(function(Rh,Rm){typeof exports=="object"&&typeof module<"u"?Rm(exports):typeof define=="function"&&define.amd?define(["exports"],Rm):(Rh=typeof globalThis<"u"?globalThis:Rh||self,Rm(Rh.mapicgcgl={}))})(this,function(Rh){"use strict";function Rm(i,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in i)){const o=Object.getOwnPropertyDescriptor(r,n);o&&Object.defineProperty(i,n,o.get?o:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}var lf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function C_(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var OI={exports:{}};(function(i,e){(function(t,r){i.exports=r()})(lf,function(){var t={},r={};function n(l,s,g){if(r[l]=g,l==="index"){var b="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",T={};return r.shared(T),r.index(t,T),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([b],{type:"text/javascript"}))),t}}n("shared",["exports"],function(l){function s(p,u,m,C){return new(m||(m=Promise))(function(P,Q){function V(he){try{re(C.next(he))}catch(h){Q(h)}}function K(he){try{re(C.throw(he))}catch(h){Q(h)}}function re(he){var h;he.done?P(he.value):(h=he.value,h instanceof m?h:new m(function(c){c(h)})).then(V,K)}re((C=C.apply(p,u||[])).next())})}function g(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}typeof SuppressedError=="function"&&SuppressedError;var b=T;function T(p,u){this.x=p,this.y=u}T.prototype={clone:function(){return new T(this.x,this.y)},add:function(p){return this.clone()._add(p)},sub:function(p){return this.clone()._sub(p)},multByPoint:function(p){return this.clone()._multByPoint(p)},divByPoint:function(p){return this.clone()._divByPoint(p)},mult:function(p){return this.clone()._mult(p)},div:function(p){return this.clone()._div(p)},rotate:function(p){return this.clone()._rotate(p)},rotateAround:function(p,u){return this.clone()._rotateAround(p,u)},matMult:function(p){return this.clone()._matMult(p)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(p){return this.x===p.x&&this.y===p.y},dist:function(p){return Math.sqrt(this.distSqr(p))},distSqr:function(p){var u=p.x-this.x,m=p.y-this.y;return u*u+m*m},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(p){return Math.atan2(this.y-p.y,this.x-p.x)},angleWith:function(p){return this.angleWithSep(p.x,p.y)},angleWithSep:function(p,u){return Math.atan2(this.x*u-this.y*p,this.x*p+this.y*u)},_matMult:function(p){var u=p[2]*this.x+p[3]*this.y;return this.x=p[0]*this.x+p[1]*this.y,this.y=u,this},_add:function(p){return this.x+=p.x,this.y+=p.y,this},_sub:function(p){return this.x-=p.x,this.y-=p.y,this},_mult:function(p){return this.x*=p,this.y*=p,this},_div:function(p){return this.x/=p,this.y/=p,this},_multByPoint:function(p){return this.x*=p.x,this.y*=p.y,this},_divByPoint:function(p){return this.x/=p.x,this.y/=p.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var p=this.y;return this.y=this.x,this.x=-p,this},_rotate:function(p){var u=Math.cos(p),m=Math.sin(p),C=m*this.x+u*this.y;return this.x=u*this.x-m*this.y,this.y=C,this},_rotateAround:function(p,u){var m=Math.cos(p),C=Math.sin(p),P=u.y+C*(this.x-u.x)+m*(this.y-u.y);return this.x=u.x+m*(this.x-u.x)-C*(this.y-u.y),this.y=P,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},T.convert=function(p){return p instanceof T?p:Array.isArray(p)?new T(p[0],p[1]):p};var F=g(b),k=z;function z(p,u,m,C){this.cx=3*p,this.bx=3*(m-p)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(C-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=p,this.p1y=u,this.p2x=m,this.p2y=C}z.prototype={sampleCurveX:function(p){return((this.ax*p+this.bx)*p+this.cx)*p},sampleCurveY:function(p){return((this.ay*p+this.by)*p+this.cy)*p},sampleCurveDerivativeX:function(p){return(3*this.ax*p+2*this.bx)*p+this.cx},solveCurveX:function(p,u){if(u===void 0&&(u=1e-6),p<0)return 0;if(p>1)return 1;for(var m=p,C=0;C<8;C++){var P=this.sampleCurveX(m)-p;if(Math.abs(P)<u)return m;var Q=this.sampleCurveDerivativeX(m);if(Math.abs(Q)<1e-6)break;m-=P/Q}var V=0,K=1;for(m=p,C=0;C<20&&(P=this.sampleCurveX(m),!(Math.abs(P-p)<u));C++)p>P?V=m:K=m,m=.5*(K-V)+V;return m},solve:function(p,u){return this.sampleCurveY(this.solveCurveX(p,u))}};var J=g(k);let te,ue;function ce(){return te==null&&(te=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),te}function de(){if(ue==null&&(ue=!1,ce())){const u=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(u){for(let C=0;C<5*5;C++){const P=4*C;u.fillStyle=`rgb(${P},${P+1},${P+2})`,u.fillRect(C%5,Math.floor(C/5),1,1)}const m=u.getImageData(0,0,5,5).data;for(let C=0;C<5*5*4;C++)if(C%4!=3&&m[C]!==C){ue=!0;break}}}return ue||!1}function _e(p,u,m,C){const P=new J(p,u,m,C);return function(Q){return P.solve(Q)}}const Ee=_e(.25,.1,.25,1);function He(p,u,m){return Math.min(m,Math.max(u,p))}function Ve(p,u,m){const C=m-u,P=((p-u)%C+C)%C+u;return P===u?m:P}function qe(p){for(var u=arguments.length,m=new Array(u>1?u-1:0),C=1;C<u;C++)m[C-1]=arguments[C];for(const P of m)for(const Q in P)p[Q]=P[Q];return p}let Ue=1;function ot(p,u,m){const C={};for(const P in p)C[P]=u.call(m||this,p[P],P,p);return C}function it(p,u,m){const C={};for(const P in p)u.call(m||this,p[P],P,p)&&(C[P]=p[P]);return C}function De(p){return Array.isArray(p)?p.map(De):typeof p=="object"&&p?ot(p,De):p}const Me={};function Ze(p){Me[p]||(typeof console<"u"&&console.warn(p),Me[p]=!0)}function We(p,u,m){return(m.y-p.y)*(u.x-p.x)>(u.y-p.y)*(m.x-p.x)}function Bt(p){let u=0;for(let m,C,P=0,Q=p.length,V=Q-1;P<Q;V=P++)m=p[P],C=p[V],u+=(C.x-m.x)*(m.y+C.y);return u}function Ct(p){return typeof WorkerGlobalScope<"u"&&p!==void 0&&p instanceof WorkerGlobalScope}let Lt=null;function _t(p){return typeof ImageBitmap<"u"&&p instanceof ImageBitmap}const Ft="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Mt(p,u,m,C,P){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const Q=new VideoFrame(p,{timestamp:0});try{const V=Q==null?void 0:Q.format;if(!V||!V.startsWith("BGR")&&!V.startsWith("RGB"))throw new Error(`Unrecognized format ${V}`);const K=V.startsWith("BGR"),re=new Uint8ClampedArray(C*P*4);if(yield Q.copyTo(re,function(he,h,c,f,v){const E=4*Math.max(-h,0),M=(Math.max(0,c)-c)*f*4+E,D=4*f,G=Math.max(0,h),$=Math.max(0,c);return{rect:{x:G,y:$,width:Math.min(he.width,h+f)-G,height:Math.min(he.height,c+v)-$},layout:[{offset:M,stride:D}]}}(p,u,m,C,P)),K)for(let he=0;he<re.length;he+=4){const h=re[he];re[he]=re[he+2],re[he+2]=h}return re}finally{Q.close()}})}let Wt,Se;const Xe="AbortError";function et(){return new Error(Xe)}const At={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ft(p){return At.REGISTERED_PROTOCOLS[p.substring(0,p.indexOf("://"))]}const wt="global-dispatcher";class Pt extends Error{constructor(u,m,C,P){super(`AJAXError: ${m} (${u}): ${C}`),this.status=u,this.statusText=m,this.url=C,this.body=P}}const It=()=>Ct(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ht=function(p,u){if(/:\/\//.test(p.url)&&!/^https?:|^file:/.test(p.url)){const C=ft(p.url);if(C)return C(p,u);if(Ct(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:p,targetMapId:wt},u)}if(!(/^file:/.test(m=p.url)||/^file:/.test(It())&&!/^\w+:/.test(m))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(C,P){return s(this,void 0,void 0,function*(){const Q=new Request(C.url,{method:C.method||"GET",body:C.body,credentials:C.credentials,headers:C.headers,cache:C.cache,referrer:It(),signal:P.signal});C.type==="json"&&Q.headers.set("Accept","application/json");const V=yield fetch(Q);if(!V.ok){const he=yield V.blob();throw new Pt(V.status,V.statusText,C.url,he)}const K=C.type==="arrayBuffer"||C.type==="image"?V.arrayBuffer():C.type==="json"?V.json():V.text(),re=yield K;if(P.signal.aborted)throw et();return{data:re,cacheControl:V.headers.get("Cache-Control"),expires:V.headers.get("Expires")}})}(p,u);if(Ct(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:p,mustQueue:!0,targetMapId:wt},u)}var m;return function(C,P){return new Promise((Q,V)=>{const K=new XMLHttpRequest;K.open(C.method||"GET",C.url,!0),C.type!=="arrayBuffer"&&C.type!=="image"||(K.responseType="arraybuffer");for(const re in C.headers)K.setRequestHeader(re,C.headers[re]);C.type==="json"&&(K.responseType="text",K.setRequestHeader("Accept","application/json")),K.withCredentials=C.credentials==="include",K.onerror=()=>{V(new Error(K.statusText))},K.onload=()=>{if(!P.signal.aborted)if((K.status>=200&&K.status<300||K.status===0)&&K.response!==null){let re=K.response;if(C.type==="json")try{re=JSON.parse(K.response)}catch(he){return void V(he)}Q({data:re,cacheControl:K.getResponseHeader("Cache-Control"),expires:K.getResponseHeader("Expires")})}else{const re=new Blob([K.response],{type:K.getResponseHeader("Content-Type")});V(new Pt(K.status,K.statusText,C.url,re))}},P.signal.addEventListener("abort",()=>{K.abort(),V(et())}),K.send(C.body)})}(p,u)};function ii(p){if(!p||p.indexOf("://")<=0||p.indexOf("data:image/")===0||p.indexOf("blob:")===0)return!0;const u=new URL(p),m=window.location;return u.protocol===m.protocol&&u.host===m.host}function gi(p,u,m){m[p]&&m[p].indexOf(u)!==-1||(m[p]=m[p]||[],m[p].push(u))}function mi(p,u,m){if(m&&m[p]){const C=m[p].indexOf(u);C!==-1&&m[p].splice(C,1)}}class Mi{constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};qe(this,m),this.type=u}}class kt extends Mi{constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",qe({error:u},m))}}class at{on(u,m){return this._listeners=this._listeners||{},gi(u,m,this._listeners),this}off(u,m){return mi(u,m,this._listeners),mi(u,m,this._oneTimeListeners),this}once(u,m){return m?(this._oneTimeListeners=this._oneTimeListeners||{},gi(u,m,this._oneTimeListeners),this):new Promise(C=>this.once(u,C))}fire(u,m){typeof u=="string"&&(u=new Mi(u,m||{}));const C=u.type;if(this.listens(C)){u.target=this;const P=this._listeners&&this._listeners[C]?this._listeners[C].slice():[];for(const K of P)K.call(this,u);const Q=this._oneTimeListeners&&this._oneTimeListeners[C]?this._oneTimeListeners[C].slice():[];for(const K of Q)mi(C,K,this._oneTimeListeners),K.call(this,u);const V=this._eventedParent;V&&(qe(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),V.fire(u))}else u instanceof kt&&console.error(u.error);return this}listens(u){return this._listeners&&this._listeners[u]&&this._listeners[u].length>0||this._oneTimeListeners&&this._oneTimeListeners[u]&&this._oneTimeListeners[u].length>0||this._eventedParent&&this._eventedParent.listens(u)}setEventedParent(u,m){return this._eventedParent=u,this._eventedParentData=m,this}}var xt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ri=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ei(p,u){const m={};for(const C in p)C!=="ref"&&(m[C]=p[C]);return Ri.forEach(C=>{C in u&&(m[C]=u[C])}),m}function ut(p,u){if(Array.isArray(p)){if(!Array.isArray(u)||p.length!==u.length)return!1;for(let m=0;m<p.length;m++)if(!ut(p[m],u[m]))return!1;return!0}if(typeof p=="object"&&p!==null&&u!==null){if(typeof u!="object"||Object.keys(p).length!==Object.keys(u).length)return!1;for(const m in p)if(!ut(p[m],u[m]))return!1;return!0}return p===u}function jt(p,u){p.push(u)}function ni(p,u,m){jt(m,{command:"addSource",args:[p,u[p]]})}function di(p,u,m){jt(u,{command:"removeSource",args:[p]}),m[p]=!0}function li(p,u,m,C){di(p,m,C),ni(p,u,m)}function Ki(p,u,m){let C;for(C in p[m])if(Object.prototype.hasOwnProperty.call(p[m],C)&&C!=="data"&&!ut(p[m][C],u[m][C]))return!1;for(C in u[m])if(Object.prototype.hasOwnProperty.call(u[m],C)&&C!=="data"&&!ut(p[m][C],u[m][C]))return!1;return!0}function tr(p,u,m,C,P,Q){p=p||{},u=u||{};for(const V in p)Object.prototype.hasOwnProperty.call(p,V)&&(ut(p[V],u[V])||m.push({command:Q,args:[C,V,u[V],P]}));for(const V in u)Object.prototype.hasOwnProperty.call(u,V)&&!Object.prototype.hasOwnProperty.call(p,V)&&(ut(p[V],u[V])||m.push({command:Q,args:[C,V,u[V],P]}))}function Ar(p){return p.id}function Er(p,u){return p[u.id]=u,p}class Nt{constructor(u,m,C,P){this.message=(u?`${u}: `:"")+C,P&&(this.identifier=P),m!=null&&m.__line__&&(this.line=m.__line__)}}function Ji(p){for(var u=arguments.length,m=new Array(u>1?u-1:0),C=1;C<u;C++)m[C-1]=arguments[C];for(const P of m)for(const Q in P)p[Q]=P[Q];return p}class ci extends Error{constructor(u,m){super(m),this.message=m,this.key=u}}class $t{constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=u,this.bindings={};for(const[C,P]of m)this.bindings[C]=P}concat(u){return new $t(this,u)}get(u){if(this.bindings[u])return this.bindings[u];if(this.parent)return this.parent.get(u);throw new Error(`${u} not found in scope.`)}has(u){return!!this.bindings[u]||!!this.parent&&this.parent.has(u)}}const Zi={kind:"null"},Qt={kind:"number"},Bi={kind:"string"},Ii={kind:"boolean"},Gt={kind:"color"},vi={kind:"object"},Jt={kind:"value"},mr={kind:"collator"},Sr={kind:"formatted"},ze={kind:"padding"},we={kind:"resolvedImage"},oe={kind:"variableAnchorOffsetCollection"};function ee(p,u){return{kind:"array",itemType:p,N:u}}function le(p){if(p.kind==="array"){const u=le(p.itemType);return typeof p.N=="number"?`array<${u}, ${p.N}>`:p.itemType.kind==="value"?"array":`array<${u}>`}return p.kind}const ge=[Zi,Qt,Bi,Ii,Gt,Sr,vi,ee(Jt),ze,we,oe];function ve(p,u){if(u.kind==="error")return null;if(p.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!ve(p.itemType,u.itemType))&&(typeof p.N!="number"||p.N===u.N))return null}else{if(p.kind===u.kind)return null;if(p.kind==="value"){for(const m of ge)if(!ve(m,u))return null}}return`Expected ${le(p)} but found ${le(u)} instead.`}function Ce(p,u){return u.some(m=>m.kind===p.kind)}function be(p,u){return u.some(m=>m==="null"?p===null:m==="array"?Array.isArray(p):m==="object"?p&&!Array.isArray(p)&&typeof p=="object":m===typeof p)}function Pe(p,u){return p.kind==="array"&&u.kind==="array"?p.itemType.kind===u.itemType.kind&&typeof p.N=="number":p.kind===u.kind}const Oe=.96422,Ge=.82521,rt=4/29,yt=6/29,Et=3*yt*yt,Yt=yt*yt*yt,qt=Math.PI/180,Kt=180/Math.PI;function si(p){return(p%=360)<0&&(p+=360),p}function Ci(p){let[u,m,C,P]=p,Q,V;const K=wi((.2225045*(u=Hi(u))+.7168786*(m=Hi(m))+.0606169*(C=Hi(C)))/1);u===m&&m===C?Q=V=K:(Q=wi((.4360747*u+.3850649*m+.1430804*C)/Oe),V=wi((.0139322*u+.0971045*m+.7141733*C)/Ge));const re=116*K-16;return[re<0?0:re,500*(Q-K),200*(K-V),P]}function Hi(p){return p<=.04045?p/12.92:Math.pow((p+.055)/1.055,2.4)}function wi(p){return p>Yt?Math.pow(p,1/3):p/Et+rt}function Ui(p){let[u,m,C,P]=p,Q=(u+16)/116,V=isNaN(m)?Q:Q+m/500,K=isNaN(C)?Q:Q-C/200;return Q=1*ti(Q),V=Oe*ti(V),K=Ge*ti(K),[st(3.1338561*V-1.6168667*Q-.4906146*K),st(-.9787684*V+1.9161415*Q+.033454*K),st(.0719453*V-.2289914*Q+1.4052427*K),P]}function st(p){return(p=p<=.00304?12.92*p:1.055*Math.pow(p,1/2.4)-.055)<0?0:p>1?1:p}function ti(p){return p>yt?p*p*p:Et*(p-rt)}function zt(p){return parseInt(p.padEnd(2,p),16)/255}function zi(p,u){return hr(u?p/100:p,0,1)}function hr(p,u,m){return Math.min(Math.max(u,p),m)}function sn(p){return!p.some(Number.isNaN)}const bn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ur{constructor(u,m,C){let P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=u,this.g=m,this.b=C,this.a=P,Q||(this.r*=P,this.g*=P,this.b*=P,P||this.overwriteGetter("rgb",[u,m,C,P]))}static parse(u){if(u instanceof ur)return u;if(typeof u!="string")return;const m=function(C){if((C=C.toLowerCase().trim())==="transparent")return[0,0,0,0];const P=bn[C];if(P){const[V,K,re]=P;return[V/255,K/255,re/255,1]}if(C.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(C)){const V=C.length<6?1:2;let K=1;return[zt(C.slice(K,K+=V)),zt(C.slice(K,K+=V)),zt(C.slice(K,K+=V)),zt(C.slice(K,K+V)||"ff")]}if(C.startsWith("rgb")){const V=C.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(V){const[K,re,he,h,c,f,v,E,M,D,G,$]=V,X=[h||" ",v||" ",D].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){const se=[he,f,M].join(""),Ae=se==="%%%"?100:se===""?255:0;if(Ae){const me=[hr(+re/Ae,0,1),hr(+c/Ae,0,1),hr(+E/Ae,0,1),G?zi(+G,$):1];if(sn(me))return me}}return}}const Q=C.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(Q){const[V,K,re,he,h,c,f,v,E]=Q,M=[re||" ",h||" ",f].join("");if(M==="  "||M==="  /"||M===",,"||M===",,,"){const D=[+K,hr(+he,0,100),hr(+c,0,100),v?zi(+v,E):1];if(sn(D))return function(G){let[$,X,se,Ae]=G;function me(Be){const Te=(Be+$/30)%12,ke=X*Math.min(se,1-se);return se-ke*Math.max(-1,Math.min(Te-3,9-Te,1))}return $=si($),X/=100,se/=100,[me(0),me(8),me(4),Ae]}(D)}}}(u);return m?new ur(...m,!1):void 0}get rgb(){const{r:u,g:m,b:C,a:P}=this,Q=P||1/0;return this.overwriteGetter("rgb",[u/Q,m/Q,C/Q,P])}get hcl(){return this.overwriteGetter("hcl",function(u){const[m,C,P,Q]=Ci(u),V=Math.sqrt(C*C+P*P);return[Math.round(1e4*V)?si(Math.atan2(P,C)*Kt):NaN,V,m,Q]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ci(this.rgb))}overwriteGetter(u,m){return Object.defineProperty(this,u,{value:m}),m}toString(){const[u,m,C,P]=this.rgb;return`rgba(${[u,m,C].map(Q=>Math.round(255*Q)).join(",")},${P})`}}ur.black=new ur(0,0,0,1),ur.white=new ur(1,1,1,1),ur.transparent=new ur(0,0,0,0),ur.red=new ur(1,0,0,1);class gn{constructor(u,m,C){this.sensitivity=u?m?"variant":"case":m?"accent":"base",this.locale=C,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(u,m){return this.collator.compare(u,m)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class mn{constructor(u,m,C,P,Q){this.text=u,this.image=m,this.scale=C,this.fontStack=P,this.textColor=Q}}class lr{constructor(u){this.sections=u}static fromString(u){return new lr([new mn(u,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(u=>u.text.length!==0||u.image&&u.image.name.length!==0)}static factory(u){return u instanceof lr?u:lr.fromString(u)}toString(){return this.sections.length===0?"":this.sections.map(u=>u.text).join("")}}class kn{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof kn)return u;if(typeof u=="number")return new kn([u,u,u,u]);if(Array.isArray(u)&&!(u.length<1||u.length>4)){for(const m of u)if(typeof m!="number")return;switch(u.length){case 1:u=[u[0],u[0],u[0],u[0]];break;case 2:u=[u[0],u[1],u[0],u[1]];break;case 3:u=[u[0],u[1],u[2],u[1]]}return new kn(u)}}toString(){return JSON.stringify(this.values)}}const gs=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Qr{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof Qr)return u;if(Array.isArray(u)&&!(u.length<1)&&u.length%2==0){for(let m=0;m<u.length;m+=2){const C=u[m],P=u[m+1];if(typeof C!="string"||!gs.has(C)||!Array.isArray(P)||P.length!==2||typeof P[0]!="number"||typeof P[1]!="number")return}return new Qr(u)}}toString(){return JSON.stringify(this.values)}}class xn{constructor(u){this.name=u.name,this.available=u.available}toString(){return this.name}static fromString(u){return u?new xn({name:u,available:!1}):null}}function So(p,u,m,C){return typeof p=="number"&&p>=0&&p<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof m=="number"&&m>=0&&m<=255?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid rgba value [${[p,u,m,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof C=="number"?[p,u,m,C]:[p,u,m]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function us(p){if(p===null||typeof p=="string"||typeof p=="boolean"||typeof p=="number"||p instanceof ur||p instanceof gn||p instanceof lr||p instanceof kn||p instanceof Qr||p instanceof xn)return!0;if(Array.isArray(p)){for(const u of p)if(!us(u))return!1;return!0}if(typeof p=="object"){for(const u in p)if(!us(p[u]))return!1;return!0}return!1}function Wi(p){if(p===null)return Zi;if(typeof p=="string")return Bi;if(typeof p=="boolean")return Ii;if(typeof p=="number")return Qt;if(p instanceof ur)return Gt;if(p instanceof gn)return mr;if(p instanceof lr)return Sr;if(p instanceof kn)return ze;if(p instanceof Qr)return oe;if(p instanceof xn)return we;if(Array.isArray(p)){const u=p.length;let m;for(const C of p){const P=Wi(C);if(m){if(m===P)continue;m=Jt;break}m=P}return ee(m||Jt,u)}return vi}function Ys(p){const u=typeof p;return p===null?"":u==="string"||u==="number"||u==="boolean"?String(p):p instanceof ur||p instanceof lr||p instanceof kn||p instanceof Qr||p instanceof xn?p.toString():JSON.stringify(p)}class Bs{constructor(u,m){this.type=u,this.value=m}static parse(u,m){if(u.length!==2)return m.error(`'literal' expression requires exactly one argument, but found ${u.length-1} instead.`);if(!us(u[1]))return m.error("invalid value");const C=u[1];let P=Wi(C);const Q=m.expectedType;return P.kind!=="array"||P.N!==0||!Q||Q.kind!=="array"||typeof Q.N=="number"&&Q.N!==0||(P=Q),new Bs(P,C)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class dr{constructor(u){this.name="ExpressionEvaluationError",this.message=u}toJSON(){return this.message}}const Fr={string:Bi,number:Qt,boolean:Ii,object:vi};class Hn{constructor(u,m){this.type=u,this.args=m}static parse(u,m){if(u.length<2)return m.error("Expected at least one argument.");let C,P=1;const Q=u[0];if(Q==="array"){let K,re;if(u.length>2){const he=u[1];if(typeof he!="string"||!(he in Fr)||he==="object")return m.error('The item type argument of "array" must be one of string, number, boolean',1);K=Fr[he],P++}else K=Jt;if(u.length>3){if(u[2]!==null&&(typeof u[2]!="number"||u[2]<0||u[2]!==Math.floor(u[2])))return m.error('The length argument to "array" must be a positive integer literal',2);re=u[2],P++}C=ee(K,re)}else{if(!Fr[Q])throw new Error(`Types doesn't contain name = ${Q}`);C=Fr[Q]}const V=[];for(;P<u.length;P++){const K=m.parse(u[P],P,Jt);if(!K)return null;V.push(K)}return new Hn(C,V)}evaluate(u){for(let m=0;m<this.args.length;m++){const C=this.args[m].evaluate(u);if(!ve(this.type,Wi(C)))return C;if(m===this.args.length-1)throw new dr(`Expected value to be of type ${le(this.type)}, but found ${le(Wi(C))} instead.`)}throw new Error}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}const Or={"to-boolean":Ii,"to-color":Gt,"to-number":Qt,"to-string":Bi};class Cn{constructor(u,m){this.type=u,this.args=m}static parse(u,m){if(u.length<2)return m.error("Expected at least one argument.");const C=u[0];if(!Or[C])throw new Error(`Can't parse ${C} as it is not part of the known types`);if((C==="to-boolean"||C==="to-string")&&u.length!==2)return m.error("Expected one argument.");const P=Or[C],Q=[];for(let V=1;V<u.length;V++){const K=m.parse(u[V],V,Jt);if(!K)return null;Q.push(K)}return new Cn(P,Q)}evaluate(u){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(u);case"color":{let m,C;for(const P of this.args){if(m=P.evaluate(u),C=null,m instanceof ur)return m;if(typeof m=="string"){const Q=u.parseColor(m);if(Q)return Q}else if(Array.isArray(m)&&(C=m.length<3||m.length>4?`Invalid rbga value ${JSON.stringify(m)}: expected an array containing either three or four numeric values.`:So(m[0],m[1],m[2],m[3]),!C))return new ur(m[0]/255,m[1]/255,m[2]/255,m[3])}throw new dr(C||`Could not parse color from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"padding":{let m;for(const C of this.args){m=C.evaluate(u);const P=kn.parse(m);if(P)return P}throw new dr(`Could not parse padding from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"variableAnchorOffsetCollection":{let m;for(const C of this.args){m=C.evaluate(u);const P=Qr.parse(m);if(P)return P}throw new dr(`Could not parse variableAnchorOffsetCollection from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"number":{let m=null;for(const C of this.args){if(m=C.evaluate(u),m===null)return 0;const P=Number(m);if(!isNaN(P))return P}throw new dr(`Could not convert ${JSON.stringify(m)} to number.`)}case"formatted":return lr.fromString(Ys(this.args[0].evaluate(u)));case"resolvedImage":return xn.fromString(Ys(this.args[0].evaluate(u)));default:return Ys(this.args[0].evaluate(u))}}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}const An=["Unknown","Point","LineString","Polygon"];class Hr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?An[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(u){let m=this._parseColorCache[u];return m||(m=this._parseColorCache[u]=ur.parse(u)),m}}class Gs{constructor(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],P=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new $t,V=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=u,this.path=C,this.key=C.map(K=>`[${K}]`).join(""),this.scope=Q,this.errors=V,this.expectedType=P,this._isConstant=m}parse(u,m,C,P){let Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return m?this.concat(m,C,P)._parse(u,Q):this._parse(u,Q)}_parse(u,m){function C(P,Q,V){return V==="assert"?new Hn(Q,[P]):V==="coerce"?new Cn(Q,[P]):P}if(u!==null&&typeof u!="string"&&typeof u!="boolean"&&typeof u!="number"||(u=["literal",u]),Array.isArray(u)){if(u.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const P=u[0];if(typeof P!="string")return this.error(`Expression name must be a string, but found ${typeof P} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Q=this.registry[P];if(Q){let V=Q.parse(u,this);if(!V)return null;if(this.expectedType){const K=this.expectedType,re=V.type;if(K.kind!=="string"&&K.kind!=="number"&&K.kind!=="boolean"&&K.kind!=="object"&&K.kind!=="array"||re.kind!=="value")if(K.kind!=="color"&&K.kind!=="formatted"&&K.kind!=="resolvedImage"||re.kind!=="value"&&re.kind!=="string")if(K.kind!=="padding"||re.kind!=="value"&&re.kind!=="number"&&re.kind!=="array")if(K.kind!=="variableAnchorOffsetCollection"||re.kind!=="value"&&re.kind!=="array"){if(this.checkSubtype(K,re))return null}else V=C(V,K,m.typeAnnotation||"coerce");else V=C(V,K,m.typeAnnotation||"coerce");else V=C(V,K,m.typeAnnotation||"coerce");else V=C(V,K,m.typeAnnotation||"assert")}if(!(V instanceof Bs)&&V.type.kind!=="resolvedImage"&&this._isConstant(V)){const K=new Hr;try{V=new Bs(V.type,V.evaluate(K))}catch(re){return this.error(re.message),null}}return V}return this.error(`Unknown expression "${P}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(u===void 0?"'undefined' value invalid. Use null instead.":typeof u=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof u} instead.`)}concat(u,m,C){const P=typeof u=="number"?this.path.concat(u):this.path,Q=C?this.scope.concat(C):this.scope;return new Gs(this.registry,this._isConstant,P,m||null,Q,this.errors)}error(u){for(var m=arguments.length,C=new Array(m>1?m-1:0),P=1;P<m;P++)C[P-1]=arguments[P];const Q=`${this.key}${C.map(V=>`[${V}]`).join("")}`;this.errors.push(new ci(Q,u))}checkSubtype(u,m){const C=ve(u,m);return C&&this.error(C),C}}class ca{constructor(u,m,C){this.type=mr,this.locale=C,this.caseSensitive=u,this.diacriticSensitive=m}static parse(u,m){if(u.length!==2)return m.error("Expected one argument.");const C=u[1];if(typeof C!="object"||Array.isArray(C))return m.error("Collator options argument must be an object.");const P=m.parse(C["case-sensitive"]!==void 0&&C["case-sensitive"],1,Ii);if(!P)return null;const Q=m.parse(C["diacritic-sensitive"]!==void 0&&C["diacritic-sensitive"],1,Ii);if(!Q)return null;let V=null;return C.locale&&(V=m.parse(C.locale,1,Bi),!V)?null:new ca(P,Q,V)}evaluate(u){return new gn(this.caseSensitive.evaluate(u),this.diacriticSensitive.evaluate(u),this.locale?this.locale.evaluate(u):null)}eachChild(u){u(this.caseSensitive),u(this.diacriticSensitive),this.locale&&u(this.locale)}outputDefined(){return!1}}const uo=8192;function Ea(p,u){p[0]=Math.min(p[0],u[0]),p[1]=Math.min(p[1],u[1]),p[2]=Math.max(p[2],u[0]),p[3]=Math.max(p[3],u[1])}function Ne(p,u){return!(p[0]<=u[0]||p[2]>=u[2]||p[1]<=u[1]||p[3]>=u[3])}function Je(p,u){const m=(180+p[0])/360,C=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+p[1]*Math.PI/360)))/360,P=Math.pow(2,u.z);return[Math.round(m*P*uo),Math.round(C*P*uo)]}function dt(p,u,m){const C=p[0]-u[0],P=p[1]-u[1],Q=p[0]-m[0],V=p[1]-m[1];return C*V-Q*P==0&&C*Q<=0&&P*V<=0}function Ot(p,u){let m=!1;for(let V=0,K=u.length;V<K;V++){const re=u[V];for(let he=0,h=re.length;he<h-1;he++){if(dt(p,re[he],re[he+1]))return!1;(P=re[he])[1]>(C=p)[1]!=(Q=re[he+1])[1]>C[1]&&C[0]<(Q[0]-P[0])*(C[1]-P[1])/(Q[1]-P[1])+P[0]&&(m=!m)}}var C,P,Q;return m}function ui(p,u){for(let m=0;m<u.length;m++)if(Ot(p,u[m]))return!0;return!1}function Gi(p,u,m,C){const P=C[0]-m[0],Q=C[1]-m[1],V=(p[0]-m[0])*Q-P*(p[1]-m[1]),K=(u[0]-m[0])*Q-P*(u[1]-m[1]);return V>0&&K<0||V<0&&K>0}function br(p,u,m){for(const he of m)for(let h=0;h<he.length-1;++h)if((K=[(V=he[h+1])[0]-(Q=he[h])[0],V[1]-Q[1]])[0]*(re=[(P=u)[0]-(C=p)[0],P[1]-C[1]])[1]-K[1]*re[0]!=0&&Gi(C,P,Q,V)&&Gi(Q,V,C,P))return!0;var C,P,Q,V,K,re;return!1}function En(p,u){for(let m=0;m<p.length;++m)if(!Ot(p[m],u))return!1;for(let m=0;m<p.length-1;++m)if(br(p[m],p[m+1],u))return!1;return!0}function On(p,u){for(let m=0;m<u.length;m++)if(En(p,u[m]))return!0;return!1}function rs(p,u,m){const C=[];for(let P=0;P<p.length;P++){const Q=[];for(let V=0;V<p[P].length;V++){const K=Je(p[P][V],m);Ea(u,K),Q.push(K)}C.push(Q)}return C}function wn(p,u,m){const C=[];for(let P=0;P<p.length;P++){const Q=rs(p[P],u,m);C.push(Q)}return C}function au(p,u,m,C){if(p[0]<m[0]||p[0]>m[2]){const P=.5*C;let Q=p[0]-m[0]>P?-C:m[0]-p[0]>P?C:0;Q===0&&(Q=p[0]-m[2]>P?-C:m[2]-p[0]>P?C:0),p[0]+=Q}Ea(u,p)}function $a(p,u,m,C){const P=Math.pow(2,C.z)*uo,Q=[C.x*uo,C.y*uo],V=[];for(const K of p)for(const re of K){const he=[re.x+Q[0],re.y+Q[1]];au(he,u,m,P),V.push(he)}return V}function Tr(p,u,m,C){const P=Math.pow(2,C.z)*uo,Q=[C.x*uo,C.y*uo],V=[];for(const re of p){const he=[];for(const h of re){const c=[h.x+Q[0],h.y+Q[1]];Ea(u,c),he.push(c)}V.push(he)}if(u[2]-u[0]<=P/2){(K=u)[0]=K[1]=1/0,K[2]=K[3]=-1/0;for(const re of V)for(const he of re)au(he,u,m,P)}var K;return V}class Ka{constructor(u,m){this.type=Ii,this.geojson=u,this.geometries=m}static parse(u,m){if(u.length!==2)return m.error(`'within' expression requires exactly one argument, but found ${u.length-1} instead.`);if(us(u[1])){const C=u[1];if(C.type==="FeatureCollection"){const P=[];for(const Q of C.features){const{type:V,coordinates:K}=Q.geometry;V==="Polygon"&&P.push(K),V==="MultiPolygon"&&P.push(...K)}if(P.length)return new Ka(C,{type:"MultiPolygon",coordinates:P})}else if(C.type==="Feature"){const P=C.geometry.type;if(P==="Polygon"||P==="MultiPolygon")return new Ka(C,C.geometry)}else if(C.type==="Polygon"||C.type==="MultiPolygon")return new Ka(C,C)}return m.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(u){if(u.geometry()!=null&&u.canonicalID()!=null){if(u.geometryType()==="Point")return function(m,C){const P=[1/0,1/0,-1/0,-1/0],Q=[1/0,1/0,-1/0,-1/0],V=m.canonicalID();if(C.type==="Polygon"){const K=rs(C.coordinates,Q,V),re=$a(m.geometry(),P,Q,V);if(!Ne(P,Q))return!1;for(const he of re)if(!Ot(he,K))return!1}if(C.type==="MultiPolygon"){const K=wn(C.coordinates,Q,V),re=$a(m.geometry(),P,Q,V);if(!Ne(P,Q))return!1;for(const he of re)if(!ui(he,K))return!1}return!0}(u,this.geometries);if(u.geometryType()==="LineString")return function(m,C){const P=[1/0,1/0,-1/0,-1/0],Q=[1/0,1/0,-1/0,-1/0],V=m.canonicalID();if(C.type==="Polygon"){const K=rs(C.coordinates,Q,V),re=Tr(m.geometry(),P,Q,V);if(!Ne(P,Q))return!1;for(const he of re)if(!En(he,K))return!1}if(C.type==="MultiPolygon"){const K=wn(C.coordinates,Q,V),re=Tr(m.geometry(),P,Q,V);if(!Ne(P,Q))return!1;for(const he of re)if(!On(he,K))return!1}return!0}(u,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ul{constructor(u,m){this.type=m.type,this.name=u,this.boundExpression=m}static parse(u,m){if(u.length!==2||typeof u[1]!="string")return m.error("'var' expression requires exactly one string literal argument.");const C=u[1];return m.scope.has(C)?new Ul(C,m.scope.get(C)):m.error(`Unknown variable "${C}". Make sure "${C}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(u){return this.boundExpression.evaluate(u)}eachChild(){}outputDefined(){return!1}}class Yn{constructor(u,m,C,P){this.name=u,this.type=m,this._evaluate=C,this.args=P}evaluate(u){return this._evaluate(u,this.args)}eachChild(u){this.args.forEach(u)}outputDefined(){return!1}static parse(u,m){const C=u[0],P=Yn.definitions[C];if(!P)return m.error(`Unknown expression "${C}". If you wanted a literal array, use ["literal", [...]].`,0);const Q=Array.isArray(P)?P[0]:P.type,V=Array.isArray(P)?[[P[1],P[2]]]:P.overloads,K=V.filter(he=>{let[h]=he;return!Array.isArray(h)||h.length===u.length-1});let re=null;for(const[he,h]of K){re=new Gs(m.registry,To,m.path,null,m.scope);const c=[];let f=!1;for(let v=1;v<u.length;v++){const E=u[v],M=Array.isArray(he)?he[v-1]:he.type,D=re.parse(E,1+c.length,M);if(!D){f=!0;break}c.push(D)}if(!f)if(Array.isArray(he)&&he.length!==c.length)re.error(`Expected ${he.length} arguments, but found ${c.length} instead.`);else{for(let v=0;v<c.length;v++){const E=Array.isArray(he)?he[v]:he.type,M=c[v];re.concat(v+1).checkSubtype(E,M.type)}if(re.errors.length===0)return new Yn(C,Q,h,c)}}if(K.length===1)m.errors.push(...re.errors);else{const he=(K.length?K:V).map(c=>{let[f]=c;return v=f,Array.isArray(v)?`(${v.map(le).join(", ")})`:`(${le(v.type)}...)`;var v}).join(" | "),h=[];for(let c=1;c<u.length;c++){const f=m.parse(u[c],1+h.length);if(!f)return null;h.push(le(f.type))}m.error(`Expected arguments of type ${he}, but found (${h.join(", ")}) instead.`)}return null}static register(u,m){Yn.definitions=m;for(const C in m)u[C]=Yn}}function To(p){if(p instanceof Ul)return To(p.boundExpression);if(p instanceof Yn&&p.name==="error"||p instanceof ca||p instanceof Ka)return!1;const u=p instanceof Cn||p instanceof Hn;let m=!0;return p.eachChild(C=>{m=u?m&&To(C):m&&C instanceof Bs}),!!m&&Wa(p)&&ua(p,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Wa(p){if(p instanceof Yn&&(p.name==="get"&&p.args.length===1||p.name==="feature-state"||p.name==="has"&&p.args.length===1||p.name==="properties"||p.name==="geometry-type"||p.name==="id"||/^filter-/.test(p.name))||p instanceof Ka)return!1;let u=!0;return p.eachChild(m=>{u&&!Wa(m)&&(u=!1)}),u}function ms(p){if(p instanceof Yn&&p.name==="feature-state")return!1;let u=!0;return p.eachChild(m=>{u&&!ms(m)&&(u=!1)}),u}function ua(p,u){if(p instanceof Yn&&u.indexOf(p.name)>=0)return!1;let m=!0;return p.eachChild(C=>{m&&!ua(C,u)&&(m=!1)}),m}function Xa(p,u){const m=p.length-1;let C,P,Q=0,V=m,K=0;for(;Q<=V;)if(K=Math.floor((Q+V)/2),C=p[K],P=p[K+1],C<=u){if(K===m||u<P)return K;Q=K+1}else{if(!(C>u))throw new dr("Input is not a number.");V=K-1}return 0}class Sa{constructor(u,m,C){this.type=u,this.input=m,this.labels=[],this.outputs=[];for(const[P,Q]of C)this.labels.push(P),this.outputs.push(Q)}static parse(u,m){if(u.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return m.error("Expected an even number of arguments.");const C=m.parse(u[1],1,Qt);if(!C)return null;const P=[];let Q=null;m.expectedType&&m.expectedType.kind!=="value"&&(Q=m.expectedType);for(let V=1;V<u.length;V+=2){const K=V===1?-1/0:u[V],re=u[V+1],he=V,h=V+1;if(typeof K!="number")return m.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',he);if(P.length&&P[P.length-1][0]>=K)return m.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',he);const c=m.parse(re,h,Q);if(!c)return null;Q=Q||c.type,P.push([K,c])}return new Sa(Q,C,P)}evaluate(u){const m=this.labels,C=this.outputs;if(m.length===1)return C[0].evaluate(u);const P=this.input.evaluate(u);if(P<=m[0])return C[0].evaluate(u);const Q=m.length;return P>=m[Q-1]?C[Q-1].evaluate(u):C[Xa(m,P)].evaluate(u)}eachChild(u){u(this.input);for(const m of this.outputs)u(m)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}}function Fc(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var Za=ho;function ho(p,u,m,C){this.cx=3*p,this.bx=3*(m-p)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(C-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=p,this.p1y=u,this.p2x=m,this.p2y=C}ho.prototype={sampleCurveX:function(p){return((this.ax*p+this.bx)*p+this.cx)*p},sampleCurveY:function(p){return((this.ay*p+this.by)*p+this.cy)*p},sampleCurveDerivativeX:function(p){return(3*this.ax*p+2*this.bx)*p+this.cx},solveCurveX:function(p,u){if(u===void 0&&(u=1e-6),p<0)return 0;if(p>1)return 1;for(var m=p,C=0;C<8;C++){var P=this.sampleCurveX(m)-p;if(Math.abs(P)<u)return m;var Q=this.sampleCurveDerivativeX(m);if(Math.abs(Q)<1e-6)break;m-=P/Q}var V=0,K=1;for(m=p,C=0;C<20&&(P=this.sampleCurveX(m),!(Math.abs(P-p)<u));C++)p>P?V=m:K=m,m=.5*(K-V)+V;return m},solve:function(p,u){return this.sampleCurveY(this.solveCurveX(p,u))}};var Pr=Fc(Za);function ha(p,u,m){return p+m*(u-p)}function hs(p,u,m){return p.map((C,P)=>ha(C,u[P],m))}const dn={number:ha,color:function(p,u,m){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[P,Q,V,K]=hs(p.rgb,u.rgb,m);return new ur(P,Q,V,K,!1)}case"hcl":{const[P,Q,V,K]=p.hcl,[re,he,h,c]=u.hcl;let f,v;if(isNaN(P)||isNaN(re))isNaN(P)?isNaN(re)?f=NaN:(f=re,V!==1&&V!==0||(v=he)):(f=P,h!==1&&h!==0||(v=Q));else{let $=re-P;re>P&&$>180?$-=360:re<P&&P-re>180&&($+=360),f=P+m*$}const[E,M,D,G]=function($){let[X,se,Ae,me]=$;return X=isNaN(X)?0:X*qt,Ui([Ae,Math.cos(X)*se,Math.sin(X)*se,me])}([f,v??ha(Q,he,m),ha(V,h,m),ha(K,c,m)]);return new ur(E,M,D,G,!1)}case"lab":{const[P,Q,V,K]=Ui(hs(p.lab,u.lab,m));return new ur(P,Q,V,K,!1)}}},array:hs,padding:function(p,u,m){return new kn(hs(p.values,u.values,m))},variableAnchorOffsetCollection:function(p,u,m){const C=p.values,P=u.values;if(C.length!==P.length)throw new dr(`Cannot interpolate values of different length. from: ${p.toString()}, to: ${u.toString()}`);const Q=[];for(let V=0;V<C.length;V+=2){if(C[V]!==P[V])throw new dr(`Cannot interpolate values containing mismatched anchors. from[${V}]: ${C[V]}, to[${V}]: ${P[V]}`);Q.push(C[V]);const[K,re]=C[V+1],[he,h]=P[V+1];Q.push([ha(K,he,m),ha(re,h,m)])}return new Qr(Q)}};class ns{constructor(u,m,C,P,Q){this.type=u,this.operator=m,this.interpolation=C,this.input=P,this.labels=[],this.outputs=[];for(const[V,K]of Q)this.labels.push(V),this.outputs.push(K)}static interpolationFactor(u,m,C,P){let Q=0;if(u.name==="exponential")Q=Vr(m,u.base,C,P);else if(u.name==="linear")Q=Vr(m,1,C,P);else if(u.name==="cubic-bezier"){const V=u.controlPoints;Q=new Pr(V[0],V[1],V[2],V[3]).solve(Vr(m,1,C,P))}return Q}static parse(u,m){let[C,P,Q,...V]=u;if(!Array.isArray(P)||P.length===0)return m.error("Expected an interpolation type expression.",1);if(P[0]==="linear")P={name:"linear"};else if(P[0]==="exponential"){const he=P[1];if(typeof he!="number")return m.error("Exponential interpolation requires a numeric base.",1,1);P={name:"exponential",base:he}}else{if(P[0]!=="cubic-bezier")return m.error(`Unknown interpolation type ${String(P[0])}`,1,0);{const he=P.slice(1);if(he.length!==4||he.some(h=>typeof h!="number"||h<0||h>1))return m.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);P={name:"cubic-bezier",controlPoints:he}}}if(u.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return m.error("Expected an even number of arguments.");if(Q=m.parse(Q,2,Qt),!Q)return null;const K=[];let re=null;C==="interpolate-hcl"||C==="interpolate-lab"?re=Gt:m.expectedType&&m.expectedType.kind!=="value"&&(re=m.expectedType);for(let he=0;he<V.length;he+=2){const h=V[he],c=V[he+1],f=he+3,v=he+4;if(typeof h!="number")return m.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(K.length&&K[K.length-1][0]>=h)return m.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);const E=m.parse(c,v,re);if(!E)return null;re=re||E.type,K.push([h,E])}return Pe(re,Qt)||Pe(re,Gt)||Pe(re,ze)||Pe(re,oe)||Pe(re,ee(Qt))?new ns(re,C,P,Q,K):m.error(`Type ${le(re)} is not interpolatable.`)}evaluate(u){const m=this.labels,C=this.outputs;if(m.length===1)return C[0].evaluate(u);const P=this.input.evaluate(u);if(P<=m[0])return C[0].evaluate(u);const Q=m.length;if(P>=m[Q-1])return C[Q-1].evaluate(u);const V=Xa(m,P),K=ns.interpolationFactor(this.interpolation,P,m[V],m[V+1]),re=C[V].evaluate(u),he=C[V+1].evaluate(u);switch(this.operator){case"interpolate":return dn[this.type.kind](re,he,K);case"interpolate-hcl":return dn.color(re,he,K,"hcl");case"interpolate-lab":return dn.color(re,he,K,"lab")}}eachChild(u){u(this.input);for(const m of this.outputs)u(m)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}}function Vr(p,u,m,C){const P=C-m,Q=p-m;return P===0?0:u===1?Q/P:(Math.pow(u,Q)-1)/(Math.pow(u,P)-1)}class Ja{constructor(u,m){this.type=u,this.args=m}static parse(u,m){if(u.length<2)return m.error("Expectected at least one argument.");let C=null;const P=m.expectedType;P&&P.kind!=="value"&&(C=P);const Q=[];for(const K of u.slice(1)){const re=m.parse(K,1+Q.length,C,void 0,{typeAnnotation:"omit"});if(!re)return null;C=C||re.type,Q.push(re)}if(!C)throw new Error("No output type");const V=P&&Q.some(K=>ve(P,K.type));return new Ja(V?Jt:C,Q)}evaluate(u){let m,C=null,P=0;for(const Q of this.args)if(P++,C=Q.evaluate(u),C&&C instanceof xn&&!C.available&&(m||(m=C.name),C=null,P===this.args.length&&(C=m)),C!==null)break;return C}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}class cl{constructor(u,m){this.type=m.type,this.bindings=[].concat(u),this.result=m}evaluate(u){return this.result.evaluate(u)}eachChild(u){for(const m of this.bindings)u(m[1]);u(this.result)}static parse(u,m){if(u.length<4)return m.error(`Expected at least 3 arguments, but found ${u.length-1} instead.`);const C=[];for(let Q=1;Q<u.length-1;Q+=2){const V=u[Q];if(typeof V!="string")return m.error(`Expected string, but found ${typeof V} instead.`,Q);if(/[^a-zA-Z0-9_]/.test(V))return m.error("Variable names must contain only alphanumeric characters or '_'.",Q);const K=m.parse(u[Q+1],Q+1);if(!K)return null;C.push([V,K])}const P=m.parse(u[u.length-1],u.length-1,m.expectedType,C);return P?new cl(C,P):null}outputDefined(){return this.result.outputDefined()}}class Nl{constructor(u,m,C){this.type=u,this.index=m,this.input=C}static parse(u,m){if(u.length!==3)return m.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,Qt),P=m.parse(u[2],2,ee(m.expectedType||Jt));return C&&P?new Nl(P.type.itemType,C,P):null}evaluate(u){const m=this.index.evaluate(u),C=this.input.evaluate(u);if(m<0)throw new dr(`Array index out of bounds: ${m} < 0.`);if(m>=C.length)throw new dr(`Array index out of bounds: ${m} > ${C.length-1}.`);if(m!==Math.floor(m))throw new dr(`Array index must be an integer, but found ${m} instead.`);return C[m]}eachChild(u){u(this.index),u(this.input)}outputDefined(){return!1}}class Io{constructor(u,m){this.type=Ii,this.needle=u,this.haystack=m}static parse(u,m){if(u.length!==3)return m.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,Jt),P=m.parse(u[2],2,Jt);return C&&P?Ce(C.type,[Ii,Bi,Qt,Zi,Jt])?new Io(C,P):m.error(`Expected first argument to be of type boolean, string, number or null, but found ${le(C.type)} instead`):null}evaluate(u){const m=this.needle.evaluate(u),C=this.haystack.evaluate(u);if(!C)return!1;if(!be(m,["boolean","string","number","null"]))throw new dr(`Expected first argument to be of type boolean, string, number or null, but found ${le(Wi(m))} instead.`);if(!be(C,["string","array"]))throw new dr(`Expected second argument to be of type array or string, but found ${le(Wi(C))} instead.`);return C.indexOf(m)>=0}eachChild(u){u(this.needle),u(this.haystack)}outputDefined(){return!0}}class Ko{constructor(u,m,C){this.type=Qt,this.needle=u,this.haystack=m,this.fromIndex=C}static parse(u,m){if(u.length<=2||u.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,Jt),P=m.parse(u[2],2,Jt);if(!C||!P)return null;if(!Ce(C.type,[Ii,Bi,Qt,Zi,Jt]))return m.error(`Expected first argument to be of type boolean, string, number or null, but found ${le(C.type)} instead`);if(u.length===4){const Q=m.parse(u[3],3,Qt);return Q?new Ko(C,P,Q):null}return new Ko(C,P)}evaluate(u){const m=this.needle.evaluate(u),C=this.haystack.evaluate(u);if(!be(m,["boolean","string","number","null"]))throw new dr(`Expected first argument to be of type boolean, string, number or null, but found ${le(Wi(m))} instead.`);if(!be(C,["string","array"]))throw new dr(`Expected second argument to be of type array or string, but found ${le(Wi(C))} instead.`);if(this.fromIndex){const P=this.fromIndex.evaluate(u);return C.indexOf(m,P)}return C.indexOf(m)}eachChild(u){u(this.needle),u(this.haystack),this.fromIndex&&u(this.fromIndex)}outputDefined(){return!1}}class dc{constructor(u,m,C,P,Q,V){this.inputType=u,this.type=m,this.input=C,this.cases=P,this.outputs=Q,this.otherwise=V}static parse(u,m){if(u.length<5)return m.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if(u.length%2!=1)return m.error("Expected an even number of arguments.");let C,P;m.expectedType&&m.expectedType.kind!=="value"&&(P=m.expectedType);const Q={},V=[];for(let he=2;he<u.length-1;he+=2){let h=u[he];const c=u[he+1];Array.isArray(h)||(h=[h]);const f=m.concat(he);if(h.length===0)return f.error("Expected at least one branch label.");for(const E of h){if(typeof E!="number"&&typeof E!="string")return f.error("Branch labels must be numbers or strings.");if(typeof E=="number"&&Math.abs(E)>Number.MAX_SAFE_INTEGER)return f.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof E=="number"&&Math.floor(E)!==E)return f.error("Numeric branch labels must be integer values.");if(C){if(f.checkSubtype(C,Wi(E)))return null}else C=Wi(E);if(Q[String(E)]!==void 0)return f.error("Branch labels must be unique.");Q[String(E)]=V.length}const v=m.parse(c,he,P);if(!v)return null;P=P||v.type,V.push(v)}const K=m.parse(u[1],1,Jt);if(!K)return null;const re=m.parse(u[u.length-1],u.length-1,P);return re?K.type.kind!=="value"&&m.concat(1).checkSubtype(C,K.type)?null:new dc(C,P,K,Q,V,re):null}evaluate(u){const m=this.input.evaluate(u);return(Wi(m)===this.inputType&&this.outputs[this.cases[m]]||this.otherwise).evaluate(u)}eachChild(u){u(this.input),this.outputs.forEach(u),u(this.otherwise)}outputDefined(){return this.outputs.every(u=>u.outputDefined())&&this.otherwise.outputDefined()}}class Wo{constructor(u,m,C){this.type=u,this.branches=m,this.otherwise=C}static parse(u,m){if(u.length<4)return m.error(`Expected at least 3 arguments, but found only ${u.length-1}.`);if(u.length%2!=0)return m.error("Expected an odd number of arguments.");let C;m.expectedType&&m.expectedType.kind!=="value"&&(C=m.expectedType);const P=[];for(let V=1;V<u.length-1;V+=2){const K=m.parse(u[V],V,Ii);if(!K)return null;const re=m.parse(u[V+1],V+1,C);if(!re)return null;P.push([K,re]),C=C||re.type}const Q=m.parse(u[u.length-1],u.length-1,C);if(!Q)return null;if(!C)throw new Error("Can't infer output type");return new Wo(C,P,Q)}evaluate(u){for(const[m,C]of this.branches)if(m.evaluate(u))return C.evaluate(u);return this.otherwise.evaluate(u)}eachChild(u){for(const[m,C]of this.branches)u(m),u(C);u(this.otherwise)}outputDefined(){return this.branches.every(u=>{let[m,C]=u;return C.outputDefined()})&&this.otherwise.outputDefined()}}class Ao{constructor(u,m,C,P){this.type=u,this.input=m,this.beginIndex=C,this.endIndex=P}static parse(u,m){if(u.length<=2||u.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,Jt),P=m.parse(u[2],2,Qt);if(!C||!P)return null;if(!Ce(C.type,[ee(Jt),Bi,Jt]))return m.error(`Expected first argument to be of type array or string, but found ${le(C.type)} instead`);if(u.length===4){const Q=m.parse(u[3],3,Qt);return Q?new Ao(C.type,C,P,Q):null}return new Ao(C.type,C,P)}evaluate(u){const m=this.input.evaluate(u),C=this.beginIndex.evaluate(u);if(!be(m,["string","array"]))throw new dr(`Expected first argument to be of type array or string, but found ${le(Wi(m))} instead.`);if(this.endIndex){const P=this.endIndex.evaluate(u);return m.slice(C,P)}return m.slice(C)}eachChild(u){u(this.input),u(this.beginIndex),this.endIndex&&u(this.endIndex)}outputDefined(){return!1}}function fc(p,u){return p==="=="||p==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function Xo(p,u,m,C){return C.compare(u,m)===0}function zl(p,u,m){const C=p!=="=="&&p!=="!=";return class uz{constructor(Q,V,K){this.type=Ii,this.lhs=Q,this.rhs=V,this.collator=K,this.hasUntypedArgument=Q.type.kind==="value"||V.type.kind==="value"}static parse(Q,V){if(Q.length!==3&&Q.length!==4)return V.error("Expected two or three arguments.");const K=Q[0];let re=V.parse(Q[1],1,Jt);if(!re)return null;if(!fc(K,re.type))return V.concat(1).error(`"${K}" comparisons are not supported for type '${le(re.type)}'.`);let he=V.parse(Q[2],2,Jt);if(!he)return null;if(!fc(K,he.type))return V.concat(2).error(`"${K}" comparisons are not supported for type '${le(he.type)}'.`);if(re.type.kind!==he.type.kind&&re.type.kind!=="value"&&he.type.kind!=="value")return V.error(`Cannot compare types '${le(re.type)}' and '${le(he.type)}'.`);C&&(re.type.kind==="value"&&he.type.kind!=="value"?re=new Hn(he.type,[re]):re.type.kind!=="value"&&he.type.kind==="value"&&(he=new Hn(re.type,[he])));let h=null;if(Q.length===4){if(re.type.kind!=="string"&&he.type.kind!=="string"&&re.type.kind!=="value"&&he.type.kind!=="value")return V.error("Cannot use collator to compare non-string types.");if(h=V.parse(Q[3],3,mr),!h)return null}return new uz(re,he,h)}evaluate(Q){const V=this.lhs.evaluate(Q),K=this.rhs.evaluate(Q);if(C&&this.hasUntypedArgument){const re=Wi(V),he=Wi(K);if(re.kind!==he.kind||re.kind!=="string"&&re.kind!=="number")throw new dr(`Expected arguments for "${p}" to be (string, string) or (number, number), but found (${re.kind}, ${he.kind}) instead.`)}if(this.collator&&!C&&this.hasUntypedArgument){const re=Wi(V),he=Wi(K);if(re.kind!=="string"||he.kind!=="string")return u(Q,V,K)}return this.collator?m(Q,V,K,this.collator.evaluate(Q)):u(Q,V,K)}eachChild(Q){Q(this.lhs),Q(this.rhs),this.collator&&Q(this.collator)}outputDefined(){return!0}}}const Dc=zl("==",function(p,u,m){return u===m},Xo),vh=zl("!=",function(p,u,m){return u!==m},function(p,u,m,C){return!Xo(0,u,m,C)}),lu=zl("<",function(p,u,m){return u<m},function(p,u,m,C){return C.compare(u,m)<0}),cu=zl(">",function(p,u,m){return u>m},function(p,u,m,C){return C.compare(u,m)>0}),Ru=zl("<=",function(p,u,m){return u<=m},function(p,u,m,C){return C.compare(u,m)<=0}),Ql=zl(">=",function(p,u,m){return u>=m},function(p,u,m,C){return C.compare(u,m)>=0});class Ya{constructor(u,m,C,P,Q){this.type=Bi,this.number=u,this.locale=m,this.currency=C,this.minFractionDigits=P,this.maxFractionDigits=Q}static parse(u,m){if(u.length!==3)return m.error("Expected two arguments.");const C=m.parse(u[1],1,Qt);if(!C)return null;const P=u[2];if(typeof P!="object"||Array.isArray(P))return m.error("NumberFormat options argument must be an object.");let Q=null;if(P.locale&&(Q=m.parse(P.locale,1,Bi),!Q))return null;let V=null;if(P.currency&&(V=m.parse(P.currency,1,Bi),!V))return null;let K=null;if(P["min-fraction-digits"]&&(K=m.parse(P["min-fraction-digits"],1,Qt),!K))return null;let re=null;return P["max-fraction-digits"]&&(re=m.parse(P["max-fraction-digits"],1,Qt),!re)?null:new Ya(C,Q,V,K,re)}evaluate(u){return new Intl.NumberFormat(this.locale?this.locale.evaluate(u):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(u):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(u):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(u):void 0}).format(this.number.evaluate(u))}eachChild(u){u(this.number),this.locale&&u(this.locale),this.currency&&u(this.currency),this.minFractionDigits&&u(this.minFractionDigits),this.maxFractionDigits&&u(this.maxFractionDigits)}outputDefined(){return!1}}class el{constructor(u){this.type=Sr,this.sections=u}static parse(u,m){if(u.length<2)return m.error("Expected at least one argument.");const C=u[1];if(!Array.isArray(C)&&typeof C=="object")return m.error("First argument must be an image or text section.");const P=[];let Q=!1;for(let V=1;V<=u.length-1;++V){const K=u[V];if(Q&&typeof K=="object"&&!Array.isArray(K)){Q=!1;let re=null;if(K["font-scale"]&&(re=m.parse(K["font-scale"],1,Qt),!re))return null;let he=null;if(K["text-font"]&&(he=m.parse(K["text-font"],1,ee(Bi)),!he))return null;let h=null;if(K["text-color"]&&(h=m.parse(K["text-color"],1,Gt),!h))return null;const c=P[P.length-1];c.scale=re,c.font=he,c.textColor=h}else{const re=m.parse(u[V],1,Jt);if(!re)return null;const he=re.type.kind;if(he!=="string"&&he!=="value"&&he!=="null"&&he!=="resolvedImage")return m.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");Q=!0,P.push({content:re,scale:null,font:null,textColor:null})}}return new el(P)}evaluate(u){return new lr(this.sections.map(m=>{const C=m.content.evaluate(u);return Wi(C)===we?new mn("",C,null,null,null):new mn(Ys(C),null,m.scale?m.scale.evaluate(u):null,m.font?m.font.evaluate(u).join(","):null,m.textColor?m.textColor.evaluate(u):null)}))}eachChild(u){for(const m of this.sections)u(m.content),m.scale&&u(m.scale),m.font&&u(m.font),m.textColor&&u(m.textColor)}outputDefined(){return!1}}class Vl{constructor(u){this.type=we,this.input=u}static parse(u,m){if(u.length!==2)return m.error("Expected two arguments.");const C=m.parse(u[1],1,Bi);return C?new Vl(C):m.error("No image name provided.")}evaluate(u){const m=this.input.evaluate(u),C=xn.fromString(m);return C&&u.availableImages&&(C.available=u.availableImages.indexOf(m)>-1),C}eachChild(u){u(this.input)}outputDefined(){return!1}}class tl{constructor(u){this.type=Qt,this.input=u}static parse(u,m){if(u.length!==2)return m.error(`Expected 1 argument, but found ${u.length-1} instead.`);const C=m.parse(u[1],1);return C?C.type.kind!=="array"&&C.type.kind!=="string"&&C.type.kind!=="value"?m.error(`Expected argument of type string or array, but found ${le(C.type)} instead.`):new tl(C):null}evaluate(u){const m=this.input.evaluate(u);if(typeof m=="string"||Array.isArray(m))return m.length;throw new dr(`Expected value to be of type string or array, but found ${le(Wi(m))} instead.`)}eachChild(u){u(this.input)}outputDefined(){return!1}}const Aa={"==":Dc,"!=":vh,">":cu,"<":lu,">=":Ql,"<=":Ru,array:Hn,at:Nl,boolean:Hn,case:Wo,coalesce:Ja,collator:ca,format:el,image:Vl,in:Io,"index-of":Ko,interpolate:ns,"interpolate-hcl":ns,"interpolate-lab":ns,length:tl,let:cl,literal:Bs,match:dc,number:Hn,"number-format":Ya,object:Hn,slice:Ao,step:Sa,string:Hn,"to-boolean":Cn,"to-color":Cn,"to-number":Cn,"to-string":Cn,var:Ul,within:Ka};function ul(p,u){let[m,C,P,Q]=u;m=m.evaluate(p),C=C.evaluate(p),P=P.evaluate(p);const V=Q?Q.evaluate(p):1,K=So(m,C,P,V);if(K)throw new dr(K);return new ur(m/255,C/255,P/255,V,!1)}function Hl(p,u){return p in u}function eo(p,u){const m=u[p];return m===void 0?null:m}function da(p){return{type:p}}function ne(p){return{result:"success",value:p}}function Ie(p){return{result:"error",value:p}}function lt(p){return p["property-type"]==="data-driven"||p["property-type"]==="cross-faded-data-driven"}function mt(p){return!!p.expression&&p.expression.parameters.indexOf("zoom")>-1}function vt(p){return!!p.expression&&p.expression.interpolated}function Tt(p){return p instanceof Number?"number":p instanceof String?"string":p instanceof Boolean?"boolean":Array.isArray(p)?"array":p===null?"null":typeof p}function pi(p){return typeof p=="object"&&p!==null&&!Array.isArray(p)}function ri(p){return p}function rr(p,u){const m=u.type==="color",C=p.stops&&typeof p.stops[0][0]=="object",P=C||!(C||p.property!==void 0),Q=p.type||(vt(u)?"exponential":"interval");if(m||u.type==="padding"){const h=m?ur.parse:kn.parse;(p=Ji({},p)).stops&&(p.stops=p.stops.map(c=>[c[0],h(c[1])])),p.default=h(p.default?p.default:u.default)}if(p.colorSpace&&(V=p.colorSpace)!=="rgb"&&V!=="hcl"&&V!=="lab")throw new Error(`Unknown color space: "${p.colorSpace}"`);var V;let K,re,he;if(Q==="exponential")K=nr;else if(Q==="interval")K=jr;else if(Q==="categorical"){K=ki,re=Object.create(null);for(const h of p.stops)re[h[0]]=h[1];he=typeof p.stops[0][0]}else{if(Q!=="identity")throw new Error(`Unknown function type "${Q}"`);K=Gn}if(C){const h={},c=[];for(let E=0;E<p.stops.length;E++){const M=p.stops[E],D=M[0].zoom;h[D]===void 0&&(h[D]={zoom:D,type:p.type,property:p.property,default:p.default,stops:[]},c.push(D)),h[D].stops.push([M[0].value,M[1]])}const f=[];for(const E of c)f.push([h[E].zoom,rr(h[E],u)]);const v={name:"linear"};return{kind:"composite",interpolationType:v,interpolationFactor:ns.interpolationFactor.bind(void 0,v),zoomStops:f.map(E=>E[0]),evaluate:(E,M)=>{let{zoom:D}=E;return nr({stops:f,base:p.base},u,D).evaluate(D,M)}}}if(P){const h=Q==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:h,interpolationFactor:ns.interpolationFactor.bind(void 0,h),zoomStops:p.stops.map(c=>c[0]),evaluate:c=>{let{zoom:f}=c;return K(p,u,f,re,he)}}}return{kind:"source",evaluate(h,c){const f=c&&c.properties?c.properties[p.property]:void 0;return f===void 0?qi(p.default,u.default):K(p,u,f,re,he)}}}function qi(p,u,m){return p!==void 0?p:u!==void 0?u:m!==void 0?m:void 0}function ki(p,u,m,C,P){return qi(typeof m===P?C[m]:void 0,p.default,u.default)}function jr(p,u,m){if(Tt(m)!=="number")return qi(p.default,u.default);const C=p.stops.length;if(C===1||m<=p.stops[0][0])return p.stops[0][1];if(m>=p.stops[C-1][0])return p.stops[C-1][1];const P=Xa(p.stops.map(Q=>Q[0]),m);return p.stops[P][1]}function nr(p,u,m){const C=p.base!==void 0?p.base:1;if(Tt(m)!=="number")return qi(p.default,u.default);const P=p.stops.length;if(P===1||m<=p.stops[0][0])return p.stops[0][1];if(m>=p.stops[P-1][0])return p.stops[P-1][1];const Q=Xa(p.stops.map(h=>h[0]),m),V=function(h,c,f,v){const E=v-f,M=h-f;return E===0?0:c===1?M/E:(Math.pow(c,M)-1)/(Math.pow(c,E)-1)}(m,C,p.stops[Q][0],p.stops[Q+1][0]),K=p.stops[Q][1],re=p.stops[Q+1][1],he=dn[u.type]||ri;return typeof K.evaluate=="function"?{evaluate(){for(var h=arguments.length,c=new Array(h),f=0;f<h;f++)c[f]=arguments[f];const v=K.evaluate.apply(void 0,c),E=re.evaluate.apply(void 0,c);if(v!==void 0&&E!==void 0)return he(v,E,V,p.colorSpace)}}:he(K,re,V,p.colorSpace)}function Gn(p,u,m){switch(u.type){case"color":m=ur.parse(m);break;case"formatted":m=lr.fromString(m.toString());break;case"resolvedImage":m=xn.fromString(m.toString());break;case"padding":m=kn.parse(m);break;default:Tt(m)===u.type||u.type==="enum"&&u.values[m]||(m=void 0)}return qi(m,p.default,u.default)}Yn.register(Aa,{error:[{kind:"error"},[Bi],(p,u)=>{let[m]=u;throw new dr(m.evaluate(p))}],typeof:[Bi,[Jt],(p,u)=>{let[m]=u;return le(Wi(m.evaluate(p)))}],"to-rgba":[ee(Qt,4),[Gt],(p,u)=>{let[m]=u;const[C,P,Q,V]=m.evaluate(p).rgb;return[255*C,255*P,255*Q,V]}],rgb:[Gt,[Qt,Qt,Qt],ul],rgba:[Gt,[Qt,Qt,Qt,Qt],ul],has:{type:Ii,overloads:[[[Bi],(p,u)=>{let[m]=u;return Hl(m.evaluate(p),p.properties())}],[[Bi,vi],(p,u)=>{let[m,C]=u;return Hl(m.evaluate(p),C.evaluate(p))}]]},get:{type:Jt,overloads:[[[Bi],(p,u)=>{let[m]=u;return eo(m.evaluate(p),p.properties())}],[[Bi,vi],(p,u)=>{let[m,C]=u;return eo(m.evaluate(p),C.evaluate(p))}]]},"feature-state":[Jt,[Bi],(p,u)=>{let[m]=u;return eo(m.evaluate(p),p.featureState||{})}],properties:[vi,[],p=>p.properties()],"geometry-type":[Bi,[],p=>p.geometryType()],id:[Jt,[],p=>p.id()],zoom:[Qt,[],p=>p.globals.zoom],"heatmap-density":[Qt,[],p=>p.globals.heatmapDensity||0],"line-progress":[Qt,[],p=>p.globals.lineProgress||0],accumulated:[Jt,[],p=>p.globals.accumulated===void 0?null:p.globals.accumulated],"+":[Qt,da(Qt),(p,u)=>{let m=0;for(const C of u)m+=C.evaluate(p);return m}],"*":[Qt,da(Qt),(p,u)=>{let m=1;for(const C of u)m*=C.evaluate(p);return m}],"-":{type:Qt,overloads:[[[Qt,Qt],(p,u)=>{let[m,C]=u;return m.evaluate(p)-C.evaluate(p)}],[[Qt],(p,u)=>{let[m]=u;return-m.evaluate(p)}]]},"/":[Qt,[Qt,Qt],(p,u)=>{let[m,C]=u;return m.evaluate(p)/C.evaluate(p)}],"%":[Qt,[Qt,Qt],(p,u)=>{let[m,C]=u;return m.evaluate(p)%C.evaluate(p)}],ln2:[Qt,[],()=>Math.LN2],pi:[Qt,[],()=>Math.PI],e:[Qt,[],()=>Math.E],"^":[Qt,[Qt,Qt],(p,u)=>{let[m,C]=u;return Math.pow(m.evaluate(p),C.evaluate(p))}],sqrt:[Qt,[Qt],(p,u)=>{let[m]=u;return Math.sqrt(m.evaluate(p))}],log10:[Qt,[Qt],(p,u)=>{let[m]=u;return Math.log(m.evaluate(p))/Math.LN10}],ln:[Qt,[Qt],(p,u)=>{let[m]=u;return Math.log(m.evaluate(p))}],log2:[Qt,[Qt],(p,u)=>{let[m]=u;return Math.log(m.evaluate(p))/Math.LN2}],sin:[Qt,[Qt],(p,u)=>{let[m]=u;return Math.sin(m.evaluate(p))}],cos:[Qt,[Qt],(p,u)=>{let[m]=u;return Math.cos(m.evaluate(p))}],tan:[Qt,[Qt],(p,u)=>{let[m]=u;return Math.tan(m.evaluate(p))}],asin:[Qt,[Qt],(p,u)=>{let[m]=u;return Math.asin(m.evaluate(p))}],acos:[Qt,[Qt],(p,u)=>{let[m]=u;return Math.acos(m.evaluate(p))}],atan:[Qt,[Qt],(p,u)=>{let[m]=u;return Math.atan(m.evaluate(p))}],min:[Qt,da(Qt),(p,u)=>Math.min(...u.map(m=>m.evaluate(p)))],max:[Qt,da(Qt),(p,u)=>Math.max(...u.map(m=>m.evaluate(p)))],abs:[Qt,[Qt],(p,u)=>{let[m]=u;return Math.abs(m.evaluate(p))}],round:[Qt,[Qt],(p,u)=>{let[m]=u;const C=m.evaluate(p);return C<0?-Math.round(-C):Math.round(C)}],floor:[Qt,[Qt],(p,u)=>{let[m]=u;return Math.floor(m.evaluate(p))}],ceil:[Qt,[Qt],(p,u)=>{let[m]=u;return Math.ceil(m.evaluate(p))}],"filter-==":[Ii,[Bi,Jt],(p,u)=>{let[m,C]=u;return p.properties()[m.value]===C.value}],"filter-id-==":[Ii,[Jt],(p,u)=>{let[m]=u;return p.id()===m.value}],"filter-type-==":[Ii,[Bi],(p,u)=>{let[m]=u;return p.geometryType()===m.value}],"filter-<":[Ii,[Bi,Jt],(p,u)=>{let[m,C]=u;const P=p.properties()[m.value],Q=C.value;return typeof P==typeof Q&&P<Q}],"filter-id-<":[Ii,[Jt],(p,u)=>{let[m]=u;const C=p.id(),P=m.value;return typeof C==typeof P&&C<P}],"filter->":[Ii,[Bi,Jt],(p,u)=>{let[m,C]=u;const P=p.properties()[m.value],Q=C.value;return typeof P==typeof Q&&P>Q}],"filter-id->":[Ii,[Jt],(p,u)=>{let[m]=u;const C=p.id(),P=m.value;return typeof C==typeof P&&C>P}],"filter-<=":[Ii,[Bi,Jt],(p,u)=>{let[m,C]=u;const P=p.properties()[m.value],Q=C.value;return typeof P==typeof Q&&P<=Q}],"filter-id-<=":[Ii,[Jt],(p,u)=>{let[m]=u;const C=p.id(),P=m.value;return typeof C==typeof P&&C<=P}],"filter->=":[Ii,[Bi,Jt],(p,u)=>{let[m,C]=u;const P=p.properties()[m.value],Q=C.value;return typeof P==typeof Q&&P>=Q}],"filter-id->=":[Ii,[Jt],(p,u)=>{let[m]=u;const C=p.id(),P=m.value;return typeof C==typeof P&&C>=P}],"filter-has":[Ii,[Jt],(p,u)=>{let[m]=u;return m.value in p.properties()}],"filter-has-id":[Ii,[],p=>p.id()!==null&&p.id()!==void 0],"filter-type-in":[Ii,[ee(Bi)],(p,u)=>{let[m]=u;return m.value.indexOf(p.geometryType())>=0}],"filter-id-in":[Ii,[ee(Jt)],(p,u)=>{let[m]=u;return m.value.indexOf(p.id())>=0}],"filter-in-small":[Ii,[Bi,ee(Jt)],(p,u)=>{let[m,C]=u;return C.value.indexOf(p.properties()[m.value])>=0}],"filter-in-large":[Ii,[Bi,ee(Jt)],(p,u)=>{let[m,C]=u;return function(P,Q,V,K){for(;V<=K;){const re=V+K>>1;if(Q[re]===P)return!0;Q[re]>P?K=re-1:V=re+1}return!1}(p.properties()[m.value],C.value,0,C.value.length-1)}],all:{type:Ii,overloads:[[[Ii,Ii],(p,u)=>{let[m,C]=u;return m.evaluate(p)&&C.evaluate(p)}],[da(Ii),(p,u)=>{for(const m of u)if(!m.evaluate(p))return!1;return!0}]]},any:{type:Ii,overloads:[[[Ii,Ii],(p,u)=>{let[m,C]=u;return m.evaluate(p)||C.evaluate(p)}],[da(Ii),(p,u)=>{for(const m of u)if(m.evaluate(p))return!0;return!1}]]},"!":[Ii,[Ii],(p,u)=>{let[m]=u;return!m.evaluate(p)}],"is-supported-script":[Ii,[Bi],(p,u)=>{let[m]=u;const C=p.globals&&p.globals.isSupportedScript;return!C||C(m.evaluate(p))}],upcase:[Bi,[Bi],(p,u)=>{let[m]=u;return m.evaluate(p).toUpperCase()}],downcase:[Bi,[Bi],(p,u)=>{let[m]=u;return m.evaluate(p).toLowerCase()}],concat:[Bi,da(Jt),(p,u)=>u.map(m=>Ys(m.evaluate(p))).join("")],"resolved-locale":[Bi,[mr],(p,u)=>{let[m]=u;return m.evaluate(p).resolvedLocale()}]});class Br{constructor(u,m){var C;this.expression=u,this._warningHistory={},this._evaluator=new Hr,this._defaultValue=m?(C=m).type==="color"&&pi(C.default)?new ur(0,0,0,0):C.type==="color"?ur.parse(C.default)||null:C.type==="padding"?kn.parse(C.default)||null:C.type==="variableAnchorOffsetCollection"?Qr.parse(C.default)||null:C.default===void 0?null:C.default:null,this._enumValues=m&&m.type==="enum"?m.values:null}evaluateWithoutErrorHandling(u,m,C,P,Q,V){return this._evaluator.globals=u,this._evaluator.feature=m,this._evaluator.featureState=C,this._evaluator.canonical=P,this._evaluator.availableImages=Q||null,this._evaluator.formattedSection=V,this.expression.evaluate(this._evaluator)}evaluate(u,m,C,P,Q,V){this._evaluator.globals=u,this._evaluator.feature=m||null,this._evaluator.featureState=C||null,this._evaluator.canonical=P,this._evaluator.availableImages=Q||null,this._evaluator.formattedSection=V||null;try{const K=this.expression.evaluate(this._evaluator);if(K==null||typeof K=="number"&&K!=K)return this._defaultValue;if(this._enumValues&&!(K in this._enumValues))throw new dr(`Expected value to be one of ${Object.keys(this._enumValues).map(re=>JSON.stringify(re)).join(", ")}, but found ${JSON.stringify(K)} instead.`);return K}catch(K){return this._warningHistory[K.message]||(this._warningHistory[K.message]=!0,typeof console<"u"&&console.warn(K.message)),this._defaultValue}}}function Lr(p){return Array.isArray(p)&&p.length>0&&typeof p[0]=="string"&&p[0]in Aa}function Un(p,u){const m=new Gs(Aa,To,[],u?function(P){const Q={color:Gt,string:Bi,number:Qt,enum:Bi,boolean:Ii,formatted:Sr,padding:ze,resolvedImage:we,variableAnchorOffsetCollection:oe};return P.type==="array"?ee(Q[P.value]||Jt,P.length):Q[P.type]}(u):void 0),C=m.parse(p,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return C?ne(new Br(C,u)):Ie(m.errors)}class $s{constructor(u,m){this.kind=u,this._styleExpression=m,this.isStateDependent=u!=="constant"&&!ms(m.expression)}evaluateWithoutErrorHandling(u,m,C,P,Q,V){return this._styleExpression.evaluateWithoutErrorHandling(u,m,C,P,Q,V)}evaluate(u,m,C,P,Q,V){return this._styleExpression.evaluate(u,m,C,P,Q,V)}}class to{constructor(u,m,C,P){this.kind=u,this.zoomStops=C,this._styleExpression=m,this.isStateDependent=u!=="camera"&&!ms(m.expression),this.interpolationType=P}evaluateWithoutErrorHandling(u,m,C,P,Q,V){return this._styleExpression.evaluateWithoutErrorHandling(u,m,C,P,Q,V)}evaluate(u,m,C,P,Q,V){return this._styleExpression.evaluate(u,m,C,P,Q,V)}interpolationFactor(u,m,C){return this.interpolationType?ns.interpolationFactor(this.interpolationType,u,m,C):0}}function Lo(p,u){const m=Un(p,u);if(m.result==="error")return m;const C=m.value.expression,P=Wa(C);if(!P&&!lt(u))return Ie([new ci("","data expressions not supported")]);const Q=ua(C,["zoom"]);if(!Q&&!mt(u))return Ie([new ci("","zoom expressions not supported")]);const V=fa(C);return V||Q?V instanceof ci?Ie([V]):V instanceof ns&&!vt(u)?Ie([new ci("",'"interpolate" expressions cannot be used with this property')]):ne(V?new to(P?"camera":"composite",m.value,V.labels,V instanceof ns?V.interpolation:void 0):new $s(P?"constant":"source",m.value)):Ie([new ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ta{constructor(u,m){this._parameters=u,this._specification=m,Ji(this,rr(this._parameters,this._specification))}static deserialize(u){return new Ta(u._parameters,u._specification)}static serialize(u){return{_parameters:u._parameters,_specification:u._specification}}}function fa(p){let u=null;if(p instanceof cl)u=fa(p.result);else if(p instanceof Ja){for(const m of p.args)if(u=fa(m),u)break}else(p instanceof Sa||p instanceof ns)&&p.input instanceof Yn&&p.input.name==="zoom"&&(u=p);return u instanceof ci||p.eachChild(m=>{const C=fa(m);C instanceof ci?u=C:!u&&C?u=new ci("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):u&&C&&u!==C&&(u=new ci("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),u}function Gl(p){if(p===!0||p===!1)return!0;if(!Array.isArray(p)||p.length===0)return!1;switch(p[0]){case"has":return p.length>=2&&p[1]!=="$id"&&p[1]!=="$type";case"in":return p.length>=3&&(typeof p[1]!="string"||Array.isArray(p[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return p.length!==3||Array.isArray(p[1])||Array.isArray(p[2]);case"any":case"all":for(const u of p.slice(1))if(!Gl(u)&&typeof u!="boolean")return!1;return!0;default:return!0}}const hl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function jl(p){if(p==null)return{filter:()=>!0,needGeometry:!1};Gl(p)||(p=Fs(p));const u=Un(p,hl);if(u.result==="error")throw new Error(u.value.map(m=>`${m.key}: ${m.message}`).join(", "));return{filter:(m,C,P)=>u.value.evaluate(m,C,{},P),needGeometry:pa(p)}}function pc(p,u){return p<u?-1:p>u?1:0}function pa(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(let u=1;u<p.length;u++)if(pa(p[u]))return!0;return!1}function Fs(p){if(!p)return!0;const u=p[0];return p.length<=1?u!=="any":u==="=="?Al(p[1],p[2],"=="):u==="!="?La(Al(p[1],p[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Al(p[1],p[2],u):u==="any"?(m=p.slice(1),["any"].concat(m.map(Fs))):u==="all"?["all"].concat(p.slice(1).map(Fs)):u==="none"?["all"].concat(p.slice(1).map(Fs).map(La)):u==="in"?ql(p[1],p.slice(2)):u==="!in"?La(ql(p[1],p.slice(2))):u==="has"?Ia(p[1]):u==="!has"?La(Ia(p[1])):u!=="within"||p;var m}function Al(p,u,m){switch(p){case"$type":return[`filter-type-${m}`,u];case"$id":return[`filter-id-${m}`,u];default:return[`filter-${m}`,p,u]}}function ql(p,u){if(u.length===0)return!1;switch(p){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(m=>typeof m!=typeof u[0])?["filter-in-large",p,["literal",u.sort(pc)]]:["filter-in-small",p,["literal",u]]}}function Ia(p){switch(p){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",p]}}function La(p){return["!",p]}function Ds(p){const u=typeof p;if(u==="number"||u==="boolean"||u==="string"||p==null)return JSON.stringify(p);if(Array.isArray(p)){let P="[";for(const Q of p)P+=`${Ds(Q)},`;return`${P}]`}const m=Object.keys(p).sort();let C="{";for(let P=0;P<m.length;P++)C+=`${JSON.stringify(m[P])}:${Ds(p[m[P]])},`;return`${C}}`}function ku(p){let u="";for(const m of Ri)u+=`/${Ds(p[m])}`;return u}function Sn(p){const u=p.value;return u?[new Nt(p.key,u,"constants have been deprecated as of v8")]:[]}function on(p){return p instanceof Number||p instanceof String||p instanceof Boolean?p.valueOf():p}function fn(p){if(Array.isArray(p))return p.map(fn);if(p instanceof Object&&!(p instanceof Number||p instanceof String||p instanceof Boolean)){const u={};for(const m in p)u[m]=fn(p[m]);return u}return on(p)}function es(p){const u=p.key,m=p.value,C=p.valueSpec||{},P=p.objectElementValidators||{},Q=p.style,V=p.styleSpec,K=p.validateSpec;let re=[];const he=Tt(m);if(he!=="object")return[new Nt(u,m,`object expected, ${he} found`)];for(const h in m){const c=h.split(".")[0],f=C[c]||C["*"];let v;if(P[c])v=P[c];else if(C[c])v=K;else if(P["*"])v=P["*"];else{if(!C["*"]){re.push(new Nt(u,m[h],`unknown property "${h}"`));continue}v=K}re=re.concat(v({key:(u&&`${u}.`)+h,value:m[h],valueSpec:f,style:Q,styleSpec:V,object:m,objectKey:h,validateSpec:K},m))}for(const h in C)P[h]||C[h].required&&C[h].default===void 0&&m[h]===void 0&&re.push(new Nt(u,m,`missing required property "${h}"`));return re}function dl(p){const u=p.value,m=p.valueSpec,C=p.style,P=p.styleSpec,Q=p.key,V=p.arrayElementValidator||p.validateSpec;if(Tt(u)!=="array")return[new Nt(Q,u,`array expected, ${Tt(u)} found`)];if(m.length&&u.length!==m.length)return[new Nt(Q,u,`array length ${m.length} expected, length ${u.length} found`)];if(m["min-length"]&&u.length<m["min-length"])return[new Nt(Q,u,`array length at least ${m["min-length"]} expected, length ${u.length} found`)];let K={type:m.value,values:m.values};P.$version<7&&(K.function=m.function),Tt(m.value)==="object"&&(K=m.value);let re=[];for(let he=0;he<u.length;he++)re=re.concat(V({array:u,arrayIndex:he,value:u[he],valueSpec:K,validateSpec:p.validateSpec,style:C,styleSpec:P,key:`${Q}[${he}]`}));return re}function fl(p){const u=p.key,m=p.value,C=p.valueSpec;let P=Tt(m);return P==="number"&&m!=m&&(P="NaN"),P!=="number"?[new Nt(u,m,`number expected, ${P} found`)]:"minimum"in C&&m<C.minimum?[new Nt(u,m,`${m} is less than the minimum value ${C.minimum}`)]:"maximum"in C&&m>C.maximum?[new Nt(u,m,`${m} is greater than the maximum value ${C.maximum}`)]:[]}function fo(p){const u=p.valueSpec,m=on(p.value.type);let C,P,Q,V={};const K=m!=="categorical"&&p.value.property===void 0,re=!K,he=Tt(p.value.stops)==="array"&&Tt(p.value.stops[0])==="array"&&Tt(p.value.stops[0][0])==="object",h=es({key:p.key,value:p.value,valueSpec:p.styleSpec.function,validateSpec:p.validateSpec,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(v){if(m==="identity")return[new Nt(v.key,v.value,'identity function may not have a "stops" property')];let E=[];const M=v.value;return E=E.concat(dl({key:v.key,value:M,valueSpec:v.valueSpec,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec,arrayElementValidator:c})),Tt(M)==="array"&&M.length===0&&E.push(new Nt(v.key,M,"array must have at least one stop")),E},default:function(v){return v.validateSpec({key:v.key,value:v.value,valueSpec:u,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec})}}});return m==="identity"&&K&&h.push(new Nt(p.key,p.value,'missing required property "property"')),m==="identity"||p.value.stops||h.push(new Nt(p.key,p.value,'missing required property "stops"')),m==="exponential"&&p.valueSpec.expression&&!vt(p.valueSpec)&&h.push(new Nt(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(re&&!lt(p.valueSpec)?h.push(new Nt(p.key,p.value,"property functions not supported")):K&&!mt(p.valueSpec)&&h.push(new Nt(p.key,p.value,"zoom functions not supported"))),m!=="categorical"&&!he||p.value.property!==void 0||h.push(new Nt(p.key,p.value,'"property" property is required')),h;function c(v){let E=[];const M=v.value,D=v.key;if(Tt(M)!=="array")return[new Nt(D,M,`array expected, ${Tt(M)} found`)];if(M.length!==2)return[new Nt(D,M,`array length 2 expected, length ${M.length} found`)];if(he){if(Tt(M[0])!=="object")return[new Nt(D,M,`object expected, ${Tt(M[0])} found`)];if(M[0].zoom===void 0)return[new Nt(D,M,"object stop key must have zoom")];if(M[0].value===void 0)return[new Nt(D,M,"object stop key must have value")];if(Q&&Q>on(M[0].zoom))return[new Nt(D,M[0].zoom,"stop zoom values must appear in ascending order")];on(M[0].zoom)!==Q&&(Q=on(M[0].zoom),P=void 0,V={}),E=E.concat(es({key:`${D}[0]`,value:M[0],valueSpec:{zoom:{}},validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{zoom:fl,value:f}}))}else E=E.concat(f({key:`${D}[0]`,value:M[0],valueSpec:{},validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec},M));return Lr(fn(M[1]))?E.concat([new Nt(`${D}[1]`,M[1],"expressions are not allowed in function stops.")]):E.concat(v.validateSpec({key:`${D}[1]`,value:M[1],valueSpec:u,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec}))}function f(v,E){const M=Tt(v.value),D=on(v.value),G=v.value!==null?v.value:E;if(C){if(M!==C)return[new Nt(v.key,G,`${M} stop domain type must match previous stop domain type ${C}`)]}else C=M;if(M!=="number"&&M!=="string"&&M!=="boolean")return[new Nt(v.key,G,"stop domain value must be a number, string, or boolean")];if(M!=="number"&&m!=="categorical"){let $=`number expected, ${M} found`;return lt(u)&&m===void 0&&($+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Nt(v.key,G,$)]}return m!=="categorical"||M!=="number"||isFinite(D)&&Math.floor(D)===D?m!=="categorical"&&M==="number"&&P!==void 0&&D<P?[new Nt(v.key,G,"stop domain values must appear in ascending order")]:(P=D,m==="categorical"&&D in V?[new Nt(v.key,G,"stop domain values must be unique")]:(V[D]=!0,[])):[new Nt(v.key,G,`integer expected, found ${D}`)]}}function ss(p){const u=(p.expressionContext==="property"?Lo:Un)(fn(p.value),p.valueSpec);if(u.result==="error")return u.value.map(C=>new Nt(`${p.key}${C.key}`,p.value,C.message));const m=u.value.expression||u.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!m.outputDefined())return[new Nt(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!ms(m))return[new Nt(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter"&&!ms(m))return[new Nt(p.key,p.value,'"feature-state" data expressions are not supported with filters.')];if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!ua(m,["zoom","feature-state"]))return[new Nt(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!Wa(m))return[new Nt(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function os(p){const u=p.key,m=p.value,C=p.valueSpec,P=[];return Array.isArray(C.values)?C.values.indexOf(on(m))===-1&&P.push(new Nt(u,m,`expected one of [${C.values.join(", ")}], ${JSON.stringify(m)} found`)):Object.keys(C.values).indexOf(on(m))===-1&&P.push(new Nt(u,m,`expected one of [${Object.keys(C.values).join(", ")}], ${JSON.stringify(m)} found`)),P}function Mo(p){return Gl(fn(p.value))?ss(Ji({},p,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Po(p)}function Po(p){const u=p.value,m=p.key;if(Tt(u)!=="array")return[new Nt(m,u,`array expected, ${Tt(u)} found`)];const C=p.styleSpec;let P,Q=[];if(u.length<1)return[new Nt(m,u,"filter array must have at least 1 element")];switch(Q=Q.concat(os({key:`${m}[0]`,value:u[0],valueSpec:C.filter_operator,style:p.style,styleSpec:p.styleSpec})),on(u[0])){case"<":case"<=":case">":case">=":u.length>=2&&on(u[1])==="$type"&&Q.push(new Nt(m,u,`"$type" cannot be use with operator "${u[0]}"`));case"==":case"!=":u.length!==3&&Q.push(new Nt(m,u,`filter array for operator "${u[0]}" must have 3 elements`));case"in":case"!in":u.length>=2&&(P=Tt(u[1]),P!=="string"&&Q.push(new Nt(`${m}[1]`,u[1],`string expected, ${P} found`)));for(let V=2;V<u.length;V++)P=Tt(u[V]),on(u[1])==="$type"?Q=Q.concat(os({key:`${m}[${V}]`,value:u[V],valueSpec:C.geometry_type,style:p.style,styleSpec:p.styleSpec})):P!=="string"&&P!=="number"&&P!=="boolean"&&Q.push(new Nt(`${m}[${V}]`,u[V],`string, number, or boolean expected, ${P} found`));break;case"any":case"all":case"none":for(let V=1;V<u.length;V++)Q=Q.concat(Po({key:`${m}[${V}]`,value:u[V],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":P=Tt(u[1]),u.length!==2?Q.push(new Nt(m,u,`filter array for "${u[0]}" operator must have 2 elements`)):P!=="string"&&Q.push(new Nt(`${m}[1]`,u[1],`string expected, ${P} found`));break;case"within":P=Tt(u[1]),u.length!==2?Q.push(new Nt(m,u,`filter array for "${u[0]}" operator must have 2 elements`)):P!=="object"&&Q.push(new Nt(`${m}[1]`,u[1],`object expected, ${P} found`))}return Q}function ga(p,u){const m=p.key,C=p.validateSpec,P=p.style,Q=p.styleSpec,V=p.value,K=p.objectKey,re=Q[`${u}_${p.layerType}`];if(!re)return[];const he=K.match(/^(.*)-transition$/);if(u==="paint"&&he&&re[he[1]]&&re[he[1]].transition)return C({key:m,value:V,valueSpec:Q.transition,style:P,styleSpec:Q});const h=p.valueSpec||re[K];if(!h)return[new Nt(m,V,`unknown property "${K}"`)];let c;if(Tt(V)==="string"&&lt(h)&&!h.tokens&&(c=/^{([^}]+)}$/.exec(V)))return[new Nt(m,V,`"${K}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(c[1])} }\`.`)];const f=[];return p.layerType==="symbol"&&(K==="text-field"&&P&&!P.glyphs&&f.push(new Nt(m,V,'use of "text-field" requires a style "glyphs" property')),K==="text-font"&&pi(fn(V))&&on(V.type)==="identity"&&f.push(new Nt(m,V,'"text-font" does not support identity functions'))),f.concat(C({key:p.key,value:V,valueSpec:h,style:P,styleSpec:Q,expressionContext:"property",propertyType:u,propertyKey:K}))}function pl(p){return ga(p,"paint")}function io(p){return ga(p,"layout")}function ro(p){let u=[];const m=p.value,C=p.key,P=p.style,Q=p.styleSpec;m.type||m.ref||u.push(new Nt(C,m,'either "type" or "ref" is required'));let V=on(m.type);const K=on(m.ref);if(m.id){const re=on(m.id);for(let he=0;he<p.arrayIndex;he++){const h=P.layers[he];on(h.id)===re&&u.push(new Nt(C,m.id,`duplicate layer id "${m.id}", previously used at line ${h.id.__line__}`))}}if("ref"in m){let re;["type","source","source-layer","filter","layout"].forEach(he=>{he in m&&u.push(new Nt(C,m[he],`"${he}" is prohibited for ref layers`))}),P.layers.forEach(he=>{on(he.id)===K&&(re=he)}),re?re.ref?u.push(new Nt(C,m.ref,"ref cannot reference another ref layer")):V=on(re.type):u.push(new Nt(C,m.ref,`ref layer "${K}" not found`))}else if(V!=="background")if(m.source){const re=P.sources&&P.sources[m.source],he=re&&on(re.type);re?he==="vector"&&V==="raster"?u.push(new Nt(C,m.source,`layer "${m.id}" requires a raster source`)):he!=="raster-dem"&&V==="hillshade"?u.push(new Nt(C,m.source,`layer "${m.id}" requires a raster-dem source`)):he==="raster"&&V!=="raster"?u.push(new Nt(C,m.source,`layer "${m.id}" requires a vector source`)):he!=="vector"||m["source-layer"]?he==="raster-dem"&&V!=="hillshade"?u.push(new Nt(C,m.source,"raster-dem source can only be used with layer type 'hillshade'.")):V!=="line"||!m.paint||!m.paint["line-gradient"]||he==="geojson"&&re.lineMetrics||u.push(new Nt(C,m,`layer "${m.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):u.push(new Nt(C,m,`layer "${m.id}" must specify a "source-layer"`)):u.push(new Nt(C,m.source,`source "${m.source}" not found`))}else u.push(new Nt(C,m,'missing required property "source"'));return u=u.concat(es({key:C,value:m,valueSpec:Q.layer,style:p.style,styleSpec:p.styleSpec,validateSpec:p.validateSpec,objectElementValidators:{"*":()=>[],type:()=>p.validateSpec({key:`${C}.type`,value:m.type,valueSpec:Q.layer.type,style:p.style,styleSpec:p.styleSpec,validateSpec:p.validateSpec,object:m,objectKey:"type"}),filter:Mo,layout:re=>es({layer:m,key:re.key,value:re.value,style:re.style,styleSpec:re.styleSpec,validateSpec:re.validateSpec,objectElementValidators:{"*":he=>io(Ji({layerType:V},he))}}),paint:re=>es({layer:m,key:re.key,value:re.value,style:re.style,styleSpec:re.styleSpec,validateSpec:re.validateSpec,objectElementValidators:{"*":he=>pl(Ji({layerType:V},he))}})}})),u}function po(p){const u=p.value,m=p.key,C=Tt(u);return C!=="string"?[new Nt(m,u,`string expected, ${C} found`)]:[]}const ys={promoteId:function(p){let{key:u,value:m}=p;if(Tt(m)==="string")return po({key:u,value:m});{const C=[];for(const P in m)C.push(...po({key:`${u}.${P}`,value:m[P]}));return C}}};function no(p){const u=p.value,m=p.key,C=p.styleSpec,P=p.style,Q=p.validateSpec;if(!u.type)return[new Nt(m,u,'"type" is required')];const V=on(u.type);let K;switch(V){case"vector":case"raster":return K=es({key:m,value:u,valueSpec:C[`source_${V.replace("-","_")}`],style:p.style,styleSpec:C,objectElementValidators:ys,validateSpec:Q}),K;case"raster-dem":return K=function(re){var he;const h=(he=re.sourceName)!==null&&he!==void 0?he:"",c=re.value,f=re.styleSpec,v=f.source_raster_dem,E=re.style;let M=[];const D=Tt(c);if(c===void 0)return M;if(D!=="object")return M.push(new Nt("source_raster_dem",c,`object expected, ${D} found`)),M;const G=on(c.encoding)==="custom",$=["redFactor","greenFactor","blueFactor","baseShift"],X=re.value.encoding?`"${re.value.encoding}"`:"Default";for(const se in c)!G&&$.includes(se)?M.push(new Nt(se,c[se],`In "${h}": "${se}" is only valid when "encoding" is set to "custom". ${X} encoding found`)):v[se]?M=M.concat(re.validateSpec({key:se,value:c[se],valueSpec:v[se],validateSpec:re.validateSpec,style:E,styleSpec:f})):M.push(new Nt(se,c[se],`unknown property "${se}"`));return M}({sourceName:m,value:u,style:p.style,styleSpec:C,validateSpec:Q}),K;case"geojson":if(K=es({key:m,value:u,valueSpec:C.source_geojson,style:P,styleSpec:C,validateSpec:Q,objectElementValidators:ys}),u.cluster)for(const re in u.clusterProperties){const[he,h]=u.clusterProperties[re],c=typeof he=="string"?[he,["accumulated"],["get",re]]:he;K.push(...ss({key:`${m}.${re}.map`,value:h,validateSpec:Q,expressionContext:"cluster-map"})),K.push(...ss({key:`${m}.${re}.reduce`,value:c,validateSpec:Q,expressionContext:"cluster-reduce"}))}return K;case"video":return es({key:m,value:u,valueSpec:C.source_video,style:P,validateSpec:Q,styleSpec:C});case"image":return es({key:m,value:u,valueSpec:C.source_image,style:P,validateSpec:Q,styleSpec:C});case"canvas":return[new Nt(m,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return os({key:`${m}.type`,value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:P,validateSpec:Q,styleSpec:C})}}function Ma(p){const u=p.value,m=p.styleSpec,C=m.light,P=p.style;let Q=[];const V=Tt(u);if(u===void 0)return Q;if(V!=="object")return Q=Q.concat([new Nt("light",u,`object expected, ${V} found`)]),Q;for(const K in u){const re=K.match(/^(.*)-transition$/);Q=Q.concat(re&&C[re[1]]&&C[re[1]].transition?p.validateSpec({key:K,value:u[K],valueSpec:m.transition,validateSpec:p.validateSpec,style:P,styleSpec:m}):C[K]?p.validateSpec({key:K,value:u[K],valueSpec:C[K],validateSpec:p.validateSpec,style:P,styleSpec:m}):[new Nt(K,u[K],`unknown property "${K}"`)])}return Q}function ma(p){const u=p.value,m=p.styleSpec,C=m.sky,P=p.style,Q=Tt(u);if(u===void 0)return[];if(Q!=="object")return[new Nt("sky",u,`object expected, ${Q} found`)];let V=[];for(const K in u)V=V.concat(C[K]?As({key:K,value:u[K],valueSpec:C[K],style:P,styleSpec:m}):[new Nt(K,u[K],`unknown property "${K}"`)]);return V}function Pa(p){const u=p.value,m=p.styleSpec,C=m.terrain,P=p.style;let Q=[];const V=Tt(u);if(u===void 0)return Q;if(V!=="object")return Q=Q.concat([new Nt("terrain",u,`object expected, ${V} found`)]),Q;for(const K in u)Q=Q.concat(C[K]?p.validateSpec({key:K,value:u[K],valueSpec:C[K],validateSpec:p.validateSpec,style:P,styleSpec:m}):[new Nt(K,u[K],`unknown property "${K}"`)]);return Q}function Tn(p){let u=[];const m=p.value,C=p.key;if(Array.isArray(m)){const P=[],Q=[];for(const V in m)m[V].id&&P.includes(m[V].id)&&u.push(new Nt(C,m,`all the sprites' ids must be unique, but ${m[V].id} is duplicated`)),P.push(m[V].id),m[V].url&&Q.includes(m[V].url)&&u.push(new Nt(C,m,`all the sprites' URLs must be unique, but ${m[V].url} is duplicated`)),Q.push(m[V].url),u=u.concat(es({key:`${C}[${V}]`,value:m[V],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:p.validateSpec}));return u}return po({key:C,value:m})}const Fo={"*":()=>[],array:dl,boolean:function(p){const u=p.value,m=p.key,C=Tt(u);return C!=="boolean"?[new Nt(m,u,`boolean expected, ${C} found`)]:[]},number:fl,color:function(p){const u=p.key,m=p.value,C=Tt(m);return C!=="string"?[new Nt(u,m,`color expected, ${C} found`)]:ur.parse(String(m))?[]:[new Nt(u,m,`color expected, "${m}" found`)]},constants:Sn,enum:os,filter:Mo,function:fo,layer:ro,object:es,source:no,light:Ma,sky:ma,terrain:Pa,string:po,formatted:function(p){return po(p).length===0?[]:ss(p)},resolvedImage:function(p){return po(p).length===0?[]:ss(p)},padding:function(p){const u=p.key,m=p.value;if(Tt(m)==="array"){if(m.length<1||m.length>4)return[new Nt(u,m,`padding requires 1 to 4 values; ${m.length} values found`)];const C={type:"number"};let P=[];for(let Q=0;Q<m.length;Q++)P=P.concat(p.validateSpec({key:`${u}[${Q}]`,value:m[Q],validateSpec:p.validateSpec,valueSpec:C}));return P}return fl({key:u,value:m,valueSpec:{}})},variableAnchorOffsetCollection:function(p){const u=p.key,m=p.value,C=Tt(m),P=p.styleSpec;if(C!=="array"||m.length<1||m.length%2!=0)return[new Nt(u,m,"variableAnchorOffsetCollection requires a non-empty array of even length")];let Q=[];for(let V=0;V<m.length;V+=2)Q=Q.concat(os({key:`${u}[${V}]`,value:m[V],valueSpec:P.layout_symbol["text-anchor"]})),Q=Q.concat(dl({key:`${u}[${V+1}]`,value:m[V+1],valueSpec:{length:2,value:"number"},validateSpec:p.validateSpec,style:p.style,styleSpec:P}));return Q},sprite:Tn};function As(p){const u=p.value,m=p.valueSpec,C=p.styleSpec;return p.validateSpec=As,m.expression&&pi(on(u))?fo(p):m.expression&&Lr(fn(u))?ss(p):m.type&&Fo[m.type]?Fo[m.type](p):es(Ji({},p,{valueSpec:m.type?C[m.type]:m}))}function _s(p){const u=p.value,m=p.key,C=po(p);return C.length||(u.indexOf("{fontstack}")===-1&&C.push(new Nt(m,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&C.push(new Nt(m,u,'"glyphs" url must include a "{range}" token'))),C}function ds(p){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:xt,m=[];return m=m.concat(As({key:"",value:p,valueSpec:u.$root,styleSpec:u,style:p,validateSpec:As,objectElementValidators:{glyphs:_s,"*":()=>[]}})),p.constants&&(m=m.concat(Sn({key:"constants",value:p.constants,style:p,styleSpec:u,validateSpec:As}))),Zr(m)}function Ir(p){return function(u){return p({...u,validateSpec:As})}}function Zr(p){return[].concat(p).sort((u,m)=>u.line-m.line)}function an(p){return function(){for(var u=arguments.length,m=new Array(u),C=0;C<u;C++)m[C]=arguments[C];return Zr(p.apply(this,m))}}ds.source=an(Ir(no)),ds.sprite=an(Ir(Tn)),ds.glyphs=an(Ir(_s)),ds.light=an(Ir(Ma)),ds.sky=an(Ir(ma)),ds.terrain=an(Ir(Pa)),ds.layer=an(Ir(ro)),ds.filter=an(Ir(Mo)),ds.paintProperty=an(Ir(pl)),ds.layoutProperty=an(Ir(io));const jn=ds,ya=jn.light,Fa=jn.paintProperty,go=jn.layoutProperty;function Zo(p,u){let m=!1;if(u&&u.length)for(const C of u)p.fire(new kt(new Error(C.message))),m=!0;return m}class Oi{constructor(u,m,C){const P=this.cells=[];if(u instanceof ArrayBuffer){this.arrayBuffer=u;const V=new Int32Array(this.arrayBuffer);u=V[0],this.d=(m=V[1])+2*(C=V[2]);for(let re=0;re<this.d*this.d;re++){const he=V[3+re],h=V[3+re+1];P.push(he===h?null:V.subarray(he,h))}const K=V[3+P.length+1];this.keys=V.subarray(V[3+P.length],K),this.bboxes=V.subarray(K),this.insert=this._insertReadonly}else{this.d=m+2*C;for(let V=0;V<this.d*this.d;V++)P.push([]);this.keys=[],this.bboxes=[]}this.n=m,this.extent=u,this.padding=C,this.scale=m/u,this.uid=0;const Q=C/m*u;this.min=-Q,this.max=u+Q}insert(u,m,C,P,Q){this._forEachCell(m,C,P,Q,this._insertCell,this.uid++,void 0,void 0),this.keys.push(u),this.bboxes.push(m),this.bboxes.push(C),this.bboxes.push(P),this.bboxes.push(Q)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(u,m,C,P,Q,V){this.cells[Q].push(V)}query(u,m,C,P,Q){const V=this.min,K=this.max;if(u<=V&&m<=V&&K<=C&&K<=P&&!Q)return Array.prototype.slice.call(this.keys);{const re=[];return this._forEachCell(u,m,C,P,this._queryCell,re,{},Q),re}}_queryCell(u,m,C,P,Q,V,K,re){const he=this.cells[Q];if(he!==null){const h=this.keys,c=this.bboxes;for(let f=0;f<he.length;f++){const v=he[f];if(K[v]===void 0){const E=4*v;(re?re(c[E+0],c[E+1],c[E+2],c[E+3]):u<=c[E+2]&&m<=c[E+3]&&C>=c[E+0]&&P>=c[E+1])?(K[v]=!0,V.push(h[v])):K[v]=!1}}}}_forEachCell(u,m,C,P,Q,V,K,re){const he=this._convertToCellCoord(u),h=this._convertToCellCoord(m),c=this._convertToCellCoord(C),f=this._convertToCellCoord(P);for(let v=he;v<=c;v++)for(let E=h;E<=f;E++){const M=this.d*E+v;if((!re||re(this._convertFromCellCoord(v),this._convertFromCellCoord(E),this._convertFromCellCoord(v+1),this._convertFromCellCoord(E+1)))&&Q.call(this,u,m,C,P,M,V,K,re))return}}_convertFromCellCoord(u){return(u-this.padding)/this.scale}_convertToCellCoord(u){return Math.max(0,Math.min(this.d-1,Math.floor(u*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const u=this.cells,m=3+this.cells.length+1+1;let C=0;for(let V=0;V<this.cells.length;V++)C+=this.cells[V].length;const P=new Int32Array(m+C+this.keys.length+this.bboxes.length);P[0]=this.extent,P[1]=this.n,P[2]=this.padding;let Q=m;for(let V=0;V<u.length;V++){const K=u[V];P[3+V]=Q,P.set(K,Q),Q+=K.length}return P[3+u.length]=Q,P.set(this.keys,Q),Q+=this.keys.length,P[3+u.length+1]=Q,P.set(this.bboxes,Q),Q+=this.bboxes.length,P.buffer}static serialize(u,m){const C=u.toArrayBuffer();return m&&m.push(C),{buffer:C}}static deserialize(u){return new Oi(u.buffer)}}const Jo={};function Pi(p,u){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Jo[p])throw new Error(`${p} is already registered.`);Object.defineProperty(u,"_classRegistryKey",{value:p,writeable:!1}),Jo[p]={klass:u,omit:m.omit||[],shallow:m.shallow||[]}}Pi("Object",Object),Pi("TransferableGridIndex",Oi),Pi("Color",ur),Pi("Error",Error),Pi("AJAXError",Pt),Pi("ResolvedImage",xn),Pi("StylePropertyFunction",Ta),Pi("StyleExpression",Br,{omit:["_evaluator"]}),Pi("ZoomDependentExpression",to),Pi("ZoomConstantExpression",$s),Pi("CompoundExpression",Yn,{omit:["_evaluate"]});for(const p in Aa)Aa[p]._classRegistryKey||Pi(`Expression_${p}`,Aa[p]);function gl(p){return p&&typeof ArrayBuffer<"u"&&(p instanceof ArrayBuffer||p.constructor&&p.constructor.name==="ArrayBuffer")}function $l(p,u){if(p==null||typeof p=="boolean"||typeof p=="number"||typeof p=="string"||p instanceof Boolean||p instanceof Number||p instanceof String||p instanceof Date||p instanceof RegExp||p instanceof Blob||p instanceof Error)return p;if(gl(p)||_t(p))return u&&u.push(p),p;if(ArrayBuffer.isView(p)){const m=p;return u&&u.push(m.buffer),m}if(p instanceof ImageData)return u&&u.push(p.data.buffer),p;if(Array.isArray(p)){const m=[];for(const C of p)m.push($l(C,u));return m}if(typeof p=="object"){const m=p.constructor,C=m._classRegistryKey;if(!C)throw new Error(`can't serialize object of unregistered class ${m.name}`);if(!Jo[C])throw new Error(`${C} is not registered.`);const P=m.serialize?m.serialize(p,u):{};if(m.serialize){if(u&&P===u[u.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const Q in p){if(!p.hasOwnProperty(Q)||Jo[C].omit.indexOf(Q)>=0)continue;const V=p[Q];P[Q]=Jo[C].shallow.indexOf(Q)>=0?V:$l(V,u)}p instanceof Error&&(P.message=p.message)}if(P.$name)throw new Error("$name property is reserved for worker serialization logic.");return C!=="Object"&&(P.$name=C),P}throw new Error("can't serialize object of type "+typeof p)}function Li(p){if(p==null||typeof p=="boolean"||typeof p=="number"||typeof p=="string"||p instanceof Boolean||p instanceof Number||p instanceof String||p instanceof Date||p instanceof RegExp||p instanceof Blob||p instanceof Error||gl(p)||_t(p)||ArrayBuffer.isView(p)||p instanceof ImageData)return p;if(Array.isArray(p))return p.map(Li);if(typeof p=="object"){const u=p.$name||"Object";if(!Jo[u])throw new Error(`can't deserialize unregistered class ${u}`);const{klass:m}=Jo[u];if(!m)throw new Error(`can't deserialize unregistered class ${u}`);if(m.deserialize)return m.deserialize(p);const C=Object.create(m.prototype);for(const P of Object.keys(p)){if(P==="$name")continue;const Q=p[P];C[P]=Jo[u].shallow.indexOf(P)>=0?Q:Li(Q)}return C}throw new Error("can't deserialize object of type "+typeof p)}class Kl{constructor(){this.first=!0}update(u,m){const C=Math.floor(u);return this.first?(this.first=!1,this.lastIntegerZoom=C,this.lastIntegerZoomTime=0,this.lastZoom=u,this.lastFloorZoom=C,!0):(this.lastFloorZoom>C?(this.lastIntegerZoom=C+1,this.lastIntegerZoomTime=m):this.lastFloorZoom<C&&(this.lastIntegerZoom=C,this.lastIntegerZoomTime=m),u!==this.lastZoom&&(this.lastZoom=u,this.lastFloorZoom=C,!0))}}const Ei={"Latin-1 Supplement":p=>p>=128&&p<=255,Arabic:p=>p>=1536&&p<=1791,"Arabic Supplement":p=>p>=1872&&p<=1919,"Arabic Extended-A":p=>p>=2208&&p<=2303,"Hangul Jamo":p=>p>=4352&&p<=4607,"Unified Canadian Aboriginal Syllabics":p=>p>=5120&&p<=5759,Khmer:p=>p>=6016&&p<=6143,"Unified Canadian Aboriginal Syllabics Extended":p=>p>=6320&&p<=6399,"General Punctuation":p=>p>=8192&&p<=8303,"Letterlike Symbols":p=>p>=8448&&p<=8527,"Number Forms":p=>p>=8528&&p<=8591,"Miscellaneous Technical":p=>p>=8960&&p<=9215,"Control Pictures":p=>p>=9216&&p<=9279,"Optical Character Recognition":p=>p>=9280&&p<=9311,"Enclosed Alphanumerics":p=>p>=9312&&p<=9471,"Geometric Shapes":p=>p>=9632&&p<=9727,"Miscellaneous Symbols":p=>p>=9728&&p<=9983,"Miscellaneous Symbols and Arrows":p=>p>=11008&&p<=11263,"CJK Radicals Supplement":p=>p>=11904&&p<=12031,"Kangxi Radicals":p=>p>=12032&&p<=12255,"Ideographic Description Characters":p=>p>=12272&&p<=12287,"CJK Symbols and Punctuation":p=>p>=12288&&p<=12351,Hiragana:p=>p>=12352&&p<=12447,Katakana:p=>p>=12448&&p<=12543,Bopomofo:p=>p>=12544&&p<=12591,"Hangul Compatibility Jamo":p=>p>=12592&&p<=12687,Kanbun:p=>p>=12688&&p<=12703,"Bopomofo Extended":p=>p>=12704&&p<=12735,"CJK Strokes":p=>p>=12736&&p<=12783,"Katakana Phonetic Extensions":p=>p>=12784&&p<=12799,"Enclosed CJK Letters and Months":p=>p>=12800&&p<=13055,"CJK Compatibility":p=>p>=13056&&p<=13311,"CJK Unified Ideographs Extension A":p=>p>=13312&&p<=19903,"Yijing Hexagram Symbols":p=>p>=19904&&p<=19967,"CJK Unified Ideographs":p=>p>=19968&&p<=40959,"Yi Syllables":p=>p>=40960&&p<=42127,"Yi Radicals":p=>p>=42128&&p<=42191,"Hangul Jamo Extended-A":p=>p>=43360&&p<=43391,"Hangul Syllables":p=>p>=44032&&p<=55215,"Hangul Jamo Extended-B":p=>p>=55216&&p<=55295,"Private Use Area":p=>p>=57344&&p<=63743,"CJK Compatibility Ideographs":p=>p>=63744&&p<=64255,"Arabic Presentation Forms-A":p=>p>=64336&&p<=65023,"Vertical Forms":p=>p>=65040&&p<=65055,"CJK Compatibility Forms":p=>p>=65072&&p<=65103,"Small Form Variants":p=>p>=65104&&p<=65135,"Arabic Presentation Forms-B":p=>p>=65136&&p<=65279,"Halfwidth and Fullwidth Forms":p=>p>=65280&&p<=65519};function so(p){for(const u of p)if(Wl(u.charCodeAt(0)))return!0;return!1}function mo(p){for(const u of p)if(!Rc(u.charCodeAt(0)))return!1;return!0}function Rc(p){return!(Ei.Arabic(p)||Ei["Arabic Supplement"](p)||Ei["Arabic Extended-A"](p)||Ei["Arabic Presentation Forms-A"](p)||Ei["Arabic Presentation Forms-B"](p))}function Wl(p){return!(p!==746&&p!==747&&(p<4352||!(Ei["Bopomofo Extended"](p)||Ei.Bopomofo(p)||Ei["CJK Compatibility Forms"](p)&&!(p>=65097&&p<=65103)||Ei["CJK Compatibility Ideographs"](p)||Ei["CJK Compatibility"](p)||Ei["CJK Radicals Supplement"](p)||Ei["CJK Strokes"](p)||!(!Ei["CJK Symbols and Punctuation"](p)||p>=12296&&p<=12305||p>=12308&&p<=12319||p===12336)||Ei["CJK Unified Ideographs Extension A"](p)||Ei["CJK Unified Ideographs"](p)||Ei["Enclosed CJK Letters and Months"](p)||Ei["Hangul Compatibility Jamo"](p)||Ei["Hangul Jamo Extended-A"](p)||Ei["Hangul Jamo Extended-B"](p)||Ei["Hangul Jamo"](p)||Ei["Hangul Syllables"](p)||Ei.Hiragana(p)||Ei["Ideographic Description Characters"](p)||Ei.Kanbun(p)||Ei["Kangxi Radicals"](p)||Ei["Katakana Phonetic Extensions"](p)||Ei.Katakana(p)&&p!==12540||!(!Ei["Halfwidth and Fullwidth Forms"](p)||p===65288||p===65289||p===65293||p>=65306&&p<=65310||p===65339||p===65341||p===65343||p>=65371&&p<=65503||p===65507||p>=65512&&p<=65519)||!(!Ei["Small Form Variants"](p)||p>=65112&&p<=65118||p>=65123&&p<=65126)||Ei["Unified Canadian Aboriginal Syllabics"](p)||Ei["Unified Canadian Aboriginal Syllabics Extended"](p)||Ei["Vertical Forms"](p)||Ei["Yijing Hexagram Symbols"](p)||Ei["Yi Syllables"](p)||Ei["Yi Radicals"](p))))}function kc(p){return!(Wl(p)||function(u){return!!(Ei["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||Ei["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||Ei["Letterlike Symbols"](u)||Ei["Number Forms"](u)||Ei["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||Ei["Control Pictures"](u)&&u!==9251||Ei["Optical Character Recognition"](u)||Ei["Enclosed Alphanumerics"](u)||Ei["Geometric Shapes"](u)||Ei["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||Ei["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||Ei["CJK Symbols and Punctuation"](u)||Ei.Katakana(u)||Ei["Private Use Area"](u)||Ei["CJK Compatibility Forms"](u)||Ei["Small Form Variants"](u)||Ei["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(p))}function Oc(p){return p>=1424&&p<=2303||Ei["Arabic Presentation Forms-A"](p)||Ei["Arabic Presentation Forms-B"](p)}function Uc(p,u){return!(!u&&Oc(p)||p>=2304&&p<=3583||p>=3840&&p<=4255||Ei.Khmer(p))}function Nc(p){for(const u of p)if(Oc(u.charCodeAt(0)))return!0;return!1}const il=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(p){this.pluginStatus=p.pluginStatus,this.pluginURL=p.pluginURL}setMethods(p){this.applyArabicShaping=p.applyArabicShaping,this.processBidirectionalText=p.processBidirectionalText,this.processStyledBidirectionalText=p.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class yn{constructor(u,m){this.zoom=u,m?(this.now=m.now,this.fadeDuration=m.fadeDuration,this.zoomHistory=m.zoomHistory,this.transition=m.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Kl,this.transition={})}isSupportedScript(u){return function(m,C){for(const P of m)if(!Uc(P.charCodeAt(0),C))return!1;return!0}(u,il.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const u=this.zoom,m=u-Math.floor(u),C=this.crossFadingFactor();return u>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:m+(1-m)*C}:{fromScale:.5,toScale:1,t:1-(1-C)*m}}}class Cs{constructor(u,m){this.property=u,this.value=m,this.expression=function(C,P){if(pi(C))return new Ta(C,P);if(Lr(C)){const Q=Lo(C,P);if(Q.result==="error")throw new Error(Q.value.map(V=>`${V.key}: ${V.message}`).join(", "));return Q.value}{let Q=C;return P.type==="color"&&typeof C=="string"?Q=ur.parse(C):P.type!=="padding"||typeof C!="number"&&!Array.isArray(C)?P.type==="variableAnchorOffsetCollection"&&Array.isArray(C)&&(Q=Qr.parse(C)):Q=kn.parse(C),{kind:"constant",evaluate:()=>Q}}}(m===void 0?u.specification.default:m,u.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(u,m,C){return this.property.possiblyEvaluate(this,u,m,C)}}class Do{constructor(u){this.property=u,this.value=new Cs(u,void 0)}transitioned(u,m){return new Ou(this.property,this.value,m,qe({},u.transition,this.transition),u.now)}untransitioned(){return new Ou(this.property,this.value,null,{},0)}}class Xl{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitionablePropertyValues)}getValue(u){return De(this._values[u].value.value)}setValue(u,m){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Do(this._values[u].property)),this._values[u].value=new Cs(this._values[u].property,m===null?void 0:De(m))}getTransition(u){return De(this._values[u].transition)}setTransition(u,m){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Do(this._values[u].property)),this._values[u].transition=De(m)||void 0}serialize(){const u={};for(const m of Object.keys(this._values)){const C=this.getValue(m);C!==void 0&&(u[m]=C);const P=this.getTransition(m);P!==void 0&&(u[`${m}-transition`]=P)}return u}transitioned(u,m){const C=new gc(this._properties);for(const P of Object.keys(this._values))C._values[P]=this._values[P].transitioned(u,m._values[P]);return C}untransitioned(){const u=new gc(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].untransitioned();return u}}class Ou{constructor(u,m,C,P,Q){this.property=u,this.value=m,this.begin=Q+P.delay||0,this.end=this.begin+P.duration||0,u.specification.transition&&(P.delay||P.duration)&&(this.prior=C)}possiblyEvaluate(u,m,C){const P=u.now||0,Q=this.value.possiblyEvaluate(u,m,C),V=this.prior;if(V){if(P>this.end)return this.prior=null,Q;if(this.value.isDataDriven())return this.prior=null,Q;if(P<this.begin)return V.possiblyEvaluate(u,m,C);{const K=(P-this.begin)/(this.end-this.begin);return this.property.interpolate(V.possiblyEvaluate(u,m,C),Q,function(re){if(re<=0)return 0;if(re>=1)return 1;const he=re*re,h=he*re;return 4*(re<.5?h:3*(re-he)+h-.75)}(K))}}return Q}}class gc{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitioningPropertyValues)}possiblyEvaluate(u,m,C){const P=new Ks(this._properties);for(const Q of Object.keys(this._values))P._values[Q]=this._values[Q].possiblyEvaluate(u,m,C);return P}hasTransition(){for(const u of Object.keys(this._values))if(this._values[u].prior)return!0;return!1}}class uu{constructor(u){this._properties=u,this._values=Object.create(u.defaultPropertyValues)}hasValue(u){return this._values[u].value!==void 0}getValue(u){return De(this._values[u].value)}setValue(u,m){this._values[u]=new Cs(this._values[u].property,m===null?void 0:De(m))}serialize(){const u={};for(const m of Object.keys(this._values)){const C=this.getValue(m);C!==void 0&&(u[m]=C)}return u}possiblyEvaluate(u,m,C){const P=new Ks(this._properties);for(const Q of Object.keys(this._values))P._values[Q]=this._values[Q].possiblyEvaluate(u,m,C);return P}}class _a{constructor(u,m,C){this.property=u,this.value=m,this.parameters=C}isConstant(){return this.value.kind==="constant"}constantOr(u){return this.value.kind==="constant"?this.value.value:u}evaluate(u,m,C,P){return this.property.evaluate(this.value,this.parameters,u,m,C,P)}}class Ks{constructor(u){this._properties=u,this._values=Object.create(u.defaultPossiblyEvaluatedValues)}get(u){return this._values[u]}}class bi{constructor(u){this.specification=u}possiblyEvaluate(u,m){if(u.isDataDriven())throw new Error("Value should not be data driven");return u.expression.evaluate(m)}interpolate(u,m,C){const P=dn[this.specification.type];return P?P(u,m,C):u}}class sr{constructor(u,m){this.specification=u,this.overrides=m}possiblyEvaluate(u,m,C,P){return new _a(this,u.expression.kind==="constant"||u.expression.kind==="camera"?{kind:"constant",value:u.expression.evaluate(m,null,{},C,P)}:u.expression,m)}interpolate(u,m,C){if(u.value.kind!=="constant"||m.value.kind!=="constant")return u;if(u.value.value===void 0||m.value.value===void 0)return new _a(this,{kind:"constant",value:void 0},u.parameters);const P=dn[this.specification.type];if(P){const Q=P(u.value.value,m.value.value,C);return new _a(this,{kind:"constant",value:Q},u.parameters)}return u}evaluate(u,m,C,P,Q,V){return u.kind==="constant"?u.value:u.evaluate(m,C,P,Q,V)}}class Zl extends sr{possiblyEvaluate(u,m,C,P){if(u.value===void 0)return new _a(this,{kind:"constant",value:void 0},m);if(u.expression.kind==="constant"){const Q=u.expression.evaluate(m,null,{},C,P),V=u.property.specification.type==="resolvedImage"&&typeof Q!="string"?Q.name:Q,K=this._calculate(V,V,V,m);return new _a(this,{kind:"constant",value:K},m)}if(u.expression.kind==="camera"){const Q=this._calculate(u.expression.evaluate({zoom:m.zoom-1}),u.expression.evaluate({zoom:m.zoom}),u.expression.evaluate({zoom:m.zoom+1}),m);return new _a(this,{kind:"constant",value:Q},m)}return new _a(this,u.expression,m)}evaluate(u,m,C,P,Q,V){if(u.kind==="source"){const K=u.evaluate(m,C,P,Q,V);return this._calculate(K,K,K,m)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(m.zoom)-1},C,P),u.evaluate({zoom:Math.floor(m.zoom)},C,P),u.evaluate({zoom:Math.floor(m.zoom)+1},C,P),m):u.value}_calculate(u,m,C,P){return P.zoom>P.zoomHistory.lastIntegerZoom?{from:u,to:m}:{from:C,to:m}}interpolate(u){return u}}class zc{constructor(u){this.specification=u}possiblyEvaluate(u,m,C,P){if(u.value!==void 0){if(u.expression.kind==="constant"){const Q=u.expression.evaluate(m,null,{},C,P);return this._calculate(Q,Q,Q,m)}return this._calculate(u.expression.evaluate(new yn(Math.floor(m.zoom-1),m)),u.expression.evaluate(new yn(Math.floor(m.zoom),m)),u.expression.evaluate(new yn(Math.floor(m.zoom+1),m)),m)}}_calculate(u,m,C,P){return P.zoom>P.zoomHistory.lastIntegerZoom?{from:u,to:m}:{from:C,to:m}}interpolate(u){return u}}class Qc{constructor(u){this.specification=u}possiblyEvaluate(u,m,C,P){return!!u.expression.evaluate(m,null,{},C,P)}interpolate(){return!1}}class Es{constructor(u){this.properties=u,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const m in u){const C=u[m];C.specification.overridable&&this.overridableProperties.push(m);const P=this.defaultPropertyValues[m]=new Cs(C,void 0),Q=this.defaultTransitionablePropertyValues[m]=new Do(C);this.defaultTransitioningPropertyValues[m]=Q.untransitioned(),this.defaultPossiblyEvaluatedValues[m]=P.possiblyEvaluate({})}}}Pi("DataDrivenProperty",sr),Pi("DataConstantProperty",bi),Pi("CrossFadedDataDrivenProperty",Zl),Pi("CrossFadedProperty",zc),Pi("ColorRampProperty",Qc);const bh="-transition";class qn extends at{constructor(u,m){if(super(),this.id=u.id,this.type=u.type,this._featureFilter={filter:()=>!0,needGeometry:!1},u.type!=="custom"&&(this.metadata=u.metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),m.layout&&(this._unevaluatedLayout=new uu(m.layout)),m.paint)){this._transitionablePaint=new Xl(m.paint);for(const C in u.paint)this.setPaintProperty(C,u.paint[C],{validate:!1});for(const C in u.layout)this.setLayoutProperty(C,u.layout[C],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ks(m.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)}setLayoutProperty(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};m!=null&&this._validate(go,`layers.${this.id}.layout.${u}`,u,m,C)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,m):this.visibility=m)}getPaintProperty(u){return u.endsWith(bh)?this._transitionablePaint.getTransition(u.slice(0,-11)):this._transitionablePaint.getValue(u)}setPaintProperty(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(m!=null&&this._validate(Fa,`layers.${this.id}.paint.${u}`,u,m,C))return!1;if(u.endsWith(bh))return this._transitionablePaint.setTransition(u.slice(0,-11),m||void 0),!1;{const P=this._transitionablePaint._values[u],Q=P.property.specification["property-type"]==="cross-faded-data-driven",V=P.value.isDataDriven(),K=P.value;this._transitionablePaint.setValue(u,m),this._handleSpecialPaintPropertyUpdate(u);const re=this._transitionablePaint._values[u].value;return re.isDataDriven()||V||Q||this._handleOverridablePaintPropertyUpdate(u,K,re)}}_handleSpecialPaintPropertyUpdate(u){}_handleOverridablePaintPropertyUpdate(u,m,C){return!1}isHidden(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"}updateTransitions(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(u,m){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,m)}serialize(){const u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),it(u,(m,C)=>!(m===void 0||C==="layout"&&!Object.keys(m).length||C==="paint"&&!Object.keys(m).length))}_validate(u,m,C,P){let Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!Q||Q.validate!==!1)&&Zo(this,u.call(jn,{key:m,layerType:this.type,objectKey:C,value:P,styleSpec:xt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const u in this.paint._values){const m=this.paint.get(u);if(m instanceof _a&&lt(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1}}const hu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $i{constructor(u,m){this._structArray=u,this._pos1=m*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ni{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(u,m){return u._trim(),m&&(u.isTransferred=!0,m.push(u.arrayBuffer)),{length:u.length,arrayBuffer:u.arrayBuffer}}static deserialize(u){const m=Object.create(this.prototype);return m.arrayBuffer=u.arrayBuffer,m.length=u.length,m.capacity=u.arrayBuffer.byteLength/m.bytesPerElement,m._refreshViews(),m}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(u){this.reserve(u),this.length=u}reserve(u){if(u>this.capacity){this.capacity=Math.max(u,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const m=this.uint8;this._refreshViews(),m&&this.uint8.set(m)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function $n(p){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,m=0,C=0;return{members:p.map(P=>{const Q=hu[P.type].BYTES_PER_ELEMENT,V=m=Uu(m,Math.max(u,Q)),K=P.components||1;return C=Math.max(C,Q),m+=Q*K,{name:P.name,type:P.type,components:K,offset:V}}),size:Uu(m,Math.max(C,u)),alignment:u}}function Uu(p,u){return Math.ceil(p/u)*u}class Rs extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m){const C=this.length;return this.resize(C+1),this.emplace(C,u,m)}emplace(u,m,C){const P=2*u;return this.int16[P+0]=m,this.int16[P+1]=C,u}}Rs.prototype.bytesPerElement=4,Pi("StructArrayLayout2i4",Rs);class tn extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,m,C)}emplace(u,m,C,P){const Q=3*u;return this.int16[Q+0]=m,this.int16[Q+1]=C,this.int16[Q+2]=P,u}}tn.prototype.bytesPerElement=6,Pi("StructArrayLayout3i6",tn);class Yo extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,P){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,m,C,P)}emplace(u,m,C,P,Q){const V=4*u;return this.int16[V+0]=m,this.int16[V+1]=C,this.int16[V+2]=P,this.int16[V+3]=Q,u}}Yo.prototype.bytesPerElement=8,Pi("StructArrayLayout4i8",Yo);class Ro extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V){const K=this.length;return this.resize(K+1),this.emplace(K,u,m,C,P,Q,V)}emplace(u,m,C,P,Q,V,K){const re=6*u;return this.int16[re+0]=m,this.int16[re+1]=C,this.int16[re+2]=P,this.int16[re+3]=Q,this.int16[re+4]=V,this.int16[re+5]=K,u}}Ro.prototype.bytesPerElement=12,Pi("StructArrayLayout2i4i12",Ro);class Au extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V){const K=this.length;return this.resize(K+1),this.emplace(K,u,m,C,P,Q,V)}emplace(u,m,C,P,Q,V,K){const re=4*u,he=8*u;return this.int16[re+0]=m,this.int16[re+1]=C,this.uint8[he+4]=P,this.uint8[he+5]=Q,this.uint8[he+6]=V,this.uint8[he+7]=K,u}}Au.prototype.bytesPerElement=8,Pi("StructArrayLayout2i4ub8",Au);class ks extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m){const C=this.length;return this.resize(C+1),this.emplace(C,u,m)}emplace(u,m,C){const P=2*u;return this.float32[P+0]=m,this.float32[P+1]=C,u}}ks.prototype.bytesPerElement=8,Pi("StructArrayLayout2f8",ks);class Jr extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V,K,re,he,h){const c=this.length;return this.resize(c+1),this.emplace(c,u,m,C,P,Q,V,K,re,he,h)}emplace(u,m,C,P,Q,V,K,re,he,h,c){const f=10*u;return this.uint16[f+0]=m,this.uint16[f+1]=C,this.uint16[f+2]=P,this.uint16[f+3]=Q,this.uint16[f+4]=V,this.uint16[f+5]=K,this.uint16[f+6]=re,this.uint16[f+7]=he,this.uint16[f+8]=h,this.uint16[f+9]=c,u}}Jr.prototype.bytesPerElement=20,Pi("StructArrayLayout10ui20",Jr);class Nn extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V,K,re,he,h,c,f){const v=this.length;return this.resize(v+1),this.emplace(v,u,m,C,P,Q,V,K,re,he,h,c,f)}emplace(u,m,C,P,Q,V,K,re,he,h,c,f,v){const E=12*u;return this.int16[E+0]=m,this.int16[E+1]=C,this.int16[E+2]=P,this.int16[E+3]=Q,this.uint16[E+4]=V,this.uint16[E+5]=K,this.uint16[E+6]=re,this.uint16[E+7]=he,this.int16[E+8]=h,this.int16[E+9]=c,this.int16[E+10]=f,this.int16[E+11]=v,u}}Nn.prototype.bytesPerElement=24,Pi("StructArrayLayout4i4ui4i24",Nn);class ko extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,m,C)}emplace(u,m,C,P){const Q=3*u;return this.float32[Q+0]=m,this.float32[Q+1]=C,this.float32[Q+2]=P,u}}ko.prototype.bytesPerElement=12,Pi("StructArrayLayout3f12",ko);class ml extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(u){const m=this.length;return this.resize(m+1),this.emplace(m,u)}emplace(u,m){return this.uint32[1*u+0]=m,u}}ml.prototype.bytesPerElement=4,Pi("StructArrayLayout1ul4",ml);class rl extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V,K,re,he){const h=this.length;return this.resize(h+1),this.emplace(h,u,m,C,P,Q,V,K,re,he)}emplace(u,m,C,P,Q,V,K,re,he,h){const c=10*u,f=5*u;return this.int16[c+0]=m,this.int16[c+1]=C,this.int16[c+2]=P,this.int16[c+3]=Q,this.int16[c+4]=V,this.int16[c+5]=K,this.uint32[f+3]=re,this.uint16[c+8]=he,this.uint16[c+9]=h,u}}rl.prototype.bytesPerElement=20,Pi("StructArrayLayout6i1ul2ui20",rl);class Da extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V){const K=this.length;return this.resize(K+1),this.emplace(K,u,m,C,P,Q,V)}emplace(u,m,C,P,Q,V,K){const re=6*u;return this.int16[re+0]=m,this.int16[re+1]=C,this.int16[re+2]=P,this.int16[re+3]=Q,this.int16[re+4]=V,this.int16[re+5]=K,u}}Da.prototype.bytesPerElement=12,Pi("StructArrayLayout2i2i2i12",Da);class Jl extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q){const V=this.length;return this.resize(V+1),this.emplace(V,u,m,C,P,Q)}emplace(u,m,C,P,Q,V){const K=4*u,re=8*u;return this.float32[K+0]=m,this.float32[K+1]=C,this.float32[K+2]=P,this.int16[re+6]=Q,this.int16[re+7]=V,u}}Jl.prototype.bytesPerElement=16,Pi("StructArrayLayout2f1f2i16",Jl);class du extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,P){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,m,C,P)}emplace(u,m,C,P,Q){const V=12*u,K=3*u;return this.uint8[V+0]=m,this.uint8[V+1]=C,this.float32[K+1]=P,this.float32[K+2]=Q,u}}du.prototype.bytesPerElement=12,Pi("StructArrayLayout2ub2f12",du);class yo extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,m,C)}emplace(u,m,C,P){const Q=3*u;return this.uint16[Q+0]=m,this.uint16[Q+1]=C,this.uint16[Q+2]=P,u}}yo.prototype.bytesPerElement=6,Pi("StructArrayLayout3ui6",yo);class va extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V,K,re,he,h,c,f,v,E,M,D,G){const $=this.length;return this.resize($+1),this.emplace($,u,m,C,P,Q,V,K,re,he,h,c,f,v,E,M,D,G)}emplace(u,m,C,P,Q,V,K,re,he,h,c,f,v,E,M,D,G,$){const X=24*u,se=12*u,Ae=48*u;return this.int16[X+0]=m,this.int16[X+1]=C,this.uint16[X+2]=P,this.uint16[X+3]=Q,this.uint32[se+2]=V,this.uint32[se+3]=K,this.uint32[se+4]=re,this.uint16[X+10]=he,this.uint16[X+11]=h,this.uint16[X+12]=c,this.float32[se+7]=f,this.float32[se+8]=v,this.uint8[Ae+36]=E,this.uint8[Ae+37]=M,this.uint8[Ae+38]=D,this.uint32[se+10]=G,this.int16[X+22]=$,u}}va.prototype.bytesPerElement=48,Pi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",va);class yl extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,P,Q,V,K,re,he,h,c,f,v,E,M,D,G,$,X,se,Ae,me,Be,Te,ke,je,$e,ct){const Ye=this.length;return this.resize(Ye+1),this.emplace(Ye,u,m,C,P,Q,V,K,re,he,h,c,f,v,E,M,D,G,$,X,se,Ae,me,Be,Te,ke,je,$e,ct)}emplace(u,m,C,P,Q,V,K,re,he,h,c,f,v,E,M,D,G,$,X,se,Ae,me,Be,Te,ke,je,$e,ct,Ye){const tt=32*u,gt=16*u;return this.int16[tt+0]=m,this.int16[tt+1]=C,this.int16[tt+2]=P,this.int16[tt+3]=Q,this.int16[tt+4]=V,this.int16[tt+5]=K,this.int16[tt+6]=re,this.int16[tt+7]=he,this.uint16[tt+8]=h,this.uint16[tt+9]=c,this.uint16[tt+10]=f,this.uint16[tt+11]=v,this.uint16[tt+12]=E,this.uint16[tt+13]=M,this.uint16[tt+14]=D,this.uint16[tt+15]=G,this.uint16[tt+16]=$,this.uint16[tt+17]=X,this.uint16[tt+18]=se,this.uint16[tt+19]=Ae,this.uint16[tt+20]=me,this.uint16[tt+21]=Be,this.uint16[tt+22]=Te,this.uint32[gt+12]=ke,this.float32[gt+13]=je,this.float32[gt+14]=$e,this.uint16[tt+30]=ct,this.uint16[tt+31]=Ye,u}}yl.prototype.bytesPerElement=64,Pi("StructArrayLayout8i15ui1ul2f2ui64",yl);class Gr extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u){const m=this.length;return this.resize(m+1),this.emplace(m,u)}emplace(u,m){return this.float32[1*u+0]=m,u}}Gr.prototype.bytesPerElement=4,Pi("StructArrayLayout1f4",Gr);class N extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,m,C)}emplace(u,m,C,P){const Q=3*u;return this.uint16[6*u+0]=m,this.float32[Q+1]=C,this.float32[Q+2]=P,u}}N.prototype.bytesPerElement=12,Pi("StructArrayLayout1ui2f12",N);class A extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C){const P=this.length;return this.resize(P+1),this.emplace(P,u,m,C)}emplace(u,m,C,P){const Q=4*u;return this.uint32[2*u+0]=m,this.uint16[Q+2]=C,this.uint16[Q+3]=P,u}}A.prototype.bytesPerElement=8,Pi("StructArrayLayout1ul2ui8",A);class x extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m){const C=this.length;return this.resize(C+1),this.emplace(C,u,m)}emplace(u,m,C){const P=2*u;return this.uint16[P+0]=m,this.uint16[P+1]=C,u}}x.prototype.bytesPerElement=4,Pi("StructArrayLayout2ui4",x);class L extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u){const m=this.length;return this.resize(m+1),this.emplace(m,u)}emplace(u,m){return this.uint16[1*u+0]=m,u}}L.prototype.bytesPerElement=2,Pi("StructArrayLayout1ui2",L);class O extends Ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,P){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,m,C,P)}emplace(u,m,C,P,Q){const V=4*u;return this.float32[V+0]=m,this.float32[V+1]=C,this.float32[V+2]=P,this.float32[V+3]=Q,u}}O.prototype.bytesPerElement=16,Pi("StructArrayLayout4f16",O);class y extends $i{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new F(this.anchorPointX,this.anchorPointY)}}y.prototype.size=20;class a extends rl{get(u){return new y(this,u)}}Pi("CollisionBoxArray",a);class d extends $i{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(u){this._structArray.uint8[this._pos1+37]=u}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(u){this._structArray.uint8[this._pos1+38]=u}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(u){this._structArray.uint32[this._pos4+10]=u}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}d.prototype.size=48;class _ extends va{get(u){return new d(this,u)}}Pi("PlacedSymbolArray",_);class B extends $i{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(u){this._structArray.uint32[this._pos4+12]=u}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}B.prototype.size=64;class S extends yl{get(u){return new B(this,u)}}Pi("SymbolInstanceArray",S);class U extends Gr{getoffsetX(u){return this.float32[1*u+0]}}Pi("GlyphOffsetArray",U);class H extends tn{getx(u){return this.int16[3*u+0]}gety(u){return this.int16[3*u+1]}gettileUnitDistanceFromAnchor(u){return this.int16[3*u+2]}}Pi("SymbolLineVertexArray",H);class q extends $i{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}q.prototype.size=12;class w extends N{get(u){return new q(this,u)}}Pi("TextAnchorOffsetArray",w);class I extends $i{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}I.prototype.size=8;class R extends A{get(u){return new I(this,u)}}Pi("FeatureIndexArray",R);class j extends Rs{}class Z extends Rs{}class W extends Rs{}class Y extends Ro{}class ie extends Au{}class ae extends ks{}class fe extends Jr{}class pe extends Nn{}class xe extends ko{}class Fe extends ml{}class Le extends Da{}class nt extends du{}class Ke extends yo{}class Re extends x{}const Qe=$n([{name:"a_pos",components:2,type:"Int16"}],4),{members:pt}=Qe;class bt{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=u}prepareSegment(u,m,C,P){let Q=this.segments[this.segments.length-1];return u>bt.MAX_VERTEX_ARRAY_LENGTH&&Ze(`Max vertices per segment is ${bt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${u}`),(!Q||Q.vertexLength+u>bt.MAX_VERTEX_ARRAY_LENGTH||Q.sortKey!==P)&&(Q={vertexOffset:m.length,primitiveOffset:C.length,vertexLength:0,primitiveLength:0},P!==void 0&&(Q.sortKey=P),this.segments.push(Q)),Q}get(){return this.segments}destroy(){for(const u of this.segments)for(const m in u.vaos)u.vaos[m].destroy()}static simpleSegment(u,m,C,P){return new bt([{vertexOffset:u,primitiveOffset:m,vertexLength:C,primitiveLength:P,vaos:{},sortKey:0}])}}function ht(p,u){return 256*(p=He(Math.floor(p),0,255))+He(Math.floor(u),0,255)}bt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pi("SegmentVector",bt);const Rt=$n([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Dt={exports:{}},hi={exports:{}};hi.exports=function(p,u){var m,C,P,Q,V,K,re,he;for(C=p.length-(m=3&p.length),P=u,V=3432918353,K=461845907,he=0;he<C;)re=255&p.charCodeAt(he)|(255&p.charCodeAt(++he))<<8|(255&p.charCodeAt(++he))<<16|(255&p.charCodeAt(++he))<<24,++he,P=27492+(65535&(Q=5*(65535&(P=(P^=re=(65535&(re=(re=(65535&re)*V+(((re>>>16)*V&65535)<<16)&4294967295)<<15|re>>>17))*K+(((re>>>16)*K&65535)<<16)&4294967295)<<13|P>>>19))+((5*(P>>>16)&65535)<<16)&4294967295))+((58964+(Q>>>16)&65535)<<16);switch(re=0,m){case 3:re^=(255&p.charCodeAt(he+2))<<16;case 2:re^=(255&p.charCodeAt(he+1))<<8;case 1:P^=re=(65535&(re=(re=(65535&(re^=255&p.charCodeAt(he)))*V+(((re>>>16)*V&65535)<<16)&4294967295)<<15|re>>>17))*K+(((re>>>16)*K&65535)<<16)&4294967295}return P^=p.length,P=2246822507*(65535&(P^=P>>>16))+((2246822507*(P>>>16)&65535)<<16)&4294967295,P=3266489909*(65535&(P^=P>>>13))+((3266489909*(P>>>16)&65535)<<16)&4294967295,(P^=P>>>16)>>>0};var Vt=hi.exports,_i={exports:{}};_i.exports=function(p,u){for(var m,C=p.length,P=u^C,Q=0;C>=4;)m=1540483477*(65535&(m=255&p.charCodeAt(Q)|(255&p.charCodeAt(++Q))<<8|(255&p.charCodeAt(++Q))<<16|(255&p.charCodeAt(++Q))<<24))+((1540483477*(m>>>16)&65535)<<16),P=1540483477*(65535&P)+((1540483477*(P>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),C-=4,++Q;switch(C){case 3:P^=(255&p.charCodeAt(Q+2))<<16;case 2:P^=(255&p.charCodeAt(Q+1))<<8;case 1:P=1540483477*(65535&(P^=255&p.charCodeAt(Q)))+((1540483477*(P>>>16)&65535)<<16)}return P=1540483477*(65535&(P^=P>>>13))+((1540483477*(P>>>16)&65535)<<16),(P^=P>>>15)>>>0};var Si=Vt,Yi=_i.exports;Dt.exports=Si,Dt.exports.murmur3=Si,Dt.exports.murmur2=Yi;var Ti=g(Dt.exports);class yr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(u,m,C,P){this.ids.push(fr(u)),this.positions.push(m,C,P)}getPositions(u){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const m=fr(u);let C=0,P=this.ids.length-1;for(;C<P;){const V=C+P>>1;this.ids[V]>=m?P=V:C=V+1}const Q=[];for(;this.ids[C]===m;)Q.push({index:this.positions[3*C],start:this.positions[3*C+1],end:this.positions[3*C+2]}),C++;return Q}static serialize(u,m){const C=new Float64Array(u.ids),P=new Uint32Array(u.positions);return ji(C,P,0,C.length-1),m&&m.push(C.buffer,P.buffer),{ids:C,positions:P}}static deserialize(u){const m=new yr;return m.ids=u.ids,m.positions=u.positions,m.indexed=!0,m}}function fr(p){const u=+p;return!isNaN(u)&&u<=Number.MAX_SAFE_INTEGER?u:Ti(String(p))}function ji(p,u,m,C){for(;m<C;){const P=p[m+C>>1];let Q=m-1,V=C+1;for(;;){do Q++;while(p[Q]<P);do V--;while(p[V]>P);if(Q>=V)break;Ur(p,Q,V),Ur(u,3*Q,3*V),Ur(u,3*Q+1,3*V+1),Ur(u,3*Q+2,3*V+2)}V-m<C-V?(ji(p,u,m,V),m=V+1):(ji(p,u,V+1,C),C=V)}}function Ur(p,u,m){const C=p[u];p[u]=p[m],p[m]=C}Pi("FeaturePositionMap",yr);class rn{constructor(u,m){this.gl=u.gl,this.location=m}}class Mr extends rn{constructor(u,m){super(u,m),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Kr extends rn{constructor(u,m){super(u,m),this.current=[0,0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))}}class Cr extends rn{constructor(u,m){super(u,m),this.current=ur.transparent}set(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))}}const ts=new Float32Array(16);function Nr(p){return[ht(255*p.r,255*p.g),ht(255*p.b,255*p.a)]}class pr{constructor(u,m,C){this.value=u,this.uniformNames=m.map(P=>`u_${P}`),this.type=C}setUniform(u,m,C){u.set(C.constantOr(this.value))}getBinding(u,m,C){return this.type==="color"?new Cr(u,m):new Mr(u,m)}}class _r{constructor(u,m){this.uniformNames=m.map(C=>`u_${C}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(u,m){this.pixelRatioFrom=m.pixelRatio,this.pixelRatioTo=u.pixelRatio,this.patternFrom=m.tlbr,this.patternTo=u.tlbr}setUniform(u,m,C,P){const Q=P==="u_pattern_to"?this.patternTo:P==="u_pattern_from"?this.patternFrom:P==="u_pixel_ratio_to"?this.pixelRatioTo:P==="u_pixel_ratio_from"?this.pixelRatioFrom:null;Q&&u.set(Q)}getBinding(u,m,C){return C.substr(0,9)==="u_pattern"?new Kr(u,m):new Mr(u,m)}}class or{constructor(u,m,C,P){this.expression=u,this.type=C,this.maxValue=0,this.paintVertexAttributes=m.map(Q=>({name:`a_${Q}`,type:"Float32",components:C==="color"?2:1,offset:0})),this.paintVertexArray=new P}populatePaintArray(u,m,C,P,Q){const V=this.paintVertexArray.length,K=this.expression.evaluate(new yn(0),m,{},P,[],Q);this.paintVertexArray.resize(u),this._setPaintValue(V,u,K)}updatePaintArray(u,m,C,P){const Q=this.expression.evaluate({zoom:0},C,P);this._setPaintValue(u,m,Q)}_setPaintValue(u,m,C){if(this.type==="color"){const P=Nr(C);for(let Q=u;Q<m;Q++)this.paintVertexArray.emplace(Q,P[0],P[1])}else{for(let P=u;P<m;P++)this.paintVertexArray.emplace(P,C);this.maxValue=Math.max(this.maxValue,Math.abs(C))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ln{constructor(u,m,C,P,Q,V){this.expression=u,this.uniformNames=m.map(K=>`u_${K}_t`),this.type=C,this.useIntegerZoom=P,this.zoom=Q,this.maxValue=0,this.paintVertexAttributes=m.map(K=>({name:`a_${K}`,type:"Float32",components:C==="color"?4:2,offset:0})),this.paintVertexArray=new V}populatePaintArray(u,m,C,P,Q){const V=this.expression.evaluate(new yn(this.zoom),m,{},P,[],Q),K=this.expression.evaluate(new yn(this.zoom+1),m,{},P,[],Q),re=this.paintVertexArray.length;this.paintVertexArray.resize(u),this._setPaintValue(re,u,V,K)}updatePaintArray(u,m,C,P){const Q=this.expression.evaluate({zoom:this.zoom},C,P),V=this.expression.evaluate({zoom:this.zoom+1},C,P);this._setPaintValue(u,m,Q,V)}_setPaintValue(u,m,C,P){if(this.type==="color"){const Q=Nr(C),V=Nr(P);for(let K=u;K<m;K++)this.paintVertexArray.emplace(K,Q[0],Q[1],V[0],V[1])}else{for(let Q=u;Q<m;Q++)this.paintVertexArray.emplace(Q,C,P);this.maxValue=Math.max(this.maxValue,Math.abs(C),Math.abs(P))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(u,m){const C=this.useIntegerZoom?Math.floor(m.zoom):m.zoom,P=He(this.expression.interpolationFactor(C,this.zoom,this.zoom+1),0,1);u.set(P)}getBinding(u,m,C){return new Mr(u,m)}}class qr{constructor(u,m,C,P,Q,V){this.expression=u,this.type=m,this.useIntegerZoom=C,this.zoom=P,this.layerId=V,this.zoomInPaintVertexArray=new Q,this.zoomOutPaintVertexArray=new Q}populatePaintArray(u,m,C){const P=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(u),this.zoomOutPaintVertexArray.resize(u),this._setPaintValues(P,u,m.patterns&&m.patterns[this.layerId],C)}updatePaintArray(u,m,C,P,Q){this._setPaintValues(u,m,C.patterns&&C.patterns[this.layerId],Q)}_setPaintValues(u,m,C,P){if(!P||!C)return;const{min:Q,mid:V,max:K}=C,re=P[Q],he=P[V],h=P[K];if(re&&he&&h)for(let c=u;c<m;c++)this.zoomInPaintVertexArray.emplace(c,he.tl[0],he.tl[1],he.br[0],he.br[1],re.tl[0],re.tl[1],re.br[0],re.br[1],he.pixelRatio,re.pixelRatio),this.zoomOutPaintVertexArray.emplace(c,he.tl[0],he.tl[1],he.br[0],he.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],he.pixelRatio,h.pixelRatio)}upload(u){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=u.createVertexBuffer(this.zoomInPaintVertexArray,Rt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=u.createVertexBuffer(this.zoomOutPaintVertexArray,Rt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Wr{constructor(u,m,C){this.binders={},this._buffers=[];const P=[];for(const Q in u.paint._values){if(!C(Q))continue;const V=u.paint.get(Q);if(!(V instanceof _a&&lt(V.property.specification)))continue;const K=Kn(Q,u.type),re=V.value,he=V.property.specification.type,h=V.property.useIntegerZoom,c=V.property.specification["property-type"],f=c==="cross-faded"||c==="cross-faded-data-driven";if(re.kind==="constant")this.binders[Q]=f?new _r(re.value,K):new pr(re.value,K,he),P.push(`/u_${Q}`);else if(re.kind==="source"||f){const v=_l(Q,he,"source");this.binders[Q]=f?new qr(re,he,h,m,v,u.id):new or(re,K,he,v),P.push(`/a_${Q}`)}else{const v=_l(Q,he,"composite");this.binders[Q]=new ln(re,K,he,h,m,v),P.push(`/z_${Q}`)}}this.cacheKey=P.sort().join("")}getMaxValue(u){const m=this.binders[u];return m instanceof or||m instanceof ln?m.maxValue:0}populatePaintArrays(u,m,C,P,Q){for(const V in this.binders){const K=this.binders[V];(K instanceof or||K instanceof ln||K instanceof qr)&&K.populatePaintArray(u,m,C,P,Q)}}setConstantPatternPositions(u,m){for(const C in this.binders){const P=this.binders[C];P instanceof _r&&P.setConstantPatternPositions(u,m)}}updatePaintArrays(u,m,C,P,Q){let V=!1;for(const K in u){const re=m.getPositions(K);for(const he of re){const h=C.feature(he.index);for(const c in this.binders){const f=this.binders[c];if((f instanceof or||f instanceof ln||f instanceof qr)&&f.expression.isStateDependent===!0){const v=P.paint.get(c);f.expression=v.value,f.updatePaintArray(he.start,he.end,h,u[K],Q),V=!0}}}}return V}defines(){const u=[];for(const m in this.binders){const C=this.binders[m];(C instanceof pr||C instanceof _r)&&u.push(...C.uniformNames.map(P=>`#define HAS_UNIFORM_${P}`))}return u}getBinderAttributes(){const u=[];for(const m in this.binders){const C=this.binders[m];if(C instanceof or||C instanceof ln)for(let P=0;P<C.paintVertexAttributes.length;P++)u.push(C.paintVertexAttributes[P].name);else if(C instanceof qr)for(let P=0;P<Rt.members.length;P++)u.push(Rt.members[P].name)}return u}getBinderUniforms(){const u=[];for(const m in this.binders){const C=this.binders[m];if(C instanceof pr||C instanceof _r||C instanceof ln)for(const P of C.uniformNames)u.push(P)}return u}getPaintVertexBuffers(){return this._buffers}getUniforms(u,m){const C=[];for(const P in this.binders){const Q=this.binders[P];if(Q instanceof pr||Q instanceof _r||Q instanceof ln){for(const V of Q.uniformNames)if(m[V]){const K=Q.getBinding(u,m[V],V);C.push({name:V,property:P,binding:K})}}}return C}setUniforms(u,m,C,P){for(const{name:Q,property:V,binding:K}of m)this.binders[V].setUniform(K,P,C.get(V),Q)}updatePaintBuffers(u){this._buffers=[];for(const m in this.binders){const C=this.binders[m];if(u&&C instanceof qr){const P=u.fromScale===2?C.zoomInPaintVertexBuffer:C.zoomOutPaintVertexBuffer;P&&this._buffers.push(P)}else(C instanceof or||C instanceof ln)&&C.paintVertexBuffer&&this._buffers.push(C.paintVertexBuffer)}}upload(u){for(const m in this.binders){const C=this.binders[m];(C instanceof or||C instanceof ln||C instanceof qr)&&C.upload(u)}this.updatePaintBuffers()}destroy(){for(const u in this.binders){const m=this.binders[u];(m instanceof or||m instanceof ln||m instanceof qr)&&m.destroy()}}}class Mn{constructor(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const P of u)this.programConfigurations[P.id]=new Wr(P,m,C);this.needsUpload=!1,this._featureMap=new yr,this._bufferOffset=0}populatePaintArrays(u,m,C,P,Q,V){for(const K in this.programConfigurations)this.programConfigurations[K].populatePaintArrays(u,m,P,Q,V);m.id!==void 0&&this._featureMap.add(m.id,C,this._bufferOffset,u),this._bufferOffset=u,this.needsUpload=!0}updatePaintArrays(u,m,C,P){for(const Q of C)this.needsUpload=this.programConfigurations[Q.id].updatePaintArrays(u,this._featureMap,m,Q,P)||this.needsUpload}get(u){return this.programConfigurations[u]}upload(u){if(this.needsUpload){for(const m in this.programConfigurations)this.programConfigurations[m].upload(u);this.needsUpload=!1}}destroy(){for(const u in this.programConfigurations)this.programConfigurations[u].destroy()}}function Kn(p,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[p]||[p.replace(`${u}-`,"").replace(/-/g,"_")]}function _l(p,u,m){const C={color:{source:ks,composite:O},number:{source:Gr,composite:ks}},P=function(Q){return{"line-pattern":{source:fe,composite:fe},"fill-pattern":{source:fe,composite:fe},"fill-extrusion-pattern":{source:fe,composite:fe}}[Q]}(p);return P&&P[m]||C[u][m]}Pi("ConstantBinder",pr),Pi("CrossFadedConstantBinder",_r),Pi("SourceExpressionBinder",or),Pi("CrossFadedCompositeBinder",qr),Pi("CompositeExpressionBinder",ln),Pi("ProgramConfiguration",Wr,{omit:["_buffers"]}),Pi("ProgramConfigurationSet",Mn);const $r=8192,_n=Math.pow(2,14)-1,ea=-_n-1;function Os(p){const u=$r/p.extent,m=p.loadGeometry();for(let C=0;C<m.length;C++){const P=m[C];for(let Q=0;Q<P.length;Q++){const V=P[Q],K=Math.round(V.x*u),re=Math.round(V.y*u);V.x=He(K,ea,_n),V.y=He(re,ea,_n),(K<V.x||K>V.x+1||re<V.y||re>V.y+1)&&Ze("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return m}function Ws(p,u){return{type:p.type,id:p.id,properties:p.properties,geometry:u?Os(p):[]}}function Oo(p,u,m,C,P){p.emplaceBack(2*u+(C+1)/2,2*m+(P+1)/2)}class oo{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new Z,this.indexArray=new Ke,this.segments=new bt,this.programConfigurations=new Mn(u.layers,u.zoom),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){const P=this.layers[0],Q=[];let V=null,K=!1;P.type==="circle"&&(V=P.layout.get("circle-sort-key"),K=!V.isConstant());for(const{feature:re,id:he,index:h,sourceLayerIndex:c}of u){const f=this.layers[0]._featureFilter.needGeometry,v=Ws(re,f);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),v,C))continue;const E=K?V.evaluate(v,{},C):void 0,M={id:he,properties:re.properties,type:re.type,sourceLayerIndex:c,index:h,geometry:f?v.geometry:Os(re),patterns:{},sortKey:E};Q.push(M)}K&&Q.sort((re,he)=>re.sortKey-he.sortKey);for(const re of Q){const{geometry:he,index:h,sourceLayerIndex:c}=re,f=u[h].feature;this.addFeature(re,he,h,C),m.featureIndex.insert(f,he,h,c,this.index)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,pt),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(u,m,C,P){for(const Q of m)for(const V of Q){const K=V.x,re=V.y;if(K<0||K>=$r||re<0||re>=$r)continue;const he=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,u.sortKey),h=he.vertexLength;Oo(this.layoutVertexArray,K,re,-1,-1),Oo(this.layoutVertexArray,K,re,1,-1),Oo(this.layoutVertexArray,K,re,1,1),Oo(this.layoutVertexArray,K,re,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),he.vertexLength+=4,he.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,{},P)}}function Nu(p,u){for(let m=0;m<p.length;m++)if(Gc(u,p[m]))return!0;for(let m=0;m<u.length;m++)if(Gc(p,u[m]))return!0;return!!fu(p,u)}function Ra(p,u,m){return!!Gc(p,u)||!!Hc(u,p,m)}function In(p,u){if(p.length===1)return nA(u,p[0]);for(let m=0;m<u.length;m++){const C=u[m];for(let P=0;P<C.length;P++)if(Gc(p,C[P]))return!0}for(let m=0;m<p.length;m++)if(nA(u,p[m]))return!0;for(let m=0;m<u.length;m++)if(fu(p,u[m]))return!0;return!1}function mc(p,u,m){if(p.length>1){if(fu(p,u))return!0;for(let C=0;C<u.length;C++)if(Hc(u[C],p,m))return!0}for(let C=0;C<p.length;C++)if(Hc(p[C],u,m))return!0;return!1}function fu(p,u){if(p.length===0||u.length===0)return!1;for(let m=0;m<p.length-1;m++){const C=p[m],P=p[m+1];for(let Q=0;Q<u.length-1;Q++)if(Vc(C,P,u[Q],u[Q+1]))return!0}return!1}function Vc(p,u,m,C){return We(p,m,C)!==We(u,m,C)&&We(p,u,m)!==We(p,u,C)}function Hc(p,u,m){const C=m*m;if(u.length===1)return p.distSqr(u[0])<C;for(let P=1;P<u.length;P++)if(zu(p,u[P-1],u[P])<C)return!0;return!1}function zu(p,u,m){const C=u.distSqr(m);if(C===0)return p.distSqr(u);const P=((p.x-u.x)*(m.x-u.x)+(p.y-u.y)*(m.y-u.y))/C;return p.distSqr(P<0?u:P>1?m:m.sub(u)._mult(P)._add(u))}function nA(p,u){let m,C,P,Q=!1;for(let V=0;V<p.length;V++){m=p[V];for(let K=0,re=m.length-1;K<m.length;re=K++)C=m[K],P=m[re],C.y>u.y!=P.y>u.y&&u.x<(P.x-C.x)*(u.y-C.y)/(P.y-C.y)+C.x&&(Q=!Q)}return Q}function Gc(p,u){let m=!1;for(let C=0,P=p.length-1;C<p.length;P=C++){const Q=p[C],V=p[P];Q.y>u.y!=V.y>u.y&&u.x<(V.x-Q.x)*(u.y-Q.y)/(V.y-Q.y)+Q.x&&(m=!m)}return m}function GA(p,u,m){const C=m[0],P=m[2];if(p.x<C.x&&u.x<C.x||p.x>P.x&&u.x>P.x||p.y<C.y&&u.y<C.y||p.y>P.y&&u.y>P.y)return!1;const Q=We(p,u,m[0]);return Q!==We(p,u,m[1])||Q!==We(p,u,m[2])||Q!==We(p,u,m[3])}function sA(p,u,m){const C=u.paint.get(p).value;return C.kind==="constant"?C.value:m.programConfigurations.get(u.id).getMaxValue(p)}function Rd(p){return Math.sqrt(p[0]*p[0]+p[1]*p[1])}function Qu(p,u,m,C,P){if(!u[0]&&!u[1])return p;const Q=F.convert(u)._mult(P);m==="viewport"&&Q._rotate(-C);const V=[];for(let K=0;K<p.length;K++)V.push(p[K].sub(Q));return V}let pu,kd;Pi("CircleBucket",oo,{omit:["layers"]});var um={get paint(){return kd=kd||new Es({"circle-radius":new sr(xt.paint_circle["circle-radius"]),"circle-color":new sr(xt.paint_circle["circle-color"]),"circle-blur":new sr(xt.paint_circle["circle-blur"]),"circle-opacity":new sr(xt.paint_circle["circle-opacity"]),"circle-translate":new bi(xt.paint_circle["circle-translate"]),"circle-translate-anchor":new bi(xt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bi(xt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bi(xt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new sr(xt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new sr(xt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new sr(xt.paint_circle["circle-stroke-opacity"])})},get layout(){return pu=pu||new Es({"circle-sort-key":new sr(xt.layout_circle["circle-sort-key"])})}},ta=1e-6,Yl=typeof Float32Array<"u"?Float32Array:Array;function oA(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function xh(p,u,m){var C=u[0],P=u[1],Q=u[2],V=u[3],K=u[4],re=u[5],he=u[6],h=u[7],c=u[8],f=u[9],v=u[10],E=u[11],M=u[12],D=u[13],G=u[14],$=u[15],X=m[0],se=m[1],Ae=m[2],me=m[3];return p[0]=X*C+se*K+Ae*c+me*M,p[1]=X*P+se*re+Ae*f+me*D,p[2]=X*Q+se*he+Ae*v+me*G,p[3]=X*V+se*h+Ae*E+me*$,p[4]=(X=m[4])*C+(se=m[5])*K+(Ae=m[6])*c+(me=m[7])*M,p[5]=X*P+se*re+Ae*f+me*D,p[6]=X*Q+se*he+Ae*v+me*G,p[7]=X*V+se*h+Ae*E+me*$,p[8]=(X=m[8])*C+(se=m[9])*K+(Ae=m[10])*c+(me=m[11])*M,p[9]=X*P+se*re+Ae*f+me*D,p[10]=X*Q+se*he+Ae*v+me*G,p[11]=X*V+se*h+Ae*E+me*$,p[12]=(X=m[12])*C+(se=m[13])*K+(Ae=m[14])*c+(me=m[15])*M,p[13]=X*P+se*re+Ae*f+me*D,p[14]=X*Q+se*he+Ae*v+me*G,p[15]=X*V+se*h+Ae*E+me*$,p}Math.hypot||(Math.hypot=function(){for(var p=0,u=arguments.length;u--;)p+=arguments[u]*arguments[u];return Math.sqrt(p)});var gu,wh=xh;function Bh(p,u,m){var C=u[0],P=u[1],Q=u[2],V=u[3];return p[0]=m[0]*C+m[4]*P+m[8]*Q+m[12]*V,p[1]=m[1]*C+m[5]*P+m[9]*Q+m[13]*V,p[2]=m[2]*C+m[6]*P+m[10]*Q+m[14]*V,p[3]=m[3]*C+m[7]*P+m[11]*Q+m[15]*V,p}gu=new Yl(4),Yl!=Float32Array&&(gu[0]=0,gu[1]=0,gu[2]=0,gu[3]=0);class aA extends qn{constructor(u){super(u,um)}createBucket(u){return new oo(u)}queryRadius(u){const m=u;return sA("circle-radius",this,m)+sA("circle-stroke-width",this,m)+Rd(this.paint.get("circle-translate"))}queryIntersectsFeature(u,m,C,P,Q,V,K,re){const he=Qu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),V.angle,K),h=this.paint.get("circle-radius").evaluate(m,C)+this.paint.get("circle-stroke-width").evaluate(m,C),c=this.paint.get("circle-pitch-alignment")==="map",f=c?he:function(E,M){return E.map(D=>Jf(D,M))}(he,re),v=c?h*K:h;for(const E of P)for(const M of E){const D=c?M:Jf(M,re);let G=v;const $=Bh([],[M.x,M.y,0,1],re);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?G*=$[3]/V.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(G*=V.cameraToCenterDistance/$[3]),Ra(f,D,G))return!0}return!1}}function Jf(p,u){const m=Bh([],[p.x,p.y,0,1],u);return new F(m[0]/m[3],m[1]/m[3])}class ia extends oo{}let jc;Pi("HeatmapBucket",ia,{omit:["layers"]});var Od={get paint(){return jc=jc||new Es({"heatmap-radius":new sr(xt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new sr(xt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bi(xt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Qc(xt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bi(xt.paint_heatmap["heatmap-opacity"])})}};function lA(p,u,m,C){let{width:P,height:Q}=u;if(C){if(C instanceof Uint8ClampedArray)C=new Uint8Array(C.buffer);else if(C.length!==P*Q*m)throw new RangeError(`mismatched image size. expected: ${C.length} but got: ${P*Q*m}`)}else C=new Uint8Array(P*Q*m);return p.width=P,p.height=Q,p.data=C,p}function vl(p,u,m){let{width:C,height:P}=u;if(C===p.width&&P===p.height)return;const Q=lA({},{width:C,height:P},m);Ud(p,Q,{x:0,y:0},{x:0,y:0},{width:Math.min(p.width,C),height:Math.min(p.height,P)},m),p.width=C,p.height=P,p.data=Q.data}function Ud(p,u,m,C,P,Q){if(P.width===0||P.height===0)return u;if(P.width>p.width||P.height>p.height||m.x>p.width-P.width||m.y>p.height-P.height)throw new RangeError("out of range source coordinates for image copy");if(P.width>u.width||P.height>u.height||C.x>u.width-P.width||C.y>u.height-P.height)throw new RangeError("out of range destination coordinates for image copy");const V=p.data,K=u.data;if(V===K)throw new Error("srcData equals dstData, so image is already copied");for(let re=0;re<P.height;re++){const he=((m.y+re)*p.width+m.x)*Q,h=((C.y+re)*u.width+C.x)*Q;for(let c=0;c<P.width*Q;c++)K[h+c]=V[he+c]}return u}class mu{constructor(u,m){lA(this,u,1,m)}resize(u){vl(this,u,1)}clone(){return new mu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,m,C,P,Q){Ud(u,m,C,P,Q,1)}}class bl{constructor(u,m){lA(this,u,4,m)}resize(u){vl(this,u,4)}replace(u,m){m?this.data.set(u):this.data=u instanceof Uint8ClampedArray?new Uint8Array(u.buffer):u}clone(){return new bl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,m,C,P,Q){Ud(u,m,C,P,Q,4)}}function Nd(p){const u={},m=p.resolution||256,C=p.clips?p.clips.length:1,P=p.image||new bl({width:m,height:C});if(Math.log(m)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${m}`);const Q=(V,K,re)=>{u[p.evaluationKey]=re;const he=p.expression.evaluate(u);P.data[V+K+0]=Math.floor(255*he.r/he.a),P.data[V+K+1]=Math.floor(255*he.g/he.a),P.data[V+K+2]=Math.floor(255*he.b/he.a),P.data[V+K+3]=Math.floor(255*he.a)};if(p.clips)for(let V=0,K=0;V<C;++V,K+=4*m)for(let re=0,he=0;re<m;re++,he+=4){const h=re/(m-1),{start:c,end:f}=p.clips[V];Q(K,he,c*(1-h)+f*h)}else for(let V=0,K=0;V<m;V++,K+=4)Q(0,K,V/(m-1));return P}Pi("AlphaImage",mu),Pi("RGBAImage",bl);class Ch extends qn{createBucket(u){return new ia(u)}constructor(u){super(u,Od),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Nd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Yf;var hm={get paint(){return Yf=Yf||new Es({"hillshade-illumination-direction":new bi(xt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bi(xt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bi(xt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bi(xt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bi(xt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bi(xt.paint_hillshade["hillshade-accent-color"])})}};class ep extends qn{constructor(u){super(u,hm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const tp=$n([{name:"a_pos",components:2,type:"Int16"}],4),{members:ip}=tp;var yc={exports:{}};function Uo(p,u,m){m=m||2;var C,P,Q,V,K,re,he,h=u&&u.length,c=h?u[0]*m:p.length,f=cA(p,0,c,m,!0),v=[];if(!f||f.next===f.prev)return v;if(h&&(f=function(M,D,G,$){var X,se,Ae,me=[];for(X=0,se=D.length;X<se;X++)(Ae=cA(M,D[X]*$,X<se-1?D[X+1]*$:M.length,$,!1))===Ae.next&&(Ae.steiner=!0),me.push(sp(Ae));for(me.sort(np),X=0;X<me.length;X++)G=uA(me[X],G);return G}(p,u,f,m)),p.length>80*m){C=Q=p[0],P=V=p[1];for(var E=m;E<c;E+=m)(K=p[E])<C&&(C=K),(re=p[E+1])<P&&(P=re),K>Q&&(Q=K),re>V&&(V=re);he=(he=Math.max(Q-C,V-P))!==0?32767/he:0}return xl(f,v,m,C,P,he,0),v}function cA(p,u,m,C,P){var Q,V;if(P===Hd(p,u,m,C)>0)for(Q=u;Q<m;Q+=C)V=qA(Q,p[Q],p[Q+1],V);else for(Q=m-C;Q>=u;Q-=C)V=qA(Q,p[Q],p[Q+1],V);return V&&dm(V,V.next)&&(op(V),V=V.next),V}function ka(p,u){if(!p)return p;u||(u=p);var m,C=p;do if(m=!1,C.steiner||!dm(C,C.next)&&Xs(C.prev,C,C.next)!==0)C=C.next;else{if(op(C),(C=u=C.prev)===C.next)break;m=!0}while(m||C!==u);return u}function xl(p,u,m,C,P,Q,V){if(p){!V&&Q&&function(h,c,f,v){var E=h;do E.z===0&&(E.z=Eh(E.x,E.y,c,f,v)),E.prevZ=E.prev,E.nextZ=E.next,E=E.next;while(E!==h);E.prevZ.nextZ=null,E.prevZ=null,function(M){var D,G,$,X,se,Ae,me,Be,Te=1;do{for(G=M,M=null,se=null,Ae=0;G;){for(Ae++,$=G,me=0,D=0;D<Te&&(me++,$=$.nextZ);D++);for(Be=Te;me>0||Be>0&&$;)me!==0&&(Be===0||!$||G.z<=$.z)?(X=G,G=G.nextZ,me--):(X=$,$=$.nextZ,Be--),se?se.nextZ=X:M=X,X.prevZ=se,se=X;G=$}se.nextZ=null,Te*=2}while(Ae>1)}(E)}(p,C,P,Q);for(var K,re,he=p;p.prev!==p.next;)if(K=p.prev,re=p.next,Q?zd(p,C,P,Q):Vu(p))u.push(K.i/m|0),u.push(p.i/m|0),u.push(re.i/m|0),op(p),p=re.next,he=re.next;else if((p=re)===he){V?V===1?xl(p=rp(ka(p),u,m),u,m,C,P,Q,2):V===2&&Am(p,u,m,C,P,Q):xl(ka(p),u,m,C,P,Q,1);break}}}function Vu(p){var u=p.prev,m=p,C=p.next;if(Xs(u,m,C)>=0)return!1;for(var P=u.x,Q=m.x,V=C.x,K=u.y,re=m.y,he=C.y,h=P<Q?P<V?P:V:Q<V?Q:V,c=K<re?K<he?K:he:re<he?re:he,f=P>Q?P>V?P:V:Q>V?Q:V,v=K>re?K>he?K:he:re>he?re:he,E=C.next;E!==u;){if(E.x>=h&&E.x<=f&&E.y>=c&&E.y<=v&&Vd(P,K,Q,re,V,he,E.x,E.y)&&Xs(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function zd(p,u,m,C){var P=p.prev,Q=p,V=p.next;if(Xs(P,Q,V)>=0)return!1;for(var K=P.x,re=Q.x,he=V.x,h=P.y,c=Q.y,f=V.y,v=K<re?K<he?K:he:re<he?re:he,E=h<c?h<f?h:f:c<f?c:f,M=K>re?K>he?K:he:re>he?re:he,D=h>c?h>f?h:f:c>f?c:f,G=Eh(v,E,u,m,C),$=Eh(M,D,u,m,C),X=p.prevZ,se=p.nextZ;X&&X.z>=G&&se&&se.z<=$;){if(X.x>=v&&X.x<=M&&X.y>=E&&X.y<=D&&X!==P&&X!==V&&Vd(K,h,re,c,he,f,X.x,X.y)&&Xs(X.prev,X,X.next)>=0||(X=X.prevZ,se.x>=v&&se.x<=M&&se.y>=E&&se.y<=D&&se!==P&&se!==V&&Vd(K,h,re,c,he,f,se.x,se.y)&&Xs(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;X&&X.z>=G;){if(X.x>=v&&X.x<=M&&X.y>=E&&X.y<=D&&X!==P&&X!==V&&Vd(K,h,re,c,he,f,X.x,X.y)&&Xs(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;se&&se.z<=$;){if(se.x>=v&&se.x<=M&&se.y>=E&&se.y<=D&&se!==P&&se!==V&&Vd(K,h,re,c,he,f,se.x,se.y)&&Xs(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function rp(p,u,m){var C=p;do{var P=C.prev,Q=C.next.next;!dm(P,Q)&&nx(P,C,C.next,Q)&&jA(P,Q)&&jA(Q,P)&&(u.push(P.i/m|0),u.push(C.i/m|0),u.push(Q.i/m|0),op(C),op(C.next),C=p=Q),C=C.next}while(C!==p);return ka(C)}function Am(p,u,m,C,P,Q){var V=p;do{for(var K=V.next.next;K!==V.prev;){if(V.i!==K.i&&hI(V,K)){var re=sx(V,K);return V=ka(V,V.next),re=ka(re,re.next),xl(V,u,m,C,P,Q,0),void xl(re,u,m,C,P,Q,0)}K=K.next}V=V.next}while(V!==p)}function np(p,u){return p.x-u.x}function uA(p,u){var m=function(P,Q){var V,K=Q,re=P.x,he=P.y,h=-1/0;do{if(he<=K.y&&he>=K.next.y&&K.next.y!==K.y){var c=K.x+(he-K.y)*(K.next.x-K.x)/(K.next.y-K.y);if(c<=re&&c>h&&(h=c,V=K.x<K.next.x?K:K.next,c===re))return V}K=K.next}while(K!==Q);if(!V)return null;var f,v=V,E=V.x,M=V.y,D=1/0;K=V;do re>=K.x&&K.x>=E&&re!==K.x&&Vd(he<M?re:h,he,E,M,he<M?h:re,he,K.x,K.y)&&(f=Math.abs(he-K.y)/(re-K.x),jA(K,P)&&(f<D||f===D&&(K.x>V.x||K.x===V.x&&Qd(V,K)))&&(V=K,D=f)),K=K.next;while(K!==v);return V}(p,u);if(!m)return u;var C=sx(m,p);return ka(C,C.next),ka(m,m.next)}function Qd(p,u){return Xs(p.prev,p,u.prev)<0&&Xs(u.next,p,p.next)<0}function Eh(p,u,m,C,P){return(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p=(p-m)*P|0)|p<<8))|p<<4))|p<<2))|p<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-C)*P|0)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function sp(p){var u=p,m=p;do(u.x<m.x||u.x===m.x&&u.y<m.y)&&(m=u),u=u.next;while(u!==p);return m}function Vd(p,u,m,C,P,Q,V,K){return(P-V)*(u-K)>=(p-V)*(Q-K)&&(p-V)*(C-K)>=(m-V)*(u-K)&&(m-V)*(Q-K)>=(P-V)*(C-K)}function hI(p,u){return p.next.i!==u.i&&p.prev.i!==u.i&&!function(m,C){var P=m;do{if(P.i!==m.i&&P.next.i!==m.i&&P.i!==C.i&&P.next.i!==C.i&&nx(P,P.next,m,C))return!0;P=P.next}while(P!==m);return!1}(p,u)&&(jA(p,u)&&jA(u,p)&&function(m,C){var P=m,Q=!1,V=(m.x+C.x)/2,K=(m.y+C.y)/2;do P.y>K!=P.next.y>K&&P.next.y!==P.y&&V<(P.next.x-P.x)*(K-P.y)/(P.next.y-P.y)+P.x&&(Q=!Q),P=P.next;while(P!==m);return Q}(p,u)&&(Xs(p.prev,p,u.prev)||Xs(p,u.prev,u))||dm(p,u)&&Xs(p.prev,p,p.next)>0&&Xs(u.prev,u,u.next)>0)}function Xs(p,u,m){return(u.y-p.y)*(m.x-u.x)-(u.x-p.x)*(m.y-u.y)}function dm(p,u){return p.x===u.x&&p.y===u.y}function nx(p,u,m,C){var P=pm(Xs(p,u,m)),Q=pm(Xs(p,u,C)),V=pm(Xs(m,C,p)),K=pm(Xs(m,C,u));return P!==Q&&V!==K||!(P!==0||!fm(p,m,u))||!(Q!==0||!fm(p,C,u))||!(V!==0||!fm(m,p,C))||!(K!==0||!fm(m,u,C))}function fm(p,u,m){return u.x<=Math.max(p.x,m.x)&&u.x>=Math.min(p.x,m.x)&&u.y<=Math.max(p.y,m.y)&&u.y>=Math.min(p.y,m.y)}function pm(p){return p>0?1:p<0?-1:0}function jA(p,u){return Xs(p.prev,p,p.next)<0?Xs(p,u,p.next)>=0&&Xs(p,p.prev,u)>=0:Xs(p,u,p.prev)<0||Xs(p,p.next,u)<0}function sx(p,u){var m=new Us(p.i,p.x,p.y),C=new Us(u.i,u.x,u.y),P=p.next,Q=u.prev;return p.next=u,u.prev=p,m.next=P,P.prev=m,C.next=m,m.prev=C,Q.next=C,C.prev=Q,C}function qA(p,u,m,C){var P=new Us(p,u,m);return C?(P.next=C.next,P.prev=C,C.next.prev=P,C.next=P):(P.prev=P,P.next=P),P}function op(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Us(p,u,m){this.i=p,this.x=u,this.y=m,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Hd(p,u,m,C){for(var P=0,Q=u,V=m-C;Q<m;Q+=C)P+=(p[V]-p[Q])*(p[Q+1]+p[V+1]),V=Q;return P}yc.exports=Uo,yc.exports.default=Uo,Uo.deviation=function(p,u,m,C){var P=u&&u.length,Q=Math.abs(Hd(p,0,P?u[0]*m:p.length,m));if(P)for(var V=0,K=u.length;V<K;V++)Q-=Math.abs(Hd(p,u[V]*m,V<K-1?u[V+1]*m:p.length,m));var re=0;for(V=0;V<C.length;V+=3){var he=C[V]*m,h=C[V+1]*m,c=C[V+2]*m;re+=Math.abs((p[he]-p[c])*(p[h+1]-p[he+1])-(p[he]-p[h])*(p[c+1]-p[he+1]))}return Q===0&&re===0?0:Math.abs((re-Q)/Q)},Uo.flatten=function(p){for(var u=p[0][0].length,m={vertices:[],holes:[],dimensions:u},C=0,P=0;P<p.length;P++){for(var Q=0;Q<p[P].length;Q++)for(var V=0;V<u;V++)m.vertices.push(p[P][Q][V]);P>0&&m.holes.push(C+=p[P-1].length)}return m};var R0=g(yc.exports);function gm(p,u,m,C,P){ap(p,u,m||0,C||p.length-1,P||ox)}function ap(p,u,m,C,P){for(;C>m;){if(C-m>600){var Q=C-m+1,V=u-m+1,K=Math.log(Q),re=.5*Math.exp(2*K/3),he=.5*Math.sqrt(K*re*(Q-re)/Q)*(V-Q/2<0?-1:1);ap(p,u,Math.max(m,Math.floor(u-V*re/Q+he)),Math.min(C,Math.floor(u+(Q-V)*re/Q+he)),P)}var h=p[u],c=m,f=C;for(Sh(p,m,u),P(p[C],h)>0&&Sh(p,m,C);c<f;){for(Sh(p,c,f),c++,f--;P(p[c],h)<0;)c++;for(;P(p[f],h)>0;)f--}P(p[m],h)===0?Sh(p,m,f):Sh(p,++f,C),f<=u&&(m=f+1),u<=f&&(C=f-1)}}function Sh(p,u,m){var C=p[u];p[u]=p[m],p[m]=C}function ox(p,u){return p<u?-1:p>u?1:0}function mm(p,u){const m=p.length;if(m<=1)return[p];const C=[];let P,Q;for(let V=0;V<m;V++){const K=Bt(p[V]);K!==0&&(p[V].area=Math.abs(K),Q===void 0&&(Q=K<0),Q===K<0?(P&&C.push(P),P=[p[V]]):P.push(p[V]))}if(P&&C.push(P),u>1)for(let V=0;V<C.length;V++)C[V].length<=u||(gm(C[V],u,1,C[V].length-1,lp),C[V]=C[V].slice(0,u));return C}function lp(p,u){return u.area-p.area}function cp(p,u,m){const C=m.patternDependencies;let P=!1;for(const Q of u){const V=Q.paint.get(`${p}-pattern`);V.isConstant()||(P=!0);const K=V.constantOr(null);K&&(P=!0,C[K.to]=!0,C[K.from]=!0)}return P}function up(p,u,m,C,P){const Q=P.patternDependencies;for(const V of u){const K=V.paint.get(`${p}-pattern`).value;if(K.kind!=="constant"){let re=K.evaluate({zoom:C-1},m,{},P.availableImages),he=K.evaluate({zoom:C},m,{},P.availableImages),h=K.evaluate({zoom:C+1},m,{},P.availableImages);re=re&&re.name?re.name:re,he=he&&he.name?he.name:he,h=h&&h.name?h.name:h,Q[re]=!0,Q[he]=!0,Q[h]=!0,m.patterns[V.id]={min:re,mid:he,max:h}}}return m}class ym{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new W,this.indexArray=new Ke,this.indexArray2=new Re,this.programConfigurations=new Mn(u.layers,u.zoom),this.segments=new bt,this.segments2=new bt,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){this.hasPattern=cp("fill",this.layers,m);const P=this.layers[0].layout.get("fill-sort-key"),Q=!P.isConstant(),V=[];for(const{feature:K,id:re,index:he,sourceLayerIndex:h}of u){const c=this.layers[0]._featureFilter.needGeometry,f=Ws(K,c);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),f,C))continue;const v=Q?P.evaluate(f,{},C,m.availableImages):void 0,E={id:re,properties:K.properties,type:K.type,sourceLayerIndex:h,index:he,geometry:c?f.geometry:Os(K),patterns:{},sortKey:v};V.push(E)}Q&&V.sort((K,re)=>K.sortKey-re.sortKey);for(const K of V){const{geometry:re,index:he,sourceLayerIndex:h}=K;if(this.hasPattern){const c=up("fill",this.layers,K,this.zoom,m);this.patternFeatures.push(c)}else this.addFeature(K,re,he,C,{});m.featureIndex.insert(u[he].feature,re,he,h,this.index)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}addFeatures(u,m,C){for(const P of this.patternFeatures)this.addFeature(P,P.geometry,P.index,m,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,ip),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.indexBuffer2=u.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(u,m,C,P,Q){for(const V of mm(m,500)){let K=0;for(const v of V)K+=v.length;const re=this.segments.prepareSegment(K,this.layoutVertexArray,this.indexArray),he=re.vertexLength,h=[],c=[];for(const v of V){if(v.length===0)continue;v!==V[0]&&c.push(h.length/2);const E=this.segments2.prepareSegment(v.length,this.layoutVertexArray,this.indexArray2),M=E.vertexLength;this.layoutVertexArray.emplaceBack(v[0].x,v[0].y),this.indexArray2.emplaceBack(M+v.length-1,M),h.push(v[0].x),h.push(v[0].y);for(let D=1;D<v.length;D++)this.layoutVertexArray.emplaceBack(v[D].x,v[D].y),this.indexArray2.emplaceBack(M+D-1,M+D),h.push(v[D].x),h.push(v[D].y);E.vertexLength+=v.length,E.primitiveLength+=v.length}const f=R0(h,c);for(let v=0;v<f.length;v+=3)this.indexArray.emplaceBack(he+f[v],he+f[v+1],he+f[v+2]);re.vertexLength+=K,re.primitiveLength+=f.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,P)}}let ax,k0;Pi("FillBucket",ym,{omit:["layers","patternFeatures"]});var hp={get paint(){return k0=k0||new Es({"fill-antialias":new bi(xt.paint_fill["fill-antialias"]),"fill-opacity":new sr(xt.paint_fill["fill-opacity"]),"fill-color":new sr(xt.paint_fill["fill-color"]),"fill-outline-color":new sr(xt.paint_fill["fill-outline-color"]),"fill-translate":new bi(xt.paint_fill["fill-translate"]),"fill-translate-anchor":new bi(xt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Zl(xt.paint_fill["fill-pattern"])})},get layout(){return ax=ax||new Es({"fill-sort-key":new sr(xt.layout_fill["fill-sort-key"])})}};class AI extends qn{constructor(u){super(u,hp)}recalculate(u,m){super.recalculate(u,m);const C=this.paint._values["fill-outline-color"];C.value.kind==="constant"&&C.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new ym(u)}queryRadius(){return Rd(this.paint.get("fill-translate"))}queryIntersectsFeature(u,m,C,P,Q,V,K){return In(Qu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),V.angle,K),P)}isTileClipped(){return!0}}const O0=$n([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),dI=$n([{name:"a_centroid",components:2,type:"Int16"}],4),{members:U0}=O0;var Hu={},N0=b,z0=$A;function $A(p,u,m,C,P){this.properties={},this.extent=m,this.type=0,this._pbf=p,this._geometry=-1,this._keys=C,this._values=P,p.readFields(fI,this,u)}function fI(p,u,m){p==1?u.id=m.readVarint():p==2?function(C,P){for(var Q=C.readVarint()+C.pos;C.pos<Q;){var V=P._keys[C.readVarint()],K=P._values[C.readVarint()];P.properties[V]=K}}(m,u):p==3?u.type=m.readVarint():p==4&&(u._geometry=m.pos)}function pI(p){for(var u,m,C=0,P=0,Q=p.length,V=Q-1;P<Q;V=P++)C+=((m=p[V]).x-(u=p[P]).x)*(u.y+m.y);return C}$A.types=["Unknown","Point","LineString","Polygon"],$A.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var u,m=p.readVarint()+p.pos,C=1,P=0,Q=0,V=0,K=[];p.pos<m;){if(P<=0){var re=p.readVarint();C=7&re,P=re>>3}if(P--,C===1||C===2)Q+=p.readSVarint(),V+=p.readSVarint(),C===1&&(u&&K.push(u),u=[]),u.push(new N0(Q,V));else{if(C!==7)throw new Error("unknown command "+C);u&&u.push(u[0].clone())}}return u&&K.push(u),K},$A.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var u=p.readVarint()+p.pos,m=1,C=0,P=0,Q=0,V=1/0,K=-1/0,re=1/0,he=-1/0;p.pos<u;){if(C<=0){var h=p.readVarint();m=7&h,C=h>>3}if(C--,m===1||m===2)(P+=p.readSVarint())<V&&(V=P),P>K&&(K=P),(Q+=p.readSVarint())<re&&(re=Q),Q>he&&(he=Q);else if(m!==7)throw new Error("unknown command "+m)}return[V,re,K,he]},$A.prototype.toGeoJSON=function(p,u,m){var C,P,Q=this.extent*Math.pow(2,m),V=this.extent*p,K=this.extent*u,re=this.loadGeometry(),he=$A.types[this.type];function h(v){for(var E=0;E<v.length;E++){var M=v[E];v[E]=[360*(M.x+V)/Q-180,360/Math.PI*Math.atan(Math.exp((180-360*(M.y+K)/Q)*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(C=0;C<re.length;C++)c[C]=re[C][0];h(re=c);break;case 2:for(C=0;C<re.length;C++)h(re[C]);break;case 3:for(re=function(v){var E=v.length;if(E<=1)return[v];for(var M,D,G=[],$=0;$<E;$++){var X=pI(v[$]);X!==0&&(D===void 0&&(D=X<0),D===X<0?(M&&G.push(M),M=[v[$]]):M.push(v[$]))}return M&&G.push(M),G}(re),C=0;C<re.length;C++)for(P=0;P<re[C].length;P++)h(re[C][P])}re.length===1?re=re[0]:he="Multi"+he;var f={type:"Feature",geometry:{type:he,coordinates:re},properties:this.properties};return"id"in this&&(f.id=this.id),f};var gI=z0,lx=cx;function cx(p,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=p,this._keys=[],this._values=[],this._features=[],p.readFields(hA,this,u),this.length=this._features.length}function hA(p,u,m){p===15?u.version=m.readVarint():p===1?u.name=m.readString():p===5?u.extent=m.readVarint():p===2?u._features.push(m.pos):p===3?u._keys.push(m.readString()):p===4&&u._values.push(function(C){for(var P=null,Q=C.readVarint()+C.pos;C.pos<Q;){var V=C.readVarint()>>3;P=V===1?C.readString():V===2?C.readFloat():V===3?C.readDouble():V===4?C.readVarint64():V===5?C.readVarint():V===6?C.readSVarint():V===7?C.readBoolean():null}return P}(m))}cx.prototype.feature=function(p){if(p<0||p>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[p];var u=this._pbf.readVarint()+this._pbf.pos;return new gI(this._pbf,u,this.extent,this._keys,this._values)};var mI=lx;function ux(p,u,m){if(p===3){var C=new mI(m,m.readVarint()+m.pos);C.length&&(u[C.name]=C)}}Hu.VectorTile=function(p,u){this.layers=p.readFields(ux,{},u)},Hu.VectorTileFeature=z0,Hu.VectorTileLayer=lx;const Gd=Hu.VectorTileFeature.types,Q0=Math.pow(2,13);function Ap(p,u,m,C,P,Q,V,K){p.emplaceBack(u,m,2*Math.floor(C*Q0)+V,P*Q0*2,Q*Q0*2,Math.round(K))}class V0{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new Y,this.centroidVertexArray=new j,this.indexArray=new Ke,this.programConfigurations=new Mn(u.layers,u.zoom),this.segments=new bt,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){this.features=[],this.hasPattern=cp("fill-extrusion",this.layers,m);for(const{feature:P,id:Q,index:V,sourceLayerIndex:K}of u){const re=this.layers[0]._featureFilter.needGeometry,he=Ws(P,re);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),he,C))continue;const h={id:Q,sourceLayerIndex:K,index:V,geometry:re?he.geometry:Os(P),properties:P.properties,type:P.type,patterns:{}};this.hasPattern?this.features.push(up("fill-extrusion",this.layers,h,this.zoom,m)):this.addFeature(h,h.geometry,V,C,{}),m.featureIndex.insert(P,h.geometry,V,K,this.index,!0)}}addFeatures(u,m,C){for(const P of this.features){const{geometry:Q}=P;this.addFeature(P,Q,P.index,m,C)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,U0),this.centroidVertexBuffer=u.createVertexBuffer(this.centroidVertexArray,dI.members,!0),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(u,m,C,P,Q){const V={x:0,y:0,vertexCount:0};for(const K of mm(m,500)){let re=0;for(const E of K)re+=E.length;let he=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const E of K){if(E.length===0||Ax(E))continue;let M=0;for(let D=0;D<E.length;D++){const G=E[D];if(D>=1){const $=E[D-1];if(!hx(G,$)){he.vertexLength+4>bt.MAX_VERTEX_ARRAY_LENGTH&&(he=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const X=G.sub($)._perp()._unit(),se=$.dist(G);M+se>32768&&(M=0),Ap(this.layoutVertexArray,G.x,G.y,X.x,X.y,0,0,M),Ap(this.layoutVertexArray,G.x,G.y,X.x,X.y,0,1,M),V.x+=2*G.x,V.y+=2*G.y,V.vertexCount+=2,M+=se,Ap(this.layoutVertexArray,$.x,$.y,X.x,X.y,0,0,M),Ap(this.layoutVertexArray,$.x,$.y,X.x,X.y,0,1,M),V.x+=2*$.x,V.y+=2*$.y,V.vertexCount+=2;const Ae=he.vertexLength;this.indexArray.emplaceBack(Ae,Ae+2,Ae+1),this.indexArray.emplaceBack(Ae+1,Ae+2,Ae+3),he.vertexLength+=4,he.primitiveLength+=2}}}}if(he.vertexLength+re>bt.MAX_VERTEX_ARRAY_LENGTH&&(he=this.segments.prepareSegment(re,this.layoutVertexArray,this.indexArray)),Gd[u.type]!=="Polygon")continue;const h=[],c=[],f=he.vertexLength;for(const E of K)if(E.length!==0){E!==K[0]&&c.push(h.length/2);for(let M=0;M<E.length;M++){const D=E[M];Ap(this.layoutVertexArray,D.x,D.y,0,0,1,1,0),V.x+=D.x,V.y+=D.y,V.vertexCount+=1,h.push(D.x),h.push(D.y)}}const v=R0(h,c);for(let E=0;E<v.length;E+=3)this.indexArray.emplaceBack(f+v[E],f+v[E+2],f+v[E+1]);he.primitiveLength+=v.length/3,he.vertexLength+=re}for(let K=0;K<V.vertexCount;K++)this.centroidVertexArray.emplaceBack(Math.floor(V.x/V.vertexCount),Math.floor(V.y/V.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,P)}}function hx(p,u){return p.x===u.x&&(p.x<0||p.x>$r)||p.y===u.y&&(p.y<0||p.y>$r)}function Ax(p){return p.every(u=>u.x<0)||p.every(u=>u.x>$r)||p.every(u=>u.y<0)||p.every(u=>u.y>$r)}let dx;Pi("FillExtrusionBucket",V0,{omit:["layers","features"]});var yI={get paint(){return dx=dx||new Es({"fill-extrusion-opacity":new bi(xt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new sr(xt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bi(xt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bi(xt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Zl(xt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new sr(xt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new sr(xt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bi(xt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class _I extends qn{constructor(u){super(u,yI)}createBucket(u){return new V0(u)}queryRadius(){return Rd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(u,m,C,P,Q,V,K,re){const he=Qu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),V.angle,K),h=this.paint.get("fill-extrusion-height").evaluate(m,C),c=this.paint.get("fill-extrusion-base").evaluate(m,C),f=function(E,M,D,G){const $=[];for(const X of E){const se=[X.x,X.y,0,1];Bh(se,se,M),$.push(new F(se[0]/se[3],se[1]/se[3]))}return $}(he,re),v=function(E,M,D,G){const $=[],X=[],se=G[8]*M,Ae=G[9]*M,me=G[10]*M,Be=G[11]*M,Te=G[8]*D,ke=G[9]*D,je=G[10]*D,$e=G[11]*D;for(const ct of E){const Ye=[],tt=[];for(const gt of ct){const St=gt.x,Xt=gt.y,xi=G[0]*St+G[4]*Xt+G[12],oi=G[1]*St+G[5]*Xt+G[13],Ai=G[2]*St+G[6]*Xt+G[14],fi=G[3]*St+G[7]*Xt+G[15],Fi=Ai+me,ai=fi+Be,Zt=xi+Te,Vi=oi+ke,Qi=Ai+je,gr=fi+$e,Dr=new F((xi+se)/ai,(oi+Ae)/ai);Dr.z=Fi/ai,Ye.push(Dr);const zr=new F(Zt/gr,Vi/gr);zr.z=Qi/gr,tt.push(zr)}$.push(Ye),X.push(tt)}return[$,X]}(P,c,h,re);return function(E,M,D){let G=1/0;In(D,M)&&(G=_m(D,M[0]));for(let $=0;$<M.length;$++){const X=M[$],se=E[$];for(let Ae=0;Ae<X.length-1;Ae++){const me=X[Ae],Be=[me,X[Ae+1],se[Ae+1],se[Ae],me];Nu(D,Be)&&(G=Math.min(G,_m(D,Be)))}}return G!==1/0&&G}(v[0],v[1],f)}}function dp(p,u){return p.x*u.x+p.y*u.y}function _m(p,u){if(p.length===1){let m=0;const C=u[m++];let P;for(;!P||C.equals(P);)if(P=u[m++],!P)return 1/0;for(;m<u.length;m++){const Q=u[m],V=p[0],K=P.sub(C),re=Q.sub(C),he=V.sub(C),h=dp(K,K),c=dp(K,re),f=dp(re,re),v=dp(he,K),E=dp(he,re),M=h*f-c*c,D=(f*v-c*E)/M,G=(h*E-c*v)/M,$=C.z*(1-D-G)+P.z*D+Q.z*G;if(isFinite($))return $}return 1/0}{let m=1/0;for(const C of u)m=Math.min(m,C.z);return m}}const fp=$n([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:H0}=fp,vI=$n([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:bI}=vI,fx=Hu.VectorTileFeature.types,xI=Math.cos(Math.PI/180*37.5),px=Math.pow(2,14)/.5;class KA{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(m=>{this.gradients[m.id]={}}),this.layoutVertexArray=new ie,this.layoutVertexArray2=new ae,this.indexArray=new Ke,this.programConfigurations=new Mn(u.layers,u.zoom),this.segments=new bt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){this.hasPattern=cp("line",this.layers,m);const P=this.layers[0].layout.get("line-sort-key"),Q=!P.isConstant(),V=[];for(const{feature:K,id:re,index:he,sourceLayerIndex:h}of u){const c=this.layers[0]._featureFilter.needGeometry,f=Ws(K,c);if(!this.layers[0]._featureFilter.filter(new yn(this.zoom),f,C))continue;const v=Q?P.evaluate(f,{},C):void 0,E={id:re,properties:K.properties,type:K.type,sourceLayerIndex:h,index:he,geometry:c?f.geometry:Os(K),patterns:{},sortKey:v};V.push(E)}Q&&V.sort((K,re)=>K.sortKey-re.sortKey);for(const K of V){const{geometry:re,index:he,sourceLayerIndex:h}=K;if(this.hasPattern){const c=up("line",this.layers,K,this.zoom,m);this.patternFeatures.push(c)}else this.addFeature(K,re,he,C,{});m.featureIndex.insert(u[he].feature,re,he,h,this.index)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}addFeatures(u,m,C){for(const P of this.patternFeatures)this.addFeature(P,P.geometry,P.index,m,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=u.createVertexBuffer(this.layoutVertexArray2,bI)),this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,H0),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(u){if(u.properties&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_end"))return{start:+u.properties.mapbox_clip_start,end:+u.properties.mapbox_clip_end}}addFeature(u,m,C,P,Q){const V=this.layers[0].layout,K=V.get("line-join").evaluate(u,{}),re=V.get("line-cap"),he=V.get("line-miter-limit"),h=V.get("line-round-limit");this.lineClips=this.lineFeatureClips(u);for(const c of m)this.addLine(c,u,K,re,he,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,P)}addLine(u,m,C,P,Q,V){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<u.length-1;G++)this.totalDistance+=u[G].dist(u[G+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const K=fx[m.type]==="Polygon";let re=u.length;for(;re>=2&&u[re-1].equals(u[re-2]);)re--;let he=0;for(;he<re-1&&u[he].equals(u[he+1]);)he++;if(re<(K?3:2))return;C==="bevel"&&(Q=1.05);const h=this.overscaling<=16?15*$r/(512*this.overscaling):0,c=this.segments.prepareSegment(10*re,this.layoutVertexArray,this.indexArray);let f,v,E,M,D;this.e1=this.e2=-1,K&&(f=u[re-2],D=u[he].sub(f)._unit()._perp());for(let G=he;G<re;G++){if(E=G===re-1?K?u[he+1]:void 0:u[G+1],E&&u[G].equals(E))continue;D&&(M=D),f&&(v=f),f=u[G],D=E?E.sub(f)._unit()._perp():M,M=M||D;let $=M.add(D);$.x===0&&$.y===0||$._unit();const X=M.x*D.x+M.y*D.y,se=$.x*D.x+$.y*D.y,Ae=se!==0?1/se:1/0,me=2*Math.sqrt(2-2*se),Be=se<xI&&v&&E,Te=M.x*D.y-M.y*D.x>0;if(Be&&G>he){const $e=f.dist(v);if($e>2*h){const ct=f.sub(f.sub(v)._mult(h/$e)._round());this.updateDistance(v,ct),this.addCurrentVertex(ct,M,0,0,c),v=ct}}const ke=v&&E;let je=ke?C:K?"butt":P;if(ke&&je==="round"&&(Ae<V?je="miter":Ae<=2&&(je="fakeround")),je==="miter"&&Ae>Q&&(je="bevel"),je==="bevel"&&(Ae>2&&(je="flipbevel"),Ae<Q&&(je="miter")),v&&this.updateDistance(v,f),je==="miter")$._mult(Ae),this.addCurrentVertex(f,$,0,0,c);else if(je==="flipbevel"){if(Ae>100)$=D.mult(-1);else{const $e=Ae*M.add(D).mag()/M.sub(D).mag();$._perp()._mult($e*(Te?-1:1))}this.addCurrentVertex(f,$,0,0,c),this.addCurrentVertex(f,$.mult(-1),0,0,c)}else if(je==="bevel"||je==="fakeround"){const $e=-Math.sqrt(Ae*Ae-1),ct=Te?$e:0,Ye=Te?0:$e;if(v&&this.addCurrentVertex(f,M,ct,Ye,c),je==="fakeround"){const tt=Math.round(180*me/Math.PI/20);for(let gt=1;gt<tt;gt++){let St=gt/tt;if(St!==.5){const xi=St-.5;St+=St*xi*(St-1)*((1.0904+X*(X*(3.55645-1.43519*X)-3.2452))*xi*xi+(.848013+X*(.215638*X-1.06021)))}const Xt=D.sub(M)._mult(St)._add(M)._unit()._mult(Te?-1:1);this.addHalfVertex(f,Xt.x,Xt.y,!1,Te,0,c)}}E&&this.addCurrentVertex(f,D,-ct,-Ye,c)}else if(je==="butt")this.addCurrentVertex(f,$,0,0,c);else if(je==="square"){const $e=v?1:-1;this.addCurrentVertex(f,$,$e,$e,c)}else je==="round"&&(v&&(this.addCurrentVertex(f,M,0,0,c),this.addCurrentVertex(f,M,1,1,c,!0)),E&&(this.addCurrentVertex(f,D,-1,-1,c,!0),this.addCurrentVertex(f,D,0,0,c)));if(Be&&G<re-1){const $e=f.dist(E);if($e>2*h){const ct=f.add(E.sub(f)._mult(h/$e)._round());this.updateDistance(f,ct),this.addCurrentVertex(ct,D,0,0,c),f=ct}}}}addCurrentVertex(u,m,C,P,Q){let V=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const K=m.y*P-m.x,re=-m.y-m.x*P;this.addHalfVertex(u,m.x+m.y*C,m.y-m.x*C,V,!1,C,Q),this.addHalfVertex(u,K,re,V,!0,-P,Q),this.distance>px/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(u,m,C,P,Q,V))}addHalfVertex(u,m,C,P,Q,V,K){let{x:re,y:he}=u;const h=.5*(this.lineClips?this.scaledDistance*(px-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((re<<1)+(P?1:0),(he<<1)+(Q?1:0),Math.round(63*m)+128,Math.round(63*C)+128,1+(V===0?0:V<0?-1:1)|(63&h)<<2,h>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=K.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),K.primitiveLength++),Q?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(u,m){this.distance+=u.dist(m),this.updateScaledDistance()}}let G0,gx;Pi("LineBucket",KA,{omit:["layers","patternFeatures"]});var mx={get paint(){return gx=gx||new Es({"line-opacity":new sr(xt.paint_line["line-opacity"]),"line-color":new sr(xt.paint_line["line-color"]),"line-translate":new bi(xt.paint_line["line-translate"]),"line-translate-anchor":new bi(xt.paint_line["line-translate-anchor"]),"line-width":new sr(xt.paint_line["line-width"]),"line-gap-width":new sr(xt.paint_line["line-gap-width"]),"line-offset":new sr(xt.paint_line["line-offset"]),"line-blur":new sr(xt.paint_line["line-blur"]),"line-dasharray":new zc(xt.paint_line["line-dasharray"]),"line-pattern":new Zl(xt.paint_line["line-pattern"]),"line-gradient":new Qc(xt.paint_line["line-gradient"])})},get layout(){return G0=G0||new Es({"line-cap":new bi(xt.layout_line["line-cap"]),"line-join":new sr(xt.layout_line["line-join"]),"line-miter-limit":new bi(xt.layout_line["line-miter-limit"]),"line-round-limit":new bi(xt.layout_line["line-round-limit"]),"line-sort-key":new sr(xt.layout_line["line-sort-key"])})}};class wI extends sr{possiblyEvaluate(u,m){return m=new yn(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),super.possiblyEvaluate(u,m)}evaluate(u,m,C,P){return m=qe({},m,{zoom:Math.floor(m.zoom)}),super.evaluate(u,m,C,P)}}let vm;class BI extends qn{constructor(u){super(u,mx),this.gradientVersion=0,vm||(vm=new wI(mx.paint.properties["line-width"].specification),vm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const m=this.gradientExpression();this.stepInterpolant=!!function(C){return C._styleExpression!==void 0}(m)&&m._styleExpression.expression instanceof Sa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(u,m){super.recalculate(u,m),this.paint._values["line-floorwidth"]=vm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new KA(u)}queryRadius(u){const m=u,C=yx(sA("line-width",this,m),sA("line-gap-width",this,m)),P=sA("line-offset",this,m);return C/2+Math.abs(P)+Rd(this.paint.get("line-translate"))}queryIntersectsFeature(u,m,C,P,Q,V,K){const re=Qu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),V.angle,K),he=K/2*yx(this.paint.get("line-width").evaluate(m,C),this.paint.get("line-gap-width").evaluate(m,C)),h=this.paint.get("line-offset").evaluate(m,C);return h&&(P=function(c,f){const v=[];for(let E=0;E<c.length;E++){const M=c[E],D=[];for(let G=0;G<M.length;G++){const $=M[G-1],X=M[G],se=M[G+1],Ae=G===0?new F(0,0):X.sub($)._unit()._perp(),me=G===M.length-1?new F(0,0):se.sub(X)._unit()._perp(),Be=Ae._add(me)._unit(),Te=Be.x*me.x+Be.y*me.y;Te!==0&&Be._mult(1/Te),D.push(Be._mult(f)._add(X))}v.push(D)}return v}(P,h*K)),function(c,f,v){for(let E=0;E<f.length;E++){const M=f[E];if(c.length>=3){for(let D=0;D<M.length;D++)if(Gc(c,M[D]))return!0}if(mc(c,M,v))return!0}return!1}(re,P,he)}isTileClipped(){return!0}}function yx(p,u){return u>0?u+2*p:p}const _x=$n([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),j0=$n([{name:"a_projected_pos",components:3,type:"Float32"}],4);$n([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const vx=$n([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);$n([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const q0=$n([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bx=$n([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function CI(p,u,m){return p.sections.forEach(C=>{C.text=function(P,Q,V){const K=Q.layout.get("text-transform").evaluate(V,{});return K==="uppercase"?P=P.toLocaleUpperCase():K==="lowercase"&&(P=P.toLocaleLowerCase()),il.applyArabicShaping&&(P=il.applyArabicShaping(P)),P}(C.text,u,m)}),p}$n([{name:"triangle",components:3,type:"Uint16"}]),$n([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),$n([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),$n([{type:"Float32",name:"offsetX"}]),$n([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),$n([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const AA={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var _o=24,$0=Wn,xx=function(p,u,m,C,P){var Q,V,K=8*P-C-1,re=(1<<K)-1,he=re>>1,h=-7,c=m?P-1:0,f=m?-1:1,v=p[u+c];for(c+=f,Q=v&(1<<-h)-1,v>>=-h,h+=K;h>0;Q=256*Q+p[u+c],c+=f,h-=8);for(V=Q&(1<<-h)-1,Q>>=-h,h+=C;h>0;V=256*V+p[u+c],c+=f,h-=8);if(Q===0)Q=1-he;else{if(Q===re)return V?NaN:1/0*(v?-1:1);V+=Math.pow(2,C),Q-=he}return(v?-1:1)*V*Math.pow(2,Q-C)},wx=function(p,u,m,C,P,Q){var V,K,re,he=8*Q-P-1,h=(1<<he)-1,c=h>>1,f=P===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=C?0:Q-1,E=C?1:-1,M=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(K=isNaN(u)?1:0,V=h):(V=Math.floor(Math.log(u)/Math.LN2),u*(re=Math.pow(2,-V))<1&&(V--,re*=2),(u+=V+c>=1?f/re:f*Math.pow(2,1-c))*re>=2&&(V++,re/=2),V+c>=h?(K=0,V=h):V+c>=1?(K=(u*re-1)*Math.pow(2,P),V+=c):(K=u*Math.pow(2,c-1)*Math.pow(2,P),V=0));P>=8;p[m+v]=255&K,v+=E,K/=256,P-=8);for(V=V<<P|K,he+=P;he>0;p[m+v]=255&V,v+=E,V/=256,he-=8);p[m+v-E]|=128*M};function Wn(p){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(p)?p:new Uint8Array(p||0),this.pos=0,this.type=0,this.length=this.buf.length}Wn.Varint=0,Wn.Fixed64=1,Wn.Bytes=2,Wn.Fixed32=5;var bm=4294967296,Bx=1/bm,Cx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function _c(p){return p.type===Wn.Bytes?p.readVarint()+p.pos:p.pos+1}function Ss(p,u,m){return m?4294967296*u+(p>>>0):4294967296*(u>>>0)+(p>>>0)}function K0(p,u,m){var C=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));m.realloc(C);for(var P=m.pos-1;P>=p;P--)m.buf[P+C]=m.buf[P]}function Ex(p,u){for(var m=0;m<p.length;m++)u.writeVarint(p[m])}function Sx(p,u){for(var m=0;m<p.length;m++)u.writeSVarint(p[m])}function Xn(p,u){for(var m=0;m<p.length;m++)u.writeFloat(p[m])}function W0(p,u){for(var m=0;m<p.length;m++)u.writeDouble(p[m])}function Tx(p,u){for(var m=0;m<p.length;m++)u.writeBoolean(p[m])}function Ix(p,u){for(var m=0;m<p.length;m++)u.writeFixed32(p[m])}function Th(p,u){for(var m=0;m<p.length;m++)u.writeSFixed32(p[m])}function jd(p,u){for(var m=0;m<p.length;m++)u.writeFixed64(p[m])}function Lx(p,u){for(var m=0;m<p.length;m++)u.writeSFixed64(p[m])}function xm(p,u){return(p[u]|p[u+1]<<8|p[u+2]<<16)+16777216*p[u+3]}function qd(p,u,m){p[m]=u,p[m+1]=u>>>8,p[m+2]=u>>>16,p[m+3]=u>>>24}function Mx(p,u){return(p[u]|p[u+1]<<8|p[u+2]<<16)+(p[u+3]<<24)}Wn.prototype={destroy:function(){this.buf=null},readFields:function(p,u,m){for(m=m||this.length;this.pos<m;){var C=this.readVarint(),P=C>>3,Q=this.pos;this.type=7&C,p(P,u,this),this.pos===Q&&this.skip(C)}return u},readMessage:function(p,u){return this.readFields(p,u,this.readVarint()+this.pos)},readFixed32:function(){var p=xm(this.buf,this.pos);return this.pos+=4,p},readSFixed32:function(){var p=Mx(this.buf,this.pos);return this.pos+=4,p},readFixed64:function(){var p=xm(this.buf,this.pos)+xm(this.buf,this.pos+4)*bm;return this.pos+=8,p},readSFixed64:function(){var p=xm(this.buf,this.pos)+Mx(this.buf,this.pos+4)*bm;return this.pos+=8,p},readFloat:function(){var p=xx(this.buf,this.pos,!0,23,4);return this.pos+=4,p},readDouble:function(){var p=xx(this.buf,this.pos,!0,52,8);return this.pos+=8,p},readVarint:function(p){var u,m,C=this.buf;return u=127&(m=C[this.pos++]),m<128?u:(u|=(127&(m=C[this.pos++]))<<7,m<128?u:(u|=(127&(m=C[this.pos++]))<<14,m<128?u:(u|=(127&(m=C[this.pos++]))<<21,m<128?u:function(P,Q,V){var K,re,he=V.buf;if(K=(112&(re=he[V.pos++]))>>4,re<128||(K|=(127&(re=he[V.pos++]))<<3,re<128)||(K|=(127&(re=he[V.pos++]))<<10,re<128)||(K|=(127&(re=he[V.pos++]))<<17,re<128)||(K|=(127&(re=he[V.pos++]))<<24,re<128)||(K|=(1&(re=he[V.pos++]))<<31,re<128))return Ss(P,K,Q);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(m=C[this.pos]))<<28,p,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var p=this.readVarint();return p%2==1?(p+1)/-2:p/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var p=this.readVarint()+this.pos,u=this.pos;return this.pos=p,p-u>=12&&Cx?function(m,C,P){return Cx.decode(m.subarray(C,P))}(this.buf,u,p):function(m,C,P){for(var Q="",V=C;V<P;){var K,re,he,h=m[V],c=null,f=h>239?4:h>223?3:h>191?2:1;if(V+f>P)break;f===1?h<128&&(c=h):f===2?(192&(K=m[V+1]))==128&&(c=(31&h)<<6|63&K)<=127&&(c=null):f===3?(re=m[V+2],(192&(K=m[V+1]))==128&&(192&re)==128&&((c=(15&h)<<12|(63&K)<<6|63&re)<=2047||c>=55296&&c<=57343)&&(c=null)):f===4&&(re=m[V+2],he=m[V+3],(192&(K=m[V+1]))==128&&(192&re)==128&&(192&he)==128&&((c=(15&h)<<18|(63&K)<<12|(63&re)<<6|63&he)<=65535||c>=1114112)&&(c=null)),c===null?(c=65533,f=1):c>65535&&(c-=65536,Q+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),Q+=String.fromCharCode(c),V+=f}return Q}(this.buf,u,p)},readBytes:function(){var p=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,p);return this.pos=p,u},readPackedVarint:function(p,u){if(this.type!==Wn.Bytes)return p.push(this.readVarint(u));var m=_c(this);for(p=p||[];this.pos<m;)p.push(this.readVarint(u));return p},readPackedSVarint:function(p){if(this.type!==Wn.Bytes)return p.push(this.readSVarint());var u=_c(this);for(p=p||[];this.pos<u;)p.push(this.readSVarint());return p},readPackedBoolean:function(p){if(this.type!==Wn.Bytes)return p.push(this.readBoolean());var u=_c(this);for(p=p||[];this.pos<u;)p.push(this.readBoolean());return p},readPackedFloat:function(p){if(this.type!==Wn.Bytes)return p.push(this.readFloat());var u=_c(this);for(p=p||[];this.pos<u;)p.push(this.readFloat());return p},readPackedDouble:function(p){if(this.type!==Wn.Bytes)return p.push(this.readDouble());var u=_c(this);for(p=p||[];this.pos<u;)p.push(this.readDouble());return p},readPackedFixed32:function(p){if(this.type!==Wn.Bytes)return p.push(this.readFixed32());var u=_c(this);for(p=p||[];this.pos<u;)p.push(this.readFixed32());return p},readPackedSFixed32:function(p){if(this.type!==Wn.Bytes)return p.push(this.readSFixed32());var u=_c(this);for(p=p||[];this.pos<u;)p.push(this.readSFixed32());return p},readPackedFixed64:function(p){if(this.type!==Wn.Bytes)return p.push(this.readFixed64());var u=_c(this);for(p=p||[];this.pos<u;)p.push(this.readFixed64());return p},readPackedSFixed64:function(p){if(this.type!==Wn.Bytes)return p.push(this.readSFixed64());var u=_c(this);for(p=p||[];this.pos<u;)p.push(this.readSFixed64());return p},skip:function(p){var u=7&p;if(u===Wn.Varint)for(;this.buf[this.pos++]>127;);else if(u===Wn.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Wn.Fixed32)this.pos+=4;else{if(u!==Wn.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(p,u){this.writeVarint(p<<3|u)},realloc:function(p){for(var u=this.length||16;u<this.pos+p;)u*=2;if(u!==this.length){var m=new Uint8Array(u);m.set(this.buf),this.buf=m,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(p){this.realloc(4),qd(this.buf,p,this.pos),this.pos+=4},writeSFixed32:function(p){this.realloc(4),qd(this.buf,p,this.pos),this.pos+=4},writeFixed64:function(p){this.realloc(8),qd(this.buf,-1&p,this.pos),qd(this.buf,Math.floor(p*Bx),this.pos+4),this.pos+=8},writeSFixed64:function(p){this.realloc(8),qd(this.buf,-1&p,this.pos),qd(this.buf,Math.floor(p*Bx),this.pos+4),this.pos+=8},writeVarint:function(p){(p=+p||0)>268435455||p<0?function(u,m){var C,P;if(u>=0?(C=u%4294967296|0,P=u/4294967296|0):(P=~(-u/4294967296),4294967295^(C=~(-u%4294967296))?C=C+1|0:(C=0,P=P+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");m.realloc(10),function(Q,V,K){K.buf[K.pos++]=127&Q|128,Q>>>=7,K.buf[K.pos++]=127&Q|128,Q>>>=7,K.buf[K.pos++]=127&Q|128,Q>>>=7,K.buf[K.pos++]=127&Q|128,K.buf[K.pos]=127&(Q>>>=7)}(C,0,m),function(Q,V){var K=(7&Q)<<4;V.buf[V.pos++]|=K|((Q>>>=3)?128:0),Q&&(V.buf[V.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(V.buf[V.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(V.buf[V.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(V.buf[V.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(V.buf[V.pos++]=127&Q)))))}(P,m)}(p,this):(this.realloc(4),this.buf[this.pos++]=127&p|(p>127?128:0),p<=127||(this.buf[this.pos++]=127&(p>>>=7)|(p>127?128:0),p<=127||(this.buf[this.pos++]=127&(p>>>=7)|(p>127?128:0),p<=127||(this.buf[this.pos++]=p>>>7&127))))},writeSVarint:function(p){this.writeVarint(p<0?2*-p-1:2*p)},writeBoolean:function(p){this.writeVarint(!!p)},writeString:function(p){p=String(p),this.realloc(4*p.length),this.pos++;var u=this.pos;this.pos=function(C,P,Q){for(var V,K,re=0;re<P.length;re++){if((V=P.charCodeAt(re))>55295&&V<57344){if(!K){V>56319||re+1===P.length?(C[Q++]=239,C[Q++]=191,C[Q++]=189):K=V;continue}if(V<56320){C[Q++]=239,C[Q++]=191,C[Q++]=189,K=V;continue}V=K-55296<<10|V-56320|65536,K=null}else K&&(C[Q++]=239,C[Q++]=191,C[Q++]=189,K=null);V<128?C[Q++]=V:(V<2048?C[Q++]=V>>6|192:(V<65536?C[Q++]=V>>12|224:(C[Q++]=V>>18|240,C[Q++]=V>>12&63|128),C[Q++]=V>>6&63|128),C[Q++]=63&V|128)}return Q}(this.buf,p,this.pos);var m=this.pos-u;m>=128&&K0(u,m,this),this.pos=u-1,this.writeVarint(m),this.pos+=m},writeFloat:function(p){this.realloc(4),wx(this.buf,p,this.pos,!0,23,4),this.pos+=4},writeDouble:function(p){this.realloc(8),wx(this.buf,p,this.pos,!0,52,8),this.pos+=8},writeBytes:function(p){var u=p.length;this.writeVarint(u),this.realloc(u);for(var m=0;m<u;m++)this.buf[this.pos++]=p[m]},writeRawMessage:function(p,u){this.pos++;var m=this.pos;p(u,this);var C=this.pos-m;C>=128&&K0(m,C,this),this.pos=m-1,this.writeVarint(C),this.pos+=C},writeMessage:function(p,u,m){this.writeTag(p,Wn.Bytes),this.writeRawMessage(u,m)},writePackedVarint:function(p,u){u.length&&this.writeMessage(p,Ex,u)},writePackedSVarint:function(p,u){u.length&&this.writeMessage(p,Sx,u)},writePackedBoolean:function(p,u){u.length&&this.writeMessage(p,Tx,u)},writePackedFloat:function(p,u){u.length&&this.writeMessage(p,Xn,u)},writePackedDouble:function(p,u){u.length&&this.writeMessage(p,W0,u)},writePackedFixed32:function(p,u){u.length&&this.writeMessage(p,Ix,u)},writePackedSFixed32:function(p,u){u.length&&this.writeMessage(p,Th,u)},writePackedFixed64:function(p,u){u.length&&this.writeMessage(p,jd,u)},writePackedSFixed64:function(p,u){u.length&&this.writeMessage(p,Lx,u)},writeBytesField:function(p,u){this.writeTag(p,Wn.Bytes),this.writeBytes(u)},writeFixed32Field:function(p,u){this.writeTag(p,Wn.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(p,u){this.writeTag(p,Wn.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(p,u){this.writeTag(p,Wn.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(p,u){this.writeTag(p,Wn.Fixed64),this.writeSFixed64(u)},writeVarintField:function(p,u){this.writeTag(p,Wn.Varint),this.writeVarint(u)},writeSVarintField:function(p,u){this.writeTag(p,Wn.Varint),this.writeSVarint(u)},writeStringField:function(p,u){this.writeTag(p,Wn.Bytes),this.writeString(u)},writeFloatField:function(p,u){this.writeTag(p,Wn.Fixed32),this.writeFloat(u)},writeDoubleField:function(p,u){this.writeTag(p,Wn.Fixed64),this.writeDouble(u)},writeBooleanField:function(p,u){this.writeVarintField(p,!!u)}};var X0=g($0);const Z0=3;function EI(p,u,m){p===1&&m.readMessage(SI,u)}function SI(p,u,m){if(p===3){const{id:C,bitmap:P,width:Q,height:V,left:K,top:re,advance:he}=m.readMessage(TI,{});u.push({id:C,bitmap:new mu({width:Q+2*Z0,height:V+2*Z0},P),metrics:{width:Q,height:V,left:K,top:re,advance:he}})}}function TI(p,u,m){p===1?u.id=m.readVarint():p===2?u.bitmap=m.readBytes():p===3?u.width=m.readVarint():p===4?u.height=m.readVarint():p===5?u.left=m.readSVarint():p===6?u.top=m.readSVarint():p===7&&(u.advance=m.readVarint())}const Px=Z0;function pp(p){let u=0,m=0;for(const V of p)u+=V.w*V.h,m=Math.max(m,V.w);p.sort((V,K)=>K.h-V.h);const C=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),m),h:1/0}];let P=0,Q=0;for(const V of p)for(let K=C.length-1;K>=0;K--){const re=C[K];if(!(V.w>re.w||V.h>re.h)){if(V.x=re.x,V.y=re.y,Q=Math.max(Q,V.y+V.h),P=Math.max(P,V.x+V.w),V.w===re.w&&V.h===re.h){const he=C.pop();K<C.length&&(C[K]=he)}else V.h===re.h?(re.x+=V.w,re.w-=V.w):V.w===re.w?(re.y+=V.h,re.h-=V.h):(C.push({x:re.x+V.w,y:re.y,w:re.w-V.w,h:V.h}),re.y+=V.h,re.h-=V.h);break}}return{w:P,h:Q,fill:u/(P*Q)||0}}const No=1;class wm{constructor(u,m){let{pixelRatio:C,version:P,stretchX:Q,stretchY:V,content:K}=m;this.paddedRect=u,this.pixelRatio=C,this.stretchX=Q,this.stretchY=V,this.content=K,this.version=P}get tl(){return[this.paddedRect.x+No,this.paddedRect.y+No]}get br(){return[this.paddedRect.x+this.paddedRect.w-No,this.paddedRect.y+this.paddedRect.h-No]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*No)/this.pixelRatio,(this.paddedRect.h-2*No)/this.pixelRatio]}}class Bm{constructor(u,m){const C={},P={};this.haveRenderCallbacks=[];const Q=[];this.addImages(u,C,Q),this.addImages(m,P,Q);const{w:V,h:K}=pp(Q),re=new bl({width:V||1,height:K||1});for(const he in u){const h=u[he],c=C[he].paddedRect;bl.copy(h.data,re,{x:0,y:0},{x:c.x+No,y:c.y+No},h.data)}for(const he in m){const h=m[he],c=P[he].paddedRect,f=c.x+No,v=c.y+No,E=h.data.width,M=h.data.height;bl.copy(h.data,re,{x:0,y:0},{x:f,y:v},h.data),bl.copy(h.data,re,{x:0,y:M-1},{x:f,y:v-1},{width:E,height:1}),bl.copy(h.data,re,{x:0,y:0},{x:f,y:v+M},{width:E,height:1}),bl.copy(h.data,re,{x:E-1,y:0},{x:f-1,y:v},{width:1,height:M}),bl.copy(h.data,re,{x:0,y:0},{x:f+E,y:v},{width:1,height:M})}this.image=re,this.iconPositions=C,this.patternPositions=P}addImages(u,m,C){for(const P in u){const Q=u[P],V={x:0,y:0,w:Q.data.width+2*No,h:Q.data.height+2*No};C.push(V),m[P]=new wm(V,Q),Q.hasRenderCallback&&this.haveRenderCallbacks.push(P)}}patchUpdatedImages(u,m){u.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const C in u.updatedImages)this.patchUpdatedImage(this.iconPositions[C],u.getImage(C),m),this.patchUpdatedImage(this.patternPositions[C],u.getImage(C),m)}patchUpdatedImage(u,m,C){if(!u||!m||u.version===m.version)return;u.version=m.version;const[P,Q]=u.tl;C.update(m.data,void 0,{x:P,y:Q})}}var Gu;Pi("ImagePosition",wm),Pi("ImageAtlas",Bm),l.ah=void 0,(Gu=l.ah||(l.ah={}))[Gu.none=0]="none",Gu[Gu.horizontal=1]="horizontal",Gu[Gu.vertical=2]="vertical",Gu[Gu.horizontalOnly=3]="horizontalOnly";const gp=-17;class mp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(u,m){const C=new mp;return C.scale=u||1,C.fontStack=m,C}static forImage(u){const m=new mp;return m.imageName=u,m}}class $d{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(u,m){const C=new $d;for(let P=0;P<u.sections.length;P++){const Q=u.sections[P];Q.image?C.addImageSection(Q):C.addTextSection(Q,m)}return C}length(){return this.text.length}getSection(u){return this.sections[this.sectionIndex[u]]}getSectionIndex(u){return this.sectionIndex[u]}getCharCode(u){return this.text.charCodeAt(u)}verticalizePunctuation(){this.text=function(u){let m="";for(let C=0;C<u.length;C++){const P=u.charCodeAt(C+1)||null,Q=u.charCodeAt(C-1)||null;m+=P&&kc(P)&&!AA[u[C+1]]||Q&&kc(Q)&&!AA[u[C-1]]||!AA[u[C]]?u[C]:AA[u[C]]}return m}(this.text)}trim(){let u=0;for(let C=0;C<this.text.length&&_p[this.text.charCodeAt(C)];C++)u++;let m=this.text.length;for(let C=this.text.length-1;C>=0&&C>=u&&_p[this.text.charCodeAt(C)];C--)m--;this.text=this.text.substring(u,m),this.sectionIndex=this.sectionIndex.slice(u,m)}substring(u,m){const C=new $d;return C.text=this.text.substring(u,m),C.sectionIndex=this.sectionIndex.slice(u,m),C.sections=this.sections,C}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((u,m)=>Math.max(u,this.sections[m].scale),0)}addTextSection(u,m){this.text+=u.text,this.sections.push(mp.forText(u.scale,u.fontStack||m));const C=this.sections.length-1;for(let P=0;P<u.text.length;++P)this.sectionIndex.push(C)}addImageSection(u){const m=u.image?u.image.name:"";if(m.length===0)return void Ze("Can't add FormattedSection with an empty image.");const C=this.getNextImageSectionCharCode();C?(this.text+=String.fromCharCode(C),this.sections.push(mp.forImage(m)),this.sectionIndex.push(this.sections.length-1)):Ze("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yp(p,u,m,C,P,Q,V,K,re,he,h,c,f,v,E,M){const D=$d.fromFeature(p,P);let G;c===l.ah.vertical&&D.verticalizePunctuation();const{processBidirectionalText:$,processStyledBidirectionalText:X}=il;if($&&D.sections.length===1){G=[];const me=$(D.toString(),fA(D,he,Q,u,C,v,E));for(const Be of me){const Te=new $d;Te.text=Be,Te.sections=D.sections;for(let ke=0;ke<Be.length;ke++)Te.sectionIndex.push(0);G.push(Te)}}else if(X){G=[];const me=X(D.text,D.sectionIndex,fA(D,he,Q,u,C,v,E));for(const Be of me){const Te=new $d;Te.text=Be[0],Te.sectionIndex=Be[1],Te.sections=D.sections,G.push(Te)}}else G=function(me,Be){const Te=[],ke=me.text;let je=0;for(const $e of Be)Te.push(me.substring(je,$e)),je=$e;return je<ke.length&&Te.push(me.substring(je,ke.length)),Te}(D,fA(D,he,Q,u,C,v,E));const se=[],Ae={positionedLines:se,text:D.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:c,iconsInText:!1,verticalizable:!1};return function(me,Be,Te,ke,je,$e,ct,Ye,tt,gt,St,Xt){let xi=0,oi=gp,Ai=0,fi=0;const Fi=Ye==="right"?1:Ye==="left"?0:.5;let ai=0;for(const Dr of je){Dr.trim();const zr=Dr.getMaxScale(),pn=(zr-1)*_o,as={positionedGlyphs:[],lineOffset:0};me.positionedLines[ai]=as;const zn=as.positionedGlyphs;let vn=0;if(!Dr.length()){oi+=$e,++ai;continue}for(let cn=0;cn<Dr.length();cn++){const vr=Dr.getSection(cn),Qn=Dr.getSectionIndex(cn),un=Dr.getCharCode(cn);let en=0,fs=null,Ts=null,vs=null,Zs=_o;const Is=!(tt===l.ah.horizontal||!St&&!Wl(un)||St&&(_p[un]||(Zt=un,Ei.Arabic(Zt)||Ei["Arabic Supplement"](Zt)||Ei["Arabic Extended-A"](Zt)||Ei["Arabic Presentation Forms-A"](Zt)||Ei["Arabic Presentation Forms-B"](Zt))));if(vr.imageName){const Fn=ke[vr.imageName];if(!Fn)continue;vs=vr.imageName,me.iconsInText=me.iconsInText||!0,Ts=Fn.paddedRect;const xr=Fn.displaySize;vr.scale=vr.scale*_o/Xt,fs={width:xr[0],height:xr[1],left:No,top:-Px,advance:Is?xr[1]:xr[0]},en=pn+(_o-xr[1]*vr.scale),Zs=fs.advance;const Ns=Is?xr[0]*vr.scale-_o*zr:xr[1]*vr.scale-_o*zr;Ns>0&&Ns>vn&&(vn=Ns)}else{const Fn=Te[vr.fontStack],xr=Fn&&Fn[un];if(xr&&xr.rect)Ts=xr.rect,fs=xr.metrics;else{const Ns=Be[vr.fontStack],ao=Ns&&Ns[un];if(!ao)continue;fs=ao.metrics}en=(zr-vr.scale)*_o}Is?(me.verticalizable=!0,zn.push({glyph:un,imageName:vs,x:xi,y:oi+en,vertical:Is,scale:vr.scale,fontStack:vr.fontStack,sectionIndex:Qn,metrics:fs,rect:Ts}),xi+=Zs*vr.scale+gt):(zn.push({glyph:un,imageName:vs,x:xi,y:oi+en,vertical:Is,scale:vr.scale,fontStack:vr.fontStack,sectionIndex:Qn,metrics:fs,rect:Ts}),xi+=fs.advance*vr.scale+gt)}zn.length!==0&&(Ai=Math.max(xi-gt,Ai),Em(zn,0,zn.length-1,Fi,vn)),xi=0;const Pn=$e*zr+vn;as.lineOffset=Math.max(vn,pn),oi+=Pn,fi=Math.max(Pn,fi),++ai}var Zt;const Vi=oi-gp,{horizontalAlign:Qi,verticalAlign:gr}=Xd(ct);(function(Dr,zr,pn,as,zn,vn,Pn,cn,vr){const Qn=(zr-pn)*zn;let un=0;un=vn!==Pn?-cn*as-gp:(-as*vr+.5)*Pn;for(const en of Dr)for(const fs of en.positionedGlyphs)fs.x+=Qn,fs.y+=un})(me.positionedLines,Fi,Qi,gr,Ai,fi,$e,Vi,je.length),me.top+=-gr*Vi,me.bottom=me.top+Vi,me.left+=-Qi*Ai,me.right=me.left+Ai}(Ae,u,m,C,G,V,K,re,c,he,f,M),!function(me){for(const Be of me)if(Be.positionedGlyphs.length!==0)return!1;return!0}(se)&&Ae}const _p={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wl={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Cm(p,u,m,C,P,Q){if(u.imageName){const V=C[u.imageName];return V?V.displaySize[0]*u.scale*_o/Q+P:0}{const V=m[u.fontStack],K=V&&V[p];return K?K.metrics.advance*u.scale+P:0}}function J0(p,u,m,C){const P=Math.pow(p-u,2);return C?p<u?P/2:2*P:P+Math.abs(m)*m}function dA(p,u,m){let C=0;return p===10&&(C-=1e4),m&&(C+=150),p!==40&&p!==65288||(C+=50),u!==41&&u!==65289||(C+=50),C}function Kd(p,u,m,C,P,Q){let V=null,K=J0(u,m,P,Q);for(const re of C){const he=J0(u-re.x,m,P,Q)+re.badness;he<=K&&(V=re,K=he)}return{index:p,x:u,priorBreak:V,badness:K}}function Wd(p){return p?Wd(p.priorBreak).concat(p.index):[]}function fA(p,u,m,C,P,Q,V){if(Q!=="point")return[];if(!p)return[];const K=[],re=function(f,v,E,M,D,G){let $=0;for(let X=0;X<f.length();X++){const se=f.getSection(X);$+=Cm(f.getCharCode(X),se,M,D,v,G)}return $/Math.max(1,Math.ceil($/E))}(p,u,m,C,P,V),he=p.text.indexOf("")>=0;let h=0;for(let f=0;f<p.length();f++){const v=p.getSection(f),E=p.getCharCode(f);if(_p[E]||(h+=Cm(E,v,C,P,u,V)),f<p.length()-1){const M=!((c=E)<11904||!(Ei["Bopomofo Extended"](c)||Ei.Bopomofo(c)||Ei["CJK Compatibility Forms"](c)||Ei["CJK Compatibility Ideographs"](c)||Ei["CJK Compatibility"](c)||Ei["CJK Radicals Supplement"](c)||Ei["CJK Strokes"](c)||Ei["CJK Symbols and Punctuation"](c)||Ei["CJK Unified Ideographs Extension A"](c)||Ei["CJK Unified Ideographs"](c)||Ei["Enclosed CJK Letters and Months"](c)||Ei["Halfwidth and Fullwidth Forms"](c)||Ei.Hiragana(c)||Ei["Ideographic Description Characters"](c)||Ei["Kangxi Radicals"](c)||Ei["Katakana Phonetic Extensions"](c)||Ei.Katakana(c)||Ei["Vertical Forms"](c)||Ei["Yi Radicals"](c)||Ei["Yi Syllables"](c)));(wl[E]||M||v.imageName)&&K.push(Kd(f+1,h,re,K,dA(E,p.getCharCode(f+1),M&&he),!1))}}var c;return Wd(Kd(p.length(),h,re,K,0,!0))}function Xd(p){let u=.5,m=.5;switch(p){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(p){case"bottom":case"bottom-right":case"bottom-left":m=1;break;case"top":case"top-right":case"top-left":m=0}return{horizontalAlign:u,verticalAlign:m}}function Em(p,u,m,C,P){if(!C&&!P)return;const Q=p[m],V=(p[m].x+Q.metrics.advance*Q.scale)*C;for(let K=u;K<=m;K++)p[K].x-=V,p[K].y+=P}function II(p,u,m){const{horizontalAlign:C,verticalAlign:P}=Xd(m),Q=u[0]-p.displaySize[0]*C,V=u[1]-p.displaySize[1]*P;return{image:p,top:V,bottom:V+p.displaySize[1],left:Q,right:Q+p.displaySize[0]}}function Y0(p,u,m,C,P,Q){const V=p.image;let K;if(V.content){const D=V.content,G=V.pixelRatio||1;K=[D[0]/G,D[1]/G,V.displaySize[0]-D[2]/G,V.displaySize[1]-D[3]/G]}const re=u.left*Q,he=u.right*Q;let h,c,f,v;m==="width"||m==="both"?(v=P[0]+re-C[3],c=P[0]+he+C[1]):(v=P[0]+(re+he-V.displaySize[0])/2,c=v+V.displaySize[0]);const E=u.top*Q,M=u.bottom*Q;return m==="height"||m==="both"?(h=P[1]+E-C[0],f=P[1]+M+C[2]):(h=P[1]+(E+M-V.displaySize[1])/2,f=h+V.displaySize[1]),{image:V,top:h,right:c,bottom:f,left:v,collisionPadding:K}}const Zd=255,ju=128,Ih=Zd*ju;function e_(p,u){const{expression:m}=u;if(m.kind==="constant")return{kind:"constant",layoutSize:m.evaluate(new yn(p+1))};if(m.kind==="source")return{kind:"source"};{const{zoomStops:C,interpolationType:P}=m;let Q=0;for(;Q<C.length&&C[Q]<=p;)Q++;Q=Math.max(0,Q-1);let V=Q;for(;V<C.length&&C[V]<p+1;)V++;V=Math.min(C.length-1,V);const K=C[Q],re=C[V];return m.kind==="composite"?{kind:"composite",minZoom:K,maxZoom:re,interpolationType:P}:{kind:"camera",minZoom:K,maxZoom:re,minSize:m.evaluate(new yn(K)),maxSize:m.evaluate(new yn(re)),interpolationType:P}}}function vp(p,u,m){let C="never";const P=p.get(u);return P?C=P:p.get(m)&&(C="always"),C}const t_=Hu.VectorTileFeature.types,LI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sm(p,u,m,C,P,Q,V,K,re,he,h,c,f){const v=K?Math.min(Ih,Math.round(K[0])):0,E=K?Math.min(Ih,Math.round(K[1])):0;p.emplaceBack(u,m,Math.round(32*C),Math.round(32*P),Q,V,(v<<1)+(re?1:0),E,16*he,16*h,256*c,256*f)}function Tm(p,u,m){p.emplaceBack(u.x,u.y,m),p.emplaceBack(u.x,u.y,m),p.emplaceBack(u.x,u.y,m),p.emplaceBack(u.x,u.y,m)}function bp(p){for(const u of p.sections)if(Nc(u.text))return!0;return!1}class qc{constructor(u){this.layoutVertexArray=new pe,this.indexArray=new Ke,this.programConfigurations=u,this.segments=new bt,this.dynamicLayoutVertexArray=new xe,this.opacityVertexArray=new Fe,this.hasVisibleVertices=!1,this.placedSymbolArray=new _}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(u,m,C,P){this.isEmpty()||(C&&(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,_x.members),this.indexBuffer=u.createIndexBuffer(this.indexArray,m),this.dynamicLayoutVertexBuffer=u.createVertexBuffer(this.dynamicLayoutVertexArray,j0.members,!0),this.opacityVertexBuffer=u.createVertexBuffer(this.opacityVertexArray,LI,!0),this.opacityVertexBuffer.itemSize=1),(C||P)&&this.programConfigurations.upload(u))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Pi("SymbolBuffers",qc);class qu{constructor(u,m,C){this.layoutVertexArray=new u,this.layoutAttributes=m,this.indexArray=new C,this.segments=new bt,this.collisionVertexArray=new nt}upload(u){this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=u.createVertexBuffer(this.collisionVertexArray,vx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Pi("CollisionBuffers",qu);class WA{constructor(u){this.collisionBoxArray=u.collisionBoxArray,this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(V=>V.id),this.index=u.index,this.pixelRatio=u.pixelRatio,this.sourceLayerIndex=u.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=oA([]),this.placementViewportMatrix=oA([]);const m=this.layers[0]._unevaluatedLayout._values;this.textSizeData=e_(this.zoom,m["text-size"]),this.iconSizeData=e_(this.zoom,m["icon-size"]);const C=this.layers[0].layout,P=C.get("symbol-sort-key"),Q=C.get("symbol-z-order");this.canOverlap=vp(C,"text-overlap","text-allow-overlap")!=="never"||vp(C,"icon-overlap","icon-allow-overlap")!=="never"||C.get("text-ignore-placement")||C.get("icon-ignore-placement"),this.sortFeaturesByKey=Q!=="viewport-y"&&!P.isConstant(),this.sortFeaturesByY=(Q==="viewport-y"||Q==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,C.get("symbol-placement")==="point"&&(this.writingModes=C.get("text-writing-mode").map(V=>l.ah[V])),this.stateDependentLayerIds=this.layers.filter(V=>V.isStateDependent()).map(V=>V.id),this.sourceID=u.sourceID}createArrays(){this.text=new qc(new Mn(this.layers,this.zoom,u=>/^text/.test(u))),this.icon=new qc(new Mn(this.layers,this.zoom,u=>/^icon/.test(u))),this.glyphOffsetArray=new U,this.lineVertexArray=new H,this.symbolInstances=new S,this.textAnchorOffsets=new w}calculateGlyphDependencies(u,m,C,P,Q){for(let V=0;V<u.length;V++)if(m[u.charCodeAt(V)]=!0,(C||P)&&Q){const K=AA[u.charAt(V)];K&&(m[K.charCodeAt(0)]=!0)}}populate(u,m,C){const P=this.layers[0],Q=P.layout,V=Q.get("text-font"),K=Q.get("text-field"),re=Q.get("icon-image"),he=(K.value.kind!=="constant"||K.value.value instanceof lr&&!K.value.value.isEmpty()||K.value.value.toString().length>0)&&(V.value.kind!=="constant"||V.value.value.length>0),h=re.value.kind!=="constant"||!!re.value.value||Object.keys(re.parameters).length>0,c=Q.get("symbol-sort-key");if(this.features=[],!he&&!h)return;const f=m.iconDependencies,v=m.glyphDependencies,E=m.availableImages,M=new yn(this.zoom);for(const{feature:D,id:G,index:$,sourceLayerIndex:X}of u){const se=P._featureFilter.needGeometry,Ae=Ws(D,se);if(!P._featureFilter.filter(M,Ae,C))continue;let me,Be;if(se||(Ae.geometry=Os(D)),he){const ke=P.getValueAndResolveTokens("text-field",Ae,C,E),je=lr.factory(ke);bp(je)&&(this.hasRTLText=!0),(!this.hasRTLText||il.getRTLTextPluginStatus()==="unavailable"||this.hasRTLText&&il.isParsed())&&(me=CI(je,P,Ae))}if(h){const ke=P.getValueAndResolveTokens("icon-image",Ae,C,E);Be=ke instanceof xn?ke:xn.fromString(ke)}if(!me&&!Be)continue;const Te=this.sortFeaturesByKey?c.evaluate(Ae,{},C):void 0;if(this.features.push({id:G,text:me,icon:Be,index:$,sourceLayerIndex:X,geometry:Ae.geometry,properties:D.properties,type:t_[D.type],sortKey:Te}),Be&&(f[Be.name]=!0),me){const ke=V.evaluate(Ae,{},C).join(","),je=Q.get("text-rotation-alignment")!=="viewport"&&Q.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.ah.vertical)>=0;for(const $e of me.sections)if($e.image)f[$e.image.name]=!0;else{const ct=so(me.toString()),Ye=$e.fontStack||ke,tt=v[Ye]=v[Ye]||{};this.calculateGlyphDependencies($e.text,tt,je,this.allowVerticalPlacement,ct)}}}Q.get("symbol-placement")==="line"&&(this.features=function(D){const G={},$={},X=[];let se=0;function Ae(ke){X.push(D[ke]),se++}function me(ke,je,$e){const ct=$[ke];return delete $[ke],$[je]=ct,X[ct].geometry[0].pop(),X[ct].geometry[0]=X[ct].geometry[0].concat($e[0]),ct}function Be(ke,je,$e){const ct=G[je];return delete G[je],G[ke]=ct,X[ct].geometry[0].shift(),X[ct].geometry[0]=$e[0].concat(X[ct].geometry[0]),ct}function Te(ke,je,$e){const ct=$e?je[0][je[0].length-1]:je[0][0];return`${ke}:${ct.x}:${ct.y}`}for(let ke=0;ke<D.length;ke++){const je=D[ke],$e=je.geometry,ct=je.text?je.text.toString():null;if(!ct){Ae(ke);continue}const Ye=Te(ct,$e),tt=Te(ct,$e,!0);if(Ye in $&&tt in G&&$[Ye]!==G[tt]){const gt=Be(Ye,tt,$e),St=me(Ye,tt,X[gt].geometry);delete G[Ye],delete $[tt],$[Te(ct,X[St].geometry,!0)]=St,X[gt].geometry=null}else Ye in $?me(Ye,tt,$e):tt in G?Be(Ye,tt,$e):(Ae(ke),G[Ye]=se-1,$[tt]=se-1)}return X.filter(ke=>ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((D,G)=>D.sortKey-G.sortKey)}update(u,m,C){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(u,m,this.layers,C),this.icon.programConfigurations.updatePaintArrays(u,m,this.layers,C))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(u){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(u),this.iconCollisionBox.upload(u)),this.text.upload(u,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(u,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(u,m){const C=this.lineVertexArray.length;if(u.segment!==void 0){let P=u.dist(m[u.segment+1]),Q=u.dist(m[u.segment]);const V={};for(let K=u.segment+1;K<m.length;K++)V[K]={x:m[K].x,y:m[K].y,tileUnitDistanceFromAnchor:P},K<m.length-1&&(P+=m[K+1].dist(m[K]));for(let K=u.segment||0;K>=0;K--)V[K]={x:m[K].x,y:m[K].y,tileUnitDistanceFromAnchor:Q},K>0&&(Q+=m[K-1].dist(m[K]));for(let K=0;K<m.length;K++){const re=V[K];this.lineVertexArray.emplaceBack(re.x,re.y,re.tileUnitDistanceFromAnchor)}}return{lineStartIndex:C,lineLength:this.lineVertexArray.length-C}}addSymbols(u,m,C,P,Q,V,K,re,he,h,c,f){const v=u.indexArray,E=u.layoutVertexArray,M=u.segments.prepareSegment(4*m.length,E,v,this.canOverlap?V.sortKey:void 0),D=this.glyphOffsetArray.length,G=M.vertexLength,$=this.allowVerticalPlacement&&K===l.ah.vertical?Math.PI/2:0,X=V.text&&V.text.sections;for(let se=0;se<m.length;se++){const{tl:Ae,tr:me,bl:Be,br:Te,tex:ke,pixelOffsetTL:je,pixelOffsetBR:$e,minFontScaleX:ct,minFontScaleY:Ye,glyphOffset:tt,isSDF:gt,sectionIndex:St}=m[se],Xt=M.vertexLength,xi=tt[1];Sm(E,re.x,re.y,Ae.x,xi+Ae.y,ke.x,ke.y,C,gt,je.x,je.y,ct,Ye),Sm(E,re.x,re.y,me.x,xi+me.y,ke.x+ke.w,ke.y,C,gt,$e.x,je.y,ct,Ye),Sm(E,re.x,re.y,Be.x,xi+Be.y,ke.x,ke.y+ke.h,C,gt,je.x,$e.y,ct,Ye),Sm(E,re.x,re.y,Te.x,xi+Te.y,ke.x+ke.w,ke.y+ke.h,C,gt,$e.x,$e.y,ct,Ye),Tm(u.dynamicLayoutVertexArray,re,$),v.emplaceBack(Xt,Xt+1,Xt+2),v.emplaceBack(Xt+1,Xt+2,Xt+3),M.vertexLength+=4,M.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(tt[0]),se!==m.length-1&&St===m[se+1].sectionIndex||u.programConfigurations.populatePaintArrays(E.length,V,V.index,{},f,X&&X[St])}u.placedSymbolArray.emplaceBack(re.x,re.y,D,this.glyphOffsetArray.length-D,G,he,h,re.segment,C?C[0]:0,C?C[1]:0,P[0],P[1],K,0,!1,0,c)}_addCollisionDebugVertex(u,m,C,P,Q,V){return m.emplaceBack(0,0),u.emplaceBack(C.x,C.y,P,Q,Math.round(V.x),Math.round(V.y))}addCollisionDebugVertices(u,m,C,P,Q,V,K){const re=Q.segments.prepareSegment(4,Q.layoutVertexArray,Q.indexArray),he=re.vertexLength,h=Q.layoutVertexArray,c=Q.collisionVertexArray,f=K.anchorX,v=K.anchorY;this._addCollisionDebugVertex(h,c,V,f,v,new F(u,m)),this._addCollisionDebugVertex(h,c,V,f,v,new F(C,m)),this._addCollisionDebugVertex(h,c,V,f,v,new F(C,P)),this._addCollisionDebugVertex(h,c,V,f,v,new F(u,P)),re.vertexLength+=4;const E=Q.indexArray;E.emplaceBack(he,he+1),E.emplaceBack(he+1,he+2),E.emplaceBack(he+2,he+3),E.emplaceBack(he+3,he),re.primitiveLength+=4}addDebugCollisionBoxes(u,m,C,P){for(let Q=u;Q<m;Q++){const V=this.collisionBoxArray.get(Q);this.addCollisionDebugVertices(V.x1,V.y1,V.x2,V.y2,P?this.textCollisionBox:this.iconCollisionBox,V.anchorPoint,C)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new qu(Le,q0.members,Re),this.iconCollisionBox=new qu(Le,q0.members,Re);for(let u=0;u<this.symbolInstances.length;u++){const m=this.symbolInstances.get(u);this.addDebugCollisionBoxes(m.textBoxStartIndex,m.textBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.iconBoxStartIndex,m.iconBoxEndIndex,m,!1),this.addDebugCollisionBoxes(m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m,!1)}}_deserializeCollisionBoxesForSymbol(u,m,C,P,Q,V,K,re,he){const h={};for(let c=m;c<C;c++){const f=u.get(c);h.textBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},h.textFeatureIndex=f.featureIndex;break}for(let c=P;c<Q;c++){const f=u.get(c);h.verticalTextBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},h.verticalTextFeatureIndex=f.featureIndex;break}for(let c=V;c<K;c++){const f=u.get(c);h.iconBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},h.iconFeatureIndex=f.featureIndex;break}for(let c=re;c<he;c++){const f=u.get(c);h.verticalIconBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},h.verticalIconFeatureIndex=f.featureIndex;break}return h}deserializeCollisionBoxes(u){this.collisionArrays=[];for(let m=0;m<this.symbolInstances.length;m++){const C=this.symbolInstances.get(m);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(u,C.textBoxStartIndex,C.textBoxEndIndex,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C.iconBoxStartIndex,C.iconBoxEndIndex,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(u,m){const C=u.placedSymbolArray.get(m),P=C.vertexStartIndex+4*C.numGlyphs;for(let Q=C.vertexStartIndex;Q<P;Q+=4)u.indexArray.emplaceBack(Q,Q+1,Q+2),u.indexArray.emplaceBack(Q+1,Q+2,Q+3)}getSortedSymbolIndexes(u){if(this.sortedAngle===u&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const m=Math.sin(u),C=Math.cos(u),P=[],Q=[],V=[];for(let K=0;K<this.symbolInstances.length;++K){V.push(K);const re=this.symbolInstances.get(K);P.push(0|Math.round(m*re.anchorX+C*re.anchorY)),Q.push(re.featureIndex)}return V.sort((K,re)=>P[K]-P[re]||Q[re]-Q[K]),V}addToSortKeyRanges(u,m){const C=this.sortKeyRanges[this.sortKeyRanges.length-1];C&&C.sortKey===m?C.symbolInstanceEnd=u+1:this.sortKeyRanges.push({sortKey:m,symbolInstanceStart:u,symbolInstanceEnd:u+1})}sortFeatures(u){if(this.sortFeaturesByY&&this.sortedAngle!==u&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(u),this.sortedAngle=u,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const m of this.symbolInstanceIndexes){const C=this.symbolInstances.get(m);this.featureSortOrder.push(C.featureIndex),[C.rightJustifiedTextSymbolIndex,C.centerJustifiedTextSymbolIndex,C.leftJustifiedTextSymbolIndex].forEach((P,Q,V)=>{P>=0&&V.indexOf(P)===Q&&this.addIndicesForPlacedSymbol(this.text,P)}),C.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,C.verticalPlacedTextSymbolIndex),C.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.placedIconSymbolIndex),C.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Im,Fx;Pi("SymbolBucket",WA,{omit:["layers","collisionBoxArray","features","compareText"]}),WA.MAX_GLYPHS=65535,WA.addDynamicAttributes=Tm;var i_={get paint(){return Fx=Fx||new Es({"icon-opacity":new sr(xt.paint_symbol["icon-opacity"]),"icon-color":new sr(xt.paint_symbol["icon-color"]),"icon-halo-color":new sr(xt.paint_symbol["icon-halo-color"]),"icon-halo-width":new sr(xt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new sr(xt.paint_symbol["icon-halo-blur"]),"icon-translate":new bi(xt.paint_symbol["icon-translate"]),"icon-translate-anchor":new bi(xt.paint_symbol["icon-translate-anchor"]),"text-opacity":new sr(xt.paint_symbol["text-opacity"]),"text-color":new sr(xt.paint_symbol["text-color"],{runtimeType:Gt,getOverride:p=>p.textColor,hasOverride:p=>!!p.textColor}),"text-halo-color":new sr(xt.paint_symbol["text-halo-color"]),"text-halo-width":new sr(xt.paint_symbol["text-halo-width"]),"text-halo-blur":new sr(xt.paint_symbol["text-halo-blur"]),"text-translate":new bi(xt.paint_symbol["text-translate"]),"text-translate-anchor":new bi(xt.paint_symbol["text-translate-anchor"])})},get layout(){return Im=Im||new Es({"symbol-placement":new bi(xt.layout_symbol["symbol-placement"]),"symbol-spacing":new bi(xt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bi(xt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new sr(xt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bi(xt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new bi(xt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new bi(xt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new bi(xt.layout_symbol["icon-ignore-placement"]),"icon-optional":new bi(xt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bi(xt.layout_symbol["icon-rotation-alignment"]),"icon-size":new sr(xt.layout_symbol["icon-size"]),"icon-text-fit":new bi(xt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new bi(xt.layout_symbol["icon-text-fit-padding"]),"icon-image":new sr(xt.layout_symbol["icon-image"]),"icon-rotate":new sr(xt.layout_symbol["icon-rotate"]),"icon-padding":new sr(xt.layout_symbol["icon-padding"]),"icon-keep-upright":new bi(xt.layout_symbol["icon-keep-upright"]),"icon-offset":new sr(xt.layout_symbol["icon-offset"]),"icon-anchor":new sr(xt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bi(xt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bi(xt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bi(xt.layout_symbol["text-rotation-alignment"]),"text-field":new sr(xt.layout_symbol["text-field"]),"text-font":new sr(xt.layout_symbol["text-font"]),"text-size":new sr(xt.layout_symbol["text-size"]),"text-max-width":new sr(xt.layout_symbol["text-max-width"]),"text-line-height":new bi(xt.layout_symbol["text-line-height"]),"text-letter-spacing":new sr(xt.layout_symbol["text-letter-spacing"]),"text-justify":new sr(xt.layout_symbol["text-justify"]),"text-radial-offset":new sr(xt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bi(xt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new sr(xt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new sr(xt.layout_symbol["text-anchor"]),"text-max-angle":new bi(xt.layout_symbol["text-max-angle"]),"text-writing-mode":new bi(xt.layout_symbol["text-writing-mode"]),"text-rotate":new sr(xt.layout_symbol["text-rotate"]),"text-padding":new bi(xt.layout_symbol["text-padding"]),"text-keep-upright":new bi(xt.layout_symbol["text-keep-upright"]),"text-transform":new sr(xt.layout_symbol["text-transform"]),"text-offset":new sr(xt.layout_symbol["text-offset"]),"text-allow-overlap":new bi(xt.layout_symbol["text-allow-overlap"]),"text-overlap":new bi(xt.layout_symbol["text-overlap"]),"text-ignore-placement":new bi(xt.layout_symbol["text-ignore-placement"]),"text-optional":new bi(xt.layout_symbol["text-optional"])})}};class xp{constructor(u){if(u.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=u.property.overrides?u.property.overrides.runtimeType:Zi,this.defaultValue=u}evaluate(u){if(u.formattedSection){const m=this.defaultValue.property.overrides;if(m&&m.hasOverride(u.formattedSection))return m.getOverride(u.formattedSection)}return u.feature&&u.featureState?this.defaultValue.evaluate(u.feature,u.featureState):this.defaultValue.property.specification.default}eachChild(u){this.defaultValue.isConstant()||u(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pi("FormatSectionOverride",xp,{omit:["defaultValue"]});class Jd extends qn{constructor(u){super(u,i_)}recalculate(u,m){if(super.recalculate(u,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const C=this.layout.get("text-writing-mode");if(C){const P=[];for(const Q of C)P.indexOf(Q)<0&&P.push(Q);this.layout._values["text-writing-mode"]=P}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(u,m,C,P){const Q=this.layout.get(u).evaluate(m,{},C,P),V=this._unevaluatedLayout._values[u];return V.isDataDriven()||Lr(V.value)||!Q?Q:function(K,re){return re.replace(/{([^{}]+)}/g,(he,h)=>K&&h in K?String(K[h]):"")}(m.properties,Q)}createBucket(u){return new WA(u)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const u of i_.paint.overridableProperties){if(!Jd.hasPaintOverride(this.layout,u))continue;const m=this.paint.get(u),C=new xp(m),P=new Br(C,m.property.specification);let Q=null;Q=m.value.kind==="constant"||m.value.kind==="source"?new $s("source",P):new to("composite",P,m.value.zoomStops),this.paint._values[u]=new _a(m.property,Q,m.parameters)}}_handleOverridablePaintPropertyUpdate(u,m,C){return!(!this.layout||m.isDataDriven()||C.isDataDriven())&&Jd.hasPaintOverride(this.layout,u)}static hasPaintOverride(u,m){const C=u.get("text-field"),P=i_.paint.properties[m];let Q=!1;const V=K=>{for(const re of K)if(P.overrides&&P.overrides.hasOverride(re))return void(Q=!0)};if(C.value.kind==="constant"&&C.value.value instanceof lr)V(C.value.value.sections);else if(C.value.kind==="source"){const K=he=>{Q||(he instanceof Bs&&Wi(he.value)===Sr?V(he.value.sections):he instanceof el?V(he.sections):he.eachChild(K))},re=C.value;re._styleExpression&&K(re._styleExpression.expression)}return Q}}let Dx;var r_={get paint(){return Dx=Dx||new Es({"background-color":new bi(xt.paint_background["background-color"]),"background-pattern":new zc(xt.paint_background["background-pattern"]),"background-opacity":new bi(xt.paint_background["background-opacity"])})}};class n_ extends qn{constructor(u){super(u,r_)}}let XA;var Rx={get paint(){return XA=XA||new Es({"raster-opacity":new bi(xt.paint_raster["raster-opacity"]),"raster-hue-rotate":new bi(xt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bi(xt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bi(xt.paint_raster["raster-brightness-max"]),"raster-saturation":new bi(xt.paint_raster["raster-saturation"]),"raster-contrast":new bi(xt.paint_raster["raster-contrast"]),"raster-resampling":new bi(xt.paint_raster["raster-resampling"]),"raster-fade-duration":new bi(xt.paint_raster["raster-fade-duration"])})}};class kx extends qn{constructor(u){super(u,Rx)}}class s_ extends qn{constructor(u){super(u,{}),this.onAdd=m=>{this.implementation.onAdd&&this.implementation.onAdd(m,m.painter.context.gl)},this.onRemove=m=>{this.implementation.onRemove&&this.implementation.onRemove(m,m.painter.context.gl)},this.implementation=u}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Ox{constructor(u){this._methodToThrottle=u,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Yd=63710088e-1;class Lh{constructor(u,m){if(isNaN(u)||isNaN(m))throw new Error(`Invalid LngLat object: (${u}, ${m})`);if(this.lng=+u,this.lat=+m,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Lh(Ve(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(u){const m=Math.PI/180,C=this.lat*m,P=u.lat*m,Q=Math.sin(C)*Math.sin(P)+Math.cos(C)*Math.cos(P)*Math.cos((u.lng-this.lng)*m);return Yd*Math.acos(Math.min(Q,1))}static convert(u){if(u instanceof Lh)return u;if(Array.isArray(u)&&(u.length===2||u.length===3))return new Lh(Number(u[0]),Number(u[1]));if(!Array.isArray(u)&&typeof u=="object"&&u!==null)return new Lh(Number("lng"in u?u.lng:u.lon),Number(u.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ux=2*Math.PI*Yd;function Nx(p){return Ux*Math.cos(p*Math.PI/180)}function o_(p){return(180+p)/360}function zx(p){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+p*Math.PI/360)))/360}function Qx(p,u){return p/Nx(u)}function a_(p){return 360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90}class Lm{constructor(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+u,this.y=+m,this.z=+C}static fromLngLat(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const C=Lh.convert(u);return new Lm(o_(C.lng),zx(C.lat),Qx(m,C.lat))}toLngLat(){return new Lh(360*this.x-180,a_(this.y))}toAltitude(){return this.z*Nx(a_(this.y))}meterInMercatorCoordinateUnits(){return 1/Ux*(u=a_(this.y),1/Math.cos(u*Math.PI/180));var u}}function Mm(p,u,m){var C=2*Math.PI*6378137/256/Math.pow(2,m);return[p*C-2*Math.PI*6378137/2,u*C-2*Math.PI*6378137/2]}class $u{constructor(u,m,C){if(u<0||u>25||C<0||C>=Math.pow(2,u)||m<0||m>=Math.pow(2,u))throw new Error(`x=${m}, y=${C}, z=${u} outside of bounds. 0<=x<${Math.pow(2,u)}, 0<=y<${Math.pow(2,u)} 0<=z<=25 `);this.z=u,this.x=m,this.y=C,this.key=ef(0,u,u,m,C)}equals(u){return this.z===u.z&&this.x===u.x&&this.y===u.y}url(u,m,C){const P=(V=this.y,K=this.z,re=Mm(256*(Q=this.x),256*(V=Math.pow(2,K)-V-1),K),he=Mm(256*(Q+1),256*(V+1),K),re[0]+","+re[1]+","+he[0]+","+he[1]);var Q,V,K,re,he;const h=function(c,f,v){let E,M="";for(let D=c;D>0;D--)E=1<<D-1,M+=(f&E?1:0)+(v&E?2:0);return M}(this.z,this.x,this.y);return u[(this.x+this.y)%u.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(C==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,m>1?"@2x":"").replace(/{quadkey}/g,h).replace(/{bbox-epsg-3857}/g,P)}isChildOf(u){const m=this.z-u.z;return m>0&&u.x===this.x>>m&&u.y===this.y>>m}getTilePoint(u){const m=Math.pow(2,this.z);return new F((u.x*m-this.x)*$r,(u.y*m-this.y)*$r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class l_{constructor(u,m){this.wrap=u,this.canonical=m,this.key=ef(u,m.z,m.z,m.x,m.y)}}class ec{constructor(u,m,C,P,Q){if(u<C)throw new Error(`overscaledZ should be >= z; overscaledZ = ${u}; z = ${C}`);this.overscaledZ=u,this.wrap=m,this.canonical=new $u(C,+P,+Q),this.key=ef(m,u,C,P,Q)}clone(){return new ec(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(u){return this.overscaledZ===u.overscaledZ&&this.wrap===u.wrap&&this.canonical.equals(u.canonical)}scaledTo(u){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-u;return u>this.canonical.z?new ec(u,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ec(u,this.wrap,u,this.canonical.x>>m,this.canonical.y>>m)}calculateScaledKey(u,m){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const C=this.canonical.z-u;return u>this.canonical.z?ef(this.wrap*+m,u,this.canonical.z,this.canonical.x,this.canonical.y):ef(this.wrap*+m,u,u,this.canonical.x>>C,this.canonical.y>>C)}isChildOf(u){if(u.wrap!==this.wrap)return!1;const m=this.canonical.z-u.canonical.z;return u.overscaledZ===0||u.overscaledZ<this.overscaledZ&&u.canonical.x===this.canonical.x>>m&&u.canonical.y===this.canonical.y>>m}children(u){if(this.overscaledZ>=u)return[new ec(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const m=this.canonical.z+1,C=2*this.canonical.x,P=2*this.canonical.y;return[new ec(m,this.wrap,m,C,P),new ec(m,this.wrap,m,C+1,P),new ec(m,this.wrap,m,C,P+1),new ec(m,this.wrap,m,C+1,P+1)]}isLessThan(u){return this.wrap<u.wrap||!(this.wrap>u.wrap)&&(this.overscaledZ<u.overscaledZ||!(this.overscaledZ>u.overscaledZ)&&(this.canonical.x<u.canonical.x||!(this.canonical.x>u.canonical.x)&&this.canonical.y<u.canonical.y))}wrapped(){return new ec(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(u){return new ec(this.overscaledZ,u,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new l_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(u){return this.canonical.getTilePoint(new Lm(u.x-this.wrap,u.y))}}function ef(p,u,m,C,P){(p*=2)<0&&(p=-1*p-1);const Q=1<<m;return(Q*Q*p+Q*P+C).toString(36)+m.toString(36)+u.toString(36)}Pi("CanonicalTileID",$u),Pi("OverscaledTileID",ec,{omit:["posMatrix"]});class c_{constructor(u,m,C){let P=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,V=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,K=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=u,m.height!==m.width)throw new RangeError("DEM tiles must be square");if(C&&!["mapbox","terrarium","custom"].includes(C))return void Ze(`"${C}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=m.height;const re=this.dim=m.height-2;switch(this.data=new Uint32Array(m.data.buffer),C){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=P,this.greenFactor=Q,this.blueFactor=V,this.baseShift=K;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let he=0;he<re;he++)this.data[this._idx(-1,he)]=this.data[this._idx(0,he)],this.data[this._idx(re,he)]=this.data[this._idx(re-1,he)],this.data[this._idx(he,-1)]=this.data[this._idx(he,0)],this.data[this._idx(he,re)]=this.data[this._idx(he,re-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(re,-1)]=this.data[this._idx(re-1,0)],this.data[this._idx(-1,re)]=this.data[this._idx(0,re-1)],this.data[this._idx(re,re)]=this.data[this._idx(re-1,re-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let he=0;he<re;he++)for(let h=0;h<re;h++){const c=this.get(he,h);c>this.max&&(this.max=c),c<this.min&&(this.min=c)}}get(u,m){const C=new Uint8Array(this.data.buffer),P=4*this._idx(u,m);return this.unpack(C[P],C[P+1],C[P+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(u,m){if(u<-1||u>=this.dim+1||m<-1||m>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(m+1)*this.stride+(u+1)}unpack(u,m,C){return u*this.redFactor+m*this.greenFactor+C*this.blueFactor-this.baseShift}getPixels(){return new bl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(u,m,C){if(this.dim!==u.dim)throw new Error("dem dimension mismatch");let P=m*this.dim,Q=m*this.dim+this.dim,V=C*this.dim,K=C*this.dim+this.dim;switch(m){case-1:P=Q-1;break;case 1:Q=P+1}switch(C){case-1:V=K-1;break;case 1:K=V+1}const re=-m*this.dim,he=-C*this.dim;for(let h=V;h<K;h++)for(let c=P;c<Q;c++)this.data[this._idx(c,h)]=u.data[this._idx(c+re,h+he)]}}Pi("DEMData",c_);class u_{constructor(u){this._stringToNumber={},this._numberToString=[];for(let m=0;m<u.length;m++){const C=u[m];this._stringToNumber[C]=m,this._numberToString[m]=C}}encode(u){return this._stringToNumber[u]}decode(u){if(u>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${u} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[u]}}class h_{constructor(u,m,C,P,Q){this.type="Feature",this._vectorTileFeature=u,u._z=m,u._x=C,u._y=P,this.properties=u.properties,this.id=Q}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(u){this._geometry=u}toJSON(){const u={geometry:this.geometry};for(const m in this)m!=="_geometry"&&m!=="_vectorTileFeature"&&(u[m]=this[m]);return u}}class Pm{constructor(u,m){this.tileID=u,this.x=u.canonical.x,this.y=u.canonical.y,this.z=u.canonical.z,this.grid=new Oi($r,16,0),this.grid3D=new Oi($r,16,0),this.featureIndexArray=new R,this.promoteId=m}insert(u,m,C,P,Q,V){const K=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(C,P,Q);const re=V?this.grid3D:this.grid;for(let he=0;he<m.length;he++){const h=m[he],c=[1/0,1/0,-1/0,-1/0];for(let f=0;f<h.length;f++){const v=h[f];c[0]=Math.min(c[0],v.x),c[1]=Math.min(c[1],v.y),c[2]=Math.max(c[2],v.x),c[3]=Math.max(c[3],v.y)}c[0]<$r&&c[1]<$r&&c[2]>=0&&c[3]>=0&&re.insert(K,c[0],c[1],c[2],c[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Hu.VectorTile(new X0(this.rawTileData)).layers,this.sourceLayerCoder=new u_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(u,m,C,P){this.loadVTLayers();const Q=u.params||{},V=$r/u.tileSize/u.scale,K=jl(Q.filter),re=u.queryGeometry,he=u.queryPadding*V,h=A_(re),c=this.grid.query(h.minX-he,h.minY-he,h.maxX+he,h.maxY+he),f=A_(u.cameraQueryGeometry),v=this.grid3D.query(f.minX-he,f.minY-he,f.maxX+he,f.maxY+he,(D,G,$,X)=>function(se,Ae,me,Be,Te){for(const je of se)if(Ae<=je.x&&me<=je.y&&Be>=je.x&&Te>=je.y)return!0;const ke=[new F(Ae,me),new F(Ae,Te),new F(Be,Te),new F(Be,me)];if(se.length>2){for(const je of ke)if(Gc(se,je))return!0}for(let je=0;je<se.length-1;je++)if(GA(se[je],se[je+1],ke))return!0;return!1}(u.cameraQueryGeometry,D-he,G-he,$+he,X+he));for(const D of v)c.push(D);c.sort(d_);const E={};let M;for(let D=0;D<c.length;D++){const G=c[D];if(G===M)continue;M=G;const $=this.featureIndexArray.get(G);let X=null;this.loadMatchingFeature(E,$.bucketIndex,$.sourceLayerIndex,$.featureIndex,K,Q.layers,Q.availableImages,m,C,P,(se,Ae,me)=>(X||(X=Os(se)),Ae.queryIntersectsFeature(re,se,me,X,this.z,u.transform,V,u.pixelPosMatrix)))}return E}loadMatchingFeature(u,m,C,P,Q,V,K,re,he,h,c){const f=this.bucketLayerIDs[m];if(V&&!function(D,G){for(let $=0;$<D.length;$++)if(G.indexOf(D[$])>=0)return!0;return!1}(V,f))return;const v=this.sourceLayerCoder.decode(C),E=this.vtLayers[v].feature(P);if(Q.needGeometry){const D=Ws(E,!0);if(!Q.filter(new yn(this.tileID.overscaledZ),D,this.tileID.canonical))return}else if(!Q.filter(new yn(this.tileID.overscaledZ),E))return;const M=this.getId(E,v);for(let D=0;D<f.length;D++){const G=f[D];if(V&&V.indexOf(G)<0)continue;const $=re[G];if(!$)continue;let X={};M&&h&&(X=h.getState($.sourceLayer||"_geojsonTileLayer",M));const se=qe({},he[G]);se.paint=wp(se.paint,$.paint,E,X,K),se.layout=wp(se.layout,$.layout,E,X,K);const Ae=!c||c(E,$,X);if(!Ae)continue;const me=new h_(E,this.z,this.x,this.y,M);me.layer=se;let Be=u[G];Be===void 0&&(Be=u[G]=[]),Be.push({featureIndex:P,feature:me,intersectionZ:Ae})}}lookupSymbolFeatures(u,m,C,P,Q,V,K,re){const he={};this.loadVTLayers();const h=jl(Q);for(const c of u)this.loadMatchingFeature(he,C,P,c,h,V,K,re,m);return he}hasLayer(u){for(const m of this.bucketLayerIDs)for(const C of m)if(u===C)return!0;return!1}getId(u,m){let C=u.id;return this.promoteId&&(C=u.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[m]],typeof C=="boolean"&&(C=Number(C))),C}}function wp(p,u,m,C,P){return ot(p,(Q,V)=>{const K=u instanceof Ks?u.get(V):null;return K&&K.evaluate?K.evaluate(m,C,P):K})}function A_(p){let u=1/0,m=1/0,C=-1/0,P=-1/0;for(const Q of p)u=Math.min(u,Q.x),m=Math.min(m,Q.y),C=Math.max(C,Q.x),P=Math.max(P,Q.y);return{minX:u,minY:m,maxX:C,maxY:P}}function d_(p,u){return u-p}function f_(p,u,m,C,P){const Q=[];for(let V=0;V<p.length;V++){const K=p[V];let re;for(let he=0;he<K.length-1;he++){let h=K[he],c=K[he+1];h.x<u&&c.x<u||(h.x<u?h=new F(u,h.y+(u-h.x)/(c.x-h.x)*(c.y-h.y))._round():c.x<u&&(c=new F(u,h.y+(u-h.x)/(c.x-h.x)*(c.y-h.y))._round()),h.y<m&&c.y<m||(h.y<m?h=new F(h.x+(m-h.y)/(c.y-h.y)*(c.x-h.x),m)._round():c.y<m&&(c=new F(h.x+(m-h.y)/(c.y-h.y)*(c.x-h.x),m)._round()),h.x>=C&&c.x>=C||(h.x>=C?h=new F(C,h.y+(C-h.x)/(c.x-h.x)*(c.y-h.y))._round():c.x>=C&&(c=new F(C,h.y+(C-h.x)/(c.x-h.x)*(c.y-h.y))._round()),h.y>=P&&c.y>=P||(h.y>=P?h=new F(h.x+(P-h.y)/(c.y-h.y)*(c.x-h.x),P)._round():c.y>=P&&(c=new F(h.x+(P-h.y)/(c.y-h.y)*(c.x-h.x),P)._round()),re&&h.equals(re[re.length-1])||(re=[h],Q.push(re)),re.push(c)))))}}return Q}Pi("FeatureIndex",Pm,{omit:["rawTileData","sourceLayerCoder"]});class zo extends F{constructor(u,m,C,P){super(u,m),this.angle=C,P!==void 0&&(this.segment=P)}clone(){return new zo(this.x,this.y,this.angle,this.segment)}}function tf(p,u,m,C,P){if(u.segment===void 0||m===0)return!0;let Q=u,V=u.segment+1,K=0;for(;K>-m/2;){if(V--,V<0)return!1;K-=p[V].dist(Q),Q=p[V]}K+=p[V].dist(p[V+1]),V++;const re=[];let he=0;for(;K<m/2;){const h=p[V],c=p[V+1];if(!c)return!1;let f=p[V-1].angleTo(h)-h.angleTo(c);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),re.push({distance:K,angleDelta:f}),he+=f;K-re[0].distance>C;)he-=re.shift().angleDelta;if(he>P)return!1;V++,K+=h.dist(c)}return!0}function p_(p){let u=0;for(let m=0;m<p.length-1;m++)u+=p[m].dist(p[m+1]);return u}function g_(p,u,m){return p?.6*u*m:0}function m_(p,u){return Math.max(p?p.right-p.left:0,u?u.right-u.left:0)}function Vx(p,u,m,C,P,Q){const V=g_(m,P,Q),K=m_(m,C)*Q;let re=0;const he=p_(p)/2;for(let h=0;h<p.length-1;h++){const c=p[h],f=p[h+1],v=c.dist(f);if(re+v>he){const E=(he-re)/v,M=dn.number(c.x,f.x,E),D=dn.number(c.y,f.y,E),G=new zo(M,D,f.angleTo(c),h);return G._round(),!V||tf(p,G,K,V,u)?G:void 0}re+=v}}function Hx(p,u,m,C,P,Q,V,K,re){const he=g_(C,Q,V),h=m_(C,P),c=h*V,f=p[0].x===0||p[0].x===re||p[0].y===0||p[0].y===re;return u-c<u/4&&(u=c+u/4),y_(p,f?u/2*K%u:(h/2+2*Q)*V*K%u,u,he,m,c,f,!1,re)}function y_(p,u,m,C,P,Q,V,K,re){const he=Q/2,h=p_(p);let c=0,f=u-m,v=[];for(let E=0;E<p.length-1;E++){const M=p[E],D=p[E+1],G=M.dist(D),$=D.angleTo(M);for(;f+m<c+G;){f+=m;const X=(f-c)/G,se=dn.number(M.x,D.x,X),Ae=dn.number(M.y,D.y,X);if(se>=0&&se<re&&Ae>=0&&Ae<re&&f-he>=0&&f+he<=h){const me=new zo(se,Ae,$,E);me._round(),C&&!tf(p,me,Q,C,P)||v.push(me)}}c+=G}return K||v.length||V||(v=y_(p,c/2,m,C,P,Q,V,!0,re)),v}Pi("Anchor",zo);const rf=No;function __(p,u,m,C){const P=[],Q=p.image,V=Q.pixelRatio,K=Q.paddedRect.w-2*rf,re=Q.paddedRect.h-2*rf,he=p.right-p.left,h=p.bottom-p.top,c=Q.stretchX||[[0,K]],f=Q.stretchY||[[0,re]],v=($e,ct)=>$e+ct[1]-ct[0],E=c.reduce(v,0),M=f.reduce(v,0),D=K-E,G=re-M;let $=0,X=E,se=0,Ae=M,me=0,Be=D,Te=0,ke=G;if(Q.content&&C){const $e=Q.content;$=yu(c,0,$e[0]),se=yu(f,0,$e[1]),X=yu(c,$e[0],$e[2]),Ae=yu(f,$e[1],$e[3]),me=$e[0]-$,Te=$e[1]-se,Be=$e[2]-$e[0]-X,ke=$e[3]-$e[1]-Ae}const je=($e,ct,Ye,tt)=>{const gt=Bp($e.stretch-$,X,he,p.left),St=Cp($e.fixed-me,Be,$e.stretch,E),Xt=Bp(ct.stretch-se,Ae,h,p.top),xi=Cp(ct.fixed-Te,ke,ct.stretch,M),oi=Bp(Ye.stretch-$,X,he,p.left),Ai=Cp(Ye.fixed-me,Be,Ye.stretch,E),fi=Bp(tt.stretch-se,Ae,h,p.top),Fi=Cp(tt.fixed-Te,ke,tt.stretch,M),ai=new F(gt,Xt),Zt=new F(oi,Xt),Vi=new F(oi,fi),Qi=new F(gt,fi),gr=new F(St/V,xi/V),Dr=new F(Ai/V,Fi/V),zr=u*Math.PI/180;if(zr){const zn=Math.sin(zr),vn=Math.cos(zr),Pn=[vn,-zn,zn,vn];ai._matMult(Pn),Zt._matMult(Pn),Qi._matMult(Pn),Vi._matMult(Pn)}const pn=$e.stretch+$e.fixed,as=ct.stretch+ct.fixed;return{tl:ai,tr:Zt,bl:Qi,br:Vi,tex:{x:Q.paddedRect.x+rf+pn,y:Q.paddedRect.y+rf+as,w:Ye.stretch+Ye.fixed-pn,h:tt.stretch+tt.fixed-as},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gr,pixelOffsetBR:Dr,minFontScaleX:Be/V/he,minFontScaleY:ke/V/h,isSDF:m}};if(C&&(Q.stretchX||Q.stretchY)){const $e=v_(c,D,E),ct=v_(f,G,M);for(let Ye=0;Ye<$e.length-1;Ye++){const tt=$e[Ye],gt=$e[Ye+1];for(let St=0;St<ct.length-1;St++)P.push(je(tt,ct[St],gt,ct[St+1]))}}else P.push(je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:K+1},{fixed:0,stretch:re+1}));return P}function yu(p,u,m){let C=0;for(const P of p)C+=Math.max(u,Math.min(m,P[1]))-Math.max(u,Math.min(m,P[0]));return C}function v_(p,u,m){const C=[{fixed:-rf,stretch:0}];for(const[P,Q]of p){const V=C[C.length-1];C.push({fixed:P-V.stretch,stretch:V.stretch}),C.push({fixed:P-V.stretch,stretch:V.stretch+(Q-P)})}return C.push({fixed:u+rf,stretch:m}),C}function Bp(p,u,m,C){return p/u*m+C}function Cp(p,u,m,C){return p-u*m/C}class Ep{constructor(u,m,C,P,Q,V,K,re,he,h){if(this.boxStartIndex=u.length,he){let c=V.top,f=V.bottom;const v=V.collisionPadding;v&&(c-=v[1],f+=v[3]);let E=f-c;E>0&&(E=Math.max(10,E),this.circleDiameter=E)}else{let c=V.top*K-re[0],f=V.bottom*K+re[2],v=V.left*K-re[3],E=V.right*K+re[1];const M=V.collisionPadding;if(M&&(v-=M[0]*K,c-=M[1]*K,E+=M[2]*K,f+=M[3]*K),h){const D=new F(v,c),G=new F(E,c),$=new F(v,f),X=new F(E,f),se=h*Math.PI/180;D._rotate(se),G._rotate(se),$._rotate(se),X._rotate(se),v=Math.min(D.x,G.x,$.x,X.x),E=Math.max(D.x,G.x,$.x,X.x),c=Math.min(D.y,G.y,$.y,X.y),f=Math.max(D.y,G.y,$.y,X.y)}u.emplaceBack(m.x,m.y,v,c,E,f,C,P,Q)}this.boxEndIndex=u.length}}class MI{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:PI;if(this.data=u,this.length=this.data.length,this.compare=m,this.length>0)for(let C=(this.length>>1)-1;C>=0;C--)this._down(C)}push(u){this.data.push(u),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const u=this.data[0],m=this.data.pop();return this.length--,this.length>0&&(this.data[0]=m,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:m,compare:C}=this,P=m[u];for(;u>0;){const Q=u-1>>1,V=m[Q];if(C(P,V)>=0)break;m[u]=V,u=Q}m[u]=P}_down(u){const{data:m,compare:C}=this,P=this.length>>1,Q=m[u];for(;u<P;){let V=1+(u<<1),K=m[V];const re=V+1;if(re<this.length&&C(m[re],K)<0&&(V=re,K=m[re]),C(K,Q)>=0)break;m[u]=K,u=V}m[u]=Q}}function PI(p,u){return p<u?-1:p>u?1:0}function Gx(p){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,C=1/0,P=1/0,Q=-1/0,V=-1/0;const K=p[0];for(let v=0;v<K.length;v++){const E=K[v];(!v||E.x<C)&&(C=E.x),(!v||E.y<P)&&(P=E.y),(!v||E.x>Q)&&(Q=E.x),(!v||E.y>V)&&(V=E.y)}const re=Math.min(Q-C,V-P);let he=re/2;const h=new MI([],nf);if(re===0)return new F(C,P);for(let v=C;v<Q;v+=re)for(let E=P;E<V;E+=re)h.push(new ZA(v+he,E+he,he,p));let c=function(v){let E=0,M=0,D=0;const G=v[0];for(let $=0,X=G.length,se=X-1;$<X;se=$++){const Ae=G[$],me=G[se],Be=Ae.x*me.y-me.x*Ae.y;M+=(Ae.x+me.x)*Be,D+=(Ae.y+me.y)*Be,E+=3*Be}return new ZA(M/E,D/E,0,v)}(p),f=h.length;for(;h.length;){const v=h.pop();(v.d>c.d||!c.d)&&(c=v,m&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,f)),v.max-c.d<=u||(he=v.h/2,h.push(new ZA(v.p.x-he,v.p.y-he,he,p)),h.push(new ZA(v.p.x+he,v.p.y-he,he,p)),h.push(new ZA(v.p.x-he,v.p.y+he,he,p)),h.push(new ZA(v.p.x+he,v.p.y+he,he,p)),f+=4)}return m&&(console.log(`num probes: ${f}`),console.log(`best distance: ${c.d}`)),c.p}function nf(p,u){return u.max-p.max}function ZA(p,u,m,C){this.p=new F(p,u),this.h=m,this.d=function(P,Q){let V=!1,K=1/0;for(let re=0;re<Q.length;re++){const he=Q[re];for(let h=0,c=he.length,f=c-1;h<c;f=h++){const v=he[h],E=he[f];v.y>P.y!=E.y>P.y&&P.x<(E.x-v.x)*(P.y-v.y)/(E.y-v.y)+v.x&&(V=!V),K=Math.min(K,zu(P,v,E))}}return(V?1:-1)*Math.sqrt(K)}(this.p,C),this.max=this.d+this.h*Math.SQRT2}var vo;l.ap=void 0,(vo=l.ap||(l.ap={}))[vo.center=1]="center",vo[vo.left=2]="left",vo[vo.right=3]="right",vo[vo.top=4]="top",vo[vo.bottom=5]="bottom",vo[vo["top-left"]=6]="top-left",vo[vo["top-right"]=7]="top-right",vo[vo["bottom-left"]=8]="bottom-left",vo[vo["bottom-right"]=9]="bottom-right";const Mh=7,sf=Number.POSITIVE_INFINITY;function Sp(p,u){return u[1]!==sf?function(m,C,P){let Q=0,V=0;switch(C=Math.abs(C),P=Math.abs(P),m){case"top-right":case"top-left":case"top":V=P-Mh;break;case"bottom-right":case"bottom-left":case"bottom":V=-P+Mh}switch(m){case"top-right":case"bottom-right":case"right":Q=-C;break;case"top-left":case"bottom-left":case"left":Q=C}return[Q,V]}(p,u[0],u[1]):function(m,C){let P=0,Q=0;C<0&&(C=0);const V=C/Math.SQRT2;switch(m){case"top-right":case"top-left":Q=V-Mh;break;case"bottom-right":case"bottom-left":Q=-V+Mh;break;case"bottom":Q=-C+Mh;break;case"top":Q=C-Mh}switch(m){case"top-right":case"bottom-right":P=-V;break;case"top-left":case"bottom-left":P=V;break;case"left":P=C;break;case"right":P=-C}return[P,Q]}(p,u[0])}function Tp(p,u,m){var C;const P=p.layout,Q=(C=P.get("text-variable-anchor-offset"))===null||C===void 0?void 0:C.evaluate(u,{},m);if(Q){const K=Q.values,re=[];for(let he=0;he<K.length;he+=2){const h=re[he]=K[he],c=K[he+1].map(f=>f*_o);h.startsWith("top")?c[1]-=Mh:h.startsWith("bottom")&&(c[1]+=Mh),re[he+1]=c}return new Qr(re)}const V=P.get("text-variable-anchor");if(V){let K;K=p._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[P.get("text-radial-offset").evaluate(u,{},m)*_o,sf]:P.get("text-offset").evaluate(u,{},m).map(he=>he*_o);const re=[];for(const he of V)re.push(he,Sp(he,K));return new Qr(re)}return null}function b_(p){switch(p){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function FI(p,u,m,C,P,Q,V,K,re,he,h){let c=Q.textMaxSize.evaluate(u,{});c===void 0&&(c=V);const f=p.layers[0].layout,v=f.get("icon-offset").evaluate(u,{},h),E=qx(m.horizontal),M=V/24,D=p.tilePixelRatio*M,G=p.tilePixelRatio*c/24,$=p.tilePixelRatio*K,X=p.tilePixelRatio*f.get("symbol-spacing"),se=f.get("text-padding")*p.tilePixelRatio,Ae=function(tt,gt,St){let Xt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const xi=tt.get("icon-padding").evaluate(gt,{},St),oi=xi&&xi.values;return[oi[0]*Xt,oi[1]*Xt,oi[2]*Xt,oi[3]*Xt]}(f,u,h,p.tilePixelRatio),me=f.get("text-max-angle")/180*Math.PI,Be=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",Te=f.get("icon-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point",ke=f.get("symbol-placement"),je=X/2,$e=f.get("icon-text-fit");let ct;C&&$e!=="none"&&(p.allowVerticalPlacement&&m.vertical&&(ct=Y0(C,m.vertical,$e,f.get("icon-text-fit-padding"),v,M)),E&&(C=Y0(C,E,$e,f.get("icon-text-fit-padding"),v,M)));const Ye=(tt,gt)=>{gt.x<0||gt.x>=$r||gt.y<0||gt.y>=$r||function(St,Xt,xi,oi,Ai,fi,Fi,ai,Zt,Vi,Qi,gr,Dr,zr,pn,as,zn,vn,Pn,cn,vr,Qn,un,en,fs){const Ts=St.addToLineVertexArray(Xt,xi);let vs,Zs,Is,Fn,xr=0,Ns=0,ao=0,lo=0,tc=-1,vc=-1;const na={};let Wu=Ti("");if(St.allowVerticalPlacement&&oi.vertical){const Oa=ai.layout.get("text-rotate").evaluate(vr,{},en)+90;Is=new Ep(Zt,Xt,Vi,Qi,gr,oi.vertical,Dr,zr,pn,Oa),Fi&&(Fn=new Ep(Zt,Xt,Vi,Qi,gr,Fi,zn,vn,pn,Oa))}if(Ai){const Oa=ai.layout.get("icon-rotate").evaluate(vr,{}),wc=ai.layout.get("icon-text-fit")!=="none",JA=__(Ai,Oa,un,wc),_u=Fi?__(Fi,Oa,un,wc):void 0;Zs=new Ep(Zt,Xt,Vi,Qi,gr,Ai,zn,vn,!1,Oa),xr=4*JA.length;const Ua=St.iconSizeData;let Bc=null;Ua.kind==="source"?(Bc=[ju*ai.layout.get("icon-size").evaluate(vr,{})],Bc[0]>Ih&&Ze(`${St.layerIds[0]}: Value for "icon-size" is >= ${Zd}. Reduce your "icon-size".`)):Ua.kind==="composite"&&(Bc=[ju*Qn.compositeIconSizes[0].evaluate(vr,{},en),ju*Qn.compositeIconSizes[1].evaluate(vr,{},en)],(Bc[0]>Ih||Bc[1]>Ih)&&Ze(`${St.layerIds[0]}: Value for "icon-size" is >= ${Zd}. Reduce your "icon-size".`)),St.addSymbols(St.icon,JA,Bc,cn,Pn,vr,l.ah.none,Xt,Ts.lineStartIndex,Ts.lineLength,-1,en),tc=St.icon.placedSymbolArray.length-1,_u&&(Ns=4*_u.length,St.addSymbols(St.icon,_u,Bc,cn,Pn,vr,l.ah.vertical,Xt,Ts.lineStartIndex,Ts.lineLength,-1,en),vc=St.icon.placedSymbolArray.length-1)}const bc=Object.keys(oi.horizontal);for(const Oa of bc){const wc=oi.horizontal[Oa];if(!vs){Wu=Ti(wc.text);const _u=ai.layout.get("text-rotate").evaluate(vr,{},en);vs=new Ep(Zt,Xt,Vi,Qi,gr,wc,Dr,zr,pn,_u)}const JA=wc.positionedLines.length===1;if(ao+=jx(St,Xt,wc,fi,ai,pn,vr,as,Ts,oi.vertical?l.ah.horizontal:l.ah.horizontalOnly,JA?bc:[Oa],na,tc,Qn,en),JA)break}oi.vertical&&(lo+=jx(St,Xt,oi.vertical,fi,ai,pn,vr,as,Ts,l.ah.vertical,["vertical"],na,vc,Qn,en));const xc=vs?vs.boxStartIndex:St.collisionBoxArray.length,Bl=vs?vs.boxEndIndex:St.collisionBoxArray.length,Ph=Is?Is.boxStartIndex:St.collisionBoxArray.length,Rp=Is?Is.boxEndIndex:St.collisionBoxArray.length,Wx=Zs?Zs.boxStartIndex:St.collisionBoxArray.length,w_=Zs?Zs.boxEndIndex:St.collisionBoxArray.length,B_=Fn?Fn.boxStartIndex:St.collisionBoxArray.length,Fh=Fn?Fn.boxEndIndex:St.collisionBoxArray.length;let $c=-1;const kp=(Oa,wc)=>Oa&&Oa.circleDiameter?Math.max(Oa.circleDiameter,wc):wc;$c=kp(vs,$c),$c=kp(Is,$c),$c=kp(Zs,$c),$c=kp(Fn,$c);const Xx=$c>-1?1:0;Xx&&($c*=fs/_o),St.glyphOffsetArray.length>=WA.MAX_GLYPHS&&Ze("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vr.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,vr.sortKey);const DI=Tp(ai,vr,en),[RI,kI]=function(Oa,wc){const JA=Oa.length,_u=wc==null?void 0:wc.values;if((_u==null?void 0:_u.length)>0)for(let Ua=0;Ua<_u.length;Ua+=2){const Bc=_u[Ua+1];Oa.emplaceBack(l.ap[_u[Ua]],Bc[0],Bc[1])}return[JA,Oa.length]}(St.textAnchorOffsets,DI);St.symbolInstances.emplaceBack(Xt.x,Xt.y,na.right>=0?na.right:-1,na.center>=0?na.center:-1,na.left>=0?na.left:-1,na.vertical||-1,tc,vc,Wu,xc,Bl,Ph,Rp,Wx,w_,B_,Fh,Vi,ao,lo,xr,Ns,Xx,0,Dr,$c,RI,kI)}(p,gt,tt,m,C,P,ct,p.layers[0],p.collisionBoxArray,u.index,u.sourceLayerIndex,p.index,D,[se,se,se,se],Be,re,$,Ae,Te,v,u,Q,he,h,V)};if(ke==="line")for(const tt of f_(u.geometry,0,0,$r,$r)){const gt=Hx(tt,X,me,m.vertical||E,C,24,G,p.overscaling,$r);for(const St of gt)E&&of(p,E.text,je,St)||Ye(tt,St)}else if(ke==="line-center"){for(const tt of u.geometry)if(tt.length>1){const gt=Vx(tt,me,m.vertical||E,C,24,G);gt&&Ye(tt,gt)}}else if(u.type==="Polygon")for(const tt of mm(u.geometry,0)){const gt=Gx(tt,16);Ye(tt[0],new zo(gt.x,gt.y,0))}else if(u.type==="LineString")for(const tt of u.geometry)Ye(tt,new zo(tt[0].x,tt[0].y,0));else if(u.type==="Point")for(const tt of u.geometry)for(const gt of tt)Ye([gt],new zo(gt.x,gt.y,0))}function jx(p,u,m,C,P,Q,V,K,re,he,h,c,f,v,E){const M=function($,X,se,Ae,me,Be,Te,ke){const je=Ae.layout.get("text-rotate").evaluate(Be,{})*Math.PI/180,$e=[];for(const ct of X.positionedLines)for(const Ye of ct.positionedGlyphs){if(!Ye.rect)continue;const tt=Ye.rect||{};let gt=Px+1,St=!0,Xt=1,xi=0;const oi=(me||ke)&&Ye.vertical,Ai=Ye.metrics.advance*Ye.scale/2;if(ke&&X.verticalizable&&(xi=ct.lineOffset/2-(Ye.imageName?-(_o-Ye.metrics.width*Ye.scale)/2:(Ye.scale-1)*_o)),Ye.imageName){const cn=Te[Ye.imageName];St=cn.sdf,Xt=cn.pixelRatio,gt=No/Xt}const fi=me?[Ye.x+Ai,Ye.y]:[0,0];let Fi=me?[0,0]:[Ye.x+Ai+se[0],Ye.y+se[1]-xi],ai=[0,0];oi&&(ai=Fi,Fi=[0,0]);const Zt=Ye.metrics.isDoubleResolution?2:1,Vi=(Ye.metrics.left-gt)*Ye.scale-Ai+Fi[0],Qi=(-Ye.metrics.top-gt)*Ye.scale+Fi[1],gr=Vi+tt.w/Zt*Ye.scale/Xt,Dr=Qi+tt.h/Zt*Ye.scale/Xt,zr=new F(Vi,Qi),pn=new F(gr,Qi),as=new F(Vi,Dr),zn=new F(gr,Dr);if(oi){const cn=new F(-Ai,Ai-gp),vr=-Math.PI/2,Qn=_o/2-Ai,un=new F(5-gp-Qn,-(Ye.imageName?Qn:0)),en=new F(...ai);zr._rotateAround(vr,cn)._add(un)._add(en),pn._rotateAround(vr,cn)._add(un)._add(en),as._rotateAround(vr,cn)._add(un)._add(en),zn._rotateAround(vr,cn)._add(un)._add(en)}if(je){const cn=Math.sin(je),vr=Math.cos(je),Qn=[vr,-cn,cn,vr];zr._matMult(Qn),pn._matMult(Qn),as._matMult(Qn),zn._matMult(Qn)}const vn=new F(0,0),Pn=new F(0,0);$e.push({tl:zr,tr:pn,bl:as,br:zn,tex:tt,writingMode:X.writingMode,glyphOffset:fi,sectionIndex:Ye.sectionIndex,isSDF:St,pixelOffsetTL:vn,pixelOffsetBR:Pn,minFontScaleX:0,minFontScaleY:0})}return $e}(0,m,K,P,Q,V,C,p.allowVerticalPlacement),D=p.textSizeData;let G=null;D.kind==="source"?(G=[ju*P.layout.get("text-size").evaluate(V,{})],G[0]>Ih&&Ze(`${p.layerIds[0]}: Value for "text-size" is >= ${Zd}. Reduce your "text-size".`)):D.kind==="composite"&&(G=[ju*v.compositeTextSizes[0].evaluate(V,{},E),ju*v.compositeTextSizes[1].evaluate(V,{},E)],(G[0]>Ih||G[1]>Ih)&&Ze(`${p.layerIds[0]}: Value for "text-size" is >= ${Zd}. Reduce your "text-size".`)),p.addSymbols(p.text,M,G,K,Q,V,he,u,re.lineStartIndex,re.lineLength,f,E);for(const $ of h)c[$]=p.text.placedSymbolArray.length-1;return 4*M.length}function qx(p){for(const u in p)return p[u];return null}function of(p,u,m,C){const P=p.compareText;if(u in P){const Q=P[u];for(let V=Q.length-1;V>=0;V--)if(C.dist(Q[V])<m)return!0}else P[u]=[];return P[u].push(C),!1}const ra=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ku{static from(u){if(!(u instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[m,C]=new Uint8Array(u,0,2);if(m!==219)throw new Error("Data does not appear to be in a KDBush format.");const P=C>>4;if(P!==1)throw new Error(`Got v${P} data when expected v1.`);const Q=ra[15&C];if(!Q)throw new Error("Unrecognized array type.");const[V]=new Uint16Array(u,2,1),[K]=new Uint32Array(u,4,1);return new Ku(K,V,Q,u)}constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,P=arguments.length>3?arguments[3]:void 0;if(isNaN(u)||u<0)throw new Error(`Unpexpected numItems value: ${u}.`);this.numItems=+u,this.nodeSize=Math.min(Math.max(+m,2),65535),this.ArrayType=C,this.IndexArrayType=u<65536?Uint16Array:Uint32Array;const Q=ra.indexOf(this.ArrayType),V=2*u*this.ArrayType.BYTES_PER_ELEMENT,K=u*this.IndexArrayType.BYTES_PER_ELEMENT,re=(8-K%8)%8;if(Q<0)throw new Error(`Unexpected typed array class: ${C}.`);P&&P instanceof ArrayBuffer?(this.data=P,this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+K+re,2*u),this._pos=2*u,this._finished=!0):(this.data=new ArrayBuffer(8+V+K+re),this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+K+re,2*u),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+Q]),new Uint16Array(this.data,2,1)[0]=m,new Uint32Array(this.data,4,1)[0]=u)}add(u,m){const C=this._pos>>1;return this.ids[C]=C,this.coords[this._pos++]=u,this.coords[this._pos++]=m,C}finish(){const u=this._pos>>1;if(u!==this.numItems)throw new Error(`Added ${u} items when expected ${this.numItems}.`);return Ip(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(u,m,C,P){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:Q,coords:V,nodeSize:K}=this,re=[0,Q.length-1,0],he=[];for(;re.length;){const h=re.pop()||0,c=re.pop()||0,f=re.pop()||0;if(c-f<=K){for(let D=f;D<=c;D++){const G=V[2*D],$=V[2*D+1];G>=u&&G<=C&&$>=m&&$<=P&&he.push(Q[D])}continue}const v=f+c>>1,E=V[2*v],M=V[2*v+1];E>=u&&E<=C&&M>=m&&M<=P&&he.push(Q[v]),(h===0?u<=E:m<=M)&&(re.push(f),re.push(v-1),re.push(1-h)),(h===0?C>=E:P>=M)&&(re.push(v+1),re.push(c),re.push(1-h))}return he}within(u,m,C){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:P,coords:Q,nodeSize:V}=this,K=[0,P.length-1,0],re=[],he=C*C;for(;K.length;){const h=K.pop()||0,c=K.pop()||0,f=K.pop()||0;if(c-f<=V){for(let D=f;D<=c;D++)$x(Q[2*D],Q[2*D+1],u,m)<=he&&re.push(P[D]);continue}const v=f+c>>1,E=Q[2*v],M=Q[2*v+1];$x(E,M,u,m)<=he&&re.push(P[v]),(h===0?u-C<=E:m-C<=M)&&(K.push(f),K.push(v-1),K.push(1-h)),(h===0?u+C>=E:m+C>=M)&&(K.push(v+1),K.push(c),K.push(1-h))}return re}}function Ip(p,u,m,C,P,Q){if(P-C<=m)return;const V=C+P>>1;x_(p,u,V,C,P,Q),Ip(p,u,m,C,V-1,1-Q),Ip(p,u,m,V+1,P,1-Q)}function x_(p,u,m,C,P,Q){for(;P>C;){if(P-C>600){const he=P-C+1,h=m-C+1,c=Math.log(he),f=.5*Math.exp(2*c/3),v=.5*Math.sqrt(c*f*(he-f)/he)*(h-he/2<0?-1:1);x_(p,u,m,Math.max(C,Math.floor(m-h*f/he+v)),Math.min(P,Math.floor(m+(he-h)*f/he+v)),Q)}const V=u[2*m+Q];let K=C,re=P;for(af(p,u,C,m),u[2*P+Q]>V&&af(p,u,C,P);K<re;){for(af(p,u,K,re),K++,re--;u[2*K+Q]<V;)K++;for(;u[2*re+Q]>V;)re--}u[2*C+Q]===V?af(p,u,C,re):(re++,af(p,u,re,P)),re<=m&&(C=re+1),m<=re&&(P=re-1)}}function af(p,u,m,C){Lp(p,m,C),Lp(u,2*m,2*C),Lp(u,2*m+1,2*C+1)}function Lp(p,u,m){const C=p[u];p[u]=p[m],p[m]=C}function $x(p,u,m,C){const P=p-m,Q=u-C;return P*P+Q*Q}var Fm;l.bc=void 0,(Fm=l.bc||(l.bc={})).create="create",Fm.load="load",Fm.fullLoad="fullLoad";let Mp=null,Pp=[];const Dm=1e3/60,Fp="loadTime",Dp="fullLoadTime",Kx={mark(p){performance.mark(p)},frame(p){const u=p;Mp!=null&&Pp.push(u-Mp),Mp=u},clearMetrics(){Mp=null,Pp=[],performance.clearMeasures(Fp),performance.clearMeasures(Dp);for(const p in l.bc)performance.clearMarks(l.bc[p])},getPerformanceMetrics(){performance.measure(Fp,l.bc.create,l.bc.load),performance.measure(Dp,l.bc.create,l.bc.fullLoad);const p=performance.getEntriesByName(Fp)[0].duration,u=performance.getEntriesByName(Dp)[0].duration,m=Pp.length,C=1/(Pp.reduce((Q,V)=>Q+V,0)/m/1e3),P=Pp.filter(Q=>Q>Dm).reduce((Q,V)=>Q+(V-Dm)/Dm,0);return{loadTime:p,fullLoadTime:u,fps:C,percentDroppedFrames:P/(m+P)*100,totalFrames:m}}};l.$=bt,l.A=Yl,l.B=function(p){if(Lt==null){const u=p.navigator?p.navigator.userAgent:null;Lt=!!p.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Lt},l.C=class{constructor(p,u){this.target=p,this.mapId=u,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Ox(()=>this.process()),this.subscription=function(m,C,P,Q){return m.addEventListener(C,P,!1),{unsubscribe:()=>{m.removeEventListener(C,P,!1)}}}(this.target,"message",m=>this.receive(m)),this.globalScope=Ct(self)?p:window}registerMessageHandler(p,u){this.messageHandlers[p]=u}sendAsync(p,u){return new Promise((m,C)=>{const P=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[P]={resolve:m,reject:C},u&&u.signal.addEventListener("abort",()=>{delete this.resolveRejects[P];const K={id:P,type:"<cancel>",origin:location.origin,targetMapId:p.targetMapId,sourceMapId:this.mapId};this.target.postMessage(K)},{once:!0});const Q=[],V=Object.assign(Object.assign({},p),{id:P,sourceMapId:this.mapId,origin:location.origin,data:$l(p.data,Q)});this.target.postMessage(V,{transfer:Q})})}receive(p){const u=p.data,m=u.id;if(!(u.origin!=="file://"&&location.origin!=="file://"&&u.origin!==location.origin||u.targetMapId&&this.mapId!==u.targetMapId)){if(u.type==="<cancel>"){delete this.tasks[m];const C=this.abortControllers[m];return delete this.abortControllers[m],void(C&&C.abort())}if(Ct(self)||u.mustQueue)return this.tasks[m]=u,this.taskQueue.push(m),void this.invoker.trigger();this.processTask(m,u)}}process(){if(this.taskQueue.length===0)return;const p=this.taskQueue.shift(),u=this.tasks[p];delete this.tasks[p],this.taskQueue.length>0&&this.invoker.trigger(),u&&this.processTask(p,u)}processTask(p,u){return s(this,void 0,void 0,function*(){if(u.type==="<response>"){const P=this.resolveRejects[p];return delete this.resolveRejects[p],P?void(u.error?P.reject(Li(u.error)):P.resolve(Li(u.data))):void 0}if(!this.messageHandlers[u.type])return void this.completeTask(p,new Error(`Could not find a registered handler for ${u.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const m=Li(u.data),C=new AbortController;this.abortControllers[p]=C;try{const P=yield this.messageHandlers[u.type](u.sourceMapId,m,C);this.completeTask(p,null,P)}catch(P){this.completeTask(p,P)}})}completeTask(p,u,m){const C=[];delete this.abortControllers[p];const P={id:p,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:u?$l(u):null,data:$l(m,C)};this.target.postMessage(P,{transfer:C})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},l.D=bi,l.E=at,l.F=function(){var p=new Yl(16);return Yl!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=0,p[12]=0,p[13]=0,p[14]=0),p[0]=1,p[5]=1,p[10]=1,p[15]=1,p},l.G=wt,l.H=function(p,u,m){var C,P,Q,V,K,re,he,h,c,f,v,E,M=m[0],D=m[1],G=m[2];return u===p?(p[12]=u[0]*M+u[4]*D+u[8]*G+u[12],p[13]=u[1]*M+u[5]*D+u[9]*G+u[13],p[14]=u[2]*M+u[6]*D+u[10]*G+u[14],p[15]=u[3]*M+u[7]*D+u[11]*G+u[15]):(P=u[1],Q=u[2],V=u[3],K=u[4],re=u[5],he=u[6],h=u[7],c=u[8],f=u[9],v=u[10],E=u[11],p[0]=C=u[0],p[1]=P,p[2]=Q,p[3]=V,p[4]=K,p[5]=re,p[6]=he,p[7]=h,p[8]=c,p[9]=f,p[10]=v,p[11]=E,p[12]=C*M+K*D+c*G+u[12],p[13]=P*M+re*D+f*G+u[13],p[14]=Q*M+he*D+v*G+u[14],p[15]=V*M+h*D+E*G+u[15]),p},l.I=wm,l.J=function(p,u,m){var C=m[0],P=m[1],Q=m[2];return p[0]=u[0]*C,p[1]=u[1]*C,p[2]=u[2]*C,p[3]=u[3]*C,p[4]=u[4]*P,p[5]=u[5]*P,p[6]=u[6]*P,p[7]=u[7]*P,p[8]=u[8]*Q,p[9]=u[9]*Q,p[10]=u[10]*Q,p[11]=u[11]*Q,p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15],p},l.K=xh,l.L=function(p,u){const m={};for(let C=0;C<u.length;C++){const P=u[C];P in p&&(m[P]=p[P])}return m},l.M=Lh,l.N=o_,l.O=zx,l.P=F,l.Q=ec,l.R=bl,l.S=ce,l.T=Xl,l.U=de,l.V=Mt,l.W=$r,l.X=$n,l.Y=Lm,l.Z=class extends Yo{},l._=s,l.a=At,l.a$=function(p,u){return p[0]*u[0]+p[1]*u[1]+p[2]*u[2]+p[3]*u[3]},l.a0=$u,l.a1=Nt,l.a2=p=>{const u=window.document.createElement("video");return u.muted=!0,new Promise(m=>{u.onloadstart=()=>{m(u)};for(const C of p){const P=window.document.createElement("source");ii(C)||(u.crossOrigin="Anonymous"),P.src=C,u.appendChild(P)}})},l.a3=function(){return Ue++},l.a4=a,l.a5=WA,l.a6=jl,l.a7=Ws,l.a8=yn,l.a9=h_,l.aA=De,l.aB=function(p,u){if(!p)return[{command:"setStyle",args:[u]}];let m=[];try{if(!ut(p.version,u.version))return[{command:"setStyle",args:[u]}];ut(p.center,u.center)||m.push({command:"setCenter",args:[u.center]}),ut(p.zoom,u.zoom)||m.push({command:"setZoom",args:[u.zoom]}),ut(p.bearing,u.bearing)||m.push({command:"setBearing",args:[u.bearing]}),ut(p.pitch,u.pitch)||m.push({command:"setPitch",args:[u.pitch]}),ut(p.sprite,u.sprite)||m.push({command:"setSprite",args:[u.sprite]}),ut(p.glyphs,u.glyphs)||m.push({command:"setGlyphs",args:[u.glyphs]}),ut(p.transition,u.transition)||m.push({command:"setTransition",args:[u.transition]}),ut(p.light,u.light)||m.push({command:"setLight",args:[u.light]}),ut(p.terrain,u.terrain)||m.push({command:"setTerrain",args:[u.terrain]}),ut(p.sky,u.sky)||m.push({command:"setSky",args:[u.sky]});const C={},P=[];(function(V,K,re,he){let h;for(h in K=K||{},V=V||{})Object.prototype.hasOwnProperty.call(V,h)&&(Object.prototype.hasOwnProperty.call(K,h)||di(h,re,he));for(h in K)Object.prototype.hasOwnProperty.call(K,h)&&(Object.prototype.hasOwnProperty.call(V,h)?ut(V[h],K[h])||(V[h].type==="geojson"&&K[h].type==="geojson"&&Ki(V,K,h)?jt(re,{command:"setGeoJSONSourceData",args:[h,K[h].data]}):li(h,K,re,he)):ni(h,K,re))})(p.sources,u.sources,P,C);const Q=[];p.layers&&p.layers.forEach(V=>{"source"in V&&C[V.source]?m.push({command:"removeLayer",args:[V.id]}):Q.push(V)}),m=m.concat(P),function(V,K,re){K=K||[];const he=(V=V||[]).map(Ar),h=K.map(Ar),c=V.reduce(Er,{}),f=K.reduce(Er,{}),v=he.slice(),E=Object.create(null);let M,D,G,$,X;for(let se=0,Ae=0;se<he.length;se++)M=he[se],Object.prototype.hasOwnProperty.call(f,M)?Ae++:(jt(re,{command:"removeLayer",args:[M]}),v.splice(v.indexOf(M,Ae),1));for(let se=0,Ae=0;se<h.length;se++)M=h[h.length-1-se],v[v.length-1-se]!==M&&(Object.prototype.hasOwnProperty.call(c,M)?(jt(re,{command:"removeLayer",args:[M]}),v.splice(v.lastIndexOf(M,v.length-Ae),1)):Ae++,$=v[v.length-se],jt(re,{command:"addLayer",args:[f[M],$]}),v.splice(v.length-se,0,M),E[M]=!0);for(let se=0;se<h.length;se++)if(M=h[se],D=c[M],G=f[M],!E[M]&&!ut(D,G))if(ut(D.source,G.source)&&ut(D["source-layer"],G["source-layer"])&&ut(D.type,G.type)){for(X in tr(D.layout,G.layout,re,M,null,"setLayoutProperty"),tr(D.paint,G.paint,re,M,null,"setPaintProperty"),ut(D.filter,G.filter)||jt(re,{command:"setFilter",args:[M,G.filter]}),ut(D.minzoom,G.minzoom)&&ut(D.maxzoom,G.maxzoom)||jt(re,{command:"setLayerZoomRange",args:[M,G.minzoom,G.maxzoom]}),D)Object.prototype.hasOwnProperty.call(D,X)&&X!=="layout"&&X!=="paint"&&X!=="filter"&&X!=="metadata"&&X!=="minzoom"&&X!=="maxzoom"&&(X.indexOf("paint.")===0?tr(D[X],G[X],re,M,X.slice(6),"setPaintProperty"):ut(D[X],G[X])||jt(re,{command:"setLayerProperty",args:[M,X,G[X]]}));for(X in G)Object.prototype.hasOwnProperty.call(G,X)&&!Object.prototype.hasOwnProperty.call(D,X)&&X!=="layout"&&X!=="paint"&&X!=="filter"&&X!=="metadata"&&X!=="minzoom"&&X!=="maxzoom"&&(X.indexOf("paint.")===0?tr(D[X],G[X],re,M,X.slice(6),"setPaintProperty"):ut(D[X],G[X])||jt(re,{command:"setLayerProperty",args:[M,X,G[X]]}))}else jt(re,{command:"removeLayer",args:[M]}),$=v[v.lastIndexOf(M)+1],jt(re,{command:"addLayer",args:[G,$]})}(Q,u.layers,m)}catch(C){console.warn("Unable to compute style diff:",C),m=[{command:"setStyle",args:[u]}]}return m},l.aC=function(p){const u=[],m=p.id;return m===void 0&&u.push({message:`layers.${m}: missing required property "id"`}),p.render===void 0&&u.push({message:`layers.${m}: missing required method "render"`}),p.renderingMode&&p.renderingMode!=="2d"&&p.renderingMode!=="3d"&&u.push({message:`layers.${m}: property "renderingMode" must be either "2d" or "3d"`}),u},l.aD=function p(u,m){if(Array.isArray(u)){if(!Array.isArray(m)||u.length!==m.length)return!1;for(let C=0;C<u.length;C++)if(!p(u[C],m[C]))return!1;return!0}if(typeof u=="object"&&u!==null&&m!==null){if(typeof m!="object"||Object.keys(u).length!==Object.keys(m).length)return!1;for(const C in u)if(!p(u[C],m[C]))return!1;return!0}return u===m},l.aE=ot,l.aF=it,l.aG=class extends rn{constructor(p,u){super(p,u),this.current=0}set(p){this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))}},l.aH=Mr,l.aI=class extends rn{constructor(p,u){super(p,u),this.current=ts}set(p){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(let u=1;u<16;u++)if(p[u]!==this.current[u]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}}},l.aJ=Kr,l.aK=class extends rn{constructor(p,u){super(p,u),this.current=[0,0,0]}set(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2]))}},l.aL=class extends rn{constructor(p,u){super(p,u),this.current=[0,0]}set(p){p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1]))}},l.aM=Cr,l.aN=function(p,u,m,C,P,Q,V){var K=1/(u-m),re=1/(C-P),he=1/(Q-V);return p[0]=-2*K,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=-2*re,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=2*he,p[11]=0,p[12]=(u+m)*K,p[13]=(P+C)*re,p[14]=(V+Q)*he,p[15]=1,p},l.aO=ur,l.aP=wh,l.aQ=class extends Jl{},l.aR=bx,l.aS=class extends yo{},l.aT=function(p){return p<=1?1:Math.pow(2,Math.ceil(Math.log(p)/Math.LN2))},l.aU=Nd,l.aV=j,l.aW=class extends L{},l.aX=Ke,l.aY=function(p,u){var m=p[0],C=p[1],P=p[2],Q=p[3],V=p[4],K=p[5],re=p[6],he=p[7],h=p[8],c=p[9],f=p[10],v=p[11],E=p[12],M=p[13],D=p[14],G=p[15],$=u[0],X=u[1],se=u[2],Ae=u[3],me=u[4],Be=u[5],Te=u[6],ke=u[7],je=u[8],$e=u[9],ct=u[10],Ye=u[11],tt=u[12],gt=u[13],St=u[14],Xt=u[15];return Math.abs(m-$)<=ta*Math.max(1,Math.abs(m),Math.abs($))&&Math.abs(C-X)<=ta*Math.max(1,Math.abs(C),Math.abs(X))&&Math.abs(P-se)<=ta*Math.max(1,Math.abs(P),Math.abs(se))&&Math.abs(Q-Ae)<=ta*Math.max(1,Math.abs(Q),Math.abs(Ae))&&Math.abs(V-me)<=ta*Math.max(1,Math.abs(V),Math.abs(me))&&Math.abs(K-Be)<=ta*Math.max(1,Math.abs(K),Math.abs(Be))&&Math.abs(re-Te)<=ta*Math.max(1,Math.abs(re),Math.abs(Te))&&Math.abs(he-ke)<=ta*Math.max(1,Math.abs(he),Math.abs(ke))&&Math.abs(h-je)<=ta*Math.max(1,Math.abs(h),Math.abs(je))&&Math.abs(c-$e)<=ta*Math.max(1,Math.abs(c),Math.abs($e))&&Math.abs(f-ct)<=ta*Math.max(1,Math.abs(f),Math.abs(ct))&&Math.abs(v-Ye)<=ta*Math.max(1,Math.abs(v),Math.abs(Ye))&&Math.abs(E-tt)<=ta*Math.max(1,Math.abs(E),Math.abs(tt))&&Math.abs(M-gt)<=ta*Math.max(1,Math.abs(M),Math.abs(gt))&&Math.abs(D-St)<=ta*Math.max(1,Math.abs(D),Math.abs(St))&&Math.abs(G-Xt)<=ta*Math.max(1,Math.abs(G),Math.abs(Xt))},l.aZ=function(p,u){return p[0]=u[0],p[1]=u[1],p[2]=u[2],p[3]=u[3],p[4]=u[4],p[5]=u[5],p[6]=u[6],p[7]=u[7],p[8]=u[8],p[9]=u[9],p[10]=u[10],p[11]=u[11],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15],p},l.a_=function(p,u,m){return p[0]=u[0]*m[0],p[1]=u[1]*m[1],p[2]=u[2]*m[2],p[3]=u[3]*m[3],p},l.aa=function(p){const u={};if(p.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(m,C,P,Q)=>{const V=P||Q;return u[C]=!V||V.toLowerCase(),""}),u["max-age"]){const m=parseInt(u["max-age"],10);isNaN(m)?delete u["max-age"]:u["max-age"]=m}return u},l.ab=function(p,u){const m=[];for(const C in p)C in u||m.push(C);return m},l.ac=He,l.ad=function(p,u,m){var C=Math.sin(m),P=Math.cos(m),Q=u[0],V=u[1],K=u[2],re=u[3],he=u[4],h=u[5],c=u[6],f=u[7];return u!==p&&(p[8]=u[8],p[9]=u[9],p[10]=u[10],p[11]=u[11],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15]),p[0]=Q*P+he*C,p[1]=V*P+h*C,p[2]=K*P+c*C,p[3]=re*P+f*C,p[4]=he*P-Q*C,p[5]=h*P-V*C,p[6]=c*P-K*C,p[7]=f*P-re*C,p},l.ae=function(p){var u=new Yl(16);return u[0]=p[0],u[1]=p[1],u[2]=p[2],u[3]=p[3],u[4]=p[4],u[5]=p[5],u[6]=p[6],u[7]=p[7],u[8]=p[8],u[9]=p[9],u[10]=p[10],u[11]=p[11],u[12]=p[12],u[13]=p[13],u[14]=p[14],u[15]=p[15],u},l.af=Bh,l.ag=function(p,u){let m=0,C=0;if(p.kind==="constant")C=p.layoutSize;else if(p.kind!=="source"){const{interpolationType:P,minZoom:Q,maxZoom:V}=p,K=P?He(ns.interpolationFactor(P,u,Q,V),0,1):0;p.kind==="camera"?C=dn.number(p.minSize,p.maxSize,K):m=K}return{uSizeT:m,uSize:C}},l.ai=function(p,u,m){let{uSize:C,uSizeT:P}=u,{lowerSize:Q,upperSize:V}=m;return p.kind==="source"?Q/ju:p.kind==="composite"?dn.number(Q/ju,V/ju,P):C},l.aj=Tm,l.ak=function(p,u,m,C){const P=u.y-p.y,Q=u.x-p.x,V=C.y-m.y,K=C.x-m.x,re=V*Q-K*P;if(re===0)return null;const he=(K*(p.y-m.y)-V*(p.x-m.x))/re;return new F(p.x+he*Q,p.y+he*P)},l.al=f_,l.am=Nu,l.an=oA,l.ao=_o,l.aq=vp,l.ar=function(p,u){var m=u[0],C=u[1],P=u[2],Q=u[3],V=u[4],K=u[5],re=u[6],he=u[7],h=u[8],c=u[9],f=u[10],v=u[11],E=u[12],M=u[13],D=u[14],G=u[15],$=m*K-C*V,X=m*re-P*V,se=m*he-Q*V,Ae=C*re-P*K,me=C*he-Q*K,Be=P*he-Q*re,Te=h*M-c*E,ke=h*D-f*E,je=h*G-v*E,$e=c*D-f*M,ct=c*G-v*M,Ye=f*G-v*D,tt=$*Ye-X*ct+se*$e+Ae*je-me*ke+Be*Te;return tt?(p[0]=(K*Ye-re*ct+he*$e)*(tt=1/tt),p[1]=(P*ct-C*Ye-Q*$e)*tt,p[2]=(M*Be-D*me+G*Ae)*tt,p[3]=(f*me-c*Be-v*Ae)*tt,p[4]=(re*je-V*Ye-he*ke)*tt,p[5]=(m*Ye-P*je+Q*ke)*tt,p[6]=(D*se-E*Be-G*X)*tt,p[7]=(h*Be-f*se+v*X)*tt,p[8]=(V*ct-K*je+he*Te)*tt,p[9]=(C*je-m*ct-Q*Te)*tt,p[10]=(E*me-M*se+G*$)*tt,p[11]=(c*se-h*me-v*$)*tt,p[12]=(K*ke-V*$e-re*Te)*tt,p[13]=(m*$e-C*ke+P*Te)*tt,p[14]=(M*X-E*Ae-D*$)*tt,p[15]=(h*Ae-c*X+f*$)*tt,p):null},l.as=b_,l.at=Xd,l.au=Ku,l.av=function(){const p={},u=xt.$version;for(const m in xt.$root){const C=xt.$root[m];if(C.required){let P=null;P=m==="version"?u:C.type==="array"?[]:{},P!=null&&(p[m]=P)}}return p},l.aw=Kl,l.ax=It,l.ay=function(p){p=p.slice();const u=Object.create(null);for(let m=0;m<p.length;m++)u[p[m].id]=p[m];for(let m=0;m<p.length;m++)"ref"in p[m]&&(p[m]=ei(p[m],u[p[m].ref]));return p},l.az=function(p){if(p.type==="custom")return new s_(p);switch(p.type){case"background":return new n_(p);case"circle":return new aA(p);case"fill":return new AI(p);case"fill-extrusion":return new _I(p);case"heatmap":return new Ch(p);case"hillshade":return new ep(p);case"line":return new BI(p);case"raster":return new kx(p);case"symbol":return new Jd(p)}},l.b=_t,l.b0=Ve,l.b1=l_,l.b2=Qx,l.b3=function(p,u,m,C,P){var Q,V=1/Math.tan(u/2);return p[0]=V/m,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=V,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[11]=-1,p[12]=0,p[13]=0,p[15]=0,P!=null&&P!==1/0?(p[10]=(P+C)*(Q=1/(C-P)),p[14]=2*P*C*Q):(p[10]=-1,p[14]=-2*C),p},l.b4=function(p,u,m){var C=Math.sin(m),P=Math.cos(m),Q=u[4],V=u[5],K=u[6],re=u[7],he=u[8],h=u[9],c=u[10],f=u[11];return u!==p&&(p[0]=u[0],p[1]=u[1],p[2]=u[2],p[3]=u[3],p[12]=u[12],p[13]=u[13],p[14]=u[14],p[15]=u[15]),p[4]=Q*P+he*C,p[5]=V*P+h*C,p[6]=K*P+c*C,p[7]=re*P+f*C,p[8]=he*P-Q*C,p[9]=h*P-V*C,p[10]=c*P-K*C,p[11]=f*P-re*C,p},l.b5=_e,l.b6=Ee,l.b7=function(p){return p*Math.PI/180},l.b8=function(p,u){return p[0]=u[0],p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=u[1],p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=u[2],p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},l.b9=class extends tn{},l.ba=Yd,l.bb=Kx,l.bd=Pt,l.be=function(p,u){At.REGISTERED_PROTOCOLS[p]=u},l.bf=function(p){delete At.REGISTERED_PROTOCOLS[p]},l.bg=function(p,u){const m={};for(let P=0;P<p.length;P++){const Q=u&&u[p[P].id]||ku(p[P]);u&&(u[p[P].id]=Q);let V=m[Q];V||(V=m[Q]=[]),V.push(p[P])}const C=[];for(const P in m)C.push(m[P]);return C},l.bh=Pi,l.bi=u_,l.bj=Pm,l.bk=Bm,l.bl=function(p){p.bucket.createArrays(),p.bucket.tilePixelRatio=$r/(512*p.bucket.overscaling),p.bucket.compareText={},p.bucket.iconsNeedLinear=!1;const u=p.bucket.layers[0],m=u.layout,C=u._unevaluatedLayout._values,P={layoutIconSize:C["icon-size"].possiblyEvaluate(new yn(p.bucket.zoom+1),p.canonical),layoutTextSize:C["text-size"].possiblyEvaluate(new yn(p.bucket.zoom+1),p.canonical),textMaxSize:C["text-size"].possiblyEvaluate(new yn(18))};if(p.bucket.textSizeData.kind==="composite"){const{minZoom:he,maxZoom:h}=p.bucket.textSizeData;P.compositeTextSizes=[C["text-size"].possiblyEvaluate(new yn(he),p.canonical),C["text-size"].possiblyEvaluate(new yn(h),p.canonical)]}if(p.bucket.iconSizeData.kind==="composite"){const{minZoom:he,maxZoom:h}=p.bucket.iconSizeData;P.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new yn(he),p.canonical),C["icon-size"].possiblyEvaluate(new yn(h),p.canonical)]}const Q=m.get("text-line-height")*_o,V=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point",K=m.get("text-keep-upright"),re=m.get("text-size");for(const he of p.bucket.features){const h=m.get("text-font").evaluate(he,{},p.canonical).join(","),c=re.evaluate(he,{},p.canonical),f=P.layoutTextSize.evaluate(he,{},p.canonical),v=P.layoutIconSize.evaluate(he,{},p.canonical),E={horizontal:{},vertical:void 0},M=he.text;let D,G=[0,0];if(M){const se=M.toString(),Ae=m.get("text-letter-spacing").evaluate(he,{},p.canonical)*_o,me=mo(se)?Ae:0,Be=m.get("text-anchor").evaluate(he,{},p.canonical),Te=Tp(u,he,p.canonical);if(!Te){const Ye=m.get("text-radial-offset").evaluate(he,{},p.canonical);G=Ye?Sp(Be,[Ye*_o,sf]):m.get("text-offset").evaluate(he,{},p.canonical).map(tt=>tt*_o)}let ke=V?"center":m.get("text-justify").evaluate(he,{},p.canonical);const je=m.get("symbol-placement"),$e=je==="point"?m.get("text-max-width").evaluate(he,{},p.canonical)*_o:0,ct=()=>{p.bucket.allowVerticalPlacement&&so(se)&&(E.vertical=yp(M,p.glyphMap,p.glyphPositions,p.imagePositions,h,$e,Q,Be,"left",me,G,l.ah.vertical,!0,je,f,c))};if(!V&&Te){const Ye=new Set;if(ke==="auto")for(let gt=0;gt<Te.values.length;gt+=2)Ye.add(b_(Te.values[gt]));else Ye.add(ke);let tt=!1;for(const gt of Ye)if(!E.horizontal[gt])if(tt)E.horizontal[gt]=E.horizontal[0];else{const St=yp(M,p.glyphMap,p.glyphPositions,p.imagePositions,h,$e,Q,"center",gt,me,G,l.ah.horizontal,!1,je,f,c);St&&(E.horizontal[gt]=St,tt=St.positionedLines.length===1)}ct()}else{ke==="auto"&&(ke=b_(Be));const Ye=yp(M,p.glyphMap,p.glyphPositions,p.imagePositions,h,$e,Q,Be,ke,me,G,l.ah.horizontal,!1,je,f,c);Ye&&(E.horizontal[ke]=Ye),ct(),so(se)&&V&&K&&(E.vertical=yp(M,p.glyphMap,p.glyphPositions,p.imagePositions,h,$e,Q,Be,ke,me,G,l.ah.vertical,!1,je,f,c))}}let $=!1;if(he.icon&&he.icon.name){const se=p.imageMap[he.icon.name];se&&(D=II(p.imagePositions[he.icon.name],m.get("icon-offset").evaluate(he,{},p.canonical),m.get("icon-anchor").evaluate(he,{},p.canonical)),$=!!se.sdf,p.bucket.sdfIcons===void 0?p.bucket.sdfIcons=$:p.bucket.sdfIcons!==$&&Ze("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(se.pixelRatio!==p.bucket.pixelRatio||m.get("icon-rotate").constantOr(1)!==0)&&(p.bucket.iconsNeedLinear=!0))}const X=qx(E.horizontal)||E.vertical;p.bucket.iconsInText=!!X&&X.iconsInText,(X||D)&&FI(p.bucket,he,E,D,p.imageMap,P,f,v,G,$,p.canonical)}p.showCollisionBoxes&&p.bucket.generateCollisionDebugBuffers()},l.bm=KA,l.bn=ym,l.bo=V0,l.bp=Hu,l.bq=X0,l.br=class{constructor(p){this._marks={start:[p.url,"start"].join("#"),end:[p.url,"end"].join("#"),measure:p.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let p=performance.getEntriesByName(this._marks.measure);return p.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),p=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),p}},l.bs=function(p,u,m,C,P){return s(this,void 0,void 0,function*(){if(de())try{return yield Mt(p,u,m,C,P)}catch{}return function(Q,V,K,re,he){const h=Q.width,c=Q.height;Wt&&Se||(Wt=new OffscreenCanvas(h,c),Se=Wt.getContext("2d",{willReadFrequently:!0})),Wt.width=h,Wt.height=c,Se.drawImage(Q,0,0,h,c);const f=Se.getImageData(V,K,re,he);return Se.clearRect(0,0,h,c),f.data}(p,u,m,C,P)})},l.bt=c_,l.bu=g,l.bv=b,l.bw=$0,l.bx=Un,l.by=function(p){return p.message===Xe},l.bz=il,l.c=et,l.d=p=>s(void 0,void 0,void 0,function*(){if(p.byteLength===0)return createImageBitmap(new ImageData(1,1));const u=new Blob([new Uint8Array(p)],{type:"image/png"});try{return createImageBitmap(u)}catch(m){throw new Error(`Could not load image because of ${m.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),l.e=qe,l.f=p=>new Promise((u,m)=>{const C=new Image;C.onload=()=>{u(C),URL.revokeObjectURL(C.src),C.onload=null,window.requestAnimationFrame(()=>{C.src=Ft})},C.onerror=()=>m(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(p)],{type:"image/png"});C.src=p.byteLength?URL.createObjectURL(P):Ft}),l.g=ft,l.h=(p,u)=>Ht(qe(p,{type:"json"}),u),l.i=Ct,l.j=kt,l.k=Mi,l.l=(p,u)=>Ht(qe(p,{type:"arrayBuffer"}),u),l.m=Ht,l.n=function(p){return new X0(p).readFields(EI,[])},l.o=mu,l.p=pp,l.q=Es,l.r=ya,l.s=ii,l.t=Zo,l.u=Ei,l.v=xt,l.w=Ze,l.x=jn,l.y=function(p){let[u,m,C]=p;return m+=90,m*=Math.PI/180,C*=Math.PI/180,{x:u*Math.cos(m)*Math.sin(C),y:u*Math.sin(m)*Math.sin(C),z:u*Math.cos(C)}},l.z=dn}),n("worker",["./shared"],function(l){class s{constructor(we){this.keyCache={},we&&this.replace(we)}replace(we){this._layerConfigs={},this._layers={},this.update(we,[])}update(we,oe){for(const le of we){this._layerConfigs[le.id]=le;const ge=this._layers[le.id]=l.az(le);ge._featureFilter=l.a6(ge.filter),this.keyCache[le.id]&&delete this.keyCache[le.id]}for(const le of oe)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};const ee=l.bg(Object.values(this._layerConfigs),this.keyCache);for(const le of ee){const ge=le.map(Ge=>this._layers[Ge.id]),ve=ge[0];if(ve.visibility==="none")continue;const Ce=ve.source||"";let be=this.familiesBySource[Ce];be||(be=this.familiesBySource[Ce]={});const Pe=ve.sourceLayer||"_geojsonTileLayer";let Oe=be[Pe];Oe||(Oe=be[Pe]=[]),Oe.push(ge)}}}class g{constructor(we){const oe={},ee=[];for(const Ce in we){const be=we[Ce],Pe=oe[Ce]={};for(const Oe in be){const Ge=be[+Oe];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const rt={x:0,y:0,w:Ge.bitmap.width+2,h:Ge.bitmap.height+2};ee.push(rt),Pe[Oe]={rect:rt,metrics:Ge.metrics}}}const{w:le,h:ge}=l.p(ee),ve=new l.o({width:le||1,height:ge||1});for(const Ce in we){const be=we[Ce];for(const Pe in be){const Oe=be[+Pe];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;const Ge=oe[Ce][Pe].rect;l.o.copy(Oe.bitmap,ve,{x:0,y:0},{x:Ge.x+1,y:Ge.y+1},Oe.bitmap)}}this.image=ve,this.positions=oe}}l.bh("GlyphAtlas",g);class b{constructor(we){this.tileID=new l.Q(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),this.uid=we.uid,this.zoom=we.zoom,this.pixelRatio=we.pixelRatio,this.tileSize=we.tileSize,this.source=we.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=we.showCollisionBoxes,this.collectResourceTiming=!!we.collectResourceTiming,this.returnDependencies=!!we.returnDependencies,this.promoteId=we.promoteId,this.inFlightDependencies=[]}parse(we,oe,ee,le){return l._(this,void 0,void 0,function*(){this.status="parsing",this.data=we,this.collisionBoxArray=new l.a4;const ge=new l.bi(Object.keys(we.layers).sort()),ve=new l.bj(this.tileID,this.promoteId);ve.bucketLayerIDs=[];const Ce={},be={featureIndex:ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ee},Pe=oe.familiesBySource[this.source];for(const wi in Pe){const Ui=we.layers[wi];if(!Ui)continue;Ui.version===1&&l.w(`Vector tile source "${this.source}" layer "${wi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const st=ge.encode(wi),ti=[];for(let zt=0;zt<Ui.length;zt++){const zi=Ui.feature(zt),hr=ve.getId(zi,wi);ti.push({feature:zi,id:hr,index:zt,sourceLayerIndex:st})}for(const zt of Pe[wi]){const zi=zt[0];zi.source!==this.source&&l.w(`layer.source = ${zi.source} does not equal this.source = ${this.source}`),zi.minzoom&&this.zoom<Math.floor(zi.minzoom)||zi.maxzoom&&this.zoom>=zi.maxzoom||zi.visibility!=="none"&&(T(zt,this.zoom,ee),(Ce[zi.id]=zi.createBucket({index:ve.bucketLayerIDs.length,layers:zt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:st,sourceID:this.source})).populate(ti,be,this.tileID.canonical),ve.bucketLayerIDs.push(zt.map(hr=>hr.id)))}}const Oe=l.aE(be.glyphDependencies,wi=>Object.keys(wi).map(Number));this.inFlightDependencies.forEach(wi=>wi==null?void 0:wi.abort()),this.inFlightDependencies=[];let Ge=Promise.resolve({});if(Object.keys(Oe).length){const wi=new AbortController;this.inFlightDependencies.push(wi),Ge=le.sendAsync({type:"getGlyphs",data:{stacks:Oe,source:this.source,tileID:this.tileID,type:"glyphs"}},wi)}const rt=Object.keys(be.iconDependencies);let yt=Promise.resolve({});if(rt.length){const wi=new AbortController;this.inFlightDependencies.push(wi),yt=le.sendAsync({type:"getImages",data:{icons:rt,source:this.source,tileID:this.tileID,type:"icons"}},wi)}const Et=Object.keys(be.patternDependencies);let Yt=Promise.resolve({});if(Et.length){const wi=new AbortController;this.inFlightDependencies.push(wi),Yt=le.sendAsync({type:"getImages",data:{icons:Et,source:this.source,tileID:this.tileID,type:"patterns"}},wi)}const[qt,Kt,si]=yield Promise.all([Ge,yt,Yt]),Ci=new g(qt),Hi=new l.bk(Kt,si);for(const wi in Ce){const Ui=Ce[wi];Ui instanceof l.a5?(T(Ui.layers,this.zoom,ee),l.bl({bucket:Ui,glyphMap:qt,glyphPositions:Ci.positions,imageMap:Kt,imagePositions:Hi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ui.hasPattern&&(Ui instanceof l.bm||Ui instanceof l.bn||Ui instanceof l.bo)&&(T(Ui.layers,this.zoom,ee),Ui.addFeatures(be,this.tileID.canonical,Hi.patternPositions))}return this.status="done",{buckets:Object.values(Ce).filter(wi=>!wi.isEmpty()),featureIndex:ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ci.image,imageAtlas:Hi,glyphMap:this.returnDependencies?qt:null,iconMap:this.returnDependencies?Kt:null,glyphPositions:this.returnDependencies?Ci.positions:null}})}}function T(ze,we,oe){const ee=new l.a8(we);for(const le of ze)le.recalculate(ee,oe)}class F{constructor(we,oe,ee){this.actor=we,this.layerIndex=oe,this.availableImages=ee,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(we,oe){return l._(this,void 0,void 0,function*(){const ee=yield l.l(we.request,oe);try{return{vectorTile:new l.bp.VectorTile(new l.bq(ee.data)),rawData:ee.data,cacheControl:ee.cacheControl,expires:ee.expires}}catch(le){const ge=new Uint8Array(ee.data);let ve=`Unable to parse the tile at ${we.request.url}, `;throw ve+=ge[0]===31&&ge[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${le.messge}`,new Error(ve)}})}loadTile(we){return l._(this,void 0,void 0,function*(){const oe=we.uid,ee=!!(we&&we.request&&we.request.collectResourceTiming)&&new l.br(we.request),le=new b(we);this.loading[oe]=le;const ge=new AbortController;le.abort=ge;try{const ve=yield this.loadVectorTile(we,ge);if(delete this.loading[oe],!ve)return null;const Ce=ve.rawData,be={};ve.expires&&(be.expires=ve.expires),ve.cacheControl&&(be.cacheControl=ve.cacheControl);const Pe={};if(ee){const Ge=ee.finish();Ge&&(Pe.resourceTiming=JSON.parse(JSON.stringify(Ge)))}le.vectorTile=ve.vectorTile;const Oe=le.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[oe]=le,this.fetching[oe]={rawTileData:Ce,cacheControl:be,resourceTiming:Pe};try{const Ge=yield Oe;return l.e({rawTileData:Ce.slice(0)},Ge,be,Pe)}finally{delete this.fetching[oe]}}catch(ve){throw delete this.loading[oe],le.status="done",this.loaded[oe]=le,ve}})}reloadTile(we){return l._(this,void 0,void 0,function*(){const oe=we.uid;if(!this.loaded||!this.loaded[oe])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ee=this.loaded[oe];if(ee.showCollisionBoxes=we.showCollisionBoxes,ee.status==="parsing"){const le=yield ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor);let ge;if(this.fetching[oe]){const{rawTileData:ve,cacheControl:Ce,resourceTiming:be}=this.fetching[oe];delete this.fetching[oe],ge=l.e({rawTileData:ve.slice(0)},le,Ce,be)}else ge=le;return ge}if(ee.status==="done"&&ee.vectorTile)return ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(we){return l._(this,void 0,void 0,function*(){const oe=this.loading,ee=we.uid;oe&&oe[ee]&&oe[ee].abort&&(oe[ee].abort.abort(),delete oe[ee])})}removeTile(we){return l._(this,void 0,void 0,function*(){this.loaded&&this.loaded[we.uid]&&delete this.loaded[we.uid]})}}class k{constructor(){this.loaded={}}loadTile(we){return l._(this,void 0,void 0,function*(){const{uid:oe,encoding:ee,rawImageData:le,redFactor:ge,greenFactor:ve,blueFactor:Ce,baseShift:be}=we,Pe=le.width+2,Oe=le.height+2,Ge=l.b(le)?new l.R({width:Pe,height:Oe},yield l.bs(le,-1,-1,Pe,Oe)):le,rt=new l.bt(oe,Ge,ee,ge,ve,Ce,be);return this.loaded=this.loaded||{},this.loaded[oe]=rt,rt})}removeTile(we){const oe=this.loaded,ee=we.uid;oe&&oe[ee]&&delete oe[ee]}}function z(ze,we){if(ze.length!==0){J(ze[0],we);for(var oe=1;oe<ze.length;oe++)J(ze[oe],!we)}}function J(ze,we){for(var oe=0,ee=0,le=0,ge=ze.length,ve=ge-1;le<ge;ve=le++){var Ce=(ze[le][0]-ze[ve][0])*(ze[ve][1]+ze[le][1]),be=oe+Ce;ee+=Math.abs(oe)>=Math.abs(Ce)?oe-be+Ce:Ce-be+oe,oe=be}oe+ee>=0!=!!we&&ze.reverse()}var te=l.bu(function ze(we,oe){var ee,le=we&&we.type;if(le==="FeatureCollection")for(ee=0;ee<we.features.length;ee++)ze(we.features[ee],oe);else if(le==="GeometryCollection")for(ee=0;ee<we.geometries.length;ee++)ze(we.geometries[ee],oe);else if(le==="Feature")ze(we.geometry,oe);else if(le==="Polygon")z(we.coordinates,oe);else if(le==="MultiPolygon")for(ee=0;ee<we.coordinates.length;ee++)z(we.coordinates[ee],oe);return we});const ue=l.bp.VectorTileFeature.prototype.toGeoJSON;var ce={exports:{}},de=l.bv,_e=l.bp.VectorTileFeature,Ee=He;function He(ze,we){this.options=we||{},this.features=ze,this.length=ze.length}function Ve(ze,we){this.id=typeof ze.id=="number"?ze.id:void 0,this.type=ze.type,this.rawGeometry=ze.type===1?[ze.geometry]:ze.geometry,this.properties=ze.tags,this.extent=we||4096}He.prototype.feature=function(ze){return new Ve(this.features[ze],this.options.extent)},Ve.prototype.loadGeometry=function(){var ze=this.rawGeometry;this.geometry=[];for(var we=0;we<ze.length;we++){for(var oe=ze[we],ee=[],le=0;le<oe.length;le++)ee.push(new de(oe[le][0],oe[le][1]));this.geometry.push(ee)}return this.geometry},Ve.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ze=this.geometry,we=1/0,oe=-1/0,ee=1/0,le=-1/0,ge=0;ge<ze.length;ge++)for(var ve=ze[ge],Ce=0;Ce<ve.length;Ce++){var be=ve[Ce];we=Math.min(we,be.x),oe=Math.max(oe,be.x),ee=Math.min(ee,be.y),le=Math.max(le,be.y)}return[we,ee,oe,le]},Ve.prototype.toGeoJSON=_e.prototype.toGeoJSON;var qe=l.bw,Ue=Ee;function ot(ze){var we=new qe;return function(oe,ee){for(var le in oe.layers)ee.writeMessage(3,it,oe.layers[le])}(ze,we),we.finish()}function it(ze,we){var oe;we.writeVarintField(15,ze.version||1),we.writeStringField(1,ze.name||""),we.writeVarintField(5,ze.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(oe=0;oe<ze.length;oe++)ee.feature=ze.feature(oe),we.writeMessage(2,De,ee);var le=ee.keys;for(oe=0;oe<le.length;oe++)we.writeStringField(3,le[oe]);var ge=ee.values;for(oe=0;oe<ge.length;oe++)we.writeMessage(4,Ct,ge[oe])}function De(ze,we){var oe=ze.feature;oe.id!==void 0&&we.writeVarintField(1,oe.id),we.writeMessage(2,Me,ze),we.writeVarintField(3,oe.type),we.writeMessage(4,Bt,oe)}function Me(ze,we){var oe=ze.feature,ee=ze.keys,le=ze.values,ge=ze.keycache,ve=ze.valuecache;for(var Ce in oe.properties){var be=oe.properties[Ce],Pe=ge[Ce];if(be!==null){Pe===void 0&&(ee.push(Ce),ge[Ce]=Pe=ee.length-1),we.writeVarint(Pe);var Oe=typeof be;Oe!=="string"&&Oe!=="boolean"&&Oe!=="number"&&(be=JSON.stringify(be));var Ge=Oe+":"+be,rt=ve[Ge];rt===void 0&&(le.push(be),ve[Ge]=rt=le.length-1),we.writeVarint(rt)}}}function Ze(ze,we){return(we<<3)+(7&ze)}function We(ze){return ze<<1^ze>>31}function Bt(ze,we){for(var oe=ze.loadGeometry(),ee=ze.type,le=0,ge=0,ve=oe.length,Ce=0;Ce<ve;Ce++){var be=oe[Ce],Pe=1;ee===1&&(Pe=be.length),we.writeVarint(Ze(1,Pe));for(var Oe=ee===3?be.length-1:be.length,Ge=0;Ge<Oe;Ge++){Ge===1&&ee!==1&&we.writeVarint(Ze(2,Oe-1));var rt=be[Ge].x-le,yt=be[Ge].y-ge;we.writeVarint(We(rt)),we.writeVarint(We(yt)),le+=rt,ge+=yt}ee===3&&we.writeVarint(Ze(7,1))}}function Ct(ze,we){var oe=typeof ze;oe==="string"?we.writeStringField(1,ze):oe==="boolean"?we.writeBooleanField(7,ze):oe==="number"&&(ze%1!=0?we.writeDoubleField(3,ze):ze<0?we.writeSVarintField(6,ze):we.writeVarintField(5,ze))}ce.exports=ot,ce.exports.fromVectorTileJs=ot,ce.exports.fromGeojsonVt=function(ze,we){we=we||{};var oe={};for(var ee in ze)oe[ee]=new Ue(ze[ee].features,we),oe[ee].name=ee,oe[ee].version=we.version,oe[ee].extent=we.extent;return ot({layers:oe})},ce.exports.GeoJSONWrapper=Ue;var Lt=l.bu(ce.exports);const _t={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ze=>ze},Ft=Math.fround||(Mt=new Float32Array(1),ze=>(Mt[0]=+ze,Mt[0]));var Mt;const Wt=3,Se=5,Xe=6;class et{constructor(we){this.options=Object.assign(Object.create(_t),we),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(we){const{log:oe,minZoom:ee,maxZoom:le}=this.options;oe&&console.time("total time");const ge=`prepare ${we.length} points`;oe&&console.time(ge),this.points=we;const ve=[];for(let be=0;be<we.length;be++){const Pe=we[be];if(!Pe.geometry)continue;const[Oe,Ge]=Pe.geometry.coordinates,rt=Ft(wt(Oe)),yt=Ft(Pt(Ge));ve.push(rt,yt,1/0,be,-1,1),this.options.reduce&&ve.push(0)}let Ce=this.trees[le+1]=this._createTree(ve);oe&&console.timeEnd(ge);for(let be=le;be>=ee;be--){const Pe=+Date.now();Ce=this.trees[be]=this._createTree(this._cluster(Ce,be)),oe&&console.log("z%d: %d clusters in %dms",be,Ce.numItems,+Date.now()-Pe)}return oe&&console.timeEnd("total time"),this}getClusters(we,oe){let ee=((we[0]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,we[1]));let ge=we[2]===180?180:((we[2]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,we[3]));if(we[2]-we[0]>=360)ee=-180,ge=180;else if(ee>ge){const Ge=this.getClusters([ee,le,180,ve],oe),rt=this.getClusters([-180,le,ge,ve],oe);return Ge.concat(rt)}const Ce=this.trees[this._limitZoom(oe)],be=Ce.range(wt(ee),Pt(ve),wt(ge),Pt(le)),Pe=Ce.data,Oe=[];for(const Ge of be){const rt=this.stride*Ge;Oe.push(Pe[rt+Se]>1?At(Pe,rt,this.clusterProps):this.points[Pe[rt+Wt]])}return Oe}getChildren(we){const oe=this._getOriginId(we),ee=this._getOriginZoom(we),le="No cluster with the specified id.",ge=this.trees[ee];if(!ge)throw new Error(le);const ve=ge.data;if(oe*this.stride>=ve.length)throw new Error(le);const Ce=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),be=ge.within(ve[oe*this.stride],ve[oe*this.stride+1],Ce),Pe=[];for(const Oe of be){const Ge=Oe*this.stride;ve[Ge+4]===we&&Pe.push(ve[Ge+Se]>1?At(ve,Ge,this.clusterProps):this.points[ve[Ge+Wt]])}if(Pe.length===0)throw new Error(le);return Pe}getLeaves(we,oe,ee){const le=[];return this._appendLeaves(le,we,oe=oe||10,ee=ee||0,0),le}getTile(we,oe,ee){const le=this.trees[this._limitZoom(we)],ge=Math.pow(2,we),{extent:ve,radius:Ce}=this.options,be=Ce/ve,Pe=(ee-be)/ge,Oe=(ee+1+be)/ge,Ge={features:[]};return this._addTileFeatures(le.range((oe-be)/ge,Pe,(oe+1+be)/ge,Oe),le.data,oe,ee,ge,Ge),oe===0&&this._addTileFeatures(le.range(1-be/ge,Pe,1,Oe),le.data,ge,ee,ge,Ge),oe===ge-1&&this._addTileFeatures(le.range(0,Pe,be/ge,Oe),le.data,-1,ee,ge,Ge),Ge.features.length?Ge:null}getClusterExpansionZoom(we){let oe=this._getOriginZoom(we)-1;for(;oe<=this.options.maxZoom;){const ee=this.getChildren(we);if(oe++,ee.length!==1)break;we=ee[0].properties.cluster_id}return oe}_appendLeaves(we,oe,ee,le,ge){const ve=this.getChildren(oe);for(const Ce of ve){const be=Ce.properties;if(be&&be.cluster?ge+be.point_count<=le?ge+=be.point_count:ge=this._appendLeaves(we,be.cluster_id,ee,le,ge):ge<le?ge++:we.push(Ce),we.length===ee)break}return ge}_createTree(we){const oe=new l.au(we.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<we.length;ee+=this.stride)oe.add(we[ee],we[ee+1]);return oe.finish(),oe.data=we,oe}_addTileFeatures(we,oe,ee,le,ge,ve){for(const Ce of we){const be=Ce*this.stride,Pe=oe[be+Se]>1;let Oe,Ge,rt;if(Pe)Oe=ft(oe,be,this.clusterProps),Ge=oe[be],rt=oe[be+1];else{const Yt=this.points[oe[be+Wt]];Oe=Yt.properties;const[qt,Kt]=Yt.geometry.coordinates;Ge=wt(qt),rt=Pt(Kt)}const yt={type:1,geometry:[[Math.round(this.options.extent*(Ge*ge-ee)),Math.round(this.options.extent*(rt*ge-le))]],tags:Oe};let Et;Et=Pe||this.options.generateId?oe[be+Wt]:this.points[oe[be+Wt]].id,Et!==void 0&&(yt.id=Et),ve.features.push(yt)}}_limitZoom(we){return Math.max(this.options.minZoom,Math.min(Math.floor(+we),this.options.maxZoom+1))}_cluster(we,oe){const{radius:ee,extent:le,reduce:ge,minPoints:ve}=this.options,Ce=ee/(le*Math.pow(2,oe)),be=we.data,Pe=[],Oe=this.stride;for(let Ge=0;Ge<be.length;Ge+=Oe){if(be[Ge+2]<=oe)continue;be[Ge+2]=oe;const rt=be[Ge],yt=be[Ge+1],Et=we.within(be[Ge],be[Ge+1],Ce),Yt=be[Ge+Se];let qt=Yt;for(const Kt of Et){const si=Kt*Oe;be[si+2]>oe&&(qt+=be[si+Se])}if(qt>Yt&&qt>=ve){let Kt,si=rt*Yt,Ci=yt*Yt,Hi=-1;const wi=((Ge/Oe|0)<<5)+(oe+1)+this.points.length;for(const Ui of Et){const st=Ui*Oe;if(be[st+2]<=oe)continue;be[st+2]=oe;const ti=be[st+Se];si+=be[st]*ti,Ci+=be[st+1]*ti,be[st+4]=wi,ge&&(Kt||(Kt=this._map(be,Ge,!0),Hi=this.clusterProps.length,this.clusterProps.push(Kt)),ge(Kt,this._map(be,st)))}be[Ge+4]=wi,Pe.push(si/qt,Ci/qt,1/0,wi,-1,qt),ge&&Pe.push(Hi)}else{for(let Kt=0;Kt<Oe;Kt++)Pe.push(be[Ge+Kt]);if(qt>1)for(const Kt of Et){const si=Kt*Oe;if(!(be[si+2]<=oe)){be[si+2]=oe;for(let Ci=0;Ci<Oe;Ci++)Pe.push(be[si+Ci])}}}}return Pe}_getOriginId(we){return we-this.points.length>>5}_getOriginZoom(we){return(we-this.points.length)%32}_map(we,oe,ee){if(we[oe+Se]>1){const ve=this.clusterProps[we[oe+Xe]];return ee?Object.assign({},ve):ve}const le=this.points[we[oe+Wt]].properties,ge=this.options.map(le);return ee&&ge===le?Object.assign({},ge):ge}}function At(ze,we,oe){return{type:"Feature",id:ze[we+Wt],properties:ft(ze,we,oe),geometry:{type:"Point",coordinates:[(ee=ze[we],360*(ee-.5)),It(ze[we+1])]}};var ee}function ft(ze,we,oe){const ee=ze[we+Se],le=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,ge=ze[we+Xe],ve=ge===-1?{}:Object.assign({},oe[ge]);return Object.assign(ve,{cluster:!0,cluster_id:ze[we+Wt],point_count:ee,point_count_abbreviated:le})}function wt(ze){return ze/360+.5}function Pt(ze){const we=Math.sin(ze*Math.PI/180),oe=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return oe<0?0:oe>1?1:oe}function It(ze){const we=(180-360*ze)*Math.PI/180;return 360*Math.atan(Math.exp(we))/Math.PI-90}function Ht(ze,we,oe,ee){for(var le,ge=ee,ve=oe-we>>1,Ce=oe-we,be=ze[we],Pe=ze[we+1],Oe=ze[oe],Ge=ze[oe+1],rt=we+3;rt<oe;rt+=3){var yt=ii(ze[rt],ze[rt+1],be,Pe,Oe,Ge);if(yt>ge)le=rt,ge=yt;else if(yt===ge){var Et=Math.abs(rt-ve);Et<Ce&&(le=rt,Ce=Et)}}ge>ee&&(le-we>3&&Ht(ze,we,le,ee),ze[le+2]=ge,oe-le>3&&Ht(ze,le,oe,ee))}function ii(ze,we,oe,ee,le,ge){var ve=le-oe,Ce=ge-ee;if(ve!==0||Ce!==0){var be=((ze-oe)*ve+(we-ee)*Ce)/(ve*ve+Ce*Ce);be>1?(oe=le,ee=ge):be>0&&(oe+=ve*be,ee+=Ce*be)}return(ve=ze-oe)*ve+(Ce=we-ee)*Ce}function gi(ze,we,oe,ee){var le={id:ze===void 0?null:ze,type:we,geometry:oe,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ge){var ve=ge.geometry,Ce=ge.type;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")mi(ge,ve);else if(Ce==="Polygon"||Ce==="MultiLineString")for(var be=0;be<ve.length;be++)mi(ge,ve[be]);else if(Ce==="MultiPolygon")for(be=0;be<ve.length;be++)for(var Pe=0;Pe<ve[be].length;Pe++)mi(ge,ve[be][Pe])}(le),le}function mi(ze,we){for(var oe=0;oe<we.length;oe+=3)ze.minX=Math.min(ze.minX,we[oe]),ze.minY=Math.min(ze.minY,we[oe+1]),ze.maxX=Math.max(ze.maxX,we[oe]),ze.maxY=Math.max(ze.maxY,we[oe+1])}function Mi(ze,we,oe,ee){if(we.geometry){var le=we.geometry.coordinates,ge=we.geometry.type,ve=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2),Ce=[],be=we.id;if(oe.promoteId?be=we.properties[oe.promoteId]:oe.generateId&&(be=ee||0),ge==="Point")kt(le,Ce);else if(ge==="MultiPoint")for(var Pe=0;Pe<le.length;Pe++)kt(le[Pe],Ce);else if(ge==="LineString")at(le,Ce,ve,!1);else if(ge==="MultiLineString"){if(oe.lineMetrics){for(Pe=0;Pe<le.length;Pe++)at(le[Pe],Ce=[],ve,!1),ze.push(gi(be,"LineString",Ce,we.properties));return}xt(le,Ce,ve,!1)}else if(ge==="Polygon")xt(le,Ce,ve,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(Pe=0;Pe<we.geometry.geometries.length;Pe++)Mi(ze,{id:be,geometry:we.geometry.geometries[Pe],properties:we.properties},oe,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Pe=0;Pe<le.length;Pe++){var Oe=[];xt(le[Pe],Oe,ve,!0),Ce.push(Oe)}}ze.push(gi(be,ge,Ce,we.properties))}}function kt(ze,we){we.push(Ri(ze[0])),we.push(ei(ze[1])),we.push(0)}function at(ze,we,oe,ee){for(var le,ge,ve=0,Ce=0;Ce<ze.length;Ce++){var be=Ri(ze[Ce][0]),Pe=ei(ze[Ce][1]);we.push(be),we.push(Pe),we.push(0),Ce>0&&(ve+=ee?(le*Pe-be*ge)/2:Math.sqrt(Math.pow(be-le,2)+Math.pow(Pe-ge,2))),le=be,ge=Pe}var Oe=we.length-3;we[2]=1,Ht(we,0,Oe,oe),we[Oe+2]=1,we.size=Math.abs(ve),we.start=0,we.end=we.size}function xt(ze,we,oe,ee){for(var le=0;le<ze.length;le++){var ge=[];at(ze[le],ge,oe,ee),we.push(ge)}}function Ri(ze){return ze/360+.5}function ei(ze){var we=Math.sin(ze*Math.PI/180),oe=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return oe<0?0:oe>1?1:oe}function ut(ze,we,oe,ee,le,ge,ve,Ce){if(ee/=we,ge>=(oe/=we)&&ve<ee)return ze;if(ve<oe||ge>=ee)return null;for(var be=[],Pe=0;Pe<ze.length;Pe++){var Oe=ze[Pe],Ge=Oe.geometry,rt=Oe.type,yt=le===0?Oe.minX:Oe.minY,Et=le===0?Oe.maxX:Oe.maxY;if(yt>=oe&&Et<ee)be.push(Oe);else if(!(Et<oe||yt>=ee)){var Yt=[];if(rt==="Point"||rt==="MultiPoint")jt(Ge,Yt,oe,ee,le);else if(rt==="LineString")ni(Ge,Yt,oe,ee,le,!1,Ce.lineMetrics);else if(rt==="MultiLineString")li(Ge,Yt,oe,ee,le,!1);else if(rt==="Polygon")li(Ge,Yt,oe,ee,le,!0);else if(rt==="MultiPolygon")for(var qt=0;qt<Ge.length;qt++){var Kt=[];li(Ge[qt],Kt,oe,ee,le,!0),Kt.length&&Yt.push(Kt)}if(Yt.length){if(Ce.lineMetrics&&rt==="LineString"){for(qt=0;qt<Yt.length;qt++)be.push(gi(Oe.id,rt,Yt[qt],Oe.tags));continue}rt!=="LineString"&&rt!=="MultiLineString"||(Yt.length===1?(rt="LineString",Yt=Yt[0]):rt="MultiLineString"),rt!=="Point"&&rt!=="MultiPoint"||(rt=Yt.length===3?"Point":"MultiPoint"),be.push(gi(Oe.id,rt,Yt,Oe.tags))}}}return be.length?be:null}function jt(ze,we,oe,ee,le){for(var ge=0;ge<ze.length;ge+=3){var ve=ze[ge+le];ve>=oe&&ve<=ee&&(we.push(ze[ge]),we.push(ze[ge+1]),we.push(ze[ge+2]))}}function ni(ze,we,oe,ee,le,ge,ve){for(var Ce,be,Pe=di(ze),Oe=le===0?tr:Ar,Ge=ze.start,rt=0;rt<ze.length-3;rt+=3){var yt=ze[rt],Et=ze[rt+1],Yt=ze[rt+2],qt=ze[rt+3],Kt=ze[rt+4],si=le===0?yt:Et,Ci=le===0?qt:Kt,Hi=!1;ve&&(Ce=Math.sqrt(Math.pow(yt-qt,2)+Math.pow(Et-Kt,2))),si<oe?Ci>oe&&(be=Oe(Pe,yt,Et,qt,Kt,oe),ve&&(Pe.start=Ge+Ce*be)):si>ee?Ci<ee&&(be=Oe(Pe,yt,Et,qt,Kt,ee),ve&&(Pe.start=Ge+Ce*be)):Ki(Pe,yt,Et,Yt),Ci<oe&&si>=oe&&(be=Oe(Pe,yt,Et,qt,Kt,oe),Hi=!0),Ci>ee&&si<=ee&&(be=Oe(Pe,yt,Et,qt,Kt,ee),Hi=!0),!ge&&Hi&&(ve&&(Pe.end=Ge+Ce*be),we.push(Pe),Pe=di(ze)),ve&&(Ge+=Ce)}var wi=ze.length-3;yt=ze[wi],Et=ze[wi+1],Yt=ze[wi+2],(si=le===0?yt:Et)>=oe&&si<=ee&&Ki(Pe,yt,Et,Yt),wi=Pe.length-3,ge&&wi>=3&&(Pe[wi]!==Pe[0]||Pe[wi+1]!==Pe[1])&&Ki(Pe,Pe[0],Pe[1],Pe[2]),Pe.length&&we.push(Pe)}function di(ze){var we=[];return we.size=ze.size,we.start=ze.start,we.end=ze.end,we}function li(ze,we,oe,ee,le,ge){for(var ve=0;ve<ze.length;ve++)ni(ze[ve],we,oe,ee,le,ge,!1)}function Ki(ze,we,oe,ee){ze.push(we),ze.push(oe),ze.push(ee)}function tr(ze,we,oe,ee,le,ge){var ve=(ge-we)/(ee-we);return ze.push(ge),ze.push(oe+(le-oe)*ve),ze.push(1),ve}function Ar(ze,we,oe,ee,le,ge){var ve=(ge-oe)/(le-oe);return ze.push(we+(ee-we)*ve),ze.push(ge),ze.push(1),ve}function Er(ze,we){for(var oe=[],ee=0;ee<ze.length;ee++){var le,ge=ze[ee],ve=ge.type;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")le=Nt(ge.geometry,we);else if(ve==="MultiLineString"||ve==="Polygon"){le=[];for(var Ce=0;Ce<ge.geometry.length;Ce++)le.push(Nt(ge.geometry[Ce],we))}else if(ve==="MultiPolygon")for(le=[],Ce=0;Ce<ge.geometry.length;Ce++){for(var be=[],Pe=0;Pe<ge.geometry[Ce].length;Pe++)be.push(Nt(ge.geometry[Ce][Pe],we));le.push(be)}oe.push(gi(ge.id,ve,le,ge.tags))}return oe}function Nt(ze,we){var oe=[];oe.size=ze.size,ze.start!==void 0&&(oe.start=ze.start,oe.end=ze.end);for(var ee=0;ee<ze.length;ee+=3)oe.push(ze[ee]+we,ze[ee+1],ze[ee+2]);return oe}function Ji(ze,we){if(ze.transformed)return ze;var oe,ee,le,ge=1<<ze.z,ve=ze.x,Ce=ze.y;for(oe=0;oe<ze.features.length;oe++){var be=ze.features[oe],Pe=be.geometry,Oe=be.type;if(be.geometry=[],Oe===1)for(ee=0;ee<Pe.length;ee+=2)be.geometry.push(ci(Pe[ee],Pe[ee+1],we,ge,ve,Ce));else for(ee=0;ee<Pe.length;ee++){var Ge=[];for(le=0;le<Pe[ee].length;le+=2)Ge.push(ci(Pe[ee][le],Pe[ee][le+1],we,ge,ve,Ce));be.geometry.push(Ge)}}return ze.transformed=!0,ze}function ci(ze,we,oe,ee,le,ge){return[Math.round(oe*(ze*ee-le)),Math.round(oe*(we*ee-ge))]}function $t(ze,we,oe,ee,le){for(var ge=we===le.maxZoom?0:le.tolerance/((1<<we)*le.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:oe,y:ee,z:we,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ce=0;Ce<ze.length;Ce++){ve.numFeatures++,Zi(ve,ze[Ce],ge,le);var be=ze[Ce].minX,Pe=ze[Ce].minY,Oe=ze[Ce].maxX,Ge=ze[Ce].maxY;be<ve.minX&&(ve.minX=be),Pe<ve.minY&&(ve.minY=Pe),Oe>ve.maxX&&(ve.maxX=Oe),Ge>ve.maxY&&(ve.maxY=Ge)}return ve}function Zi(ze,we,oe,ee){var le=we.geometry,ge=we.type,ve=[];if(ge==="Point"||ge==="MultiPoint")for(var Ce=0;Ce<le.length;Ce+=3)ve.push(le[Ce]),ve.push(le[Ce+1]),ze.numPoints++,ze.numSimplified++;else if(ge==="LineString")Qt(ve,le,ze,oe,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(Ce=0;Ce<le.length;Ce++)Qt(ve,le[Ce],ze,oe,ge==="Polygon",Ce===0);else if(ge==="MultiPolygon")for(var be=0;be<le.length;be++){var Pe=le[be];for(Ce=0;Ce<Pe.length;Ce++)Qt(ve,Pe[Ce],ze,oe,!0,Ce===0)}if(ve.length){var Oe=we.tags||null;if(ge==="LineString"&&ee.lineMetrics){for(var Ge in Oe={},we.tags)Oe[Ge]=we.tags[Ge];Oe.mapbox_clip_start=le.start/le.size,Oe.mapbox_clip_end=le.end/le.size}var rt={geometry:ve,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:Oe};we.id!==null&&(rt.id=we.id),ze.features.push(rt)}}function Qt(ze,we,oe,ee,le,ge){var ve=ee*ee;if(ee>0&&we.size<(le?ve:ee))oe.numPoints+=we.length/3;else{for(var Ce=[],be=0;be<we.length;be+=3)(ee===0||we[be+2]>ve)&&(oe.numSimplified++,Ce.push(we[be]),Ce.push(we[be+1])),oe.numPoints++;le&&function(Pe,Oe){for(var Ge=0,rt=0,yt=Pe.length,Et=yt-2;rt<yt;Et=rt,rt+=2)Ge+=(Pe[rt]-Pe[Et])*(Pe[rt+1]+Pe[Et+1]);if(Ge>0===Oe)for(rt=0,yt=Pe.length;rt<yt/2;rt+=2){var Yt=Pe[rt],qt=Pe[rt+1];Pe[rt]=Pe[yt-2-rt],Pe[rt+1]=Pe[yt-1-rt],Pe[yt-2-rt]=Yt,Pe[yt-1-rt]=qt}}(Ce,ge),ze.push(Ce)}}function Bi(ze,we){var oe=(we=this.options=function(le,ge){for(var ve in ge)le[ve]=ge[ve];return le}(Object.create(this.options),we)).debug;if(oe&&console.time("preprocess data"),we.maxZoom<0||we.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(we.promoteId&&we.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee=function(le,ge){var ve=[];if(le.type==="FeatureCollection")for(var Ce=0;Ce<le.features.length;Ce++)Mi(ve,le.features[Ce],ge,Ce);else Mi(ve,le.type==="Feature"?le:{geometry:le},ge);return ve}(ze,we);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",we.indexMaxZoom,we.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=function(le,ge){var ve=ge.buffer/ge.extent,Ce=le,be=ut(le,1,-1-ve,ve,0,-1,2,ge),Pe=ut(le,1,1-ve,2+ve,0,-1,2,ge);return(be||Pe)&&(Ce=ut(le,1,-ve,1+ve,0,-1,2,ge)||[],be&&(Ce=Er(be,1).concat(Ce)),Pe&&(Ce=Ce.concat(Er(Pe,-1)))),Ce}(ee,we),ee.length&&this.splitTile(ee,0,0,0),oe&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ii(ze,we,oe){return 32*((1<<ze)*oe+we)+ze}function Gt(ze,we){return we?ze.properties[we]:ze.id}function vi(ze,we){if(ze==null)return!0;if(ze.type==="Feature")return Gt(ze,we)!=null;if(ze.type==="FeatureCollection"){const oe=new Set;for(const ee of ze.features){const le=Gt(ee,we);if(le==null||oe.has(le))return!1;oe.add(le)}return!0}return!1}function Jt(ze,we){const oe=new Map;if(ze!=null)if(ze.type==="Feature")oe.set(Gt(ze,we),ze);else for(const ee of ze.features)oe.set(Gt(ee,we),ee);return oe}Bi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Bi.prototype.splitTile=function(ze,we,oe,ee,le,ge,ve){for(var Ce=[ze,we,oe,ee],be=this.options,Pe=be.debug;Ce.length;){ee=Ce.pop(),oe=Ce.pop(),we=Ce.pop(),ze=Ce.pop();var Oe=1<<we,Ge=Ii(we,oe,ee),rt=this.tiles[Ge];if(!rt&&(Pe>1&&console.time("creation"),rt=this.tiles[Ge]=$t(ze,we,oe,ee,be),this.tileCoords.push({z:we,x:oe,y:ee}),Pe)){Pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",we,oe,ee,rt.numFeatures,rt.numPoints,rt.numSimplified),console.timeEnd("creation"));var yt="z"+we;this.stats[yt]=(this.stats[yt]||0)+1,this.total++}if(rt.source=ze,le){if(we===be.maxZoom||we===le)continue;var Et=1<<le-we;if(oe!==Math.floor(ge/Et)||ee!==Math.floor(ve/Et))continue}else if(we===be.indexMaxZoom||rt.numPoints<=be.indexMaxPoints)continue;if(rt.source=null,ze.length!==0){Pe>1&&console.time("clipping");var Yt,qt,Kt,si,Ci,Hi,wi=.5*be.buffer/be.extent,Ui=.5-wi,st=.5+wi,ti=1+wi;Yt=qt=Kt=si=null,Ci=ut(ze,Oe,oe-wi,oe+st,0,rt.minX,rt.maxX,be),Hi=ut(ze,Oe,oe+Ui,oe+ti,0,rt.minX,rt.maxX,be),ze=null,Ci&&(Yt=ut(Ci,Oe,ee-wi,ee+st,1,rt.minY,rt.maxY,be),qt=ut(Ci,Oe,ee+Ui,ee+ti,1,rt.minY,rt.maxY,be),Ci=null),Hi&&(Kt=ut(Hi,Oe,ee-wi,ee+st,1,rt.minY,rt.maxY,be),si=ut(Hi,Oe,ee+Ui,ee+ti,1,rt.minY,rt.maxY,be),Hi=null),Pe>1&&console.timeEnd("clipping"),Ce.push(Yt||[],we+1,2*oe,2*ee),Ce.push(qt||[],we+1,2*oe,2*ee+1),Ce.push(Kt||[],we+1,2*oe+1,2*ee),Ce.push(si||[],we+1,2*oe+1,2*ee+1)}}},Bi.prototype.getTile=function(ze,we,oe){var ee=this.options,le=ee.extent,ge=ee.debug;if(ze<0||ze>24)return null;var ve=1<<ze,Ce=Ii(ze,we=(we%ve+ve)%ve,oe);if(this.tiles[Ce])return Ji(this.tiles[Ce],le);ge>1&&console.log("drilling down to z%d-%d-%d",ze,we,oe);for(var be,Pe=ze,Oe=we,Ge=oe;!be&&Pe>0;)Pe--,Oe=Math.floor(Oe/2),Ge=Math.floor(Ge/2),be=this.tiles[Ii(Pe,Oe,Ge)];return be&&be.source?(ge>1&&console.log("found parent tile z%d-%d-%d",Pe,Oe,Ge),ge>1&&console.time("drilling down"),this.splitTile(be.source,Pe,Oe,Ge,ze,we,oe),ge>1&&console.timeEnd("drilling down"),this.tiles[Ce]?Ji(this.tiles[Ce],le):null):null};class mr extends F{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(we,oe){return l._(this,void 0,void 0,function*(){const ee=we.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const le=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!le)return null;const ge=new class{constructor(Ce){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.W,this.length=Ce.length,this._features=Ce}feature(Ce){return new class{constructor(be){this._feature=be,this.extent=l.W,this.type=be.type,this.properties=be.tags,"id"in be&&!isNaN(be.id)&&(this.id=parseInt(be.id,10))}loadGeometry(){if(this._feature.type===1){const be=[];for(const Pe of this._feature.geometry)be.push([new l.P(Pe[0],Pe[1])]);return be}{const be=[];for(const Pe of this._feature.geometry){const Oe=[];for(const Ge of Pe)Oe.push(new l.P(Ge[0],Ge[1]));be.push(Oe)}return be}}toGeoJSON(be,Pe,Oe){return ue.call(this,be,Pe,Oe)}}(this._features[Ce])}}(le.features);let ve=Lt(ge);return ve.byteOffset===0&&ve.byteLength===ve.buffer.byteLength||(ve=new Uint8Array(ve)),{vectorTile:ge,rawData:ve.buffer}})}loadData(we){var oe;return l._(this,void 0,void 0,function*(){(oe=this._pendingRequest)===null||oe===void 0||oe.abort();const ee=!!(we&&we.request&&we.request.collectResourceTiming)&&new l.br(we.request);this._pendingRequest=new AbortController;try{let le=yield this.loadGeoJSON(we,this._pendingRequest);if(delete this._pendingRequest,typeof le!="object")throw new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`);if(te(le,!0),we.filter){const ve=l.bx(we.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ve.result==="error")throw new Error(ve.value.map(be=>`${be.key}: ${be.message}`).join(", "));le={type:"FeatureCollection",features:le.features.filter(be=>ve.value.evaluate({zoom:0},be))}}this._geoJSONIndex=we.cluster?new et(function(ve){let{superclusterOptions:Ce,clusterProperties:be}=ve;if(!be||!Ce)return Ce;const Pe={},Oe={},Ge={accumulated:null,zoom:0},rt={properties:null},yt=Object.keys(be);for(const Et of yt){const[Yt,qt]=be[Et],Kt=l.bx(qt),si=l.bx(typeof Yt=="string"?[Yt,["accumulated"],["get",Et]]:Yt);Pe[Et]=Kt.value,Oe[Et]=si.value}return Ce.map=Et=>{rt.properties=Et;const Yt={};for(const qt of yt)Yt[qt]=Pe[qt].evaluate(Ge,rt);return Yt},Ce.reduce=(Et,Yt)=>{rt.properties=Yt;for(const qt of yt)Ge.accumulated=Et[qt],Et[qt]=Oe[qt].evaluate(Ge,rt)},Ce}(we)).load(le.features):function(ve,Ce){return new Bi(ve,Ce)}(le,we.geojsonVtOptions),this.loaded={};const ge={};if(ee){const ve=ee.finish();ve&&(ge.resourceTiming={},ge.resourceTiming[we.source]=JSON.parse(JSON.stringify(ve)))}return ge}catch(le){if(delete this._pendingRequest,l.by(le))return{abandoned:!0};throw le}})}reloadTile(we){const oe=this.loaded;return oe&&oe[we.uid]?super.reloadTile(we):this.loadTile(we)}loadGeoJSON(we,oe){return l._(this,void 0,void 0,function*(){const{promoteId:ee}=we;if(we.request){const le=yield l.h(we.request,oe);return this._dataUpdateable=vi(le.data,ee)?Jt(le.data,ee):void 0,le.data}if(typeof we.data=="string")try{const le=JSON.parse(we.data);return this._dataUpdateable=vi(le,ee)?Jt(le,ee):void 0,le}catch{throw new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`)}if(!we.dataDiff)throw new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${we.source}`);return function(le,ge,ve){var Ce,be,Pe,Oe;if(ge.removeAll&&le.clear(),ge.remove)for(const Ge of ge.remove)le.delete(Ge);if(ge.add)for(const Ge of ge.add){const rt=Gt(Ge,ve);rt!=null&&le.set(rt,Ge)}if(ge.update)for(const Ge of ge.update){let rt=le.get(Ge.id);if(rt==null)continue;const yt=!Ge.removeAllProperties&&(((Ce=Ge.removeProperties)===null||Ce===void 0?void 0:Ce.length)>0||((be=Ge.addOrUpdateProperties)===null||be===void 0?void 0:be.length)>0);if((Ge.newGeometry||Ge.removeAllProperties||yt)&&(rt=Object.assign({},rt),le.set(Ge.id,rt),yt&&(rt.properties=Object.assign({},rt.properties))),Ge.newGeometry&&(rt.geometry=Ge.newGeometry),Ge.removeAllProperties)rt.properties={};else if(((Pe=Ge.removeProperties)===null||Pe===void 0?void 0:Pe.length)>0)for(const Et of Ge.removeProperties)Object.prototype.hasOwnProperty.call(rt.properties,Et)&&delete rt.properties[Et];if(((Oe=Ge.addOrUpdateProperties)===null||Oe===void 0?void 0:Oe.length)>0)for(const{key:Et,value:Yt}of Ge.addOrUpdateProperties)rt.properties[Et]=Yt}}(this._dataUpdateable,we.dataDiff,ee),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(we){return l._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(we){return this._geoJSONIndex.getClusterExpansionZoom(we.clusterId)}getClusterChildren(we){return this._geoJSONIndex.getChildren(we.clusterId)}getClusterLeaves(we){return this._geoJSONIndex.getLeaves(we.clusterId,we.limit,we.offset)}}class Sr{constructor(we){this.self=we,this.actor=new l.C(we),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(oe,ee)=>{if(this.externalWorkerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.externalWorkerSourceTypes[oe]=ee},this.self.addProtocol=l.be,this.self.removeProtocol=l.bf,this.self.registerRTLTextPlugin=oe=>{if(l.bz.isParsed())throw new Error("RTL text plugin already registered.");l.bz.setMethods(oe)},this.actor.registerMessageHandler("loadDEMTile",(oe,ee)=>this._getDEMWorkerSource(oe,ee.source).loadTile(ee)),this.actor.registerMessageHandler("removeDEMTile",(oe,ee)=>l._(this,void 0,void 0,function*(){this._getDEMWorkerSource(oe,ee.source).removeTile(ee)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(oe,ee)=>l._(this,void 0,void 0,function*(){return this._getWorkerSource(oe,ee.type,ee.source).getClusterExpansionZoom(ee)})),this.actor.registerMessageHandler("getClusterChildren",(oe,ee)=>l._(this,void 0,void 0,function*(){return this._getWorkerSource(oe,ee.type,ee.source).getClusterChildren(ee)})),this.actor.registerMessageHandler("getClusterLeaves",(oe,ee)=>l._(this,void 0,void 0,function*(){return this._getWorkerSource(oe,ee.type,ee.source).getClusterLeaves(ee)})),this.actor.registerMessageHandler("loadData",(oe,ee)=>this._getWorkerSource(oe,ee.type,ee.source).loadData(ee)),this.actor.registerMessageHandler("loadTile",(oe,ee)=>this._getWorkerSource(oe,ee.type,ee.source).loadTile(ee)),this.actor.registerMessageHandler("reloadTile",(oe,ee)=>this._getWorkerSource(oe,ee.type,ee.source).reloadTile(ee)),this.actor.registerMessageHandler("abortTile",(oe,ee)=>this._getWorkerSource(oe,ee.type,ee.source).abortTile(ee)),this.actor.registerMessageHandler("removeTile",(oe,ee)=>this._getWorkerSource(oe,ee.type,ee.source).removeTile(ee)),this.actor.registerMessageHandler("removeSource",(oe,ee)=>l._(this,void 0,void 0,function*(){if(!this.workerSources[oe]||!this.workerSources[oe][ee.type]||!this.workerSources[oe][ee.type][ee.source])return;const le=this.workerSources[oe][ee.type][ee.source];delete this.workerSources[oe][ee.type][ee.source],le.removeSource!==void 0&&le.removeSource(ee)})),this.actor.registerMessageHandler("setReferrer",(oe,ee)=>l._(this,void 0,void 0,function*(){this.referrer=ee})),this.actor.registerMessageHandler("syncRTLPluginState",(oe,ee)=>this._syncRTLPluginState(oe,ee)),this.actor.registerMessageHandler("importScript",(oe,ee)=>l._(this,void 0,void 0,function*(){this.self.importScripts(ee)})),this.actor.registerMessageHandler("setImages",(oe,ee)=>this._setImages(oe,ee)),this.actor.registerMessageHandler("updateLayers",(oe,ee)=>l._(this,void 0,void 0,function*(){this._getLayerIndex(oe).update(ee.layers,ee.removedIds)})),this.actor.registerMessageHandler("setLayers",(oe,ee)=>l._(this,void 0,void 0,function*(){this._getLayerIndex(oe).replace(ee)}))}_setImages(we,oe){return l._(this,void 0,void 0,function*(){this.availableImages[we]=oe;for(const ee in this.workerSources[we]){const le=this.workerSources[we][ee];for(const ge in le)le[ge].availableImages=oe}})}_syncRTLPluginState(we,oe){return l._(this,void 0,void 0,function*(){l.bz.setState(oe);const ee=l.bz.getPluginURL();if(oe.pluginStatus==="loaded"&&!l.bz.isParsed()&&ee!=null){this.self.importScripts(ee);const le=l.bz.isParsed();if(le)return le;throw new Error(`RTL Text Plugin failed to import scripts from ${ee}`)}return!1})}_getAvailableImages(we){let oe=this.availableImages[we];return oe||(oe=[]),oe}_getLayerIndex(we){let oe=this.layerIndexes[we];return oe||(oe=this.layerIndexes[we]=new s),oe}_getWorkerSource(we,oe,ee){if(this.workerSources[we]||(this.workerSources[we]={}),this.workerSources[we][oe]||(this.workerSources[we][oe]={}),!this.workerSources[we][oe][ee]){const le={sendAsync:(ge,ve)=>(ge.targetMapId=we,this.actor.sendAsync(ge,ve))};switch(oe){case"vector":this.workerSources[we][oe][ee]=new F(le,this._getLayerIndex(we),this._getAvailableImages(we));break;case"geojson":this.workerSources[we][oe][ee]=new mr(le,this._getLayerIndex(we),this._getAvailableImages(we));break;default:this.workerSources[we][oe][ee]=new this.externalWorkerSourceTypes[oe](le,this._getLayerIndex(we),this._getAvailableImages(we))}}return this.workerSources[we][oe][ee]}_getDEMWorkerSource(we,oe){return this.demWorkerSources[we]||(this.demWorkerSources[we]={}),this.demWorkerSources[we][oe]||(this.demWorkerSources[we][oe]=new k),this.demWorkerSources[we][oe]}}return l.i(self)&&(self.worker=new Sr(self)),Sr}),n("index",["exports","./shared"],function(l,s){var g="4.0.2";let b,T;const F={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((a,d)=>{const _=requestAnimationFrame(a);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(_),d(s.c())})}),getImageData(y){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(y).getImageData(-a,-a,y.width+2*a,y.height+2*a)},getImageCanvasContext(y){const a=window.document.createElement("canvas"),d=a.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return a.width=y.width,a.height=y.height,d.drawImage(y,0,0,y.width,y.height),d},resolveURL:y=>(b||(b=document.createElement("a")),b.href=y,b.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(T==null&&(T=matchMedia("(prefers-reduced-motion: reduce)")),T.matches)}};class k{static testProp(a){if(!k.docStyle)return a[0];for(let d=0;d<a.length;d++)if(a[d]in k.docStyle)return a[d];return a[0]}static create(a,d,_){const B=window.document.createElement(a);return d!==void 0&&(B.className=d),_&&_.appendChild(B),B}static createNS(a,d){return window.document.createElementNS(a,d)}static disableDrag(){k.docStyle&&k.selectProp&&(k.userSelect=k.docStyle[k.selectProp],k.docStyle[k.selectProp]="none")}static enableDrag(){k.docStyle&&k.selectProp&&(k.docStyle[k.selectProp]=k.userSelect)}static setTransform(a,d){a.style[k.transformProp]=d}static addEventListener(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};a.addEventListener(d,_,"passive"in B?B:B.capture)}static removeEventListener(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};a.removeEventListener(d,_,"passive"in B?B:B.capture)}static suppressClickInternal(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",k.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",k.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",k.suppressClickInternal,!0)},0)}static getScale(a){const d=a.getBoundingClientRect();return{x:d.width/a.offsetWidth||1,y:d.height/a.offsetHeight||1,boundingClientRect:d}}static getPoint(a,d,_){const B=d.boundingClientRect;return new s.P((_.clientX-B.left)/d.x-a.clientLeft,(_.clientY-B.top)/d.y-a.clientTop)}static mousePos(a,d){const _=k.getScale(a);return k.getPoint(a,_,d)}static touchPos(a,d){const _=[],B=k.getScale(a);for(let S=0;S<d.length;S++)_.push(k.getPoint(a,B,d[S]));return _}static mouseButton(a){return a.button}static remove(a){a.parentNode&&a.parentNode.removeChild(a)}}k.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,k.selectProp=k.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),k.transformProp=k.testProp(["transform","WebkitTransform"]);const z={supported:!1,testSupport:function(y){!ue&&te&&(ce?de(y):J=y)}};let J,te,ue=!1,ce=!1;function de(y){const a=y.createTexture();y.bindTexture(y.TEXTURE_2D,a);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,te),y.isContextLost())return;z.supported=!0}catch{}y.deleteTexture(a),ue=!0}var _e,Ee;typeof document<"u"&&(te=document.createElement("img"),te.onload=function(){J&&de(J),J=null,ce=!0},te.onerror=function(){ue=!0,J=null},te.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let a,d,_,B;y.resetRequestQueue=()=>{a=[],d=0,_=0,B={}},y.addThrottleControl=q=>{const w=_++;return B[w]=q,w},y.removeThrottleControl=q=>{delete B[q],U()},y.getImage=function(q,w){let I=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((R,j)=>{z.supported&&(q.headers||(q.headers={}),q.headers.accept="image/webp,*/*"),s.e(q,{type:"image"}),a.push({abortController:w,requestParameters:q,supportImageRefresh:I,state:"queued",onError:Z=>{j(Z)},onSuccess:Z=>{R(Z)}}),U()})};const S=q=>s._(this,void 0,void 0,function*(){q.state="running";const{requestParameters:w,supportImageRefresh:I,onError:R,onSuccess:j,abortController:Z}=q,W=I===!1&&!s.i(self)&&!s.g(w.url)&&(!w.headers||Object.keys(w.headers).reduce((ae,fe)=>ae&&fe==="accept",!0));d++;const Y=W?H(w,Z):s.m(w,Z);try{const ae=yield Y;delete q.abortController,q.state="completed",ae.data instanceof HTMLImageElement||s.b(ae.data)?j(ae):ae.data&&j({data:yield(ie=ae.data,typeof createImageBitmap=="function"?s.d(ie):s.f(ie)),cacheControl:ae.cacheControl,expires:ae.expires})}catch(ae){delete q.abortController,R(ae)}finally{d--,U()}var ie}),U=()=>{const q=(()=>{for(const w of Object.keys(B))if(B[w]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let w=d;w<q&&a.length>0;w++){const I=a.shift();I.abortController.signal.aborted?w--:S(I)}},H=(q,w)=>new Promise((I,R)=>{const j=new Image,Z=q.url,W=q.credentials;W&&W==="include"?j.crossOrigin="use-credentials":(W&&W==="same-origin"||!s.s(Z))&&(j.crossOrigin="anonymous"),w.signal.addEventListener("abort",()=>{j.src="",R(s.c())}),j.fetchPriority="high",j.onload=()=>{j.onerror=j.onload=null,I({data:j})},j.onerror=()=>{j.onerror=j.onload=null,w.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},j.src=Z})}(_e||(_e={})),_e.resetRequestQueue(),function(y){y.Glyphs="Glyphs",y.Image="Image",y.Source="Source",y.SpriteImage="SpriteImage",y.SpriteJSON="SpriteJSON",y.Style="Style",y.Tile="Tile",y.Unknown="Unknown"}(Ee||(Ee={}));class He{constructor(a){this._transformRequestFn=a}transformRequest(a,d){return this._transformRequestFn&&this._transformRequestFn(a,d)||{url:a}}normalizeSpriteURL(a,d,_){const B=function(S){const U=S.match(Ve);if(!U)throw new Error(`Unable to parse URL "${S}"`);return{protocol:U[1],authority:U[2],path:U[3]||"/",params:U[4]?U[4].split("&"):[]}}(a);return B.path+=`${d}${_}`,function(S){const U=S.params.length?`?${S.params.join("&")}`:"";return`${S.protocol}://${S.authority}${S.path}${U}`}(B)}setTransformRequest(a){this._transformRequestFn=a}}const Ve=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function qe(y){var a=new s.A(3);return a[0]=y[0],a[1]=y[1],a[2]=y[2],a}var Ue,ot=function(y,a,d){return y[0]=a[0]-d[0],y[1]=a[1]-d[1],y[2]=a[2]-d[2],y};Ue=new s.A(3),s.A!=Float32Array&&(Ue[0]=0,Ue[1]=0,Ue[2]=0);var it=function(y){var a=y[0],d=y[1];return a*a+d*d};function De(y){const a=[];if(typeof y=="string")a.push({id:"default",url:y});else if(y&&y.length>0){const d=[];for(const{id:_,url:B}of y){const S=`${_}${B}`;d.indexOf(S)===-1&&(d.push(S),a.push({id:_,url:B}))}}return a}(function(){var y=new s.A(2);s.A!=Float32Array&&(y[0]=0,y[1]=0)})();class Me{constructor(a,d,_,B){this.context=a,this.format=_,this.texture=a.gl.createTexture(),this.update(d,B)}update(a,d,_){const{width:B,height:S}=a,U=!(this.size&&this.size[0]===B&&this.size[1]===S||_),{context:H}=this,{gl:q}=H;if(this.useMipmap=!!(d&&d.useMipmap),q.bindTexture(q.TEXTURE_2D,this.texture),H.pixelStoreUnpackFlipY.set(!1),H.pixelStoreUnpack.set(1),H.pixelStoreUnpackPremultiplyAlpha.set(this.format===q.RGBA&&(!d||d.premultiply!==!1)),U)this.size=[B,S],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||s.b(a)?q.texImage2D(q.TEXTURE_2D,0,this.format,this.format,q.UNSIGNED_BYTE,a):q.texImage2D(q.TEXTURE_2D,0,this.format,B,S,0,this.format,q.UNSIGNED_BYTE,a.data);else{const{x:w,y:I}=_||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||s.b(a)?q.texSubImage2D(q.TEXTURE_2D,0,w,I,q.RGBA,q.UNSIGNED_BYTE,a):q.texSubImage2D(q.TEXTURE_2D,0,w,I,B,S,q.RGBA,q.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&q.generateMipmap(q.TEXTURE_2D)}bind(a,d,_){const{context:B}=this,{gl:S}=B;S.bindTexture(S.TEXTURE_2D,this.texture),_!==S.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(_=S.LINEAR),a!==this.filter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,a),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,_||a),this.filter=a),d!==this.wrap&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,d),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}function Ze(y){const{userImage:a}=y;return!!(a&&a.render&&a.render())&&(y.data.replace(new Uint8Array(a.data.buffer)),!0)}class We extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:d,promiseResolve:_}of this.requestors)_(this._getImagesForIds(d));this.requestors=[]}}getImage(a){const d=this.images[a];if(d&&!d.data&&d.spriteData){const _=d.spriteData;d.data=new s.R({width:_.width,height:_.height},_.context.getImageData(_.x,_.y,_.width,_.height).data),d.spriteData=null}return d}addImage(a,d){if(this.images[a])throw new Error(`Image id ${a} already exist, use updateImage instead`);this._validate(a,d)&&(this.images[a]=d)}_validate(a,d){let _=!0;const B=d.data||d.spriteData;return this._validateStretch(d.stretchX,B&&B.width)||(this.fire(new s.j(new Error(`Image "${a}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,B&&B.height)||(this.fire(new s.j(new Error(`Image "${a}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new s.j(new Error(`Image "${a}" has invalid "content" value`))),_=!1),_}_validateStretch(a,d){if(!a)return!0;let _=0;for(const B of a){if(B[0]<_||B[1]<B[0]||d<B[1])return!1;_=B[1]}return!0}_validateContent(a,d){if(!a)return!0;if(a.length!==4)return!1;const _=d.spriteData,B=_&&_.width||d.data.width,S=_&&_.height||d.data.height;return!(a[0]<0||B<a[0]||a[1]<0||S<a[1]||a[2]<0||B<a[2]||a[3]<0||S<a[3]||a[2]<a[0]||a[3]<a[1])}updateImage(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const B=this.getImage(a);if(_&&(B.data.width!==d.data.width||B.data.height!==d.data.height))throw new Error(`size mismatch between old image (${B.data.width}x${B.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=B.version+1,this.images[a]=d,this.updatedImages[a]=!0}removeImage(a){const d=this.images[a];delete this.images[a],delete this.patterns[a],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a){return new Promise((d,_)=>{let B=!0;if(!this.isLoaded())for(const S of a)this.images[S]||(B=!1);this.isLoaded()||B?d(this._getImagesForIds(a)):this.requestors.push({ids:a,promiseResolve:d})})}_getImagesForIds(a){const d={};for(const _ of a){let B=this.getImage(_);B||(this.fire(new s.k("styleimagemissing",{id:_})),B=this.getImage(_)),B?d[_]={data:B.data.clone(),pixelRatio:B.pixelRatio,sdf:B.sdf,version:B.version,stretchX:B.stretchX,stretchY:B.stretchY,content:B.content,hasRenderCallback:!!(B.userImage&&B.userImage.render)}:s.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:a,height:d}=this.atlasImage;return{width:a,height:d}}getPattern(a){const d=this.patterns[a],_=this.getImage(a);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const B={w:_.data.width+2,h:_.data.height+2,x:0,y:0},S=new s.I(B,_);this.patterns[a]={bin:B,position:S}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const d=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Me(a,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const S in this.patterns)a.push(this.patterns[S].bin);const{w:d,h:_}=s.p(a),B=this.atlasImage;B.resize({width:d||1,height:_||1});for(const S in this.patterns){const{bin:U}=this.patterns[S],H=U.x+1,q=U.y+1,w=this.getImage(S).data,I=w.width,R=w.height;s.R.copy(w,B,{x:0,y:0},{x:H,y:q},{width:I,height:R}),s.R.copy(w,B,{x:0,y:R-1},{x:H,y:q-1},{width:I,height:1}),s.R.copy(w,B,{x:0,y:0},{x:H,y:q+R},{width:I,height:1}),s.R.copy(w,B,{x:I-1,y:0},{x:H-1,y:q},{width:1,height:R}),s.R.copy(w,B,{x:0,y:0},{x:H+I,y:q},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const d of a){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.getImage(d);_||s.w(`Image with ID: "${d}" was not found`),Ze(_)&&this.updateImage(d,_)}}}const Bt=1e20;function Ct(y,a,d,_,B,S,U,H,q){for(let w=a;w<a+_;w++)Lt(y,d*S+w,S,B,U,H,q);for(let w=d;w<d+B;w++)Lt(y,w*S+a,1,_,U,H,q)}function Lt(y,a,d,_,B,S,U){S[0]=0,U[0]=-Bt,U[1]=Bt,B[0]=y[a];for(let H=1,q=0,w=0;H<_;H++){B[H]=y[a+H*d];const I=H*H;do{const R=S[q];w=(B[H]-B[R]+I-R*R)/(H-R)/2}while(w<=U[q]&&--q>-1);q++,S[q]=H,U[q]=w,U[q+1]=Bt}for(let H=0,q=0;H<_;H++){for(;U[q+1]<H;)q++;const w=S[q],I=H-w;y[a+H*d]=B[w]+I*I}}class _t{constructor(a,d){this.requestManager=a,this.localIdeographFontFamily=d,this.entries={}}setURL(a){this.url=a}getGlyphs(a){return s._(this,void 0,void 0,function*(){const d=[];for(const S in a)for(const U of a[S])d.push(this._getAndCacheGlyphsPromise(S,U));const _=yield Promise.all(d),B={};for(const{stack:S,id:U,glyph:H}of _)B[S]||(B[S]={}),B[S][U]=H&&{id:H.id,bitmap:H.bitmap.clone(),metrics:H.metrics};return B})}_getAndCacheGlyphsPromise(a,d){return s._(this,void 0,void 0,function*(){let _=this.entries[a];_||(_=this.entries[a]={glyphs:{},requests:{},ranges:{}});let B=_.glyphs[d];if(B!==void 0)return{stack:a,id:d,glyph:B};if(B=this._tinySDF(_,a,d),B)return _.glyphs[d]=B,{stack:a,id:d,glyph:B};const S=Math.floor(d/256);if(256*S>65535)throw new Error("glyphs > 65535 not supported");if(_.ranges[S])return{stack:a,id:d,glyph:B};if(!this.url)throw new Error("glyphsUrl is not set");if(!_.requests[S]){const H=_t.loadGlyphRange(a,S,this.url,this.requestManager);_.requests[S]=H}const U=yield _.requests[S];for(const H in U)this._doesCharSupportLocalGlyph(+H)||(_.glyphs[+H]=U[+H]);return _.ranges[S]=!0,{stack:a,id:d,glyph:U[d]||null}})}_doesCharSupportLocalGlyph(a){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](a)||s.u["Hangul Syllables"](a)||s.u.Hiragana(a)||s.u.Katakana(a))}_tinySDF(a,d,_){const B=this.localIdeographFontFamily;if(!B||!this._doesCharSupportLocalGlyph(_))return;let S=a.tinySDF;if(!S){let H="400";/bold/i.test(d)?H="900":/medium/i.test(d)?H="500":/light/i.test(d)&&(H="200"),S=a.tinySDF=new _t.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:B,fontWeight:H})}const U=S.draw(String.fromCharCode(_));return{id:_,bitmap:new s.o({width:U.width||60,height:U.height||60},U.data),metrics:{width:U.glyphWidth/2||24,height:U.glyphHeight/2||24,left:U.glyphLeft/2+.5||0,top:U.glyphTop/2-27.5||-8,advance:U.glyphAdvance/2||24,isDoubleResolution:!0}}}}_t.loadGlyphRange=function(y,a,d,_){return s._(this,void 0,void 0,function*(){const B=256*a,S=B+255,U=_.transformRequest(d.replace("{fontstack}",y).replace("{range}",`${B}-${S}`),Ee.Glyphs),H=yield s.l(U,new AbortController);if(!H||!H.data)throw new Error(`Could not load glyph range. range: ${a}, ${B}-${S}`);const q={};for(const w of s.n(H.data))q[w.id]=w;return q})},_t.TinySDF=class{constructor(){let{fontSize:y=24,buffer:a=3,radius:d=8,cutoff:_=.25,fontFamily:B="sans-serif",fontWeight:S="normal",fontStyle:U="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=a,this.cutoff=_,this.radius=d;const H=this.size=y+4*a,q=this._createCanvas(H),w=this.ctx=q.getContext("2d",{willReadFrequently:!0});w.font=`${U} ${S} ${y}px ${B}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(H*H),this.gridInner=new Float64Array(H*H),this.f=new Float64Array(H),this.z=new Float64Array(H+1),this.v=new Uint16Array(H)}_createCanvas(y){const a=document.createElement("canvas");return a.width=a.height=y,a}draw(y){const{width:a,actualBoundingBoxAscent:d,actualBoundingBoxDescent:_,actualBoundingBoxLeft:B,actualBoundingBoxRight:S}=this.ctx.measureText(y),U=Math.ceil(d),H=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(S-B))),q=Math.min(this.size-this.buffer,U+Math.ceil(_)),w=H+2*this.buffer,I=q+2*this.buffer,R=Math.max(w*I,0),j=new Uint8ClampedArray(R),Z={data:j,width:w,height:I,glyphWidth:H,glyphHeight:q,glyphTop:U,glyphLeft:0,glyphAdvance:a};if(H===0||q===0)return Z;const{ctx:W,buffer:Y,gridInner:ie,gridOuter:ae}=this;W.clearRect(Y,Y,H,q),W.fillText(y,Y,Y+U);const fe=W.getImageData(Y,Y,H,q);ae.fill(Bt,0,R),ie.fill(0,0,R);for(let pe=0;pe<q;pe++)for(let xe=0;xe<H;xe++){const Fe=fe.data[4*(pe*H+xe)+3]/255;if(Fe===0)continue;const Le=(pe+Y)*w+xe+Y;if(Fe===1)ae[Le]=0,ie[Le]=Bt;else{const nt=.5-Fe;ae[Le]=nt>0?nt*nt:0,ie[Le]=nt<0?nt*nt:0}}Ct(ae,0,0,w,I,w,this.f,this.v,this.z),Ct(ie,Y,Y,H,q,w,this.f,this.v,this.z);for(let pe=0;pe<R;pe++){const xe=Math.sqrt(ae[pe])-Math.sqrt(ie[pe]);j[pe]=Math.round(255-255*(xe/this.radius+this.cutoff))}return Z}};class Ft{constructor(){this.specification=s.v.light.position}possiblyEvaluate(a,d){return s.y(a.expression.evaluate(d))}interpolate(a,d,_){return{x:s.z.number(a.x,d.x,_),y:s.z.number(a.y,d.y,_),z:s.z.number(a.z,d.z,_)}}}let Mt;class Wt extends s.E{constructor(a){super(),Mt=Mt||new s.q({anchor:new s.D(s.v.light.anchor),position:new Ft,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(Mt),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(s.r,a,d))for(const _ in a){const B=a[_];_.endsWith("-transition")?this._transitionable.setTransition(_.slice(0,-11),B):this._transitionable.setValue(_,B)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,d,_){return(!_||_.validate!==!1)&&s.t(this,a.call(s.x,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}class Se{constructor(a,d){this.width=a,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(a,d){const _=a.join(",")+String(d);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(a,d)),this.dashEntry[_]}getDashRanges(a,d,_){const B=[];let S=a.length%2==1?-a[a.length-1]*_:0,U=a[0]*_,H=!0;B.push({left:S,right:U,isDash:H,zeroLength:a[0]===0});let q=a[0];for(let w=1;w<a.length;w++){H=!H;const I=a[w];S=q*_,q+=I,U=q*_,B.push({left:S,right:U,isDash:H,zeroLength:I===0})}return B}addRoundDash(a,d,_){const B=d/2;for(let S=-_;S<=_;S++){const U=this.width*(this.nextRow+_+S);let H=0,q=a[H];for(let w=0;w<this.width;w++){w/q.right>1&&(q=a[++H]);const I=Math.abs(w-q.left),R=Math.abs(w-q.right),j=Math.min(I,R);let Z;const W=S/_*(B+1);if(q.isDash){const Y=B-Math.abs(W);Z=Math.sqrt(j*j+Y*Y)}else Z=B-Math.sqrt(j*j+W*W);this.data[U+w]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(a){for(let H=a.length-1;H>=0;--H){const q=a[H],w=a[H+1];q.zeroLength?a.splice(H,1):w&&w.isDash===q.isDash&&(w.left=q.left,a.splice(H,1))}const d=a[0],_=a[a.length-1];d.isDash===_.isDash&&(d.left=_.left-this.width,_.right=d.right+this.width);const B=this.width*this.nextRow;let S=0,U=a[S];for(let H=0;H<this.width;H++){H/U.right>1&&(U=a[++S]);const q=Math.abs(H-U.left),w=Math.abs(H-U.right),I=Math.min(q,w);this.data[B+H]=Math.max(0,Math.min(255,(U.isDash?I:-I)+128))}}addDash(a,d){const _=d?7:0,B=2*_+1;if(this.nextRow+B>this.height)return s.w("LineAtlas out of space"),null;let S=0;for(let H=0;H<a.length;H++)S+=a[H];if(S!==0){const H=this.width/S,q=this.getDashRanges(a,this.width,H);d?this.addRoundDash(q,H,_):this.addRegularDash(q)}const U={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:S};return this.nextRow+=B,this.dirty=!0,U}bind(a){const d=a.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const Xe="maplibre_preloaded_worker_pool";class et{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<et.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Xe]}numActive(){return Object.keys(this.active).length}}const At=Math.floor(F.hardwareConcurrency/2);let ft,wt;function Pt(){return ft||(ft=new et),ft}et.workerCount=s.B(globalThis)?Math.max(Math.min(At,3),1):1;class It{constructor(a,d){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=d;const _=this.workerPool.acquire(d);for(let B=0;B<_.length;B++){const S=new s.C(_[B],d);S.name=`Worker ${B}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(a,d){const _=[];for(const B of this.actors)_.push(B.sendAsync({type:a,data:d}));return Promise.all(_)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(d=>{d.remove()}),this.actors=[],a&&this.workerPool.release(this.id)}registerMessageHandler(a,d){for(const _ of this.actors)_.registerMessageHandler(a,d)}}function Ht(){return wt||(wt=new It(Pt(),s.G),wt.registerMessageHandler("getResource",(y,a,d)=>s.m(a,d))),wt}function ii(y,a){const d=s.F();return s.H(d,d,[1,1,0]),s.J(d,d,[.5*y.width,.5*y.height,1]),s.K(d,d,y.calculatePosMatrix(a.toUnwrapped()))}function gi(y,a,d,_,B,S){const U=function(R,j,Z){if(R)for(const W of R){const Y=j[W];if(Y&&Y.source===Z&&Y.type==="fill-extrusion")return!0}else for(const W in j){const Y=j[W];if(Y.source===Z&&Y.type==="fill-extrusion")return!0}return!1}(B&&B.layers,a,y.id),H=S.maxPitchScaleFactor(),q=y.tilesIn(_,H,U);q.sort(mi);const w=[];for(const R of q)w.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(a,d,y._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,B,S,H,ii(y.transform,R.tileID))});const I=function(R){const j={},Z={};for(const W of R){const Y=W.queryResults,ie=W.wrappedTileID,ae=Z[ie]=Z[ie]||{};for(const fe in Y){const pe=Y[fe],xe=ae[fe]=ae[fe]||{},Fe=j[fe]=j[fe]||[];for(const Le of pe)xe[Le.featureIndex]||(xe[Le.featureIndex]=!0,Fe.push(Le))}}return j}(w);for(const R in I)I[R].forEach(j=>{const Z=j.feature,W=y.getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=W});return I}function mi(y,a){const d=y.tileID,_=a.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function Mi(y,a,d){return s._(this,void 0,void 0,function*(){let _=y;if(y.url?_=(yield s.h(a.transformRequest(y.url,Ee.Source),d)).data:yield F.frameAsync(d),!_)return null;const B=s.L(s.e(_,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in _&&_.vector_layers&&(B.vectorLayerIds=_.vector_layers.map(S=>S.id)),B})}class kt{constructor(a,d){a&&(d?this.setSouthWest(a).setNorthEast(d):Array.isArray(a)&&(a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1])))}setNorthEast(a){return this._ne=a instanceof s.M?new s.M(a.lng,a.lat):s.M.convert(a),this}setSouthWest(a){return this._sw=a instanceof s.M?new s.M(a.lng,a.lat):s.M.convert(a),this}extend(a){const d=this._sw,_=this._ne;let B,S;if(a instanceof s.M)B=a,S=a;else{if(!(a instanceof kt))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(kt.convert(a)):this.extend(s.M.convert(a)):a&&("lng"in a||"lon"in a)&&"lat"in a?this.extend(s.M.convert(a)):this;if(B=a._sw,S=a._ne,!B||!S)return this}return d||_?(d.lng=Math.min(B.lng,d.lng),d.lat=Math.min(B.lat,d.lat),_.lng=Math.max(S.lng,_.lng),_.lat=Math.max(S.lat,_.lat)):(this._sw=new s.M(B.lng,B.lat),this._ne=new s.M(S.lng,S.lat)),this}getCenter(){return new s.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.M(this.getWest(),this.getNorth())}getSouthEast(){return new s.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:d,lat:_}=s.M.convert(a);let B=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(B=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=_&&_<=this._ne.lat&&B}static convert(a){return a instanceof kt?a:a&&new kt(a)}static fromLngLat(a){const _=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,B=_/Math.cos(Math.PI/180*a.lat);return new kt(new s.M(a.lng-B,a.lat-_),new s.M(a.lng+B,a.lat+_))}}class at{constructor(a,d,_){this.bounds=kt.convert(this.validateBounds(a)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const d=Math.pow(2,a.z),_=Math.floor(s.N(this.bounds.getWest())*d),B=Math.floor(s.O(this.bounds.getNorth())*d),S=Math.ceil(s.N(this.bounds.getEast())*d),U=Math.ceil(s.O(this.bounds.getSouth())*d);return a.x>=_&&a.x<S&&a.y>=B&&a.y<U}}class xt extends s.E{constructor(a,d,_,B){if(super(),this.id=a,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.L(d,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(B)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Mi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),a&&(s.e(this,a),a.bounds&&(this.tileBounds=new at(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new s.j(a))}})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}setSourceProperty(a){this._tileJSONRequest&&this._tileJSONRequest.abort(),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(a){return s._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(d,Ee.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};_.request.collectResourceTiming=this._collectResourceTiming;let B="reloadTile";if(a.actor&&a.state!=="expired"){if(a.state==="loading")return new Promise((S,U)=>{a.reloadPromise={resolve:S,reject:U}})}else a.actor=this.dispatcher.getActor(),B="loadTile";a.abortController=new AbortController;try{const S=yield a.actor.sendAsync({type:B,data:_},a.abortController);if(delete a.abortController,a.aborted)return;this._afterTileLoadWorkerResponse(a,S)}catch(S){if(delete a.abortController,a.aborted)return;if(S&&S.status!==404)throw S;this._afterTileLoadWorkerResponse(a,null)}})}_afterTileLoadWorkerResponse(a,d){if(d&&d.resourceTiming&&(a.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&a.setExpiryData(d),a.loadVectorData(d,this.map.painter),a.reloadPromise){const _=a.reloadPromise;a.reloadPromise=null,this.loadTile(a).then(_.resolve).catch(_.reject)}}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.actor&&(yield a.actor.sendAsync({type:"abortTile",data:{uid:a.uid,type:this.type,source:this.id}}))})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.unloadVectorData(),a.actor&&(yield a.actor.sendAsync({type:"removeTile",data:{uid:a.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ri extends s.E{constructor(a,d,_,B){super(),this.id=a,this.dispatcher=_,this.setEventedParent(B),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},d),s.e(this,s.L(d,["url","scheme","tileSize"]))}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Mi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(s.e(this,a),a.bounds&&(this.tileBounds=new at(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new s.j(a))}})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(a){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}serialize(){return s.e({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a){return s._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);a.abortController=new AbortController;try{const _=yield _e.getImage(this.map._requestManager.transformRequest(d,Ee.Tile),a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(_&&_.data){this.map._refreshExpiredTiles&&_.cacheControl&&_.expires&&a.setExpiryData({cacheControl:_.cacheControl,expires:_.expires});const B=this.map.painter.context,S=B.gl,U=_.data;a.texture=this.map.painter.getTileTexture(U.width),a.texture?a.texture.update(U,{useMipmap:!0}):(a.texture=new Me(B,U,S.RGBA,{useMipmap:!0}),a.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),B.extTextureFilterAnisotropic&&S.texParameterf(S.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax)),a.state="loaded"}}catch(_){if(delete a.abortController,a.aborted)a.state="unloaded";else if(_)throw a.state="errored",_}})}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController)})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.texture&&this.map.painter.saveTileTexture(a.texture)})}hasTransition(){return!1}}class ei extends Ri{constructor(a,d,_,B){super(a,d,_,B),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(a){return s._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_=this.map._requestManager.transformRequest(d,Ee.Tile);a.neighboringTiles=this._getNeighboringTiles(a.tileID),a.abortController=new AbortController;try{const B=yield _e.getImage(_,a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(B&&B.data){const S=B.data;this.map._refreshExpiredTiles&&B.cacheControl&&B.expires&&a.setExpiryData({cacheControl:B.cacheControl,expires:B.expires});const U=s.b(S)&&s.S()?S:yield this.readImageNow(S),H={type:this.type,uid:a.uid,source:this.id,rawImageData:U,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!a.actor||a.state==="expired"){a.actor=this.dispatcher.getActor();const q=yield a.actor.sendAsync({type:"loadDEMTile",data:H});a.dem=q,a.needsHillshadePrepare=!0,a.needsTerrainPrepare=!0,a.state="loaded"}}}catch(B){if(delete a.abortController,a.aborted)a.state="unloaded";else if(B)throw a.state="errored",B}})}readImageNow(a){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.U()){const d=a.width+2,_=a.height+2;try{return new s.R({width:d,height:_},yield s.V(a,-1,-1,d,_))}catch{}}return F.getImageData(a,1)})}_getNeighboringTiles(a){const d=a.canonical,_=Math.pow(2,d.z),B=(d.x-1+_)%_,S=d.x===0?a.wrap-1:a.wrap,U=(d.x+1+_)%_,H=d.x+1===_?a.wrap+1:a.wrap,q={};return q[new s.Q(a.overscaledZ,S,d.z,B,d.y).key]={backfilled:!1},q[new s.Q(a.overscaledZ,H,d.z,U,d.y).key]={backfilled:!1},d.y>0&&(q[new s.Q(a.overscaledZ,S,d.z,B,d.y-1).key]={backfilled:!1},q[new s.Q(a.overscaledZ,a.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},q[new s.Q(a.overscaledZ,H,d.z,U,d.y-1).key]={backfilled:!1}),d.y+1<_&&(q[new s.Q(a.overscaledZ,S,d.z,B,d.y+1).key]={backfilled:!1},q[new s.Q(a.overscaledZ,a.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},q[new s.Q(a.overscaledZ,H,d.z,U,d.y+1).key]={backfilled:!1}),q}unloadTile(a){return s._(this,void 0,void 0,function*(){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&(yield a.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:a.uid,source:this.id}}))})}}class ut extends s.E{constructor(a,d,_,B){super(),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=_.getActor(),this.setEventedParent(B),this._data=d.data,this._options=s.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const S=s.W/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*S,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*S,extent:s.W,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:s.W,radius:(d.clusterRadius||50)*S,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(a){this.map=a,this.load()}setData(a){return this._data=a,this._updateWorkerData(),this}updateData(a){return this._updateWorkerData(a),this}setClusterOptions(a){return this.workerOptions.cluster=a.cluster,a&&(a.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=a.clusterRadius),a.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=a.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(a){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:a,source:this.id}})}getClusterChildren(a){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:a,source:this.id}})}getClusterLeaves(a,d,_){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:a,limit:d,offset:_}})}_updateWorkerData(a){return s._(this,void 0,void 0,function*(){const d=s.e({type:this.type},this.workerOptions);a?d.dataDiff=a:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(F.resolveURL(this._data),Ee.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"}));try{const _=yield this.actor.sendAsync({type:"loadData",data:d});if(this._pendingLoads--,this._removed||_.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let B=null;_.resourceTiming&&_.resourceTiming[this.id]&&(B=_.resourceTiming[this.id].slice(0));const S={dataType:"source"};this._collectResourceTiming&&B&&B.length>0&&s.e(S,{resourceTiming:B}),this.fire(new s.k("data",Object.assign(Object.assign({},S),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},S),{sourceDataType:"content"})))}catch(_){if(this._pendingLoads--,this._removed)return void this.fire(new s.k("dataabort",{dataType:"source"}));this.fire(new s.j(_))}})}loaded(){return this._pendingLoads===0}loadTile(a){return s._(this,void 0,void 0,function*(){const d=a.actor?"reloadTile":"loadTile";a.actor=this.actor;const _={type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.abortController=new AbortController;const B=yield this.actor.sendAsync({type:d,data:_},a.abortController);delete a.abortController,a.unloadVectorData(),a.aborted||a.loadVectorData(B,this.map.painter,d==="reloadTile")})}abortTile(a){return s._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.aborted=!0})}unloadTile(a){return s._(this,void 0,void 0,function*(){a.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:a.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var jt=s.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ni extends s.E{constructor(a,d,_,B){super(),this.id=a,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(B),this.options=d}load(a){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield _e.getImage(this.map._requestManager.transformRequest(this.url,Ee.Image),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,a&&(this.coordinates=a),this._finishLoading())}catch(d){this._request=null,this.fire(new s.j(d))}})}loaded(){return this._loaded}updateImage(a){return a.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=a.url,this.load(a.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(a){this.coordinates=a;const d=a.map(s.Y.fromLngLat);this.tileID=function(B){let S=1/0,U=1/0,H=-1/0,q=-1/0;for(const j of B)S=Math.min(S,j.x),U=Math.min(U,j.y),H=Math.max(H,j.x),q=Math.max(q,j.y);const w=Math.max(H-S,q-U),I=Math.max(0,Math.floor(-Math.log(w)/Math.LN2)),R=Math.pow(2,I);return new s.a0(I,Math.floor((S+H)/2*R),Math.floor((U+q)/2*R))}(d),this.minzoom=this.maxzoom=this.tileID.z;const _=d.map(B=>this.tileID.getTilePoint(B)._round());return this._boundsArray=new s.Z,this._boundsArray.emplaceBack(_[0].x,_[0].y,0,0),this._boundsArray.emplaceBack(_[1].x,_[1].y,s.W,0),this._boundsArray.emplaceBack(_[3].x,_[3].y,0,s.W),this._boundsArray.emplaceBack(_[2].x,_[2].y,s.W,s.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,jt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Me(a,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let _=!1;for(const B in this.tiles){const S=this.tiles[B];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(a){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={}):a.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class di extends ni{constructor(a,d,_,B){super(a,d,_,B),this.roundZoom=!0,this.type="video",this.options=d}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const a=this.options;this.urls=[];for(const d of a.urls)this.urls.push(this.map._requestManager.transformRequest(d,Ee.Source).url);try{const d=yield s.a2(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new s.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(a){if(this.video){const d=this.video.seekable;a<d.start(0)||a>d.end(0)?this.fire(new s.j(new s.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=a}}getVideo(){return this.video}onAdd(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,jt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new Me(a,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let _=!1;for(const B in this.tiles){const S=this.tiles[B];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class li extends ni{constructor(a,d,_,B){super(a,d,_,B),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(S=>!Array.isArray(S)||S.length!==2||S.some(U=>typeof U!="number"))||this.fire(new s.j(new s.a1(`sources.${a}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.a1(`sources.${a}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new s.j(new s.a1(`sources.${a}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.a1(`sources.${a}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.a1(`sources.${a}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,_=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,jt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Me(d,this.canvas,_.RGBA,{premultiply:!0});let B=!1;for(const S in this.tiles){const U=this.tiles[S];U.state!=="loaded"&&(U.state="loaded",U.texture=this.texture,B=!0)}B&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const a of[this.canvas.width,this.canvas.height])if(isNaN(a)||a<=0)return!0;return!1}}const Ki={},tr=y=>{switch(y){case"geojson":return ut;case"image":return ni;case"raster":return Ri;case"raster-dem":return ei;case"vector":return xt;case"video":return di;case"canvas":return li}return Ki[y]};class Ar extends s.E{constructor(){super(...arguments),this.pluginStatus="unavailable",this.pluginURL=null,this.dispatcher=Ht(),this.queue=[]}_sendPluginStateToWorker(){return s._(this,void 0,void 0,function*(){yield this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}),this.fire(new s.k("pluginStateChange",{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}))})}getRTLTextPluginStatus(){return this.pluginStatus}clearRTLTextPlugin(){this.pluginStatus="unavailable",this.pluginURL=null}setRTLTextPlugin(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return s._(this,void 0,void 0,function*(){if(this.pluginStatus==="deferred"||this.pluginStatus==="loading"||this.pluginStatus==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");this.pluginURL=F.resolveURL(a),this.pluginStatus="deferred",yield this._sendPluginStateToWorker(),d||(yield this._downloadRTLTextPlugin())})}_downloadRTLTextPlugin(){return s._(this,void 0,void 0,function*(){if(this.pluginStatus!=="deferred"||!this.pluginURL)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");try{this.pluginStatus="loading",yield this._sendPluginStateToWorker(),yield s.l({url:this.pluginURL},new AbortController),this.pluginStatus="loaded"}catch{this.pluginStatus="error"}yield this._sendPluginStateToWorker()})}lazyLoadRTLTextPlugin(){return s._(this,void 0,void 0,function*(){this.pluginStatus==="deferred"&&(yield this._downloadRTLTextPlugin())})}}let Er=null;function Nt(){return Er||(Er=new Ar),Er}class Ji{constructor(a,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=a,this.uid=s.a3(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(a){const d=a+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(a){this.demTexture&&a.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(a,d,_){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(B,S){const U={};if(!S)return U;for(const H of B){const q=H.layerIds.map(w=>S.getLayer(w)).filter(Boolean);if(q.length!==0){H.layers=q,H.stateDependentLayerIds&&(H.stateDependentLayers=H.stateDependentLayerIds.map(w=>q.filter(I=>I.id===w)[0]));for(const w of q)U[w.id]=H}}return U}(a.buckets,d.style),this.hasSymbolBuckets=!1;for(const B in this.buckets){const S=this.buckets[B];if(S instanceof s.a5){if(this.hasSymbolBuckets=!0,!_)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const B in this.buckets){const S=this.buckets[B];if(S instanceof s.a5&&S.hasRTLText){this.hasRTLText=!0,Nt().lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const B in this.buckets){const S=this.buckets[B];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(B).queryRadius(S))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new s.a4}unloadVectorData(){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(a){return this.buckets[a.id]}upload(a){for(const _ in this.buckets){const B=this.buckets[_];B.uploadPending()&&B.upload(a)}const d=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Me(a,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Me(a,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,d,_,B,S,U,H,q,w,I){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:B,cameraQueryGeometry:S,scale:U,tileSize:this.tileSize,pixelPosMatrix:I,transform:q,params:H,queryPadding:this.queryPadding*w},a,d,_):{}}querySourceFeatures(a,d){const _=this.latestFeatureIndex;if(!_||!_.rawTileData)return;const B=_.loadVTLayers(),S=d&&d.sourceLayer?d.sourceLayer:"",U=B._geojsonTileLayer||B[S];if(!U)return;const H=s.a6(d&&d.filter),{z:q,x:w,y:I}=this.tileID.canonical,R={z:q,x:w,y:I};for(let j=0;j<U.length;j++){const Z=U.feature(j);if(H.needGeometry){const ie=s.a7(Z,!0);if(!H.filter(new s.a8(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!H.filter(new s.a8(this.tileID.overscaledZ),Z))continue;const W=_.getId(Z,S),Y=new s.a9(Z,q,w,I,W);Y.tile=R,a.push(Y)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const d=this.expirationTime;if(a.cacheControl){const _=s.aa(a.cacheControl);_["max-age"]&&(this.expirationTime=Date.now()+1e3*_["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const _=Date.now();let B=!1;if(this.expirationTime>_)B=!1;else if(d)if(this.expirationTime<d)B=!0;else{const S=this.expirationTime-d;S?this.expirationTime=_+Math.max(S,3e4):B=!0}else B=!0;B?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(a).length===0)return;const _=this.latestFeatureIndex.loadVTLayers();for(const B in this.buckets){if(!d.style.hasLayer(B))continue;const S=this.buckets[B],U=S.layers[0].sourceLayer||"_geojsonTileLayer",H=_[U],q=a[U];if(!H||!q||Object.keys(q).length===0)continue;S.update(q,H,this.imageAtlas&&this.imageAtlas.patternPositions||{});const w=d&&d.style&&d.style.getLayer(B);w&&(this.queryPadding=Math.max(this.queryPadding,w.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<F.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=F.now()+a}setDependencies(a,d){const _={};for(const B of d)_[B]=!0;this.dependencies[a]=_}hasDependency(a,d){for(const _ of a){const B=this.dependencies[_];if(B){for(const S of d)if(B[S])return!0}}return!1}}class ci{constructor(a,d){this.max=a,this.onRemove=d,this.reset()}reset(){for(const a in this.data)for(const d of this.data[a])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(a,d,_){const B=a.wrapped().key;this.data[B]===void 0&&(this.data[B]=[]);const S={value:d,timeout:void 0};if(_!==void 0&&(S.timeout=setTimeout(()=>{this.remove(a,S)},_)),this.data[B].push(S),this.order.push(B),this.order.length>this.max){const U=this._getAndRemoveByKey(this.order[0]);U&&this.onRemove(U)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const d=this.data[a].shift();return d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),d.value}getByKey(a){const d=this.data[a];return d?d[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,d){if(!this.has(a))return this;const _=a.wrapped().key,B=d===void 0?0:this.data[_].indexOf(d),S=this.data[_][B];return this.data[_].splice(B,1),S.timeout&&clearTimeout(S.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(S.value),this.order.splice(this.order.indexOf(_),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(a){const d=[];for(const _ in this.data)for(const B of this.data[_])a(B.value)||d.push(B);for(const _ of d)this.remove(_.value.tileID,_)}}class $t{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,d,_){const B=String(d);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][B]=this.stateChanges[a][B]||{},s.e(this.stateChanges[a][B],_),this.deletedStates[a]===null){this.deletedStates[a]={};for(const S in this.state[a])S!==B&&(this.deletedStates[a][S]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][B]===null){this.deletedStates[a][B]={};for(const S in this.state[a][B])_[S]||(this.deletedStates[a][B][S]=null)}else for(const S in _)this.deletedStates[a]&&this.deletedStates[a][B]&&this.deletedStates[a][B][S]===null&&delete this.deletedStates[a][B][S]}removeFeatureState(a,d,_){if(this.deletedStates[a]===null)return;const B=String(d);if(this.deletedStates[a]=this.deletedStates[a]||{},_&&d!==void 0)this.deletedStates[a][B]!==null&&(this.deletedStates[a][B]=this.deletedStates[a][B]||{},this.deletedStates[a][B][_]=null);else if(d!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][B])for(_ in this.deletedStates[a][B]={},this.stateChanges[a][B])this.deletedStates[a][B][_]=null;else this.deletedStates[a][B]=null;else this.deletedStates[a]=null}getState(a,d){const _=String(d),B=s.e({},(this.state[a]||{})[_],(this.stateChanges[a]||{})[_]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){const S=this.deletedStates[a][d];if(S===null)return{};for(const U in S)delete B[U]}return B}initializeTileState(a,d){a.setFeatureState(this.state,d)}coalesceChanges(a,d){const _={};for(const B in this.stateChanges){this.state[B]=this.state[B]||{};const S={};for(const U in this.stateChanges[B])this.state[B][U]||(this.state[B][U]={}),s.e(this.state[B][U],this.stateChanges[B][U]),S[U]=this.state[B][U];_[B]=S}for(const B in this.deletedStates){this.state[B]=this.state[B]||{};const S={};if(this.deletedStates[B]===null)for(const U in this.state[B])S[U]={},this.state[B][U]={};else for(const U in this.deletedStates[B]){if(this.deletedStates[B][U]===null)this.state[B][U]={};else for(const H of Object.keys(this.deletedStates[B][U]))delete this.state[B][U][H];S[U]=this.state[B][U]}_[B]=_[B]||{},s.e(_[B],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(_).length!==0)for(const B in a)a[B].setFeatureState(_,d)}}class Zi extends s.E{constructor(a,d,_){super(),this.id=a,this.dispatcher=_,this.on("data",B=>{B.dataType==="source"&&B.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&B.dataType==="source"&&B.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((B,S,U,H)=>{const q=new(tr(S.type))(B,S,U,H);if(q.id!==B)throw new Error(`Expected Source id to be ${B} instead of ${q.id}`);return q})(a,d,_,this),this._tiles={},this._cache=new ci(0,B=>this._unloadTile(B)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new $t,this._didEmitContent=!1,this._updated=!1}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._maxTileCacheZoomLevels=a?a._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(a)}onRemove(a){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(a)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const a in this._tiles){const d=this._tiles[a];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(a,d,_){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(a),this._tileLoaded(a,d,_)}catch(B){a.state="errored",B.status!==404?this._source.fire(new s.j(B,{tile:a})):this.update(this.transform,this.terrain)}})}_unloadTile(a){this._source.unloadTile&&this._source.unloadTile(a)}_abortTile(a){this._source.abortTile&&this._source.abortTile(a),this._source.fire(new s.k("dataabort",{tile:a,coord:a.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const _=this._tiles[d];_.upload(a),_.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(Qt).map(a=>a.key)}getRenderableIds(a){const d=[];for(const _ in this._tiles)this._isIdRenderable(_,a)&&d.push(this._tiles[_]);return a?d.sort((_,B)=>{const S=_.tileID,U=B.tileID,H=new s.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),q=new s.P(U.canonical.x,U.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-U.overscaledZ||q.y-H.y||q.x-H.x}).map(_=>_.tileID.key):d.map(_=>_.tileID).sort(Qt).map(_=>_.key)}hasRenderableParent(a){const d=this.findLoadedParent(a,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(a,d){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(d||!this._tiles[a].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(a,d){return s._(this,void 0,void 0,function*(){const _=this._tiles[a];_&&(_.state!=="loading"&&(_.state=d),yield this._loadTile(_,a,d))})}_tileLoaded(a,d,_){a.timeAdded=F.now(),_==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(d,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),a.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:a,coord:a.tileID}))}_backfillDEM(a){const d=this.getRenderableIds();for(let B=0;B<d.length;B++){const S=d[B];if(a.neighboringTiles&&a.neighboringTiles[S]){const U=this.getTileByID(S);_(a,U),_(U,a)}}function _(B,S){B.needsHillshadePrepare=!0,B.needsTerrainPrepare=!0;let U=S.tileID.canonical.x-B.tileID.canonical.x;const H=S.tileID.canonical.y-B.tileID.canonical.y,q=Math.pow(2,B.tileID.canonical.z),w=S.tileID.key;U===0&&H===0||Math.abs(H)>1||(Math.abs(U)>1&&(Math.abs(U+q)===1?U+=q:Math.abs(U-q)===1&&(U-=q)),S.dem&&B.dem&&(B.dem.backfillBorder(S.dem,U,H),B.neighboringTiles&&B.neighboringTiles[w]&&(B.neighboringTiles[w].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,d,_,B){for(const S in this._tiles){let U=this._tiles[S];if(B[S]||!U.hasData()||U.tileID.overscaledZ<=d||U.tileID.overscaledZ>_)continue;let H=U.tileID;for(;U&&U.tileID.overscaledZ>d+1;){const w=U.tileID.scaledTo(U.tileID.overscaledZ-1);U=this._tiles[w.key],U&&U.hasData()&&(H=w)}let q=H;for(;q.overscaledZ>d;)if(q=q.scaledTo(q.overscaledZ-1),a[q.key]){B[H.key]=H;break}}}findLoadedParent(a,d){if(a.key in this._loadedParentTiles){const _=this._loadedParentTiles[a.key];return _&&_.tileID.overscaledZ>=d?_:null}for(let _=a.overscaledZ-1;_>=d;_--){const B=a.scaledTo(_),S=this._getLoadedTile(B);if(S)return S}}_getLoadedTile(a){const d=this._tiles[a.key];return d&&d.hasData()?d:this._cache.getByKey(a.wrapped().key)}updateCacheSize(a){const d=Math.ceil(a.width/this._source.tileSize)+1,_=Math.ceil(a.height/this._source.tileSize)+1,B=Math.floor(d*_*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,B):B;this._cache.setMaxSize(S)}handleWrapJump(a){const d=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,d){const _={};for(const B in this._tiles){const S=this._tiles[B];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+d),_[S.tileID.key]=S}this._tiles=_;for(const B in this._timers)clearTimeout(this._timers[B]),delete this._timers[B];for(const B in this._tiles)this._setTileReloadTimer(B,this._tiles[B])}}update(a,d){if(this.transform=a,this.terrain=d,!this._sourceLoaded||this._paused)return;let _;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?_=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new s.Q(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y)):(_=a.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(_=_.filter(I=>this._source.hasTile(I)))):_=[];const B=a.coveringZoomLevel(this._source),S=Math.max(B-Zi.maxOverzooming,this._source.minzoom),U=Math.max(B+Zi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const I={};for(const R of _)if(R.canonical.z>this._source.minzoom){const j=R.scaledTo(R.canonical.z-1);I[j.key]=j;const Z=R.scaledTo(Math.max(this._source.minzoom,Math.min(R.canonical.z,5)));I[Z.key]=Z}_=_.concat(Object.values(I))}const H=_.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,H&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const q=this._updateRetainedTiles(_,B);if(Bi(this._source.type)){const I={},R={},j=Object.keys(q),Z=F.now();for(const W of j){const Y=q[W],ie=this._tiles[W];if(!ie||ie.fadeEndTime!==0&&ie.fadeEndTime<=Z)continue;const ae=this.findLoadedParent(Y,S);ae&&(this._addTile(ae.tileID),I[ae.tileID.key]=ae.tileID),R[W]=Y}this._retainLoadedChildren(R,B,U,q);for(const W in I)q[W]||(this._coveredTiles[W]=!0,q[W]=I[W]);if(d){const W={},Y={};for(const ie of _)this._tiles[ie.key].hasData()?W[ie.key]=ie:Y[ie.key]=ie;for(const ie in Y){const ae=Y[ie].children(this._source.maxzoom);this._tiles[ae[0].key]&&this._tiles[ae[1].key]&&this._tiles[ae[2].key]&&this._tiles[ae[3].key]&&(W[ae[0].key]=q[ae[0].key]=ae[0],W[ae[1].key]=q[ae[1].key]=ae[1],W[ae[2].key]=q[ae[2].key]=ae[2],W[ae[3].key]=q[ae[3].key]=ae[3],delete Y[ie])}for(const ie in Y){const ae=this.findLoadedParent(Y[ie],this._source.minzoom);if(ae){W[ae.tileID.key]=q[ae.tileID.key]=ae.tileID;for(const fe in W)W[fe].isChildOf(ae.tileID)&&delete W[fe]}}for(const ie in this._tiles)W[ie]||(this._coveredTiles[ie]=!0)}}for(const I in q)this._tiles[I].clearFadeHold();const w=s.ab(this._tiles,q);for(const I of w){const R=this._tiles[I];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(I)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)}_updateRetainedTiles(a,d){const _={},B={},S=Math.max(d-Zi.maxOverzooming,this._source.minzoom),U=Math.max(d+Zi.maxUnderzooming,this._source.minzoom),H={};for(const q of a){const w=this._addTile(q);_[q.key]=q,w.hasData()||d<this._source.maxzoom&&(H[q.key]=q)}this._retainLoadedChildren(H,d,U,_);for(const q of a){let w=this._tiles[q.key];if(w.hasData())continue;if(d+1>this._source.maxzoom){const R=q.children(this._source.maxzoom)[0],j=this.getTile(R);if(j&&j.hasData()){_[R.key]=R;continue}}else{const R=q.children(this._source.maxzoom);if(_[R[0].key]&&_[R[1].key]&&_[R[2].key]&&_[R[3].key])continue}let I=w.wasRequested();for(let R=q.overscaledZ-1;R>=S;--R){const j=q.scaledTo(R);if(B[j.key])break;if(B[j.key]=!0,w=this.getTile(j),!w&&I&&(w=this._addTile(j)),w){const Z=w.hasData();if((I||Z)&&(_[j.key]=j),I=w.wasRequested(),Z)break}}}return _}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const d=[];let _,B=this._tiles[a].tileID;for(;B.overscaledZ>0;){if(B.key in this._loadedParentTiles){_=this._loadedParentTiles[B.key];break}d.push(B.key);const S=B.scaledTo(B.overscaledZ-1);if(_=this._getLoadedTile(S),_)break;B=S}for(const S of d)this._loadedParentTiles[S]=_}}_addTile(a){let d=this._tiles[a.key];if(d)return d;d=this._cache.getAndRemove(a),d&&(this._setTileReloadTimer(a.key,d),d.tileID=a,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,d)));const _=d;return d||(d=new Ji(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(d,a.key,d.state)),d.uses++,this._tiles[a.key]=d,_||this._source.fire(new s.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(a,d){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const _=d.getExpiryTimeout();_&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},_))}_removeTile(a){const d=this._tiles[a];d&&(d.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(a);this._cache.reset()}tilesIn(a,d,_){const B=[],S=this.transform;if(!S)return B;const U=_?S.getCameraQueryGeometry(a):a,H=a.map(W=>S.pointCoordinate(W,this.terrain)),q=U.map(W=>S.pointCoordinate(W,this.terrain)),w=this.getIds();let I=1/0,R=1/0,j=-1/0,Z=-1/0;for(const W of q)I=Math.min(I,W.x),R=Math.min(R,W.y),j=Math.max(j,W.x),Z=Math.max(Z,W.y);for(let W=0;W<w.length;W++){const Y=this._tiles[w[W]];if(Y.holdingForFade())continue;const ie=Y.tileID,ae=Math.pow(2,S.zoom-Y.tileID.overscaledZ),fe=d*Y.queryPadding*s.W/Y.tileSize/ae,pe=[ie.getTilePoint(new s.Y(I,R)),ie.getTilePoint(new s.Y(j,Z))];if(pe[0].x-fe<s.W&&pe[0].y-fe<s.W&&pe[1].x+fe>=0&&pe[1].y+fe>=0){const xe=H.map(Le=>ie.getTilePoint(Le)),Fe=q.map(Le=>ie.getTilePoint(Le));B.push({tile:Y,tileID:ie,queryGeometry:xe,cameraQueryGeometry:Fe,scale:ae})}}return B}getVisibleCoordinates(a){const d=this.getRenderableIds(a).map(_=>this._tiles[_].tileID);for(const _ of d)_.posMatrix=this.transform.calculatePosMatrix(_.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(Bi(this._source.type)){const a=F.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=a)return!0}return!1}setFeatureState(a,d,_){this._state.updateState(a=a||"_geojsonTileLayer",d,_)}removeFeatureState(a,d,_){this._state.removeFeatureState(a=a||"_geojsonTileLayer",d,_)}getFeatureState(a,d){return this._state.getState(a=a||"_geojsonTileLayer",d)}setDependencies(a,d,_){const B=this._tiles[a];B&&B.setDependencies(d,_)}reloadTilesForDependencies(a,d){for(const _ in this._tiles)this._tiles[_].hasDependency(a,d)&&this._reloadTile(_,"reloading");this._cache.filter(_=>!_.hasDependency(a,d))}}function Qt(y,a){const d=Math.abs(2*y.wrap)-+(y.wrap<0),_=Math.abs(2*a.wrap)-+(a.wrap<0);return y.overscaledZ-a.overscaledZ||_-d||a.canonical.y-y.canonical.y||a.canonical.x-y.canonical.x}function Bi(y){return y==="raster"||y==="image"||y==="video"}Zi.maxOverzooming=10,Zi.maxUnderzooming=3;class Ii{constructor(a,d){this.reset(a,d)}reset(a,d){this.points=a||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=s.ac(a,0,1);let d=1,_=this._distances[d];const B=a*this.paddedLength+this.padding;for(;_<B&&d<this._distances.length;)_=this._distances[++d];const S=d-1,U=this._distances[S],H=_-U,q=H>0?(B-U)/H:0;return this.points[S].mult(1-q).add(this.points[d].mult(q))}}function Gt(y,a){let d=!0;return y==="always"||y!=="never"&&a!=="never"||(d=!1),d}class vi{constructor(a,d,_){const B=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(a/_),this.yCellCount=Math.ceil(d/_);for(let U=0;U<this.xCellCount*this.yCellCount;U++)B.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=d,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,d,_,B,S){this._forEachCell(d,_,B,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(B),this.bboxes.push(S)}insertCircle(a,d,_,B){this._forEachCell(d-B,_-B,d+B,_+B,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(d),this.circles.push(_),this.circles.push(B)}_insertBoxCell(a,d,_,B,S,U){this.boxCells[S].push(U)}_insertCircleCell(a,d,_,B,S,U){this.circleCells[S].push(U)}_query(a,d,_,B,S,U,H){if(_<0||a>this.width||B<0||d>this.height)return[];const q=[];if(a<=0&&d<=0&&this.width<=_&&this.height<=B){if(S)return[{key:null,x1:a,y1:d,x2:_,y2:B}];for(let w=0;w<this.boxKeys.length;w++)q.push({key:this.boxKeys[w],x1:this.bboxes[4*w],y1:this.bboxes[4*w+1],x2:this.bboxes[4*w+2],y2:this.bboxes[4*w+3]});for(let w=0;w<this.circleKeys.length;w++){const I=this.circles[3*w],R=this.circles[3*w+1],j=this.circles[3*w+2];q.push({key:this.circleKeys[w],x1:I-j,y1:R-j,x2:I+j,y2:R+j})}}else this._forEachCell(a,d,_,B,this._queryCell,q,{hitTest:S,overlapMode:U,seenUids:{box:{},circle:{}}},H);return q}query(a,d,_,B){return this._query(a,d,_,B,!1,null)}hitTest(a,d,_,B,S,U){return this._query(a,d,_,B,!0,S,U).length>0}hitTestCircle(a,d,_,B,S){const U=a-_,H=a+_,q=d-_,w=d+_;if(H<0||U>this.width||w<0||q>this.height)return!1;const I=[];return this._forEachCell(U,q,H,w,this._queryCellCircle,I,{hitTest:!0,overlapMode:B,circle:{x:a,y:d,radius:_},seenUids:{box:{},circle:{}}},S),I.length>0}_queryCell(a,d,_,B,S,U,H,q){const{seenUids:w,hitTest:I,overlapMode:R}=H,j=this.boxCells[S];if(j!==null){const W=this.bboxes;for(const Y of j)if(!w.box[Y]){w.box[Y]=!0;const ie=4*Y,ae=this.boxKeys[Y];if(a<=W[ie+2]&&d<=W[ie+3]&&_>=W[ie+0]&&B>=W[ie+1]&&(!q||q(ae))&&(!I||!Gt(R,ae.overlapMode))&&(U.push({key:ae,x1:W[ie],y1:W[ie+1],x2:W[ie+2],y2:W[ie+3]}),I))return!0}}const Z=this.circleCells[S];if(Z!==null){const W=this.circles;for(const Y of Z)if(!w.circle[Y]){w.circle[Y]=!0;const ie=3*Y,ae=this.circleKeys[Y];if(this._circleAndRectCollide(W[ie],W[ie+1],W[ie+2],a,d,_,B)&&(!q||q(ae))&&(!I||!Gt(R,ae.overlapMode))){const fe=W[ie],pe=W[ie+1],xe=W[ie+2];if(U.push({key:ae,x1:fe-xe,y1:pe-xe,x2:fe+xe,y2:pe+xe}),I)return!0}}}return!1}_queryCellCircle(a,d,_,B,S,U,H,q){const{circle:w,seenUids:I,overlapMode:R}=H,j=this.boxCells[S];if(j!==null){const W=this.bboxes;for(const Y of j)if(!I.box[Y]){I.box[Y]=!0;const ie=4*Y,ae=this.boxKeys[Y];if(this._circleAndRectCollide(w.x,w.y,w.radius,W[ie+0],W[ie+1],W[ie+2],W[ie+3])&&(!q||q(ae))&&!Gt(R,ae.overlapMode))return U.push(!0),!0}}const Z=this.circleCells[S];if(Z!==null){const W=this.circles;for(const Y of Z)if(!I.circle[Y]){I.circle[Y]=!0;const ie=3*Y,ae=this.circleKeys[Y];if(this._circlesCollide(W[ie],W[ie+1],W[ie+2],w.x,w.y,w.radius)&&(!q||q(ae))&&!Gt(R,ae.overlapMode))return U.push(!0),!0}}}_forEachCell(a,d,_,B,S,U,H,q){const w=this._convertToXCellCoord(a),I=this._convertToYCellCoord(d),R=this._convertToXCellCoord(_),j=this._convertToYCellCoord(B);for(let Z=w;Z<=R;Z++)for(let W=I;W<=j;W++)if(S.call(this,a,d,_,B,this.xCellCount*W+Z,U,H,q))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,d,_,B,S,U){const H=B-a,q=S-d,w=_+U;return w*w>H*H+q*q}_circleAndRectCollide(a,d,_,B,S,U,H){const q=(U-B)/2,w=Math.abs(a-(B+q));if(w>q+_)return!1;const I=(H-S)/2,R=Math.abs(d-(S+I));if(R>I+_)return!1;if(w<=q||R<=I)return!0;const j=w-q,Z=R-I;return j*j+Z*Z<=_*_}}function Jt(y,a,d,_,B){const S=s.F();return a?(s.J(S,S,[1/B,1/B,1]),d||s.ad(S,S,_.angle)):s.K(S,_.labelPlaneMatrix,y),S}function mr(y,a,d,_,B){if(a){const S=s.ae(y);return s.J(S,S,[B,B,1]),d||s.ad(S,S,-_.angle),S}return _.glCoordMatrix}function Sr(y,a,d){let _;d?(_=[y.x,y.y,d(y.x,y.y),1],s.af(_,_,a)):(_=[y.x,y.y,0,1],yt(_,_,a));const B=_[3];return{point:new s.P(_[0]/B,_[1]/B),signedDistanceFromCamera:B}}function ze(y,a){return .5+y/a*.5}function we(y,a){const d=y[0]/y[3],_=y[1]/y[3];return d>=-a[0]&&d<=a[0]&&_>=-a[1]&&_<=a[1]}function oe(y,a,d,_,B,S,U,H,q,w){const I=_?y.textSizeData:y.iconSizeData,R=s.ag(I,d.transform.zoom),j=[256/d.width*2+1,256/d.height*2+1],Z=_?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;Z.clear();const W=y.lineVertexArray,Y=_?y.text.placedSymbolArray:y.icon.placedSymbolArray,ie=d.transform.width/d.transform.height;let ae=!1;for(let fe=0;fe<Y.length;fe++){const pe=Y.get(fe);if(pe.hidden||pe.writingMode===s.ah.vertical&&!ae){rt(pe.numGlyphs,Z);continue}let xe;if(ae=!1,w?(xe=[pe.anchorX,pe.anchorY,w(pe.anchorX,pe.anchorY),1],s.af(xe,xe,a)):(xe=[pe.anchorX,pe.anchorY,0,1],yt(xe,xe,a)),!we(xe,j)){rt(pe.numGlyphs,Z);continue}const Fe=ze(d.transform.cameraToCenterDistance,xe[3]),Le=s.ai(I,R,pe),nt=U?Le/Fe:Le*Fe,Ke=new s.P(pe.anchorX,pe.anchorY),Re=Sr(Ke,B,w).point,Qe={projections:{},offsets:{}},pt=ge(pe,nt,!1,H,a,B,S,y.glyphOffsetArray,W,Z,Re,Ke,Qe,ie,q,w);ae=pt.useVertical,(pt.notEnoughRoom||ae||pt.needsFlipping&&ge(pe,nt,!0,H,a,B,S,y.glyphOffsetArray,W,Z,Re,Ke,Qe,ie,q,w).notEnoughRoom)&&rt(pe.numGlyphs,Z)}_?y.text.dynamicLayoutVertexBuffer.updateData(Z):y.icon.dynamicLayoutVertexBuffer.updateData(Z)}function ee(y,a,d,_,B,S,U,H,q,w,I,R,j){const Z=H.glyphStartIndex+H.numGlyphs,W=H.lineStartIndex,Y=H.lineStartIndex+H.lineLength,ie=a.getoffsetX(H.glyphStartIndex),ae=a.getoffsetX(Z-1),fe=Oe(y*ie,d,_,B,S,U,H.segment,W,Y,q,w,I,R,j);if(!fe)return null;const pe=Oe(y*ae,d,_,B,S,U,H.segment,W,Y,q,w,I,R,j);return pe?{first:fe,last:pe}:null}function le(y,a,d,_){return y===s.ah.horizontal&&Math.abs(d.y-a.y)>Math.abs(d.x-a.x)*_?{useVertical:!0}:(y===s.ah.vertical?a.y<d.y:a.x>d.x)?{needsFlipping:!0}:null}function ge(y,a,d,_,B,S,U,H,q,w,I,R,j,Z,W,Y){const ie=a/24,ae=y.lineOffsetX*ie,fe=y.lineOffsetY*ie;let pe;if(y.numGlyphs>1){const xe=y.glyphStartIndex+y.numGlyphs,Fe=y.lineStartIndex,Le=y.lineStartIndex+y.lineLength,nt=ee(ie,H,ae,fe,d,I,R,y,q,S,j,W,Y);if(!nt)return{notEnoughRoom:!0};const Ke=Sr(nt.first.point,U,Y).point,Re=Sr(nt.last.point,U,Y).point;if(_&&!d){const Qe=le(y.writingMode,Ke,Re,Z);if(Qe)return Qe}pe=[nt.first];for(let Qe=y.glyphStartIndex+1;Qe<xe-1;Qe++)pe.push(Oe(ie*H.getoffsetX(Qe),ae,fe,d,I,R,y.segment,Fe,Le,q,S,j,W,Y));pe.push(nt.last)}else{if(_&&!d){const Fe=Sr(R,B,Y).point,Le=y.lineStartIndex+y.segment+1,nt=new s.P(q.getx(Le),q.gety(Le)),Ke=Sr(nt,B,Y),Re=Ke.signedDistanceFromCamera>0?Ke.point:ve(R,nt,Fe,1,B,Y),Qe=le(y.writingMode,Fe,Re,Z);if(Qe)return Qe}const xe=Oe(ie*H.getoffsetX(y.glyphStartIndex),ae,fe,d,I,R,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,q,S,j,W,Y);if(!xe)return{notEnoughRoom:!0};pe=[xe]}for(const xe of pe)s.aj(w,xe.point,xe.angle);return{}}function ve(y,a,d,_,B,S){const U=Sr(y.add(y.sub(a)._unit()),B,S).point,H=d.sub(U);return d.add(H._mult(_/H.mag()))}function Ce(y,a){const{projectionCache:d,lineVertexArray:_,labelPlaneMatrix:B,tileAnchorPoint:S,distanceFromAnchor:U,getElevation:H,previousVertex:q,direction:w,absOffsetX:I}=a;if(d.projections[y])return d.projections[y];const R=new s.P(_.getx(y),_.gety(y)),j=Sr(R,B,H);if(j.signedDistanceFromCamera>0)return d.projections[y]=j.point,j.point;const Z=y-w;return ve(U===0?S:new s.P(_.getx(Z),_.gety(Z)),R,q,I-U+1,B,H)}function be(y,a,d){return y._unit()._perp()._mult(a*d)}function Pe(y,a,d,_,B,S,U,H){const{projectionCache:q,direction:w}=H;if(q.offsets[y])return q.offsets[y];const I=d.add(a);if(y+w<_||y+w>=B)return q.offsets[y]=I,I;const R=Ce(y+w,H),j=be(R.sub(d),U,w),Z=d.add(j),W=R.add(j);return q.offsets[y]=s.ak(S,I,Z,W)||I,q.offsets[y]}function Oe(y,a,d,_,B,S,U,H,q,w,I,R,j,Z){const W=_?y-a:y+a;let Y=W>0?1:-1,ie=0;_&&(Y*=-1,ie=Math.PI),Y<0&&(ie+=Math.PI);let ae,fe,pe=Y>0?H+U:H+U+1,xe=B,Fe=B,Le=0,nt=0;const Ke=Math.abs(W),Re=[];let Qe;for(;Le+nt<=Ke;){if(pe+=Y,pe<H||pe>=q)return null;Le+=nt,Fe=xe,fe=ae;const ht={projectionCache:R,lineVertexArray:w,labelPlaneMatrix:I,tileAnchorPoint:S,distanceFromAnchor:Le,getElevation:Z,previousVertex:Fe,direction:Y,absOffsetX:Ke};if(xe=Ce(pe,ht),d===0)Re.push(Fe),Qe=xe.sub(Fe);else{let Rt;const Dt=xe.sub(Fe);Rt=Dt.mag()===0?be(Ce(pe+Y,ht).sub(xe),d,Y):be(Dt,d,Y),fe||(fe=Fe.add(Rt)),ae=Pe(pe,Rt,xe,H,q,fe,d,ht),Re.push(fe),Qe=ae.sub(fe)}nt=Qe.mag()}const pt=Qe._mult((Ke-Le)/nt)._add(fe||Fe),bt=ie+Math.atan2(xe.y-Fe.y,xe.x-Fe.x);return Re.push(pt),{point:pt,angle:j?bt:0,path:Re}}const Ge=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function rt(y,a){for(let d=0;d<y;d++){const _=a.length;a.resize(_+4),a.float32.set(Ge,3*_)}}function yt(y,a,d){const _=a[0],B=a[1];return y[0]=d[0]*_+d[4]*B+d[12],y[1]=d[1]*_+d[5]*B+d[13],y[3]=d[3]*_+d[7]*B+d[15],y}const Et=100;class Yt{constructor(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new vi(a.width+200,a.height+200,25),_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new vi(a.width+200,a.height+200,25);this.transform=a,this.grid=d,this.ignoredGrid=_,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Et,this.screenBottomBoundary=a.height+Et,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(a,d,_,B,S,U){const H=this.projectAndGetPerspectiveRatio(B,a.anchorPointX,a.anchorPointY,U),q=_*H.perspectiveRatio,w=a.x1*q+H.point.x,I=a.y1*q+H.point.y,R=a.x2*q+H.point.x,j=a.y2*q+H.point.y;return!this.isInsideGrid(w,I,R,j)||d!=="always"&&this.grid.hitTest(w,I,R,j,d,S)||H.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[w,I,R,j],offscreen:this.isOffscreen(w,I,R,j)}}placeCollisionCircles(a,d,_,B,S,U,H,q,w,I,R,j,Z,W){const Y=[],ie=new s.P(d.anchorX,d.anchorY),ae=Sr(ie,U,W),fe=ze(this.transform.cameraToCenterDistance,ae.signedDistanceFromCamera),pe=(I?S/fe:S*fe)/s.ao,xe=Sr(ie,H,W).point,Fe=ee(pe,B,d.lineOffsetX*pe,d.lineOffsetY*pe,!1,xe,ie,d,_,H,{projections:{},offsets:{}},!1,W);let Le=!1,nt=!1,Ke=!0;if(Fe){const Re=.5*j*fe+Z,Qe=new s.P(-100,-100),pt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),bt=new Ii,ht=Fe.first,Rt=Fe.last;let Dt=[];for(let _i=ht.path.length-1;_i>=1;_i--)Dt.push(ht.path[_i]);for(let _i=1;_i<Rt.path.length;_i++)Dt.push(Rt.path[_i]);const hi=2.5*Re;if(q){const _i=Dt.map(Si=>Sr(Si,q,W));Dt=_i.some(Si=>Si.signedDistanceFromCamera<=0)?[]:_i.map(Si=>Si.point)}let Vt=[];if(Dt.length>0){const _i=Dt[0].clone(),Si=Dt[0].clone();for(let Yi=1;Yi<Dt.length;Yi++)_i.x=Math.min(_i.x,Dt[Yi].x),_i.y=Math.min(_i.y,Dt[Yi].y),Si.x=Math.max(Si.x,Dt[Yi].x),Si.y=Math.max(Si.y,Dt[Yi].y);Vt=_i.x>=Qe.x&&Si.x<=pt.x&&_i.y>=Qe.y&&Si.y<=pt.y?[Dt]:Si.x<Qe.x||_i.x>pt.x||Si.y<Qe.y||_i.y>pt.y?[]:s.al([Dt],Qe.x,Qe.y,pt.x,pt.y)}for(const _i of Vt){bt.reset(_i,.25*Re);let Si=0;Si=bt.length<=.5*Re?1:Math.ceil(bt.paddedLength/hi)+1;for(let Yi=0;Yi<Si;Yi++){const Ti=Yi/Math.max(Si-1,1),yr=bt.lerp(Ti),fr=yr.x+Et,ji=yr.y+Et;Y.push(fr,ji,Re,0);const Ur=fr-Re,rn=ji-Re,Mr=fr+Re,Kr=ji+Re;if(Ke=Ke&&this.isOffscreen(Ur,rn,Mr,Kr),nt=nt||this.isInsideGrid(Ur,rn,Mr,Kr),a!=="always"&&this.grid.hitTestCircle(fr,ji,Re,a,R)&&(Le=!0,!w))return{circles:[],offscreen:!1,collisionDetected:Le}}}}return{circles:!w&&Le||!nt||fe<this.perspectiveRatioCutoff?[]:Y,offscreen:Ke,collisionDetected:Le}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let _=1/0,B=1/0,S=-1/0,U=-1/0;for(const I of a){const R=new s.P(I.x+Et,I.y+Et);_=Math.min(_,R.x),B=Math.min(B,R.y),S=Math.max(S,R.x),U=Math.max(U,R.y),d.push(R)}const H=this.grid.query(_,B,S,U).concat(this.ignoredGrid.query(_,B,S,U)),q={},w={};for(const I of H){const R=I.key;if(q[R.bucketInstanceId]===void 0&&(q[R.bucketInstanceId]={}),q[R.bucketInstanceId][R.featureIndex])continue;const j=[new s.P(I.x1,I.y1),new s.P(I.x2,I.y1),new s.P(I.x2,I.y2),new s.P(I.x1,I.y2)];s.am(d,j)&&(q[R.bucketInstanceId][R.featureIndex]=!0,w[R.bucketInstanceId]===void 0&&(w[R.bucketInstanceId]=[]),w[R.bucketInstanceId].push(R.featureIndex))}return w}insertCollisionBox(a,d,_,B,S,U){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:B,featureIndex:S,collisionGroupID:U,overlapMode:d},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,d,_,B,S,U){const H=_?this.ignoredGrid:this.grid,q={bucketInstanceId:B,featureIndex:S,collisionGroupID:U,overlapMode:d};for(let w=0;w<a.length;w+=4)H.insertCircle(q,a[w],a[w+1],a[w+2])}projectAndGetPerspectiveRatio(a,d,_,B){let S;return B?(S=[d,_,B(d,_),1],s.af(S,S,a)):(S=[d,_,0,1],yt(S,S,a)),{point:new s.P((S[0]/S[3]+1)/2*this.transform.width+Et,(-S[1]/S[3]+1)/2*this.transform.height+Et),perspectiveRatio:.5+this.transform.cameraToCenterDistance/S[3]*.5}}isOffscreen(a,d,_,B){return _<Et||a>=this.screenRightBoundary||B<Et||d>this.screenBottomBoundary}isInsideGrid(a,d,_,B){return _>=0&&a<this.gridRightBoundary&&B>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const a=s.an([]);return s.H(a,a,[-100,-100,0]),a}}function qt(y,a,d){return a*(s.W/(y.tileSize*Math.pow(2,d-y.tileID.overscaledZ)))}class Kt{constructor(a,d,_,B){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?d:-d))):B&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class si{constructor(a,d,_,B,S){this.text=new Kt(a?a.text:null,d,_,S),this.icon=new Kt(a?a.icon:null,d,B,S)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ci{constructor(a,d,_){this.text=a,this.icon=d,this.skipFade=_}}class Hi{constructor(){this.invProjMatrix=s.F(),this.viewportMatrix=s.F(),this.circles=[]}}class wi{constructor(a,d,_,B,S){this.bucketInstanceId=a,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=B,this.tileID=S}}class Ui{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const d=++this.maxGroupID;this.collisionGroups[a]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[a]}}function st(y,a,d,_,B){const{horizontalAlign:S,verticalAlign:U}=s.at(y);return new s.P(-(S-.5)*a+_[0]*B,-(U-.5)*d+_[1]*B)}function ti(y,a,d,_,B,S){const{x1:U,x2:H,y1:q,y2:w,anchorPointX:I,anchorPointY:R}=y,j=new s.P(a,d);return _&&j._rotate(B?S:-S),{x1:U+j.x,y1:q+j.y,x2:H+j.x,y2:w+j.y,anchorPointX:I,anchorPointY:R}}class zt{constructor(a,d,_,B,S){this.transform=a.clone(),this.terrain=d,this.collisionIndex=new Yt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new Ui(B),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,d,_,B){const S=_.getBucket(d),U=_.latestFeatureIndex;if(!S||!U||d.id!==S.layerIds[0])return;const H=_.collisionBoxArray,q=S.layers[0].layout,w=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),I=_.tileSize/s.W,R=this.transform.calculatePosMatrix(_.tileID.toUnwrapped()),j=q.get("text-pitch-alignment")==="map",Z=q.get("text-rotation-alignment")==="map",W=qt(_,1,this.transform.zoom),Y=Jt(R,j,Z,this.transform,W);let ie=null;if(j){const fe=mr(R,j,Z,this.transform,W);ie=s.K([],this.transform.labelPlaneMatrix,fe)}this.retainedQueryData[S.bucketInstanceId]=new wi(S.bucketInstanceId,U,S.sourceLayerIndex,S.index,_.tileID);const ae={bucket:S,layout:q,posMatrix:R,textLabelPlaneMatrix:Y,labelToScreenMatrix:ie,scale:w,textPixelRatio:I,holdingForFade:_.holdingForFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:s.ag(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(B)for(const fe of S.sortKeyRanges){const{sortKey:pe,symbolInstanceStart:xe,symbolInstanceEnd:Fe}=fe;a.push({sortKey:pe,symbolInstanceStart:xe,symbolInstanceEnd:Fe,parameters:ae})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:ae})}attemptAnchorPlacement(a,d,_,B,S,U,H,q,w,I,R,j,Z,W,Y,ie){const ae=s.ap[a.textAnchor],fe=[a.textOffset0,a.textOffset1],pe=st(ae,_,B,fe,S),xe=this.collisionIndex.placeCollisionBox(ti(d,pe.x,pe.y,U,H,this.transform.angle),R,q,w,I.predicate,ie);if((!Y||this.collisionIndex.placeCollisionBox(ti(Y,pe.x,pe.y,U,H,this.transform.angle),R,q,w,I.predicate,ie).box.length!==0)&&xe.box.length>0){let Fe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Fe=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:fe,width:_,height:B,anchor:ae,textBoxScale:S,prevAnchor:Fe},this.markUsedJustification(Z,ae,j,W),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,W,j),this.placedOrientations[j.crossTileID]=W),{shift:pe,placedGlyphBoxes:xe}}}placeLayerBucketPart(a,d,_){const{bucket:B,layout:S,posMatrix:U,textLabelPlaneMatrix:H,labelToScreenMatrix:q,textPixelRatio:w,holdingForFade:I,collisionBoxArray:R,partiallyEvaluatedTextSize:j,collisionGroup:Z}=a.parameters,W=S.get("text-optional"),Y=S.get("icon-optional"),ie=s.aq(S,"text-overlap","text-allow-overlap"),ae=ie==="always",fe=s.aq(S,"icon-overlap","icon-allow-overlap"),pe=fe==="always",xe=S.get("text-rotation-alignment")==="map",Fe=S.get("text-pitch-alignment")==="map",Le=S.get("icon-text-fit")!=="none",nt=S.get("symbol-z-order")==="viewport-y",Ke=ae&&(pe||!B.hasIconData()||Y),Re=pe&&(ae||!B.hasTextData()||W);!B.collisionArrays&&R&&B.deserializeCollisionBoxes(R);const Qe=this.retainedQueryData[B.bucketInstanceId].tileID,pt=this.terrain?(ht,Rt)=>this.terrain.getElevation(Qe,ht,Rt):null,bt=(ht,Rt)=>{var Dt,hi;if(d[ht.crossTileID])return;if(I)return void(this.placements[ht.crossTileID]=new Ci(!1,!1,!1));let Vt=!1,_i=!1,Si=!0,Yi=null,Ti={box:null,offscreen:null},yr={box:null,offscreen:null},fr=null,ji=null,Ur=null,rn=0,Mr=0,Kr=0;Rt.textFeatureIndex?rn=Rt.textFeatureIndex:ht.useRuntimeCollisionCircles&&(rn=ht.featureIndex),Rt.verticalTextFeatureIndex&&(Mr=Rt.verticalTextFeatureIndex);const Cr=Rt.textBox;if(Cr){const pr=qr=>{let Wr=s.ah.horizontal;if(B.allowVerticalPlacement&&!qr&&this.prevPlacement){const Mn=this.prevPlacement.placedOrientations[ht.crossTileID];Mn&&(this.placedOrientations[ht.crossTileID]=Mn,Wr=Mn,this.markUsedOrientation(B,Wr,ht))}return Wr},_r=(qr,Wr)=>{if(B.allowVerticalPlacement&&ht.numVerticalGlyphVertices>0&&Rt.verticalTextBox){for(const Mn of B.writingModes)if(Mn===s.ah.vertical?(Ti=Wr(),yr=Ti):Ti=qr(),Ti&&Ti.box&&Ti.box.length)break}else Ti=qr()},or=ht.textAnchorOffsetStartIndex,ln=ht.textAnchorOffsetEndIndex;if(ln===or){const qr=(Wr,Mn)=>{const Kn=this.collisionIndex.placeCollisionBox(Wr,ie,w,U,Z.predicate,pt);return Kn&&Kn.box&&Kn.box.length&&(this.markUsedOrientation(B,Mn,ht),this.placedOrientations[ht.crossTileID]=Mn),Kn};_r(()=>qr(Cr,s.ah.horizontal),()=>{const Wr=Rt.verticalTextBox;return B.allowVerticalPlacement&&ht.numVerticalGlyphVertices>0&&Wr?qr(Wr,s.ah.vertical):{box:null,offscreen:null}}),pr(Ti&&Ti.box&&Ti.box.length)}else{let qr=s.ap[(hi=(Dt=this.prevPlacement)===null||Dt===void 0?void 0:Dt.variableOffsets[ht.crossTileID])===null||hi===void 0?void 0:hi.anchor];const Wr=(Kn,_l,$r)=>{const _n=Kn.x2-Kn.x1,ea=Kn.y2-Kn.y1,Os=ht.textBoxScale,Ws=Le&&fe==="never"?_l:null;let Oo={box:[],offscreen:!1},oo=ie==="never"?1:2,Nu="never";qr&&oo++;for(let Ra=0;Ra<oo;Ra++){for(let In=or;In<ln;In++){const mc=B.textAnchorOffsets.get(In);if(qr&&mc.textAnchor!==qr)continue;const fu=this.attemptAnchorPlacement(mc,Kn,_n,ea,Os,xe,Fe,w,U,Z,Nu,ht,B,$r,Ws,pt);if(fu&&(Oo=fu.placedGlyphBoxes,Oo&&Oo.box&&Oo.box.length))return Vt=!0,Yi=fu.shift,Oo}qr?qr=null:Nu=ie}return Oo};_r(()=>Wr(Cr,Rt.iconBox,s.ah.horizontal),()=>{const Kn=Rt.verticalTextBox;return B.allowVerticalPlacement&&!(Ti&&Ti.box&&Ti.box.length)&&ht.numVerticalGlyphVertices>0&&Kn?Wr(Kn,Rt.verticalIconBox,s.ah.vertical):{box:null,offscreen:null}}),Ti&&(Vt=Ti.box,Si=Ti.offscreen);const Mn=pr(Ti&&Ti.box);if(!Vt&&this.prevPlacement){const Kn=this.prevPlacement.variableOffsets[ht.crossTileID];Kn&&(this.variableOffsets[ht.crossTileID]=Kn,this.markUsedJustification(B,Kn.anchor,ht,Mn))}}}if(fr=Ti,Vt=fr&&fr.box&&fr.box.length>0,Si=fr&&fr.offscreen,ht.useRuntimeCollisionCircles){const pr=B.text.placedSymbolArray.get(ht.centerJustifiedTextSymbolIndex),_r=s.ai(B.textSizeData,j,pr),or=S.get("text-padding");ji=this.collisionIndex.placeCollisionCircles(ie,pr,B.lineVertexArray,B.glyphOffsetArray,_r,U,H,q,_,Fe,Z.predicate,ht.collisionCircleDiameter,or,pt),ji.circles.length&&ji.collisionDetected&&!_&&s.w("Collisions detected, but collision boxes are not shown"),Vt=ae||ji.circles.length>0&&!ji.collisionDetected,Si=Si&&ji.offscreen}if(Rt.iconFeatureIndex&&(Kr=Rt.iconFeatureIndex),Rt.iconBox){const pr=_r=>{const or=Le&&Yi?ti(_r,Yi.x,Yi.y,xe,Fe,this.transform.angle):_r;return this.collisionIndex.placeCollisionBox(or,fe,w,U,Z.predicate,pt)};yr&&yr.box&&yr.box.length&&Rt.verticalIconBox?(Ur=pr(Rt.verticalIconBox),_i=Ur.box.length>0):(Ur=pr(Rt.iconBox),_i=Ur.box.length>0),Si=Si&&Ur.offscreen}const ts=W||ht.numHorizontalGlyphVertices===0&&ht.numVerticalGlyphVertices===0,Nr=Y||ht.numIconVertices===0;if(ts||Nr?Nr?ts||(_i=_i&&Vt):Vt=_i&&Vt:_i=Vt=_i&&Vt,Vt&&fr&&fr.box&&this.collisionIndex.insertCollisionBox(fr.box,ie,S.get("text-ignore-placement"),B.bucketInstanceId,yr&&yr.box&&Mr?Mr:rn,Z.ID),_i&&Ur&&this.collisionIndex.insertCollisionBox(Ur.box,fe,S.get("icon-ignore-placement"),B.bucketInstanceId,Kr,Z.ID),ji&&(Vt&&this.collisionIndex.insertCollisionCircles(ji.circles,ie,S.get("text-ignore-placement"),B.bucketInstanceId,rn,Z.ID),_)){const pr=B.bucketInstanceId;let _r=this.collisionCircleArrays[pr];_r===void 0&&(_r=this.collisionCircleArrays[pr]=new Hi);for(let or=0;or<ji.circles.length;or+=4)_r.circles.push(ji.circles[or+0]),_r.circles.push(ji.circles[or+1]),_r.circles.push(ji.circles[or+2]),_r.circles.push(ji.collisionDetected?1:0)}if(ht.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(B.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ht.crossTileID]=new Ci(Vt||Ke,_i||Re,Si||B.justReloaded),d[ht.crossTileID]=!0};if(nt){if(a.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ht=B.getSortedSymbolIndexes(this.transform.angle);for(let Rt=ht.length-1;Rt>=0;--Rt){const Dt=ht[Rt];bt(B.symbolInstances.get(Dt),B.collisionArrays[Dt])}}else for(let ht=a.symbolInstanceStart;ht<a.symbolInstanceEnd;ht++)bt(B.symbolInstances.get(ht),B.collisionArrays[ht]);if(_&&B.bucketInstanceId in this.collisionCircleArrays){const ht=this.collisionCircleArrays[B.bucketInstanceId];s.ar(ht.invProjMatrix,U),ht.viewportMatrix=this.collisionIndex.getViewportMatrix()}B.justReloaded=!1}markUsedJustification(a,d,_,B){let S;S=B===s.ah.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[s.as(d)];const U=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];for(const H of U)H>=0&&(a.text.placedSymbolArray.get(H).crossTileID=S>=0&&H!==S?0:_.crossTileID)}markUsedOrientation(a,d,_){const B=d===s.ah.horizontal||d===s.ah.horizontalOnly?d:0,S=d===s.ah.vertical?d:0,U=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];for(const H of U)a.text.placedSymbolArray.get(H).placedOrientation=B;_.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=S)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const B=d?d.symbolFadeChange(a):1,S=d?d.opacities:{},U=d?d.variableOffsets:{},H=d?d.placedOrientations:{};for(const q in this.placements){const w=this.placements[q],I=S[q];I?(this.opacities[q]=new si(I,B,w.text,w.icon),_=_||w.text!==I.text.placed||w.icon!==I.icon.placed):(this.opacities[q]=new si(null,B,w.text,w.icon,w.skipFade),_=_||w.text||w.icon)}for(const q in S){const w=S[q];if(!this.opacities[q]){const I=new si(w,B,!1,!1);I.isHidden()||(this.opacities[q]=I,_=_||w.text.placed||w.icon.placed)}}for(const q in U)this.variableOffsets[q]||!this.opacities[q]||this.opacities[q].isHidden()||(this.variableOffsets[q]=U[q]);for(const q in H)this.placedOrientations[q]||!this.opacities[q]||this.opacities[q].isHidden()||(this.placedOrientations[q]=H[q]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");_?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:a)}updateLayerOpacities(a,d){const _={};for(const B of d){const S=B.getBucket(a);S&&B.latestFeatureIndex&&a.id===S.layerIds[0]&&this.updateBucketOpacities(S,_,B.collisionBoxArray)}}updateBucketOpacities(a,d,_){a.hasTextData()&&(a.text.opacityVertexArray.clear(),a.text.hasVisibleVertices=!1),a.hasIconData()&&(a.icon.opacityVertexArray.clear(),a.icon.hasVisibleVertices=!1),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const B=a.layers[0],S=B.layout,U=new si(null,0,!1,!1,!0),H=S.get("text-allow-overlap"),q=S.get("icon-allow-overlap"),w=B._unevaluatedLayout.hasValue("text-variable-anchor")||B._unevaluatedLayout.hasValue("text-variable-anchor-offset"),I=S.get("text-rotation-alignment")==="map",R=S.get("text-pitch-alignment")==="map",j=S.get("icon-text-fit")!=="none",Z=new si(null,0,H&&(q||!a.hasIconData()||S.get("icon-optional")),q&&(H||!a.hasTextData()||S.get("text-optional")),!0);!a.collisionArrays&&_&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(_);const W=(Y,ie,ae)=>{for(let fe=0;fe<ie/4;fe++)Y.opacityVertexArray.emplaceBack(ae);Y.hasVisibleVertices=Y.hasVisibleVertices||ae!==gs};for(let Y=0;Y<a.symbolInstances.length;Y++){const ie=a.symbolInstances.get(Y),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:fe,crossTileID:pe}=ie;let xe=this.opacities[pe];d[pe]?xe=U:xe||(xe=Z,this.opacities[pe]=xe),d[pe]=!0;const Fe=ie.numIconVertices>0,Le=this.placedOrientations[ie.crossTileID],nt=Le===s.ah.vertical,Ke=Le===s.ah.horizontal||Le===s.ah.horizontalOnly;if(ae>0||fe>0){const Re=kn(xe.text);W(a.text,ae,nt?gs:Re),W(a.text,fe,Ke?gs:Re);const Qe=xe.text.isHidden();[ie.rightJustifiedTextSymbolIndex,ie.centerJustifiedTextSymbolIndex,ie.leftJustifiedTextSymbolIndex].forEach(ht=>{ht>=0&&(a.text.placedSymbolArray.get(ht).hidden=Qe||nt?1:0)}),ie.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(ie.verticalPlacedTextSymbolIndex).hidden=Qe||Ke?1:0);const pt=this.variableOffsets[ie.crossTileID];pt&&this.markUsedJustification(a,pt.anchor,ie,Le);const bt=this.placedOrientations[ie.crossTileID];bt&&(this.markUsedJustification(a,"left",ie,bt),this.markUsedOrientation(a,bt,ie))}if(Fe){const Re=kn(xe.icon),Qe=!(j&&ie.verticalPlacedIconSymbolIndex&&nt);ie.placedIconSymbolIndex>=0&&(W(a.icon,ie.numIconVertices,Qe?Re:gs),a.icon.placedSymbolArray.get(ie.placedIconSymbolIndex).hidden=xe.icon.isHidden()),ie.verticalPlacedIconSymbolIndex>=0&&(W(a.icon,ie.numVerticalIconVertices,Qe?gs:Re),a.icon.placedSymbolArray.get(ie.verticalPlacedIconSymbolIndex).hidden=xe.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const Re=a.collisionArrays[Y];if(Re){let Qe=new s.P(0,0);if(Re.textBox||Re.verticalTextBox){let bt=!0;if(w){const ht=this.variableOffsets[pe];ht?(Qe=st(ht.anchor,ht.width,ht.height,ht.textOffset,ht.textBoxScale),I&&Qe._rotate(R?this.transform.angle:-this.transform.angle)):bt=!1}Re.textBox&&zi(a.textCollisionBox.collisionVertexArray,xe.text.placed,!bt||nt,Qe.x,Qe.y),Re.verticalTextBox&&zi(a.textCollisionBox.collisionVertexArray,xe.text.placed,!bt||Ke,Qe.x,Qe.y)}const pt=!!(!Ke&&Re.verticalIconBox);Re.iconBox&&zi(a.iconCollisionBox.collisionVertexArray,xe.icon.placed,pt,j?Qe.x:0,j?Qe.y:0),Re.verticalIconBox&&zi(a.iconCollisionBox.collisionVertexArray,xe.icon.placed,!pt,j?Qe.x:0,j?Qe.y:0)}}}if(a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.text.opacityVertexArray.length!==a.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${a.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${a.text.layoutVertexArray.length}) / 4`);if(a.icon.opacityVertexArray.length!==a.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${a.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${a.icon.layoutVertexArray.length}) / 4`);if(a.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=Y.invProjMatrix,a.placementViewportMatrix=Y.viewportMatrix,a.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>a}setStale(){this.stale=!0}}function zi(y,a,d,_,B){y.emplaceBack(a?1:0,d?1:0,_||0,B||0),y.emplaceBack(a?1:0,d?1:0,_||0,B||0),y.emplaceBack(a?1:0,d?1:0,_||0,B||0),y.emplaceBack(a?1:0,d?1:0,_||0,B||0)}const hr=Math.pow(2,25),sn=Math.pow(2,24),bn=Math.pow(2,17),ur=Math.pow(2,16),gn=Math.pow(2,9),mn=Math.pow(2,8),lr=Math.pow(2,1);function kn(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const a=y.placed?1:0,d=Math.floor(127*y.opacity);return d*hr+a*sn+d*bn+a*ur+d*gn+a*mn+d*lr+a}const gs=0;class Qr{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&!a.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,d,_,B,S){const U=this._bucketParts;for(;this._currentTileIndex<a.length;)if(d.getBucketParts(U,B,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,U.sort((H,q)=>H.sortKey-q.sortKey));this._currentPartIndex<U.length;)if(d.placeLayerBucketPart(U[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,S())return!0;return!1}}class xn{constructor(a,d,_,B,S,U,H,q){this.placement=new zt(a,d,U,H,q),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=B,this._showCollisionBoxes=S,this._done=!1}isDone(){return this._done}continuePlacement(a,d,_){const B=F.now(),S=()=>!this._forceFullPlacement&&F.now()-B>2;for(;this._currentPlacementIndex>=0;){const U=d[a[this._currentPlacementIndex]],H=this.placement.collisionIndex.transform.zoom;if(U.type==="symbol"&&(!U.minzoom||U.minzoom<=H)&&(!U.maxzoom||U.maxzoom>H)){if(this._inProgressLayer||(this._inProgressLayer=new Qr(U)),this._inProgressLayer.continuePlacement(_[U.source],this.placement,this._showCollisionBoxes,U,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const So=512/s.W/2;class us{constructor(a,d,_){this.tileID=a,this.bucketInstanceId=_,this._symbolsByKey={};const B=new Map;for(let S=0;S<d.length;S++){const U=d.get(S),H=U.key,q=B.get(H);q?q.push(U):B.set(H,[U])}for(const[S,U]of B){const H={positions:U.map(q=>({x:Math.floor(q.anchorX*So),y:Math.floor(q.anchorY*So)})),crossTileIDs:U.map(q=>q.crossTileID)};if(H.positions.length>128){const q=new s.au(H.positions.length,16,Uint16Array);for(const{x:w,y:I}of H.positions)q.add(w,I);q.finish(),delete H.positions,H.index=q}this._symbolsByKey[S]=H}}getScaledCoordinates(a,d){const{x:_,y:B,z:S}=this.tileID.canonical,{x:U,y:H,z:q}=d.canonical,w=So/Math.pow(2,q-S),I=(H*s.W+a.anchorY)*w,R=B*s.W*So;return{x:Math.floor((U*s.W+a.anchorX)*w-_*s.W*So),y:Math.floor(I-R)}}findMatches(a,d,_){const B=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let S=0;S<a.length;S++){const U=a.get(S);if(U.crossTileID)continue;const H=this._symbolsByKey[U.key];if(!H)continue;const q=this.getScaledCoordinates(U,d);if(H.index){const w=H.index.range(q.x-B,q.y-B,q.x+B,q.y+B).sort();for(const I of w){const R=H.crossTileIDs[I];if(!_[R]){_[R]=!0,U.crossTileID=R;break}}}else if(H.positions)for(let w=0;w<H.positions.length;w++){const I=H.positions[w],R=H.crossTileIDs[w];if(Math.abs(I.x-q.x)<=B&&Math.abs(I.y-q.y)<=B&&!_[R]){_[R]=!0,U.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(a=>{let{crossTileIDs:d}=a;return d})}}class Wi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ys{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const d=Math.round((a-this.lng)/360);if(d!==0)for(const _ in this.indexes){const B=this.indexes[_],S={};for(const U in B){const H=B[U];H.tileID=H.tileID.unwrapTo(H.tileID.wrap+d),S[H.tileID.key]=H}this.indexes[_]=S}this.lng=a}addBucket(a,d,_){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let S=0;S<d.symbolInstances.length;S++)d.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const B=this.usedCrossTileIDs[a.overscaledZ];for(const S in this.indexes){const U=this.indexes[S];if(Number(S)>a.overscaledZ)for(const H in U){const q=U[H];q.tileID.isChildOf(a)&&q.findMatches(d.symbolInstances,a,B)}else{const H=U[a.scaledTo(Number(S)).key];H&&H.findMatches(d.symbolInstances,a,B)}}for(let S=0;S<d.symbolInstances.length;S++){const U=d.symbolInstances.get(S);U.crossTileID||(U.crossTileID=_.generate(),B[U.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new us(a,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(a,d){for(const _ of d.getCrossTileIDsLists())for(const B of _)delete this.usedCrossTileIDs[a][B]}removeStaleBuckets(a){let d=!1;for(const _ in this.indexes){const B=this.indexes[_];for(const S in B)a[B[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,B[S]),delete B[S],d=!0)}return d}}class Bs{constructor(){this.layerIndexes={},this.crossTileIDs=new Wi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,d,_){let B=this.layerIndexes[a.id];B===void 0&&(B=this.layerIndexes[a.id]=new Ys);let S=!1;const U={};B.handleWrapJump(_);for(const H of d){const q=H.getBucket(a);q&&a.id===q.layerIds[0]&&(q.bucketInstanceId||(q.bucketInstanceId=++this.maxBucketInstanceId),B.addBucket(H.tileID,q,this.crossTileIDs)&&(S=!0),U[q.bucketInstanceId]=!0)}return B.removeStaleBuckets(U)&&(S=!0),S}pruneUnusedLayers(a){const d={};a.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const dr=(y,a)=>s.t(y,a&&a.filter(d=>d.identifier!=="source.canvas")),Fr=s.av();class Hn extends s.E{constructor(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlTextPluginStateChange=()=>{for(const _ in this.sourceCaches){const B=this.sourceCaches[_].getSource().type;B!=="vector"&&B!=="geojson"||this.sourceCaches[_].reload()}},this.map=a,this.dispatcher=new It(Pt(),a._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(_,B)=>this.getGlyphs(_,B)),this.dispatcher.registerMessageHandler("getImages",(_,B)=>this.getImages(_,B)),this.imageManager=new We,this.imageManager.setEventedParent(this),this.glyphManager=new _t(a._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Se(256,512),this.crossTileSymbolIndex=new Bs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.ax()),Nt().on("pluginStateChange",this._rtlTextPluginStateChange),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const B=this.sourceCaches[_.sourceId];if(!B)return;const S=B.getSource();if(S&&S.vectorLayerIds)for(const U in this._layers){const H=this._layers[U];H.source===S.id&&this._validateLayer(H)}})}loadURL(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const B=this.map._requestManager.transformRequest(a,Ee.Style);this._loadStyleRequest=new AbortController,s.h(B,this._loadStyleRequest).then(S=>{this._loadStyleRequest=null,this._load(S.data,d,_)}).catch(S=>{this._loadStyleRequest=null,S&&this.fire(new s.j(S))})}loadJSON(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,F.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(a,d,_)}).catch(()=>{})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(Fr,{validate:!1})}_load(a,d,_){var B;const S=d.transformStyle?d.transformStyle(_,a):a;if(!d.validate||!dr(this,s.x(S))){this._loaded=!0,this.stylesheet=S;for(const U in S.sources)this.addSource(U,S.sources[U],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new Wt(this.stylesheet.light),this.map.setTerrain((B=this.stylesheet.terrain)!==null&&B!==void 0?B:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const a=s.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",a),this._order=a.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of a){const _=s.az(d);_.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=_}}_loadSprite(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,B;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(S,U,H,q){return s._(this,void 0,void 0,function*(){const w=De(S),I=H>1?"@2x":"",R={},j={};for(const{id:Z,url:W}of w){const Y=U.transformRequest(U.normalizeSpriteURL(W,I,".json"),Ee.SpriteJSON);R[Z]=s.h(Y,q);const ie=U.transformRequest(U.normalizeSpriteURL(W,I,".png"),Ee.SpriteImage);j[Z]=_e.getImage(ie,q)}return yield Promise.all([...Object.values(R),...Object.values(j)]),function(Z,W){return s._(this,void 0,void 0,function*(){const Y={};for(const ie in Z){Y[ie]={};const ae=F.getImageCanvasContext((yield W[ie]).data),fe=(yield Z[ie]).data;for(const pe in fe){const{width:xe,height:Fe,x:Le,y:nt,sdf:Ke,pixelRatio:Re,stretchX:Qe,stretchY:pt,content:bt}=fe[pe];Y[ie][pe]={data:null,pixelRatio:Re,sdf:Ke,stretchX:Qe,stretchY:pt,content:bt,spriteData:{width:xe,height:Fe,x:Le,y:nt,context:ae}}}}return Y})}(R,j)})}(a,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(S=>{if(this._spriteRequest=null,S)for(const U in S){this._spritesImagesIds[U]=[];const H=this._spritesImagesIds[U]?this._spritesImagesIds[U].filter(q=>!(q in S)):[];for(const q of H)this.imageManager.removeImage(q),this._changedImages[q]=!0;for(const q in S[U]){const w=U==="default"?q:`${U}:${q}`;this._spritesImagesIds[U].push(w),w in this.imageManager.images?this.imageManager.updateImage(w,S[U][q],!1):this.imageManager.addImage(w,S[U][q]),d&&(this._changedImages[w]=!0)}}}).catch(S=>{this._spriteRequest=null,B=S,this.fire(new s.j(B))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),_&&_(B)})}_unloadSprite(){for(const a of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(a),this._changedImages[a]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(a){const d=this.sourceCaches[a.source];if(!d)return;const _=a.sourceLayer;if(!_)return;const B=d.getSource();(B.type==="geojson"||B.vectorLayerIds&&B.vectorLayerIds.indexOf(_)===-1)&&this.fire(new s.j(new Error(`Source layer "${_}" does not exist on source "${B.id}" as specified by style layer "${a.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(a){const d=this._serializedAllLayers();if(!a||a.length===0)return Object.values(d);const _=[];for(const B of a)d[B]&&_.push(d[B]);return _}_serializedAllLayers(){let a=this._serializedLayers;if(a)return a;a=this._serializedLayers={};const d=Object.keys(this._layers);for(const _ of d){const B=this._layers[_];B.type!=="custom"&&(a[_]=B.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(a){if(!this._loaded)return;const d=this._changed;if(this._changed){const B=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);(B.length||S.length)&&this._updateWorkerLayers(B,S);for(const U in this._updatedSources){const H=this._updatedSources[U];if(H==="reload")this._reloadSource(U);else{if(H!=="clear")throw new Error(`Invalid action ${H}`);this._clearSource(U)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const U in this._updatedPaintProps)this._layers[U].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}const _={};for(const B in this.sourceCaches){const S=this.sourceCaches[B];_[B]=S.used,S.used=!1}for(const B of this._order){const S=this._layers[B];S.recalculate(a,this._availableImages),!S.isHidden(a.zoom)&&S.source&&(this.sourceCaches[S.source].used=!0)}for(const B in _){const S=this.sourceCaches[B];_[B]!==S.used&&S.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:B}))}this.light.recalculate(a),this.z=a.zoom,d&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(a,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(a),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var _;this._checkLoaded();const B=this.serialize();if(a=d.transformStyle?d.transformStyle(B,a):a,((_=d.validate)===null||_===void 0||_)&&dr(this,s.x(a)))return!1;(a=s.aA(a)).layers=s.ay(a.layers);const S=s.aB(B,a),U=this._getOperationsToPerform(S);if(U.unimplemented.length>0)throw new Error(`Unimplemented: ${U.unimplemented.join(", ")}.`);if(U.operations.length===0)return!1;for(const H of U.operations)H();return this.stylesheet=a,this._serializedLayers=null,!0}_getOperationsToPerform(a){const d=[],_=[];for(const B of a)switch(B.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,B.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,B.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,B.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,B.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,B.args));break;case"addSource":d.push(()=>this.addSource.apply(this,B.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,B.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,B.args));break;case"setLight":d.push(()=>this.setLight.apply(this,B.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,B.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,B.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,B.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,B.args));break;case"setTransition":d.push(()=>{});break;default:_.push(B.command)}return{operations:d,unimplemented:_}}addImage(a,d){if(this.getImage(a))return this.fire(new s.j(new Error(`An image named "${a}" already exists.`)));this.imageManager.addImage(a,d),this._afterImageUpdated(a)}updateImage(a,d){this.imageManager.updateImage(a,d)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){if(!this.getImage(a))return this.fire(new s.j(new Error(`An image named "${a}" does not exist.`)));this.imageManager.removeImage(a),this._afterImageUpdated(a)}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error(`Source "${a}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(s.x.source,`sources.${a}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const B=this.sourceCaches[a]=new Zi(a,d,this.dispatcher);B.style=this,B.setEventedParent(this,()=>({isSourceLoaded:B.loaded(),source:B.serialize(),sourceId:a})),B.onAdd(this.map),this._changed=!0}removeSource(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===a)return this.fire(new s.j(new Error(`Source "${a}" cannot be removed while layer "${_}" is using it.`)));const d=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],d.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,d){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error(`There is no source with this ID=${a}`);const _=this.sourceCaches[a].getSource();if(_.type!=="geojson")throw new Error(`geojsonSource.type is ${_.type}, which is !== 'geojson`);_.setData(d),this._changed=!0}getSource(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()}addLayer(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const B=a.id;if(this.getLayer(B))return void this.fire(new s.j(new Error(`Layer "${B}" already exists on this map.`)));let S;if(a.type==="custom"){if(dr(this,s.aC(a)))return;S=s.az(a)}else{if("source"in a&&typeof a.source=="object"&&(this.addSource(B,a.source),a=s.aA(a),a=s.e(a,{source:B})),this._validate(s.x.layer,`layers.${B}`,a,{arrayIndex:-1},_))return;S=s.az(a),this._validateLayer(S),S.setEventedParent(this,{layer:{id:B}})}const U=d?this._order.indexOf(d):this._order.length;if(d&&U===-1)this.fire(new s.j(new Error(`Cannot add layer "${B}" before non-existing layer "${d}".`)));else{if(this._order.splice(U,0,B),this._layerOrderChanged=!0,this._layers[B]=S,this._removedLayers[B]&&S.source&&S.type!=="custom"){const H=this._removedLayers[B];delete this._removedLayers[B],H.type!==S.type?this._updatedSources[S.source]="clear":(this._updatedSources[S.source]="reload",this.sourceCaches[S.source].pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map)}}moveLayer(a,d){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new s.j(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===d)return;const _=this._order.indexOf(a);this._order.splice(_,1);const B=d?this._order.indexOf(d):this._order.length;d&&B===-1?this.fire(new s.j(new Error(`Cannot move layer "${a}" before non-existing layer "${d}".`))):(this._order.splice(B,0,a),this._layerOrderChanged=!0)}removeLayer(a){this._checkLoaded();const d=this._layers[a];if(!d)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${a}".`)));d.setEventedParent(null);const _=this._order.indexOf(a);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=d,delete this._layers[a],this._serializedLayers&&delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],d.onRemove&&d.onRemove(this.map)}getLayer(a){return this._layers[a]}getLayersOrder(){return[...this._order]}hasLayer(a){return a in this._layers}setLayerZoomRange(a,d,_){this._checkLoaded();const B=this.getLayer(a);B?B.minzoom===d&&B.maxzoom===_||(d!=null&&(B.minzoom=d),_!=null&&(B.maxzoom=_),this._updateLayer(B)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${a}".`)))}setFilter(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const B=this.getLayer(a);if(B){if(!s.aD(B.filter,d))return d==null?(B.filter=void 0,void this._updateLayer(B)):void(this._validate(s.x.filter,`layers.${B.id}.filter`,d,null,_)||(B.filter=s.aA(d),this._updateLayer(B)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${a}".`)))}getFilter(a){return s.aA(this.getLayer(a).filter)}setLayoutProperty(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const S=this.getLayer(a);S?s.aD(S.getLayoutProperty(d),_)||(S.setLayoutProperty(d,_,B),this._updateLayer(S)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${a}".`)))}getLayoutProperty(a,d){const _=this.getLayer(a);if(_)return _.getLayoutProperty(d);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${a}".`)))}setPaintProperty(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const S=this.getLayer(a);S?s.aD(S.getPaintProperty(d),_)||(S.setPaintProperty(d,_,B)&&this._updateLayer(S),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${a}".`)))}getPaintProperty(a,d){return this.getLayer(a).getPaintProperty(d)}setFeatureState(a,d){this._checkLoaded();const _=a.source,B=a.sourceLayer,S=this.sourceCaches[_];if(S===void 0)return void this.fire(new s.j(new Error(`The source '${_}' does not exist in the map's style.`)));const U=S.getSource().type;U==="geojson"&&B?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):U!=="vector"||B?(a.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),S.setFeatureState(B,a.id,d)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(a,d){this._checkLoaded();const _=a.source,B=this.sourceCaches[_];if(B===void 0)return void this.fire(new s.j(new Error(`The source '${_}' does not exist in the map's style.`)));const S=B.getSource().type,U=S==="vector"?a.sourceLayer:void 0;S!=="vector"||U?d&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):B.removeFeatureState(U,a.id,d):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(a){this._checkLoaded();const d=a.source,_=a.sourceLayer,B=this.sourceCaches[d];if(B!==void 0)return B.getSource().type!=="vector"||_?(a.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),B.getFeatureState(_,a.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const a=s.aE(this.sourceCaches,S=>S.serialize()),d=this._serializeByIds(this._order),_=this.map.getTerrain()||void 0,B=this.stylesheet;return s.aF({version:B.version,name:B.name,metadata:B.metadata,light:B.light,center:B.center,zoom:B.zoom,bearing:B.bearing,pitch:B.pitch,sprite:B.sprite,glyphs:B.glyphs,transition:B.transition,sources:a,layers:d,terrain:_},S=>S!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(a){const d=U=>this._layers[U].type==="fill-extrusion",_={},B=[];for(let U=this._order.length-1;U>=0;U--){const H=this._order[U];if(d(H)){_[H]=U;for(const q of a){const w=q[H];if(w)for(const I of w)B.push(I)}}}B.sort((U,H)=>H.intersectionZ-U.intersectionZ);const S=[];for(let U=this._order.length-1;U>=0;U--){const H=this._order[U];if(d(H))for(let q=B.length-1;q>=0;q--){const w=B[q].feature;if(_[w.layer.id]<U)break;S.push(w),B.pop()}else for(const q of a){const w=q[H];if(w)for(const I of w)S.push(I.feature)}}return S}queryRenderedFeatures(a,d,_){d&&d.filter&&this._validate(s.x.filter,"queryRenderedFeatures.filter",d.filter,null,d);const B={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const H of d.layers){const q=this._layers[H];if(!q)return this.fire(new s.j(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];B[q.source]=!0}}const S=[];d.availableImages=this._availableImages;const U=this._serializedAllLayers();for(const H in this.sourceCaches)d.layers&&!B[H]||S.push(gi(this.sourceCaches[H],this._layers,U,a,d,_));return this.placement&&S.push(function(H,q,w,I,R,j,Z){const W={},Y=j.queryRenderedSymbols(I),ie=[];for(const ae of Object.keys(Y).map(Number))ie.push(Z[ae]);ie.sort(mi);for(const ae of ie){const fe=ae.featureIndex.lookupSymbolFeatures(Y[ae.bucketInstanceId],q,ae.bucketIndex,ae.sourceLayerIndex,R.filter,R.layers,R.availableImages,H);for(const pe in fe){const xe=W[pe]=W[pe]||[],Fe=fe[pe];Fe.sort((Le,nt)=>{const Ke=ae.featureSortOrder;if(Ke){const Re=Ke.indexOf(Le.featureIndex);return Ke.indexOf(nt.featureIndex)-Re}return nt.featureIndex-Le.featureIndex});for(const Le of Fe)xe.push(Le)}}for(const ae in W)W[ae].forEach(fe=>{const pe=fe.feature,xe=w[H[ae].source].getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=xe});return W}(this._layers,U,this.sourceCaches,a,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(a,d){d&&d.filter&&this._validate(s.x.filter,"querySourceFeatures.filter",d.filter,null,d);const _=this.sourceCaches[a];return _?function(B,S){const U=B.getRenderableIds().map(w=>B.getTileByID(w)),H=[],q={};for(let w=0;w<U.length;w++){const I=U[w],R=I.tileID.canonical.key;q[R]||(q[R]=!0,I.querySourceFeatures(H,S))}return H}(_,d):[]}getLight(){return this.light.getLight()}setLight(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const _=this.light.getLight();let B=!1;for(const U in a)if(!s.aD(a[U],_[U])){B=!0;break}if(!B)return;const S={now:F.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,d),this.light.updateTransitions(S)}_validate(a,d,_,B){let S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!S||S.validate!==!1)&&dr(this,a.call(s.x,s.e({key:d,style:this.serialize(),value:_,styleSpec:s.v},B)))}_remove(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Nt().off("pluginStateChange",this._rtlTextPluginStateChange);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const _=this.sourceCaches[d];_.setEventedParent(null),_.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(a)}_clearSource(a){this.sourceCaches[a].clearTiles()}_reloadSource(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()}_updateSources(a){for(const d in this.sourceCaches)this.sourceCaches[d].update(a,this.map.terrain)}_generateCollisionBoxes(){for(const a in this.sourceCaches)this._reloadSource(a)}_updatePlacement(a,d,_,B){let S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,U=!1,H=!1;const q={};for(const w of this._order){const I=this._layers[w];if(I.type!=="symbol")continue;if(!q[I.source]){const j=this.sourceCaches[I.source];q[I.source]=j.getRenderableIds(!0).map(Z=>j.getTileByID(Z)).sort((Z,W)=>W.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(W.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(I,q[I.source],a.center.lng);U=U||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((S=S||this._layerOrderChanged||_===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(F.now(),a.zoom))&&(this.pauseablePlacement=new xn(a,this.map.terrain,this._order,S,d,_,B,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,q),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(F.now()),H=!0),U&&this.pauseablePlacement.placement.setStale()),H||U)for(const w of this._order){const I=this._layers[w];I.type==="symbol"&&this.placement.updateLayerOpacities(I,q[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(F.now())}_releaseSymbolFadeTiles(){for(const a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,d){return s._(this,void 0,void 0,function*(){const _=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const B=this.sourceCaches[d.source];return B&&B.setDependencies(d.tileID.key,d.type,d.icons),_})}getGlyphs(a,d){return s._(this,void 0,void 0,function*(){const _=yield this.glyphManager.getGlyphs(d.stacks),B=this.sourceCaches[d.source];return B&&B.setDependencies(d.tileID.key,d.type,[""]),_})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),a&&this._validate(s.x.glyphs,"glyphs",a,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=a,this.glyphManager.entries={},this.glyphManager.setURL(a))}addSprite(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},B=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const S=[{id:a,url:d}],U=[...De(this.stylesheet.sprite),...S];this._validate(s.x.sprite,"sprite",U,null,_)||(this.stylesheet.sprite=U,this._loadSprite(S,!0,B))}removeSprite(a){this._checkLoaded();const d=De(this.stylesheet.sprite);if(d.find(_=>_.id===a)){if(this._spritesImagesIds[a])for(const _ of this._spritesImagesIds[a])this.imageManager.removeImage(_),this._changedImages[_]=!0;d.splice(d.findIndex(_=>_.id===a),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[a],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${a}" doesn't exists on this map.`)))}getSprite(){return De(this.stylesheet.sprite)}setSprite(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),a&&this._validate(s.x.sprite,"sprite",a,null,d)||(this.stylesheet.sprite=a,a?this._loadSprite(a,!0,_):(this._unloadSprite(),_&&_(null)))}}var Or=s.X([{name:"a_pos",type:"Int16",components:2}]),Cn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const An={prelude:Hr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Hr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Hr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Hr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Hr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Hr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Hr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Hr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Hr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Hr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Hr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Hr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Hr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Hr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Hr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Hr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Hr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Hr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Hr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Hr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Hr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Hr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Hr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Hr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Hr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Hr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Hr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Cn),terrainDepth:Hr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Cn),terrainCoords:Hr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Cn)};function Hr(y,a){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=a.match(/attribute ([\w]+) ([\w]+)/g),B=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),U=S?S.concat(B):B,H={};return{fragmentSource:y=y.replace(d,(q,w,I,R,j)=>(H[j]=!0,w==="define"?`
#ifndef HAS_UNIFORM_u_${j}
varying ${I} ${R} ${j};
#else
uniform ${I} ${R} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${I} ${R} ${j} = u_${j};
#endif
`)),vertexSource:a=a.replace(d,(q,w,I,R,j)=>{const Z=R==="float"?"vec2":"vec4",W=j.match(/color/)?"color":Z;return H[j]?w==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${I} ${Z} a_${j};
varying ${I} ${R} ${j};
#else
uniform ${I} ${R} u_${j};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${I} ${R} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);
#else
    ${I} ${R} ${j} = u_${j};
#endif
`:w==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${I} ${Z} a_${j};
#else
uniform ${I} ${R} u_${j};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${I} ${R} ${j} = a_${j};
#else
    ${I} ${R} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${I} ${R} ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);
#else
    ${I} ${R} ${j} = u_${j};
#endif
`}),staticAttributes:_,staticUniforms:U}}class Gs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,d,_,B,S,U,H,q,w){this.context=a;let I=this.boundPaintVertexBuffers.length!==B.length;for(let R=0;!I&&R<B.length;R++)this.boundPaintVertexBuffers[R]!==B[R]&&(I=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==_||I||this.boundIndexBuffer!==S||this.boundVertexOffset!==U||this.boundDynamicVertexBuffer!==H||this.boundDynamicVertexBuffer2!==q||this.boundDynamicVertexBuffer3!==w?this.freshBind(d,_,B,S,U,H,q,w):(a.bindVertexArray.set(this.vao),H&&H.bind(),S&&S.dynamicDraw&&S.bind(),q&&q.bind(),w&&w.bind())}freshBind(a,d,_,B,S,U,H,q){const w=a.numAttributes,I=this.context,R=I.gl;this.vao&&this.destroy(),this.vao=I.createVertexArray(),I.bindVertexArray.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=B,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=U,this.boundDynamicVertexBuffer2=H,this.boundDynamicVertexBuffer3=q,d.enableAttributes(R,a);for(const j of _)j.enableAttributes(R,a);U&&U.enableAttributes(R,a),H&&H.enableAttributes(R,a),q&&q.enableAttributes(R,a),d.bind(),d.setVertexAttribPointers(R,a,S);for(const j of _)j.bind(),j.setVertexAttribPointers(R,a,S);U&&(U.bind(),U.setVertexAttribPointers(R,a,S)),B&&B.bind(),H&&(H.bind(),H.setVertexAttribPointers(R,a,S)),q&&(q.bind(),q.setVertexAttribPointers(R,a,S)),I.currentNumAttributes=w}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ca(y){const a=[];for(let d=0;d<y.length;d++){if(y[d]===null)continue;const _=y[d].split(" ");a.push(_.pop())}return a}class uo{constructor(a,d,_,B,S,U){const H=a.gl;this.program=H.createProgram();const q=ca(d.staticAttributes),w=_?_.getBinderAttributes():[],I=q.concat(w),R=An.prelude.staticUniforms?ca(An.prelude.staticUniforms):[],j=d.staticUniforms?ca(d.staticUniforms):[],Z=_?_.getBinderUniforms():[],W=R.concat(j).concat(Z),Y=[];for(const Le of W)Y.indexOf(Le)<0&&Y.push(Le);const ie=_?_.defines():[];S&&ie.push("#define OVERDRAW_INSPECTOR;"),U&&ie.push("#define TERRAIN3D;");const ae=ie.concat(An.prelude.fragmentSource,d.fragmentSource).join(`
`),fe=ie.concat(An.prelude.vertexSource,d.vertexSource).join(`
`),pe=H.createShader(H.FRAGMENT_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(pe,ae),H.compileShader(pe),!H.getShaderParameter(pe,H.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${H.getShaderInfoLog(pe)}`);H.attachShader(this.program,pe);const xe=H.createShader(H.VERTEX_SHADER);if(H.isContextLost())return void(this.failedToCreate=!0);if(H.shaderSource(xe,fe),H.compileShader(xe),!H.getShaderParameter(xe,H.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${H.getShaderInfoLog(xe)}`);H.attachShader(this.program,xe),this.attributes={};const Fe={};this.numAttributes=I.length;for(let Le=0;Le<this.numAttributes;Le++)I[Le]&&(H.bindAttribLocation(this.program,Le,I[Le]),this.attributes[I[Le]]=Le);if(H.linkProgram(this.program),!H.getProgramParameter(this.program,H.LINK_STATUS))throw new Error(`Program failed to link: ${H.getProgramInfoLog(this.program)}`);H.deleteShader(xe),H.deleteShader(pe);for(let Le=0;Le<Y.length;Le++){const nt=Y[Le];if(nt&&!Fe[nt]){const Ke=H.getUniformLocation(this.program,nt);Ke&&(Fe[nt]=Ke)}}this.fixedUniforms=B(a,Fe),this.terrainUniforms=((Le,nt)=>({u_depth:new s.aG(Le,nt.u_depth),u_terrain:new s.aG(Le,nt.u_terrain),u_terrain_dim:new s.aH(Le,nt.u_terrain_dim),u_terrain_matrix:new s.aI(Le,nt.u_terrain_matrix),u_terrain_unpack:new s.aJ(Le,nt.u_terrain_unpack),u_terrain_exaggeration:new s.aH(Le,nt.u_terrain_exaggeration)}))(a,Fe),this.binderUniforms=_?_.getUniforms(a,Fe):[]}draw(a,d,_,B,S,U,H,q,w,I,R,j,Z,W,Y,ie,ae,fe){const pe=a.gl;if(this.failedToCreate)return;if(a.program.set(this.program),a.setDepthMode(_),a.setStencilMode(B),a.setColorMode(S),a.setCullFace(U),q){a.activeTexture.set(pe.TEXTURE2),pe.bindTexture(pe.TEXTURE_2D,q.depthTexture),a.activeTexture.set(pe.TEXTURE3),pe.bindTexture(pe.TEXTURE_2D,q.texture);for(const Fe in this.terrainUniforms)this.terrainUniforms[Fe].set(q[Fe])}for(const Fe in this.fixedUniforms)this.fixedUniforms[Fe].set(H[Fe]);Y&&Y.setUniforms(a,this.binderUniforms,Z,{zoom:W});let xe=0;switch(d){case pe.LINES:xe=2;break;case pe.TRIANGLES:xe=3;break;case pe.LINE_STRIP:xe=1}for(const Fe of j.get()){const Le=Fe.vaos||(Fe.vaos={});(Le[w]||(Le[w]=new Gs)).bind(a,this,I,Y?Y.getPaintVertexBuffers():[],R,Fe.vertexOffset,ie,ae,fe),pe.drawElements(d,Fe.primitiveLength*xe,pe.UNSIGNED_SHORT,Fe.primitiveOffset*xe*2)}}}function Ea(y,a,d){const _=1/qt(d,1,a.transform.tileZoom),B=Math.pow(2,d.tileID.overscaledZ),S=d.tileSize*Math.pow(2,a.transform.tileZoom)/B,U=S*(d.tileID.canonical.x+d.tileID.wrap*B),H=S*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[_,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[U>>16,H>>16],u_pixel_coord_lower:[65535&U,65535&H]}}const Ne=(y,a,d,_)=>{const B=a.style.light,S=B.properties.get("position"),U=[S.x,S.y,S.z],H=function(){var w=new s.A(9);return s.A!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[5]=0,w[6]=0,w[7]=0),w[0]=1,w[4]=1,w[8]=1,w}();B.properties.get("anchor")==="viewport"&&function(w,I){var R=Math.sin(I),j=Math.cos(I);w[0]=j,w[1]=R,w[2]=0,w[3]=-R,w[4]=j,w[5]=0,w[6]=0,w[7]=0,w[8]=1}(H,-a.transform.angle),function(w,I,R){var j=I[0],Z=I[1],W=I[2];w[0]=j*R[0]+Z*R[3]+W*R[6],w[1]=j*R[1]+Z*R[4]+W*R[7],w[2]=j*R[2]+Z*R[5]+W*R[8]}(U,U,H);const q=B.properties.get("color");return{u_matrix:y,u_lightpos:U,u_lightintensity:B.properties.get("intensity"),u_lightcolor:[q.r,q.g,q.b],u_vertical_gradient:+d,u_opacity:_}},Je=(y,a,d,_,B,S,U)=>s.e(Ne(y,a,d,_),Ea(S,a,U),{u_height_factor:-Math.pow(2,B.overscaledZ)/U.tileSize/8}),dt=y=>({u_matrix:y}),Ot=(y,a,d,_)=>s.e(dt(y),Ea(d,a,_)),ui=(y,a)=>({u_matrix:y,u_world:a}),Gi=(y,a,d,_,B)=>s.e(Ot(y,a,d,_),{u_world:B}),br=(y,a,d,_)=>{const B=y.transform;let S,U;if(_.paint.get("circle-pitch-alignment")==="map"){const H=qt(d,1,B.zoom);S=!0,U=[H,H]}else S=!1,U=B.pixelsToGLUnits;return{u_camera_to_center_distance:B.cameraToCenterDistance,u_scale_with_map:+(_.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(a.posMatrix,d,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:U}},En=(y,a,d)=>{const _=qt(d,1,a.zoom),B=Math.pow(2,a.zoom-d.tileID.overscaledZ),S=d.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:a.cameraToCenterDistance,u_pixels_to_tile_units:_,u_extrude_scale:[a.pixelsToGLUnits[0]/(_*B),a.pixelsToGLUnits[1]/(_*B)],u_overscale_factor:S}},On=function(y,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:y,u_color:a,u_overlay:0,u_overlay_scale:d}},rs=y=>({u_matrix:y}),wn=(y,a,d,_)=>({u_matrix:y,u_extrude_scale:qt(a,1,d),u_intensity:_});function au(y,a){const d=Math.pow(2,a.canonical.z),_=a.canonical.y;return[new s.Y(0,_/d).toLngLat().lat,new s.Y(0,(_+1)/d).toLngLat().lat]}const $a=(y,a,d,_)=>{const B=y.transform;return{u_matrix:To(y,a,d,_),u_ratio:1/qt(a,1,B.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/B.pixelsToGLUnits[0],1/B.pixelsToGLUnits[1]]}},Tr=(y,a,d,_,B)=>s.e($a(y,a,d,B),{u_image:0,u_image_height:_}),Ka=(y,a,d,_,B)=>{const S=y.transform,U=Yn(a,S);return{u_matrix:To(y,a,d,B),u_texsize:a.imageAtlasTexture.size,u_ratio:1/qt(a,1,S.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[U,_.fromScale,_.toScale],u_fade:_.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Ul=(y,a,d,_,B,S)=>{const U=y.lineAtlas,H=Yn(a,y.transform),q=d.layout.get("line-cap")==="round",w=U.getDash(_.from,q),I=U.getDash(_.to,q),R=w.width*B.fromScale,j=I.width*B.toScale;return s.e($a(y,a,d,S),{u_patternscale_a:[H/R,-w.height/2],u_patternscale_b:[H/j,-I.height/2],u_sdfgamma:U.width/(256*Math.min(R,j)*y.pixelRatio)/2,u_image:0,u_tex_y_a:w.y,u_tex_y_b:I.y,u_mix:B.t})};function Yn(y,a){return 1/qt(y,1,a.tileZoom)}function To(y,a,d,_){return y.translatePosMatrix(_?_.posMatrix:a.tileID.posMatrix,a,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Wa=(y,a,d,_,B)=>{return{u_matrix:y,u_tl_parent:a,u_scale_parent:d,u_buffer_scale:1,u_fade_t:_.mix,u_opacity:_.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:(U=B.paint.get("raster-saturation"),U>0?1-1/(1.001-U):-U),u_contrast_factor:(S=B.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:ms(B.paint.get("raster-hue-rotate"))};var S,U};function ms(y){y*=Math.PI/180;const a=Math.sin(y),d=Math.cos(y);return[(2*d+1)/3,(-Math.sqrt(3)*a-d+1)/3,(Math.sqrt(3)*a-d+1)/3]}const ua=(y,a,d,_,B,S,U,H,q,w)=>{const I=B.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:I.cameraToCenterDistance,u_pitch:I.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:I.width/I.height,u_fade_change:B.options.fadeDuration?B.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:U,u_coord_matrix:H,u_is_text:+q,u_pitch_with_map:+_,u_texsize:w,u_texture:0}},Xa=(y,a,d,_,B,S,U,H,q,w,I)=>{const R=B.transform;return s.e(ua(y,a,d,_,B,S,U,H,q,w),{u_gamma_scale:_?Math.cos(R._pitch)*R.cameraToCenterDistance:1,u_device_pixel_ratio:B.pixelRatio,u_is_halo:+I})},Sa=(y,a,d,_,B,S,U,H,q,w)=>s.e(Xa(y,a,d,_,B,S,U,H,!0,q,!0),{u_texsize_icon:w,u_texture_icon:1}),Fc=(y,a,d)=>({u_matrix:y,u_opacity:a,u_color:d}),Za=(y,a,d,_,B,S)=>s.e(function(U,H,q,w){const I=q.imageManager.getPattern(U.from.toString()),R=q.imageManager.getPattern(U.to.toString()),{width:j,height:Z}=q.imageManager.getPixelSize(),W=Math.pow(2,w.tileID.overscaledZ),Y=w.tileSize*Math.pow(2,q.transform.tileZoom)/W,ie=Y*(w.tileID.canonical.x+w.tileID.wrap*W),ae=Y*w.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:I.tl,u_pattern_br_a:I.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[j,Z],u_mix:H.t,u_pattern_size_a:I.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:H.fromScale,u_scale_b:H.toScale,u_tile_units_to_pixels:1/qt(w,1,q.transform.tileZoom),u_pixel_coord_upper:[ie>>16,ae>>16],u_pixel_coord_lower:[65535&ie,65535&ae]}}(_,S,d,B),{u_matrix:y,u_opacity:a}),ho={fillExtrusion:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_lightpos:new s.aK(y,a.u_lightpos),u_lightintensity:new s.aH(y,a.u_lightintensity),u_lightcolor:new s.aK(y,a.u_lightcolor),u_vertical_gradient:new s.aH(y,a.u_vertical_gradient),u_opacity:new s.aH(y,a.u_opacity)}),fillExtrusionPattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_lightpos:new s.aK(y,a.u_lightpos),u_lightintensity:new s.aH(y,a.u_lightintensity),u_lightcolor:new s.aK(y,a.u_lightcolor),u_vertical_gradient:new s.aH(y,a.u_vertical_gradient),u_height_factor:new s.aH(y,a.u_height_factor),u_image:new s.aG(y,a.u_image),u_texsize:new s.aL(y,a.u_texsize),u_pixel_coord_upper:new s.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(y,a.u_pixel_coord_lower),u_scale:new s.aK(y,a.u_scale),u_fade:new s.aH(y,a.u_fade),u_opacity:new s.aH(y,a.u_opacity)}),fill:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix)}),fillPattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_image:new s.aG(y,a.u_image),u_texsize:new s.aL(y,a.u_texsize),u_pixel_coord_upper:new s.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(y,a.u_pixel_coord_lower),u_scale:new s.aK(y,a.u_scale),u_fade:new s.aH(y,a.u_fade)}),fillOutline:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_world:new s.aL(y,a.u_world)}),fillOutlinePattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_world:new s.aL(y,a.u_world),u_image:new s.aG(y,a.u_image),u_texsize:new s.aL(y,a.u_texsize),u_pixel_coord_upper:new s.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(y,a.u_pixel_coord_lower),u_scale:new s.aK(y,a.u_scale),u_fade:new s.aH(y,a.u_fade)}),circle:(y,a)=>({u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_scale_with_map:new s.aG(y,a.u_scale_with_map),u_pitch_with_map:new s.aG(y,a.u_pitch_with_map),u_extrude_scale:new s.aL(y,a.u_extrude_scale),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_matrix:new s.aI(y,a.u_matrix)}),collisionBox:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aH(y,a.u_pixels_to_tile_units),u_extrude_scale:new s.aL(y,a.u_extrude_scale),u_overscale_factor:new s.aH(y,a.u_overscale_factor)}),collisionCircle:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_inv_matrix:new s.aI(y,a.u_inv_matrix),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_viewport_size:new s.aL(y,a.u_viewport_size)}),debug:(y,a)=>({u_color:new s.aM(y,a.u_color),u_matrix:new s.aI(y,a.u_matrix),u_overlay:new s.aG(y,a.u_overlay),u_overlay_scale:new s.aH(y,a.u_overlay_scale)}),clippingMask:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix)}),heatmap:(y,a)=>({u_extrude_scale:new s.aH(y,a.u_extrude_scale),u_intensity:new s.aH(y,a.u_intensity),u_matrix:new s.aI(y,a.u_matrix)}),heatmapTexture:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_world:new s.aL(y,a.u_world),u_image:new s.aG(y,a.u_image),u_color_ramp:new s.aG(y,a.u_color_ramp),u_opacity:new s.aH(y,a.u_opacity)}),hillshade:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_image:new s.aG(y,a.u_image),u_latrange:new s.aL(y,a.u_latrange),u_light:new s.aL(y,a.u_light),u_shadow:new s.aM(y,a.u_shadow),u_highlight:new s.aM(y,a.u_highlight),u_accent:new s.aM(y,a.u_accent)}),hillshadePrepare:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_image:new s.aG(y,a.u_image),u_dimension:new s.aL(y,a.u_dimension),u_zoom:new s.aH(y,a.u_zoom),u_unpack:new s.aJ(y,a.u_unpack)}),line:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_ratio:new s.aH(y,a.u_ratio),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_units_to_pixels:new s.aL(y,a.u_units_to_pixels)}),lineGradient:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_ratio:new s.aH(y,a.u_ratio),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_units_to_pixels:new s.aL(y,a.u_units_to_pixels),u_image:new s.aG(y,a.u_image),u_image_height:new s.aH(y,a.u_image_height)}),linePattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_texsize:new s.aL(y,a.u_texsize),u_ratio:new s.aH(y,a.u_ratio),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_image:new s.aG(y,a.u_image),u_units_to_pixels:new s.aL(y,a.u_units_to_pixels),u_scale:new s.aK(y,a.u_scale),u_fade:new s.aH(y,a.u_fade)}),lineSDF:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_ratio:new s.aH(y,a.u_ratio),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_units_to_pixels:new s.aL(y,a.u_units_to_pixels),u_patternscale_a:new s.aL(y,a.u_patternscale_a),u_patternscale_b:new s.aL(y,a.u_patternscale_b),u_sdfgamma:new s.aH(y,a.u_sdfgamma),u_image:new s.aG(y,a.u_image),u_tex_y_a:new s.aH(y,a.u_tex_y_a),u_tex_y_b:new s.aH(y,a.u_tex_y_b),u_mix:new s.aH(y,a.u_mix)}),raster:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_tl_parent:new s.aL(y,a.u_tl_parent),u_scale_parent:new s.aH(y,a.u_scale_parent),u_buffer_scale:new s.aH(y,a.u_buffer_scale),u_fade_t:new s.aH(y,a.u_fade_t),u_opacity:new s.aH(y,a.u_opacity),u_image0:new s.aG(y,a.u_image0),u_image1:new s.aG(y,a.u_image1),u_brightness_low:new s.aH(y,a.u_brightness_low),u_brightness_high:new s.aH(y,a.u_brightness_high),u_saturation_factor:new s.aH(y,a.u_saturation_factor),u_contrast_factor:new s.aH(y,a.u_contrast_factor),u_spin_weights:new s.aK(y,a.u_spin_weights)}),symbolIcon:(y,a)=>({u_is_size_zoom_constant:new s.aG(y,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(y,a.u_is_size_feature_constant),u_size_t:new s.aH(y,a.u_size_t),u_size:new s.aH(y,a.u_size),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_pitch:new s.aH(y,a.u_pitch),u_rotate_symbol:new s.aG(y,a.u_rotate_symbol),u_aspect_ratio:new s.aH(y,a.u_aspect_ratio),u_fade_change:new s.aH(y,a.u_fade_change),u_matrix:new s.aI(y,a.u_matrix),u_label_plane_matrix:new s.aI(y,a.u_label_plane_matrix),u_coord_matrix:new s.aI(y,a.u_coord_matrix),u_is_text:new s.aG(y,a.u_is_text),u_pitch_with_map:new s.aG(y,a.u_pitch_with_map),u_texsize:new s.aL(y,a.u_texsize),u_texture:new s.aG(y,a.u_texture)}),symbolSDF:(y,a)=>({u_is_size_zoom_constant:new s.aG(y,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(y,a.u_is_size_feature_constant),u_size_t:new s.aH(y,a.u_size_t),u_size:new s.aH(y,a.u_size),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_pitch:new s.aH(y,a.u_pitch),u_rotate_symbol:new s.aG(y,a.u_rotate_symbol),u_aspect_ratio:new s.aH(y,a.u_aspect_ratio),u_fade_change:new s.aH(y,a.u_fade_change),u_matrix:new s.aI(y,a.u_matrix),u_label_plane_matrix:new s.aI(y,a.u_label_plane_matrix),u_coord_matrix:new s.aI(y,a.u_coord_matrix),u_is_text:new s.aG(y,a.u_is_text),u_pitch_with_map:new s.aG(y,a.u_pitch_with_map),u_texsize:new s.aL(y,a.u_texsize),u_texture:new s.aG(y,a.u_texture),u_gamma_scale:new s.aH(y,a.u_gamma_scale),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_is_halo:new s.aG(y,a.u_is_halo)}),symbolTextAndIcon:(y,a)=>({u_is_size_zoom_constant:new s.aG(y,a.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(y,a.u_is_size_feature_constant),u_size_t:new s.aH(y,a.u_size_t),u_size:new s.aH(y,a.u_size),u_camera_to_center_distance:new s.aH(y,a.u_camera_to_center_distance),u_pitch:new s.aH(y,a.u_pitch),u_rotate_symbol:new s.aG(y,a.u_rotate_symbol),u_aspect_ratio:new s.aH(y,a.u_aspect_ratio),u_fade_change:new s.aH(y,a.u_fade_change),u_matrix:new s.aI(y,a.u_matrix),u_label_plane_matrix:new s.aI(y,a.u_label_plane_matrix),u_coord_matrix:new s.aI(y,a.u_coord_matrix),u_is_text:new s.aG(y,a.u_is_text),u_pitch_with_map:new s.aG(y,a.u_pitch_with_map),u_texsize:new s.aL(y,a.u_texsize),u_texsize_icon:new s.aL(y,a.u_texsize_icon),u_texture:new s.aG(y,a.u_texture),u_texture_icon:new s.aG(y,a.u_texture_icon),u_gamma_scale:new s.aH(y,a.u_gamma_scale),u_device_pixel_ratio:new s.aH(y,a.u_device_pixel_ratio),u_is_halo:new s.aG(y,a.u_is_halo)}),background:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_opacity:new s.aH(y,a.u_opacity),u_color:new s.aM(y,a.u_color)}),backgroundPattern:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_opacity:new s.aH(y,a.u_opacity),u_image:new s.aG(y,a.u_image),u_pattern_tl_a:new s.aL(y,a.u_pattern_tl_a),u_pattern_br_a:new s.aL(y,a.u_pattern_br_a),u_pattern_tl_b:new s.aL(y,a.u_pattern_tl_b),u_pattern_br_b:new s.aL(y,a.u_pattern_br_b),u_texsize:new s.aL(y,a.u_texsize),u_mix:new s.aH(y,a.u_mix),u_pattern_size_a:new s.aL(y,a.u_pattern_size_a),u_pattern_size_b:new s.aL(y,a.u_pattern_size_b),u_scale_a:new s.aH(y,a.u_scale_a),u_scale_b:new s.aH(y,a.u_scale_b),u_pixel_coord_upper:new s.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(y,a.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aH(y,a.u_tile_units_to_pixels)}),terrain:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_texture:new s.aG(y,a.u_texture),u_ele_delta:new s.aH(y,a.u_ele_delta)}),terrainDepth:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_ele_delta:new s.aH(y,a.u_ele_delta)}),terrainCoords:(y,a)=>({u_matrix:new s.aI(y,a.u_matrix),u_texture:new s.aG(y,a.u_texture),u_terrain_coords_id:new s.aH(y,a.u_terrain_coords_id),u_ele_delta:new s.aH(y,a.u_ele_delta)})};class Pr{constructor(a,d,_){this.context=a;const B=a.gl;this.buffer=B.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),B.bufferData(B.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?B.DYNAMIC_DRAW:B.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ha={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class hs{constructor(a,d,_,B){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=B,this.context=a;const S=a.gl;this.buffer=S.createBuffer(),a.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){if(a.length!==this.length)throw new Error(`Length of new data is ${a.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,d){for(let _=0;_<this.attributes.length;_++){const B=d.attributes[this.attributes[_].name];B!==void 0&&a.enableVertexAttribArray(B)}}setVertexAttribPointers(a,d,_){for(let B=0;B<this.attributes.length;B++){const S=this.attributes[B],U=d.attributes[S.name];U!==void 0&&a.vertexAttribPointer(U,S.components,a[ha[S.type]],!1,this.itemSize,S.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const dn=new WeakMap;function ns(y){var a;if(dn.has(y))return dn.get(y);{const d=(a=y.getParameter(y.VERSION))===null||a===void 0?void 0:a.startsWith("WebGL 2.0");return dn.set(y,d),d}}class Vr{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ja extends Vr{getDefault(){return s.aO.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class cl extends Vr{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Nl extends Vr{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Io extends Vr{getDefault(){return[!0,!0,!0,!0]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Ko extends Vr{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class dc extends Vr{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Wo extends Vr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const d=this.current;(a.func!==d.func||a.ref!==d.ref||a.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Ao extends Vr{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class fc extends Vr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=a,this.dirty=!1}}class Xo extends Vr{getDefault(){return[0,1]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class zl extends Vr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=a,this.dirty=!1}}class Dc extends Vr{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class vh extends Vr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.BLEND):d.disable(d.BLEND),this.current=a,this.dirty=!1}}class lu extends Vr{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class cu extends Vr{getDefault(){return s.aO.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Ru extends Vr{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Ql extends Vr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=a,this.dirty=!1}}class Ya extends Vr{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class el extends Vr{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class Vl extends Vr{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class tl extends Vr{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class Aa extends Vr{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class ul extends Vr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Hl extends Vr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class eo extends Vr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class da extends Vr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class ne extends Vr{getDefault(){return null}set(a){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Ie extends Vr{getDefault(){return null}set(a){var d;if(a===this.current&&!this.dirty)return;const _=this.gl;ns(_)?_.bindVertexArray(a):(d=_.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(a),this.current=a,this.dirty=!1}}class lt extends Vr{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class mt extends Vr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class vt extends Vr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Tt extends Vr{constructor(a,d){super(a),this.context=a,this.parent=d}getDefault(){return null}}class pi extends Tt{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class ri extends Tt{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class rr extends Tt{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class qi{constructor(a,d,_,B,S){this.context=a,this.width=d,this.height=_;const U=a.gl,H=this.framebuffer=U.createFramebuffer();if(this.colorAttachment=new pi(a,H),B)this.depthAttachment=S?new rr(a,H):new ri(a,H);else if(S)throw new Error("Stencil cannot be set without depth");if(U.checkFramebufferStatus(U.FRAMEBUFFER)!==U.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const a=this.context.gl,d=this.colorAttachment.get();if(d&&a.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&a.deleteRenderbuffer(_)}a.deleteFramebuffer(this.framebuffer)}}class ki{constructor(a,d,_){this.blendFunction=a,this.blendColor=d,this.mask=_}}ki.Replace=[1,0],ki.disabled=new ki(ki.Replace,s.aO.transparent,[!1,!1,!1,!1]),ki.unblended=new ki(ki.Replace,s.aO.transparent,[!0,!0,!0,!0]),ki.alphaBlended=new ki([1,771],s.aO.transparent,[!0,!0,!0,!0]);class jr{constructor(a){var d,_;if(this.gl=a,this.clearColor=new Ja(this),this.clearDepth=new cl(this),this.clearStencil=new Nl(this),this.colorMask=new Io(this),this.depthMask=new Ko(this),this.stencilMask=new dc(this),this.stencilFunc=new Wo(this),this.stencilOp=new Ao(this),this.stencilTest=new fc(this),this.depthRange=new Xo(this),this.depthTest=new zl(this),this.depthFunc=new Dc(this),this.blend=new vh(this),this.blendFunc=new lu(this),this.blendColor=new cu(this),this.blendEquation=new Ru(this),this.cullFace=new Ql(this),this.cullFaceSide=new Ya(this),this.frontFace=new el(this),this.program=new Vl(this),this.activeTexture=new tl(this),this.viewport=new Aa(this),this.bindFramebuffer=new ul(this),this.bindRenderbuffer=new Hl(this),this.bindTexture=new eo(this),this.bindVertexBuffer=new da(this),this.bindElementBuffer=new ne(this),this.bindVertexArray=new Ie(this),this.pixelStoreUnpack=new lt(this),this.pixelStoreUnpackPremultiplyAlpha=new mt(this),this.pixelStoreUnpackFlipY=new vt(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),ns(a)){this.HALF_FLOAT=a.HALF_FLOAT;const B=a.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=a.RGBA16F)!==null&&d!==void 0?d:B==null?void 0:B.RGBA16F_EXT,this.RGB16F=(_=a.RGB16F)!==null&&_!==void 0?_:B==null?void 0:B.RGB16F_EXT,a.getExtension("EXT_color_buffer_float")}else{a.getExtension("EXT_color_buffer_half_float"),a.getExtension("OES_texture_half_float_linear");const B=a.getExtension("OES_texture_half_float");this.HALF_FLOAT=B==null?void 0:B.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,d){return new Pr(this,a,d)}createVertexBuffer(a,d,_){return new hs(this,a,d,_)}createRenderbuffer(a,d,_){const B=this.gl,S=B.createRenderbuffer();return this.bindRenderbuffer.set(S),B.renderbufferStorage(B.RENDERBUFFER,a,d,_),this.bindRenderbuffer.set(null),S}createFramebuffer(a,d,_,B){return new qi(this,a,d,_,B)}clear(a){let{color:d,depth:_,stencil:B}=a;const S=this.gl;let U=0;d&&(U|=S.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),_!==void 0&&(U|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(_),this.depthMask.set(!0)),B!==void 0&&(U|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(B),this.stencilMask.set(255)),S.clear(U)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){s.aD(a.blendFunction,ki.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}createVertexArray(){var a;return ns(this.gl)?this.gl.createVertexArray():(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.createVertexArrayOES()}deleteVertexArray(a){var d;return ns(this.gl)?this.gl.deleteVertexArray(a):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(a)}unbindVAO(){this.bindVertexArray.set(null)}}class nr{constructor(a,d,_){this.func=a,this.mask=d,this.range=_}}nr.ReadOnly=!1,nr.ReadWrite=!0,nr.disabled=new nr(519,nr.ReadOnly,[0,1]);const Gn=7680;class Br{constructor(a,d,_,B,S,U){this.test=a,this.ref=d,this.mask=_,this.fail=B,this.depthFail=S,this.pass=U}}Br.disabled=new Br({func:519,mask:0},0,0,Gn,Gn,Gn);class Lr{constructor(a,d,_){this.enable=a,this.mode=d,this.frontFace=_}}let Un;function $s(y,a,d,_,B,S,U){const H=y.context,q=H.gl,w=y.useProgram("collisionBox"),I=[];let R=0,j=0;for(let pe=0;pe<_.length;pe++){const xe=_[pe],Fe=a.getTile(xe),Le=Fe.getBucket(d);if(!Le)continue;let nt=xe.posMatrix;B[0]===0&&B[1]===0||(nt=y.translatePosMatrix(xe.posMatrix,Fe,B,S));const Ke=U?Le.textCollisionBox:Le.iconCollisionBox,Re=Le.collisionCircleArray;if(Re.length>0){const Qe=s.F(),pt=nt;s.aP(Qe,Le.placementInvProjMatrix,y.transform.glCoordMatrix),s.aP(Qe,Qe,Le.placementViewportMatrix),I.push({circleArray:Re,circleOffset:j,transform:pt,invTransform:Qe,coord:xe}),R+=Re.length/4,j=R}Ke&&w.draw(H,q.LINES,nr.disabled,Br.disabled,y.colorModeForRenderPass(),Lr.disabled,En(nt,y.transform,Fe),y.style.map.terrain&&y.style.map.terrain.getTerrainData(xe),d.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,null,y.transform.zoom,null,null,Ke.collisionVertexBuffer)}if(!U||!I.length)return;const Z=y.useProgram("collisionCircle"),W=new s.aQ;W.resize(4*R),W._trim();let Y=0;for(const pe of I)for(let xe=0;xe<pe.circleArray.length/4;xe++){const Fe=4*xe,Le=pe.circleArray[Fe+0],nt=pe.circleArray[Fe+1],Ke=pe.circleArray[Fe+2],Re=pe.circleArray[Fe+3];W.emplace(Y++,Le,nt,Ke,Re,0),W.emplace(Y++,Le,nt,Ke,Re,1),W.emplace(Y++,Le,nt,Ke,Re,2),W.emplace(Y++,Le,nt,Ke,Re,3)}(!Un||Un.length<2*R)&&(Un=function(pe){const xe=2*pe,Fe=new s.aS;Fe.resize(xe),Fe._trim();for(let Le=0;Le<xe;Le++){const nt=6*Le;Fe.uint16[nt+0]=4*Le+0,Fe.uint16[nt+1]=4*Le+1,Fe.uint16[nt+2]=4*Le+2,Fe.uint16[nt+3]=4*Le+2,Fe.uint16[nt+4]=4*Le+3,Fe.uint16[nt+5]=4*Le+0}return Fe}(R));const ie=H.createIndexBuffer(Un,!0),ae=H.createVertexBuffer(W,s.aR.members,!0);for(const pe of I){const xe={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(fe=y.transform).cameraToCenterDistance,u_viewport_size:[fe.width,fe.height]};Z.draw(H,q.TRIANGLES,nr.disabled,Br.disabled,y.colorModeForRenderPass(),Lr.disabled,xe,y.style.map.terrain&&y.style.map.terrain.getTerrainData(pe.coord),d.id,ae,ie,s.$.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,y.transform.zoom,null,null,null)}var fe;ae.destroy(),ie.destroy()}Lr.disabled=new Lr(!1,1029,2305),Lr.backCCW=new Lr(!0,1029,2305);const to=s.an(new Float32Array(16));function Lo(y,a,d,_,B,S){const{horizontalAlign:U,verticalAlign:H}=s.at(y);return new s.P((-(U-.5)*a/B+_[0])*S,(-(H-.5)*d/B+_[1])*S)}function Ta(y,a,d,_,B,S,U,H,q,w,I){const R=y.text.placedSymbolArray,j=y.text.dynamicLayoutVertexArray,Z=y.icon.dynamicLayoutVertexArray,W={};j.clear();for(let Y=0;Y<R.length;Y++){const ie=R.get(Y),ae=ie.hidden||!ie.crossTileID||y.allowVerticalPlacement&&!ie.placedOrientation?null:_[ie.crossTileID];if(ae){const fe=new s.P(ie.anchorX,ie.anchorY),pe=Sr(fe,d?U:S,I),xe=ze(B.cameraToCenterDistance,pe.signedDistanceFromCamera);let Fe=s.ai(y.textSizeData,q,ie)*xe/s.ao;d&&(Fe*=y.tilePixelRatio/H);const{width:Le,height:nt,anchor:Ke,textOffset:Re,textBoxScale:Qe}=ae,pt=Lo(Ke,Le,nt,Re,Qe,Fe),bt=d?Sr(fe.add(pt),S,I).point:pe.point.add(a?pt.rotate(-B.angle):pt),ht=y.allowVerticalPlacement&&ie.placedOrientation===s.ah.vertical?Math.PI/2:0;for(let Rt=0;Rt<ie.numGlyphs;Rt++)s.aj(j,bt,ht);w&&ie.associatedIconIndex>=0&&(W[ie.associatedIconIndex]={shiftedAnchor:bt,angle:ht})}else rt(ie.numGlyphs,j)}if(w){Z.clear();const Y=y.icon.placedSymbolArray;for(let ie=0;ie<Y.length;ie++){const ae=Y.get(ie);if(ae.hidden)rt(ae.numGlyphs,Z);else{const fe=W[ie];if(fe)for(let pe=0;pe<ae.numGlyphs;pe++)s.aj(Z,fe.shiftedAnchor,fe.angle);else rt(ae.numGlyphs,Z)}}y.icon.dynamicLayoutVertexBuffer.updateData(Z)}y.text.dynamicLayoutVertexBuffer.updateData(j)}function fa(y,a,d){return d.iconsInText&&a?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function Gl(y,a,d,_,B,S,U,H,q,w,I,R){const j=y.context,Z=j.gl,W=y.transform,Y=H==="map",ie=q==="map",ae=H!=="viewport"&&d.layout.get("symbol-placement")!=="point",fe=Y&&!ie&&!ae,pe=!d.layout.get("symbol-sort-key").isConstant();let xe=!1;const Fe=y.depthModeForSublayer(0,nr.ReadOnly),Le=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),nt=[];for(const Ke of _){const Re=a.getTile(Ke),Qe=Re.getBucket(d);if(!Qe)continue;const pt=B?Qe.text:Qe.icon;if(!pt||!pt.segments.get().length||!pt.hasVisibleVertices)continue;const bt=pt.programConfigurations.get(d.id),ht=B||Qe.sdfIcons,Rt=B?Qe.textSizeData:Qe.iconSizeData,Dt=ie||W.pitch!==0,hi=y.useProgram(fa(ht,B,Qe),bt),Vt=s.ag(Rt,W.zoom),_i=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ke);let Si,Yi,Ti,yr,fr=[0,0],ji=null;if(B)Yi=Re.glyphAtlasTexture,Ti=Z.LINEAR,Si=Re.glyphAtlasTexture.size,Qe.iconsInText&&(fr=Re.imageAtlasTexture.size,ji=Re.imageAtlasTexture,yr=Dt||y.options.rotating||y.options.zooming||Rt.kind==="composite"||Rt.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const qr=d.layout.get("icon-size").constantOr(0)!==1||Qe.iconsNeedLinear;Yi=Re.imageAtlasTexture,Ti=ht||y.options.rotating||y.options.zooming||qr||Dt?Z.LINEAR:Z.NEAREST,Si=Re.imageAtlasTexture.size}const Ur=qt(Re,1,y.transform.zoom),rn=Jt(Ke.posMatrix,ie,Y,y.transform,Ur),Mr=mr(Ke.posMatrix,ie,Y,y.transform,Ur),Kr=Le&&Qe.hasTextData(),Cr=d.layout.get("icon-text-fit")!=="none"&&Kr&&Qe.hasIconData();if(ae){const qr=y.style.map.terrain?(Mn,Kn)=>y.style.map.terrain.getElevation(Ke,Mn,Kn):null,Wr=d.layout.get("text-rotation-alignment")==="map";oe(Qe,Ke.posMatrix,y,B,rn,Mr,ie,w,Wr,qr)}const ts=y.translatePosMatrix(Ke.posMatrix,Re,S,U),Nr=ae||B&&Le||Cr?to:rn,pr=y.translatePosMatrix(Mr,Re,S,U,!0),_r=ht&&d.paint.get(B?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let or;or=ht?Qe.iconsInText?Sa(Rt.kind,Vt,fe,ie,y,ts,Nr,pr,Si,fr):Xa(Rt.kind,Vt,fe,ie,y,ts,Nr,pr,B,Si,!0):ua(Rt.kind,Vt,fe,ie,y,ts,Nr,pr,B,Si);const ln={program:hi,buffers:pt,uniformValues:or,atlasTexture:Yi,atlasTextureIcon:ji,atlasInterpolation:Ti,atlasInterpolationIcon:yr,isSDF:ht,hasHalo:_r};if(pe&&Qe.canOverlap){xe=!0;const qr=pt.segments.get();for(const Wr of qr)nt.push({segments:new s.$([Wr]),sortKey:Wr.sortKey,state:ln,terrainData:_i})}else nt.push({segments:pt.segments,sortKey:0,state:ln,terrainData:_i})}xe&&nt.sort((Ke,Re)=>Ke.sortKey-Re.sortKey);for(const Ke of nt){const Re=Ke.state;if(j.activeTexture.set(Z.TEXTURE0),Re.atlasTexture.bind(Re.atlasInterpolation,Z.CLAMP_TO_EDGE),Re.atlasTextureIcon&&(j.activeTexture.set(Z.TEXTURE1),Re.atlasTextureIcon&&Re.atlasTextureIcon.bind(Re.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Re.isSDF){const Qe=Re.uniformValues;Re.hasHalo&&(Qe.u_is_halo=1,hl(Re.buffers,Ke.segments,d,y,Re.program,Fe,I,R,Qe,Ke.terrainData)),Qe.u_is_halo=0}hl(Re.buffers,Ke.segments,d,y,Re.program,Fe,I,R,Re.uniformValues,Ke.terrainData)}}function hl(y,a,d,_,B,S,U,H,q,w){const I=_.context;B.draw(I,I.gl.TRIANGLES,S,U,H,Lr.disabled,q,w,d.id,y.layoutVertexBuffer,y.indexBuffer,a,d.paint,_.transform.zoom,y.programConfigurations.get(d.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function jl(y,a,d,_,B){if(!d||!_||!_.imageAtlas)return;const S=_.imageAtlas.patternPositions;let U=S[d.to.toString()],H=S[d.from.toString()];if(!U&&H&&(U=H),!H&&U&&(H=U),!U||!H){const q=B.getPaintProperty(a);U=S[q],H=S[q]}U&&H&&y.setConstantPatternPositions(U,H)}function pc(y,a,d,_,B,S,U){const H=y.context.gl,q="fill-pattern",w=d.paint.get(q),I=w&&w.constantOr(1),R=d.getCrossfadeParameters();let j,Z,W,Y,ie;U?(Z=I&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=H.LINES):(Z=I?"fillPattern":"fill",j=H.TRIANGLES);const ae=w.constantOr(null);for(const fe of _){const pe=a.getTile(fe);if(I&&!pe.patternsLoaded())continue;const xe=pe.getBucket(d);if(!xe)continue;const Fe=xe.programConfigurations.get(d.id),Le=y.useProgram(Z,Fe),nt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(fe);I&&(y.context.activeTexture.set(H.TEXTURE0),pe.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Fe.updatePaintBuffers(R)),jl(Fe,q,ae,pe,d);const Ke=nt?fe:null,Re=y.translatePosMatrix(Ke?Ke.posMatrix:fe.posMatrix,pe,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(U){Y=xe.indexBuffer2,ie=xe.segments2;const Qe=[H.drawingBufferWidth,H.drawingBufferHeight];W=Z==="fillOutlinePattern"&&I?Gi(Re,y,R,pe,Qe):ui(Re,Qe)}else Y=xe.indexBuffer,ie=xe.segments,W=I?Ot(Re,y,R,pe):dt(Re);Le.draw(y.context,j,B,y.stencilModeForClipping(fe),S,Lr.disabled,W,nt,d.id,xe.layoutVertexBuffer,Y,ie,d.paint,y.transform.zoom,Fe)}}function pa(y,a,d,_,B,S,U){const H=y.context,q=H.gl,w="fill-extrusion-pattern",I=d.paint.get(w),R=I.constantOr(1),j=d.getCrossfadeParameters(),Z=d.paint.get("fill-extrusion-opacity"),W=I.constantOr(null);for(const Y of _){const ie=a.getTile(Y),ae=ie.getBucket(d);if(!ae)continue;const fe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Y),pe=ae.programConfigurations.get(d.id),xe=y.useProgram(R?"fillExtrusionPattern":"fillExtrusion",pe);R&&(y.context.activeTexture.set(q.TEXTURE0),ie.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),pe.updatePaintBuffers(j)),jl(pe,w,W,ie,d);const Fe=y.translatePosMatrix(Y.posMatrix,ie,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Le=d.paint.get("fill-extrusion-vertical-gradient"),nt=R?Je(Fe,y,Le,Z,Y,j,ie):Ne(Fe,y,Le,Z);xe.draw(H,H.gl.TRIANGLES,B,S,U,Lr.backCCW,nt,fe,d.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,d.paint,y.transform.zoom,pe,y.style.map.terrain&&ae.centroidVertexBuffer)}}function Fs(y,a,d,_,B,S,U){const H=y.context,q=H.gl,w=d.fbo;if(!w)return;const I=y.useProgram("hillshade"),R=y.style.map.terrain&&y.style.map.terrain.getTerrainData(a);H.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,w.colorAttachment.get()),I.draw(H,q.TRIANGLES,B,S,U,Lr.disabled,((j,Z,W,Y)=>{const ie=W.paint.get("hillshade-shadow-color"),ae=W.paint.get("hillshade-highlight-color"),fe=W.paint.get("hillshade-accent-color");let pe=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(pe-=j.transform.angle);const xe=!j.options.moving;return{u_matrix:Y?Y.posMatrix:j.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),xe),u_image:0,u_latrange:au(0,Z.tileID),u_light:[W.paint.get("hillshade-exaggeration"),pe],u_shadow:ie,u_highlight:ae,u_accent:fe}})(y,d,_,R?a:null),R,_.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function Al(y,a,d,_,B,S){const U=y.context,H=U.gl,q=a.dem;if(q&&q.data){const w=q.dim,I=q.stride,R=q.getPixels();if(U.activeTexture.set(H.TEXTURE1),U.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||y.getTileTexture(I),a.demTexture){const Z=a.demTexture;Z.update(R,{premultiply:!1}),Z.bind(H.NEAREST,H.CLAMP_TO_EDGE)}else a.demTexture=new Me(U,R,H.RGBA,{premultiply:!1}),a.demTexture.bind(H.NEAREST,H.CLAMP_TO_EDGE);U.activeTexture.set(H.TEXTURE0);let j=a.fbo;if(!j){const Z=new Me(U,{width:w,height:w,data:null},H.RGBA);Z.bind(H.LINEAR,H.CLAMP_TO_EDGE),j=a.fbo=U.createFramebuffer(w,w,!0,!1),j.colorAttachment.set(Z.texture)}U.bindFramebuffer.set(j.framebuffer),U.viewport.set([0,0,w,w]),y.useProgram("hillshadePrepare").draw(U,H.TRIANGLES,_,B,S,Lr.disabled,((Z,W)=>{const Y=W.stride,ie=s.F();return s.aN(ie,0,s.W,-s.W,0,0,1),s.H(ie,ie,[0,-s.W,0]),{u_matrix:ie,u_image:1,u_dimension:[Y,Y],u_zoom:Z.overscaledZ,u_unpack:W.getUnpackVector()}})(a.tileID,q),null,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),a.needsHillshadePrepare=!1}}function ql(y,a,d,_,B,S){const U=_.paint.get("raster-fade-duration");if(!S&&U>0){const H=F.now(),q=(H-y.timeAdded)/U,w=a?(H-a.timeAdded)/U:-1,I=d.getSource(),R=B.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),j=!a||Math.abs(a.tileID.overscaledZ-R)>Math.abs(y.tileID.overscaledZ-R),Z=j&&y.refreshedUponExpiration?1:s.ac(j?q:1-w,0,1);return y.refreshedUponExpiration&&q>=1&&(y.refreshedUponExpiration=!1),a?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const Ia=new s.aO(1,0,0,1),La=new s.aO(0,1,0,1),Ds=new s.aO(0,0,1,1),ku=new s.aO(1,0,1,1),Sn=new s.aO(0,1,1,1);function on(y,a,d,_){es(y,0,a+d/2,y.transform.width,d,_)}function fn(y,a,d,_){es(y,a-d/2,0,d,y.transform.height,_)}function es(y,a,d,_,B,S){const U=y.context,H=U.gl;H.enable(H.SCISSOR_TEST),H.scissor(a*y.pixelRatio,d*y.pixelRatio,_*y.pixelRatio,B*y.pixelRatio),U.clear({color:S}),H.disable(H.SCISSOR_TEST)}function dl(y,a,d){const _=y.context,B=_.gl,S=d.posMatrix,U=y.useProgram("debug"),H=nr.disabled,q=Br.disabled,w=y.colorModeForRenderPass(),I="$debug",R=y.style.map.terrain&&y.style.map.terrain.getTerrainData(d);_.activeTexture.set(B.TEXTURE0);const j=a.getTileByID(d.key).latestRawTileData,Z=Math.floor((j&&j.byteLength||0)/1024),W=a.getTile(d).tileSize,Y=512/Math.min(W,512)*(d.overscaledZ/y.transform.zoom)*.5;let ie=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ie+=` => ${d.overscaledZ}`),function(ae,fe){ae.initDebugOverlayCanvas();const pe=ae.debugOverlayCanvas,xe=ae.context.gl,Fe=ae.debugOverlayCanvas.getContext("2d");Fe.clearRect(0,0,pe.width,pe.height),Fe.shadowColor="white",Fe.shadowBlur=2,Fe.lineWidth=1.5,Fe.strokeStyle="white",Fe.textBaseline="top",Fe.font="bold 36px Open Sans, sans-serif",Fe.fillText(fe,5,5),Fe.strokeText(fe,5,5),ae.debugOverlayTexture.update(pe),ae.debugOverlayTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE)}(y,`${ie} ${Z}kB`),U.draw(_,B.TRIANGLES,H,q,ki.alphaBlended,Lr.disabled,On(S,s.aO.transparent,Y),null,I,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),U.draw(_,B.LINE_STRIP,H,q,w,Lr.disabled,On(S,s.aO.red),R,I,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function fl(y,a,d){const _=y.context,B=_.gl,S=y.colorModeForRenderPass(),U=new nr(B.LEQUAL,nr.ReadWrite,y.depthRangeFor3D),H=y.useProgram("terrain"),q=a.getTerrainMesh();_.bindFramebuffer.set(null),_.viewport.set([0,0,y.width,y.height]);for(const w of d){const I=y.renderToTexture.getTexture(w),R=a.getTerrainData(w.tileID);_.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,I.texture);const j={u_matrix:y.transform.calculatePosMatrix(w.tileID.toUnwrapped()),u_texture:0,u_ele_delta:a.getMeshFrameDelta(y.transform.zoom)};H.draw(_,B.TRIANGLES,U,Br.disabled,S,Lr.backCCW,j,R,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}}class fo{constructor(a,d){this.context=new jr(a),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.F(),renderTime:0},this.setup(),this.numSublayers=Zi.maxUnderzooming+Zi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Bs}resize(a,d,_){if(this.width=Math.floor(a*_),this.height=Math.floor(d*_),this.pixelRatio=_,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const B of this.style._order)this.style._layers[B].resize()}setup(){const a=this.context,d=new s.aV;d.emplaceBack(0,0),d.emplaceBack(s.W,0),d.emplaceBack(0,s.W),d.emplaceBack(s.W,s.W),this.tileExtentBuffer=a.createVertexBuffer(d,Or.members),this.tileExtentSegments=s.$.simpleSegment(0,0,4,2);const _=new s.aV;_.emplaceBack(0,0),_.emplaceBack(s.W,0),_.emplaceBack(0,s.W),_.emplaceBack(s.W,s.W),this.debugBuffer=a.createVertexBuffer(_,Or.members),this.debugSegments=s.$.simpleSegment(0,0,4,5);const B=new s.Z;B.emplaceBack(0,0,0,0),B.emplaceBack(s.W,0,s.W,0),B.emplaceBack(0,s.W,0,s.W),B.emplaceBack(s.W,s.W,s.W,s.W),this.rasterBoundsBuffer=a.createVertexBuffer(B,jt.members),this.rasterBoundsSegments=s.$.simpleSegment(0,0,4,2);const S=new s.aV;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(S,Or.members),this.viewportSegments=s.$.simpleSegment(0,0,4,2);const U=new s.aW;U.emplaceBack(0),U.emplaceBack(1),U.emplaceBack(3),U.emplaceBack(2),U.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(U);const H=new s.aX;H.emplaceBack(0,1,2),H.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(H);const q=this.context.gl;this.stencilClearMode=new Br({func:q.ALWAYS,mask:0},0,255,q.ZERO,q.ZERO,q.ZERO)}clearStencil(){const a=this.context,d=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const _=s.F();s.aN(_,0,this.width,this.height,0,0,1),s.J(_,_,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(a,d.TRIANGLES,nr.disabled,this.stencilClearMode,ki.disabled,Lr.disabled,rs(_),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(a,d){if(this.currentStencilSource===a.source||!a.isTileClipped()||!d||!d.length)return;this.currentStencilSource=a.source;const _=this.context,B=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(ki.disabled),_.setDepthMode(nr.disabled);const S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const U of d){const H=this._tileClippingMaskIDs[U.key]=this.nextStencilID++,q=this.style.map.terrain&&this.style.map.terrain.getTerrainData(U);S.draw(_,B.TRIANGLES,nr.disabled,new Br({func:B.ALWAYS,mask:0},H,255,B.KEEP,B.KEEP,B.REPLACE),ki.disabled,Lr.disabled,rs(U.posMatrix),q,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,d=this.context.gl;return new Br({func:d.NOTEQUAL,mask:255},a,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(a){const d=this.context.gl;return new Br({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(a){const d=this.context.gl,_=a.sort((U,H)=>H.overscaledZ-U.overscaledZ),B=_[_.length-1].overscaledZ,S=_[0].overscaledZ-B+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const U={};for(let H=0;H<S;H++)U[H+B]=new Br({func:d.GEQUAL,mask:255},H+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=S,[U,_]}return[{[B]:Br.disabled},_]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new ki([a.CONSTANT_COLOR,a.ONE],new s.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ki.unblended:ki.alphaBlended}depthModeForSublayer(a,d,_){if(!this.opaquePassEnabledForLayer())return nr.disabled;const B=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new nr(_||this.context.gl.LEQUAL,d,[B,B])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,d){this.style=a,this.options=d,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(F.now()),this.imageManager.beginFrame();const _=this.style._order,B=this.style.sourceCaches,S={},U={},H={};for(const q in B){const w=B[q];w.used&&w.prepare(this.context),S[q]=w.getVisibleCoordinates(),U[q]=S[q].slice().reverse(),H[q]=w.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let q=0;q<_.length;q++)if(this.style._layers[_[q]].is3D()){this.opaquePassCutoff=q;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const q=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.aY(this.terrainFacilitator.matrix,this.transform.projMatrix)||q.length)&&(s.aZ(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(w,I){const R=w.context,j=R.gl,Z=ki.unblended,W=new nr(j.LEQUAL,nr.ReadWrite,[0,1]),Y=I.getTerrainMesh(),ie=I.sourceCache.getRenderableTiles(),ae=w.useProgram("terrainDepth");R.bindFramebuffer.set(I.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),R.clear({color:s.aO.transparent,depth:1});for(const fe of ie){const pe=I.getTerrainData(fe.tileID),xe={u_matrix:w.transform.calculatePosMatrix(fe.tileID.toUnwrapped()),u_ele_delta:I.getMeshFrameDelta(w.transform.zoom)};ae.draw(R,j.TRIANGLES,W,Br.disabled,Z,Lr.backCCW,xe,pe,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain),function(w,I){const R=w.context,j=R.gl,Z=ki.unblended,W=new nr(j.LEQUAL,nr.ReadWrite,[0,1]),Y=I.getTerrainMesh(),ie=I.getCoordsTexture(),ae=I.sourceCache.getRenderableTiles(),fe=w.useProgram("terrainCoords");R.bindFramebuffer.set(I.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),R.clear({color:s.aO.transparent,depth:1}),I.coordsIndex=[];for(const pe of ae){const xe=I.getTerrainData(pe.tileID);R.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,ie.texture);const Fe={u_matrix:w.transform.calculatePosMatrix(pe.tileID.toUnwrapped()),u_terrain_coords_id:(255-I.coordsIndex.length)/255,u_texture:0,u_ele_delta:I.getMeshFrameDelta(w.transform.zoom)};fe.draw(R,j.TRIANGLES,W,Br.disabled,Z,Lr.backCCW,Fe,xe,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments),I.coordsIndex.push(pe.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const q of _){const w=this.style._layers[q];if(!w.hasOffscreenPass()||w.isHidden(this.transform.zoom))continue;const I=U[w.source];(w.type==="custom"||I.length)&&this.renderLayer(this,B[w.source],w,I)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?s.aO.black:s.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const q=this.style._layers[_[this.currentLayer]],w=B[q.source],I=S[q.source];this._renderTileClippingMasks(q,I),this.renderLayer(this,w,q,I)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const q=this.style._layers[_[this.currentLayer]],w=B[q.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(q))continue;const I=(q.type==="symbol"?H:U)[q.source];this._renderTileClippingMasks(q,S[q.source]),this.renderLayer(this,w,q,I)}if(this.options.showTileBoundaries){const q=function(w,I){let R=null;const j=Object.values(w._layers).flatMap(ie=>ie.source&&!ie.isHidden(I)?[w.sourceCaches[ie.source]]:[]),Z=j.filter(ie=>ie.getSource().type==="vector"),W=j.filter(ie=>ie.getSource().type!=="vector"),Y=ie=>{(!R||R.getSource().maxzoom<ie.getSource().maxzoom)&&(R=ie)};return Z.forEach(ie=>Y(ie)),R||W.forEach(ie=>Y(ie)),R}(this.style,this.transform.zoom);q&&function(w,I,R){for(let j=0;j<R.length;j++)dl(w,I,R[j])}(this,q,q.getVisibleCoordinates())}this.options.showPadding&&function(q){const w=q.transform.padding;on(q,q.transform.height-(w.top||0),3,Ia),on(q,w.bottom||0,3,La),fn(q,w.left||0,3,Ds),fn(q,q.transform.width-(w.right||0),3,ku);const I=q.transform.centerPoint;(function(R,j,Z,W){es(R,j-1,Z-10,2,20,W),es(R,j-10,Z-1,20,2,W)})(q,I.x,q.transform.height-I.y,Sn)}(this),this.context.setDefault()}renderLayer(a,d,_,B){if(!_.isHidden(this.transform.zoom)&&(_.type==="background"||_.type==="custom"||(B||[]).length))switch(this.id=_.id,_.type){case"symbol":(function(S,U,H,q,w){if(S.renderPass!=="translucent")return;const I=Br.disabled,R=S.colorModeForRenderPass();(H._unevaluatedLayout.hasValue("text-variable-anchor")||H._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(j,Z,W,Y,ie,ae,fe){const pe=Z.transform,xe=ie==="map",Fe=ae==="map";for(const Le of j){const nt=Y.getTile(Le),Ke=nt.getBucket(W);if(!Ke||!Ke.text||!Ke.text.segments.get().length)continue;const Re=s.ag(Ke.textSizeData,pe.zoom),Qe=qt(nt,1,Z.transform.zoom),pt=Jt(Le.posMatrix,Fe,xe,Z.transform,Qe),bt=W.layout.get("icon-text-fit")!=="none"&&Ke.hasIconData();if(Re){const ht=Math.pow(2,pe.zoom-nt.tileID.overscaledZ);Ta(Ke,xe,Fe,fe,pe,pt,Le.posMatrix,ht,Re,bt,Z.style.map.terrain?(Rt,Dt)=>Z.style.map.terrain.getElevation(Le,Rt,Dt):null)}}}(q,S,H,U,H.layout.get("text-rotation-alignment"),H.layout.get("text-pitch-alignment"),w),H.paint.get("icon-opacity").constantOr(1)!==0&&Gl(S,U,H,q,!1,H.paint.get("icon-translate"),H.paint.get("icon-translate-anchor"),H.layout.get("icon-rotation-alignment"),H.layout.get("icon-pitch-alignment"),H.layout.get("icon-keep-upright"),I,R),H.paint.get("text-opacity").constantOr(1)!==0&&Gl(S,U,H,q,!0,H.paint.get("text-translate"),H.paint.get("text-translate-anchor"),H.layout.get("text-rotation-alignment"),H.layout.get("text-pitch-alignment"),H.layout.get("text-keep-upright"),I,R),U.map.showCollisionBoxes&&($s(S,U,H,q,H.paint.get("text-translate"),H.paint.get("text-translate-anchor"),!0),$s(S,U,H,q,H.paint.get("icon-translate"),H.paint.get("icon-translate-anchor"),!1))})(a,d,_,B,this.style.placement.variableOffsets);break;case"circle":(function(S,U,H,q){if(S.renderPass!=="translucent")return;const w=H.paint.get("circle-opacity"),I=H.paint.get("circle-stroke-width"),R=H.paint.get("circle-stroke-opacity"),j=!H.layout.get("circle-sort-key").isConstant();if(w.constantOr(1)===0&&(I.constantOr(1)===0||R.constantOr(1)===0))return;const Z=S.context,W=Z.gl,Y=S.depthModeForSublayer(0,nr.ReadOnly),ie=Br.disabled,ae=S.colorModeForRenderPass(),fe=[];for(let pe=0;pe<q.length;pe++){const xe=q[pe],Fe=U.getTile(xe),Le=Fe.getBucket(H);if(!Le)continue;const nt=Le.programConfigurations.get(H.id),Ke=S.useProgram("circle",nt),Re=Le.layoutVertexBuffer,Qe=Le.indexBuffer,pt=S.style.map.terrain&&S.style.map.terrain.getTerrainData(xe),bt={programConfiguration:nt,program:Ke,layoutVertexBuffer:Re,indexBuffer:Qe,uniformValues:br(S,xe,Fe,H),terrainData:pt};if(j){const ht=Le.segments.get();for(const Rt of ht)fe.push({segments:new s.$([Rt]),sortKey:Rt.sortKey,state:bt})}else fe.push({segments:Le.segments,sortKey:0,state:bt})}j&&fe.sort((pe,xe)=>pe.sortKey-xe.sortKey);for(const pe of fe){const{programConfiguration:xe,program:Fe,layoutVertexBuffer:Le,indexBuffer:nt,uniformValues:Ke,terrainData:Re}=pe.state;Fe.draw(Z,W.TRIANGLES,Y,ie,ae,Lr.disabled,Ke,Re,H.id,Le,nt,pe.segments,H.paint,S.transform.zoom,xe)}})(a,d,_,B);break;case"heatmap":(function(S,U,H,q){if(H.paint.get("heatmap-opacity")!==0)if(S.renderPass==="offscreen"){const w=S.context,I=w.gl,R=Br.disabled,j=new ki([I.ONE,I.ONE],s.aO.transparent,[!0,!0,!0,!0]);(function(Z,W,Y){const ie=Z.gl;Z.activeTexture.set(ie.TEXTURE1),Z.viewport.set([0,0,W.width/4,W.height/4]);let ae=Y.heatmapFbo;if(ae)ie.bindTexture(ie.TEXTURE_2D,ae.colorAttachment.get()),Z.bindFramebuffer.set(ae.framebuffer);else{const fe=ie.createTexture();ie.bindTexture(ie.TEXTURE_2D,fe),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_2D,ie.TEXTURE_MAG_FILTER,ie.LINEAR),ae=Y.heatmapFbo=Z.createFramebuffer(W.width/4,W.height/4,!1,!1),function(pe,xe,Fe,Le){var nt,Ke;const Re=pe.gl,Qe=(nt=pe.HALF_FLOAT)!==null&&nt!==void 0?nt:Re.UNSIGNED_BYTE,pt=(Ke=pe.RGBA16F)!==null&&Ke!==void 0?Ke:Re.RGBA;Re.texImage2D(Re.TEXTURE_2D,0,pt,xe.width/4,xe.height/4,0,Re.RGBA,Qe,null),Le.colorAttachment.set(Fe)}(Z,W,fe,ae)}})(w,S,H),w.clear({color:s.aO.transparent});for(let Z=0;Z<q.length;Z++){const W=q[Z];if(U.hasRenderableParent(W))continue;const Y=U.getTile(W),ie=Y.getBucket(H);if(!ie)continue;const ae=ie.programConfigurations.get(H.id),fe=S.useProgram("heatmap",ae),{zoom:pe}=S.transform;fe.draw(w,I.TRIANGLES,nr.disabled,R,j,Lr.disabled,wn(W.posMatrix,Y,pe,H.paint.get("heatmap-intensity")),null,H.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,H.paint,S.transform.zoom,ae)}w.viewport.set([0,0,S.width,S.height])}else S.renderPass==="translucent"&&(S.context.setColorMode(S.colorModeForRenderPass()),function(w,I){const R=w.context,j=R.gl,Z=I.heatmapFbo;if(!Z)return;R.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,Z.colorAttachment.get()),R.activeTexture.set(j.TEXTURE1);let W=I.colorRampTexture;W||(W=I.colorRampTexture=new Me(R,I.colorRamp,j.RGBA)),W.bind(j.LINEAR,j.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(R,j.TRIANGLES,nr.disabled,Br.disabled,w.colorModeForRenderPass(),Lr.disabled,((Y,ie,ae,fe)=>{const pe=s.F();s.aN(pe,0,Y.width,Y.height,0,0,1);const xe=Y.context.gl;return{u_matrix:pe,u_world:[xe.drawingBufferWidth,xe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ie.paint.get("heatmap-opacity")}})(w,I),null,I.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,I.paint,w.transform.zoom)}(S,H))})(a,d,_,B);break;case"line":(function(S,U,H,q){if(S.renderPass!=="translucent")return;const w=H.paint.get("line-opacity"),I=H.paint.get("line-width");if(w.constantOr(1)===0||I.constantOr(1)===0)return;const R=S.depthModeForSublayer(0,nr.ReadOnly),j=S.colorModeForRenderPass(),Z=H.paint.get("line-dasharray"),W=H.paint.get("line-pattern"),Y=W.constantOr(1),ie=H.paint.get("line-gradient"),ae=H.getCrossfadeParameters(),fe=Y?"linePattern":Z?"lineSDF":ie?"lineGradient":"line",pe=S.context,xe=pe.gl;let Fe=!0;for(const Le of q){const nt=U.getTile(Le);if(Y&&!nt.patternsLoaded())continue;const Ke=nt.getBucket(H);if(!Ke)continue;const Re=Ke.programConfigurations.get(H.id),Qe=S.context.program.get(),pt=S.useProgram(fe,Re),bt=Fe||pt.program!==Qe,ht=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Le),Rt=W.constantOr(null);if(Rt&&nt.imageAtlas){const Vt=nt.imageAtlas,_i=Vt.patternPositions[Rt.to.toString()],Si=Vt.patternPositions[Rt.from.toString()];_i&&Si&&Re.setConstantPatternPositions(_i,Si)}const Dt=ht?Le:null,hi=Y?Ka(S,nt,H,ae,Dt):Z?Ul(S,nt,H,Z,ae,Dt):ie?Tr(S,nt,H,Ke.lineClipsArray.length,Dt):$a(S,nt,H,Dt);if(Y)pe.activeTexture.set(xe.TEXTURE0),nt.imageAtlasTexture.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Re.updatePaintBuffers(ae);else if(Z&&(bt||S.lineAtlas.dirty))pe.activeTexture.set(xe.TEXTURE0),S.lineAtlas.bind(pe);else if(ie){const Vt=Ke.gradients[H.id];let _i=Vt.texture;if(H.gradientVersion!==Vt.version){let Si=256;if(H.stepInterpolant){const Yi=U.getSource().maxzoom,Ti=Le.canonical.z===Yi?Math.ceil(1<<S.transform.maxZoom-Le.canonical.z):1;Si=s.ac(s.aT(Ke.maxLineLength/s.W*1024*Ti),256,pe.maxTextureSize)}Vt.gradient=s.aU({expression:H.gradientExpression(),evaluationKey:"lineProgress",resolution:Si,image:Vt.gradient||void 0,clips:Ke.lineClipsArray}),Vt.texture?Vt.texture.update(Vt.gradient):Vt.texture=new Me(pe,Vt.gradient,xe.RGBA),Vt.version=H.gradientVersion,_i=Vt.texture}pe.activeTexture.set(xe.TEXTURE0),_i.bind(H.stepInterpolant?xe.NEAREST:xe.LINEAR,xe.CLAMP_TO_EDGE)}pt.draw(pe,xe.TRIANGLES,R,S.stencilModeForClipping(Le),j,Lr.disabled,hi,ht,H.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,H.paint,S.transform.zoom,Re,Ke.layoutVertexBuffer2),Fe=!1}})(a,d,_,B);break;case"fill":(function(S,U,H,q){const w=H.paint.get("fill-color"),I=H.paint.get("fill-opacity");if(I.constantOr(1)===0)return;const R=S.colorModeForRenderPass(),j=H.paint.get("fill-pattern"),Z=S.opaquePassEnabledForLayer()&&!j.constantOr(1)&&w.constantOr(s.aO.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(S.renderPass===Z){const W=S.depthModeForSublayer(1,S.renderPass==="opaque"?nr.ReadWrite:nr.ReadOnly);pc(S,U,H,q,W,R,!1)}if(S.renderPass==="translucent"&&H.paint.get("fill-antialias")){const W=S.depthModeForSublayer(H.getPaintProperty("fill-outline-color")?2:0,nr.ReadOnly);pc(S,U,H,q,W,R,!0)}})(a,d,_,B);break;case"fill-extrusion":(function(S,U,H,q){const w=H.paint.get("fill-extrusion-opacity");if(w!==0&&S.renderPass==="translucent"){const I=new nr(S.context.gl.LEQUAL,nr.ReadWrite,S.depthRangeFor3D);if(w!==1||H.paint.get("fill-extrusion-pattern").constantOr(1))pa(S,U,H,q,I,Br.disabled,ki.disabled),pa(S,U,H,q,I,S.stencilModeFor3D(),S.colorModeForRenderPass());else{const R=S.colorModeForRenderPass();pa(S,U,H,q,I,Br.disabled,R)}}})(a,d,_,B);break;case"hillshade":(function(S,U,H,q){if(S.renderPass!=="offscreen"&&S.renderPass!=="translucent")return;const w=S.context,I=S.depthModeForSublayer(0,nr.ReadOnly),R=S.colorModeForRenderPass(),[j,Z]=S.renderPass==="translucent"?S.stencilConfigForOverlap(q):[{},q];for(const W of Z){const Y=U.getTile(W);Y.needsHillshadePrepare!==void 0&&Y.needsHillshadePrepare&&S.renderPass==="offscreen"?Al(S,Y,H,I,Br.disabled,R):S.renderPass==="translucent"&&Fs(S,W,Y,H,I,j[W.overscaledZ],R)}w.viewport.set([0,0,S.width,S.height])})(a,d,_,B);break;case"raster":(function(S,U,H,q){if(S.renderPass!=="translucent"||H.paint.get("raster-opacity")===0||!q.length)return;const w=S.context,I=w.gl,R=U.getSource(),j=S.useProgram("raster"),Z=S.colorModeForRenderPass(),[W,Y]=R instanceof ni?[{},q]:S.stencilConfigForOverlap(q),ie=Y[Y.length-1].overscaledZ,ae=!S.options.moving;for(const fe of Y){const pe=S.depthModeForSublayer(fe.overscaledZ-ie,H.paint.get("raster-opacity")===1?nr.ReadWrite:nr.ReadOnly,I.LESS),xe=U.getTile(fe);xe.registerFadeDuration(H.paint.get("raster-fade-duration"));const Fe=U.findLoadedParent(fe,0),Le=ql(xe,Fe,U,H,S.transform,S.style.map.terrain);let nt,Ke;const Re=H.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;w.activeTexture.set(I.TEXTURE0),xe.texture.bind(Re,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),w.activeTexture.set(I.TEXTURE1),Fe?(Fe.texture.bind(Re,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),nt=Math.pow(2,Fe.tileID.overscaledZ-xe.tileID.overscaledZ),Ke=[xe.tileID.canonical.x*nt%1,xe.tileID.canonical.y*nt%1]):xe.texture.bind(Re,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const Qe=S.style.map.terrain&&S.style.map.terrain.getTerrainData(fe),pt=Qe?fe:null,bt=pt?pt.posMatrix:S.transform.calculatePosMatrix(fe.toUnwrapped(),ae),ht=Wa(bt,Ke||[0,0],nt||1,Le,H);R instanceof ni?j.draw(w,I.TRIANGLES,pe,Br.disabled,Z,Lr.disabled,ht,Qe,H.id,R.boundsBuffer,S.quadTriangleIndexBuffer,R.boundsSegments):j.draw(w,I.TRIANGLES,pe,W[fe.overscaledZ],Z,Lr.disabled,ht,Qe,H.id,S.rasterBoundsBuffer,S.quadTriangleIndexBuffer,S.rasterBoundsSegments)}})(a,d,_,B);break;case"background":(function(S,U,H,q){const w=H.paint.get("background-color"),I=H.paint.get("background-opacity");if(I===0)return;const R=S.context,j=R.gl,Z=S.transform,W=Z.tileSize,Y=H.paint.get("background-pattern");if(S.isPatternMissing(Y))return;const ie=!Y&&w.a===1&&I===1&&S.opaquePassEnabledForLayer()?"opaque":"translucent";if(S.renderPass!==ie)return;const ae=Br.disabled,fe=S.depthModeForSublayer(0,ie==="opaque"?nr.ReadWrite:nr.ReadOnly),pe=S.colorModeForRenderPass(),xe=S.useProgram(Y?"backgroundPattern":"background"),Fe=q||Z.coveringTiles({tileSize:W,terrain:S.style.map.terrain});Y&&(R.activeTexture.set(j.TEXTURE0),S.imageManager.bind(S.context));const Le=H.getCrossfadeParameters();for(const nt of Fe){const Ke=q?nt.posMatrix:S.transform.calculatePosMatrix(nt.toUnwrapped()),Re=Y?Za(Ke,I,S,Y,{tileID:nt,tileSize:W},Le):Fc(Ke,I,w),Qe=S.style.map.terrain&&S.style.map.terrain.getTerrainData(nt);xe.draw(R,j.TRIANGLES,fe,ae,pe,Lr.disabled,Re,Qe,H.id,S.tileExtentBuffer,S.quadTriangleIndexBuffer,S.tileExtentSegments)}})(a,0,_,B);break;case"custom":(function(S,U,H){const q=S.context,w=H.implementation;if(S.renderPass==="offscreen"){const I=w.prerender;I&&(S.setCustomLayerDefaults(),q.setColorMode(S.colorModeForRenderPass()),I.call(w,q.gl,S.transform.customLayerMatrix()),q.setDirty(),S.setBaseState())}else if(S.renderPass==="translucent"){S.setCustomLayerDefaults(),q.setColorMode(S.colorModeForRenderPass()),q.setStencilMode(Br.disabled);const I=w.renderingMode==="3d"?new nr(S.context.gl.LEQUAL,nr.ReadWrite,S.depthRangeFor3D):S.depthModeForSublayer(0,nr.ReadOnly);q.setDepthMode(I),w.render(q.gl,S.transform.customLayerMatrix()),q.setDirty(),S.setBaseState(),q.bindFramebuffer.set(null)}})(a,0,_)}}translatePosMatrix(a,d,_,B,S){if(!_[0]&&!_[1])return a;const U=S?B==="map"?this.transform.angle:0:B==="viewport"?-this.transform.angle:0;if(U){const w=Math.sin(U),I=Math.cos(U);_=[_[0]*I-_[1]*w,_[0]*w+_[1]*I]}const H=[S?_[0]:qt(d,_[0],this.transform.zoom),S?_[1]:qt(d,_[1],this.transform.zoom),0],q=new Float32Array(16);return s.H(q,a,H),q}saveTileTexture(a){const d=this._tileTextures[a.size[0]];d?d.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const d=this._tileTextures[a];return d&&d.length>0?d.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const d=this.imageManager.getPattern(a.from.toString()),_=this.imageManager.getPattern(a.to.toString());return!d||!_}useProgram(a,d){this.cache=this.cache||{};const _=a+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[_]||(this.cache[_]=new uo(this.context,An[a],d,ho[a],this._showOverdrawInspector,this.style.map.terrain)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Me(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:a,drawingBufferHeight:d}=this.context.gl;return this.width!==a||this.height!==d}}class ss{constructor(a,d){this.points=a,this.planes=d}static fromInvProjectionMatrix(a,d,_){const B=Math.pow(2,_),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(H=>{const q=1/(H=s.af([],H,a))[3]/d*B;return s.a_(H,H,[q,q,1/H[3],q])}),U=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(H=>{const q=function(j,Z){var W=Z[0],Y=Z[1],ie=Z[2],ae=W*W+Y*Y+ie*ie;return ae>0&&(ae=1/Math.sqrt(ae)),j[0]=Z[0]*ae,j[1]=Z[1]*ae,j[2]=Z[2]*ae,j}([],function(j,Z,W){var Y=Z[0],ie=Z[1],ae=Z[2],fe=W[0],pe=W[1],xe=W[2];return j[0]=ie*xe-ae*pe,j[1]=ae*fe-Y*xe,j[2]=Y*pe-ie*fe,j}([],ot([],S[H[0]],S[H[1]]),ot([],S[H[2]],S[H[1]]))),w=-((I=q)[0]*(R=S[H[1]])[0]+I[1]*R[1]+I[2]*R[2]);var I,R;return q.concat(w)});return new ss(S,U)}}class os{constructor(a,d){this.min=a,this.max=d,this.center=function(_,B,S){return _[0]=.5*B[0],_[1]=.5*B[1],_[2]=.5*B[2],_}([],function(_,B,S){return _[0]=B[0]+S[0],_[1]=B[1]+S[1],_[2]=B[2]+S[2],_}([],this.min,this.max))}quadrant(a){const d=[a%2==0,a<2],_=qe(this.min),B=qe(this.max);for(let S=0;S<d.length;S++)_[S]=d[S]?this.min[S]:this.center[S],B[S]=d[S]?this.center[S]:this.max[S];return B[2]=this.max[2],new os(_,B)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}intersects(a){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let _=!0;for(let B=0;B<a.planes.length;B++){const S=a.planes[B];let U=0;for(let H=0;H<d.length;H++)s.a$(S,d[H])>=0&&U++;if(U===0)return 0;U!==d.length&&(_=!1)}if(_)return 2;for(let B=0;B<3;B++){let S=Number.MAX_VALUE,U=-Number.MAX_VALUE;for(let H=0;H<a.points.length;H++){const q=a.points[H][B]-this.min[B];S=Math.min(S,q),U=Math.max(U,q)}if(U<0||S>this.max[B]-this.min[B])return 0}return 1}}class Mo{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(a)||a<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(B)||B<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=d,this.left=_,this.right=B}interpolate(a,d,_){return d.top!=null&&a.top!=null&&(this.top=s.z.number(a.top,d.top,_)),d.bottom!=null&&a.bottom!=null&&(this.bottom=s.z.number(a.bottom,d.bottom,_)),d.left!=null&&a.left!=null&&(this.left=s.z.number(a.left,d.left,_)),d.right!=null&&a.right!=null&&(this.right=s.z.number(a.right,d.right,_)),this}getCenter(a,d){const _=s.ac((this.left+a-this.right)/2,0,a),B=s.ac((this.top+d-this.bottom)/2,0,d);return new s.P(_,B)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Mo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Po{constructor(a,d,_,B,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||!!S,this._minZoom=a||0,this._maxZoom=d||22,this._minPitch=_??0,this._maxPitch=B??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Mo,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const a=new Po(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.apply(this),a}apply(a){this.tileSize=a.tileSize,this.latRange=a.latRange,this.width=a.width,this.height=a.height,this._center=a._center,this._elevation=a._elevation,this.minElevationForCurrentTile=a.minElevationForCurrentTile,this.zoom=a.zoom,this.angle=a.angle,this._fov=a._fov,this._pitch=a._pitch,this._unmodified=a._unmodified,this._edgeInsets=a._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(a){const d=-s.b0(a,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var _=new s.A(4);return s.A!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_}(),function(_,B,S){var U=B[0],H=B[1],q=B[2],w=B[3],I=Math.sin(S),R=Math.cos(S);_[0]=U*R+q*I,_[1]=H*R+w*I,_[2]=U*-I+q*R,_[3]=H*-I+w*R}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const d=s.ac(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(a){const d=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(a){a!==this._elevation&&(this._elevation=a,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,d,_){this._unmodified=!1,this._edgeInsets.interpolate(a,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const d=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(a){const d=[new s.b1(0,a)];if(this._renderWorldCopies){const _=this.pointCoordinate(new s.P(0,0)),B=this.pointCoordinate(new s.P(this.width,0)),S=this.pointCoordinate(new s.P(this.width,this.height)),U=this.pointCoordinate(new s.P(0,this.height)),H=Math.floor(Math.min(_.x,B.x,S.x,U.x)),q=Math.floor(Math.max(_.x,B.x,S.x,U.x)),w=1;for(let I=H-w;I<=q+w;I++)I!==0&&d.push(new s.b1(I,a))}return d}coveringTiles(a){var d,_;let B=this.coveringZoomLevel(a);const S=B;if(a.minzoom!==void 0&&B<a.minzoom)return[];a.maxzoom!==void 0&&B>a.maxzoom&&(B=a.maxzoom);const U=this.pointCoordinate(this.getCameraPoint()),H=s.Y.fromLngLat(this.center),q=Math.pow(2,B),w=[q*U.x,q*U.y,0],I=[q*H.x,q*H.y,0],R=ss.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,B);let j=a.minzoom||0;!a.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(j=B);const Z=a.terrain?2/Math.min(this.tileSize,a.tileSize)*this.tileSize:3,W=pe=>({aabb:new os([pe*q,0,0],[(pe+1)*q,q,0]),zoom:0,x:0,y:0,wrap:pe,fullyVisible:!1}),Y=[],ie=[],ae=B,fe=a.reparseOverscaled?S:B;if(this._renderWorldCopies)for(let pe=1;pe<=3;pe++)Y.push(W(-pe)),Y.push(W(pe));for(Y.push(W(0));Y.length>0;){const pe=Y.pop(),xe=pe.x,Fe=pe.y;let Le=pe.fullyVisible;if(!Le){const pt=pe.aabb.intersects(R);if(pt===0)continue;Le=pt===2}const nt=a.terrain?w:I,Ke=pe.aabb.distanceX(nt),Re=pe.aabb.distanceY(nt),Qe=Math.max(Math.abs(Ke),Math.abs(Re));if(pe.zoom===ae||Qe>Z+(1<<ae-pe.zoom)-2&&pe.zoom>=j){const pt=ae-pe.zoom,bt=w[0]-.5-(xe<<pt),ht=w[1]-.5-(Fe<<pt);ie.push({tileID:new s.Q(pe.zoom===ae?fe:pe.zoom,pe.wrap,pe.zoom,xe,Fe),distanceSq:it([I[0]-.5-xe,I[1]-.5-Fe]),tileDistanceToCamera:Math.sqrt(bt*bt+ht*ht)})}else for(let pt=0;pt<4;pt++){const bt=(xe<<1)+pt%2,ht=(Fe<<1)+(pt>>1),Rt=pe.zoom+1;let Dt=pe.aabb.quadrant(pt);if(a.terrain){const hi=new s.Q(Rt,pe.wrap,Rt,bt,ht),Vt=a.terrain.getMinMaxElevation(hi),_i=(d=Vt.minElevation)!==null&&d!==void 0?d:this.elevation,Si=(_=Vt.maxElevation)!==null&&_!==void 0?_:this.elevation;Dt=new os([Dt.min[0],Dt.min[1],_i],[Dt.max[0],Dt.max[1],Si])}Y.push({aabb:Dt,zoom:Rt,x:bt,y:ht,wrap:pe.wrap,fullyVisible:Le})}}return ie.sort((pe,xe)=>pe.distanceSq-xe.distanceSq).map(pe=>pe.tileID)}resize(a,d){this.width=a,this.height=d,this.pixelsToGLUnits=[2/a,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const d=s.ac(a.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.P(s.N(a.lng)*this.worldSize,s.O(d)*this.worldSize)}unproject(a){return new s.Y(a.x/this.worldSize,a.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(a){const d=this.pointLocation(this.centerPoint,a),_=a.getElevationForLngLatZoom(d,this.tileZoom);if(!(this.elevation-_))return;const B=this.getCameraPosition(),S=s.Y.fromLngLat(B.lngLat,B.altitude),U=s.Y.fromLngLat(d,_),H=S.x-U.x,q=S.y-U.y,w=S.z-U.z,I=Math.sqrt(H*H+q*q+w*w),R=this.scaleZoom(this.cameraToCenterDistance/I/this.tileSize);this._elevation=_,this._center=d,this.zoom=R}setLocationAtPoint(a,d){const _=this.pointCoordinate(d),B=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(a),U=new s.Y(S.x-(_.x-B.x),S.y-(_.y-B.y));this.center=this.coordinateLocation(U),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(a,d){return d?this.coordinatePoint(this.locationCoordinate(a),d.getElevationForLngLatZoom(a,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(a))}pointLocation(a,d){return this.coordinateLocation(this.pointCoordinate(a,d))}locationCoordinate(a){return s.Y.fromLngLat(a)}coordinateLocation(a){return a&&a.toLngLat()}pointCoordinate(a,d){if(d){const j=d.pointCoordinate(a);if(j!=null)return j}const _=[a.x,a.y,0,1],B=[a.x,a.y,1,1];s.af(_,_,this.pixelMatrixInverse),s.af(B,B,this.pixelMatrixInverse);const S=_[3],U=B[3],H=_[1]/S,q=B[1]/U,w=_[2]/S,I=B[2]/U,R=w===I?0:(0-w)/(I-w);return new s.Y(s.z.number(_[0]/S,B[0]/U,R)/this.worldSize,s.z.number(H,q,R)/this.worldSize)}coordinatePoint(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const B=[a.x*this.worldSize,a.y*this.worldSize,d,1];return s.af(B,B,_),new s.P(B[0]/B[3],B[1]/B[3])}getBounds(){const a=Math.max(0,this.height/2-this.getHorizon());return new kt().extend(this.pointLocation(new s.P(0,a))).extend(this.pointLocation(new s.P(this.width,a))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new kt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(a){a?(this.lngRange=[a.getWest(),a.getEast()],this.latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(a){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const _=a.key,B=d?this._alignedPosMatrixCache:this._posMatrixCache;if(B[_])return B[_];const S=a.canonical,U=this.worldSize/this.zoomScale(S.z),H=S.x+Math.pow(2,S.z)*a.wrap,q=s.an(new Float64Array(16));return s.H(q,q,[H*U,S.y*U,0]),s.J(q,q,[U/s.W,U/s.W,1]),s.K(q,d?this.alignedProjMatrix:this.projMatrix,q),B[_]=new Float32Array(q),B[_]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let a,d,_,B,S=-90,U=90,H=-180,q=180;const w=this.size,I=this._unmodified;if(this.latRange){const Z=this.latRange;S=s.O(Z[1])*this.worldSize,U=s.O(Z[0])*this.worldSize,a=U-S<w.y?w.y/(U-S):0}if(this.lngRange){const Z=this.lngRange;H=s.b0(s.N(Z[0])*this.worldSize,0,this.worldSize),q=s.b0(s.N(Z[1])*this.worldSize,0,this.worldSize),q<H&&(q+=this.worldSize),d=q-H<w.x?w.x/(q-H):0}const R=this.point,j=Math.max(d||0,a||0);if(j)return this.center=this.unproject(new s.P(d?(q+H)/2:R.x,a?(U+S)/2:R.y)),this.zoom+=this.scaleZoom(j),this._unmodified=I,void(this._constraining=!1);if(this.latRange){const Z=R.y,W=w.y/2;Z-W<S&&(B=S+W),Z+W>U&&(B=U-W)}if(this.lngRange){const Z=(H+q)/2,W=s.b0(R.x,Z-this.worldSize/2,Z+this.worldSize/2),Y=w.x/2;W-Y<H&&(_=H+Y),W+Y>q&&(_=q-Y)}_===void 0&&B===void 0||(this.center=this.unproject(new s.P(_!==void 0?_:R.x,B!==void 0?B:R.y)).wrap()),this._unmodified=I,this._constraining=!1}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,d=this.point.x,_=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b2(1,this.center.lat)*this.worldSize;let B=s.an(new Float64Array(16));s.J(B,B,[this.width/2,-this.height/2,1]),s.H(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=s.an(new Float64Array(16)),s.J(B,B,[1,-1,1]),s.H(B,B,[-1,-1,0]),s.J(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B;const S=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),U=Math.min(this.elevation,this.minElevationForCurrentTile),H=S-U*this._pixelPerMeter/Math.cos(this._pitch),q=U<0?H:S,w=Math.PI/2+this._pitch,I=this._fov*(.5+a.y/this.height),R=Math.sin(I)*q/Math.sin(s.ac(Math.PI-w-I,.01,Math.PI-.01)),j=this.getHorizon(),Z=2*Math.atan(j/this.cameraToCenterDistance)*(.5+a.y/(2*j)),W=Math.sin(Z)*q/Math.sin(s.ac(Math.PI-w-Z,.01,Math.PI-.01)),Y=Math.min(R,W),ie=1.01*(Math.cos(Math.PI/2-this._pitch)*Y+q),ae=this.height/50;B=new Float64Array(16),s.b3(B,this._fov,this.width/this.height,ae,ie),B[8]=2*-a.x/this.width,B[9]=2*a.y/this.height,s.J(B,B,[1,-1,1]),s.H(B,B,[0,0,-this.cameraToCenterDistance]),s.b4(B,B,this._pitch),s.ad(B,B,this.angle),s.H(B,B,[-d,-_,0]),this.mercatorMatrix=s.J([],B,[this.worldSize,this.worldSize,this.worldSize]),s.J(B,B,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.K(new Float64Array(16),this.labelPlaneMatrix,B),s.H(B,B,[0,0,-this.elevation]),this.projMatrix=B,this.invProjMatrix=s.ar([],B),this.pixelMatrix3D=s.K(new Float64Array(16),this.labelPlaneMatrix,B);const fe=this.width%2/2,pe=this.height%2/2,xe=Math.cos(this.angle),Fe=Math.sin(this.angle),Le=d-Math.round(d)+xe*fe+Fe*pe,nt=_-Math.round(_)+xe*pe+Fe*fe,Ke=new Float64Array(B);if(s.H(Ke,Ke,[Le>.5?Le-1:Le,nt>.5?nt-1:nt,0]),this.alignedProjMatrix=Ke,B=s.ar(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");this.pixelMatrixInverse=B,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const a=this.pointCoordinate(new s.P(0,0)),d=[a.x*this.worldSize,a.y*this.worldSize,0,1];return s.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,a))}getCameraQueryGeometry(a){const d=this.getCameraPoint();if(a.length===1)return[a[0],d];{let _=d.x,B=d.y,S=d.x,U=d.y;for(const H of a)_=Math.min(_,H.x),B=Math.min(B,H.y),S=Math.max(S,H.x),U=Math.max(U,H.y);return[new s.P(_,B),new s.P(S,B),new s.P(S,U),new s.P(_,U),new s.P(_,B)]}}lngLatToCameraDepth(a,d){const _=this.locationCoordinate(a),B=[_.x*this.worldSize,_.y*this.worldSize,d,1];return s.af(B,B,this.projMatrix),B[2]/B[3]}}function ga(y,a){var d=this;let _,B=!1,S=null,U=null;const H=()=>{S=null,B&&(y.apply(U,_),S=setTimeout(H,a),B=!1)};return function(){for(var q=arguments.length,w=new Array(q),I=0;I<q;I++)w[I]=arguments[I];return B=!0,U=d,_=w,S||H(),S}}class pl{constructor(a){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let _;return d.split("&").map(B=>B.split("=")).forEach(B=>{B[0]===this._hashName&&(_=B)}),(_&&_[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){const _=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=ga(this._updateHashUnthrottled,300),this._hashName=a&&encodeURIComponent(a)}addTo(a){return this._map=a,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(a){const d=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,B=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,B),U=Math.round(d.lng*S)/S,H=Math.round(d.lat*S)/S,q=this._map.getBearing(),w=this._map.getPitch();let I="";if(I+=a?`/${U}/${H}/${_}`:`${_}/${H}/${U}`,(q||w)&&(I+="/"+Math.round(10*q)/10),w&&(I+=`/${Math.round(w)}`),this._hashName){const R=this._hashName;let j=!1;const Z=window.location.hash.slice(1).split("&").map(W=>{const Y=W.split("=")[0];return Y===R?(j=!0,`${Y}=${I}`):W}).filter(W=>W);return j||Z.push(`${R}=${I}`),`#${Z.join("&")}`}return`#${I}`}}const io={linearity:.3,easing:s.b5(0,0,.3,1)},ro=s.e({deceleration:2500,maxSpeed:1400},io),po=s.e({deceleration:20,maxSpeed:1400},io),ys=s.e({deceleration:1e3,maxSpeed:360},io),no=s.e({deceleration:1e3,maxSpeed:90},io);class Ma{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:F.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,d=F.now();for(;a.length>0&&d-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)d.zoom+=S.zoomDelta||0,d.bearing+=S.bearingDelta||0,d.pitch+=S.pitchDelta||0,S.panDelta&&d.pan._add(S.panDelta),S.around&&(d.around=S.around),S.pinchAround&&(d.pinchAround=S.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,B={};if(d.pan.mag()){const S=Pa(d.pan.mag(),_,s.e({},ro,a||{}));B.offset=d.pan.mult(S.amount/d.pan.mag()),B.center=this._map.transform.center,ma(B,S)}if(d.zoom){const S=Pa(d.zoom,_,po);B.zoom=this._map.transform.zoom+S.amount,ma(B,S)}if(d.bearing){const S=Pa(d.bearing,_,ys);B.bearing=this._map.transform.bearing+s.ac(S.amount,-179,179),ma(B,S)}if(d.pitch){const S=Pa(d.pitch,_,no);B.pitch=this._map.transform.pitch+S.amount,ma(B,S)}if(B.zoom||B.bearing){const S=d.pinchAround===void 0?d.around:d.pinchAround;B.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),s.e(B,{noMoveStart:!0})}}function ma(y,a){(!y.duration||y.duration<a.duration)&&(y.duration=a.duration,y.easing=a.easing)}function Pa(y,a,d){const{maxSpeed:_,linearity:B,deceleration:S}=d,U=s.ac(y*B/(a/1e3),-_,_),H=Math.abs(U)/(S*B);return{easing:d.easing,duration:1e3*H,amount:U*(H/2)}}class Tn extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const S=k.mousePos(d.getCanvas(),_),U=d.unproject(S);super(a,s.e({point:S,lngLat:U,originalEvent:_},B)),this._defaultPrevented=!1,this.target=d}}class Fo extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_){const B=a==="touchend"?_.changedTouches:_.touches,S=k.touchPos(d.getCanvasContainer(),B),U=S.map(q=>d.unproject(q)),H=S.reduce((q,w,I,R)=>q.add(w.div(R.length)),new s.P(0,0));super(a,{points:S,point:H,lngLats:U,lngLat:d.unproject(H),originalEvent:_}),this._defaultPrevented=!1}}class As extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,_){super(a,{originalEvent:_}),this._defaultPrevented=!1}}class _s{constructor(a,d){this._map=a,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new As(a.type,this._map,a))}mousedown(a,d){return this._mousedownPos=d,this._firePreventable(new Tn(a.type,this._map,a))}mouseup(a){this._map.fire(new Tn(a.type,this._map,a))}click(a,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Tn(a.type,this._map,a))}dblclick(a){return this._firePreventable(new Tn(a.type,this._map,a))}mouseover(a){this._map.fire(new Tn(a.type,this._map,a))}mouseout(a){this._map.fire(new Tn(a.type,this._map,a))}touchstart(a){return this._firePreventable(new Fo(a.type,this._map,a))}touchmove(a){this._map.fire(new Fo(a.type,this._map,a))}touchend(a){this._map.fire(new Fo(a.type,this._map,a))}touchcancel(a){this._map.fire(new Fo(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ds{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(a){this._map.fire(new Tn(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._ignoreContextMenu||this._map.fire(new Tn(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ir{constructor(a){this._map=a}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(a){return this.transform.pointLocation(s.P.convert(a),this._map.terrain)}}class Zr{constructor(a,d){this._map=a,this._tr=new Ir(a),this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,d){this.isEnabled()&&a.shiftKey&&a.button===0&&(k.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(a,d){if(!this._active)return;const _=d;if(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)return;const B=this._startPos;this._lastPos=_,this._box||(this._box=k.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",a));const S=Math.min(B.x,_.x),U=Math.max(B.x,_.x),H=Math.min(B.y,_.y),q=Math.max(B.y,_.y);k.setTransform(this._box,`translate(${S}px,${H}px)`),this._box.style.width=U-S+"px",this._box.style.height=q-H+"px"}mouseupWindow(a,d){if(!this._active||a.button!==0)return;const _=this._startPos,B=d;if(this.reset(),k.suppressClick(),_.x!==B.x||_.y!==B.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:a})),{cameraAnimation:S=>S.fitScreenCoordinates(_,B,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(k.remove(this._box),this._box=null),k.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(a,d){return this._map.fire(new s.k(a,{originalEvent:d}))}}function an(y,a){if(y.length!==a.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${a.length}`);const d={};for(let _=0;_<y.length;_++)d[y[_].identifier]=a[_];return d}class jn{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(a,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),_.length===this.numTouches&&(this.centroid=function(B){const S=new s.P(0,0);for(const U of B)S._add(U);return S.div(B.length)}(d),this.touches=an(_,d)))}touchmove(a,d,_){if(this.aborted||!this.centroid)return;const B=an(_,d);for(const S in this.touches){const U=B[S];(!U||U.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(a,d,_){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const B=!this.aborted&&this.centroid;if(this.reset(),B)return B}}}class ya{constructor(a){this.singleTap=new jn(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,d,_){this.singleTap.touchstart(a,d,_)}touchmove(a,d,_){this.singleTap.touchmove(a,d,_)}touchend(a,d,_){const B=this.singleTap.touchend(a,d,_);if(B){const S=a.timeStamp-this.lastTime<500,U=!this.lastTap||this.lastTap.dist(B)<30;if(S&&U||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=B,this.count===this.numTaps)return this.reset(),B}}}class Fa{constructor(a){this._tr=new Ir(a),this._zoomIn=new ya({numTouches:1,numTaps:2}),this._zoomOut=new ya({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,d,_){this._zoomIn.touchstart(a,d,_),this._zoomOut.touchstart(a,d,_)}touchmove(a,d,_){this._zoomIn.touchmove(a,d,_),this._zoomOut.touchmove(a,d,_)}touchend(a,d,_){const B=this._zoomIn.touchend(a,d,_),S=this._zoomOut.touchend(a,d,_),U=this._tr;return B?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:H=>H.easeTo({duration:300,zoom:U.zoom+1,around:U.unproject(B)},{originalEvent:a})}):S?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:H=>H.easeTo({duration:300,zoom:U.zoom-1,around:U.unproject(S)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class go{constructor(a){this._enabled=!!a.enable,this._moveStateManager=a.moveStateManager,this._clickTolerance=a.clickTolerance||1,this._moveFunction=a.move,this._activateOnStart=!!a.activateOnStart,a.assignEvents(this),this.reset()}reset(a){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(a)}_move(){const a=this._moveFunction(...arguments);if(a.bearingDelta||a.pitchDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(a,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(a)&&(this._moveStateManager.startMove(a),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(a,d){if(!this.isEnabled())return;const _=this._lastPoint;if(!_)return;if(a.preventDefault(),!this._moveStateManager.isValidMoveEvent(a))return void this.reset(a);const B=d.length?d[0]:d;return!this._moved&&B.dist(_)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=B,this._move(_,B))}dragEnd(a){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(a)&&(this._moved&&k.suppressClick(),this.reset(a))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Zo={0:1,2:2};class Oi{constructor(a){this._correctEvent=a.checkCorrectEvent}startMove(a){const d=k.mouseButton(a);this._eventButton=d}endMove(a){delete this._eventButton}isValidStartEvent(a){return this._correctEvent(a)}isValidMoveEvent(a){return!function(d,_){const B=Zo[_];return d.buttons===void 0||(d.buttons&B)!==B}(a,this._eventButton)}isValidEndEvent(a){return k.mouseButton(a)===this._eventButton}}class Jo{constructor(){this._firstTouch=void 0}_isOneFingerTouch(a){return a.targetTouches.length===1}_isSameTouchEvent(a){return a.targetTouches[0].identifier===this._firstTouch}startMove(a){this._firstTouch=a.targetTouches[0].identifier}endMove(a){delete this._firstTouch}isValidStartEvent(a){return this._isOneFingerTouch(a)}isValidMoveEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}isValidEndEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}}const Pi=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(a){a.preventDefault()}},gl=y=>{let{enable:a,clickTolerance:d,bearingDegreesPerPixelMoved:_=.8}=y;const B=new Oi({checkCorrectEvent:S=>k.mouseButton(S)===0&&S.ctrlKey||k.mouseButton(S)===2});return new go({clickTolerance:d,move:(S,U)=>({bearingDelta:(U.x-S.x)*_}),moveStateManager:B,enable:a,assignEvents:Pi})},$l=y=>{let{enable:a,clickTolerance:d,pitchDegreesPerPixelMoved:_=-.5}=y;const B=new Oi({checkCorrectEvent:S=>k.mouseButton(S)===0&&S.ctrlKey||k.mouseButton(S)===2});return new go({clickTolerance:d,move:(S,U)=>({pitchDelta:(U.y-S.y)*_}),moveStateManager:B,enable:a,assignEvents:Pi})};class Li{constructor(a,d){this._clickTolerance=a.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(a,d,_){return this._calculateTransform(a,d,_)}touchmove(a,d,_){if(this._active&&!(_.length<this.minTouchs()))return a.preventDefault(),this._calculateTransform(a,d,_)}touchend(a,d,_){this._calculateTransform(a,d,_),this._active&&_.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,d,_){_.length>0&&(this._active=!0);const B=an(_,d),S=new s.P(0,0),U=new s.P(0,0);let H=0;for(const w in B){const I=B[w],R=this._touches[w];R&&(S._add(I),U._add(I.sub(R)),H++,B[w]=I)}if(this._touches=B,H<this.minTouchs()||!U.mag())return;const q=U.div(H);return this._sum._add(q),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(H),panDelta:q}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(a,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(a,d,_){if(!this._firstTwoTouches)return;a.preventDefault();const[B,S]=this._firstTwoTouches,U=Ei(_,d,B),H=Ei(_,d,S);if(!U||!H)return;const q=this._aroundCenter?null:U.add(H).div(2);return this._move([U,H],q,a)}touchend(a,d,_){if(!this._firstTwoTouches)return;const[B,S]=this._firstTwoTouches,U=Ei(_,d,B),H=Ei(_,d,S);U&&H||(this._active&&k.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ei(y,a,d){for(let _=0;_<y.length;_++)if(y[_].identifier===d)return a[_]}function so(y,a){return Math.log(y/a)/Math.LN2}class mo extends Kl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,d){const _=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(so(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:so(this._distance,_),pinchAround:d}}}function Rc(y,a){return 180*y.angleWith(a)/Math.PI}class Wl extends Kl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,d,_){const B=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Rc(this._vector,B),pinchAround:d}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const d=25/(Math.PI*this._minDiameter)*360,_=Rc(a,this._startVector);return Math.abs(_)<d}}function kc(y){return Math.abs(y.y)>Math.abs(y.x)}class Oc extends Kl{constructor(a){super(),this._currentTouchCount=0,this._map=a}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(a,d,_){super.touchstart(a,d,_),this._currentTouchCount=_.length}_start(a){this._lastPoints=a,kc(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,d,_){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const B=a[0].sub(this._lastPoints[0]),S=a[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(B,S,_.timeStamp),this._valid?(this._lastPoints=a,this._active=!0,{pitchDelta:(B.y+S.y)/2*-.5}):void 0}gestureBeginsVertically(a,d,_){if(this._valid!==void 0)return this._valid;const B=a.mag()>=2,S=d.mag()>=2;if(!B&&!S)return;if(!B||!S)return this._firstMove===void 0&&(this._firstMove=_),_-this._firstMove<100&&void 0;const U=a.y>0==d.y>0;return kc(a)&&kc(d)&&U}}const Uc={panStep:100,bearingStep:15,pitchStep:10};class Nc{constructor(a){this._tr=new Ir(a);const d=Uc;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let d=0,_=0,B=0,S=0,U=0;switch(a.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:a.shiftKey?_=-1:(a.preventDefault(),S=-1);break;case 39:a.shiftKey?_=1:(a.preventDefault(),S=1);break;case 38:a.shiftKey?B=1:(a.preventDefault(),U=-1);break;case 40:a.shiftKey?B=-1:(a.preventDefault(),U=1);break;default:return}return this._rotationDisabled&&(_=0,B=0),{cameraAnimation:H=>{const q=this._tr;H.easeTo({duration:300,easeId:"keyboardHandler",easing:il,zoom:d?Math.round(q.zoom)+d*(a.shiftKey?2:1):q.zoom,bearing:q.bearing+_*this._bearingStep,pitch:q.pitch+B*this._pitchStep,offset:[-S*this._panStep,-U*this._panStep],center:q.center},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function il(y){return y*(2-y)}const yn=4.000244140625;class Cs{constructor(a,d){this._onTimeout=_=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(_)},this._map=a,this._tr=new Ir(a),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(a){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!a[this._map.cooperativeGestures._bypassKey])return;let d=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const _=F.now(),B=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,d!==0&&d%yn==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":B>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(B*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),a.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=a,this._delta-=d,this._active||this._start(a)),a.preventDefault()}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=k.mousePos(this._map.getCanvas(),a),_=this._tr;this._around=d.y>_.transform.height/2-_.transform.getHorizon()?s.M.convert(this._aroundCenter?_.center:_.unproject(d)):s.M.convert(_.center),this._aroundPoint=_.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._tr.transform;if(this._delta!==0){const H=this._type==="wheel"&&Math.abs(this._delta)>yn?this._wheelZoomRate:this._defaultZoomRate;let q=2/(1+Math.exp(-Math.abs(this._delta*H)));this._delta<0&&q!==0&&(q=1/q);const w=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):a.scale;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(w*q))),this._type==="wheel"&&(this._startZoom=a.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a.zoom,_=this._startZoom,B=this._easing;let S,U=!1;if(this._type==="wheel"&&_&&B){const H=Math.min((F.now()-this._lastWheelEventTime)/200,1),q=B(H);S=s.z.number(_,d,q),H<1?this._frameId||(this._frameId=!0):U=!0}else S=d,U=!0;return this._active=!0,U&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!U,zoomDelta:S-a.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let d=s.b6;if(this._prevEase){const _=this._prevEase,B=(F.now()-_.start)/_.duration,S=_.easing(B+.01)-_.easing(B),U=.27/Math.sqrt(S*S+1e-4)*.01,H=Math.sqrt(.0729-U*U);d=s.b5(U,H,.25,1)}return this._prevEase={start:F.now(),duration:a,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Do{constructor(a,d){this._clickZoom=a,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Xl{constructor(a){this._tr=new Ir(a),this.reset()}reset(){this._active=!1}dblclick(a,d){return a.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:this._tr.zoom+(a.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ou{constructor(){this._tap=new ya({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(a,d,_){if(!this._swipePoint)if(this._tapTime){const B=d[0],S=a.timeStamp-this._tapTime<500,U=this._tapPoint.dist(B)<30;S&&U?_.length>0&&(this._swipePoint=B,this._swipeTouch=_[0].identifier):this.reset()}else this._tap.touchstart(a,d,_)}touchmove(a,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const B=d[0],S=B.y-this._swipePoint.y;return this._swipePoint=B,a.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(a,d,_)}touchend(a,d,_){if(this._tapTime)this._swipePoint&&_.length===0&&this.reset();else{const B=this._tap.touchend(a,d,_);B&&(this._tapTime=a.timeStamp,this._tapPoint=B)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gc{constructor(a,d,_){this._el=a,this._mousePan=d,this._touchPan=_}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class uu{constructor(a,d,_){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class _a{constructor(a,d,_,B){this._el=a,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=B,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ks{constructor(a,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=a,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const a=this._map.getCanvasContainer();a.classList.add("maplibregl-cooperative-gestures"),this._container=k.create("div","maplibregl-cooperative-gesture-screen",a);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const _=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),B=document.createElement("div");B.className="maplibregl-desktop-message",B.textContent=d,this._container.appendChild(B);const S=document.createElement("div");S.className="maplibregl-mobile-message",S.textContent=_,this._container.appendChild(S),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(k.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(a){this._onCooperativeGesture(a.touches.length===1)}wheel(a){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!a[this._bypassKey])}_onCooperativeGesture(a){this._enabled&&a&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const bi=y=>y.zoom||y.drag||y.pitch||y.rotate;class sr extends s.k{}function Zl(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class zc{constructor(a,d){this.handleWindowEvent=B=>{this.handleEvent(B,`${B.type}Window`)},this.handleEvent=(B,S)=>{if(B.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const U=B.type==="renderFrame"?void 0:B,H={needsRenderFrame:!1},q={},w={},I=B.touches,R=I?this._getMapTouches(I):void 0,j=R?k.touchPos(this._map.getCanvas(),R):k.mousePos(this._map.getCanvas(),B);for(const{handlerName:Y,handler:ie,allowed:ae}of this._handlers){if(!ie.isEnabled())continue;let fe;this._blockedByActive(w,ae,Y)?ie.reset():ie[S||B.type]&&(fe=ie[S||B.type](B,j,R),this.mergeHandlerResult(H,q,fe,Y,U),fe&&fe.needsRenderFrame&&this._triggerRenderFrame()),(fe||ie.isActive())&&(w[Y]=ie)}const Z={};for(const Y in this._previousActiveHandlers)w[Y]||(Z[Y]=U);this._previousActiveHandlers=w,(Object.keys(Z).length||Zl(H))&&(this._changes.push([H,q,Z]),this._triggerRenderFrame()),(Object.keys(w).length||Zl(H))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:W}=H;W&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],W(this._map))},this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ma(a),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[B,S,U]of this._listeners)k.addEventListener(B,S,B===document?this.handleWindowEvent:this.handleEvent,U)}destroy(){for(const[a,d,_]of this._listeners)k.removeEventListener(a,d,a===document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(a){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new _s(d,a));const B=d.boxZoom=new Zr(d,a);this._add("boxZoom",B),a.interactive&&a.boxZoom&&B.enable();const S=d.cooperativeGestures=new Ks(d,a.cooperativeGestures);this._add("cooperativeGestures",S),a.cooperativeGestures&&S.enable();const U=new Fa(d),H=new Xl(d);d.doubleClickZoom=new Do(H,U),this._add("tapZoom",U),this._add("clickZoom",H),a.interactive&&a.doubleClickZoom&&d.doubleClickZoom.enable();const q=new Ou;this._add("tapDragZoom",q);const w=d.touchPitch=new Oc(d);this._add("touchPitch",w),a.interactive&&a.touchPitch&&d.touchPitch.enable(a.touchPitch);const I=gl(a),R=$l(a);d.dragRotate=new uu(a,I,R),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]),a.interactive&&a.dragRotate&&d.dragRotate.enable();const j=(fe=>{let{enable:pe,clickTolerance:xe}=fe;const Fe=new Oi({checkCorrectEvent:Le=>k.mouseButton(Le)===0&&!Le.ctrlKey});return new go({clickTolerance:xe,move:(Le,nt)=>({around:nt,panDelta:nt.sub(Le)}),activateOnStart:!0,moveStateManager:Fe,enable:pe,assignEvents:Pi})})(a),Z=new Li(a,d);d.dragPan=new gc(_,j,Z),this._add("mousePan",j),this._add("touchPan",Z,["touchZoom","touchRotate"]),a.interactive&&a.dragPan&&d.dragPan.enable(a.dragPan);const W=new Wl,Y=new mo;d.touchZoomRotate=new _a(_,Y,W,q),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),a.interactive&&a.touchZoomRotate&&d.touchZoomRotate.enable(a.touchZoomRotate);const ie=d.scrollZoom=new Cs(d,()=>this._triggerRenderFrame());this._add("scrollZoom",ie,["mousePan"]),a.interactive&&a.scrollZoom&&d.scrollZoom.enable(a.scrollZoom);const ae=d.keyboard=new Nc(d);this._add("keyboard",ae),a.interactive&&a.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new ds(d))}_add(a,d,_){this._handlers.push({handlerName:a,handler:d,allowed:_}),this._handlersById[a]=d}stop(a){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!bi(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,d,_){for(const B in a)if(B!==_&&(!d||d.indexOf(B)<0))return!0;return!1}_getMapTouches(a){const d=[];for(const _ of a)this._el.contains(_.target)&&d.push(_);return d}mergeHandlerResult(a,d,_,B,S){if(!_)return;s.e(a,_);const U={handlerName:B,originalEvent:_.originalEvent||S};_.zoomDelta!==void 0&&(d.zoom=U),_.panDelta!==void 0&&(d.drag=U),_.pitchDelta!==void 0&&(d.pitch=U),_.bearingDelta!==void 0&&(d.rotate=U)}_applyChanges(){const a={},d={},_={};for(const[B,S,U]of this._changes)B.panDelta&&(a.panDelta=(a.panDelta||new s.P(0,0))._add(B.panDelta)),B.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+B.zoomDelta),B.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+B.bearingDelta),B.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+B.pitchDelta),B.around!==void 0&&(a.around=B.around),B.pinchAround!==void 0&&(a.pinchAround=B.pinchAround),B.noInertia&&(a.noInertia=B.noInertia),s.e(d,S),s.e(_,U);this._updateMapTransform(a,d,_),this._changes=[]}_updateMapTransform(a,d,_){const B=this._map,S=B._getTransformForUpdate(),U=B.terrain;if(!(Zl(a)||U&&this._terrainMovement))return this._fireEvents(d,_,!0);let{panDelta:H,zoomDelta:q,bearingDelta:w,pitchDelta:I,around:R,pinchAround:j}=a;j!==void 0&&(R=j),B._stop(!0),R=R||B.transform.centerPoint;const Z=S.pointLocation(H?R.sub(H):R);w&&(S.bearing+=w),I&&(S.pitch+=I),q&&(S.zoom+=q),U?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?S.center=S.pointLocation(S.centerPoint.sub(H)):S.setLocationAtPoint(Z,R):(this._terrainMovement=!0,this._map._elevationFreeze=!0,S.setLocationAtPoint(Z,R),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,S.recalculateZoom(B.terrain)})):S.setLocationAtPoint(Z,R),B._applyUpdatedTransform(S),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(d,_,!0)}_fireEvents(a,d,_){const B=bi(this._eventsInProgress),S=bi(a),U={};for(const I in a){const{originalEvent:R}=a[I];this._eventsInProgress[I]||(U[`${I}start`]=R),this._eventsInProgress[I]=a[I]}!B&&S&&this._fireEvent("movestart",S.originalEvent);for(const I in U)this._fireEvent(I,U[I]);S&&this._fireEvent("move",S.originalEvent);for(const I in a){const{originalEvent:R}=a[I];this._fireEvent(I,R)}const H={};let q;for(const I in this._eventsInProgress){const{handlerName:R,originalEvent:j}=this._eventsInProgress[I];this._handlersById[R].isActive()||(delete this._eventsInProgress[I],q=d[R]||j,H[`${I}end`]=q)}for(const I in H)this._fireEvent(I,H[I]);const w=bi(this._eventsInProgress);if(_&&(B||S)&&!w){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!I||!I.essential&&F.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:q})),R(this._map.getBearing())&&this._map.resetNorth()):(R(I.bearing||this._map.getBearing())&&(I.bearing=0),I.freezeElevation=!0,this._map.easeTo(I,{originalEvent:q})),this._updatingCamera=!1}}_fireEvent(a,d){this._map.fire(new s.k(a,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new sr("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Qc extends s.E{constructor(a,d){super(),this._renderFrameCallback=()=>{const _=Math.min((F.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.M(this.transform.center.lng,this.transform.center.lat)}setCenter(a,d){return this.jumpTo({center:a},d)}panBy(a,d,_){return a=s.P.convert(a).mult(-1),this.panTo(this.transform.center,s.e({offset:a},d),_)}panTo(a,d,_){return this.easeTo(s.e({center:a},d),_)}getZoom(){return this.transform.zoom}setZoom(a,d){return this.jumpTo({zoom:a},d),this}zoomTo(a,d,_){return this.easeTo(s.e({zoom:a},d),_)}zoomIn(a,d){return this.zoomTo(this.getZoom()+1,a,d),this}zoomOut(a,d){return this.zoomTo(this.getZoom()-1,a,d),this}getBearing(){return this.transform.bearing}setBearing(a,d){return this.jumpTo({bearing:a},d),this}getPadding(){return this.transform.padding}setPadding(a,d){return this.jumpTo({padding:a},d),this}rotateTo(a,d,_){return this.easeTo(s.e({bearing:a},d),_)}resetNorth(a,d){return this.rotateTo(0,s.e({duration:1e3},a),d),this}resetNorthPitch(a,d){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},a),d),this}snapToNorth(a,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,d):this}getPitch(){return this.transform.pitch}setPitch(a,d){return this.jumpTo({pitch:a},d),this}cameraForBounds(a,d){a=kt.convert(a);const _=d&&d.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),_,d)}_cameraForBoxAndBearing(a,d,_,B){const S={top:0,bottom:0,right:0,left:0};if(typeof(B=s.e({padding:S,offset:[0,0],maxZoom:this.transform.maxZoom},B)).padding=="number"){const pt=B.padding;B.padding={top:pt,bottom:pt,right:pt,left:pt}}B.padding=s.e(S,B.padding);const U=this.transform,H=U.padding,q=new kt(a,d),w=U.project(q.getNorthWest()),I=U.project(q.getNorthEast()),R=U.project(q.getSouthEast()),j=U.project(q.getSouthWest()),Z=s.b7(-_),W=w.rotate(Z),Y=I.rotate(Z),ie=R.rotate(Z),ae=j.rotate(Z),fe=new s.P(Math.max(W.x,Y.x,ae.x,ie.x),Math.max(W.y,Y.y,ae.y,ie.y)),pe=new s.P(Math.min(W.x,Y.x,ae.x,ie.x),Math.min(W.y,Y.y,ae.y,ie.y)),xe=fe.sub(pe),Fe=(U.width-(H.left+H.right+B.padding.left+B.padding.right))/xe.x,Le=(U.height-(H.top+H.bottom+B.padding.top+B.padding.bottom))/xe.y;if(Le<0||Fe<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const nt=Math.min(U.scaleZoom(U.scale*Math.min(Fe,Le)),B.maxZoom),Ke=s.P.convert(B.offset),Re=new s.P((B.padding.left-B.padding.right)/2,(B.padding.top-B.padding.bottom)/2).rotate(s.b7(_)),Qe=Ke.add(Re).mult(U.scale/U.zoomScale(nt));return{center:U.unproject(w.add(R).div(2).sub(Qe)),zoom:nt,bearing:_}}fitBounds(a,d,_){return this._fitInternal(this.cameraForBounds(a,d),d,_)}fitScreenCoordinates(a,d,_,B,S){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(a)),this.transform.pointLocation(s.P.convert(d)),_,B),B,S)}_fitInternal(a,d,_){return a?(delete(d=s.e(a,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(a,d){this.stop();const _=this._getTransformForUpdate();let B=!1,S=!1,U=!1;return"zoom"in a&&_.zoom!==+a.zoom&&(B=!0,_.zoom=+a.zoom),a.center!==void 0&&(_.center=s.M.convert(a.center)),"bearing"in a&&_.bearing!==+a.bearing&&(S=!0,_.bearing=+a.bearing),"pitch"in a&&_.pitch!==+a.pitch&&(U=!0,_.pitch=+a.pitch),a.padding==null||_.isPaddingEqual(a.padding)||(_.padding=a.padding),this._applyUpdatedTransform(_),this.fire(new s.k("movestart",d)).fire(new s.k("move",d)),B&&this.fire(new s.k("zoomstart",d)).fire(new s.k("zoom",d)).fire(new s.k("zoomend",d)),S&&this.fire(new s.k("rotatestart",d)).fire(new s.k("rotate",d)).fire(new s.k("rotateend",d)),U&&this.fire(new s.k("pitchstart",d)).fire(new s.k("pitch",d)).fire(new s.k("pitchend",d)),this.fire(new s.k("moveend",d))}calculateCameraOptionsFromTo(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const S=s.Y.fromLngLat(a,d),U=s.Y.fromLngLat(_,B),H=U.x-S.x,q=U.y-S.y,w=U.z-S.z,I=Math.hypot(H,q,w);if(I===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(H,q),j=this.transform.scaleZoom(this.transform.cameraToCenterDistance/I/this.transform.tileSize),Z=180*Math.atan2(H,-q)/Math.PI;let W=180*Math.acos(R/I)/Math.PI;return W=w<0?90-W:90+W,{center:U.toLngLat(),zoom:j,pitch:W,bearing:Z}}easeTo(a,d){this._stop(!1,a.easeId),((a=s.e({offset:[0,0],duration:500,easing:s.b6},a)).animate===!1||!a.essential&&F.prefersReducedMotion)&&(a.duration=0);const _=this._getTransformForUpdate(),B=this.getZoom(),S=this.getBearing(),U=this.getPitch(),H=this.getPadding(),q="zoom"in a?+a.zoom:B,w="bearing"in a?this._normalizeBearing(a.bearing,S):S,I="pitch"in a?+a.pitch:U,R="padding"in a?a.padding:_.padding,j=s.P.convert(a.offset);let Z=_.centerPoint.add(j);const W=_.pointLocation(Z),Y=s.M.convert(a.center||W);this._normalizeCenter(Y);const ie=_.project(W),ae=_.project(Y).sub(ie),fe=_.zoomScale(q-B);let pe,xe;a.around&&(pe=s.M.convert(a.around),xe=_.locationPoint(pe));const Fe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||q!==B,this._rotating=this._rotating||S!==w,this._pitching=this._pitching||I!==U,this._padding=!_.isPaddingEqual(R),this._easeId=a.easeId,this._prepareEase(d,a.noMoveStart,Fe),this.terrain&&this._prepareElevation(Y),this._ease(Le=>{if(this._zooming&&(_.zoom=s.z.number(B,q,Le)),this._rotating&&(_.bearing=s.z.number(S,w,Le)),this._pitching&&(_.pitch=s.z.number(U,I,Le)),this._padding&&(_.interpolatePadding(H,R,Le),Z=_.centerPoint.add(j)),this.terrain&&!a.freezeElevation&&this._updateElevation(Le),pe)_.setLocationAtPoint(pe,xe);else{const nt=_.zoomScale(_.zoom-B),Ke=q>B?Math.min(2,fe):Math.max(.5,fe),Re=Math.pow(Ke,1-Le),Qe=_.unproject(ie.add(ae.mult(Le*Re)).mult(nt));_.setLocationAtPoint(_.renderWorldCopies?Qe.wrap():Qe,Z)}this._applyUpdatedTransform(_),this._fireMoveEvents(d)},Le=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,Le)},a),this}_prepareEase(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,d||_.moving||this.fire(new s.k("movestart",a)),this._zooming&&!_.zooming&&this.fire(new s.k("zoomstart",a)),this._rotating&&!_.rotating&&this.fire(new s.k("rotatestart",a)),this._pitching&&!_.pitching&&this.fire(new s.k("pitchstart",a))}_prepareElevation(a){this._elevationCenter=a,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(a){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(a<1&&d!==this._elevationTarget){const _=this._elevationTarget-this._elevationStart;this._elevationStart+=a*(_-(d-(_*a+this._elevationStart))/(1-a)),this._elevationTarget=d}this.transform.elevation=s.z.number(this._elevationStart,this._elevationTarget,a)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(a){if(!this.transformCameraUpdate)return;const d=a.clone(),{center:_,zoom:B,pitch:S,bearing:U,elevation:H}=this.transformCameraUpdate(d);_&&(d.center=_),B!==void 0&&(d.zoom=B),S!==void 0&&(d.pitch=S),U!==void 0&&(d.bearing=U),H!==void 0&&(d.elevation=H),this.transform.apply(d)}_fireMoveEvents(a){this.fire(new s.k("move",a)),this._zooming&&this.fire(new s.k("zoom",a)),this._rotating&&this.fire(new s.k("rotate",a)),this._pitching&&this.fire(new s.k("pitch",a))}_afterEase(a,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const _=this._zooming,B=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new s.k("zoomend",a)),B&&this.fire(new s.k("rotateend",a)),S&&this.fire(new s.k("pitchend",a)),this.fire(new s.k("moveend",a))}flyTo(a,d){if(!a.essential&&F.prefersReducedMotion){const Dt=s.L(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Dt,d)}this.stop(),a=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.b6},a);const _=this._getTransformForUpdate(),B=this.getZoom(),S=this.getBearing(),U=this.getPitch(),H=this.getPadding(),q="zoom"in a?s.ac(+a.zoom,_.minZoom,_.maxZoom):B,w="bearing"in a?this._normalizeBearing(a.bearing,S):S,I="pitch"in a?+a.pitch:U,R="padding"in a?a.padding:_.padding,j=_.zoomScale(q-B),Z=s.P.convert(a.offset);let W=_.centerPoint.add(Z);const Y=_.pointLocation(W),ie=s.M.convert(a.center||Y);this._normalizeCenter(ie);const ae=_.project(Y),fe=_.project(ie).sub(ae);let pe=a.curve;const xe=Math.max(_.width,_.height),Fe=xe/j,Le=fe.mag();if("minZoom"in a){const Dt=s.ac(Math.min(a.minZoom,B,q),_.minZoom,_.maxZoom),hi=xe/_.zoomScale(Dt-B);pe=Math.sqrt(hi/Le*2)}const nt=pe*pe;function Ke(Dt){const hi=(Fe*Fe-xe*xe+(Dt?-1:1)*nt*nt*Le*Le)/(2*(Dt?Fe:xe)*nt*Le);return Math.log(Math.sqrt(hi*hi+1)-hi)}function Re(Dt){return(Math.exp(Dt)-Math.exp(-Dt))/2}function Qe(Dt){return(Math.exp(Dt)+Math.exp(-Dt))/2}const pt=Ke(!1);let bt=function(Dt){return Qe(pt)/Qe(pt+pe*Dt)},ht=function(Dt){return xe*((Qe(pt)*(Re(hi=pt+pe*Dt)/Qe(hi))-Re(pt))/nt)/Le;var hi},Rt=(Ke(!0)-pt)/pe;if(Math.abs(Le)<1e-6||!isFinite(Rt)){if(Math.abs(xe-Fe)<1e-6)return this.easeTo(a,d);const Dt=Fe<xe?-1:1;Rt=Math.abs(Math.log(Fe/xe))/pe,ht=function(){return 0},bt=function(hi){return Math.exp(Dt*pe*hi)}}return a.duration="duration"in a?+a.duration:1e3*Rt/("screenSpeed"in a?+a.screenSpeed/pe:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=S!==w,this._pitching=I!==U,this._padding=!_.isPaddingEqual(R),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(ie),this._ease(Dt=>{const hi=Dt*Rt,Vt=1/bt(hi);_.zoom=Dt===1?q:B+_.scaleZoom(Vt),this._rotating&&(_.bearing=s.z.number(S,w,Dt)),this._pitching&&(_.pitch=s.z.number(U,I,Dt)),this._padding&&(_.interpolatePadding(H,R,Dt),W=_.centerPoint.add(Z)),this.terrain&&!a.freezeElevation&&this._updateElevation(Dt);const _i=Dt===1?ie:_.unproject(ae.add(fe.mult(ht(hi))).mult(Vt));_.setLocationAtPoint(_.renderWorldCopies?_i.wrap():_i,W),this._applyUpdatedTransform(_),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const _=this._onEaseEnd;delete this._onEaseEnd,_.call(this,d)}if(!a){const _=this.handlers;_&&_.stop(!1)}return this}_ease(a,d,_){_.animate===!1||_.duration===0?(a(1),d()):(this._easeStart=F.now(),this._easeOptions=_,this._onEaseFrame=a,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(a,d){a=s.b0(a,-180,180);const _=Math.abs(a-d);return Math.abs(a-360-d)<_&&(a-=360),Math.abs(a+360-d)<_&&(a+=360),a}_normalizeCenter(a){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const _=a.lng-d.center.lng;a.lng+=_>180?-360:_<-180?360:0}queryTerrainElevation(a){return this.terrain?this.terrain.getElevationForLngLatZoom(s.M.convert(a),this.transform.tileZoom)-this.transform.elevation:null}}const Es={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class bh{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Es;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=a}getDefaultPosition(){return"bottom-right"}onAdd(a){return this._map=a,this._compact=this.options.compact,this._container=k.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=k.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=k.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){k.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(a,d){const _=this._map._getUIString(`AttributionControl.${d}`);a.title=_,a.setAttribute("aria-label",_)}_updateAttributions(){if(!this._map.style)return;let a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(B=>typeof B!="string"?"":B)):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){const B=this._map.style.stylesheet;this.styleOwner=B.owner,this.styleId=B.id}const d=this._map.style.sourceCaches;for(const B in d){const S=d[B];if(S.used||S.usedForTerrain){const U=S.getSource();U.attribution&&a.indexOf(U.attribution)<0&&a.push(U.attribution)}}a=a.filter(B=>String(B).trim()),a.sort((B,S)=>B.length-S.length),a=a.filter((B,S)=>{for(let U=S+1;U<a.length;U++)if(a[U].indexOf(B)>=0)return!1;return!0});const _=a.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,a.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class qn{constructor(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const d=this._container.children;if(d.length){const _=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&_.classList.add("maplibregl-compact"):_.classList.remove("maplibregl-compact")}},this.options=a}getDefaultPosition(){return"bottom-left"}onAdd(a){this._map=a,this._compact=this.options&&this.options.compact,this._container=k.create("div","maplibregl-ctrl");const d=k.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){k.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class hu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const d=++this._id;return this._queue.push({callback:a,id:d,cancelled:!1}),d}remove(a){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const B of _)if(B.id===a)return void(B.cancelled=!0)}run(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var $i=s.X([{name:"a_pos3d",type:"Int16",components:3}]);class Ni extends s.E{constructor(a){super(),this.sourceCache=a,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,a.usedForTerrain=!0,a.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(a,d){this.sourceCache.update(a,d),this._renderableTilesKeys=[];const _={};for(const B of a.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))_[B.key]=!0,this._renderableTilesKeys.push(B.key),this._tiles[B.key]||(B.posMatrix=new Float64Array(16),s.aN(B.posMatrix,0,s.W,0,s.W,0,1),this._tiles[B.key]=new Ji(B,this.tileSize));for(const B in this._tiles)_[B]||delete this._tiles[B]}freeRtt(a){for(const d in this._tiles){const _=this._tiles[d];(!a||_.tileID.equals(a)||_.tileID.isChildOf(a)||a.isChildOf(_.tileID))&&(_.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(a=>this.getTileByID(a))}getTileByID(a){return this._tiles[a]}getTerrainCoords(a){const d={};for(const _ of this._renderableTilesKeys){const B=this._tiles[_].tileID;if(B.canonical.equals(a.canonical)){const S=a.clone();S.posMatrix=new Float64Array(16),s.aN(S.posMatrix,0,s.W,0,s.W,0,1),d[_]=S}else if(B.canonical.isChildOf(a.canonical)){const S=a.clone();S.posMatrix=new Float64Array(16);const U=B.canonical.z-a.canonical.z,H=B.canonical.x-(B.canonical.x>>U<<U),q=B.canonical.y-(B.canonical.y>>U<<U),w=s.W>>U;s.aN(S.posMatrix,0,w,0,w,0,1),s.H(S.posMatrix,S.posMatrix,[-H*w,-q*w,0]),d[_]=S}else if(a.canonical.isChildOf(B.canonical)){const S=a.clone();S.posMatrix=new Float64Array(16);const U=a.canonical.z-B.canonical.z,H=a.canonical.x-(a.canonical.x>>U<<U),q=a.canonical.y-(a.canonical.y>>U<<U),w=s.W>>U;s.aN(S.posMatrix,0,s.W,0,s.W,0,1),s.H(S.posMatrix,S.posMatrix,[H*w,q*w,0]),s.J(S.posMatrix,S.posMatrix,[1/2**U,1/2**U,0]),d[_]=S}}return d}getSourceTile(a,d){const _=this.sourceCache._source;let B=a.overscaledZ-this.deltaZoom;if(B>_.maxzoom&&(B=_.maxzoom),B<_.minzoom)return null;this._sourceTileCache[a.key]||(this._sourceTileCache[a.key]=a.scaledTo(B).key);let S=this.sourceCache.getTileByID(this._sourceTileCache[a.key]);if((!S||!S.dem)&&d)for(;B>=_.minzoom&&(!S||!S.dem);)S=this.sourceCache.getTileByID(a.scaledTo(B--).key);return S}tilesAfterTime(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(d=>d.timeAdded>=a)}}class $n{constructor(a,d,_){this.painter=a,this.sourceCache=new Ni(d),this.options=_,this.exaggeration=typeof _.exaggeration=="number"?_.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.W;var S;if(!(d>=0&&d<B&&_>=0&&_<B))return 0;const U=this.getTerrainData(a),H=(S=U.tile)===null||S===void 0?void 0:S.dem;if(!H)return 0;const q=function(W,Y,ie){var ae=Y[0],fe=Y[1];return W[0]=ie[0]*ae+ie[4]*fe+ie[12],W[1]=ie[1]*ae+ie[5]*fe+ie[13],W}([],[d/B*s.W,_/B*s.W],U.u_terrain_matrix),w=[q[0]*H.dim,q[1]*H.dim],I=Math.floor(w[0]),R=Math.floor(w[1]),j=w[0]-I,Z=w[1]-R;return H.get(I,R)*(1-j)*(1-Z)+H.get(I+1,R)*j*(1-Z)+H.get(I,R+1)*(1-j)*Z+H.get(I+1,R+1)*j*Z}getElevationForLngLatZoom(a,d){const{tileID:_,mercatorX:B,mercatorY:S}=this._getOverscaledTileIDFromLngLatZoom(a,d);return this.getElevation(_,B%s.W,S%s.W,s.W)}getElevation(a,d,_){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.W;return this.getDEMElevation(a,d,_,B)*this.exaggeration}getTerrainData(a){if(!this._emptyDemTexture){const B=this.painter.context,S=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Me(B,S,B.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Me(B,new s.R({width:1,height:1}),B.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(B.gl.NEAREST,B.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.an([])}const d=this.sourceCache.getSourceTile(a,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const B=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new Me(B,d.dem.getPixels(),B.gl.RGBA,{premultiply:!1}),d.demTexture.bind(B.gl.NEAREST,B.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const _=d&&d+d.tileID.key+a.key;if(_&&!this._demMatrixCache[_]){const B=this.sourceCache.sourceCache._source.maxzoom;let S=a.canonical.z-d.tileID.canonical.z;a.overscaledZ>a.canonical.z&&(a.canonical.z>=B?S=a.canonical.z-B:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const U=a.canonical.x-(a.canonical.x>>S<<S),H=a.canonical.y-(a.canonical.y>>S<<S),q=s.b8(new Float64Array(16),[1/(s.W<<S),1/(s.W<<S),0]);s.H(q,q,[U*s.W,H*s.W,0]),this._demMatrixCache[a.key]={matrix:q,coord:a}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:_?this._demMatrixCache[a.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(a){const d=this.painter,_=d.width/devicePixelRatio,B=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===_&&this._fbo.height===B||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Me(d.context,{width:_,height:B,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Me(d.context,{width:_,height:B,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(_,B,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,_,B))),this._fbo.colorAttachment.set(a==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const a=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let S=0,U=0;S<this._coordsTextureSize;S++)for(let H=0;H<this._coordsTextureSize;H++,U+=4)d[U+0]=255&H,d[U+1]=255&S,d[U+2]=H>>8<<4|S>>8,d[U+3]=0;const _=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),B=new Me(a,_,a.gl.RGBA,{premultiply:!1});return B.bind(a.gl.NEAREST,a.gl.CLAMP_TO_EDGE),this._coordsTexture=B,B}pointCoordinate(a){const d=new Uint8Array(4),_=this.painter.context,B=_.gl;_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),B.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,B.RGBA,B.UNSIGNED_BYTE,d),_.bindFramebuffer.set(null);const S=d[0]+(d[2]>>4<<8),U=d[1]+((15&d[2])<<8),H=this.coordsIndex[255-d[3]],q=H&&this.sourceCache.getTileByID(H);if(!q)return null;const w=this._coordsTextureSize,I=(1<<q.tileID.canonical.z)*w;return new s.Y((q.tileID.canonical.x*w+S)/I+q.tileID.wrap,(q.tileID.canonical.y*w+U)/I,this.getElevation(q.tileID,S,U,w))}depthAtPoint(a){const d=new Uint8Array(4),_=this.painter.context,B=_.gl;return _.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),B.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,B.RGBA,B.UNSIGNED_BYTE,d),_.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const a=this.painter.context,d=new s.b9,_=new s.aX,B=this.meshSize,S=s.W/B,U=B*B;for(let R=0;R<=B;R++)for(let j=0;j<=B;j++)d.emplaceBack(j*S,R*S,0);for(let R=0;R<U;R+=B+1)for(let j=0;j<B;j++)_.emplaceBack(j+R,B+j+R+1,B+j+R+2),_.emplaceBack(j+R,B+j+R+2,j+R+1);const H=d.length,q=H+2*(B+1);for(const R of[0,1])for(let j=0;j<=B;j++)for(const Z of[0,1])d.emplaceBack(j*S,R*s.W,Z);for(let R=0;R<2*B;R+=2)_.emplaceBack(q+R,q+R+1,q+R+3),_.emplaceBack(q+R,q+R+3,q+R+2),_.emplaceBack(H+R,H+R+3,H+R+1),_.emplaceBack(H+R,H+R+2,H+R+3);const w=d.length,I=w+2*(B+1);for(const R of[0,1])for(let j=0;j<=B;j++)for(const Z of[0,1])d.emplaceBack(R*s.W,j*S,Z);for(let R=0;R<2*B;R+=2)_.emplaceBack(w+R,w+R+1,w+R+3),_.emplaceBack(w+R,w+R+3,w+R+2),_.emplaceBack(I+R,I+R+3,I+R+1),_.emplaceBack(I+R,I+R+2,I+R+3);return this._mesh={indexBuffer:a.createIndexBuffer(_),vertexBuffer:a.createVertexBuffer(d,$i.members),segments:s.$.simpleSegment(0,0,d.length,_.length)},this._mesh}getMeshFrameDelta(a){return 2*Math.PI*s.ba/Math.pow(2,a)/5}getMinTileElevationForLngLatZoom(a,d){var _;const{tileID:B}=this._getOverscaledTileIDFromLngLatZoom(a,d);return(_=this.getMinMaxElevation(B).minElevation)!==null&&_!==void 0?_:0}getMinMaxElevation(a){const d=this.getTerrainData(a).tile,_={minElevation:null,maxElevation:null};return d&&d.dem&&(_.minElevation=d.dem.min*this.exaggeration,_.maxElevation=d.dem.max*this.exaggeration),_}_getOverscaledTileIDFromLngLatZoom(a,d){const _=s.Y.fromLngLat(a.wrap()),B=(1<<d)*s.W,S=_.x*B,U=_.y*B,H=Math.floor(S/s.W),q=Math.floor(U/s.W);return{tileID:new s.Q(d,0,d,H,q),mercatorX:S,mercatorY:U}}}class Uu{constructor(a,d,_){this._context=a,this._size=d,this._tileSize=_,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const a of this._objects)a.texture.destroy(),a.fbo.destroy()}_createObject(a){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),_=new Me(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return _.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(_.texture),{id:a,fbo:d,texture:_,stamp:-1,inUse:!1}}getObjectForId(a){return this._objects[a]}useObject(a){a.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>a.id!==d),this._recentlyUsed.push(a.id)}stampObject(a){a.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const a=this._createObject(this._objects.length);return this._objects.push(a),a}freeObject(a){a.inUse=!1}freeAllObjects(){for(const a of this._objects)this.freeObject(a)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(a=>!a.inUse)===!1}}const Rs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class tn{constructor(a,d){this.painter=a,this.terrain=d,this.pool=new Uu(a.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(a){return this.pool.getObjectForId(a.rtt[this._stacks.length-1].id).texture}prepareForRender(a,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=a._order.filter(_=>!a._layers[_].isHidden(d)),this._coordsDescendingInv={};for(const _ in a.sourceCaches){this._coordsDescendingInv[_]={};const B=a.sourceCaches[_].getVisibleCoordinates();for(const S of B){const U=this.terrain.sourceCache.getTerrainCoords(S);for(const H in U)this._coordsDescendingInv[_][H]||(this._coordsDescendingInv[_][H]=[]),this._coordsDescendingInv[_][H].push(U[H])}}this._coordsDescendingInvStr={};for(const _ of a._order){const B=a._layers[_],S=B.source;if(Rs[B.type]&&!this._coordsDescendingInvStr[S]){this._coordsDescendingInvStr[S]={};for(const U in this._coordsDescendingInv[S])this._coordsDescendingInvStr[S][U]=this._coordsDescendingInv[S][U].map(H=>H.key).sort().join()}}for(const _ of this._renderableTiles)for(const B in this._coordsDescendingInvStr){const S=this._coordsDescendingInvStr[B][_.tileID.key];S&&S!==_.rttCoords[B]&&(_.rtt=[])}}renderLayer(a){if(a.isHidden(this.painter.transform.zoom))return!1;const d=a.type,_=this.painter,B=this._renderableLayerIds[this._renderableLayerIds.length-1]===a.id;if(Rs[d]&&(this._prevType&&Rs[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(a.id),!B))return!0;if(Rs[this._prevType]||Rs[d]&&B){this._prevType=d;const S=this._stacks.length-1,U=this._stacks[S]||[];for(const H of this._renderableTiles){if(this.pool.isFull()&&(fl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(H),H.rtt[S]){const w=this.pool.getObjectForId(H.rtt[S].id);if(w.stamp===H.rtt[S].stamp){this.pool.useObject(w);continue}}const q=this.pool.getOrCreateFreeObject();this.pool.useObject(q),this.pool.stampObject(q),H.rtt[S]={id:q.id,stamp:q.stamp},_.context.bindFramebuffer.set(q.fbo.framebuffer),_.context.clear({color:s.aO.transparent,stencil:0}),_.currentStencilSource=void 0;for(let w=0;w<U.length;w++){const I=_.style._layers[U[w]],R=I.source?this._coordsDescendingInv[I.source][H.tileID.key]:[H.tileID];_.context.viewport.set([0,0,q.fbo.width,q.fbo.height]),_._renderTileClippingMasks(I,R),_.renderLayer(_,_.style.sourceCaches[I.source],I,R),I.source&&(H.rttCoords[I.source]=this._coordsDescendingInvStr[I.source][H.tileID.key])}}return fl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Rs[d]}return!1}}const Yo={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ro=g,Au={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Es,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},ks=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Jr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Nn{constructor(a,d){let _=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=U=>{this.startMouse(s.e({},U,{ctrlKey:!0,preventDefault:()=>U.preventDefault()}),k.mousePos(this.element,U)),k.addEventListener(window,"mousemove",this.mousemove),k.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=U=>{this.moveMouse(U,k.mousePos(this.element,U))},this.mouseup=U=>{this.mouseRotate.dragEnd(U),this.mousePitch&&this.mousePitch.dragEnd(U),this.offTemp()},this.touchstart=U=>{U.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=k.touchPos(this.element,U.targetTouches)[0],this.startTouch(U,this._startPos),k.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.addEventListener(window,"touchend",this.touchend))},this.touchmove=U=>{U.targetTouches.length!==1?this.reset():(this._lastPos=k.touchPos(this.element,U.targetTouches)[0],this.moveTouch(U,this._lastPos))},this.touchend=U=>{U.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const B=a.dragRotate._mouseRotate.getClickTolerance(),S=a.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=gl({clickTolerance:B,enable:!0}),this.touchRotate=(U=>{let{enable:H,clickTolerance:q,bearingDegreesPerPixelMoved:w=.8}=U;const I=new Jo;return new go({clickTolerance:q,move:(R,j)=>({bearingDelta:(j.x-R.x)*w}),moveStateManager:I,enable:H,assignEvents:ks})})({clickTolerance:B,enable:!0}),this.map=a,_&&(this.mousePitch=$l({clickTolerance:S,enable:!0}),this.touchPitch=(U=>{let{enable:H,clickTolerance:q,pitchDegreesPerPixelMoved:w=-.5}=U;const I=new Jo;return new go({clickTolerance:q,move:(R,j)=>({pitchDelta:(j.y-R.y)*w}),moveStateManager:I,enable:H,assignEvents:ks})})({clickTolerance:S,enable:!0})),k.addEventListener(d,"mousedown",this.mousedown),k.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),k.addEventListener(d,"touchcancel",this.reset)}startMouse(a,d){this.mouseRotate.dragStart(a,d),this.mousePitch&&this.mousePitch.dragStart(a,d),k.disableDrag()}startTouch(a,d){this.touchRotate.dragStart(a,d),this.touchPitch&&this.touchPitch.dragStart(a,d),k.disableDrag()}moveMouse(a,d){const _=this.map,{bearingDelta:B}=this.mouseRotate.dragMove(a,d)||{};if(B&&_.setBearing(_.getBearing()+B),this.mousePitch){const{pitchDelta:S}=this.mousePitch.dragMove(a,d)||{};S&&_.setPitch(_.getPitch()+S)}}moveTouch(a,d){const _=this.map,{bearingDelta:B}=this.touchRotate.dragMove(a,d)||{};if(B&&_.setBearing(_.getBearing()+B),this.touchPitch){const{pitchDelta:S}=this.touchPitch.dragMove(a,d)||{};S&&_.setPitch(_.getPitch()+S)}}off(){const a=this.element;k.removeEventListener(a,"mousedown",this.mousedown),k.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend),k.removeEventListener(a,"touchcancel",this.reset),this.offTemp()}offTemp(){k.enableDrag(),k.removeEventListener(window,"mousemove",this.mousemove),k.removeEventListener(window,"mouseup",this.mouseup),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend)}}let ko;function ml(y,a,d){const _=new s.M(y.lng,y.lat);if(y=new s.M(y.lng,y.lat),a){const B=new s.M(y.lng-360,y.lat),S=new s.M(y.lng+360,y.lat),U=d.locationPoint(y).distSqr(a);d.locationPoint(B).distSqr(a)<U?y=B:d.locationPoint(S).distSqr(a)<U&&(y=S)}for(;Math.abs(y.lng-d.center.lng)>180;){const B=d.locationPoint(y);if(B.x>=0&&B.y>=0&&B.x<=d.width&&B.y<=d.height)break;y.lng>d.center.lng?y.lng-=360:y.lng+=360}return y.lng!==_.lng&&d.locationPoint(y).y>d.height/2-d.getHorizon()?y:_}const rl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Da(y,a,d){const _=y.classList;for(const B in rl)_.remove(`maplibregl-${d}-anchor-${B}`);_.add(`maplibregl-${d}-anchor-${a}`)}class Jl extends s.E{constructor(a){if(super(),this._onKeyPress=d=>{const _=d.code,B=d.charCode||d.keyCode;_!=="Space"&&_!=="Enter"&&B!==32&&B!==13||this.togglePopup()},this._onMapClick=d=>{const _=d.originalEvent.target,B=this._element;this._popup&&(_===B||B.contains(_))&&this.togglePopup()},this._update=d=>{if(!this._map)return;const _=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!_)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=ml(this._lngLat,this._flatPos,this._map.transform)),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let B="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?B=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(B=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),k.setTransform(this._element,`${rl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${B}`),F.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const _=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=_}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(a==null?void 0:a.opacity,a==null?void 0:a.opacityWhenCovered),a&&a.element)this._element=a.element,this._offset=s.P.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=k.create("div"),this._element.setAttribute("aria-label","Map marker");const d=k.createNS("http://www.w3.org/2000/svg","svg"),_=41,B=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${_}px`),d.setAttributeNS(null,"width",`${B}px`),d.setAttributeNS(null,"viewBox",`0 0 ${B} ${_}`);const S=k.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const U=k.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"fill-rule","nonzero");const H=k.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(3.0, 29.0)"),H.setAttributeNS(null,"fill","#000000");const q=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ae of q){const fe=k.createNS("http://www.w3.org/2000/svg","ellipse");fe.setAttributeNS(null,"opacity","0.04"),fe.setAttributeNS(null,"cx","10.5"),fe.setAttributeNS(null,"cy","5.80029008"),fe.setAttributeNS(null,"rx",ae.rx),fe.setAttributeNS(null,"ry",ae.ry),H.appendChild(fe)}const w=k.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill",this._color);const I=k.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),w.appendChild(I);const R=k.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const j=k.createNS("http://www.w3.org/2000/svg","path");j.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(j);const Z=k.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Z.setAttributeNS(null,"fill","#FFFFFF");const W=k.createNS("http://www.w3.org/2000/svg","g");W.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Y=k.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#000000"),Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962");const ie=k.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#FFFFFF"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962"),W.appendChild(Y),W.appendChild(ie),U.appendChild(H),U.appendChild(w),U.appendChild(R),U.appendChild(Z),U.appendChild(W),d.appendChild(U),d.setAttributeNS(null,"height",_*this._scale+"px"),d.setAttributeNS(null,"width",B*this._scale+"px"),this._element.appendChild(d),this._offset=s.P.convert(a&&a.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),Da(this._element,this._anchor,"marker"),a&&a.className)for(const d of a.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),a.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),k.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=s.M.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const B=Math.abs(13.5)/Math.SQRT2;a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[B,-1*(38.1-13.5+B)],"bottom-right":[-B,-1*(38.1-13.5+B)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?a.remove():a.addTo(this._map),this):this}_updateOpacity(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var d;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(a)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const _=this._map,B=_.terrain.depthAtPoint(this._pos),S=_.terrain.getElevationForLngLatZoom(this._lngLat,_.transform.tileZoom);if(_.transform.lngLatToCameraDepth(this._lngLat,S)-B<.006)return void(this._element.style.opacity=this._opacity);const U=-this._offset.y/_.transform._pixelPerMeter,H=Math.sin(_.getPitch()*Math.PI/180)*U,q=_.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),w=_.transform.lngLatToCameraDepth(this._lngLat,S+H);this._element.style.opacity=w-q>.006?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(a){return this._offset=s.P.convert(a),this._update(),this}addClassName(a){this._element.classList.add(a)}removeClassName(a){this._element.classList.remove(a)}toggleClassName(a){return this._element.classList.toggle(a)}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(a,d){return a===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),a!==void 0&&(this._opacity=a),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const du={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let yo=0,va=!1;const yl={maxWidth:100,unit:"metric"};function Gr(y,a,d){const _=d&&d.maxWidth||100,B=y._container.clientHeight/2,S=y.unproject([0,B]),U=y.unproject([_,B]),H=S.distanceTo(U);if(d&&d.unit==="imperial"){const q=3.2808*H;q>5280?N(a,_,q/5280,y._getUIString("ScaleControl.Miles")):N(a,_,q,y._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?N(a,_,H/1852,y._getUIString("ScaleControl.NauticalMiles")):H>=1e3?N(a,_,H/1e3,y._getUIString("ScaleControl.Kilometers")):N(a,_,H,y._getUIString("ScaleControl.Meters"))}function N(y,a,d,_){const B=function(S){const U=Math.pow(10,`${Math.floor(S)}`.length-1);let H=S/U;return H=H>=10?10:H>=5?5:H>=3?3:H>=2?2:H>=1?1:function(q){const w=Math.pow(10,Math.ceil(-Math.log(q)/Math.LN10));return Math.round(q*w)/w}(H),U*H}(d);y.style.width=a*(B/d)+"px",y.innerHTML=`${B}&nbsp;${_}`}const A={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},x=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function L(y){if(y){if(typeof y=="number"){const a=Math.round(Math.abs(y)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,y),"top-left":new s.P(a,a),"top-right":new s.P(-a,a),bottom:new s.P(0,-y),"bottom-left":new s.P(a,-a),"bottom-right":new s.P(-a,-a),left:new s.P(y,0),right:new s.P(-y,0)}}if(y instanceof s.P||Array.isArray(y)){const a=s.P.convert(y);return{center:a,top:a,"top-left":a,"top-right":a,bottom:a,"bottom-left":a,"bottom-right":a,left:a,right:a}}return{center:s.P.convert(y.center||[0,0]),top:s.P.convert(y.top||[0,0]),"top-left":s.P.convert(y["top-left"]||[0,0]),"top-right":s.P.convert(y["top-right"]||[0,0]),bottom:s.P.convert(y.bottom||[0,0]),"bottom-left":s.P.convert(y["bottom-left"]||[0,0]),"bottom-right":s.P.convert(y["bottom-right"]||[0,0]),left:s.P.convert(y.left||[0,0]),right:s.P.convert(y.right||[0,0])}}return L(new s.P(0,0))}const O=g;l.AJAXError=s.bd,l.Evented=s.E,l.LngLat=s.M,l.MercatorCoordinate=s.Y,l.Point=s.P,l.addProtocol=s.be,l.config=s.a,l.removeProtocol=s.bf,l.AttributionControl=bh,l.BoxZoomHandler=Zr,l.CanvasSource=li,l.CooperativeGesturesHandler=Ks,l.DoubleClickZoomHandler=Do,l.DragPanHandler=gc,l.DragRotateHandler=uu,l.EdgeInsets=Mo,l.FullscreenControl=class extends s.E{constructor(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){k.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=k.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);k.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},l.GeoJSONSource=ut,l.GeolocateControl=class extends s.E{constructor(y){super(),this._onSuccess=a=>{if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",a)),this._finish()}},this._updateCamera=a=>{const d=new s.M(a.coords.longitude,a.coords.latitude),_=a.coords.accuracy,B=this._map.getBearing(),S=s.e({bearing:B},this.options.fitBoundsOptions),U=kt.fromLngLat(d,_);this._map.fitBounds(U,S,{geolocateSource:!0})},this._updateMarker=a=>{if(a){const d=new s.M(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=a=>{if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&va)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",a)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=a=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=k.create("button","maplibregl-ctrl-geolocate",this._container),k.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",a===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Jl({element:this._dotElement}),this._circleElement=k.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Jl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},du,y)}onAdd(y){return this._map=y,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return s._(this,void 0,void 0,function*(){if(ko!==void 0&&!a)return ko;if(window.navigator.permissions===void 0)return ko=!!window.navigator.geolocation,ko;try{ko=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ko=!!window.navigator.geolocation}return ko})}().then(a=>this._setupUI(a)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),k.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,yo=0,va=!1}_isOutOfMapMaxBounds(y){const a=this._map.getMaxBounds(),d=y.coords;return a&&(d.longitude<a.getWest()||d.longitude>a.getEast()||d.latitude<a.getSouth()||d.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),a=y.getSouthEast(),d=y.getNorthEast(),_=a.distanceTo(d),B=Math.ceil(this._accuracy/(_/this._map._container.clientHeight)*2);this._circleElement.style.width=`${B}px`,this._circleElement.style.height=`${B}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":yo--,va=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),yo++,yo>1?(y={maximumAge:6e5,timeout:0},va=!0):(y=this.options.positionOptions,va=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},l.Hash=pl,l.ImageSource=ni,l.KeyboardHandler=Nc,l.LngLatBounds=kt,l.LogoControl=qn,l.Map=class extends Qc{constructor(y){if(s.bb.mark(s.bc.create),(y=s.e({},Au,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Po(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=a=>{a.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.k("webglcontextlost",{originalEvent:a}))},this._contextRestored=a=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:a}))},this._onMapScroll=a=>{if(a.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new hu,this._controls=[],this._mapId=s.a3(),this._locale=s.e({},Yo,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=_e.addThrottleControl(()=>this.isMoving()),this._requestManager=new He(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let a=!1;const d=ga(_=>{this._trackResize&&!this._removed&&this.resize(_)._update()},50);this._resizeObserver=new ResizeObserver(_=>{a?d(_):a=!0}),this._resizeObserver.observe(this._container)}this.handlers=new zc(this,y),this._hash=y.hash&&new pl(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,s.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new bh(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new qn,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new s.k(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new s.k(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new s.k("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(y,a){if(a===void 0&&(a=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=y.onAdd(this);this._controls.push(y);const _=this._controlPositions[a];return a.indexOf("bottom")!==-1?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(y);return a>-1&&this._controls.splice(a,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,a,d,_){return _==null&&this.terrain&&(_=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,a,d,_)}resize(y){var a;const d=this._containerDimensions(),_=d[0],B=d[1],S=this._getClampedPixelRatio(_,B);if(this._resizeCanvas(_,B,S),this.painter.resize(_,B,S),this.painter.overLimit()){const H=this.painter.context.gl;this._maxCanvasSize=[H.drawingBufferWidth,H.drawingBufferHeight];const q=this._getClampedPixelRatio(_,B);this._resizeCanvas(_,B,q),this.painter.resize(_,B,q)}this.transform.resize(_,B),(a=this._requestedCameraState)===null||a===void 0||a.resize(_,B);const U=!this._moving;return U&&(this.stop(),this.fire(new s.k("movestart",y)).fire(new s.k("move",y))),this.fire(new s.k("resize",y)),U&&this.fire(new s.k("moveend",y)),this}_getClampedPixelRatio(y,a){const{0:d,1:_}=this._maxCanvasSize,B=this.getPixelRatio(),S=y*B,U=a*B;return Math.min(S>d?d/S:1,U>_?_/U:1)*B}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(kt.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(s.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(s.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,a,d){if(y==="mouseenter"||y==="mouseover"){let _=!1;return{layer:a,listener:d,delegates:{mousemove:S=>{const U=this.getLayer(a)?this.queryRenderedFeatures(S.point,{layers:[a]}):[];U.length?_||(_=!0,d.call(this,new Tn(y,this,S.originalEvent,{features:U}))):_=!1},mouseout:()=>{_=!1}}}}if(y==="mouseleave"||y==="mouseout"){let _=!1;return{layer:a,listener:d,delegates:{mousemove:U=>{(this.getLayer(a)?this.queryRenderedFeatures(U.point,{layers:[a]}):[]).length?_=!0:_&&(_=!1,d.call(this,new Tn(y,this,U.originalEvent)))},mouseout:U=>{_&&(_=!1,d.call(this,new Tn(y,this,U.originalEvent)))}}}}{const _=B=>{const S=this.getLayer(a)?this.queryRenderedFeatures(B.point,{layers:[a]}):[];S.length&&(B.features=S,d.call(this,B),delete B.features)};return{layer:a,listener:d,delegates:{[y]:_}}}}on(y,a,d){if(d===void 0)return super.on(y,a);const _=this._createDelegatedListener(y,a,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(_);for(const B in _.delegates)this.on(B,_.delegates[B]);return this}once(y,a,d){if(d===void 0)return super.once(y,a);const _=this._createDelegatedListener(y,a,d);for(const B in _.delegates)this.once(B,_.delegates[B]);return this}off(y,a,d){return d===void 0?super.off(y,a):(this._delegatedListeners&&this._delegatedListeners[y]&&(_=>{const B=this._delegatedListeners[y];for(let S=0;S<B.length;S++){const U=B[S];if(U.layer===a&&U.listener===d){for(const H in U.delegates)this.off(H,U.delegates[H]);return B.splice(S,1),this}}})(),this)}queryRenderedFeatures(y,a){if(!this.style)return[];let d;const _=y instanceof s.P||Array.isArray(y),B=_?y:[[0,0],[this.transform.width,this.transform.height]];if(a=a||(_?{}:y)||{},B instanceof s.P||typeof B[0]=="number")d=[s.P.convert(B)];else{const S=s.P.convert(B[0]),U=s.P.convert(B[1]);d=[S,new s.P(U.x,S.y),U,new s.P(S.x,U.y),S]}return this.style.queryRenderedFeatures(d,a,this.transform)}querySourceFeatures(y,a){return this.style.querySourceFeatures(y,a)}setStyle(y,a){return(a=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._updateStyle(y,a))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const a=this._locale[y];if(a==null)throw new Error(`Missing UI string '${y}'`);return a}_updateStyle(y,a){if(a.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,a));const d=this.style&&a.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Hn(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,a,d):this.style.loadJSON(y,a,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Hn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,a){if(typeof y=="string"){const d=this._requestManager.transformRequest(y,Ee.Style);s.h(d,new AbortController).then(_=>{this._updateDiff(_.data,a)}).catch(_=>{_&&this.fire(new s.j(_))})}else typeof y=="object"&&this._updateDiff(y,a)}_updateDiff(y,a){try{this.style.setState(y,a)&&this._update(!0)}catch(d){s.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(y,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(y,a){return this._lazyInitEmptyStyle(),this.style.addSource(y,a),this._update(!0)}isSourceLoaded(y){const a=this.style&&this.style.sourceCaches[y];if(a!==void 0)return a.loaded();this.fire(new s.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const a=this.style.sourceCaches[y.source];if(!a)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&a.reload();for(const d in this.style._layers){const _=this.style._layers[d];_.type==="hillshade"&&_.source===y.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new $n(this.painter,a,y),this.painter.renderToTexture=new tn(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:y})),this}getTerrain(){var y,a;return(a=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&a!==void 0?a:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const a in y){const d=y[a]._tiles;for(const _ in d){const B=d[_];if(B.state!=="loaded"&&B.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:_=1,sdf:B=!1,stretchX:S,stretchY:U,content:H}=d;if(this._lazyInitEmptyStyle(),!(a instanceof HTMLImageElement||s.b(a))){if(a.width===void 0||a.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:q,height:w,data:I}=a,R=a;return this.style.addImage(y,{data:new s.R({width:q,height:w},new Uint8Array(I)),pixelRatio:_,stretchX:S,stretchY:U,content:H,sdf:B,version:0,userImage:R}),R.onAdd&&R.onAdd(this,y),this}}{const{width:q,height:w,data:I}=F.getImageData(a);this.style.addImage(y,{data:new s.R({width:q,height:w},I),pixelRatio:_,stretchX:S,stretchY:U,content:H,sdf:B,version:0})}}updateImage(y,a){const d=this.style.getImage(y);if(!d)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=a instanceof HTMLImageElement||s.b(a)?F.getImageData(a):a,{width:B,height:S,data:U}=_;if(B===void 0||S===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(B!==d.data.width||S!==d.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const H=!(a instanceof HTMLImageElement||s.b(a));return d.data.replace(U,H),this.style.updateImage(y,d),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return _e.getImage(this._requestManager.transformRequest(y,Ee.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,a){return this._lazyInitEmptyStyle(),this.style.addLayer(y,a),this._update(!0)}moveLayer(y,a){return this.style.moveLayer(y,a),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,a,d){return this.style.setLayerZoomRange(y,a,d),this._update(!0)}setFilter(y,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(y,a,d),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,a,d){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(y,a,d,_),this._update(!0)}getPaintProperty(y,a){return this.style.getPaintProperty(y,a)}setLayoutProperty(y,a,d){let _=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(y,a,d,_),this._update(!0)}getLayoutProperty(y,a){return this.style.getLayoutProperty(y,a)}setGlyphs(y){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,a),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,a){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(y,a,d,_=>{_||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(y,a,d=>{d||this._update(!0)}),this}setLight(y){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(y,a),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,a){return this.style.setFeatureState(y,a),this._update()}removeFeatureState(y,a){return this.style.removeFeatureState(y,a),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,a=0;return this._container&&(y=this._container.clientWidth||400,a=this._container.clientHeight||300),[y,a]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const a=this._canvasContainer=k.create("div","maplibregl-canvas-container",y);this._interactive&&a.classList.add("maplibregl-interactive"),this._canvas=k.create("canvas","maplibregl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),_=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],_);const B=this._controlContainer=k.create("div","maplibregl-control-container",y),S=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(U=>{S[U]=k.create("div",`maplibregl-ctrl-${U} `,B)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,a,d){this._canvas.width=Math.floor(d*y),this._canvas.height=Math.floor(d*a),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${a}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let a=null;this._canvas.addEventListener("webglcontextcreationerror",_=>{a={requestedAttributes:y},_&&(a.statusMessage=_.statusMessage,a.type=_.type)},{once:!0});const d=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!d){const _="Failed to initialize WebGL";throw a?(a.message=_,new Error(JSON.stringify(a))):new Error(_)}this.painter=new fo(d,this.transform),z.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const a=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,S=F.now();this.style.zoomHistory.update(B,S);const U=new s.a8(B,{now:S,fadeDuration:a,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),H=U.crossFadingFactor();H===1&&H===this._crossFadingFactor||(d=!0,this._crossFadingFactor=H),this.style.update(U)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bb.mark(s.bc.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const _=this._sourcesDirty||this._styleDirty||this._placementDirty;return _||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||_||(this._fullyLoaded=!0,s.bb.mark(s.bc.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),_e.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const a=this.painter.context.gl.getExtension("WEBGL_lose_context");a&&a.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),k.remove(this._canvasContainer),k.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),s.bb.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,F.frameAsync(this._frameRequest).then(y=>{s.bb.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Ro}getCameraTargetElevation(){return this.transform.elevation}},l.MapMouseEvent=Tn,l.MapTouchEvent=Fo,l.MapWheelEvent=As,l.Marker=Jl,l.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const a=this._map.getZoom(),d=a===this._map.getMaxZoom(),_=a===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},this._rotateCompassArrow=()=>{const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=a},this._setButtonTitle=(a,d)=>{const _=this._map._getUIString(`NavigationControl.${d}`);a.title=_,a.setAttribute("aria-label",_)},this.options=s.e({},Jr,y),this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),k.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),k.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=k.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Nn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){k.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,a){const d=k.create("button",y,this._container);return d.type="button",d.addEventListener("click",a),d}},l.Popup=class extends s.E{constructor(y){super(),this.remove=()=>(this._content&&k.remove(this._content),this._container&&(k.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map),this.fire(new s.k("close")),this),this._onMouseUp=a=>{this._update(a.point)},this._onMouseMove=a=>{this._update(a.point)},this._onDrag=a=>{this._update(a.point)},this._update=a=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=k.create("div","maplibregl-popup",this._map.getContainer()),this._tip=k.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const U of this.options.className.split(" "))this._container.classList.add(U);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ml(this._lngLat,this._flatPos,this._map.transform)),this._trackPointer&&!a)return;const d=this._flatPos=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&a?a:this._map.transform.locationPoint(this._lngLat));let _=this.options.anchor;const B=L(this.options.offset);if(!_){const U=this._container.offsetWidth,H=this._container.offsetHeight;let q;q=d.y+B.bottom.y<H?["top"]:d.y>this._map.transform.height-H?["bottom"]:[],d.x<U/2?q.push("left"):d.x>this._map.transform.width-U/2&&q.push("right"),_=q.length===0?"bottom":q.join("-")}const S=d.add(B[_]).round();k.setTransform(this._container,`${rl[_]} translate(${S.x}px,${S.y}px)`),Da(this._container,_,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(A),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=s.M.convert(y),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const a=document.createDocumentFragment(),d=document.createElement("body");let _;for(d.innerHTML=y;_=d.firstChild,_;)a.appendChild(_);return this.setDOMContent(a)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=k.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}_createCloseButton(){this.options.closeButton&&(this._closeButton=k.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(x);y&&y.focus()}},l.RasterDEMTileSource=ei,l.RasterTileSource=Ri,l.ScaleControl=class{constructor(y){this._onMove=()=>{Gr(this._map,this._container,this.options)},this.setUnit=a=>{this.options.unit=a,Gr(this._map,this._container,this.options)},this.options=s.e({},yl,y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){k.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},l.ScrollZoomHandler=Cs,l.Style=Hn,l.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=k.create("button","maplibregl-ctrl-terrain",this._container),k.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){k.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},l.TwoFingersTouchPitchHandler=Oc,l.TwoFingersTouchRotateHandler=Wl,l.TwoFingersTouchZoomHandler=mo,l.TwoFingersTouchZoomRotateHandler=_a,l.VectorTileSource=xt,l.VideoSource=di,l.addSourceType=(y,a)=>s._(void 0,void 0,void 0,function*(){if(tr(y))throw new Error(`A source type called "${y}" already exists.`);((d,_)=>{Ki[d]=_})(y,a)}),l.clearPrewarmedResources=function(){const y=ft;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Xe),ft=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},l.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},l.getRTLTextPluginStatus=function(){return Nt().getRTLTextPluginStatus()},l.getVersion=function(){return O},l.getWorkerCount=function(){return et.workerCount},l.getWorkerUrl=function(){return s.a.WORKER_URL},l.importScriptInWorkers=function(y){return Ht().broadcast("importScript",y)},l.prewarm=function(){Pt().acquire(Xe)},l.setMaxParallelImageRequests=function(y){s.a.MAX_PARALLEL_IMAGE_REQUESTS=y},l.setRTLTextPlugin=function(y,a){return Nt().setRTLTextPlugin(y,a)},l.setWorkerCount=function(y){et.workerCount=y},l.setWorkerUrl=function(y){s.a.WORKER_URL=y}});var o=t;return o})})(OI);var Az=OI.exports;const ic=C_(Az);var Na;(function(i){i[i.Unknown=0]="Unknown",i[i.Point=1]="Point",i[i.LineString=2]="LineString",i[i.Polygon=3]="Polygon",i[i.MultiPoint=4]="MultiPoint",i[i.MultiLineString=5]="MultiLineString",i[i.MultiPolygon=6]="MultiPolygon",i[i.GeometryCollection=7]="GeometryCollection",i[i.CircularString=8]="CircularString",i[i.CompoundCurve=9]="CompoundCurve",i[i.CurvePolygon=10]="CurvePolygon",i[i.MultiCurve=11]="MultiCurve",i[i.MultiSurface=12]="MultiSurface",i[i.Curve=13]="Curve",i[i.Surface=14]="Surface",i[i.PolyhedralSurface=15]="PolyhedralSurface",i[i.TIN=16]="TIN",i[i.Triangle=17]="Triangle"})(Na||(Na={}));const km=4,Om=4,Um=4,YA=new Int32Array(2),UI=new Float32Array(YA.buffer),NI=new Float64Array(YA.buffer),E_=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Zx;(function(i){i[i.UTF8_BYTES=1]="UTF8_BYTES",i[i.UTF16_STRING=2]="UTF16_STRING"})(Zx||(Zx={}));class gA{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new gA(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return YA[0]=this.readInt32(e),UI[0]}readFloat64(e){return YA[E_?0:1]=this.readInt32(e),YA[E_?1:0]=this.readInt32(e+4),NI[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){UI[0]=t,this.writeInt32(e,YA[0])}writeFloat64(e,t){NI[0]=t,this.writeInt32(e,YA[E_?0:1]),this.writeInt32(e+4,YA[E_?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+km+Om)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<Om;t++)e+=String.fromCharCode(this.readInt8(this.position_+km+t));return e}__offset(e,t){const r=e-this.readInt32(e);return t<this.readInt16(r)?this.readInt16(r+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const r=this.readInt32(e);e+=km;const n=this.bytes_.subarray(e,e+r);return t===Zx.UTF8_BYTES?n:this.text_decoder_.decode(n)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+km}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Om)throw new Error("FlatBuffers: file identifier must be length "+Om);for(let t=0;t<Om;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+km+t))return!1;return!0}createScalarList(e,t){const r=[];for(let n=0;n<t;++n){const o=e(n);o!==null&&r.push(o)}return r}createObjList(e,t){const r=[];for(let n=0;n<t;++n){const o=e(n);o!==null&&r.push(o.unpack())}return r}}let dz=class Kc{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new Kc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+Um),(t||new Kc).__init(e.readInt32(e.position())+e.position(),e)}ends(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}endsLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){const e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}xyLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}zLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){const e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}mLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){const e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}tLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){const e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+e*8):BigInt(0)}tmLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):Na.Unknown}parts(e,t){const r=this.bb.__offset(this.bb_pos,18);return r?(t||new Kc).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}partsLength(){const e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addInt32(t[r]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addInt64(t[r]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,Na.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,r,n,o,l,s,g,b){return Kc.startGeometry(e),Kc.addEnds(e,t),Kc.addXy(e,r),Kc.addZ(e,n),Kc.addM(e,o),Kc.addT(e,l),Kc.addTm(e,s),Kc.addType(e,g),Kc.addParts(e,b),Kc.endGeometry(e)}};function Jx(i,e){const t=[];for(let r=0;r<i.length;r+=2){const n=[i[r],i[r+1]];e&&n.push(e[r>>1]),t.push(n)}return t}function zI(i,e,t){if(!t||t.length===0)return[Jx(i,e)];let r=0;const n=Array.from(t).map(l=>i.slice(r,r=l<<1));let o;return e&&(r=0,o=Array.from(t).map(l=>e.slice(r,r=l))),n.map((l,s)=>Jx(l,o?o[s]:void 0))}function fz(i,e){const t=i.xyArray(),r=i.zArray();switch(e){case Na.Point:{const n=Array.from(t);return r&&n.push(r[0]),n}case Na.MultiPoint:case Na.LineString:return Jx(t,r);case Na.MultiLineString:return zI(t,r,i.endsArray());case Na.Polygon:return zI(t,r,i.endsArray())}}function Yx(i,e){let t=e;if(t===Na.Unknown&&(t=i.type()),t===Na.GeometryCollection){const n=[];for(let o=0;o<i.partsLength();o++){const l=i.parts(o),s=l.type();n.push(Yx(l,s))}return{type:Na[t],geometries:n}}else if(t===Na.MultiPolygon){const n=[];for(let o=0;o<i.partsLength();o++)n.push(Yx(i.parts(o),Na.Polygon));return{type:Na[t],coordinates:n.map(o=>o.coordinates)}}const r=fz(i,t);return{type:Na[t],coordinates:r}}var za;(function(i){i[i.Byte=0]="Byte",i[i.UByte=1]="UByte",i[i.Bool=2]="Bool",i[i.Short=3]="Short",i[i.UShort=4]="UShort",i[i.Int=5]="Int",i[i.UInt=6]="UInt",i[i.Long=7]="Long",i[i.ULong=8]="ULong",i[i.Float=9]="Float",i[i.Double=10]="Double",i[i.String=11]="String",i[i.Json=12]="Json",i[i.DateTime=13]="DateTime",i[i.Binary=14]="Binary"})(za||(za={}));class Qa{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new Qa).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+Um),(t||new Qa).__init(e.readInt32(e.position())+e.position(),e)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):za.Byte}title(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){const e=this.bb.__offset(this.bb_pos,18);return e?!!this.bb.readInt8(this.bb_pos+e):!0}unique(){const e=this.bb.__offset(this.bb_pos,20);return e?!!this.bb.readInt8(this.bb_pos+e):!1}primaryKey(){const e=this.bb.__offset(this.bb_pos,22);return e?!!this.bb.readInt8(this.bb_pos+e):!1}metadata(e){const t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,za.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){const t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,r,n,o,l,s,g,b,T,F,k){return Qa.startColumn(e),Qa.addName(e,t),Qa.addType(e,r),Qa.addTitle(e,n),Qa.addDescription(e,o),Qa.addWidth(e,l),Qa.addPrecision(e,s),Qa.addScale(e,g),Qa.addNullable(e,b),Qa.addUnique(e,T),Qa.addPrimaryKey(e,F),Qa.addMetadata(e,k),Qa.endColumn(e)}}class Xu{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new Xu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+Um),(t||new Xu).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){const t=this.bb.__offset(this.bb_pos,4);return t?(e||new dz).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){const r=this.bb.__offset(this.bb_pos,8);return r?(t||new Qa).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}columnsLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let r=t.length-1;r>=0;r--)e.addInt8(t[r]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,r,n){return Xu.startFeature(e),Xu.addGeometry(e,t),Xu.addProperties(e,r),Xu.addColumns(e,n),Xu.endFeature(e)}}new TextEncoder;const QI=new TextDecoder;function pz(i,e){const t={};if(!e||e.length===0)return t;const r=i.propertiesArray();if(!r)return t;const n=new DataView(r.buffer,r.byteOffset),o=i.propertiesLength();let l=0;for(;l<o;){const s=n.getUint16(l,!0);l+=2;const g=e[s],b=g.name;switch(g.type){case za.Bool:{t[b]=!!n.getUint8(l),l+=1;break}case za.Byte:{t[b]=n.getInt8(l),l+=1;break}case za.UByte:{t[b]=n.getUint8(l),l+=1;break}case za.Short:{t[b]=n.getInt16(l,!0),l+=2;break}case za.UShort:{t[b]=n.getUint16(l,!0),l+=2;break}case za.Int:{t[b]=n.getInt32(l,!0),l+=4;break}case za.UInt:{t[b]=n.getUint32(l,!0),l+=4;break}case za.Long:{t[b]=Number(n.getBigInt64(l,!0)),l+=8;break}case za.ULong:{t[b]=Number(n.getBigUint64(l,!0)),l+=8;break}case za.Float:{t[b]=n.getFloat32(l,!0),l+=4;break}case za.Double:{t[b]=n.getFloat64(l,!0),l+=8;break}case za.DateTime:case za.String:{const T=n.getUint32(l,!0);l+=4,t[b]=QI.decode(r.subarray(l,l+T)),l+=T;break}case za.Json:{const T=n.getUint32(l,!0);l+=4;const F=QI.decode(r.subarray(l,l+T));t[b]=JSON.parse(F),l+=T;break}default:throw new Error("Unknown type "+g.type)}}return t}function ew(i,e){const t=e.columns;return{type:"Feature",geometry:Yx(i.geometry(),e.geometryType),properties:pz(i,t)}}const tw=new Uint8Array(0);function gz(){return this._source.cancel()}function mz(i,e){if(!i.length)return e;if(!e.length)return i;var t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function yz(){var i=this,e=i._array.subarray(i._index);return i._source.read().then(function(t){return i._array=tw,i._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:mz(e,t.value)}})}function _z(i){if((i|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+i<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=i));var r=new Uint8Array(i);return r.set(this._array.subarray(this._index)),function n(){return e._source.read().then(function(o){return o.done?(e._array=tw,e._index=0,t>0?r.subarray(0,t):null):t+o.value.length>=i?(e._array=o.value,e._index=i-t,r.set(o.value.subarray(0,i-t),t),r):(r.set(o.value,t),t+=o.value.length,n())})}()}function vz(i){return typeof i.slice=="function"?i:new S_(typeof i.read=="function"?i:i.getReader())}function S_(i){this._source=i,this._array=tw,this._index=0}S_.prototype.read=yz,S_.prototype.slice=_z,S_.prototype.cancel=gz;class bu{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new bu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+Um),(t||new bu).__init(e.readInt32(e.position())+e.position(),e)}org(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,r,n,o,l,s){return bu.startCrs(e),bu.addOrg(e,t),bu.addCode(e,r),bu.addName(e,n),bu.addDescription(e,o),bu.addWkt(e,l),bu.addCodeString(e,s),bu.endCrs(e)}}class T_{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new T_).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+Um),(t||new T_).__init(e.readInt32(e.position())+e.position(),e)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}envelopeLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):Na.Unknown}hasZ(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasM(){const e=this.bb.__offset(this.bb_pos,12);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasT(){const e=this.bb.__offset(this.bb_pos,14);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasTm(){const e=this.bb.__offset(this.bb_pos,16);return e?!!this.bb.readInt8(this.bb_pos+e):!1}columns(e,t){const r=this.bb.__offset(this.bb_pos,18);return r?(t||new Qa).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+r)+e*4),this.bb):null}columnsLength(){const e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){const e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){const e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){const t=this.bb.__offset(this.bb_pos,24);return t?(e||new bu).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){const t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){const t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let r=t.length-1;r>=0;r--)e.addFloat64(t[r]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,Na.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let r=t.length-1;r>=0;r--)e.addOffset(t[r]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function iw(i){const e=T_.getRootAsHeader(i),t=e.featuresCount(),r=e.indexNodeSize(),n=[];for(let g=0;g<e.columnsLength();g++){const b=e.columns(g);if(!b)throw new Error("Column unexpectedly missing");if(!b.name())throw new Error("Column name unexpectedly missing");n.push({name:b.name(),type:b.type(),title:b.title(),description:b.description(),width:b.width(),precision:b.precision(),scale:b.scale(),nullable:b.nullable(),unique:b.unique(),primary_key:b.primaryKey()})}const o=e.crs(),l=o?{org:o.org(),code:o.code(),name:o.name(),description:o.description(),wkt:o.wkt(),code_string:o.codeString()}:null;return{geometryType:e.geometryType(),columns:n,envelope:null,featuresCount:Number(t),indexNodeSize:r,crs:l,title:e.title(),description:e.description(),metadata:e.metadata()}}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var rw=function(i,e){return rw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},rw(i,e)};function bz(i,e){rw(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Np(i,e,t,r){function n(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function s(T){try{b(r.next(T))}catch(F){l(F)}}function g(T){try{b(r.throw(T))}catch(F){l(F)}}function b(T){T.done?o(T.value):n(T.value).then(s,g)}b((r=r.apply(i,e||[])).next())})}function ed(i,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,n,o,l;return l={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function s(b){return function(T){return g([b,T])}}function g(b){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,n&&(o=b[0]&2?n.return:b[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,b[1])).done)return o;switch(n=0,o&&(b=[b[0]&2,o.value]),b[0]){case 0:case 1:o=b;break;case 4:return t.label++,{value:b[1],done:!1};case 5:t.label++,n=b[1],b=[0];continue;case 7:b=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(b[0]===6||b[0]===2)){t=0;continue}if(b[0]===3&&(!o||b[1]>o[0]&&b[1]<o[3])){t.label=b[1];break}if(b[0]===6&&t.label<o[1]){t.label=o[1],o=b;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(b);break}o[2]&&t.ops.pop(),t.trys.pop();continue}b=e.call(i,t)}catch(T){b=[6,T],n=0}finally{r=o=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function zp(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],r=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&r>=i.length&&(i=void 0),{value:i&&i[r++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Nm(i){return this instanceof Nm?(this.v=i,this):new Nm(i)}function xz(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(i,e||[]),n,o=[];return n={},l("next"),l("throw"),l("return"),n[Symbol.asyncIterator]=function(){return this},n;function l(k){r[k]&&(n[k]=function(z){return new Promise(function(J,te){o.push([k,z,J,te])>1||s(k,z)})})}function s(k,z){try{g(r[k](z))}catch(J){F(o[0][3],J)}}function g(k){k.value instanceof Nm?Promise.resolve(k.value.v).then(b,T):F(o[0][2],k)}function b(k){s("next",k)}function T(k){s("throw",k)}function F(k,z){k(z),o.shift(),o.length&&s(o[0][0],o[0][1])}}var VI=function(i){bz(e,i);function e(t){var r=i.call(this,t)||this;return Object.defineProperty(r,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(r,r.constructor.prototype):r.__proto__=r.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(r,r.constructor),r}return e}(Error);(function(){function i(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),i.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i})(),function(){function i(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i}(),function(){function i(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(i.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},i.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},i}();function nw(i){i!=null&&typeof i.then=="function"&&i.then(M_,M_)}var sw=0,HI=1,cf=2,I_=3,ow=4,L_=1024,M_=function(){};function Qp(i){var e=i.err,t=Promise.resolve(i.execution).then(function(r){if(e!=null)throw e;return r});return i.err=void 0,i.execution=t.then(function(){},function(){}),i.pending===void 0?t:i.pending.then(function(){return t})}function uf(i,e){var t=i.state>=I_;return Promise.resolve(e).then(function(r){return!t&&i.state>=ow?Qp(i).then(function(n){return{value:n,done:!0}}):{value:r,done:t}})}function aw(i,e){var t,r;if(!(i.state>=cf))if(i.state=cf,i.onnext(),i.onstop(),i.err==null&&(i.err=e),i.pushes.length===0&&(typeof i.buffer>"u"||i.buffer.empty))zm(i);else try{for(var n=zp(i.pushes),o=n.next();!o.done;o=n.next()){var l=o.value;l.resolve()}}catch(s){t={error:s}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}function zm(i){var e,t;if(!(i.state>=I_)){i.state<cf&&aw(i),i.state=I_,i.buffer=void 0;try{for(var r=zp(i.nexts),n=r.next();!n.done;n=r.next()){var o=n.value,l=i.pending===void 0?Qp(i):i.pending.then(function(){return Qp(i)});o.resolve(uf(i,l))}}catch(s){e={error:s}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}i.pushes=[],i.nexts=[]}}function GI(i){i.state>=ow||(i.state<I_&&zm(i),i.state=ow)}function wz(i,e){if(nw(e),i.pushes.length>=L_)throw new VI("No more than "+L_+" pending calls to push are allowed on a single repeater.");if(i.state>=cf)return Promise.resolve(void 0);var t=i.pending===void 0?Promise.resolve(e):i.pending.then(function(){return e});t=t.catch(function(g){i.state<cf&&(i.err=g),GI(i)});var r;if(i.nexts.length){var n=i.nexts.shift();n.resolve(uf(i,t)),i.nexts.length?r=Promise.resolve(i.nexts[0].value):r=new Promise(function(g){return i.onnext=g})}else typeof i.buffer<"u"&&!i.buffer.full?(i.buffer.add(t),r=Promise.resolve(void 0)):r=new Promise(function(g){return i.pushes.push({resolve:g,value:t})});var o=!0,l={},s=r.catch(function(g){if(o)throw g});return l.then=function(g,b){return o=!1,Promise.prototype.then.call(r,g,b)},l.catch=function(g){return o=!1,Promise.prototype.catch.call(r,g)},l.finally=r.finally.bind(r),i.pending=t.then(function(){return s}).catch(function(g){i.err=g,GI(i)}),l}function Bz(i){var e=aw.bind(null,i),t=new Promise(function(r){return i.onstop=r});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function Cz(i){if(!(i.state>=HI)){i.state=HI;var e=wz.bind(null,i),t=Bz(i);i.execution=new Promise(function(r){return r(i.executor(e,t))}),i.execution.catch(function(){return aw(i)})}}var P_=new WeakMap,Qm=function(){function i(e,t){P_.set(this,{executor:e,buffer:t,err:void 0,state:sw,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:M_,onstop:M_})}return i.prototype.next=function(e){nw(e);var t=P_.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=L_)throw new VI("No more than "+L_+" pending calls to next are allowed on a single repeater.");if(t.state<=sw&&Cz(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var r=uf(t,t.buffer.remove());if(t.pushes.length){var n=t.pushes.shift();t.buffer.add(n.value),t.onnext=n.resolve}return r}else if(t.pushes.length){var o=t.pushes.shift();return t.onnext=o.resolve,uf(t,o.value)}else if(t.state>=cf)return zm(t),uf(t,Qp(t));return new Promise(function(l){return t.nexts.push({resolve:l,value:e})})},i.prototype.return=function(e){nw(e);var t=P_.get(this);if(t===void 0)throw new Error("WeakMap error");return zm(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),uf(t,Qp(t))},i.prototype.throw=function(e){var t=P_.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=sw||t.state>=cf||typeof t.buffer<"u"&&!t.buffer.empty?(zm(t),t.err==null&&(t.err=e),uf(t,Qp(t))):this.next(Promise.reject(e))},i.prototype[Symbol.asyncIterator]=function(){return this},i.race=Ez,i.merge=Sz,i.zip=Tz,i.latest=Iz,i}();function F_(i,e){var t,r,n=[],o=function(b){b!=null&&typeof b[Symbol.asyncIterator]=="function"?n.push(b[Symbol.asyncIterator]()):b!=null&&typeof b[Symbol.iterator]=="function"?n.push(b[Symbol.iterator]()):n.push(function(){return xz(this,arguments,function(){return ed(this,function(k){switch(k.label){case 0:return e.yieldValues?[4,Nm(b)]:[3,3];case 1:return[4,k.sent()];case 2:k.sent(),k.label=3;case 3:return e.returnValues?[4,Nm(b)]:[3,5];case 4:return[2,k.sent()];case 5:return[2]}})})}())};try{for(var l=zp(i),s=l.next();!s.done;s=l.next()){var g=s.value;o(g)}}catch(b){t={error:b}}finally{try{s&&!s.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}return n}function Ez(i){var e=this,t=F_(i,{returnValues:!0});return new Qm(function(r,n){return Np(e,void 0,void 0,function(){var o,l,s,g,b,T;return ed(this,function(F){switch(F.label){case 0:if(!t.length)return n(),[2];l=!1,n.then(function(){o(),l=!0}),F.label=1;case 1:F.trys.push([1,,5,7]),g=void 0,b=0,T=function(){var k,z,J,te,ue,ce;return ed(this,function(de){switch(de.label){case 0:k=b;try{for(z=(ue=void 0,zp(t)),J=z.next();!J.done;J=z.next())te=J.value,Promise.resolve(te.next()).then(function(_e){_e.done?(n(),s===void 0&&(s=_e)):b===k&&(b++,o(_e))},function(_e){return n(_e)})}catch(_e){ue={error:_e}}finally{try{J&&!J.done&&(ce=z.return)&&ce.call(z)}finally{if(ue)throw ue.error}}return[4,new Promise(function(_e){return o=_e})];case 1:return g=de.sent(),g===void 0?[3,3]:[4,r(g.value)];case 2:de.sent(),de.label=3;case 3:return[2]}})},F.label=2;case 2:return l?[3,4]:[5,T()];case 3:return F.sent(),[3,2];case 4:return[2,s&&s.value];case 5:return n(),[4,Promise.race(t.map(function(k){return k.return&&k.return()}))];case 6:return F.sent(),[7];case 7:return[2]}})})})}function Sz(i){var e=this,t=F_(i,{yieldValues:!0});return new Qm(function(r,n){return Np(e,void 0,void 0,function(){var o,l,s,g=this;return ed(this,function(b){switch(b.label){case 0:if(!t.length)return n(),[2];o=[],l=!1,n.then(function(){var T,F;l=!0;try{for(var k=zp(o),z=k.next();!z.done;z=k.next()){var J=z.value;J()}}catch(te){T={error:te}}finally{try{z&&!z.done&&(F=k.return)&&F.call(k)}finally{if(T)throw T.error}}}),b.label=1;case 1:return b.trys.push([1,,3,4]),[4,Promise.all(t.map(function(T,F){return Np(g,void 0,void 0,function(){var k,z;return ed(this,function(J){switch(J.label){case 0:J.trys.push([0,,6,9]),J.label=1;case 1:return l?[3,5]:(Promise.resolve(T.next()).then(function(te){return o[F](te)},function(te){return n(te)}),[4,new Promise(function(te){o[F]=te})]);case 2:return k=J.sent(),k===void 0?[3,4]:k.done?(s=k,[2]):[4,r(k.value)];case 3:J.sent(),J.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return z=T.return,z?[4,T.return()]:[3,8];case 7:z=J.sent(),J.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return b.sent(),[2,s&&s.value];case 3:return n(),[7];case 4:return[2]}})})})}function Tz(i){var e=this,t=F_(i,{returnValues:!0});return new Qm(function(r,n){return Np(e,void 0,void 0,function(){var o,l,s,g;return ed(this,function(b){switch(b.label){case 0:if(!t.length)return n(),[2,[]];l=!1,n.then(function(){o(),l=!0}),b.label=1;case 1:b.trys.push([1,,6,8]),b.label=2;case 2:return l?[3,5]:(Promise.all(t.map(function(T){return T.next()})).then(function(T){return o(T)},function(T){return n(T)}),[4,new Promise(function(T){return o=T})]);case 3:return s=b.sent(),s===void 0?[2]:(g=s.map(function(T){return T.value}),s.some(function(T){return T.done})?[2,g]:[4,r(g)]);case 4:return b.sent(),[3,2];case 5:return[3,8];case 6:return n(),[4,Promise.all(t.map(function(T){return T.return&&T.return()}))];case 7:return b.sent(),[7];case 8:return[2]}})})})}function Iz(i){var e=this,t=F_(i,{yieldValues:!0,returnValues:!0});return new Qm(function(r,n){return Np(e,void 0,void 0,function(){var o,l,s,g,b,T=this;return ed(this,function(F){switch(F.label){case 0:if(!t.length)return n(),[2,[]];l=[],s=!1,n.then(function(){var k,z;o();try{for(var J=zp(l),te=J.next();!te.done;te=J.next()){var ue=te.value;ue()}}catch(ce){k={error:ce}}finally{try{te&&!te.done&&(z=J.return)&&z.call(J)}finally{if(k)throw k.error}}s=!0}),F.label=1;case 1:return F.trys.push([1,,5,7]),Promise.all(t.map(function(k){return k.next()})).then(function(k){return o(k)},function(k){return n(k)}),[4,new Promise(function(k){return o=k})];case 2:return g=F.sent(),g===void 0?[2]:(b=g.map(function(k){return k.value}),g.every(function(k){return k.done})?[2,b]:[4,r(b.slice())]);case 3:return F.sent(),[4,Promise.all(t.map(function(k,z){return Np(T,void 0,void 0,function(){var J;return ed(this,function(te){switch(te.label){case 0:if(g[z].done)return[2,g[z].value];te.label=1;case 1:return s?[3,4]:(Promise.resolve(k.next()).then(function(ue){return l[z](ue)},function(ue){return n(ue)}),[4,new Promise(function(ue){return l[z]=ue})]);case 2:return J=te.sent(),J===void 0?[2,g[z].value]:J.done?[2,J.value]:(b[z]=J.value,[4,r(b.slice())]);case 3:return te.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,F.sent()];case 5:return n(),[4,Promise.all(t.map(function(k){return k.return&&k.return()}))];case 6:return F.sent(),[7];case 7:return[2]}})})})}class D_{constructor(){this._extraRequestThreshold=256*1024}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}}D_.global=new D_;var Zu;(function(i){i[i.Debug=0]="Debug",i[i.Info=1]="Info",i[i.Warn=2]="Warn",i[i.Error=3]="Error"})(Zu||(Zu={}));class Va{static debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log(Zu.Debug,...t)}static info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log(Zu.Info,...t)}static warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log(Zu.Warn,...t)}static error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log(Zu.Error,...t)}static log(e){if(!(this.logLevel>e)){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];switch(e){case Zu.Debug:{console.debug(...r);break}case Zu.Info:{console.info(...r);break}case Zu.Warn:{console.warn(...r);break}case Zu.Error:{console.error(...r);break}}}}}Va.logLevel=Zu.Warn;const hf=8*4+8,Lz=16;function lw(i,e){e=Math.min(Math.max(+e,2),65535);let t=i,r=t;do t=Math.ceil(t/e),r+=t;while(t!==1);return r*hf}function Mz(i,e){if(e<2)throw new Error("Node size must be at least 2");if(i===0)throw new Error("Number of items must be greater than 0");let t=i,r=t;const n=[t];do t=Math.ceil(t/e),r+=t,n.push(t);while(t!==1);const o=[];t=r;for(const s of n)o.push(t-s),t-=s;const l=[];for(let s=0;s<n.length;s++)l.push([o[s],o[s]+n[s]]);return l}async function*Pz(i,e,t,r){class n{constructor(J,te){this._level=te,this.nodes=J}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(J){console.assert(J>this.nodes[1]),this.nodes[1]=J}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}const{minX:o,minY:l,maxX:s,maxY:g}=t;Va.info(`tree items: ${i}, nodeSize: ${e}`);const b=Mz(i,e),T=b[0][0],k=[(()=>{const z=[0,1],J=b.length-1;return new n(z,J)})()];for(Va.debug(`starting stream search with queue: ${k}, numItems: ${i}, nodeSize: ${e}, levelBounds: ${b}`);k.length!=0;){const z=k.shift();Va.debug(`popped node: ${z}, queueLength: ${k.length}`);const J=z.startNodeIdx(),te=J>=T,ue=(()=>{const[,Ee]=b[z.level()],He=Math.min(z.endNodeIdx()+e,Ee);return te&&He<Ee?He+1:He})(),ce=ue-J,de=await r(J*hf,ce*hf),_e=new DataView(de);for(let Ee=J;Ee<ue;Ee++){const He=Ee-J,Ve=He*hf;if(s<_e.getFloat64(Ve+0,!0)||g<_e.getFloat64(Ve+8,!0)||o>_e.getFloat64(Ve+16,!0)||l>_e.getFloat64(Ve+24,!0))continue;const qe=_e.getBigUint64(Ve+32,!0);if(te){const Me=qe,Ze=(()=>{if(Ee<i-1){const Bt=(He+1)*hf;return _e.getBigUint64(Bt+32,!0)-Me}else return null})(),We=Ee-T;yield[Number(Me),We,Number(Ze)];continue}const Ue=qe,ot=D_.global.extraRequestThreshold()/hf,it=k[k.length-1];if(it!==void 0&&it.level()==z.level()-1&&Ue<it.endNodeIdx()+ot){Va.debug(`Merging "nodeRange" request into existing range: ${it}, newEndNodeIdx: ${it.endNodeIdx()} -> ${Ue}`),it.extendEndNodeIdx(Number(Ue));continue}const De=(()=>{const Me=z.level()-1,Ze=[Number(Ue),Number(Ue)+1];return new n(Ze,Me)})();it!==void 0&&it.level()==De.level()?Va.info(`Same level, but too far away. Pushing new request for nodeIdx: ${Ue} rather than merging with distant ${it}`):Va.info(`Pushing new level for ${De} onto queue with nearestNodeRange: ${it} since there's not already a range for this level.`),k.push(De)}}}const td=new Uint8Array([102,103,98,3,102,103,98,0]),mA=4;class cw{constructor(e,t,r,n){this.headerClient=e,this.header=t,this.headerLength=r,this.indexLength=n}static async open(e){const r=new jI(e),n=(()=>{const F=Lz,k=3;let z=0,J;for(J=0;J<k;J++){const te=F**J*hf;z+=te}return z})(),o=2024+n;Va.debug(`fetching header. minReqLength: ${o} (assumedHeaderLength: 2024, assumedIndexLength: ${n})`);{const F=new Uint8Array(await r.getRange(0,8,o,"header"));if(!F.subarray(0,3).every((k,z)=>td[z]===k))throw Va.error(`bytes: ${F} != ${td}`),new Error("Not a FlatGeobuf file");Va.debug("magic bytes look good")}let l;{const F=await r.getRange(8,4,o,"header");l=new DataView(F).getUint32(0,!0);const k=1048576*10;if(l>k||l<8)throw new Error("Invalid header size");Va.debug(`headerLength: ${l}`)}const s=await r.getRange(12,l,o,"header"),g=new gA(new Uint8Array(s)),b=iw(g),T=lw(b.featuresCount,b.indexNodeSize);return Va.debug("completed: opening http reader"),new cw(r,b,l,T)}async*selectBbox(e){const t=this.lengthBeforeTree(),r=this.headerClient,n=async function(g,b){return r.getRange(t+g,b,0,"index")},o=[];let l=[];for await(const g of Pz(this.header.featuresCount,this.header.indexNodeSize,e,n)){const[b,,]=g;let[,,T]=g;if(T||(Va.info("final feature"),T=4),l.length==0){l.push([b,T]);continue}const F=l[l.length-1],k=b-(F[0]+F[1]);k>D_.global.extraRequestThreshold()&&(Va.info(`Pushing new feature batch, since gap ${k} was too large`),o.push(l),l=[]),l.push([b,T])}this.headerClient.logUsage("header+index"),l.length>0&&o.push(l);const s=o.flatMap(g=>this.readFeatureBatch(g));yield*Qm.merge(s)}lengthBeforeTree(){return td.length+mA+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(){return new jI(this.headerClient.httpClient)}async*readFeatureBatch(e){const[t]=e[0],[r,n]=e[e.length-1],o=t,s=r+n-o,g=this.buildFeatureClient();let b=s;for(const[T]of e)yield await this.readFeature(g,T,b),b=0;g.logUsage("feature")}async readFeature(e,t,r){const n=t+this.lengthBeforeFeatures();let o;{const T=await e.getRange(n,4,r,"feature length");o=new DataView(T).getUint32(0,!0)}const l=await e.getRange(n+4,o,r,"feature data"),s=new Uint8Array(l),g=new Uint8Array(o+mA);g.set(s,mA);const b=new gA(g);return b.setPosition(mA),Xu.getRootAsFeature(b)}}class jI{constructor(e){if(this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,typeof e=="string")this.httpClient=new qI(e);else if(e instanceof qI)this.httpClient=e;else throw new Error("Unknown source ")}async getRange(e,t,r,n){this.bytesEverUsed+=t;const o=e-this.head,l=o+t;if(o>=0&&l<=this.buffer.byteLength)return this.buffer.slice(o,l);const s=Math.max(t,r);return this.bytesEverFetched+=s,Va.debug(`requesting for new Range: ${e}-${e+s-1}`),this.buffer=await this.httpClient.getRange(e,s,n),this.head=e,this.buffer.slice(0,t)}logUsage(e){const t=e.split(" ")[0],r=this.bytesEverUsed,n=this.bytesEverFetched,o=(100*r/n).toFixed(2);Va.info(`${t} bytes used/requested: ${r} / ${n} = ${o}%`)}}class qI{constructor(e){this.requestsEverMade=0,this.bytesEverRequested=0,this.url=e}async getRange(e,t,r){this.requestsEverMade+=1,this.bytesEverRequested+=t;const n=`bytes=${e}-${e+t-1}`;return Va.info(`request: #${this.requestsEverMade}, purpose: ${r}), bytes: (this_request: ${t}, ever: ${this.bytesEverRequested}), Range: ${n}`),(await fetch(this.url,{headers:{Range:n}})).arrayBuffer()}}function Fz(i,e,t){if(!i.subarray(0,3).every((T,F)=>td[F]===T))throw new Error("Not a FlatGeobuf file");const r=new gA(i),n=r.readUint32(td.length);r.setPosition(td.length+mA);const o=iw(r);t&&t(o);let l=td.length+mA+n;const{indexNodeSize:s,featuresCount:g}=o;s>0&&(l+=lw(g,s));const b=[];for(;l<r.capacity();){const T=r.readUint32(l);r.setPosition(l+mA);const F=Xu.getRootAsFeature(r);b.push(e(F,o)),l+=mA+T}return b}async function*Dz(i,e,t){const r=vz(i),n=async k=>await r.slice(k);let o=new Uint8Array(await n(8));if(!o.subarray(0,3).every((k,z)=>td[z]===k))throw new Error("Not a FlatGeobuf file");o=new Uint8Array(await n(4));let l=new gA(o);const s=l.readUint32(0);o=new Uint8Array(await n(s)),l=new gA(o);const g=iw(l);t&&t(g);const{indexNodeSize:b,featuresCount:T}=g;if(b>0){const k=lw(T,b);await n(k)}let F;for(;F=await kz(n,g,e);)yield F}async function*Rz(i,e,t,r){const n=await cw.open(i);Va.debug("opened reader"),r&&r(n.header);for await(const o of n.selectBbox(e))yield t(o,n.header)}async function kz(i,e,t){let r=new Uint8Array(await i(4,"feature length"));if(r.byteLength===0)return;let n=new gA(r);const o=n.readUint32(0);r=new Uint8Array(await i(o,"feature data"));const l=new Uint8Array(o+4);l.set(r,4),n=new gA(l),n.setPosition(mA);const s=Xu.getRootAsFeature(n);return t(s,e)}function Oz(i,e){return{type:"FeatureCollection",features:Fz(i,ew,e)}}function Uz(i,e){return Dz(i,ew,e)}function Nz(i,e,t){return Rz(i,e,ew,t)}function zz(i,e,t){return i instanceof Uint8Array?Oz(i,t):i instanceof ReadableStream?Uz(i,t):Nz(i,e,t)}class Qz{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(e){this._map=e;let t=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(t._btn.className.indexOf("3d")!=-1){let b={pitch:t._pitch,bearing:t._bearing};t._minpitchzoom&&e.getZoom()>t._minpitchzoom&&(b.zoom=t._minpitchzoom);var r=0,n=38.5,o=6,l=62.33,{longitude:s,latitude:g}=e.getCenter();e.getZoom()<10?e.setTerrain({source:"terrainMapZen",exaggeration:1.5}):s>=r&&s<=o&&g>=n&&g<=l?e.setTerrain({source:"terrainICGC",exaggeration:1.2}):e.setTerrain({source:"terrainMapZen",exaggeration:1.5}),e.easeTo(b),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else e.setTerrain(null),e.easeTo({pitch:0,bearing:0}),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function Vm(i){"@babel/helpers - typeof";return Vm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vm(i)}function Vz(i,e){if(Vm(i)!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var r=t.call(i,e||"default");if(Vm(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function Hz(i){var e=Vz(i,"string");return Vm(e)=="symbol"?e:String(e)}function ye(i,e,t){return e=Hz(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ls(i,e){if(!i)throw new Error(e||"loader assertion failed.")}const R_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),$I=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);$I&&parseFloat($I[1]);const Gz="3.4.14";function kh(i,e){if(!i)throw new Error(e||"loaders.gl assertion failed.")}const uw={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},jz=uw.global||uw.self||uw.window||{},yA=typeof process!="object"||String(process)!=="[object process]"||process.browser,hw=typeof importScripts=="function",qz=typeof window<"u"&&typeof window.orientation<"u",KI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);KI&&parseFloat(KI[1]);class $z{constructor(e,t){ye(this,"name",void 0),ye(this,"workerThread",void 0),ye(this,"isRunning",!0),ye(this,"result",void 0),ye(this,"_resolve",()=>{}),ye(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((r,n)=>{this._resolve=r,this._reject=n})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){kh(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){kh(this.isRunning),this.isRunning=!1,this._reject(e)}}let Aw=class{terminate(){}};const dw=new Map;function Kz(i){kh(i.source&&!i.url||!i.source&&i.url);let e=dw.get(i.source||i.url);return e||(i.url&&(e=Wz(i.url),dw.set(i.url,e)),i.source&&(e=WI(i.source),dw.set(i.source,e))),kh(e),e}function Wz(i){if(!i.startsWith("http"))return i;const e=Xz(i);return WI(e)}function WI(i){const e=new Blob([i],{type:"application/javascript"});return URL.createObjectURL(e)}function Xz(i){return`try {
  importScripts('`.concat(i,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function XI(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2?arguments[2]:void 0;const r=t||new Set;if(i){if(ZI(i))r.add(i);else if(ZI(i.buffer))r.add(i.buffer);else if(!ArrayBuffer.isView(i)){if(e&&typeof i=="object")for(const n in i)XI(i[n],e,r)}}return t===void 0?Array.from(r):[]}function ZI(i){return i?i instanceof ArrayBuffer||typeof MessagePort<"u"&&i instanceof MessagePort||typeof ImageBitmap<"u"&&i instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas:!1}const fw=()=>{};class pw{static isSupported(){return typeof Worker<"u"&&yA||typeof Aw<"u"&&!yA}constructor(e){ye(this,"name",void 0),ye(this,"source",void 0),ye(this,"url",void 0),ye(this,"terminated",!1),ye(this,"worker",void 0),ye(this,"onMessage",void 0),ye(this,"onError",void 0),ye(this,"_loadableURL","");const{name:t,source:r,url:n}=e;kh(r||n),this.name=t,this.source=r,this.url=n,this.onMessage=fw,this.onError=o=>console.log(o),this.worker=yA?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=fw,this.onError=fw,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||XI(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=Kz({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Aw(r,{eval:!1})}else if(this.source)e=new Aw(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class Zz{static isSupported(){return pw.isSupported()}constructor(e){ye(this,"name","unnamed"),ye(this,"source",void 0),ye(this,"url",void 0),ye(this,"maxConcurrency",1),ye(this,"maxMobileConcurrency",1),ye(this,"onDebug",()=>{}),ye(this,"reuseWorkers",!0),ye(this,"props",{}),ye(this,"jobQueue",[]),ye(this,"idleQueue",[]),ye(this,"count",0),ye(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(o,l,s)=>o.done(s),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(o,l)=>o.error(l);const n=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:o}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new $z(t.name,e);e.onMessage=n=>t.onMessage(r,n.type,n.payload),e.onError=n=>t.onError(r,n),t.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new pw({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return qz?this.maxMobileConcurrency:this.maxConcurrency}}const Jz={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class _A{static isSupported(){return pw.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return _A._workerFarm=_A._workerFarm||new _A({}),_A._workerFarm.setProps(e),_A._workerFarm}constructor(e){ye(this,"props",void 0),ye(this,"workerPools",new Map),this.props={...Jz},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:n}=e;let o=this.workerPools.get(t);return o||(o=new Zz({name:t,source:r,url:n}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}ye(_A,"_workerFarm",void 0);const Yz="latest";function e8(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e[i.id]||{},r="".concat(i.id,"-worker.js");let n=t.workerUrl;if(!n&&i.id==="compression"&&(n=e.workerUrl),e._workerType==="test"&&(n="modules/".concat(i.module,"/dist/").concat(r)),!n){let o=i.version;o==="latest"&&(o=Yz);const l=o?"@".concat(o):"";n="https://unpkg.com/@loaders.gl/".concat(i.module).concat(l,"/dist/").concat(r)}return kh(n),n}function t8(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Gz;kh(i,"no worker provided");const t=i.version;return!(!e||!t)}const i8=null,r8=null,gw=null,JI=null,n8=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:i8,readFileAsText:r8,requireFromFile:gw,requireFromString:JI},Symbol.toStringTag,{value:"Module"})),s8="3.4.14",mw={};async function Af(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e&&(i=o8(i,e,t)),mw[i]=mw[i]||a8(i),await mw[i]}function o8(i,e,t){if(i.startsWith("http"))return i;const r=t.modules||{};return r[i]?r[i]:yA?t.CDN?(kh(t.CDN.startsWith("http")),"".concat(t.CDN,"/").concat(e,"@").concat(s8,"/dist/libs/").concat(i)):hw?"../src/libs/".concat(i):"modules/".concat(e,"/src/libs/").concat(i):"modules/".concat(e,"/dist/libs/").concat(i)}async function a8(i){if(i.endsWith("wasm"))return await(await fetch(i)).arrayBuffer();if(!yA)try{return n8&&gw&&await gw(i)}catch{return null}if(hw)return importScripts(i);const t=await(await fetch(i)).text();return l8(t,i)}function l8(i,e){if(!yA)return JI;if(hw)return eval.call(jz,i),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(i))}catch{t.text=i}return document.body.appendChild(t),null}function c8(i,e){return!_A.isSupported()||!yA&&!(e!=null&&e._nodeWorkers)?!1:i.worker&&(e==null?void 0:e.worker)}async function u8(i,e,t,r,n){const o=i.id,l=e8(i,t),g=_A.getWorkerFarm(t).getWorkerPool({name:o,url:l});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const b=await g.startJob("process-on-worker",h8.bind(null,n));return b.postMessage("process",{input:e,options:t,context:r}),await(await b.result).result}async function h8(i,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:n,input:o,options:l}=r;try{const s=await i(o,l);e.postMessage("done",{id:n,result:s})}catch(s){const g=s instanceof Error?s.message:"unknown error";e.postMessage("error",{id:n,error:g})}break;default:console.warn("parse-with-worker unknown message ".concat(t))}}function A8(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?YI(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?YI(i,0,e):""}function YI(i,e,t){if(i.byteLength<=e+t)return"";const r=new DataView(i);let n="";for(let o=0;o<t;o++)n+=String.fromCharCode(r.getUint8(e+o));return n}function d8(i){try{return JSON.parse(i)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(A8(i),'"'))}}function f8(i,e,t){if(t=t||i.byteLength,i.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(i),n=new Uint8Array(e);for(let o=0;o<r.length;++o)if(r[o]!==n[o])return!1;return!0}function p8(){for(var i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];const r=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=r.reduce((s,g)=>s+g.byteLength,0),o=new Uint8Array(n);let l=0;for(const s of r)o.set(s,l),l+=s.byteLength;return o.buffer}function yw(i,e,t){const r=t!==void 0?new Uint8Array(i).subarray(e,e+t):new Uint8Array(i).subarray(e);return new Uint8Array(r).buffer}function Hm(i,e){return Ls(i>=0),Ls(e>0),i+(e-1)&~(e-1)}function g8(i,e,t){let r;if(i instanceof ArrayBuffer)r=new Uint8Array(i);else{const n=i.byteOffset,o=i.byteLength;r=new Uint8Array(i.buffer||i.arrayBuffer,n,o)}return e.set(r,t),t+Hm(r.byteLength,4)}async function m8(i){const e=[];for await(const t of i)e.push(t);return p8(...e)}function e5(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}let t5=class{constructor(e,t){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=e5(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(e5()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},y8=class{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let n=this.stats[t];return n||(e instanceof t5?n=e:n=new t5(t,r),this.stats[t]=n),n}};const _8="Queued Requests",v8="Active Requests",b8="Cancelled Requests",x8="Queued Requests Ever",w8="Active Requests Ever",B8={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class C8{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"props",void 0),ye(this,"stats",void 0),ye(this,"activeRequestCount",0),ye(this,"requestQueue",[]),ye(this,"requestMap",new Map),ye(this,"deferredUpdate",null),this.props={...B8,...e},this.stats=new y8({id:this.props.id}),this.stats.get(_8),this.stats.get(v8),this.stats.get(b8),this.stats.get(x8),this.stats.get(w8)}scheduleRequest(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:t},n=new Promise(o=>(r.resolve=o,r));return this.requestQueue.push(r),this.requestMap.set(e,n),this._issueNewRequests(),n}_issueRequest(e){const{handle:t,resolve:r}=e;let n=!1;const o=()=>{n||(n=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const r=e[t];this._updateRequest(r)||(e.splice(t,1),this.requestMap.delete(r.handle),t--)}e.sort((t,r)=>t.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let E8="";const i5={};function S8(i){for(const e in i5)if(i.startsWith(e)){const t=i5[e];i=i.replace(e,t)}return!i.startsWith("http://")&&!i.startsWith("https://")&&(i="".concat(E8).concat(i)),i}function Uve(i){return i}function T8(i){return i&&typeof i=="object"&&i.isBuffer}function r5(i){if(T8(i))return i;if(i instanceof ArrayBuffer)return i;if(ArrayBuffer.isView(i))return i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i.buffer.slice(i.byteOffset,i.byteOffset+i.byteLength);if(typeof i=="string"){const e=i;return new TextEncoder().encode(e).buffer}if(i&&typeof i=="object"&&i._toArrayBuffer)return i._toArrayBuffer();throw new Error("toArrayBuffer")}function n5(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(e+1):""}function _w(i){const e=i?i.lastIndexOf("/"):-1;return e>=0?i.substr(0,e):""}const I8=i=>typeof i=="boolean",Gm=i=>typeof i=="function",jm=i=>i!==null&&typeof i=="object",s5=i=>jm(i)&&i.constructor==={}.constructor,L8=i=>i&&typeof i[Symbol.iterator]=="function",M8=i=>i&&typeof i[Symbol.asyncIterator]=="function",df=i=>typeof Response<"u"&&i instanceof Response||i&&i.arrayBuffer&&i.text&&i.json,ff=i=>typeof Blob<"u"&&i instanceof Blob,P8=i=>i&&typeof i=="object"&&i.isBuffer,F8=i=>typeof ReadableStream<"u"&&i instanceof ReadableStream||jm(i)&&Gm(i.tee)&&Gm(i.cancel)&&Gm(i.getReader),D8=i=>jm(i)&&Gm(i.read)&&Gm(i.pipe)&&I8(i.readable),o5=i=>F8(i)||D8(i),R8=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,k8=/^([-\w.]+\/[-\w.+]+)/;function O8(i){const e=k8.exec(i);return e?e[1]:i}function a5(i){const e=R8.exec(i);return e?e[1]:""}const l5=/\?.*/;function U8(i){const e=i.match(l5);return e&&e[0]}function vw(i){return i.replace(l5,"")}function k_(i){return df(i)?i.url:ff(i)?i.name||"":typeof i=="string"?i:""}function bw(i){if(df(i)){const e=i,t=e.headers.get("content-type")||"",r=vw(e.url);return O8(t)||a5(r)}return ff(i)?i.type||"":typeof i=="string"?a5(i):""}function N8(i){return df(i)?i.headers["content-length"]||-1:ff(i)?i.size:typeof i=="string"?i.length:i instanceof ArrayBuffer||ArrayBuffer.isView(i)?i.byteLength:-1}async function c5(i){if(df(i))return i;const e={},t=N8(i);t>=0&&(e["content-length"]=String(t));const r=k_(i),n=bw(i);n&&(e["content-type"]=n);const o=await V8(i);o&&(e["x-first-bytes"]=o),typeof i=="string"&&(i=new TextEncoder().encode(i));const l=new Response(i,{headers:e});return Object.defineProperty(l,"url",{value:r}),l}async function z8(i){if(!i.ok){const e=await Q8(i);throw new Error(e)}}async function Q8(i){let e="Failed to fetch resource ".concat(i.url," (").concat(i.status,"): ");try{const t=i.headers.get("Content-Type");let r=i.statusText;t.includes("application/json")&&(r+=" ".concat(await i.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function V8(i){if(typeof i=="string")return"data:,".concat(i.slice(0,5));if(i instanceof Blob){const t=i.slice(0,5);return await new Promise(r=>{const n=new FileReader;n.onload=o=>{var l;return r(o==null||(l=o.target)===null||l===void 0?void 0:l.result)},n.readAsDataURL(t)})}if(i instanceof ArrayBuffer){const t=i.slice(0,5),r=H8(t);return"data:base64,".concat(r)}return null}function H8(i){let e="";const t=new Uint8Array(i);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}async function u5(i,e){if(typeof i=="string"){i=S8(i);let t=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(t=e.fetch),await fetch(i,t)}return await c5(i)}function G8(i){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=i||e;return!!(t&&t.indexOf("Electron")>=0)}function qm(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||G8()}const O_=globalThis.window||globalThis.self||globalThis.global,$m=globalThis.process||{},h5=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";qm();function j8(i){try{const e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}let q8=class{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=j8(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function $8(i){let e;return i<10?e=`${i.toFixed(2)}ms`:i<100?e=`${i.toFixed(1)}ms`:i<1e3?e=`${i.toFixed(0)}ms`:e=`${(i/1e3).toFixed(2)}s`,e}function K8(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-i.length,0);return`${" ".repeat(t)}${i}`}function xw(i,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const n=i.src.replace(/\(/g,"%28").replace(/\)/g,"%29");i.width>r&&(t=Math.min(t,r/i.width));const o=i.width*t,l=i.height*t,s=["font-size:1px;",`padding:${Math.floor(l/2)}px ${Math.floor(o/2)}px;`,`line-height:${l}px;`,`background:url(${n});`,`background-size:${o}px ${l}px;`,"color:transparent;"].join("");return[`${e} %c+`,s]}let U_;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(U_||(U_={}));const W8=10;function A5(i){return typeof i!="string"?i:(i=i.toUpperCase(),U_[i]||U_.WHITE)}function X8(i,e,t){return!qm&&typeof i=="string"&&(e&&(i=`\x1B[${A5(e)}m${i}\x1B[39m`),t&&(i=`\x1B[${A5(t)+W8}m${i}\x1B[49m`)),i}function Z8(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(t),n=i;for(const o of r){const l=n[o];typeof l=="function"&&(e.find(s=>o===s)||(n[o]=l.bind(i)))}}function N_(i,e){if(!i)throw new Error(e||"Assertion failed")}function Vp(){let i;if(qm()&&O_.performance){var e,t;i=O_==null||(e=O_.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in $m){var r;const n=$m==null||(r=$m.hrtime)===null||r===void 0?void 0:r.call($m);i=n[0]*1e3+n[1]/1e6}else i=Date.now();return i}const Hp={debug:qm()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},J8={enabled:!0,level:0};function xu(){}const d5={},f5={once:!0};let ww=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=h5,this._startTs=Vp(),this._deltaTs=Vp(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new q8(`__probe-${this.id}__`,J8),this.timeStamp(`${this.id} started`),Z8(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Vp()-this._startTs).toPrecision(10))}getDelta(){return Number((Vp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){N_(e,t)}warn(e){return this._getLogFunction(0,e,Hp.warn,arguments,f5)}error(e){return this._getLogFunction(0,e,Hp.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Hp.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Hp.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Hp.debug||Hp.info,arguments,f5)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||xu,r&&[r],{tag:iQ(t)}):xu}image(e){let{logLevel:t,priority:r,image:n,message:o="",scale:l=1}=e;return this._shouldLog(t||r)?qm()?tQ({image:n,message:o,scale:l}):eQ():xu}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||xu)}group(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const n=g5({logLevel:e,message:t,opts:r}),{collapsed:o}=r;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||xu)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=p5(e)}_getLogFunction(e,t,r,n,o){if(this._shouldLog(e)){o=g5({logLevel:e,message:t,args:n,opts:o}),r=r||o.method,N_(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Vp();const l=o.tag||o.message;if(o.once&&l)if(!d5[l])d5[l]=Vp();else return xu;return t=Y8(this.id,o.message,o),r.bind(console,t,...o.args)}return xu}};ww.VERSION=h5;function p5(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return N_(Number.isFinite(e)&&e>=0),e}function g5(i){const{logLevel:e,message:t}=i;i.logLevel=p5(e);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const n=typeof i.message;return N_(n==="string"||n==="object"),Object.assign(i,{args:r},i.opts)}function Y8(i,e,t){if(typeof e=="string"){const r=t.time?K8($8(t.total)):"";e=t.time?`${i}: ${r}  ${e}`:`${i}: ${e}`,e=X8(e,t.color,t.background)}return e}function eQ(i){return console.warn("removed"),xu}function tQ(i){let{image:e,message:t="",scale:r=1}=i;if(typeof e=="string"){const o=new Image;return o.onload=()=>{const l=xw(o,t,r);console.log(...l)},o.src=e,xu}const n=e.nodeName||"";if(n.toLowerCase()==="img")return console.log(...xw(e,t,r)),xu;if(n.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...xw(o,t,r)),o.src=e.toDataURL(),xu}return xu}function iQ(i){for(const e in i)for(const t in i[e])return t||"untitled";return"empty"}const m5=new ww({id:"loaders.gl"});class rQ{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class nQ{constructor(){ye(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.console.error.bind(this.console,...t)}}const y5={fetch:null,mimeType:void 0,nothrow:!1,log:new nQ,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:R_,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},sQ={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function _5(){globalThis.loaders=globalThis.loaders||{};const{loaders:i}=globalThis;return i._state=i._state||{},i._state}const v5=()=>{const i=_5();return i.globalOptions=i.globalOptions||{...y5},i.globalOptions};function oQ(i,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],aQ(i,t),cQ(e,i,r)}function aQ(i,e){b5(i,null,y5,sQ,e);for(const t of e){const r=i&&i[t.id]||{},n=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};b5(r,t.id,n,o,e)}}function b5(i,e,t,r,n){const o=e||"Top level",l=e?"".concat(e,"."):"";for(const s in i){const g=!e&&jm(i[s]),b=s==="baseUri"&&!e,T=s==="workerUrl"&&e;if(!(s in t)&&!b&&!T){if(s in r)m5.warn("".concat(o," loader option '").concat(l).concat(s,"' no longer supported, use '").concat(r[s],"'"))();else if(!g){const F=lQ(s,n);m5.warn("".concat(o," loader option '").concat(l).concat(s,"' not recognized. ").concat(F))()}}}}function lQ(i,e){const t=i.toLowerCase();let r="";for(const n of e)for(const o in n.options){if(i===o)return"Did you mean '".concat(n.id,".").concat(o,"'?");const l=o.toLowerCase();(t.startsWith(l)||l.startsWith(t))&&(r=r||"Did you mean '".concat(n.id,".").concat(o,"'?"))}return r}function cQ(i,e,t){const n={...i.options||{}};return uQ(n,t),n.log===null&&(n.log=new rQ),x5(n,v5()),x5(n,e),n}function x5(i,e){for(const t in e)if(t in e){const r=e[t];s5(r)&&s5(i[t])?i[t]={...i[t],...e[t]}:i[t]=e[t]}}function uQ(i,e){e&&!("baseUri"in i)&&(i.baseUri=e)}function Bw(i){var e;return i?(Array.isArray(i)&&(i=i[0]),Array.isArray((e=i)===null||e===void 0?void 0:e.extensions)):!1}function Cw(i){var e,t;Ls(i,"null loader"),Ls(Bw(i),"invalid loader");let r;return Array.isArray(i)&&(r=i[1],i=i[0],i={...i,options:{...i.options,...r}}),((e=i)!==null&&e!==void 0&&e.parseTextSync||(t=i)!==null&&t!==void 0&&t.parseText)&&(i.text=!0),i.text||(i.binary=!0),i}const w5=()=>{const i=_5();return i.loaderRegistry=i.loaderRegistry||[],i.loaderRegistry};function hQ(i){const e=w5();i=Array.isArray(i)?i:[i];for(const t of i){const r=Cw(t);e.find(n=>r===n)||e.unshift(r)}}function AQ(){return w5()}const dQ=new ww({id:"loaders.gl"}),fQ=/\.([^.]+)$/;async function pQ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!C5(i))return null;let n=B5(i,e,{...t,nothrow:!0},r);if(n)return n;if(ff(i)&&(i=await i.slice(0,10).arrayBuffer(),n=B5(i,e,t,r)),!n&&!(t!=null&&t.nothrow))throw new Error(E5(i));return n}function B5(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!C5(i))return null;if(e&&!Array.isArray(e))return Cw(e);let n=[];e&&(n=n.concat(e)),t!=null&&t.ignoreRegisteredLoaders||n.push(...AQ()),mQ(n);const o=gQ(i,n,t,r);if(!o&&!(t!=null&&t.nothrow))throw new Error(E5(i));return o}function gQ(i,e,t,r){const n=k_(i),o=bw(i),l=vw(n)||(r==null?void 0:r.url);let s=null,g="";if(t!=null&&t.mimeType&&(s=Ew(e,t==null?void 0:t.mimeType),g="match forced by supplied MIME type ".concat(t==null?void 0:t.mimeType)),s=s||yQ(e,l),g=g||(s?"matched url ".concat(l):""),s=s||Ew(e,o),g=g||(s?"matched MIME type ".concat(o):""),s=s||vQ(e,i),g=g||(s?"matched initial data ".concat(T5(i)):""),s=s||Ew(e,t==null?void 0:t.fallbackMimeType),g=g||(s?"matched fallback MIME type ".concat(o):""),g){var b;dQ.log(1,"selectLoader selected ".concat((b=s)===null||b===void 0?void 0:b.name,": ").concat(g,"."))}return s}function C5(i){return!(i instanceof Response&&i.status===204)}function E5(i){const e=k_(i),t=bw(i);let r="No valid loader found (";r+=e?"".concat(n5(e),", "):"no url provided, ",r+="MIME type: ".concat(t?'"'.concat(t,'"'):"not provided",", ");const n=i?T5(i):"";return r+=n?' first bytes: "'.concat(n,'"'):"first bytes: not available",r+=")",r}function mQ(i){for(const e of i)Cw(e)}function yQ(i,e){const t=e&&fQ.exec(e),r=t&&t[1];return r?_Q(i,r):null}function _Q(i,e){e=e.toLowerCase();for(const t of i)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function Ew(i,e){for(const t of i)if(t.mimeTypes&&t.mimeTypes.includes(e)||e==="application/x.".concat(t.id))return t;return null}function vQ(i,e){if(!e)return null;for(const t of i)if(typeof e=="string"){if(bQ(e,t))return t}else if(ArrayBuffer.isView(e)){if(S5(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&S5(e,0,t))return t;return null}function bQ(i,e){return e.testText?e.testText(i):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>i.startsWith(r))}function S5(i,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>xQ(i,e,t,n))}function xQ(i,e,t,r){if(r instanceof ArrayBuffer)return f8(r,i,r.byteLength);switch(typeof r){case"function":return r(i,t);case"string":const n=Sw(i,e,r.length);return r===n;default:return!1}}function T5(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof i=="string"?i.slice(0,e):ArrayBuffer.isView(i)?Sw(i.buffer,i.byteOffset,e):i instanceof ArrayBuffer?Sw(i,0,e):""}function Sw(i,e,t){if(i.byteLength<e+t)return"";const r=new DataView(i);let n="";for(let o=0;o<t;o++)n+=String.fromCharCode(r.getUint8(e+o));return n}const wQ=256*1024;function*BQ(i,e){const t=(e==null?void 0:e.chunkSize)||wQ;let r=0;const n=new TextEncoder;for(;r<i.length;){const o=Math.min(i.length-r,t),l=i.slice(r,r+o);r+=o,yield n.encode(l)}}const CQ=256*1024;function EQ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:t=CQ}=e;let r=0;for(;r<i.byteLength;){const n=Math.min(i.byteLength-r,t),o=new ArrayBuffer(n),l=new Uint8Array(i,r,n);new Uint8Array(o).set(l),r+=n,yield o}}()}const SQ=1024*1024;async function*TQ(i,e){const t=(e==null?void 0:e.chunkSize)||SQ;let r=0;for(;r<i.size;){const n=r+t,o=await i.slice(r,n).arrayBuffer();r=n,yield o}}function I5(i,e){return R_?IQ(i,e):LQ(i)}async function*IQ(i,e){const t=i.getReader();let r;try{for(;;){const n=r||t.read();e!=null&&e._streamReadAhead&&(r=t.read());const{done:o,value:l}=await n;if(o)return;yield r5(l)}}catch{t.releaseLock()}}async function*LQ(i,e){for await(const t of i)yield r5(t)}function MQ(i,e){if(typeof i=="string")return BQ(i,e);if(i instanceof ArrayBuffer)return EQ(i,e);if(ff(i))return TQ(i,e);if(o5(i))return I5(i,e);if(df(i))return I5(i.body,e);throw new Error("makeIterator")}const L5="Cannot convert supplied data type";function PQ(i,e,t){if(e.text&&typeof i=="string")return i;if(P8(i)&&(i=i.buffer),i instanceof ArrayBuffer){const r=i;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(i)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(i);let r=i.buffer;const n=i.byteLength||i.length;return(i.byteOffset!==0||n!==r.byteLength)&&(r=r.slice(i.byteOffset,i.byteOffset+n)),r}throw new Error(L5)}async function FQ(i,e,t){const r=i instanceof ArrayBuffer||ArrayBuffer.isView(i);if(typeof i=="string"||r)return PQ(i,e);if(ff(i)&&(i=await c5(i)),df(i)){const n=i;return await z8(n),e.binary?await n.arrayBuffer():await n.text()}if(o5(i)&&(i=MQ(i,t)),L8(i)||M8(i))return m8(i);throw new Error(L5)}function M5(i,e){const t=v5(),r=i||t;return typeof r.fetch=="function"?r.fetch:jm(r.fetch)?n=>u5(n,r):e!=null&&e.fetch?e==null?void 0:e.fetch:u5}function DQ(i,e,t){if(t)return t;const r={fetch:M5(e,i),...i};if(r.url){const n=vw(r.url);r.baseUrl=n,r.queryString=U8(r.url),r.filename=n5(n),r.baseUrl=_w(n)}return Array.isArray(r.loaders)||(r.loaders=null),r}function RQ(i,e){if(!e&&i&&!Array.isArray(i))return i;let t;if(i&&(t=Array.isArray(i)?i:[i]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:null}async function Tw(i,e,t,r){kh(!r||typeof r=="object"),e&&!Array.isArray(e)&&!Bw(e)&&(r=void 0,t=e,e=void 0),i=await i,t=t||{};const n=k_(i),l=RQ(e,r),s=await pQ(i,l,t);return s?(t=oQ(t,s,l,n),r=DQ({url:n,parse:Tw,loaders:l},t,r||null),await kQ(s,i,t,r)):null}async function kQ(i,e,t,r){if(t8(i),df(e)){const n=e,{ok:o,redirected:l,status:s,statusText:g,type:b,url:T}=n,F=Object.fromEntries(n.headers.entries());r.response={headers:F,ok:o,redirected:l,status:s,statusText:g,type:b,url:T}}if(e=await FQ(e,i,t),i.parseTextSync&&typeof e=="string")return t.dataType="text",i.parseTextSync(e,t,r,i);if(c8(i,t))return await u8(i,e,t,r,Tw);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,r,i);if(i.parse)return await i.parse(e,t,r,i);throw kh(!i.parseSync),new Error("".concat(i.id," loader - no parser found and worker is disabled"))}async function id(i,e,t,r){!Array.isArray(e)&&!Bw(e)&&(t=e,e=void 0);const n=M5(t);let o=i;return typeof i=="string"&&(o=await n(i)),ff(i)&&(o=await n(i)),await Tw(o,e,t)}const OQ="3.4.14",{_parseImageNode:UQ}=globalThis,Iw=typeof Image<"u",Lw=typeof ImageBitmap<"u",Mw=R_?!0:!!UQ;function NQ(i){switch(i){case"auto":return Lw||Iw||Mw;case"imagebitmap":return Lw;case"image":return Iw;case"data":return Mw;default:throw new Error("@loaders.gl/images: image ".concat(i," not supported in this environment"))}}function zQ(){if(Lw)return"imagebitmap";if(Iw)return"image";if(Mw)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function QQ(i){const e=HQ(i);if(!e)throw new Error("Not an image");return e}function VQ(i){switch(QQ(i)){case"data":return i;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=i.width,e.height=i.height,t.drawImage(i,0,0),t.getImageData(0,0,i.width,i.height);default:throw new Error("getImageData")}}function HQ(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&i instanceof Image?"image":i&&typeof i=="object"&&i.data&&i.width&&i.height?"data":null}const GQ=/^data:image\/svg\+xml/,jQ=/\.svg((\?|#).*)?$/;function Pw(i){return i&&(GQ.test(i)||jQ.test(i))}function qQ(i,e){if(Pw(e)){let r=new TextDecoder().decode(i);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(o){throw new Error(o.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return P5(i,e)}function P5(i,e){if(Pw(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(i)])}async function F5(i,e,t){const r=qQ(i,t),n=self.URL||self.webkitURL,o=typeof r!="string"&&n.createObjectURL(r);try{return await $Q(o||r,e)}finally{o&&n.revokeObjectURL(o)}}async function $Q(i,e){const t=new Image;return t.src=i,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,n)=>{try{t.onload=()=>r(t),t.onerror=o=>n(new Error("Could not load image ".concat(i,": ").concat(o)))}catch(o){n(o)}})}const KQ={};let D5=!0;async function WQ(i,e,t){let r;Pw(t)?r=await F5(i,e,t):r=P5(i,t);const n=e&&e.imagebitmap;return await XQ(r,n)}async function XQ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((ZQ(e)||!D5)&&(e=null),e)try{return await createImageBitmap(i,e)}catch(t){console.warn(t),D5=!1}return await createImageBitmap(i)}function ZQ(i){for(const e in i||KQ)return!1;return!0}function JQ(i){return!iV(i,"ftyp",4)||!(i[8]&96)?null:YQ(i)}function YQ(i){switch(eV(i,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function eV(i,e,t){return String.fromCharCode(...i.slice(e,t))}function tV(i){return[...i].map(e=>e.charCodeAt(0))}function iV(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=tV(e);for(let n=0;n<r.length;++n)if(r[n]!==i[n+t])return!1;return!0}const Oh=!1,Km=!0;function Fw(i){const e=Wm(i);return nV(e)||aV(e)||sV(e)||oV(e)||rV(e)}function rV(i){const e=new Uint8Array(i instanceof DataView?i.buffer:i),t=JQ(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function nV(i){const e=Wm(i);return e.byteLength>=24&&e.getUint32(0,Oh)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Oh),height:e.getUint32(20,Oh)}:null}function sV(i){const e=Wm(i);return e.byteLength>=10&&e.getUint32(0,Oh)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Km),height:e.getUint16(8,Km)}:null}function oV(i){const e=Wm(i);return e.byteLength>=14&&e.getUint16(0,Oh)===16973&&e.getUint32(2,Km)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Km),height:e.getUint32(22,Km)}:null}function aV(i){const e=Wm(i);if(!(e.byteLength>=3&&e.getUint16(0,Oh)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:n}=lV();let o=2;for(;o+9<e.byteLength;){const l=e.getUint16(o,Oh);if(n.has(l))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Oh),width:e.getUint16(o+7,Oh)};if(!r.has(l))return null;o+=2,o+=e.getUint16(o,Oh)}return null}function lV(){const i=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)i.add(t);return{tableMarkers:i,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Wm(i){if(i instanceof DataView)return i;if(ArrayBuffer.isView(i))return new DataView(i.buffer);if(i instanceof ArrayBuffer)return new DataView(i);throw new Error("toDataView")}async function cV(i,e){const{mimeType:t}=Fw(i)||{},r=globalThis._parseImageNode;return Ls(r),await r(i,t)}async function uV(i,e,t){e=e||{};const n=(e.image||{}).type||"auto",{url:o}=t||{},l=hV(n);let s;switch(l){case"imagebitmap":s=await WQ(i,e,o);break;case"image":s=await F5(i,e,o);break;case"data":s=await cV(i);break;default:Ls(!1)}return n==="data"&&(s=VQ(s)),s}function hV(i){switch(i){case"auto":case"data":return zQ();default:return NQ(i),i}}const R5={id:"image",module:"images",name:"Images",version:OQ,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:uV,tests:[i=>!!Fw(new DataView(i))],options:{image:{type:"auto",decode:!0}}},Dw={};function AV(i){if(Dw[i]===void 0){const e=R_?fV(i):dV(i);Dw[i]=e}return Dw[i]}function dV(i){const e=["image/png","image/jpeg","image/gif"],{_parseImageNode:t,_imageFormatsNode:r=e}=globalThis;return!!t&&r.includes(i)}function fV(i){switch(i){case"image/avif":case"image/webp":return pV(i);default:return!0}}function pV(i){try{return document.createElement("canvas").toDataURL(i).indexOf("data:".concat(i))===0}catch{return!1}}function k5(i){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=i||e;return!!(t&&t.indexOf("Electron")>=0)}function vA(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||k5()}const z_={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Q_=z_.window||z_.self||z_.global,Xm=z_.process||{},O5=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";vA();const Rw=globalThis;function U5(i){if(!i&&!vA())return"Node";if(k5(i))return"Electron";const t=i||(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const r=t.indexOf("MSIE ")!==-1,n=t.indexOf("Trident/")!==-1;return r||n?"IE":Rw.chrome?"Chrome":Rw.safari?"Safari":Rw.mozInnerScreenX?"Firefox":"Unknown"}function gV(i){try{const e=window[i],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class mV{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";ye(this,"storage",void 0),ye(this,"id",void 0),ye(this,"config",void 0),this.storage=gV(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function yV(i){let e;return i<10?e="".concat(i.toFixed(2),"ms"):i<100?e="".concat(i.toFixed(1),"ms"):i<1e3?e="".concat(i.toFixed(0),"ms"):e="".concat((i/1e3).toFixed(2),"s"),e}function _V(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-i.length,0);return"".concat(" ".repeat(t)).concat(i)}function kw(i,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const n=i.src.replace(/\(/g,"%28").replace(/\)/g,"%29");i.width>r&&(t=Math.min(t,r/i.width));const o=i.width*t,l=i.height*t,s=["font-size:1px;","padding:".concat(Math.floor(l/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(l,"px;"),"background:url(".concat(n,");"),"background-size:".concat(o,"px ").concat(l,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}let V_;(function(i){i[i.BLACK=30]="BLACK",i[i.RED=31]="RED",i[i.GREEN=32]="GREEN",i[i.YELLOW=33]="YELLOW",i[i.BLUE=34]="BLUE",i[i.MAGENTA=35]="MAGENTA",i[i.CYAN=36]="CYAN",i[i.WHITE=37]="WHITE",i[i.BRIGHT_BLACK=90]="BRIGHT_BLACK",i[i.BRIGHT_RED=91]="BRIGHT_RED",i[i.BRIGHT_GREEN=92]="BRIGHT_GREEN",i[i.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",i[i.BRIGHT_BLUE=94]="BRIGHT_BLUE",i[i.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",i[i.BRIGHT_CYAN=96]="BRIGHT_CYAN",i[i.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(V_||(V_={}));function N5(i){return typeof i=="string"?V_[i.toUpperCase()]||V_.WHITE:i}function vV(i,e,t){return!vA&&typeof i=="string"&&(e&&(e=N5(e),i="\x1B[".concat(e,"m").concat(i,"\x1B[39m")),t&&(e=N5(t),i="\x1B[".concat(t+10,"m").concat(i,"\x1B[49m"))),i}function bV(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(i),r=Object.getOwnPropertyNames(t);for(const n of r)typeof i[n]=="function"&&(e.find(o=>n===o)||(i[n]=i[n].bind(i)))}function H_(i,e){if(!i)throw new Error(e||"Assertion failed")}function Gp(){let i;if(vA&&"performance"in Q_){var e,t;i=Q_==null||(e=Q_.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in Xm){var r;const n=Xm==null||(r=Xm.hrtime)===null||r===void 0?void 0:r.call(Xm);i=n[0]*1e3+n[1]/1e6}else i=Date.now();return i}const jp={debug:vA&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},xV={enabled:!0,level:0};function wu(){}const z5={},Q5={once:!0};class Ow{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};ye(this,"id",void 0),ye(this,"VERSION",O5),ye(this,"_startTs",Gp()),ye(this,"_deltaTs",Gp()),ye(this,"_storage",void 0),ye(this,"userData",{}),ye(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new mV("__probe-".concat(this.id,"__"),xV),this.timeStamp("".concat(this.id," started")),bV(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Gp()-this._startTs).toPrecision(10))}getDelta(){return Number((Gp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){H_(e,t)}warn(e){return this._getLogFunction(0,e,jp.warn,arguments,Q5)}error(e){return this._getLogFunction(0,e,jp.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,jp.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,jp.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];return this._getLogFunction(e,t,jp.debug||jp.info,arguments,Q5)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||wu,r&&[r],{tag:EV(t)}):wu}image(e){let{logLevel:t,priority:r,image:n,message:o="",scale:l=1}=e;return this._shouldLog(t||r)?vA?CV({image:n,message:o,scale:l}):BV():wu}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||wu)}group(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const n=H5({logLevel:e,message:t,opts:r}),{collapsed:o}=r;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||wu)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=V5(e)}_getLogFunction(e,t,r,n,o){if(this._shouldLog(e)){o=H5({logLevel:e,message:t,args:n,opts:o}),r=r||o.method,H_(r),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Gp();const l=o.tag||o.message;if(o.once)if(!z5[l])z5[l]=Gp();else return wu;return t=wV(this.id,o.message,o),r.bind(console,t,...o.args)}return wu}}ye(Ow,"VERSION",O5);function V5(i){if(!i)return 0;let e;switch(typeof i){case"number":e=i;break;case"object":e=i.logLevel||i.priority||0;break;default:return 0}return H_(Number.isFinite(e)&&e>=0),e}function H5(i){const{logLevel:e,message:t}=i;i.logLevel=V5(e);const r=i.args?Array.from(i.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),i.message=e;break;case"object":Object.assign(i,e);break}typeof i.message=="function"&&(i.message=i.message());const n=typeof i.message;return H_(n==="string"||n==="object"),Object.assign(i,{args:r},i.opts)}function wV(i,e,t){if(typeof e=="string"){const r=t.time?_V(yV(t.total)):"";e=t.time?"".concat(i,": ").concat(r,"  ").concat(e):"".concat(i,": ").concat(e),e=vV(e,t.color,t.background)}return e}function BV(i){return console.warn("removed"),wu}function CV(i){let{image:e,message:t="",scale:r=1}=i;if(typeof e=="string"){const o=new Image;return o.onload=()=>{const l=kw(o,t,r);console.log(...l)},o.src=e,wu}const n=e.nodeName||"";if(n.toLowerCase()==="img")return console.log(...kw(e,t,r)),wu;if(n.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...kw(o,t,r)),o.src=e.toDataURL(),wu}return wu}function EV(i){for(const e in i)for(const t in i[e])return t||"untitled";return"empty"}const Dn=new Ow({id:"deck"}),rd={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},Uw=1,Zm=2,Nw=3,zw=4,SV=2,TV=i=>({"layer.changeFlag":(e,t,r)=>{i.log(Nw,"".concat(e.id," ").concat(t,": "),r[t])()},"layer.initialize":e=>{i.log(Uw,"Initializing ".concat(e))()},"layer.update":(e,t)=>{if(t){const r=e.getChangeFlags();i.log(Zm,"Updating ".concat(e," because: ").concat(Object.keys(r).filter(n=>r[n]).join(", ")))()}else i.log(zw,"".concat(e," does not need update"))()},"layer.matched":(e,t)=>{t&&i.log(zw,"Matched ".concat(e,", state transfered"))()},"layer.finalize":e=>{i.log(Uw,"Finalizing ".concat(e))()},"compositeLayer.renderLayers":(e,t,r)=>{t?i.log(Zm,"Composite layer rendered new subLayers ".concat(e),r)():i.log(zw,"Composite layer reused subLayers ".concat(e),r)()},"layerManager.setLayers":(e,t,r)=>{t&&i.log(Zm,"Updating ".concat(r.length," deck layers"))()},"layerManager.activateViewport":(e,t)=>{i.log(Nw,"Viewport changed",t)()},"attributeManager.invalidate":(e,t,r)=>{i.log(Uw,r?"invalidated attributes ".concat(r," (").concat(t,") for ").concat(e.id):"invalidated all attributes for ".concat(e.id))()},"attributeManager.updateStart":e=>{rd.attributeUpdateMessages.length=0,rd.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(e,t)=>{const r=Math.round(Date.now()-rd.attributeManagerUpdateStart);i.groupCollapsed(Zm,"Updated attributes for ".concat(t," instances in ").concat(e.id," in ").concat(r,"ms"))();for(const n of rd.attributeUpdateMessages)i.log(Nw,n)();i.groupEnd(Zm)()},"attribute.updateStart":e=>{rd.attributeUpdateStart=Date.now()},"attribute.allocate":(e,t)=>{const r="".concat(e.id," allocated ").concat(t);rd.attributeUpdateMessages.push(r)},"attribute.updateEnd":(e,t)=>{const r=Math.round(Date.now()-rd.attributeUpdateStart),n="".concat(e.id," updated ").concat(t," in ").concat(r,"ms");rd.attributeUpdateMessages.push(n)},"deckRenderer.renderLayers":(e,t,r)=>{const{pass:n,redrawReason:o,stats:l}=r;for(const s of t){const{totalCount:g,visibleCount:b,compositeCount:T,pickableCount:F}=s,z=g-T-b;i.log(SV,"RENDER #".concat(e.renderCount,"   ").concat(b," (of ").concat(g," layers) to ").concat(n," because ").concat(o,"   (").concat(z," hidden, ").concat(T," composite ").concat(F," pickable)"))(),l&&l.get("Redraw Layers").add(b)}}});var IV={};let G_={};IV.NODE_ENV!=="production"&&(G_=TV(Dn));function LV(i){G_=i}function El(i,e,t,r){Dn.level>0&&G_[i]&&G_[i].call(null,e,t,r)}function MV(i){const e=i[0],t=i[i.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const PV={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:MV,parseTextSync:JSON.parse};function FV(){const i="8.9.34",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==i)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(i));return e||(Dn.log(1,"deck.gl ".concat(i))(),globalThis.deck={...globalThis.deck,VERSION:i,version:i,log:Dn,_registerLoggers:LV},hQ([PV,[R5,{imagebitmap:{premultiplyAlpha:"none"}}]])),i}const DV=FV(),Ln={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ln,"IDENTITY",{get:()=>(Dn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Uh={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Qw={common:0,meters:1,pixels:2},G5={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},ar=new Ow({id:"luma.gl"});function rc(i,e){if(!i)throw new Error(e||"luma.gl: assertion failed.")}const RV="Invalid WebGLRenderingContext",kV="Requires WebGL2";function j_(i){return typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&Number.isFinite(i._version))}function hn(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function OV(i){return hn(i)?i:null}function q_(i){return rc(j_(i),RV),i}function nc(i){return rc(hn(i),kV),i}const Jm={};function UV(i){globalThis.console&&globalThis.console.error&&globalThis.console.error(i)}function NV(i){globalThis.console&&globalThis.console.log&&globalThis.console.log(i)}function zV(i,e){Jm[i]=!0,e!==void 0&&UV(e)}function QV(i){const e=i.getError;i.getError=function(){let r;do r=e.apply(i),r!==0&&(Jm[r]=!0);while(r!==0);for(r in Jm)if(Jm[r])return delete Jm[r],parseInt(r,10);return 0}}const Ym=function i(e){const t=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const n=new i.VertexAttrib(t);this.attribs[r]=n}this.maxAttrib=0};Ym.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()},Ym.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const pf=function(e){const t=this;this.gl=e,QV(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(o){return o===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(o){const l=t.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,o);const s=l.attribs[o];return s.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(o){const l=t.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,o);const s=l.attribs[o];return s.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(o,l){switch(o){case 34962:t.currentArrayBuffer=l;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=l;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(o,l){const g=t.currentVertexArrayObject.attribs[o];switch(l){case 34975:return g.buffer;case 34338:return g.enabled;case 34339:return g.size;case 34340:return g.stride;case 34341:return g.type;case 34922:return g.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(o,l,s,g,b,T){const F=t.currentVertexArrayObject;F.maxAttrib=Math.max(F.maxAttrib,o);const k=F.attribs[o];return k.buffer=t.currentArrayBuffer,k.size=l,k.type=s,k.normalized=g,k.stride=b,k.offset=T,k.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{NV("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};pf.prototype.VERTEX_ARRAY_BINDING_OES=34229,pf.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const t=this.gl;this.maxVertexAttribs=t.getParameter(34921),this.defaultVertexArrayObject=new Ym(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},pf.prototype.createVertexArrayOES=function(){const e=new Ym(this);return this.vertexArrayObjects.push(e),e},pf.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},pf.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof Ym&&e.hasBeenBound&&e.ext===this)},pf.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive){zV(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,n=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const o=this.currentVertexArrayObject;if(n===o)return;(!n||o.elementArrayBuffer!==n.elementArrayBuffer)&&r.bindBuffer.call(t,34963,o.elementArrayBuffer);let l=this.currentArrayBuffer;const s=Math.max(n?n.maxAttrib:0,o.maxAttrib);for(let g=0;g<=s;g++){const b=o.attribs[g],T=n?n.attribs[g]:null;if((!n||b.enabled!==T.enabled)&&(b.enabled?r.enableVertexAttribArray.call(t,g):r.disableVertexAttribArray.call(t,g)),b.enabled){let F=!1;(!n||b.buffer!==T.buffer)&&(l!==b.buffer&&(r.bindBuffer.call(t,34962,b.buffer),l=b.buffer),F=!0),(F||b.cached!==T.cached)&&r.vertexAttribPointer.call(t,g,b.size,b.type,b.normalized,b.stride,b.offset)}}this.currentArrayBuffer!==l&&r.bindBuffer.call(t,34962,this.currentArrayBuffer)};function VV(i){if(typeof i.createVertexArray=="function")return;const e=i.getSupportedExtensions;i.getSupportedExtensions=function(){const n=e.call(this)||[];return n.indexOf("OES_vertex_array_object")<0&&n.push("OES_vertex_array_object"),n};const t=i.getExtension;i.getExtension=function(n){const o=t.call(this,n);return o||(n!=="OES_vertex_array_object"?null:(i.__OESVertexArrayObject||(this.__OESVertexArrayObject=new pf(this)),this.__OESVertexArrayObject))}}const j5="OES_element_index",q5="WEBGL_draw_buffers",HV="EXT_disjoint_timer_query",GV="EXT_disjoint_timer_query_webgl2",jV="EXT_texture_filter_anisotropic",$5="WEBGL_debug_renderer_info",qV=35723,$V=4352,KV=36795,WV=34047,XV=37445,ZV=37446,zs=i=>hn(i)?void 0:0,JV={3074:i=>hn(i)?void 0:36064,[qV]:i=>hn(i)?void 0:$V,35977:zs,32937:zs,[KV]:(i,e)=>{const t=hn(i)?i.getExtension(GV):i.getExtension(HV);return t&&t.GPU_DISJOINT_EXT?e(t.GPU_DISJOINT_EXT):0},[XV]:(i,e)=>{const t=i.getExtension($5);return e(t&&t.UNMASKED_VENDOR_WEBGL||7936)},[ZV]:(i,e)=>{const t=i.getExtension($5);return e(t&&t.UNMASKED_RENDERER_WEBGL||7937)},[WV]:(i,e)=>{const t=i.luma.extensions[jV];return t?e(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:zs,35071:zs,37447:zs,36063:(i,e)=>{if(!hn(i)){const t=i.getExtension(q5);return t?e(t.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:zs,35374:zs,35377:zs,34852:i=>{if(!hn(i)){const e=i.getExtension(q5);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:i=>i.getExtension(j5)?2147483647:65535,33001:i=>i.getExtension(j5)?16777216:65535,33e3:i=>16777216,37157:zs,35373:zs,35657:zs,36183:zs,37137:zs,34045:zs,35978:zs,35979:zs,35968:zs,35376:zs,35375:zs,35659:zs,37154:zs,35371:zs,35658:zs,35076:zs,35077:zs,35380:zs};function YV(i,e,t){const r=JV[t],n=typeof r=="function"?r(i,e,t):r;return n!==void 0?n:e(t)}const eH="OES_vertex_array_object",K5="ANGLE_instanced_arrays",tH="WEBGL_draw_buffers",iH="EXT_disjoint_timer_query",rH="EXT_texture_filter_anisotropic",nH="VertexArray requires WebGL2 or OES_vertex_array_object extension";function sH(i,e){return{webgl2:hn(i),ext:i.getExtension(e)}}const W5={[eH]:{meta:{suffix:"OES"},createVertexArray:()=>{rc(!1,nH)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[K5]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(i,e){rc(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[tH]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{rc(!1)}},[iH]:{meta:{suffix:"EXT"},createQuery:()=>{rc(!1)},deleteQuery:()=>{rc(!1)},beginQuery:()=>{rc(!1)},endQuery:()=>{},getQuery(i,e){return this.getQueryObject(i,e)},getQueryParameter(i,e){return this.getQueryObject(i,e)},getQueryObject:()=>{}}},Vw={readBuffer:(i,e,t)=>{hn(i)&&e(t)},getVertexAttrib:(i,e,t,r)=>{const{webgl2:n,ext:o}=sH(i,K5);let l;switch(r){case 35069:l=n?void 0:!1;break;case 35070:l=!n&&!o?0:void 0;break}return l!==void 0?l:e(t,r)},getProgramParameter:(i,e,t,r)=>{if(!hn(i))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(t,r)},getInternalformatParameter:(i,e,t,r,n)=>{if(!hn(i))switch(n){case 32937:return new Int32Array([0])}return i.getInternalformatParameter(t,r,n)},getTexParameter(i,e,t,r){switch(r){case 34046:const{extensions:n}=i.luma,o=n[rH];r=o&&o.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(t,r)},getParameter:YV,hint(i,e,t,r){return e(t,r)}};function oH(i){i.luma=i.luma||{};const{luma:e}=i;return e.polyfilled||(VV(i),aH(i),cH(i,W5),lH(i,{target:e,target2:i}),e.polyfilled=!0),i}globalThis.polyfillContext=oH;function aH(i){i.luma.extensions={};const e=i.getSupportedExtensions()||[];for(const t of e)i.luma[t]=i.getExtension(t)}function lH(i,e){let{target:t,target2:r}=e;Object.keys(Vw).forEach(n=>{if(typeof Vw[n]=="function"){const o=i[n]?i[n].bind(i):()=>{},l=Vw[n].bind(null,i,o);t[n]=l,r[n]=l}})}function cH(i,e){for(const t of Object.getOwnPropertyNames(e))t!=="overrides"&&uH(i,{extension:t,target:i.luma,target2:i})}function uH(i,e){let{extension:t,target:r,target2:n}=e;const o=W5[t];rc(o);const{meta:l={}}=o,{suffix:s=""}=l,g=i.getExtension(t);for(const b of Object.keys(o)){const T="".concat(b).concat(s);let F=null;b==="meta"||typeof i[b]=="function"||(g&&typeof g[T]=="function"?F=function(){return g[T](...arguments)}:typeof o[b]=="function"&&(F=o[b].bind(r))),F&&(r[b]=F,n[b]=F)}}const Hw={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},nd=(i,e,t)=>e?i.enable(t):i.disable(t),X5=(i,e,t)=>i.hint(t,e),Wc=(i,e,t)=>i.pixelStorei(t,e),hH=(i,e)=>{const t=hn(i)?36009:36160;return i.bindFramebuffer(t,e)},AH=(i,e)=>i.bindFramebuffer(36008,e);function ey(i){return Array.isArray(i)||ArrayBuffer.isView(i)}const dH={3042:nd,32773:(i,e)=>i.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(i,e)=>i.clearColor(...e),3107:(i,e)=>i.colorMask(...e),2884:nd,2885:(i,e)=>i.cullFace(e),2929:nd,2931:(i,e)=>i.clearDepth(e),2932:(i,e)=>i.depthFunc(e),2928:(i,e)=>i.depthRange(...e),2930:(i,e)=>i.depthMask(e),3024:nd,35723:X5,36006:hH,2886:(i,e)=>i.frontFace(e),33170:X5,2849:(i,e)=>i.lineWidth(e),32823:nd,32824:"polygonOffset",10752:"polygonOffset",35977:nd,32938:"sampleCoverage",32939:"sampleCoverage",3089:nd,3088:(i,e)=>i.scissor(...e),2960:nd,2961:(i,e)=>i.clearStencil(e),2968:(i,e)=>i.stencilMaskSeparate(1028,e),36005:(i,e)=>i.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(i,e)=>i.viewport(...e),3333:Wc,3317:Wc,37440:Wc,37441:Wc,37443:Wc,3330:Wc,3332:Wc,3331:Wc,36010:AH,3314:Wc,32878:Wc,3316:Wc,3315:Wc,32877:Wc,framebuffer:(i,e)=>{const t=e&&"handle"in e?e.handle:e;return i.bindFramebuffer(36160,t)},blend:(i,e)=>e?i.enable(3042):i.disable(3042),blendColor:(i,e)=>i.blendColor(...e),blendEquation:(i,e)=>{e=ey(e)?e:[e,e],i.blendEquationSeparate(...e)},blendFunc:(i,e)=>{e=ey(e)&&e.length===2?[...e,...e]:e,i.blendFuncSeparate(...e)},clearColor:(i,e)=>i.clearColor(...e),clearDepth:(i,e)=>i.clearDepth(e),clearStencil:(i,e)=>i.clearStencil(e),colorMask:(i,e)=>i.colorMask(...e),cull:(i,e)=>e?i.enable(2884):i.disable(2884),cullFace:(i,e)=>i.cullFace(e),depthTest:(i,e)=>e?i.enable(2929):i.disable(2929),depthFunc:(i,e)=>i.depthFunc(e),depthMask:(i,e)=>i.depthMask(e),depthRange:(i,e)=>i.depthRange(...e),dither:(i,e)=>e?i.enable(3024):i.disable(3024),derivativeHint:(i,e)=>{i.hint(35723,e)},frontFace:(i,e)=>i.frontFace(e),mipmapHint:(i,e)=>i.hint(33170,e),lineWidth:(i,e)=>i.lineWidth(e),polygonOffsetFill:(i,e)=>e?i.enable(32823):i.disable(32823),polygonOffset:(i,e)=>i.polygonOffset(...e),sampleCoverage:(i,e)=>i.sampleCoverage(...e),scissorTest:(i,e)=>e?i.enable(3089):i.disable(3089),scissor:(i,e)=>i.scissor(...e),stencilTest:(i,e)=>e?i.enable(2960):i.disable(2960),stencilMask:(i,e)=>{e=ey(e)?e:[e,e];const[t,r]=e;i.stencilMaskSeparate(1028,t),i.stencilMaskSeparate(1029,r)},stencilFunc:(i,e)=>{e=ey(e)&&e.length===3?[...e,...e]:e;const[t,r,n,o,l,s]=e;i.stencilFuncSeparate(1028,t,r,n),i.stencilFuncSeparate(1029,o,l,s)},stencilOp:(i,e)=>{e=ey(e)&&e.length===3?[...e,...e]:e;const[t,r,n,o,l,s]=e;i.stencilOpSeparate(1028,t,r,n),i.stencilOpSeparate(1029,o,l,s)},viewport:(i,e)=>i.viewport(...e)};function bo(i,e,t){return e[i]!==void 0?e[i]:t[i]}const fH={blendEquation:(i,e,t)=>i.blendEquationSeparate(bo(32777,e,t),bo(34877,e,t)),blendFunc:(i,e,t)=>i.blendFuncSeparate(bo(32969,e,t),bo(32968,e,t),bo(32971,e,t),bo(32970,e,t)),polygonOffset:(i,e,t)=>i.polygonOffset(bo(32824,e,t),bo(10752,e,t)),sampleCoverage:(i,e,t)=>i.sampleCoverage(bo(32938,e,t),bo(32939,e,t)),stencilFuncFront:(i,e,t)=>i.stencilFuncSeparate(1028,bo(2962,e,t),bo(2967,e,t),bo(2963,e,t)),stencilFuncBack:(i,e,t)=>i.stencilFuncSeparate(1029,bo(34816,e,t),bo(36003,e,t),bo(36004,e,t)),stencilOpFront:(i,e,t)=>i.stencilOpSeparate(1028,bo(2964,e,t),bo(2965,e,t),bo(2966,e,t)),stencilOpBack:(i,e,t)=>i.stencilOpSeparate(1029,bo(34817,e,t),bo(34818,e,t),bo(34819,e,t))},Z5={enable:(i,e)=>i({[e]:!0}),disable:(i,e)=>i({[e]:!1}),pixelStorei:(i,e,t)=>i({[e]:t}),hint:(i,e,t)=>i({[e]:t}),bindFramebuffer:(i,e,t)=>{switch(e){case 36160:return i({36006:t,36010:t});case 36009:return i({36006:t});case 36008:return i({36010:t});default:return null}},blendColor:(i,e,t,r,n)=>i({32773:new Float32Array([e,t,r,n])}),blendEquation:(i,e)=>i({32777:e,34877:e}),blendEquationSeparate:(i,e,t)=>i({32777:e,34877:t}),blendFunc:(i,e,t)=>i({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(i,e,t,r,n)=>i({32969:e,32968:t,32971:r,32970:n}),clearColor:(i,e,t,r,n)=>i({3106:new Float32Array([e,t,r,n])}),clearDepth:(i,e)=>i({2931:e}),clearStencil:(i,e)=>i({2961:e}),colorMask:(i,e,t,r,n)=>i({3107:[e,t,r,n]}),cullFace:(i,e)=>i({2885:e}),depthFunc:(i,e)=>i({2932:e}),depthRange:(i,e,t)=>i({2928:new Float32Array([e,t])}),depthMask:(i,e)=>i({2930:e}),frontFace:(i,e)=>i({2886:e}),lineWidth:(i,e)=>i({2849:e}),polygonOffset:(i,e,t)=>i({32824:e,10752:t}),sampleCoverage:(i,e,t)=>i({32938:e,32939:t}),scissor:(i,e,t,r,n)=>i({3088:new Int32Array([e,t,r,n])}),stencilMask:(i,e)=>i({2968:e,36005:e}),stencilMaskSeparate:(i,e,t)=>i({[e===1028?2968:36005]:t}),stencilFunc:(i,e,t,r)=>i({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(i,e,t,r,n)=>i({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:n}),stencilOp:(i,e,t,r)=>i({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(i,e,t,r,n)=>i({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:n}),viewport:(i,e,t,r,n)=>i({2978:[e,t,r,n]})},Nh=(i,e)=>i.isEnabled(e),J5={3042:Nh,2884:Nh,2929:Nh,3024:Nh,32823:Nh,32926:Nh,32928:Nh,3089:Nh,2960:Nh,35977:Nh};function Y5(i){for(const e in i)return!1;return!0}function pH(i,e){if(i===e)return!0;const t=Array.isArray(i)||ArrayBuffer.isView(i),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&i.length===e.length){for(let n=0;n<i.length;++n)if(i[n]!==e[n])return!1;return!0}return!1}function e3(i,e){const t=i[e].bind(i);i[e]=function(){const n=arguments.length<=0?void 0:arguments[0];return n in i.state.cache?i.state.enable?i.state.cache[n]:t(...arguments):t(...arguments)},Object.defineProperty(i[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function gH(i,e,t){const r=i[e].bind(i);i[e]=function(){for(var o=arguments.length,l=new Array(o),s=0;s<o;s++)l[s]=arguments[s];const{valueChanged:g,oldValue:b}=t(i.state._updateCache,...l);return g&&r(...l),b},Object.defineProperty(i[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function mH(i){const e=i.useProgram.bind(i);i.useProgram=function(r){i.state.program!==r&&(e(r),i.state.program=r)}}class yH{constructor(e){let{copyState:t=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?vH(e):Object.assign({},Hw),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){rc(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];bA(this.gl,e),this.stateStack.pop()}_updateCache(e){let t=!1,r;const n=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const o in e){rc(o!==void 0);const l=e[o],s=this.cache[o];pH(l,s)||(t=!0,r=s,n&&!(o in n)&&(n[o]=s),this.cache[o]=l)}return{valueChanged:t,oldValue:r}}}function t3(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:t=!0,copyState:r}=e;if(rc(r!==void 0),!i.state){const{polyfillContext:n}=globalThis;n&&n(i),i.state=new yH(i,{copyState:r}),mH(i);for(const o in Z5){const l=Z5[o];gH(i,o,l)}e3(i,"getParameter"),e3(i,"isEnabled")}return i.state.enable=t,i}function _H(i){i.state||t3(i,{copyState:!1}),i.state.push()}function i3(i){rc(i.state),i.state.pop()}function bA(i,e){if(rc(j_(i),"setParameters requires a WebGL context"),Y5(e))return;const t={};for(const n in e){const o=Number(n),l=dH[n];l&&(typeof l=="string"?t[l]=!0:l(i,e[n],o))}const r=i.state&&i.state.cache;if(r)for(const n in t){const o=fH[n];o(i,e,r)}}function vH(i,e){if(e=e||Hw,typeof e=="number"){const n=e,o=J5[n];return o?o(i,n):i.getParameter(n)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const n of t){const o=J5[n];r[n]=o?o(i,Number(n)):i.getParameter(Number(n))}return r}function bH(i){bA(i,Hw)}function Ju(i,e,t){if(Y5(e))return t(i);const{nocatch:r=!0}=e;_H(i),bA(i,e);let n;if(r)n=t(i),i3(i);else try{n=t(i)}finally{i3(i)}return n}function qp(i){const{luma:e}=i;if(i.canvas&&e){const t=e.canvasSizeInfo,r="clientWidth"in t?t.clientWidth:i.canvas.clientWidth;return r?i.drawingBufferWidth/r:1}return 1}function Gw(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=qp(i),n=i.drawingBufferWidth,o=i.drawingBufferHeight;return wH(e,r,n,o,t)}function xH(i){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(i)?i<=0?1:i:i?e:1}function wH(i,e,t,r,n){const o=r3(i[0],e,t);let l=n3(i[1],e,r,n),s=r3(i[0]+1,e,t);const g=s===t-1?s:s-1;s=n3(i[1]+1,e,r,n);let b;return n?(s=s===0?s:s+1,b=l,l=s):b=s===r-1?s:s-1,{x:o,y:l,width:Math.max(g-o+1,1),height:Math.max(b-l+1,1)}}function r3(i,e,t){return Math.min(Math.round(i*e),t-1)}function n3(i,e,t,r){return r?Math.max(0,t-1-Math.round(i*e)):Math.min(Math.round(i*e),t-1)}const jw=vA(),BH=jw&&typeof document<"u",s3={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function o3(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};rc(jw,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),i=Object.assign({},s3,i);const{width:e,height:t}=i;function r(s){if(i.throwOnError)throw new Error(s);return console.error(s),null}i.onError=r;let n;const{canvas:o}=i,l=TH({canvas:o,width:e,height:t,onError:r});return n=SH(l,i),n?(n=qw(n,i),IH(n),n):null}function qw(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!i||i._instrumented)return i;i._version=i._version||LH(i),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{},e=Object.assign({},s3,e);const{manageState:t,debug:r}=e;return t&&t3(i,{copyState:!1,log:function(){for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return ar.log(1,...o)()}}),jw&&r&&(globalThis.makeDebugContext?(i=globalThis.makeDebugContext(i,e),ar.level=Math.max(ar.level,1)):ar.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),i._instrumented=!0,i}function CH(i){const e=i.getParameter(7936),t=i.getParameter(7937),r=i.getExtension("WEBGL_debug_renderer_info"),n=r&&i.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),o=r&&i.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:n||e,renderer:o||t,vendorMasked:e,rendererMasked:t,version:i.getParameter(7938),shadingLanguageVersion:i.getParameter(35724)}}function EH(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(i.canvas){const r=xH(e.useDevicePixels);MH(i,r,e);return}const t=i.getExtension("STACKGL_resize_drawingbuffer");t&&"width"in e&&"height"in e&&t.resize(e.width,e.height)}function SH(i,e){const{onError:t}=e;let r=null;const n=g=>r=g.statusMessage||r;i.addEventListener("webglcontextcreationerror",n,!1);const{webgl1:o=!0,webgl2:l=!0}=e;let s=null;return l&&(s=s||i.getContext("webgl2",e),s=s||i.getContext("experimental-webgl2",e)),o&&(s=s||i.getContext("webgl",e),s=s||i.getContext("experimental-webgl",e)),i.removeEventListener("webglcontextcreationerror",n,!1),s?(e.onContextLost&&i.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&i.addEventListener("webglcontextrestored",e.onContextRestored,!1),s):t("Failed to create ".concat(l&&!o?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function TH(i){let{canvas:e,width:t=800,height:r=600,onError:n}=i,o;return typeof e=="string"?(BH&&document.readyState==="complete"||n("createGLContext called on canvas '".concat(e,"' before page was loaded")),o=document.getElementById(e)):e?o=e:(o=document.createElement("canvas"),o.id="lumagl-canvas",o.style.width=Number.isFinite(t)?"".concat(t,"px"):"100%",o.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(o,document.body.firstChild)),o}function IH(i){const e=hn(i)?"WebGL2":"WebGL1",t=CH(i),r=t?"(".concat(t.vendor,",").concat(t.renderer,")"):"",n=i.debug?" debug":"";ar.info(1,"".concat(e).concat(n," context ").concat(r))()}function LH(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?2:1}function MH(i,e,t){let r="width"in t?t.width:i.canvas.clientWidth,n="height"in t?t.height:i.canvas.clientHeight;(!r||!n)&&(ar.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=i.canvas.width||1,n=i.canvas.height||1),i.luma=i.luma||{},i.luma.canvasSizeInfo=i.luma.canvasSizeInfo||{};const o=i.luma.canvasSizeInfo;if(o.clientWidth!==r||o.clientHeight!==n||o.devicePixelRatio!==e){let l=e;const s=Math.floor(r*l),g=Math.floor(n*l);i.canvas.width=s,i.canvas.height=g,(i.drawingBufferWidth!==s||i.drawingBufferHeight!==g)&&(ar.warn("Device pixel ratio clamped")(),l=Math.min(i.drawingBufferWidth/r,i.drawingBufferHeight/n),i.canvas.width=Math.floor(r*l),i.canvas.height=Math.floor(n*l)),Object.assign(i.luma.canvasSizeInfo,{clientWidth:r,clientHeight:n,devicePixelRatio:e})}}function a3(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}let l3=class{constructor(e,t){ye(this,"name",void 0),ye(this,"type",void 0),ye(this,"sampleSize",1),ye(this,"time",void 0),ye(this,"count",void 0),ye(this,"samples",void 0),ye(this,"lastTiming",void 0),ye(this,"lastSampleTime",void 0),ye(this,"lastSampleCount",void 0),ye(this,"_count",0),ye(this,"_time",0),ye(this,"_samples",0),ye(this,"_startTime",0),ye(this,"_timerPending",!1),this.name=e,this.type=t,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=a3(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(a3()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},$w=class{constructor(e){ye(this,"id",void 0),ye(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t])}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:r}=e;return this.stats[t]||(e instanceof l3?this.stats[t]=e:this.stats[t]=new l3(t,r)),this.stats[t]}};const ty="8.5.21",PH="set luma.log.level=1 (or higher) to trace rendering";class FH{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new $w({id:e})),this.stats.get(e)}}const gf=new FH;if(globalThis.luma&&globalThis.luma.VERSION!==ty)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(ty));globalThis.luma||(vA()&&ar.log(1,"luma.gl ".concat(ty," - ").concat(PH))(),globalThis.luma=globalThis.luma||{VERSION:ty,version:ty,log:ar,stats:gf,globals:{modules:{},nodeIO:{}}});function DH(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,1e3/60)}function RH(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):clearTimeout(i)}function Xi(i,e){if(!i)throw new Error(e||"luma.gl: assertion failed.")}function Kw(i,e){if(typeof e!="string")return e;const t=Number(e);if(!isNaN(t))return t;e=e.replace(/^.*\./,"");const r=i[e];return Xi(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function sd(i,e){e=Number(e);for(const t in i)if(i[t]===e)return"GL.".concat(t);return String(e)}const Ww={};function xA(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Ww[i]=Ww[i]||1;const e=Ww[i]++;return"".concat(i,"-").concat(e)}function c3(i){return Xi(typeof i=="number","Input must be a number"),i&&(i&i-1)===0}function $p(i){let e=!0;for(const t in i){e=!1;break}return e}function u3(i,e,t,r){const n="See luma.gl ".concat(t," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),o=Object.getPrototypeOf(i);r.forEach(l=>{o.methodName||(o[l]=()=>{throw ar.removed("Calling removed method ".concat(e,".").concat(l,": "),n)(),new Error(l)})})}const Kp="Resource subclass must define virtual methods";let wA=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};q_(e);const{id:r,userData:n={}}=t;this.gl=e,this.gl2=e,this.id=r||xA(this[Symbol.toStringTag]),this.userData=n,this._bound=!1,this._handle=t.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Kw(this.gl,e),Xi(e);const n=(this.constructor.PARAMETERS||{})[e];if(n){const o=hn(this.gl);if(!((!("webgl2"in n)||o)&&(!("extension"in n)||this.gl.getExtension(n.extension)))){const s=n.webgl1,g="webgl2"in n?n.webgl2:n.webgl1;return o?g:s}}return this._getParameter(e,t)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:t,keys:r}=e,n=this.constructor.PARAMETERS||{},o=hn(this.gl),l={},s=t||Object.keys(n);for(const g of s){const b=n[g];if(b&&(!("webgl2"in b)||o)&&(!("extension"in b)||this.gl.getExtension(b.extension))){const F=r?sd(this.gl,g):g;l[F]=this.getParameter(g,e),r&&b.type==="GLenum"&&(l[F]=sd(this.gl,l[F]))}}return l}setParameter(e,t){e=Kw(this.gl,e),Xi(e);const n=(this.constructor.PARAMETERS||{})[e];if(n){const o=hn(this.gl);if(!((!("webgl2"in n)||o)&&(!("extension"in n)||this.gl.getExtension(n.extension))))throw new Error("Parameter not available on this platform");n.type==="GLenum"&&(t=Kw(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,r){return u3(this,e,t,r)}initialize(e){}_createHandle(){throw new Error(Kp)}_deleteHandle(){throw new Error(Kp)}_bindHandle(e){throw new Error(Kp)}_getOptsFromHandle(){throw new Error(Kp)}_getParameter(e,t){throw new Error(Kp)}_setParameter(e,t){throw new Error(Kp)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],t=gf.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(e,"s Created")).incrementCount(),t.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];gf.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,t),this._trackAllocatedMemoryForContext(e,t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const n=gf.get("Memory Usage".concat(r));n.get("GPU Memory").addCount(e),n.get("".concat(t," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=gf.get("Memory Usage".concat(t));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const kH="Failed to deduce GL constant from typed array";function Xw(i){switch(ArrayBuffer.isView(i)?i.constructor:i){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(kH)}}function iy(i){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(i){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function OH(i){let{data:e,width:t,height:r,bytesPerPixel:n=4,temp:o}=i;const l=t*n;o=o||new Uint8Array(l);for(let s=0;s<r/2;++s){const g=s*l,b=(r-s-1)*l;o.set(e.subarray(g,g+l)),e.copyWithin(g,b,b+l),e.set(o,b)}}function UH(i){let{data:e,width:t,height:r}=i;const n=Math.round(t/2),o=Math.round(r/2),l=new Uint8Array(n*o*4);for(let s=0;s<o;s++)for(let g=0;g<n;g++)for(let b=0;b<4;b++)l[(s*n+g)*4+b]=e[(s*2*t+g*2)*4+b];return{data:l,width:n,height:o}}function Zw(i,e,t){const{removedProps:r={},deprecatedProps:n={},replacedProps:o={}}=t;for(const s in r)if(s in e){const b=r[s]?"".concat(i,".").concat(r[s]):"N/A";ar.removed("".concat(i,".").concat(s),b)()}for(const s in n)if(s in e){const g=n[s];ar.deprecated("".concat(i,".").concat(s),"".concat(i,".").concat(g))()}let l=null;for(const s in o)if(s in e){const g=o[s];ar.deprecated("".concat(i,".").concat(s),"".concat(i,".").concat(g))(),l=l||Object.assign({},e),l[g]=e[s],delete l[s]}return l||e}const NH={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},zH={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Cc{static getBytesPerElement(e){return iy(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return Xi(e.size),iy(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return new Cc(NH,...t)}constructor(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach(n=>this._assign(n)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Cc.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Cc.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=Zw("Accessor",e,zH),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const h3=10,A3={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},QH={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:A3},VH={removedProps:A3};class bs extends wA{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Cc.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Cc.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Zw("Buffer",e,QH),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=Zw("Buffer",e,VH),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Cc(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:r=0,srcOffset:n=0}=e,o=e.byteLength||e.length;Xi(t);const l=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(l,this.handle),n!==0||o!==void 0?(nc(this.gl),this.gl.bufferSubData(this.target,r,t,n,o)):this.gl.bufferSubData(l,r,t),this.gl.bindBuffer(l,null),this.debugData=null,this._inferType(t),this}copyData(e){let{sourceBuffer:t,readOffset:r=0,writeOffset:n=0,size:o}=e;const{gl:l}=this;return nc(l),l.bindBuffer(36662,t.handle),l.bindBuffer(36663,this.handle),l.copyBufferSubData(36662,36663,r,n,o),l.bindBuffer(36662,null),l.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:t=0,dstOffset:r=0,length:n=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};nc(this.gl);const o=iy(this.accessor.type||5126,{clamped:!1}),l=this._getAvailableElementCount(t),s=r;let g,b;e?(b=e.length,g=b-s):(g=Math.min(l,n||l),b=s+g);const T=Math.min(l,g);return n=n||T,Xi(n<=T),e=e||new o(b),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,r,n),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:r=0,size:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?n!==void 0?this.gl.bindBufferRange(e,t,this.handle,r,n):(Xi(r===0),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(h3,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+t;Xi(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const n=this._getTarget();this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.usage),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this.debugData=e.slice(0,h3),this.bytesUsed=r,this._trackAllocatedMemory(r);const o=Xw(e);return Xi(o),this.setAccessor(new Cc(this.accessor,{type:o})),this}_setByteLength(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;Xi(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const n=this._getTarget();return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,t),this.gl.bindBuffer(n,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const t=iy(this.accessor.type||5126,{clamped:!1}),r=e/t.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new Cc(this.accessor,{type:Xw(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return ar.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return ar.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return ar.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return ar.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Cc(this.accessor,e),this}}const Jw={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},d3={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},f3={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function HH(i,e){const t=Jw[e];if(!t)return!1;if(t.gl1===void 0&&t.gl2===void 0)return!0;const r=hn(i)&&t.gl2||t.gl1;return typeof r=="string"?i.getExtension(r):r}function GH(i,e){const t=Jw[e];switch(t&&t.types[0]){case 5126:return i.getExtension("OES_texture_float_linear");case 5131:return i.getExtension("OES_texture_half_float_linear");default:return!0}}const jH=[9729,9728],p3=globalThis.WebGLBuffer||function(){};class Wp extends wA{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:n}=t;let o=!0;return r&&(o=o&&HH(e,r),o=o&&(!n||GH(e,r))),o}constructor(e,t){const{id:r=xA("texture"),handle:n,target:o}=t;super(e,{id:r,handle:n}),this.target=o,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.data;if(t instanceof Promise)return t.then(de=>this.initialize(Object.assign({},e,{pixels:de,data:de}))),this;const r=typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement;if(r&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:n=null,format:o=6408,border:l=0,recreate:s=!1,parameters:g={},pixelStore:b={},textureUnit:T=void 0}=e;t||(t=n);let{width:F,height:k,dataFormat:z,type:J,compressed:te=!1,mipmaps:ue=!0}=e;const{depth:ce=0}=e;return{width:F,height:k,compressed:te,dataFormat:z,type:J}=this._deduceParameters({format:o,type:J,dataFormat:z,compressed:te,data:t,width:F,height:k}),this.width=F,this.height=k,this.depth=ce,this.format=o,this.type=J,this.dataFormat=z,this.border=l,this.textureUnit=T,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),ue&&this._isNPOT()&&(ar.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),ue=!1,this._updateForNPOT(g)),this.mipmaps=ue,this.setImageData({data:t,width:F,height:k,depth:ce,format:o,type:J,dataFormat:z,border:l,mipmaps:ue,parameters:b,compressed:te}),ue&&this.generateMipmap(),this.setParameters(g),s&&(this.data=t),r&&(this._video={video:t,parameters:g,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:t,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:t,width:r,mipmaps:n=!1}=e;return r!==this.width||t!==this.height?this.initialize({width:r,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:n}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(ar.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Ju(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:r=null,level:n=0,format:o=this.format,border:l=this.border,offset:s=0,parameters:g={}}=e;let{data:b=null,type:T=this.type,width:F=this.width,height:k=this.height,dataFormat:z=this.dataFormat,compressed:J=!1}=e;b||(b=r),{type:T,dataFormat:z,compressed:J,width:F,height:k}=this._deduceParameters({format:o,type:T,dataFormat:z,compressed:J,data:b,width:F,height:k});const{gl:te}=this;te.bindTexture(this.target,this.handle);let ue=null;({data:b,dataType:ue}=this._getDataType({data:b,compressed:J}));let ce,de=0;if(Ju(this.gl,g,()=>{switch(ue){case"null":te.texImage2D(t,n,o,F,k,l,z,T,b);break;case"typed-array":te.texImage2D(t,n,o,F,k,l,z,T,b,s);break;case"buffer":ce=nc(te),ce.bindBuffer(35052,b.handle||b),ce.texImage2D(t,n,o,F,k,l,z,T,s),ce.bindBuffer(35052,null);break;case"browser-object":hn(te)?te.texImage2D(t,n,o,F,k,l,z,T,b):te.texImage2D(t,n,o,z,T,b);break;case"compressed":for(const[_e,Ee]of b.entries())te.compressedTexImage2D(t,_e,Ee.format,Ee.width,Ee.height,l,Ee.data),de+=Ee.levelSize;break;default:Xi(!1,"Unknown image data type")}}),ue==="compressed")this._trackAllocatedMemory(de,"Texture");else if(b&&b.byteLength)this._trackAllocatedMemory(b.byteLength,"Texture");else{const _e=d3[this.dataFormat]||4,Ee=f3[this.type]||1;this._trackAllocatedMemory(this.width*this.height*_e*Ee,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:t=this.target,pixels:r=null,data:n=null,x:o=0,y:l=0,width:s=this.width,height:g=this.height,level:b=0,format:T=this.format,type:F=this.type,dataFormat:k=this.dataFormat,compressed:z=!1,offset:J=0,border:te=this.border,parameters:ue={}}=e;if({type:F,dataFormat:k,compressed:z,width:s,height:g}=this._deduceParameters({format:T,type:F,dataFormat:k,compressed:z,data:n,width:s,height:g}),Xi(this.depth===0,"texSubImage not supported for 3D textures"),n||(n=r),n&&n.data){const ce=n;n=ce.data,s=ce.shape[0],g=ce.shape[1]}n instanceof bs&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),Ju(this.gl,ue,()=>{if(z)this.gl.compressedTexSubImage2D(t,b,o,l,s,g,T,n);else if(n===null)this.gl.texSubImage2D(t,b,o,l,s,g,k,F,null);else if(ArrayBuffer.isView(n))this.gl.texSubImage2D(t,b,o,l,s,g,k,F,n,J);else if(n instanceof p3){const ce=nc(this.gl);ce.bindBuffer(35052,n),ce.texSubImage2D(t,b,o,l,s,g,k,F,J),ce.bindBuffer(35052,null)}else hn(this.gl)?nc(this.gl).texSubImage2D(t,b,o,l,s,g,k,F,n):this.gl.texSubImage2D(t,b,o,l,k,F,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return ar.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType(e){let{data:t,compressed:r=!1}=e;return r?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof bs?{data:t.handle,dataType:"buffer"}:t instanceof p3?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:r}=e;let{width:n,height:o,dataFormat:l,type:s,compressed:g}=e;const b=Jw[t];return l=l||b&&b.dataFormat,s=s||b&&b.types[0],g=g||b&&b.compressed,{width:n,height:o}=this._deduceImageSize(r,n,o),{dataFormat:l,type:s,compressed:g,width:n,height:o,format:t,data:r}}_deduceImageSize(e,t,r){let n;return typeof ImageData<"u"&&e instanceof ImageData?n={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?n={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?n={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?n={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?n={width:e.videoWidth,height:e.videoHeight}:e?n={width:t,height:r}:n={width:t>=0?t:1,height:r>=0?r:1},Xi(n,"Could not deduced texture size"),Xi(t===void 0||n.width===t,"Deduced texture width does not match supplied width"),Xi(r===void 0||n.height===r,"Deduced texture height does not match supplied height"),n}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:Xi(!1);break;default:this.gl.texParameteri(this.target,e,t);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return hn(this.gl)||!this.width||!this.height?!1:!c3(this.width)||!c3(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case 10241:jH.indexOf(t)===-1&&(t=9729);break;case 10242:case 10243:t!==33071&&(t=33071);break}return t}}let qH="";function $H(i,e){return Xi(typeof i=="string"),i=qH+i,new Promise((t,r)=>{try{const n=new Image;n.onload=()=>t(n),n.onerror=()=>r(new Error("Could not load image ".concat(i,"."))),n.crossOrigin=e&&e.crossOrigin||"anonymous",n.src=i}catch(n){r(n)}})}class Xc extends Wp{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,t){return Wp.isSupported(e,t)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};q_(e),(t instanceof Promise||typeof t=="string")&&(t={data:t}),typeof t.data=="string"&&(t=Object.assign({},t,{data:$H(t.data)})),super(e,Object.assign({},t,{target:3553})),this.initialize(t),Object.seal(this)}}const Yw=[34069,34070,34071,34072,34073,34074];class g3 extends Wp{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};q_(e),super(e,Object.assign({},t,{target:34067})),this.initialize(t),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:t=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:t,data:r,x:n=0,y:o=0,mipmapLevel:l=0}=e;return this._subImage({target:t,data:r,x:n,y:o,mipmapLevel:l})}async setCubeMapImageData(e){let{width:t,height:r,pixels:n,data:o,border:l=0,format:s=6408,type:g=5121}=e;const{gl:b}=this,T=n||o,F=await Promise.all(Yw.map(k=>{const z=T[k];return Promise.all(Array.isArray(z)?z:[z])}));this.bind(),Yw.forEach((k,z)=>{F[z].length>1&&this.opts.mipmaps!==!1&&ar.warn("".concat(this.id," has mipmap and multiple LODs."))(),F[z].forEach((J,te)=>{t&&r?b.texImage2D(k,te,s,t,r,l,s,g,J):b.texImage2D(k,te,s,s,g,J)})}),this.unbind()}setImageDataForFace(e){const{face:t,width:r,height:n,pixels:o,data:l,border:s=0,format:g=6408,type:b=5121}=e,{gl:T}=this,F=o||l;return this.bind(),F instanceof Promise?F.then(k=>this.setImageDataForFace(Object.assign({},e,{face:t,data:k,pixels:k}))):this.width||this.height?T.texImage2D(t,0,g,r,n,s,g,b,F):T.texImage2D(t,0,g,g,b,F),this}}g3.FACES=Yw;class KH extends Wp{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return hn(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};nc(e),t=Object.assign({depth:1},t,{target:32879,unpackFlipY:!1}),super(e,t),this.initialize(t),Object.seal(this)}setImageData(e){let{level:t=0,dataFormat:r=6408,width:n,height:o,depth:l=1,border:s=0,format:g,type:b=5121,offset:T=0,data:F,parameters:k={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),Ju(this.gl,k,()=>{ArrayBuffer.isView(F)&&this.gl.texImage3D(this.target,t,r,n,o,l,s,g,b,F),F instanceof bs&&(this.gl.bindBuffer(35052,F.handle),this.gl.texImage3D(this.target,t,r,n,o,l,s,g,b,T))}),F&&F.byteLength)this._trackAllocatedMemory(F.byteLength,"Texture");else{const z=d3[this.dataFormat]||4,J=f3[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*z*J,"Texture")}return this.loaded=!0,this}}const mf="EXT_color_buffer_float",m3={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:mf,bpp:2},33327:{gl2:mf,bpp:4},34842:{gl2:mf,bpp:8},33326:{gl2:mf,bpp:4},33328:{gl2:mf,bpp:8},34836:{gl2:mf,bpp:16},35898:{gl2:mf,bpp:4}};function WH(i,e,t){const r=t[e];if(!r)return!1;const n=hn(i)&&r.gl2||r.gl1;return typeof n=="string"?i.getExtension(n):n}class Xp extends wA{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!t||WH(e,t,m3)}static getSamplesForFormat(e,t){let{format:r}=t;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.initialize(t),Object.seal(this)}initialize(e){let{format:t,width:r=1,height:n=1,samples:o=0}=e;return Xi(t,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),o!==0&&hn(this.gl)?this.gl.renderbufferStorageMultisample(36161,o,t,r,n):this.gl.renderbufferStorage(36161,t,r,n),this.format=t,this.width=r,this.height=n,this.samples=o,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*m3[this.format].bpp),this}resize(e){let{width:t,height:r}=e;return t!==this.width||r!==this.height?this.initialize({width:t,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const XH=256,ZH=1024,JH=16384,y3=6144,_3=6145,v3=6146,b3=34041,x3="clear: bad arguments";function e2(i){let{framebuffer:e=null,color:t=null,depth:r=null,stencil:n=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};e&&(o.framebuffer=e);let l=0;t&&(l|=JH,t!==!0&&(o.clearColor=t)),r&&(l|=XH,r!==!0&&(o.clearDepth=r)),n&&(l|=ZH,r!==!0&&(o.clearStencil=r)),Xi(l!==0,x3),Ju(i,o,()=>{i.clear(l)})}function YH(i){let{framebuffer:e=null,buffer:t=y3,drawBuffer:r=0,value:n=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};nc(i),Ju(i,{framebuffer:e},()=>{switch(t){case y3:switch(n.constructor){case Int32Array:i.clearBufferiv(t,r,n);break;case Uint32Array:i.clearBufferuiv(t,r,n);break;case Float32Array:default:i.clearBufferfv(t,r,n)}break;case _3:i.clearBufferfv(_3,0,[n]);break;case v3:i.clearBufferiv(v3,0,[n]);break;case b3:const[o,l]=n;i.clearBufferfi(b3,0,o,l);break;default:Xi(!1,x3)}})}function e9(i){switch(i){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Xi(!1),0}}function $_(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:t=0,sourceY:r=0,sourceFormat:n=6408}=e;let{sourceAttachment:o=36064,target:l=null,sourceWidth:s,sourceHeight:g,sourceType:b}=e;const{framebuffer:T,deleteFramebuffer:F}=t9(i);Xi(T);const{gl:k,handle:z,attachments:J}=T;s=s||T.width,g=g||T.height,o===36064&&z===null&&(o=1028),Xi(J[o]),b=b||J[o].type,l=i9(l,b,n,s,g),b=b||Xw(l);const te=k.bindFramebuffer(36160,z);return k.readPixels(t,r,s,g,n,b,l),k.bindFramebuffer(36160,te||null),F&&T.delete(),l}function w3(i){let{sourceAttachment:e=36064,targetMaxHeight:t=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=$_(i,{sourceAttachment:e}),{width:n,height:o}=i;for(;o>t;)({data:r,width:n,height:o}=UH({data:r,width:n,height:o}));OH({data:r,width:n,height:o});const l=document.createElement("canvas");l.width=n,l.height=o;const s=l.getContext("2d"),g=s.createImageData(n,o);return g.data.set(r),s.putImageData(g,0,0),l.toDataURL()}function t9(i){return i instanceof ba?{framebuffer:i,deleteFramebuffer:!1}:{framebuffer:h9(i),deleteFramebuffer:!0}}function i9(i,e,t,r,n){if(i)return i;e=e||5121;const o=iy(e,{clamped:!1}),l=e9(t);return new o(r*n*l)}const Qs={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function r9(i){const e=new Xc(i,{format:6408,type:5126,dataFormat:6408}),t=new ba(i,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),r=t.getStatus();return e.delete(),t.delete(),r===36053}const B3={[Qs.WEBGL2]:[!1,!0],[Qs.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Qs.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Qs.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Qs.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Qs.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Qs.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Qs.FLOAT_BLEND]:["EXT_float_blend"],[Qs.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Qs.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Qs.TEXTURE_FLOAT]:["OES_texture_float",!0],[Qs.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Qs.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Qs.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Qs.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Qs.COLOR_ATTACHMENT_RGBA32F]:[r9,"EXT_color_buffer_float"],[Qs.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Qs.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Qs.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Qs.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Qs.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Qs.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},n9=2;function t2(i,e){return C3(i,e)}function C3(i,e){return e=Array.isArray(e)?e:[e],e.every(t=>E3(i,t))}function s9(i){i.luma=i.luma||{},i.luma.caps=i.luma.caps||{};for(const e in B3)i.luma.caps[e]===void 0&&(i.luma.caps[e]=E3(i,e));return i.luma.caps}function E3(i,e){return i.luma=i.luma||{},i.luma.caps=i.luma.caps||{},i.luma.caps[e]===void 0&&(i.luma.caps[e]=o9(i,e)),i.luma.caps[e]||ar.log(n9,"Feature: ".concat(e," not supported"))(),i.luma.caps[e]}function o9(i,e){const t=B3[e];Xi(t,e);let r;const n=hn(i)&&t[1]||t[0];if(typeof n=="function")r=n(i);else if(Array.isArray(n)){r=!0;for(const o of n)r=r&&!!i.getExtension(o)}else typeof n=="string"?r=!!i.getExtension(n):typeof n=="boolean"?r=n:Xi(!1);return r}const S3="Multiple render targets not supported";class ba extends wA{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:n}=t;let o=!0;return r&&(o=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),n&&(o=o&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),o}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new ba(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=nc(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=nc(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:t=1,height:r=1,attachments:n=null,color:o=!0,depth:l=!0,stencil:s=!1,check:g=!0,readBuffer:b=void 0,drawBuffers:T=void 0}=e;if(Xi(t>=0&&r>=0,"Width and height need to be integers"),this.width=t,this.height=r,n)for(const F in n){const k=n[F];(Array.isArray(k)?k[0]:k).resize({width:t,height:r})}else n=this._createDefaultAttachments(o,l,s,t,r);this.update({clearAttachments:!0,attachments:n,readBuffer:b,drawBuffers:T}),n&&g&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:t={},readBuffer:r,drawBuffers:n,clearAttachments:o=!1,resizeAttachments:l=!0}=e;this.attach(t,{clearAttachments:o,resizeAttachments:l});const{gl:s}=this,g=s.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),n&&this._setDrawBuffers(n),s.bindFramebuffer(36160,g||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:t,height:r}=e;if(this.handle===null)return Xi(t===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),t!==this.width&&r!==this.height&&ar.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(t,"x").concat(r))();for(const n in this.attachments)this.attachments[n].resize({width:t,height:r});return this.width=t,this.height=r,this}attach(e){let{clearAttachments:t=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={};t&&Object.keys(this.attachments).forEach(l=>{n[l]=null}),Object.assign(n,e);const o=this.gl.bindFramebuffer(36160,this.handle);for(const l in n){Xi(l!==void 0,"Misspelled framebuffer binding point?");const s=Number(l),g=n[s];let b=g;if(!b)this._unattach(s);else if(b instanceof Xp)this._attachRenderbuffer({attachment:s,renderbuffer:b});else if(Array.isArray(g)){const[T,F=0,k=0]=g;b=T,this._attachTexture({attachment:s,texture:T,layer:F,level:k})}else this._attachTexture({attachment:s,texture:b,layer:0,level:0});r&&b&&b.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,o||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(l=>!this.attachments[l]).forEach(l=>{delete this.attachments[l]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(l9(e));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,t||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:t,depth:r,stencil:n,drawBuffers:o=[]}=e,l=this.gl.bindFramebuffer(36160,this.handle);return(t||r||n)&&e2(this.gl,{color:t,depth:r,stencil:n}),o.forEach((s,g)=>{YH(this.gl,{drawBuffer:g,value:s})}),this.gl.bindFramebuffer(36160,l||null),this}readPixels(){return ar.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return ar.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return ar.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return ar.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return ar.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return ar.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:t=[],x:r=0,y:n=0,width:o,height:l}=e;const s=nc(this.gl),g=s.bindFramebuffer(36008,this.handle);return r===0&&n===0&&o===void 0&&l===void 0?s.invalidateFramebuffer(36008,t):s.invalidateFramebuffer(36008,t,r,n,o,l),s.bindFramebuffer(36008,g),this}getAttachmentParameter(e,t,r){let n=this._getAttachmentParameterFallback(t);return n===null&&(this.gl.bindFramebuffer(36160,this.handle),n=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),r&&n>1e3&&(n=sd(this.gl,n)),n}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const n={};for(const o of r){const l=t?sd(this.gl,o):o;n[l]=this.getAttachmentParameter(e,o,t)}return n}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const t=Object.keys(this.attachments),r={};for(const n of t){const o=Number(n),l=e?sd(this.gl,o):o;r[l]=this.getAttachmentParameters(o,e)}return r}show(){return typeof window<"u"&&window.open(w3(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>ar.level||typeof window>"u")return this;t=t||"Framebuffer ".concat(this.id);const r=w3(this,{targetMaxHeight:100});return ar.image({logLevel:e,message:t,image:r},t)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,r,n,o){let l=null;return e&&(l=l||{},l[36064]=new Xc(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:n,height:o,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(l[36064])),t&&r?(l=l||{},l[33306]=new Xp(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:n,height:111}),this.ownResources.push(l[33306])):t?(l=l||{},l[36096]=new Xp(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:n,height:o}),this.ownResources.push(l[36096])):r&&Xi(!1),l}_unattach(e){const t=this.attachments[e];t&&(t instanceof Xp?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:t=36064,renderbuffer:r}=e;const{gl:n}=this;n.framebufferRenderbuffer(36160,t,36161,r.handle),this.attachments[t]=r}_attachTexture(e){let{attachment:t=36064,texture:r,layer:n,level:o}=e;const{gl:l}=this;switch(l.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:nc(l).framebufferTextureLayer(36160,t,r.target,o,n);break;case 34067:const g=a9(n);l.framebufferTexture2D(36160,t,g,r.handle,o);break;case 3553:l.framebufferTexture2D(36160,t,3553,r.handle,o);break;default:Xi(!1,"Illegal texture type")}l.bindTexture(r.target,null),this.attachments[t]=r}_setReadBuffer(e){const t=OV(this.gl);t?t.readBuffer(e):Xi(e===36064||e===1029,S3),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this,r=nc(t);if(r)r.drawBuffers(e);else{const n=t.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(e):Xi(e.length===1&&(e[0]===36064||e[0]===1029),S3)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=s9(this.gl);switch(e){case 36052:return t.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.WEBGL2?null:8;case 33297:return t.WEBGL2?null:5125;case 33296:return!t.WEBGL2&&!t.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function a9(i){return i<34069?i+34069:i}function l9(i){return(ba.STATUS||{})[i]||"Framebuffer error ".concat(i)}const c9=[36049,36048,33296,33298,33299,33300,33301,33302,33303];ba.ATTACHMENT_PARAMETERS=c9;function u9(i,e){Xi(i instanceof Xc||i instanceof g3||i instanceof KH);const t=i.constructor,{gl:r,width:n,height:o,format:l,type:s,dataFormat:g,border:b,mipmaps:T}=i,F=Object.assign({width:n,height:o,format:l,type:s,dataFormat:g,border:b,mipmaps:T},e);return new t(r,F)}function h9(i,e){const{gl:t,width:r,height:n,id:o}=i;return new ba(t,Object.assign({},e,{id:"framebuffer-for-".concat(o),width:r,height:n,attachments:{36064:i}}))}function K_(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const t=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=i.match(t);return r?r[1]:e}const A9=35632,d9=35633;function f9(i){switch(i){case A9:return"fragment";case d9:return"vertex";default:return"unknown type"}}function p9(i,e,t,r){const n=i.split(/\r?\n/),o={},l={},s=r||K_(e)||"(unnamed)",g="".concat(f9(t)," shader ").concat(s);for(let T=0;T<n.length;T++){const F=n[T];if(F.length<=1)continue;const k=F.split(":"),z=k[0],J=parseInt(k[2],10);if(isNaN(J))throw new Error("GLSL compilation error in ".concat(g,": ").concat(i));z!=="WARNING"?o[J]=F:l[J]=F}const b=g9(e);return{shaderName:g,errors:T3(o,b),warnings:T3(l,b)}}function T3(i,e){let t="";for(let r=0;r<e.length;r++){const n=e[r];if(!(!i[r+3]&&!i[r+2]&&!i[r+1])&&(t+="".concat(n,`
`),i[r+1])){const o=i[r+1],l=o.split(":",3),s=l[0],g=parseInt(l[1],10)||0,b=o.substring(l.join(":").length+1).trim();t+=I3("^^^ ".concat(s,": ").concat(b,`

`),g)}}return t}function g9(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=i.split(/\r?\n/),n=String(r.length+e-1).length;return r.map((o,l)=>{const s=String(l+e),g=s.length;return I3(s,n-g)+t+o})}function I3(i,e){let t="";for(let r=0;r<e;++r)t+=" ";return"".concat(t).concat(i)}function L3(i){let e=100;const t=i.match(/[^\s]+/g);if(t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}return e}const m9="Shader: GLSL source code must be a JavaScript string";class ry extends wA{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Xi(!1),"unknown"}}constructor(e,t){q_(e),Xi(typeof t.source=="string",m9);const r=K_(t.source,null)||t.id||xA("unnamed ".concat(ry.getTypeName(t.shaderType)));super(e,{id:r}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize(e){let{source:t}=e;const r=K_(t,null);r&&(this.id=xA(r)),this._compile(t)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(ry.getTypeName(this.shaderType),":").concat(this.id)}getName(){return K_(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:n,errors:o,warnings:l}=p9(r,this.source,this.shaderType,this.id);throw ar.error("GLSL compilation errors in ".concat(n,`
`).concat(o))(),ar.warn("GLSL compilation warnings in ".concat(n,`
`).concat(l))(),new Error("GLSL compilation errors in ".concat(n))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class i2 extends ry{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class r2 extends ry{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const y9={5126:js.bind(null,"uniform1fv",Zc,1,Sl),35664:js.bind(null,"uniform2fv",Zc,2,Sl),35665:js.bind(null,"uniform3fv",Zc,3,Sl),35666:js.bind(null,"uniform4fv",Zc,4,Sl),5124:js.bind(null,"uniform1iv",od,1,Sl),35667:js.bind(null,"uniform2iv",od,2,Sl),35668:js.bind(null,"uniform3iv",od,3,Sl),35669:js.bind(null,"uniform4iv",od,4,Sl),35670:js.bind(null,"uniform1iv",od,1,Sl),35671:js.bind(null,"uniform2iv",od,2,Sl),35672:js.bind(null,"uniform3iv",od,3,Sl),35673:js.bind(null,"uniform4iv",od,4,Sl),35674:js.bind(null,"uniformMatrix2fv",Zc,4,BA),35675:js.bind(null,"uniformMatrix3fv",Zc,9,BA),35676:js.bind(null,"uniformMatrix4fv",Zc,16,BA),35678:nl,35680:nl,5125:js.bind(null,"uniform1uiv",W_,1,Sl),36294:js.bind(null,"uniform2uiv",W_,2,Sl),36295:js.bind(null,"uniform3uiv",W_,3,Sl),36296:js.bind(null,"uniform4uiv",W_,4,Sl),35685:js.bind(null,"uniformMatrix2x3fv",Zc,6,BA),35686:js.bind(null,"uniformMatrix2x4fv",Zc,8,BA),35687:js.bind(null,"uniformMatrix3x2fv",Zc,6,BA),35688:js.bind(null,"uniformMatrix3x4fv",Zc,12,BA),35689:js.bind(null,"uniformMatrix4x2fv",Zc,8,BA),35690:js.bind(null,"uniformMatrix4x3fv",Zc,12,BA),35678:nl,35680:nl,35679:nl,35682:nl,36289:nl,36292:nl,36293:nl,36298:nl,36299:nl,36300:nl,36303:nl,36306:nl,36307:nl,36308:nl,36311:nl},_9={},v9={},b9={},M3=[0];function n2(i,e,t,r){e===1&&typeof i=="boolean"&&(i=i?1:0),Number.isFinite(i)&&(M3[0]=i,i=M3);const n=i.length;if(n%e&&ar.warn("Uniform size should be multiples of ".concat(e),i)(),i instanceof t)return i;let o=r[n];o||(o=new t(n),r[n]=o);for(let l=0;l<n;l++)o[l]=i[l];return o}function Zc(i,e){return n2(i,e,Float32Array,_9)}function od(i,e){return n2(i,e,Int32Array,v9)}function W_(i,e){return n2(i,e,Uint32Array,b9)}function P3(i,e,t){const r=y9[t.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(t.type));return r().bind(null,i,e)}function x9(i){if(i[i.length-1]!=="]")return{name:i,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,t=i.match(e);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(i));return{name:t[1],length:t[2]||1,isArray:!!t[2]}}function w9(i,e,t){for(const r in i){const n=i[r];if((!t||!!t[r])&&!B9(n))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),n),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function B9(i){return Array.isArray(i)||ArrayBuffer.isView(i)?E9(i):isFinite(i)||i===!0||i===!1||i instanceof Wp||i instanceof Xp?!0:i instanceof ba?!!i.texture:!1}function C9(i,e,t){if(Array.isArray(t)||ArrayBuffer.isView(t))if(i[e]){const r=i[e];for(let n=0,o=t.length;n<o;++n)r[n]=t[n]}else i[e]=t.slice();else i[e]=t}function E9(i){if(i.length===0)return!1;const e=Math.min(i.length,16);for(let t=0;t<e;++t)if(!Number.isFinite(i[t]))return!1;return!0}function nl(){let i=null;return(e,t,r)=>{const n=i!==r;return n&&(e.uniform1i(t,r),i=r),n}}function js(i,e,t,r){let n=null,o=null;return(l,s,g)=>{const b=e(g,t),T=b.length;let F=!1;if(n===null)n=new Float32Array(T),o=T,F=!0;else{Xi(o===T,"Uniform length cannot change.");for(let k=0;k<T;++k)if(b[k]!==n[k]){F=!0;break}}return F&&(r(l,i,s,b),n.set(b)),F}}function Sl(i,e,t,r){i[e](t,r)}function BA(i,e,t,r){i[e](t,!1,r)}const S9=5120,T9=5121,I9=5122,L9=5123,F3=0,X_=1,M9=2,P9=3,Z_=4,F9=5,D9=6,xa=5126,R9=35664,k9=35665,O9=35666,ny=5124,U9=35667,N9=35668,z9=35669,sy=5125,Q9=36294,V9=36295,H9=36296,G9=35670,j9=35671,q9=35672,$9=35673,K9=35674,W9=35675,X9=35676,Z9=35685,J9=35686,Y9=35687,e7=35688,t7=35689,i7=35690,s2={[xa]:[xa,1,"float"],[R9]:[xa,2,"vec2"],[k9]:[xa,3,"vec3"],[O9]:[xa,4,"vec4"],[ny]:[ny,1,"int"],[U9]:[ny,2,"ivec2"],[N9]:[ny,3,"ivec3"],[z9]:[ny,4,"ivec4"],[sy]:[sy,1,"uint"],[Q9]:[sy,2,"uvec2"],[V9]:[sy,3,"uvec3"],[H9]:[sy,4,"uvec4"],[G9]:[xa,1,"bool"],[j9]:[xa,2,"bvec2"],[q9]:[xa,3,"bvec3"],[$9]:[xa,4,"bvec4"],[K9]:[xa,8,"mat2"],[Z9]:[xa,8,"mat2x3"],[J9]:[xa,8,"mat2x4"],[W9]:[xa,12,"mat3"],[Y9]:[xa,12,"mat3x2"],[e7]:[xa,12,"mat3x4"],[X9]:[xa,16,"mat4"],[t7]:[xa,16,"mat4x2"],[i7]:[xa,16,"mat4x3"]};function r7(i){switch(i){case F3:return F3;case X_:return X_;case P9:return X_;case M9:return X_;case Z_:return Z_;case F9:return Z_;case D9:return Z_;default:return Xi(!1),0}}function D3(i){const e=s2[i];if(!e)return null;const[t,r]=e;return{type:t,components:r}}function R3(i,e){switch(i){case S9:case T9:case I9:case L9:i=xa;break}for(const t in s2){const[r,n,o]=s2[t];if(r===i&&n===e)return{glType:t,name:o}}return null}class n7{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,r=t.getProgramParameter(e.handle,35721);for(let n=0;n<r;n++){const{name:o,type:l,size:s}=t.getActiveAttrib(e.handle,n),g=t.getAttribLocation(e.handle,o);g>=0&&this._addAttribute(g,o,l,s)}this.attributeInfos.sort((n,o)=>n.location-o.location)}_readVaryingsFromProgram(e){const{gl:t}=e;if(!hn(t))return;const r=t.getProgramParameter(e.handle,35971);for(let n=0;n<r;n++){const{name:o,type:l,size:s}=t.getTransformFeedbackVarying(e.handle,n);this._addVarying(n,o,l,s)}this.varyingInfos.sort((n,o)=>n.location-o.location)}_addAttribute(e,t,r,n){const{type:o,components:l}=D3(r),s={type:o,size:n*l};this._inferProperties(e,t,s);const g={location:e,name:t,accessor:new Cc(s)};this.attributeInfos.push(g),this.attributeInfosByLocation[e]=g,this.attributeInfosByName[g.name]=g}_inferProperties(e,t,r){/instance/i.test(t)&&(r.divisor=1)}_addVarying(e,t,r,n){const{type:o,components:l}=D3(r),s=new Cc({type:o,size:n*l}),g={location:e,name:t,accessor:s};this.varyingInfos.push(g),this.varyingInfosByName[g.name]=g}}const k3=4,s7=35981,o7=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class O3 extends wA{get[Symbol.toStringTag](){return"Program"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Program","v6.0",o7),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:t,vs:r,fs:n,varyings:o,bufferMode:l=s7}=e;return this.hash=t||"",this.vs=typeof r=="string"?new i2(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof n=="string"?new r2(this.gl,{id:"".concat(e.id,"-fs"),source:n}):n,Xi(this.vs instanceof i2),Xi(this.fs instanceof r2),this.uniforms={},this._textureUniforms={},o&&o.length>0&&(nc(this.gl),this.varyings=o,this.gl2.transformFeedbackVaryings(this.handle,o,l)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new n7(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:t,drawMode:r=4,vertexCount:n,offset:o=0,start:l,end:s,isIndexed:g=!1,indexType:b=5123,instanceCount:T=0,isInstanced:F=T>0,vertexArray:k=null,transformFeedback:z,framebuffer:J,parameters:te={},uniforms:ue,samplers:ce}=e;if((ue||ce)&&(ar.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(ue||{})),ar.priority>=t){const de=J?J.id:"default",_e="mode=".concat(sd(this.gl,r)," verts=").concat(n," ")+"instances=".concat(T," indexType=").concat(sd(this.gl,b)," ")+"isInstanced=".concat(F," isIndexed=").concat(g," ")+"Framebuffer=".concat(de);ar.log(t,_e)()}return Xi(k),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||n===0||F&&T===0?!1:(k.bindForDraw(n,T,()=>{if(J!==void 0&&(te=Object.assign({},te,{framebuffer:J})),z){const de=r7(r);z.begin(de)}this._bindTextures(),Ju(this.gl,te,()=>{g&&F?this.gl2.drawElementsInstanced(r,n,b,o,T):g&&hn(this.gl)&&!isNaN(l)&&!isNaN(s)?this.gl2.drawRangeElements(r,l,s,n,b,o):g?this.gl.drawElements(r,n,b,o):F?this.gl2.drawArraysInstanced(r,o,n,T):this.gl.drawArrays(r,o,n)}),z&&z.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ar.priority>=2&&w9(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const t in e){const r=e[t],n=this._uniformSetters[t];if(n){let o=r,l=!1;if(o instanceof ba&&(o=o.texture),o instanceof Wp)if(l=this.uniforms[t]!==r,l){n.textureIndex===void 0&&(n.textureIndex=this._textureIndexCounter++);const s=o,{textureIndex:g}=n;s.bind(g),o=g,this._textureUniforms[t]=s}else o=n.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(n(o)||l)&&C9(this.uniforms,t,r)}}return this}_areTexturesRenderable(){let e=!0;for(const t in this._textureUniforms){const r=this._textureUniforms[t];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const t=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(t)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),r={};for(const n of t)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new i2({handle:n});break;case 35632:r.fs=new r2({handle:n});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const t=this._getName();this.id=xA(t)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),ar.time(k3,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),ar.timeEnd(k3,"linkProgram for ".concat(this._getName()))(),e.debug||ar.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let t=0;t<this._uniformCount;t++){const r=this.gl.getActiveUniform(this.handle,t),{name:n}=x9(r.name);let o=e.getUniformLocation(this.handle,n);if(this._uniformSetters[n]=P3(e,o,r),r.size>1)for(let l=0;l<r.size;l++)o=e.getUniformLocation(this.handle,"".concat(n,"[").concat(l,"]")),this._uniformSetters["".concat(n,"[").concat(l,"]")]=P3(e,o,r)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}}const a7=34918,l7=34919,c7=35007,u7=36795,h7=35976,A7=35887,d7=36202;class J_ extends wA{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=hn(e),n=C3(e,Qs.TIMER_QUERY);let o=r||n;for(const l of t)switch(l){case"queries":o=o&&r;break;case"timers":o=o&&n;break;default:Xi(!1)}return o}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(c7)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?d7:A7)}beginTransformFeedbackQuery(){return this.begin(h7)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,l7);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(u7)}getResult(){return this.gl2.getQueryParameter(this.handle,a7)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((r,n)=>{const o=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):t++>e?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}_createHandle(){return J_.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class U3 extends wA{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return hn(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};nc(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,$p(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])}),this}setBuffer(e,t){const r=this._getVaryingIndex(e),{buffer:n,byteSize:o,byteOffset:l}=this._getBufferParams(t);return r<0?(this.unused[e]=n,ar.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=t,this.bindOnUse||this._bindBuffer(r,n,l,o),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let t,r,n;return e instanceof bs?n=e:(n=e.buffer,r=e.byteSize,t=e.byteOffset),(t!==void 0||r!==void 0)&&(t=t||0,r=r||n.byteLength-t),{buffer:n,byteOffset:t,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:r,byteOffset:n}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,n,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;const o=t&&t.handle;return!o||n===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,r,n),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let Y_=null;function f7(i){return(!Y_||Y_.byteLength<i)&&(Y_=new ArrayBuffer(i)),Y_}function p7(i,e){const t=f7(i.BYTES_PER_ELEMENT*e);return new i(t,0,e)}function g7(i){let{target:e,source:t,start:r=0,count:n=1}=i;const o=t.length,l=n*o;let s=0;for(let g=r;s<o;s++)e[g++]=t[s];for(;s<l;)s<l-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+l-s),s=l);return e}const m7="elements must be GL.ELEMENT_ARRAY_BUFFER";class Jc extends wA{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?hn(e)||U5()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Jc(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Jc.MAX_ATTRIBUTES=Jc.MAX_ATTRIBUTES||e.getParameter(34921),Jc.MAX_ATTRIBUTES}static setConstant(e,t,r){switch(r.constructor){case Float32Array:Jc._setConstantFloatArray(e,t,r);break;case Int32Array:Jc._setConstantIntArray(e,t,r);break;case Uint32Array:Jc._setConstantUintArray(e,t,r);break;default:Xi(!1)}}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.gl2=e,this.initialize(t),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Jc.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return Xi(!e||e.target===34963,m7),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,t,r){if(t.target===34963)return this.setElementBuffer(t,r);const{size:n,type:o,stride:l,offset:s,normalized:g,integer:b,divisor:T}=r,{gl:F,gl2:k}=this;return e=Number(e),this.bind(()=>{F.bindBuffer(34962,t.handle),b?(Xi(hn(F)),k.vertexAttribIPointer(e,n,o,l,s)):F.vertexAttribPointer(e,n,o,g,l,s),F.enableVertexAttribArray(e),k.vertexAttribDivisor(e,T||0)}),this}enable(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!t&&e===0&&!Jc.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t){const r=this._normalizeConstantArrayValue(t),n=r.byteLength*e,o=r.length*e;let l=!this.buffer;if(this.buffer=this.buffer||new bs(this.gl,n),l=l||this.buffer.reallocate(n),l=l||!this._compareConstantArrayValues(r,this.bufferValue),l){const s=p7(t.constructor,o);g7({target:s,source:r,start:0,count:o}),this.buffer.subData(s),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}static _setConstantFloatArray(e,t,r){switch(r.length){case 1:e.vertexAttrib1fv(t,r);break;case 2:e.vertexAttrib2fv(t,r);break;case 3:e.vertexAttrib3fv(t,r);break;case 4:e.vertexAttrib4fv(t,r);break;default:Xi(!1)}}static _setConstantIntArray(e,t,r){switch(Xi(hn(e)),r.length){case 1:e.vertexAttribI1iv(t,r);break;case 2:e.vertexAttribI2iv(t,r);break;case 3:e.vertexAttribI3iv(t,r);break;case 4:e.vertexAttribI4iv(t,r);break;default:Xi(!1)}}static _setConstantUintArray(e,t,r){switch(Xi(hn(e)),r.length){case 1:e.vertexAttribI1uiv(t,r);break;case 2:e.vertexAttribI2uiv(t,r);break;case 3:e.vertexAttribI3uiv(t,r);break;case 4:e.vertexAttribI4uiv(t,r);break;default:Xi(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,t){let{location:r}=t;return Xi(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const y7="VertexArray: attributes must be Buffers or constants (i.e. typed array)",_7=/^(.+)__LOCATION_([0-9]+)$/,v7=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class b7{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=t.id||t.program&&t.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Jc(e),u3(this,"VertexArray","v6.0",v7),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const t in e){const r=e[t];this._setAttribute(t,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.target===34963)return this.setElementBuffer(t,r);const{location:n,accessor:o}=this._resolveLocationAndAccessor(e,t,t.accessor,r);return n>=0&&(this.values[n]=t,this.accessors[n]=o,this.clearDrawParams(),this.vertexArrayObject.setBuffer(n,t,o)),this}setConstant(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:n,accessor:o}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},r));return n>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[n]=t,this.accessors[n]=o,this.clearDrawParams(),this.vertexArrayObject.enable(n,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new bs(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof bs&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof bs&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,r){let n;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),n=r()}),n}_resolveLocationAndAccessor(e,t,r,n){const o={location:-1,accessor:null},{location:l,name:s}=this._getAttributeIndex(e);if(!Number.isFinite(l)||l<0)return this.unused[e]=t,ar.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),o;const g=this._getAttributeInfo(s||l);if(!g)return o;const b=this.accessors[l]||{},T=Cc.resolve(g.accessor,b,r,n),{size:F,type:k}=T;return Xi(Number.isFinite(F)&&Number.isFinite(k)),{location:l,accessor:T}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const r=_7.exec(e),n=r?r[1]:e,o=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(n)+o,name:n}:{location:-1}}_setAttribute(e,t){if(t instanceof bs)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof bs){const r=t[0],n=t[1];this.setBuffer(e,r,n)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){const r=t;this.setConstant(e,r)}else if(t.buffer instanceof bs){const r=t;this.setBuffer(e,r.buffer,r)}else throw new Error(y7)}_setConstantAttributes(e,t){const r=Math.max(e|0,t|0);let n=this.values[0];ArrayBuffer.isView(n)&&this._setConstantAttributeZero(n,r);for(let o=1;o<this.vertexArrayObject.MAX_ATTRIBUTES;o++)n=this.values[o],ArrayBuffer.isView(n)&&this._setConstantAttribute(o,n)}_setConstantAttributeZero(e,t){if(Jc.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,t){Jc.setConstant(this.gl,e,t)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const r=this.values[t],n=this.accessors[t];if(!r)return;const{divisor:o}=n,l=o>0;if(e.isInstanced=e.isInstanced||l,r instanceof bs){const s=r;if(l){const g=s.getVertexCount(n);e.instanceCount=Math.min(e.instanceCount,g)}else{const g=s.getVertexCount(n);e.vertexCount=Math.min(e.vertexCount,g)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ar.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}function x7(i,e){const{maxElts:t=16,size:r=1}=e;let n="[";for(let l=0;l<i.length&&l<t;++l)l>0&&(n+=",".concat(l%r===0?" ":"")),n+=oy(i[l],e);const o=i.length>t?"...":"]";return"".concat(n).concat(o)}function oy(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=1e-16,{isInteger:r=!1}=e;if(Array.isArray(i)||ArrayBuffer.isView(i))return x7(i,e);if(!Number.isFinite(i))return String(i);if(Math.abs(i)<t)return r?"0":"0.";if(r||Math.abs(i)>100&&Math.abs(i)<1e4)return i.toFixed(0);const n=i.toPrecision(2);return n.indexOf(".0")===n.length-2?n.slice(0,-1):n}function N3(i){let{header:e="Uniforms",program:t,uniforms:r,undefinedOnly:n=!1}=i;Xi(t);const o=".*_.*",l=".*Matrix",s=t._uniformSetters,g={},b=Object.keys(s).sort();let T=0;for(const z of b)!z.match(o)&&!z.match(l)&&o2({table:g,header:e,uniforms:r,uniformName:z,undefinedOnly:n})&&T++;for(const z of b)z.match(l)&&o2({table:g,header:e,uniforms:r,uniformName:z,undefinedOnly:n})&&T++;for(const z of b)g[z]||o2({table:g,header:e,uniforms:r,uniformName:z,undefinedOnly:n})&&T++;let F=0;const k={};if(!n)for(const z in r){const J=r[z];g[z]||(F++,k[z]={Type:"NOT USED: ".concat(J),[e]:oy(J)})}return{table:g,count:T,unusedTable:k,unusedCount:F}}function o2(i){let{table:e,header:t,uniforms:r,uniformName:n,undefinedOnly:o}=i;const l=r[n],s=w7(l);return!o||!s?(e[n]={[t]:s?oy(l):"N/A","Uniform Type":s?l:"NOT PROVIDED"},!0):!1}function w7(i){return i!=null}function B7(i){let{vertexArray:e,header:t="Attributes"}=i;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=z3(e,e.elements,null,t));const n=e.values;for(const o in n){const l=e._getAttributeInfo(o);if(l){let s="".concat(o,": ").concat(l.name);const g=e.accessors[l.location];g&&(s="".concat(o,": ").concat(C7(l.name,g))),r[s]=z3(e,n[o],g,t)}}return r}function z3(i,e,t,r){const{gl:n}=i;if(!e)return{[r]:"null","Format ":"N/A"};let o="NOT PROVIDED",l=1,s=0,g=0,b,T,F;if(t&&(o=t.type,l=t.size,o=String(o).replace("Array",""),b=o.indexOf("nt")!==-1),e instanceof bs){const k=e,{data:z,changed:J}=k.getDebugData();T=J?"*":"",F=z,g=k.byteLength,s=g/z.BYTES_PER_ELEMENT/l;let te;if(t){const ue=t.divisor>0;te="".concat(ue?"I ":"P "," ").concat(s," (x").concat(l,"=").concat(g," bytes ").concat(sd(n,o),")")}else b=!0,te="".concat(g," bytes");return{[r]:"".concat(T).concat(oy(F,{size:l,isInteger:b})),"Format ":te}}return F=e,l=e.length,o=String(e.constructor.name).replace("Array",""),b=o.indexOf("nt")!==-1,{[r]:"".concat(oy(F,{size:l,isInteger:b})," (constant)"),"Format ":"".concat(l,"x").concat(o," (constant)")}}function C7(i,e){const{type:t,size:r}=e,n=R3(t,r);return n?"".concat(i," (").concat(n.name,")"):i}function E7(i){const e={},t="Accessors for ".concat(i.id);for(const r of i.attributeInfos)if(r){const n=Q3(r);e["in ".concat(n)]={[t]:JSON.stringify(r.accessor)}}for(const r of i.varyingInfos)if(r){const n=Q3(r);e["out ".concat(n)]={[t]:JSON.stringify(r.accessor)}}return e}function Q3(i){const{type:e,size:t}=i.accessor,r=R3(e,t);return r?"".concat(r.name," ").concat(i.name):i.name}const V3=vA()&&typeof document<"u";let S7=0;class T7{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:t=ue=>o3(ue),onAddHTML:r=null,onInitialize:n=()=>{},onRender:o=()=>{},onFinalize:l=()=>{},onError:s,gl:g=null,glOptions:b={},debug:T=!1,createFramebuffer:F=!1,autoResizeViewport:k=!0,autoResizeDrawingBuffer:z=!0,stats:J=gf.get("animation-loop-".concat(S7++))}=e;let{useDevicePixels:te=!0}=e;"useDevicePixelRatio"in e&&(ar.deprecated("useDevicePixelRatio","useDevicePixels")(),te=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:r,onInitialize:n,onRender:o,onFinalize:l,onError:s,gl:g,glOptions:b,debug:T,createFramebuffer:F},this.gl=g,this.needsRedraw=null,this.timeline=null,this.stats=J,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:k,autoResizeDrawingBuffer:z,useDevicePixels:te}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return Xi(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const t=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=J_.isSupported(this.gl,["timers"])?new J_(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):t}setViewParameters(){return ar.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=V3?new Promise((e,t)=>{if(V3&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):RH(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):DH(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?qw(this.props.gl,e):this.onCreateContext(e),!j_(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");bH(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let r=1;const{canvas:n}=this.gl;return n&&n.clientHeight?r=n.clientWidth/n.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&EH(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new ba(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const ay="vs",a2="fs";function Yc(i,e){if(!i)throw new Error(e||"shadertools: assertion failed.")}const l2={number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},array:{validate(i,e){return Array.isArray(i)||ArrayBuffer.isView(i)}}};function I7(i){const e={};for(const t in i){const r=i[t],n=L7(r);e[t]=n}return e}function L7(i){let e=H3(i);return e==="object"?i?"type"in i?Object.assign({},i,l2[i.type]):"value"in i?(e=H3(i.value),Object.assign({type:e},i,l2[e])):{type:"object",value:i}:{type:"object",value:null}:Object.assign({type:e,value:i},l2[e])}function H3(i){return Array.isArray(i)||ArrayBuffer.isView(i)?"array":typeof i}const M7="vs",P7="fs";class G3{constructor(e){let{name:t,vs:r,fs:n,dependencies:o=[],uniforms:l,getUniforms:s,deprecations:g=[],defines:b={},inject:T={},vertexShader:F,fragmentShader:k}=e;Yc(typeof t=="string"),this.name=t,this.vs=r||F,this.fs=n||k,this.getModuleUniforms=s,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(g),this.defines=b,this.injections=F7(T),l&&(this.uniforms=I7(l))}getModuleSource(e){let t;switch(e){case M7:t=this.vs||"";break;case P7:t=this.fs||"";break;default:Yc(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(t,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={},r=this.uniforms;for(const n in r){const o=r[n];n in e&&!o.private?(o.validate&&Yc(o.validate(e[n],o),"".concat(this.name,": invalid ").concat(n)),t[n]=e[n]):t[n]=o.value}return t}}function F7(i){const e={vs:{},fs:{}};for(const t in i){let r=i[t];const n=t.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[n][t]=r}return e}function D7(i){return R7(q3(i))}function R7(i){const e={},t={};return j3({modules:i,level:0,moduleMap:e,moduleDepth:t}),Object.keys(t).sort((r,n)=>t[n]-t[r]).map(r=>e[r])}function j3(i){let{modules:e,level:t,moduleMap:r,moduleDepth:n}=i;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)r[o.name]=o,(n[o.name]===void 0||n[o.name]<t)&&(n[o.name]=t);for(const o of e)o.dependencies&&j3({modules:o.dependencies,level:t+1,moduleMap:r,moduleDepth:n})}function q3(i,e){return i.map(t=>(t instanceof G3||(Yc(typeof t!="string","Shader module use by name is deprecated. Import shader module '".concat(t,"' and use it directly.")),Yc(t.name,"shader module has no name"),t=new G3(t),t.dependencies=q3(t.dependencies)),t))}function k7(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},t=i.userAgent||e.userAgent||"",r=t.indexOf("MSIE ")!==-1,n=t.indexOf("Trident/")!==-1;return r||n}const O7=7936,U7=7937,N7=7938,z7=35724,c2={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},yf={};Object.keys(c2).forEach(i=>{yf[i]=i});function Q7(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function V7(i){const e=i.getExtension("WEBGL_debug_renderer_info"),t=i.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||O7),r=i.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||U7);return{gpuVendor:H7(t,r),vendor:t,renderer:r,version:i.getParameter(N7),shadingLanguageVersion:i.getParameter(z7)}}function H7(i,e){return i.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":i.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":i.match(/AMD/i)||e.match(/AMD/i)||i.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const u2={};function $3(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=c2[e];if(Yc(r,e),!k7(t))return!0;if(e in u2)return u2[e];const n=r[0],o=t.behavior||"enable",l="#extension GL_".concat(n," : ").concat(o,`
void main(void) {}`),s=i.createShader(35633);i.shaderSource(s,l),i.compileShader(s);const g=i.getShaderParameter(s,35713);return i.deleteShader(s),u2[e]=g,g}function G7(i,e){const t=c2[e];Yc(t,e);const r=Q7(i)&&t[1]||t[0],n=typeof r=="string"?!!i.getExtension(r):r;return Yc(n===!1||n===!0),n}function e1(i,e){return e=Array.isArray(e)?e:[e],e.every(t=>G7(i,t))}function j7(i){switch(V7(i).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function q7(i,e,t){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return e1(i,yf.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),e1(i,yf.GLSL_DERIVATIVES)&&$3(i,yf.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),e1(i,yf.GLSL_FRAG_DATA)&&$3(i,yf.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),e1(i,yf.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const $7=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,K7=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,W7={[ay]:$7,[a2]:K7},t1="__LUMA_INJECT_DECLARATIONS__",K3=/void\s+main\s*\([^)]*\)\s*\{\n?/,W3=/}\n?[^{}]*$/,h2=[];function X3(i,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const n=e===ay;for(const o in t){const l=t[o];l.sort((g,b)=>g.order-b.order),h2.length=l.length;for(let g=0,b=l.length;g<b;++g)h2[g]=l[g].injection;const s="".concat(h2.join(`
`),`
`);switch(o){case"vs:#decl":n&&(i=i.replace(t1,s));break;case"vs:#main-start":n&&(i=i.replace(K3,g=>g+s));break;case"vs:#main-end":n&&(i=i.replace(W3,g=>s+g));break;case"fs:#decl":n||(i=i.replace(t1,s));break;case"fs:#main-start":n||(i=i.replace(K3,g=>g+s));break;case"fs:#main-end":n||(i=i.replace(W3,g=>s+g));break;default:i=i.replace(o,g=>g+s)}}return i=i.replace(t1,""),r&&(i=i.replace(/\}\s*$/,o=>o+W7[e])),i}function A2(i){const e={};return Yc(Array.isArray(i)&&i.length>1),i.forEach(t=>{for(const r in t)e[r]=e[r]?"".concat(e[r],`
`).concat(t[r]):t[r]}),e}function Zp(i){return new RegExp("\\b".concat(i,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const Z3=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],X7=[...Z3,[Zp("attribute"),"in $1"],[Zp("varying"),"out $1"]],Z7=[...Z3,[Zp("varying"),"in $1"]],J3=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],J7=[...J3,[Zp("in"),"attribute $1"],[Zp("out"),"varying $1"]],Y7=[...J3,[Zp("in"),"varying $1"]],d2="gl_FragColor",f2=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,eG=/void\s+main\s*\([^)]*\)\s*\{\n?/;function tG(i,e,t){switch(e){case 300:return t?i1(i,X7):iG(i);case 100:return t?i1(i,J7):rG(i);default:throw new Error("unknown GLSL version ".concat(e))}}function i1(i,e){for(const[t,r]of e)i=i.replace(t,r);return i}function iG(i){i=i1(i,Z7);const e=i.match(f2);if(e){const t=e[1];i=i.replace(new RegExp("\\b".concat(d2,"\\b"),"g"),t)}else{const t="fragmentColor";i=i.replace(eG,r=>"out vec4 ".concat(t,`;
`).concat(r)).replace(new RegExp("\\b".concat(d2,"\\b"),"g"),t)}return i}function rG(i){i=i1(i,Y7);const e=i.match(f2);if(e){const t=e[1];i=i.replace(f2,"").replace(new RegExp("\\b".concat(t,"\\b"),"g"),d2)}return i}const nG=`

`.concat(t1,`

`),Y3={[ay]:"vertex",[a2]:"fragment"},sG=`precision highp float;

`;function oG(i,e){const{vs:t,fs:r}=e,n=D7(e.modules||[]);return{gl:i,vs:eL(i,Object.assign({},e,{source:t,type:ay,modules:n})),fs:eL(i,Object.assign({},e,{source:r,type:a2,modules:n})),getUniforms:aG(n)}}function eL(i,e){let{id:t,source:r,type:n,modules:o,defines:l={},hookFunctions:s=[],inject:g={},transpileToGLSL100:b=!1,prologue:T=!0,log:F}=e;Yc(typeof r=="string","shader source must be a string");const k=n===ay,z=r.split(`
`);let J=100,te="",ue=r;z[0].indexOf("#version ")===0?(J=300,te=z[0],ue=z.slice(1).join(`
`)):te="#version ".concat(J);const ce={};o.forEach(qe=>{Object.assign(ce,qe.getDefines())}),Object.assign(ce,l);let de=T?"".concat(te,`
`).concat(cG({id:t,source:r,type:n}),`
`).concat(lG({type:n}),`
`).concat(j7(i),`
`).concat(q7(i),`
`).concat(uG(ce),`
`).concat(k?"":sG,`
`):"".concat(te,`
`);const _e=AG(s),Ee={},He={},Ve={};for(const qe in g){const Ue=typeof g[qe]=="string"?{injection:g[qe],order:0}:g[qe],ot=qe.match(/^(v|f)s:(#)?([\w-]+)$/);if(ot){const it=ot[2],De=ot[3];it?De==="decl"?He[qe]=[Ue]:Ve[qe]=[Ue]:Ee[qe]=[Ue]}else Ve[qe]=[Ue]}for(const qe of o){F&&qe.checkDeprecations(ue,F);const Ue=qe.getModuleSource(n,J);de+=Ue;const ot=qe.injections[n];for(const it in ot){const De=it.match(/^(v|f)s:#([\w-]+)$/);if(De){const Ze=De[2]==="decl"?He:Ve;Ze[it]=Ze[it]||[],Ze[it].push(ot[it])}else Ee[it]=Ee[it]||[],Ee[it].push(ot[it])}}return de+=nG,de=X3(de,n,He),de+=hG(_e[n],Ee),de+=ue,de=X3(de,n,Ve),de=tG(de,b?100:J,k),de}function aG(i){return function(t){const r={};for(const n of i){const o=n.getUniforms(t,r);Object.assign(r,o)}return r}}function lG(i){let{type:e}=i;return`
#define SHADER_TYPE_`.concat(Y3[e].toUpperCase(),`
`)}function cG(i){let{id:e,source:t,type:r}=i;return e&&typeof e=="string"&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(Y3[r],`

`):""}function uG(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,t="";for(const r in i){e===0&&(t+=`
// APPLICATION DEFINES
`),e++;const n=i[r];(n||Number.isFinite(n))&&(t+="#define ".concat(r.toUpperCase()," ").concat(i[r],`
`))}return e===0&&(t+=`
`),t}function hG(i,e){let t="";for(const r in i){const n=i[r];if(t+="void ".concat(n.signature,` {
`),n.header&&(t+="  ".concat(n.header)),e[r]){const o=e[r];o.sort((l,s)=>l.order-s.order);for(const l of o)t+="  ".concat(l.injection,`
`)}n.footer&&(t+="  ".concat(n.footer)),t+=`}
`}return t}function AG(i){const e={vs:{},fs:{}};return i.forEach(t=>{let r;typeof t!="string"?(r=t,t=r.hook):r={},t=t.trim();const[n,o]=t.split(":"),l=t.replace(/\(.+/,"");e[n][l]=Object.assign(r,{signature:o})}),e}const dG="void main() {gl_FragColor = vec4(0);}",tL=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,fG=`#version 300 es
`.concat(tL);function iL(i,e){e=Array.isArray(e)?e:[e];const t=i.replace(/^\s+/,"").split(/\s+/),[r,n,o]=t;if(!e.includes(r)||!n||!o)return null;const l=o.split(";")[0];return{qualifier:r,type:n,name:l}}function rL(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:t,inputType:r,output:n}=i;if(!t)return e===300?fG:e>300?"#version ".concat(e,`
`).concat(tL):dG;const o=mG(t,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(t,`;
out vec4 `).concat(n,`;
void main() {
  `).concat(n," = ").concat(o,`;
}`):"varying ".concat(r," ").concat(t,`;
void main() {
  gl_FragColor = `).concat(o,`;
}`)}function pG(i){switch(i){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Yc(!1),null}}function gG(i){switch(i){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Yc(!1),null}}function mG(i,e){switch(e){case"float":return"vec4(".concat(i,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(i,", 0.0, 1.0)");case"vec3":return"vec4(".concat(i,", 1.0)");case"vec4":return i;default:return Yc(!1),null}}const yG={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fs:null};function Yu(i,e){if(!i)throw new Error("math.gl assertion ".concat(e))}const _G=1/Math.PI*180,vG=1/180*Math.PI,wa={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function bG(i){let{precision:e=wa.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return i=CG(i),"".concat(parseFloat(i.toPrecision(e)))}function ad(i){return Array.isArray(i)||ArrayBuffer.isView(i)&&!(i instanceof DataView)}function xG(i){return BG(i)}function wG(i){return CA(i)}function BG(i,e){return p2(i,t=>t*vG,e)}function CA(i,e){return p2(i,t=>t*_G,e)}function EA(i,e,t){return p2(i,r=>Math.max(e,Math.min(t,r)))}function r1(i,e,t){return ad(i)?i.map((r,n)=>r1(r,e[n],t)):t*e+(1-t)*i}function eh(i,e,t){const r=wa.EPSILON;t&&(wa.EPSILON=t);try{if(i===e)return!0;if(ad(i)&&ad(e)){if(i.length!==e.length)return!1;for(let n=0;n<i.length;++n)if(!eh(i[n],e[n]))return!1;return!0}return i&&i.equals?i.equals(e):e&&e.equals?e.equals(i):typeof i=="number"&&typeof e=="number"?Math.abs(i-e)<=wa.EPSILON*Math.max(1,Math.abs(i),Math.abs(e)):!1}finally{wa.EPSILON=r}}function CG(i){return Math.round(i/wa.EPSILON)*wa.EPSILON}function EG(i){return i.clone?i.clone():new Array(i.length)}function p2(i,e,t){if(ad(i)){const r=i;t=t||EG(r);for(let n=0;n<t.length&&n<r.length;++n)t[n]=e(i[n],n,t);return t}return e(i)}function SG(i){function e(){var t=Reflect.construct(i,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return e.prototype=Object.create(i.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i,e}class g2 extends SG(Array){clone(){return new this.constructor().copy(this)}fromArray(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ad(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(wa)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+bG(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!eh(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let n=0;n<this.ELEMENTS;++n){const o=e[n];this[n]=o+r*(t[n]-o)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]+=n[o];return this.check()}subtract(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]-=n[o];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(wa.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function TG(i,e){if(i.length!==e)return!1;for(let t=0;t<i.length;++t)if(!Number.isFinite(i[t]))return!1;return!0}function is(i){if(!Number.isFinite(i))throw new Error("Invalid number ".concat(i));return i}function ly(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(wa.debug&&!TG(i,e))throw new Error("math.gl: ".concat(t," some fields set to invalid numbers'"));return i}let m2=class extends g2{get x(){return this[0]}set x(e){this[0]=is(e)}get y(){return this[1]}set y(e){this[1]=is(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const n=this[r]-e[r];t+=n*n}return is(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return is(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]*=n[o];return this.check()}divide(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]/=n[o];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Yu(e>=0&&e<this.ELEMENTS,"index is out of range"),is(this[e])}setComponent(e,t){return Yu(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}};var cy=1e-6,th=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});function IG(){var i=new th(2);return th!=Float32Array&&(i[0]=0,i[1]=0),i}function nL(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i}function LG(i,e){return i[0]=-e[0],i[1]=-e[1],i}function sL(i,e,t,r){var n=e[0],o=e[1];return i[0]=n+r*(t[0]-n),i[1]=o+r*(t[1]-o),i}function MG(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n,i[1]=t[1]*r+t[3]*n,i}function PG(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n+t[4],i[1]=t[1]*r+t[3]*n+t[5],i}function oL(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[3]*n+t[6],i[1]=t[1]*r+t[4]*n+t[7],i}function aL(i,e,t){var r=e[0],n=e[1];return i[0]=t[0]*r+t[4]*n+t[12],i[1]=t[1]*r+t[5]*n+t[13],i}(function(){var i=IG();return function(e,t,r,n,o,l){var s,g;for(t||(t=2),r||(r=0),n?g=Math.min(n*t+r,e.length):g=e.length,s=r;s<g;s+=t)i[0]=e[s],i[1]=e[s+1],o(i,i,l),e[s]=i[0],e[s+1]=i[1];return e}})();function lL(i,e,t){const r=e[0],n=e[1],o=t[3]*r+t[7]*n||1;return i[0]=(t[0]*r+t[4]*n)/o,i[1]=(t[1]*r+t[5]*n)/o,i}function cL(i,e,t){const r=e[0],n=e[1],o=e[2],l=t[3]*r+t[7]*n+t[11]*o||1;return i[0]=(t[0]*r+t[4]*n+t[8]*o)/l,i[1]=(t[1]*r+t[5]*n+t[9]*o)/l,i[2]=(t[2]*r+t[6]*n+t[10]*o)/l,i}function FG(i,e,t){const r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n,i[1]=t[1]*r+t[3]*n,i[2]=e[2],i}function DG(i,e,t){const r=e[0],n=e[1];return i[0]=t[0]*r+t[2]*n,i[1]=t[1]*r+t[3]*n,i[2]=e[2],i[3]=e[3],i}function uL(i,e,t){const r=e[0],n=e[1],o=e[2];return i[0]=t[0]*r+t[3]*n+t[6]*o,i[1]=t[1]*r+t[4]*n+t[7]*o,i[2]=t[2]*r+t[5]*n+t[8]*o,i[3]=e[3],i}class y2 extends m2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),ad(e)&&arguments.length===1?this.copy(e):(wa.debug&&(is(e),is(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return wa.debug&&(is(e.x),is(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return aL(this,this,e),this.check()}transformAsVector(e){return lL(this,this,e),this.check()}transformByMatrix3(e){return oL(this,this,e),this.check()}transformByMatrix2x3(e){return PG(this,this,e),this.check()}transformByMatrix2(e){return MG(this,this,e),this.check()}}function hL(){var i=new th(3);return th!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function AL(i){var e=i[0],t=i[1],r=i[2];return Math.hypot(e,t,r)}function dL(i,e,t){var r=new th(3);return r[0]=i,r[1]=e,r[2]=t,r}function RG(i,e,t){return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i}function kG(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i}function OG(i,e){var t=e[0],r=e[1],n=e[2],o=t*t+r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i}function _2(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function n1(i,e,t){var r=e[0],n=e[1],o=e[2],l=t[0],s=t[1],g=t[2];return i[0]=n*g-o*s,i[1]=o*l-r*g,i[2]=r*s-n*l,i}function v2(i,e,t){var r=e[0],n=e[1],o=e[2],l=t[3]*r+t[7]*n+t[11]*o+t[15];return l=l||1,i[0]=(t[0]*r+t[4]*n+t[8]*o+t[12])/l,i[1]=(t[1]*r+t[5]*n+t[9]*o+t[13])/l,i[2]=(t[2]*r+t[6]*n+t[10]*o+t[14])/l,i}function fL(i,e,t){var r=e[0],n=e[1],o=e[2];return i[0]=r*t[0]+n*t[3]+o*t[6],i[1]=r*t[1]+n*t[4]+o*t[7],i[2]=r*t[2]+n*t[5]+o*t[8],i}function pL(i,e,t){var r=t[0],n=t[1],o=t[2],l=t[3],s=e[0],g=e[1],b=e[2],T=n*b-o*g,F=o*s-r*b,k=r*g-n*s,z=n*k-o*F,J=o*T-r*k,te=r*F-n*T,ue=l*2;return T*=ue,F*=ue,k*=ue,z*=2,J*=2,te*=2,i[0]=s+T+z,i[1]=g+F+J,i[2]=b+k+te,i}function UG(i,e,t,r){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[0],o[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),o[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i}function NG(i,e,t,r){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),o[1]=n[1],o[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i}function zG(i,e,t,r){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),o[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),o[2]=n[2],i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i}function QG(i,e){var t=i[0],r=i[1],n=i[2],o=e[0],l=e[1],s=e[2],g=Math.sqrt(t*t+r*r+n*n),b=Math.sqrt(o*o+l*l+s*s),T=g*b,F=T&&_2(i,e)/T;return Math.acos(Math.min(Math.max(F,-1),1))}var VG=RG,HG=AL;(function(){var i=hL();return function(e,t,r,n,o,l){var s,g;for(t||(t=3),r||(r=0),n?g=Math.min(n*t+r,e.length):g=e.length,s=r;s<g;s+=t)i[0]=e[s],i[1]=e[s+1],i[2]=e[s+2],o(i,i,l),e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2];return e}})();const b2=[0,0,0];let s1;class Ut extends m2{static get ZERO(){return s1||(s1=new Ut(0,0,0),Object.freeze(s1)),s1}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&ad(e)?this.copy(e):(wa.debug&&(is(e),is(t),is(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return wa.debug&&(is(e.x),is(e.y),is(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=is(e)}angle(e){return QG(this,e)}cross(e){return n1(this,this,e),this.check()}rotateX(e){let{radians:t,origin:r=b2}=e;return UG(this,this,r,t),this.check()}rotateY(e){let{radians:t,origin:r=b2}=e;return NG(this,this,r,t),this.check()}rotateZ(e){let{radians:t,origin:r=b2}=e;return zG(this,this,r,t),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return v2(this,this,e),this.check()}transformAsVector(e){return cL(this,this,e),this.check()}transformByMatrix3(e){return fL(this,this,e),this.check()}transformByMatrix2(e){return FG(this,this,e),this.check()}transformByQuaternion(e){return pL(this,this,e),this.check()}}let o1;class x2 extends m2{static get ZERO(){return o1||(o1=new x2(0,0,0,0),Object.freeze(o1)),o1}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),ad(e)&&arguments.length===1?this.copy(e):(wa.debug&&(is(e),is(t),is(r),is(n)),this[0]=e,this[1]=t,this[2]=r,this[3]=n)}set(e,t,r,n){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return wa.debug&&(is(e.x),is(e.y),is(e.z),is(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=is(e)}get w(){return this[3]}set w(e){this[3]=is(e)}transform(e){return v2(this,this,e),this.check()}transformByMatrix3(e){return uL(this,this,e),this.check()}transformByMatrix2(e){return DG(this,this,e),this.check()}transformByQuaternion(e){return pL(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class gL extends g2{toString(){let e="[";if(wa.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+t])}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=" ".concat(this[t])}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=is(r),this}getColumn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const r=e*this.RANK;for(let n=0;n<this.RANK;++n)t[n]=this[r+n];return t}setColumn(e,t){const r=e*this.RANK;for(let n=0;n<this.RANK;++n)this[r+n]=t[n];return this}}function GG(){var i=new th(9);return th!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function jG(i,e){if(i===e){var t=e[1],r=e[2],n=e[5];i[1]=e[3],i[2]=e[6],i[3]=t,i[5]=e[7],i[6]=r,i[7]=n}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i}function qG(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=e[4],s=e[5],g=e[6],b=e[7],T=e[8],F=T*l-s*b,k=-T*o+s*g,z=b*o-l*g,J=t*F+r*k+n*z;return J?(J=1/J,i[0]=F*J,i[1]=(-T*r+n*b)*J,i[2]=(s*r-n*l)*J,i[3]=k*J,i[4]=(T*t-n*g)*J,i[5]=(-s*t+n*o)*J,i[6]=z*J,i[7]=(-b*t+r*g)*J,i[8]=(l*t-r*o)*J,i):null}function $G(i){var e=i[0],t=i[1],r=i[2],n=i[3],o=i[4],l=i[5],s=i[6],g=i[7],b=i[8];return e*(b*o-l*g)+t*(-b*n+l*s)+r*(g*n-o*s)}function mL(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=e[4],g=e[5],b=e[6],T=e[7],F=e[8],k=t[0],z=t[1],J=t[2],te=t[3],ue=t[4],ce=t[5],de=t[6],_e=t[7],Ee=t[8];return i[0]=k*r+z*l+J*b,i[1]=k*n+z*s+J*T,i[2]=k*o+z*g+J*F,i[3]=te*r+ue*l+ce*b,i[4]=te*n+ue*s+ce*T,i[5]=te*o+ue*g+ce*F,i[6]=de*r+_e*l+Ee*b,i[7]=de*n+_e*s+Ee*T,i[8]=de*o+_e*g+Ee*F,i}function KG(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=e[4],g=e[5],b=e[6],T=e[7],F=e[8],k=t[0],z=t[1];return i[0]=r,i[1]=n,i[2]=o,i[3]=l,i[4]=s,i[5]=g,i[6]=k*r+z*l+b,i[7]=k*n+z*s+T,i[8]=k*o+z*g+F,i}function WG(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=e[4],g=e[5],b=e[6],T=e[7],F=e[8],k=Math.sin(t),z=Math.cos(t);return i[0]=z*r+k*l,i[1]=z*n+k*s,i[2]=z*o+k*g,i[3]=z*l-k*r,i[4]=z*s-k*n,i[5]=z*g-k*o,i[6]=b,i[7]=T,i[8]=F,i}function yL(i,e,t){var r=t[0],n=t[1];return i[0]=r*e[0],i[1]=r*e[1],i[2]=r*e[2],i[3]=n*e[3],i[4]=n*e[4],i[5]=n*e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i}function XG(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=t+t,s=r+r,g=n+n,b=t*l,T=r*l,F=r*s,k=n*l,z=n*s,J=n*g,te=o*l,ue=o*s,ce=o*g;return i[0]=1-F-J,i[3]=T-ce,i[6]=k+ue,i[1]=T+ce,i[4]=1-b-J,i[7]=z-te,i[2]=k-ue,i[5]=z+te,i[8]=1-b-F,i}var w2;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL1ROW0=3]="COL1ROW0",i[i.COL1ROW1=4]="COL1ROW1",i[i.COL1ROW2=5]="COL1ROW2",i[i.COL2ROW0=6]="COL2ROW0",i[i.COL2ROW1=7]="COL2ROW1",i[i.COL2ROW2=8]="COL2ROW2"})(w2||(w2={}));const ZG=Object.freeze([1,0,0,0,1,0,0,0,1]);class xo extends gL{static get IDENTITY(){return YG()}static get ZERO(){return JG()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return w2}constructor(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):r.length>0?this.copy([e,...r]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(ZG)}fromObject(e){return this.check()}fromQuaternion(e){return XG(this,e),this.check()}set(e,t,r,n,o,l,s,g,b){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this[4]=o,this[5]=l,this[6]=s,this[7]=g,this[8]=b,this.check()}setRowMajor(e,t,r,n,o,l,s,g,b){return this[0]=e,this[1]=n,this[2]=s,this[3]=t,this[4]=o,this[5]=g,this[6]=r,this[7]=l,this[8]=b,this.check()}determinant(){return $G(this)}transpose(){return jG(this,this),this.check()}invert(){return qG(this,this),this.check()}multiplyLeft(e){return mL(this,e,this),this.check()}multiplyRight(e){return mL(this,this,e),this.check()}rotate(e){return WG(this,this,e),this.check()}scale(e){return Array.isArray(e)?yL(this,this,e):yL(this,this,[e,e]),this.check()}translate(e){return KG(this,this,e),this.check()}transform(e,t){let r;switch(e.length){case 2:r=oL(t||[-0,-0],e,this);break;case 3:r=fL(t||[-0,-0,-0],e,this);break;case 4:r=uL(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return ly(r,e.length),r}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let a1,l1;function JG(){return a1||(a1=new xo([0,0,0,0,0,0,0,0,0]),Object.freeze(a1)),a1}function YG(){return l1||(l1=new xo,Object.freeze(l1)),l1}function ej(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function tj(i,e){if(i===e){var t=e[1],r=e[2],n=e[3],o=e[6],l=e[7],s=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=t,i[6]=e[9],i[7]=e[13],i[8]=r,i[9]=o,i[11]=e[14],i[12]=n,i[13]=l,i[14]=s}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i}function B2(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=e[4],s=e[5],g=e[6],b=e[7],T=e[8],F=e[9],k=e[10],z=e[11],J=e[12],te=e[13],ue=e[14],ce=e[15],de=t*s-r*l,_e=t*g-n*l,Ee=t*b-o*l,He=r*g-n*s,Ve=r*b-o*s,qe=n*b-o*g,Ue=T*te-F*J,ot=T*ue-k*J,it=T*ce-z*J,De=F*ue-k*te,Me=F*ce-z*te,Ze=k*ce-z*ue,We=de*Ze-_e*Me+Ee*De+He*it-Ve*ot+qe*Ue;return We?(We=1/We,i[0]=(s*Ze-g*Me+b*De)*We,i[1]=(n*Me-r*Ze-o*De)*We,i[2]=(te*qe-ue*Ve+ce*He)*We,i[3]=(k*Ve-F*qe-z*He)*We,i[4]=(g*it-l*Ze-b*ot)*We,i[5]=(t*Ze-n*it+o*ot)*We,i[6]=(ue*Ee-J*qe-ce*_e)*We,i[7]=(T*qe-k*Ee+z*_e)*We,i[8]=(l*Me-s*it+b*Ue)*We,i[9]=(r*it-t*Me-o*Ue)*We,i[10]=(J*Ve-te*Ee+ce*de)*We,i[11]=(F*Ee-T*Ve-z*de)*We,i[12]=(s*ot-l*De-g*Ue)*We,i[13]=(t*De-r*ot+n*Ue)*We,i[14]=(te*_e-J*He-ue*de)*We,i[15]=(T*He-F*_e+k*de)*We,i):null}function ij(i){var e=i[0],t=i[1],r=i[2],n=i[3],o=i[4],l=i[5],s=i[6],g=i[7],b=i[8],T=i[9],F=i[10],k=i[11],z=i[12],J=i[13],te=i[14],ue=i[15],ce=e*l-t*o,de=e*s-r*o,_e=e*g-n*o,Ee=t*s-r*l,He=t*g-n*l,Ve=r*g-n*s,qe=b*J-T*z,Ue=b*te-F*z,ot=b*ue-k*z,it=T*te-F*J,De=T*ue-k*J,Me=F*ue-k*te;return ce*Me-de*De+_e*it+Ee*ot-He*Ue+Ve*qe}function _f(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=e[4],g=e[5],b=e[6],T=e[7],F=e[8],k=e[9],z=e[10],J=e[11],te=e[12],ue=e[13],ce=e[14],de=e[15],_e=t[0],Ee=t[1],He=t[2],Ve=t[3];return i[0]=_e*r+Ee*s+He*F+Ve*te,i[1]=_e*n+Ee*g+He*k+Ve*ue,i[2]=_e*o+Ee*b+He*z+Ve*ce,i[3]=_e*l+Ee*T+He*J+Ve*de,_e=t[4],Ee=t[5],He=t[6],Ve=t[7],i[4]=_e*r+Ee*s+He*F+Ve*te,i[5]=_e*n+Ee*g+He*k+Ve*ue,i[6]=_e*o+Ee*b+He*z+Ve*ce,i[7]=_e*l+Ee*T+He*J+Ve*de,_e=t[8],Ee=t[9],He=t[10],Ve=t[11],i[8]=_e*r+Ee*s+He*F+Ve*te,i[9]=_e*n+Ee*g+He*k+Ve*ue,i[10]=_e*o+Ee*b+He*z+Ve*ce,i[11]=_e*l+Ee*T+He*J+Ve*de,_e=t[12],Ee=t[13],He=t[14],Ve=t[15],i[12]=_e*r+Ee*s+He*F+Ve*te,i[13]=_e*n+Ee*g+He*k+Ve*ue,i[14]=_e*o+Ee*b+He*z+Ve*ce,i[15]=_e*l+Ee*T+He*J+Ve*de,i}function c1(i,e,t){var r=t[0],n=t[1],o=t[2],l,s,g,b,T,F,k,z,J,te,ue,ce;return e===i?(i[12]=e[0]*r+e[4]*n+e[8]*o+e[12],i[13]=e[1]*r+e[5]*n+e[9]*o+e[13],i[14]=e[2]*r+e[6]*n+e[10]*o+e[14],i[15]=e[3]*r+e[7]*n+e[11]*o+e[15]):(l=e[0],s=e[1],g=e[2],b=e[3],T=e[4],F=e[5],k=e[6],z=e[7],J=e[8],te=e[9],ue=e[10],ce=e[11],i[0]=l,i[1]=s,i[2]=g,i[3]=b,i[4]=T,i[5]=F,i[6]=k,i[7]=z,i[8]=J,i[9]=te,i[10]=ue,i[11]=ce,i[12]=l*r+T*n+J*o+e[12],i[13]=s*r+F*n+te*o+e[13],i[14]=g*r+k*n+ue*o+e[14],i[15]=b*r+z*n+ce*o+e[15]),i}function C2(i,e,t){var r=t[0],n=t[1],o=t[2];return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i[8]=e[8]*o,i[9]=e[9]*o,i[10]=e[10]*o,i[11]=e[11]*o,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function rj(i,e,t,r){var n=r[0],o=r[1],l=r[2],s=Math.hypot(n,o,l),g,b,T,F,k,z,J,te,ue,ce,de,_e,Ee,He,Ve,qe,Ue,ot,it,De,Me,Ze,We,Bt;return s<cy?null:(s=1/s,n*=s,o*=s,l*=s,g=Math.sin(t),b=Math.cos(t),T=1-b,F=e[0],k=e[1],z=e[2],J=e[3],te=e[4],ue=e[5],ce=e[6],de=e[7],_e=e[8],Ee=e[9],He=e[10],Ve=e[11],qe=n*n*T+b,Ue=o*n*T+l*g,ot=l*n*T-o*g,it=n*o*T-l*g,De=o*o*T+b,Me=l*o*T+n*g,Ze=n*l*T+o*g,We=o*l*T-n*g,Bt=l*l*T+b,i[0]=F*qe+te*Ue+_e*ot,i[1]=k*qe+ue*Ue+Ee*ot,i[2]=z*qe+ce*Ue+He*ot,i[3]=J*qe+de*Ue+Ve*ot,i[4]=F*it+te*De+_e*Me,i[5]=k*it+ue*De+Ee*Me,i[6]=z*it+ce*De+He*Me,i[7]=J*it+de*De+Ve*Me,i[8]=F*Ze+te*We+_e*Bt,i[9]=k*Ze+ue*We+Ee*Bt,i[10]=z*Ze+ce*We+He*Bt,i[11]=J*Ze+de*We+Ve*Bt,e!==i&&(i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i)}function _L(i,e,t){var r=Math.sin(t),n=Math.cos(t),o=e[4],l=e[5],s=e[6],g=e[7],b=e[8],T=e[9],F=e[10],k=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=o*n+b*r,i[5]=l*n+T*r,i[6]=s*n+F*r,i[7]=g*n+k*r,i[8]=b*n-o*r,i[9]=T*n-l*r,i[10]=F*n-s*r,i[11]=k*n-g*r,i}function nj(i,e,t){var r=Math.sin(t),n=Math.cos(t),o=e[0],l=e[1],s=e[2],g=e[3],b=e[8],T=e[9],F=e[10],k=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=o*n-b*r,i[1]=l*n-T*r,i[2]=s*n-F*r,i[3]=g*n-k*r,i[8]=o*r+b*n,i[9]=l*r+T*n,i[10]=s*r+F*n,i[11]=g*r+k*n,i}function vL(i,e,t){var r=Math.sin(t),n=Math.cos(t),o=e[0],l=e[1],s=e[2],g=e[3],b=e[4],T=e[5],F=e[6],k=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=o*n+b*r,i[1]=l*n+T*r,i[2]=s*n+F*r,i[3]=g*n+k*r,i[4]=b*n-o*r,i[5]=T*n-l*r,i[6]=F*n-s*r,i[7]=k*n-g*r,i}function sj(i,e){var t=e[0],r=e[1],n=e[2],o=e[4],l=e[5],s=e[6],g=e[8],b=e[9],T=e[10];return i[0]=Math.hypot(t,r,n),i[1]=Math.hypot(o,l,s),i[2]=Math.hypot(g,b,T),i}function oj(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=t+t,s=r+r,g=n+n,b=t*l,T=r*l,F=r*s,k=n*l,z=n*s,J=n*g,te=o*l,ue=o*s,ce=o*g;return i[0]=1-F-J,i[1]=T+ce,i[2]=k-ue,i[3]=0,i[4]=T-ce,i[5]=1-b-J,i[6]=z+te,i[7]=0,i[8]=k+ue,i[9]=z-te,i[10]=1-b-F,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function aj(i,e,t,r,n,o,l){var s=1/(t-e),g=1/(n-r),b=1/(o-l);return i[0]=o*2*s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o*2*g,i[6]=0,i[7]=0,i[8]=(t+e)*s,i[9]=(n+r)*g,i[10]=(l+o)*b,i[11]=-1,i[12]=0,i[13]=0,i[14]=l*o*2*b,i[15]=0,i}function lj(i,e,t,r,n){var o=1/Math.tan(e/2),l;return i[0]=o/t,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,n!=null&&n!==1/0?(l=1/(r-n),i[10]=(n+r)*l,i[14]=2*n*r*l):(i[10]=-1,i[14]=-2*r),i}var cj=lj;function uj(i,e,t,r,n,o,l){var s=1/(e-t),g=1/(r-n),b=1/(o-l);return i[0]=-2*s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*g,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*b,i[11]=0,i[12]=(e+t)*s,i[13]=(n+r)*g,i[14]=(l+o)*b,i[15]=1,i}var hj=uj;function Aj(i,e,t,r){var n,o,l,s,g,b,T,F,k,z,J=e[0],te=e[1],ue=e[2],ce=r[0],de=r[1],_e=r[2],Ee=t[0],He=t[1],Ve=t[2];return Math.abs(J-Ee)<cy&&Math.abs(te-He)<cy&&Math.abs(ue-Ve)<cy?ej(i):(T=J-Ee,F=te-He,k=ue-Ve,z=1/Math.hypot(T,F,k),T*=z,F*=z,k*=z,n=de*k-_e*F,o=_e*T-ce*k,l=ce*F-de*T,z=Math.hypot(n,o,l),z?(z=1/z,n*=z,o*=z,l*=z):(n=0,o=0,l=0),s=F*l-k*o,g=k*n-T*l,b=T*o-F*n,z=Math.hypot(s,g,b),z?(z=1/z,s*=z,g*=z,b*=z):(s=0,g=0,b=0),i[0]=n,i[1]=s,i[2]=T,i[3]=0,i[4]=o,i[5]=g,i[6]=F,i[7]=0,i[8]=l,i[9]=b,i[10]=k,i[11]=0,i[12]=-(n*J+o*te+l*ue),i[13]=-(s*J+g*te+b*ue),i[14]=-(T*J+F*te+k*ue),i[15]=1,i)}function dj(){var i=new th(4);return th!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function fj(i,e,t){return i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i}function bL(i,e,t){return i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i}function pj(i){var e=i[0],t=i[1],r=i[2],n=i[3];return Math.hypot(e,t,r,n)}function gj(i){var e=i[0],t=i[1],r=i[2],n=i[3];return e*e+t*t+r*r+n*n}function mj(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=t*t+r*r+n*n+o*o;return l>0&&(l=1/Math.sqrt(l)),i[0]=t*l,i[1]=r*l,i[2]=n*l,i[3]=o*l,i}function yj(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]}function _j(i,e,t,r){var n=e[0],o=e[1],l=e[2],s=e[3];return i[0]=n+r*(t[0]-n),i[1]=o+r*(t[1]-o),i[2]=l+r*(t[2]-l),i[3]=s+r*(t[3]-s),i}function uy(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3];return i[0]=t[0]*r+t[4]*n+t[8]*o+t[12]*l,i[1]=t[1]*r+t[5]*n+t[9]*o+t[13]*l,i[2]=t[2]*r+t[6]*n+t[10]*o+t[14]*l,i[3]=t[3]*r+t[7]*n+t[11]*o+t[15]*l,i}function vj(i,e,t){var r=e[0],n=e[1],o=e[2],l=t[0],s=t[1],g=t[2],b=t[3],T=b*r+s*o-g*n,F=b*n+g*r-l*o,k=b*o+l*n-s*r,z=-l*r-s*n-g*o;return i[0]=T*b+z*-l+F*-g-k*-s,i[1]=F*b+z*-s+k*-l-T*-g,i[2]=k*b+z*-g+T*-s-F*-l,i[3]=e[3],i}(function(){var i=dj();return function(e,t,r,n,o,l){var s,g;for(t||(t=4),r||(r=0),n?g=Math.min(n*t+r,e.length):g=e.length,s=r;s<g;s+=t)i[0]=e[s],i[1]=e[s+1],i[2]=e[s+2],i[3]=e[s+3],o(i,i,l),e[s]=i[0],e[s+1]=i[1],e[s+2]=i[2],e[s+3]=i[3];return e}})();var E2;(function(i){i[i.COL0ROW0=0]="COL0ROW0",i[i.COL0ROW1=1]="COL0ROW1",i[i.COL0ROW2=2]="COL0ROW2",i[i.COL0ROW3=3]="COL0ROW3",i[i.COL1ROW0=4]="COL1ROW0",i[i.COL1ROW1=5]="COL1ROW1",i[i.COL1ROW2=6]="COL1ROW2",i[i.COL1ROW3=7]="COL1ROW3",i[i.COL2ROW0=8]="COL2ROW0",i[i.COL2ROW1=9]="COL2ROW1",i[i.COL2ROW2=10]="COL2ROW2",i[i.COL2ROW3=11]="COL2ROW3",i[i.COL3ROW0=12]="COL3ROW0",i[i.COL3ROW1=13]="COL3ROW1",i[i.COL3ROW2=14]="COL3ROW2",i[i.COL3ROW3=15]="COL3ROW3"})(E2||(E2={}));const bj=45*Math.PI/180,xj=1,S2=.1,T2=500,wj=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Bn extends gL{static get IDENTITY(){return Cj()}static get ZERO(){return Bj()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return E2}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,n,o,l,s,g,b,T,F,k,z,J,te,ue){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this[4]=o,this[5]=l,this[6]=s,this[7]=g,this[8]=b,this[9]=T,this[10]=F,this[11]=k,this[12]=z,this[13]=J,this[14]=te,this[15]=ue,this.check()}setRowMajor(e,t,r,n,o,l,s,g,b,T,F,k,z,J,te,ue){return this[0]=e,this[1]=o,this[2]=b,this[3]=z,this[4]=t,this[5]=l,this[6]=T,this[7]=J,this[8]=r,this[9]=s,this[10]=F,this[11]=te,this[12]=n,this[13]=g,this[14]=k,this[15]=ue,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(wj)}fromObject(e){return this.check()}fromQuaternion(e){return oj(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:n,top:o,near:l=S2,far:s=T2}=e;return s===1/0?Ej(this,t,r,n,o,l):aj(this,t,r,n,o,l,s),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:n=[0,1,0]}=e;return Aj(this,t,r,n),this.check()}ortho(e){const{left:t,right:r,bottom:n,top:o,near:l=S2,far:s=T2}=e;return hj(this,t,r,n,o,l,s),this.check()}orthographic(e){const{fovy:t=bj,aspect:r=xj,focalDistance:n=1,near:o=S2,far:l=T2}=e;xL(t);const s=t/2,g=n*Math.tan(s),b=g*r;return this.ortho({left:-b,right:b,bottom:-g,top:g,near:o,far:l})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:n=.1,far:o=500}=e;return xL(t),cj(this,t,r,n,o),this.check()}determinant(){return ij(this)}getScale(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),n=1/r[0],o=1/r[1],l=1/r[2];return e[0]=this[0]*n,e[1]=this[1]*o,e[2]=this[2]*l,e[3]=0,e[4]=this[4]*n,e[5]=this[5]*o,e[6]=this[6]*l,e[7]=0,e[8]=this[8]*n,e[9]=this[9]*o,e[10]=this[10]*l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),n=1/r[0],o=1/r[1],l=1/r[2];return e[0]=this[0]*n,e[1]=this[1]*o,e[2]=this[2]*l,e[3]=this[4]*n,e[4]=this[5]*o,e[5]=this[6]*l,e[6]=this[8]*n,e[7]=this[9]*o,e[8]=this[10]*l,e}transpose(){return tj(this,this),this.check()}invert(){return B2(this,this),this.check()}multiplyLeft(e){return _f(this,e,this),this.check()}multiplyRight(e){return _f(this,this,e),this.check()}rotateX(e){return _L(this,this,e),this.check()}rotateY(e){return nj(this,this,e),this.check()}rotateZ(e){return vL(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return rj(this,this,e,t),this.check()}scale(e){return C2(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return c1(this,this,e),this.check()}transform(e,t){return e.length===4?(t=uy(t||[-0,-0,-0,-0],e,this),ly(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let n;switch(r){case 2:n=aL(t||[-0,-0],e,this);break;case 3:n=v2(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return ly(n,e.length),n}transformAsVector(e,t){let r;switch(e.length){case 2:r=lL(t||[-0,-0],e,this);break;case 3:r=cL(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return ly(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let u1,h1;function Bj(){return u1||(u1=new Bn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(u1)),u1}function Cj(){return h1||(h1=new Bn,Object.freeze(h1)),h1}function xL(i){if(i>Math.PI*2)throw Error("expected radians")}function Ej(i,e,t,r,n,o){const l=2*o/(t-e),s=2*o/(n-r),g=(t+e)/(t-e),b=(n+r)/(n-r),T=-1,F=-1,k=-2*o;return i[0]=l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=s,i[6]=0,i[7]=0,i[8]=g,i[9]=b,i[10]=T,i[11]=F,i[12]=0,i[13]=0,i[14]=k,i[15]=0,i}function wL(){var i=new th(4);return th!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Sj(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function BL(i,e,t){t=t*.5;var r=Math.sin(t);return i[0]=r*e[0],i[1]=r*e[1],i[2]=r*e[2],i[3]=Math.cos(t),i}function CL(i,e,t){var r=e[0],n=e[1],o=e[2],l=e[3],s=t[0],g=t[1],b=t[2],T=t[3];return i[0]=r*T+l*s+n*b-o*g,i[1]=n*T+l*g+o*s-r*b,i[2]=o*T+l*b+r*g-n*s,i[3]=l*T-r*s-n*g-o*b,i}function Tj(i,e,t){t*=.5;var r=e[0],n=e[1],o=e[2],l=e[3],s=Math.sin(t),g=Math.cos(t);return i[0]=r*g+l*s,i[1]=n*g+o*s,i[2]=o*g-n*s,i[3]=l*g-r*s,i}function Ij(i,e,t){t*=.5;var r=e[0],n=e[1],o=e[2],l=e[3],s=Math.sin(t),g=Math.cos(t);return i[0]=r*g-o*s,i[1]=n*g+l*s,i[2]=o*g+r*s,i[3]=l*g-n*s,i}function Lj(i,e,t){t*=.5;var r=e[0],n=e[1],o=e[2],l=e[3],s=Math.sin(t),g=Math.cos(t);return i[0]=r*g+n*s,i[1]=n*g-r*s,i[2]=o*g+l*s,i[3]=l*g-o*s,i}function Mj(i,e){var t=e[0],r=e[1],n=e[2];return i[0]=t,i[1]=r,i[2]=n,i[3]=Math.sqrt(Math.abs(1-t*t-r*r-n*n)),i}function A1(i,e,t,r){var n=e[0],o=e[1],l=e[2],s=e[3],g=t[0],b=t[1],T=t[2],F=t[3],k,z,J,te,ue;return z=n*g+o*b+l*T+s*F,z<0&&(z=-z,g=-g,b=-b,T=-T,F=-F),1-z>cy?(k=Math.acos(z),J=Math.sin(k),te=Math.sin((1-r)*k)/J,ue=Math.sin(r*k)/J):(te=1-r,ue=r),i[0]=te*n+ue*g,i[1]=te*o+ue*b,i[2]=te*l+ue*T,i[3]=te*s+ue*F,i}function Pj(i,e){var t=e[0],r=e[1],n=e[2],o=e[3],l=t*t+r*r+n*n+o*o,s=l?1/l:0;return i[0]=-t*s,i[1]=-r*s,i[2]=-n*s,i[3]=o*s,i}function Fj(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i}function EL(i,e){var t=e[0]+e[4]+e[8],r;if(t>0)r=Math.sqrt(t+1),i[3]=.5*r,r=.5/r,i[0]=(e[5]-e[7])*r,i[1]=(e[6]-e[2])*r,i[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);var o=(n+1)%3,l=(n+2)%3;r=Math.sqrt(e[n*3+n]-e[o*3+o]-e[l*3+l]+1),i[n]=.5*r,r=.5/r,i[3]=(e[o*3+l]-e[l*3+o])*r,i[o]=(e[o*3+n]+e[n*3+o])*r,i[l]=(e[l*3+n]+e[n*3+l])*r}return i}var Dj=fj,Rj=bL,kj=yj,Oj=_j,Uj=pj,Nj=gj,SL=mj,zj=function(){var i=hL(),e=dL(1,0,0),t=dL(0,1,0);return function(r,n,o){var l=_2(n,o);return l<-.999999?(n1(i,e,n),HG(i)<1e-6&&n1(i,t,n),OG(i,i),BL(r,i,Math.PI),r):l>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(n1(i,n,o),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=1+l,SL(r,r))}}();(function(){var i=wL(),e=wL();return function(t,r,n,o,l,s){return A1(i,r,l,s),A1(e,n,o,s),A1(t,i,e,2*s*(1-s)),t}})(),function(){var i=GG();return function(e,t,r,n){return i[0]=r[0],i[3]=r[1],i[6]=r[2],i[1]=n[0],i[4]=n[1],i[7]=n[2],i[2]=-t[0],i[5]=-t[1],i[8]=-t[2],SL(e,EL(e,i))}}();const Qj=[0,0,0,1];class hy extends g2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,r,n)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,r,n){return this[0]=e,this[1]=t,this[2]=r,this[3]=n,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return EL(this,e),this.check()}fromAxisRotation(e,t){return BL(this,e,t),this.check()}identity(){return Sj(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=is(e)}get y(){return this[1]}set y(e){this[1]=is(e)}get z(){return this[2]}set z(e){this[2]=is(e)}get w(){return this[3]}set w(e){this[3]=is(e)}len(){return Uj(this)}lengthSquared(){return Nj(this)}dot(e){return kj(this,e)}rotationTo(e,t){return zj(this,e,t),this.check()}add(e){return Dj(this,this,e),this.check()}calculateW(){return Mj(this,this),this.check()}conjugate(){return Fj(this,this),this.check()}invert(){return Pj(this,this),this.check()}lerp(e,t,r){return r===void 0?this.lerp(this,e,t):(Oj(this,e,t,r),this.check())}multiplyRight(e){return CL(this,this,e),this.check()}multiplyLeft(e){return CL(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return Tj(this,this,e),this.check()}rotateY(e){return Ij(this,this,e),this.check()}rotateZ(e){return Lj(this,this,e),this.check()}scale(e){return Rj(this,this,e),this.check()}slerp(e,t,r){let n,o,l;switch(arguments.length){case 1:({start:n=Qj,target:o,ratio:l}=e);break;case 2:n=this,o=e,l=t;break;default:n=e,o=t,l=r}return A1(this,n,o,l),this.check()}transformVector4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new x2;return vj(t,e,this),ly(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const Ay={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},TL=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,Vj={lightSources:{}};function I2(){let{color:i=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return i.map(t=>t*e/255)}function Hj(i){let{ambientLight:e,pointLights:t=[],directionalLights:r=[]}=i;const n={};return e?n["lighting_uAmbientLight.color"]=I2(e):n["lighting_uAmbientLight.color"]=[0,0,0],t.forEach((o,l)=>{n["lighting_uPointLight[".concat(l,"].color")]=I2(o),n["lighting_uPointLight[".concat(l,"].position")]=o.position,n["lighting_uPointLight[".concat(l,"].attenuation")]=o.attenuation||[1,0,0]}),n.lighting_uPointLightCount=t.length,r.forEach((o,l)=>{n["lighting_uDirectionalLight[".concat(l,"].color")]=I2(o),n["lighting_uDirectionalLight[".concat(l,"].direction")]=o.direction}),n.lighting_uDirectionalLightCount=r.length,n}function IL(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Vj;if("lightSources"in i){const{ambientLight:e,pointLights:t,directionalLights:r}=i.lightSources||{};return e||t&&t.length>0||r&&r.length>0?Object.assign({},Hj({ambientLight:e,pointLights:t,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in i){const e={pointLights:[],directionalLights:[]};for(const t of i.lights||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights.push(t);break;case"point":e.pointLights.push(t);break}return IL({lightSources:e})}return{}}const L2={name:"lights",vs:TL,fs:TL,getUniforms:IL,defines:{MAX_LIGHTS:3}},Gj={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};function jj(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Gj;const e={};if(i.pickingSelectedColor!==void 0)if(!i.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const t=i.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=t}if(i.pickingHighlightColor){const t=Array.from(i.pickingHighlightColor,r=>r/255);Number.isFinite(t[3])||(t[3]=1),e.picking_uHighlightColor=t}return i.pickingActive!==void 0&&(e.picking_uActive=!!i.pickingActive,e.picking_uAttribute=!!i.pickingAttribute),e}const qj={name:"picking",vs:`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,getUniforms:jj},LL=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,$j={};function Kj(i){const{ambient:e=.35,diffuse:t=.6,shininess:r=32,specularColor:n=[30,30,30]}=i;return{lighting_uAmbient:e,lighting_uDiffuse:t,lighting_uShininess:r,lighting_uSpecularColor:n.map(o=>o/255)}}function ML(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$j;if(!("material"in i))return{};const{material:e}=i;return e?Kj(e):{lighting_uEnabled:!1}}const Wj={name:"gouraud-lighting",dependencies:[L2],vs:LL,defines:{LIGHTING_VERTEX:1},getUniforms:ML},Xj={name:"phong-lighting",dependencies:[L2],fs:LL,defines:{LIGHTING_FRAGMENT:1},getUniforms:ML},M2={name:"pbr",vs:`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,fs:`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,defines:{LIGHTING_FRAGMENT:1},dependencies:[L2]},Zj={name:"transform",vs:`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,fs:null};class dy{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new dy(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(t=>t.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:t="",fs:r="",defines:n={},inject:o={},varyings:l=[],bufferMode:s=35981,transpileToGLSL100:g=!1}=e,b=this._getModuleList(e.modules),T=this._getHash(t),F=this._getHash(r),k=b.map(_e=>this._getHash(_e.name)).sort(),z=l.map(_e=>this._getHash(_e)),J=Object.keys(n).sort(),te=Object.keys(o).sort(),ue=[],ce=[];for(const _e of J)ue.push(this._getHash(_e)),ue.push(this._getHash(n[_e]));for(const _e of te)ce.push(this._getHash(_e)),ce.push(this._getHash(o[_e]));const de="".concat(T,"/").concat(F,"D").concat(ue.join("/"),"M").concat(k.join("/"),"I").concat(ce.join("/"),"V").concat(z.join("/"),"H").concat(this.stateHash,"B").concat(s).concat(g?"T":"");if(!this._programCache[de]){const _e=oG(this.gl,{vs:t,fs:r,modules:b,inject:o,defines:n,hookFunctions:this._hookFunctions,transpileToGLSL100:g});this._programCache[de]=new O3(this.gl,{hash:de,vs:_e.vs,fs:_e.fs,varyings:l,bufferMode:s}),this._getUniforms[de]=_e.getUniforms||(Ee=>{}),this._useCounts[de]=0}return this._useCounts[de]++,this._programCache[de]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const t=e.hash;this._useCounts[t]--,this._useCounts[t]===0&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=new Array(this._defaultModules.length+e.length),r={};let n=0;for(let o=0,l=this._defaultModules.length;o<l;++o){const s=this._defaultModules[o],g=s.name;t[n++]=s,r[g]=!0}for(let o=0,l=e.length;o<l;++o){const s=e[o],g=s.name;r[g]||(t[n++]=s,r[g]=!0)}return t.length=n,t}}const Jj={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Yj(i,e,t){const r={};let n=e.indices;for(const o in e.attributes){const l=e.attributes[o],s=eq(o,t);if(o==="indices")n=l;else if(l.constant)r[s]=l.value;else{const g=l.value,b={...l};delete b.value,r[s]=[new bs(i,g),b],tq(o,b)}}if(n){const o=n.value||n;Xi(o instanceof Uint16Array||o instanceof Uint32Array,'attribute array for "indices" must be of integer type');const l={size:1,isIndexed:n.isIndexed===void 0?!0:n.isIndexed};r.indices=[new bs(i,{data:o,target:34963}),l]}return r}function eq(i,e){const{attributeMap:t=Jj}=e||{};return t&&t[i]||i}function tq(i,e){let t;switch(i){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":t="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":t="vectors";break}switch(t){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}Xi(Number.isFinite(e.size),"attribute ".concat(i," needs size"))}const Jp=2,iq=1e4,rq="Model needs drawMode and vertexCount",PL=()=>{},nq={};class Yp{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=xA("model")}=t;Xi(j_(e)),this.id=r,this.gl=e,this.id=t.id||xA("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||dy.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:t=null,vs:r,fs:n,modules:o,defines:l,inject:s,varyings:g,bufferMode:b,transpileToGLSL100:T}=e;this.programProps={program:t,vs:r,fs:n,modules:o,defines:l,inject:s,varyings:g,bufferMode:b,transpileToGLSL100:T},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},Xi(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),rq)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:t,vs:r,fs:n,modules:o,defines:l,inject:s,varyings:g,bufferMode:b,transpileToGLSL100:T}=e;this.programProps={program:t,vs:r,fs:n,modules:o,defines:l,inject:s,varyings:g,bufferMode:b,transpileToGLSL100:T},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return Xi(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return Xi(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=Yj(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if($p(e))return this;const t={};for(const r in e){const n=e[r];t[r]=n.getValue?n.getValue():n}return this.vertexArray.setAttributes(t),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){const t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return e2(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:t=null,framebuffer:r,uniforms:n={},attributes:o={},transformFeedback:l=this.transformFeedback,parameters:s={},vertexArray:g=this.vertexArray}=e;this.setAttributes(o),this.updateModuleSettings(t),this.setUniforms(n);let b;ar.priority>=Jp&&(b=this._logDrawCallStart(Jp));const T=this.vertexArray.getDrawParams(),{isIndexed:F=T.isIndexed,indexType:k=T.indexType,indexOffset:z=T.indexOffset,vertexArrayInstanced:J=T.isInstanced}=this.props;J&&!this.isInstanced&&ar.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:te,instanceCount:ue}=this,{onBeforeRender:ce=PL,onAfterRender:de=PL}=this.props;ce(),this.program.setUniforms(this.uniforms);const _e=this.program.draw(Object.assign(nq,e,{logPriority:b,uniforms:null,framebuffer:r,parameters:s,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:g,transformFeedback:l,isIndexed:F,indexType:k,isInstanced:te,instanceCount:ue,offset:F?z:0}));return de(),ar.priority>=Jp&&this._logDrawCallEnd(b,g,r),_e}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:t=!0,feedbackBuffers:r,unbindModels:n=[]}=e;let{parameters:o}=e;r&&this._setFeedbackBuffers(r),t&&(o=Object.assign({},o,{35977:t})),n.forEach(l=>l.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:o}))}finally{n.forEach(l=>l.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ar.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:r,fs:n,modules:o,inject:l,defines:s,varyings:g,bufferMode:b,transpileToGLSL100:T}=this.programProps;t=this.programManager.get({vs:r,fs:n,modules:o,inject:l,defines:s,varyings:g,bufferMode:b,transpileToGLSL100:T}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Xi(t instanceof O3,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new b7(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof bs&&t.delete()}}_setAnimationProps(e){this.animated&&Xi(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if($p(e))return this;const{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new U3(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const t=e>3?0:iq;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),ar.group(Jp,">>> DRAWING MODEL ".concat(this.id),{collapsed:ar.level<=2})(),e}_logDrawCallEnd(e,t,r,n){if(e===void 0)return;const o=B7({vertexArray:t,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:l,unusedTable:s,unusedCount:g}=N3({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:b,count:T}=N3({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});T>0&&ar.log("MISSING UNIFORMS",Object.keys(b))(),g>0&&ar.log("UNUSED UNIFORMS",Object.keys(s))();const F=E7(this.vertexArray.configuration);ar.table(e,o)(),ar.table(e,l)(),ar.table(e+1,F)(),n&&n.log({logLevel:Jp,message:"Rendered to ".concat(n.id)}),ar.groupEnd(Jp)()}}class sq{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:n}=t;return{attributes:Object.assign({},r,e.attributes),transformFeedback:n}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:t}=this.bindings[this.currentIndex],r=e?t[e]:null;return r?r instanceof bs?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:t}=e,r=this.getBuffer(t);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Xi(hn(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:t={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const n in this.feedbackMap){const o=this.feedbackMap[n];n in t&&(r[o]=n)}Object.assign(r,e.feedbackBuffers);for(const n in r){const o=r[n];if(typeof o=="string"){const l=t[o],{byteLength:s,usage:g,accessor:b}=l;r[n]=this._createNewBuffer(n,{byteLength:s,usage:g,accessor:b})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:r})}_setupTransformFeedback(e,t){let{model:r}=t;const{program:n}=r;e.transformFeedback=new U3(this.gl,{program:n,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:t,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:t,feedbackBuffers:r})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const n in this.feedbackMap){const o=this.feedbackMap[n];t[n]=e.feedbackBuffers[o],r[o]=e.sourceBuffers[n],Xi(r[o]instanceof bs)}return{sourceBuffers:t,feedbackBuffers:r}}_createNewBuffer(e,t){const r=new bs(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const oq="transform_uSampler_",d1="transform_uSize_",FL="transform_position";function aq(i){let{vs:e,sourceTextureMap:t,targetTextureVarying:r,targetTexture:n}=i,l=Object.keys(t).length,s=null;const g={};let b=e,T={};if(l>0||r){const F=b.split(`
`),k=F.slice();if(F.forEach((z,J,te)=>{if(l>0){const ue=Aq(z,t);if(ue){const{updatedLine:ce,inject:de}=ue;k[J]=ce,T=A2([T,de]),Object.assign(g,ue.samplerTextureMap),l--}}r&&!s&&(s=hq(z,r))}),r){Xi(n);const z="".concat(d1).concat(r),J="uniform vec2 ".concat(z,`;
`),te="     vec2 ".concat(FL," = transform_getPos(").concat(z,`);
     gl_Position = vec4(`).concat(FL,`, 0, 1.);
`);T=A2([T,{"vs:#decl":J,"vs:#main-start":te}])}b=k.join(`
`)}return{vs:b,targetTextureType:s,inject:T,samplerTextureMap:g}}function lq(i){let{sourceTextureMap:e,targetTextureVarying:t,targetTexture:r}=i;const n={};let o,l;t&&({width:o,height:l}=r,n["".concat(d1).concat(t)]=[o,l]);for(const s in e)({width:o,height:l}=e[s]),n["".concat(d1).concat(s)]=[o,l];return n}function cq(i){return iL(i,["attribute","in"])}function uq(i){const e="".concat(oq).concat(i),t="".concat(d1).concat(i),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(t,";");return{samplerName:e,sizeName:t,uniformDeclerations:r}}function hq(i,e){const t=iL(i,["varying","out"]);return t&&t.name===e?t.type:null}function Aq(i,e){const t={},r=cq(i);if(!r)return null;const{type:n,name:o}=r;if(o&&e[o]){const l="// ".concat(i," => Replaced by Transform with a sampler"),{samplerName:s,sizeName:g,uniformDeclerations:b}=uq(o),T=pG(n),F="  ".concat(n," ").concat(o," = transform_getInput(").concat(s,", ").concat(g,").").concat(T,`;
`);return t[s]=o,{updatedLine:l,inject:{"vs:#decl":b,"vs:#main-start":F},samplerTextureMap:t}}return null}const dq={10241:9728,10240:9728,10242:33071,10243:33071},fq="transform_output";class pq{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,sourceTextures:r,framebuffer:n,targetTexture:o}=this.bindings[this.currentIndex],l=Object.assign({},t,e.attributes),s=Object.assign({},e.uniforms),g=Object.assign({},e.parameters);let b=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){l.transform_elementID=this.elementIDBuffer;for(const F in this.samplerTextureMap){const k=this.samplerTextureMap[F];s[F]=r[k]}this._setSourceTextureParameters();const T=lq({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:o});Object.assign(s,T)}return this.hasTargetTexture&&(b=!1,g.viewport=[0,0,n.width,n.height]),{attributes:l,framebuffer:n,uniforms:s,discard:b,parameters:g}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:t}=this.bindings[this.currentIndex],r=$_(t);if(!e)return r;const n=r.constructor,o=gG(this.targetTextureType),l=new n(r.length*o/4);let s=0;for(let g=0;g<r.length;g+=4)for(let b=0;b<o;b++)l[s++]=r[g+b];return l}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:t,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:t,textureOrReference:r}=e;if(r instanceof Xc)return r;const n=t[r];return n?(this._targetRefTexName=r,this._createNewTexture(n)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,_sourceTextures:r={},_targetTexture:n}=e,o=this._createTargetTexture({sourceTextures:r,textureOrReference:n});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:r,targetTexture:o}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const t=new Float32Array(e);t.forEach((r,n,o)=>{o[n]=n}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new bs(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:t,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:t,targetTexture:r})}}_updateBinding(e,t){const{sourceBuffers:r,sourceTextures:n,targetTexture:o}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),Object.assign(e.sourceBuffers,r),o){e.targetTexture=o;const{width:l,height:s}=o,{framebuffer:g}=e;g?(g.update({attachments:{36064:o},resizeAttachments:!1}),g.resize({width:l,height:s})):e.framebuffer=new ba(this.gl,{id:"transform-framebuffer",width:l,height:s,attachments:{36064:o}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const r in t)t[r].setParameters(dq)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);t[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:t,targetTexture:r}}_createNewTexture(e){const t=u9(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:t,targetTexture:r}=this.bindings[this.currentIndex],{vs:n,uniforms:o,targetTextureType:l,inject:s,samplerTextureMap:g}=aq({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),b=A2([e.inject||{},s]);this.targetTextureType=l,this.samplerTextureMap=g;const T=e._fs||rL({version:L3(n),input:this.targetTextureVarying,inputType:l,output:fq}),F=this.hasSourceTextures||this.targetTextureVarying?[Zj].concat(e.modules||[]):e.modules;return{vs:n,fs:T,modules:F,uniforms:o,inject:b}}}class P2{static isSupported(e){return hn(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:r}=this;e&&e.delete(),t&&t.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:t=!0}=e,r=this._updateDrawOptions(e);t&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)e=e||r.swap();Xi(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t){const n=r.getData(e);if(n)return n}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of t)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new Yp(t,Object.assign({},e,{fs:e.fs||rL({version:L3(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of r)t=n.updateModelProps(t);return t}_buildResourceTransforms(e,t){gq(t)&&(this.bufferTransform=new sq(e,t)),mq(t)&&(this.textureTransform=new pq(e,t)),Xi(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of r)t=Object.assign(t,n.getDrawOptions(t));return t}}function gq(i){return!!(!$p(i.feedbackBuffers)||!$p(i.feedbackMap)||i.varyings&&i.varyings.length>0)}function mq(i){return!!(!$p(i._sourceTextures)||i._targetTexture||i._targetTextureVarying)}const DL={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class fy{static get DRAW_MODE(){return DL}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t=xA("geometry"),drawMode:r=DL.TRIANGLES,attributes:n={},indices:o=null,vertexCount:l=null}=e;this.id=t,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(n,o),this.vertexCount=l||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(const r in e){let n=e[r];n=ArrayBuffer.isView(n)?{value:n}:n,Xi(ArrayBuffer.isView(n.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!n.size&&(n.size=3),r==="indices"?(Xi(!this.indices),this.indices=n):this.attributes[r]=n}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const n in e){const o=e[n],{value:l,size:s,constant:g}=o;!g&&l&&s>=1&&(r=Math.min(r,l.length/s))}return Xi(Number.isFinite(r)),r}}let yq=1,_q=1;class RL{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:n=1,repeat:o=1}=e,l=yq++,s={time:0,delay:t,duration:r,rate:n,repeat:o};return this._setChannelTime(s,this.time),this.channels.set(l,s),l}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const n of t)this._setChannelTime(n,this.time);const r=this.animations.values();for(const n of r){const{animation:o,channel:l}=n;o.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=_q++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,n=e.duration*e.repeat;r>=n?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const vq=[255,255,255],bq=1;let xq=0;class kL{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id",void 0),ye(this,"color",void 0),ye(this,"intensity",void 0),ye(this,"type","ambient");const{color:t=vq}=e,{intensity:r=bq}=e;this.id=e.id||"ambient-".concat(xq++),this.color=t,this.intensity=r}}const wq=[255,255,255],Bq=1,Cq=[0,0,-1];let Eq=0;class OL{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id",void 0),ye(this,"color",void 0),ye(this,"intensity",void 0),ye(this,"type","directional"),ye(this,"direction",void 0),ye(this,"shadow",void 0);const{color:t=wq}=e,{intensity:r=Bq}=e,{direction:n=Cq}=e,{_shadow:o=!1}=e;this.id=e.id||"directional-".concat(Eq++),this.color=t,this.intensity=r,this.type="directional",this.direction=new Ut(n).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class Sq{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};ye(this,"id",void 0),ye(this,"gl",void 0),ye(this,"props",void 0);const{id:r}=t;this.id=r,this.gl=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class F2 extends Sq{constructor(){super(...arguments),ye(this,"_lastRenderIndex",-1)}render(e){const t=this.gl;return bA(t,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:t,moduleParameters:r,viewports:n,views:o,onViewportActive:l,clearStack:s=!0,clearCanvas:g=!0}=e;e.pass=e.pass||"unknown";const b=this.gl;g&&Iq(b,t),s&&(this._lastRenderIndex=-1);const T=[];for(const F of n){const k=o&&o[F.id];l==null||l(F);const z=this._getDrawLayerParams(F,e),J=F.subViewports||[F];for(const te of J){const ue=this._drawLayersInViewport(b,{target:t,moduleParameters:r,viewport:te,view:k,pass:e.pass,layers:e.layers},z);T.push(ue)}}return T}_getDrawLayerParams(e,t){let{layers:r,pass:n,isPicking:o=!1,layerFilter:l,cullRect:s,effects:g,moduleParameters:b}=t,T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const F=[],k=UL(this._lastRenderIndex+1),z={layer:r[0],viewport:e,isPicking:o,renderPass:n,cullRect:s},J={};for(let te=0;te<r.length;te++){const ue=r[te],ce=this._shouldDrawLayer(ue,z,l,J),de={shouldDrawLayer:ce};ce&&!T&&(de.layerRenderIndex=k(ue,ce),de.moduleParameters=this._getModuleParameters(ue,g,n,b),de.layerParameters=this.getLayerParameters(ue,te,e)),F[te]=de}return F}_drawLayersInViewport(e,t,r){let{layers:n,moduleParameters:o,pass:l,target:s,viewport:g,view:b}=t;const T=Tq(e,{moduleParameters:o,target:s,viewport:g});if(b&&b.props.clear){const k=b.props.clear===!0?{color:!0,depth:!0}:b.props.clear;Ju(e,{scissorTest:!0,scissor:T},()=>e2(e,k))}const F={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};bA(e,{viewport:T});for(let k=0;k<n.length;k++){const z=n[k],{shouldDrawLayer:J,layerRenderIndex:te,moduleParameters:ue,layerParameters:ce}=r[k];if(J&&z.props.pickable&&F.pickableCount++,z.isComposite)F.compositeCount++;else if(J){F.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,te),ue.viewport=g;try{z._drawLayer({moduleParameters:ue,uniforms:{layerIndex:te},parameters:ce})}catch(de){z.raiseError(de,"drawing ".concat(z," to ").concat(l))}}}return F}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,n){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(t))return!1;t.layer=l,l=l.parent}if(r){const s=t.layer.id;if(s in n||(n[s]=r(t)),!n[s])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,r,n){var o;const l=Object.assign(Object.create(((o=e.internalState)===null||o===void 0?void 0:o.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:qp(this.gl)});if(t)for(const g of t){var s;Object.assign(l,(s=g.getModuleParameters)===null||s===void 0?void 0:s.call(g,e))}return Object.assign(l,this.getModuleParameters(e,t),n)}}function UL(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t={},r=(n,o)=>{const l=n.props._offset,s=n.id,g=n.parent&&n.parent.id;let b;if(g&&!(g in e)&&r(n.parent,!1),g in t){const T=t[g]=t[g]||UL(e[g],e);b=T(n,o),t[s]=T}else Number.isFinite(l)?(b=l+(e[g]||0),t[s]=null):b=i;return o&&b>=i&&(i=b+1),e[s]=b,b};return r}function Tq(i,e){let{moduleParameters:t,target:r,viewport:n}=e;const o=r&&r.id!=="default-framebuffer",l=t&&t.devicePixelRatio||qp(i),s=o?r.height:i.drawingBufferHeight,g=n;return[g.x*l,s-(g.y+g.height)*l,g.width*l,g.height*l]}function Iq(i,e){const t=e?e.width:i.drawingBufferWidth,r=e?e.height:i.drawingBufferHeight;bA(i,{viewport:[0,0,t,r]}),i.clear(16640)}class Lq extends F2{constructor(e,t){super(e,t),ye(this,"shadowMap",void 0),ye(this,"depthBuffer",void 0),ye(this,"fbo",void 0),this.shadowMap=new Xc(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new Xp(e,{format:33189,width:1,height:1}),this.fbo=new ba(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const t=this.fbo;Ju(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],n=qp(this.gl),o=r.width*n,l=r.height*n;(o!==t.width||l!==t.height)&&t.resize({width:o,height:l}),super.render({...e,target:t,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const NL="#define SMOOTH_EDGE_RADIUS 0.5",Mq=`
`.concat(NL,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),Pq=`
`.concat(NL,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),Fq={name:"geometry",vs:Mq,fs:Pq},Dq=Object.keys(Ln).map(i=>"const int COORDINATE_SYSTEM_".concat(i," = ").concat(Ln[i],";")).join(""),Rq=Object.keys(Uh).map(i=>"const int PROJECTION_MODE_".concat(i," = ").concat(Uh[i],";")).join(""),kq=Object.keys(Qw).map(i=>"const int UNIT_".concat(i.toUpperCase()," = ").concat(Qw[i],";")).join(""),Oq="".concat(Dq,`
`).concat(Rq,`
`).concat(kq,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function Uq(i,e){if(i===e)return!0;if(Array.isArray(i)){const t=i.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(i[r]!==e[r])return!1;return!0}return!1}function py(i){let e={},t;return r=>{for(const n in r)if(!Uq(r[n],e[n])){t=i(r),e=r;break}return t}}const zL=[0,0,0,0],Nq=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],QL=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],zq=[0,0,0],VL=[0,0,0],Qq=py(Gq);function HL(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:VL;t.length<3&&(t=[t[0],t[1],0]);let r=t,n,o=!0;switch(e===Ln.LNGLAT_OFFSETS||e===Ln.METER_OFFSETS?n=t:n=i.isGeospatial?[Math.fround(i.longitude),Math.fround(i.latitude),0]:null,i.projectionMode){case Uh.WEB_MERCATOR:(e===Ln.LNGLAT||e===Ln.CARTESIAN)&&(n=[0,0,0],o=!1);break;case Uh.WEB_MERCATOR_AUTO_OFFSET:e===Ln.LNGLAT?r=n:e===Ln.CARTESIAN&&(r=[Math.fround(i.center[0]),Math.fround(i.center[1]),0],n=i.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case Uh.IDENTITY:r=i.position.map(Math.fround),r[2]=r[2]||0;break;case Uh.GLOBE:o=!1,n=null;break;default:o=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:r,offsetMode:o}}function Vq(i,e,t){const{viewMatrixUncentered:r,projectionMatrix:n}=i;let{viewMatrix:o,viewProjectionMatrix:l}=i,s=zL,g=zL,b=i.cameraPosition;const{geospatialOrigin:T,shaderCoordinateOrigin:F,offsetMode:k}=HL(i,e,t);return k&&(g=i.projectPosition(T||F),b=[b[0]-g[0],b[1]-g[1],b[2]-g[2]],g[3]=1,s=uy([],g,l),o=r||o,l=_f([],n,o),l=_f([],l,Nq)),{viewMatrix:o,viewProjectionMatrix:l,projectionCenter:s,originCommon:g,cameraPosCommon:b,shaderCoordinateOrigin:F,geospatialOrigin:T}}function Hq(i){let{viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:n=Ln.DEFAULT,coordinateOrigin:o=VL,autoWrapLongitude:l=!1}=i;n===Ln.DEFAULT&&(n=e.isGeospatial?Ln.LNGLAT:Ln.CARTESIAN);const s=Qq({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:o});return s.project_uWrapLongitude=l,s.project_uModelMatrix=r||QL,s}function Gq(i){let{viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:n}=i;const{projectionCenter:o,viewProjectionMatrix:l,originCommon:s,cameraPosCommon:g,shaderCoordinateOrigin:b,geospatialOrigin:T}=Vq(e,r,n),F=e.getDistanceScales(),k=[e.width*t,e.height*t],z=uy([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,J={project_uCoordinateSystem:r,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:b,project_uCommonOrigin:s.slice(0,3),project_uCenter:o,project_uPseudoMeters:!!e._pseudoMeters,project_uViewportSize:k,project_uDevicePixelRatio:t,project_uFocalDistance:z,project_uCommonUnitsPerMeter:F.unitsPerMeter,project_uCommonUnitsPerWorldUnit:F.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:zq,project_uScale:e.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:l,project_uModelMatrix:QL,project_uCameraPosition:g};if(T){const te=e.getDistanceScales(T);switch(r){case Ln.METER_OFFSETS:J.project_uCommonUnitsPerWorldUnit=te.unitsPerMeter,J.project_uCommonUnitsPerWorldUnit2=te.unitsPerMeter2;break;case Ln.LNGLAT:case Ln.LNGLAT_OFFSETS:e._pseudoMeters||(J.project_uCommonUnitsPerMeter=te.unitsPerMeter),J.project_uCommonUnitsPerWorldUnit=te.unitsPerDegree,J.project_uCommonUnitsPerWorldUnit2=te.unitsPerDegree2;break;case Ln.CARTESIAN:J.project_uCommonUnitsPerWorldUnit=[1,1,te.unitsPerMeter[2]],J.project_uCommonUnitsPerWorldUnit2=[0,0,te.unitsPerMeter2[2]];break}}return J}const jq={};function qq(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:jq;return"viewport"in i?Hq(i):{}}const D2={name:"project",dependencies:[yG,Fq],vs:Oq,getUniforms:qq};function $q(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function eg(i,e){const t=uy([],e,i);return bL(t,t,1/t[3]),t}function jL(i,e){const t=i%e;return t<0?e+t:t}function R2(i,e,t){return i<e?e:i>t?t:i}function Kq(i){return Math.log(i)*Math.LOG2E}const k2=Math.log2||Kq;function SA(i,e){if(!i)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const ih=Math.PI,qL=ih/4,Bu=ih/180,O2=180/ih,tg=512,f1=4003e4,p1=85.051129,Wq=1.5;function Xq(i){return k2(i)}function gy(i){const[e,t]=i;SA(Number.isFinite(e)),SA(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*Bu,n=t*Bu,o=tg*(r+ih)/(2*ih),l=tg*(ih+Math.log(Math.tan(qL+n*.5)))/(2*ih);return[o,l]}function ig(i){const[e,t]=i,r=e/tg*(2*ih)-ih,n=2*(Math.atan(Math.exp(t/tg*(2*ih)-ih))-qL);return[r*O2,n*O2]}function Zq(i){const{latitude:e}=i;SA(Number.isFinite(e));const t=Math.cos(e*Bu);return Xq(f1*t)-9}function g1(i){const e=Math.cos(i*Bu);return tg/f1/e}function U2(i){const{latitude:e,longitude:t,highPrecision:r=!1}=i;SA(Number.isFinite(e)&&Number.isFinite(t));const n=tg,o=Math.cos(e*Bu),l=n/360,s=l/o,g=n/f1/o,b={unitsPerMeter:[g,g,g],metersPerUnit:[1/g,1/g,1/g],unitsPerDegree:[l,s,g],degreesPerUnit:[1/l,1/s,1/g]};if(r){const T=Bu*Math.tan(e*Bu)/o,F=l*T/2,k=n/f1*T,z=k/s*g;b.unitsPerDegree2=[0,F,k],b.unitsPerMeter2=[z,0,z]}return b}function $L(i,e){const[t,r,n]=i,[o,l,s]=e,{unitsPerMeter:g,unitsPerMeter2:b}=U2({longitude:t,latitude:r,highPrecision:!0}),T=gy(i);T[0]+=o*(g[0]+b[0]*l),T[1]+=l*(g[1]+b[1]*l);const F=ig(T),k=(n||0)+(s||0);return Number.isFinite(n)||Number.isFinite(s)?[F[0],F[1],k]:F}function Jq(i){const{height:e,pitch:t,bearing:r,altitude:n,scale:o,center:l}=i,s=$q();c1(s,s,[0,0,-n]),_L(s,s,-t*Bu),vL(s,s,r*Bu);const g=o/e;return C2(s,s,[g,g,g]),l&&c1(s,s,kG([],l)),s}function Yq(i){const{width:e,height:t,altitude:r,pitch:n=0,offset:o,center:l,scale:s,nearZMultiplier:g=1,farZMultiplier:b=1}=i;let{fovy:T=m1(Wq)}=i;r!==void 0&&(T=m1(r));const F=T*Bu,k=n*Bu,z=KL(T);let J=z;l&&(J+=l[2]*s/Math.cos(k)/t);const te=F*(.5+(o?o[1]:0)/t),ue=Math.sin(te)*J/Math.sin(R2(Math.PI/2-k-te,.01,Math.PI-.01)),ce=Math.sin(k)*ue+J,de=J*10,_e=Math.min(ce*b,de);return{fov:F,aspect:e/t,focalDistance:z,near:g,far:_e}}function m1(i){return 2*Math.atan(.5/i)*O2}function KL(i){return .5/Math.tan(.5*i*Bu)}function WL(i,e){const[t,r,n=0]=i;return SA(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(n)),eg(e,[t,r,n,1])}function N2(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[r,n,o]=i;if(SA(Number.isFinite(r)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(o))return eg(e,[r,n,o,1]);const l=eg(e,[r,n,0,1]),s=eg(e,[r,n,1,1]),g=l[2],b=s[2],T=g===b?0:((t||0)-g)/(b-g);return sL([],l,s,T)}function e$(i){const{width:e,height:t,bounds:r,minExtent:n=0,maxZoom:o=24,offset:l=[0,0]}=i,[[s,g],[b,T]]=r,F=t$(i.padding),k=gy([s,R2(T,-p1,p1)]),z=gy([b,R2(g,-p1,p1)]),J=[Math.max(Math.abs(z[0]-k[0]),n),Math.max(Math.abs(z[1]-k[1]),n)],te=[e-F.left-F.right-Math.abs(l[0])*2,t-F.top-F.bottom-Math.abs(l[1])*2];SA(te[0]>0&&te[1]>0);const ue=te[0]/J[0],ce=te[1]/J[1],de=(F.right-F.left)/2/ue,_e=(F.top-F.bottom)/2/ce,Ee=[(z[0]+k[0])/2+de,(z[1]+k[1])/2+_e],He=ig(Ee),Ve=Math.min(o,k2(Math.abs(Math.min(ue,ce))));return SA(Number.isFinite(Ve)),{longitude:He[0],latitude:He[1],zoom:Ve}}function t$(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof i=="number"?{top:i,bottom:i,left:i,right:i}:(SA(Number.isFinite(i.top)&&Number.isFinite(i.bottom)&&Number.isFinite(i.left)&&Number.isFinite(i.right)),i)}const XL=Math.PI/180;function i$(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:t,height:r,unproject:n}=i,o={targetZ:e},l=n([0,r],o),s=n([t,r],o);let g,b;const T=i.fovy?.5*i.fovy*XL:Math.atan(.5/i.altitude),F=(90-i.pitch)*XL;return T>F-.01?(g=ZL(i,0,e),b=ZL(i,t,e)):(g=n([0,0],o),b=n([t,0],o)),[l,s,b,g]}function ZL(i,e,t){const{pixelUnprojectionMatrix:r}=i,n=eg(r,[e,0,1,1]),o=eg(r,[e,i.height,1,1]),s=(t*i.distanceScales.unitsPerMeter[2]-n[2])/(o[2]-n[2]),g=sL([],n,o,s),b=ig(g);return b.push(t),b}const JL=512;function r$(i){const{width:e,height:t,pitch:r=0}=i;let{longitude:n,latitude:o,zoom:l,bearing:s=0}=i;(n<-180||n>180)&&(n=jL(n+180,360)-180),(s<-180||s>180)&&(s=jL(s+180,360)-180);const g=k2(t/JL);if(l<=g)l=g,o=0;else{const b=t/2/Math.pow(2,l),T=ig([0,b])[1];if(o<T)o=T;else{const F=ig([0,JL-b])[1];o>F&&(o=F)}}return{width:e,height:t,longitude:n,latitude:o,zoom:l,pitch:r,bearing:s}}const n$=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,s$=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,o$=py(h$),a$=py(A$),l$=[0,0,0,1],c$=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function u$(i,e){const[t,r,n]=i,o=N2([t,r,n],e);return Number.isFinite(n)?o:[o[0],o[1],0]}function h$(i){let{viewport:e,center:t}=i;return new Bn(e.viewProjectionMatrix).invert().transform(t)}function A$(i){let{viewport:e,shadowMatrices:t}=i;const r=[],n=e.pixelUnprojectionMatrix,o=e.isGeospatial?void 0:1,l=[[0,0,o],[e.width,0,o],[0,e.height,o],[e.width,e.height,o],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(s=>u$(s,n));for(const s of t){const g=s.clone().translate(new Ut(e.center).negate()),b=l.map(F=>g.transform(F)),T=new Bn().ortho({left:Math.min(...b.map(F=>F[0])),right:Math.max(...b.map(F=>F[0])),bottom:Math.min(...b.map(F=>F[1])),top:Math.max(...b.map(F=>F[1])),near:Math.min(...b.map(F=>-F[2])),far:Math.max(...b.map(F=>-F[2]))});r.push(T.multiplyRight(s))}return r}function d$(i,e){const{shadowEnabled:t=!0}=i;if(!t||!i.shadowMatrices||!i.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!i.drawToShadowMap,shadow_uUseShadowMap:i.shadowMaps?i.shadowMaps.length>0:!1,shadow_uColor:i.shadowColor||l$,shadow_uLightId:i.shadowLightId||0,shadow_uLightCount:i.shadowMatrices.length},n=o$({viewport:i.viewport,center:e.project_uCenter}),o=[],l=a$({shadowMatrices:i.shadowMatrices,viewport:i.viewport}).slice();for(let s=0;s<i.shadowMatrices.length;s++){const g=l[s],b=g.clone().translate(new Ut(i.viewport.center).negate());e.project_uCoordinateSystem===Ln.LNGLAT&&e.project_uProjectionMode===Uh.WEB_MERCATOR?(l[s]=b,o[s]=n):(l[s]=g.clone().multiplyRight(c$),o[s]=b.transform(n))}for(let s=0;s<l.length;s++)r["shadow_uViewProjectionMatrices[".concat(s,"]")]=l[s],r["shadow_uProjectCenters[".concat(s,"]")]=o[s],i.shadowMaps&&i.shadowMaps.length>0?r["shadow_uShadowMap".concat(s)]=i.shadowMaps[s]:r["shadow_uShadowMap".concat(s)]=i.dummyShadowMap;return r}const z2={name:"shadow",dependencies:[D2],vs:n$,fs:s$,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in i&&(i.drawToShadowMap||i.shadowMaps&&i.shadowMaps.length>0)?d$(i,e):{}}},f$={color:[255,255,255],intensity:1},YL=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],p$=[0,0,0,200/255];class Q2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id","lighting-effect"),ye(this,"props",void 0),ye(this,"shadowColor",p$),ye(this,"shadow",void 0),ye(this,"ambientLight",void 0),ye(this,"directionalLights",void 0),ye(this,"pointLights",void 0),ye(this,"shadowPasses",[]),ye(this,"shadowMaps",[]),ye(this,"dummyShadowMap",null),ye(this,"programManager",void 0),ye(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.props=e}preRender(e,t){let{layers:r,layerFilter:n,viewports:o,onViewportActive:l,views:s}=t;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=dy.getDefaultProgramManager(e),z2&&this.programManager.addDefaultModule(z2)),this.dummyShadowMap||(this.dummyShadowMap=new Xc(e,{width:1,height:1}));for(let g=0;g<this.shadowPasses.length;g++)this.shadowPasses[g].render({layers:r,layerFilter:n,viewports:o,onViewportActive:l,views:s,moduleParameters:{shadowLightId:g,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},t}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(z2),this.programManager=null)}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new Bn().lookAt({eye:new Ut(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new Lq(e);this.shadowPasses[t]=r,this.shadowMaps[t]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new kL(f$),this.directionalLights.push(new OL(YL[0]),new OL(YL[1])))}}class g${constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"_pool",[]),ye(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,r){let{size:n=1,type:o,padding:l=0,copy:s=!1,initialize:g=!1,maxCount:b}=r;const T=o||e&&e.constructor||Float32Array,F=t*n+l;if(ArrayBuffer.isView(e)){if(F<=e.length)return e;if(F*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new T(e.buffer,0,F)}let k=1/0;b&&(k=b*n+l);const z=this._allocate(T,F,g,k);return e&&s?z.set(e):g||z.fill(0,0,4),this._release(e),z}release(e){this._release(e)}_allocate(e,t,r,n){let o=Math.max(Math.ceil(t*this.opts.overAlloc),1);o>n&&(o=n);const l=this._pool,s=e.BYTES_PER_ELEMENT*o,g=l.findIndex(b=>b.byteLength>=s);if(g>=0){const b=new e(l.splice(g,1)[0],0,o);return r&&b.fill(0),b}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:n}=r,o=t.findIndex(l=>l.byteLength>=n);o<0?t.push(r):(o>0||t.length<this.opts.poolSize)&&t.splice(o,0,r),t.length>this.opts.poolSize&&t.shift()}}const my=new g$;function yy(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function m$(i){return[i[12],i[13],i[14]]}function y$(i){return{left:rg(i[3]+i[0],i[7]+i[4],i[11]+i[8],i[15]+i[12]),right:rg(i[3]-i[0],i[7]-i[4],i[11]-i[8],i[15]-i[12]),bottom:rg(i[3]+i[1],i[7]+i[5],i[11]+i[9],i[15]+i[13]),top:rg(i[3]-i[1],i[7]-i[5],i[11]-i[9],i[15]-i[13]),near:rg(i[3]+i[2],i[7]+i[6],i[11]+i[10],i[15]+i[14]),far:rg(i[3]-i[2],i[7]-i[6],i[11]-i[10],i[15]-i[14])}}const eM=new Ut;function rg(i,e,t,r){eM.set(i,e,t);const n=eM.len();return{distance:r/n,normal:new Ut(-i/n,-e/n,-t/n)}}function _$(i){return i-Math.fround(i)}let _y;function V2(i,e){const{size:t=1,startIndex:r=0}=e,n=e.endIndex!==void 0?e.endIndex:i.length,o=(n-r)/t;_y=my.allocate(_y,o,{type:Float32Array,size:t*2});let l=r,s=0;for(;l<n;){for(let g=0;g<t;g++){const b=i[l++];_y[s+g]=b,_y[s+g+t]=_$(b)}s+=t*2}return _y.subarray(0,o*t*2)}function v$(i){let e=null,t=!1;for(const r of i)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const b$=Math.PI/180,x$=yy(),tM=[0,0,0],w$={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function B$(i){let{width:e,height:t,orthographic:r,fovyRadians:n,focalDistance:o,padding:l,near:s,far:g}=i;const b=e/t,T=r?new Bn().orthographic({fovy:n,aspect:b,focalDistance:o,near:s,far:g}):new Bn().perspective({fovy:n,aspect:b,near:s,far:g});if(l){const{left:F=0,right:k=0,top:z=0,bottom:J=0}=l,te=EA((F+e-k)/2,0,e)-e/2,ue=EA((z+t-J)/2,0,t)-t/2;T[8]-=te*2/e,T[9]+=ue*2/t}return T}class ng{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id",void 0),ye(this,"x",void 0),ye(this,"y",void 0),ye(this,"width",void 0),ye(this,"height",void 0),ye(this,"padding",void 0),ye(this,"isGeospatial",void 0),ye(this,"zoom",void 0),ye(this,"focalDistance",void 0),ye(this,"position",void 0),ye(this,"modelMatrix",void 0),ye(this,"distanceScales",void 0),ye(this,"scale",void 0),ye(this,"center",void 0),ye(this,"cameraPosition",void 0),ye(this,"projectionMatrix",void 0),ye(this,"viewMatrix",void 0),ye(this,"viewMatrixUncentered",void 0),ye(this,"viewMatrixInverse",void 0),ye(this,"viewProjectionMatrix",void 0),ye(this,"pixelProjectionMatrix",void 0),ye(this,"pixelUnprojectionMatrix",void 0),ye(this,"resolution",void 0),ye(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||w$,this.focalDistance=e.focalDistance||1,this.position=e.position||tM,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Uh.WEB_MERCATOR:Uh.WEB_MERCATOR_AUTO_OFFSET:Uh.IDENTITY}equals(e){return e instanceof ng?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&eh(e.projectionMatrix,this.projectionMatrix)&&eh(e.viewMatrix,this.viewMatrix):!1}project(e){let{topLeft:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.projectPosition(e),n=WL(r,this.pixelProjectionMatrix),[o,l]=n,s=t?l:this.height-l;return e.length===2?[o,s]:[o,s,n[2]]}unproject(e){let{topLeft:t=!0,targetZ:r}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[n,o,l]=e,s=t?o:this.height-o,g=r&&r*this.distanceScales.unitsPerMeter[2],b=N2([n,s,l],this.pixelUnprojectionMatrix,g),[T,F,k]=this.unprojectPosition(b);return Number.isFinite(l)?[T,F,k]:Number.isFinite(r)?[T,F,r]:[T,F]}projectPosition(e){const[t,r]=this.projectFlat(e),n=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,n]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),n=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,n]}projectFlat(e){if(this.isGeospatial){const t=gy(e);return t[1]=EA(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?ig(e):e}getBounds(){const t={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},r=this.unproject([0,0],t),n=this.unproject([this.width,0],t),o=this.unproject([0,this.height],t),l=this.unproject([this.width,this.height],t);return[Math.min(r[0],n[0],o[0],l[0]),Math.min(r[1],n[1],o[1],l[1]),Math.max(r[0],n[0],o[0],l[0]),Math.max(r[1],n[1],o[1],l[1])]}getDistanceScales(e){return e?U2({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel(e){let{x:t,y:r,width:n=1,height:o=1}=e;return t<this.x+this.width&&this.x<t+n&&r<this.y+this.height&&this.y<r+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,y$(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=Zq({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||U2({latitude:r,longitude:t}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:o,modelMatrix:l}=e;let s=tM;if(o&&(s=l?new Bn(l).transformAsVector(o,[]):o),this.isGeospatial){const g=this.projectPosition([t,r,0]);this.center=new Ut(s).scale(this.distanceScales.unitsPerMeter).add(g)}else this.center=this.projectPosition(s)}_initMatrices(e){const{viewMatrix:t=x$,projectionMatrix:r=null,orthographic:n=!1,fovyRadians:o,fovy:l=75,near:s=.1,far:g=1e3,padding:b=null,focalDistance:T=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Bn().multiplyRight(t).translate(new Ut(this.center).negate()),this.projectionMatrix=r||B$({width:this.width,height:this.height,orthographic:n,fovyRadians:o||l*b$,focalDistance:T,padding:b,near:s,far:g});const F=yy();_f(F,F,this.projectionMatrix),_f(F,F,this.viewMatrix),this.viewProjectionMatrix=F,this.viewMatrixInverse=B2([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=m$(this.viewMatrixInverse);const k=yy(),z=yy();C2(k,k,[this.width/2,-this.height/2,1]),c1(k,k,[1,-1,0]),_f(z,k,this.viewProjectionMatrix),this.pixelProjectionMatrix=z,this.pixelUnprojectionMatrix=B2(yy(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Dn.warn("Pixel project matrix not invertible")()}}ye(ng,"displayName","Viewport");class vf extends ng{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:t=0,longitude:r=0,zoom:n=0,pitch:o=0,bearing:l=0,nearZMultiplier:s=.1,farZMultiplier:g=1.01,nearZ:b,farZ:T,orthographic:F=!1,projectionMatrix:k,repeat:z=!1,worldOffset:J=0,position:te,padding:ue,legacyMeterSizes:ce=!1}=e;let{width:de,height:_e,altitude:Ee=1.5}=e;const He=Math.pow(2,n);de=de||1,_e=_e||1;let Ve,qe=null;if(k)Ee=k[5]/2,Ve=m1(Ee);else{e.fovy?(Ve=e.fovy,Ee=KL(Ve)):Ve=m1(Ee);let ot;if(ue){const{top:it=0,bottom:De=0}=ue;ot=[0,EA((it+_e-De)/2,0,_e)-_e/2]}qe=Yq({width:de,height:_e,scale:He,center:te&&[0,0,te[2]*g1(t)],offset:ot,pitch:o,fovy:Ve,nearZMultiplier:s,farZMultiplier:g}),Number.isFinite(b)&&(qe.near=b),Number.isFinite(T)&&(qe.far=T)}let Ue=Jq({height:_e,pitch:o,bearing:l,scale:He,altitude:Ee});J&&(Ue=new Bn().translate([512*J,0,0]).multiplyLeft(Ue)),super({...e,width:de,height:_e,viewMatrix:Ue,longitude:r,latitude:t,zoom:n,...qe,fovy:Ve,focalDistance:Ee}),ye(this,"longitude",void 0),ye(this,"latitude",void 0),ye(this,"pitch",void 0),ye(this,"bearing",void 0),ye(this,"altitude",void 0),ye(this,"fovy",void 0),ye(this,"orthographic",void 0),ye(this,"_subViewports",void 0),ye(this,"_pseudoMeters",void 0),this.latitude=t,this.longitude=r,this.zoom=n,this.pitch=o,this.bearing=l,this.altitude=Ee,this.fovy=Ve,this.orthographic=F,this._subViewports=z?[]:null,this._pseudoMeters=ce,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let n=t;n<=r;n++){const o=n?new vf({...this,worldOffset:n}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),n=(e[2]||0)*g1(e[1]);return[t,r,n]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),n=(e[2]||0)/g1(r);return[t,r,n]}addMetersToLngLat(e,t){return $L(e,t)}panByPosition(e,t){const r=N2(t,this.pixelUnprojectionMatrix),n=this.projectFlat(e),o=nL([],n,LG([],r)),l=nL([],this.center,o),[s,g]=this.unprojectFlat(l);return{longitude:s,latitude:g}}getBounds(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=i$(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:r,height:n}=this,{longitude:o,latitude:l,zoom:s}=e$({width:r,height:n,bounds:e,...t});return new vf({width:r,height:n,longitude:o,latitude:l,zoom:s})}}ye(vf,"displayName","WebMercatorViewport");const iM=[0,0,0];function H2(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=e.projectPosition(i);if(t&&e instanceof vf){const[n,o,l=0]=i,s=e.getDistanceScales([n,o]);r[2]=l*s.unitsPerMeter[2]}return r}function C$(i){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=i;let{coordinateSystem:n,fromCoordinateSystem:o,fromCoordinateOrigin:l}=i;return n===Ln.DEFAULT&&(n=e.isGeospatial?Ln.LNGLAT:Ln.CARTESIAN),o===void 0&&(o=n),l===void 0&&(l=r),{viewport:e,coordinateSystem:n,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:o,fromCoordinateOrigin:l}}function rM(i,e){let{viewport:t,modelMatrix:r,coordinateSystem:n,coordinateOrigin:o,offsetMode:l}=e,[s,g,b=0]=i;switch(r&&([s,g,b]=uy([],[s,g,b,1],r)),n){case Ln.LNGLAT:return H2([s,g,b],t,l);case Ln.LNGLAT_OFFSETS:return H2([s+o[0],g+o[1],b+(o[2]||0)],t,l);case Ln.METER_OFFSETS:return H2($L(o,[s,g,b]),t,l);case Ln.CARTESIAN:default:return t.isGeospatial?[s+o[0],g+o[1],b+o[2]]:t.projectPosition([s,g,b])}}function E$(i,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:n,modelMatrix:o,fromCoordinateSystem:l,fromCoordinateOrigin:s}=C$(e),{autoOffset:g=!0}=e,{geospatialOrigin:b=iM,shaderCoordinateOrigin:T=iM,offsetMode:F=!1}=g?HL(t,r,n):{},k=rM(i,{viewport:t,modelMatrix:o,coordinateSystem:l,coordinateOrigin:s,offsetMode:F});if(F){const z=t.projectPosition(b||T);VG(k,k,z)}return k}const nM={blendFunc:[1,0,32771,0],blendEquation:32774};class sM extends F2{constructor(){super(...arguments),ye(this,"pickZ",void 0),ye(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer(e){let{layers:t,layerFilter:r,views:n,viewports:o,onViewportActive:l,pickingFBO:s,deviceRect:{x:g,y:b,width:T,height:F},cullRect:k,effects:z,pass:J="picking",pickZ:te,moduleParameters:ue}=e;const ce=this.gl;this.pickZ=te;const de=this._resetColorEncoder(te),_e=Ju(ce,{scissorTest:!0,scissor:[g,b,T,F],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...nM,blend:!te},()=>super.render({target:s,layers:t,layerFilter:r,views:n,viewports:o,onViewportActive:l,cullRect:k,effects:z==null?void 0:z.filter(He=>He.useInPicking),pass:J,isPicking:!0,moduleParameters:ue}));return this._colorEncoderState=null,{decodePickingColor:de&&T$.bind(null,de),stats:_e}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,t,r){const n={...e.props.parameters},{pickable:o,operation:l}=e.props;return this._colorEncoderState?o&&l.includes("draw")&&(Object.assign(n,nM),n.blend=!0,n.blendColor=S$(this._colorEncoderState,e,r)):n.blend=!1,l.includes("terrain")&&(n.blend=!1),n}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function S$(i,e,t){const{byLayer:r,byAlpha:n}=i;let o,l=r.get(e);return l?(l.viewports.push(t),o=l.a):(o=r.size+1,o<=255?(l={a:o,layer:e,viewports:[t]},r.set(e,l),n[o]=l):(Dn.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function T$(i,e){const t=i.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const sg={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},y1=Symbol.for("component"),ld=Symbol.for("propTypes"),G2=Symbol.for("deprecatedProps"),og=Symbol.for("asyncPropDefaults"),bf=Symbol.for("asyncPropOriginal"),cd=Symbol.for("asyncPropResolved");function _1(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(i)?oM(i,e,[]):e(i)?[i]:[]}function oM(i,e,t){let r=-1;for(;++r<i.length;){const n=i[r];Array.isArray(n)?oM(n,e,t):e(n)&&t.push(n)}return t}function I$(i){let{target:e,source:t,start:r=0,count:n=1}=i;const o=t.length,l=n*o;let s=0;for(let g=r;s<o;s++)e[g++]=t[s];for(;s<l;)s<l-s?(e.copyWithin(r+s,r,r+s),s*=2):(e.copyWithin(r+s,r,r+l-s),s=l);return e}class L${constructor(e,t,r){ye(this,"id",void 0),ye(this,"context",void 0),ye(this,"isLoaded",void 0),ye(this,"persistent",void 0),ye(this,"_loadCount",0),ye(this,"_subscribers",new Set),ye(this,"_data",void 0),ye(this,"_loader",void 0),ye(this,"_error",void 0),ye(this,"_content",void 0),this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let n=e;typeof e=="string"&&(n=id(e)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===r&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class M${constructor(e){let{gl:t,protocol:r}=e;ye(this,"protocol",void 0),ye(this,"_context",void 0),ye(this,"_resources",void 0),ye(this,"_consumers",void 0),ye(this,"_pruneRequest",void 0),this.protocol=r||"resource://",this._context={gl:t,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add(e){let{resourceId:t,data:r,forceUpdate:n=!1,persistent:o=!0}=e,l=this._resources[t];l?l.setData(r,n):(l=new L$(t,r,this._context),this._resources[t]=l),l.persistent=o}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe(e){let{consumerId:t}=e;const r=this._consumers[t];if(r){for(const n in r){const o=r[n],l=this._resources[o.resourceId];l&&l.unsubscribe(o)}delete this._consumers[t],this.prune()}}subscribe(e){let{resourceId:t,onChange:r,consumerId:n,requestId:o="default"}=e;const{_resources:l,protocol:s}=this;t.startsWith(s)&&(t=t.replace(s,""),l[t]||this.add({resourceId:t,data:null,persistent:!1}));const g=l[t];if(this._track(n,o,g,r),g)return g.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,n){const o=this._consumers,l=o[e]=o[e]||{},s=l[t]||{},g=s.resourceId&&this._resources[s.resourceId];g&&(g.unsubscribe(s),this.prune()),r&&(l[t]=s,s.onChange=n,s.resourceId=r.id,r.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const j2={name:"project32",dependencies:[D2],vs:`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`},q2={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...qj},P$=[D2],F$=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function D$(i){const e=dy.getDefaultProgramManager(i);for(const t of P$)e.addDefaultModule(t);for(const t of F$)e.addShaderHook(t);return e}const R$="layerManager.setLayers",k$="layerManager.activateViewport";class O${constructor(e){let{deck:t,stats:r,viewport:n,timeline:o}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ye(this,"layers",void 0),ye(this,"context",void 0),ye(this,"resourceManager",void 0),ye(this,"_lastRenderedLayers",[]),ye(this,"_needsRedraw",!1),ye(this,"_needsUpdate",!1),ye(this,"_nextLayers",null),ye(this,"_debug",!1),ye(this,"activateViewport",l=>{El(k$,this,l),l&&(this.context.viewport=l)}),this.layers=[],this.resourceManager=new M$({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:t,programManager:e&&D$(e),stats:r||new $w({id:"deck.gl"}),viewport:n||new ng({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new RL,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const n=r.getNeedsRedraw(e);t=t||n}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers(){let{layerIds:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){El(R$,this,t,e),this._lastRenderedLayers=e;const r=_1(e,Boolean);for(const n of r)n.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,t,r){r.raiseError(t,"".concat(e," of ").concat(r))}_updateLayers(e,t){const r={};for(const l of e)r[l.id]?Dn.warn("Multiple old layers with same id ".concat(l.id))():r[l.id]=l;const n=[];this._updateSublayersRecursively(t,r,n),this._finalizeOldLayers(r);let o=!1;for(const l of n)if(l.hasUniformTransition()){o="Uniform transition in ".concat(l);break}this._needsUpdate=o,this.layers=n}_updateSublayersRecursively(e,t,r){for(const n of e){n.context=this.context;const o=t[n.id];o===null&&Dn.warn("Multiple new layers with same id ".concat(n.id))(),t[n.id]=null;let l=null;try{this._debug&&o!==n&&n.validateProps(),o?(this._transferLayerState(o,n),this._updateLayer(n)):this._initializeLayer(n),r.push(n),l=n.isComposite?n.getSubLayers():null}catch(s){this._handleError("matching",s,n)}l&&this._updateSublayersRecursively(l,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=sg.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=sg.MATCHED,t!==e&&(e.lifecycle=sg.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=sg.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=sg.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function zh(i,e,t){if(i===e)return!0;if(!t||!i||!e)return!1;if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!zh(i[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof i=="object"&&typeof e=="object"){const r=Object.keys(i),n=Object.keys(e);if(r.length!==n.length)return!1;for(const o of r)if(!e.hasOwnProperty(o)||!zh(i[o],e[o],t-1))return!1;return!0}return!1}class U${constructor(e){ye(this,"width",void 0),ye(this,"height",void 0),ye(this,"views",void 0),ye(this,"viewState",void 0),ye(this,"controllers",void 0),ye(this,"timeline",void 0),ye(this,"_viewports",void 0),ye(this,"_viewportMap",void 0),ye(this,"_isUpdating",void 0),ye(this,"_needsRedraw",void 0),ye(this,"_needsUpdate",void 0),ye(this,"_eventManager",void 0),ye(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),n={x:e[0],y:e[1]};for(let o=r.length-1;o>=0;--o){const l=r[o];if(l.containsPixel(n)){const s=e.slice();return s[0]-=l.x,s[1]-=l.y,l.unproject(s,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=_1(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!zh(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Dn.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,t){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...t,viewId:e})}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>{var l;return(l=this.getView(e.id))===null||l===void 0?void 0:l.makeViewport({viewState:o,width:this.width,height:this.height})}})}_updateController(e,t,r,n){const o=e.controller;if(o&&r){const l={...t,...o,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!n||n.constructor!==o.type)&&(n=this._createController(e,l)),n&&n.setProps(l),n}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let n=e.length;n--;){const o=e[n],l=this.getViewState(o),s=o.makeViewport({viewState:l,width:this.width,height:this.height});let g=t[o.id];const b=!!o.controller;b&&!g&&(r=!0),(r||!b)&&g&&(g.finalize(),g=null),this.controllers[o.id]=this._updateController(o,l,s,g),s&&this._viewports.unshift(s)}for(const n in t){const o=t[n];o&&!this.controllers[n]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,n)=>!e[n].equals(t[n]))}}const N$=/([0-9]+\.?[0-9]*)(%|px)/;function ud(i){switch(typeof i){case"number":return{position:i,relative:!1};case"string":const e=N$.exec(i);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error("Could not parse position string ".concat(i))}}function hd(i,e){return i.relative?Math.round(i.position*e):i.position}function sl(i,e){if(!i)throw new Error(e||"deck.gl: assertion failed.")}class z${constructor(e){ye(this,"id",void 0),ye(this,"viewportInstance",void 0),ye(this,"_x",void 0),ye(this,"_y",void 0),ye(this,"_width",void 0),ye(this,"_height",void 0),ye(this,"_padding",void 0),ye(this,"props",void 0);const{id:t,x:r=0,y:n=0,width:o="100%",height:l="100%",padding:s=null,viewportInstance:g}=e||{};sl(!g||g instanceof ng),this.viewportInstance=g,this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ud(r),this._y=ud(n),this._width=ud(o),this._height=ud(l),this._padding=s&&{left:ud(s.left||0),right:ud(s.right||0),top:ud(s.top||0),bottom:ud(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&zh(this.props,e.props,2)}makeViewport(e){let{width:t,height:r,viewState:n}=e;if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);const o=this.getDimensions({width:t,height:r});return!o.height||!o.width?null:new this.ViewportType({...n,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions(e){let{width:t,height:r}=e;const n={x:hd(this._x,t),y:hd(this._y,r),width:hd(this._width,t),height:hd(this._height,r)};return this._padding&&(n.padding={left:hd(this._padding.left,t),top:hd(this._padding.top,r),right:hd(this._padding.right,t),bottom:hd(this._padding.bottom,r)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class vy{constructor(e){ye(this,"_inProgress",void 0),ye(this,"_handle",void 0),ye(this,"_timeline",void 0),ye(this,"time",void 0),ye(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var t,r;this.cancel(),this.settings=e,this._inProgress=!0,(t=(r=this.settings).onStart)===null||t===void 0||t.call(r,this)}end(){if(this._inProgress){var e,t;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(t=this.settings).onEnd)===null||e===void 0||e.call(t,this)}}cancel(){if(this._inProgress){var e,t;(e=(t=this.settings).onInterrupt)===null||e===void 0||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:n}=this;this._handle=r.addChannel({delay:r.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(t=this.settings).onUpdate)===null||e===void 0||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const aM=()=>{},$2={BREAK:1,SNAP_TO_END:2,IGNORE:3},Q$=i=>i,V$=$2.BREAK;class H${constructor(e){ye(this,"getControllerState",void 0),ye(this,"props",void 0),ye(this,"propsInTransition",void 0),ye(this,"transition",void 0),ye(this,"onViewStateChange",void 0),ye(this,"onStateChange",void 0),ye(this,"_onTransitionUpdate",t=>{const{time:r,settings:{interpolator:n,startProps:o,endProps:l,duration:s,easing:g}}=t,b=g(r/s),T=n.interpolateProps(o,l,b);this.propsInTransition=this.getControllerState({...this.props,...T}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new vy(e.timeline),this.onViewStateChange=e.onViewStateChange||aM,this.onStateChange=e.onStateChange||aM}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let n=r;if(this.transition.inProgress){const{interruption:o,endProps:l}=this.transition.settings;n={...r,...o===$2.SNAP_TO_END?l:this.propsInTransition||r}}this._triggerTransition(n,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===$2.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),n=this.getControllerState(t).shortestPathFrom(r),o=t.transitionInterpolator,l=o.getDuration?o.getDuration(e,t):t.transitionDuration;if(l===0)return;const s=o.initializeProps(e,n);this.propsInTransition={};const g={duration:l,easing:t.transitionEasing||Q$,interpolator:o,interruption:t.transitionInterruption||V$,startProps:s.start,endProps:s.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(g),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}class G${constructor(e){ye(this,"_propsToCompare",void 0),ye(this,"_propsToExtract",void 0),ye(this,"_requiredProps",void 0);const{compare:t,extract:r,required:n}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=n}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!eh(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},n={};for(const o of this._propsToExtract)(o in e||o in t)&&(r[o]=e[o],n[o]=t[o]);return this._checkRequiredProps(r),this._checkRequiredProps(n),{start:r,end:n}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];sl(Number.isFinite(r)||Array.isArray(r),"".concat(t," is required for transition"))})}}const j$=["longitude","latitude","zoom","bearing","pitch"],q$=["longitude","latitude","zoom"];class lM extends G${constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:j$,required:q$},super(r.transitionProps),ye(this,"opts",void 0),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:n,around:o}=this.opts;if(n&&o){const l=n(e),s=n(t),g=l.unproject(o);r.start.around=o,Object.assign(r.end,{around:s.project(g),aroundPosition:g,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const n={};for(const o of this._propsToExtract)n[o]=r1(e[o]||0,t[o]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...t,...n});Object.assign(n,o.panByPosition(t.aroundPosition,r1(e.around,t.around,r)))}return n}}const Ad={transitionDuration:0},$$=300,v1=i=>1-(1-i)*(1-i),ag={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},xf={};class K${constructor(e){ye(this,"props",void 0),ye(this,"state",{}),ye(this,"transitionManager",void 0),ye(this,"eventManager",void 0),ye(this,"onViewStateChange",void 0),ye(this,"onStateChange",void 0),ye(this,"makeViewport",void 0),ye(this,"_controllerState",void 0),ye(this,"_events",{}),ye(this,"_interactionState",{isDragging:!1}),ye(this,"_customEvents",[]),ye(this,"_eventStartBlocked",null),ye(this,"_panMove",!1),ye(this,"invertPan",!1),ye(this,"dragMode","rotate"),ye(this,"inertia",0),ye(this,"scrollZoom",!0),ye(this,"dragPan",!0),ye(this,"dragRotate",!0),ye(this,"doubleClickZoom",!0),ye(this,"touchZoom",!0),ye(this,"touchRotate",!1),ye(this,"keyboard",!0),this.transitionManager=new H$({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)if(this._events[t]){var e;(e=this.eventManager)===null||e===void 0||e.off(t,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return t?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:n}=e;return[n.x-t,n.y-r]}isPointInBounds(e,t){const{width:r,height:n}=this.props;if(t&&t.handled)return!1;const o=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=n;return o&&t&&t.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?$$:0;const{scrollZoom:r=!0,dragPan:n=!0,dragRotate:o=!0,doubleClickZoom:l=!0,touchZoom:s=!0,touchRotate:g=!1,keyboard:b=!0}=e,T=!!this.onViewStateChange;this.toggleEvents(ag.WHEEL,T&&r),this.toggleEvents(ag.PAN,T),this.toggleEvents(ag.PINCH,T&&(s||g)),this.toggleEvents(ag.TRIPLE_PAN,T&&g),this.toggleEvents(ag.DOUBLE_TAP,T&&l),this.toggleEvents(ag.KEYBOARD,T&&b),this.scrollZoom=r,this.dragPan=n,this.dragRotate=o,this.doubleClickZoom=l,this.touchZoom=s,this.touchRotate=g,this.keyboard=b}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n={...e.getViewportProps(),...t},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),o){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:l})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const n=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(n,Ad,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,Ad,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),n=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],o=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:v1},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Ad,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),n=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],o=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:v1},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let l=2/(1+Math.exp(-Math.abs(o*r)));o<0&&l!==0&&(l=1/l);const s=this.controllerState.zoom({pos:t,scale:l});return this.updateViewport(s,{...this._getTransitionProps({around:t}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,Ad,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,Ad,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),n=[r[0],r[1]+=e.velocityY*t/2],o=this.controllerState.rotate({pos:n});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:v1},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return xf._startPinchRotation=e.rotation,xf._lastPinchEvent=e,this.updateViewport(r,Ad,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,n=this.getCenter(e);t=t.zoom({pos:n,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:xf._startPinchRotation-r})}return this.updateViewport(t,Ad,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),xf._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=xf;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const n=this.getCenter(e);let o=this.controllerState.rotateEnd();const l=Math.log2(e.scale),s=(l-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),g=Math.pow(2,l+s*t/2);o=o.zoom({pos:n,scale:g}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:n}),transitionDuration:t,transitionEasing:v1},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return xf._startPinchRotation=null,xf._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(n,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:n,rotateSpeedX:o,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:s}=this;let g;const b={};switch(e.srcEvent.code){case"Minus":g=t?s.zoomOut(r).zoomOut(r):s.zoomOut(r),b.isZooming=!0;break;case"Equal":g=t?s.zoomIn(r).zoomIn(r):s.zoomIn(r),b.isZooming=!0;break;case"ArrowLeft":t?(g=s.rotateLeft(o),b.isRotating=!0):(g=s.moveLeft(n),b.isPanning=!0);break;case"ArrowRight":t?(g=s.rotateRight(o),b.isRotating=!0):(g=s.moveRight(n),b.isPanning=!0);break;case"ArrowUp":t?(g=s.rotateUp(l),b.isRotating=!0):(g=s.moveUp(n),b.isPanning=!0);break;case"ArrowDown":t?(g=s.rotateDown(l),b.isRotating=!0):(g=s.moveDown(n),b.isPanning=!0);break;default:return!1}return this.updateViewport(g,this._getTransitionProps(),b),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Ad:e?{...t,transitionInterpolator:new lM({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class W${constructor(e,t){ye(this,"_viewportProps",void 0),ye(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const cM=5,X$=1.2;class Z$ extends W${constructor(e){const{width:t,height:r,latitude:n,longitude:o,zoom:l,bearing:s=0,pitch:g=0,altitude:b=1.5,position:T=[0,0,0],maxZoom:F=20,minZoom:k=0,maxPitch:z=60,minPitch:J=0,startPanLngLat:te,startZoomLngLat:ue,startRotatePos:ce,startBearing:de,startPitch:_e,startZoom:Ee,normalize:He=!0}=e;sl(Number.isFinite(o)),sl(Number.isFinite(n)),sl(Number.isFinite(l)),super({width:t,height:r,latitude:n,longitude:o,zoom:l,bearing:s,pitch:g,altitude:b,maxZoom:F,minZoom:k,maxPitch:z,minPitch:J,normalize:He,position:T},{startPanLngLat:te,startZoomLngLat:ue,startRotatePos:ce,startBearing:de,startPitch:_e,startZoom:Ee}),ye(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart(e){let{pos:t}=e;return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan(e){let{pos:t,startPos:r}=e;const n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;const l=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(l)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(e){let{pos:t}=e;return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(e){let{pos:t,deltaAngleX:r=0,deltaAngleY:n=0}=e;const{startRotatePos:o,startBearing:l,startPitch:s}=this.getState();if(!o||l===void 0||s===void 0)return this;let g;return t?g=this._getNewRotation(t,o,s,l):g={bearing:l+r,pitch:s+n},this._getUpdatedState(g)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(e){let{pos:t}=e;return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom(e){let{pos:t,startPos:r,scale:n}=e,{startZoom:o,startZoomLngLat:l}=this.getState();if(l||(o=this.getViewportProps().zoom,l=this._unproject(r)||this._unproject(t)),!l)return this;const{maxZoom:s,minZoom:g}=this.getViewportProps();let b=o+Math.log2(n);b=EA(b,g,s);const T=this.makeViewport({...this.getViewportProps(),zoom:b});return this._getUpdatedState({zoom:b,...T.panByPosition(l,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(e)}zoomOut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/e)}moveLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([e,0])}moveRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-e,0])}moveUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,e])}moveDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-e])}rotateLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:n,longitude:o}=r;return Math.abs(n-t.bearing)>180&&(r.bearing=n<0?n+360:n-360),Math.abs(o-t.longitude)>180&&(r.longitude=o<0?o+360:o-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:n}=e;e.zoom=EA(n,r,t);const{maxPitch:o,minPitch:l,pitch:s}=e;e.pitch=EA(s,l,o);const{normalize:g=!0}=e;return g&&Object.assign(e,r$(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,n){const o=e[0]-t[0],l=e[1]-t[1],s=e[1],g=t[1],{width:b,height:T}=this.getViewportProps(),F=o/b;let k=0;l>0?Math.abs(T-g)>cM&&(k=l/(g-T)*X$):l<0&&g>cM&&(k=1-s/g),k=EA(k,-1,1);const{minPitch:z,maxPitch:J}=this.getViewportProps(),te=n+180*F;let ue=r;return k>0?ue=r+k*(J-r):k<0&&(ue=r-k*(z-r)),{pitch:ue,bearing:te}}}class J$ extends K${constructor(){super(...arguments),ye(this,"ControllerState",Z$),ye(this,"transition",{transitionDuration:300,transitionInterpolator:new lM({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),ye(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class K2 extends z${get ViewportType(){return vf}get ControllerType(){return J$}}ye(K2,"displayName","MapView");const Y$=new Q2;function eK(i,e){var t,r;const n=(t=i.order)!==null&&t!==void 0?t:1/0,o=(r=e.order)!==null&&r!==void 0?r:1/0;return n-o}class tK{constructor(){ye(this,"effects",void 0),ye(this,"_resolvedEffects",[]),ye(this,"_defaultEffects",[]),ye(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(n=>eK(n,e)>0);r<0?t.push(e):t.splice(r,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(zh(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const n of this.effects)t[n.id]=n;const r=[];for(const n of e){const o=t[n.id];o&&o!==n?o.setProps?(o.setProps(n.props),r.push(o)):(o.cleanup(),r.push(n)):r.push(n),delete t[n.id]}for(const n in t)t[n].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(n=>n instanceof Q2)||this._resolvedEffects.push(Y$),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class iK extends F2{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const rK="deckRenderer.renderLayers";class nK{constructor(e){ye(this,"gl",void 0),ye(this,"layerFilter",void 0),ye(this,"drawPickingColors",void 0),ye(this,"drawLayersPass",void 0),ye(this,"pickLayersPass",void 0),ye(this,"renderCount",void 0),ye(this,"_needsRedraw",void 0),ye(this,"renderBuffers",void 0),ye(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new iK(e),this.pickLayersPass=new sM(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||ba.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const n=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,o=t.render({...r,target:n});r.effects&&this._postRender(r.effects,r),this.renderCount++,El(rK,this,o,e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(this.gl,t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new ba(this.gl),new ba(this.gl));for(const t of e)t.resize()}_postRender(e,t){const{renderBuffers:r}=this,n={...t,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const o of e)if(o.postRender){if(o.id===this.lastPostProcessEffect){n.target=t.target,o.postRender(this.gl,n);break}const l=o.postRender(this.gl,n);n.inputBuffer=l,n.swapBuffer=l===r[0]?r[1]:r[0]}}}const sK={pickedColor:null,pickedObjectIndex:-1};function oK(i){let{pickedColors:e,decodePickingColor:t,deviceX:r,deviceY:n,deviceRadius:o,deviceRect:l}=i;const{x:s,y:g,width:b,height:T}=l;let F=o*o,k=-1,z=0;for(let J=0;J<T;J++){const te=J+g-n,ue=te*te;if(ue>F)z+=4*b;else for(let ce=0;ce<b;ce++){if(e[z+3]-1>=0){const _e=ce+s-r,Ee=_e*_e+ue;Ee<=F&&(F=Ee,k=z)}z+=4}}if(k>=0){const J=e.slice(k,k+4),te=t(J);if(te){const ue=Math.floor(k/4/b),ce=k/4-ue*b;return{...te,pickedColor:J,pickedX:s+ce,pickedY:g+ue}}Dn.error("Picked non-existent layer. Is picking buffer corrupt?")()}return sK}function aK(i){let{pickedColors:e,decodePickingColor:t}=i;const r=new Map;if(e){for(let n=0;n<e.length;n+=4)if(e[n+3]-1>=0){const l=e.slice(n,n+4),s=l.join(",");if(!r.has(s)){const g=t(l);g?r.set(s,{...g,color:l}):Dn.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function uM(i){let{pickInfo:e,viewports:t,pixelRatio:r,x:n,y:o,z:l}=i,s=t[0];t.length>1&&(s=cK((e==null?void 0:e.pickedViewports)||t,{x:n,y:o}));let g;if(s){const b=[n-s.x,o-s.y];l!==void 0&&(b[2]=l),g=s.unproject(b)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:n,y:o,pixel:[n,o],coordinate:g,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:r}}function lK(i){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:n}=i,{pickedColor:o,pickedLayer:l,pickedObjectIndex:s}=e,g=l?[l]:[];if(r==="hover"){const F=t.index,k=t.layerId,z=l?l.props.id:null;if(z!==k||s!==F){if(z!==k){const J=n.find(te=>te.props.id===k);J&&g.unshift(J)}t.layerId=z,t.index=s,t.info=null}}const b=uM(i),T=new Map;return T.set(null,b),g.forEach(F=>{let k={...b};F===l&&(k.color=o,k.index=s,k.picked=!0),k=hM({layer:F,info:k,mode:r});const z=k.layer;F===l&&r==="hover"&&(t.info=k),T.set(z.id,k),r==="hover"&&z.updateAutoHighlight(k)}),T}function hM(i){let{layer:e,info:t,mode:r}=i;for(;e&&t;){const n=t.layer||null;t.sourceLayer=n,t.layer=e,t=e.getPickingInfo({info:t,mode:r,sourceLayer:n}),e=e.parent}return t}function cK(i,e){for(let t=i.length-1;t>=0;t--){const r=i[t];if(r.containsPixel(e))return r}return i[0]}class uK{constructor(e){ye(this,"gl",void 0),ye(this,"pickingFBO",void 0),ye(this,"depthFBO",void 0),ye(this,"pickLayersPass",void 0),ye(this,"layerFilter",void 0),ye(this,"lastPickedInfo",void 0),ye(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new sM(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject(e){let{x:t,y:r,layers:n,viewports:o}=e,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const s=l&&l.layer&&l.layer.id,g=l&&l.viewport&&l.viewport.id,b=s?n.find(z=>z.id===s):null,T=g&&o.find(z=>z.id===g)||o[0],F=T&&T.unproject([t-T.x,r-T.y]);return{...l,...{x:t,y:r,viewport:T,coordinate:F,layer:b}}}_resizeBuffer(){var e,t;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new ba(r),ba.isSupported(r,{colorBufferFloat:!0}))){const n=new ba(r);n.attach({36064:new Xc(r,{format:hn(r)?34836:6408,type:5126})}),this.depthFBO=n}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(t=this.depthFBO)===null||t===void 0||t.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject(e){let{layers:t,views:r,viewports:n,x:o,y:l,radius:s=0,depth:g=1,mode:b="query",unproject3D:T,onViewportActive:F,effects:k}=e;const z=this._getPickable(t),J=qp(this.gl);if(!z)return{result:[],emptyInfo:uM({viewports:n,x:o,y:l,pixelRatio:J})};this._resizeBuffer();const te=Gw(this.gl,[o,l],!0),ue=[te.x+Math.floor(te.width/2),te.y+Math.floor(te.height/2)],ce=Math.round(s*J),{width:de,height:_e}=this.pickingFBO,Ee=this._getPickingRect({deviceX:ue[0],deviceY:ue[1],deviceRadius:ce,deviceWidth:de,deviceHeight:_e}),He={x:o-s,y:l-s,width:s*2+1,height:s*2+1};let Ve;const qe=[],Ue=new Set;for(let ot=0;ot<g;ot++){let it;if(Ee){const Me=this._drawAndSample({layers:z,views:r,viewports:n,onViewportActive:F,deviceRect:Ee,cullRect:He,effects:k,pass:"picking:".concat(b)});it=oK({...Me,deviceX:ue[0],deviceY:ue[1],deviceRadius:ce,deviceRect:Ee})}else it={pickedColor:null,pickedObjectIndex:-1};let De;if(it.pickedLayer&&T&&this.depthFBO){const{pickedColors:Me}=this._drawAndSample({layers:[it.pickedLayer],views:r,viewports:n,onViewportActive:F,deviceRect:{x:it.pickedX,y:it.pickedY,width:1,height:1},cullRect:He,effects:k,pass:"picking:".concat(b,":z")},!0);Me[3]&&(De=Me[0])}it.pickedLayer&&ot+1<g&&(Ue.add(it.pickedLayer),it.pickedLayer.disablePickingIndex(it.pickedObjectIndex)),Ve=lK({pickInfo:it,lastPickedInfo:this.lastPickedInfo,mode:b,layers:z,viewports:n,x:o,y:l,z:De,pixelRatio:J});for(const Me of Ve.values())Me.layer&&qe.push(Me);if(!it.pickedColor)break}for(const ot of Ue)ot.restorePickingColors();return{result:qe,emptyInfo:Ve.get(null)}}_pickVisibleObjects(e){let{layers:t,views:r,viewports:n,x:o,y:l,width:s=1,height:g=1,mode:b="query",maxObjects:T=null,onViewportActive:F,effects:k}=e;const z=this._getPickable(t);if(!z)return[];this._resizeBuffer();const J=qp(this.gl),te=Gw(this.gl,[o,l],!0),ue=te.x,ce=te.y+te.height,de=Gw(this.gl,[o+s,l+g],!0),_e=de.x+de.width,Ee=de.y,He={x:ue,y:Ee,width:_e-ue,height:ce-Ee},Ve=this._drawAndSample({layers:z,views:r,viewports:n,onViewportActive:F,deviceRect:He,cullRect:{x:o,y:l,width:s,height:g},effects:k,pass:"picking:".concat(b)}),qe=aK(Ve),Ue=new Map,ot=Number.isFinite(T);for(let De=0;De<qe.length;De++){var it;if(ot&&T&&Ue.size>=T)break;const Me=qe[De];let Ze={color:Me.pickedColor,layer:null,index:Me.pickedObjectIndex,picked:!0,x:o,y:l,pixelRatio:J};Ze=hM({layer:Me.pickedLayer,info:Ze,mode:b});const We=(it=Ze.object)!==null&&it!==void 0?it:"".concat(Ze.layer.id,"[").concat(Ze.index,"]");Ue.has(We)||Ue.set(We,Ze)}return Array.from(Ue.values())}_drawAndSample(e){let{layers:t,views:r,viewports:n,onViewportActive:o,deviceRect:l,cullRect:s,effects:g,pass:b}=e,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const F=T?this.depthFBO:this.pickingFBO,k={layers:t,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:o,pickingFBO:F,deviceRect:l,cullRect:s,effects:g,pass:b,pickZ:T,preRenderStats:{}};for(const _e of g)_e.useInPicking&&(k.preRenderStats[_e.id]=_e.preRender(this.gl,k));const{decodePickingColor:z}=this.pickLayersPass.render(k),{x:J,y:te,width:ue,height:ce}=l,de=new(T?Float32Array:Uint8Array)(ue*ce*4);return $_(F,{sourceX:J,sourceY:te,sourceWidth:ue,sourceHeight:ce,target:de}),{pickedColors:de,decodePickingColor:z}}_getPickingRect(e){let{deviceX:t,deviceY:r,deviceRadius:n,deviceWidth:o,deviceHeight:l}=e;const s=Math.max(0,t-n),g=Math.max(0,r-n),b=Math.min(o,t+n+1)-s,T=Math.min(l,r+n+1)-g;return b<=0||T<=0?null:{x:s,y:g,width:b,height:T}}}const hK={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class AK{constructor(e){ye(this,"el",null),ye(this,"isVisible",!1);const t=e.parentElement;t&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,hK),t.appendChild(this.el))}setTooltip(e,t,r){const n=this.el;if(n){if(typeof e=="string")n.innerText=e;else if(e)e.text&&(n.innerText=e.text),e.html&&(n.innerHTML=e.html),e.className&&(n.className=e.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform="translate(".concat(t,"px, ").concat(r,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(n.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var AM={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(i){(function(e,t,r,n){var o=["","webkit","Moz","MS","ms","o"],l=t.createElement("div"),s="function",g=Math.round,b=Math.abs,T=Date.now;function F(Ne,Je,dt){return setTimeout(_e(Ne,dt),Je)}function k(Ne,Je,dt){return Array.isArray(Ne)?(z(Ne,dt[Je],dt),!0):!1}function z(Ne,Je,dt){var Ot;if(Ne)if(Ne.forEach)Ne.forEach(Je,dt);else if(Ne.length!==n)for(Ot=0;Ot<Ne.length;)Je.call(dt,Ne[Ot],Ot,Ne),Ot++;else for(Ot in Ne)Ne.hasOwnProperty(Ot)&&Je.call(dt,Ne[Ot],Ot,Ne)}function J(Ne,Je,dt){var Ot="DEPRECATED METHOD: "+Je+`
`+dt+` AT 
`;return function(){var ui=new Error("get-stack-trace"),Gi=ui&&ui.stack?ui.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",br=e.console&&(e.console.warn||e.console.log);return br&&br.call(e.console,Ot,Gi),Ne.apply(this,arguments)}}var te;typeof Object.assign!="function"?te=function(Je){if(Je===n||Je===null)throw new TypeError("Cannot convert undefined or null to object");for(var dt=Object(Je),Ot=1;Ot<arguments.length;Ot++){var ui=arguments[Ot];if(ui!==n&&ui!==null)for(var Gi in ui)ui.hasOwnProperty(Gi)&&(dt[Gi]=ui[Gi])}return dt}:te=Object.assign;var ue=J(function(Je,dt,Ot){for(var ui=Object.keys(dt),Gi=0;Gi<ui.length;)(!Ot||Ot&&Je[ui[Gi]]===n)&&(Je[ui[Gi]]=dt[ui[Gi]]),Gi++;return Je},"extend","Use `assign`."),ce=J(function(Je,dt){return ue(Je,dt,!0)},"merge","Use `assign`.");function de(Ne,Je,dt){var Ot=Je.prototype,ui;ui=Ne.prototype=Object.create(Ot),ui.constructor=Ne,ui._super=Ot,dt&&te(ui,dt)}function _e(Ne,Je){return function(){return Ne.apply(Je,arguments)}}function Ee(Ne,Je){return typeof Ne==s?Ne.apply(Je&&Je[0]||n,Je):Ne}function He(Ne,Je){return Ne===n?Je:Ne}function Ve(Ne,Je,dt){z(it(Je),function(Ot){Ne.addEventListener(Ot,dt,!1)})}function qe(Ne,Je,dt){z(it(Je),function(Ot){Ne.removeEventListener(Ot,dt,!1)})}function Ue(Ne,Je){for(;Ne;){if(Ne==Je)return!0;Ne=Ne.parentNode}return!1}function ot(Ne,Je){return Ne.indexOf(Je)>-1}function it(Ne){return Ne.trim().split(/\s+/g)}function De(Ne,Je,dt){if(Ne.indexOf&&!dt)return Ne.indexOf(Je);for(var Ot=0;Ot<Ne.length;){if(dt&&Ne[Ot][dt]==Je||!dt&&Ne[Ot]===Je)return Ot;Ot++}return-1}function Me(Ne){return Array.prototype.slice.call(Ne,0)}function Ze(Ne,Je,dt){for(var Ot=[],ui=[],Gi=0;Gi<Ne.length;){var br=Je?Ne[Gi][Je]:Ne[Gi];De(ui,br)<0&&Ot.push(Ne[Gi]),ui[Gi]=br,Gi++}return dt&&(Je?Ot=Ot.sort(function(On,rs){return On[Je]>rs[Je]}):Ot=Ot.sort()),Ot}function We(Ne,Je){for(var dt,Ot,ui=Je[0].toUpperCase()+Je.slice(1),Gi=0;Gi<o.length;){if(dt=o[Gi],Ot=dt?dt+ui:Je,Ot in Ne)return Ot;Gi++}return n}var Bt=1;function Ct(){return Bt++}function Lt(Ne){var Je=Ne.ownerDocument||Ne;return Je.defaultView||Je.parentWindow||e}var _t=/mobile|tablet|ip(ad|hone|od)|android/i,Ft="ontouchstart"in e,Mt=We(e,"PointerEvent")!==n,Wt=Ft&&_t.test(navigator.userAgent),Se="touch",Xe="pen",et="mouse",At="kinect",ft=25,wt=1,Pt=2,It=4,Ht=8,ii=1,gi=2,mi=4,Mi=8,kt=16,at=gi|mi,xt=Mi|kt,Ri=at|xt,ei=["x","y"],ut=["clientX","clientY"];function jt(Ne,Je){var dt=this;this.manager=Ne,this.callback=Je,this.element=Ne.element,this.target=Ne.options.inputTarget,this.domHandler=function(Ot){Ee(Ne.options.enable,[Ne])&&dt.handler(Ot)},this.init()}jt.prototype={handler:function(){},init:function(){this.evEl&&Ve(this.element,this.evEl,this.domHandler),this.evTarget&&Ve(this.target,this.evTarget,this.domHandler),this.evWin&&Ve(Lt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&qe(this.element,this.evEl,this.domHandler),this.evTarget&&qe(this.target,this.evTarget,this.domHandler),this.evWin&&qe(Lt(this.element),this.evWin,this.domHandler)}};function ni(Ne){var Je,dt=Ne.options.inputClass;return dt?Je=dt:Mt?Je=we:Wt?Je=Pe:Ft?Je=yt:Je=vi,new Je(Ne,di)}function di(Ne,Je,dt){var Ot=dt.pointers.length,ui=dt.changedPointers.length,Gi=Je&wt&&Ot-ui===0,br=Je&(It|Ht)&&Ot-ui===0;dt.isFirst=!!Gi,dt.isFinal=!!br,Gi&&(Ne.session={}),dt.eventType=Je,li(Ne,dt),Ne.emit("hammer.input",dt),Ne.recognize(dt),Ne.session.prevInput=dt}function li(Ne,Je){var dt=Ne.session,Ot=Je.pointers,ui=Ot.length;dt.firstInput||(dt.firstInput=Ar(Je)),ui>1&&!dt.firstMultiple?dt.firstMultiple=Ar(Je):ui===1&&(dt.firstMultiple=!1);var Gi=dt.firstInput,br=dt.firstMultiple,En=br?br.center:Gi.center,On=Je.center=Er(Ot);Je.timeStamp=T(),Je.deltaTime=Je.timeStamp-Gi.timeStamp,Je.angle=$t(En,On),Je.distance=ci(En,On),Ki(dt,Je),Je.offsetDirection=Ji(Je.deltaX,Je.deltaY);var rs=Nt(Je.deltaTime,Je.deltaX,Je.deltaY);Je.overallVelocityX=rs.x,Je.overallVelocityY=rs.y,Je.overallVelocity=b(rs.x)>b(rs.y)?rs.x:rs.y,Je.scale=br?Qt(br.pointers,Ot):1,Je.rotation=br?Zi(br.pointers,Ot):0,Je.maxPointers=dt.prevInput?Je.pointers.length>dt.prevInput.maxPointers?Je.pointers.length:dt.prevInput.maxPointers:Je.pointers.length,tr(dt,Je);var wn=Ne.element;Ue(Je.srcEvent.target,wn)&&(wn=Je.srcEvent.target),Je.target=wn}function Ki(Ne,Je){var dt=Je.center,Ot=Ne.offsetDelta||{},ui=Ne.prevDelta||{},Gi=Ne.prevInput||{};(Je.eventType===wt||Gi.eventType===It)&&(ui=Ne.prevDelta={x:Gi.deltaX||0,y:Gi.deltaY||0},Ot=Ne.offsetDelta={x:dt.x,y:dt.y}),Je.deltaX=ui.x+(dt.x-Ot.x),Je.deltaY=ui.y+(dt.y-Ot.y)}function tr(Ne,Je){var dt=Ne.lastInterval||Je,Ot=Je.timeStamp-dt.timeStamp,ui,Gi,br,En;if(Je.eventType!=Ht&&(Ot>ft||dt.velocity===n)){var On=Je.deltaX-dt.deltaX,rs=Je.deltaY-dt.deltaY,wn=Nt(Ot,On,rs);Gi=wn.x,br=wn.y,ui=b(wn.x)>b(wn.y)?wn.x:wn.y,En=Ji(On,rs),Ne.lastInterval=Je}else ui=dt.velocity,Gi=dt.velocityX,br=dt.velocityY,En=dt.direction;Je.velocity=ui,Je.velocityX=Gi,Je.velocityY=br,Je.direction=En}function Ar(Ne){for(var Je=[],dt=0;dt<Ne.pointers.length;)Je[dt]={clientX:g(Ne.pointers[dt].clientX),clientY:g(Ne.pointers[dt].clientY)},dt++;return{timeStamp:T(),pointers:Je,center:Er(Je),deltaX:Ne.deltaX,deltaY:Ne.deltaY}}function Er(Ne){var Je=Ne.length;if(Je===1)return{x:g(Ne[0].clientX),y:g(Ne[0].clientY)};for(var dt=0,Ot=0,ui=0;ui<Je;)dt+=Ne[ui].clientX,Ot+=Ne[ui].clientY,ui++;return{x:g(dt/Je),y:g(Ot/Je)}}function Nt(Ne,Je,dt){return{x:Je/Ne||0,y:dt/Ne||0}}function Ji(Ne,Je){return Ne===Je?ii:b(Ne)>=b(Je)?Ne<0?gi:mi:Je<0?Mi:kt}function ci(Ne,Je,dt){dt||(dt=ei);var Ot=Je[dt[0]]-Ne[dt[0]],ui=Je[dt[1]]-Ne[dt[1]];return Math.sqrt(Ot*Ot+ui*ui)}function $t(Ne,Je,dt){dt||(dt=ei);var Ot=Je[dt[0]]-Ne[dt[0]],ui=Je[dt[1]]-Ne[dt[1]];return Math.atan2(ui,Ot)*180/Math.PI}function Zi(Ne,Je){return $t(Je[1],Je[0],ut)+$t(Ne[1],Ne[0],ut)}function Qt(Ne,Je){return ci(Je[0],Je[1],ut)/ci(Ne[0],Ne[1],ut)}var Bi={mousedown:wt,mousemove:Pt,mouseup:It},Ii="mousedown",Gt="mousemove mouseup";function vi(){this.evEl=Ii,this.evWin=Gt,this.pressed=!1,jt.apply(this,arguments)}de(vi,jt,{handler:function(Je){var dt=Bi[Je.type];dt&wt&&Je.button===0&&(this.pressed=!0),dt&Pt&&Je.which!==1&&(dt=It),this.pressed&&(dt&It&&(this.pressed=!1),this.callback(this.manager,dt,{pointers:[Je],changedPointers:[Je],pointerType:et,srcEvent:Je}))}});var Jt={pointerdown:wt,pointermove:Pt,pointerup:It,pointercancel:Ht,pointerout:Ht},mr={2:Se,3:Xe,4:et,5:At},Sr="pointerdown",ze="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Sr="MSPointerDown",ze="MSPointerMove MSPointerUp MSPointerCancel");function we(){this.evEl=Sr,this.evWin=ze,jt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}de(we,jt,{handler:function(Je){var dt=this.store,Ot=!1,ui=Je.type.toLowerCase().replace("ms",""),Gi=Jt[ui],br=mr[Je.pointerType]||Je.pointerType,En=br==Se,On=De(dt,Je.pointerId,"pointerId");Gi&wt&&(Je.button===0||En)?On<0&&(dt.push(Je),On=dt.length-1):Gi&(It|Ht)&&(Ot=!0),!(On<0)&&(dt[On]=Je,this.callback(this.manager,Gi,{pointers:dt,changedPointers:[Je],pointerType:br,srcEvent:Je}),Ot&&dt.splice(On,1))}});var oe={touchstart:wt,touchmove:Pt,touchend:It,touchcancel:Ht},ee="touchstart",le="touchstart touchmove touchend touchcancel";function ge(){this.evTarget=ee,this.evWin=le,this.started=!1,jt.apply(this,arguments)}de(ge,jt,{handler:function(Je){var dt=oe[Je.type];if(dt===wt&&(this.started=!0),!!this.started){var Ot=ve.call(this,Je,dt);dt&(It|Ht)&&Ot[0].length-Ot[1].length===0&&(this.started=!1),this.callback(this.manager,dt,{pointers:Ot[0],changedPointers:Ot[1],pointerType:Se,srcEvent:Je})}}});function ve(Ne,Je){var dt=Me(Ne.touches),Ot=Me(Ne.changedTouches);return Je&(It|Ht)&&(dt=Ze(dt.concat(Ot),"identifier",!0)),[dt,Ot]}var Ce={touchstart:wt,touchmove:Pt,touchend:It,touchcancel:Ht},be="touchstart touchmove touchend touchcancel";function Pe(){this.evTarget=be,this.targetIds={},jt.apply(this,arguments)}de(Pe,jt,{handler:function(Je){var dt=Ce[Je.type],Ot=Oe.call(this,Je,dt);Ot&&this.callback(this.manager,dt,{pointers:Ot[0],changedPointers:Ot[1],pointerType:Se,srcEvent:Je})}});function Oe(Ne,Je){var dt=Me(Ne.touches),Ot=this.targetIds;if(Je&(wt|Pt)&&dt.length===1)return Ot[dt[0].identifier]=!0,[dt,dt];var ui,Gi,br=Me(Ne.changedTouches),En=[],On=this.target;if(Gi=dt.filter(function(rs){return Ue(rs.target,On)}),Je===wt)for(ui=0;ui<Gi.length;)Ot[Gi[ui].identifier]=!0,ui++;for(ui=0;ui<br.length;)Ot[br[ui].identifier]&&En.push(br[ui]),Je&(It|Ht)&&delete Ot[br[ui].identifier],ui++;if(En.length)return[Ze(Gi.concat(En),"identifier",!0),En]}var Ge=2500,rt=25;function yt(){jt.apply(this,arguments);var Ne=_e(this.handler,this);this.touch=new Pe(this.manager,Ne),this.mouse=new vi(this.manager,Ne),this.primaryTouch=null,this.lastTouches=[]}de(yt,jt,{handler:function(Je,dt,Ot){var ui=Ot.pointerType==Se,Gi=Ot.pointerType==et;if(!(Gi&&Ot.sourceCapabilities&&Ot.sourceCapabilities.firesTouchEvents)){if(ui)Et.call(this,dt,Ot);else if(Gi&&qt.call(this,Ot))return;this.callback(Je,dt,Ot)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Et(Ne,Je){Ne&wt?(this.primaryTouch=Je.changedPointers[0].identifier,Yt.call(this,Je)):Ne&(It|Ht)&&Yt.call(this,Je)}function Yt(Ne){var Je=Ne.changedPointers[0];if(Je.identifier===this.primaryTouch){var dt={x:Je.clientX,y:Je.clientY};this.lastTouches.push(dt);var Ot=this.lastTouches,ui=function(){var Gi=Ot.indexOf(dt);Gi>-1&&Ot.splice(Gi,1)};setTimeout(ui,Ge)}}function qt(Ne){for(var Je=Ne.srcEvent.clientX,dt=Ne.srcEvent.clientY,Ot=0;Ot<this.lastTouches.length;Ot++){var ui=this.lastTouches[Ot],Gi=Math.abs(Je-ui.x),br=Math.abs(dt-ui.y);if(Gi<=rt&&br<=rt)return!0}return!1}var Kt=We(l.style,"touchAction"),si=Kt!==n,Ci="compute",Hi="auto",wi="manipulation",Ui="none",st="pan-x",ti="pan-y",zt=sn();function zi(Ne,Je){this.manager=Ne,this.set(Je)}zi.prototype={set:function(Ne){Ne==Ci&&(Ne=this.compute()),si&&this.manager.element.style&&zt[Ne]&&(this.manager.element.style[Kt]=Ne),this.actions=Ne.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Ne=[];return z(this.manager.recognizers,function(Je){Ee(Je.options.enable,[Je])&&(Ne=Ne.concat(Je.getTouchAction()))}),hr(Ne.join(" "))},preventDefaults:function(Ne){var Je=Ne.srcEvent,dt=Ne.offsetDirection;if(this.manager.session.prevented){Je.preventDefault();return}var Ot=this.actions,ui=ot(Ot,Ui)&&!zt[Ui],Gi=ot(Ot,ti)&&!zt[ti],br=ot(Ot,st)&&!zt[st];if(ui){var En=Ne.pointers.length===1,On=Ne.distance<2,rs=Ne.deltaTime<250;if(En&&On&&rs)return}if(!(br&&Gi)&&(ui||Gi&&dt&at||br&&dt&xt))return this.preventSrc(Je)},preventSrc:function(Ne){this.manager.session.prevented=!0,Ne.preventDefault()}};function hr(Ne){if(ot(Ne,Ui))return Ui;var Je=ot(Ne,st),dt=ot(Ne,ti);return Je&&dt?Ui:Je||dt?Je?st:ti:ot(Ne,wi)?wi:Hi}function sn(){if(!si)return!1;var Ne={},Je=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(dt){Ne[dt]=Je?e.CSS.supports("touch-action",dt):!0}),Ne}var bn=1,ur=2,gn=4,mn=8,lr=mn,kn=16,gs=32;function Qr(Ne){this.options=te({},this.defaults,Ne||{}),this.id=Ct(),this.manager=null,this.options.enable=He(this.options.enable,!0),this.state=bn,this.simultaneous={},this.requireFail=[]}Qr.prototype={defaults:{},set:function(Ne){return te(this.options,Ne),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Ne){if(k(Ne,"recognizeWith",this))return this;var Je=this.simultaneous;return Ne=us(Ne,this),Je[Ne.id]||(Je[Ne.id]=Ne,Ne.recognizeWith(this)),this},dropRecognizeWith:function(Ne){return k(Ne,"dropRecognizeWith",this)?this:(Ne=us(Ne,this),delete this.simultaneous[Ne.id],this)},requireFailure:function(Ne){if(k(Ne,"requireFailure",this))return this;var Je=this.requireFail;return Ne=us(Ne,this),De(Je,Ne)===-1&&(Je.push(Ne),Ne.requireFailure(this)),this},dropRequireFailure:function(Ne){if(k(Ne,"dropRequireFailure",this))return this;Ne=us(Ne,this);var Je=De(this.requireFail,Ne);return Je>-1&&this.requireFail.splice(Je,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Ne){return!!this.simultaneous[Ne.id]},emit:function(Ne){var Je=this,dt=this.state;function Ot(ui){Je.manager.emit(ui,Ne)}dt<mn&&Ot(Je.options.event+xn(dt)),Ot(Je.options.event),Ne.additionalEvent&&Ot(Ne.additionalEvent),dt>=mn&&Ot(Je.options.event+xn(dt))},tryEmit:function(Ne){if(this.canEmit())return this.emit(Ne);this.state=gs},canEmit:function(){for(var Ne=0;Ne<this.requireFail.length;){if(!(this.requireFail[Ne].state&(gs|bn)))return!1;Ne++}return!0},recognize:function(Ne){var Je=te({},Ne);if(!Ee(this.options.enable,[this,Je])){this.reset(),this.state=gs;return}this.state&(lr|kn|gs)&&(this.state=bn),this.state=this.process(Je),this.state&(ur|gn|mn|kn)&&this.tryEmit(Je)},process:function(Ne){},getTouchAction:function(){},reset:function(){}};function xn(Ne){return Ne&kn?"cancel":Ne&mn?"end":Ne&gn?"move":Ne&ur?"start":""}function So(Ne){return Ne==kt?"down":Ne==Mi?"up":Ne==gi?"left":Ne==mi?"right":""}function us(Ne,Je){var dt=Je.manager;return dt?dt.get(Ne):Ne}function Wi(){Qr.apply(this,arguments)}de(Wi,Qr,{defaults:{pointers:1},attrTest:function(Ne){var Je=this.options.pointers;return Je===0||Ne.pointers.length===Je},process:function(Ne){var Je=this.state,dt=Ne.eventType,Ot=Je&(ur|gn),ui=this.attrTest(Ne);return Ot&&(dt&Ht||!ui)?Je|kn:Ot||ui?dt&It?Je|mn:Je&ur?Je|gn:ur:gs}});function Ys(){Wi.apply(this,arguments),this.pX=null,this.pY=null}de(Ys,Wi,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ri},getTouchAction:function(){var Ne=this.options.direction,Je=[];return Ne&at&&Je.push(ti),Ne&xt&&Je.push(st),Je},directionTest:function(Ne){var Je=this.options,dt=!0,Ot=Ne.distance,ui=Ne.direction,Gi=Ne.deltaX,br=Ne.deltaY;return ui&Je.direction||(Je.direction&at?(ui=Gi===0?ii:Gi<0?gi:mi,dt=Gi!=this.pX,Ot=Math.abs(Ne.deltaX)):(ui=br===0?ii:br<0?Mi:kt,dt=br!=this.pY,Ot=Math.abs(Ne.deltaY))),Ne.direction=ui,dt&&Ot>Je.threshold&&ui&Je.direction},attrTest:function(Ne){return Wi.prototype.attrTest.call(this,Ne)&&(this.state&ur||!(this.state&ur)&&this.directionTest(Ne))},emit:function(Ne){this.pX=Ne.deltaX,this.pY=Ne.deltaY;var Je=So(Ne.direction);Je&&(Ne.additionalEvent=this.options.event+Je),this._super.emit.call(this,Ne)}});function Bs(){Wi.apply(this,arguments)}de(Bs,Wi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ui]},attrTest:function(Ne){return this._super.attrTest.call(this,Ne)&&(Math.abs(Ne.scale-1)>this.options.threshold||this.state&ur)},emit:function(Ne){if(Ne.scale!==1){var Je=Ne.scale<1?"in":"out";Ne.additionalEvent=this.options.event+Je}this._super.emit.call(this,Ne)}});function dr(){Qr.apply(this,arguments),this._timer=null,this._input=null}de(dr,Qr,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Hi]},process:function(Ne){var Je=this.options,dt=Ne.pointers.length===Je.pointers,Ot=Ne.distance<Je.threshold,ui=Ne.deltaTime>Je.time;if(this._input=Ne,!Ot||!dt||Ne.eventType&(It|Ht)&&!ui)this.reset();else if(Ne.eventType&wt)this.reset(),this._timer=F(function(){this.state=lr,this.tryEmit()},Je.time,this);else if(Ne.eventType&It)return lr;return gs},reset:function(){clearTimeout(this._timer)},emit:function(Ne){this.state===lr&&(Ne&&Ne.eventType&It?this.manager.emit(this.options.event+"up",Ne):(this._input.timeStamp=T(),this.manager.emit(this.options.event,this._input)))}});function Fr(){Wi.apply(this,arguments)}de(Fr,Wi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ui]},attrTest:function(Ne){return this._super.attrTest.call(this,Ne)&&(Math.abs(Ne.rotation)>this.options.threshold||this.state&ur)}});function Hn(){Wi.apply(this,arguments)}de(Hn,Wi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:at|xt,pointers:1},getTouchAction:function(){return Ys.prototype.getTouchAction.call(this)},attrTest:function(Ne){var Je=this.options.direction,dt;return Je&(at|xt)?dt=Ne.overallVelocity:Je&at?dt=Ne.overallVelocityX:Je&xt&&(dt=Ne.overallVelocityY),this._super.attrTest.call(this,Ne)&&Je&Ne.offsetDirection&&Ne.distance>this.options.threshold&&Ne.maxPointers==this.options.pointers&&b(dt)>this.options.velocity&&Ne.eventType&It},emit:function(Ne){var Je=So(Ne.offsetDirection);Je&&this.manager.emit(this.options.event+Je,Ne),this.manager.emit(this.options.event,Ne)}});function Or(){Qr.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}de(Or,Qr,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[wi]},process:function(Ne){var Je=this.options,dt=Ne.pointers.length===Je.pointers,Ot=Ne.distance<Je.threshold,ui=Ne.deltaTime<Je.time;if(this.reset(),Ne.eventType&wt&&this.count===0)return this.failTimeout();if(Ot&&ui&&dt){if(Ne.eventType!=It)return this.failTimeout();var Gi=this.pTime?Ne.timeStamp-this.pTime<Je.interval:!0,br=!this.pCenter||ci(this.pCenter,Ne.center)<Je.posThreshold;this.pTime=Ne.timeStamp,this.pCenter=Ne.center,!br||!Gi?this.count=1:this.count+=1,this._input=Ne;var En=this.count%Je.taps;if(En===0)return this.hasRequireFailures()?(this._timer=F(function(){this.state=lr,this.tryEmit()},Je.interval,this),ur):lr}return gs},failTimeout:function(){return this._timer=F(function(){this.state=gs},this.options.interval,this),gs},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==lr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Cn(Ne,Je){return Je=Je||{},Je.recognizers=He(Je.recognizers,Cn.defaults.preset),new Gs(Ne,Je)}Cn.VERSION="2.0.7",Cn.defaults={domEvents:!1,touchAction:Ci,enable:!0,inputTarget:null,inputClass:null,preset:[[Fr,{enable:!1}],[Bs,{enable:!1},["rotate"]],[Hn,{direction:at}],[Ys,{direction:at},["swipe"]],[Or],[Or,{event:"doubletap",taps:2},["tap"]],[dr]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var An=1,Hr=2;function Gs(Ne,Je){this.options=te({},Cn.defaults,Je||{}),this.options.inputTarget=this.options.inputTarget||Ne,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Ne,this.input=ni(this),this.touchAction=new zi(this,this.options.touchAction),ca(this,!0),z(this.options.recognizers,function(dt){var Ot=this.add(new dt[0](dt[1]));dt[2]&&Ot.recognizeWith(dt[2]),dt[3]&&Ot.requireFailure(dt[3])},this)}Gs.prototype={set:function(Ne){return te(this.options,Ne),Ne.touchAction&&this.touchAction.update(),Ne.inputTarget&&(this.input.destroy(),this.input.target=Ne.inputTarget,this.input.init()),this},stop:function(Ne){this.session.stopped=Ne?Hr:An},recognize:function(Ne){var Je=this.session;if(!Je.stopped){this.touchAction.preventDefaults(Ne);var dt,Ot=this.recognizers,ui=Je.curRecognizer;(!ui||ui&&ui.state&lr)&&(ui=Je.curRecognizer=null);for(var Gi=0;Gi<Ot.length;)dt=Ot[Gi],Je.stopped!==Hr&&(!ui||dt==ui||dt.canRecognizeWith(ui))?dt.recognize(Ne):dt.reset(),!ui&&dt.state&(ur|gn|mn)&&(ui=Je.curRecognizer=dt),Gi++}},get:function(Ne){if(Ne instanceof Qr)return Ne;for(var Je=this.recognizers,dt=0;dt<Je.length;dt++)if(Je[dt].options.event==Ne)return Je[dt];return null},add:function(Ne){if(k(Ne,"add",this))return this;var Je=this.get(Ne.options.event);return Je&&this.remove(Je),this.recognizers.push(Ne),Ne.manager=this,this.touchAction.update(),Ne},remove:function(Ne){if(k(Ne,"remove",this))return this;if(Ne=this.get(Ne),Ne){var Je=this.recognizers,dt=De(Je,Ne);dt!==-1&&(Je.splice(dt,1),this.touchAction.update())}return this},on:function(Ne,Je){if(Ne!==n&&Je!==n){var dt=this.handlers;return z(it(Ne),function(Ot){dt[Ot]=dt[Ot]||[],dt[Ot].push(Je)}),this}},off:function(Ne,Je){if(Ne!==n){var dt=this.handlers;return z(it(Ne),function(Ot){Je?dt[Ot]&&dt[Ot].splice(De(dt[Ot],Je),1):delete dt[Ot]}),this}},emit:function(Ne,Je){this.options.domEvents&&uo(Ne,Je);var dt=this.handlers[Ne]&&this.handlers[Ne].slice();if(!(!dt||!dt.length)){Je.type=Ne,Je.preventDefault=function(){Je.srcEvent.preventDefault()};for(var Ot=0;Ot<dt.length;)dt[Ot](Je),Ot++}},destroy:function(){this.element&&ca(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ca(Ne,Je){var dt=Ne.element;if(dt.style){var Ot;z(Ne.options.cssProps,function(ui,Gi){Ot=We(dt.style,Gi),Je?(Ne.oldCssProps[Ot]=dt.style[Ot],dt.style[Ot]=ui):dt.style[Ot]=Ne.oldCssProps[Ot]||""}),Je||(Ne.oldCssProps={})}}function uo(Ne,Je){var dt=t.createEvent("Event");dt.initEvent(Ne,!0,!0),dt.gesture=Je,Je.target.dispatchEvent(dt)}te(Cn,{INPUT_START:wt,INPUT_MOVE:Pt,INPUT_END:It,INPUT_CANCEL:Ht,STATE_POSSIBLE:bn,STATE_BEGAN:ur,STATE_CHANGED:gn,STATE_ENDED:mn,STATE_RECOGNIZED:lr,STATE_CANCELLED:kn,STATE_FAILED:gs,DIRECTION_NONE:ii,DIRECTION_LEFT:gi,DIRECTION_RIGHT:mi,DIRECTION_UP:Mi,DIRECTION_DOWN:kt,DIRECTION_HORIZONTAL:at,DIRECTION_VERTICAL:xt,DIRECTION_ALL:Ri,Manager:Gs,Input:jt,TouchAction:zi,TouchInput:Pe,MouseInput:vi,PointerEventInput:we,TouchMouseInput:yt,SingleTouchInput:ge,Recognizer:Qr,AttrRecognizer:Wi,Tap:Or,Pan:Ys,Swipe:Hn,Pinch:Bs,Rotate:Fr,Press:dr,on:Ve,off:qe,each:z,merge:ce,extend:ue,assign:te,inherit:de,bindFn:_e,prefixed:We});var Ea=typeof e<"u"?e:typeof self<"u"?self:{};Ea.Hammer=Cn,typeof n=="function"&&n.amd?n(function(){return Cn}):i.exports?i.exports=Cn:e[r]=Cn})(window,document,"Hammer")})(AM);var by=AM.exports;const Qh=Rm({__proto__:null,default:C_(by)},[by]),dM=1,fM=2,W2=4,dK={mousedown:dM,mousemove:fM,mouseup:W2};function fK(i,e){for(let t=0;t<i.length;t++)if(e(i[t]))return!0;return!1}function pK(i){const e=i.prototype.handler;i.prototype.handler=function(r){const n=this.store;r.button>0&&r.type==="pointerdown"&&(fK(n,o=>o.pointerId===r.pointerId)||n.push(r)),e.call(this,r)}}function gK(i){i.prototype.handler=function(t){let r=dK[t.type];r&dM&&t.button>=0&&(this.pressed=!0),r&fM&&t.which===0&&(r=W2),this.pressed&&(r&W2&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}pK(by.PointerEventInput),gK(by.MouseInput);const mK=by.Manager;class b1{constructor(e,t,r){this.element=e,this.callback=t,this.options={enable:!0,...r}}}const yK=Qh?[[Qh.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Qh.Rotate,{enable:!1}],[Qh.Pinch,{enable:!1}],[Qh.Swipe,{enable:!1}],[Qh.Pan,{threshold:0,enable:!1}],[Qh.Press,{enable:!1}],[Qh.Tap,{event:"doubletap",taps:2,enable:!1}],[Qh.Tap,{event:"anytap",enable:!1}],[Qh.Tap,{enable:!1}]]:null,pM={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},_K={doubletap:["tap"]},vK={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},X2={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},bK={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},gM={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},xK=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",lg=typeof window<"u"?window:global;let Z2=!1;try{const i={get passive(){return Z2=!0,!0}};lg.addEventListener("test",null,i),lg.removeEventListener("test",null)}catch{Z2=!1}const wK=xK.indexOf("firefox")!==-1,{WHEEL_EVENTS:BK}=X2,mM="wheel",yM=4.000244140625,CK=40,EK=.25;class SK extends b1{constructor(e,t,r){super(e,t,r),this.handleEvent=n=>{if(!this.options.enable)return;let o=n.deltaY;lg.WheelEvent&&(wK&&n.deltaMode===lg.WheelEvent.DOM_DELTA_PIXEL&&(o/=lg.devicePixelRatio),n.deltaMode===lg.WheelEvent.DOM_DELTA_LINE&&(o*=CK)),o!==0&&o%yM===0&&(o=Math.floor(o/yM)),n.shiftKey&&o&&(o=o*EK),this.callback({type:mM,center:{x:n.clientX,y:n.clientY},delta:-o,srcEvent:n,pointerType:"mouse",target:n.target})},this.events=(this.options.events||[]).concat(BK),this.events.forEach(n=>e.addEventListener(n,this.handleEvent,Z2?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===mM&&(this.options.enable=t)}}const{MOUSE_EVENTS:TK}=X2,_M="pointermove",vM="pointerover",bM="pointerout",xM="pointerenter",wM="pointerleave";class IK extends b1{constructor(e,t,r){super(e,t,r),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,this.events=(this.options.events||[]).concat(TK),this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===_M&&(this.enableMoveEvent=t),e===vM&&(this.enableOverEvent=t),e===bM&&(this.enableOutEvent=t),e===xM&&(this.enableEnterEvent=t),e===wM&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(vM,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(bM,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(xM,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(wM,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(_M,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:LK}=X2,BM="keydown",CM="keyup";class MK extends b1{constructor(e,t,r){super(e,t,r),this.handleEvent=n=>{const o=n.target||n.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:BM,srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:CM,srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(LK),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===BM&&(this.enableDownEvent=t),e===CM&&(this.enableUpEvent=t)}}const EM="contextmenu";class PK extends b1{constructor(e,t,r){super(e,t,r),this.handleEvent=n=>{this.options.enable&&this.callback({type:EM,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===EM&&(this.options.enable=t)}}const J2=1,x1=2,Y2=4,FK={pointerdown:J2,pointermove:x1,pointerup:Y2,mousedown:J2,mousemove:x1,mouseup:Y2},DK=1,RK=2,kK=3,OK=0,UK=1,NK=2,zK=1,QK=2,VK=4;function HK(i){const e=FK[i.srcEvent.type];if(!e)return null;const{buttons:t,button:r,which:n}=i.srcEvent;let o=!1,l=!1,s=!1;return e===Y2||e===x1&&!Number.isFinite(t)?(o=n===DK,l=n===RK,s=n===kK):e===x1?(o=!!(t&zK),l=!!(t&VK),s=!!(t&QK)):e===J2&&(o=r===OK,l=r===UK,s=r===NK),{leftButton:o,middleButton:l,rightButton:s}}function GK(i,e){const t=i.center;if(!t)return null;const r=e.getBoundingClientRect(),n=r.width/e.offsetWidth||1,o=r.height/e.offsetHeight||1,l={x:(t.x-r.left-e.clientLeft)/n,y:(t.y-r.top-e.clientTop)/o};return{center:t,offsetCenter:l}}const eB={srcElement:"root",priority:0};class jK{constructor(e){this.handleEvent=t=>{if(this.isEmpty())return;const r=this._normalizeEvent(t);let n=t.srcEvent.target;for(;n&&n!==r.rootElement;){if(this._emit(r,n),r.handled)return;n=n.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:l,handlersByElement:s}=this;let g=eB;typeof r=="string"||r&&r.addEventListener?g={...eB,srcElement:r}:r&&(g={...eB,...r});let b=s.get(g.srcElement);b||(b=[],s.set(g.srcElement,b));const T={type:e,handler:t,srcElement:g.srcElement,priority:g.priority};n&&(T.once=!0),o&&(T.passive=!0),l.push(T),this._active=this._active||!T.passive;let F=b.length-1;for(;F>=0&&!(b[F].priority>=T.priority);)F--;b.splice(F+1,0,T)}remove(e,t){const{handlers:r,handlersByElement:n}=this;for(let o=r.length-1;o>=0;o--){const l=r[o];if(l.type===e&&l.handler===t){r.splice(o,1);const s=n.get(l.srcElement);s.splice(s.indexOf(l),1),s.length===0&&n.delete(l.srcElement)}}this._active=r.some(o=>!o.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let n=!1;const o=()=>{e.handled=!0},l=()=>{e.handled=!0,n=!0},s=[];for(let g=0;g<r.length;g++){const{type:b,handler:T,once:F}=r[g];if(T({...e,type:b,stopPropagation:o,stopImmediatePropagation:l}),F&&s.push(r[g]),n)break}for(let g=0;g<s.length;g++){const{type:b,handler:T}=s[g];this.remove(b,T)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...HK(e),...GK(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const qK={events:null,recognizers:null,recognizerOptions:{},Manager:mK,touchAction:"none",tabIndex:0};class $K{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;this._onBasicInput=n=>{const{srcEvent:o}=n,l=vK[o.type];l&&this.manager.emit(l,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={...qK,...t},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,r=t.Manager;this.manager=new r(e,{touchAction:t.touchAction,recognizers:t.recognizers||yK}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(pM).forEach(n=>{const o=this.manager.get(n);o&&pM[n].forEach(l=>{o.recognizeWith(l)})});for(const n in t.recognizerOptions){const o=this.manager.get(n);if(o){const l=t.recognizerOptions[n];delete l.enable,o.set(l)}}this.wheelInput=new SK(e,this._onOtherEvent,{enable:!1}),this.moveInput=new IK(e,this._onOtherEvent,{enable:!1}),this.keyInput=new MK(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new PK(e,this._onOtherEvent,{enable:!1});for(const[n,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(n,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:r}=this;if(!r)return;const n=r.get(e);if(n&&n.options.enable!==t){n.set({enable:t});const o=_K[e];o&&!this.options.recognizers&&o.forEach(l=>{const s=r.get(l);t?(s.requireFailure(e),n.dropRequireFailure(l)):s.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,r,n,o){if(typeof e!="string"){r=t;for(const T in e)this._addEventHandler(T,e[T],r,n,o);return}const{manager:l,events:s}=this,g=gM[e]||e;let b=s.get(g);b||(b=new jK(this),s.set(g,b),b.recognizerName=bK[g]||g,l&&l.on(g,b.handleEvent)),b.add(e,t,r,n,o),b.isEmpty()||this._toggleRecognizer(b.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const l in e)this._removeEventHandler(l,e[l]);return}const{events:r}=this,n=gM[e]||e,o=r.get(n);if(o&&(o.remove(e,t),o.isEmpty())){const{recognizerName:l}=o;let s=!1;for(const g of r.values())if(g.recognizerName===l&&!g.isEmpty()){s=!0;break}s||this._toggleRecognizer(l,!1)}}}function wf(){}const SM={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:wf,onResize:wf,onViewStateChange:wf,onInteractionStateChange:wf,onBeforeRender:wf,onAfterRender:wf,onLoad:wf,onError:i=>Dn.error(i.message,i.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:i=>{let{isDragging:e}=i;return e?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class tB{constructor(e){ye(this,"props",void 0),ye(this,"width",0),ye(this,"height",0),ye(this,"userData",{}),ye(this,"canvas",null),ye(this,"viewManager",null),ye(this,"layerManager",null),ye(this,"effectManager",null),ye(this,"deckRenderer",null),ye(this,"deckPicker",null),ye(this,"eventManager",null),ye(this,"tooltip",null),ye(this,"metrics",void 0),ye(this,"animationLoop",void 0),ye(this,"stats",void 0),ye(this,"viewState",void 0),ye(this,"cursorState",void 0),ye(this,"_needsRedraw",void 0),ye(this,"_pickRequest",void 0),ye(this,"_lastPointerDownInfo",null),ye(this,"_metricsCounter",void 0),ye(this,"_onPointerMove",t=>{const{_pickRequest:r}=this;if(t.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(t.leftButton||t.rightButton)return;{const n=t.offsetCenter;if(!n)return;r.x=n.x,r.y=n.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=t}),ye(this,"_onEvent",t=>{const r=G5[t.type],n=t.offsetCenter;if(!r||!n||!this.layerManager)return;const o=this.layerManager.getLayers(),l=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:o,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:s}=l,g=s&&(s[r.handler]||s.props[r.handler]),b=this.props[r.handler];let T=!1;g&&(T=g.call(s,l,t)),!T&&b&&b(l,t)}),ye(this,"_onPointerDown",t=>{const r=t.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo}),this.props={...SM,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&Dn.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),U5()==="IE"&&Dn.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new $w({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&my.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,r,n,o,l,s,g;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(t=this.layerManager)===null||t===void 0||t.finalize(),this.layerManager=null,(r=this.viewManager)===null||r===void 0||r.finalize(),this.viewManager=null,(n=this.effectManager)===null||n===void 0||n.finalize(),this.effectManager=null,(o=this.deckRenderer)===null||o===void 0||o.finalize(),this.deckRenderer=null,(l=this.deckPicker)===null||l===void 0||l.finalize(),this.deckPicker=null,(s=this.eventManager)===null||s===void 0||s.destroy(),this.eventManager=null,(g=this.tooltip)===null||g===void 0||g.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var b;(b=this.canvas.parentElement)===null||b===void 0||b.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Dn.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Dn.removed("onLayerClick","onClick")(),e.initialViewState&&!zh(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),l=this.deckRenderer.needsRedraw(e);return t=t||r||n||o||l,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return sl(this.viewManager),this.viewManager.views}getViewports(e){return sl(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,t,r){sl(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(t).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return n.get(t).timeEnd(),o}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),sl(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const o=Number.isFinite(t)?"".concat(t,"px"):t;this.canvas.style.width=o}if(r||r===0){var n;const o=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((n=e.style)===null||n===void 0?void 0:n.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){var e,t;const{canvas:r}=this;if(!r)return;const n=(e=r.clientWidth)!==null&&e!==void 0?e:r.width,o=(t=r.clientHeight)!==null&&t!==void 0?t:r.height;if(n!==this.width||o!==this.height){var l,s;this.width=n,this.height=o,(l=this.viewManager)===null||l===void 0||l.setProps({width:n,height:o}),(s=this.layerManager)===null||s===void 0||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:o})}}_createAnimationLoop(e){const{width:t,height:r,gl:n,glOptions:o,debug:l,onError:s,onBeforeRender:g,onAfterRender:b,useDevicePixels:T}=e;return new T7({width:t,height:r,useDevicePixels:T,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,gl:n,onCreateContext:F=>o3({...o,...F,canvas:this.canvas,debug:l,onContextLost:()=>this._onContextLost()}),onInitialize:F=>this._setGLContext(F.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:g,onAfterRender:b,onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new K2({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let o=n,l=!1;for(const s of r){var t;o=s,l=((t=s.layer)===null||t===void 0?void 0:t.onHover(s,e.event))||l}if(!l&&this.props.onHover&&this.props.onHover(o,e.event),this.props.getTooltip&&this.tooltip){const s=this.props.getTooltip(o);this.tooltip.setTooltip(s,o.x,o.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,qw(e,{enable:!0,copyState:!0})),this.tooltip=new AK(this.canvas),bA(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const t=new RL;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new $K(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const n in G5)this.eventManager.on(n,this._onEvent);this.viewManager=new U$({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new O$(e,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new tK,this.deckRenderer=new nK(e),this.deckPicker=new uK(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{gl:r}=this.layerManager.context;bA(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Dn.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=gf.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}ye(tB,"defaultProps",SM),ye(tB,"VERSION",DV);class iB{constructor(e,t){ye(this,"opts",void 0),ye(this,"source",void 0),this.opts=t,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),t=this.getAccessor();if(e)return[e,t];const{value:r}=this.source,{size:n}=t;let o=r;if(r&&r.length!==n){o=new Float32Array(n);const l=t.elementOffset||0;for(let s=0;s<n;++s)o[s]=r[l+s]}return o}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function KK(i){switch(i){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function w1(i){return i.stride||i.size*i.bytesPerElement}function TM(i,e){e.offset&&Dn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=w1(i),r=e.vertexOffset!==void 0?e.vertexOffset:i.vertexOffset||0,n=e.elementOffset||0,o=r*t+n*i.bytesPerElement+(i.offset||0);return{...e,offset:o,stride:t}}function WK(i,e){const t=TM(i,e);return{high:t,low:{...t,offset:t.offset+i.size*4}}}class XK{constructor(e,t,r){ye(this,"gl",void 0),ye(this,"id",void 0),ye(this,"size",void 0),ye(this,"settings",void 0),ye(this,"value",void 0),ye(this,"doublePrecision",void 0),ye(this,"_buffer",void 0),ye(this,"state",void 0),this.gl=e,this.id=t.id||"",this.size=t.size||1;const n=t.logicalType||t.type,o=n===5130;let{defaultValue:l}=t;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0);let s;o?s=5126:!n&&t.isIndexed?s=e&&t2(e,Qs.ELEMENT_INDEX_UINT32)?5125:5123:s=n||5126;let g=KK(n||s||5126);this.doublePrecision=o,o&&t.fp64===!1&&(g=Float32Array),this.value=null,this.settings={...t,defaultType:g,defaultValue:l,logicalType:n,type:s,size:this.size,bytesPerElement:g.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:t}=this.settings;this._buffer=new bs(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:t}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*w1(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),my.release(this.state.allocatedValue)}getShaderAttributes(e,t){if(this.doublePrecision){const r={},n=this.value instanceof Float64Array,o=WK(this.getAccessor(),t||{});return r[e]=new iB(this,o.high),r["".concat(e,"64Low")]=n?new iB(this,o.low):new Float32Array(this.size),r}if(t){const r=TM(this.getAccessor(),t);return{[e]:new iB(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:n}=this,o=r*n;if(t&&o&&t.length>=o){const l=new Array(n).fill(1/0),s=new Array(n).fill(-1/0);for(let g=0;g<o;)for(let b=0;b<n;b++){const T=t[g++];T<l[b]&&(l[b]=T),T>s[b]&&(s[b]=T)}e=[l,s]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof bs?r={buffer:e}:r=e;const n={...this.settings,...r};if(t.bufferAccessor=n,t.bounds=null,r.constant){let o=r.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!t.constant||!this._areValuesEqual(o,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=o}else if(r.buffer){const o=r.buffer;t.externalBuffer=o,t.constant=!1,this.value=r.value||null;const l=r.value instanceof Float64Array;n.type=r.type||o.accessor.type,n.bytesPerElement=o.accessor.BYTES_PER_ELEMENT*(l?2:1),n.stride=w1(n)}else if(r.value){this._checkExternalBuffer(r);let o=r.value;t.externalBuffer=null,t.constant=!1,this.value=o,n.bytesPerElement=o.BYTES_PER_ELEMENT,n.stride=w1(n);const{buffer:l,byteOffset:s}=this;this.doublePrecision&&o instanceof Float64Array&&(o=V2(o,n));const g=o.byteLength+s+n.stride*2;l.byteLength<g&&l.reallocate(g),l.setAccessor(null),l.subData({data:o,offset:s}),n.type=r.type||l.accessor.type}return!0}updateSubBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:n}=e;this.buffer.subData({data:this.doublePrecision&&t instanceof Float64Array?V2(t,{size:this.size,startIndex:r,endIndex:n}):t.subarray(r,n),offset:r*t.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:r}=this,n=r.allocatedValue,o=my.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=o;const{buffer:l,byteOffset:s}=this;return l.byteLength<o.byteLength+s&&(l.reallocate(o.byteLength+s),t&&n&&l.subData({data:n instanceof Float64Array?V2(n,this):n,offset:s})),r.allocatedValue=o,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=t.BYTES_PER_ELEMENT<4),n)throw new Error("Attribute ".concat(this.id," does not support ").concat(t.constructor.name));!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&Dn.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(t=>(t+128)/255*2-1);case 5122:return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case 5121:return new Float32Array(e).map(t=>t/255);case 5123:return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:n,size:o}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let l=o;for(;--l>=0;)t[r+l]=n[l];return t}switch(o){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:n[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:n[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:n[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:n[0];break;default:let l=o;for(;--l>=0;)t[r+l]=Number.isFinite(e[l])?e[l]:n[l]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}}const IM=[],LM=[];function MM(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,r=IM;const n={index:-1,data:i,target:[]};return i?typeof i[Symbol.iterator]=="function"?r=i:i.length>0&&(LM.length=i.length,r=LM):r=IM,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),n.index=e-1),{iterable:r,objectInfo:n}}function PM(i){return i&&i[Symbol.asyncIterator]}function ZK(i,e){const{size:t,stride:r,offset:n,startIndices:o,nested:l}=e,s=i.BYTES_PER_ELEMENT,g=r?r/s:t,b=n?n/s:0,T=Math.floor((i.length-b)/g);return(F,k)=>{let{index:z,target:J}=k;if(!o){const de=z*g+b;for(let _e=0;_e<t;_e++)J[_e]=i[de+_e];return J}const te=o[z],ue=o[z+1]||T;let ce;if(l){ce=new Array(ue-te);for(let de=te;de<ue;de++){const _e=de*g+b;J=new Array(t);for(let Ee=0;Ee<t;Ee++)J[Ee]=i[_e+Ee];ce[de-te]=J}}else if(g===t)ce=i.subarray(te*t+b,ue*t+b);else{ce=new i.constructor((ue-te)*t);let de=0;for(let _e=te;_e<ue;_e++){const Ee=_e*g+b;for(let He=0;He<t;He++)ce[de++]=i[Ee+He]}}return ce}}const JK=[],B1=[[0,1/0]];function YK(i,e){if(i===B1||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return i;const t=[],r=i.length;let n=0;for(let o=0;o<r;o++){const l=i[o];l[1]<e[0]?(t.push(l),n=o+1):l[0]>e[1]?t.push(l):e=[Math.min(l[0],e[0]),Math.max(l[1],e[1])]}return t.splice(n,0,e),t}function rB(i){const{source:e,target:t,start:r=0,size:n,getData:o}=i,l=i.end||t.length,s=e.length,g=l-r;if(s>g){t.set(e.subarray(0,g),r);return}if(t.set(e,r),!o)return;let b=s;for(;b<g;){const T=o(b,e);for(let F=0;F<n;F++)t[r+b]=T[F]||0,b++}}function eW(i){let{source:e,target:t,size:r,getData:n,sourceStartIndices:o,targetStartIndices:l}=i;if(!Array.isArray(l))return rB({source:e,target:t,size:r,getData:n}),t;let s=0,g=0;const b=n&&((F,k)=>n(F+g,k)),T=Math.min(o.length,l.length);for(let F=1;F<T;F++){const k=o[F]*r,z=l[F]*r;rB({source:e.subarray(s,k),target:t,start:g,end:z,size:r,getData:b}),s=k,g=z}return g<t.length&&rB({source:[],target:t,start:g,size:r,getData:b}),t}const tW={interpolation:{duration:0,easing:i=>i},spring:{stiffness:.05,damping:.5}};function FM(i,e){if(!i)return null;Number.isFinite(i)&&(i={type:"interpolation",duration:i});const t=i.type||"interpolation";return{...tW[t],...e,...i,type:t}}function DM(i,e){const t=e.getBuffer();return t?[t,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function RM(i){switch(i){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(i,'"'))}}function kM(i){i.push(i.shift())}function nB(i,e){const{doublePrecision:t,settings:r,value:n,size:o}=i,l=t&&n instanceof Float64Array?2:1;return(r.noAlloc?n.length:e*o)*l}function OM(i){let{buffer:e,numInstances:t,attribute:r,fromLength:n,fromStartIndices:o,getData:l=de=>de}=i;const s=r.doublePrecision&&r.value instanceof Float64Array?2:1,g=r.size*s,b=r.byteOffset,T=r.startIndices,F=o&&T,k=nB(r,t),z=r.isConstant;if(!F&&n>=k)return;const J=z?r.value:r.getBuffer().getData({srcByteOffset:b});if(r.settings.normalized&&!z){const de=l;l=(_e,Ee)=>r.normalizeConstant(de(_e,Ee))}const te=z?(de,_e)=>l(J,_e):(de,_e)=>l(J.subarray(de,de+g),_e),ue=e.getData({length:n}),ce=new Float32Array(k);eW({source:ue,target:ce,sourceStartIndices:o,targetStartIndices:T,size:g,getData:te}),e.byteLength<ce.byteLength+b&&e.reallocate(ce.byteLength+b),e.subData({data:ce,offset:b})}class sB extends XK{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:B1}),ye(this,"constant",!1),this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,n=Array.isArray(t)?e[t.find(o=>e[o])]:e[t];return FM(n,r)}setNeedsUpdate(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,t=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:n=1/0}=t;this.state.updateRanges=YK(this.state.updateRanges,[r,n])}else this.state.updateRanges=B1}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=JK}setNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==B1),!0):!1}updateBuffer(e){let{numInstances:t,data:r,props:n,context:o}=e;if(!this.needsUpdate())return!1;const{state:{updateRanges:l},settings:{update:s,noAlloc:g}}=this;let b=!0;if(s){for(const[T,F]of l)s.call(o,this,{data:r,startRow:T,endRow:F,props:n,numInstances:t});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[T,F]of l){const k=Number.isFinite(T)?this.getVertexOffset(T):0,z=Number.isFinite(F)?this.getVertexOffset(F):g||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:k,endOffset:z})}this._checkAttributeArray()}else b=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),b}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:r,settings:n}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),n.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;sl(ArrayBuffer.isView(l.value),"invalid ".concat(n.accessor));const s=!!l.size&&l.size!==this.size;return r.binaryAccessor=ZK(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:t,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},t={};for(const r in e)Object.assign(t,super.getShaderAttributes(r,e[r]));return t}_autoUpdater(e,t){let{data:r,startRow:n,endRow:o,props:l,numInstances:s}=t;if(e.constant)return;const{settings:g,state:b,value:T,size:F,startIndices:k}=e,{accessor:z,transform:J}=g,te=b.binaryAccessor||(typeof z=="function"?z:l[z]);sl(typeof te=="function",'accessor "'.concat(z,'" is not a function'));let ue=e.getVertexOffset(n);const{iterable:ce,objectInfo:de}=MM(r,n,o);for(const _e of ce){de.index++;let Ee=te(_e,de);if(J&&(Ee=J.call(this,Ee)),k){const He=(de.index<k.length-1?k[de.index+1]:s)-k[de.index];if(Ee&&Array.isArray(Ee[0])){let Ve=ue;for(const qe of Ee)e._normalizeValue(qe,T,Ve),Ve+=F}else Ee&&Ee.length>F?T.set(Ee,ue):(e._normalizeValue(Ee,de.target,0),I$({target:T,source:de.target,start:ue,count:He}));ue+=He*F}else e._normalizeValue(Ee,T,ue),ue+=F}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class iW{constructor(e){let{gl:t,attribute:r,timeline:n}=e;ye(this,"gl",void 0),ye(this,"type","interpolation"),ye(this,"attributeInTransition",void 0),ye(this,"settings",void 0),ye(this,"attribute",void 0),ye(this,"transition",void 0),ye(this,"currentStartIndices",void 0),ye(this,"currentLength",void 0),ye(this,"transform",void 0),ye(this,"buffers",void 0),this.gl=t,this.transition=new vy(n),this.attribute=r,this.attributeInTransition=new sB(t,r.settings),this.currentStartIndices=r.startIndices,this.currentLength=0,this.transform=nW(t,r);const o={byteLength:0,usage:35050};this.buffers=[new bs(t,o),new bs(t,o)]}get inProgress(){return this.transition.inProgress}start(e,t){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:n,attribute:o}=this;kM(n);const l={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of n)OM({buffer:s,...l});this.currentStartIndices=o.startIndices,this.currentLength=nB(o,t),this.attributeInTransition.setData({buffer:n[1],value:o.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aFrom:n[0],aTo:DM(r,o)},feedbackBuffers:{vCurrent:n[1]}})}update(){const e=this.transition.update();if(e){const{duration:t,easing:r}=this.settings,{time:n}=this.transition;let o=n/t;r&&(o=r(o)),this.transform.run({uniforms:{time:o}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const rW=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function nW(i,e){const t=RM(e.size);return new P2(i,{vs:rW,defines:{ATTRIBUTE_TYPE:t},varyings:["vCurrent"]})}class sW{constructor(e){let{gl:t,attribute:r,timeline:n}=e;ye(this,"gl",void 0),ye(this,"type","spring"),ye(this,"attributeInTransition",void 0),ye(this,"settings",void 0),ye(this,"attribute",void 0),ye(this,"transition",void 0),ye(this,"currentStartIndices",void 0),ye(this,"currentLength",void 0),ye(this,"texture",void 0),ye(this,"framebuffer",void 0),ye(this,"transform",void 0),ye(this,"buffers",void 0),this.gl=t,this.type="spring",this.transition=new vy(n),this.attribute=r,this.attributeInTransition=new sB(t,{...r.settings,normalized:!1}),this.currentStartIndices=r.startIndices,this.currentLength=0,this.texture=aW(t),this.framebuffer=lW(t,this.texture),this.transform=oW(t,r,this.framebuffer);const o={byteLength:0,usage:35050};this.buffers=[new bs(t,o),new bs(t,o),new bs(t,o)]}get inProgress(){return this.transition.inProgress}start(e,t){const{gl:r,buffers:n,attribute:o}=this,l={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of n)OM({buffer:s,...l});this.settings=e,this.currentStartIndices=o.startIndices,this.currentLength=nB(o,t),this.attributeInTransition.setData({buffer:n[1],value:o.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:DM(r,o)}})}update(){const{buffers:e,transform:t,framebuffer:r,transition:n}=this;if(!n.update())return!1;const l=this.settings;return t.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),t.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:l.stiffness,damping:l.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),kM(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),$_(r)[0]>0||n.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function oW(i,e,t){const r=RM(e.size);return new P2(i,{framebuffer:t,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function aW(i){return new Xc(i,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function lW(i,e){return new ba(i,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const cW={interpolation:iW,spring:sW};class uW{constructor(e,t){let{id:r,timeline:n}=t;ye(this,"id",void 0),ye(this,"isSupported",void 0),ye(this,"gl",void 0),ye(this,"timeline",void 0),ye(this,"transitions",void 0),ye(this,"needsRedraw",void 0),ye(this,"numInstances",void 0),this.id=r,this.gl=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=P2.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update(e){let{attributes:t,transitions:r,numInstances:n}=e;this.numInstances=n||1;for(const o in t){const l=t[o],s=l.getTransitionSetting(r);s&&this._updateAttribute(o,l,s)}for(const o in this.transitions){const l=t[o];(!l||!l.getTransitionSetting(r))&&this._removeTransition(o)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,t,r){const n=this.transitions[e];let o=!n||n.type!==r.type;if(o){if(!this.isSupported){Dn.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}n&&this._removeTransition(e);const l=cW[r.type];l?this.transitions[e]=new l({attribute:t,timeline:this.timeline,gl:this.gl}):(Dn.error("unsupported transition type '".concat(r.type,"'"))(),o=!1)}(o||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const UM="attributeManager.invalidate",hW="attributeManager.updateStart",AW="attributeManager.updateEnd",dW="attribute.updateStart",fW="attribute.allocate",pW="attribute.updateEnd";class gW{constructor(e){let{id:t="attribute-manager",stats:r,timeline:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ye(this,"id",void 0),ye(this,"gl",void 0),ye(this,"attributes",void 0),ye(this,"updateTriggers",void 0),ye(this,"needsRedraw",void 0),ye(this,"userData",void 0),ye(this,"stats",void 0),ye(this,"attributeTransitionManager",void 0),ye(this,"mergeBoundsMemoized",py(v$)),this.id=t,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new uW(e,{id:"".concat(t,"-transitions"),timeline:n}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);El(UM,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);El(UM,this,"all")}update(e){let{data:t,numInstances:r,startIndices:n=null,transitions:o,props:l={},buffers:s={},context:g={}}=e,b=!1;El(hW,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const T in this.attributes){const F=this.attributes[T],k=F.settings.accessor;F.startIndices=n,F.numInstances=r,l[T]&&Dn.removed("props.".concat(T),"data.attributes.".concat(T))(),F.setExternalBuffer(s[T])||F.setBinaryValue(typeof k=="string"?s[k]:void 0,t.startIndices)||typeof k=="string"&&!s[k]&&F.setConstantValue(l[k])||F.needsUpdate()&&(b=!0,this._updateAttribute({attribute:F,numInstances:r,data:t,props:l,context:g})),this.needsRedraw=this.needsRedraw||F.needsRedraw()}b&&El(AW,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return this.attributes}getBounds(e){const t=e.map(r=>{var n;return(n=this.attributes[r])===null||n===void 0?void 0:n.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:t,attributeTransitionManager:r}=this,n={...r.getAttributes()};for(const o in t){const l=t[o];l.needsRedraw(e)&&!r.hasAttribute(o)&&(n[o]=l)}return n}getShaderAttributes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e||(e=this.getAttributes());const r={};for(const n in e)t[n]||Object.assign(r,e[n].getShaderAttributes());return r}_add(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const r in e){const n=e[r];this.attributes[r]=this._createAttribute(r,n,t)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,t,r){const n={...t,id:e,size:t.isIndexed&&1||t.size||1,divisor:r.instanced?1:t.divisor||0};return new sB(this.gl,n)}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:n}=this,o=n[e];return o&&o.forEach(l=>{const s=r[l];s&&s.setNeedsUpdate(s.id,t)}),o}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(El(dW,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&El(fW,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,El(pW,t,r))}}class mW extends vy{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:n,easing:o}}=this,l=o(e/n);this._value=r1(t,r,l)}}const NM=1e-5;function zM(i,e,t,r,n){const o=e-i,s=(t-e)*n,g=-o*r;return s+g+o+e}function yW(i,e,t,r,n){if(Array.isArray(t)){const o=[];for(let l=0;l<t.length;l++)o[l]=zM(i[l],e[l],t[l],r,n);return o}return zM(i,e,t,r,n)}function QM(i,e){if(Array.isArray(i)){let t=0;for(let r=0;r<i.length;r++){const n=i[r]-e[r];t+=n*n}return Math.sqrt(t)}return Math.abs(i-e)}class _W extends vy{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:n}=this.settings,{_prevValue:o=e,_currValue:l=e}=this;let s=yW(o,l,t,r,n);const g=QM(s,t),b=QM(s,l);g<NM&&b<NM&&(s=t,this.end()),this._prevValue=l,this._currValue=s}}const vW={interpolation:mW,spring:_W};class bW{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,n){const{transitions:o}=this;if(o.has(e)){const g=o.get(e),{value:b=g.settings.fromValue}=g;t=b,this.remove(e)}if(n=FM(n),!n)return;const l=vW[n.type];if(!l){Dn.error("unsupported transition type '".concat(n.type,"'"))();return}const s=new l(this.timeline);s.start({...n,fromValue:t,toValue:r}),o.set(e,s)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function xW(i){const e=i[ld];for(const t in e){const r=e[t],{validate:n}=r;if(n&&!n(i[t],r))throw new Error("Invalid prop ".concat(t,": ").concat(i[t]))}}function wW(i,e){const t=VM({newProps:i,oldProps:e,propTypes:i[ld],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=CW(i,e);let n=!1;return r||(n=EW(i,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:n,extensionsChanged:SW(i,e),transitionsChanged:BW(i,e)}}function BW(i,e){if(!i.transitions)return!1;const t={},r=i[ld];let n=!1;for(const o in i.transitions){const l=r[o],s=l&&l.type;(s==="number"||s==="color"||s==="array")&&oB(i[o],e[o],l)&&(t[o]=!0,n=!0)}return n?t:!1}function VM(i){let{newProps:e,oldProps:t,ignoreProps:r={},propTypes:n={},triggerName:o="props"}=i;if(t===e)return!1;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return"".concat(o," changed shallowly");for(const l of Object.keys(e))if(!(l in r)){if(!(l in t))return"".concat(o,".").concat(l," added");const s=oB(e[l],t[l],n[l]);if(s)return"".concat(o,".").concat(l," ").concat(s)}for(const l of Object.keys(t))if(!(l in r)){if(!(l in e))return"".concat(o,".").concat(l," dropped");if(!Object.hasOwnProperty.call(e,l)){const s=oB(e[l],t[l],n[l]);if(s)return"".concat(o,".").concat(l," ").concat(s)}}return!1}function oB(i,e,t){let r=t&&t.equal;return r&&!r(i,e,t)||!r&&(r=i&&e&&i.equals,r&&!r.call(i,e))?"changed deeply":!r&&e!==i?"changed shallowly":null}function CW(i,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:n}=i;return r?r(i.data,e.data)||(t="Data comparator detected a change"):i.data!==e.data&&(t="A new data container was supplied"),t&&n&&(t=n(i.data,e.data)||t),t}function EW(i,e){if(e===null)return{all:!0};if("all"in i.updateTriggers&&HM(i,e,"all"))return{all:!0};const t={};let r=!1;for(const n in i.updateTriggers)n!=="all"&&HM(i,e,n)&&(t[n]=!0,r=!0);return r?t:!1}function SW(i,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=i;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let n=0;n<r.length;n++)if(!r[n].equals(t[n]))return!0;return!1}function HM(i,e,t){let r=i.updateTriggers[t];r=r??{};let n=e.updateTriggers[t];return n=n??{},VM({oldProps:n,newProps:r,triggerName:t})}const TW="count(): argument not an object",IW="count(): argument not a container";function LW(i){if(!PW(i))throw new Error(TW);if(typeof i.count=="function")return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(MW(i))return Object.keys(i).length;throw new Error(IW)}function MW(i){return i!==null&&typeof i=="object"&&i.constructor===Object}function PW(i){return i!==null&&typeof i=="object"}function FW(i,e){if(!e)return i;const t={...i,...e};if("defines"in e&&(t.defines={...i.defines,...e.defines}),"modules"in e&&(t.modules=(i.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(n=>n.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!i.inject)t.inject=e.inject;else{const r={...i.inject};for(const n in e.inject)r[n]=(r[n]||"")+e.inject[n];t.inject=r}return t}const DW={10241:9987,10240:9729,10242:33071,10243:33071},aB={};function RW(i,e,t,r){if(t instanceof Xc)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let n=null;t.compressed&&(n={10241:t.data.length>1?9985:9729});const o=new Xc(e,{...t,parameters:{...DW,...n,...r}});return aB[o.id]=i,o}function kW(i,e){!e||!(e instanceof Xc)||aB[e.id]===i&&(e.delete(),delete aB[e.id])}const OW={boolean:{validate(i,e){return!0},equal(i,e,t){return!!i==!!e}},number:{validate(i,e){return Number.isFinite(i)&&(!("max"in e)||i<=e.max)&&(!("min"in e)||i>=e.min)}},color:{validate(i,e){return e.optional&&!i||lB(i)&&(i.length===3||i.length===4)},equal(i,e,t){return zh(i,e,1)}},accessor:{validate(i,e){const t=C1(i);return t==="function"||t===C1(e.value)},equal(i,e,t){return typeof e=="function"?!0:zh(i,e,1)}},array:{validate(i,e){return e.optional&&!i||lB(i)},equal(i,e,t){const{compare:r}=t,n=Number.isInteger(r)?r:r?1:0;return r?zh(i,e,n):i===e}},object:{equal(i,e,t){if(t.ignore)return!0;const{compare:r}=t,n=Number.isInteger(r)?r:r?1:0;return r?zh(i,e,n):i===e}},function:{validate(i,e){return e.optional&&!i||typeof i=="function"},equal(i,e,t){return!t.compare&&t.ignore!==!1||i===e}},data:{transform:(i,e,t)=>{const{dataTransform:r}=t.props;return r&&i?r(i):i}},image:{transform:(i,e,t)=>{const r=t.context;return!r||!r.gl?null:RW(t.id,r.gl,i,{...e.parameters,...t.props.textureParameters})},release:(i,e,t)=>{kW(t.id,i)}}};function UW(i){const e={},t={},r={};for(const[n,o]of Object.entries(i)){const l=o==null?void 0:o.deprecatedFor;if(l)r[n]=Array.isArray(l)?l:[l];else{const s=NW(n,o);e[n]=s,t[n]=s.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function NW(i,e){switch(C1(e)){case"object":return xy(i,e);case"array":return xy(i,{type:"array",value:e,compare:!1});case"boolean":return xy(i,{type:"boolean",value:e});case"number":return xy(i,{type:"number",value:e});case"function":return xy(i,{type:"function",value:e,compare:!0});default:return{name:i,type:"unknown",value:e}}}function xy(i,e){return"type"in e?{name:i,...OW[e.type],...e}:"value"in e?{name:i,type:C1(e.value),...e}:{name:i,type:"object",value:e}}function lB(i){return Array.isArray(i)||ArrayBuffer.isView(i)}function C1(i){return lB(i)?"array":i===null?"null":typeof i}function zW(i,e){let t;for(let o=e.length-1;o>=0;o--){const l=e[o];"extensions"in l&&(t=l.extensions)}const r=cB(i.constructor,t),n=Object.create(r);n[y1]=i,n[bf]={},n[cd]={};for(let o=0;o<e.length;++o){const l=e[o];for(const s in l)n[s]=l[s]}return Object.freeze(n),n}const QW="_mergedDefaultProps";function cB(i,e){let t=QW;if(e)for(const n of e){const o=n.constructor;o&&(t+=":".concat(o.extensionName||o.name))}const r=GM(i,t);return r||(i[t]=VW(i,e||[]))}function VW(i,e){if(!i.prototype)return null;const r=Object.getPrototypeOf(i),n=cB(r),o=GM(i,"defaultProps")||{},l=UW(o),s=Object.assign(Object.create(null),n,l.defaultProps),g=Object.assign(Object.create(null),n==null?void 0:n[ld],l.propTypes),b=Object.assign(Object.create(null),n==null?void 0:n[G2],l.deprecatedProps);for(const T of e){const F=cB(T.constructor);F&&(Object.assign(s,F),Object.assign(g,F[ld]),Object.assign(b,F[G2]))}return HW(s,i),jW(s,g),GW(s,b),s[ld]=g,s[G2]=b,e.length===0&&!uB(i,"_propTypes")&&(i._propTypes=g),s}function HW(i,e){const t=$W(e);Object.defineProperties(i,{id:{writable:!0,value:t}})}function GW(i,e){for(const t in e)Object.defineProperty(i,t,{enumerable:!1,set(r){const n="".concat(this.id,": ").concat(t);for(const o of e[t])uB(this,o)||(this[o]=r);Dn.deprecated(n,e[t].join("/"))()}})}function jW(i,e){const t={},r={};for(const n in e){const o=e[n],{name:l,value:s}=o;o.async&&(t[l]=s,r[l]=qW(l))}i[og]=t,i[bf]={},Object.defineProperties(i,r)}function qW(i){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||PM(e)?this[bf][i]=e:this[cd][i]=e},get(){if(this[cd]){if(i in this[cd])return this[cd][i]||this[og][i];if(i in this[bf]){const e=this[y1]&&this[y1].internalState;if(e&&e.hasAsyncProp(i))return e.getAsyncProp(i)||this[og][i]}}return this[og][i]}}}function uB(i,e){return Object.prototype.hasOwnProperty.call(i,e)}function GM(i,e){return uB(i,e)&&i[e]}function $W(i){const e=i.componentName;return e||Dn.warn("".concat(i.name,".componentName not specified"))(),e||i.name}let KW=0;class hB{constructor(){ye(this,"id",void 0),ye(this,"props",void 0),ye(this,"count",void 0);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.props=zW(this,t),this.id=this.props.id,this.count=KW++}clone(e){const{props:t}=this,r={};for(const n in t[og])n in t[cd]?r[n]=t[cd][n]:n in t[bf]&&(r[n]=t[bf][n]);return new this.constructor({...t,...r,...e})}}ye(hB,"componentName","Component"),ye(hB,"defaultProps",{});const WW=Object.freeze({});class XW{constructor(e){ye(this,"component",void 0),ye(this,"onAsyncPropUpdated",void 0),ye(this,"asyncProps",void 0),ye(this,"oldProps",void 0),ye(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||WW}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[y1]||this.component;const t=e[cd]||{},r=e[bf]||e,n=e[og]||{};for(const o in t){const l=t[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,l),t[o]=this.getAsyncProp(o)}for(const o in r){const l=r[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,l)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(PM(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const n=this.asyncProps[e];n&&r>=n.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=t,n.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const n=r.pendingLoadCount;t.then(o=>{this.component&&(o=this._postProcessValue(r,o),this._setAsyncPropValue(e,o,n),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const n=r.pendingLoadCount;let o=[],l=0;for await(const s of t){if(!this.component)return;const{dataTransform:g}=this.component.props;g?o=g(s,o):o=o.concat(s),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:l,endRow:o.length}]}),l=o.length,this._setAsyncPropValue(e,o,n)}this._onResolve(e,o)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.props[ld];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class ZW extends XW{constructor(e){let{attributeManager:t,layer:r}=e;super(r),ye(this,"attributeManager",void 0),ye(this,"needsRedraw",void 0),ye(this,"needsUpdate",void 0),ye(this,"subLayers",void 0),ye(this,"usesPickingColorCache",void 0),ye(this,"hasPickingBuffer",void 0),ye(this,"changeFlags",void 0),ye(this,"viewport",void 0),ye(this,"uniformTransitions",void 0),ye(this,"propsInTransition",void 0),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,n=r==null?void 0:r.props.fetch;return n?n(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const n=r.props.onDataLoad;e==="data"&&n&&n(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,"loading ".concat(e," of ").concat(this.layer))}}const JW="layer.changeFlag",YW="layer.initialize",eX="layer.update",tX="layer.finalize",iX="layer.matched",jM=2**24-1,rX=Object.freeze([]),nX=py(i=>{let{oldViewport:e,viewport:t}=i;return e.equals(t)});let Vh=new Uint8ClampedArray(0);const sX={data:{type:"data",value:rX,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:i=>i&&i.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(i,e)=>{let{propName:t,layer:r,loaders:n,loadOptions:o,signal:l}=e;const{resourceManager:s}=r.context;if(o=o||r.getLoadOptions(),n=n||r.props.loaders,l){var g;o={...o,fetch:{...(g=o)===null||g===void 0?void 0:g.fetch,signal:l}}}let b=s.contains(i);return!b&&!o&&(s.add({resourceId:i,data:id(i,n),persistent:!1}),b=!0),b?s.subscribe({resourceId:i,onChange:T=>{var F;return(F=r.internalState)===null||F===void 0?void 0:F.reloadAsyncProp(t,T)},consumerId:r.id,requestId:t}):id(i,n,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ln.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:i=>{let{layerIndex:e}=i;return[0,-e*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class cg extends hB{constructor(){super(...arguments),ye(this,"internalState",null),ye(this,"lifecycle",sg.NO_STATE),ye(this,"context",void 0),ye(this,"state",void 0),ye(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){sl(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=rM(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,o,l]=WL(r,t.pixelProjectionMatrix);return e.length===2?[n,o]:[n,o,l]}unproject(e){return sl(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){sl(this.internalState);const r=this.internalState.viewport||this.context.viewport;return E$(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ln.DEFAULT||e===Ln.LNGLAT||e===Ln.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){sl(e instanceof Uint8Array);const[t,r,n]=e;return t+r*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:LW(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const t of this.props.extensions)e=FW(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const n of r)t.invalidateAll(n);else t.invalidateAll();if(t){const{props:n}=e,o=this.internalState.hasPickingBuffer,l=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(s=>s.getNeedsPickingBuffer.call(this,s));if(o!==l){this.internalState.hasPickingBuffer=l;const{pickingColors:s,instancePickingColors:g}=t.attributes,b=s||g;b&&(l&&b.constant&&(b.constant=!1,t.invalidate(b.id)),!b.value&&!l&&(b.constant=!0,b.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.delete();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo(e){let{info:t,mode:r,sourceLayer:n}=e;const{index:o}=t;return o>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[o]),t}raiseError(e,t){var r,n;if(t&&(e=new Error("".concat(t,": ").concat(e.message),{cause:e})),!((r=(n=this.props).onError)!==null&&r!==void 0&&r.call(n,e))){var o,l;(o=this.context)===null||o===void 0||(l=o.onError)===null||l===void 0||l.call(o,e,this)}}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!nX({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){for(const t of this.getModels())this._setModelAttributes(t,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),n=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:n,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const n in t)Object.defineProperty(r,n,{value:t[n]});return r}return this.props}calculateInstancePickingColors(e,t){let{numInstances:r}=t;if(e.constant)return;const n=Math.floor(Vh.length/3);if(this.internalState.usesPickingColorCache=!0,n<r){r>jM&&Dn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Vh=my.allocate(Vh,r,{size:3,copy:!0,maxCount:Math.max(r,jM)});const o=Math.floor(Vh.length/3),l=[];for(let s=n;s<o;s++)this.encodePickingColor(s,l),Vh[s*3+0]=l[0],Vh[s*3+1]=l[1],Vh[s*3+2]=l[2]}e.value=Vh.subarray(0,r*3)}_setModelAttributes(e,t){const r=this.getAttributeManager(),n=e.userData.excludeAttributes||{},o=r.getShaderAttributes(t,n);e.setAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,o=r||n,l=o&&t.attributes&&t.attributes[o.id];if(l&&l.value){const s=l.value,g=this.encodePickingColor(e);for(let b=0;b<t.length;b++){const T=o.getVertexOffset(b);s[T]===g[0]&&s[T+1]===g[1]&&s[T+2]===g[2]&&this._disablePickingIndex(b)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,n=t||r;if(!n)return;const o=n.getVertexOffset(e),l=n.getVertexOffset(e+1);n.buffer.subData({data:new Uint8Array(l-o),offset:o})}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Vh.buffer&&(r.value=Vh.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){sl(!this.internalState),sl(Number.isFinite(this.props.coordinateSystem)),El(YW,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new ZW({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Dn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new bW(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){El(iX,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(El(eX,this,e),!e)return;const t=this.props,r=this.context,n=this.internalState,o=r.viewport,l=this._updateUniformTransition();n.propsInTransition=l,r.viewport=n.viewport||o,this.props=l;try{const s=this._getUpdateParams(),g=this.getModels();if(r.gl)this.updateState(s);else try{this.updateState(s)}catch{}for(const T of this.props.extensions)T.updateState.call(this,s,T);const b=this.getModels()[0]!==g[0];this._postUpdate(s,b)}finally{r.viewport=o,this.props=t,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){El(tX,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer(e){let{moduleParameters:t=null,uniforms:r={},parameters:n={}}=e;this._updateAttributeTransition();const o=this.props,l=this.context;this.props=this.internalState.propsInTransition||o;const s=this.props.opacity;r.opacity=Math.pow(s,1/2.2);try{t&&this.setModuleParameters(t);const{getPolygonOffset:g}=this.props,b=g&&g(r)||[0,0];bA(l.gl,{polygonOffset:b}),Ju(l.gl,n,()=>{const T={moduleParameters:t,uniforms:r,parameters:n,context:l};for(const F of this.props.extensions)F.draw.call(this,T,F);this.draw(T)})}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const n in e)if(e[n]){let o=!1;switch(n){case"dataChanged":const l=e[n],s=t[n];l&&Array.isArray(s)&&(t.dataChanged=Array.isArray(l)?s.concat(l):l,o=!0);default:t[n]||(t[n]=e[n],o=!0)}o&&El(JW,this,n,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const r=wW(e,t);if(r.updateTriggersChanged)for(const o in r.updateTriggersChanged)r.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(r.transitionsChanged)for(const o in r.transitionsChanged){var n;this.internalState.uniformTransitions.add(o,t[o],e[o],(n=e.transitions)===null||n===void 0?void 0:n[o])}return this.setChangeFlags(r)}validateProps(){xW(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.pickingHighlightColor=r(e)),this.setModuleParameters(t),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new gW(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:n}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:o}=this.state;o==null||o.setInstanceCount(this.getNumInstances());const{autoHighlight:l,highlightedObjectIndex:s,highlightColor:g}=r;if(t||n.autoHighlight!==l||n.highlightedObjectIndex!==s||n.highlightColor!==g){const b={};l||(b.pickingSelectedColor=null),Array.isArray(g)&&(b.pickingHighlightColor=g),(t||s!==n.highlightedObjectIndex)&&(b.pickingSelectedColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setModuleParameters(b)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),n=r?r.getNeedsRedraw(e):!1;if(t=t||n,t)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}ye(cg,"defaultProps",sX),ye(cg,"layerName","Layer");const oX="compositeLayer.renderLayers";class qM extends cg{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo(e){let{info:t}=e;const{object:r}=t;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(t.object=r.__source.object,t.index=r.__source.index),t}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(r,n)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,n)}return e}getSubLayerProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var t;const{opacity:r,pickable:n,visible:o,parameters:l,getPolygonOffset:s,highlightedObjectIndex:g,autoHighlight:b,highlightColor:T,coordinateSystem:F,coordinateOrigin:k,wrapLongitude:z,positionFormat:J,modelMatrix:te,extensions:ue,fetch:ce,operation:de,_subLayerProps:_e}=this.props,Ee={id:"",updateTriggers:{},opacity:r,pickable:n,visible:o,parameters:l,getPolygonOffset:s,highlightedObjectIndex:g,autoHighlight:b,highlightColor:T,coordinateSystem:F,coordinateOrigin:k,wrapLongitude:z,positionFormat:J,modelMatrix:te,extensions:ue,fetch:ce,operation:de},He=_e&&e.id&&_e[e.id],Ve=He&&He.updateTriggers,qe=e.id||"sublayer";if(He){const Ue=this.props[ld],ot=e.type?e.type._propTypes:{};for(const it in He){const De=ot[it]||Ue[it];De&&De.type==="accessor"&&(He[it]=this.getSubLayerAccessor(He[it]))}}Object.assign(Ee,e,He),Ee.id="".concat(this.props.id,"-").concat(qe),Ee.updateTriggers={all:(t=this.props.updateTriggers)===null||t===void 0?void 0:t.all,...e.updateTriggers,...Ve};for(const Ue of ue){const ot=Ue.getSubLayerProps.call(this,Ue);ot&&Object.assign(Ee,ot,{updateTriggers:Object.assign(Ee.updateTriggers,ot.updateTriggers)})}return Ee}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers;const n=!r||this.needsUpdate();if(n){const o=this.renderLayers();r=_1(o,Boolean),this.internalState.subLayers=r}El(oX,this,n,r);for(const o of r)o.parent=this}}ye(qM,"layerName","CompositeLayer");const AB=512,aX=Math.PI/180;function lX(i){let{map:e,gl:t,deck:r}=i;if(e.__deck)return e.__deck;const n=r==null?void 0:r.props._customRender,o=r==null?void 0:r.props.onLoad,l=uX({...r==null?void 0:r.props,_customRender:()=>{e.triggerRepaint(),n==null||n("")}});let s;return(!r||r.props.gl===t)&&(Object.assign(l,{gl:t,width:null,height:null,touchAction:"unset",viewState:dB(e)}),r!=null&&r.isInitialized?$M(r,e):l.onLoad=()=>{o==null||o(),$M(s,e)}),r?(s=r,r.setProps(l),r.userData.isExternal=!0):(s=new tB(l),e.on("remove",()=>{cX(e)})),s.userData.mapboxLayers=new Set,e.__deck=s,e.on("render",()=>{s.isInitialized&&gX(s,e)}),s}function $M(i,e){const t=()=>{i.isInitialized?mX(i,e):e.off("move",t)};e.on("move",t)}function cX(i){var e;(e=i.__deck)===null||e===void 0||e.finalize(),i.__deck=null}function uX(i){return{...i,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...i.parameters},views:i.views||[new K2({id:"mapbox"})]}}function hX(i,e){i.userData.mapboxLayers.add(e),fB(i)}function AX(i,e){i.userData.mapboxLayers.delete(e),fB(i)}function dX(i,e){fB(i)}function fX(i,e,t){let{currentViewport:r}=i.userData,n=!1;r||(r=KM(i,e,!0),i.userData.currentViewport=r,n=!0),i.isInitialized&&i._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:o=>{let{layer:l}=o;return t.id===l.id||l.props.operation.includes("terrain")},clearStack:n,clearCanvas:!1})}function dB(i){var e;const{lng:t,lat:r}=i.getCenter(),n={longitude:(t+540)%360-180,latitude:r,zoom:i.getZoom(),bearing:i.getBearing(),pitch:i.getPitch(),padding:i.getPadding(),repeat:i.getRenderWorldCopies()};return(e=i.getTerrain)!==null&&e!==void 0&&e.call(i)&&pX(i,n),n}function pX(i,e){if(i.getFreeCameraOptions){const{position:t}=i.getFreeCameraOptions();if(!t||t.z===void 0)return;const r=i.transform.height,{longitude:n,latitude:o,pitch:l}=e,s=t.x*AB,g=(1-t.y)*AB,b=t.z*AB,T=gy([n,o]),F=s-T[0],k=g-T[1],z=Math.sqrt(F*F+k*k),J=l*aX,te=1.5*r,ue=J<.001?te*Math.cos(J)/b:te*Math.sin(J)/z;e.zoom=Math.log2(ue);const ce=te*Math.cos(J)/ue,de=b-ce;e.position=[0,0,de/g1(o)]}else typeof i.transform.elevation=="number"&&(e.position=[0,0,i.transform.elevation])}function KM(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new vf({id:"mapbox",x:0,y:0,width:i.width,height:i.height,...dB(e),nearZMultiplier:t?.02:.1,nearZ:e.transform._nearZ/e.transform.height,farZ:e.transform._farZ/e.transform.height})}function gX(i,e){const{mapboxLayers:t,isExternal:r}=i.userData;if(r){const n=Array.from(t,T=>T.id),l=_1(i.props.layers,Boolean).some(T=>T&&!n.includes(T.id));let s=i.getViewports();const g=s.findIndex(T=>T.id==="mapbox"),b=s.length>1||g<0;(l||b)&&(g>=0&&(s=s.slice(),s[g]=KM(i,e,!1)),i._drawLayers("mapbox-repaint",{viewports:s,layerFilter:T=>(!i.props.layerFilter||i.props.layerFilter(T))&&(T.viewport.id!=="mapbox"||!n.includes(T.layer.id)),clearCanvas:!1}))}i.userData.currentViewport=null}function mX(i,e){i.setProps({viewState:dB(e)}),i.needsRedraw({clearRedrawFlags:!0})}function fB(i){if(i.userData.isExternal)return;const e=[];i.userData.mapboxLayers.forEach(t=>{const r=t.props.type,n=new r(t.props);e.push(n)}),i.setProps({layers:e})}class yX{constructor(e){if(ye(this,"id",void 0),ye(this,"type",void 0),ye(this,"renderingMode",void 0),ye(this,"map",void 0),ye(this,"deck",void 0),ye(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=lX({map:e,gl:t,deck:this.props.deck}),hX(this.deck,this)}onRemove(){this.deck&&AX(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&dX(this.deck)}render(){fX(this.deck,this.map,this)}}const _X=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,vX=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,WM=[0,0,0,255],XM=[0,0,1],bX={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:i=>i.position},getNormal:{type:"accessor",value:XM},getColor:{type:"accessor",value:WM},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function xX(i){const{header:e,attributes:t}=i;!e||!t||(i.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0&&(t.instanceColors=t.COLOR_0))}class pB extends cg{getShaders(){return super.getShaders({vs:_X,fs:vX,modules:[j2,Wj,q2]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:XM},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:WM}})}updateState(e){const{changeFlags:t,props:r}=e;if(super.updateState(e),t.extensionsChanged){var n;const{gl:o}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}t.dataChanged&&xX(r.data)}draw(e){let{uniforms:t}=e;const{pointSize:r,sizeUnits:n}=this.props;this.state.model.setUniforms(t).setUniforms({sizeUnits:Qw[n],radiusPixels:r}).draw()}_getModel(e){const t=[];for(let r=0;r<3;r++){const n=r/3*Math.PI*2;t.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new Yp(e,{...this.getShaders(),id:this.props.id,geometry:new fy({drawMode:4,attributes:{positions:new Float32Array(t)}}),isInstanced:!0})}}ye(pB,"layerName","PointCloudLayer"),ye(pB,"defaultProps",bX);const eu={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new Ut,new Ut;const wy=new Ut,ZM=new Ut;class By{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;ye(this,"center",void 0),ye(this,"radius",void 0),this.radius=-0,this.center=new Ut,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=wy.from(t),this.center=new Ut().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new By(this.center,this.radius)}union(e){const t=this.center,r=this.radius,n=e.center,o=e.radius,l=wy.copy(n).subtract(t),s=l.magnitude();if(r>=s+o)return this.clone();if(o>=s+r)return e.clone();const g=(r+s+o)*.5;return ZM.copy(l).scale((-r+g)/s).add(t),this.center.copy(ZM),this.radius=g,this}expand(e){const r=wy.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const t=sj(wy,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const r=wy.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const t=this.center,r=this.radius,o=e.normal.dot(t)+e.distance;return o<-r?eu.OUTSIDE:o<r?eu.INTERSECTING:eu.INSIDE}}const wX=new Ut,BX=new Ut,E1=new Ut,S1=new Ut,T1=new Ut,CX=new Ut,EX=new Ut,TA={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Cy{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];ye(this,"center",void 0),ye(this,"halfAxes",void 0),this.center=new Ut().from(e),this.halfAxes=new xo(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new Ut(e).len(),new Ut(t).len(),new Ut(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),n=new Ut(e).normalize(),o=new Ut(t).normalize(),l=new Ut(r).normalize();return new hy().fromMatrix3(new xo([...n,...o,...l]))}fromCenterHalfSizeQuaternion(e,t,r){const n=new hy(r),o=new xo().fromQuaternion(n);return o[0]=o[0]*t[0],o[1]=o[1]*t[0],o[2]=o[2]*t[0],o[3]=o[3]*t[1],o[4]=o[4]*t[1],o[5]=o[5]*t[1],o[6]=o[6]*t[2],o[7]=o[7]*t[2],o[8]=o[8]*t[2],this.center=new Ut().from(e),this.halfAxes=o,this}clone(){return new Cy(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new By;const t=this.halfAxes,r=t.getColumn(0,E1),n=t.getColumn(1,S1),o=t.getColumn(2,T1),l=wX.copy(r).add(n).add(o);return e.center.copy(this.center),e.radius=l.magnitude(),e}intersectPlane(e){const t=this.center,r=e.normal,n=this.halfAxes,o=r.x,l=r.y,s=r.z,g=Math.abs(o*n[TA.COLUMN0ROW0]+l*n[TA.COLUMN0ROW1]+s*n[TA.COLUMN0ROW2])+Math.abs(o*n[TA.COLUMN1ROW0]+l*n[TA.COLUMN1ROW1]+s*n[TA.COLUMN1ROW2])+Math.abs(o*n[TA.COLUMN2ROW0]+l*n[TA.COLUMN2ROW1]+s*n[TA.COLUMN2ROW2]),b=r.dot(t)+e.distance;return b<=-g?eu.OUTSIDE:b>=g?eu.INSIDE:eu.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=BX.from(e).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,E1),o=r.getColumn(1,S1),l=r.getColumn(2,T1),s=n.magnitude(),g=o.magnitude(),b=l.magnitude();n.normalize(),o.normalize(),l.normalize();let T=0,F;return F=Math.abs(t.dot(n))-s,F>0&&(T+=F*F),F=Math.abs(t.dot(o))-g,F>0&&(T+=F*F),F=Math.abs(t.dot(l))-b,F>0&&(T+=F*F),T}computePlaneDistances(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const l=this.center,s=this.halfAxes,g=s.getColumn(0,E1),b=s.getColumn(1,S1),T=s.getColumn(2,T1),F=CX.copy(g).add(b).add(T).add(l),k=EX.copy(F).subtract(e);let z=t.dot(k);return n=Math.min(z,n),o=Math.max(z,o),F.copy(l).add(g).add(b).subtract(T),k.copy(F).subtract(e),z=t.dot(k),n=Math.min(z,n),o=Math.max(z,o),F.copy(l).add(g).subtract(b).add(T),k.copy(F).subtract(e),z=t.dot(k),n=Math.min(z,n),o=Math.max(z,o),F.copy(l).add(g).subtract(b).subtract(T),k.copy(F).subtract(e),z=t.dot(k),n=Math.min(z,n),o=Math.max(z,o),l.copy(F).subtract(g).add(b).add(T),k.copy(F).subtract(e),z=t.dot(k),n=Math.min(z,n),o=Math.max(z,o),l.copy(F).subtract(g).add(b).subtract(T),k.copy(F).subtract(e),z=t.dot(k),n=Math.min(z,n),o=Math.max(z,o),l.copy(F).subtract(g).subtract(b).add(T),k.copy(F).subtract(e),z=t.dot(k),n=Math.min(z,n),o=Math.max(z,o),l.copy(F).subtract(g).subtract(b).subtract(T),k.copy(F).subtract(e),z=t.dot(k),n=Math.min(z,n),o=Math.max(z,o),r[0]=n,r[1]=o,r}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,E1);t.transformAsPoint(e);const r=this.halfAxes.getColumn(1,S1);r.transformAsPoint(e);const n=this.halfAxes.getColumn(2,T1);return n.transformAsPoint(e),this.halfAxes=new xo([...t,...r,...n]),this}getTransform(){throw new Error("not implemented")}}const JM=new Ut,YM=new Ut;class rh{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;ye(this,"normal",void 0),ye(this,"distance",void 0),this.normal=new Ut,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return Yu(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=JM.from(e),this.normal.from(t).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,t,r,n){return this.normal.set(e,t,r),Yu(eh(this.normal.len(),1)),this.distance=n,this}clone(){return new rh(this.normal,this.distance)}equals(e){return eh(this.distance,e.distance)&&eh(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=YM.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,t)}projectPointOntoPlane(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];e=JM.from(e);const r=this.getPointDistance(e),n=YM.copy(this.normal).scale(r);return e.subtract(n).to(t)}}const eP=[new Ut([1,0,0]),new Ut([0,1,0]),new Ut([0,0,1])],tP=new Ut,SX=new Ut;new rh(new Ut(1,0,0),0);class Cu{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];ye(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*eP.length;const t=e.center,r=e.radius;let n=0;for(const o of eP){let l=this.planes[n],s=this.planes[n+1];l||(l=this.planes[n]=new rh),s||(s=this.planes[n+1]=new rh);const g=tP.copy(o).scale(-r).add(t);-o.dot(g),l.fromPointNormal(g,o);const b=tP.copy(o).scale(r).add(t),T=SX.copy(o).negate();-T.dot(b),s.fromPointNormal(b,T),n+=2}return this}computeVisibility(e){let t=eu.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case eu.OUTSIDE:return eu.OUTSIDE;case eu.INTERSECTING:t=eu.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(Yu(Number.isFinite(t),"parentPlaneMask is required."),t===Cu.MASK_OUTSIDE||t===Cu.MASK_INSIDE)return t;let r=Cu.MASK_INSIDE;const n=this.planes;for(let o=0;o<this.planes.length;++o){const l=o<31?1<<o:0;if(o<31&&!(t&l))continue;const s=n[o],g=e.intersectPlane(s);if(g===eu.OUTSIDE)return Cu.MASK_OUTSIDE;g===eu.INTERSECTING&&(r|=l)}return r}}ye(Cu,"MASK_OUTSIDE",4294967295),ye(Cu,"MASK_INSIDE",0),ye(Cu,"MASK_INDETERMINATE",2147483647),new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut;const Hh=new xo,TX=new xo,IX=new xo,I1=new xo,iP=new xo;function LX(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=Ay.EPSILON20,r=10;let n=0,o=0;const l=TX,s=IX;l.identity(),s.copy(i);const g=t*MX(s);for(;o<r&&PX(s)>g;)FX(s,I1),iP.copy(I1).transpose(),s.multiplyRight(I1),s.multiplyLeft(iP),l.multiplyRight(I1),++n>2&&(++o,n=0);return e.unitary=l.toTarget(e.unitary),e.diagonal=s.toTarget(e.diagonal),e}function MX(i){let e=0;for(let t=0;t<9;++t){const r=i[t];e+=r*r}return Math.sqrt(e)}const gB=[1,0,0],mB=[2,2,1];function PX(i){let e=0;for(let t=0;t<3;++t){const r=i[Hh.getElementIndex(mB[t],gB[t])];e+=2*r*r}return Math.sqrt(e)}function FX(i,e){const t=Ay.EPSILON15;let r=0,n=1;for(let b=0;b<3;++b){const T=Math.abs(i[Hh.getElementIndex(mB[b],gB[b])]);T>r&&(n=b,r=T)}const o=gB[n],l=mB[n];let s=1,g=0;if(Math.abs(i[Hh.getElementIndex(l,o)])>t){const b=i[Hh.getElementIndex(l,l)],T=i[Hh.getElementIndex(o,o)],F=i[Hh.getElementIndex(l,o)],k=(b-T)/2/F;let z;k<0?z=-1/(-k+Math.sqrt(1+k*k)):z=1/(k+Math.sqrt(1+k*k)),s=1/Math.sqrt(1+z*z),g=z*s}return xo.IDENTITY.to(e),e[Hh.getElementIndex(o,o)]=e[Hh.getElementIndex(l,l)]=s,e[Hh.getElementIndex(l,o)]=g,e[Hh.getElementIndex(o,l)]=-g,e}const dd=new Ut,DX=new Ut,RX=new Ut,kX=new Ut,OX=new Ut,UX=new xo,NX={diagonal:new xo,unitary:new xo};function zX(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Cy;if(!i||i.length===0)return e.halfAxes=new xo([0,0,0,0,0,0,0,0,0]),e.center=new Ut,e;const t=i.length,r=new Ut(0,0,0);for(const ot of i)r.add(ot);const n=1/t;r.multiplyByScalar(n);let o=0,l=0,s=0,g=0,b=0,T=0;for(const ot of i){const it=dd.copy(ot).subtract(r);o+=it.x*it.x,l+=it.x*it.y,s+=it.x*it.z,g+=it.y*it.y,b+=it.y*it.z,T+=it.z*it.z}o*=n,l*=n,s*=n,g*=n,b*=n,T*=n;const F=UX;F[0]=o,F[1]=l,F[2]=s,F[3]=l,F[4]=g,F[5]=b,F[6]=s,F[7]=b,F[8]=T;const{unitary:k}=LX(F,NX),z=e.halfAxes.copy(k);let J=z.getColumn(0,RX),te=z.getColumn(1,kX),ue=z.getColumn(2,OX),ce=-Number.MAX_VALUE,de=-Number.MAX_VALUE,_e=-Number.MAX_VALUE,Ee=Number.MAX_VALUE,He=Number.MAX_VALUE,Ve=Number.MAX_VALUE;for(const ot of i)dd.copy(ot),ce=Math.max(dd.dot(J),ce),de=Math.max(dd.dot(te),de),_e=Math.max(dd.dot(ue),_e),Ee=Math.min(dd.dot(J),Ee),He=Math.min(dd.dot(te),He),Ve=Math.min(dd.dot(ue),Ve);J=J.multiplyByScalar(.5*(Ee+ce)),te=te.multiplyByScalar(.5*(He+de)),ue=ue.multiplyByScalar(.5*(Ve+_e)),e.center.copy(J).add(te).add(ue);const qe=DX.set(ce-Ee,de-He,_e-Ve).multiplyByScalar(.5),Ue=new xo([qe[0],0,0,0,qe[1],0,0,0,qe[2]]);return e.halfAxes.multiplyRight(Ue),e}const yB=Math.PI/180,L1=new Float32Array(16),rP=new Float32Array(12);function nP(i,e,t){const r=e[0]*yB,n=e[1]*yB,o=e[2]*yB,l=Math.sin(o),s=Math.sin(r),g=Math.sin(n),b=Math.cos(o),T=Math.cos(r),F=Math.cos(n),k=t[0],z=t[1],J=t[2];i[0]=k*F*T,i[1]=k*g*T,i[2]=k*-s,i[3]=z*(-g*b+F*s*l),i[4]=z*(F*b+g*s*l),i[5]=z*T*l,i[6]=J*(g*l+F*s*b),i[7]=J*(-F*l+g*s*b),i[8]=J*T*b}function sP(i){return i[0]=i[0],i[1]=i[1],i[2]=i[2],i[3]=i[4],i[4]=i[5],i[5]=i[6],i[6]=i[8],i[7]=i[9],i[8]=i[10],i[9]=i[12],i[10]=i[13],i[11]=i[14],i.subarray(0,12)}const oP={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(i,e){let{startRow:t,endRow:r}=e;const{data:n,getOrientation:o,getScale:l,getTranslation:s,getTransformMatrix:g}=this.props,b=Array.isArray(g),T=b&&g.length===16,F=Array.isArray(l),k=Array.isArray(o),z=Array.isArray(s),J=T||!b&&!!g(n[0]);J?i.constant=T:i.constant=k&&F&&z;const te=i.value;if(i.constant){let ue;J?(L1.set(g),ue=sP(L1)):(ue=rP,nP(ue,o,l),ue.set(s,9)),i.value=new Float32Array(ue)}else{let ue=t*i.size;const{iterable:ce,objectInfo:de}=MM(n,t,r);for(const _e of ce){de.index++;let Ee;if(J)L1.set(T?g:g(_e,de)),Ee=sP(L1);else{Ee=rP;const He=k?o:o(_e,de),Ve=F?l:l(_e,de);nP(Ee,He,Ve),Ee.set(z?s:s(_e,de),9)}te[ue++]=Ee[0],te[ue++]=Ee[1],te[ue++]=Ee[2],te[ue++]=Ee[3],te[ue++]=Ee[4],te[ue++]=Ee[5],te[ue++]=Ee[6],te[ue++]=Ee[7],te[ue++]=Ee[8],te[ue++]=Ee[9],te[ue++]=Ee[10],te[ue++]=Ee[11]}}}};function aP(i,e){return e===Ln.CARTESIAN||e===Ln.METER_OFFSETS||e===Ln.DEFAULT&&!i.isGeospatial}const QX=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,VX=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function lP(i){let e=1/0,t=1/0,r=1/0,n=-1/0,o=-1/0,l=-1/0;const s=i.POSITION?i.POSITION.value:[],g=s&&s.length;for(let b=0;b<g;b+=3){const T=s[b],F=s[b+1],k=s[b+2];e=T<e?T:e,t=F<t?F:t,r=k<r?k:r,n=T>n?T:n,o=F>o?F:o,l=k>l?k:l}return[[e,t,r],[n,o,l]]}function HX(i,e){if(!i)throw new Error(e||"loader assertion failed.")}class ug{constructor(e,t){ye(this,"fields",void 0),ye(this,"metadata",void 0),HX(Array.isArray(e)),GX(e),this.fields=e,this.metadata=t||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let t=0;t<this.fields.length;++t)if(!this.fields[t].compareTo(e.fields[t]))return!1;return!0}select(){const e=Object.create(null);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(const l of r)e[l]=!0;const o=this.fields.filter(l=>e[l.name]);return new ug(o,this.metadata)}selectAt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.map(o=>this.fields[o]).filter(Boolean);return new ug(n,this.metadata)}assign(e){let t,r=this.metadata;if(e instanceof ug){const l=e;t=l.fields,r=cP(cP(new Map,this.metadata),l.metadata)}else t=e;const n=Object.create(null);for(const l of this.fields)n[l.name]=l;for(const l of t)n[l.name]=l;const o=Object.values(n);return new ug(o,r)}}function GX(i){const e={};for(const t of i)e[t.name]&&console.warn("Schema: duplicated field name",t.name,t),e[t.name]=!0}function cP(i,e){return new Map([...i||new Map,...e||new Map])}class M1{constructor(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;ye(this,"name",void 0),ye(this,"type",void 0),ye(this,"nullable",void 0),ye(this,"metadata",void 0),this.name=e,this.type=t,this.nullable=r,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new M1(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let wo=function(i){return i[i.NONE=0]="NONE",i[i.Null=1]="Null",i[i.Int=2]="Int",i[i.Float=3]="Float",i[i.Binary=4]="Binary",i[i.Utf8=5]="Utf8",i[i.Bool=6]="Bool",i[i.Decimal=7]="Decimal",i[i.Date=8]="Date",i[i.Time=9]="Time",i[i.Timestamp=10]="Timestamp",i[i.Interval=11]="Interval",i[i.List=12]="List",i[i.Struct=13]="Struct",i[i.Union=14]="Union",i[i.FixedSizeBinary=15]="FixedSizeBinary",i[i.FixedSizeList=16]="FixedSizeList",i[i.Map=17]="Map",i[i.Dictionary=-1]="Dictionary",i[i.Int8=-2]="Int8",i[i.Int16=-3]="Int16",i[i.Int32=-4]="Int32",i[i.Int64=-5]="Int64",i[i.Uint8=-6]="Uint8",i[i.Uint16=-7]="Uint16",i[i.Uint32=-8]="Uint32",i[i.Uint64=-9]="Uint64",i[i.Float16=-10]="Float16",i[i.Float32=-11]="Float32",i[i.Float64=-12]="Float64",i[i.DateDay=-13]="DateDay",i[i.DateMillisecond=-14]="DateMillisecond",i[i.TimestampSecond=-15]="TimestampSecond",i[i.TimestampMillisecond=-16]="TimestampMillisecond",i[i.TimestampMicrosecond=-17]="TimestampMicrosecond",i[i.TimestampNanosecond=-18]="TimestampNanosecond",i[i.TimeSecond=-19]="TimeSecond",i[i.TimeMillisecond=-20]="TimeMillisecond",i[i.TimeMicrosecond=-21]="TimeMicrosecond",i[i.TimeNanosecond=-22]="TimeNanosecond",i[i.DenseUnion=-23]="DenseUnion",i[i.SparseUnion=-24]="SparseUnion",i[i.IntervalDayTime=-25]="IntervalDayTime",i[i.IntervalYearMonth=-26]="IntervalYearMonth",i}({}),uP,hP,AP;class _B{static isNull(e){return e&&e.typeId===wo.Null}static isInt(e){return e&&e.typeId===wo.Int}static isFloat(e){return e&&e.typeId===wo.Float}static isBinary(e){return e&&e.typeId===wo.Binary}static isUtf8(e){return e&&e.typeId===wo.Utf8}static isBool(e){return e&&e.typeId===wo.Bool}static isDecimal(e){return e&&e.typeId===wo.Decimal}static isDate(e){return e&&e.typeId===wo.Date}static isTime(e){return e&&e.typeId===wo.Time}static isTimestamp(e){return e&&e.typeId===wo.Timestamp}static isInterval(e){return e&&e.typeId===wo.Interval}static isList(e){return e&&e.typeId===wo.List}static isStruct(e){return e&&e.typeId===wo.Struct}static isUnion(e){return e&&e.typeId===wo.Union}static isFixedSizeBinary(e){return e&&e.typeId===wo.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===wo.FixedSizeList}static isMap(e){return e&&e.typeId===wo.Map}static isDictionary(e){return e&&e.typeId===wo.Dictionary}get typeId(){return wo.NONE}compareTo(e){return this===e}}uP=Symbol.toStringTag;class hg extends _B{constructor(e,t){super(),ye(this,"isSigned",void 0),ye(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=t}get typeId(){return wo.Int}get[uP](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class jX extends hg{constructor(){super(!0,8)}}class qX extends hg{constructor(){super(!0,16)}}class $X extends hg{constructor(){super(!0,32)}}class KX extends hg{constructor(){super(!1,8)}}class WX extends hg{constructor(){super(!1,16)}}class XX extends hg{constructor(){super(!1,32)}}const dP={HALF:16,SINGLE:32,DOUBLE:64};hP=Symbol.toStringTag;class fP extends _B{constructor(e){super(),ye(this,"precision",void 0),this.precision=e}get typeId(){return wo.Float}get[hP](){return"Float"}toString(){return"Float".concat(this.precision)}}class ZX extends fP{constructor(){super(dP.SINGLE)}}class JX extends fP{constructor(){super(dP.DOUBLE)}}AP=Symbol.toStringTag;class YX extends _B{constructor(e,t){super(),ye(this,"listSize",void 0),ye(this,"children",void 0),this.listSize=e,this.children=[t]}get typeId(){return wo.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[AP](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function eZ(i){switch(i.constructor){case Int8Array:return new jX;case Uint8Array:return new KX;case Int16Array:return new qX;case Uint16Array:return new WX;case Int32Array:return new $X;case Uint32Array:return new XX;case Float32Array:return new ZX;case Float64Array:return new JX;default:throw new Error("array type not supported")}}function tZ(i,e,t){const r=eZ(e.value),n=t||iZ(e);return new M1(i,new YX(e.size,new M1("value",r)),!1,n)}function iZ(i){const e=new Map;return"byteOffset"in i&&e.set("byteOffset",i.byteOffset.toString(10)),"byteStride"in i&&e.set("byteStride",i.byteStride.toString(10)),"normalized"in i&&e.set("normalized",i.normalized.toString()),e}function pP(i,e){(i.COLOR_0||i.colors)&&e||(i.colors={constant:!0,value:new Float32Array([1,1,1])}),Dn.assert(i.positions||i.POSITION,'no "postions" or "POSITION" attribute in mesh')}function gP(i,e){if(i.attributes)return pP(i.attributes,e),i instanceof fy?i:new fy(i);if(i.positions||i.POSITION)return pP(i,e),new fy({attributes:i});throw Error("Invalid mesh")}const rZ={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class vB extends cg{constructor(){super(...arguments),ye(this,"state",void 0)}getShaders(){const e=!hn(this.context.gl),t={};return t2(this.context.gl,Qs.GLSL_DERIVATIVES)&&(t.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:QX,fs:VX,modules:[j2,Xj,q2],transpileToGLSL100:e,defines:t})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let t=this.state.positionBounds;if(t)return t;const{mesh:r}=this.props;if(!r)return null;if(t=(e=r.header)===null||e===void 0?void 0:e.boundingBox,!t){const{attributes:n}=gP(r,this.props._useMeshColors);n.POSITION=n.POSITION||n.positions,t=lP(n)}return this.state.positionBounds=t,t}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:oP}),this.setState({emptyTexture:new Xc(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:t,oldProps:r,changeFlags:n}=e;if(t.mesh!==r.mesh||n.extensionsChanged){var o;if(this.state.positionBounds=null,(o=this.state.model)===null||o===void 0||o.delete(),t.mesh){this.state.model=this.getModel(t.mesh);const l=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(l.NORMAL||l.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==r.texture&&this.setTexture(t.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw(e){let{uniforms:t}=e;if(!this.state.model)return;const{viewport:r}=this.context,{sizeScale:n,coordinateSystem:o,_instanced:l}=this.props;this.state.model.setUniforms(t).setUniforms({sizeScale:n,composeModelMatrix:!l||aP(r,o),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var e;return((e=this.state)===null||e===void 0?void 0:e.model)&&super.isLoaded}getModel(e){const t=new Yp(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:gP(e,this.props._useMeshColors),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:n}=this.state;return t.setUniforms({sampler:r||n,hasTexture:!!r}),t}setTexture(e){const{emptyTexture:t,model:r}=this.state;r&&r.setUniforms({sampler:e||t,hasTexture:!!e})}}ye(vB,"defaultProps",rZ),ye(vB,"layerName","SimpleMeshLayer");class Ag{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t}=e;this.id=t||xA(this.constructor.name),this.display=!0,this.position=new Ut,this.rotation=new Ut,this.scale=new Ut(1,1,1),this.matrix=new Bn,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(e){return Xi(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return Xi(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return Xi(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:t,rotation:r,scale:n,update:o=!0}=e;return t&&this.setPosition(t),r&&this.setRotation(r),n&&this.setScale(n),o&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(r),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:t,rotation:r,scale:n}=e;return t&&this.setPosition(t),r&&this.setRotation(r),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(e,t){Xi(e),t=t||this.matrix;const r=new Bn(e).multiplyRight(t),n=r.invert(),o=n.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:r,worldInverseMatrix:n,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Ey extends Ag{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=Array.isArray(e)?{children:e}:e;const{children:t=[]}=e;ar.assert(t.every(r=>r instanceof Ag),"every child must an instance of ScenegraphNode"),super(e),this.children=t}add(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const n of t)Array.isArray(n)?this.add(...n):this.children.push(n);return this}remove(e){const t=this.children,r=t.indexOf(e);return r>-1&&t.splice(r,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((t,r)=>{let{worldMatrix:n}=r;const o=t.getBounds();if(!o)return;const[l,s]=o,g=new Ut(l).add(s).divide([2,2,2]);n.transformAsPoint(g,g);const b=new Ut(s).subtract(l).divide([2,2,2]);n.transformAsVector(b,b);for(let T=0;T<8;T++){const F=new Ut(T&1?-1:1,T&2?-1:1,T&4?-1:1).multiply(b).add(g);for(let k=0;k<3;k++)e[0][k]=Math.min(e[0][k],F[k]),e[1][k]=Math.max(e[1][k],F[k])}}),Number.isFinite(e[0][0])?e:null}traverse(e){let{worldMatrix:t=new Bn}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new Bn(t).multiplyRight(this.matrix);for(const n of this.children)n instanceof Ey?n.traverse(e,{worldMatrix:r}):e(n,{worldMatrix:r})}}const nZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},sZ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function mP(i){if(!i._animation){const e=sZ[i.componentType],t=nZ[i.type],r=t*i.count,{buffer:n,byteOffset:o}=i.bufferView.data,l=new e(n,o+(i.byteOffset||0),r);if(t===1)i._animation=Array.from(l);else{const s=[];for(let g=0;g<l.length;g+=t)s.push(Array.from(l.slice(g,g+t)));i._animation=s}}return i._animation}const oZ=new Bn;function aZ(i,e){if(e.matrix.identity(),i.translation&&e.matrix.translate(i.translation),i.rotation){const t=oZ.fromQuaternion(i.rotation);e.matrix.multiplyRight(t)}i.scale&&e.matrix.scale(i.scale)}const bB=new hy;function lZ(i,e,t,r,n){if(e==="rotation"){bB.slerp({start:t,target:r,ratio:n});for(let o=0;o<bB.length;o++)i[e][o]=bB[o]}else for(let o=0;o<t.length;o++)i[e][o]=n*r[o]+(1-n)*t[o]}function cZ(i,e,t){let{p0:r,outTangent0:n,inTangent1:o,p1:l,tDiff:s,ratio:g}=t;for(let b=0;b<i[e].length;b++){const T=n[b]*s,F=o[b]*s;i[e][b]=(2*Math.pow(g,3)-3*Math.pow(g,2)+1)*r[b]+(Math.pow(g,3)-2*Math.pow(g,2)+g)*T+(-2*Math.pow(g,3)+3*Math.pow(g,2))*l[b]+(Math.pow(g,3)-Math.pow(g,2))*F}}function uZ(i,e,t){for(let r=0;r<t.length;r++)i[e][r]=t[r]}function hZ(i,e,t,r){let{input:n,interpolation:o,output:l}=e;const s=n[n.length-1],g=i%s,b=n.findIndex(z=>z>=g),T=Math.max(0,b-1);if(!Array.isArray(t[r]))switch(r){case"translation":t[r]=[0,0,0];break;case"rotation":t[r]=[0,0,0,1];break;case"scale":t[r]=[1,1,1];break;default:ar.warn("Bad animation path ".concat(r))()}Xi(t[r].length===l[T].length);const F=n[T],k=n[b];switch(o){case"STEP":uZ(t,r,l[T]);break;case"LINEAR":if(k>F){const z=(g-F)/(k-F);lZ(t,r,l[T],l[b],z)}break;case"CUBICSPLINE":if(k>F){const z=(g-F)/(k-F),J=k-F,te=l[3*T+1],ue=l[3*T+2],ce=l[3*b+0],de=l[3*b+1];cZ(t,r,{p0:te,outTangent0:ue,inTangent1:ce,p1:de,tDiff:J,ratio:z})}break;default:ar.warn("Interpolation ".concat(o," not supported"))();break}}class AZ{constructor(e){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}animate(e){if(!this.playing)return;const r=(e/1e3-this.startTime)*this.speed;this.channels.forEach(n=>{let{sampler:o,target:l,path:s}=n;hZ(r,o,l,s),aZ(l,l._node)})}}class dZ{constructor(e){this.animations=e.animations.map((t,r)=>{const n=t.name||"Animation-".concat(r),o=t.samplers.map(s=>{let{input:g,interpolation:b="LINEAR",output:T}=s;return{input:mP(e.accessors[g]),interpolation:b,output:mP(e.accessors[T])}}),l=t.channels.map(s=>{let{sampler:g,target:b}=s;return{sampler:o[g],target:e.nodes[b.node],path:b.path}});return new AZ({name:n,channels:l})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}class fZ extends Ag{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t),this.onBeforeRender=null,this.AfterRender=null,e instanceof Yp?(this.model=e,this._setModelNodeProps(t)):this.model=new Yp(e,t),this.bounds=null,this.managedResources=t.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(e){this.model.setProps(e)}}class yP{constructor(e,t){let{attributes:r,material:n,pbrDebug:o,imageBasedLightingEnvironment:l,lights:s,useTangents:g}=t;this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},t2(e,Qs.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],l&&(this.uniforms.u_DiffuseEnvSampler=l.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=l.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=l.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),o&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(r.NORMAL,"HAS_NORMALS"),this.defineIfPresent(r.TANGENT&&g,"HAS_TANGENTS"),this.defineIfPresent(r.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(l,"USE_IBL"),this.defineIfPresent(s,"USE_LIGHTS"),this.defineIfPresent(o,"PBR_DEBUG"),n&&this.parseMaterial(n)}defineIfPresent(e,t){e&&(this.defines[t]=1)}parseTexture(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const n=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},o=e.texture.source.image;let l,s={};o.compressed?(l=o,s={[this.gl.TEXTURE_MIN_FILTER]:o.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):l={data:o};const g=new Xc(this.gl,{id:e.name||e.id,parameters:{...n,...s},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...l});this.uniforms[t]=g,this.defineIfPresent(r,r),this.generatedTextures.push(g)}parsePbrMetallicRoughness(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:t=1,roughnessFactor:r=1}=e;this.uniforms.u_MetallicRoughnessValues=[t,r]}parseMaterial(e){if(this.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:t=1}=e.normalTexture;this.uniforms.u_NormalScale=t}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:t=1}=e.occlusionTexture;this.uniforms.u_OcclusionStrength=t}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){const{alphaCutoff:t=.5}=e;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=t}else e.alphaMode==="BLEND"&&(ar.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(e=>e.delete())}}const pZ=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,gZ=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function _P(i,e){return hn(i)?`#version 300 es
`.concat(e):e}function mZ(i,e){const{id:t,drawMode:r,vertexCount:n,attributes:o,modelOptions:l}=e,s=new yP(i,e);ar.info(4,"createGLTFModel defines: ",s.defines)();const g=[];g.push(...s.generatedTextures),g.push(...Object.values(o).map(T=>T.buffer));const b=new fZ(i,{id:t,drawMode:r,vertexCount:n,modules:[M2],parameters:s.parameters,vs:_P(i,pZ),fs:_P(i,gZ),managedResources:g,...l,defines:{...s.defines,...l.defines}});return b.setProps({attributes:o}),b.setUniforms(s.uniforms),b}const yZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_Z={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class vZ{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.options=Object.assign({},_Z,t)}instantiate(e){return this.gltf=e,(e.scenes||[]).map(r=>this.createScene(r))}createAnimator(){return Array.isArray(this.gltf.animations)?new dZ(this.gltf):null}createScene(e){const r=(e.nodes||[]).map(o=>this.createNode(o));return new Ey({id:e.name||e.id,children:r})}createNode(e){if(!e._node){const r=(e.children||[]).map(o=>this.createNode(o));e.mesh&&r.push(this.createMesh(e.mesh));const n=new Ey({id:e.name||e.id,children:r});if(e.matrix)n.setMatrix(e.matrix);else{if(n.matrix.identity(),e.translation&&n.matrix.translate(e.translation),e.rotation){const o=new Bn().fromQuaternion(e.rotation);n.matrix.multiplyRight(o)}e.scale&&n.matrix.scale(e.scale)}e._node=n}return e._node}createMesh(e){if(!e._mesh){const r=(e.primitives||[]).map((o,l)=>this.createPrimitive(o,l,e)),n=new Ey({id:e.name||e.id,children:r});e._mesh=n}return e._mesh}getVertexCount(e){ar.warn("getVertexCount() not found")()}createPrimitive(e,t,r){const n=mZ(this.gl,Object.assign({id:e.name||"".concat(r.name||r.id,"-primitive-").concat(t),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options));return n.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],n}createAttributes(e,t){const r={};return Object.keys(e).forEach(n=>{r[n]=this.createAccessor(e[n],this.createBuffer(e[n],this.gl.ARRAY_BUFFER))}),t&&(r.indices=this.createAccessor(t,this.createBuffer(t,this.gl.ELEMENT_ARRAY_BUFFER))),ar.info(4,"glTF Attributes",{attributes:e,indices:t,generated:r})(),r}createBuffer(e,t){e.bufferView||(e.bufferView={});const{bufferView:r}=e;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[t]||(r.lumaBuffers[t]=new bs(this.gl,{id:"from-".concat(r.id),data:r.data||e.value,target:t})),r.lumaBuffers[t]}createAccessor(e,t){return new Cc({buffer:t,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:yZ[e.type]})}createSampler(e){return e}needsPOT(){return!1}}function bZ(i,e,t){const r=new vZ(i,t),n=r.instantiate(e),o=r.createAnimator();return{scenes:n,animator:o}}const xZ="3.4.14",wZ="3.4.14",vP="3.4.14",BZ="https://unpkg.com/@loaders.gl/textures@".concat(vP,"/dist/libs/basis_encoder.wasm"),CZ="https://unpkg.com/@loaders.gl/textures@".concat(vP,"/dist/libs/basis_encoder.js");let xB;async function bP(i){const e=i.modules||{};return e.basis?e.basis:(xB=xB||EZ(i),await xB)}async function EZ(i){let e=null,t=null;return[e,t]=await Promise.all([await Af("basis_transcoder.js","textures",i),await Af("basis_transcoder.wasm","textures",i)]),e=e||globalThis.BASIS,await SZ(e,t)}function SZ(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(r=>{i(t).then(n=>{const{BasisFile:o,initializeBasis:l}=n;l(),r({BasisFile:o})})})}let wB;async function xP(i){const e=i.modules||{};return e.basisEncoder?e.basisEncoder:(wB=wB||TZ(i),await wB)}async function TZ(i){let e=null,t=null;return[e,t]=await Promise.all([await Af(CZ,"textures",i),await Af(BZ,"textures",i)]),e=e||globalThis.BASIS,await IZ(e,t)}function IZ(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(r=>{i(t).then(n=>{const{BasisFile:o,KTX2File:l,initializeBasis:s,BasisEncoder:g}=n;s(),r({BasisFile:o,KTX2File:l,BasisEncoder:g})})})}const dg={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},LZ=["","WEBKIT_","MOZ_"],wP={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let P1=null;function MZ(i){if(!P1){i=i||PZ()||void 0,P1=new Set;for(const e of LZ)for(const t in wP)if(i&&i.getExtension("".concat(e).concat(t))){const r=wP[t];P1.add(r)}}return P1}function PZ(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var BP,CP,EP,SP,TP,IP,LP,MP;(function(i){i[i.NONE=0]="NONE",i[i.BASISLZ=1]="BASISLZ",i[i.ZSTD=2]="ZSTD",i[i.ZLIB=3]="ZLIB"})(BP||(BP={})),function(i){i[i.BASICFORMAT=0]="BASICFORMAT"}(CP||(CP={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.ETC1S=163]="ETC1S",i[i.UASTC=166]="UASTC"}(EP||(EP={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.SRGB=1]="SRGB"}(SP||(SP={})),function(i){i[i.UNSPECIFIED=0]="UNSPECIFIED",i[i.LINEAR=1]="LINEAR",i[i.SRGB=2]="SRGB",i[i.ITU=3]="ITU",i[i.NTSC=4]="NTSC",i[i.SLOG=5]="SLOG",i[i.SLOG2=6]="SLOG2"}(TP||(TP={})),function(i){i[i.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",i[i.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(IP||(IP={})),function(i){i[i.RGB=0]="RGB",i[i.RRR=3]="RRR",i[i.GGG=4]="GGG",i[i.AAA=15]="AAA"}(LP||(LP={})),function(i){i[i.RGB=0]="RGB",i[i.RGBA=3]="RGBA",i[i.RRR=4]="RRR",i[i.RRRG=5]="RRRG"}(MP||(MP={}));const tu=[171,75,84,88,32,50,48,187,13,10,26,10];function FZ(i){const e=new Uint8Array(i);return!(e.byteLength<tu.length||e[0]!==tu[0]||e[1]!==tu[1]||e[2]!==tu[2]||e[3]!==tu[3]||e[4]!==tu[4]||e[5]!==tu[5]||e[6]!==tu[6]||e[7]!==tu[7]||e[8]!==tu[8]||e[9]!==tu[9]||e[10]!==tu[10]||e[11]!==tu[11])}const DZ={etc1:{basisFormat:0,compressed:!0,format:dg.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:dg.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:dg.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:dg.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:dg.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:dg.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function RZ(i,e){if(e.basis.containerFormat==="auto"){if(FZ(i)){const r=await xP(e);return PP(r.KTX2File,i,e)}const{BasisFile:t}=await bP(e);return BB(t,i,e)}switch(e.basis.module){case"encoder":const t=await xP(e);switch(e.basis.containerFormat){case"ktx2":return PP(t.KTX2File,i,e);case"basis":default:return BB(t.BasisFile,i,e)}case"transcoder":default:const{BasisFile:r}=await bP(e);return BB(r,i,e)}}function BB(i,e,t){const r=new i(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");const n=r.getNumImages(),o=[];for(let l=0;l<n;l++){const s=r.getNumLevels(l),g=[];for(let b=0;b<s;b++)g.push(kZ(r,l,b,t));o.push(g)}return o}finally{r.close(),r.delete()}}function kZ(i,e,t,r){const n=i.getImageWidth(e,t),o=i.getImageHeight(e,t),l=i.getHasAlpha(),{compressed:s,format:g,basisFormat:b}=FP(r,l),T=i.getImageTranscodedSizeInBytes(e,t,b),F=new Uint8Array(T);if(!i.transcodeImage(F,e,t,b,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:o,data:F,compressed:s,format:g,hasAlpha:l}}function PP(i,e,t){const r=new i(new Uint8Array(e));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");const n=r.getLevels(),o=[];for(let l=0;l<n;l++){o.push(OZ(r,l,t));break}return[o]}finally{r.close(),r.delete()}}function OZ(i,e,t){const{alphaFlag:r,height:n,width:o}=i.getImageLevelInfo(e,0,0),{compressed:l,format:s,basisFormat:g}=FP(t,r),b=i.getImageTranscodedSizeInBytes(e,0,0,g),T=new Uint8Array(b);if(!i.transcodeImage(T,e,0,0,g,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:n,data:T,compressed:l,levelSize:b,hasAlpha:r,format:s}}function FP(i,e){let t=i&&i.basis&&i.basis.format;return t==="auto"&&(t=DP()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),DZ[t]}function DP(){const i=MZ();return i.has("astc")?"astc-4x4":i.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:i.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:i.has("etc1")?"etc1":i.has("etc2")?"etc2":"rgb565"}const UZ={...{name:"Basis",id:yA?"basis":"basis-nodejs",module:"textures",version:wZ,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:RZ};function iu(i,e){if(!i)throw new Error(e||"assert failed: gltf")}function RP(i,e){if(i.startsWith("data:")||i.startsWith("http:")||i.startsWith("https:"))return i;const r=e.baseUri||e.uri;if(!r)throw new Error("'baseUri' must be provided to resolve relative url ".concat(i));return r.substr(0,r.lastIndexOf("/")+1)+i}function NZ(i,e,t){const r=i.bufferViews[t];iu(r);const n=r.buffer,o=e[n];iu(o);const l=(r.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,l,r.byteLength)}const kP=["SCALAR","VEC2","VEC3","VEC4"],zZ=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],QZ=new Map(zZ),VZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},HZ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},GZ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function OP(i){return kP[i-1]||kP[0]}function UP(i){const e=QZ.get(i.constructor);if(!e)throw new Error("Illegal typed array");return e}function CB(i,e){const t=GZ[i.componentType],r=VZ[i.type],n=HZ[i.componentType],o=i.count*r,l=i.count*r*n;return iu(l>=0&&l<=e.byteLength),{ArrayType:t,length:o,byteLength:l}}function NP(i){let{images:e,bufferViews:t}=i;e=e||[],t=t||[];const r=e.map(l=>l.bufferView);t=t.filter(l=>!r.includes(l));const n=t.reduce((l,s)=>l+s.byteLength,0),o=e.reduce((l,s)=>{const{width:g,height:b}=s.image;return l+g*b},0);return n+Math.ceil(4*o*1.33)}const jZ={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class Ec{constructor(e){ye(this,"gltf",void 0),ye(this,"sourceBuffers",void 0),ye(this,"byteLength",void 0),this.gltf=e||{json:{...jZ},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const t=this.getUsedExtensions().find(n=>n===e),r=this.json.extensions||{};return t?r[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(r=>r===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const r=this.json[e]&&this.json[e][t];if(!r)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return r}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,r=this.gltf.buffers[t];iu(r);const n=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,{ArrayType:o,length:l}=CB(e,t),s=t.byteOffset+e.byteOffset;return new o(n,s,l)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,o=t.byteOffset||0;return new Uint8Array(n,o,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,r){return e.extensions=e.extensions||{},e.extensions[t]=r,this.registerUsedExtension(t),this}setObjectExtension(e,t,r){const n=e.extensions||{};n[t]=r}removeObjectExtension(e,t){const r=e.extensions||{},n=r[t];return delete r[t],n}addExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return iu(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return iu(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(!this.getExtension(e))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:r}=e;this.json.nodes=this.json.nodes||[];const n={mesh:t};return r&&(n.matrix=r),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:r,material:n,mode:o=4}=e,s={primitives:[{attributes:this._addAttributes(t),mode:o}]};if(r){const g=this._addIndices(r);s.primitives[0].indices=g}return Number.isFinite(n)&&(s.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){const r={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(r),this.json.meshes.length-1}addImage(e,t){const r=Fw(e),n=t||(r==null?void 0:r.mimeType),l={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(l),this.json.images.length-1}addBufferView(e){const t=e.byteLength;iu(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=Hm(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,t){const r={bufferView:e,type:OP(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const r=this.addBufferView(e);let n={min:t.min,max:t.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,t.size));const o={size:t.size,componentType:UP(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(r,Object.assign(o,t))}addTexture(e){const{imageIndex:t}=e,r={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(r),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];const r=this.byteLength,n=new ArrayBuffer(r),o=new Uint8Array(n);let l=0;for(const s of this.sourceBuffers||[])l=g8(s,o,l);(e=this.json)!==null&&e!==void 0&&(t=e.buffers)!==null&&t!==void 0&&t[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=n,this.sourceBuffers=[n]}_removeStringFromArray(e,t){let r=!0;for(;r;){const n=e.indexOf(t);n>-1?e.splice(n,1):r=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={};for(const r in e){const n=e[r],o=this._getGltfAttributeName(r),l=this.addBinaryBuffer(n.value,n);t[o]=l}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const r={min:null,max:null};if(e.length<t)return r;r.min=[],r.max=[];const n=e.subarray(0,t);for(const o of n)r.min.push(o),r.max.push(o);for(let o=t;o<e.length;o+=t)for(let l=0;l<t;l++)r.min[0+l]=Math.min(r.min[0+l],e[o+l]),r.max[0+l]=Math.max(r.max[0+l],e[o+l]);return r}}const qZ="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",$Z="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",KZ=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),WZ=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),XZ={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ZZ={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function JZ(i,e,t,r,n){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const l=await YZ();iJ(l,l.exports[ZZ[n]],i,e,t,r,l.exports[XZ[o||"NONE"]])}let EB;async function YZ(){return EB||(EB=eJ()),EB}async function eJ(){let i=qZ;WebAssembly.validate(KZ)&&(i=$Z,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(tJ(i),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function tJ(i){const e=new Uint8Array(i.length);for(let r=0;r<i.length;++r){const n=i.charCodeAt(r);e[r]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let t=0;for(let r=0;r<i.length;++r)e[t++]=e[r]<60?WZ[e[r]]:(e[r]-60)*64+e[++r];return e.buffer.slice(0,t)}function iJ(i,e,t,r,n,o,l){const s=i.exports.sbrk,g=r+3&-4,b=s(g*n),T=s(o.length),F=new Uint8Array(i.exports.memory.buffer);F.set(o,T);const k=e(b,r,n,T,o.length);if(k===0&&l&&l(b,g,n),t.set(F.subarray(b,b+r*n)),s(b-s(0)),k!==0)throw new Error("Malformed buffer data: ".concat(k))}const SB="EXT_meshopt_compression",rJ=SB;async function nJ(i,e){var t;const r=new Ec(i);if(!(e!=null&&(t=e.gltf)!==null&&t!==void 0&&t.decompressMeshes))return;const n=[];for(const o of i.json.bufferViews||[])n.push(sJ(r,o));await Promise.all(n),r.removeExtension(SB)}async function sJ(i,e){const t=i.getObjectExtension(e,SB);if(t){const{byteOffset:r=0,byteLength:n=0,byteStride:o,count:l,mode:s,filter:g="NONE",buffer:b}=t,T=i.gltf.buffers[b],F=new Uint8Array(T.arrayBuffer,T.byteOffset+r,n),k=new Uint8Array(i.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await JZ(k,l,o,F,s,g),k}return null}const oJ=Object.freeze(Object.defineProperty({__proto__:null,decode:nJ,name:rJ},Symbol.toStringTag,{value:"Module"})),fg="EXT_texture_webp",aJ=fg;function lJ(i,e){const t=new Ec(i);if(!AV("image/webp")){if(t.getRequiredExtensions().includes(fg))throw new Error("gltf: Required extension ".concat(fg," not supported by browser"));return}const{json:r}=t;for(const n of r.textures||[]){const o=t.getObjectExtension(n,fg);o&&(n.source=o.source),t.removeObjectExtension(n,fg)}t.removeExtension(fg)}const cJ=Object.freeze(Object.defineProperty({__proto__:null,name:aJ,preprocess:lJ},Symbol.toStringTag,{value:"Module"})),F1="KHR_texture_basisu",uJ=F1;function hJ(i,e){const t=new Ec(i),{json:r}=t;for(const n of r.textures||[]){const o=t.getObjectExtension(n,F1);o&&(n.source=o.source),t.removeObjectExtension(n,F1)}t.removeExtension(F1)}const AJ=Object.freeze(Object.defineProperty({__proto__:null,name:uJ,preprocess:hJ},Symbol.toStringTag,{value:"Module"})),dJ={name:"Draco",id:yA?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:"3.4.14",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function fJ(i,e,t){const r=QP(e.metadata),n=[],o=pJ(e.attributes);for(const l in i){const s=i[l],g=zP(l,s,o[l]);n.push(g)}if(t){const l=zP("indices",t);n.push(l)}return new ug(n,r)}function pJ(i){const e={};for(const t in i){const r=i[t];e[r.name||"undefined"]=r}return e}function zP(i,e,t){const r=t?QP(t.metadata):void 0;return tZ(i,e,r)}function QP(i){const e=new Map;for(const t in i)e.set("".concat(t,".string"),JSON.stringify(i[t]));return e}const VP={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},gJ={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},mJ=4;class yJ{constructor(e){ye(this,"draco",void 0),ye(this,"decoder",void 0),ye(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const n=this.decoder.GetEncodedGeometryType(r),o=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let l;switch(n){case this.draco.TRIANGULAR_MESH:l=this.decoder.DecodeBufferToMesh(r,o);break;case this.draco.POINT_CLOUD:l=this.decoder.DecodeBufferToPointCloud(r,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!l.ok()||!o.ptr){const k="DRACO decompression failed: ".concat(l.error_msg());throw new Error(k)}const s=this._getDracoLoaderData(o,n,t),g=this._getMeshData(o,s,t),b=lP(g.attributes),T=fJ(g.attributes,s,g.indices);return{loader:"draco",loaderData:s,header:{vertexCount:o.num_points(),boundingBox:b},...g,schema:T}}finally{this.draco.destroy(r),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,t,r){const n=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,r);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:o}}_getDracoAttributes(e,t){const r={};for(let n=0;n<e.num_attributes();n++){const o=this.decoder.GetAttribute(e,n),l=this._getAttributeMetadata(e,n);r[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:n,metadata:l};const s=this._getQuantizationTransform(o,t);s&&(r[o.unique_id()].quantization_transform=s);const g=this._getOctahedronTransform(o,t);g&&(r[o.unique_id()].octahedron_transform=g)}return r}_getMeshData(e,t,r){const n=this._getMeshAttributes(t,e,r);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(r.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,t,r){const n={};for(const o of Object.values(e.attributes)){const l=this._deduceAttributeName(o,r);o.name=l;const{value:s,size:g}=this._getAttributeValues(t,o);n[l]={value:s,size:g,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}return n}_getTriangleListIndices(e){const r=e.num_faces()*3,n=r*mJ,o=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,o),new Uint32Array(this.draco.HEAPF32.buffer,o,r).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),bJ(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const r=gJ[t.data_type],n=t.num_components,l=e.num_points()*n,s=l*r.BYTES_PER_ELEMENT,g=_J(this.draco,r);let b;const T=this.draco._malloc(s);try{const F=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,F,g,s,T),b=new r(this.draco.HEAPF32.buffer,T,l).slice()}finally{this.draco._free(T)}return{value:b,size:n}}_deduceAttributeName(e,t){const r=e.unique_id;for(const[l,s]of Object.entries(t.extraAttributes||{}))if(s===r)return l;const n=e.attribute_type;for(const l in VP)if(this.draco[l]===n)return VP[l];const o=t.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:"CUSTOM_ATTRIBUTE_".concat(r)}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const r=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},r=this.metadataQuerier.NumEntries(e);for(let n=0;n<r;n++){const o=this.metadataQuerier.GetEntryName(e,n);t[o]=this._getDracoMetadataField(e,o)}return t}_getDracoMetadataField(e,t){const r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,r);const n=vJ(r);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:n}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:r=[]}=e,n=[...t,...r];for(const o of n)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,t){const{quantizedAttributes:r=[]}=t,n=e.attribute_type();if(r.map(l=>this.decoder[l]).includes(n)){const l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits(),range:l.range(),min_values:new Float32Array([1,2,3]).map(s=>l.min_value(s))}}finally{this.draco.destroy(l)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:r=[]}=t,n=e.attribute_type();if(r.map(l=>this.decoder[l]).includes(n)){const l=new this.draco.AttributeQuantizationTransform;try{if(l.InitFromAttribute(e))return{quantization_bits:l.quantization_bits()}}finally{this.draco.destroy(l)}}return null}}function _J(i,e){switch(e){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32;default:return i.DT_INVALID}}function vJ(i){const e=i.size(),t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=i.GetValue(r);return t}function bJ(i){const e=i.size(),t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=i.GetValue(r);return t}const TB="https://www.gstatic.com/draco/versioned/decoders/".concat("1.5.5"),xJ="".concat(TB,"/draco_decoder.js"),wJ="".concat(TB,"/draco_wasm_wrapper.js"),BJ="".concat(TB,"/draco_decoder.wasm");let Sy;async function CJ(i){const e=i.modules||{};return e.draco3d?Sy=Sy||e.draco3d.createDecoderModule({}).then(t=>({draco:t})):Sy=Sy||EJ(i),await Sy}async function EJ(i){let e,t;switch(i.draco&&i.draco.decoderType){case"js":e=await Af(xJ,"draco",i);break;case"wasm":default:[e,t]=await Promise.all([await Af(wJ,"draco",i),await Af(BJ,"draco",i)])}return e=e||globalThis.DracoDecoderModule,await SJ(e,t)}function SJ(i,e){const t={};return e&&(t.wasmBinary=e),new Promise(r=>{i({...t,onModuleLoaded:n=>r({draco:n})})})}const HP={...dJ,parse:TJ};async function TJ(i,e){const{draco:t}=await CJ(e),r=new yJ(t);try{return r.parseSync(i,e==null?void 0:e.draco)}finally{r.destroy()}}function IJ(i){const e={};for(const t in i){const r=i[t];if(t!=="indices"){const n=GP(r);e[t]=n}}return e}function GP(i){const{buffer:e,size:t,count:r}=LJ(i);return{value:e,size:t,byteOffset:0,count:r,type:OP(t),componentType:UP(e)}}function LJ(i){let e=i,t=1,r=0;return i&&i.value&&(e=i.value,t=i.size||1),e&&(ArrayBuffer.isView(e)||(e=MJ(e,Float32Array)),r=e.length/t),{buffer:e,size:t,count:r}}function MJ(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return i?Array.isArray(i)?new e(i):t&&!(i instanceof e)?new e(i):i:null}const Bf="KHR_draco_mesh_compression",PJ=Bf;function FJ(i,e,t){const r=new Ec(i);for(const n of jP(r))r.getObjectExtension(n,Bf)}async function DJ(i,e,t){var r;if(!(e!=null&&(r=e.gltf)!==null&&r!==void 0&&r.decompressMeshes))return;const n=new Ec(i),o=[];for(const l of jP(n))n.getObjectExtension(l,Bf)&&o.push(kJ(n,l,e,t));await Promise.all(o),n.removeExtension(Bf)}function RJ(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new Ec(i);for(const r of t.json.meshes||[])OJ(r,e),t.addRequiredExtension(Bf)}async function kJ(i,e,t,r){const n=i.getObjectExtension(e,Bf);if(!n)return;const o=i.getTypedArrayForBufferView(n.bufferView),l=yw(o.buffer,o.byteOffset),{parse:s}=r,g={...t};delete g["3d-tiles"];const b=await s(l,HP,g,r),T=IJ(b.attributes);for(const[F,k]of Object.entries(T))if(F in e.attributes){const z=e.attributes[F],J=i.getAccessor(z);J!=null&&J.min&&J!==null&&J!==void 0&&J.max&&(k.min=J.min,k.max=J.max)}e.attributes=T,b.indices&&(e.indices=GP(b.indices)),UJ(e)}function OJ(i,e){var t;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,n=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const l=n.DracoWriter.encodeSync({attributes:i}),s=o==null||(t=o.parseSync)===null||t===void 0?void 0:t.call(o,{attributes:i}),g=n._addFauxAttributes(s.attributes),b=n.addBufferView(l);return{primitives:[{attributes:g,mode:r,extensions:{[Bf]:{bufferView:b,attributes:g}}}]}}function UJ(i){if(!i.attributes&&Object.keys(i.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*jP(i){for(const e of i.json.meshes||[])for(const t of e.primitives)yield t}const NJ=Object.freeze(Object.defineProperty({__proto__:null,decode:DJ,encode:RJ,name:PJ,preprocess:FJ},Symbol.toStringTag,{value:"Module"})),zJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},QJ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},IB="KHR_texture_transform",VJ=IB,D1=new Ut,HJ=new xo,GJ=new xo;async function jJ(i,e){if(!new Ec(i).getExtension(IB))return;const n=i.json.materials||[];for(let o=0;o<n.length;o++)qJ(o,i)}function qJ(i,e){var t,r,n;const o=[],l=(t=e.json.materials)===null||t===void 0?void 0:t[i],s=l==null||(r=l.pbrMetallicRoughness)===null||r===void 0?void 0:r.baseColorTexture;s&&Ty(e,i,s,o);const g=l==null?void 0:l.emissiveTexture;g&&Ty(e,i,g,o);const b=l==null?void 0:l.normalTexture;b&&Ty(e,i,b,o);const T=l==null?void 0:l.occlusionTexture;T&&Ty(e,i,T,o);const F=l==null||(n=l.pbrMetallicRoughness)===null||n===void 0?void 0:n.metallicRoughnessTexture;F&&Ty(e,i,F,o)}function Ty(i,e,t,r){const n=$J(t,r);if(!n)return;const o=i.json.meshes||[];for(const l of o)for(const s of l.primitives){const g=s.material;Number.isFinite(g)&&e===g&&KJ(i,s,n)}}function $J(i,e){var t;const r=(t=i.extensions)===null||t===void 0?void 0:t[IB],{texCoord:n=0}=i,{texCoord:o=n}=r;if(!(e.findIndex(s=>{let[g,b]=s;return g===n&&b===o})!==-1)){const s=ZJ(r);return n!==o&&(i.texCoord=o),e.push([n,o]),{originalTexCoord:n,texCoord:o,matrix:s}}return null}function KJ(i,e,t){const{originalTexCoord:r,texCoord:n,matrix:o}=t,l=e.attributes["TEXCOORD_".concat(r)];if(Number.isFinite(l)){var s;const b=(s=i.json.accessors)===null||s===void 0?void 0:s[l];if(b&&b.bufferView){var g;const T=(g=i.json.bufferViews)===null||g===void 0?void 0:g[b.bufferView];if(T){const{arrayBuffer:F,byteOffset:k}=i.buffers[T.buffer],z=(k||0)+(b.byteOffset||0)+(T.byteOffset||0),{ArrayType:J,length:te}=CB(b,T),ue=QJ[b.componentType],ce=zJ[b.type],de=T.byteStride||ue*ce,_e=new Float32Array(te);for(let Ee=0;Ee<b.count;Ee++){const He=new J(F,z+Ee*de,2);D1.set(He[0],He[1],1),D1.transformByMatrix3(o),_e.set([D1[0],D1[1]],Ee*ce)}r===n?WJ(b,T,i.buffers,_e):XJ(n,b,e,i,_e)}}}}function WJ(i,e,t,r){i.componentType=5126,t.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=r.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function XJ(i,e,t,r,n){r.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});const o=r.json.bufferViews;if(!o)return;o.push({buffer:r.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});const l=r.json.accessors;l&&(l.push({bufferView:(o==null?void 0:o.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes["TEXCOORD_".concat(i)]=l.length-1)}function ZJ(i){const{offset:e=[0,0],rotation:t=0,scale:r=[1,1]}=i,n=new xo().set(1,0,0,0,1,0,e[0],e[1],1),o=HJ.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),l=GJ.set(r[0],0,0,0,r[1],0,0,0,1);return n.multiplyRight(o).multiplyRight(l)}const JJ=Object.freeze(Object.defineProperty({__proto__:null,decode:jJ,name:VJ},Symbol.toStringTag,{value:"Module"})),Cf="KHR_lights_punctual",YJ=Cf;async function eY(i){const e=new Ec(i),{json:t}=e,r=e.getExtension(Cf);r&&(e.json.lights=r.lights,e.removeExtension(Cf));for(const n of t.nodes||[]){const o=e.getObjectExtension(n,Cf);o&&(n.light=o.light),e.removeObjectExtension(n,Cf)}}async function tY(i){const e=new Ec(i),{json:t}=e;if(t.lights){const r=e.addExtension(Cf);iu(!r.lights),r.lights=t.lights,delete t.lights}if(e.json.lights){for(const r of e.json.lights){const n=r.node;e.addObjectExtension(n,Cf,r)}delete e.json.lights}}const iY=Object.freeze(Object.defineProperty({__proto__:null,decode:eY,encode:tY,name:YJ},Symbol.toStringTag,{value:"Module"})),Iy="KHR_materials_unlit",rY=Iy;async function nY(i){const e=new Ec(i),{json:t}=e;for(const r of t.materials||[])r.extensions&&r.extensions.KHR_materials_unlit&&(r.unlit=!0),e.removeObjectExtension(r,Iy);e.removeExtension(Iy)}function sY(i){const e=new Ec(i),{json:t}=e;if(e.materials)for(const r of t.materials||[])r.unlit&&(delete r.unlit,e.addObjectExtension(r,Iy,{}),e.addExtension(Iy))}const oY=Object.freeze(Object.defineProperty({__proto__:null,decode:nY,encode:sY,name:rY},Symbol.toStringTag,{value:"Module"})),Ly="KHR_techniques_webgl",aY=Ly;async function lY(i){const e=new Ec(i),{json:t}=e,r=e.getExtension(Ly);if(r){const n=uY(r,e);for(const o of t.materials||[]){const l=e.getObjectExtension(o,Ly);l&&(o.technique=Object.assign({},l,n[l.technique]),o.technique.values=hY(o.technique,e)),e.removeObjectExtension(o,Ly)}e.removeExtension(Ly)}}async function cY(i,e){}function uY(i,e){const{programs:t=[],shaders:r=[],techniques:n=[]}=i,o=new TextDecoder;return r.forEach(l=>{if(Number.isFinite(l.bufferView))l.code=o.decode(e.getTypedArrayForBufferView(l.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(l=>{l.fragmentShader=r[l.fragmentShader],l.vertexShader=r[l.vertexShader]}),n.forEach(l=>{l.program=t[l.program]}),n}function hY(i,e){const t=Object.assign({},i.values);return Object.keys(i.uniforms||{}).forEach(r=>{i.uniforms[r].value&&!(r in t)&&(t[r]=i.uniforms[r].value)}),Object.keys(t).forEach(r=>{typeof t[r]=="object"&&t[r].index!==void 0&&(t[r].texture=e.getTexture(t[r].index))}),t}const AY=Object.freeze(Object.defineProperty({__proto__:null,decode:lY,encode:cY,name:aY},Symbol.toStringTag,{value:"Module"})),qP="EXT_feature_metadata",dY=qP;async function fY(i){const e=new Ec(i);pY(e)}function pY(i){var e;const t=i.getExtension(qP),r=t==null||(e=t.schema)===null||e===void 0?void 0:e.classes,n=t==null?void 0:t.featureTables;if((t==null?void 0:t.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),r&&n)for(const l in r){const s=r[l],g=yY(n,l);g&&gY(i,g,s)}}function gY(i,e,t){for(const n in t.properties){var r;const o=t.properties[n],l=e==null||(r=e.properties)===null||r===void 0?void 0:r[n],s=e.count;if(l){const g=mY(i,o,s,l);l.data=g}}}function mY(i,e,t,r){const n=r.bufferView;let o=i.getTypedArrayForBufferView(n);switch(e.type){case"STRING":{const l=r.stringOffsetBufferView,s=i.getTypedArrayForBufferView(l);o=_Y(o,s,t);break}}return o}function yY(i,e){for(const t in i){const r=i[t];if(r.class===e)return r}return null}function _Y(i,e,t){const r=[],n=new TextDecoder("utf8");let o=0;const l=4;for(let s=0;s<t;s++){const g=e[(s+1)*l]-e[s*l],b=i.subarray(o,g+o),T=n.decode(b);r.push(T),o+=g}return r}const $P=[oJ,cJ,AJ,NJ,iY,oY,AY,JJ,Object.freeze(Object.defineProperty({__proto__:null,decode:fY,name:dY},Symbol.toStringTag,{value:"Module"}))];function vY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const r=$P.filter(o=>KP(o.name,e));for(const o of r){var n;(n=o.preprocess)===null||n===void 0||n.call(o,i,e,t)}}async function bY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const r=$P.filter(o=>KP(o.name,e));for(const o of r){var n;await((n=o.decode)===null||n===void 0?void 0:n.call(o,i,e,t))}}function KP(i,e){var t;const r=(e==null||(t=e.gltf)===null||t===void 0?void 0:t.excludeExtensions)||{};return!(i in r&&!r[i])}const LB="KHR_binary_glTF";function xY(i){const e=new Ec(i),{json:t}=e;for(const r of t.images||[]){const n=e.getObjectExtension(r,LB);n&&Object.assign(r,n),e.removeObjectExtension(r,LB)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(LB)}const WP={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},wY={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class BY{constructor(){ye(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),ye(this,"json",void 0)}normalize(e,t){this.json=e.json;const r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(r.asset.version));return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),xY(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in WP)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const r=e[t];if(!(!r||Array.isArray(r))){e[t]=[];for(const n in r){const o=r[n];o.id=o.id||n;const l=e[t].length;e[t].push(o),this.idToIndexMap[t][n]=l}}}_convertObjectIdsToArrayIndices(e){for(const t in WP)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:r,indices:n,material:o}=t;for(const l in r)r[l]=this._convertIdToIndex(r[l],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),o&&(t.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn("gltf v1: json doesn't contain attribute ".concat(t)),e[t]=[]);for(const r of e[t])for(const n in r){const o=r[n],l=this._convertIdToIndex(o,n);r[n]=l}}_convertIdToIndex(e,t){const r=wY[t];if(r in this.idToIndexMap){const n=this.idToIndexMap[r][e];if(!Number.isFinite(n))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return n}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const o of e.materials){var t,r,n;o.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const l=((t=o.values)===null||t===void 0?void 0:t.tex)||((r=o.values)===null||r===void 0?void 0:r.texture2d_0)||((n=o.values)===null||n===void 0?void 0:n.diffuseTex),s=e.textures.findIndex(g=>g.id===l);s!==-1&&(o.pbrMetallicRoughness.baseColorTexture={index:s})}}}function CY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new BY().normalize(i,e)}const EY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},SY={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Eu={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},TY={magFilter:Eu.TEXTURE_MAG_FILTER,minFilter:Eu.TEXTURE_MIN_FILTER,wrapS:Eu.TEXTURE_WRAP_S,wrapT:Eu.TEXTURE_WRAP_T},IY={[Eu.TEXTURE_MAG_FILTER]:Eu.LINEAR,[Eu.TEXTURE_MIN_FILTER]:Eu.NEAREST_MIPMAP_LINEAR,[Eu.TEXTURE_WRAP_S]:Eu.REPEAT,[Eu.TEXTURE_WRAP_T]:Eu.REPEAT};function LY(i){return SY[i]}function MY(i){return EY[i]}class PY{constructor(){ye(this,"baseUri",""),ye(this,"json",{}),ye(this,"buffers",[]),ye(this,"images",[])}postProcess(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:r,buffers:n=[],images:o=[],baseUri:l=""}=e;return iu(r),this.baseUri=l,this.json=r,this.buffers=n,this.images=o,this._resolveTree(this.json,t),this.json}_resolveTree(e){e.bufferViews&&(e.bufferViews=e.bufferViews.map((t,r)=>this._resolveBufferView(t,r))),e.images&&(e.images=e.images.map((t,r)=>this._resolveImage(t,r))),e.samplers&&(e.samplers=e.samplers.map((t,r)=>this._resolveSampler(t,r))),e.textures&&(e.textures=e.textures.map((t,r)=>this._resolveTexture(t,r))),e.accessors&&(e.accessors=e.accessors.map((t,r)=>this._resolveAccessor(t,r))),e.materials&&(e.materials=e.materials.map((t,r)=>this._resolveMaterial(t,r))),e.meshes&&(e.meshes=e.meshes.map((t,r)=>this._resolveMesh(t,r))),e.nodes&&(e.nodes=e.nodes.map((t,r)=>this._resolveNode(t,r))),e.skins&&(e.skins=e.skins.map((t,r)=>this._resolveSkin(t,r))),e.scenes&&(e.scenes=e.scenes.map((t,r)=>this._resolveScene(t,r))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){if(typeof t=="object")return t;const r=this.json[e]&&this.json[e][t];return r||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),r}_resolveScene(e,t){return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map(r=>this.getNode(r)),e}_resolveNode(e,t){return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map(r=>this.getNode(r))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((r,n)=>{const o=this.getMesh(n);return r.id=o.id,r.primitives=r.primitives.concat(o.primitives),r},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map(r=>{r={...r};const n=r.attributes;r.attributes={};for(const o in n)r.attributes[o]=this.getAccessor(n[o]);return r.indices!==void 0&&(r.indices=this.getAccessor(r.indices)),r.material!==void 0&&(r.material=this.getMaterial(r.material)),r})),e}_resolveMaterial(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const r=e.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){if(e.id=e.id||"accessor-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=LY(e.componentType),e.components=MY(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const r=e.bufferView.buffer,{ArrayType:n,byteLength:o}=CB(e,e.bufferView),l=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+r.byteOffset;let s=r.arrayBuffer.slice(l,l+o);e.bufferView.byteStride&&(s=this._getValueFromInterleavedBuffer(r,l,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new n(s)}return e}_getValueFromInterleavedBuffer(e,t,r,n,o){const l=new Uint8Array(o*n);for(let s=0;s<o;s++){const g=t+s*r;l.set(new Uint8Array(e.arrayBuffer.slice(g,g+n)),s*n)}return l.buffer}_resolveTexture(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):IY,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||"sampler-".concat(t),e.parameters={};for(const r in e){const n=this._enumSamplerParameter(r);n!==void 0&&(e.parameters[n]=e[r])}return e}_enumSamplerParameter(e){return TY[e]}_resolveImage(e,t){e.id=e.id||"image-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const r=this.images[t];return r&&(e.image=r),e}_resolveBufferView(e,t){const r=e.buffer,n={id:"bufferView-".concat(t),...e,buffer:this.buffers[r]},o=this.buffers[r].arrayBuffer;let l=this.buffers[r].byteOffset||0;return"byteOffset"in e&&(l+=e.byteOffset),n.data=new Uint8Array(o,l,e.byteLength),n}_resolveCamera(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}function FY(i,e){return new PY().postProcess(i,e)}const XP=1735152710,MB=12,R1=8,DY=1313821514,RY=5130562,kY=0,OY=1,UY=0,pg=!0;function NY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(i.getUint8(e+0))).concat(String.fromCharCode(i.getUint8(e+1))).concat(String.fromCharCode(i.getUint8(e+2))).concat(String.fromCharCode(i.getUint8(e+3)))}function zY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new DataView(i),{magic:n=XP}=t,o=r.getUint32(e,!1);return o===n||o===XP}function QY(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(e),n=NY(r,t+0),o=r.getUint32(t+4,pg),l=r.getUint32(t+8,pg);switch(Object.assign(i,{header:{byteOffset:t,byteLength:l,hasBinChunk:!1},type:n,version:o,json:{},binChunks:[]}),t+=MB,i.version){case 1:return VY(i,r,t);case 2:return HY(i,r,t,{});default:throw new Error("Invalid GLB version ".concat(i.version,". Only supports v1 and v2."))}}function VY(i,e,t){Ls(i.header.byteLength>MB+R1);const r=e.getUint32(t+0,pg),n=e.getUint32(t+4,pg);return t+=R1,Ls(n===UY),PB(i,e,t,r),t+=r,t+=FB(i,e,t,i.header.byteLength),t}function HY(i,e,t,r){return Ls(i.header.byteLength>MB+R1),GY(i,e,t,r),t+i.header.byteLength}function GY(i,e,t,r){for(;t+8<=i.header.byteLength;){const n=e.getUint32(t+0,pg),o=e.getUint32(t+4,pg);switch(t+=R1,o){case DY:PB(i,e,t,n);break;case RY:FB(i,e,t,n);break;case kY:r.strict||PB(i,e,t,n);break;case OY:r.strict||FB(i,e,t,n);break}t+=Hm(n,4)}return t}function PB(i,e,t,r){const n=new Uint8Array(e.buffer,t,r),l=new TextDecoder("utf8").decode(n);return i.json=JSON.parse(l),Hm(r,4)}function FB(i,e,t,r){return i.header.hasBinChunk=!0,i.binChunks.push({byteOffset:t,byteLength:r,arrayBuffer:e.buffer}),Hm(r,4)}async function jY(i,e){var t,r,n,o;let l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;qY(i,e,l,s),CY(i,{normalize:s==null||(t=s.gltf)===null||t===void 0?void 0:t.normalize}),vY(i,s,g);const b=[];if(s!=null&&(r=s.gltf)!==null&&r!==void 0&&r.loadBuffers&&i.json.buffers&&await $Y(i,s,g),s!=null&&(n=s.gltf)!==null&&n!==void 0&&n.loadImages){const F=KY(i,s,g);b.push(F)}const T=bY(i,s,g);return b.push(T),await Promise.all(b),s!=null&&(o=s.gltf)!==null&&o!==void 0&&o.postProcess?FY(i,s):i}function qY(i,e,t,r){if(r.uri&&(i.baseUri=r.uri),e instanceof ArrayBuffer&&!zY(e,t,r)&&(e=new TextDecoder().decode(e)),typeof e=="string")i.json=d8(e);else if(e instanceof ArrayBuffer){const l={};t=QY(l,e,t,r.glb),iu(l.type==="glTF","Invalid GLB magic string ".concat(l.type)),i._glb=l,i.json=l.json}else iu(!1,"GLTF: must be ArrayBuffer or string");const n=i.json.buffers||[];if(i.buffers=new Array(n.length).fill(null),i._glb&&i._glb.header.hasBinChunk){const{binChunks:l}=i._glb;i.buffers[0]={arrayBuffer:l[0].arrayBuffer,byteOffset:l[0].byteOffset,byteLength:l[0].byteLength}}const o=i.json.images||[];i.images=new Array(o.length).fill({})}async function $Y(i,e,t){const r=i.json.buffers||[];for(let l=0;l<r.length;++l){const s=r[l];if(s.uri){var n,o;const{fetch:g}=t;iu(g);const b=RP(s.uri,e),T=await(t==null||(n=t.fetch)===null||n===void 0?void 0:n.call(t,b)),F=await(T==null||(o=T.arrayBuffer)===null||o===void 0?void 0:o.call(T));i.buffers[l]={arrayBuffer:F,byteOffset:0,byteLength:F.byteLength},delete s.uri}else i.buffers[l]===null&&(i.buffers[l]={arrayBuffer:new ArrayBuffer(s.byteLength),byteOffset:0,byteLength:s.byteLength})}}async function KY(i,e,t){const r=WY(i),n=i.json.images||[],o=[];for(const l of r)o.push(XY(i,n[l],l,e,t));return await Promise.all(o)}function WY(i){const e=new Set,t=i.json.textures||[];for(const r of t)r.source!==void 0&&e.add(r.source);return Array.from(e).sort()}async function XY(i,e,t,r,n){const{fetch:o,parse:l}=n;let s;if(e.uri&&!e.hasOwnProperty("bufferView")){const b=RP(e.uri,r);s=await(await o(b)).arrayBuffer(),e.bufferView={data:s}}if(Number.isFinite(e.bufferView)){const b=NZ(i.json,i.buffers,e.bufferView);s=yw(b.buffer,b.byteOffset,b.byteLength)}iu(s,"glTF image has no data");let g=await l(s,[R5,UZ],{mimeType:e.mimeType,basis:r.basis||{format:DP()}},n);g&&g[0]&&(g={compressed:!0,mipmaps:!1,width:g[0].width,height:g[0].height,data:g[0]}),i.images=i.images||[],i.images[t]=g}const My={name:"glTF",id:"gltf",module:"gltf",version:xZ,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:ZY,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function ZY(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;e={...My.options,...e},e.gltf={...My.options.gltf,...e.gltf};const{byteOffset:r=0}=e;return await jY({},i,r,e,t)}async function JY(i){const e=[];return i.scenes.forEach(t=>{t.traverse(r=>{Object.values(r.model.getUniforms()).forEach(n=>{n.loaded===!1&&e.push(n)})})}),await YY(()=>e.some(t=>!t.loaded))}async function YY(i){for(;i();)await new Promise(e=>requestAnimationFrame(e))}const eee=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,tee=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,ZP=[255,255,255,255],iee={scenegraph:{type:"object",value:null,async:!0},getScene:i=>i&&i.scenes?typeof i.scene=="object"?i.scene:i.scenes[i.scene||0]:i,getAnimator:i=>i&&i.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:i=>i.position},getColor:{type:"accessor",value:ZP},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[My]};class DB extends cg{constructor(){super(...arguments),ye(this,"state",void 0)}getShaders(){const e=[j2,q2];return this.props._lighting==="pbr"&&e.push(M2),super.getShaders({vs:eee,fs:tee,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:ZP,transition:!0},instanceModelMatrix:oP})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;t.scenegraph!==r.scenegraph?this._updateScenegraph():t._animations!==r._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,t._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}get isLoaded(){var e;return((e=this.state)===null||e===void 0?void 0:e.scenegraph)&&super.isLoaded}_updateScenegraph(){const e=this.props,{gl:t}=this.context;let r=null;if(e.scenegraph instanceof Ag)r={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){const s=e.scenegraph,g=bZ(t,s,this._getModelOptions());r={gltf:s,...g},JY(g).then(()=>this.setNeedsRedraw())}else e.scenegraph&&(Dn.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),r=e.scenegraph);const n={layer:this,gl:t},o=e.getScene(r,n),l=e.getAnimator(r,n);o instanceof Ag?(this._deleteScenegraph(),this._applyAllAttributes(o),this._applyAnimationsProp(o,l,e._animations),this.setState({scenegraph:o,animator:l})):o!==null&&Dn.warn("invalid scenegraph:",o)()}_applyAllAttributes(e){if(this.state.attributesAvailable){const t=this.getAttributeManager().getAttributes();e.traverse(r=>{this._setModelAttributes(r.model,t)})}}_applyAnimationsProp(e,t,r){if(!e||!t||!r)return;const n=t.getAnimations();Object.keys(r).sort().forEach(o=>{const l=r[o];if(o==="*")n.forEach(s=>{Object.assign(s,l)});else if(Number.isFinite(Number(o))){const s=Number(o);s>=0&&s<n.length?Object.assign(n[s],l):Dn.warn("animation ".concat(o," not found"))()}else{const s=n.find(g=>{let{name:b}=g;return b===o});s?Object.assign(s,l):Dn.warn("animation ".concat(o," not found"))()}})}_deleteScenegraph(){const{scenegraph:e}=this.state;e instanceof Ag&&e.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t=null;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:t,modelOptions:{isInstanced:!0,transpileToGLSL100:!hn(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(e){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(t=>{this._setModelAttributes(t.model,e)})}draw(e){let{moduleParameters:t=null,parameters:r={},context:n}=e;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(n.timeline.getTime()),this.setNeedsRedraw());const{viewport:o}=this.context,{sizeScale:l,sizeMinPixels:s,sizeMaxPixels:g,opacity:b,coordinateSystem:T}=this.props,F=this.getNumInstances();this.state.scenegraph.traverse((k,z)=>{let{worldMatrix:J}=z;k.model.setInstanceCount(F),k.updateModuleSettings(t),k.draw({parameters:r,uniforms:{sizeScale:l,opacity:b,sizeMinPixels:s,sizeMaxPixels:g,composeModelMatrix:aP(o,T),sceneModelMatrix:J,u_Camera:k.model.getUniforms().project_uCameraPosition}})})}}ye(DB,"defaultProps",iee),ye(DB,"layerName","ScenegraphLayer");const ree=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,nee=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function see(i){i.COLOR_0||i.colors||(i.colors={constant:!0,value:new Float32Array([1,1,1])})}const oee={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class RB extends vB{getShaders(){const e=super.getShaders();return e.modules.push(M2),{...e,vs:ree,fs:nee}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:r}=e;t.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!t}),super.draw(e))}getModel(e){const{id:t,pbrMaterial:r}=this.props,n=this.parseMaterial(r,e);this.setState({materialParser:n});const o=this.getShaders();return see(e.attributes),new Yp(this.context.gl,{...this.getShaders(),id:t,geometry:e,defines:{...o.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:r}=this.props,n=this.parseMaterial(e,r);this.setState({materialParser:n}),t.setUniforms(n.uniforms)}}parseMaterial(e,t){var r;const n=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return(r=this.state.materialParser)===null||r===void 0||r.delete(),new yP(this.context.gl,{attributes:{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},material:{unlit:n,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,r=new Uint8ClampedArray(t.length*e.size),n=[];for(let o=0;o<t.length;o++)this.encodePickingColor(t[o],n),r[o*3]=n[0],r[o*3+1]=n[1],r[o*3+2]=n[2];e.value=r}finalizeState(e){var t;super.finalizeState(e),(t=this.state.materialParser)===null||t===void 0||t.delete(),this.setState({materialParser:null})}}ye(RB,"layerName","MeshLayer"),ye(RB,"defaultProps",oee);const aee=6378137,lee=6378137,cee=6356752314245179e-9;function k1(i){return i}new Ut;function uee(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:k1;return"longitude"in i?(e[0]=t(i.longitude),e[1]=t(i.latitude),e[2]=i.height):"x"in i?(e[0]=t(i.x),e[1]=t(i.y),e[2]=i.z):(e[0]=t(i[0]),e[1]=t(i[1]),e[2]=i[2]),e}function hee(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return uee(i,e,wa._cartographicRadians?k1:xG)}function Aee(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:k1;return"longitude"in e?(e.longitude=t(i[0]),e.latitude=t(i[1]),e.height=i[2]):"x"in e?(e.x=t(i[0]),e.y=t(i[1]),e.z=i[2]):(e[0]=t(i[0]),e[1]=t(i[1]),e[2]=i[2]),e}function dee(i,e){return Aee(i,e,wa._cartographicRadians?k1:wG)}const gg=new Ut,fee=new Ut,pee=new Ut;function gee(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:r,oneOverRadiiSquared:n,centerToleranceSquared:o}=e;gg.from(i);const l=gg.x,s=gg.y,g=gg.z,b=r.x,T=r.y,F=r.z,k=l*l*b*b,z=s*s*T*T,J=g*g*F*F,te=k+z+J,ue=Math.sqrt(1/te);if(!Number.isFinite(ue))return;const ce=fee;if(ce.copy(i).scale(ue),te<o)return ce.to(t);const de=n.x,_e=n.y,Ee=n.z,He=pee;He.set(ce.x*de*2,ce.y*_e*2,ce.z*Ee*2);let Ve=(1-ue)*gg.len()/(.5*He.len()),qe=0,Ue,ot,it,De;do{Ve-=qe,Ue=1/(1+Ve*de),ot=1/(1+Ve*_e),it=1/(1+Ve*Ee);const Me=Ue*Ue,Ze=ot*ot,We=it*it,Bt=Me*Ue,Ct=Ze*ot,Lt=We*it;De=k*Me+z*Ze+J*We-1;const Ft=-2*(k*Bt*de+z*Ct*_e+J*Lt*Ee);qe=De/Ft}while(Math.abs(De)>Ay.EPSILON12);return gg.scale([Ue,ot,it]).to(t)}const JP=1e-14,mee=new Ut,YP={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},kB={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Py={east:new Ut,north:new Ut,up:new Ut,west:new Ut,south:new Ut,down:new Ut},yee=new Ut,_ee=new Ut,vee=new Ut;function eF(i,e,t,r,n,o){const l=YP[e]&&YP[e][t];Yu(l&&(!r||r===l));let s,g,b;const T=mee.copy(n);if(eh(T.x,0,JP)&&eh(T.y,0,JP)){const k=Math.sign(T.z);s=yee.fromArray(kB[e]),e!=="east"&&e!=="west"&&s.scale(k),g=_ee.fromArray(kB[t]),t!=="east"&&t!=="west"&&g.scale(k),b=vee.fromArray(kB[r]),r!=="east"&&r!=="west"&&b.scale(k)}else{const{up:k,east:z,north:J}=Py;z.set(-T.y,T.x,0).normalize(),i.geodeticSurfaceNormal(T,k),J.copy(k).cross(z);const{down:te,west:ue,south:ce}=Py;te.copy(k).scale(-1),ue.copy(z).scale(-1),ce.copy(J).scale(-1),s=Py[e],g=Py[t],b=Py[r]}return o[0]=s.x,o[1]=s.y,o[2]=s.z,o[3]=0,o[4]=g.x,o[5]=g.y,o[6]=g.z,o[7]=0,o[8]=b.x,o[9]=b.y,o[10]=b.z,o[11]=0,o[12]=T.x,o[13]=T.y,o[14]=T.z,o[15]=1,o}const O1=new Ut,tF=new Ut,bee=new Ut,nh=new Ut,xee=new Ut,U1=new Ut;class co{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;ye(this,"radii",void 0),ye(this,"radiiSquared",void 0),ye(this,"radiiToTheFourth",void 0),ye(this,"oneOverRadii",void 0),ye(this,"oneOverRadiiSquared",void 0),ye(this,"minimumRadius",void 0),ye(this,"maximumRadius",void 0),ye(this,"centerToleranceSquared",Ay.EPSILON1),ye(this,"squaredXOverSquaredZ",void 0),Yu(e>=0),Yu(t>=0),Yu(r>=0),this.radii=new Ut(e,t,r),this.radiiSquared=new Ut(e*e,t*t,r*r),this.radiiToTheFourth=new Ut(e*e*e*e,t*t*t*t,r*r*r*r),this.oneOverRadii=new Ut(e===0?0:1/e,t===0?0:1/t,r===0?0:1/r),this.oneOverRadiiSquared=new Ut(e===0?0:1/(e*e),t===0?0:1/(t*t),r===0?0:1/(r*r)),this.minimumRadius=Math.min(e,t,r),this.maximumRadius=Math.max(e,t,r),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=tF,n=bee,[,,o]=e;this.geodeticSurfaceNormalCartographic(e,r),n.copy(this.radiiSquared).scale(r);const l=Math.sqrt(r.dot(n));return n.scale(1/l),r.scale(o),n.add(r),n.to(t)}cartesianToCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];U1.from(e);const r=this.scaleToGeodeticSurface(U1,nh);if(!r)return;const n=this.geodeticSurfaceNormal(r,tF),o=xee;o.copy(U1).subtract(r);const l=Math.atan2(n.y,n.x),s=Math.asin(n.z),g=Math.sign(_2(o,U1))*AL(o);return dee([l,s,g],t)}eastNorthUpToFixedFrame(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Bn;return eF(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,r,n){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Bn;return eF(this,e,t,r,n,o)}geocentricSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return O1.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const r=hee(e),n=r[0],o=r[1],l=Math.cos(o);return O1.set(l*Math.cos(n),l*Math.sin(n),Math.sin(o)).normalize(),O1.to(t)}geodeticSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return O1.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return gee(e,this,t)}scaleToGeocentricSurface(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];nh.from(e);const r=nh.x,n=nh.y,o=nh.z,l=this.oneOverRadiiSquared,s=1/Math.sqrt(r*r*l.x+n*n*l.y+o*o*l.z);return nh.multiplyScalar(s).to(t)}transformPositionToScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return nh.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return nh.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];Yu(eh(this.radii.x,this.radii.y,Ay.EPSILON15)),Yu(this.radii.z>0),nh.from(e);const n=nh.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-t))return nh.set(0,0,n).to(r)}}ye(co,"WGS84",new co(aee,lee,cee));function iF(){let i;if(typeof window<"u"&&window.performance)i=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();i=e[0]*1e3+e[1]/1e6}else i=Date.now();return i}class rF{constructor(e,t){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=iF(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(iF()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class wee{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let n=this.stats[t];return n||(e instanceof rF?n=e:n=new rF(t,r),this.stats[t]=n),n}}class Bee{constructor(e,t,r){ye(this,"item",void 0),ye(this,"previous",void 0),ye(this,"next",void 0),this.item=e,this.previous=t,this.next=r}}class Cee{constructor(){ye(this,"head",null),ye(this,"tail",null),ye(this,"_length",0)}get length(){return this._length}add(e){const t=new Bee(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const r=e.next;e.next=t,this.tail===e?this.tail=t:r.previous=t,t.next=r,t.previous=e,++this._length}}class Eee{constructor(){ye(this,"_list",void 0),ye(this,"_sentinel",void 0),ye(this,"_trimTiles",void 0),this._list=new Cee,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,r){t._cacheNode||(t._cacheNode=this._list.add(t),r&&r(e,t))}unloadTile(e,t,r){const n=t._cacheNode;n&&(this._list.remove(n),t._cacheNode=null,r&&r(e,t))}unloadTiles(e,t){const r=this._trimTiles;this._trimTiles=!1;const n=this._list,o=e.maximumMemoryUsage*1024*1024,l=this._sentinel;let s=n.head;for(;s!==l&&(e.gpuMemoryUsageInBytes>o||r);){const g=s.item;s=s.next,this.unloadTile(e,g,t)}}trim(){this._trimTiles=!0}}function See(i,e){Ls(i),Ls(e);const{rtcCenter:t,gltfUpAxis:r}=e,{computedTransform:n,boundingVolume:{center:o}}=i;let l=new Bn(n);switch(t&&l.translate(t),r){case"Z":break;case"Y":const F=new Bn().rotateX(Math.PI/2);l=l.multiplyRight(F);break;case"X":const k=new Bn().rotateY(-Math.PI/2);l=l.multiplyRight(k);break}e.isQuantized&&l.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const s=new Ut(o);e.cartesianModelMatrix=l,e.cartesianOrigin=s;const g=co.WGS84.cartesianToCartographic(s,new Ut),T=co.WGS84.eastNorthUpToFixedFrame(s).invert();e.cartographicModelMatrix=T.multiplyRight(l),e.cartographicOrigin=g,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const nF=new Ut,OB=new Ut,UB=new Cu([new rh,new rh,new rh,new rh,new rh,new rh]);function Tee(i,e){const{cameraDirection:t,cameraUp:r,height:n}=i,{metersPerUnit:o}=i.distanceScales,l=N1(i,i.center),s=co.WGS84.eastNorthUpToFixedFrame(l),g=i.unprojectPosition(i.cameraPosition),b=co.WGS84.cartographicToCartesian(g,new Ut),T=new Ut(s.transformAsVector(new Ut(t).scale(o))).normalize(),F=new Ut(s.transformAsVector(new Ut(r).scale(o))).normalize();Lee(i);const k=i.constructor,{longitude:z,latitude:J,width:te,bearing:ue,zoom:ce}=i,de=new k({longitude:z,latitude:J,height:n,width:te,bearing:ue,zoom:ce,pitch:0});return{camera:{position:b,direction:T,up:F},viewport:i,topDownViewport:de,height:n,cullingVolume:UB,frameNumber:e,sseDenominator:1.15}}function Iee(i,e,t){if(t===0||i.length<=t)return[i,[]];const r=[],{longitude:n,latitude:o}=e.viewport;for(const[b,T]of i.entries()){const[F,k]=T.header.mbs,z=Math.abs(n-F),J=Math.abs(o-k),te=Math.sqrt(J*J+z*z);r.push([b,te])}const l=r.sort((b,T)=>b[1]-T[1]),s=[];for(let b=0;b<t;b++)s.push(i[l[b][0]]);const g=[];for(let b=t;b<l.length;b++)g.push(i[l[b][0]]);return[s,g]}function Lee(i){const e=i.getFrustumPlanes(),t=sF(e.near,i.cameraPosition),r=N1(i,t),n=N1(i,i.cameraPosition,OB);let o=0;UB.planes[o++].fromPointNormal(r,nF.copy(r).subtract(n));for(const l in e){if(l==="near")continue;const s=e[l],g=sF(s,t,OB),b=N1(i,g,OB);UB.planes[o++].fromPointNormal(b,nF.copy(r).subtract(b))}}function sF(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Ut;const r=i.normal.dot(e);return t.copy(i.normal).scale(i.distance-r).add(e),t}function N1(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Ut;const r=i.unprojectPosition(e);return co.WGS84.cartographicToCartesian(r,t)}const Mee=6378137,Pee=6378137,NB=6356752314245179e-9,oF=new Ut;function Fee(i,e){if(i instanceof Cy){const{halfAxes:t}=i,r=Ree(t);return Math.log2(NB/(r+e[2]))}else if(i instanceof By){const{radius:t}=i;return Math.log2(NB/(t+e[2]))}else if(i.width&&i.height){const{width:t,height:r}=i,n=Math.log2(Mee/t),o=Math.log2(Pee/r);return(n+o)/2}return 1}function aF(i,e,t){const r=co.WGS84.cartographicToCartesian([i.xmax,i.ymax,i.zmax],new Ut),n=Math.sqrt(Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2)+Math.pow(r[2]-t[2],2));return Math.log2(NB/(n+e[2]))}function Dee(i,e,t){const[r,n,o,l]=i;return aF({xmin:r,xmax:o,ymin:n,ymax:l,zmin:0,zmax:0},e,t)}function Ree(i){i.getColumn(0,oF);const e=i.getColumn(1),t=i.getColumn(2);return oF.add(e).add(t).len()}const ru={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},IA={ADD:1,REPLACE:2},mg={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Su={I3S:"I3S",TILES3D:"TILES3D"},z1={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},kee={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function lF(i){return i!=null}const Tl=new Ut,Q1=new Ut,Oee=new Ut,Uee=new Ut;function zB(i,e,t){if(Ls(i,"3D Tile: boundingVolume must be defined"),i.box)return zee(i.box,e,t);if(i.region){const[r,n,o,l,s,g]=i.region,b=co.WGS84.cartographicToCartesian([CA(r),CA(l),s],Oee),T=co.WGS84.cartographicToCartesian([CA(o),CA(n),g],Uee),F=new Ut().addVectors(b,T).multiplyScalar(.5),k=new Ut().subVectors(b,T).len()/2;return cF([F[0],F[1],F[2],k],new Bn)}if(i.sphere)return cF(i.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function Nee(i,e){if(i.box)return Qee(e);if(i.region){const[t,r,n,o,l,s]=i.region;return[[CA(t),CA(r),l],[CA(n),CA(o),s]]}if(i.sphere)return Vee(e);throw new Error("Unkown boundingVolume type")}function zee(i,e,t){const r=new Ut(i[0],i[1],i[2]);e.transform(r,r);let n=[];if(i.length===10){const b=i.slice(3,6),T=new hy;T.fromArray(i,6);const F=new Ut([1,0,0]),k=new Ut([0,1,0]),z=new Ut([0,0,1]);F.transformByQuaternion(T),F.scale(b[0]),k.transformByQuaternion(T),k.scale(b[1]),z.transformByQuaternion(T),z.scale(b[2]),n=[...F.toArray(),...k.toArray(),...z.toArray()]}else n=[...i.slice(3,6),...i.slice(6,9),...i.slice(9,12)];const o=e.transformAsVector(n.slice(0,3)),l=e.transformAsVector(n.slice(3,6)),s=e.transformAsVector(n.slice(6,9)),g=new xo([o[0],o[1],o[2],l[0],l[1],l[2],s[0],s[1],s[2]]);return lF(t)?(t.center=r,t.halfAxes=g,t):new Cy(r,g)}function cF(i,e,t){const r=new Ut(i[0],i[1],i[2]);e.transform(r,r);const n=e.getScale(Q1),o=Math.max(Math.max(n[0],n[1]),n[2]),l=i[3]*o;return lF(t)?(t.center=r,t.radius=l,t):new By(r,l)}function Qee(i){const e=uF(),{halfAxes:t}=i,r=new Ut(t.getColumn(0)),n=new Ut(t.getColumn(1)),o=new Ut(t.getColumn(2));for(let l=0;l<2;l++){for(let s=0;s<2;s++){for(let g=0;g<2;g++)Tl.copy(i.center),Tl.add(r),Tl.add(n),Tl.add(o),hF(e,Tl),o.negate();n.negate()}r.negate()}return e}function Vee(i){const e=uF(),{center:t,radius:r}=i,n=co.WGS84.scaleToGeodeticSurface(t,Tl);let o;n?o=co.WGS84.geodeticSurfaceNormal(n):o=new Ut(0,0,1);let l=new Ut(o[2],-o[1],0);l.len()>0?l.normalize():l=new Ut(0,1,0);const s=l.clone().cross(o);for(const g of[l,s,o]){Q1.copy(g).scale(r);for(let b=0;b<2;b++)Tl.copy(t),Tl.add(Q1),hF(e,Tl),Q1.negate()}return e}function uF(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function hF(i,e){co.WGS84.cartesianToCartographic(e,Tl),i[0][0]=Math.min(i[0][0],Tl[0]),i[0][1]=Math.min(i[0][1],Tl[1]),i[0][2]=Math.min(i[0][2],Tl[2]),i[1][0]=Math.max(i[1][0],Tl[0]),i[1][1]=Math.max(i[1][1],Tl[1]),i[1][2]=Math.max(i[1][2],Tl[2])}new Ut,new Ut,new Bn,new Ut,new Ut,new Ut;function Hee(i,e){const t=i*e;return 1-Math.exp(-(t*t))}function Gee(i,e){if(i.dynamicScreenSpaceError&&i.dynamicScreenSpaceErrorComputedDensity){const t=i.dynamicScreenSpaceErrorComputedDensity,r=i.dynamicScreenSpaceErrorFactor;return Hee(e,t)*r}return 0}function jee(i,e,t){const r=i.tileset,n=i.parent&&i.parent.lodMetricValue||i.lodMetricValue,o=t?n:i.lodMetricValue;if(o===0)return 0;const l=Math.max(i._distanceToCamera,1e-7),{height:s,sseDenominator:g}=e,{viewDistanceScale:b}=r.options;let T=o*s*(b||1)/(l*g);return T-=Gee(r,l),T}const QB=new Ut,AF=new Ut,fd=new Ut,dF=new Ut,qee=new Ut,VB=new Bn,fF=new Bn;function $ee(i,e){if(i.lodMetricValue===0||isNaN(i.lodMetricValue))return"DIG";const t=2*pF(i,e);return t<2?"OUT":!i.header.children||t<=i.lodMetricValue?"DRAW":i.header.children?"DIG":"OUT"}function pF(i,e){const{topDownViewport:t}=e,r=i.header.mbs[1],n=i.header.mbs[0],o=i.header.mbs[2],l=i.header.mbs[3],s=[...i.boundingVolume.center],g=t.unprojectPosition(t.cameraPosition);co.WGS84.cartographicToCartesian(g,QB),AF.copy(QB).subtract(s).normalize(),co.WGS84.eastNorthUpToFixedFrame(s,VB),fF.copy(VB).invert(),fd.copy(QB).transform(fF);const b=Math.sqrt(fd[0]*fd[0]+fd[1]*fd[1]),T=b*b/fd[2];dF.copy([fd[0],fd[1],T]);const k=dF.transform(VB).subtract(s).normalize(),J=AF.cross(k).normalize().scale(l).add(s),te=co.WGS84.cartesianToCartographic(J),ue=t.project([n,r,o]),ce=t.project(te);return qee.copy(ue).subtract(ce).magnitude()}function Kee(i){return{assetGltfUpAxis:i.asset&&i.asset.gltfUpAxis||"Y"}}class gF{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;ye(this,"_map",new Map),ye(this,"_array",void 0),ye(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Ls(e<this._array.length),this._array[e]}set(e,t){Ls(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Ls(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Ls(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const Wee={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class V1{traversalFinished(e){return!0}constructor(e){ye(this,"options",void 0),ye(this,"root",null),ye(this,"selectedTiles",{}),ye(this,"requestedTiles",{}),ye(this,"emptyTiles",{}),ye(this,"lastUpdate",new Date().getTime()),ye(this,"updateDebounceTime",1e3),ye(this,"_traversalStack",new gF),ye(this,"_emptyTraversalStack",new gF),ye(this,"_frameNumber",null),this.options={...Wee,...e}}traverse(e,t,r){this.root=e,this.options={...this.options,...r},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){const o=r.pop();let l=!1;this.canTraverse(o,t)&&(this.updateChildTiles(o,t),l=this.updateAndPushChildren(o,t,r,o.hasRenderContent?o._selectionDepth+1:o._selectionDepth));const s=o.parent,g=!!(!s||s._shouldRefine),b=!l;o.hasRenderContent?o.refine===IA.ADD?(this.loadTile(o,t),this.selectTile(o,t)):o.refine===IA.REPLACE&&(this.loadTile(o,t),b&&this.selectTile(o,t)):(this.emptyTiles[o.id]=o,this.loadTile(o,t),b&&this.selectTile(o,t)),this.touchTile(o,t),o._shouldRefine=l&&g}const n=new Date().getTime();(this.traversalFinished(t)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const r=e.children;for(const n of r)this.updateTile(n,t)}updateAndPushChildren(e,t,r,n){const{loadSiblings:o,skipLevelOfDetail:l}=this.options,s=e.children;s.sort(this.compareDistanceToCamera.bind(this));const g=e.refine===IA.REPLACE&&e.hasRenderContent&&!l;let b=!1,T=!0;for(const F of s)if(F._selectionDepth=n,F.isVisibleAndInRequestVolume?(r.find(F)&&r.delete(F),r.push(F),b=!0):(g||o)&&(this.loadTile(F,t),this.touchTile(F,t)),g){let k;if(F._inRequestVolume?F.hasRenderContent?k=F.contentAvailable:k=this.executeEmptyTraversal(F,t):k=!1,T=T&&k,!T)return!1}return b||(T=!1),T}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!n&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,t,r):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=e._screenSpaceError;return r&&(n=e.getScreenSpaceError(t,!0)),n>this.options.maximumScreenSpaceError}updateTileVisibility(e,t){const r=[];if(this.options.viewportTraversersMap)for(const n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===t.viewport.id&&r.push(n);else r.push(t.viewport.id);e.updateVisibility(t,r)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let r=!1;for(const n of e.children)n.updateVisibility(t),r=r||n.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(e,t){let r=!0;const n=this._emptyTraversalStack;for(n.push(e);n.length>0&&r;){const o=n.pop();if(this.updateTile(o,t),o.isVisibleAndInRequestVolume||this.loadTile(o,t),this.touchTile(o,t),!o.hasRenderContent&&this.canTraverse(o,t,!1,!0)){const s=o.children;for(const g of s)n.find(g)&&n.delete(g),n.push(g)}else!o.contentAvailable&&!o.hasEmptyContent&&(r=!1)}return r}}const mF=new Ut;function Xee(i){return i!=null}class HB{constructor(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";ye(this,"tileset",void 0),ye(this,"header",void 0),ye(this,"id",void 0),ye(this,"url",void 0),ye(this,"parent",void 0),ye(this,"refine",void 0),ye(this,"type",void 0),ye(this,"contentUrl",void 0),ye(this,"lodMetricType","geometricError"),ye(this,"lodMetricValue",0),ye(this,"boundingVolume",null),ye(this,"content",null),ye(this,"contentState",ru.UNLOADED),ye(this,"gpuMemoryUsageInBytes",0),ye(this,"children",[]),ye(this,"depth",0),ye(this,"viewportIds",[]),ye(this,"transform",new Bn),ye(this,"extensions",null),ye(this,"implicitTiling",null),ye(this,"userData",{}),ye(this,"computedTransform",void 0),ye(this,"hasEmptyContent",!1),ye(this,"hasTilesetContent",!1),ye(this,"traverser",new V1({})),ye(this,"_cacheNode",null),ye(this,"_frameNumber",null),ye(this,"_expireDate",null),ye(this,"_expiredContent",null),ye(this,"_boundingBox",void 0),ye(this,"_distanceToCamera",0),ye(this,"_screenSpaceError",0),ye(this,"_visibilityPlaneMask",void 0),ye(this,"_visible",void 0),ye(this,"_contentBoundingVolume",void 0),ye(this,"_viewerRequestVolume",void 0),ye(this,"_initialTransform",new Bn),ye(this,"_priority",0),ye(this,"_selectedFrame",0),ye(this,"_requestedFrame",0),ye(this,"_selectionDepth",0),ye(this,"_touchedFrame",0),ye(this,"_centerZDepth",0),ye(this,"_shouldRefine",!1),ye(this,"_stackLength",0),ye(this,"_visitedFrame",0),ye(this,"_inRequestVolume",!1),ye(this,"_lodJudge",null),this.header=t,this.tileset=e,this.id=n||t.id,this.url=t.url,this.parent=r,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===ru.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===ru.UNLOADED}get contentExpired(){return this.contentState===ru.EXPIRED}get contentFailed(){return this.contentState===ru.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=Nee(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case Su.I3S:return pF(this,e);case Su.TILES3D:return jee(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,r=this.refine===IA.ADD||t;if(r&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===ru.UNLOADED)return-1;const n=this.parent,l=n&&(!r||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,s=e.root?e.root._screenSpaceError:0;return Math.max(s-l,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=ru.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=ru.UNLOADED,!1;try{const r=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,o={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(n.id)}};return this.content=await id(r,n,o),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=ru.READY,this._onContentLoaded(),!0}catch(r){throw this.contentState=ru.FAILED,r}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=ru.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const r=this.parent,n=r?r._visibilityPlaneMask:Cu.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const o=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==Cu.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:r}=e,{boundingVolume:n}=this;return r.computeVisibilityWithPlaneMask(n,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:t}=e;const r=this.boundingVolume;return mF.subVectors(r.center,t.position),t.direction.dot(mF)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(Xee(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=ru.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Bn(e.transform):new Bn;const t=this.parent,r=this.tileset,n=t&&t.computedTransform?t.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new Bn(n).multiplyRight(this.transform);const o=t&&t._initialTransform?t._initialTransform.clone():new Bn;this._initialTransform=new Bn(o).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=ru.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Cu.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||IA.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=zB(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=zB(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=zB(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Bn).clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return Kee(this.tileset.tileset)}}}class Zee extends V1{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const r=e.children.length>0;if(e.hasTilesetContent&&r){const l=e.children[0];this.updateTileVisibility(l,t),e._visible=l._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}const n=e.refine===IA.REPLACE,o=e._optimChildrenWithinParent===kee.USE_OPTIMIZATION;if(n&&o&&r&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){const{parent:r}=e;return!r||r.hasTilesetContent||r.refine!==IA.ADD?!1:!this.shouldRefine(e,t,!0)}}class Jee{constructor(){ye(this,"frameNumberMap",new Map)}register(e,t){const r=this.frameNumberMap.get(e)||new Map,n=r.get(t)||0;r.set(t,n+1),this.frameNumberMap.set(e,r)}deregister(e,t){const r=this.frameNumberMap.get(e);if(!r)return;const n=r.get(t)||1;r.set(t,n-1)}isZero(e,t){var r;return(((r=this.frameNumberMap.get(e))===null||r===void 0?void 0:r.get(t))||0)===0}}const GB={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Yee{constructor(){ye(this,"_statusMap",void 0),ye(this,"pendingTilesRegister",new Jee),this._statusMap={}}add(e,t,r,n){if(!this._statusMap[t]){const{frameNumber:o,viewport:{id:l}}=n;this._statusMap[t]={request:e,callback:r,key:t,frameState:n,status:GB.REQUESTED},this.pendingTilesRegister.register(l,o),e().then(s=>{this._statusMap[t].status=GB.COMPLETED;const{frameNumber:g,viewport:{id:b}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(b,g),this._statusMap[t].callback(s,n)}).catch(s=>{this._statusMap[t].status=GB.ERROR;const{frameNumber:g,viewport:{id:b}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(b,g),r(s)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:r,viewport:{id:n}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(n,r);const{frameNumber:o,viewport:{id:l}}=t;this.pendingTilesRegister.register(l,o),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class ete extends V1{constructor(e){super(e),ye(this,"_tileManager",void 0),this._tileManager=new Yee}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=$ee(e,t),e._lodJudge==="DIG"}updateChildTiles(e,t){const r=e.header.children||[],n=e.children,o=e.tileset;for(const l of r){const s="".concat(l.id,"-").concat(t.viewport.id),g=n&&n.find(b=>b.id===s);if(g)g&&this.updateTile(g,t);else{let b=()=>this._loadTile(l.id,o);this._tileManager.find(s)?this._tileManager.update(s,t):(o.tileset.nodePages&&(b=()=>o.tileset.nodePagesTile.formTileFromNodePages(l.id)),this._tileManager.add(b,s,F=>this._onTileLoad(F,e,s),t))}}return!1}async _loadTile(e,t){const{loader:r}=t,n=t.getTileUrl("".concat(t.url,"/nodes/").concat(e)),o={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await id(n,r,o)}_onTileLoad(e,t,r){const n=new HB(t.tileset,e,t,r);t.children.push(n);const o=this._tileManager.find(n.id).frameState;this.updateTile(n,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,o)}}const tte={description:"",ellipsoid:co.WGS84,modelMatrix:new Bn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:i=>i,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},H1="Tiles In Tileset(s)",jB="Tiles In Memory",yF="Tiles In View",_F="Tiles To Render",vF="Tiles Loaded",qB="Tiles Loading",bF="Tiles Unloaded",xF="Failed Tile Loads",wF="Points/Vertices",$B="Tile Memory Use";class ite{constructor(e,t){ye(this,"options",void 0),ye(this,"loadOptions",void 0),ye(this,"type",void 0),ye(this,"tileset",void 0),ye(this,"loader",void 0),ye(this,"url",void 0),ye(this,"basePath",void 0),ye(this,"modelMatrix",void 0),ye(this,"ellipsoid",void 0),ye(this,"lodMetricType",void 0),ye(this,"lodMetricValue",void 0),ye(this,"refine",void 0),ye(this,"root",null),ye(this,"roots",{}),ye(this,"asset",{}),ye(this,"description",""),ye(this,"properties",void 0),ye(this,"extras",null),ye(this,"attributions",{}),ye(this,"credits",{}),ye(this,"stats",void 0),ye(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),ye(this,"cartographicCenter",null),ye(this,"cartesianCenter",null),ye(this,"zoom",1),ye(this,"boundingVolume",null),ye(this,"dynamicScreenSpaceErrorComputedDensity",0),ye(this,"maximumMemoryUsage",32),ye(this,"gpuMemoryUsageInBytes",0),ye(this,"_frameNumber",0),ye(this,"_queryParams",{}),ye(this,"_extensionsUsed",[]),ye(this,"_tiles",{}),ye(this,"_pendingCount",0),ye(this,"selectedTiles",[]),ye(this,"traverseCounter",0),ye(this,"geometricError",0),ye(this,"lastUpdatedVieports",null),ye(this,"_requestedTiles",[]),ye(this,"_emptyTiles",[]),ye(this,"frameStateData",{}),ye(this,"_traverser",void 0),ye(this,"_cache",new Eee),ye(this,"_requestScheduler",void 0),ye(this,"updatePromise",null),ye(this,"tilesetInitializationPromise",void 0),this.options={...tte,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||_w(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new C8({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new wee({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(e.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const r=[];for(const n of t){const o=n.id;this._needTraverse(o)?r.push(o):this.traverseCounter--}for(const n of t){const o=n.id;if(this.roots[o]||(this.roots[o]=this._initializeTileHeaders(this.tileset,null)),!r.includes(o))continue;const l=Tee(n,this._frameNumber);this._traverser.traverse(this.roots[o],l,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[t],n=Object.values(this._traverser.selectedTiles),[o,l]=Iee(n,e,this.options.maximumTilesSelected);r.selectedTiles=o;for(const s of l)s.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const r=new Set(e.map(l=>l.id)),n=new Set(t.map(l=>l.id));let o=e.filter(l=>!n.has(l.id)).length>0;return o=o||t.filter(l=>!r.has(l.id)).length>0,o}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(e++,r.content.pointCount?t+=r.content.pointCount:t+=r.content.vertexCount);this.stats.get(yF).count=this.selectedTiles.length,this.stats.get(_F).count=e,this.stats.get(wF).count=t}async _initializeTileSet(e){this.type===Su.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Su.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Su.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const t=this.tileset.fullExtent;if(t){const{xmin:n,xmax:o,ymin:l,ymax:s,zmin:g,zmax:b}=t;this.cartographicCenter=new Ut(n+(o-n)/2,l+(s-l)/2,g+(b-g)/2),this.cartesianCenter=co.WGS84.cartographicToCartesian(this.cartographicCenter,new Ut),this.zoom=aF(t,this.cartographicCenter,this.cartesianCenter);return}const r=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(r){const[n,o,l,s]=r;this.cartographicCenter=new Ut(n+(l-n)/2,o+(s-o)/2,0),this.cartesianCenter=co.WGS84.cartographicToCartesian(this.cartographicCenter,new Ut),this.zoom=Dee(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Ut,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Ut,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?this.cartographicCenter=co.WGS84.cartesianToCartographic(t,new Ut):this.cartographicCenter=new Ut(0,0,-co.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=Fee(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(H1),this.stats.get(qB),this.stats.get(jB),this.stats.get(yF),this.stats.get(_F),this.stats.get(vF),this.stats.get(bF),this.stats.get(xF),this.stats.get(wF),this.stats.get($B,"memory")}_initializeTileHeaders(e,t){const r=new HB(this,e.root,t);if(t&&(t.children.push(r),r.depth=t.depth+1),this.type===Su.TILES3D){const o=[];for(o.push(r);o.length>0;){const l=o.pop();this.stats.get(H1).incrementCount();const s=l.header.children||[];for(const g of s){var n;const b=new HB(this,g,l);if((n=b.contentUrl)!==null&&n!==void 0&&n.includes("?session=")){const F=new URL(b.contentUrl).searchParams.get("session");F&&(this._queryParams.session=F)}l.children.push(b),b.depth=l.depth+1,o.push(b)}}}return r}_initializeTraverser(){let e;switch(this.type){case Su.TILES3D:e=Zee;break;case Su.I3S:e=ete;break;default:e=V1}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(r){this._onTileLoadError(e,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(xF).incrementCount();const r=t.message||t.toString(),n=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(r)),this.options.onTileError(e,r,n)}_onTileLoad(e,t){if(t){if(this.type===Su.I3S){var r,n;const o=((r=this.tileset)===null||r===void 0||(n=r.nodePagesTile)===null||n===void 0?void 0:n.nodesInNodePages)||0;this.stats.get(H1).reset(),this.stats.get(H1).addCount(o)}e&&e.content&&See(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===Su.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Su.TILES3D){var t;const{extensionsRemoved:r=[]}=((t=e.content)===null||t===void 0?void 0:t.gltf)||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(qB).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(qB).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(vF).incrementCount(),this.stats.get(jB).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get($B).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(jB).decrementCount(),this.stats.get(bF).incrementCount(),this.stats.get($B).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const r of t.children)e.push(r);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,r=[];for(r.push(t);r.length>0;){e=r.pop();for(const n of e.children)r.push(n);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),r=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const BF="3.4.14",Fy={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function CF(i,e,t){Ls(i instanceof ArrayBuffer);const r=new TextDecoder("utf8"),n=new Uint8Array(i,e,t);return r.decode(n)}function rte(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const t=new DataView(i);return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}const nte={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},sa={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Vn={...nte,...sa},KB={[sa.DOUBLE]:Float64Array,[sa.FLOAT]:Float32Array,[sa.UNSIGNED_SHORT]:Uint16Array,[sa.UNSIGNED_INT]:Uint32Array,[sa.UNSIGNED_BYTE]:Uint8Array,[sa.BYTE]:Int8Array,[sa.SHORT]:Int16Array,[sa.INT]:Int32Array},ste={DOUBLE:sa.DOUBLE,FLOAT:sa.FLOAT,UNSIGNED_SHORT:sa.UNSIGNED_SHORT,UNSIGNED_INT:sa.UNSIGNED_INT,UNSIGNED_BYTE:sa.UNSIGNED_BYTE,BYTE:sa.BYTE,SHORT:sa.SHORT,INT:sa.INT},WB="Failed to convert GL type";class Gh{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in KB)if(KB[t]===e)return t;throw new Error(WB)}static fromName(e){const t=ste[e];if(!t)throw new Error(WB);return t}static getArrayType(e){switch(e){case sa.UNSIGNED_SHORT_5_6_5:case sa.UNSIGNED_SHORT_4_4_4_4:case sa.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=KB[e];if(!t)throw new Error(WB);return t}}static getByteSize(e){return Gh.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Gh.getArrayType(e)}static createTypedArray(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;n===void 0&&(n=(t.byteLength-r)/Gh.getByteSize(e));const o=Gh.getArrayType(e);return new o(t,r,n)}}function ote(i,e){if(!i)throw new Error("math.gl assertion failed. ".concat(e))}function ate(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const t=i>>11&31,r=i>>5&63,n=i&31;return e[0]=t<<3,e[1]=r<<2,e[2]=n<<3,e}new y2,new Ut,new y2,new y2;function EF(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return EA(i,0,e)/e*2-1}function SF(i){return i<0?-1:1}function lte(i,e,t,r){if(ote(r),i<0||i>t||e<0||e>t)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(t));if(r.x=EF(i,t),r.y=EF(e,t),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const n=r.x;r.x=(1-Math.abs(r.y))*SF(n),r.y=(1-Math.abs(n))*SF(r.y)}return r.normalize()}function cte(i,e,t){return lte(i,e,255,t)}class XB{constructor(e,t){ye(this,"json",void 0),ye(this,"buffer",void 0),ye(this,"featuresLength",0),ye(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Vn.UNSIGNED_INT,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,t,r,1,n.byteOffset):n}getPropertyArray(e,t,r){const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(t=Gh.fromName(n.componentType)),this._getTypedArrayFromBinary(e,t,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,t,n)}getProperty(e,t,r,n,o){const l=this.json[e];if(!l)return l;const s=this.getPropertyArray(e,t,r);if(r===1)return s[n];for(let g=0;g<r;++g)o[g]=s[r*n+g];return o}_getTypedArrayFromBinary(e,t,r,n,o){const l=this._cachedTypedArrays;let s=l[e];return s||(s=Gh.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+o,n*r),l[e]=s),s}_getTypedArrayFromArray(e,t,r){const n=this._cachedTypedArrays;let o=n[e];return o||(o=Gh.createTypedArray(t,r),n[e]=o),o}}const ute={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hte={SCALAR:(i,e)=>i[e],VEC2:(i,e)=>[i[2*e+0],i[2*e+1]],VEC3:(i,e)=>[i[3*e+0],i[3*e+1],i[3*e+2]],VEC4:(i,e)=>[i[4*e+0],i[4*e+1],i[4*e+2],i[4*e+3]],MAT2:(i,e)=>[i[4*e+0],i[4*e+1],i[4*e+2],i[4*e+3]],MAT3:(i,e)=>[i[9*e+0],i[9*e+1],i[9*e+2],i[9*e+3],i[9*e+4],i[9*e+5],i[9*e+6],i[9*e+7],i[9*e+8]],MAT4:(i,e)=>[i[16*e+0],i[16*e+1],i[16*e+2],i[16*e+3],i[16*e+4],i[16*e+5],i[16*e+6],i[16*e+7],i[16*e+8],i[16*e+9],i[16*e+10],i[16*e+11],i[16*e+12],i[16*e+13],i[16*e+14],i[16*e+15]]},Ate={SCALAR:(i,e,t)=>{e[t]=i},VEC2:(i,e,t)=>{e[2*t+0]=i[0],e[2*t+1]=i[1]},VEC3:(i,e,t)=>{e[3*t+0]=i[0],e[3*t+1]=i[1],e[3*t+2]=i[2]},VEC4:(i,e,t)=>{e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},MAT2:(i,e,t)=>{e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},MAT3:(i,e,t)=>{e[9*t+0]=i[0],e[9*t+1]=i[1],e[9*t+2]=i[2],e[9*t+3]=i[3],e[9*t+4]=i[4],e[9*t+5]=i[5],e[9*t+6]=i[6],e[9*t+7]=i[7],e[9*t+8]=i[8],e[9*t+9]=i[9]},MAT4:(i,e,t)=>{e[16*t+0]=i[0],e[16*t+1]=i[1],e[16*t+2]=i[2],e[16*t+3]=i[3],e[16*t+4]=i[4],e[16*t+5]=i[5],e[16*t+6]=i[6],e[16*t+7]=i[7],e[16*t+8]=i[8],e[16*t+9]=i[9],e[16*t+10]=i[10],e[16*t+11]=i[11],e[16*t+12]=i[12],e[16*t+13]=i[13],e[16*t+14]=i[14],e[16*t+15]=i[15]}};function dte(i,e,t,r){const{componentType:n}=i;Ls(i.componentType);const o=typeof n=="string"?Gh.fromName(n):n,l=ute[i.type],s=hte[i.type],g=Ate[i.type];return t+=i.byteOffset,{values:Gh.createTypedArray(o,e,t,l*r),type:o,size:l,unpacker:s,packer:g}}const jh=i=>i!==void 0;function fte(i,e,t){if(!e)return null;let r=i.getExtension("3DTILES_batch_table_hierarchy");const n=e.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=n,r=n),r?pte(r,t):null}function pte(i,e){let t,r,n;const o=i.instancesLength,l=i.classes;let s=i.classIds,g=i.parentCounts,b=i.parentIds,T=o;jh(s.byteOffset)&&(s.componentType=defaultValue(s.componentType,GL.UNSIGNED_SHORT),s.type=AttributeType.SCALAR,n=getBinaryAccessor(s),s=n.createArrayBufferView(e.buffer,e.byteOffset+s.byteOffset,o));let F;if(jh(g))for(jh(g.byteOffset)&&(g.componentType=defaultValue(g.componentType,GL.UNSIGNED_SHORT),g.type=AttributeType.SCALAR,n=getBinaryAccessor(g),g=n.createArrayBufferView(e.buffer,e.byteOffset+g.byteOffset,o)),F=new Uint16Array(o),T=0,t=0;t<o;++t)F[t]=T,T+=g[t];jh(b)&&jh(b.byteOffset)&&(b.componentType=defaultValue(b.componentType,GL.UNSIGNED_SHORT),b.type=AttributeType.SCALAR,n=getBinaryAccessor(b),b=n.createArrayBufferView(e.buffer,e.byteOffset+b.byteOffset,T));const k=l.length;for(t=0;t<k;++t){const ue=l[t].length,ce=l[t].instances,de=getBinaryProperties(ue,ce,e);l[t].instances=combine(de,ce)}const z=new Array(k).fill(0),J=new Uint16Array(o);for(t=0;t<o;++t)r=s[t],J[t]=z[r],++z[r];const te={classes:l,classIds:s,classIndexes:J,parentCounts:g,parentIndexes:F,parentIds:b};return yte(te),te}function Dy(i,e,t){if(!i)return;const r=i.parentCounts;return i.parentIds?t(i,e):r>0?gte(i,e,t):mte(i,e,t)}function gte(i,e,t){const r=i.classIds,n=i.parentCounts,o=i.parentIds,l=i.parentIndexes,s=r.length,g=scratchVisited;g.length=Math.max(g.length,s);const b=++marker,T=scratchStack;for(T.length=0,T.push(e);T.length>0;){if(e=T.pop(),g[e]===b)continue;g[e]=b;const F=t(i,e);if(jh(F))return F;const k=n[e],z=l[e];for(let J=0;J<k;++J){const te=o[z+J];te!==e&&T.push(te)}}return null}function mte(i,e,t){let r=!0;for(;r;){const n=t(i,e);if(jh(n))return n;const o=i.parentIds[e];r=o!==e,e=o}throw new Error("traverseHierarchySingleParent")}function yte(i){const t=i.classIds.length;for(let r=0;r<t;++r)TF(i,r,stack)}function TF(i,e,t){const r=i.parentCounts,n=i.parentIds,o=i.parentIndexes,s=i.classIds.length;if(!jh(n))return;assert(e<s,"Parent index ".concat(e," exceeds the total number of instances: ").concat(s)),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const g=jh(r)?r[e]:1,b=jh(r)?o[e]:e;for(let T=0;T<g;++T){const F=n[b+T];F!==e&&TF(i,F,t)}t.pop(e)}function Sc(i){return i!=null}const G1=(i,e)=>i,_te={HIERARCHY:!0,extensions:!0,extras:!0};class IF{constructor(e,t,r){var n;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};ye(this,"json",void 0),ye(this,"binary",void 0),ye(this,"featureCount",void 0),ye(this,"_extensions",void 0),ye(this,"_properties",void 0),ye(this,"_binaryProperties",void 0),ye(this,"_hierarchy",void 0),Ls(r>=0),this.json=e||{},this.binary=t,this.featureCount=r,this._extensions=((n=this.json)===null||n===void 0?void 0:n.extensions)||{},this._properties={};for(const l in this.json)_te[l]||(this._properties[l]=this.json[l]);this._binaryProperties=this._initializeBinaryProperties(),o["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=fte(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),Ls(typeof t=="string",t),this._hierarchy){const r=Dy(this._hierarchy,e,(n,o)=>{const l=n.classIds[o];return n.classes[l].name===t});return Sc(r)}return!1}isExactClass(e,t){return Ls(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),Ls(typeof t=="string",t),Sc(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=Sc(t)?t:[],t.length=0;const r=Object.keys(this._properties);return t.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),Ls(typeof t=="string",t),this._binaryProperties){const n=this._binaryProperties[t];if(Sc(n))return this._getBinaryProperty(n,e)}const r=this._properties[t];if(Sc(r))return G1(r[e]);if(this._hierarchy){const n=this._getHierarchyProperty(e,t);if(Sc(n))return n}}setProperty(e,t,r){const n=this.featureCount;if(this._checkBatchId(e),Ls(typeof t=="string",t),this._binaryProperties){const l=this._binaryProperties[t];if(l){this._setBinaryProperty(l,e,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,r))return;let o=this._properties[t];Sc(o)||(this._properties[t]=new Array(n),o=this._properties[t]),o[e]=G1(r)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,r){e.pack(r,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const r=this._properties[t],n=this._initializeBinaryProperty(t,r);n&&(e=e||{},e[t]=n)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const r=t;Ls(this.binary,"Property ".concat(e," requires a batch table binary.")),Ls(r.type,"Property ".concat(e," requires a type."));const n=dte(r,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const r=Dy(this._hierarchy,e,(n,o)=>{const l=n.classIds[o],s=n.classes[l].instances;return Sc(s[t])});return Sc(r)}_getPropertyNamesInHierarchy(e,t){Dy(this._hierarchy,e,(r,n)=>{const o=r.classIds[n],l=r.classes[o].instances;for(const s in l)l.hasOwnProperty(s)&&t.indexOf(s)===-1&&t.push(s)})}_getHierarchyProperty(e,t){return Dy(this._hierarchy,e,(r,n)=>{const o=r.classIds[n],l=r.classes[o],s=r.classIndexes[n],g=l.instances[t];return Sc(g)?Sc(g.typedArray)?this._getBinaryProperty(g,s):G1(g[s]):null})}_setHierarchyProperty(e,t,r,n){const o=Dy(this._hierarchy,t,(l,s)=>{const g=l.classIds[s],b=l.classes[g],T=l.classIndexes[s],F=b.instances[r];return Sc(F)?(Ls(s===t,'Inherited property "'.concat(r,'" is read-only.')),Sc(F.typedArray)?this._setBinaryProperty(F,T,n):F[T]=G1(n),!0):!1});return Sc(o)}}const ZB=4;function j1(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=new DataView(e);if(i.magic=r.getUint32(t,!0),t+=ZB,i.version=r.getUint32(t,!0),t+=ZB,i.byteLength=r.getUint32(t,!0),t+=ZB,i.version!==1)throw new Error("3D Tile Version ".concat(i.version," not supported"));return t}const yg=4,LF="b3dm tile in legacy format.";function JB(i,e,t){const r=new DataView(e);let n;i.header=i.header||{};let o=r.getUint32(t,!0);t+=yg;let l=r.getUint32(t,!0);t+=yg;let s=r.getUint32(t,!0);t+=yg;let g=r.getUint32(t,!0);return t+=yg,s>=570425344?(t-=yg*2,n=o,s=l,g=0,o=0,l=0,console.warn(LF)):g>=570425344&&(t-=yg,n=s,s=o,g=l,o=0,l=0,console.warn(LF)),i.header.featureTableJsonByteLength=o,i.header.featureTableBinaryByteLength=l,i.header.batchTableJsonByteLength=s,i.header.batchTableBinaryByteLength=g,i.header.batchLength=n,t}function YB(i,e,t,r){return t=vte(i,e,t),t=bte(i,e,t),t}function vte(i,e,t,r){const{featureTableJsonByteLength:n,featureTableBinaryByteLength:o,batchLength:l}=i.header;if(i.featureTableJson={BATCH_LENGTH:l||0},n>0){const s=CF(e,t,n);i.featureTableJson=JSON.parse(s)}return t+=n,i.featureTableBinary=new Uint8Array(e,t,o),t+=o,t}function bte(i,e,t,r){const{batchTableJsonByteLength:n,batchTableBinaryByteLength:o}=i.header;if(n>0){const l=CF(e,t,n);i.batchTableJson=JSON.parse(l),t+=n,o>0&&(i.batchTableBinary=new Uint8Array(e,t,o),i.batchTableBinary=new Uint8Array(i.batchTableBinary),t+=o)}return t}function MF(i,e,t){if(!e&&(!i||!i.batchIds||!t))return null;const{batchIds:r,isRGB565:n,pointCount:o}=i;if(r&&t){const l=new Uint8ClampedArray(o*3);for(let s=0;s<o;s++){const g=r[s],T=t.getProperty(g,"dimensions").map(F=>F*255);l[s*3]=T[0],l[s*3+1]=T[1],l[s*3+2]=T[2]}return{type:Vn.UNSIGNED_BYTE,value:l,size:3,normalized:!0}}if(n){const l=new Uint8ClampedArray(o*3);for(let s=0;s<o;s++){const g=ate(e[s]);l[s*3]=g[0],l[s*3+1]=g[1],l[s*3+2]=g[2]}return{type:Vn.UNSIGNED_BYTE,value:l,size:3,normalized:!0}}return e&&e.length===o*3?{type:Vn.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Vn.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const PF=new Ut;function xte(i,e){if(!e)return null;if(i.isOctEncoded16P){const t=new Float32Array(i.pointsLength*3);for(let r=0;r<i.pointsLength;r++)cte(e[r*2],e[r*2+1],PF),PF.toArray(t,r*3);return{type:Vn.FLOAT,size:2,value:t}}return{type:Vn.FLOAT,size:2,value:e}}function wte(i,e,t){return i.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(i.isQuantized=!1,Bte(i,e)):{type:Vn.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function Bte(i,e){const t=new Ut,r=new Float32Array(i.pointCount*3);for(let n=0;n<i.pointCount;n++)t.set(e[n*3],e[n*3+1],e[n*3+2]).scale(1/i.quantizedRange).multiply(i.quantizedVolumeScale).add(i.quantizedVolumeOffset).toArray(r,n*3);return r}async function Cte(i,e,t,r,n){t=j1(i,e,t),t=JB(i,e,t),t=YB(i,e,t),Ete(i);const{featureTable:o,batchTable:l}=Ste(i);return await Pte(i,o,l,r,n),Tte(i,o,r),Ite(i,o,l),Lte(i,o),t}function Ete(i){i.attributes={positions:null,colors:null,normals:null,batchIds:null},i.isQuantized=!1,i.isTranslucent=!1,i.isRGB565=!1,i.isOctEncoded16P=!1}function Ste(i){const e=new XB(i.featureTableJson,i.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,i.featuresLength=t,i.pointsLength=t,i.pointCount=t,i.rtcCenter=e.getGlobalProperty("RTC_CENTER",Vn.FLOAT,3);const r=Mte(i,e);return{featureTable:e,batchTable:r}}function Tte(i,e,t){if(!i.attributes.positions){if(e.hasProperty("POSITION"))i.attributes.positions=e.getPropertyArray("POSITION",Vn.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const r=e.getPropertyArray("POSITION_QUANTIZED",Vn.UNSIGNED_SHORT,3);if(i.isQuantized=!0,i.quantizedRange=65535,i.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Vn.FLOAT,3),!i.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(i.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Vn.FLOAT,3),!i.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");i.attributes.positions=wte(i,r,t)}}if(!i.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Ite(i,e,t){if(!i.attributes.colors){let r=null;e.hasProperty("RGBA")?(r=e.getPropertyArray("RGBA",Vn.UNSIGNED_BYTE,4),i.isTranslucent=!0):e.hasProperty("RGB")?r=e.getPropertyArray("RGB",Vn.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(r=e.getPropertyArray("RGB565",Vn.UNSIGNED_SHORT,1),i.isRGB565=!0),i.attributes.colors=MF(i,r,t)}e.hasProperty("CONSTANT_RGBA")&&(i.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Vn.UNSIGNED_BYTE,4))}function Lte(i,e){if(!i.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",Vn.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",Vn.UNSIGNED_BYTE,2),i.isOctEncoded16P=!0),i.attributes.normals=xte(i,t)}}function Mte(i,e){let t=null;if(!i.batchIds&&e.hasProperty("BATCH_ID")&&(i.batchIds=e.getPropertyArray("BATCH_ID",Vn.UNSIGNED_SHORT,1),i.batchIds)){const r=e.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:n,batchTableBinary:o}=i;t=new IF(n,o,r)}return t}async function Pte(i,e,t,r,n){let o,l,s;const g=i.batchTableJson&&i.batchTableJson.extensions&&i.batchTableJson.extensions["3DTILES_draco_point_compression"];g&&(s=g.properties);const b=e.getExtension("3DTILES_draco_point_compression");if(b){l=b.properties;const F=b.byteOffset,k=b.byteLength;if(!l||!Number.isFinite(F)||!k)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=i.featureTableBinary.slice(F,F+k),i.hasPositions=Number.isFinite(l.POSITION),i.hasColors=Number.isFinite(l.RGB)||Number.isFinite(l.RGBA),i.hasNormals=Number.isFinite(l.NORMAL),i.hasBatchIds=Number.isFinite(l.BATCH_ID),i.isTranslucent=Number.isFinite(l.RGBA)}if(!o)return!0;const T={buffer:o,properties:{...l,...s},featureTableProperties:l,batchTableProperties:s,dequantizeInShader:!1};return await Fte(i,T,r,n)}async function Fte(i,e,t,r){const{parse:n}=r,o={...t,draco:{...t.draco,extraAttributes:e.batchTableProperties||{}}};delete o["3d-tiles"];const l=await n(e.buffer,HP,o),s=l.attributes.POSITION&&l.attributes.POSITION.value,g=l.attributes.COLOR_0&&l.attributes.COLOR_0.value,b=l.attributes.NORMAL&&l.attributes.NORMAL.value,T=l.attributes.BATCH_ID&&l.attributes.BATCH_ID.value,F=s&&l.attributes.POSITION.value.quantization,k=b&&l.attributes.NORMAL.value.quantization;if(F){const J=l.POSITION.data.quantization,te=J.range;i.quantizedVolumeScale=new Ut(te,te,te),i.quantizedVolumeOffset=new Ut(J.minValues),i.quantizedRange=(1<<J.quantizationBits)-1,i.isQuantizedDraco=!0}k&&(i.octEncodedRange=(1<<l.NORMAL.data.quantization.quantizationBits)-1,i.isOctEncodedDraco=!0);const z={};if(e.batchTableProperties)for(const J of Object.keys(e.batchTableProperties))l.attributes[J]&&l.attributes[J].value&&(z[J.toLowerCase()]=l.attributes[J].value);i.attributes={positions:s,colors:MF(i,g,void 0),normals:b,batchIds:T,...z}}const eC={URI:0,EMBEDDED:1};function FF(i,e,t,r){i.rotateYtoZ=!0;const n=i.byteOffset+i.byteLength-t;if(n===0)throw new Error("glTF byte length must be greater than 0.");return i.gltfUpAxis=r["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",i.gltfArrayBuffer=yw(e,t,n),i.gltfByteOffset=0,i.gltfByteLength=n,t%4===0||console.warn("".concat(i.type,": embedded glb is not aligned to a 4-byte boundary.")),i.byteOffset+i.byteLength}async function DF(i,e,t,r){const n=t["3d-tiles"]||{};if(Dte(i,e),n.loadGLTF){const{parse:o,fetch:l}=r;i.gltfUrl&&(i.gltfArrayBuffer=await l(i.gltfUrl,t),i.gltfByteOffset=0),i.gltfArrayBuffer&&(i.gltf=await o(i.gltfArrayBuffer,My,t,r),i.gpuMemoryUsageInBytes=NP(i.gltf),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength)}}function Dte(i,e,t){switch(e){case eC.URI:const r=new Uint8Array(i.gltfArrayBuffer,i.gltfByteOffset),o=new TextDecoder().decode(r);i.gltfUrl=o.replace(/[\s\0]+$/,""),delete i.gltfArrayBuffer,delete i.gltfByteOffset,delete i.gltfByteLength;break;case eC.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function Rte(i,e,t,r,n){var o;t=kte(i,e,t,r),await DF(i,eC.EMBEDDED,r,n);const l=i==null||(o=i.gltf)===null||o===void 0?void 0:o.extensions;return l&&l.CESIUM_RTC&&(i.rtcCenter=l.CESIUM_RTC.center),t}function kte(i,e,t,r,n){t=j1(i,e,t),t=JB(i,e,t),t=YB(i,e,t),t=FF(i,e,t,r);const o=new XB(i.featureTableJson,i.featureTableBinary);return i.rtcCenter=o.getGlobalProperty("RTC_CENTER",Vn.FLOAT,3),t}async function Ote(i,e,t,r,n){return t=Ute(i,e,t,r),await DF(i,i.gltfFormat,r,n),t}function Ute(i,e,t,r,n){if(t=j1(i,e,t),i.version!==1)throw new Error("Instanced 3D Model version ".concat(i.version," is not supported"));t=JB(i,e,t);const o=new DataView(e);if(i.gltfFormat=o.getUint32(t,!0),t+=4,t=YB(i,e,t),t=FF(i,e,t,r),i.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const l=new XB(i.featureTableJson,i.featureTableBinary),s=l.getGlobalProperty("INSTANCES_LENGTH");if(l.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");i.eastNorthUp=l.getGlobalProperty("EAST_NORTH_UP"),i.rtcCenter=l.getGlobalProperty("RTC_CENTER",Vn.FLOAT,3);const g=new IF(i.batchTableJson,i.batchTableBinary,s);return Nte(i,l,g,s),t}function Nte(i,e,t,r){const o={instances:new Array(r),batchTable:i._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,l=new Ut;new Ut,new Ut,new Ut;const s=new xo,g=new hy,b=new Ut,T={},F=new Bn,k=[],z=[],J=new Ut,te=new Ut;for(let ue=0;ue<r;ue++){let ce;if(e.hasProperty("POSITION"))ce=e.getProperty("POSITION",Vn.FLOAT,3,ue,l);else if(e.hasProperty("POSITION_QUANTIZED")){ce=e.getProperty("POSITION_QUANTIZED",Vn.UNSIGNED_SHORT,3,ue,l);const qe=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Vn.FLOAT,3,J);if(!qe)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Ue=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Vn.FLOAT,3,te);if(!Ue)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const ot=65535;for(let it=0;it<3;it++)ce[it]=ce[it]/ot*Ue[it]+qe[it]}if(!ce)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(l.copy(ce),T.translation=l,i.normalUp=e.getProperty("NORMAL_UP",Vn.FLOAT,3,ue,k),i.normalRight=e.getProperty("NORMAL_RIGHT",Vn.FLOAT,3,ue,z),i.normalUp){if(!i.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");i.hasCustomOrientation=!0}else{if(i.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Vn.UNSIGNED_SHORT,2,k),i.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Vn.UNSIGNED_SHORT,2,z),i.octNormalUp)throw i.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");i.eastNorthUp?(co.WGS84.eastNorthUpToFixedFrame(l,F),F.getRotationMatrix3(s)):s.identity()}g.fromMatrix3(s),T.rotation=g,b.set(1,1,1);const de=e.getProperty("SCALE",Vn.FLOAT,1,ue);Number.isFinite(de)&&b.multiplyByScalar(de);const _e=e.getProperty("SCALE_NON_UNIFORM",Vn.FLOAT,3,ue,k);_e&&b.scale(_e),T.scale=b;let Ee=e.getProperty("BATCH_ID",Vn.UNSIGNED_SHORT,1,ue);Ee===void 0&&(Ee=ue);const He=new Bn().fromQuaternion(T.rotation);F.identity(),F.translate(T.translation),F.multiplyRight(He),F.scale(T.scale);const Ve=F.clone();o[ue]={modelMatrix:Ve,batchId:Ee}}i.instances=o}async function zte(i,e,t,r,n,o){t=j1(i,e,t);const l=new DataView(e);for(i.tilesLength=l.getUint32(t,!0),t+=4,i.tiles=[];i.tiles.length<i.tilesLength&&i.byteLength-t>12;){const s={};i.tiles.push(s),t=await o(e,t,r,n,s)}return t}async function Qte(i,e,t,r){i.rotateYtoZ=!0,i.gltfUpAxis=t["3d-tiles"]&&t["3d-tiles"].assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y";const{parse:n}=r;i.gltf=await n(e,My,t,r),i.gpuMemoryUsageInBytes=NP(i.gltf)}async function RF(i){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(n.byteOffset=e,n.type=rte(i,e),n.type){case Fy.COMPOSITE:return await zte(n,i,e,t,r,RF);case Fy.BATCHED_3D_MODEL:return await Rte(n,i,e,t,r);case Fy.GLTF:return await Qte(n,i,t,r);case Fy.INSTANCED_3D_MODEL:return await Ote(n,i,e,t,r);case Fy.POINT_CLOUD:return await Cte(n,i,e,t,r);default:throw new Error("3DTileLoader: unknown type ".concat(n.type))}}const Vte=1952609651,Hte=1;async function Gte(i,e,t){if(new Uint32Array(i.slice(0,4))[0]!==Vte)throw new Error("Wrong subtree file magic number");if(new Uint32Array(i.slice(4,8))[0]!==Hte)throw new Error("Wrong subtree file verson, must be 1");const o=kF(i.slice(8,16)),l=new Uint8Array(i,24,o),g=new TextDecoder("utf8").decode(l),b=JSON.parse(g),T=kF(i.slice(16,24));let F=new ArrayBuffer(0);return T&&(F=i.slice(24+o)),"bufferView"in b.tileAvailability&&(b.tileAvailability.explicitBitstream=await tC(b,"tileAvailability",F,t)),"bufferView"in b.contentAvailability&&(b.contentAvailability.explicitBitstream=await tC(b,"contentAvailability",F,t)),"bufferView"in b.childSubtreeAvailability&&(b.childSubtreeAvailability.explicitBitstream=await tC(b,"childSubtreeAvailability",F,t)),b}function jte(i,e){if(e.startsWith("http")){const o=new URL(i,e);return decodeURI(o.toString())}const r="http://".concat(e),n=new URL(i,r);return"/".concat(n.host).concat(n.pathname)}async function tC(i,e,t,r){const n=i[e].bufferView,o=i.bufferViews[n],l=i.buffers[o.buffer];if(!(r!=null&&r.url)||!r.fetch)throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(l.uri){const s=jte(l.uri,r==null?void 0:r.url),b=await(await r.fetch(s)).arrayBuffer();return new Uint8Array(b,o.byteOffset,o.byteLength)}return new Uint8Array(t,o.byteOffset,o.byteLength)}function kF(i){const e=new DataView(i),t=e.getUint32(0,!0),r=e.getUint32(4,!0);return t+2**32*r}const OF={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:BF,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:Gte,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Tu=null;try{Tu=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ps(i,e,t){this.low=i|0,this.high=e|0,this.unsigned=!!t}ps.prototype.__isLong__,Object.defineProperty(ps.prototype,"__isLong__",{value:!0});function Il(i){return(i&&i.__isLong__)===!0}function UF(i){var e=Math.clz32(i&-i);return i?31-e:e}ps.isLong=Il;var NF={},zF={};function Ef(i,e){var t,r,n;return e?(i>>>=0,(n=0<=i&&i<256)&&(r=zF[i],r)?r:(t=Zn(i,0,!0),n&&(zF[i]=t),t)):(i|=0,(n=-128<=i&&i<128)&&(r=NF[i],r)?r:(t=Zn(i,i<0?-1:0,!1),n&&(NF[i]=t),t))}ps.fromInt=Ef;function Iu(i,e){if(isNaN(i))return e?LA:oh;if(e){if(i<0)return LA;if(i>=VF)return $F}else{if(i<=-HF)return Tc;if(i+1>=HF)return qF}return i<0?Iu(-i,e).neg():Zn(i%_g|0,i/_g|0,e)}ps.fromNumber=Iu;function Zn(i,e,t){return new ps(i,e,t)}ps.fromBits=Zn;var q1=Math.pow;function iC(i,e,t){if(i.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,i==="NaN"||i==="Infinity"||i==="+Infinity"||i==="-Infinity")return e?LA:oh;if(t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=i.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return iC(i.substring(1),e,t).neg();for(var n=Iu(q1(t,8)),o=oh,l=0;l<i.length;l+=8){var s=Math.min(8,i.length-l),g=parseInt(i.substring(l,l+s),t);if(s<8){var b=Iu(q1(t,s));o=o.mul(b).add(Iu(g))}else o=o.mul(n),o=o.add(Iu(g))}return o.unsigned=e,o}ps.fromString=iC;function sh(i,e){return typeof i=="number"?Iu(i,e):typeof i=="string"?iC(i,e):Zn(i.low,i.high,typeof e=="boolean"?e:i.unsigned)}ps.fromValue=sh;var QF=65536,qte=1<<24,_g=QF*QF,VF=_g*_g,HF=VF/2,GF=Ef(qte),oh=Ef(0);ps.ZERO=oh;var LA=Ef(0,!0);ps.UZERO=LA;var vg=Ef(1);ps.ONE=vg;var jF=Ef(1,!0);ps.UONE=jF;var rC=Ef(-1);ps.NEG_ONE=rC;var qF=Zn(-1,2147483647,!1);ps.MAX_VALUE=qF;var $F=Zn(-1,-1,!0);ps.MAX_UNSIGNED_VALUE=$F;var Tc=Zn(0,-2147483648,!1);ps.MIN_VALUE=Tc;var Di=ps.prototype;Di.toInt=function(){return this.unsigned?this.low>>>0:this.low},Di.toNumber=function(){return this.unsigned?(this.high>>>0)*_g+(this.low>>>0):this.high*_g+(this.low>>>0)},Di.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Tc)){var t=Iu(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Iu(q1(e,6),this.unsigned),l=this,s="";;){var g=l.div(o),b=l.sub(g.mul(o)).toInt()>>>0,T=b.toString(e);if(l=g,l.isZero())return T+s;for(;T.length<6;)T="0"+T;s=""+T+s}},Di.getHighBits=function(){return this.high},Di.getHighBitsUnsigned=function(){return this.high>>>0},Di.getLowBits=function(){return this.low},Di.getLowBitsUnsigned=function(){return this.low>>>0},Di.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Tc)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1},Di.isZero=function(){return this.high===0&&this.low===0},Di.eqz=Di.isZero,Di.isNegative=function(){return!this.unsigned&&this.high<0},Di.isPositive=function(){return this.unsigned||this.high>=0},Di.isOdd=function(){return(this.low&1)===1},Di.isEven=function(){return(this.low&1)===0},Di.equals=function(e){return Il(e)||(e=sh(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},Di.eq=Di.equals,Di.notEquals=function(e){return!this.eq(e)},Di.neq=Di.notEquals,Di.ne=Di.notEquals,Di.lessThan=function(e){return this.comp(e)<0},Di.lt=Di.lessThan,Di.lessThanOrEqual=function(e){return this.comp(e)<=0},Di.lte=Di.lessThanOrEqual,Di.le=Di.lessThanOrEqual,Di.greaterThan=function(e){return this.comp(e)>0},Di.gt=Di.greaterThan,Di.greaterThanOrEqual=function(e){return this.comp(e)>=0},Di.gte=Di.greaterThanOrEqual,Di.ge=Di.greaterThanOrEqual,Di.compare=function(e){if(Il(e)||(e=sh(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},Di.comp=Di.compare,Di.negate=function(){return!this.unsigned&&this.eq(Tc)?Tc:this.not().add(vg)},Di.neg=Di.negate,Di.add=function(e){Il(e)||(e=sh(e));var t=this.high>>>16,r=this.high&65535,n=this.low>>>16,o=this.low&65535,l=e.high>>>16,s=e.high&65535,g=e.low>>>16,b=e.low&65535,T=0,F=0,k=0,z=0;return z+=o+b,k+=z>>>16,z&=65535,k+=n+g,F+=k>>>16,k&=65535,F+=r+s,T+=F>>>16,F&=65535,T+=t+l,T&=65535,Zn(k<<16|z,T<<16|F,this.unsigned)},Di.subtract=function(e){return Il(e)||(e=sh(e)),this.add(e.neg())},Di.sub=Di.subtract,Di.multiply=function(e){if(this.isZero())return this;if(Il(e)||(e=sh(e)),Tu){var t=Tu.mul(this.low,this.high,e.low,e.high);return Zn(t,Tu.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?LA:oh;if(this.eq(Tc))return e.isOdd()?Tc:oh;if(e.eq(Tc))return this.isOdd()?Tc:oh;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(GF)&&e.lt(GF))return Iu(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,n=this.high&65535,o=this.low>>>16,l=this.low&65535,s=e.high>>>16,g=e.high&65535,b=e.low>>>16,T=e.low&65535,F=0,k=0,z=0,J=0;return J+=l*T,z+=J>>>16,J&=65535,z+=o*T,k+=z>>>16,z&=65535,z+=l*b,k+=z>>>16,z&=65535,k+=n*T,F+=k>>>16,k&=65535,k+=o*b,F+=k>>>16,k&=65535,k+=l*g,F+=k>>>16,k&=65535,F+=r*T+n*b+o*g+l*s,F&=65535,Zn(z<<16|J,F<<16|k,this.unsigned)},Di.mul=Di.multiply,Di.divide=function(e){if(Il(e)||(e=sh(e)),e.isZero())throw Error("division by zero");if(Tu){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Tu.div_u:Tu.div_s)(this.low,this.high,e.low,e.high);return Zn(t,Tu.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?LA:oh;var r,n,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return LA;if(e.gt(this.shru(1)))return jF;o=LA}else{if(this.eq(Tc)){if(e.eq(vg)||e.eq(rC))return Tc;if(e.eq(Tc))return vg;var l=this.shr(1);return r=l.div(e).shl(1),r.eq(oh)?e.isNegative()?vg:rC:(n=this.sub(e.mul(r)),o=r.add(n.div(e)),o)}else if(e.eq(Tc))return this.unsigned?LA:oh;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=oh}for(n=this;n.gte(e);){r=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),g=s<=48?1:q1(2,s-48),b=Iu(r),T=b.mul(e);T.isNegative()||T.gt(n);)r-=g,b=Iu(r,this.unsigned),T=b.mul(e);b.isZero()&&(b=vg),o=o.add(b),n=n.sub(T)}return o},Di.div=Di.divide,Di.modulo=function(e){if(Il(e)||(e=sh(e)),Tu){var t=(this.unsigned?Tu.rem_u:Tu.rem_s)(this.low,this.high,e.low,e.high);return Zn(t,Tu.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},Di.mod=Di.modulo,Di.rem=Di.modulo,Di.not=function(){return Zn(~this.low,~this.high,this.unsigned)},Di.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},Di.clz=Di.countLeadingZeros,Di.countTrailingZeros=function(){return this.low?UF(this.low):UF(this.high)+32},Di.ctz=Di.countTrailingZeros,Di.and=function(e){return Il(e)||(e=sh(e)),Zn(this.low&e.low,this.high&e.high,this.unsigned)},Di.or=function(e){return Il(e)||(e=sh(e)),Zn(this.low|e.low,this.high|e.high,this.unsigned)},Di.xor=function(e){return Il(e)||(e=sh(e)),Zn(this.low^e.low,this.high^e.high,this.unsigned)},Di.shiftLeft=function(e){return Il(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Zn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Zn(0,this.low<<e-32,this.unsigned)},Di.shl=Di.shiftLeft,Di.shiftRight=function(e){return Il(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Zn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Zn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},Di.shr=Di.shiftRight,Di.shiftRightUnsigned=function(e){return Il(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Zn(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Zn(this.high,0,this.unsigned):Zn(this.high>>>e-32,0,this.unsigned)},Di.shru=Di.shiftRightUnsigned,Di.shr_u=Di.shiftRightUnsigned,Di.rotateLeft=function(e){var t;return Il(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Zn(this.high,this.low,this.unsigned):e<32?(t=32-e,Zn(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Zn(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},Di.rotl=Di.rotateLeft,Di.rotateRight=function(e){var t;return Il(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Zn(this.high,this.low,this.unsigned):e<32?(t=32-e,Zn(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Zn(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},Di.rotr=Di.rotateRight,Di.toSigned=function(){return this.unsigned?Zn(this.low,this.high,!1):this},Di.toUnsigned=function(){return this.unsigned?this:Zn(this.low,this.high,!0)},Di.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},Di.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},Di.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},ps.fromBytes=function(e,t,r){return r?ps.fromBytesLE(e,t):ps.fromBytesBE(e,t)},ps.fromBytesLE=function(e,t){return new ps(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},ps.fromBytesBE=function(e,t){return new ps(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const $te=16;function KF(i){i==="X"&&(i="");const e=i.padEnd($te,"0");return ps.fromString(e,!0,16)}function Kte(i){if(i.isZero())return"X";let e=i.countTrailingZeros();const t=e%4;e=(e-t)/4;const r=e;e*=4;const o=i.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-r-o.length).join("0")+o}function Wte(i,e){const t=Xte(i).shiftRightUnsigned(2);return i.add(ps.fromNumber(2*e+1-4).multiply(t))}function Xte(i){return i.and(i.not().add(1))}const Zte=3,Jte=2*30+1,WF=180/Math.PI;function Yte(i){if(i.length===0)throw new Error("Invalid Hilbert quad key ".concat(i));const e=i.split("/"),t=parseInt(e[0],10),r=e[1],n=r.length;let o=0;const l=[0,0];for(let s=n-1;s>=0;s--){o=n-s;const g=r[s];let b=0,T=0;g==="1"?T=1:g==="2"?(b=1,T=1):g==="3"&&(b=1);const F=Math.pow(2,o-1);tie(F,l,b,T),l[0]+=F*b,l[1]+=F*T}if(t%2===1){const s=l[0];l[0]=l[1],l[1]=s}return{face:t,ij:l,level:o}}function eie(i){if(i.isZero())return"";let e=i.toString(2);for(;e.length<Zte+Jte;)e="0"+e;const t=e.lastIndexOf("1"),r=e.substring(0,3),n=e.substring(3,t),o=n.length/2,l=ps.fromString(r,!0,2).toString(10);let s="";if(o!==0)for(s=ps.fromString(n,!0,2).toString(4);s.length<o;)s="0"+s;return"".concat(l,"/").concat(s)}function XF(i,e,t){const r=1<<e;return[(i[0]+t[0])/r,(i[1]+t[1])/r]}function ZF(i){return i>=.5?1/3*(4*i*i-1):1/3*(1-4*(1-i)*(1-i))}function JF(i){return[ZF(i[0]),ZF(i[1])]}function YF(i,e){let[t,r]=e;switch(i){case 0:return[1,t,r];case 1:return[-t,1,r];case 2:return[-t,-r,1];case 3:return[-1,-r,-t];case 4:return[r,-1,-t];case 5:return[r,t,-1];default:throw new Error("Invalid face")}}function e4(i){let[e,t,r]=i;const n=Math.atan2(r,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*WF,n*WF]}function tie(i,e,t,r){if(r===0){t===1&&(e[0]=i-1-e[0],e[1]=i-1-e[1]);const n=e[0];e[0]=e[1],e[1]=n}}function iie(i){const e=XF(i.ij,i.level,[.5,.5]),t=JF(e),r=YF(i.face,t);return e4(r)}const rie=100;function t4(i){const{face:e,ij:t,level:r}=i,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],o=Math.max(1,Math.ceil(rie*Math.pow(2,-r))),l=new Float64Array(4*o*2+2);let s=0,g=0;for(let b=0;b<4;b++){const T=n[b].slice(0),F=n[b+1],k=(F[0]-T[0])/o,z=(F[1]-T[1])/o;for(let J=0;J<o;J++){T[0]+=k,T[1]+=z;const te=XF(t,r,T),ue=JF(te),ce=YF(e,ue),de=e4(ce);Math.abs(de[1])>89.999&&(de[0]=g);const _e=de[0]-g;de[0]+=_e>180?-360:_e<-180?360:0,l[s++]=de[0],l[s++]=de[1],g=de[0]}}return l[s++]=l[0],l[s++]=l[1],l}function nC(i){const e=nie(i);return Yte(e)}function nie(i){if(i.indexOf("/")>0)return i;const e=KF(i);return eie(e)}function sie(i){const e=nC(i);return iie(e)}function oie(i){let e;if(i.face===2||i.face===5){let t=null,r=0;for(let n=0;n<4;n++){const o="".concat(i.face,"/").concat(n),l=nC(o),s=t4(l);(typeof t>"u"||t===null)&&(t=new Float64Array(4*s.length)),t.set(s,r),r+=s.length}e=i4(t)}else{const t=t4(i);e=i4(t)}return e}function i4(i){if(i.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let r=0;r<i.length;r+=2)e.push(i[r]),t.push(i[r+1]);return e.sort((r,n)=>r-n),t.sort((r,n)=>r-n),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function aie(i,e){const t=(e==null?void 0:e.minimumHeight)||0,r=(e==null?void 0:e.maximumHeight)||0,n=nC(i),o=oie(n),l=o.west,s=o.south,g=o.east,b=o.north,T=[];return T.push(new Ut(l,b,t)),T.push(new Ut(g,b,t)),T.push(new Ut(g,s,t)),T.push(new Ut(l,s,t)),T.push(new Ut(l,b,r)),T.push(new Ut(g,b,r)),T.push(new Ut(g,s,r)),T.push(new Ut(l,s,r)),T}function r4(i){const e=i.token,t={minimumHeight:i.minimumHeight,maximumHeight:i.maximumHeight},r=aie(e,t),n=sie(e),o=n[0],l=n[1],s=co.WGS84.cartographicToCartesian([o,l,t.maximumHeight]),g=new Ut(s[0],s[1],s[2]);r.push(g);const b=zX(r);return[...b.center,...b.halfAxes]}const lie={QUADTREE:4,OCTREE:8};function cie(i,e,t){if(i!=null&&i.box){const r=KF(i.s2VolumeInfo.token),n=Wte(r,e),o=Kte(n),l={...i.s2VolumeInfo};switch(l.token=o,t){case"OCTREE":const b=i.s2VolumeInfo,T=b.maximumHeight-b.minimumHeight,F=T/2,k=b.minimumHeight+T/2;b.minimumHeight=k-F,b.maximumHeight=k+F;break}return{box:r4(l),s2VolumeInfo:l}}}async function n4(i){const{options:e,parentData:t={mortonIndex:0,x:0,y:0,z:0},childIndex:r=0,globalData:n={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:o}=i;let{subtree:l,level:s=0}=i;const{subdivisionScheme:g,subtreeLevels:b,maximumLevel:T,contentUrlTemplate:F,subtreesUriTemplate:k,basePath:z}=e,J={children:[],lodMetricValue:0,contentUrl:""},te=lie[g],ue=r&1,ce=r>>1&1,de=r>>2&1,_e=(te**s-1)/(te-1);let Ee=Sf(t.mortonIndex,r),He=_e+Ee,Ve=Sf(t.x,ue),qe=Sf(t.y,ce),Ue=Sf(t.z,de),ot=!1;s+1>b&&(ot=sC(l.childSubtreeAvailability,Ee));const it=Sf(n.x,Ve),De=Sf(n.y,qe),Me=Sf(n.z,Ue),Ze=s+n.level;if(ot){const _t="".concat(z,"/").concat(k),Ft=oC(_t,Ze,it,De,Me);l=await id(Ft,OF),n.mortonIndex=Ee,n.x=Ve,n.y=qe,n.z=Ue,n.level=s,Ee=0,He=0,Ve=0,qe=0,Ue=0,s=0}if(!sC(l.tileAvailability,He)||s>T)return J;sC(l.contentAvailability,He)&&(J.contentUrl=oC(F,Ze,it,De,Me));const Ct=s+1,Lt={mortonIndex:Ee,x:Ve,y:qe,z:Ue};for(let _t=0;_t<te;_t++){const Ft=cie(o,_t,g),Mt=await n4({subtree:l,options:e,parentData:Lt,childIndex:_t,level:Ct,globalData:n,s2VolumeBox:Ft});if(Mt.contentUrl||Mt.children.length){const Wt=Ze+1,Xe=uie(Mt,Wt,{childTileX:Ve,childTileY:qe,childTileZ:Ue},e,o);J.children.push(Xe)}}return J}function sC(i,e){return"constant"in i?!!i.constant:i.explicitBitstream?die(e,i.explicitBitstream):!1}function uie(i,e,t,r,n){const{basePath:o,refine:l,getRefine:s,lodMetricType:g,getTileType:b,rootLodMetricValue:T,rootBoundingVolume:F}=r,k=i.contentUrl&&i.contentUrl.replace("".concat(o,"/"),""),z=T/2**e,J=n!=null&&n.box?{box:n.box}:F,te=hie(e,J,t);return{children:i.children,contentUrl:i.contentUrl,content:{uri:k},id:i.contentUrl,refine:s(l),type:b(i),lodMetricType:g,lodMetricValue:z,geometricError:z,transform:i.transform,boundingVolume:te}}function hie(i,e,t){if(e.region){const{childTileX:r,childTileY:n,childTileZ:o}=t,[l,s,g,b,T,F]=e.region,k=2**i,z=(g-l)/k,J=(b-s)/k,te=(F-T)/k,[ue,ce]=[l+z*r,l+z*(r+1)],[de,_e]=[s+J*n,s+J*(n+1)],[Ee,He]=[T+te*o,T+te*(o+1)];return{region:[ue,de,ce,_e,Ee,He]}}if(e.box)return e;throw new Error("Unsupported bounding volume type ".concat(e))}function Sf(i,e){return parseInt(i.toString(2)+e.toString(2),2)}function oC(i,e,t,r,n){const o=Aie({level:e,x:t,y:r,z:n});return i.replace(/{level}|{x}|{y}|{z}/gi,l=>o[l])}function Aie(i){const e={};for(const t in i)e["{".concat(t,"}")]=i[t];return e}function die(i,e){const t=Math.floor(i/8),r=i%8;return(e[t]>>r&1)===1}function aC(i){if(!i.contentUrl)return mg.EMPTY;const t=i.contentUrl.split("?")[0].split(".").pop();switch(t){case"pnts":return mg.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return mg.SCENEGRAPH;default:return t}}function lC(i){switch(i){case"REPLACE":case"replace":return IA.REPLACE;case"ADD":case"add":return IA.ADD;default:return i}}function cC(i,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const r=new URL(i,"".concat(e,"/"));return decodeURI(r.toString())}else if(i.startsWith("/"))return i;return"".concat(e,"/").concat(i)}function s4(i,e){if(!i)return null;if(i.content){const t=i.content.uri||i.content.url;i.contentUrl=cC(t,e.basePath)}return i.id=i.contentUrl,i.lodMetricType=z1.GEOMETRIC_ERROR,i.lodMetricValue=i.geometricError,i.transformMatrix=i.transform,i.type=aC(i),i.refine=lC(i.refine),i}async function fie(i,e){const t=i.basePath;let r;const n=a4(i==null?void 0:i.root);n&&i.root?r=await o4(i.root,i,n,e):r=s4(i.root,i);const o=[];for(o.push(r);o.length>0;){const s=(o.pop()||{}).children||[];for(let g of s){const b=a4(g);b?g=await o4(g,i,b,e):s4(g,{basePath:t}),o.push(g)}}return r}async function o4(i,e,t,r){var n,o;const l=e.basePath,{subdivisionScheme:s,maximumLevel:g,subtreeLevels:b,subtrees:{uri:T}}=t,F=oC(T,0,0,0,0),k=cC(F,l),z=await id(k,OF,r),J=cC(i.content.uri,l),te=e==null||(n=e.root)===null||n===void 0?void 0:n.refine,ue=i.geometricError,ce=(o=i.boundingVolume.extensions)===null||o===void 0?void 0:o["3DTILES_bounding_volume_S2"];if(ce){const He={box:r4(ce),s2VolumeInfo:ce};i.boundingVolume=He}const de=i.boundingVolume,_e={contentUrlTemplate:J,subtreesUriTemplate:T,subdivisionScheme:s,subtreeLevels:b,maximumLevel:g,refine:te,basePath:l,lodMetricType:z1.GEOMETRIC_ERROR,rootLodMetricValue:ue,rootBoundingVolume:de,getTileType:aC,getRefine:lC};return await pie(i,z,_e)}async function pie(i,e,t){if(!i)return null;i.lodMetricType=z1.GEOMETRIC_ERROR,i.lodMetricValue=i.geometricError,i.transformMatrix=i.transform;const{children:r,contentUrl:n}=await n4({subtree:e,options:t,s2VolumeBox:i});return n&&(i.contentUrl=n,i.content={uri:n.replace("".concat(t.basePath,"/"),"")}),i.refine=lC(i.refine),i.type=aC(i),i.children=r,i.id=i.contentUrl,i}function a4(i){var e;return(i==null||(e=i.extensions)===null||e===void 0?void 0:e["3DTILES_implicit_tiling"])||(i==null?void 0:i.implicitTiling)}const uC={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:BF,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:_ie,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function gie(i){return _w(i.url)}async function mie(i,e,t){const r={content:{featureIds:null}};return await RF(i,0,e,t,r.content),r.content}async function yie(i,e,t){var r;const n=JSON.parse(new TextDecoder().decode(i));return n.loader=e.loader||uC,n.url=t.url,n.queryString=t.queryString,n.basePath=gie(n),n.root=await fie(n,e),n.type=Su.TILES3D,n.lodMetricType=z1.GEOMETRIC_ERROR,n.lodMetricValue=((r=n.root)===null||r===void 0?void 0:r.lodMetricValue)||0,n}async function _ie(i,e,t){const r=e["3d-tiles"]||{};let n;return r.isTileset==="auto"?n=t.url&&t.url.indexOf(".json")!==-1:n=r.isTileset,n?i=await yie(i,e,t):i=await mie(i,e,t),i}const l4=[0],vie={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:uC,onTilesetLoad:{type:"function",value:i=>{}},onTileLoad:{type:"function",value:i=>{}},onTileUnload:{type:"function",value:i=>{}},onTileError:{type:"function",value:(i,e,t)=>{}},_getMeshColor:{type:"function",value:i=>[255,255,255]}};class hC extends qM{constructor(){super(...arguments),ye(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&Dn.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return!!(!((e=this.state)===null||e===void 0||(t=e.tileset3d)===null||t===void 0)&&t.isLoaded()&&super.isLoaded)}shouldUpdateState(e){let{changeFlags:t}=e;return t.somethingChanged}updateState(e){let{props:t,oldProps:r,changeFlags:n}=e;if(t.data&&t.data!==r.data&&this._loadTileset(t.data),n.viewportChanged){const{activeViewports:o}=this.state;Object.keys(o).length&&(this._updateTileset(o),this.state.lastUpdatedViewports=o,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:o}=this.state;for(const l in o)o[l].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:r}=this.state;this.internalState.viewport=e,t[e.id]=e;const n=r==null?void 0:r[e.id];(!n||!e.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(e){let{info:t,sourceLayer:r}=e;const n=r&&r.props.tile;return t.picked&&(t.object=n),t.sourceTile=n,t}filterSubLayer(e){let{layer:t,viewport:r}=e;const{tile:n}=t.props,{id:o}=r;return n.selected&&n.viewportIds.includes(o)}_updateAutoHighlight(e){const t=e.sourceTile,r=this.state.layerMap[t==null?void 0:t.id];r&&r.layer&&r.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props;let r=this.props.loader||this.props.loaders;Array.isArray(r)&&(r=r[0]);const n={loadOptions:{...t}};let o=e;if(r.preload){const g=await r.preload(e,t);g.url&&(o=g.url),g.headers&&(n.loadOptions.fetch={...n.loadOptions.fetch,headers:g.headers}),Object.assign(n,g)}const l=await id(o,r,n.loadOptions),s=new ite(l,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...n});this.setState({tileset3d:s,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(s)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:r}=this.context,n=Object.keys(e).length;!r||!n||!t||t.selectTiles(Object.values(e)).then(o=>{this.state.frameNumber!==o&&this.setState({frameNumber:o})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case mg.POINTCLOUD:return this._makePointCloudLayer(e,t);case mg.SCENEGRAPH:return this._make3DModelLayer(e);case mg.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,t){const{attributes:r,pointCount:n,constantRGBA:o,cartographicOrigin:l,modelMatrix:s}=e.content,{positions:g,normals:b,colors:T}=r;if(!g)return null;const F=t&&t.props.data||{header:{vertexCount:n},attributes:{POSITION:g,NORMAL:b,COLOR_0:T}},{pointSize:k,getPointColor:z}=this.props,J=this.getSubLayerClass("pointcloud",pB);return new J({pointSize:k},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:F,coordinateSystem:Ln.METER_OFFSETS,coordinateOrigin:l,modelMatrix:s,getColor:o||z,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:r,cartographicOrigin:n,modelMatrix:o}=e.content,l=this.getSubLayerClass("scenegraph",DB);return new l({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:r||l4,scenegraph:t,coordinateSystem:Ln.METER_OFFSETS,coordinateOrigin:n,modelMatrix:o,getTransformMatrix:s=>s.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const r=e.content,{attributes:n,indices:o,modelMatrix:l,cartographicOrigin:s,coordinateSystem:g=Ln.METER_OFFSETS,material:b,featureIds:T}=r,{_getMeshColor:F}=this.props,k=t&&t.props.mesh||new fy({drawMode:4,attributes:bie(n),indices:o}),z=this.getSubLayerClass("mesh",RB);return new z(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:k,data:l4,getColor:F(e),pbrMaterial:b,modelMatrix:l,coordinateOrigin:s,coordinateSystem:g,featureIds:T,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(r=>{const n=t[r.id]=t[r.id]||{tile:r};let{layer:o}=n;return r.selected&&(o?n.needsUpdate&&(o=this._getSubLayer(r,o),n.needsUpdate=!1):o=this._getSubLayer(r)),n.layer=o,o}).filter(Boolean):null}}ye(hC,"defaultProps",vie),ye(hC,"layerName","Tile3DLayer");function bie(i){const e={};return e.positions={...i.positions,value:new Float32Array(i.positions.value)},i.normals&&(e.normals=i.normals),i.texCoords&&(e.texCoords=i.texCoords),i.colors&&(e.colors=i.colors),i.uvRegions&&(e.uvRegions=i.uvRegions),e}var c4={exports:{}};(function(i,e){(function(t,r){i.exports=r()})(lf,function(){var t,r,n;function o(s,g){if(!t)t=g;else if(!r)r=g;else{var b="var sharedChunk = {}; ("+t+")(sharedChunk); ("+r+")(sharedChunk);",T={};t(T),n=g(T),typeof window<"u"&&(n.workerUrl=window.URL.createObjectURL(new Blob([b],{type:"text/javascript"})))}}o(["exports"],function(s){function g(h,c,f,v){return new(f||(f=Promise))(function(E,M){function D(X){try{$(v.next(X))}catch(se){M(se)}}function G(X){try{$(v.throw(X))}catch(se){M(se)}}function $(X){var se;X.done?E(X.value):(se=X.value,se instanceof f?se:new f(function(Ae){Ae(se)})).then(D,G)}$((v=v.apply(h,c||[])).next())})}function b(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}typeof SuppressedError=="function"&&SuppressedError;var T=F;function F(h,c){this.x=h,this.y=c}F.prototype={clone:function(){return new F(this.x,this.y)},add:function(h){return this.clone()._add(h)},sub:function(h){return this.clone()._sub(h)},multByPoint:function(h){return this.clone()._multByPoint(h)},divByPoint:function(h){return this.clone()._divByPoint(h)},mult:function(h){return this.clone()._mult(h)},div:function(h){return this.clone()._div(h)},rotate:function(h){return this.clone()._rotate(h)},rotateAround:function(h,c){return this.clone()._rotateAround(h,c)},matMult:function(h){return this.clone()._matMult(h)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(h){return this.x===h.x&&this.y===h.y},dist:function(h){return Math.sqrt(this.distSqr(h))},distSqr:function(h){var c=h.x-this.x,f=h.y-this.y;return c*c+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith:function(h){return this.angleWithSep(h.x,h.y)},angleWithSep:function(h,c){return Math.atan2(this.x*c-this.y*h,this.x*h+this.y*c)},_matMult:function(h){var c=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=c,this},_add:function(h){return this.x+=h.x,this.y+=h.y,this},_sub:function(h){return this.x-=h.x,this.y-=h.y,this},_mult:function(h){return this.x*=h,this.y*=h,this},_div:function(h){return this.x/=h,this.y/=h,this},_multByPoint:function(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint:function(h){return this.x/=h.x,this.y/=h.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var h=this.y;return this.y=this.x,this.x=-h,this},_rotate:function(h){var c=Math.cos(h),f=Math.sin(h),v=f*this.x+c*this.y;return this.x=c*this.x-f*this.y,this.y=v,this},_rotateAround:function(h,c){var f=Math.cos(h),v=Math.sin(h),E=c.y+v*(this.x-c.x)+f*(this.y-c.y);return this.x=c.x+f*(this.x-c.x)-v*(this.y-c.y),this.y=E,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},F.convert=function(h){return h instanceof F?h:Array.isArray(h)?new F(h[0],h[1]):h};var k=b(T),z=J;function J(h,c,f,v){this.cx=3*h,this.bx=3*(f-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(v-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=c,this.p2x=f,this.p2y=v}J.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,c){if(c===void 0&&(c=1e-6),h<0)return 0;if(h>1)return 1;for(var f=h,v=0;v<8;v++){var E=this.sampleCurveX(f)-h;if(Math.abs(E)<c)return f;var M=this.sampleCurveDerivativeX(f);if(Math.abs(M)<1e-6)break;f-=E/M}var D=0,G=1;for(f=h,v=0;v<20&&(E=this.sampleCurveX(f),!(Math.abs(E-h)<c));v++)h>E?D=f:G=f,f=.5*(G-D)+D;return f},solve:function(h,c){return this.sampleCurveY(this.solveCurveX(h,c))}};var te=b(z);let ue,ce;function de(){return ue==null&&(ue=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ue}function _e(){if(ce==null&&(ce=!1,de())){const c=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(c){for(let v=0;v<5*5;v++){const E=4*v;c.fillStyle=`rgb(${E},${E+1},${E+2})`,c.fillRect(v%5,Math.floor(v/5),1,1)}const f=c.getImageData(0,0,5,5).data;for(let v=0;v<5*5*4;v++)if(v%4!=3&&f[v]!==v){ce=!0;break}}}return ce||!1}function Ee(h,c,f,v){const E=new te(h,c,f,v);return function(M){return E.solve(M)}}const He=Ee(.25,.1,.25,1);function Ve(h,c,f){return Math.min(f,Math.max(c,h))}function qe(h,c,f){const v=f-c,E=((h-c)%v+v)%v+c;return E===c?f:E}function Ue(h){for(var c=arguments.length,f=new Array(c>1?c-1:0),v=1;v<c;v++)f[v-1]=arguments[v];for(const E of f)for(const M in E)h[M]=E[M];return h}let ot=1;function it(h,c,f){const v={};for(const E in h)v[E]=c.call(f||this,h[E],E,h);return v}function De(h,c,f){const v={};for(const E in h)c.call(f||this,h[E],E,h)&&(v[E]=h[E]);return v}function Me(h){return Array.isArray(h)?h.map(Me):typeof h=="object"&&h?it(h,Me):h}const Ze={};function We(h){Ze[h]||(typeof console<"u"&&console.warn(h),Ze[h]=!0)}function Bt(h,c,f){return(f.y-h.y)*(c.x-h.x)>(c.y-h.y)*(f.x-h.x)}function Ct(h){let c=0;for(let f,v,E=0,M=h.length,D=M-1;E<M;D=E++)f=h[E],v=h[D],c+=(v.x-f.x)*(f.y+v.y);return c}function Lt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let _t=null;function Ft(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const Mt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Wt(h,c,f,v,E){return g(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const M=new VideoFrame(h,{timestamp:0});try{const D=M==null?void 0:M.format;if(!D||!D.startsWith("BGR")&&!D.startsWith("RGB"))throw new Error(`Unrecognized format ${D}`);const G=D.startsWith("BGR"),$=new Uint8ClampedArray(v*E*4);if(yield M.copyTo($,function(X,se,Ae,me,Be){const Te=4*Math.max(-se,0),ke=(Math.max(0,Ae)-Ae)*me*4+Te,je=4*me,$e=Math.max(0,se),ct=Math.max(0,Ae);return{rect:{x:$e,y:ct,width:Math.min(X.width,se+me)-$e,height:Math.min(X.height,Ae+Be)-ct},layout:[{offset:ke,stride:je}]}}(h,c,f,v,E)),G)for(let X=0;X<$.length;X+=4){const se=$[X];$[X]=$[X+2],$[X+2]=se}return $}finally{M.close()}})}let Se,Xe,et,At;const ft={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(h){const c=requestAnimationFrame(h);return{cancel:()=>cancelAnimationFrame(c)}},getImageData(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(h).getImageData(-c,-c,h.width+2*c,h.height+2*c)},getImageCanvasContext(h){const c=window.document.createElement("canvas"),f=c.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return c.width=h.width,c.height=h.height,f.drawImage(h,0,0,h.width,h.height),f},resolveURL:h=>(et||(et=document.createElement("a")),et.href=h,et.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(At==null&&(At=matchMedia("(prefers-reduced-motion: reduce)")),At.matches)}},wt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Pt extends Error{constructor(c,f,v,E){super(`AJAXError: ${f} (${c}): ${v}`),this.status=c,this.statusText=f,this.url=v,this.body=E}}const It=Lt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Ht=h=>wt.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))];function ii(h,c){const f=new AbortController,v=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:It(),signal:f.signal});let E=!1,M=!1;return h.type==="json"&&v.headers.set("Accept","application/json"),M||fetch(v).then(D=>D.ok?(G=>{(h.type==="arrayBuffer"||h.type==="image"?G.arrayBuffer():h.type==="json"?G.json():G.text()).then($=>{M||(E=!0,c(null,$,G.headers.get("Cache-Control"),G.headers.get("Expires")))}).catch($=>{M||c(new Error($.message))})})(D):D.blob().then(G=>c(new Pt(D.status,D.statusText,h.url,G)))).catch(D=>{D.code!==20&&c(new Error(D.message))}),{cancel:()=>{M=!0,E||f.abort()}}}const gi=function(h,c){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){if(Lt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",h,c);if(!Lt())return(Ht(h.url)||ii)(h,c)}if(!(/^file:/.test(f=h.url)||/^file:/.test(It())&&!/^\w+:/.test(f))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ii(h,c);if(Lt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",h,c,void 0,!0)}var f;return function(v,E){const M=new XMLHttpRequest;M.open(v.method||"GET",v.url,!0),v.type!=="arrayBuffer"&&v.type!=="image"||(M.responseType="arraybuffer");for(const D in v.headers)M.setRequestHeader(D,v.headers[D]);return v.type==="json"&&(M.responseType="text",M.setRequestHeader("Accept","application/json")),M.withCredentials=v.credentials==="include",M.onerror=()=>{E(new Error(M.statusText))},M.onload=()=>{if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let D=M.response;if(v.type==="json")try{D=JSON.parse(M.response)}catch(G){return E(G)}E(null,D,M.getResponseHeader("Cache-Control"),M.getResponseHeader("Expires"))}else{const D=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});E(new Pt(M.status,M.statusText,v.url,D))}},M.send(v.body),{cancel:()=>M.abort()}}(h,c)},mi=function(h,c){return gi(Ue(h,{type:"arrayBuffer"}),c)};function Mi(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const c=new URL(h),f=window.location;return c.protocol===f.protocol&&c.host===f.host}function kt(h,c,f){f[h]&&f[h].indexOf(c)!==-1||(f[h]=f[h]||[],f[h].push(c))}function at(h,c,f){if(f&&f[h]){const v=f[h].indexOf(c);v!==-1&&f[h].splice(v,1)}}class xt{constructor(c){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ue(this,f),this.type=c}}class Ri extends xt{constructor(c){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",Ue({error:c},f))}}class ei{on(c,f){return this._listeners=this._listeners||{},kt(c,f,this._listeners),this}off(c,f){return at(c,f,this._listeners),at(c,f,this._oneTimeListeners),this}once(c,f){return f?(this._oneTimeListeners=this._oneTimeListeners||{},kt(c,f,this._oneTimeListeners),this):new Promise(v=>this.once(c,v))}fire(c,f){typeof c=="string"&&(c=new xt(c,f||{}));const v=c.type;if(this.listens(v)){c.target=this;const E=this._listeners&&this._listeners[v]?this._listeners[v].slice():[];for(const G of E)G.call(this,c);const M=this._oneTimeListeners&&this._oneTimeListeners[v]?this._oneTimeListeners[v].slice():[];for(const G of M)at(v,G,this._oneTimeListeners),G.call(this,c);const D=this._eventedParent;D&&(Ue(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(c))}else c instanceof Ri&&console.error(c.error);return this}listens(c){return this._listeners&&this._listeners[c]&&this._listeners[c].length>0||this._oneTimeListeners&&this._oneTimeListeners[c]&&this._oneTimeListeners[c].length>0||this._eventedParent&&this._eventedParent.listens(c)}setEventedParent(c,f){return this._eventedParent=c,this._eventedParentData=f,this}}var ut={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const jt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ni(h,c){const f={};for(const v in h)v!=="ref"&&(f[v]=h[v]);return jt.forEach(v=>{v in c&&(f[v]=c[v])}),f}function di(h,c){if(Array.isArray(h)){if(!Array.isArray(c)||h.length!==c.length)return!1;for(let f=0;f<h.length;f++)if(!di(h[f],c[f]))return!1;return!0}if(typeof h=="object"&&h!==null&&c!==null){if(typeof c!="object"||Object.keys(h).length!==Object.keys(c).length)return!1;for(const f in h)if(!di(h[f],c[f]))return!1;return!0}return h===c}const li={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ki(h,c,f){f.push({command:li.addSource,args:[h,c[h]]})}function tr(h,c,f){c.push({command:li.removeSource,args:[h]}),f[h]=!0}function Ar(h,c,f,v){tr(h,f,v),Ki(h,c,f)}function Er(h,c,f){let v;for(v in h[f])if(Object.prototype.hasOwnProperty.call(h[f],v)&&v!=="data"&&!di(h[f][v],c[f][v]))return!1;for(v in c[f])if(Object.prototype.hasOwnProperty.call(c[f],v)&&v!=="data"&&!di(h[f][v],c[f][v]))return!1;return!0}function Nt(h,c,f,v,E,M){let D;for(D in c=c||{},h=h||{})Object.prototype.hasOwnProperty.call(h,D)&&(di(h[D],c[D])||f.push({command:M,args:[v,D,c[D],E]}));for(D in c)Object.prototype.hasOwnProperty.call(c,D)&&!Object.prototype.hasOwnProperty.call(h,D)&&(di(h[D],c[D])||f.push({command:M,args:[v,D,c[D],E]}))}function Ji(h){return h.id}function ci(h,c){return h[c.id]=c,h}class $t{constructor(c,f,v,E){this.message=(c?`${c}: `:"")+v,E&&(this.identifier=E),f!=null&&f.__line__&&(this.line=f.__line__)}}function Zi(h){for(var c=arguments.length,f=new Array(c>1?c-1:0),v=1;v<c;v++)f[v-1]=arguments[v];for(const E of f)for(const M in E)h[M]=E[M];return h}class Qt extends Error{constructor(c,f){super(f),this.message=f,this.key=c}}class Bi{constructor(c){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=c,this.bindings={};for(const[v,E]of f)this.bindings[v]=E}concat(c){return new Bi(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(`${c} not found in scope.`)}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}const Ii={kind:"null"},Gt={kind:"number"},vi={kind:"string"},Jt={kind:"boolean"},mr={kind:"color"},Sr={kind:"object"},ze={kind:"value"},we={kind:"collator"},oe={kind:"formatted"},ee={kind:"padding"},le={kind:"resolvedImage"},ge={kind:"variableAnchorOffsetCollection"};function ve(h,c){return{kind:"array",itemType:h,N:c}}function Ce(h){if(h.kind==="array"){const c=Ce(h.itemType);return typeof h.N=="number"?`array<${c}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${c}>`}return h.kind}const be=[Ii,Gt,vi,Jt,mr,oe,Sr,ve(ze),ee,le,ge];function Pe(h,c){if(c.kind==="error")return null;if(h.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!Pe(h.itemType,c.itemType))&&(typeof h.N!="number"||h.N===c.N))return null}else{if(h.kind===c.kind)return null;if(h.kind==="value"){for(const f of be)if(!Pe(f,c))return null}}return`Expected ${Ce(h)} but found ${Ce(c)} instead.`}function Oe(h,c){return c.some(f=>f.kind===h.kind)}function Ge(h,c){return c.some(f=>f==="null"?h===null:f==="array"?Array.isArray(h):f==="object"?h&&!Array.isArray(h)&&typeof h=="object":f===typeof h)}function rt(h,c){return h.kind==="array"&&c.kind==="array"?h.itemType.kind===c.itemType.kind&&typeof h.N=="number":h.kind===c.kind}const yt=.96422,Et=.82521,Yt=4/29,qt=6/29,Kt=3*qt*qt,si=qt*qt*qt,Ci=Math.PI/180,Hi=180/Math.PI;function wi(h){return(h%=360)<0&&(h+=360),h}function Ui(h){let[c,f,v,E]=h,M,D;const G=ti((.2225045*(c=st(c))+.7168786*(f=st(f))+.0606169*(v=st(v)))/1);c===f&&f===v?M=D=G:(M=ti((.4360747*c+.3850649*f+.1430804*v)/yt),D=ti((.0139322*c+.0971045*f+.7141733*v)/Et));const $=116*G-16;return[$<0?0:$,500*(M-G),200*(G-D),E]}function st(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function ti(h){return h>si?Math.pow(h,1/3):h/Kt+Yt}function zt(h){let[c,f,v,E]=h,M=(c+16)/116,D=isNaN(f)?M:M+f/500,G=isNaN(v)?M:M-v/200;return M=1*hr(M),D=yt*hr(D),G=Et*hr(G),[zi(3.1338561*D-1.6168667*M-.4906146*G),zi(-.9787684*D+1.9161415*M+.033454*G),zi(.0719453*D-.2289914*M+1.4052427*G),E]}function zi(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function hr(h){return h>qt?h*h*h:Kt*(h-Yt)}function sn(h){return parseInt(h.padEnd(2,h),16)/255}function bn(h,c){return ur(c?h/100:h,0,1)}function ur(h,c,f){return Math.min(Math.max(c,h),f)}function gn(h){return!h.some(Number.isNaN)}const mn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class lr{constructor(c,f,v){let E=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=c,this.g=f,this.b=v,this.a=E,M||(this.r*=E,this.g*=E,this.b*=E,E||this.overwriteGetter("rgb",[c,f,v,E]))}static parse(c){if(c instanceof lr)return c;if(typeof c!="string")return;const f=function(v){if((v=v.toLowerCase().trim())==="transparent")return[0,0,0,0];const E=mn[v];if(E){const[D,G,$]=E;return[D/255,G/255,$/255,1]}if(v.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(v)){const D=v.length<6?1:2;let G=1;return[sn(v.slice(G,G+=D)),sn(v.slice(G,G+=D)),sn(v.slice(G,G+=D)),sn(v.slice(G,G+D)||"ff")]}if(v.startsWith("rgb")){const D=v.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(D){const[G,$,X,se,Ae,me,Be,Te,ke,je,$e,ct]=D,Ye=[se||" ",Be||" ",je].join("");if(Ye==="  "||Ye==="  /"||Ye===",,"||Ye===",,,"){const tt=[X,me,ke].join(""),gt=tt==="%%%"?100:tt===""?255:0;if(gt){const St=[ur(+$/gt,0,1),ur(+Ae/gt,0,1),ur(+Te/gt,0,1),$e?bn(+$e,ct):1];if(gn(St))return St}}return}}const M=v.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(M){const[D,G,$,X,se,Ae,me,Be,Te]=M,ke=[$||" ",se||" ",me].join("");if(ke==="  "||ke==="  /"||ke===",,"||ke===",,,"){const je=[+G,ur(+X,0,100),ur(+Ae,0,100),Be?bn(+Be,Te):1];if(gn(je))return function($e){let[ct,Ye,tt,gt]=$e;function St(Xt){const xi=(Xt+ct/30)%12,oi=Ye*Math.min(tt,1-tt);return tt-oi*Math.max(-1,Math.min(xi-3,9-xi,1))}return ct=wi(ct),Ye/=100,tt/=100,[St(0),St(8),St(4),gt]}(je)}}}(c);return f?new lr(...f,!1):void 0}get rgb(){const{r:c,g:f,b:v,a:E}=this,M=E||1/0;return this.overwriteGetter("rgb",[c/M,f/M,v/M,E])}get hcl(){return this.overwriteGetter("hcl",function(c){const[f,v,E,M]=Ui(c),D=Math.sqrt(v*v+E*E);return[Math.round(1e4*D)?wi(Math.atan2(E,v)*Hi):NaN,D,f,M]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Ui(this.rgb))}overwriteGetter(c,f){return Object.defineProperty(this,c,{value:f}),f}toString(){const[c,f,v,E]=this.rgb;return`rgba(${[c,f,v].map(M=>Math.round(255*M)).join(",")},${E})`}}lr.black=new lr(0,0,0,1),lr.white=new lr(1,1,1,1),lr.transparent=new lr(0,0,0,0),lr.red=new lr(1,0,0,1);class kn{constructor(c,f,v){this.sensitivity=c?f?"variant":"case":f?"accent":"base",this.locale=v,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,f){return this.collator.compare(c,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class gs{constructor(c,f,v,E,M){this.text=c,this.image=f,this.scale=v,this.fontStack=E,this.textColor=M}}class Qr{constructor(c){this.sections=c}static fromString(c){return new Qr([new gs(c,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.name.length!==0)}static factory(c){return c instanceof Qr?c:Qr.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}}class xn{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof xn)return c;if(typeof c=="number")return new xn([c,c,c,c]);if(Array.isArray(c)&&!(c.length<1||c.length>4)){for(const f of c)if(typeof f!="number")return;switch(c.length){case 1:c=[c[0],c[0],c[0],c[0]];break;case 2:c=[c[0],c[1],c[0],c[1]];break;case 3:c=[c[0],c[1],c[2],c[1]]}return new xn(c)}}toString(){return JSON.stringify(this.values)}}const So=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class us{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof us)return c;if(Array.isArray(c)&&!(c.length<1)&&c.length%2==0){for(let f=0;f<c.length;f+=2){const v=c[f],E=c[f+1];if(typeof v!="string"||!So.has(v)||!Array.isArray(E)||E.length!==2||typeof E[0]!="number"||typeof E[1]!="number")return}return new us(c)}}toString(){return JSON.stringify(this.values)}}class Wi{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new Wi({name:c,available:!1}):null}}function Ys(h,c,f,v){return typeof h=="number"&&h>=0&&h<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof f=="number"&&f>=0&&f<=255?v===void 0||typeof v=="number"&&v>=0&&v<=1?null:`Invalid rgba value [${[h,c,f,v].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof v=="number"?[h,c,f,v]:[h,c,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bs(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof lr||h instanceof kn||h instanceof Qr||h instanceof xn||h instanceof us||h instanceof Wi)return!0;if(Array.isArray(h)){for(const c of h)if(!Bs(c))return!1;return!0}if(typeof h=="object"){for(const c in h)if(!Bs(h[c]))return!1;return!0}return!1}function dr(h){if(h===null)return Ii;if(typeof h=="string")return vi;if(typeof h=="boolean")return Jt;if(typeof h=="number")return Gt;if(h instanceof lr)return mr;if(h instanceof kn)return we;if(h instanceof Qr)return oe;if(h instanceof xn)return ee;if(h instanceof us)return ge;if(h instanceof Wi)return le;if(Array.isArray(h)){const c=h.length;let f;for(const v of h){const E=dr(v);if(f){if(f===E)continue;f=ze;break}f=E}return ve(f||ze,c)}return Sr}function Fr(h){const c=typeof h;return h===null?"":c==="string"||c==="number"||c==="boolean"?String(h):h instanceof lr||h instanceof Qr||h instanceof xn||h instanceof us||h instanceof Wi?h.toString():JSON.stringify(h)}class Hn{constructor(c,f){this.type=c,this.value=f}static parse(c,f){if(c.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!Bs(c[1]))return f.error("invalid value");const v=c[1];let E=dr(v);const M=f.expectedType;return E.kind!=="array"||E.N!==0||!M||M.kind!=="array"||typeof M.N=="number"&&M.N!==0||(E=M),new Hn(E,v)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Or{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}}const Cn={string:vi,number:Gt,boolean:Jt,object:Sr};class An{constructor(c,f){this.type=c,this.args=f}static parse(c,f){if(c.length<2)return f.error("Expected at least one argument.");let v,E=1;const M=c[0];if(M==="array"){let G,$;if(c.length>2){const X=c[1];if(typeof X!="string"||!(X in Cn)||X==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);G=Cn[X],E++}else G=ze;if(c.length>3){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return f.error('The length argument to "array" must be a positive integer literal',2);$=c[2],E++}v=ve(G,$)}else{if(!Cn[M])throw new Error(`Types doesn't contain name = ${M}`);v=Cn[M]}const D=[];for(;E<c.length;E++){const G=f.parse(c[E],E,ze);if(!G)return null;D.push(G)}return new An(v,D)}evaluate(c){for(let f=0;f<this.args.length;f++){const v=this.args[f].evaluate(c);if(!Pe(this.type,dr(v)))return v;if(f===this.args.length-1)throw new Or(`Expected value to be of type ${Ce(this.type)}, but found ${Ce(dr(v))} instead.`)}throw new Error}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const Hr={"to-boolean":Jt,"to-color":mr,"to-number":Gt,"to-string":vi};class Gs{constructor(c,f){this.type=c,this.args=f}static parse(c,f){if(c.length<2)return f.error("Expected at least one argument.");const v=c[0];if(!Hr[v])throw new Error(`Can't parse ${v} as it is not part of the known types`);if((v==="to-boolean"||v==="to-string")&&c.length!==2)return f.error("Expected one argument.");const E=Hr[v],M=[];for(let D=1;D<c.length;D++){const G=f.parse(c[D],D,ze);if(!G)return null;M.push(G)}return new Gs(E,M)}evaluate(c){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(c);case"color":{let f,v;for(const E of this.args){if(f=E.evaluate(c),v=null,f instanceof lr)return f;if(typeof f=="string"){const M=c.parseColor(f);if(M)return M}else if(Array.isArray(f)&&(v=f.length<3||f.length>4?`Invalid rbga value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:Ys(f[0],f[1],f[2],f[3]),!v))return new lr(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new Or(v||`Could not parse color from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"padding":{let f;for(const v of this.args){f=v.evaluate(c);const E=xn.parse(f);if(E)return E}throw new Or(`Could not parse padding from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"variableAnchorOffsetCollection":{let f;for(const v of this.args){f=v.evaluate(c);const E=us.parse(f);if(E)return E}throw new Or(`Could not parse variableAnchorOffsetCollection from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"number":{let f=null;for(const v of this.args){if(f=v.evaluate(c),f===null)return 0;const E=Number(f);if(!isNaN(E))return E}throw new Or(`Could not convert ${JSON.stringify(f)} to number.`)}case"formatted":return Qr.fromString(Fr(this.args[0].evaluate(c)));case"resolvedImage":return Wi.fromString(Fr(this.args[0].evaluate(c)));default:return Fr(this.args[0].evaluate(c))}}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const ca=["Unknown","Point","LineString","Polygon"];class uo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ca[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(c){let f=this._parseColorCache[c];return f||(f=this._parseColorCache[c]=lr.parse(c)),f}}class Ea{constructor(c,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],E=arguments.length>3?arguments[3]:void 0,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Bi,D=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=c,this.path=v,this.key=v.map(G=>`[${G}]`).join(""),this.scope=M,this.errors=D,this.expectedType=E,this._isConstant=f}parse(c,f,v,E){let M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return f?this.concat(f,v,E)._parse(c,M):this._parse(c,M)}_parse(c,f){function v(E,M,D){return D==="assert"?new An(M,[E]):D==="coerce"?new Gs(M,[E]):E}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const E=c[0];if(typeof E!="string")return this.error(`Expression name must be a string, but found ${typeof E} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const M=this.registry[E];if(M){let D=M.parse(c,this);if(!D)return null;if(this.expectedType){const G=this.expectedType,$=D.type;if(G.kind!=="string"&&G.kind!=="number"&&G.kind!=="boolean"&&G.kind!=="object"&&G.kind!=="array"||$.kind!=="value")if(G.kind!=="color"&&G.kind!=="formatted"&&G.kind!=="resolvedImage"||$.kind!=="value"&&$.kind!=="string")if(G.kind!=="padding"||$.kind!=="value"&&$.kind!=="number"&&$.kind!=="array")if(G.kind!=="variableAnchorOffsetCollection"||$.kind!=="value"&&$.kind!=="array"){if(this.checkSubtype(G,$))return null}else D=v(D,G,f.typeAnnotation||"coerce");else D=v(D,G,f.typeAnnotation||"coerce");else D=v(D,G,f.typeAnnotation||"coerce");else D=v(D,G,f.typeAnnotation||"assert")}if(!(D instanceof Hn)&&D.type.kind!=="resolvedImage"&&this._isConstant(D)){const G=new uo;try{D=new Hn(D.type,D.evaluate(G))}catch($){return this.error($.message),null}}return D}return this.error(`Unknown expression "${E}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(c===void 0?"'undefined' value invalid. Use null instead.":typeof c=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof c} instead.`)}concat(c,f,v){const E=typeof c=="number"?this.path.concat(c):this.path,M=v?this.scope.concat(v):this.scope;return new Ea(this.registry,this._isConstant,E,f||null,M,this.errors)}error(c){for(var f=arguments.length,v=new Array(f>1?f-1:0),E=1;E<f;E++)v[E-1]=arguments[E];const M=`${this.key}${v.map(D=>`[${D}]`).join("")}`;this.errors.push(new Qt(M,c))}checkSubtype(c,f){const v=Pe(c,f);return v&&this.error(v),v}}class Ne{constructor(c,f,v){this.type=we,this.locale=v,this.caseSensitive=c,this.diacriticSensitive=f}static parse(c,f){if(c.length!==2)return f.error("Expected one argument.");const v=c[1];if(typeof v!="object"||Array.isArray(v))return f.error("Collator options argument must be an object.");const E=f.parse(v["case-sensitive"]!==void 0&&v["case-sensitive"],1,Jt);if(!E)return null;const M=f.parse(v["diacritic-sensitive"]!==void 0&&v["diacritic-sensitive"],1,Jt);if(!M)return null;let D=null;return v.locale&&(D=f.parse(v.locale,1,vi),!D)?null:new Ne(E,M,D)}evaluate(c){return new kn(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}}const Je=8192;function dt(h,c){h[0]=Math.min(h[0],c[0]),h[1]=Math.min(h[1],c[1]),h[2]=Math.max(h[2],c[0]),h[3]=Math.max(h[3],c[1])}function Ot(h,c){return!(h[0]<=c[0]||h[2]>=c[2]||h[1]<=c[1]||h[3]>=c[3])}function ui(h,c){const f=(180+h[0])/360,v=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,E=Math.pow(2,c.z);return[Math.round(f*E*Je),Math.round(v*E*Je)]}function Gi(h,c,f){const v=h[0]-c[0],E=h[1]-c[1],M=h[0]-f[0],D=h[1]-f[1];return v*D-M*E==0&&v*M<=0&&E*D<=0}function br(h,c){let f=!1;for(let D=0,G=c.length;D<G;D++){const $=c[D];for(let X=0,se=$.length;X<se-1;X++){if(Gi(h,$[X],$[X+1]))return!1;(E=$[X])[1]>(v=h)[1]!=(M=$[X+1])[1]>v[1]&&v[0]<(M[0]-E[0])*(v[1]-E[1])/(M[1]-E[1])+E[0]&&(f=!f)}}var v,E,M;return f}function En(h,c){for(let f=0;f<c.length;f++)if(br(h,c[f]))return!0;return!1}function On(h,c,f,v){const E=v[0]-f[0],M=v[1]-f[1],D=(h[0]-f[0])*M-E*(h[1]-f[1]),G=(c[0]-f[0])*M-E*(c[1]-f[1]);return D>0&&G<0||D<0&&G>0}function rs(h,c,f){for(const X of f)for(let se=0;se<X.length-1;++se)if((G=[(D=X[se+1])[0]-(M=X[se])[0],D[1]-M[1]])[0]*($=[(E=c)[0]-(v=h)[0],E[1]-v[1]])[1]-G[1]*$[0]!=0&&On(v,E,M,D)&&On(M,D,v,E))return!0;var v,E,M,D,G,$;return!1}function wn(h,c){for(let f=0;f<h.length;++f)if(!br(h[f],c))return!1;for(let f=0;f<h.length-1;++f)if(rs(h[f],h[f+1],c))return!1;return!0}function au(h,c){for(let f=0;f<c.length;f++)if(wn(h,c[f]))return!0;return!1}function $a(h,c,f){const v=[];for(let E=0;E<h.length;E++){const M=[];for(let D=0;D<h[E].length;D++){const G=ui(h[E][D],f);dt(c,G),M.push(G)}v.push(M)}return v}function Tr(h,c,f){const v=[];for(let E=0;E<h.length;E++){const M=$a(h[E],c,f);v.push(M)}return v}function Ka(h,c,f,v){if(h[0]<f[0]||h[0]>f[2]){const E=.5*v;let M=h[0]-f[0]>E?-v:f[0]-h[0]>E?v:0;M===0&&(M=h[0]-f[2]>E?-v:f[2]-h[0]>E?v:0),h[0]+=M}dt(c,h)}function Ul(h,c,f,v){const E=Math.pow(2,v.z)*Je,M=[v.x*Je,v.y*Je],D=[];for(const G of h)for(const $ of G){const X=[$.x+M[0],$.y+M[1]];Ka(X,c,f,E),D.push(X)}return D}function Yn(h,c,f,v){const E=Math.pow(2,v.z)*Je,M=[v.x*Je,v.y*Je],D=[];for(const $ of h){const X=[];for(const se of $){const Ae=[se.x+M[0],se.y+M[1]];dt(c,Ae),X.push(Ae)}D.push(X)}if(c[2]-c[0]<=E/2){(G=c)[0]=G[1]=1/0,G[2]=G[3]=-1/0;for(const $ of D)for(const X of $)Ka(X,c,f,E)}var G;return D}class To{constructor(c,f){this.type=Jt,this.geojson=c,this.geometries=f}static parse(c,f){if(c.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(Bs(c[1])){const v=c[1];if(v.type==="FeatureCollection")for(let E=0;E<v.features.length;++E){const M=v.features[E].geometry.type;if(M==="Polygon"||M==="MultiPolygon")return new To(v,v.features[E].geometry)}else if(v.type==="Feature"){const E=v.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new To(v,v.geometry)}else if(v.type==="Polygon"||v.type==="MultiPolygon")return new To(v,v)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(f,v){const E=[1/0,1/0,-1/0,-1/0],M=[1/0,1/0,-1/0,-1/0],D=f.canonicalID();if(v.type==="Polygon"){const G=$a(v.coordinates,M,D),$=Ul(f.geometry(),E,M,D);if(!Ot(E,M))return!1;for(const X of $)if(!br(X,G))return!1}if(v.type==="MultiPolygon"){const G=Tr(v.coordinates,M,D),$=Ul(f.geometry(),E,M,D);if(!Ot(E,M))return!1;for(const X of $)if(!En(X,G))return!1}return!0}(c,this.geometries);if(c.geometryType()==="LineString")return function(f,v){const E=[1/0,1/0,-1/0,-1/0],M=[1/0,1/0,-1/0,-1/0],D=f.canonicalID();if(v.type==="Polygon"){const G=$a(v.coordinates,M,D),$=Yn(f.geometry(),E,M,D);if(!Ot(E,M))return!1;for(const X of $)if(!wn(X,G))return!1}if(v.type==="MultiPolygon"){const G=Tr(v.coordinates,M,D),$=Yn(f.geometry(),E,M,D);if(!Ot(E,M))return!1;for(const X of $)if(!au(X,G))return!1}return!0}(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Wa{constructor(c,f){this.type=f.type,this.name=c,this.boundExpression=f}static parse(c,f){if(c.length!==2||typeof c[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");const v=c[1];return f.scope.has(v)?new Wa(v,f.scope.get(v)):f.error(`Unknown variable "${v}". Make sure "${v}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}}class ms{constructor(c,f,v,E){this.name=c,this.type=f,this._evaluate=v,this.args=E}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}static parse(c,f){const v=c[0],E=ms.definitions[v];if(!E)return f.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0);const M=Array.isArray(E)?E[0]:E.type,D=Array.isArray(E)?[[E[1],E[2]]]:E.overloads,G=D.filter(X=>{let[se]=X;return!Array.isArray(se)||se.length===c.length-1});let $=null;for(const[X,se]of G){$=new Ea(f.registry,ua,f.path,null,f.scope);const Ae=[];let me=!1;for(let Be=1;Be<c.length;Be++){const Te=c[Be],ke=Array.isArray(X)?X[Be-1]:X.type,je=$.parse(Te,1+Ae.length,ke);if(!je){me=!0;break}Ae.push(je)}if(!me)if(Array.isArray(X)&&X.length!==Ae.length)$.error(`Expected ${X.length} arguments, but found ${Ae.length} instead.`);else{for(let Be=0;Be<Ae.length;Be++){const Te=Array.isArray(X)?X[Be]:X.type,ke=Ae[Be];$.concat(Be+1).checkSubtype(Te,ke.type)}if($.errors.length===0)return new ms(v,M,se,Ae)}}if(G.length===1)f.errors.push(...$.errors);else{const X=(G.length?G:D).map(Ae=>{let[me]=Ae;return Be=me,Array.isArray(Be)?`(${Be.map(Ce).join(", ")})`:`(${Ce(Be.type)}...)`;var Be}).join(" | "),se=[];for(let Ae=1;Ae<c.length;Ae++){const me=f.parse(c[Ae],1+se.length);if(!me)return null;se.push(Ce(me.type))}f.error(`Expected arguments of type ${X}, but found (${se.join(", ")}) instead.`)}return null}static register(c,f){ms.definitions=f;for(const v in f)c[v]=ms}}function ua(h){if(h instanceof Wa)return ua(h.boundExpression);if(h instanceof ms&&h.name==="error"||h instanceof Ne||h instanceof To)return!1;const c=h instanceof Gs||h instanceof An;let f=!0;return h.eachChild(v=>{f=c?f&&ua(v):f&&v instanceof Hn}),!!f&&Xa(h)&&Fc(h,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Xa(h){if(h instanceof ms&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof To)return!1;let c=!0;return h.eachChild(f=>{c&&!Xa(f)&&(c=!1)}),c}function Sa(h){if(h instanceof ms&&h.name==="feature-state")return!1;let c=!0;return h.eachChild(f=>{c&&!Sa(f)&&(c=!1)}),c}function Fc(h,c){if(h instanceof ms&&c.indexOf(h.name)>=0)return!1;let f=!0;return h.eachChild(v=>{f&&!Fc(v,c)&&(f=!1)}),f}function Za(h,c){const f=h.length-1;let v,E,M=0,D=f,G=0;for(;M<=D;)if(G=Math.floor((M+D)/2),v=h[G],E=h[G+1],v<=c){if(G===f||c<E)return G;M=G+1}else{if(!(v>c))throw new Or("Input is not a number.");D=G-1}return 0}class ho{constructor(c,f,v){this.type=c,this.input=f,this.labels=[],this.outputs=[];for(const[E,M]of v)this.labels.push(E),this.outputs.push(M)}static parse(c,f){if(c.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return f.error("Expected an even number of arguments.");const v=f.parse(c[1],1,Gt);if(!v)return null;const E=[];let M=null;f.expectedType&&f.expectedType.kind!=="value"&&(M=f.expectedType);for(let D=1;D<c.length;D+=2){const G=D===1?-1/0:c[D],$=c[D+1],X=D,se=D+1;if(typeof G!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(E.length&&E[E.length-1][0]>=G)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',X);const Ae=f.parse($,se,M);if(!Ae)return null;M=M||Ae.type,E.push([G,Ae])}return new ho(M,v,E)}evaluate(c){const f=this.labels,v=this.outputs;if(f.length===1)return v[0].evaluate(c);const E=this.input.evaluate(c);if(E<=f[0])return v[0].evaluate(c);const M=f.length;return E>=f[M-1]?v[M-1].evaluate(c):v[Za(f,E)].evaluate(c)}eachChild(c){c(this.input);for(const f of this.outputs)c(f)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function Pr(h,c,f){return h+f*(c-h)}function ha(h,c,f){return h.map((v,E)=>Pr(v,c[E],f))}const hs={number:Pr,color:function(h,c,f){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[E,M,D,G]=ha(h.rgb,c.rgb,f);return new lr(E,M,D,G,!1)}case"hcl":{const[E,M,D,G]=h.hcl,[$,X,se,Ae]=c.hcl;let me,Be;if(isNaN(E)||isNaN($))isNaN(E)?isNaN($)?me=NaN:(me=$,D!==1&&D!==0||(Be=X)):(me=E,se!==1&&se!==0||(Be=M));else{let ct=$-E;$>E&&ct>180?ct-=360:$<E&&E-$>180&&(ct+=360),me=E+f*ct}const[Te,ke,je,$e]=function(ct){let[Ye,tt,gt,St]=ct;return Ye=isNaN(Ye)?0:Ye*Ci,zt([gt,Math.cos(Ye)*tt,Math.sin(Ye)*tt,St])}([me,Be??Pr(M,X,f),Pr(D,se,f),Pr(G,Ae,f)]);return new lr(Te,ke,je,$e,!1)}case"lab":{const[E,M,D,G]=zt(ha(h.lab,c.lab,f));return new lr(E,M,D,G,!1)}}},array:ha,padding:function(h,c,f){return new xn(ha(h.values,c.values,f))},variableAnchorOffsetCollection:function(h,c,f){const v=h.values,E=c.values;if(v.length!==E.length)throw new Or(`Cannot interpolate values of different length. from: ${h.toString()}, to: ${c.toString()}`);const M=[];for(let D=0;D<v.length;D+=2){if(v[D]!==E[D])throw new Or(`Cannot interpolate values containing mismatched anchors. from[${D}]: ${v[D]}, to[${D}]: ${E[D]}`);M.push(v[D]);const[G,$]=v[D+1],[X,se]=E[D+1];M.push([Pr(G,X,f),Pr($,se,f)])}return new us(M)}};class dn{constructor(c,f,v,E,M){this.type=c,this.operator=f,this.interpolation=v,this.input=E,this.labels=[],this.outputs=[];for(const[D,G]of M)this.labels.push(D),this.outputs.push(G)}static interpolationFactor(c,f,v,E){let M=0;if(c.name==="exponential")M=ns(f,c.base,v,E);else if(c.name==="linear")M=ns(f,1,v,E);else if(c.name==="cubic-bezier"){const D=c.controlPoints;M=new te(D[0],D[1],D[2],D[3]).solve(ns(f,1,v,E))}return M}static parse(c,f){let[v,E,M,...D]=c;if(!Array.isArray(E)||E.length===0)return f.error("Expected an interpolation type expression.",1);if(E[0]==="linear")E={name:"linear"};else if(E[0]==="exponential"){const X=E[1];if(typeof X!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);E={name:"exponential",base:X}}else{if(E[0]!=="cubic-bezier")return f.error(`Unknown interpolation type ${String(E[0])}`,1,0);{const X=E.slice(1);if(X.length!==4||X.some(se=>typeof se!="number"||se<0||se>1))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);E={name:"cubic-bezier",controlPoints:X}}}if(c.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return f.error("Expected an even number of arguments.");if(M=f.parse(M,2,Gt),!M)return null;const G=[];let $=null;v==="interpolate-hcl"||v==="interpolate-lab"?$=mr:f.expectedType&&f.expectedType.kind!=="value"&&($=f.expectedType);for(let X=0;X<D.length;X+=2){const se=D[X],Ae=D[X+1],me=X+3,Be=X+4;if(typeof se!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',me);if(G.length&&G[G.length-1][0]>=se)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',me);const Te=f.parse(Ae,Be,$);if(!Te)return null;$=$||Te.type,G.push([se,Te])}return rt($,Gt)||rt($,mr)||rt($,ee)||rt($,ge)||rt($,ve(Gt))?new dn($,v,E,M,G):f.error(`Type ${Ce($)} is not interpolatable.`)}evaluate(c){const f=this.labels,v=this.outputs;if(f.length===1)return v[0].evaluate(c);const E=this.input.evaluate(c);if(E<=f[0])return v[0].evaluate(c);const M=f.length;if(E>=f[M-1])return v[M-1].evaluate(c);const D=Za(f,E),G=dn.interpolationFactor(this.interpolation,E,f[D],f[D+1]),$=v[D].evaluate(c),X=v[D+1].evaluate(c);switch(this.operator){case"interpolate":return hs[this.type.kind]($,X,G);case"interpolate-hcl":return hs.color($,X,G,"hcl");case"interpolate-lab":return hs.color($,X,G,"lab")}}eachChild(c){c(this.input);for(const f of this.outputs)c(f)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function ns(h,c,f,v){const E=v-f,M=h-f;return E===0?0:c===1?M/E:(Math.pow(c,M)-1)/(Math.pow(c,E)-1)}class Vr{constructor(c,f){this.type=c,this.args=f}static parse(c,f){if(c.length<2)return f.error("Expectected at least one argument.");let v=null;const E=f.expectedType;E&&E.kind!=="value"&&(v=E);const M=[];for(const G of c.slice(1)){const $=f.parse(G,1+M.length,v,void 0,{typeAnnotation:"omit"});if(!$)return null;v=v||$.type,M.push($)}if(!v)throw new Error("No output type");const D=E&&M.some(G=>Pe(E,G.type));return new Vr(D?ze:v,M)}evaluate(c){let f,v=null,E=0;for(const M of this.args)if(E++,v=M.evaluate(c),v&&v instanceof Wi&&!v.available&&(f||(f=v.name),v=null,E===this.args.length&&(v=f)),v!==null)break;return v}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}class Ja{constructor(c,f){this.type=f.type,this.bindings=[].concat(c),this.result=f}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const f of this.bindings)c(f[1]);c(this.result)}static parse(c,f){if(c.length<4)return f.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);const v=[];for(let M=1;M<c.length-1;M+=2){const D=c[M];if(typeof D!="string")return f.error(`Expected string, but found ${typeof D} instead.`,M);if(/[^a-zA-Z0-9_]/.test(D))return f.error("Variable names must contain only alphanumeric characters or '_'.",M);const G=f.parse(c[M+1],M+1);if(!G)return null;v.push([D,G])}const E=f.parse(c[c.length-1],c.length-1,f.expectedType,v);return E?new Ja(v,E):null}outputDefined(){return this.result.outputDefined()}}class cl{constructor(c,f,v){this.type=c,this.index=f,this.input=v}static parse(c,f){if(c.length!==3)return f.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const v=f.parse(c[1],1,Gt),E=f.parse(c[2],2,ve(f.expectedType||ze));return v&&E?new cl(E.type.itemType,v,E):null}evaluate(c){const f=this.index.evaluate(c),v=this.input.evaluate(c);if(f<0)throw new Or(`Array index out of bounds: ${f} < 0.`);if(f>=v.length)throw new Or(`Array index out of bounds: ${f} > ${v.length-1}.`);if(f!==Math.floor(f))throw new Or(`Array index must be an integer, but found ${f} instead.`);return v[f]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}}class Nl{constructor(c,f){this.type=Jt,this.needle=c,this.haystack=f}static parse(c,f){if(c.length!==3)return f.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const v=f.parse(c[1],1,ze),E=f.parse(c[2],2,ze);return v&&E?Oe(v.type,[Jt,vi,Gt,Ii,ze])?new Nl(v,E):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ce(v.type)} instead`):null}evaluate(c){const f=this.needle.evaluate(c),v=this.haystack.evaluate(c);if(!v)return!1;if(!Ge(f,["boolean","string","number","null"]))throw new Or(`Expected first argument to be of type boolean, string, number or null, but found ${Ce(dr(f))} instead.`);if(!Ge(v,["string","array"]))throw new Or(`Expected second argument to be of type array or string, but found ${Ce(dr(v))} instead.`);return v.indexOf(f)>=0}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}}class Io{constructor(c,f,v){this.type=Gt,this.needle=c,this.haystack=f,this.fromIndex=v}static parse(c,f){if(c.length<=2||c.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const v=f.parse(c[1],1,ze),E=f.parse(c[2],2,ze);if(!v||!E)return null;if(!Oe(v.type,[Jt,vi,Gt,Ii,ze]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ce(v.type)} instead`);if(c.length===4){const M=f.parse(c[3],3,Gt);return M?new Io(v,E,M):null}return new Io(v,E)}evaluate(c){const f=this.needle.evaluate(c),v=this.haystack.evaluate(c);if(!Ge(f,["boolean","string","number","null"]))throw new Or(`Expected first argument to be of type boolean, string, number or null, but found ${Ce(dr(f))} instead.`);if(!Ge(v,["string","array"]))throw new Or(`Expected second argument to be of type array or string, but found ${Ce(dr(v))} instead.`);if(this.fromIndex){const E=this.fromIndex.evaluate(c);return v.indexOf(f,E)}return v.indexOf(f)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}}class Ko{constructor(c,f,v,E,M,D){this.inputType=c,this.type=f,this.input=v,this.cases=E,this.outputs=M,this.otherwise=D}static parse(c,f){if(c.length<5)return f.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return f.error("Expected an even number of arguments.");let v,E;f.expectedType&&f.expectedType.kind!=="value"&&(E=f.expectedType);const M={},D=[];for(let X=2;X<c.length-1;X+=2){let se=c[X];const Ae=c[X+1];Array.isArray(se)||(se=[se]);const me=f.concat(X);if(se.length===0)return me.error("Expected at least one branch label.");for(const Te of se){if(typeof Te!="number"&&typeof Te!="string")return me.error("Branch labels must be numbers or strings.");if(typeof Te=="number"&&Math.abs(Te)>Number.MAX_SAFE_INTEGER)return me.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Te=="number"&&Math.floor(Te)!==Te)return me.error("Numeric branch labels must be integer values.");if(v){if(me.checkSubtype(v,dr(Te)))return null}else v=dr(Te);if(M[String(Te)]!==void 0)return me.error("Branch labels must be unique.");M[String(Te)]=D.length}const Be=f.parse(Ae,X,E);if(!Be)return null;E=E||Be.type,D.push(Be)}const G=f.parse(c[1],1,ze);if(!G)return null;const $=f.parse(c[c.length-1],c.length-1,E);return $?G.type.kind!=="value"&&f.concat(1).checkSubtype(v,G.type)?null:new Ko(v,E,G,M,D,$):null}evaluate(c){const f=this.input.evaluate(c);return(dr(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}}class dc{constructor(c,f,v){this.type=c,this.branches=f,this.otherwise=v}static parse(c,f){if(c.length<4)return f.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return f.error("Expected an odd number of arguments.");let v;f.expectedType&&f.expectedType.kind!=="value"&&(v=f.expectedType);const E=[];for(let D=1;D<c.length-1;D+=2){const G=f.parse(c[D],D,Jt);if(!G)return null;const $=f.parse(c[D+1],D+1,v);if(!$)return null;E.push([G,$]),v=v||$.type}const M=f.parse(c[c.length-1],c.length-1,v);if(!M)return null;if(!v)throw new Error("Can't infer output type");return new dc(v,E,M)}evaluate(c){for(const[f,v]of this.branches)if(f.evaluate(c))return v.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(const[f,v]of this.branches)c(f),c(v);c(this.otherwise)}outputDefined(){return this.branches.every(c=>{let[f,v]=c;return v.outputDefined()})&&this.otherwise.outputDefined()}}class Wo{constructor(c,f,v,E){this.type=c,this.input=f,this.beginIndex=v,this.endIndex=E}static parse(c,f){if(c.length<=2||c.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const v=f.parse(c[1],1,ze),E=f.parse(c[2],2,Gt);if(!v||!E)return null;if(!Oe(v.type,[ve(ze),vi,ze]))return f.error(`Expected first argument to be of type array or string, but found ${Ce(v.type)} instead`);if(c.length===4){const M=f.parse(c[3],3,Gt);return M?new Wo(v.type,v,E,M):null}return new Wo(v.type,v,E)}evaluate(c){const f=this.input.evaluate(c),v=this.beginIndex.evaluate(c);if(!Ge(f,["string","array"]))throw new Or(`Expected first argument to be of type array or string, but found ${Ce(dr(f))} instead.`);if(this.endIndex){const E=this.endIndex.evaluate(c);return f.slice(v,E)}return f.slice(v)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}}function Ao(h,c){return h==="=="||h==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function fc(h,c,f,v){return v.compare(c,f)===0}function Xo(h,c,f){const v=h!=="=="&&h!=="!=";return class hz{constructor(M,D,G){this.type=Jt,this.lhs=M,this.rhs=D,this.collator=G,this.hasUntypedArgument=M.type.kind==="value"||D.type.kind==="value"}static parse(M,D){if(M.length!==3&&M.length!==4)return D.error("Expected two or three arguments.");const G=M[0];let $=D.parse(M[1],1,ze);if(!$)return null;if(!Ao(G,$.type))return D.concat(1).error(`"${G}" comparisons are not supported for type '${Ce($.type)}'.`);let X=D.parse(M[2],2,ze);if(!X)return null;if(!Ao(G,X.type))return D.concat(2).error(`"${G}" comparisons are not supported for type '${Ce(X.type)}'.`);if($.type.kind!==X.type.kind&&$.type.kind!=="value"&&X.type.kind!=="value")return D.error(`Cannot compare types '${Ce($.type)}' and '${Ce(X.type)}'.`);v&&($.type.kind==="value"&&X.type.kind!=="value"?$=new An(X.type,[$]):$.type.kind!=="value"&&X.type.kind==="value"&&(X=new An($.type,[X])));let se=null;if(M.length===4){if($.type.kind!=="string"&&X.type.kind!=="string"&&$.type.kind!=="value"&&X.type.kind!=="value")return D.error("Cannot use collator to compare non-string types.");if(se=D.parse(M[3],3,we),!se)return null}return new hz($,X,se)}evaluate(M){const D=this.lhs.evaluate(M),G=this.rhs.evaluate(M);if(v&&this.hasUntypedArgument){const $=dr(D),X=dr(G);if($.kind!==X.kind||$.kind!=="string"&&$.kind!=="number")throw new Or(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${$.kind}, ${X.kind}) instead.`)}if(this.collator&&!v&&this.hasUntypedArgument){const $=dr(D),X=dr(G);if($.kind!=="string"||X.kind!=="string")return c(M,D,G)}return this.collator?f(M,D,G,this.collator.evaluate(M)):c(M,D,G)}eachChild(M){M(this.lhs),M(this.rhs),this.collator&&M(this.collator)}outputDefined(){return!0}}}const zl=Xo("==",function(h,c,f){return c===f},fc),Dc=Xo("!=",function(h,c,f){return c!==f},function(h,c,f,v){return!fc(0,c,f,v)}),vh=Xo("<",function(h,c,f){return c<f},function(h,c,f,v){return v.compare(c,f)<0}),lu=Xo(">",function(h,c,f){return c>f},function(h,c,f,v){return v.compare(c,f)>0}),cu=Xo("<=",function(h,c,f){return c<=f},function(h,c,f,v){return v.compare(c,f)<=0}),Ru=Xo(">=",function(h,c,f){return c>=f},function(h,c,f,v){return v.compare(c,f)>=0});class Ql{constructor(c,f,v,E,M){this.type=vi,this.number=c,this.locale=f,this.currency=v,this.minFractionDigits=E,this.maxFractionDigits=M}static parse(c,f){if(c.length!==3)return f.error("Expected two arguments.");const v=f.parse(c[1],1,Gt);if(!v)return null;const E=c[2];if(typeof E!="object"||Array.isArray(E))return f.error("NumberFormat options argument must be an object.");let M=null;if(E.locale&&(M=f.parse(E.locale,1,vi),!M))return null;let D=null;if(E.currency&&(D=f.parse(E.currency,1,vi),!D))return null;let G=null;if(E["min-fraction-digits"]&&(G=f.parse(E["min-fraction-digits"],1,Gt),!G))return null;let $=null;return E["max-fraction-digits"]&&($=f.parse(E["max-fraction-digits"],1,Gt),!$)?null:new Ql(v,M,D,G,$)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}}class Ya{constructor(c){this.type=oe,this.sections=c}static parse(c,f){if(c.length<2)return f.error("Expected at least one argument.");const v=c[1];if(!Array.isArray(v)&&typeof v=="object")return f.error("First argument must be an image or text section.");const E=[];let M=!1;for(let D=1;D<=c.length-1;++D){const G=c[D];if(M&&typeof G=="object"&&!Array.isArray(G)){M=!1;let $=null;if(G["font-scale"]&&($=f.parse(G["font-scale"],1,Gt),!$))return null;let X=null;if(G["text-font"]&&(X=f.parse(G["text-font"],1,ve(vi)),!X))return null;let se=null;if(G["text-color"]&&(se=f.parse(G["text-color"],1,mr),!se))return null;const Ae=E[E.length-1];Ae.scale=$,Ae.font=X,Ae.textColor=se}else{const $=f.parse(c[D],1,ze);if(!$)return null;const X=$.type.kind;if(X!=="string"&&X!=="value"&&X!=="null"&&X!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");M=!0,E.push({content:$,scale:null,font:null,textColor:null})}}return new Ya(E)}evaluate(c){return new Qr(this.sections.map(f=>{const v=f.content.evaluate(c);return dr(v)===le?new gs("",v,null,null,null):new gs(Fr(v),null,f.scale?f.scale.evaluate(c):null,f.font?f.font.evaluate(c).join(","):null,f.textColor?f.textColor.evaluate(c):null)}))}eachChild(c){for(const f of this.sections)c(f.content),f.scale&&c(f.scale),f.font&&c(f.font),f.textColor&&c(f.textColor)}outputDefined(){return!1}}class el{constructor(c){this.type=le,this.input=c}static parse(c,f){if(c.length!==2)return f.error("Expected two arguments.");const v=f.parse(c[1],1,vi);return v?new el(v):f.error("No image name provided.")}evaluate(c){const f=this.input.evaluate(c),v=Wi.fromString(f);return v&&c.availableImages&&(v.available=c.availableImages.indexOf(f)>-1),v}eachChild(c){c(this.input)}outputDefined(){return!1}}class Vl{constructor(c){this.type=Gt,this.input=c}static parse(c,f){if(c.length!==2)return f.error(`Expected 1 argument, but found ${c.length-1} instead.`);const v=f.parse(c[1],1);return v?v.type.kind!=="array"&&v.type.kind!=="string"&&v.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${Ce(v.type)} instead.`):new Vl(v):null}evaluate(c){const f=this.input.evaluate(c);if(typeof f=="string"||Array.isArray(f))return f.length;throw new Or(`Expected value to be of type string or array, but found ${Ce(dr(f))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}}const tl={"==":zl,"!=":Dc,">":lu,"<":vh,">=":Ru,"<=":cu,array:An,at:cl,boolean:An,case:dc,coalesce:Vr,collator:Ne,format:Ya,image:el,in:Nl,"index-of":Io,interpolate:dn,"interpolate-hcl":dn,"interpolate-lab":dn,length:Vl,let:Ja,literal:Hn,match:Ko,number:An,"number-format":Ql,object:An,slice:Wo,step:ho,string:An,"to-boolean":Gs,"to-color":Gs,"to-number":Gs,"to-string":Gs,var:Wa,within:To};function Aa(h,c){let[f,v,E,M]=c;f=f.evaluate(h),v=v.evaluate(h),E=E.evaluate(h);const D=M?M.evaluate(h):1,G=Ys(f,v,E,D);if(G)throw new Or(G);return new lr(f/255,v/255,E/255,D,!1)}function ul(h,c){return h in c}function Hl(h,c){const f=c[h];return f===void 0?null:f}function eo(h){return{type:h}}function da(h){return{result:"success",value:h}}function ne(h){return{result:"error",value:h}}function Ie(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function lt(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function mt(h){return!!h.expression&&h.expression.interpolated}function vt(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function Tt(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)}function pi(h){return h}function ri(h,c){const f=c.type==="color",v=h.stops&&typeof h.stops[0][0]=="object",E=v||!(v||h.property!==void 0),M=h.type||(mt(c)?"exponential":"interval");if(f||c.type==="padding"){const se=f?lr.parse:xn.parse;(h=Zi({},h)).stops&&(h.stops=h.stops.map(Ae=>[Ae[0],se(Ae[1])])),h.default=se(h.default?h.default:c.default)}if(h.colorSpace&&(D=h.colorSpace)!=="rgb"&&D!=="hcl"&&D!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var D;let G,$,X;if(M==="exponential")G=jr;else if(M==="interval")G=ki;else if(M==="categorical"){G=qi,$=Object.create(null);for(const se of h.stops)$[se[0]]=se[1];X=typeof h.stops[0][0]}else{if(M!=="identity")throw new Error(`Unknown function type "${M}"`);G=nr}if(v){const se={},Ae=[];for(let Te=0;Te<h.stops.length;Te++){const ke=h.stops[Te],je=ke[0].zoom;se[je]===void 0&&(se[je]={zoom:je,type:h.type,property:h.property,default:h.default,stops:[]},Ae.push(je)),se[je].stops.push([ke[0].value,ke[1]])}const me=[];for(const Te of Ae)me.push([se[Te].zoom,ri(se[Te],c)]);const Be={name:"linear"};return{kind:"composite",interpolationType:Be,interpolationFactor:dn.interpolationFactor.bind(void 0,Be),zoomStops:me.map(Te=>Te[0]),evaluate:(Te,ke)=>{let{zoom:je}=Te;return jr({stops:me,base:h.base},c,je).evaluate(je,ke)}}}if(E){const se=M==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:se,interpolationFactor:dn.interpolationFactor.bind(void 0,se),zoomStops:h.stops.map(Ae=>Ae[0]),evaluate:Ae=>{let{zoom:me}=Ae;return G(h,c,me,$,X)}}}return{kind:"source",evaluate(se,Ae){const me=Ae&&Ae.properties?Ae.properties[h.property]:void 0;return me===void 0?rr(h.default,c.default):G(h,c,me,$,X)}}}function rr(h,c,f){return h!==void 0?h:c!==void 0?c:f!==void 0?f:void 0}function qi(h,c,f,v,E){return rr(typeof f===E?v[f]:void 0,h.default,c.default)}function ki(h,c,f){if(vt(f)!=="number")return rr(h.default,c.default);const v=h.stops.length;if(v===1||f<=h.stops[0][0])return h.stops[0][1];if(f>=h.stops[v-1][0])return h.stops[v-1][1];const E=Za(h.stops.map(M=>M[0]),f);return h.stops[E][1]}function jr(h,c,f){const v=h.base!==void 0?h.base:1;if(vt(f)!=="number")return rr(h.default,c.default);const E=h.stops.length;if(E===1||f<=h.stops[0][0])return h.stops[0][1];if(f>=h.stops[E-1][0])return h.stops[E-1][1];const M=Za(h.stops.map(se=>se[0]),f),D=function(se,Ae,me,Be){const Te=Be-me,ke=se-me;return Te===0?0:Ae===1?ke/Te:(Math.pow(Ae,ke)-1)/(Math.pow(Ae,Te)-1)}(f,v,h.stops[M][0],h.stops[M+1][0]),G=h.stops[M][1],$=h.stops[M+1][1],X=hs[c.type]||pi;return typeof G.evaluate=="function"?{evaluate(){for(var se=arguments.length,Ae=new Array(se),me=0;me<se;me++)Ae[me]=arguments[me];const Be=G.evaluate.apply(void 0,Ae),Te=$.evaluate.apply(void 0,Ae);if(Be!==void 0&&Te!==void 0)return X(Be,Te,D,h.colorSpace)}}:X(G,$,D,h.colorSpace)}function nr(h,c,f){switch(c.type){case"color":f=lr.parse(f);break;case"formatted":f=Qr.fromString(f.toString());break;case"resolvedImage":f=Wi.fromString(f.toString());break;case"padding":f=xn.parse(f);break;default:vt(f)===c.type||c.type==="enum"&&c.values[f]||(f=void 0)}return rr(f,h.default,c.default)}ms.register(tl,{error:[{kind:"error"},[vi],(h,c)=>{let[f]=c;throw new Or(f.evaluate(h))}],typeof:[vi,[ze],(h,c)=>{let[f]=c;return Ce(dr(f.evaluate(h)))}],"to-rgba":[ve(Gt,4),[mr],(h,c)=>{let[f]=c;const[v,E,M,D]=f.evaluate(h).rgb;return[255*v,255*E,255*M,D]}],rgb:[mr,[Gt,Gt,Gt],Aa],rgba:[mr,[Gt,Gt,Gt,Gt],Aa],has:{type:Jt,overloads:[[[vi],(h,c)=>{let[f]=c;return ul(f.evaluate(h),h.properties())}],[[vi,Sr],(h,c)=>{let[f,v]=c;return ul(f.evaluate(h),v.evaluate(h))}]]},get:{type:ze,overloads:[[[vi],(h,c)=>{let[f]=c;return Hl(f.evaluate(h),h.properties())}],[[vi,Sr],(h,c)=>{let[f,v]=c;return Hl(f.evaluate(h),v.evaluate(h))}]]},"feature-state":[ze,[vi],(h,c)=>{let[f]=c;return Hl(f.evaluate(h),h.featureState||{})}],properties:[Sr,[],h=>h.properties()],"geometry-type":[vi,[],h=>h.geometryType()],id:[ze,[],h=>h.id()],zoom:[Gt,[],h=>h.globals.zoom],"heatmap-density":[Gt,[],h=>h.globals.heatmapDensity||0],"line-progress":[Gt,[],h=>h.globals.lineProgress||0],accumulated:[ze,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[Gt,eo(Gt),(h,c)=>{let f=0;for(const v of c)f+=v.evaluate(h);return f}],"*":[Gt,eo(Gt),(h,c)=>{let f=1;for(const v of c)f*=v.evaluate(h);return f}],"-":{type:Gt,overloads:[[[Gt,Gt],(h,c)=>{let[f,v]=c;return f.evaluate(h)-v.evaluate(h)}],[[Gt],(h,c)=>{let[f]=c;return-f.evaluate(h)}]]},"/":[Gt,[Gt,Gt],(h,c)=>{let[f,v]=c;return f.evaluate(h)/v.evaluate(h)}],"%":[Gt,[Gt,Gt],(h,c)=>{let[f,v]=c;return f.evaluate(h)%v.evaluate(h)}],ln2:[Gt,[],()=>Math.LN2],pi:[Gt,[],()=>Math.PI],e:[Gt,[],()=>Math.E],"^":[Gt,[Gt,Gt],(h,c)=>{let[f,v]=c;return Math.pow(f.evaluate(h),v.evaluate(h))}],sqrt:[Gt,[Gt],(h,c)=>{let[f]=c;return Math.sqrt(f.evaluate(h))}],log10:[Gt,[Gt],(h,c)=>{let[f]=c;return Math.log(f.evaluate(h))/Math.LN10}],ln:[Gt,[Gt],(h,c)=>{let[f]=c;return Math.log(f.evaluate(h))}],log2:[Gt,[Gt],(h,c)=>{let[f]=c;return Math.log(f.evaluate(h))/Math.LN2}],sin:[Gt,[Gt],(h,c)=>{let[f]=c;return Math.sin(f.evaluate(h))}],cos:[Gt,[Gt],(h,c)=>{let[f]=c;return Math.cos(f.evaluate(h))}],tan:[Gt,[Gt],(h,c)=>{let[f]=c;return Math.tan(f.evaluate(h))}],asin:[Gt,[Gt],(h,c)=>{let[f]=c;return Math.asin(f.evaluate(h))}],acos:[Gt,[Gt],(h,c)=>{let[f]=c;return Math.acos(f.evaluate(h))}],atan:[Gt,[Gt],(h,c)=>{let[f]=c;return Math.atan(f.evaluate(h))}],min:[Gt,eo(Gt),(h,c)=>Math.min(...c.map(f=>f.evaluate(h)))],max:[Gt,eo(Gt),(h,c)=>Math.max(...c.map(f=>f.evaluate(h)))],abs:[Gt,[Gt],(h,c)=>{let[f]=c;return Math.abs(f.evaluate(h))}],round:[Gt,[Gt],(h,c)=>{let[f]=c;const v=f.evaluate(h);return v<0?-Math.round(-v):Math.round(v)}],floor:[Gt,[Gt],(h,c)=>{let[f]=c;return Math.floor(f.evaluate(h))}],ceil:[Gt,[Gt],(h,c)=>{let[f]=c;return Math.ceil(f.evaluate(h))}],"filter-==":[Jt,[vi,ze],(h,c)=>{let[f,v]=c;return h.properties()[f.value]===v.value}],"filter-id-==":[Jt,[ze],(h,c)=>{let[f]=c;return h.id()===f.value}],"filter-type-==":[Jt,[vi],(h,c)=>{let[f]=c;return h.geometryType()===f.value}],"filter-<":[Jt,[vi,ze],(h,c)=>{let[f,v]=c;const E=h.properties()[f.value],M=v.value;return typeof E==typeof M&&E<M}],"filter-id-<":[Jt,[ze],(h,c)=>{let[f]=c;const v=h.id(),E=f.value;return typeof v==typeof E&&v<E}],"filter->":[Jt,[vi,ze],(h,c)=>{let[f,v]=c;const E=h.properties()[f.value],M=v.value;return typeof E==typeof M&&E>M}],"filter-id->":[Jt,[ze],(h,c)=>{let[f]=c;const v=h.id(),E=f.value;return typeof v==typeof E&&v>E}],"filter-<=":[Jt,[vi,ze],(h,c)=>{let[f,v]=c;const E=h.properties()[f.value],M=v.value;return typeof E==typeof M&&E<=M}],"filter-id-<=":[Jt,[ze],(h,c)=>{let[f]=c;const v=h.id(),E=f.value;return typeof v==typeof E&&v<=E}],"filter->=":[Jt,[vi,ze],(h,c)=>{let[f,v]=c;const E=h.properties()[f.value],M=v.value;return typeof E==typeof M&&E>=M}],"filter-id->=":[Jt,[ze],(h,c)=>{let[f]=c;const v=h.id(),E=f.value;return typeof v==typeof E&&v>=E}],"filter-has":[Jt,[ze],(h,c)=>{let[f]=c;return f.value in h.properties()}],"filter-has-id":[Jt,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[Jt,[ve(vi)],(h,c)=>{let[f]=c;return f.value.indexOf(h.geometryType())>=0}],"filter-id-in":[Jt,[ve(ze)],(h,c)=>{let[f]=c;return f.value.indexOf(h.id())>=0}],"filter-in-small":[Jt,[vi,ve(ze)],(h,c)=>{let[f,v]=c;return v.value.indexOf(h.properties()[f.value])>=0}],"filter-in-large":[Jt,[vi,ve(ze)],(h,c)=>{let[f,v]=c;return function(E,M,D,G){for(;D<=G;){const $=D+G>>1;if(M[$]===E)return!0;M[$]>E?G=$-1:D=$+1}return!1}(h.properties()[f.value],v.value,0,v.value.length-1)}],all:{type:Jt,overloads:[[[Jt,Jt],(h,c)=>{let[f,v]=c;return f.evaluate(h)&&v.evaluate(h)}],[eo(Jt),(h,c)=>{for(const f of c)if(!f.evaluate(h))return!1;return!0}]]},any:{type:Jt,overloads:[[[Jt,Jt],(h,c)=>{let[f,v]=c;return f.evaluate(h)||v.evaluate(h)}],[eo(Jt),(h,c)=>{for(const f of c)if(f.evaluate(h))return!0;return!1}]]},"!":[Jt,[Jt],(h,c)=>{let[f]=c;return!f.evaluate(h)}],"is-supported-script":[Jt,[vi],(h,c)=>{let[f]=c;const v=h.globals&&h.globals.isSupportedScript;return!v||v(f.evaluate(h))}],upcase:[vi,[vi],(h,c)=>{let[f]=c;return f.evaluate(h).toUpperCase()}],downcase:[vi,[vi],(h,c)=>{let[f]=c;return f.evaluate(h).toLowerCase()}],concat:[vi,eo(ze),(h,c)=>c.map(f=>Fr(f.evaluate(h))).join("")],"resolved-locale":[vi,[we],(h,c)=>{let[f]=c;return f.evaluate(h).resolvedLocale()}]});class Gn{constructor(c,f){var v;this.expression=c,this._warningHistory={},this._evaluator=new uo,this._defaultValue=f?(v=f).type==="color"&&Tt(v.default)?new lr(0,0,0,0):v.type==="color"?lr.parse(v.default)||null:v.type==="padding"?xn.parse(v.default)||null:v.type==="variableAnchorOffsetCollection"?us.parse(v.default)||null:v.default===void 0?null:v.default:null,this._enumValues=f&&f.type==="enum"?f.values:null}evaluateWithoutErrorHandling(c,f,v,E,M,D){return this._evaluator.globals=c,this._evaluator.feature=f,this._evaluator.featureState=v,this._evaluator.canonical=E,this._evaluator.availableImages=M||null,this._evaluator.formattedSection=D,this.expression.evaluate(this._evaluator)}evaluate(c,f,v,E,M,D){this._evaluator.globals=c,this._evaluator.feature=f||null,this._evaluator.featureState=v||null,this._evaluator.canonical=E,this._evaluator.availableImages=M||null,this._evaluator.formattedSection=D||null;try{const G=this.expression.evaluate(this._evaluator);if(G==null||typeof G=="number"&&G!=G)return this._defaultValue;if(this._enumValues&&!(G in this._enumValues))throw new Or(`Expected value to be one of ${Object.keys(this._enumValues).map($=>JSON.stringify($)).join(", ")}, but found ${JSON.stringify(G)} instead.`);return G}catch(G){return this._warningHistory[G.message]||(this._warningHistory[G.message]=!0,typeof console<"u"&&console.warn(G.message)),this._defaultValue}}}function Br(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in tl}function Lr(h,c){const f=new Ea(tl,ua,[],c?function(E){const M={color:mr,string:vi,number:Gt,enum:vi,boolean:Jt,formatted:oe,padding:ee,resolvedImage:le,variableAnchorOffsetCollection:ge};return E.type==="array"?ve(M[E.value]||ze,E.length):M[E.type]}(c):void 0),v=f.parse(h,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?da(new Gn(v,c)):ne(f.errors)}class Un{constructor(c,f){this.kind=c,this._styleExpression=f,this.isStateDependent=c!=="constant"&&!Sa(f.expression)}evaluateWithoutErrorHandling(c,f,v,E,M,D){return this._styleExpression.evaluateWithoutErrorHandling(c,f,v,E,M,D)}evaluate(c,f,v,E,M,D){return this._styleExpression.evaluate(c,f,v,E,M,D)}}class $s{constructor(c,f,v,E){this.kind=c,this.zoomStops=v,this._styleExpression=f,this.isStateDependent=c!=="camera"&&!Sa(f.expression),this.interpolationType=E}evaluateWithoutErrorHandling(c,f,v,E,M,D){return this._styleExpression.evaluateWithoutErrorHandling(c,f,v,E,M,D)}evaluate(c,f,v,E,M,D){return this._styleExpression.evaluate(c,f,v,E,M,D)}interpolationFactor(c,f,v){return this.interpolationType?dn.interpolationFactor(this.interpolationType,c,f,v):0}}function to(h,c){const f=Lr(h,c);if(f.result==="error")return f;const v=f.value.expression,E=Xa(v);if(!E&&!Ie(c))return ne([new Qt("","data expressions not supported")]);const M=Fc(v,["zoom"]);if(!M&&!lt(c))return ne([new Qt("","zoom expressions not supported")]);const D=Ta(v);return D||M?D instanceof Qt?ne([D]):D instanceof dn&&!mt(c)?ne([new Qt("",'"interpolate" expressions cannot be used with this property')]):da(D?new $s(E?"camera":"composite",f.value,D.labels,D instanceof dn?D.interpolation:void 0):new Un(E?"constant":"source",f.value)):ne([new Qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Lo{constructor(c,f){this._parameters=c,this._specification=f,Zi(this,ri(this._parameters,this._specification))}static deserialize(c){return new Lo(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function Ta(h){let c=null;if(h instanceof Ja)c=Ta(h.result);else if(h instanceof Vr){for(const f of h.args)if(c=Ta(f),c)break}else(h instanceof ho||h instanceof dn)&&h.input instanceof ms&&h.input.name==="zoom"&&(c=h);return c instanceof Qt||h.eachChild(f=>{const v=Ta(f);v instanceof Qt?c=v:!c&&v?c=new Qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):c&&v&&c!==v&&(c=new Qt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),c}function fa(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const c of h.slice(1))if(!fa(c)&&typeof c!="boolean")return!1;return!0;default:return!0}}const Gl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function hl(h){if(h==null)return{filter:()=>!0,needGeometry:!1};fa(h)||(h=pa(h));const c=Lr(h,Gl);if(c.result==="error")throw new Error(c.value.map(f=>`${f.key}: ${f.message}`).join(", "));return{filter:(f,v,E)=>c.value.evaluate(f,v,{},E),needGeometry:pc(h)}}function jl(h,c){return h<c?-1:h>c?1:0}function pc(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(let c=1;c<h.length;c++)if(pc(h[c]))return!0;return!1}function pa(h){if(!h)return!0;const c=h[0];return h.length<=1?c!=="any":c==="=="?Fs(h[1],h[2],"=="):c==="!="?Ia(Fs(h[1],h[2],"==")):c==="<"||c===">"||c==="<="||c===">="?Fs(h[1],h[2],c):c==="any"?(f=h.slice(1),["any"].concat(f.map(pa))):c==="all"?["all"].concat(h.slice(1).map(pa)):c==="none"?["all"].concat(h.slice(1).map(pa).map(Ia)):c==="in"?Al(h[1],h.slice(2)):c==="!in"?Ia(Al(h[1],h.slice(2))):c==="has"?ql(h[1]):c==="!has"?Ia(ql(h[1])):c!=="within"||h;var f}function Fs(h,c,f){switch(h){case"$type":return[`filter-type-${f}`,c];case"$id":return[`filter-id-${f}`,c];default:return[`filter-${f}`,h,c]}}function Al(h,c){if(c.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some(f=>typeof f!=typeof c[0])?["filter-in-large",h,["literal",c.sort(jl)]]:["filter-in-small",h,["literal",c]]}}function ql(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function Ia(h){return["!",h]}function La(h){const c=typeof h;if(c==="number"||c==="boolean"||c==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let E="[";for(const M of h)E+=`${La(M)},`;return`${E}]`}const f=Object.keys(h).sort();let v="{";for(let E=0;E<f.length;E++)v+=`${JSON.stringify(f[E])}:${La(h[f[E]])},`;return`${v}}`}function Ds(h){let c="";for(const f of jt)c+=`/${La(h[f])}`;return c}function ku(h){const c=h.value;return c?[new $t(h.key,c,"constants have been deprecated as of v8")]:[]}function Sn(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function on(h){if(Array.isArray(h))return h.map(on);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const c={};for(const f in h)c[f]=on(h[f]);return c}return Sn(h)}function fn(h){const c=h.key,f=h.value,v=h.valueSpec||{},E=h.objectElementValidators||{},M=h.style,D=h.styleSpec,G=h.validateSpec;let $=[];const X=vt(f);if(X!=="object")return[new $t(c,f,`object expected, ${X} found`)];for(const se in f){const Ae=se.split(".")[0],me=v[Ae]||v["*"];let Be;if(E[Ae])Be=E[Ae];else if(v[Ae])Be=G;else if(E["*"])Be=E["*"];else{if(!v["*"]){$.push(new $t(c,f[se],`unknown property "${se}"`));continue}Be=G}$=$.concat(Be({key:(c&&`${c}.`)+se,value:f[se],valueSpec:me,style:M,styleSpec:D,object:f,objectKey:se,validateSpec:G},f))}for(const se in v)E[se]||v[se].required&&v[se].default===void 0&&f[se]===void 0&&$.push(new $t(c,f,`missing required property "${se}"`));return $}function es(h){const c=h.value,f=h.valueSpec,v=h.style,E=h.styleSpec,M=h.key,D=h.arrayElementValidator||h.validateSpec;if(vt(c)!=="array")return[new $t(M,c,`array expected, ${vt(c)} found`)];if(f.length&&c.length!==f.length)return[new $t(M,c,`array length ${f.length} expected, length ${c.length} found`)];if(f["min-length"]&&c.length<f["min-length"])return[new $t(M,c,`array length at least ${f["min-length"]} expected, length ${c.length} found`)];let G={type:f.value,values:f.values};E.$version<7&&(G.function=f.function),vt(f.value)==="object"&&(G=f.value);let $=[];for(let X=0;X<c.length;X++)$=$.concat(D({array:c,arrayIndex:X,value:c[X],valueSpec:G,validateSpec:h.validateSpec,style:v,styleSpec:E,key:`${M}[${X}]`}));return $}function dl(h){const c=h.key,f=h.value,v=h.valueSpec;let E=vt(f);return E==="number"&&f!=f&&(E="NaN"),E!=="number"?[new $t(c,f,`number expected, ${E} found`)]:"minimum"in v&&f<v.minimum?[new $t(c,f,`${f} is less than the minimum value ${v.minimum}`)]:"maximum"in v&&f>v.maximum?[new $t(c,f,`${f} is greater than the maximum value ${v.maximum}`)]:[]}function fl(h){const c=h.valueSpec,f=Sn(h.value.type);let v,E,M,D={};const G=f!=="categorical"&&h.value.property===void 0,$=!G,X=vt(h.value.stops)==="array"&&vt(h.value.stops[0])==="array"&&vt(h.value.stops[0][0])==="object",se=fn({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(Be){if(f==="identity")return[new $t(Be.key,Be.value,'identity function may not have a "stops" property')];let Te=[];const ke=Be.value;return Te=Te.concat(es({key:Be.key,value:ke,valueSpec:Be.valueSpec,validateSpec:Be.validateSpec,style:Be.style,styleSpec:Be.styleSpec,arrayElementValidator:Ae})),vt(ke)==="array"&&ke.length===0&&Te.push(new $t(Be.key,ke,"array must have at least one stop")),Te},default:function(Be){return Be.validateSpec({key:Be.key,value:Be.value,valueSpec:c,validateSpec:Be.validateSpec,style:Be.style,styleSpec:Be.styleSpec})}}});return f==="identity"&&G&&se.push(new $t(h.key,h.value,'missing required property "property"')),f==="identity"||h.value.stops||se.push(new $t(h.key,h.value,'missing required property "stops"')),f==="exponential"&&h.valueSpec.expression&&!mt(h.valueSpec)&&se.push(new $t(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&($&&!Ie(h.valueSpec)?se.push(new $t(h.key,h.value,"property functions not supported")):G&&!lt(h.valueSpec)&&se.push(new $t(h.key,h.value,"zoom functions not supported"))),f!=="categorical"&&!X||h.value.property!==void 0||se.push(new $t(h.key,h.value,'"property" property is required')),se;function Ae(Be){let Te=[];const ke=Be.value,je=Be.key;if(vt(ke)!=="array")return[new $t(je,ke,`array expected, ${vt(ke)} found`)];if(ke.length!==2)return[new $t(je,ke,`array length 2 expected, length ${ke.length} found`)];if(X){if(vt(ke[0])!=="object")return[new $t(je,ke,`object expected, ${vt(ke[0])} found`)];if(ke[0].zoom===void 0)return[new $t(je,ke,"object stop key must have zoom")];if(ke[0].value===void 0)return[new $t(je,ke,"object stop key must have value")];if(M&&M>Sn(ke[0].zoom))return[new $t(je,ke[0].zoom,"stop zoom values must appear in ascending order")];Sn(ke[0].zoom)!==M&&(M=Sn(ke[0].zoom),E=void 0,D={}),Te=Te.concat(fn({key:`${je}[0]`,value:ke[0],valueSpec:{zoom:{}},validateSpec:Be.validateSpec,style:Be.style,styleSpec:Be.styleSpec,objectElementValidators:{zoom:dl,value:me}}))}else Te=Te.concat(me({key:`${je}[0]`,value:ke[0],valueSpec:{},validateSpec:Be.validateSpec,style:Be.style,styleSpec:Be.styleSpec},ke));return Br(on(ke[1]))?Te.concat([new $t(`${je}[1]`,ke[1],"expressions are not allowed in function stops.")]):Te.concat(Be.validateSpec({key:`${je}[1]`,value:ke[1],valueSpec:c,validateSpec:Be.validateSpec,style:Be.style,styleSpec:Be.styleSpec}))}function me(Be,Te){const ke=vt(Be.value),je=Sn(Be.value),$e=Be.value!==null?Be.value:Te;if(v){if(ke!==v)return[new $t(Be.key,$e,`${ke} stop domain type must match previous stop domain type ${v}`)]}else v=ke;if(ke!=="number"&&ke!=="string"&&ke!=="boolean")return[new $t(Be.key,$e,"stop domain value must be a number, string, or boolean")];if(ke!=="number"&&f!=="categorical"){let ct=`number expected, ${ke} found`;return Ie(c)&&f===void 0&&(ct+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $t(Be.key,$e,ct)]}return f!=="categorical"||ke!=="number"||isFinite(je)&&Math.floor(je)===je?f!=="categorical"&&ke==="number"&&E!==void 0&&je<E?[new $t(Be.key,$e,"stop domain values must appear in ascending order")]:(E=je,f==="categorical"&&je in D?[new $t(Be.key,$e,"stop domain values must be unique")]:(D[je]=!0,[])):[new $t(Be.key,$e,`integer expected, found ${je}`)]}}function fo(h){const c=(h.expressionContext==="property"?to:Lr)(on(h.value),h.valueSpec);if(c.result==="error")return c.value.map(v=>new $t(`${h.key}${v.key}`,h.value,v.message));const f=c.value.expression||c.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!f.outputDefined())return[new $t(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!Sa(f))return[new $t(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!Sa(f))return[new $t(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!Fc(f,["zoom","feature-state"]))return[new $t(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!Xa(f))return[new $t(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ss(h){const c=h.key,f=h.value,v=h.valueSpec,E=[];return Array.isArray(v.values)?v.values.indexOf(Sn(f))===-1&&E.push(new $t(c,f,`expected one of [${v.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(v.values).indexOf(Sn(f))===-1&&E.push(new $t(c,f,`expected one of [${Object.keys(v.values).join(", ")}], ${JSON.stringify(f)} found`)),E}function os(h){return fa(on(h.value))?fo(Zi({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Mo(h)}function Mo(h){const c=h.value,f=h.key;if(vt(c)!=="array")return[new $t(f,c,`array expected, ${vt(c)} found`)];const v=h.styleSpec;let E,M=[];if(c.length<1)return[new $t(f,c,"filter array must have at least 1 element")];switch(M=M.concat(ss({key:`${f}[0]`,value:c[0],valueSpec:v.filter_operator,style:h.style,styleSpec:h.styleSpec})),Sn(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&Sn(c[1])==="$type"&&M.push(new $t(f,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&M.push(new $t(f,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(E=vt(c[1]),E!=="string"&&M.push(new $t(`${f}[1]`,c[1],`string expected, ${E} found`)));for(let D=2;D<c.length;D++)E=vt(c[D]),Sn(c[1])==="$type"?M=M.concat(ss({key:`${f}[${D}]`,value:c[D],valueSpec:v.geometry_type,style:h.style,styleSpec:h.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&M.push(new $t(`${f}[${D}]`,c[D],`string, number, or boolean expected, ${E} found`));break;case"any":case"all":case"none":for(let D=1;D<c.length;D++)M=M.concat(Mo({key:`${f}[${D}]`,value:c[D],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":E=vt(c[1]),c.length!==2?M.push(new $t(f,c,`filter array for "${c[0]}" operator must have 2 elements`)):E!=="string"&&M.push(new $t(`${f}[1]`,c[1],`string expected, ${E} found`));break;case"within":E=vt(c[1]),c.length!==2?M.push(new $t(f,c,`filter array for "${c[0]}" operator must have 2 elements`)):E!=="object"&&M.push(new $t(`${f}[1]`,c[1],`object expected, ${E} found`))}return M}function Po(h,c){const f=h.key,v=h.validateSpec,E=h.style,M=h.styleSpec,D=h.value,G=h.objectKey,$=M[`${c}_${h.layerType}`];if(!$)return[];const X=G.match(/^(.*)-transition$/);if(c==="paint"&&X&&$[X[1]]&&$[X[1]].transition)return v({key:f,value:D,valueSpec:M.transition,style:E,styleSpec:M});const se=h.valueSpec||$[G];if(!se)return[new $t(f,D,`unknown property "${G}"`)];let Ae;if(vt(D)==="string"&&Ie(se)&&!se.tokens&&(Ae=/^{([^}]+)}$/.exec(D)))return[new $t(f,D,`"${G}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Ae[1])} }\`.`)];const me=[];return h.layerType==="symbol"&&(G==="text-field"&&E&&!E.glyphs&&me.push(new $t(f,D,'use of "text-field" requires a style "glyphs" property')),G==="text-font"&&Tt(on(D))&&Sn(D.type)==="identity"&&me.push(new $t(f,D,'"text-font" does not support identity functions'))),me.concat(v({key:h.key,value:D,valueSpec:se,style:E,styleSpec:M,expressionContext:"property",propertyType:c,propertyKey:G}))}function ga(h){return Po(h,"paint")}function pl(h){return Po(h,"layout")}function io(h){let c=[];const f=h.value,v=h.key,E=h.style,M=h.styleSpec;f.type||f.ref||c.push(new $t(v,f,'either "type" or "ref" is required'));let D=Sn(f.type);const G=Sn(f.ref);if(f.id){const $=Sn(f.id);for(let X=0;X<h.arrayIndex;X++){const se=E.layers[X];Sn(se.id)===$&&c.push(new $t(v,f.id,`duplicate layer id "${f.id}", previously used at line ${se.id.__line__}`))}}if("ref"in f){let $;["type","source","source-layer","filter","layout"].forEach(X=>{X in f&&c.push(new $t(v,f[X],`"${X}" is prohibited for ref layers`))}),E.layers.forEach(X=>{Sn(X.id)===G&&($=X)}),$?$.ref?c.push(new $t(v,f.ref,"ref cannot reference another ref layer")):D=Sn($.type):c.push(new $t(v,f.ref,`ref layer "${G}" not found`))}else if(D!=="background")if(f.source){const $=E.sources&&E.sources[f.source],X=$&&Sn($.type);$?X==="vector"&&D==="raster"?c.push(new $t(v,f.source,`layer "${f.id}" requires a raster source`)):X!=="raster-dem"&&D==="hillshade"?c.push(new $t(v,f.source,`layer "${f.id}" requires a raster-dem source`)):X==="raster"&&D!=="raster"?c.push(new $t(v,f.source,`layer "${f.id}" requires a vector source`)):X!=="vector"||f["source-layer"]?X==="raster-dem"&&D!=="hillshade"?c.push(new $t(v,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="line"||!f.paint||!f.paint["line-gradient"]||X==="geojson"&&$.lineMetrics||c.push(new $t(v,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new $t(v,f,`layer "${f.id}" must specify a "source-layer"`)):c.push(new $t(v,f.source,`source "${f.source}" not found`))}else c.push(new $t(v,f,'missing required property "source"'));return c=c.concat(fn({key:v,value:f,valueSpec:M.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${v}.type`,value:f.type,valueSpec:M.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:f,objectKey:"type"}),filter:os,layout:$=>fn({layer:f,key:$.key,value:$.value,style:$.style,styleSpec:$.styleSpec,validateSpec:$.validateSpec,objectElementValidators:{"*":X=>pl(Zi({layerType:D},X))}}),paint:$=>fn({layer:f,key:$.key,value:$.value,style:$.style,styleSpec:$.styleSpec,validateSpec:$.validateSpec,objectElementValidators:{"*":X=>ga(Zi({layerType:D},X))}})}})),c}function ro(h){const c=h.value,f=h.key,v=vt(c);return v!=="string"?[new $t(f,c,`string expected, ${v} found`)]:[]}const po={promoteId:function(h){let{key:c,value:f}=h;if(vt(f)==="string")return ro({key:c,value:f});{const v=[];for(const E in f)v.push(...ro({key:`${c}.${E}`,value:f[E]}));return v}}};function ys(h){const c=h.value,f=h.key,v=h.styleSpec,E=h.style,M=h.validateSpec;if(!c.type)return[new $t(f,c,'"type" is required')];const D=Sn(c.type);let G;switch(D){case"vector":case"raster":return G=fn({key:f,value:c,valueSpec:v[`source_${D.replace("-","_")}`],style:h.style,styleSpec:v,objectElementValidators:po,validateSpec:M}),G;case"raster-dem":return G=function($){var X;const se=(X=$.sourceName)!==null&&X!==void 0?X:"",Ae=$.value,me=$.styleSpec,Be=me.source_raster_dem,Te=$.style;let ke=[];const je=vt(Ae);if(Ae===void 0)return ke;if(je!=="object")return ke.push(new $t("source_raster_dem",Ae,`object expected, ${je} found`)),ke;const $e=Sn(Ae.encoding)==="custom",ct=["redFactor","greenFactor","blueFactor","baseShift"],Ye=$.value.encoding?`"${$.value.encoding}"`:"Default";for(const tt in Ae)!$e&&ct.includes(tt)?ke.push(new $t(tt,Ae[tt],`In "${se}": "${tt}" is only valid when "encoding" is set to "custom". ${Ye} encoding found`)):Be[tt]?ke=ke.concat($.validateSpec({key:tt,value:Ae[tt],valueSpec:Be[tt],validateSpec:$.validateSpec,style:Te,styleSpec:me})):ke.push(new $t(tt,Ae[tt],`unknown property "${tt}"`));return ke}({sourceName:f,value:c,style:h.style,styleSpec:v,validateSpec:M}),G;case"geojson":if(G=fn({key:f,value:c,valueSpec:v.source_geojson,style:E,styleSpec:v,validateSpec:M,objectElementValidators:po}),c.cluster)for(const $ in c.clusterProperties){const[X,se]=c.clusterProperties[$],Ae=typeof X=="string"?[X,["accumulated"],["get",$]]:X;G.push(...fo({key:`${f}.${$}.map`,value:se,validateSpec:M,expressionContext:"cluster-map"})),G.push(...fo({key:`${f}.${$}.reduce`,value:Ae,validateSpec:M,expressionContext:"cluster-reduce"}))}return G;case"video":return fn({key:f,value:c,valueSpec:v.source_video,style:E,validateSpec:M,styleSpec:v});case"image":return fn({key:f,value:c,valueSpec:v.source_image,style:E,validateSpec:M,styleSpec:v});case"canvas":return[new $t(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ss({key:`${f}.type`,value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:E,validateSpec:M,styleSpec:v})}}function no(h){const c=h.value,f=h.styleSpec,v=f.light,E=h.style;let M=[];const D=vt(c);if(c===void 0)return M;if(D!=="object")return M=M.concat([new $t("light",c,`object expected, ${D} found`)]),M;for(const G in c){const $=G.match(/^(.*)-transition$/);M=M.concat($&&v[$[1]]&&v[$[1]].transition?h.validateSpec({key:G,value:c[G],valueSpec:f.transition,validateSpec:h.validateSpec,style:E,styleSpec:f}):v[G]?h.validateSpec({key:G,value:c[G],valueSpec:v[G],validateSpec:h.validateSpec,style:E,styleSpec:f}):[new $t(G,c[G],`unknown property "${G}"`)])}return M}function Ma(h){const c=h.value,f=h.styleSpec,v=f.terrain,E=h.style;let M=[];const D=vt(c);if(c===void 0)return M;if(D!=="object")return M=M.concat([new $t("terrain",c,`object expected, ${D} found`)]),M;for(const G in c)M=M.concat(v[G]?h.validateSpec({key:G,value:c[G],valueSpec:v[G],validateSpec:h.validateSpec,style:E,styleSpec:f}):[new $t(G,c[G],`unknown property "${G}"`)]);return M}function ma(h){let c=[];const f=h.value,v=h.key;if(Array.isArray(f)){const E=[],M=[];for(const D in f)f[D].id&&E.includes(f[D].id)&&c.push(new $t(v,f,`all the sprites' ids must be unique, but ${f[D].id} is duplicated`)),E.push(f[D].id),f[D].url&&M.includes(f[D].url)&&c.push(new $t(v,f,`all the sprites' URLs must be unique, but ${f[D].url} is duplicated`)),M.push(f[D].url),c=c.concat(fn({key:`${v}[${D}]`,value:f[D],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return c}return ro({key:v,value:f})}const Pa={"*":()=>[],array:es,boolean:function(h){const c=h.value,f=h.key,v=vt(c);return v!=="boolean"?[new $t(f,c,`boolean expected, ${v} found`)]:[]},number:dl,color:function(h){const c=h.key,f=h.value,v=vt(f);return v!=="string"?[new $t(c,f,`color expected, ${v} found`)]:lr.parse(String(f))?[]:[new $t(c,f,`color expected, "${f}" found`)]},constants:ku,enum:ss,filter:os,function:fl,layer:io,object:fn,source:ys,light:no,terrain:Ma,string:ro,formatted:function(h){return ro(h).length===0?[]:fo(h)},resolvedImage:function(h){return ro(h).length===0?[]:fo(h)},padding:function(h){const c=h.key,f=h.value;if(vt(f)==="array"){if(f.length<1||f.length>4)return[new $t(c,f,`padding requires 1 to 4 values; ${f.length} values found`)];const v={type:"number"};let E=[];for(let M=0;M<f.length;M++)E=E.concat(h.validateSpec({key:`${c}[${M}]`,value:f[M],validateSpec:h.validateSpec,valueSpec:v}));return E}return dl({key:c,value:f,valueSpec:{}})},variableAnchorOffsetCollection:function(h){const c=h.key,f=h.value,v=vt(f),E=h.styleSpec;if(v!=="array"||f.length<1||f.length%2!=0)return[new $t(c,f,"variableAnchorOffsetCollection requires a non-empty array of even length")];let M=[];for(let D=0;D<f.length;D+=2)M=M.concat(ss({key:`${c}[${D}]`,value:f[D],valueSpec:E.layout_symbol["text-anchor"]})),M=M.concat(es({key:`${c}[${D+1}]`,value:f[D+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:E}));return M},sprite:ma};function Tn(h){const c=h.value,f=h.valueSpec,v=h.styleSpec;return h.validateSpec=Tn,f.expression&&Tt(Sn(c))?fl(h):f.expression&&Br(on(c))?fo(h):f.type&&Pa[f.type]?Pa[f.type](h):fn(Zi({},h,{valueSpec:f.type?v[f.type]:f}))}function Fo(h){const c=h.value,f=h.key,v=ro(h);return v.length||(c.indexOf("{fontstack}")===-1&&v.push(new $t(f,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&v.push(new $t(f,c,'"glyphs" url must include a "{range}" token'))),v}function As(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ut,f=[];return f=f.concat(Tn({key:"",value:h,valueSpec:c.$root,styleSpec:c,style:h,validateSpec:Tn,objectElementValidators:{glyphs:Fo,"*":()=>[]}})),h.constants&&(f=f.concat(ku({key:"constants",value:h.constants,style:h,styleSpec:c,validateSpec:Tn}))),ds(f)}function _s(h){return function(c){return h({...c,validateSpec:Tn})}}function ds(h){return[].concat(h).sort((c,f)=>c.line-f.line)}function Ir(h){return function(){for(var c=arguments.length,f=new Array(c),v=0;v<c;v++)f[v]=arguments[v];return ds(h.apply(this,f))}}As.source=Ir(_s(ys)),As.sprite=Ir(_s(ma)),As.glyphs=Ir(_s(Fo)),As.light=Ir(_s(no)),As.terrain=Ir(_s(Ma)),As.layer=Ir(_s(io)),As.filter=Ir(_s(os)),As.paintProperty=Ir(_s(ga)),As.layoutProperty=Ir(_s(pl));const Zr=As,an=Zr.light,jn=Zr.paintProperty,ya=Zr.layoutProperty;function Fa(h,c){let f=!1;if(c&&c.length)for(const v of c)h.fire(new Ri(new Error(v.message))),f=!0;return f}class go{constructor(c,f,v){const E=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;const D=new Int32Array(this.arrayBuffer);c=D[0],this.d=(f=D[1])+2*(v=D[2]);for(let $=0;$<this.d*this.d;$++){const X=D[3+$],se=D[3+$+1];E.push(X===se?null:D.subarray(X,se))}const G=D[3+E.length+1];this.keys=D.subarray(D[3+E.length],G),this.bboxes=D.subarray(G),this.insert=this._insertReadonly}else{this.d=f+2*v;for(let D=0;D<this.d*this.d;D++)E.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=c,this.padding=v,this.scale=f/c,this.uid=0;const M=v/f*c;this.min=-M,this.max=c+M}insert(c,f,v,E,M){this._forEachCell(f,v,E,M,this._insertCell,this.uid++,void 0,void 0),this.keys.push(c),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(E),this.bboxes.push(M)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,f,v,E,M,D){this.cells[M].push(D)}query(c,f,v,E,M){const D=this.min,G=this.max;if(c<=D&&f<=D&&G<=v&&G<=E&&!M)return Array.prototype.slice.call(this.keys);{const $=[];return this._forEachCell(c,f,v,E,this._queryCell,$,{},M),$}}_queryCell(c,f,v,E,M,D,G,$){const X=this.cells[M];if(X!==null){const se=this.keys,Ae=this.bboxes;for(let me=0;me<X.length;me++){const Be=X[me];if(G[Be]===void 0){const Te=4*Be;($?$(Ae[Te+0],Ae[Te+1],Ae[Te+2],Ae[Te+3]):c<=Ae[Te+2]&&f<=Ae[Te+3]&&v>=Ae[Te+0]&&E>=Ae[Te+1])?(G[Be]=!0,D.push(se[Be])):G[Be]=!1}}}}_forEachCell(c,f,v,E,M,D,G,$){const X=this._convertToCellCoord(c),se=this._convertToCellCoord(f),Ae=this._convertToCellCoord(v),me=this._convertToCellCoord(E);for(let Be=X;Be<=Ae;Be++)for(let Te=se;Te<=me;Te++){const ke=this.d*Te+Be;if((!$||$(this._convertFromCellCoord(Be),this._convertFromCellCoord(Te),this._convertFromCellCoord(Be+1),this._convertFromCellCoord(Te+1)))&&M.call(this,c,f,v,E,ke,D,G,$))return}}_convertFromCellCoord(c){return(c-this.padding)/this.scale}_convertToCellCoord(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const c=this.cells,f=3+this.cells.length+1+1;let v=0;for(let D=0;D<this.cells.length;D++)v+=this.cells[D].length;const E=new Int32Array(f+v+this.keys.length+this.bboxes.length);E[0]=this.extent,E[1]=this.n,E[2]=this.padding;let M=f;for(let D=0;D<c.length;D++){const G=c[D];E[3+D]=M,E.set(G,M),M+=G.length}return E[3+c.length]=M,E.set(this.keys,M),M+=this.keys.length,E[3+c.length+1]=M,E.set(this.bboxes,M),M+=this.bboxes.length,E.buffer}static serialize(c,f){const v=c.toArrayBuffer();return f&&f.push(v),{buffer:v}}static deserialize(c){return new go(c.buffer)}}const Zo={};function Oi(h,c){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(Zo[h])throw new Error(`${h} is already registered.`);Object.defineProperty(c,"_classRegistryKey",{value:h,writeable:!1}),Zo[h]={klass:c,omit:f.omit||[],shallow:f.shallow||[]}}Oi("Object",Object),Oi("TransferableGridIndex",go),Oi("Color",lr),Oi("Error",Error),Oi("AJAXError",Pt),Oi("ResolvedImage",Wi),Oi("StylePropertyFunction",Lo),Oi("StyleExpression",Gn,{omit:["_evaluator"]}),Oi("ZoomDependentExpression",$s),Oi("ZoomConstantExpression",Un),Oi("CompoundExpression",ms,{omit:["_evaluate"]});for(const h in tl)tl[h]._classRegistryKey||Oi(`Expression_${h}`,tl[h]);function Jo(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function Pi(h,c){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob)return h;if(Jo(h)||Ft(h))return c&&c.push(h),h;if(ArrayBuffer.isView(h)){const f=h;return c&&c.push(f.buffer),f}if(h instanceof ImageData)return c&&c.push(h.data.buffer),h;if(Array.isArray(h)){const f=[];for(const v of h)f.push(Pi(v,c));return f}if(typeof h=="object"){const f=h.constructor,v=f._classRegistryKey;if(!v)throw new Error("can't serialize object of unregistered class");if(!Zo[v])throw new Error(`${v} is not registered.`);const E=f.serialize?f.serialize(h,c):{};if(f.serialize){if(c&&E===c[c.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const M in h){if(!h.hasOwnProperty(M)||Zo[v].omit.indexOf(M)>=0)continue;const D=h[M];E[M]=Zo[v].shallow.indexOf(M)>=0?D:Pi(D,c)}h instanceof Error&&(E.message=h.message)}if(E.$name)throw new Error("$name property is reserved for worker serialization logic.");return v!=="Object"&&(E.$name=v),E}throw new Error("can't serialize object of type "+typeof h)}function gl(h){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||Jo(h)||Ft(h)||ArrayBuffer.isView(h)||h instanceof ImageData)return h;if(Array.isArray(h))return h.map(gl);if(typeof h=="object"){const c=h.$name||"Object";if(!Zo[c])throw new Error(`can't deserialize unregistered class ${c}`);const{klass:f}=Zo[c];if(!f)throw new Error(`can't deserialize unregistered class ${c}`);if(f.deserialize)return f.deserialize(h);const v=Object.create(f.prototype);for(const E of Object.keys(h)){if(E==="$name")continue;const M=h[E];v[E]=Zo[c].shallow.indexOf(E)>=0?M:gl(M)}return v}throw new Error("can't deserialize object of type "+typeof h)}class $l{constructor(){this.first=!0}update(c,f){const v=Math.floor(c);return this.first?(this.first=!1,this.lastIntegerZoom=v,this.lastIntegerZoomTime=0,this.lastZoom=c,this.lastFloorZoom=v,!0):(this.lastFloorZoom>v?(this.lastIntegerZoom=v+1,this.lastIntegerZoomTime=f):this.lastFloorZoom<v&&(this.lastIntegerZoom=v,this.lastIntegerZoomTime=f),c!==this.lastZoom&&(this.lastZoom=c,this.lastFloorZoom=v,!0))}}const Li={"Latin-1 Supplement":h=>h>=128&&h<=255,Arabic:h=>h>=1536&&h<=1791,"Arabic Supplement":h=>h>=1872&&h<=1919,"Arabic Extended-A":h=>h>=2208&&h<=2303,"Hangul Jamo":h=>h>=4352&&h<=4607,"Unified Canadian Aboriginal Syllabics":h=>h>=5120&&h<=5759,Khmer:h=>h>=6016&&h<=6143,"Unified Canadian Aboriginal Syllabics Extended":h=>h>=6320&&h<=6399,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"CJK Radicals Supplement":h=>h>=11904&&h<=12031,"Kangxi Radicals":h=>h>=12032&&h<=12255,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Hiragana:h=>h>=12352&&h<=12447,Katakana:h=>h>=12448&&h<=12543,Bopomofo:h=>h>=12544&&h<=12591,"Hangul Compatibility Jamo":h=>h>=12592&&h<=12687,Kanbun:h=>h>=12688&&h<=12703,"Bopomofo Extended":h=>h>=12704&&h<=12735,"CJK Strokes":h=>h>=12736&&h<=12783,"Katakana Phonetic Extensions":h=>h>=12784&&h<=12799,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"CJK Unified Ideographs Extension A":h=>h>=13312&&h<=19903,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"CJK Unified Ideographs":h=>h>=19968&&h<=40959,"Yi Syllables":h=>h>=40960&&h<=42127,"Yi Radicals":h=>h>=42128&&h<=42191,"Hangul Jamo Extended-A":h=>h>=43360&&h<=43391,"Hangul Syllables":h=>h>=44032&&h<=55215,"Hangul Jamo Extended-B":h=>h>=55216&&h<=55295,"Private Use Area":h=>h>=57344&&h<=63743,"CJK Compatibility Ideographs":h=>h>=63744&&h<=64255,"Arabic Presentation Forms-A":h=>h>=64336&&h<=65023,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Arabic Presentation Forms-B":h=>h>=65136&&h<=65279,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519};function Kl(h){for(const c of h)if(mo(c.charCodeAt(0)))return!0;return!1}function Ei(h){for(const c of h)if(!so(c.charCodeAt(0)))return!1;return!0}function so(h){return!(Li.Arabic(h)||Li["Arabic Supplement"](h)||Li["Arabic Extended-A"](h)||Li["Arabic Presentation Forms-A"](h)||Li["Arabic Presentation Forms-B"](h))}function mo(h){return!(h!==746&&h!==747&&(h<4352||!(Li["Bopomofo Extended"](h)||Li.Bopomofo(h)||Li["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||Li["CJK Compatibility Ideographs"](h)||Li["CJK Compatibility"](h)||Li["CJK Radicals Supplement"](h)||Li["CJK Strokes"](h)||!(!Li["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||Li["CJK Unified Ideographs Extension A"](h)||Li["CJK Unified Ideographs"](h)||Li["Enclosed CJK Letters and Months"](h)||Li["Hangul Compatibility Jamo"](h)||Li["Hangul Jamo Extended-A"](h)||Li["Hangul Jamo Extended-B"](h)||Li["Hangul Jamo"](h)||Li["Hangul Syllables"](h)||Li.Hiragana(h)||Li["Ideographic Description Characters"](h)||Li.Kanbun(h)||Li["Kangxi Radicals"](h)||Li["Katakana Phonetic Extensions"](h)||Li.Katakana(h)&&h!==12540||!(!Li["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!Li["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||Li["Unified Canadian Aboriginal Syllabics"](h)||Li["Unified Canadian Aboriginal Syllabics Extended"](h)||Li["Vertical Forms"](h)||Li["Yijing Hexagram Symbols"](h)||Li["Yi Syllables"](h)||Li["Yi Radicals"](h))))}function Rc(h){return!(mo(h)||function(c){return!!(Li["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||Li["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||Li["Letterlike Symbols"](c)||Li["Number Forms"](c)||Li["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||Li["Control Pictures"](c)&&c!==9251||Li["Optical Character Recognition"](c)||Li["Enclosed Alphanumerics"](c)||Li["Geometric Shapes"](c)||Li["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||Li["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||Li["CJK Symbols and Punctuation"](c)||Li.Katakana(c)||Li["Private Use Area"](c)||Li["CJK Compatibility Forms"](c)||Li["Small Form Variants"](c)||Li["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)}(h))}function Wl(h){return h>=1424&&h<=2303||Li["Arabic Presentation Forms-A"](h)||Li["Arabic Presentation Forms-B"](h)}function kc(h,c){return!(!c&&Wl(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||Li.Khmer(h))}function Oc(h){for(const c of h)if(Wl(c.charCodeAt(0)))return!0;return!1}const Uc="deferred",Nc="loading",il="loaded";let yn=null,Cs="unavailable",Do=null;const Xl=function(h){h&&typeof h=="string"&&h.indexOf("NetworkError")>-1&&(Cs="error"),yn&&yn(h)};function Ou(){gc.fire(new xt("pluginStateChange",{pluginStatus:Cs,pluginURL:Do}))}const gc=new ei,uu=function(){return Cs},_a=function(){if(Cs!==Uc||!Do)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Cs=Nc,Ou(),Do&&mi({url:Do},h=>{h?Xl(h):(Cs=il,Ou())})},Ks={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Cs===il||Ks.applyArabicShaping!=null,isLoading:()=>Cs===Nc,setState(h){if(!Lt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Cs=h.pluginStatus,Do=h.pluginURL},isParsed(){if(!Lt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Ks.applyArabicShaping!=null&&Ks.processBidirectionalText!=null&&Ks.processStyledBidirectionalText!=null},getPluginURL(){if(!Lt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Do}};class bi{constructor(c,f){this.zoom=c,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.zoomHistory=f.zoomHistory,this.transition=f.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new $l,this.transition={})}isSupportedScript(c){return function(f,v){for(const E of f)if(!kc(E.charCodeAt(0),v))return!1;return!0}(c,Ks.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const c=this.zoom,f=c-Math.floor(c),v=this.crossFadingFactor();return c>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:f+(1-f)*v}:{fromScale:.5,toScale:1,t:1-(1-v)*f}}}class sr{constructor(c,f){this.property=c,this.value=f,this.expression=function(v,E){if(Tt(v))return new Lo(v,E);if(Br(v)){const M=to(v,E);if(M.result==="error")throw new Error(M.value.map(D=>`${D.key}: ${D.message}`).join(", "));return M.value}{let M=v;return E.type==="color"&&typeof v=="string"?M=lr.parse(v):E.type!=="padding"||typeof v!="number"&&!Array.isArray(v)?E.type==="variableAnchorOffsetCollection"&&Array.isArray(v)&&(M=us.parse(v)):M=xn.parse(v),{kind:"constant",evaluate:()=>M}}}(f===void 0?c.specification.default:f,c.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(c,f,v){return this.property.possiblyEvaluate(this,c,f,v)}}class Zl{constructor(c){this.property=c,this.value=new sr(c,void 0)}transitioned(c,f){return new Qc(this.property,this.value,f,Ue({},c.transition,this.transition),c.now)}untransitioned(){return new Qc(this.property,this.value,null,{},0)}}class zc{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues)}getValue(c){return Me(this._values[c].value.value)}setValue(c,f){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new Zl(this._values[c].property)),this._values[c].value=new sr(this._values[c].property,f===null?void 0:Me(f))}getTransition(c){return Me(this._values[c].transition)}setTransition(c,f){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new Zl(this._values[c].property)),this._values[c].transition=Me(f)||void 0}serialize(){const c={};for(const f of Object.keys(this._values)){const v=this.getValue(f);v!==void 0&&(c[f]=v);const E=this.getTransition(f);E!==void 0&&(c[`${f}-transition`]=E)}return c}transitioned(c,f){const v=new Es(this._properties);for(const E of Object.keys(this._values))v._values[E]=this._values[E].transitioned(c,f._values[E]);return v}untransitioned(){const c=new Es(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].untransitioned();return c}}class Qc{constructor(c,f,v,E,M){this.property=c,this.value=f,this.begin=M+E.delay||0,this.end=this.begin+E.duration||0,c.specification.transition&&(E.delay||E.duration)&&(this.prior=v)}possiblyEvaluate(c,f,v){const E=c.now||0,M=this.value.possiblyEvaluate(c,f,v),D=this.prior;if(D){if(E>this.end)return this.prior=null,M;if(this.value.isDataDriven())return this.prior=null,M;if(E<this.begin)return D.possiblyEvaluate(c,f,v);{const G=(E-this.begin)/(this.end-this.begin);return this.property.interpolate(D.possiblyEvaluate(c,f,v),M,function($){if($<=0)return 0;if($>=1)return 1;const X=$*$,se=X*$;return 4*($<.5?se:3*($-X)+se-.75)}(G))}}return M}}class Es{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,f,v){const E=new hu(this._properties);for(const M of Object.keys(this._values))E._values[M]=this._values[M].possiblyEvaluate(c,f,v);return E}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class bh{constructor(c){this._properties=c,this._values=Object.create(c.defaultPropertyValues)}hasValue(c){return this._values[c].value!==void 0}getValue(c){return Me(this._values[c].value)}setValue(c,f){this._values[c]=new sr(this._values[c].property,f===null?void 0:Me(f))}serialize(){const c={};for(const f of Object.keys(this._values)){const v=this.getValue(f);v!==void 0&&(c[f]=v)}return c}possiblyEvaluate(c,f,v){const E=new hu(this._properties);for(const M of Object.keys(this._values))E._values[M]=this._values[M].possiblyEvaluate(c,f,v);return E}}class qn{constructor(c,f,v){this.property=c,this.value=f,this.parameters=v}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,f,v,E){return this.property.evaluate(this.value,this.parameters,c,f,v,E)}}class hu{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class $i{constructor(c){this.specification=c}possiblyEvaluate(c,f){if(c.isDataDriven())throw new Error("Value should not be data driven");return c.expression.evaluate(f)}interpolate(c,f,v){const E=hs[this.specification.type];return E?E(c,f,v):c}}class Ni{constructor(c,f){this.specification=c,this.overrides=f}possiblyEvaluate(c,f,v,E){return new qn(this,c.expression.kind==="constant"||c.expression.kind==="camera"?{kind:"constant",value:c.expression.evaluate(f,null,{},v,E)}:c.expression,f)}interpolate(c,f,v){if(c.value.kind!=="constant"||f.value.kind!=="constant")return c;if(c.value.value===void 0||f.value.value===void 0)return new qn(this,{kind:"constant",value:void 0},c.parameters);const E=hs[this.specification.type];if(E){const M=E(c.value.value,f.value.value,v);return new qn(this,{kind:"constant",value:M},c.parameters)}return c}evaluate(c,f,v,E,M,D){return c.kind==="constant"?c.value:c.evaluate(f,v,E,M,D)}}class $n extends Ni{possiblyEvaluate(c,f,v,E){if(c.value===void 0)return new qn(this,{kind:"constant",value:void 0},f);if(c.expression.kind==="constant"){const M=c.expression.evaluate(f,null,{},v,E),D=c.property.specification.type==="resolvedImage"&&typeof M!="string"?M.name:M,G=this._calculate(D,D,D,f);return new qn(this,{kind:"constant",value:G},f)}if(c.expression.kind==="camera"){const M=this._calculate(c.expression.evaluate({zoom:f.zoom-1}),c.expression.evaluate({zoom:f.zoom}),c.expression.evaluate({zoom:f.zoom+1}),f);return new qn(this,{kind:"constant",value:M},f)}return new qn(this,c.expression,f)}evaluate(c,f,v,E,M,D){if(c.kind==="source"){const G=c.evaluate(f,v,E,M,D);return this._calculate(G,G,G,f)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(f.zoom)-1},v,E),c.evaluate({zoom:Math.floor(f.zoom)},v,E),c.evaluate({zoom:Math.floor(f.zoom)+1},v,E),f):c.value}_calculate(c,f,v,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:c,to:f}:{from:v,to:f}}interpolate(c){return c}}class Uu{constructor(c){this.specification=c}possiblyEvaluate(c,f,v,E){if(c.value!==void 0){if(c.expression.kind==="constant"){const M=c.expression.evaluate(f,null,{},v,E);return this._calculate(M,M,M,f)}return this._calculate(c.expression.evaluate(new bi(Math.floor(f.zoom-1),f)),c.expression.evaluate(new bi(Math.floor(f.zoom),f)),c.expression.evaluate(new bi(Math.floor(f.zoom+1),f)),f)}}_calculate(c,f,v,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:c,to:f}:{from:v,to:f}}interpolate(c){return c}}class Rs{constructor(c){this.specification=c}possiblyEvaluate(c,f,v,E){return!!c.expression.evaluate(f,null,{},v,E)}interpolate(){return!1}}class tn{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const f in c){const v=c[f];v.specification.overridable&&this.overridableProperties.push(f);const E=this.defaultPropertyValues[f]=new sr(v,void 0),M=this.defaultTransitionablePropertyValues[f]=new Zl(v);this.defaultTransitioningPropertyValues[f]=M.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=E.possiblyEvaluate({})}}}Oi("DataDrivenProperty",Ni),Oi("DataConstantProperty",$i),Oi("CrossFadedDataDrivenProperty",$n),Oi("CrossFadedProperty",Uu),Oi("ColorRampProperty",Rs);const Yo="-transition";class Ro extends ei{constructor(c,f){if(super(),this.id=c.id,this.type=c.type,this._featureFilter={filter:()=>!0,needGeometry:!1},c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),f.layout&&(this._unevaluatedLayout=new bh(f.layout)),f.paint)){this._transitionablePaint=new zc(f.paint);for(const v in c.paint)this.setPaintProperty(v,c.paint[v],{validate:!1});for(const v in c.layout)this.setLayoutProperty(v,c.layout[v],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new hu(f.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}setLayoutProperty(c,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};f!=null&&this._validate(ya,`layers.${this.id}.layout.${c}`,c,f,v)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,f):this.visibility=f)}getPaintProperty(c){return c.endsWith(Yo)?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)}setPaintProperty(c,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(f!=null&&this._validate(jn,`layers.${this.id}.paint.${c}`,c,f,v))return!1;if(c.endsWith(Yo))return this._transitionablePaint.setTransition(c.slice(0,-11),f||void 0),!1;{const E=this._transitionablePaint._values[c],M=E.property.specification["property-type"]==="cross-faded-data-driven",D=E.value.isDataDriven(),G=E.value;this._transitionablePaint.setValue(c,f),this._handleSpecialPaintPropertyUpdate(c);const $=this._transitionablePaint._values[c].value;return $.isDataDriven()||D||M||this._handleOverridablePaintPropertyUpdate(c,G,$)}}_handleSpecialPaintPropertyUpdate(c){}_handleOverridablePaintPropertyUpdate(c,f,v){return!1}isHidden(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,f){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,f)}serialize(){const c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),De(c,(f,v)=>!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length))}_validate(c,f,v,E){let M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!M||M.validate!==!1)&&Fa(this,c.call(Zr,{key:f,layerType:this.type,objectKey:v,value:E,styleSpec:ut,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const c in this.paint._values){const f=this.paint.get(c);if(f instanceof qn&&Ie(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1}}const Au={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ks{constructor(c,f){this._structArray=c,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Jr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,f){return c._trim(),f&&(c.isTransferred=!0,f.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){const f=Object.create(this.prototype);return f.arrayBuffer=c.arrayBuffer,f.length=c.length,f.capacity=c.arrayBuffer.byteLength/f.bytesPerElement,f._refreshViews(),f}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){if(c>this.capacity){this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const f=this.uint8;this._refreshViews(),f&&this.uint8.set(f)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Nn(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,f=0,v=0;return{members:h.map(E=>{const M=Au[E.type].BYTES_PER_ELEMENT,D=f=ko(f,Math.max(c,M)),G=E.components||1;return v=Math.max(v,M),f+=M*G,{name:E.name,type:E.type,components:G,offset:D}}),size:ko(f,Math.max(v,c)),alignment:c}}function ko(h,c){return Math.ceil(h/c)*c}class ml extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f){const v=this.length;return this.resize(v+1),this.emplace(v,c,f)}emplace(c,f,v){const E=2*c;return this.int16[E+0]=f,this.int16[E+1]=v,c}}ml.prototype.bytesPerElement=4,Oi("StructArrayLayout2i4",ml);class rl extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,c,f,v)}emplace(c,f,v,E){const M=3*c;return this.int16[M+0]=f,this.int16[M+1]=v,this.int16[M+2]=E,c}}rl.prototype.bytesPerElement=6,Oi("StructArrayLayout3i6",rl);class Da extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,E){const M=this.length;return this.resize(M+1),this.emplace(M,c,f,v,E)}emplace(c,f,v,E,M){const D=4*c;return this.int16[D+0]=f,this.int16[D+1]=v,this.int16[D+2]=E,this.int16[D+3]=M,c}}Da.prototype.bytesPerElement=8,Oi("StructArrayLayout4i8",Da);class Jl extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,D){const G=this.length;return this.resize(G+1),this.emplace(G,c,f,v,E,M,D)}emplace(c,f,v,E,M,D,G){const $=6*c;return this.int16[$+0]=f,this.int16[$+1]=v,this.int16[$+2]=E,this.int16[$+3]=M,this.int16[$+4]=D,this.int16[$+5]=G,c}}Jl.prototype.bytesPerElement=12,Oi("StructArrayLayout2i4i12",Jl);class du extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,D){const G=this.length;return this.resize(G+1),this.emplace(G,c,f,v,E,M,D)}emplace(c,f,v,E,M,D,G){const $=4*c,X=8*c;return this.int16[$+0]=f,this.int16[$+1]=v,this.uint8[X+4]=E,this.uint8[X+5]=M,this.uint8[X+6]=D,this.uint8[X+7]=G,c}}du.prototype.bytesPerElement=8,Oi("StructArrayLayout2i4ub8",du);class yo extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f){const v=this.length;return this.resize(v+1),this.emplace(v,c,f)}emplace(c,f,v){const E=2*c;return this.float32[E+0]=f,this.float32[E+1]=v,c}}yo.prototype.bytesPerElement=8,Oi("StructArrayLayout2f8",yo);class va extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,D,G,$,X,se){const Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,c,f,v,E,M,D,G,$,X,se)}emplace(c,f,v,E,M,D,G,$,X,se,Ae){const me=10*c;return this.uint16[me+0]=f,this.uint16[me+1]=v,this.uint16[me+2]=E,this.uint16[me+3]=M,this.uint16[me+4]=D,this.uint16[me+5]=G,this.uint16[me+6]=$,this.uint16[me+7]=X,this.uint16[me+8]=se,this.uint16[me+9]=Ae,c}}va.prototype.bytesPerElement=20,Oi("StructArrayLayout10ui20",va);class yl extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,D,G,$,X,se,Ae,me){const Be=this.length;return this.resize(Be+1),this.emplace(Be,c,f,v,E,M,D,G,$,X,se,Ae,me)}emplace(c,f,v,E,M,D,G,$,X,se,Ae,me,Be){const Te=12*c;return this.int16[Te+0]=f,this.int16[Te+1]=v,this.int16[Te+2]=E,this.int16[Te+3]=M,this.uint16[Te+4]=D,this.uint16[Te+5]=G,this.uint16[Te+6]=$,this.uint16[Te+7]=X,this.int16[Te+8]=se,this.int16[Te+9]=Ae,this.int16[Te+10]=me,this.int16[Te+11]=Be,c}}yl.prototype.bytesPerElement=24,Oi("StructArrayLayout4i4ui4i24",yl);class Gr extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,c,f,v)}emplace(c,f,v,E){const M=3*c;return this.float32[M+0]=f,this.float32[M+1]=v,this.float32[M+2]=E,c}}Gr.prototype.bytesPerElement=12,Oi("StructArrayLayout3f12",Gr);class N extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){const f=this.length;return this.resize(f+1),this.emplace(f,c)}emplace(c,f){return this.uint32[1*c+0]=f,c}}N.prototype.bytesPerElement=4,Oi("StructArrayLayout1ul4",N);class A extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,D,G,$,X){const se=this.length;return this.resize(se+1),this.emplace(se,c,f,v,E,M,D,G,$,X)}emplace(c,f,v,E,M,D,G,$,X,se){const Ae=10*c,me=5*c;return this.int16[Ae+0]=f,this.int16[Ae+1]=v,this.int16[Ae+2]=E,this.int16[Ae+3]=M,this.int16[Ae+4]=D,this.int16[Ae+5]=G,this.uint32[me+3]=$,this.uint16[Ae+8]=X,this.uint16[Ae+9]=se,c}}A.prototype.bytesPerElement=20,Oi("StructArrayLayout6i1ul2ui20",A);class x extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,D){const G=this.length;return this.resize(G+1),this.emplace(G,c,f,v,E,M,D)}emplace(c,f,v,E,M,D,G){const $=6*c;return this.int16[$+0]=f,this.int16[$+1]=v,this.int16[$+2]=E,this.int16[$+3]=M,this.int16[$+4]=D,this.int16[$+5]=G,c}}x.prototype.bytesPerElement=12,Oi("StructArrayLayout2i2i2i12",x);class L extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M){const D=this.length;return this.resize(D+1),this.emplace(D,c,f,v,E,M)}emplace(c,f,v,E,M,D){const G=4*c,$=8*c;return this.float32[G+0]=f,this.float32[G+1]=v,this.float32[G+2]=E,this.int16[$+6]=M,this.int16[$+7]=D,c}}L.prototype.bytesPerElement=16,Oi("StructArrayLayout2f1f2i16",L);class O extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,E){const M=this.length;return this.resize(M+1),this.emplace(M,c,f,v,E)}emplace(c,f,v,E,M){const D=12*c,G=3*c;return this.uint8[D+0]=f,this.uint8[D+1]=v,this.float32[G+1]=E,this.float32[G+2]=M,c}}O.prototype.bytesPerElement=12,Oi("StructArrayLayout2ub2f12",O);class y extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,c,f,v)}emplace(c,f,v,E){const M=3*c;return this.uint16[M+0]=f,this.uint16[M+1]=v,this.uint16[M+2]=E,c}}y.prototype.bytesPerElement=6,Oi("StructArrayLayout3ui6",y);class a extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,D,G,$,X,se,Ae,me,Be,Te,ke,je,$e){const ct=this.length;return this.resize(ct+1),this.emplace(ct,c,f,v,E,M,D,G,$,X,se,Ae,me,Be,Te,ke,je,$e)}emplace(c,f,v,E,M,D,G,$,X,se,Ae,me,Be,Te,ke,je,$e,ct){const Ye=24*c,tt=12*c,gt=48*c;return this.int16[Ye+0]=f,this.int16[Ye+1]=v,this.uint16[Ye+2]=E,this.uint16[Ye+3]=M,this.uint32[tt+2]=D,this.uint32[tt+3]=G,this.uint32[tt+4]=$,this.uint16[Ye+10]=X,this.uint16[Ye+11]=se,this.uint16[Ye+12]=Ae,this.float32[tt+7]=me,this.float32[tt+8]=Be,this.uint8[gt+36]=Te,this.uint8[gt+37]=ke,this.uint8[gt+38]=je,this.uint32[tt+10]=$e,this.int16[Ye+22]=ct,c}}a.prototype.bytesPerElement=48,Oi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",a);class d extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,E,M,D,G,$,X,se,Ae,me,Be,Te,ke,je,$e,ct,Ye,tt,gt,St,Xt,xi,oi,Ai,fi,Fi){const ai=this.length;return this.resize(ai+1),this.emplace(ai,c,f,v,E,M,D,G,$,X,se,Ae,me,Be,Te,ke,je,$e,ct,Ye,tt,gt,St,Xt,xi,oi,Ai,fi,Fi)}emplace(c,f,v,E,M,D,G,$,X,se,Ae,me,Be,Te,ke,je,$e,ct,Ye,tt,gt,St,Xt,xi,oi,Ai,fi,Fi,ai){const Zt=32*c,Vi=16*c;return this.int16[Zt+0]=f,this.int16[Zt+1]=v,this.int16[Zt+2]=E,this.int16[Zt+3]=M,this.int16[Zt+4]=D,this.int16[Zt+5]=G,this.int16[Zt+6]=$,this.int16[Zt+7]=X,this.uint16[Zt+8]=se,this.uint16[Zt+9]=Ae,this.uint16[Zt+10]=me,this.uint16[Zt+11]=Be,this.uint16[Zt+12]=Te,this.uint16[Zt+13]=ke,this.uint16[Zt+14]=je,this.uint16[Zt+15]=$e,this.uint16[Zt+16]=ct,this.uint16[Zt+17]=Ye,this.uint16[Zt+18]=tt,this.uint16[Zt+19]=gt,this.uint16[Zt+20]=St,this.uint16[Zt+21]=Xt,this.uint16[Zt+22]=xi,this.uint32[Vi+12]=oi,this.float32[Vi+13]=Ai,this.float32[Vi+14]=fi,this.uint16[Zt+30]=Fi,this.uint16[Zt+31]=ai,c}}d.prototype.bytesPerElement=64,Oi("StructArrayLayout8i15ui1ul2f2ui64",d);class _ extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){const f=this.length;return this.resize(f+1),this.emplace(f,c)}emplace(c,f){return this.float32[1*c+0]=f,c}}_.prototype.bytesPerElement=4,Oi("StructArrayLayout1f4",_);class B extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,c,f,v)}emplace(c,f,v,E){const M=3*c;return this.uint16[6*c+0]=f,this.float32[M+1]=v,this.float32[M+2]=E,c}}B.prototype.bytesPerElement=12,Oi("StructArrayLayout1ui2f12",B);class S extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f,v){const E=this.length;return this.resize(E+1),this.emplace(E,c,f,v)}emplace(c,f,v,E){const M=4*c;return this.uint32[2*c+0]=f,this.uint16[M+2]=v,this.uint16[M+3]=E,c}}S.prototype.bytesPerElement=8,Oi("StructArrayLayout1ul2ui8",S);class U extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,f){const v=this.length;return this.resize(v+1),this.emplace(v,c,f)}emplace(c,f,v){const E=2*c;return this.uint16[E+0]=f,this.uint16[E+1]=v,c}}U.prototype.bytesPerElement=4,Oi("StructArrayLayout2ui4",U);class H extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){const f=this.length;return this.resize(f+1),this.emplace(f,c)}emplace(c,f){return this.uint16[1*c+0]=f,c}}H.prototype.bytesPerElement=2,Oi("StructArrayLayout1ui2",H);class q extends Jr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,f,v,E){const M=this.length;return this.resize(M+1),this.emplace(M,c,f,v,E)}emplace(c,f,v,E,M){const D=4*c;return this.float32[D+0]=f,this.float32[D+1]=v,this.float32[D+2]=E,this.float32[D+3]=M,c}}q.prototype.bytesPerElement=16,Oi("StructArrayLayout4f16",q);class w extends ks{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new k(this.anchorPointX,this.anchorPointY)}}w.prototype.size=20;class I extends A{get(c){return new w(this,c)}}Oi("CollisionBoxArray",I);class R extends ks{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(c){this._structArray.uint8[this._pos1+37]=c}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(c){this._structArray.uint8[this._pos1+38]=c}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(c){this._structArray.uint32[this._pos4+10]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}R.prototype.size=48;class j extends a{get(c){return new R(this,c)}}Oi("PlacedSymbolArray",j);class Z extends ks{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(c){this._structArray.uint32[this._pos4+12]=c}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Z.prototype.size=64;class W extends d{get(c){return new Z(this,c)}}Oi("SymbolInstanceArray",W);class Y extends _{getoffsetX(c){return this.float32[1*c+0]}}Oi("GlyphOffsetArray",Y);class ie extends rl{getx(c){return this.int16[3*c+0]}gety(c){return this.int16[3*c+1]}gettileUnitDistanceFromAnchor(c){return this.int16[3*c+2]}}Oi("SymbolLineVertexArray",ie);class ae extends ks{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ae.prototype.size=12;class fe extends B{get(c){return new ae(this,c)}}Oi("TextAnchorOffsetArray",fe);class pe extends ks{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}pe.prototype.size=8;class xe extends S{get(c){return new pe(this,c)}}Oi("FeatureIndexArray",xe);class Fe extends ml{}class Le extends ml{}class nt extends ml{}class Ke extends Jl{}class Re extends du{}class Qe extends yo{}class pt extends va{}class bt extends yl{}class ht extends Gr{}class Rt extends N{}class Dt extends x{}class hi extends O{}class Vt extends y{}class _i extends U{}const Si=Nn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Yi}=Si;class Ti{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=c}prepareSegment(c,f,v,E){let M=this.segments[this.segments.length-1];return c>Ti.MAX_VERTEX_ARRAY_LENGTH&&We(`Max vertices per segment is ${Ti.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${c}`),(!M||M.vertexLength+c>Ti.MAX_VERTEX_ARRAY_LENGTH||M.sortKey!==E)&&(M={vertexOffset:f.length,primitiveOffset:v.length,vertexLength:0,primitiveLength:0},E!==void 0&&(M.sortKey=E),this.segments.push(M)),M}get(){return this.segments}destroy(){for(const c of this.segments)for(const f in c.vaos)c.vaos[f].destroy()}static simpleSegment(c,f,v,E){return new Ti([{vertexOffset:c,primitiveOffset:f,vertexLength:v,primitiveLength:E,vaos:{},sortKey:0}])}}function yr(h,c){return 256*(h=Ve(Math.floor(h),0,255))+Ve(Math.floor(c),0,255)}Ti.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Oi("SegmentVector",Ti);const fr=Nn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ji={exports:{}},Ur={exports:{}};Ur.exports=function(h,c){var f,v,E,M,D,G,$,X;for(v=h.length-(f=3&h.length),E=c,D=3432918353,G=461845907,X=0;X<v;)$=255&h.charCodeAt(X)|(255&h.charCodeAt(++X))<<8|(255&h.charCodeAt(++X))<<16|(255&h.charCodeAt(++X))<<24,++X,E=27492+(65535&(M=5*(65535&(E=(E^=$=(65535&($=($=(65535&$)*D+((($>>>16)*D&65535)<<16)&4294967295)<<15|$>>>17))*G+((($>>>16)*G&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(M>>>16)&65535)<<16);switch($=0,f){case 3:$^=(255&h.charCodeAt(X+2))<<16;case 2:$^=(255&h.charCodeAt(X+1))<<8;case 1:E^=$=(65535&($=($=(65535&($^=255&h.charCodeAt(X)))*D+((($>>>16)*D&65535)<<16)&4294967295)<<15|$>>>17))*G+((($>>>16)*G&65535)<<16)&4294967295}return E^=h.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0};var rn=Ur.exports,Mr={exports:{}};Mr.exports=function(h,c){for(var f,v=h.length,E=c^v,M=0;v>=4;)f=1540483477*(65535&(f=255&h.charCodeAt(M)|(255&h.charCodeAt(++M))<<8|(255&h.charCodeAt(++M))<<16|(255&h.charCodeAt(++M))<<24))+((1540483477*(f>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++M;switch(v){case 3:E^=(255&h.charCodeAt(M+2))<<16;case 2:E^=(255&h.charCodeAt(M+1))<<8;case 1:E=1540483477*(65535&(E^=255&h.charCodeAt(M)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0};var Kr=rn,Cr=Mr.exports;ji.exports=Kr,ji.exports.murmur3=Kr,ji.exports.murmur2=Cr;var ts=b(ji.exports);class Nr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,f,v,E){this.ids.push(pr(c)),this.positions.push(f,v,E)}getPositions(c){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const f=pr(c);let v=0,E=this.ids.length-1;for(;v<E;){const D=v+E>>1;this.ids[D]>=f?E=D:v=D+1}const M=[];for(;this.ids[v]===f;)M.push({index:this.positions[3*v],start:this.positions[3*v+1],end:this.positions[3*v+2]}),v++;return M}static serialize(c,f){const v=new Float64Array(c.ids),E=new Uint32Array(c.positions);return _r(v,E,0,v.length-1),f&&f.push(v.buffer,E.buffer),{ids:v,positions:E}}static deserialize(c){const f=new Nr;return f.ids=c.ids,f.positions=c.positions,f.indexed=!0,f}}function pr(h){const c=+h;return!isNaN(c)&&c<=Number.MAX_SAFE_INTEGER?c:ts(String(h))}function _r(h,c,f,v){for(;f<v;){const E=h[f+v>>1];let M=f-1,D=v+1;for(;;){do M++;while(h[M]<E);do D--;while(h[D]>E);if(M>=D)break;or(h,M,D),or(c,3*M,3*D),or(c,3*M+1,3*D+1),or(c,3*M+2,3*D+2)}D-f<v-D?(_r(h,c,f,D),f=D+1):(_r(h,c,D+1,v),v=D)}}function or(h,c,f){const v=h[c];h[c]=h[f],h[f]=v}Oi("FeaturePositionMap",Nr);class ln{constructor(c,f){this.gl=c.gl,this.location=f}}class qr extends ln{constructor(c,f){super(c,f),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class Wr extends ln{constructor(c,f){super(c,f),this.current=[0,0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))}}class Mn extends ln{constructor(c,f){super(c,f),this.current=lr.transparent}set(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))}}const Kn=new Float32Array(16);function _l(h){return[yr(255*h.r,255*h.g),yr(255*h.b,255*h.a)]}class $r{constructor(c,f,v){this.value=c,this.uniformNames=f.map(E=>`u_${E}`),this.type=v}setUniform(c,f,v){c.set(v.constantOr(this.value))}getBinding(c,f,v){return this.type==="color"?new Mn(c,f):new qr(c,f)}}class _n{constructor(c,f){this.uniformNames=f.map(v=>`u_${v}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(c,f){this.pixelRatioFrom=f.pixelRatio,this.pixelRatioTo=c.pixelRatio,this.patternFrom=f.tlbr,this.patternTo=c.tlbr}setUniform(c,f,v,E){const M=E==="u_pattern_to"?this.patternTo:E==="u_pattern_from"?this.patternFrom:E==="u_pixel_ratio_to"?this.pixelRatioTo:E==="u_pixel_ratio_from"?this.pixelRatioFrom:null;M&&c.set(M)}getBinding(c,f,v){return v.substr(0,9)==="u_pattern"?new Wr(c,f):new qr(c,f)}}class ea{constructor(c,f,v,E){this.expression=c,this.type=v,this.maxValue=0,this.paintVertexAttributes=f.map(M=>({name:`a_${M}`,type:"Float32",components:v==="color"?2:1,offset:0})),this.paintVertexArray=new E}populatePaintArray(c,f,v,E,M){const D=this.paintVertexArray.length,G=this.expression.evaluate(new bi(0),f,{},E,[],M);this.paintVertexArray.resize(c),this._setPaintValue(D,c,G)}updatePaintArray(c,f,v,E){const M=this.expression.evaluate({zoom:0},v,E);this._setPaintValue(c,f,M)}_setPaintValue(c,f,v){if(this.type==="color"){const E=_l(v);for(let M=c;M<f;M++)this.paintVertexArray.emplace(M,E[0],E[1])}else{for(let E=c;E<f;E++)this.paintVertexArray.emplace(E,v);this.maxValue=Math.max(this.maxValue,Math.abs(v))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Os{constructor(c,f,v,E,M,D){this.expression=c,this.uniformNames=f.map(G=>`u_${G}_t`),this.type=v,this.useIntegerZoom=E,this.zoom=M,this.maxValue=0,this.paintVertexAttributes=f.map(G=>({name:`a_${G}`,type:"Float32",components:v==="color"?4:2,offset:0})),this.paintVertexArray=new D}populatePaintArray(c,f,v,E,M){const D=this.expression.evaluate(new bi(this.zoom),f,{},E,[],M),G=this.expression.evaluate(new bi(this.zoom+1),f,{},E,[],M),$=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue($,c,D,G)}updatePaintArray(c,f,v,E){const M=this.expression.evaluate({zoom:this.zoom},v,E),D=this.expression.evaluate({zoom:this.zoom+1},v,E);this._setPaintValue(c,f,M,D)}_setPaintValue(c,f,v,E){if(this.type==="color"){const M=_l(v),D=_l(E);for(let G=c;G<f;G++)this.paintVertexArray.emplace(G,M[0],M[1],D[0],D[1])}else{for(let M=c;M<f;M++)this.paintVertexArray.emplace(M,v,E);this.maxValue=Math.max(this.maxValue,Math.abs(v),Math.abs(E))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,f){const v=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,E=Ve(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);c.set(E)}getBinding(c,f,v){return new qr(c,f)}}class Ws{constructor(c,f,v,E,M,D){this.expression=c,this.type=f,this.useIntegerZoom=v,this.zoom=E,this.layerId=D,this.zoomInPaintVertexArray=new M,this.zoomOutPaintVertexArray=new M}populatePaintArray(c,f,v){const E=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(c),this.zoomOutPaintVertexArray.resize(c),this._setPaintValues(E,c,f.patterns&&f.patterns[this.layerId],v)}updatePaintArray(c,f,v,E,M){this._setPaintValues(c,f,v.patterns&&v.patterns[this.layerId],M)}_setPaintValues(c,f,v,E){if(!E||!v)return;const{min:M,mid:D,max:G}=v,$=E[M],X=E[D],se=E[G];if($&&X&&se)for(let Ae=c;Ae<f;Ae++)this.zoomInPaintVertexArray.emplace(Ae,X.tl[0],X.tl[1],X.br[0],X.br[1],$.tl[0],$.tl[1],$.br[0],$.br[1],X.pixelRatio,$.pixelRatio),this.zoomOutPaintVertexArray.emplace(Ae,X.tl[0],X.tl[1],X.br[0],X.br[1],se.tl[0],se.tl[1],se.br[0],se.br[1],X.pixelRatio,se.pixelRatio)}upload(c){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=c.createVertexBuffer(this.zoomInPaintVertexArray,fr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=c.createVertexBuffer(this.zoomOutPaintVertexArray,fr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Oo{constructor(c,f,v){this.binders={},this._buffers=[];const E=[];for(const M in c.paint._values){if(!v(M))continue;const D=c.paint.get(M);if(!(D instanceof qn&&Ie(D.property.specification)))continue;const G=Nu(M,c.type),$=D.value,X=D.property.specification.type,se=D.property.useIntegerZoom,Ae=D.property.specification["property-type"],me=Ae==="cross-faded"||Ae==="cross-faded-data-driven";if($.kind==="constant")this.binders[M]=me?new _n($.value,G):new $r($.value,G,X),E.push(`/u_${M}`);else if($.kind==="source"||me){const Be=Ra(M,X,"source");this.binders[M]=me?new Ws($,X,se,f,Be,c.id):new ea($,G,X,Be),E.push(`/a_${M}`)}else{const Be=Ra(M,X,"composite");this.binders[M]=new Os($,G,X,se,f,Be),E.push(`/z_${M}`)}}this.cacheKey=E.sort().join("")}getMaxValue(c){const f=this.binders[c];return f instanceof ea||f instanceof Os?f.maxValue:0}populatePaintArrays(c,f,v,E,M){for(const D in this.binders){const G=this.binders[D];(G instanceof ea||G instanceof Os||G instanceof Ws)&&G.populatePaintArray(c,f,v,E,M)}}setConstantPatternPositions(c,f){for(const v in this.binders){const E=this.binders[v];E instanceof _n&&E.setConstantPatternPositions(c,f)}}updatePaintArrays(c,f,v,E,M){let D=!1;for(const G in c){const $=f.getPositions(G);for(const X of $){const se=v.feature(X.index);for(const Ae in this.binders){const me=this.binders[Ae];if((me instanceof ea||me instanceof Os||me instanceof Ws)&&me.expression.isStateDependent===!0){const Be=E.paint.get(Ae);me.expression=Be.value,me.updatePaintArray(X.start,X.end,se,c[G],M),D=!0}}}}return D}defines(){const c=[];for(const f in this.binders){const v=this.binders[f];(v instanceof $r||v instanceof _n)&&c.push(...v.uniformNames.map(E=>`#define HAS_UNIFORM_${E}`))}return c}getBinderAttributes(){const c=[];for(const f in this.binders){const v=this.binders[f];if(v instanceof ea||v instanceof Os)for(let E=0;E<v.paintVertexAttributes.length;E++)c.push(v.paintVertexAttributes[E].name);else if(v instanceof Ws)for(let E=0;E<fr.members.length;E++)c.push(fr.members[E].name)}return c}getBinderUniforms(){const c=[];for(const f in this.binders){const v=this.binders[f];if(v instanceof $r||v instanceof _n||v instanceof Os)for(const E of v.uniformNames)c.push(E)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c,f){const v=[];for(const E in this.binders){const M=this.binders[E];if(M instanceof $r||M instanceof _n||M instanceof Os){for(const D of M.uniformNames)if(f[D]){const G=M.getBinding(c,f[D],D);v.push({name:D,property:E,binding:G})}}}return v}setUniforms(c,f,v,E){for(const{name:M,property:D,binding:G}of f)this.binders[D].setUniform(G,E,v.get(D),M)}updatePaintBuffers(c){this._buffers=[];for(const f in this.binders){const v=this.binders[f];if(c&&v instanceof Ws){const E=c.fromScale===2?v.zoomInPaintVertexBuffer:v.zoomOutPaintVertexBuffer;E&&this._buffers.push(E)}else(v instanceof ea||v instanceof Os)&&v.paintVertexBuffer&&this._buffers.push(v.paintVertexBuffer)}}upload(c){for(const f in this.binders){const v=this.binders[f];(v instanceof ea||v instanceof Os||v instanceof Ws)&&v.upload(c)}this.updatePaintBuffers()}destroy(){for(const c in this.binders){const f=this.binders[c];(f instanceof ea||f instanceof Os||f instanceof Ws)&&f.destroy()}}}class oo{constructor(c,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const E of c)this.programConfigurations[E.id]=new Oo(E,f,v);this.needsUpload=!1,this._featureMap=new Nr,this._bufferOffset=0}populatePaintArrays(c,f,v,E,M,D){for(const G in this.programConfigurations)this.programConfigurations[G].populatePaintArrays(c,f,E,M,D);f.id!==void 0&&this._featureMap.add(f.id,v,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,f,v,E){for(const M of v)this.needsUpload=this.programConfigurations[M.id].updatePaintArrays(c,this._featureMap,f,M,E)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const f in this.programConfigurations)this.programConfigurations[f].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}function Nu(h,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${c}-`,"").replace(/-/g,"_")]}function Ra(h,c,f){const v={color:{source:yo,composite:q},number:{source:_,composite:yo}},E=function(M){return{"line-pattern":{source:pt,composite:pt},"fill-pattern":{source:pt,composite:pt},"fill-extrusion-pattern":{source:pt,composite:pt}}[M]}(h);return E&&E[f]||v[c][f]}Oi("ConstantBinder",$r),Oi("CrossFadedConstantBinder",_n),Oi("SourceExpressionBinder",ea),Oi("CrossFadedCompositeBinder",Ws),Oi("CompositeExpressionBinder",Os),Oi("ProgramConfiguration",Oo,{omit:["_buffers"]}),Oi("ProgramConfigurationSet",oo);const In=8192,mc=Math.pow(2,14)-1,fu=-mc-1;function Vc(h){const c=In/h.extent,f=h.loadGeometry();for(let v=0;v<f.length;v++){const E=f[v];for(let M=0;M<E.length;M++){const D=E[M],G=Math.round(D.x*c),$=Math.round(D.y*c);D.x=Ve(G,fu,mc),D.y=Ve($,fu,mc),(G<D.x||G>D.x+1||$<D.y||$>D.y+1)&&We("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return f}function Hc(h,c){return{type:h.type,id:h.id,properties:h.properties,geometry:c?Vc(h):[]}}function zu(h,c,f,v,E){h.emplaceBack(2*c+(v+1)/2,2*f+(E+1)/2)}class nA{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(f=>f.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new Le,this.indexArray=new Vt,this.segments=new Ti,this.programConfigurations=new oo(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(c,f,v){const E=this.layers[0],M=[];let D=null,G=!1;E.type==="circle"&&(D=E.layout.get("circle-sort-key"),G=!D.isConstant());for(const{feature:$,id:X,index:se,sourceLayerIndex:Ae}of c){const me=this.layers[0]._featureFilter.needGeometry,Be=Hc($,me);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),Be,v))continue;const Te=G?D.evaluate(Be,{},v):void 0,ke={id:X,properties:$.properties,type:$.type,sourceLayerIndex:Ae,index:se,geometry:me?Be.geometry:Vc($),patterns:{},sortKey:Te};M.push(ke)}G&&M.sort(($,X)=>$.sortKey-X.sortKey);for(const $ of M){const{geometry:X,index:se,sourceLayerIndex:Ae}=$,me=c[se].feature;this.addFeature($,X,se,v),f.featureIndex.insert(me,X,se,Ae,this.index)}}update(c,f,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,f,this.stateDependentLayers,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Yi),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,f,v,E){for(const M of f)for(const D of M){const G=D.x,$=D.y;if(G<0||G>=In||$<0||$>=In)continue;const X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,c.sortKey),se=X.vertexLength;zu(this.layoutVertexArray,G,$,-1,-1),zu(this.layoutVertexArray,G,$,1,-1),zu(this.layoutVertexArray,G,$,1,1),zu(this.layoutVertexArray,G,$,-1,1),this.indexArray.emplaceBack(se,se+1,se+2),this.indexArray.emplaceBack(se,se+3,se+2),X.vertexLength+=4,X.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,{},E)}}function Gc(h,c){for(let f=0;f<h.length;f++)if(Yl(c,h[f]))return!0;for(let f=0;f<c.length;f++)if(Yl(h,c[f]))return!0;return!!Qu(h,c)}function GA(h,c,f){return!!Yl(h,c)||!!kd(c,h,f)}function sA(h,c){if(h.length===1)return ta(c,h[0]);for(let f=0;f<c.length;f++){const v=c[f];for(let E=0;E<v.length;E++)if(Yl(h,v[E]))return!0}for(let f=0;f<h.length;f++)if(ta(c,h[f]))return!0;for(let f=0;f<c.length;f++)if(Qu(h,c[f]))return!0;return!1}function Rd(h,c,f){if(h.length>1){if(Qu(h,c))return!0;for(let v=0;v<c.length;v++)if(kd(c[v],h,f))return!0}for(let v=0;v<h.length;v++)if(kd(h[v],c,f))return!0;return!1}function Qu(h,c){if(h.length===0||c.length===0)return!1;for(let f=0;f<h.length-1;f++){const v=h[f],E=h[f+1];for(let M=0;M<c.length-1;M++)if(pu(v,E,c[M],c[M+1]))return!0}return!1}function pu(h,c,f,v){return Bt(h,f,v)!==Bt(c,f,v)&&Bt(h,c,f)!==Bt(h,c,v)}function kd(h,c,f){const v=f*f;if(c.length===1)return h.distSqr(c[0])<v;for(let E=1;E<c.length;E++)if(um(h,c[E-1],c[E])<v)return!0;return!1}function um(h,c,f){const v=c.distSqr(f);if(v===0)return h.distSqr(c);const E=((h.x-c.x)*(f.x-c.x)+(h.y-c.y)*(f.y-c.y))/v;return h.distSqr(E<0?c:E>1?f:f.sub(c)._mult(E)._add(c))}function ta(h,c){let f,v,E,M=!1;for(let D=0;D<h.length;D++){f=h[D];for(let G=0,$=f.length-1;G<f.length;$=G++)v=f[G],E=f[$],v.y>c.y!=E.y>c.y&&c.x<(E.x-v.x)*(c.y-v.y)/(E.y-v.y)+v.x&&(M=!M)}return M}function Yl(h,c){let f=!1;for(let v=0,E=h.length-1;v<h.length;E=v++){const M=h[v],D=h[E];M.y>c.y!=D.y>c.y&&c.x<(D.x-M.x)*(c.y-M.y)/(D.y-M.y)+M.x&&(f=!f)}return f}function oA(h,c,f){const v=f[0],E=f[2];if(h.x<v.x&&c.x<v.x||h.x>E.x&&c.x>E.x||h.y<v.y&&c.y<v.y||h.y>E.y&&c.y>E.y)return!1;const M=Bt(h,c,f[0]);return M!==Bt(h,c,f[1])||M!==Bt(h,c,f[2])||M!==Bt(h,c,f[3])}function xh(h,c,f){const v=c.paint.get(h).value;return v.kind==="constant"?v.value:f.programConfigurations.get(c.id).getMaxValue(h)}function gu(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function wh(h,c,f,v,E){if(!c[0]&&!c[1])return h;const M=k.convert(c)._mult(E);f==="viewport"&&M._rotate(-v);const D=[];for(let G=0;G<h.length;G++)D.push(h[G].sub(M));return D}let Bh,aA;Oi("CircleBucket",nA,{omit:["layers"]});var Jf={get paint(){return aA=aA||new tn({"circle-radius":new Ni(ut.paint_circle["circle-radius"]),"circle-color":new Ni(ut.paint_circle["circle-color"]),"circle-blur":new Ni(ut.paint_circle["circle-blur"]),"circle-opacity":new Ni(ut.paint_circle["circle-opacity"]),"circle-translate":new $i(ut.paint_circle["circle-translate"]),"circle-translate-anchor":new $i(ut.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $i(ut.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $i(ut.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ni(ut.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ni(ut.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ni(ut.paint_circle["circle-stroke-opacity"])})},get layout(){return Bh=Bh||new tn({"circle-sort-key":new Ni(ut.layout_circle["circle-sort-key"])})}},ia=1e-6,jc=typeof Float32Array<"u"?Float32Array:Array;function Od(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function lA(h,c,f){var v=c[0],E=c[1],M=c[2],D=c[3],G=c[4],$=c[5],X=c[6],se=c[7],Ae=c[8],me=c[9],Be=c[10],Te=c[11],ke=c[12],je=c[13],$e=c[14],ct=c[15],Ye=f[0],tt=f[1],gt=f[2],St=f[3];return h[0]=Ye*v+tt*G+gt*Ae+St*ke,h[1]=Ye*E+tt*$+gt*me+St*je,h[2]=Ye*M+tt*X+gt*Be+St*$e,h[3]=Ye*D+tt*se+gt*Te+St*ct,h[4]=(Ye=f[4])*v+(tt=f[5])*G+(gt=f[6])*Ae+(St=f[7])*ke,h[5]=Ye*E+tt*$+gt*me+St*je,h[6]=Ye*M+tt*X+gt*Be+St*$e,h[7]=Ye*D+tt*se+gt*Te+St*ct,h[8]=(Ye=f[8])*v+(tt=f[9])*G+(gt=f[10])*Ae+(St=f[11])*ke,h[9]=Ye*E+tt*$+gt*me+St*je,h[10]=Ye*M+tt*X+gt*Be+St*$e,h[11]=Ye*D+tt*se+gt*Te+St*ct,h[12]=(Ye=f[12])*v+(tt=f[13])*G+(gt=f[14])*Ae+(St=f[15])*ke,h[13]=Ye*E+tt*$+gt*me+St*je,h[14]=Ye*M+tt*X+gt*Be+St*$e,h[15]=Ye*D+tt*se+gt*Te+St*ct,h}Math.hypot||(Math.hypot=function(){for(var h=0,c=arguments.length;c--;)h+=arguments[c]*arguments[c];return Math.sqrt(h)});var vl,Ud=lA;function mu(h,c,f){var v=c[0],E=c[1],M=c[2],D=c[3];return h[0]=f[0]*v+f[4]*E+f[8]*M+f[12]*D,h[1]=f[1]*v+f[5]*E+f[9]*M+f[13]*D,h[2]=f[2]*v+f[6]*E+f[10]*M+f[14]*D,h[3]=f[3]*v+f[7]*E+f[11]*M+f[15]*D,h}vl=new jc(4),jc!=Float32Array&&(vl[0]=0,vl[1]=0,vl[2]=0,vl[3]=0);class bl extends Ro{constructor(c){super(c,Jf)}createBucket(c){return new nA(c)}queryRadius(c){const f=c;return xh("circle-radius",this,f)+xh("circle-stroke-width",this,f)+gu(this.paint.get("circle-translate"))}queryIntersectsFeature(c,f,v,E,M,D,G,$){const X=wh(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),D.angle,G),se=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),Ae=this.paint.get("circle-pitch-alignment")==="map",me=Ae?X:function(Te,ke){return Te.map(je=>Nd(je,ke))}(X,$),Be=Ae?se*G:se;for(const Te of E)for(const ke of Te){const je=Ae?ke:Nd(ke,$);let $e=Be;const ct=mu([],[ke.x,ke.y,0,1],$);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?$e*=ct[3]/D.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&($e*=D.cameraToCenterDistance/ct[3]),GA(me,je,$e))return!0}return!1}}function Nd(h,c){const f=mu([],[h.x,h.y,0,1],c);return new k(f[0]/f[3],f[1]/f[3])}class Ch extends nA{}let Yf;Oi("HeatmapBucket",Ch,{omit:["layers"]});var hm={get paint(){return Yf=Yf||new tn({"heatmap-radius":new Ni(ut.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ni(ut.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $i(ut.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Rs(ut.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $i(ut.paint_heatmap["heatmap-opacity"])})}};function ep(h,c,f,v){let{width:E,height:M}=c;if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==E*M*f)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${E*M*f}`)}else v=new Uint8Array(E*M*f);return h.width=E,h.height=M,h.data=v,h}function tp(h,c,f){let{width:v,height:E}=c;if(v===h.width&&E===h.height)return;const M=ep({},{width:v,height:E},f);ip(h,M,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,v),height:Math.min(h.height,E)},f),h.width=v,h.height=E,h.data=M.data}function ip(h,c,f,v,E,M){if(E.width===0||E.height===0)return c;if(E.width>h.width||E.height>h.height||f.x>h.width-E.width||f.y>h.height-E.height)throw new RangeError("out of range source coordinates for image copy");if(E.width>c.width||E.height>c.height||v.x>c.width-E.width||v.y>c.height-E.height)throw new RangeError("out of range destination coordinates for image copy");const D=h.data,G=c.data;if(D===G)throw new Error("srcData equals dstData, so image is already copied");for(let $=0;$<E.height;$++){const X=((f.y+$)*h.width+f.x)*M,se=((v.y+$)*c.width+v.x)*M;for(let Ae=0;Ae<E.width*M;Ae++)G[se+Ae]=D[X+Ae]}return c}class yc{constructor(c,f){ep(this,c,1,f)}resize(c){tp(this,c,1)}clone(){return new yc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,f,v,E,M){ip(c,f,v,E,M,1)}}class Uo{constructor(c,f){ep(this,c,4,f)}resize(c){tp(this,c,4)}replace(c,f){f?this.data.set(c):this.data=c instanceof Uint8ClampedArray?new Uint8Array(c.buffer):c}clone(){return new Uo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,f,v,E,M){ip(c,f,v,E,M,4)}}function cA(h){const c={},f=h.resolution||256,v=h.clips?h.clips.length:1,E=h.image||new Uo({width:f,height:v});if(Math.log(f)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${f}`);const M=(D,G,$)=>{c[h.evaluationKey]=$;const X=h.expression.evaluate(c);E.data[D+G+0]=Math.floor(255*X.r/X.a),E.data[D+G+1]=Math.floor(255*X.g/X.a),E.data[D+G+2]=Math.floor(255*X.b/X.a),E.data[D+G+3]=Math.floor(255*X.a)};if(h.clips)for(let D=0,G=0;D<v;++D,G+=4*f)for(let $=0,X=0;$<f;$++,X+=4){const se=$/(f-1),{start:Ae,end:me}=h.clips[D];M(G,X,Ae*(1-se)+me*se)}else for(let D=0,G=0;D<f;D++,G+=4)M(0,G,D/(f-1));return E}Oi("AlphaImage",yc),Oi("RGBAImage",Uo);class ka extends Ro{createBucket(c){return new Ch(c)}constructor(c){super(c,hm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=cA({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let xl;var Vu={get paint(){return xl=xl||new tn({"hillshade-illumination-direction":new $i(ut.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $i(ut.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $i(ut.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $i(ut.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $i(ut.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $i(ut.paint_hillshade["hillshade-accent-color"])})}};class zd extends Ro{constructor(c){super(c,Vu)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const rp=Nn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Am}=rp;var np={exports:{}};function uA(h,c,f){f=f||2;var v,E,M,D,G,$,X,se=c&&c.length,Ae=se?c[0]*f:h.length,me=Qd(h,0,Ae,f,!0),Be=[];if(!me||me.next===me.prev)return Be;if(se&&(me=function(ke,je,$e,ct){var Ye,tt,gt,St=[];for(Ye=0,tt=je.length;Ye<tt;Ye++)(gt=Qd(ke,je[Ye]*ct,Ye<tt-1?je[Ye+1]*ct:ke.length,ct,!1))===gt.next&&(gt.steiner=!0),St.push(sx(gt));for(St.sort(nx),Ye=0;Ye<St.length;Ye++)$e=fm(St[Ye],$e);return $e}(h,c,me,f)),h.length>80*f){v=M=h[0],E=D=h[1];for(var Te=f;Te<Ae;Te+=f)(G=h[Te])<v&&(v=G),($=h[Te+1])<E&&(E=$),G>M&&(M=G),$>D&&(D=$);X=(X=Math.max(M-v,D-E))!==0?32767/X:0}return sp(me,Be,f,v,E,X,0),Be}function Qd(h,c,f,v,E){var M,D;if(E===up(h,c,f,v)>0)for(M=c;M<f;M+=v)D=mm(M,h[M],h[M+1],D);else for(M=f-v;M>=c;M-=v)D=mm(M,h[M],h[M+1],D);return D&&Hd(D,D.next)&&(lp(D),D=D.next),D}function Eh(h,c){if(!h)return h;c||(c=h);var f,v=h;do if(f=!1,v.steiner||!Hd(v,v.next)&&Us(v.prev,v,v.next)!==0)v=v.next;else{if(lp(v),(v=c=v.prev)===v.next)break;f=!0}while(f||v!==c);return c}function sp(h,c,f,v,E,M,D){if(h){!D&&M&&function(se,Ae,me,Be){var Te=se;do Te.z===0&&(Te.z=jA(Te.x,Te.y,Ae,me,Be)),Te.prevZ=Te.prev,Te.nextZ=Te.next,Te=Te.next;while(Te!==se);Te.prevZ.nextZ=null,Te.prevZ=null,function(ke){var je,$e,ct,Ye,tt,gt,St,Xt,xi=1;do{for($e=ke,ke=null,tt=null,gt=0;$e;){for(gt++,ct=$e,St=0,je=0;je<xi&&(St++,ct=ct.nextZ);je++);for(Xt=xi;St>0||Xt>0&&ct;)St!==0&&(Xt===0||!ct||$e.z<=ct.z)?(Ye=$e,$e=$e.nextZ,St--):(Ye=ct,ct=ct.nextZ,Xt--),tt?tt.nextZ=Ye:ke=Ye,Ye.prevZ=tt,tt=Ye;$e=ct}tt.nextZ=null,xi*=2}while(gt>1)}(Te)}(h,v,E,M);for(var G,$,X=h;h.prev!==h.next;)if(G=h.prev,$=h.next,M?hI(h,v,E,M):Vd(h))c.push(G.i/f|0),c.push(h.i/f|0),c.push($.i/f|0),lp(h),h=$.next,X=$.next;else if((h=$)===X){D?D===1?sp(h=Xs(Eh(h),c,f),c,f,v,E,M,2):D===2&&dm(h,c,f,v,E,M):sp(Eh(h),c,f,v,E,M,1);break}}}function Vd(h){var c=h.prev,f=h,v=h.next;if(Us(c,f,v)>=0)return!1;for(var E=c.x,M=f.x,D=v.x,G=c.y,$=f.y,X=v.y,se=E<M?E<D?E:D:M<D?M:D,Ae=G<$?G<X?G:X:$<X?$:X,me=E>M?E>D?E:D:M>D?M:D,Be=G>$?G>X?G:X:$>X?$:X,Te=v.next;Te!==c;){if(Te.x>=se&&Te.x<=me&&Te.y>=Ae&&Te.y<=Be&&qA(E,G,M,$,D,X,Te.x,Te.y)&&Us(Te.prev,Te,Te.next)>=0)return!1;Te=Te.next}return!0}function hI(h,c,f,v){var E=h.prev,M=h,D=h.next;if(Us(E,M,D)>=0)return!1;for(var G=E.x,$=M.x,X=D.x,se=E.y,Ae=M.y,me=D.y,Be=G<$?G<X?G:X:$<X?$:X,Te=se<Ae?se<me?se:me:Ae<me?Ae:me,ke=G>$?G>X?G:X:$>X?$:X,je=se>Ae?se>me?se:me:Ae>me?Ae:me,$e=jA(Be,Te,c,f,v),ct=jA(ke,je,c,f,v),Ye=h.prevZ,tt=h.nextZ;Ye&&Ye.z>=$e&&tt&&tt.z<=ct;){if(Ye.x>=Be&&Ye.x<=ke&&Ye.y>=Te&&Ye.y<=je&&Ye!==E&&Ye!==D&&qA(G,se,$,Ae,X,me,Ye.x,Ye.y)&&Us(Ye.prev,Ye,Ye.next)>=0||(Ye=Ye.prevZ,tt.x>=Be&&tt.x<=ke&&tt.y>=Te&&tt.y<=je&&tt!==E&&tt!==D&&qA(G,se,$,Ae,X,me,tt.x,tt.y)&&Us(tt.prev,tt,tt.next)>=0))return!1;tt=tt.nextZ}for(;Ye&&Ye.z>=$e;){if(Ye.x>=Be&&Ye.x<=ke&&Ye.y>=Te&&Ye.y<=je&&Ye!==E&&Ye!==D&&qA(G,se,$,Ae,X,me,Ye.x,Ye.y)&&Us(Ye.prev,Ye,Ye.next)>=0)return!1;Ye=Ye.prevZ}for(;tt&&tt.z<=ct;){if(tt.x>=Be&&tt.x<=ke&&tt.y>=Te&&tt.y<=je&&tt!==E&&tt!==D&&qA(G,se,$,Ae,X,me,tt.x,tt.y)&&Us(tt.prev,tt,tt.next)>=0)return!1;tt=tt.nextZ}return!0}function Xs(h,c,f){var v=h;do{var E=v.prev,M=v.next.next;!Hd(E,M)&&R0(E,v,v.next,M)&&Sh(E,M)&&Sh(M,E)&&(c.push(E.i/f|0),c.push(v.i/f|0),c.push(M.i/f|0),lp(v),lp(v.next),v=h=M),v=v.next}while(v!==h);return Eh(v)}function dm(h,c,f,v,E,M){var D=h;do{for(var G=D.next.next;G!==D.prev;){if(D.i!==G.i&&op(D,G)){var $=ox(D,G);return D=Eh(D,D.next),$=Eh($,$.next),sp(D,c,f,v,E,M,0),void sp($,c,f,v,E,M,0)}G=G.next}D=D.next}while(D!==h)}function nx(h,c){return h.x-c.x}function fm(h,c){var f=function(E,M){var D,G=M,$=E.x,X=E.y,se=-1/0;do{if(X<=G.y&&X>=G.next.y&&G.next.y!==G.y){var Ae=G.x+(X-G.y)*(G.next.x-G.x)/(G.next.y-G.y);if(Ae<=$&&Ae>se&&(se=Ae,D=G.x<G.next.x?G:G.next,Ae===$))return D}G=G.next}while(G!==M);if(!D)return null;var me,Be=D,Te=D.x,ke=D.y,je=1/0;G=D;do $>=G.x&&G.x>=Te&&$!==G.x&&qA(X<ke?$:se,X,Te,ke,X<ke?se:$,X,G.x,G.y)&&(me=Math.abs(X-G.y)/($-G.x),Sh(G,E)&&(me<je||me===je&&(G.x>D.x||G.x===D.x&&pm(D,G)))&&(D=G,je=me)),G=G.next;while(G!==Be);return D}(h,c);if(!f)return c;var v=ox(f,h);return Eh(v,v.next),Eh(f,f.next)}function pm(h,c){return Us(h.prev,h,c.prev)<0&&Us(c.next,h,h.next)<0}function jA(h,c,f,v,E){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-f)*E|0)|h<<8))|h<<4))|h<<2))|h<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-v)*E|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function sx(h){var c=h,f=h;do(c.x<f.x||c.x===f.x&&c.y<f.y)&&(f=c),c=c.next;while(c!==h);return f}function qA(h,c,f,v,E,M,D,G){return(E-D)*(c-G)>=(h-D)*(M-G)&&(h-D)*(v-G)>=(f-D)*(c-G)&&(f-D)*(M-G)>=(E-D)*(v-G)}function op(h,c){return h.next.i!==c.i&&h.prev.i!==c.i&&!function(f,v){var E=f;do{if(E.i!==f.i&&E.next.i!==f.i&&E.i!==v.i&&E.next.i!==v.i&&R0(E,E.next,f,v))return!0;E=E.next}while(E!==f);return!1}(h,c)&&(Sh(h,c)&&Sh(c,h)&&function(f,v){var E=f,M=!1,D=(f.x+v.x)/2,G=(f.y+v.y)/2;do E.y>G!=E.next.y>G&&E.next.y!==E.y&&D<(E.next.x-E.x)*(G-E.y)/(E.next.y-E.y)+E.x&&(M=!M),E=E.next;while(E!==f);return M}(h,c)&&(Us(h.prev,h,c.prev)||Us(h,c.prev,c))||Hd(h,c)&&Us(h.prev,h,h.next)>0&&Us(c.prev,c,c.next)>0)}function Us(h,c,f){return(c.y-h.y)*(f.x-c.x)-(c.x-h.x)*(f.y-c.y)}function Hd(h,c){return h.x===c.x&&h.y===c.y}function R0(h,c,f,v){var E=ap(Us(h,c,f)),M=ap(Us(h,c,v)),D=ap(Us(f,v,h)),G=ap(Us(f,v,c));return E!==M&&D!==G||!(E!==0||!gm(h,f,c))||!(M!==0||!gm(h,v,c))||!(D!==0||!gm(f,h,v))||!(G!==0||!gm(f,c,v))}function gm(h,c,f){return c.x<=Math.max(h.x,f.x)&&c.x>=Math.min(h.x,f.x)&&c.y<=Math.max(h.y,f.y)&&c.y>=Math.min(h.y,f.y)}function ap(h){return h>0?1:h<0?-1:0}function Sh(h,c){return Us(h.prev,h,h.next)<0?Us(h,c,h.next)>=0&&Us(h,h.prev,c)>=0:Us(h,c,h.prev)<0||Us(h,h.next,c)<0}function ox(h,c){var f=new cp(h.i,h.x,h.y),v=new cp(c.i,c.x,c.y),E=h.next,M=c.prev;return h.next=c,c.prev=h,f.next=E,E.prev=f,v.next=f,f.prev=v,M.next=v,v.prev=M,v}function mm(h,c,f,v){var E=new cp(h,c,f);return v?(E.next=v.next,E.prev=v,v.next.prev=E,v.next=E):(E.prev=E,E.next=E),E}function lp(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function cp(h,c,f){this.i=h,this.x=c,this.y=f,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function up(h,c,f,v){for(var E=0,M=c,D=f-v;M<f;M+=v)E+=(h[D]-h[M])*(h[M+1]+h[D+1]),D=M;return E}np.exports=uA,np.exports.default=uA,uA.deviation=function(h,c,f,v){var E=c&&c.length,M=Math.abs(up(h,0,E?c[0]*f:h.length,f));if(E)for(var D=0,G=c.length;D<G;D++)M-=Math.abs(up(h,c[D]*f,D<G-1?c[D+1]*f:h.length,f));var $=0;for(D=0;D<v.length;D+=3){var X=v[D]*f,se=v[D+1]*f,Ae=v[D+2]*f;$+=Math.abs((h[X]-h[Ae])*(h[se+1]-h[X+1])-(h[X]-h[se])*(h[Ae+1]-h[X+1]))}return M===0&&$===0?0:Math.abs(($-M)/M)},uA.flatten=function(h){for(var c=h[0][0].length,f={vertices:[],holes:[],dimensions:c},v=0,E=0;E<h.length;E++){for(var M=0;M<h[E].length;M++)for(var D=0;D<c;D++)f.vertices.push(h[E][M][D]);E>0&&f.holes.push(v+=h[E-1].length)}return f};var ym=b(np.exports);function ax(h,c,f,v,E){k0(h,c,f||0,v||h.length-1,E||AI)}function k0(h,c,f,v,E){for(;v>f;){if(v-f>600){var M=v-f+1,D=c-f+1,G=Math.log(M),$=.5*Math.exp(2*G/3),X=.5*Math.sqrt(G*$*(M-$)/M)*(D-M/2<0?-1:1);k0(h,c,Math.max(f,Math.floor(c-D*$/M+X)),Math.min(v,Math.floor(c+(M-D)*$/M+X)),E)}var se=h[c],Ae=f,me=v;for(hp(h,f,c),E(h[v],se)>0&&hp(h,f,v);Ae<me;){for(hp(h,Ae,me),Ae++,me--;E(h[Ae],se)<0;)Ae++;for(;E(h[me],se)>0;)me--}E(h[f],se)===0?hp(h,f,me):hp(h,++me,v),me<=c&&(f=me+1),c<=me&&(v=me-1)}}function hp(h,c,f){var v=h[c];h[c]=h[f],h[f]=v}function AI(h,c){return h<c?-1:h>c?1:0}function O0(h,c){const f=h.length;if(f<=1)return[h];const v=[];let E,M;for(let D=0;D<f;D++){const G=Ct(h[D]);G!==0&&(h[D].area=Math.abs(G),M===void 0&&(M=G<0),M===G<0?(E&&v.push(E),E=[h[D]]):E.push(h[D]))}if(E&&v.push(E),c>1)for(let D=0;D<v.length;D++)v[D].length<=c||(ax(v[D],c,1,v[D].length-1,dI),v[D]=v[D].slice(0,c));return v}function dI(h,c){return c.area-h.area}function U0(h,c,f){const v=f.patternDependencies;let E=!1;for(const M of c){const D=M.paint.get(`${h}-pattern`);D.isConstant()||(E=!0);const G=D.constantOr(null);G&&(E=!0,v[G.to]=!0,v[G.from]=!0)}return E}function Hu(h,c,f,v,E){const M=E.patternDependencies;for(const D of c){const G=D.paint.get(`${h}-pattern`).value;if(G.kind!=="constant"){let $=G.evaluate({zoom:v-1},f,{},E.availableImages),X=G.evaluate({zoom:v},f,{},E.availableImages),se=G.evaluate({zoom:v+1},f,{},E.availableImages);$=$&&$.name?$.name:$,X=X&&X.name?X.name:X,se=se&&se.name?se.name:se,M[$]=!0,M[X]=!0,M[se]=!0,f.patterns[D.id]={min:$,mid:X,max:se}}}return f}class N0{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(f=>f.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new nt,this.indexArray=new Vt,this.indexArray2=new _i,this.programConfigurations=new oo(c.layers,c.zoom),this.segments=new Ti,this.segments2=new Ti,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(c,f,v){this.hasPattern=U0("fill",this.layers,f);const E=this.layers[0].layout.get("fill-sort-key"),M=!E.isConstant(),D=[];for(const{feature:G,id:$,index:X,sourceLayerIndex:se}of c){const Ae=this.layers[0]._featureFilter.needGeometry,me=Hc(G,Ae);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),me,v))continue;const Be=M?E.evaluate(me,{},v,f.availableImages):void 0,Te={id:$,properties:G.properties,type:G.type,sourceLayerIndex:se,index:X,geometry:Ae?me.geometry:Vc(G),patterns:{},sortKey:Be};D.push(Te)}M&&D.sort((G,$)=>G.sortKey-$.sortKey);for(const G of D){const{geometry:$,index:X,sourceLayerIndex:se}=G;if(this.hasPattern){const Ae=Hu("fill",this.layers,G,this.zoom,f);this.patternFeatures.push(Ae)}else this.addFeature(G,$,X,v,{});f.featureIndex.insert(c[X].feature,$,X,se,this.index)}}update(c,f,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,f,this.stateDependentLayers,v)}addFeatures(c,f,v){for(const E of this.patternFeatures)this.addFeature(E,E.geometry,E.index,f,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Am),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,f,v,E,M){for(const D of O0(f,500)){let G=0;for(const Be of D)G+=Be.length;const $=this.segments.prepareSegment(G,this.layoutVertexArray,this.indexArray),X=$.vertexLength,se=[],Ae=[];for(const Be of D){if(Be.length===0)continue;Be!==D[0]&&Ae.push(se.length/2);const Te=this.segments2.prepareSegment(Be.length,this.layoutVertexArray,this.indexArray2),ke=Te.vertexLength;this.layoutVertexArray.emplaceBack(Be[0].x,Be[0].y),this.indexArray2.emplaceBack(ke+Be.length-1,ke),se.push(Be[0].x),se.push(Be[0].y);for(let je=1;je<Be.length;je++)this.layoutVertexArray.emplaceBack(Be[je].x,Be[je].y),this.indexArray2.emplaceBack(ke+je-1,ke+je),se.push(Be[je].x),se.push(Be[je].y);Te.vertexLength+=Be.length,Te.primitiveLength+=Be.length}const me=ym(se,Ae);for(let Be=0;Be<me.length;Be+=3)this.indexArray.emplaceBack(X+me[Be],X+me[Be+1],X+me[Be+2]);$.vertexLength+=G,$.primitiveLength+=me.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,M,E)}}let z0,$A;Oi("FillBucket",N0,{omit:["layers","patternFeatures"]});var fI={get paint(){return $A=$A||new tn({"fill-antialias":new $i(ut.paint_fill["fill-antialias"]),"fill-opacity":new Ni(ut.paint_fill["fill-opacity"]),"fill-color":new Ni(ut.paint_fill["fill-color"]),"fill-outline-color":new Ni(ut.paint_fill["fill-outline-color"]),"fill-translate":new $i(ut.paint_fill["fill-translate"]),"fill-translate-anchor":new $i(ut.paint_fill["fill-translate-anchor"]),"fill-pattern":new $n(ut.paint_fill["fill-pattern"])})},get layout(){return z0=z0||new tn({"fill-sort-key":new Ni(ut.layout_fill["fill-sort-key"])})}};class pI extends Ro{constructor(c){super(c,fI)}recalculate(c,f){super.recalculate(c,f);const v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new N0(c)}queryRadius(){return gu(this.paint.get("fill-translate"))}queryIntersectsFeature(c,f,v,E,M,D,G){return sA(wh(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),D.angle,G),E)}isTileClipped(){return!0}}const gI=Nn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),lx=Nn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:cx}=gI;var hA={},mI=T,ux=Gd;function Gd(h,c,f,v,E){this.properties={},this.extent=f,this.type=0,this._pbf=h,this._geometry=-1,this._keys=v,this._values=E,h.readFields(Q0,this,c)}function Q0(h,c,f){h==1?c.id=f.readVarint():h==2?function(v,E){for(var M=v.readVarint()+v.pos;v.pos<M;){var D=E._keys[v.readVarint()],G=E._values[v.readVarint()];E.properties[D]=G}}(f,c):h==3?c.type=f.readVarint():h==4&&(c._geometry=f.pos)}function Ap(h){for(var c,f,v=0,E=0,M=h.length,D=M-1;E<M;D=E++)v+=((f=h[D]).x-(c=h[E]).x)*(c.y+f.y);return v}Gd.types=["Unknown","Point","LineString","Polygon"],Gd.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var c,f=h.readVarint()+h.pos,v=1,E=0,M=0,D=0,G=[];h.pos<f;){if(E<=0){var $=h.readVarint();v=7&$,E=$>>3}if(E--,v===1||v===2)M+=h.readSVarint(),D+=h.readSVarint(),v===1&&(c&&G.push(c),c=[]),c.push(new mI(M,D));else{if(v!==7)throw new Error("unknown command "+v);c&&c.push(c[0].clone())}}return c&&G.push(c),G},Gd.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var c=h.readVarint()+h.pos,f=1,v=0,E=0,M=0,D=1/0,G=-1/0,$=1/0,X=-1/0;h.pos<c;){if(v<=0){var se=h.readVarint();f=7&se,v=se>>3}if(v--,f===1||f===2)(E+=h.readSVarint())<D&&(D=E),E>G&&(G=E),(M+=h.readSVarint())<$&&($=M),M>X&&(X=M);else if(f!==7)throw new Error("unknown command "+f)}return[D,$,G,X]},Gd.prototype.toGeoJSON=function(h,c,f){var v,E,M=this.extent*Math.pow(2,f),D=this.extent*h,G=this.extent*c,$=this.loadGeometry(),X=Gd.types[this.type];function se(Be){for(var Te=0;Te<Be.length;Te++){var ke=Be[Te];Be[Te]=[360*(ke.x+D)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(ke.y+G)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var Ae=[];for(v=0;v<$.length;v++)Ae[v]=$[v][0];se($=Ae);break;case 2:for(v=0;v<$.length;v++)se($[v]);break;case 3:for($=function(Be){var Te=Be.length;if(Te<=1)return[Be];for(var ke,je,$e=[],ct=0;ct<Te;ct++){var Ye=Ap(Be[ct]);Ye!==0&&(je===void 0&&(je=Ye<0),je===Ye<0?(ke&&$e.push(ke),ke=[Be[ct]]):ke.push(Be[ct]))}return ke&&$e.push(ke),$e}($),v=0;v<$.length;v++)for(E=0;E<$[v].length;E++)se($[v][E])}$.length===1?$=$[0]:X="Multi"+X;var me={type:"Feature",geometry:{type:X,coordinates:$},properties:this.properties};return"id"in this&&(me.id=this.id),me};var V0=ux,hx=Ax;function Ax(h,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(dx,this,c),this.length=this._features.length}function dx(h,c,f){h===15?c.version=f.readVarint():h===1?c.name=f.readString():h===5?c.extent=f.readVarint():h===2?c._features.push(f.pos):h===3?c._keys.push(f.readString()):h===4&&c._values.push(function(v){for(var E=null,M=v.readVarint()+v.pos;v.pos<M;){var D=v.readVarint()>>3;E=D===1?v.readString():D===2?v.readFloat():D===3?v.readDouble():D===4?v.readVarint64():D===5?v.readVarint():D===6?v.readSVarint():D===7?v.readBoolean():null}return E}(f))}Ax.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var c=this._pbf.readVarint()+this._pbf.pos;return new V0(this._pbf,c,this.extent,this._keys,this._values)};var yI=hx;function _I(h,c,f){if(h===3){var v=new yI(f,f.readVarint()+f.pos);v.length&&(c[v.name]=v)}}hA.VectorTile=function(h,c){this.layers=h.readFields(_I,{},c)},hA.VectorTileFeature=ux,hA.VectorTileLayer=hx;const dp=hA.VectorTileFeature.types,_m=Math.pow(2,13);function fp(h,c,f,v,E,M,D,G){h.emplaceBack(c,f,2*Math.floor(v*_m)+D,E*_m*2,M*_m*2,Math.round(G))}class H0{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(f=>f.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new Ke,this.centroidVertexArray=new Fe,this.indexArray=new Vt,this.programConfigurations=new oo(c.layers,c.zoom),this.segments=new Ti,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(c,f,v){this.features=[],this.hasPattern=U0("fill-extrusion",this.layers,f);for(const{feature:E,id:M,index:D,sourceLayerIndex:G}of c){const $=this.layers[0]._featureFilter.needGeometry,X=Hc(E,$);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),X,v))continue;const se={id:M,sourceLayerIndex:G,index:D,geometry:$?X.geometry:Vc(E),properties:E.properties,type:E.type,patterns:{}};this.hasPattern?this.features.push(Hu("fill-extrusion",this.layers,se,this.zoom,f)):this.addFeature(se,se.geometry,D,v,{}),f.featureIndex.insert(E,se.geometry,D,G,this.index,!0)}}addFeatures(c,f,v){for(const E of this.features){const{geometry:M}=E;this.addFeature(E,M,E.index,f,v)}}update(c,f,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,f,this.stateDependentLayers,v)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,cx),this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,lx.members,!0),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(c,f,v,E,M){const D={x:0,y:0,vertexCount:0};for(const G of O0(f,500)){let $=0;for(const Te of G)$+=Te.length;let X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Te of G){if(Te.length===0||bI(Te))continue;let ke=0;for(let je=0;je<Te.length;je++){const $e=Te[je];if(je>=1){const ct=Te[je-1];if(!vI($e,ct)){X.vertexLength+4>Ti.MAX_VERTEX_ARRAY_LENGTH&&(X=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ye=$e.sub(ct)._perp()._unit(),tt=ct.dist($e);ke+tt>32768&&(ke=0),fp(this.layoutVertexArray,$e.x,$e.y,Ye.x,Ye.y,0,0,ke),fp(this.layoutVertexArray,$e.x,$e.y,Ye.x,Ye.y,0,1,ke),D.x+=2*$e.x,D.y+=2*$e.y,D.vertexCount+=2,ke+=tt,fp(this.layoutVertexArray,ct.x,ct.y,Ye.x,Ye.y,0,0,ke),fp(this.layoutVertexArray,ct.x,ct.y,Ye.x,Ye.y,0,1,ke),D.x+=2*ct.x,D.y+=2*ct.y,D.vertexCount+=2;const gt=X.vertexLength;this.indexArray.emplaceBack(gt,gt+2,gt+1),this.indexArray.emplaceBack(gt+1,gt+2,gt+3),X.vertexLength+=4,X.primitiveLength+=2}}}}if(X.vertexLength+$>Ti.MAX_VERTEX_ARRAY_LENGTH&&(X=this.segments.prepareSegment($,this.layoutVertexArray,this.indexArray)),dp[c.type]!=="Polygon")continue;const se=[],Ae=[],me=X.vertexLength;for(const Te of G)if(Te.length!==0){Te!==G[0]&&Ae.push(se.length/2);for(let ke=0;ke<Te.length;ke++){const je=Te[ke];fp(this.layoutVertexArray,je.x,je.y,0,0,1,1,0),D.x+=je.x,D.y+=je.y,D.vertexCount+=1,se.push(je.x),se.push(je.y)}}const Be=ym(se,Ae);for(let Te=0;Te<Be.length;Te+=3)this.indexArray.emplaceBack(me+Be[Te],me+Be[Te+2],me+Be[Te+1]);X.primitiveLength+=Be.length/3,X.vertexLength+=$}for(let G=0;G<D.vertexCount;G++)this.centroidVertexArray.emplaceBack(Math.floor(D.x/D.vertexCount),Math.floor(D.y/D.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,M,E)}}function vI(h,c){return h.x===c.x&&(h.x<0||h.x>In)||h.y===c.y&&(h.y<0||h.y>In)}function bI(h){return h.every(c=>c.x<0)||h.every(c=>c.x>In)||h.every(c=>c.y<0)||h.every(c=>c.y>In)}let fx;Oi("FillExtrusionBucket",H0,{omit:["layers","features"]});var xI={get paint(){return fx=fx||new tn({"fill-extrusion-opacity":new $i(ut["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ni(ut["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $i(ut["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $i(ut["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $n(ut["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ni(ut["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ni(ut["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $i(ut["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class px extends Ro{constructor(c){super(c,xI)}createBucket(c){return new H0(c)}queryRadius(){return gu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,f,v,E,M,D,G,$){const X=wh(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),D.angle,G),se=this.paint.get("fill-extrusion-height").evaluate(f,v),Ae=this.paint.get("fill-extrusion-base").evaluate(f,v),me=function(Te,ke,je,$e){const ct=[];for(const Ye of Te){const tt=[Ye.x,Ye.y,0,1];mu(tt,tt,ke),ct.push(new k(tt[0]/tt[3],tt[1]/tt[3]))}return ct}(X,$),Be=function(Te,ke,je,$e){const ct=[],Ye=[],tt=$e[8]*ke,gt=$e[9]*ke,St=$e[10]*ke,Xt=$e[11]*ke,xi=$e[8]*je,oi=$e[9]*je,Ai=$e[10]*je,fi=$e[11]*je;for(const Fi of Te){const ai=[],Zt=[];for(const Vi of Fi){const Qi=Vi.x,gr=Vi.y,Dr=$e[0]*Qi+$e[4]*gr+$e[12],zr=$e[1]*Qi+$e[5]*gr+$e[13],pn=$e[2]*Qi+$e[6]*gr+$e[14],as=$e[3]*Qi+$e[7]*gr+$e[15],zn=pn+St,vn=as+Xt,Pn=Dr+xi,cn=zr+oi,vr=pn+Ai,Qn=as+fi,un=new k((Dr+tt)/vn,(zr+gt)/vn);un.z=zn/vn,ai.push(un);const en=new k(Pn/Qn,cn/Qn);en.z=vr/Qn,Zt.push(en)}ct.push(ai),Ye.push(Zt)}return[ct,Ye]}(E,Ae,se,$);return function(Te,ke,je){let $e=1/0;sA(je,ke)&&($e=G0(je,ke[0]));for(let ct=0;ct<ke.length;ct++){const Ye=ke[ct],tt=Te[ct];for(let gt=0;gt<Ye.length-1;gt++){const St=Ye[gt],Xt=[St,Ye[gt+1],tt[gt+1],tt[gt],St];Gc(je,Xt)&&($e=Math.min($e,G0(je,Xt)))}}return $e!==1/0&&$e}(Be[0],Be[1],me)}}function KA(h,c){return h.x*c.x+h.y*c.y}function G0(h,c){if(h.length===1){let f=0;const v=c[f++];let E;for(;!E||v.equals(E);)if(E=c[f++],!E)return 1/0;for(;f<c.length;f++){const M=c[f],D=h[0],G=E.sub(v),$=M.sub(v),X=D.sub(v),se=KA(G,G),Ae=KA(G,$),me=KA($,$),Be=KA(X,G),Te=KA(X,$),ke=se*me-Ae*Ae,je=(me*Be-Ae*Te)/ke,$e=(se*Te-Ae*Be)/ke,ct=v.z*(1-je-$e)+E.z*je+M.z*$e;if(isFinite(ct))return ct}return 1/0}{let f=1/0;for(const v of c)f=Math.min(f,v.z);return f}}const gx=Nn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:mx}=gx,wI=Nn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:vm}=wI,BI=hA.VectorTileFeature.types,yx=Math.cos(Math.PI/180*37.5),_x=Math.pow(2,14)/.5;class j0{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(f=>f.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(f=>{this.gradients[f.id]={}}),this.layoutVertexArray=new Re,this.layoutVertexArray2=new Qe,this.indexArray=new Vt,this.programConfigurations=new oo(c.layers,c.zoom),this.segments=new Ti,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(c,f,v){this.hasPattern=U0("line",this.layers,f);const E=this.layers[0].layout.get("line-sort-key"),M=!E.isConstant(),D=[];for(const{feature:G,id:$,index:X,sourceLayerIndex:se}of c){const Ae=this.layers[0]._featureFilter.needGeometry,me=Hc(G,Ae);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),me,v))continue;const Be=M?E.evaluate(me,{},v):void 0,Te={id:$,properties:G.properties,type:G.type,sourceLayerIndex:se,index:X,geometry:Ae?me.geometry:Vc(G),patterns:{},sortKey:Be};D.push(Te)}M&&D.sort((G,$)=>G.sortKey-$.sortKey);for(const G of D){const{geometry:$,index:X,sourceLayerIndex:se}=G;if(this.hasPattern){const Ae=Hu("line",this.layers,G,this.zoom,f);this.patternFeatures.push(Ae)}else this.addFeature(G,$,X,v,{});f.featureIndex.insert(c[X].feature,$,X,se,this.index)}}update(c,f,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,f,this.stateDependentLayers,v)}addFeatures(c,f,v){for(const E of this.patternFeatures)this.addFeature(E,E.geometry,E.index,f,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,vm)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,mx),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,f,v,E,M){const D=this.layers[0].layout,G=D.get("line-join").evaluate(c,{}),$=D.get("line-cap"),X=D.get("line-miter-limit"),se=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const Ae of f)this.addLine(Ae,c,G,$,X,se);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,M,E)}addLine(c,f,v,E,M,D){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let $e=0;$e<c.length-1;$e++)this.totalDistance+=c[$e].dist(c[$e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const G=BI[f.type]==="Polygon";let $=c.length;for(;$>=2&&c[$-1].equals(c[$-2]);)$--;let X=0;for(;X<$-1&&c[X].equals(c[X+1]);)X++;if($<(G?3:2))return;v==="bevel"&&(M=1.05);const se=this.overscaling<=16?15*In/(512*this.overscaling):0,Ae=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray);let me,Be,Te,ke,je;this.e1=this.e2=-1,G&&(me=c[$-2],je=c[X].sub(me)._unit()._perp());for(let $e=X;$e<$;$e++){if(Te=$e===$-1?G?c[X+1]:void 0:c[$e+1],Te&&c[$e].equals(Te))continue;je&&(ke=je),me&&(Be=me),me=c[$e],je=Te?Te.sub(me)._unit()._perp():ke,ke=ke||je;let ct=ke.add(je);ct.x===0&&ct.y===0||ct._unit();const Ye=ke.x*je.x+ke.y*je.y,tt=ct.x*je.x+ct.y*je.y,gt=tt!==0?1/tt:1/0,St=2*Math.sqrt(2-2*tt),Xt=tt<yx&&Be&&Te,xi=ke.x*je.y-ke.y*je.x>0;if(Xt&&$e>X){const fi=me.dist(Be);if(fi>2*se){const Fi=me.sub(me.sub(Be)._mult(se/fi)._round());this.updateDistance(Be,Fi),this.addCurrentVertex(Fi,ke,0,0,Ae),Be=Fi}}const oi=Be&&Te;let Ai=oi?v:G?"butt":E;if(oi&&Ai==="round"&&(gt<D?Ai="miter":gt<=2&&(Ai="fakeround")),Ai==="miter"&&gt>M&&(Ai="bevel"),Ai==="bevel"&&(gt>2&&(Ai="flipbevel"),gt<M&&(Ai="miter")),Be&&this.updateDistance(Be,me),Ai==="miter")ct._mult(gt),this.addCurrentVertex(me,ct,0,0,Ae);else if(Ai==="flipbevel"){if(gt>100)ct=je.mult(-1);else{const fi=gt*ke.add(je).mag()/ke.sub(je).mag();ct._perp()._mult(fi*(xi?-1:1))}this.addCurrentVertex(me,ct,0,0,Ae),this.addCurrentVertex(me,ct.mult(-1),0,0,Ae)}else if(Ai==="bevel"||Ai==="fakeround"){const fi=-Math.sqrt(gt*gt-1),Fi=xi?fi:0,ai=xi?0:fi;if(Be&&this.addCurrentVertex(me,ke,Fi,ai,Ae),Ai==="fakeround"){const Zt=Math.round(180*St/Math.PI/20);for(let Vi=1;Vi<Zt;Vi++){let Qi=Vi/Zt;if(Qi!==.5){const Dr=Qi-.5;Qi+=Qi*Dr*(Qi-1)*((1.0904+Ye*(Ye*(3.55645-1.43519*Ye)-3.2452))*Dr*Dr+(.848013+Ye*(.215638*Ye-1.06021)))}const gr=je.sub(ke)._mult(Qi)._add(ke)._unit()._mult(xi?-1:1);this.addHalfVertex(me,gr.x,gr.y,!1,xi,0,Ae)}}Te&&this.addCurrentVertex(me,je,-Fi,-ai,Ae)}else if(Ai==="butt")this.addCurrentVertex(me,ct,0,0,Ae);else if(Ai==="square"){const fi=Be?1:-1;this.addCurrentVertex(me,ct,fi,fi,Ae)}else Ai==="round"&&(Be&&(this.addCurrentVertex(me,ke,0,0,Ae),this.addCurrentVertex(me,ke,1,1,Ae,!0)),Te&&(this.addCurrentVertex(me,je,-1,-1,Ae,!0),this.addCurrentVertex(me,je,0,0,Ae)));if(Xt&&$e<$-1){const fi=me.dist(Te);if(fi>2*se){const Fi=me.add(Te.sub(me)._mult(se/fi)._round());this.updateDistance(me,Fi),this.addCurrentVertex(Fi,je,0,0,Ae),me=Fi}}}}addCurrentVertex(c,f,v,E,M){let D=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const G=f.y*E-f.x,$=-f.y-f.x*E;this.addHalfVertex(c,f.x+f.y*v,f.y-f.x*v,D,!1,v,M),this.addHalfVertex(c,G,$,D,!0,-E,M),this.distance>_x/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(c,f,v,E,M,D))}addHalfVertex(c,f,v,E,M,D,G){let{x:$,y:X}=c;const se=.5*(this.lineClips?this.scaledDistance*(_x-1):this.scaledDistance);this.layoutVertexArray.emplaceBack(($<<1)+(E?1:0),(X<<1)+(M?1:0),Math.round(63*f)+128,Math.round(63*v)+128,1+(D===0?0:D<0?-1:1)|(63&se)<<2,se>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const Ae=G.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,Ae),G.primitiveLength++),M?this.e2=Ae:this.e1=Ae}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(c,f){this.distance+=c.dist(f),this.updateScaledDistance()}}let vx,q0;Oi("LineBucket",j0,{omit:["layers","patternFeatures"]});var bx={get paint(){return q0=q0||new tn({"line-opacity":new Ni(ut.paint_line["line-opacity"]),"line-color":new Ni(ut.paint_line["line-color"]),"line-translate":new $i(ut.paint_line["line-translate"]),"line-translate-anchor":new $i(ut.paint_line["line-translate-anchor"]),"line-width":new Ni(ut.paint_line["line-width"]),"line-gap-width":new Ni(ut.paint_line["line-gap-width"]),"line-offset":new Ni(ut.paint_line["line-offset"]),"line-blur":new Ni(ut.paint_line["line-blur"]),"line-dasharray":new Uu(ut.paint_line["line-dasharray"]),"line-pattern":new $n(ut.paint_line["line-pattern"]),"line-gradient":new Rs(ut.paint_line["line-gradient"])})},get layout(){return vx=vx||new tn({"line-cap":new $i(ut.layout_line["line-cap"]),"line-join":new Ni(ut.layout_line["line-join"]),"line-miter-limit":new $i(ut.layout_line["line-miter-limit"]),"line-round-limit":new $i(ut.layout_line["line-round-limit"]),"line-sort-key":new Ni(ut.layout_line["line-sort-key"])})}};class CI extends Ni{possiblyEvaluate(c,f){return f=new bi(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),super.possiblyEvaluate(c,f)}evaluate(c,f,v,E){return f=Ue({},f,{zoom:Math.floor(f.zoom)}),super.evaluate(c,f,v,E)}}let AA;class _o extends Ro{constructor(c){super(c,bx),this.gradientVersion=0,AA||(AA=new CI(bx.paint.properties["line-width"].specification),AA.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const f=this.gradientExpression();this.stepInterpolant=!!function(v){return v._styleExpression!==void 0}(f)&&f._styleExpression.expression instanceof ho,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,f){super.recalculate(c,f),this.paint._values["line-floorwidth"]=AA.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new j0(c)}queryRadius(c){const f=c,v=$0(xh("line-width",this,f),xh("line-gap-width",this,f)),E=xh("line-offset",this,f);return v/2+Math.abs(E)+gu(this.paint.get("line-translate"))}queryIntersectsFeature(c,f,v,E,M,D,G){const $=wh(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),D.angle,G),X=G/2*$0(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),se=this.paint.get("line-offset").evaluate(f,v);return se&&(E=function(Ae,me){const Be=[];for(let Te=0;Te<Ae.length;Te++){const ke=Ae[Te],je=[];for(let $e=0;$e<ke.length;$e++){const ct=ke[$e-1],Ye=ke[$e],tt=ke[$e+1],gt=$e===0?new k(0,0):Ye.sub(ct)._unit()._perp(),St=$e===ke.length-1?new k(0,0):tt.sub(Ye)._unit()._perp(),Xt=gt._add(St)._unit(),xi=Xt.x*St.x+Xt.y*St.y;xi!==0&&Xt._mult(1/xi),je.push(Xt._mult(me)._add(Ye))}Be.push(je)}return Be}(E,se*G)),function(Ae,me,Be){for(let Te=0;Te<me.length;Te++){const ke=me[Te];if(Ae.length>=3){for(let je=0;je<ke.length;je++)if(Yl(Ae,ke[je]))return!0}if(Rd(Ae,ke,Be))return!0}return!1}($,E,X)}isTileClipped(){return!0}}function $0(h,c){return c>0?c+2*h:h}const xx=Nn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),wx=Nn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Nn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Wn=Nn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Nn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const bm=Nn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Bx=Nn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Cx(h,c,f){return h.sections.forEach(v=>{v.text=function(E,M,D){const G=M.layout.get("text-transform").evaluate(D,{});return G==="uppercase"?E=E.toLocaleUpperCase():G==="lowercase"&&(E=E.toLocaleLowerCase()),Ks.applyArabicShaping&&(E=Ks.applyArabicShaping(E)),E}(v.text,c,f)}),h}Nn([{name:"triangle",components:3,type:"Uint16"}]),Nn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Nn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Nn([{type:"Float32",name:"offsetX"}]),Nn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Nn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const _c={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Ss=24,K0=Xn,Ex=function(h,c,f,v,E){var M,D,G=8*E-v-1,$=(1<<G)-1,X=$>>1,se=-7,Ae=f?E-1:0,me=f?-1:1,Be=h[c+Ae];for(Ae+=me,M=Be&(1<<-se)-1,Be>>=-se,se+=G;se>0;M=256*M+h[c+Ae],Ae+=me,se-=8);for(D=M&(1<<-se)-1,M>>=-se,se+=v;se>0;D=256*D+h[c+Ae],Ae+=me,se-=8);if(M===0)M=1-X;else{if(M===$)return D?NaN:1/0*(Be?-1:1);D+=Math.pow(2,v),M-=X}return(Be?-1:1)*D*Math.pow(2,M-v)},Sx=function(h,c,f,v,E,M){var D,G,$,X=8*M-E-1,se=(1<<X)-1,Ae=se>>1,me=E===23?Math.pow(2,-24)-Math.pow(2,-77):0,Be=v?0:M-1,Te=v?1:-1,ke=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(G=isNaN(c)?1:0,D=se):(D=Math.floor(Math.log(c)/Math.LN2),c*($=Math.pow(2,-D))<1&&(D--,$*=2),(c+=D+Ae>=1?me/$:me*Math.pow(2,1-Ae))*$>=2&&(D++,$/=2),D+Ae>=se?(G=0,D=se):D+Ae>=1?(G=(c*$-1)*Math.pow(2,E),D+=Ae):(G=c*Math.pow(2,Ae-1)*Math.pow(2,E),D=0));E>=8;h[f+Be]=255&G,Be+=Te,G/=256,E-=8);for(D=D<<E|G,X+=E;X>0;h[f+Be]=255&D,Be+=Te,D/=256,X-=8);h[f+Be-Te]|=128*ke};function Xn(h){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(h)?h:new Uint8Array(h||0),this.pos=0,this.type=0,this.length=this.buf.length}Xn.Varint=0,Xn.Fixed64=1,Xn.Bytes=2,Xn.Fixed32=5;var W0=4294967296,Tx=1/W0,Ix=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Th(h){return h.type===Xn.Bytes?h.readVarint()+h.pos:h.pos+1}function jd(h,c,f){return f?4294967296*c+(h>>>0):4294967296*(c>>>0)+(h>>>0)}function Lx(h,c,f){var v=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));f.realloc(v);for(var E=f.pos-1;E>=h;E--)f.buf[E+v]=f.buf[E]}function xm(h,c){for(var f=0;f<h.length;f++)c.writeVarint(h[f])}function qd(h,c){for(var f=0;f<h.length;f++)c.writeSVarint(h[f])}function Mx(h,c){for(var f=0;f<h.length;f++)c.writeFloat(h[f])}function X0(h,c){for(var f=0;f<h.length;f++)c.writeDouble(h[f])}function Z0(h,c){for(var f=0;f<h.length;f++)c.writeBoolean(h[f])}function EI(h,c){for(var f=0;f<h.length;f++)c.writeFixed32(h[f])}function SI(h,c){for(var f=0;f<h.length;f++)c.writeSFixed32(h[f])}function TI(h,c){for(var f=0;f<h.length;f++)c.writeFixed64(h[f])}function Px(h,c){for(var f=0;f<h.length;f++)c.writeSFixed64(h[f])}function pp(h,c){return(h[c]|h[c+1]<<8|h[c+2]<<16)+16777216*h[c+3]}function No(h,c,f){h[f]=c,h[f+1]=c>>>8,h[f+2]=c>>>16,h[f+3]=c>>>24}function wm(h,c){return(h[c]|h[c+1]<<8|h[c+2]<<16)+(h[c+3]<<24)}Xn.prototype={destroy:function(){this.buf=null},readFields:function(h,c,f){for(f=f||this.length;this.pos<f;){var v=this.readVarint(),E=v>>3,M=this.pos;this.type=7&v,h(E,c,this),this.pos===M&&this.skip(v)}return c},readMessage:function(h,c){return this.readFields(h,c,this.readVarint()+this.pos)},readFixed32:function(){var h=pp(this.buf,this.pos);return this.pos+=4,h},readSFixed32:function(){var h=wm(this.buf,this.pos);return this.pos+=4,h},readFixed64:function(){var h=pp(this.buf,this.pos)+pp(this.buf,this.pos+4)*W0;return this.pos+=8,h},readSFixed64:function(){var h=pp(this.buf,this.pos)+wm(this.buf,this.pos+4)*W0;return this.pos+=8,h},readFloat:function(){var h=Ex(this.buf,this.pos,!0,23,4);return this.pos+=4,h},readDouble:function(){var h=Ex(this.buf,this.pos,!0,52,8);return this.pos+=8,h},readVarint:function(h){var c,f,v=this.buf;return c=127&(f=v[this.pos++]),f<128?c:(c|=(127&(f=v[this.pos++]))<<7,f<128?c:(c|=(127&(f=v[this.pos++]))<<14,f<128?c:(c|=(127&(f=v[this.pos++]))<<21,f<128?c:function(E,M,D){var G,$,X=D.buf;if(G=(112&($=X[D.pos++]))>>4,$<128||(G|=(127&($=X[D.pos++]))<<3,$<128)||(G|=(127&($=X[D.pos++]))<<10,$<128)||(G|=(127&($=X[D.pos++]))<<17,$<128)||(G|=(127&($=X[D.pos++]))<<24,$<128)||(G|=(1&($=X[D.pos++]))<<31,$<128))return jd(E,G,M);throw new Error("Expected varint not more than 10 bytes")}(c|=(15&(f=v[this.pos]))<<28,h,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var h=this.readVarint();return h%2==1?(h+1)/-2:h/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var h=this.readVarint()+this.pos,c=this.pos;return this.pos=h,h-c>=12&&Ix?function(f,v,E){return Ix.decode(f.subarray(v,E))}(this.buf,c,h):function(f,v,E){for(var M="",D=v;D<E;){var G,$,X,se=f[D],Ae=null,me=se>239?4:se>223?3:se>191?2:1;if(D+me>E)break;me===1?se<128&&(Ae=se):me===2?(192&(G=f[D+1]))==128&&(Ae=(31&se)<<6|63&G)<=127&&(Ae=null):me===3?($=f[D+2],(192&(G=f[D+1]))==128&&(192&$)==128&&((Ae=(15&se)<<12|(63&G)<<6|63&$)<=2047||Ae>=55296&&Ae<=57343)&&(Ae=null)):me===4&&($=f[D+2],X=f[D+3],(192&(G=f[D+1]))==128&&(192&$)==128&&(192&X)==128&&((Ae=(15&se)<<18|(63&G)<<12|(63&$)<<6|63&X)<=65535||Ae>=1114112)&&(Ae=null)),Ae===null?(Ae=65533,me=1):Ae>65535&&(Ae-=65536,M+=String.fromCharCode(Ae>>>10&1023|55296),Ae=56320|1023&Ae),M+=String.fromCharCode(Ae),D+=me}return M}(this.buf,c,h)},readBytes:function(){var h=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,h);return this.pos=h,c},readPackedVarint:function(h,c){if(this.type!==Xn.Bytes)return h.push(this.readVarint(c));var f=Th(this);for(h=h||[];this.pos<f;)h.push(this.readVarint(c));return h},readPackedSVarint:function(h){if(this.type!==Xn.Bytes)return h.push(this.readSVarint());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readSVarint());return h},readPackedBoolean:function(h){if(this.type!==Xn.Bytes)return h.push(this.readBoolean());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readBoolean());return h},readPackedFloat:function(h){if(this.type!==Xn.Bytes)return h.push(this.readFloat());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readFloat());return h},readPackedDouble:function(h){if(this.type!==Xn.Bytes)return h.push(this.readDouble());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readDouble());return h},readPackedFixed32:function(h){if(this.type!==Xn.Bytes)return h.push(this.readFixed32());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readFixed32());return h},readPackedSFixed32:function(h){if(this.type!==Xn.Bytes)return h.push(this.readSFixed32());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readSFixed32());return h},readPackedFixed64:function(h){if(this.type!==Xn.Bytes)return h.push(this.readFixed64());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readFixed64());return h},readPackedSFixed64:function(h){if(this.type!==Xn.Bytes)return h.push(this.readSFixed64());var c=Th(this);for(h=h||[];this.pos<c;)h.push(this.readSFixed64());return h},skip:function(h){var c=7&h;if(c===Xn.Varint)for(;this.buf[this.pos++]>127;);else if(c===Xn.Bytes)this.pos=this.readVarint()+this.pos;else if(c===Xn.Fixed32)this.pos+=4;else{if(c!==Xn.Fixed64)throw new Error("Unimplemented type: "+c);this.pos+=8}},writeTag:function(h,c){this.writeVarint(h<<3|c)},realloc:function(h){for(var c=this.length||16;c<this.pos+h;)c*=2;if(c!==this.length){var f=new Uint8Array(c);f.set(this.buf),this.buf=f,this.length=c}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(h){this.realloc(4),No(this.buf,h,this.pos),this.pos+=4},writeSFixed32:function(h){this.realloc(4),No(this.buf,h,this.pos),this.pos+=4},writeFixed64:function(h){this.realloc(8),No(this.buf,-1&h,this.pos),No(this.buf,Math.floor(h*Tx),this.pos+4),this.pos+=8},writeSFixed64:function(h){this.realloc(8),No(this.buf,-1&h,this.pos),No(this.buf,Math.floor(h*Tx),this.pos+4),this.pos+=8},writeVarint:function(h){(h=+h||0)>268435455||h<0?function(c,f){var v,E;if(c>=0?(v=c%4294967296|0,E=c/4294967296|0):(E=~(-c/4294967296),4294967295^(v=~(-c%4294967296))?v=v+1|0:(v=0,E=E+1|0)),c>=18446744073709552e3||c<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(M,D,G){G.buf[G.pos++]=127&M|128,M>>>=7,G.buf[G.pos++]=127&M|128,M>>>=7,G.buf[G.pos++]=127&M|128,M>>>=7,G.buf[G.pos++]=127&M|128,G.buf[G.pos]=127&(M>>>=7)}(v,0,f),function(M,D){var G=(7&M)<<4;D.buf[D.pos++]|=G|((M>>>=3)?128:0),M&&(D.buf[D.pos++]=127&M|((M>>>=7)?128:0),M&&(D.buf[D.pos++]=127&M|((M>>>=7)?128:0),M&&(D.buf[D.pos++]=127&M|((M>>>=7)?128:0),M&&(D.buf[D.pos++]=127&M|((M>>>=7)?128:0),M&&(D.buf[D.pos++]=127&M)))))}(E,f)}(h,this):(this.realloc(4),this.buf[this.pos++]=127&h|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=h>>>7&127))))},writeSVarint:function(h){this.writeVarint(h<0?2*-h-1:2*h)},writeBoolean:function(h){this.writeVarint(!!h)},writeString:function(h){h=String(h),this.realloc(4*h.length),this.pos++;var c=this.pos;this.pos=function(v,E,M){for(var D,G,$=0;$<E.length;$++){if((D=E.charCodeAt($))>55295&&D<57344){if(!G){D>56319||$+1===E.length?(v[M++]=239,v[M++]=191,v[M++]=189):G=D;continue}if(D<56320){v[M++]=239,v[M++]=191,v[M++]=189,G=D;continue}D=G-55296<<10|D-56320|65536,G=null}else G&&(v[M++]=239,v[M++]=191,v[M++]=189,G=null);D<128?v[M++]=D:(D<2048?v[M++]=D>>6|192:(D<65536?v[M++]=D>>12|224:(v[M++]=D>>18|240,v[M++]=D>>12&63|128),v[M++]=D>>6&63|128),v[M++]=63&D|128)}return M}(this.buf,h,this.pos);var f=this.pos-c;f>=128&&Lx(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeFloat:function(h){this.realloc(4),Sx(this.buf,h,this.pos,!0,23,4),this.pos+=4},writeDouble:function(h){this.realloc(8),Sx(this.buf,h,this.pos,!0,52,8),this.pos+=8},writeBytes:function(h){var c=h.length;this.writeVarint(c),this.realloc(c);for(var f=0;f<c;f++)this.buf[this.pos++]=h[f]},writeRawMessage:function(h,c){this.pos++;var f=this.pos;h(c,this);var v=this.pos-f;v>=128&&Lx(f,v,this),this.pos=f-1,this.writeVarint(v),this.pos+=v},writeMessage:function(h,c,f){this.writeTag(h,Xn.Bytes),this.writeRawMessage(c,f)},writePackedVarint:function(h,c){c.length&&this.writeMessage(h,xm,c)},writePackedSVarint:function(h,c){c.length&&this.writeMessage(h,qd,c)},writePackedBoolean:function(h,c){c.length&&this.writeMessage(h,Z0,c)},writePackedFloat:function(h,c){c.length&&this.writeMessage(h,Mx,c)},writePackedDouble:function(h,c){c.length&&this.writeMessage(h,X0,c)},writePackedFixed32:function(h,c){c.length&&this.writeMessage(h,EI,c)},writePackedSFixed32:function(h,c){c.length&&this.writeMessage(h,SI,c)},writePackedFixed64:function(h,c){c.length&&this.writeMessage(h,TI,c)},writePackedSFixed64:function(h,c){c.length&&this.writeMessage(h,Px,c)},writeBytesField:function(h,c){this.writeTag(h,Xn.Bytes),this.writeBytes(c)},writeFixed32Field:function(h,c){this.writeTag(h,Xn.Fixed32),this.writeFixed32(c)},writeSFixed32Field:function(h,c){this.writeTag(h,Xn.Fixed32),this.writeSFixed32(c)},writeFixed64Field:function(h,c){this.writeTag(h,Xn.Fixed64),this.writeFixed64(c)},writeSFixed64Field:function(h,c){this.writeTag(h,Xn.Fixed64),this.writeSFixed64(c)},writeVarintField:function(h,c){this.writeTag(h,Xn.Varint),this.writeVarint(c)},writeSVarintField:function(h,c){this.writeTag(h,Xn.Varint),this.writeSVarint(c)},writeStringField:function(h,c){this.writeTag(h,Xn.Bytes),this.writeString(c)},writeFloatField:function(h,c){this.writeTag(h,Xn.Fixed32),this.writeFloat(c)},writeDoubleField:function(h,c){this.writeTag(h,Xn.Fixed64),this.writeDouble(c)},writeBooleanField:function(h,c){this.writeVarintField(h,!!c)}};var Bm=b(K0);const Gu=3;function gp(h,c,f){h===1&&f.readMessage(mp,c)}function mp(h,c,f){if(h===3){const{id:v,bitmap:E,width:M,height:D,left:G,top:$,advance:X}=f.readMessage($d,{});c.push({id:v,bitmap:new yc({width:M+2*Gu,height:D+2*Gu},E),metrics:{width:M,height:D,left:G,top:$,advance:X}})}}function $d(h,c,f){h===1?c.id=f.readVarint():h===2?c.bitmap=f.readBytes():h===3?c.width=f.readVarint():h===4?c.height=f.readVarint():h===5?c.left=f.readSVarint():h===6?c.top=f.readSVarint():h===7&&(c.advance=f.readVarint())}const yp=Gu;function _p(h){let c=0,f=0;for(const D of h)c+=D.w*D.h,f=Math.max(f,D.w);h.sort((D,G)=>G.h-D.h);const v=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),f),h:1/0}];let E=0,M=0;for(const D of h)for(let G=v.length-1;G>=0;G--){const $=v[G];if(!(D.w>$.w||D.h>$.h)){if(D.x=$.x,D.y=$.y,M=Math.max(M,D.y+D.h),E=Math.max(E,D.x+D.w),D.w===$.w&&D.h===$.h){const X=v.pop();G<v.length&&(v[G]=X)}else D.h===$.h?($.x+=D.w,$.w-=D.w):D.w===$.w?($.y+=D.h,$.h-=D.h):(v.push({x:$.x+D.w,y:$.y,w:$.w-D.w,h:D.h}),$.y+=D.h,$.h-=D.h);break}}return{w:E,h:M,fill:c/(E*M)||0}}const wl=1;class Cm{constructor(c,f){let{pixelRatio:v,version:E,stretchX:M,stretchY:D,content:G}=f;this.paddedRect=c,this.pixelRatio=v,this.stretchX=M,this.stretchY=D,this.content=G,this.version=E}get tl(){return[this.paddedRect.x+wl,this.paddedRect.y+wl]}get br(){return[this.paddedRect.x+this.paddedRect.w-wl,this.paddedRect.y+this.paddedRect.h-wl]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*wl)/this.pixelRatio,(this.paddedRect.h-2*wl)/this.pixelRatio]}}class J0{constructor(c,f){const v={},E={};this.haveRenderCallbacks=[];const M=[];this.addImages(c,v,M),this.addImages(f,E,M);const{w:D,h:G}=_p(M),$=new Uo({width:D||1,height:G||1});for(const X in c){const se=c[X],Ae=v[X].paddedRect;Uo.copy(se.data,$,{x:0,y:0},{x:Ae.x+wl,y:Ae.y+wl},se.data)}for(const X in f){const se=f[X],Ae=E[X].paddedRect,me=Ae.x+wl,Be=Ae.y+wl,Te=se.data.width,ke=se.data.height;Uo.copy(se.data,$,{x:0,y:0},{x:me,y:Be},se.data),Uo.copy(se.data,$,{x:0,y:ke-1},{x:me,y:Be-1},{width:Te,height:1}),Uo.copy(se.data,$,{x:0,y:0},{x:me,y:Be+ke},{width:Te,height:1}),Uo.copy(se.data,$,{x:Te-1,y:0},{x:me-1,y:Be},{width:1,height:ke}),Uo.copy(se.data,$,{x:0,y:0},{x:me+Te,y:Be},{width:1,height:ke})}this.image=$,this.iconPositions=v,this.patternPositions=E}addImages(c,f,v){for(const E in c){const M=c[E],D={x:0,y:0,w:M.data.width+2*wl,h:M.data.height+2*wl};v.push(D),f[E]=new Cm(D,M),M.hasRenderCallback&&this.haveRenderCallbacks.push(E)}}patchUpdatedImages(c,f){c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const v in c.updatedImages)this.patchUpdatedImage(this.iconPositions[v],c.getImage(v),f),this.patchUpdatedImage(this.patternPositions[v],c.getImage(v),f)}patchUpdatedImage(c,f,v){if(!c||!f||c.version===f.version)return;c.version=f.version;const[E,M]=c.tl;v.update(f.data,void 0,{x:E,y:M})}}var dA;Oi("ImagePosition",Cm),Oi("ImageAtlas",J0),s.ai=void 0,(dA=s.ai||(s.ai={}))[dA.none=0]="none",dA[dA.horizontal=1]="horizontal",dA[dA.vertical=2]="vertical",dA[dA.horizontalOnly=3]="horizontalOnly";const Kd=-17;class Wd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(c,f){const v=new Wd;return v.scale=c||1,v.fontStack=f,v}static forImage(c){const f=new Wd;return f.imageName=c,f}}class fA{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,f){const v=new fA;for(let E=0;E<c.sections.length;E++){const M=c.sections[E];M.image?v.addImageSection(M):v.addTextSection(M,f)}return v}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSectionIndex(c){return this.sectionIndex[c]}getCharCode(c){return this.text.charCodeAt(c)}verticalizePunctuation(){this.text=function(c){let f="";for(let v=0;v<c.length;v++){const E=c.charCodeAt(v+1)||null,M=c.charCodeAt(v-1)||null;f+=E&&Rc(E)&&!_c[c[v+1]]||M&&Rc(M)&&!_c[c[v-1]]||!_c[c[v]]?c[v]:_c[c[v]]}return f}(this.text)}trim(){let c=0;for(let v=0;v<this.text.length&&Em[this.text.charCodeAt(v)];v++)c++;let f=this.text.length;for(let v=this.text.length-1;v>=0&&v>=c&&Em[this.text.charCodeAt(v)];v--)f--;this.text=this.text.substring(c,f),this.sectionIndex=this.sectionIndex.slice(c,f)}substring(c,f){const v=new fA;return v.text=this.text.substring(c,f),v.sectionIndex=this.sectionIndex.slice(c,f),v.sections=this.sections,v}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,f)=>Math.max(c,this.sections[f].scale),0)}addTextSection(c,f){this.text+=c.text,this.sections.push(Wd.forText(c.scale,c.fontStack||f));const v=this.sections.length-1;for(let E=0;E<c.text.length;++E)this.sectionIndex.push(v)}addImageSection(c){const f=c.image?c.image.name:"";if(f.length===0)return void We("Can't add FormattedSection with an empty image.");const v=this.getNextImageSectionCharCode();v?(this.text+=String.fromCharCode(v),this.sections.push(Wd.forImage(f)),this.sectionIndex.push(this.sections.length-1)):We("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Xd(h,c,f,v,E,M,D,G,$,X,se,Ae,me,Be,Te,ke){const je=fA.fromFeature(h,E);let $e;Ae===s.ai.vertical&&je.verticalizePunctuation();const{processBidirectionalText:ct,processStyledBidirectionalText:Ye}=Ks;if(ct&&je.sections.length===1){$e=[];const St=ct(je.toString(),vp(je,X,M,c,v,Be,Te));for(const Xt of St){const xi=new fA;xi.text=Xt,xi.sections=je.sections;for(let oi=0;oi<Xt.length;oi++)xi.sectionIndex.push(0);$e.push(xi)}}else if(Ye){$e=[];const St=Ye(je.text,je.sectionIndex,vp(je,X,M,c,v,Be,Te));for(const Xt of St){const xi=new fA;xi.text=Xt[0],xi.sectionIndex=Xt[1],xi.sections=je.sections,$e.push(xi)}}else $e=function(St,Xt){const xi=[],oi=St.text;let Ai=0;for(const fi of Xt)xi.push(St.substring(Ai,fi)),Ai=fi;return Ai<oi.length&&xi.push(St.substring(Ai,oi.length)),xi}(je,vp(je,X,M,c,v,Be,Te));const tt=[],gt={positionedLines:tt,text:je.toString(),top:se[1],bottom:se[1],left:se[0],right:se[0],writingMode:Ae,iconsInText:!1,verticalizable:!1};return function(St,Xt,xi,oi,Ai,fi,Fi,ai,Zt,Vi,Qi,gr){let Dr=0,zr=Kd,pn=0,as=0;const zn=ai==="right"?1:ai==="left"?0:.5;let vn=0;for(const un of Ai){un.trim();const en=un.getMaxScale(),fs=(en-1)*Ss,Ts={positionedGlyphs:[],lineOffset:0};St.positionedLines[vn]=Ts;const vs=Ts.positionedGlyphs;let Zs=0;if(!un.length()){zr+=fi,++vn;continue}for(let Fn=0;Fn<un.length();Fn++){const xr=un.getSection(Fn),Ns=un.getSectionIndex(Fn),ao=un.getCharCode(Fn);let lo=0,tc=null,vc=null,na=null,Wu=Ss;const bc=!(Zt===s.ai.horizontal||!Qi&&!mo(ao)||Qi&&(Em[ao]||(Pn=ao,Li.Arabic(Pn)||Li["Arabic Supplement"](Pn)||Li["Arabic Extended-A"](Pn)||Li["Arabic Presentation Forms-A"](Pn)||Li["Arabic Presentation Forms-B"](Pn))));if(xr.imageName){const xc=oi[xr.imageName];if(!xc)continue;na=xr.imageName,St.iconsInText=St.iconsInText||!0,vc=xc.paddedRect;const Bl=xc.displaySize;xr.scale=xr.scale*Ss/gr,tc={width:Bl[0],height:Bl[1],left:wl,top:-yp,advance:bc?Bl[1]:Bl[0]},lo=fs+(Ss-Bl[1]*xr.scale),Wu=tc.advance;const Ph=bc?Bl[0]*xr.scale-Ss*en:Bl[1]*xr.scale-Ss*en;Ph>0&&Ph>Zs&&(Zs=Ph)}else{const xc=xi[xr.fontStack],Bl=xc&&xc[ao];if(Bl&&Bl.rect)vc=Bl.rect,tc=Bl.metrics;else{const Ph=Xt[xr.fontStack],Rp=Ph&&Ph[ao];if(!Rp)continue;tc=Rp.metrics}lo=(en-xr.scale)*Ss}bc?(St.verticalizable=!0,vs.push({glyph:ao,imageName:na,x:Dr,y:zr+lo,vertical:bc,scale:xr.scale,fontStack:xr.fontStack,sectionIndex:Ns,metrics:tc,rect:vc}),Dr+=Wu*xr.scale+Vi):(vs.push({glyph:ao,imageName:na,x:Dr,y:zr+lo,vertical:bc,scale:xr.scale,fontStack:xr.fontStack,sectionIndex:Ns,metrics:tc,rect:vc}),Dr+=tc.advance*xr.scale+Vi)}vs.length!==0&&(pn=Math.max(Dr-Vi,pn),LI(vs,0,vs.length-1,zn,Zs)),Dr=0;const Is=fi*en+Zs;Ts.lineOffset=Math.max(Zs,fs),zr+=Is,as=Math.max(Is,as),++vn}var Pn;const cn=zr-Kd,{horizontalAlign:vr,verticalAlign:Qn}=t_(Fi);(function(un,en,fs,Ts,vs,Zs,Is,Fn,xr){const Ns=(en-fs)*vs;let ao=0;ao=Zs!==Is?-Fn*Ts-Kd:(-Ts*xr+.5)*Is;for(const lo of un)for(const tc of lo.positionedGlyphs)tc.x+=Ns,tc.y+=ao})(St.positionedLines,zn,vr,Qn,pn,as,fi,cn,Ai.length),St.top+=-Qn*cn,St.bottom=St.top+cn,St.left+=-vr*pn,St.right=St.left+pn}(gt,c,f,v,$e,D,G,$,Ae,X,me,ke),!function(St){for(const Xt of St)if(Xt.positionedGlyphs.length!==0)return!1;return!0}(tt)&&gt}const Em={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},II={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Y0(h,c,f,v,E,M){if(c.imageName){const D=v[c.imageName];return D?D.displaySize[0]*c.scale*Ss/M+E:0}{const D=f[c.fontStack],G=D&&D[h];return G?G.metrics.advance*c.scale+E:0}}function Zd(h,c,f,v){const E=Math.pow(h-c,2);return v?h<c?E/2:2*E:E+Math.abs(f)*f}function ju(h,c,f){let v=0;return h===10&&(v-=1e4),f&&(v+=150),h!==40&&h!==65288||(v+=50),c!==41&&c!==65289||(v+=50),v}function Ih(h,c,f,v,E,M){let D=null,G=Zd(c,f,E,M);for(const $ of v){const X=Zd(c-$.x,f,E,M)+$.badness;X<=G&&(D=$,G=X)}return{index:h,x:c,priorBreak:D,badness:G}}function e_(h){return h?e_(h.priorBreak).concat(h.index):[]}function vp(h,c,f,v,E,M,D){if(M!=="point")return[];if(!h)return[];const G=[],$=function(me,Be,Te,ke,je,$e){let ct=0;for(let Ye=0;Ye<me.length();Ye++){const tt=me.getSection(Ye);ct+=Y0(me.getCharCode(Ye),tt,ke,je,Be,$e)}return ct/Math.max(1,Math.ceil(ct/Te))}(h,c,f,v,E,D),X=h.text.indexOf("")>=0;let se=0;for(let me=0;me<h.length();me++){const Be=h.getSection(me),Te=h.getCharCode(me);if(Em[Te]||(se+=Y0(Te,Be,v,E,c,D)),me<h.length()-1){const ke=!((Ae=Te)<11904||!(Li["Bopomofo Extended"](Ae)||Li.Bopomofo(Ae)||Li["CJK Compatibility Forms"](Ae)||Li["CJK Compatibility Ideographs"](Ae)||Li["CJK Compatibility"](Ae)||Li["CJK Radicals Supplement"](Ae)||Li["CJK Strokes"](Ae)||Li["CJK Symbols and Punctuation"](Ae)||Li["CJK Unified Ideographs Extension A"](Ae)||Li["CJK Unified Ideographs"](Ae)||Li["Enclosed CJK Letters and Months"](Ae)||Li["Halfwidth and Fullwidth Forms"](Ae)||Li.Hiragana(Ae)||Li["Ideographic Description Characters"](Ae)||Li["Kangxi Radicals"](Ae)||Li["Katakana Phonetic Extensions"](Ae)||Li.Katakana(Ae)||Li["Vertical Forms"](Ae)||Li["Yi Radicals"](Ae)||Li["Yi Syllables"](Ae)));(II[Te]||ke||Be.imageName)&&G.push(Ih(me+1,se,$,G,ju(Te,h.getCharCode(me+1),ke&&X),!1))}}var Ae;return e_(Ih(h.length(),se,$,G,0,!0))}function t_(h){let c=.5,f=.5;switch(h){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:c,verticalAlign:f}}function LI(h,c,f,v,E){if(!v&&!E)return;const M=h[f],D=(h[f].x+M.metrics.advance*M.scale)*v;for(let G=c;G<=f;G++)h[G].x-=D,h[G].y+=E}function Sm(h,c,f){const{horizontalAlign:v,verticalAlign:E}=t_(f),M=c[0]-h.displaySize[0]*v,D=c[1]-h.displaySize[1]*E;return{image:h,top:D,bottom:D+h.displaySize[1],left:M,right:M+h.displaySize[0]}}function Tm(h,c,f,v,E,M){const D=h.image;let G;if(D.content){const je=D.content,$e=D.pixelRatio||1;G=[je[0]/$e,je[1]/$e,D.displaySize[0]-je[2]/$e,D.displaySize[1]-je[3]/$e]}const $=c.left*M,X=c.right*M;let se,Ae,me,Be;f==="width"||f==="both"?(Be=E[0]+$-v[3],Ae=E[0]+X+v[1]):(Be=E[0]+($+X-D.displaySize[0])/2,Ae=Be+D.displaySize[0]);const Te=c.top*M,ke=c.bottom*M;return f==="height"||f==="both"?(se=E[1]+Te-v[0],me=E[1]+ke+v[2]):(se=E[1]+(Te+ke-D.displaySize[1])/2,me=se+D.displaySize[1]),{image:D,top:se,right:Ae,bottom:me,left:Be,collisionPadding:G}}const bp=255,qc=128,qu=bp*qc;function WA(h,c){const{expression:f}=c;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new bi(h+1))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:v,interpolationType:E}=f;let M=0;for(;M<v.length&&v[M]<=h;)M++;M=Math.max(0,M-1);let D=M;for(;D<v.length&&v[D]<h+1;)D++;D=Math.min(v.length-1,D);const G=v[M],$=v[D];return f.kind==="composite"?{kind:"composite",minZoom:G,maxZoom:$,interpolationType:E}:{kind:"camera",minZoom:G,maxZoom:$,minSize:f.evaluate(new bi(G)),maxSize:f.evaluate(new bi($)),interpolationType:E}}}function Im(h,c,f){let v="never";const E=h.get(c);return E?v=E:h.get(f)&&(v="always"),v}const Fx=hA.VectorTileFeature.types,i_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xp(h,c,f,v,E,M,D,G,$,X,se,Ae,me){const Be=G?Math.min(qu,Math.round(G[0])):0,Te=G?Math.min(qu,Math.round(G[1])):0;h.emplaceBack(c,f,Math.round(32*v),Math.round(32*E),M,D,(Be<<1)+($?1:0),Te,16*X,16*se,256*Ae,256*me)}function Jd(h,c,f){h.emplaceBack(c.x,c.y,f),h.emplaceBack(c.x,c.y,f),h.emplaceBack(c.x,c.y,f),h.emplaceBack(c.x,c.y,f)}function Dx(h){for(const c of h.sections)if(Oc(c.text))return!0;return!1}class r_{constructor(c){this.layoutVertexArray=new bt,this.indexArray=new Vt,this.programConfigurations=c,this.segments=new Ti,this.dynamicLayoutVertexArray=new ht,this.opacityVertexArray=new Rt,this.hasVisibleVertices=!1,this.placedSymbolArray=new j}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,f,v,E){this.isEmpty()||(v&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,xx.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,f),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,wx.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,i_,!0),this.opacityVertexBuffer.itemSize=1),(v||E)&&this.programConfigurations.upload(c))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Oi("SymbolBuffers",r_);class n_{constructor(c,f,v){this.layoutVertexArray=new c,this.layoutAttributes=f,this.indexArray=new v,this.segments=new Ti,this.collisionVertexArray=new hi}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,Wn.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Oi("CollisionBuffers",n_);class XA{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(D=>D.id),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Od([]),this.placementViewportMatrix=Od([]);const f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=WA(this.zoom,f["text-size"]),this.iconSizeData=WA(this.zoom,f["icon-size"]);const v=this.layers[0].layout,E=v.get("symbol-sort-key"),M=v.get("symbol-z-order");this.canOverlap=Im(v,"text-overlap","text-allow-overlap")!=="never"||Im(v,"icon-overlap","icon-allow-overlap")!=="never"||v.get("text-ignore-placement")||v.get("icon-ignore-placement"),this.sortFeaturesByKey=M!=="viewport-y"&&!E.isConstant(),this.sortFeaturesByY=(M==="viewport-y"||M==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,v.get("symbol-placement")==="point"&&(this.writingModes=v.get("text-writing-mode").map(D=>s.ai[D])),this.stateDependentLayerIds=this.layers.filter(D=>D.isStateDependent()).map(D=>D.id),this.sourceID=c.sourceID}createArrays(){this.text=new r_(new oo(this.layers,this.zoom,c=>/^text/.test(c))),this.icon=new r_(new oo(this.layers,this.zoom,c=>/^icon/.test(c))),this.glyphOffsetArray=new Y,this.lineVertexArray=new ie,this.symbolInstances=new W,this.textAnchorOffsets=new fe}calculateGlyphDependencies(c,f,v,E,M){for(let D=0;D<c.length;D++)if(f[c.charCodeAt(D)]=!0,(v||E)&&M){const G=_c[c.charAt(D)];G&&(f[G.charCodeAt(0)]=!0)}}populate(c,f,v){const E=this.layers[0],M=E.layout,D=M.get("text-font"),G=M.get("text-field"),$=M.get("icon-image"),X=(G.value.kind!=="constant"||G.value.value instanceof Qr&&!G.value.value.isEmpty()||G.value.value.toString().length>0)&&(D.value.kind!=="constant"||D.value.value.length>0),se=$.value.kind!=="constant"||!!$.value.value||Object.keys($.parameters).length>0,Ae=M.get("symbol-sort-key");if(this.features=[],!X&&!se)return;const me=f.iconDependencies,Be=f.glyphDependencies,Te=f.availableImages,ke=new bi(this.zoom);for(const{feature:je,id:$e,index:ct,sourceLayerIndex:Ye}of c){const tt=E._featureFilter.needGeometry,gt=Hc(je,tt);if(!E._featureFilter.filter(ke,gt,v))continue;let St,Xt;if(tt||(gt.geometry=Vc(je)),X){const oi=E.getValueAndResolveTokens("text-field",gt,v,Te),Ai=Qr.factory(oi);Dx(Ai)&&(this.hasRTLText=!0),(!this.hasRTLText||uu()==="unavailable"||this.hasRTLText&&Ks.isParsed())&&(St=Cx(Ai,E,gt))}if(se){const oi=E.getValueAndResolveTokens("icon-image",gt,v,Te);Xt=oi instanceof Wi?oi:Wi.fromString(oi)}if(!St&&!Xt)continue;const xi=this.sortFeaturesByKey?Ae.evaluate(gt,{},v):void 0;if(this.features.push({id:$e,text:St,icon:Xt,index:ct,sourceLayerIndex:Ye,geometry:gt.geometry,properties:je.properties,type:Fx[je.type],sortKey:xi}),Xt&&(me[Xt.name]=!0),St){const oi=D.evaluate(gt,{},v).join(","),Ai=M.get("text-rotation-alignment")!=="viewport"&&M.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(s.ai.vertical)>=0;for(const fi of St.sections)if(fi.image)me[fi.image.name]=!0;else{const Fi=Kl(St.toString()),ai=fi.fontStack||oi,Zt=Be[ai]=Be[ai]||{};this.calculateGlyphDependencies(fi.text,Zt,Ai,this.allowVerticalPlacement,Fi)}}}M.get("symbol-placement")==="line"&&(this.features=function(je){const $e={},ct={},Ye=[];let tt=0;function gt(oi){Ye.push(je[oi]),tt++}function St(oi,Ai,fi){const Fi=ct[oi];return delete ct[oi],ct[Ai]=Fi,Ye[Fi].geometry[0].pop(),Ye[Fi].geometry[0]=Ye[Fi].geometry[0].concat(fi[0]),Fi}function Xt(oi,Ai,fi){const Fi=$e[Ai];return delete $e[Ai],$e[oi]=Fi,Ye[Fi].geometry[0].shift(),Ye[Fi].geometry[0]=fi[0].concat(Ye[Fi].geometry[0]),Fi}function xi(oi,Ai,fi){const Fi=fi?Ai[0][Ai[0].length-1]:Ai[0][0];return`${oi}:${Fi.x}:${Fi.y}`}for(let oi=0;oi<je.length;oi++){const Ai=je[oi],fi=Ai.geometry,Fi=Ai.text?Ai.text.toString():null;if(!Fi){gt(oi);continue}const ai=xi(Fi,fi),Zt=xi(Fi,fi,!0);if(ai in ct&&Zt in $e&&ct[ai]!==$e[Zt]){const Vi=Xt(ai,Zt,fi),Qi=St(ai,Zt,Ye[Vi].geometry);delete $e[ai],delete ct[Zt],ct[xi(Fi,Ye[Qi].geometry,!0)]=Qi,Ye[Vi].geometry=null}else ai in ct?St(ai,Zt,fi):Zt in $e?Xt(ai,Zt,fi):(gt(oi),$e[ai]=tt-1,ct[Zt]=tt-1)}return Ye.filter(oi=>oi.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((je,$e)=>je.sortKey-$e.sortKey)}update(c,f,v){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,f,this.layers,v),this.icon.programConfigurations.updatePaintArrays(c,f,this.layers,v))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,f){const v=this.lineVertexArray.length;if(c.segment!==void 0){let E=c.dist(f[c.segment+1]),M=c.dist(f[c.segment]);const D={};for(let G=c.segment+1;G<f.length;G++)D[G]={x:f[G].x,y:f[G].y,tileUnitDistanceFromAnchor:E},G<f.length-1&&(E+=f[G+1].dist(f[G]));for(let G=c.segment||0;G>=0;G--)D[G]={x:f[G].x,y:f[G].y,tileUnitDistanceFromAnchor:M},G>0&&(M+=f[G-1].dist(f[G]));for(let G=0;G<f.length;G++){const $=D[G];this.lineVertexArray.emplaceBack($.x,$.y,$.tileUnitDistanceFromAnchor)}}return{lineStartIndex:v,lineLength:this.lineVertexArray.length-v}}addSymbols(c,f,v,E,M,D,G,$,X,se,Ae,me){const Be=c.indexArray,Te=c.layoutVertexArray,ke=c.segments.prepareSegment(4*f.length,Te,Be,this.canOverlap?D.sortKey:void 0),je=this.glyphOffsetArray.length,$e=ke.vertexLength,ct=this.allowVerticalPlacement&&G===s.ai.vertical?Math.PI/2:0,Ye=D.text&&D.text.sections;for(let tt=0;tt<f.length;tt++){const{tl:gt,tr:St,bl:Xt,br:xi,tex:oi,pixelOffsetTL:Ai,pixelOffsetBR:fi,minFontScaleX:Fi,minFontScaleY:ai,glyphOffset:Zt,isSDF:Vi,sectionIndex:Qi}=f[tt],gr=ke.vertexLength,Dr=Zt[1];xp(Te,$.x,$.y,gt.x,Dr+gt.y,oi.x,oi.y,v,Vi,Ai.x,Ai.y,Fi,ai),xp(Te,$.x,$.y,St.x,Dr+St.y,oi.x+oi.w,oi.y,v,Vi,fi.x,Ai.y,Fi,ai),xp(Te,$.x,$.y,Xt.x,Dr+Xt.y,oi.x,oi.y+oi.h,v,Vi,Ai.x,fi.y,Fi,ai),xp(Te,$.x,$.y,xi.x,Dr+xi.y,oi.x+oi.w,oi.y+oi.h,v,Vi,fi.x,fi.y,Fi,ai),Jd(c.dynamicLayoutVertexArray,$,ct),Be.emplaceBack(gr,gr+1,gr+2),Be.emplaceBack(gr+1,gr+2,gr+3),ke.vertexLength+=4,ke.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Zt[0]),tt!==f.length-1&&Qi===f[tt+1].sectionIndex||c.programConfigurations.populatePaintArrays(Te.length,D,D.index,{},me,Ye&&Ye[Qi])}c.placedSymbolArray.emplaceBack($.x,$.y,je,this.glyphOffsetArray.length-je,$e,X,se,$.segment,v?v[0]:0,v?v[1]:0,E[0],E[1],G,0,!1,0,Ae)}_addCollisionDebugVertex(c,f,v,E,M,D){return f.emplaceBack(0,0),c.emplaceBack(v.x,v.y,E,M,Math.round(D.x),Math.round(D.y))}addCollisionDebugVertices(c,f,v,E,M,D,G){const $=M.segments.prepareSegment(4,M.layoutVertexArray,M.indexArray),X=$.vertexLength,se=M.layoutVertexArray,Ae=M.collisionVertexArray,me=G.anchorX,Be=G.anchorY;this._addCollisionDebugVertex(se,Ae,D,me,Be,new k(c,f)),this._addCollisionDebugVertex(se,Ae,D,me,Be,new k(v,f)),this._addCollisionDebugVertex(se,Ae,D,me,Be,new k(v,E)),this._addCollisionDebugVertex(se,Ae,D,me,Be,new k(c,E)),$.vertexLength+=4;const Te=M.indexArray;Te.emplaceBack(X,X+1),Te.emplaceBack(X+1,X+2),Te.emplaceBack(X+2,X+3),Te.emplaceBack(X+3,X),$.primitiveLength+=4}addDebugCollisionBoxes(c,f,v,E){for(let M=c;M<f;M++){const D=this.collisionBoxArray.get(M);this.addCollisionDebugVertices(D.x1,D.y1,D.x2,D.y2,E?this.textCollisionBox:this.iconCollisionBox,D.anchorPoint,v)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new n_(Dt,bm.members,_i),this.iconCollisionBox=new n_(Dt,bm.members,_i);for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.addDebugCollisionBoxes(f.textBoxStartIndex,f.textBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.iconBoxStartIndex,f.iconBoxEndIndex,f,!1),this.addDebugCollisionBoxes(f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f,!1)}}_deserializeCollisionBoxesForSymbol(c,f,v,E,M,D,G,$,X){const se={};for(let Ae=f;Ae<v;Ae++){const me=c.get(Ae);se.textBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},se.textFeatureIndex=me.featureIndex;break}for(let Ae=E;Ae<M;Ae++){const me=c.get(Ae);se.verticalTextBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},se.verticalTextFeatureIndex=me.featureIndex;break}for(let Ae=D;Ae<G;Ae++){const me=c.get(Ae);se.iconBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},se.iconFeatureIndex=me.featureIndex;break}for(let Ae=$;Ae<X;Ae++){const me=c.get(Ae);se.verticalIconBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},se.verticalIconFeatureIndex=me.featureIndex;break}return se}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let f=0;f<this.symbolInstances.length;f++){const v=this.symbolInstances.get(f);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,v.textBoxStartIndex,v.textBoxEndIndex,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v.iconBoxStartIndex,v.iconBoxEndIndex,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(c,f){const v=c.placedSymbolArray.get(f),E=v.vertexStartIndex+4*v.numGlyphs;for(let M=v.vertexStartIndex;M<E;M+=4)c.indexArray.emplaceBack(M,M+1,M+2),c.indexArray.emplaceBack(M+1,M+2,M+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const f=Math.sin(c),v=Math.cos(c),E=[],M=[],D=[];for(let G=0;G<this.symbolInstances.length;++G){D.push(G);const $=this.symbolInstances.get(G);E.push(0|Math.round(f*$.anchorX+v*$.anchorY)),M.push($.featureIndex)}return D.sort((G,$)=>E[G]-E[$]||M[$]-M[G]),D}addToSortKeyRanges(c,f){const v=this.sortKeyRanges[this.sortKeyRanges.length-1];v&&v.sortKey===f?v.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:f,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const f of this.symbolInstanceIndexes){const v=this.symbolInstances.get(f);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach((E,M,D)=>{E>=0&&D.indexOf(E)===M&&this.addIndicesForPlacedSymbol(this.text,E)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Rx,kx;Oi("SymbolBucket",XA,{omit:["layers","collisionBoxArray","features","compareText"]}),XA.MAX_GLYPHS=65535,XA.addDynamicAttributes=Jd;var s_={get paint(){return kx=kx||new tn({"icon-opacity":new Ni(ut.paint_symbol["icon-opacity"]),"icon-color":new Ni(ut.paint_symbol["icon-color"]),"icon-halo-color":new Ni(ut.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ni(ut.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ni(ut.paint_symbol["icon-halo-blur"]),"icon-translate":new $i(ut.paint_symbol["icon-translate"]),"icon-translate-anchor":new $i(ut.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ni(ut.paint_symbol["text-opacity"]),"text-color":new Ni(ut.paint_symbol["text-color"],{runtimeType:mr,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new Ni(ut.paint_symbol["text-halo-color"]),"text-halo-width":new Ni(ut.paint_symbol["text-halo-width"]),"text-halo-blur":new Ni(ut.paint_symbol["text-halo-blur"]),"text-translate":new $i(ut.paint_symbol["text-translate"]),"text-translate-anchor":new $i(ut.paint_symbol["text-translate-anchor"])})},get layout(){return Rx=Rx||new tn({"symbol-placement":new $i(ut.layout_symbol["symbol-placement"]),"symbol-spacing":new $i(ut.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $i(ut.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ni(ut.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $i(ut.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $i(ut.layout_symbol["icon-allow-overlap"]),"icon-overlap":new $i(ut.layout_symbol["icon-overlap"]),"icon-ignore-placement":new $i(ut.layout_symbol["icon-ignore-placement"]),"icon-optional":new $i(ut.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $i(ut.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ni(ut.layout_symbol["icon-size"]),"icon-text-fit":new $i(ut.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $i(ut.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ni(ut.layout_symbol["icon-image"]),"icon-rotate":new Ni(ut.layout_symbol["icon-rotate"]),"icon-padding":new Ni(ut.layout_symbol["icon-padding"]),"icon-keep-upright":new $i(ut.layout_symbol["icon-keep-upright"]),"icon-offset":new Ni(ut.layout_symbol["icon-offset"]),"icon-anchor":new Ni(ut.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $i(ut.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $i(ut.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $i(ut.layout_symbol["text-rotation-alignment"]),"text-field":new Ni(ut.layout_symbol["text-field"]),"text-font":new Ni(ut.layout_symbol["text-font"]),"text-size":new Ni(ut.layout_symbol["text-size"]),"text-max-width":new Ni(ut.layout_symbol["text-max-width"]),"text-line-height":new $i(ut.layout_symbol["text-line-height"]),"text-letter-spacing":new Ni(ut.layout_symbol["text-letter-spacing"]),"text-justify":new Ni(ut.layout_symbol["text-justify"]),"text-radial-offset":new Ni(ut.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $i(ut.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ni(ut.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ni(ut.layout_symbol["text-anchor"]),"text-max-angle":new $i(ut.layout_symbol["text-max-angle"]),"text-writing-mode":new $i(ut.layout_symbol["text-writing-mode"]),"text-rotate":new Ni(ut.layout_symbol["text-rotate"]),"text-padding":new $i(ut.layout_symbol["text-padding"]),"text-keep-upright":new $i(ut.layout_symbol["text-keep-upright"]),"text-transform":new Ni(ut.layout_symbol["text-transform"]),"text-offset":new Ni(ut.layout_symbol["text-offset"]),"text-allow-overlap":new $i(ut.layout_symbol["text-allow-overlap"]),"text-overlap":new $i(ut.layout_symbol["text-overlap"]),"text-ignore-placement":new $i(ut.layout_symbol["text-ignore-placement"]),"text-optional":new $i(ut.layout_symbol["text-optional"])})}};class Ox{constructor(c){if(c.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=c.property.overrides?c.property.overrides.runtimeType:Ii,this.defaultValue=c}evaluate(c){if(c.formattedSection){const f=this.defaultValue.property.overrides;if(f&&f.hasOverride(c.formattedSection))return f.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Oi("FormatSectionOverride",Ox,{omit:["defaultValue"]});class Yd extends Ro{constructor(c){super(c,s_)}recalculate(c,f){if(super.recalculate(c,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const v=this.layout.get("text-writing-mode");if(v){const E=[];for(const M of v)E.indexOf(M)<0&&E.push(M);this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(c,f,v,E){const M=this.layout.get(c).evaluate(f,{},v,E),D=this._unevaluatedLayout._values[c];return D.isDataDriven()||Br(D.value)||!M?M:function(G,$){return $.replace(/{([^{}]+)}/g,(X,se)=>G&&se in G?String(G[se]):"")}(f.properties,M)}createBucket(c){return new XA(c)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const c of s_.paint.overridableProperties){if(!Yd.hasPaintOverride(this.layout,c))continue;const f=this.paint.get(c),v=new Ox(f),E=new Gn(v,f.property.specification);let M=null;M=f.value.kind==="constant"||f.value.kind==="source"?new Un("source",E):new $s("composite",E,f.value.zoomStops),this.paint._values[c]=new qn(f.property,M,f.parameters)}}_handleOverridablePaintPropertyUpdate(c,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&Yd.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,f){const v=c.get("text-field"),E=s_.paint.properties[f];let M=!1;const D=G=>{for(const $ of G)if(E.overrides&&E.overrides.hasOverride($))return void(M=!0)};if(v.value.kind==="constant"&&v.value.value instanceof Qr)D(v.value.value.sections);else if(v.value.kind==="source"){const G=X=>{M||(X instanceof Hn&&dr(X.value)===oe?D(X.value.sections):X instanceof Ya?D(X.sections):X.eachChild(G))},$=v.value;$._styleExpression&&G($._styleExpression.expression)}return M}}let Lh;var Ux={get paint(){return Lh=Lh||new tn({"background-color":new $i(ut.paint_background["background-color"]),"background-pattern":new Uu(ut.paint_background["background-pattern"]),"background-opacity":new $i(ut.paint_background["background-opacity"])})}};class Nx extends Ro{constructor(c){super(c,Ux)}}let o_;var zx={get paint(){return o_=o_||new tn({"raster-opacity":new $i(ut.paint_raster["raster-opacity"]),"raster-hue-rotate":new $i(ut.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $i(ut.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $i(ut.paint_raster["raster-brightness-max"]),"raster-saturation":new $i(ut.paint_raster["raster-saturation"]),"raster-contrast":new $i(ut.paint_raster["raster-contrast"]),"raster-resampling":new $i(ut.paint_raster["raster-resampling"]),"raster-fade-duration":new $i(ut.paint_raster["raster-fade-duration"])})}};class Qx extends Ro{constructor(c){super(c,zx)}}class a_ extends Ro{constructor(c){super(c,{}),this.onAdd=f=>{this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},this.onRemove=f=>{this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Lm{constructor(c){this._callback=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Mm=63710088e-1;class $u{constructor(c,f){if(isNaN(c)||isNaN(f))throw new Error(`Invalid LngLat object: (${c}, ${f})`);if(this.lng=+c,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new $u(qe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){const f=Math.PI/180,v=this.lat*f,E=c.lat*f,M=Math.sin(v)*Math.sin(E)+Math.cos(v)*Math.cos(E)*Math.cos((c.lng-this.lng)*f);return Mm*Math.acos(Math.min(M,1))}static convert(c){if(c instanceof $u)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new $u(Number(c[0]),Number(c[1]));if(!Array.isArray(c)&&typeof c=="object"&&c!==null)return new $u(Number("lng"in c?c.lng:c.lon),Number(c.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const l_=2*Math.PI*Mm;function ec(h){return l_*Math.cos(h*Math.PI/180)}function ef(h){return(180+h)/360}function c_(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function u_(h,c){return h/ec(c)}function h_(h){return 360*h-180}function Pm(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}class wp{constructor(c,f){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+c,this.y=+f,this.z=+v}static fromLngLat(c){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const v=$u.convert(c);return new wp(ef(v.lng),c_(v.lat),u_(f,v.lat))}toLngLat(){return new $u(h_(this.x),Pm(this.y))}toAltitude(){return this.z*ec(Pm(this.y))}meterInMercatorCoordinateUnits(){return 1/l_*(c=Pm(this.y),1/Math.cos(c*Math.PI/180));var c}}function A_(h,c,f){var v=2*Math.PI*6378137/256/Math.pow(2,f);return[h*v-2*Math.PI*6378137/2,c*v-2*Math.PI*6378137/2]}class d_{constructor(c,f,v){if(c<0||c>25||v<0||v>=Math.pow(2,c)||f<0||f>=Math.pow(2,c))throw new Error(`x=${f}, y=${v}, z=${c} outside of bounds. 0<=x<${Math.pow(2,c)}, 0<=y<${Math.pow(2,c)} 0<=z<=25 `);this.z=c,this.x=f,this.y=v,this.key=tf(0,c,c,f,v)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,f,v){const E=(D=this.y,G=this.z,$=A_(256*(M=this.x),256*(D=Math.pow(2,G)-D-1),G),X=A_(256*(M+1),256*(D+1),G),$[0]+","+$[1]+","+X[0]+","+X[1]);var M,D,G,$,X;const se=function(Ae,me,Be){let Te,ke="";for(let je=Ae;je>0;je--)Te=1<<je-1,ke+=(me&Te?1:0)+(Be&Te?2:0);return ke}(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(v==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,f>1?"@2x":"").replace(/{quadkey}/g,se).replace(/{bbox-epsg-3857}/g,E)}isChildOf(c){const f=this.z-c.z;return f>0&&c.x===this.x>>f&&c.y===this.y>>f}getTilePoint(c){const f=Math.pow(2,this.z);return new k((c.x*f-this.x)*In,(c.y*f-this.y)*In)}toString(){return`${this.z}/${this.x}/${this.y}`}}class f_{constructor(c,f){this.wrap=c,this.canonical=f,this.key=tf(c,f.z,f.z,f.x,f.y)}}class zo{constructor(c,f,v,E,M){if(c<v)throw new Error(`overscaledZ should be >= z; overscaledZ = ${c}; z = ${v}`);this.overscaledZ=c,this.wrap=f,this.canonical=new d_(v,+E,+M),this.key=tf(f,c,v,E,M)}clone(){return new zo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-c;return c>this.canonical.z?new zo(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new zo(c,this.wrap,c,this.canonical.x>>f,this.canonical.y>>f)}calculateScaledKey(c,f){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const v=this.canonical.z-c;return c>this.canonical.z?tf(this.wrap*+f,c,this.canonical.z,this.canonical.x,this.canonical.y):tf(this.wrap*+f,c,c,this.canonical.x>>v,this.canonical.y>>v)}isChildOf(c){if(c.wrap!==this.wrap)return!1;const f=this.canonical.z-c.canonical.z;return c.overscaledZ===0||c.overscaledZ<this.overscaledZ&&c.canonical.x===this.canonical.x>>f&&c.canonical.y===this.canonical.y>>f}children(c){if(this.overscaledZ>=c)return[new zo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const f=this.canonical.z+1,v=2*this.canonical.x,E=2*this.canonical.y;return[new zo(f,this.wrap,f,v,E),new zo(f,this.wrap,f,v+1,E),new zo(f,this.wrap,f,v,E+1),new zo(f,this.wrap,f,v+1,E+1)]}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new zo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new zo(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new f_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(c){return this.canonical.getTilePoint(new wp(c.x-this.wrap,c.y))}}function tf(h,c,f,v,E){(h*=2)<0&&(h=-1*h-1);const M=1<<f;return(M*M*h+M*E+v).toString(36)+f.toString(36)+c.toString(36)}Oi("CanonicalTileID",d_),Oi("OverscaledTileID",zo,{omit:["posMatrix"]});class p_{constructor(c,f,v){let E=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,M=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,D=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,G=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=c,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(v&&!["mapbox","terrarium","custom"].includes(v))return void We(`"${v}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=f.height;const $=this.dim=f.height-2;switch(this.data=new Uint32Array(f.data.buffer),v){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=E,this.greenFactor=M,this.blueFactor=D,this.baseShift=G;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let X=0;X<$;X++)this.data[this._idx(-1,X)]=this.data[this._idx(0,X)],this.data[this._idx($,X)]=this.data[this._idx($-1,X)],this.data[this._idx(X,-1)]=this.data[this._idx(X,0)],this.data[this._idx(X,$)]=this.data[this._idx(X,$-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx($,-1)]=this.data[this._idx($-1,0)],this.data[this._idx(-1,$)]=this.data[this._idx(0,$-1)],this.data[this._idx($,$)]=this.data[this._idx($-1,$-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let X=0;X<$;X++)for(let se=0;se<$;se++){const Ae=this.get(X,se);Ae>this.max&&(this.max=Ae),Ae<this.min&&(this.min=Ae)}}get(c,f){const v=new Uint8Array(this.data.buffer),E=4*this._idx(c,f);return this.unpack(v[E],v[E+1],v[E+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(c,f){if(c<-1||c>=this.dim+1||f<-1||f>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(f+1)*this.stride+(c+1)}unpack(c,f,v){return c*this.redFactor+f*this.greenFactor+v*this.blueFactor-this.baseShift}getPixels(){return new Uo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(c,f,v){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let E=f*this.dim,M=f*this.dim+this.dim,D=v*this.dim,G=v*this.dim+this.dim;switch(f){case-1:E=M-1;break;case 1:M=E+1}switch(v){case-1:D=G-1;break;case 1:G=D+1}const $=-f*this.dim,X=-v*this.dim;for(let se=D;se<G;se++)for(let Ae=E;Ae<M;Ae++)this.data[this._idx(Ae,se)]=c.data[this._idx(Ae+$,se+X)]}}Oi("DEMData",p_);class g_{constructor(c){this._stringToNumber={},this._numberToString=[];for(let f=0;f<c.length;f++){const v=c[f];this._stringToNumber[v]=f,this._numberToString[f]=v}}encode(c){return this._stringToNumber[c]}decode(c){if(c>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${c} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[c]}}class m_{constructor(c,f,v,E,M){this.type="Feature",this._vectorTileFeature=c,c._z=f,c._x=v,c._y=E,this.properties=c.properties,this.id=M}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){const c={geometry:this.geometry};for(const f in this)f!=="_geometry"&&f!=="_vectorTileFeature"&&(c[f]=this[f]);return c}}class Vx{constructor(c,f){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new go(In,16,0),this.grid3D=new go(In,16,0),this.featureIndexArray=new xe,this.promoteId=f}insert(c,f,v,E,M,D){const G=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(v,E,M);const $=D?this.grid3D:this.grid;for(let X=0;X<f.length;X++){const se=f[X],Ae=[1/0,1/0,-1/0,-1/0];for(let me=0;me<se.length;me++){const Be=se[me];Ae[0]=Math.min(Ae[0],Be.x),Ae[1]=Math.min(Ae[1],Be.y),Ae[2]=Math.max(Ae[2],Be.x),Ae[3]=Math.max(Ae[3],Be.y)}Ae[0]<In&&Ae[1]<In&&Ae[2]>=0&&Ae[3]>=0&&$.insert(G,Ae[0],Ae[1],Ae[2],Ae[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new hA.VectorTile(new Bm(this.rawTileData)).layers,this.sourceLayerCoder=new g_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(c,f,v,E){this.loadVTLayers();const M=c.params||{},D=In/c.tileSize/c.scale,G=hl(M.filter),$=c.queryGeometry,X=c.queryPadding*D,se=y_($),Ae=this.grid.query(se.minX-X,se.minY-X,se.maxX+X,se.maxY+X),me=y_(c.cameraQueryGeometry),Be=this.grid3D.query(me.minX-X,me.minY-X,me.maxX+X,me.maxY+X,(je,$e,ct,Ye)=>function(tt,gt,St,Xt,xi){for(const Ai of tt)if(gt<=Ai.x&&St<=Ai.y&&Xt>=Ai.x&&xi>=Ai.y)return!0;const oi=[new k(gt,St),new k(gt,xi),new k(Xt,xi),new k(Xt,St)];if(tt.length>2){for(const Ai of oi)if(Yl(tt,Ai))return!0}for(let Ai=0;Ai<tt.length-1;Ai++)if(oA(tt[Ai],tt[Ai+1],oi))return!0;return!1}(c.cameraQueryGeometry,je-X,$e-X,ct+X,Ye+X));for(const je of Be)Ae.push(je);Ae.sort(rf);const Te={};let ke;for(let je=0;je<Ae.length;je++){const $e=Ae[je];if($e===ke)continue;ke=$e;const ct=this.featureIndexArray.get($e);let Ye=null;this.loadMatchingFeature(Te,ct.bucketIndex,ct.sourceLayerIndex,ct.featureIndex,G,M.layers,M.availableImages,f,v,E,(tt,gt,St)=>(Ye||(Ye=Vc(tt)),gt.queryIntersectsFeature($,tt,St,Ye,this.z,c.transform,D,c.pixelPosMatrix)))}return Te}loadMatchingFeature(c,f,v,E,M,D,G,$,X,se,Ae){const me=this.bucketLayerIDs[f];if(D&&!function(je,$e){for(let ct=0;ct<je.length;ct++)if($e.indexOf(je[ct])>=0)return!0;return!1}(D,me))return;const Be=this.sourceLayerCoder.decode(v),Te=this.vtLayers[Be].feature(E);if(M.needGeometry){const je=Hc(Te,!0);if(!M.filter(new bi(this.tileID.overscaledZ),je,this.tileID.canonical))return}else if(!M.filter(new bi(this.tileID.overscaledZ),Te))return;const ke=this.getId(Te,Be);for(let je=0;je<me.length;je++){const $e=me[je];if(D&&D.indexOf($e)<0)continue;const ct=$[$e];if(!ct)continue;let Ye={};ke&&se&&(Ye=se.getState(ct.sourceLayer||"_geojsonTileLayer",ke));const tt=Ue({},X[$e]);tt.paint=Hx(tt.paint,ct.paint,Te,Ye,G),tt.layout=Hx(tt.layout,ct.layout,Te,Ye,G);const gt=!Ae||Ae(Te,ct,Ye);if(!gt)continue;const St=new m_(Te,this.z,this.x,this.y,ke);St.layer=tt;let Xt=c[$e];Xt===void 0&&(Xt=c[$e]=[]),Xt.push({featureIndex:E,feature:St,intersectionZ:gt})}}lookupSymbolFeatures(c,f,v,E,M,D,G,$){const X={};this.loadVTLayers();const se=hl(M);for(const Ae of c)this.loadMatchingFeature(X,v,E,Ae,se,D,G,$,f);return X}hasLayer(c){for(const f of this.bucketLayerIDs)for(const v of f)if(c===v)return!0;return!1}getId(c,f){let v=c.id;return this.promoteId&&(v=c.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[f]],typeof v=="boolean"&&(v=Number(v))),v}}function Hx(h,c,f,v,E){return it(h,(M,D)=>{const G=c instanceof hu?c.get(D):null;return G&&G.evaluate?G.evaluate(f,v,E):G})}function y_(h){let c=1/0,f=1/0,v=-1/0,E=-1/0;for(const M of h)c=Math.min(c,M.x),f=Math.min(f,M.y),v=Math.max(v,M.x),E=Math.max(E,M.y);return{minX:c,minY:f,maxX:v,maxY:E}}function rf(h,c){return c-h}function __(h,c,f,v,E){const M=[];for(let D=0;D<h.length;D++){const G=h[D];let $;for(let X=0;X<G.length-1;X++){let se=G[X],Ae=G[X+1];se.x<c&&Ae.x<c||(se.x<c?se=new k(c,se.y+(c-se.x)/(Ae.x-se.x)*(Ae.y-se.y))._round():Ae.x<c&&(Ae=new k(c,se.y+(c-se.x)/(Ae.x-se.x)*(Ae.y-se.y))._round()),se.y<f&&Ae.y<f||(se.y<f?se=new k(se.x+(f-se.y)/(Ae.y-se.y)*(Ae.x-se.x),f)._round():Ae.y<f&&(Ae=new k(se.x+(f-se.y)/(Ae.y-se.y)*(Ae.x-se.x),f)._round()),se.x>=v&&Ae.x>=v||(se.x>=v?se=new k(v,se.y+(v-se.x)/(Ae.x-se.x)*(Ae.y-se.y))._round():Ae.x>=v&&(Ae=new k(v,se.y+(v-se.x)/(Ae.x-se.x)*(Ae.y-se.y))._round()),se.y>=E&&Ae.y>=E||(se.y>=E?se=new k(se.x+(E-se.y)/(Ae.y-se.y)*(Ae.x-se.x),E)._round():Ae.y>=E&&(Ae=new k(se.x+(E-se.y)/(Ae.y-se.y)*(Ae.x-se.x),E)._round()),$&&se.equals($[$.length-1])||($=[se],M.push($)),$.push(Ae)))))}}return M}Oi("FeatureIndex",Vx,{omit:["rawTileData","sourceLayerCoder"]});class yu extends k{constructor(c,f,v,E){super(c,f),this.angle=v,E!==void 0&&(this.segment=E)}clone(){return new yu(this.x,this.y,this.angle,this.segment)}}function v_(h,c,f,v,E){if(c.segment===void 0||f===0)return!0;let M=c,D=c.segment+1,G=0;for(;G>-f/2;){if(D--,D<0)return!1;G-=h[D].dist(M),M=h[D]}G+=h[D].dist(h[D+1]),D++;const $=[];let X=0;for(;G<f/2;){const se=h[D],Ae=h[D+1];if(!Ae)return!1;let me=h[D-1].angleTo(se)-se.angleTo(Ae);for(me=Math.abs((me+3*Math.PI)%(2*Math.PI)-Math.PI),$.push({distance:G,angleDelta:me}),X+=me;G-$[0].distance>v;)X-=$.shift().angleDelta;if(X>E)return!1;D++,G+=se.dist(Ae)}return!0}function Bp(h){let c=0;for(let f=0;f<h.length-1;f++)c+=h[f].dist(h[f+1]);return c}function Cp(h,c,f){return h?.6*c*f:0}function Ep(h,c){return Math.max(h?h.right-h.left:0,c?c.right-c.left:0)}function MI(h,c,f,v,E,M){const D=Cp(f,E,M),G=Ep(f,v)*M;let $=0;const X=Bp(h)/2;for(let se=0;se<h.length-1;se++){const Ae=h[se],me=h[se+1],Be=Ae.dist(me);if($+Be>X){const Te=(X-$)/Be,ke=hs.number(Ae.x,me.x,Te),je=hs.number(Ae.y,me.y,Te),$e=new yu(ke,je,me.angleTo(Ae),se);return $e._round(),!D||v_(h,$e,G,D,c)?$e:void 0}$+=Be}}function PI(h,c,f,v,E,M,D,G,$){const X=Cp(v,M,D),se=Ep(v,E),Ae=se*D,me=h[0].x===0||h[0].x===$||h[0].y===0||h[0].y===$;return c-Ae<c/4&&(c=Ae+c/4),Gx(h,me?c/2*G%c:(se/2+2*M)*D*G%c,c,X,f,Ae,me,!1,$)}function Gx(h,c,f,v,E,M,D,G,$){const X=M/2,se=Bp(h);let Ae=0,me=c-f,Be=[];for(let Te=0;Te<h.length-1;Te++){const ke=h[Te],je=h[Te+1],$e=ke.dist(je),ct=je.angleTo(ke);for(;me+f<Ae+$e;){me+=f;const Ye=(me-Ae)/$e,tt=hs.number(ke.x,je.x,Ye),gt=hs.number(ke.y,je.y,Ye);if(tt>=0&&tt<$&&gt>=0&&gt<$&&me-X>=0&&me+X<=se){const St=new yu(tt,gt,ct,Te);St._round(),v&&!v_(h,St,M,v,E)||Be.push(St)}}Ae+=$e}return G||Be.length||D||(Be=Gx(h,Ae/2,f,v,E,M,D,!0,$)),Be}Oi("Anchor",yu);const nf=wl;function ZA(h,c,f,v){const E=[],M=h.image,D=M.pixelRatio,G=M.paddedRect.w-2*nf,$=M.paddedRect.h-2*nf,X=h.right-h.left,se=h.bottom-h.top,Ae=M.stretchX||[[0,G]],me=M.stretchY||[[0,$]],Be=(fi,Fi)=>fi+Fi[1]-Fi[0],Te=Ae.reduce(Be,0),ke=me.reduce(Be,0),je=G-Te,$e=$-ke;let ct=0,Ye=Te,tt=0,gt=ke,St=0,Xt=je,xi=0,oi=$e;if(M.content&&v){const fi=M.content;ct=vo(Ae,0,fi[0]),tt=vo(me,0,fi[1]),Ye=vo(Ae,fi[0],fi[2]),gt=vo(me,fi[1],fi[3]),St=fi[0]-ct,xi=fi[1]-tt,Xt=fi[2]-fi[0]-Ye,oi=fi[3]-fi[1]-gt}const Ai=(fi,Fi,ai,Zt)=>{const Vi=sf(fi.stretch-ct,Ye,X,h.left),Qi=Sp(fi.fixed-St,Xt,fi.stretch,Te),gr=sf(Fi.stretch-tt,gt,se,h.top),Dr=Sp(Fi.fixed-xi,oi,Fi.stretch,ke),zr=sf(ai.stretch-ct,Ye,X,h.left),pn=Sp(ai.fixed-St,Xt,ai.stretch,Te),as=sf(Zt.stretch-tt,gt,se,h.top),zn=Sp(Zt.fixed-xi,oi,Zt.stretch,ke),vn=new k(Vi,gr),Pn=new k(zr,gr),cn=new k(zr,as),vr=new k(Vi,as),Qn=new k(Qi/D,Dr/D),un=new k(pn/D,zn/D),en=c*Math.PI/180;if(en){const vs=Math.sin(en),Zs=Math.cos(en),Is=[Zs,-vs,vs,Zs];vn._matMult(Is),Pn._matMult(Is),vr._matMult(Is),cn._matMult(Is)}const fs=fi.stretch+fi.fixed,Ts=Fi.stretch+Fi.fixed;return{tl:vn,tr:Pn,bl:vr,br:cn,tex:{x:M.paddedRect.x+nf+fs,y:M.paddedRect.y+nf+Ts,w:ai.stretch+ai.fixed-fs,h:Zt.stretch+Zt.fixed-Ts},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Qn,pixelOffsetBR:un,minFontScaleX:Xt/D/X,minFontScaleY:oi/D/se,isSDF:f}};if(v&&(M.stretchX||M.stretchY)){const fi=Mh(Ae,je,Te),Fi=Mh(me,$e,ke);for(let ai=0;ai<fi.length-1;ai++){const Zt=fi[ai],Vi=fi[ai+1];for(let Qi=0;Qi<Fi.length-1;Qi++)E.push(Ai(Zt,Fi[Qi],Vi,Fi[Qi+1]))}}else E.push(Ai({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:G+1},{fixed:0,stretch:$+1}));return E}function vo(h,c,f){let v=0;for(const E of h)v+=Math.max(c,Math.min(f,E[1]))-Math.max(c,Math.min(f,E[0]));return v}function Mh(h,c,f){const v=[{fixed:-nf,stretch:0}];for(const[E,M]of h){const D=v[v.length-1];v.push({fixed:E-D.stretch,stretch:D.stretch}),v.push({fixed:E-D.stretch,stretch:D.stretch+(M-E)})}return v.push({fixed:c+nf,stretch:f}),v}function sf(h,c,f,v){return h/c*f+v}function Sp(h,c,f,v){return h-c*f/v}class Tp{constructor(c,f,v,E,M,D,G,$,X,se){if(this.boxStartIndex=c.length,X){let Ae=D.top,me=D.bottom;const Be=D.collisionPadding;Be&&(Ae-=Be[1],me+=Be[3]);let Te=me-Ae;Te>0&&(Te=Math.max(10,Te),this.circleDiameter=Te)}else{let Ae=D.top*G-$[0],me=D.bottom*G+$[2],Be=D.left*G-$[3],Te=D.right*G+$[1];const ke=D.collisionPadding;if(ke&&(Be-=ke[0]*G,Ae-=ke[1]*G,Te+=ke[2]*G,me+=ke[3]*G),se){const je=new k(Be,Ae),$e=new k(Te,Ae),ct=new k(Be,me),Ye=new k(Te,me),tt=se*Math.PI/180;je._rotate(tt),$e._rotate(tt),ct._rotate(tt),Ye._rotate(tt),Be=Math.min(je.x,$e.x,ct.x,Ye.x),Te=Math.max(je.x,$e.x,ct.x,Ye.x),Ae=Math.min(je.y,$e.y,ct.y,Ye.y),me=Math.max(je.y,$e.y,ct.y,Ye.y)}c.emplaceBack(f.x,f.y,Be,Ae,Te,me,v,E,M)}this.boxEndIndex=c.length}}class b_{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:FI;if(this.data=c,this.length=this.data.length,this.compare=f,this.length>0)for(let v=(this.length>>1)-1;v>=0;v--)this._down(v)}push(c){this.data.push(c),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const c=this.data[0],f=this.data.pop();return this.length--,this.length>0&&(this.data[0]=f,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:f,compare:v}=this,E=f[c];for(;c>0;){const M=c-1>>1,D=f[M];if(v(E,D)>=0)break;f[c]=D,c=M}f[c]=E}_down(c){const{data:f,compare:v}=this,E=this.length>>1,M=f[c];for(;c<E;){let D=1+(c<<1),G=f[D];const $=D+1;if($<this.length&&v(f[$],G)<0&&(D=$,G=f[$]),v(G,M)>=0)break;f[c]=G,c=D}f[c]=M}}function FI(h,c){return h<c?-1:h>c?1:0}function jx(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,v=1/0,E=1/0,M=-1/0,D=-1/0;const G=h[0];for(let Be=0;Be<G.length;Be++){const Te=G[Be];(!Be||Te.x<v)&&(v=Te.x),(!Be||Te.y<E)&&(E=Te.y),(!Be||Te.x>M)&&(M=Te.x),(!Be||Te.y>D)&&(D=Te.y)}const $=Math.min(M-v,D-E);let X=$/2;const se=new b_([],qx);if($===0)return new k(v,E);for(let Be=v;Be<M;Be+=$)for(let Te=E;Te<D;Te+=$)se.push(new of(Be+X,Te+X,X,h));let Ae=function(Be){let Te=0,ke=0,je=0;const $e=Be[0];for(let ct=0,Ye=$e.length,tt=Ye-1;ct<Ye;tt=ct++){const gt=$e[ct],St=$e[tt],Xt=gt.x*St.y-St.x*gt.y;ke+=(gt.x+St.x)*Xt,je+=(gt.y+St.y)*Xt,Te+=3*Xt}return new of(ke/Te,je/Te,0,Be)}(h),me=se.length;for(;se.length;){const Be=se.pop();(Be.d>Ae.d||!Ae.d)&&(Ae=Be,f&&console.log("found best %d after %d probes",Math.round(1e4*Be.d)/1e4,me)),Be.max-Ae.d<=c||(X=Be.h/2,se.push(new of(Be.p.x-X,Be.p.y-X,X,h)),se.push(new of(Be.p.x+X,Be.p.y-X,X,h)),se.push(new of(Be.p.x-X,Be.p.y+X,X,h)),se.push(new of(Be.p.x+X,Be.p.y+X,X,h)),me+=4)}return f&&(console.log(`num probes: ${me}`),console.log(`best distance: ${Ae.d}`)),Ae.p}function qx(h,c){return c.max-h.max}function of(h,c,f,v){this.p=new k(h,c),this.h=f,this.d=function(E,M){let D=!1,G=1/0;for(let $=0;$<M.length;$++){const X=M[$];for(let se=0,Ae=X.length,me=Ae-1;se<Ae;me=se++){const Be=X[se],Te=X[me];Be.y>E.y!=Te.y>E.y&&E.x<(Te.x-Be.x)*(E.y-Be.y)/(Te.y-Be.y)+Be.x&&(D=!D),G=Math.min(G,um(E,Be,Te))}}return(D?1:-1)*Math.sqrt(G)}(this.p,v),this.max=this.d+this.h*Math.SQRT2}var ra;s.aq=void 0,(ra=s.aq||(s.aq={}))[ra.center=1]="center",ra[ra.left=2]="left",ra[ra.right=3]="right",ra[ra.top=4]="top",ra[ra.bottom=5]="bottom",ra[ra["top-left"]=6]="top-left",ra[ra["top-right"]=7]="top-right",ra[ra["bottom-left"]=8]="bottom-left",ra[ra["bottom-right"]=9]="bottom-right";const Ku=7,Ip=Number.POSITIVE_INFINITY;function x_(h,c){return c[1]!==Ip?function(f,v,E){let M=0,D=0;switch(v=Math.abs(v),E=Math.abs(E),f){case"top-right":case"top-left":case"top":D=E-Ku;break;case"bottom-right":case"bottom-left":case"bottom":D=-E+Ku}switch(f){case"top-right":case"bottom-right":case"right":M=-v;break;case"top-left":case"bottom-left":case"left":M=v}return[M,D]}(h,c[0],c[1]):function(f,v){let E=0,M=0;v<0&&(v=0);const D=v/Math.SQRT2;switch(f){case"top-right":case"top-left":M=D-Ku;break;case"bottom-right":case"bottom-left":M=-D+Ku;break;case"bottom":M=-v+Ku;break;case"top":M=v-Ku}switch(f){case"top-right":case"bottom-right":E=-D;break;case"top-left":case"bottom-left":E=D;break;case"left":E=v;break;case"right":E=-v}return[E,M]}(h,c[0])}function af(h,c,f){var v;const E=h.layout,M=(v=E.get("text-variable-anchor-offset"))===null||v===void 0?void 0:v.evaluate(c,{},f);if(M){const G=M.values,$=[];for(let X=0;X<G.length;X+=2){const se=$[X]=G[X],Ae=G[X+1].map(me=>me*Ss);se.startsWith("top")?Ae[1]-=Ku:se.startsWith("bottom")&&(Ae[1]+=Ku),$[X+1]=Ae}return new us($)}const D=E.get("text-variable-anchor");if(D){let G;G=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[E.get("text-radial-offset").evaluate(c,{},f)*Ss,Ip]:E.get("text-offset").evaluate(c,{},f).map(X=>X*Ss);const $=[];for(const X of D)$.push(X,x_(X,G));return new us($)}return null}function Lp(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function $x(h,c,f,v,E,M,D,G,$,X,se){let Ae=M.textMaxSize.evaluate(c,{});Ae===void 0&&(Ae=D);const me=h.layers[0].layout,Be=me.get("icon-offset").evaluate(c,{},se),Te=Mp(f.horizontal),ke=D/24,je=h.tilePixelRatio*ke,$e=h.tilePixelRatio*Ae/24,ct=h.tilePixelRatio*G,Ye=h.tilePixelRatio*me.get("symbol-spacing"),tt=me.get("text-padding")*h.tilePixelRatio,gt=function(Zt,Vi,Qi){let gr=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const Dr=Zt.get("icon-padding").evaluate(Vi,{},Qi),zr=Dr&&Dr.values;return[zr[0]*gr,zr[1]*gr,zr[2]*gr,zr[3]*gr]}(me,c,se,h.tilePixelRatio),St=me.get("text-max-angle")/180*Math.PI,Xt=me.get("text-rotation-alignment")!=="viewport"&&me.get("symbol-placement")!=="point",xi=me.get("icon-rotation-alignment")==="map"&&me.get("symbol-placement")!=="point",oi=me.get("symbol-placement"),Ai=Ye/2,fi=me.get("icon-text-fit");let Fi;v&&fi!=="none"&&(h.allowVerticalPlacement&&f.vertical&&(Fi=Tm(v,f.vertical,fi,me.get("icon-text-fit-padding"),Be,ke)),Te&&(v=Tm(v,Te,fi,me.get("icon-text-fit-padding"),Be,ke)));const ai=(Zt,Vi)=>{Vi.x<0||Vi.x>=In||Vi.y<0||Vi.y>=In||function(Qi,gr,Dr,zr,pn,as,zn,vn,Pn,cn,vr,Qn,un,en,fs,Ts,vs,Zs,Is,Fn,xr,Ns,ao,lo,tc){const vc=Qi.addToLineVertexArray(gr,Dr);let na,Wu,bc,xc,Bl=0,Ph=0,Rp=0,Wx=0,w_=-1,B_=-1;const Fh={};let $c=ts("");if(Qi.allowVerticalPlacement&&zr.vertical){const Cl=vn.layout.get("text-rotate").evaluate(xr,{},lo)+90;bc=new Tp(Pn,gr,cn,vr,Qn,zr.vertical,un,en,fs,Cl),zn&&(xc=new Tp(Pn,gr,cn,vr,Qn,zn,vs,Zs,fs,Cl))}if(pn){const Cl=vn.layout.get("icon-rotate").evaluate(xr,{}),vu=vn.layout.get("icon-text-fit")!=="none",Op=ZA(pn,Cl,ao,vu),Dh=zn?ZA(zn,Cl,ao,vu):void 0;Wu=new Tp(Pn,gr,cn,vr,Qn,pn,vs,Zs,!1,Cl),Bl=4*Op.length;const Up=Qi.iconSizeData;let pA=null;Up.kind==="source"?(pA=[qc*vn.layout.get("icon-size").evaluate(xr,{})],pA[0]>qu&&We(`${Qi.layerIds[0]}: Value for "icon-size" is >= ${bp}. Reduce your "icon-size".`)):Up.kind==="composite"&&(pA=[qc*Ns.compositeIconSizes[0].evaluate(xr,{},lo),qc*Ns.compositeIconSizes[1].evaluate(xr,{},lo)],(pA[0]>qu||pA[1]>qu)&&We(`${Qi.layerIds[0]}: Value for "icon-size" is >= ${bp}. Reduce your "icon-size".`)),Qi.addSymbols(Qi.icon,Op,pA,Fn,Is,xr,s.ai.none,gr,vc.lineStartIndex,vc.lineLength,-1,lo),w_=Qi.icon.placedSymbolArray.length-1,Dh&&(Ph=4*Dh.length,Qi.addSymbols(Qi.icon,Dh,pA,Fn,Is,xr,s.ai.vertical,gr,vc.lineStartIndex,vc.lineLength,-1,lo),B_=Qi.icon.placedSymbolArray.length-1)}const kp=Object.keys(zr.horizontal);for(const Cl of kp){const vu=zr.horizontal[Cl];if(!na){$c=ts(vu.text);const Dh=vn.layout.get("text-rotate").evaluate(xr,{},lo);na=new Tp(Pn,gr,cn,vr,Qn,vu,un,en,fs,Dh)}const Op=vu.positionedLines.length===1;if(Rp+=Fm(Qi,gr,vu,as,vn,fs,xr,Ts,vc,zr.vertical?s.ai.horizontal:s.ai.horizontalOnly,Op?kp:[Cl],Fh,w_,Ns,lo),Op)break}zr.vertical&&(Wx+=Fm(Qi,gr,zr.vertical,as,vn,fs,xr,Ts,vc,s.ai.vertical,["vertical"],Fh,B_,Ns,lo));const Xx=na?na.boxStartIndex:Qi.collisionBoxArray.length,DI=na?na.boxEndIndex:Qi.collisionBoxArray.length,RI=bc?bc.boxStartIndex:Qi.collisionBoxArray.length,kI=bc?bc.boxEndIndex:Qi.collisionBoxArray.length,Oa=Wu?Wu.boxStartIndex:Qi.collisionBoxArray.length,wc=Wu?Wu.boxEndIndex:Qi.collisionBoxArray.length,JA=xc?xc.boxStartIndex:Qi.collisionBoxArray.length,_u=xc?xc.boxEndIndex:Qi.collisionBoxArray.length;let Ua=-1;const Bc=(Cl,vu)=>Cl&&Cl.circleDiameter?Math.max(Cl.circleDiameter,vu):vu;Ua=Bc(na,Ua),Ua=Bc(bc,Ua),Ua=Bc(Wu,Ua),Ua=Bc(xc,Ua);const cz=Ua>-1?1:0;cz&&(Ua*=tc/Ss),Qi.glyphOffsetArray.length>=XA.MAX_GLYPHS&&We("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xr.sortKey!==void 0&&Qi.addToSortKeyRanges(Qi.symbolInstances.length,xr.sortKey);const Rve=af(vn,xr,lo),[kve,Ove]=function(Cl,vu){const Op=Cl.length,Dh=vu==null?void 0:vu.values;if((Dh==null?void 0:Dh.length)>0)for(let Up=0;Up<Dh.length;Up+=2){const pA=Dh[Up+1];Cl.emplaceBack(s.aq[Dh[Up]],pA[0],pA[1])}return[Op,Cl.length]}(Qi.textAnchorOffsets,Rve);Qi.symbolInstances.emplaceBack(gr.x,gr.y,Fh.right>=0?Fh.right:-1,Fh.center>=0?Fh.center:-1,Fh.left>=0?Fh.left:-1,Fh.vertical||-1,w_,B_,$c,Xx,DI,RI,kI,Oa,wc,JA,_u,cn,Rp,Wx,Bl,Ph,cz,0,un,Ua,kve,Ove)}(h,Vi,Zt,f,v,E,Fi,h.layers[0],h.collisionBoxArray,c.index,c.sourceLayerIndex,h.index,je,[tt,tt,tt,tt],Xt,$,ct,gt,xi,Be,c,M,X,se,D)};if(oi==="line")for(const Zt of __(c.geometry,0,0,In,In)){const Vi=PI(Zt,Ye,St,f.vertical||Te,v,24,$e,h.overscaling,In);for(const Qi of Vi)Te&&Pp(h,Te.text,Ai,Qi)||ai(Zt,Qi)}else if(oi==="line-center"){for(const Zt of c.geometry)if(Zt.length>1){const Vi=MI(Zt,St,f.vertical||Te,v,24,$e);Vi&&ai(Zt,Vi)}}else if(c.type==="Polygon")for(const Zt of O0(c.geometry,0)){const Vi=jx(Zt,16);ai(Zt[0],new yu(Vi.x,Vi.y,0))}else if(c.type==="LineString")for(const Zt of c.geometry)ai(Zt,new yu(Zt[0].x,Zt[0].y,0));else if(c.type==="Point")for(const Zt of c.geometry)for(const Vi of Zt)ai([Vi],new yu(Vi.x,Vi.y,0))}function Fm(h,c,f,v,E,M,D,G,$,X,se,Ae,me,Be,Te){const ke=function(ct,Ye,tt,gt,St,Xt,xi,oi){const Ai=gt.layout.get("text-rotate").evaluate(Xt,{})*Math.PI/180,fi=[];for(const Fi of Ye.positionedLines)for(const ai of Fi.positionedGlyphs){if(!ai.rect)continue;const Zt=ai.rect||{};let Vi=yp+1,Qi=!0,gr=1,Dr=0;const zr=(St||oi)&&ai.vertical,pn=ai.metrics.advance*ai.scale/2;if(oi&&Ye.verticalizable&&(Dr=Fi.lineOffset/2-(ai.imageName?-(Ss-ai.metrics.width*ai.scale)/2:(ai.scale-1)*Ss)),ai.imageName){const Fn=xi[ai.imageName];Qi=Fn.sdf,gr=Fn.pixelRatio,Vi=wl/gr}const as=St?[ai.x+pn,ai.y]:[0,0];let zn=St?[0,0]:[ai.x+pn+tt[0],ai.y+tt[1]-Dr],vn=[0,0];zr&&(vn=zn,zn=[0,0]);const Pn=ai.metrics.isDoubleResolution?2:1,cn=(ai.metrics.left-Vi)*ai.scale-pn+zn[0],vr=(-ai.metrics.top-Vi)*ai.scale+zn[1],Qn=cn+Zt.w/Pn*ai.scale/gr,un=vr+Zt.h/Pn*ai.scale/gr,en=new k(cn,vr),fs=new k(Qn,vr),Ts=new k(cn,un),vs=new k(Qn,un);if(zr){const Fn=new k(-pn,pn-Kd),xr=-Math.PI/2,Ns=Ss/2-pn,ao=new k(5-Kd-Ns,-(ai.imageName?Ns:0)),lo=new k(...vn);en._rotateAround(xr,Fn)._add(ao)._add(lo),fs._rotateAround(xr,Fn)._add(ao)._add(lo),Ts._rotateAround(xr,Fn)._add(ao)._add(lo),vs._rotateAround(xr,Fn)._add(ao)._add(lo)}if(Ai){const Fn=Math.sin(Ai),xr=Math.cos(Ai),Ns=[xr,-Fn,Fn,xr];en._matMult(Ns),fs._matMult(Ns),Ts._matMult(Ns),vs._matMult(Ns)}const Zs=new k(0,0),Is=new k(0,0);fi.push({tl:en,tr:fs,bl:Ts,br:vs,tex:Zt,writingMode:Ye.writingMode,glyphOffset:as,sectionIndex:ai.sectionIndex,isSDF:Qi,pixelOffsetTL:Zs,pixelOffsetBR:Is,minFontScaleX:0,minFontScaleY:0})}return fi}(0,f,G,E,M,D,v,h.allowVerticalPlacement),je=h.textSizeData;let $e=null;je.kind==="source"?($e=[qc*E.layout.get("text-size").evaluate(D,{})],$e[0]>qu&&We(`${h.layerIds[0]}: Value for "text-size" is >= ${bp}. Reduce your "text-size".`)):je.kind==="composite"&&($e=[qc*Be.compositeTextSizes[0].evaluate(D,{},Te),qc*Be.compositeTextSizes[1].evaluate(D,{},Te)],($e[0]>qu||$e[1]>qu)&&We(`${h.layerIds[0]}: Value for "text-size" is >= ${bp}. Reduce your "text-size".`)),h.addSymbols(h.text,ke,$e,G,M,D,X,c,$.lineStartIndex,$.lineLength,me,Te);for(const ct of se)Ae[ct]=h.text.placedSymbolArray.length-1;return 4*ke.length}function Mp(h){for(const c in h)return h[c];return null}function Pp(h,c,f,v){const E=h.compareText;if(c in E){const M=E[c];for(let D=M.length-1;D>=0;D--)if(v.dist(M[D])<f)return!0}else E[c]=[];return E[c].push(v),!1}const Dm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Fp{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[f,v]=new Uint8Array(c,0,2);if(f!==219)throw new Error("Data does not appear to be in a KDBush format.");const E=v>>4;if(E!==1)throw new Error(`Got v${E} data when expected v1.`);const M=Dm[15&v];if(!M)throw new Error("Unrecognized array type.");const[D]=new Uint16Array(c,2,1),[G]=new Uint32Array(c,4,1);return new Fp(G,D,M,c)}constructor(c){let f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,E=arguments.length>3?arguments[3]:void 0;if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+f,2),65535),this.ArrayType=v,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;const M=Dm.indexOf(this.ArrayType),D=2*c*this.ArrayType.BYTES_PER_ELEMENT,G=c*this.IndexArrayType.BYTES_PER_ELEMENT,$=(8-G%8)%8;if(M<0)throw new Error(`Unexpected typed array class: ${v}.`);E&&E instanceof ArrayBuffer?(this.data=E,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+G+$,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+D+G+$),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+G+$,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+M]),new Uint16Array(this.data,2,1)[0]=f,new Uint32Array(this.data,4,1)[0]=c)}add(c,f){const v=this._pos>>1;return this.ids[v]=v,this.coords[this._pos++]=c,this.coords[this._pos++]=f,v}finish(){const c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return Dp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,f,v,E){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:M,coords:D,nodeSize:G}=this,$=[0,M.length-1,0],X=[];for(;$.length;){const se=$.pop()||0,Ae=$.pop()||0,me=$.pop()||0;if(Ae-me<=G){for(let je=me;je<=Ae;je++){const $e=D[2*je],ct=D[2*je+1];$e>=c&&$e<=v&&ct>=f&&ct<=E&&X.push(M[je])}continue}const Be=me+Ae>>1,Te=D[2*Be],ke=D[2*Be+1];Te>=c&&Te<=v&&ke>=f&&ke<=E&&X.push(M[Be]),(se===0?c<=Te:f<=ke)&&($.push(me),$.push(Be-1),$.push(1-se)),(se===0?v>=Te:E>=ke)&&($.push(Be+1),$.push(Ae),$.push(1-se))}return X}within(c,f,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:E,coords:M,nodeSize:D}=this,G=[0,E.length-1,0],$=[],X=v*v;for(;G.length;){const se=G.pop()||0,Ae=G.pop()||0,me=G.pop()||0;if(Ae-me<=D){for(let je=me;je<=Ae;je++)m(M[2*je],M[2*je+1],c,f)<=X&&$.push(E[je]);continue}const Be=me+Ae>>1,Te=M[2*Be],ke=M[2*Be+1];m(Te,ke,c,f)<=X&&$.push(E[Be]),(se===0?c-v<=Te:f-v<=ke)&&(G.push(me),G.push(Be-1),G.push(1-se)),(se===0?c+v>=Te:f+v>=ke)&&(G.push(Be+1),G.push(Ae),G.push(1-se))}return $}}function Dp(h,c,f,v,E,M){if(E-v<=f)return;const D=v+E>>1;Kx(h,c,D,v,E,M),Dp(h,c,f,v,D-1,1-M),Dp(h,c,f,D+1,E,1-M)}function Kx(h,c,f,v,E,M){for(;E>v;){if(E-v>600){const X=E-v+1,se=f-v+1,Ae=Math.log(X),me=.5*Math.exp(2*Ae/3),Be=.5*Math.sqrt(Ae*me*(X-me)/X)*(se-X/2<0?-1:1);Kx(h,c,f,Math.max(v,Math.floor(f-se*me/X+Be)),Math.min(E,Math.floor(f+(X-se)*me/X+Be)),M)}const D=c[2*f+M];let G=v,$=E;for(p(h,c,v,f),c[2*E+M]>D&&p(h,c,v,E);G<$;){for(p(h,c,G,$),G++,$--;c[2*G+M]<D;)G++;for(;c[2*$+M]>D;)$--}c[2*v+M]===D?p(h,c,v,$):($++,p(h,c,$,E)),$<=f&&(v=$+1),f<=$&&(E=$-1)}}function p(h,c,f,v){u(h,f,v),u(c,2*f,2*v),u(c,2*f+1,2*v+1)}function u(h,c,f){const v=h[c];h[c]=h[f],h[f]=v}function m(h,c,f,v){const E=h-f,M=c-v;return E*E+M*M}var C;s.bh=void 0,(C=s.bh||(s.bh={})).create="create",C.load="load",C.fullLoad="fullLoad";let P=null,Q=[];const V=1e3/60,K="loadTime",re="fullLoadTime",he={mark(h){performance.mark(h)},frame(h){const c=h;P!=null&&Q.push(c-P),P=c},clearMetrics(){P=null,Q=[],performance.clearMeasures(K),performance.clearMeasures(re);for(const h in s.bh)performance.clearMarks(s.bh[h])},getPerformanceMetrics(){performance.measure(K,s.bh.create,s.bh.load),performance.measure(re,s.bh.create,s.bh.fullLoad);const h=performance.getEntriesByName(K)[0].duration,c=performance.getEntriesByName(re)[0].duration,f=Q.length,v=1/(Q.reduce((M,D)=>M+D,0)/f/1e3),E=Q.filter(M=>M>V).reduce((M,D)=>M+(D-V)/V,0);return{loadTime:h,fullLoadTime:c,fps:v,percentDroppedFrames:E/(f+E)*100,totalFrames:f}}};s.$=function(h,c,f){var v,E,M,D,G,$,X,se,Ae,me,Be,Te,ke=f[0],je=f[1],$e=f[2];return c===h?(h[12]=c[0]*ke+c[4]*je+c[8]*$e+c[12],h[13]=c[1]*ke+c[5]*je+c[9]*$e+c[13],h[14]=c[2]*ke+c[6]*je+c[10]*$e+c[14],h[15]=c[3]*ke+c[7]*je+c[11]*$e+c[15]):(E=c[1],M=c[2],D=c[3],G=c[4],$=c[5],X=c[6],se=c[7],Ae=c[8],me=c[9],Be=c[10],Te=c[11],h[0]=v=c[0],h[1]=E,h[2]=M,h[3]=D,h[4]=G,h[5]=$,h[6]=X,h[7]=se,h[8]=Ae,h[9]=me,h[10]=Be,h[11]=Te,h[12]=v*ke+G*je+Ae*$e+c[12],h[13]=E*ke+$*je+me*$e+c[13],h[14]=M*ke+X*je+Be*$e+c[14],h[15]=D*ke+se*je+Te*$e+c[15]),h},s.A=jc,s.B=hs,s.C=class{constructor(h,c,f){this.receive=v=>{const E=v.data,M=E.id;if(M&&(!E.targetMapId||this.mapId===E.targetMapId))if(E.type==="<cancel>"){delete this.tasks[M];const D=this.cancelCallbacks[M];delete this.cancelCallbacks[M],D&&D()}else Lt()||E.mustQueue?(this.tasks[M]=E,this.taskQueue.push(M),this.invoker.trigger()):this.processTask(M,E)},this.process=()=>{if(!this.taskQueue.length)return;const v=this.taskQueue.shift(),E=this.tasks[v];delete this.tasks[v],this.taskQueue.length&&this.invoker.trigger(),E&&this.processTask(v,E)},this.target=h,this.parent=c,this.mapId=f,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Lm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Lt()?h:window}send(h,c,f,v){let E=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const M=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(this.callbacks[M]=f);const D=[],G={id:M,type:h,hasCallback:!!f,targetMapId:v,mustQueue:E,sourceMapId:this.mapId,data:Pi(c,D)};return this.target.postMessage(G,{transfer:D}),{cancel:()=>{f&&delete this.callbacks[M],this.target.postMessage({id:M,type:"<cancel>",targetMapId:v,sourceMapId:this.mapId})}}}processTask(h,c){if(c.type==="<response>"){const f=this.callbacks[h];delete this.callbacks[h],f&&(c.error?f(gl(c.error)):f(null,gl(c.data)))}else{let f=!1;const v=[],E=c.hasCallback?(G,$)=>{f=!0,delete this.cancelCallbacks[h];const X={id:h,type:"<response>",sourceMapId:this.mapId,error:G?Pi(G):null,data:Pi($,v)};this.target.postMessage(X,{transfer:v})}:G=>{f=!0};let M=null;const D=gl(c.data);if(this.parent[c.type])M=this.parent[c.type](c.sourceMapId,D,E);else if("getWorkerSource"in this.parent){const G=c.type.split(".");M=this.parent.getWorkerSource(c.sourceMapId,G[0],D.source)[G[1]](D,E)}else E(new Error(`Could not find function ${c.type}`));!f&&M&&M.cancel&&(this.cancelCallbacks[h]=M.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.D=$i,s.E=ei,s.F=function(h,c){const f={};for(let v=0;v<c.length;v++){const E=c[v];E in h&&(f[E]=h[E])}return f},s.G=ef,s.H=c_,s.I=Cm,s.J=de,s.K=_e,s.L=$u,s.M=Wt,s.N=In,s.O=zo,s.P=k,s.Q=Nn,s.R=Uo,s.S=Ti,s.T=zc,s.U=wp,s.V=class extends Da{},s.W=d_,s.X=function(h,c){const f=window.document.createElement("video");f.muted=!0,f.onloadstart=function(){c(null,f)};for(let v=0;v<h.length;v++){const E=window.document.createElement("source");Mi(h[v])||(f.crossOrigin="Anonymous"),E.src=h[v],f.appendChild(E)}return{cancel:()=>{}}},s.Y=$t,s.Z=function(){var h=new jc(16);return jc!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},s._=g,s.a=Ft,s.a$=class extends H{},s.a0=function(h,c,f){var v=f[0],E=f[1],M=f[2];return h[0]=c[0]*v,h[1]=c[1]*v,h[2]=c[2]*v,h[3]=c[3]*v,h[4]=c[4]*E,h[5]=c[5]*E,h[6]=c[6]*E,h[7]=c[7]*E,h[8]=c[8]*M,h[9]=c[9]*M,h[10]=c[10]*M,h[11]=c[11]*M,h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15],h},s.a1=lA,s.a2=function(){return ot++},s.a3=I,s.a4=XA,s.a5=function(){Ks.isLoading()||Ks.isLoaded()||uu()!=="deferred"||_a()},s.a6=hl,s.a7=Hc,s.a8=bi,s.a9=m_,s.aA=Xl,s.aB=function(h){h=h.slice();const c=Object.create(null);for(let f=0;f<h.length;f++)c[h[f].id]=h[f];for(let f=0;f<h.length;f++)"ref"in h[f]&&(h[f]=ni(h[f],c[h[f].ref]));return h},s.aC=function(h){if(h.type==="custom")return new a_(h);switch(h.type){case"background":return new Nx(h);case"circle":return new bl(h);case"fill":return new pI(h);case"fill-extrusion":return new px(h);case"heatmap":return new ka(h);case"hillshade":return new zd(h);case"line":return new _o(h);case"raster":return new Qx(h);case"symbol":return new Yd(h)}},s.aD=Me,s.aE=function(h,c){if(!h)return[{command:li.setStyle,args:[c]}];let f=[];try{if(!di(h.version,c.version))return[{command:li.setStyle,args:[c]}];di(h.center,c.center)||f.push({command:li.setCenter,args:[c.center]}),di(h.zoom,c.zoom)||f.push({command:li.setZoom,args:[c.zoom]}),di(h.bearing,c.bearing)||f.push({command:li.setBearing,args:[c.bearing]}),di(h.pitch,c.pitch)||f.push({command:li.setPitch,args:[c.pitch]}),di(h.sprite,c.sprite)||f.push({command:li.setSprite,args:[c.sprite]}),di(h.glyphs,c.glyphs)||f.push({command:li.setGlyphs,args:[c.glyphs]}),di(h.transition,c.transition)||f.push({command:li.setTransition,args:[c.transition]}),di(h.light,c.light)||f.push({command:li.setLight,args:[c.light]});const v={},E=[];(function(D,G,$,X){let se;for(se in G=G||{},D=D||{})Object.prototype.hasOwnProperty.call(D,se)&&(Object.prototype.hasOwnProperty.call(G,se)||tr(se,$,X));for(se in G)Object.prototype.hasOwnProperty.call(G,se)&&(Object.prototype.hasOwnProperty.call(D,se)?di(D[se],G[se])||(D[se].type==="geojson"&&G[se].type==="geojson"&&Er(D,G,se)?$.push({command:li.setGeoJSONSourceData,args:[se,G[se].data]}):Ar(se,G,$,X)):Ki(se,G,$))})(h.sources,c.sources,E,v);const M=[];h.layers&&h.layers.forEach(D=>{v[D.source]?f.push({command:li.removeLayer,args:[D.id]}):M.push(D)}),f=f.concat(E),function(D,G,$){G=G||[];const X=(D=D||[]).map(Ji),se=G.map(Ji),Ae=D.reduce(ci,{}),me=G.reduce(ci,{}),Be=X.slice(),Te=Object.create(null);let ke,je,$e,ct,Ye,tt,gt;for(ke=0,je=0;ke<X.length;ke++)$e=X[ke],Object.prototype.hasOwnProperty.call(me,$e)?je++:($.push({command:li.removeLayer,args:[$e]}),Be.splice(Be.indexOf($e,je),1));for(ke=0,je=0;ke<se.length;ke++)$e=se[se.length-1-ke],Be[Be.length-1-ke]!==$e&&(Object.prototype.hasOwnProperty.call(Ae,$e)?($.push({command:li.removeLayer,args:[$e]}),Be.splice(Be.lastIndexOf($e,Be.length-je),1)):je++,tt=Be[Be.length-ke],$.push({command:li.addLayer,args:[me[$e],tt]}),Be.splice(Be.length-ke,0,$e),Te[$e]=!0);for(ke=0;ke<se.length;ke++)if($e=se[ke],ct=Ae[$e],Ye=me[$e],!Te[$e]&&!di(ct,Ye))if(di(ct.source,Ye.source)&&di(ct["source-layer"],Ye["source-layer"])&&di(ct.type,Ye.type)){for(gt in Nt(ct.layout,Ye.layout,$,$e,null,li.setLayoutProperty),Nt(ct.paint,Ye.paint,$,$e,null,li.setPaintProperty),di(ct.filter,Ye.filter)||$.push({command:li.setFilter,args:[$e,Ye.filter]}),di(ct.minzoom,Ye.minzoom)&&di(ct.maxzoom,Ye.maxzoom)||$.push({command:li.setLayerZoomRange,args:[$e,Ye.minzoom,Ye.maxzoom]}),ct)Object.prototype.hasOwnProperty.call(ct,gt)&&gt!=="layout"&&gt!=="paint"&&gt!=="filter"&&gt!=="metadata"&&gt!=="minzoom"&&gt!=="maxzoom"&&(gt.indexOf("paint.")===0?Nt(ct[gt],Ye[gt],$,$e,gt.slice(6),li.setPaintProperty):di(ct[gt],Ye[gt])||$.push({command:li.setLayerProperty,args:[$e,gt,Ye[gt]]}));for(gt in Ye)Object.prototype.hasOwnProperty.call(Ye,gt)&&!Object.prototype.hasOwnProperty.call(ct,gt)&&gt!=="layout"&&gt!=="paint"&&gt!=="filter"&&gt!=="metadata"&&gt!=="minzoom"&&gt!=="maxzoom"&&(gt.indexOf("paint.")===0?Nt(ct[gt],Ye[gt],$,$e,gt.slice(6),li.setPaintProperty):di(ct[gt],Ye[gt])||$.push({command:li.setLayerProperty,args:[$e,gt,Ye[gt]]}))}else $.push({command:li.removeLayer,args:[$e]}),tt=Be[Be.lastIndexOf($e)+1],$.push({command:li.addLayer,args:[Ye,tt]})}(M,c.layers,f)}catch(v){console.warn("Unable to compute style diff:",v),f=[{command:li.setStyle,args:[c]}]}return f},s.aF=function(h){const c=[],f=h.id;return f===void 0&&c.push({message:`layers.${f}: missing required property "id"`}),h.render===void 0&&c.push({message:`layers.${f}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&c.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),c},s.aG=function h(c,f){if(Array.isArray(c)){if(!Array.isArray(f)||c.length!==f.length)return!1;for(let v=0;v<c.length;v++)if(!h(c[v],f[v]))return!1;return!0}if(typeof c=="object"&&c!==null&&f!==null){if(typeof f!="object"||Object.keys(c).length!==Object.keys(f).length)return!1;for(const v in c)if(!h(c[v],f[v]))return!1;return!0}return c===f},s.aH=it,s.aI=De,s.aJ=gc,s.aK=function(h){return h({pluginStatus:Cs,pluginURL:Do}),gc.on("pluginStateChange",h),h},s.aL=class extends ln{constructor(h,c){super(h,c),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},s.aM=qr,s.aN=class extends ln{constructor(h,c){super(h,c),this.current=Kn}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let c=1;c<16;c++)if(h[c]!==this.current[c]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},s.aO=Wr,s.aP=class extends ln{constructor(h,c){super(h,c),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},s.aQ=class extends ln{constructor(h,c){super(h,c),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},s.aR=Mn,s.aS=function(h,c,f,v,E,M,D){var G=1/(c-f),$=1/(v-E),X=1/(M-D);return h[0]=-2*G,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*$,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*X,h[11]=0,h[12]=(c+f)*G,h[13]=(E+v)*$,h[14]=(D+M)*X,h[15]=1,h},s.aT=lr,s.aU=Ud,s.aV=class extends L{},s.aW=Bx,s.aX=class extends y{},s.aY=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},s.aZ=cA,s.a_=Fe,s.aa=function(h){const c={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(f,v,E,M)=>{const D=E||M;return c[v]=!D||D.toLowerCase(),""}),c["max-age"]){const f=parseInt(c["max-age"],10);isNaN(f)?delete c["max-age"]:c["max-age"]=f}return c},s.ab=function(h,c){const f=[];for(const v in h)v in c||f.push(v);return f},s.ac=function(h){if(_t==null){const c=h.navigator?h.navigator.userAgent:null;_t=!!h.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return _t},s.ad=Ve,s.ae=function(h,c,f){var v=Math.sin(f),E=Math.cos(f),M=c[0],D=c[1],G=c[2],$=c[3],X=c[4],se=c[5],Ae=c[6],me=c[7];return c!==h&&(h[8]=c[8],h[9]=c[9],h[10]=c[10],h[11]=c[11],h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15]),h[0]=M*E+X*v,h[1]=D*E+se*v,h[2]=G*E+Ae*v,h[3]=$*E+me*v,h[4]=X*E-M*v,h[5]=se*E-D*v,h[6]=Ae*E-G*v,h[7]=me*E-$*v,h},s.af=function(h){var c=new jc(16);return c[0]=h[0],c[1]=h[1],c[2]=h[2],c[3]=h[3],c[4]=h[4],c[5]=h[5],c[6]=h[6],c[7]=h[7],c[8]=h[8],c[9]=h[9],c[10]=h[10],c[11]=h[11],c[12]=h[12],c[13]=h[13],c[14]=h[14],c[15]=h[15],c},s.ag=mu,s.ah=function(h,c){let f=0,v=0;if(h.kind==="constant")v=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:E,minZoom:M,maxZoom:D}=h,G=E?Ve(dn.interpolationFactor(E,c,M,D),0,1):0;h.kind==="camera"?v=hs.number(h.minSize,h.maxSize,G):f=G}return{uSizeT:f,uSize:v}},s.aj=function(h,c,f){let{uSize:v,uSizeT:E}=c,{lowerSize:M,upperSize:D}=f;return h.kind==="source"?M/qc:h.kind==="composite"?hs.number(M/qc,D/qc,E):v},s.ak=Jd,s.al=function(h,c,f,v){const E=c.y-h.y,M=c.x-h.x,D=v.y-f.y,G=v.x-f.x,$=D*M-G*E;if($===0)return null;const X=(G*(h.y-f.y)-D*(h.x-f.x))/$;return new k(h.x+X*M,h.y+X*E)},s.am=__,s.an=Gc,s.ao=Od,s.ap=Ss,s.ar=Im,s.as=function(h,c){var f=c[0],v=c[1],E=c[2],M=c[3],D=c[4],G=c[5],$=c[6],X=c[7],se=c[8],Ae=c[9],me=c[10],Be=c[11],Te=c[12],ke=c[13],je=c[14],$e=c[15],ct=f*G-v*D,Ye=f*$-E*D,tt=f*X-M*D,gt=v*$-E*G,St=v*X-M*G,Xt=E*X-M*$,xi=se*ke-Ae*Te,oi=se*je-me*Te,Ai=se*$e-Be*Te,fi=Ae*je-me*ke,Fi=Ae*$e-Be*ke,ai=me*$e-Be*je,Zt=ct*ai-Ye*Fi+tt*fi+gt*Ai-St*oi+Xt*xi;return Zt?(h[0]=(G*ai-$*Fi+X*fi)*(Zt=1/Zt),h[1]=(E*Fi-v*ai-M*fi)*Zt,h[2]=(ke*Xt-je*St+$e*gt)*Zt,h[3]=(me*St-Ae*Xt-Be*gt)*Zt,h[4]=($*Ai-D*ai-X*oi)*Zt,h[5]=(f*ai-E*Ai+M*oi)*Zt,h[6]=(je*tt-Te*Xt-$e*Ye)*Zt,h[7]=(se*Xt-me*tt+Be*Ye)*Zt,h[8]=(D*Fi-G*Ai+X*xi)*Zt,h[9]=(v*Ai-f*Fi-M*xi)*Zt,h[10]=(Te*St-ke*tt+$e*ct)*Zt,h[11]=(Ae*tt-se*St-Be*ct)*Zt,h[12]=(G*oi-D*fi-$*xi)*Zt,h[13]=(f*fi-v*oi+E*xi)*Zt,h[14]=(ke*Ye-Te*gt-je*ct)*Zt,h[15]=(se*gt-Ae*Ye+me*ct)*Zt,h):null},s.at=Lp,s.au=t_,s.av=Fp,s.aw=function(){const h={},c=ut.$version;for(const f in ut.$root){const v=ut.$root[f];if(v.required){let E=null;E=f==="version"?c:v.type==="array"?[]:{},E!=null&&(h[f]=E)}}return h},s.ax=li,s.ay=$l,s.az=It,s.b=function(h,c){const f=new Blob([new Uint8Array(h)],{type:"image/png"});createImageBitmap(f).then(v=>{c(null,v)}).catch(v=>{c(new Error(`Could not load image because of ${v.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},s.b0=Vt,s.b1=function(h,c){var f=h[0],v=h[1],E=h[2],M=h[3],D=h[4],G=h[5],$=h[6],X=h[7],se=h[8],Ae=h[9],me=h[10],Be=h[11],Te=h[12],ke=h[13],je=h[14],$e=h[15],ct=c[0],Ye=c[1],tt=c[2],gt=c[3],St=c[4],Xt=c[5],xi=c[6],oi=c[7],Ai=c[8],fi=c[9],Fi=c[10],ai=c[11],Zt=c[12],Vi=c[13],Qi=c[14],gr=c[15];return Math.abs(f-ct)<=ia*Math.max(1,Math.abs(f),Math.abs(ct))&&Math.abs(v-Ye)<=ia*Math.max(1,Math.abs(v),Math.abs(Ye))&&Math.abs(E-tt)<=ia*Math.max(1,Math.abs(E),Math.abs(tt))&&Math.abs(M-gt)<=ia*Math.max(1,Math.abs(M),Math.abs(gt))&&Math.abs(D-St)<=ia*Math.max(1,Math.abs(D),Math.abs(St))&&Math.abs(G-Xt)<=ia*Math.max(1,Math.abs(G),Math.abs(Xt))&&Math.abs($-xi)<=ia*Math.max(1,Math.abs($),Math.abs(xi))&&Math.abs(X-oi)<=ia*Math.max(1,Math.abs(X),Math.abs(oi))&&Math.abs(se-Ai)<=ia*Math.max(1,Math.abs(se),Math.abs(Ai))&&Math.abs(Ae-fi)<=ia*Math.max(1,Math.abs(Ae),Math.abs(fi))&&Math.abs(me-Fi)<=ia*Math.max(1,Math.abs(me),Math.abs(Fi))&&Math.abs(Be-ai)<=ia*Math.max(1,Math.abs(Be),Math.abs(ai))&&Math.abs(Te-Zt)<=ia*Math.max(1,Math.abs(Te),Math.abs(Zt))&&Math.abs(ke-Vi)<=ia*Math.max(1,Math.abs(ke),Math.abs(Vi))&&Math.abs(je-Qi)<=ia*Math.max(1,Math.abs(je),Math.abs(Qi))&&Math.abs($e-gr)<=ia*Math.max(1,Math.abs($e),Math.abs(gr))},s.b2=function(h,c){return h[0]=c[0],h[1]=c[1],h[2]=c[2],h[3]=c[3],h[4]=c[4],h[5]=c[5],h[6]=c[6],h[7]=c[7],h[8]=c[8],h[9]=c[9],h[10]=c[10],h[11]=c[11],h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15],h},s.b3=function(h,c,f){return h[0]=c[0]*f[0],h[1]=c[1]*f[1],h[2]=c[2]*f[2],h[3]=c[3]*f[3],h},s.b4=function(h,c){return h[0]*c[0]+h[1]*c[1]+h[2]*c[2]+h[3]*c[3]},s.b5=qe,s.b6=f_,s.b7=u_,s.b8=function(h,c,f,v,E){var M,D=1/Math.tan(c/2);return h[0]=D/f,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=D,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,E!=null&&E!==1/0?(h[10]=(E+v)*(M=1/(v-E)),h[14]=2*E*v*M):(h[10]=-1,h[14]=-2*v),h},s.b9=function(h,c,f){var v=Math.sin(f),E=Math.cos(f),M=c[4],D=c[5],G=c[6],$=c[7],X=c[8],se=c[9],Ae=c[10],me=c[11];return c!==h&&(h[0]=c[0],h[1]=c[1],h[2]=c[2],h[3]=c[3],h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15]),h[4]=M*E+X*v,h[5]=D*E+se*v,h[6]=G*E+Ae*v,h[7]=$*E+me*v,h[8]=X*E-M*v,h[9]=se*E-D*v,h[10]=Ae*E-G*v,h[11]=me*E-$*v,h},s.bA=T,s.bB=K0,s.bC=Lr,s.bD=Ks,s.ba=Ee,s.bb=He,s.bc=function(h,c){return h[0]=c[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=c[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=c[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},s.bd=class extends rl{},s.be=Mm,s.bf=h_,s.bg=he,s.bi=Pt,s.bj=function(h,c){let f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(Cs===Uc||Cs===Nc||Cs===il)throw new Error("setRTLTextPlugin cannot be called multiple times.");Do=ft.resolveURL(h),Cs=Uc,yn=c,Ou(),f||_a()},s.bk=uu,s.bl=function(h,c){const f={};for(let E=0;E<h.length;E++){const M=c&&c[h[E].id]||Ds(h[E]);c&&(c[h[E].id]=M);let D=f[M];D||(D=f[M]=[]),D.push(h[E])}const v=[];for(const E in f)v.push(f[E]);return v},s.bm=Oi,s.bn=g_,s.bo=Vx,s.bp=J0,s.bq=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=In/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const c=h.bucket.layers[0],f=c.layout,v=c._unevaluatedLayout._values,E={layoutIconSize:v["icon-size"].possiblyEvaluate(new bi(h.bucket.zoom+1),h.canonical),layoutTextSize:v["text-size"].possiblyEvaluate(new bi(h.bucket.zoom+1),h.canonical),textMaxSize:v["text-size"].possiblyEvaluate(new bi(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:X,maxZoom:se}=h.bucket.textSizeData;E.compositeTextSizes=[v["text-size"].possiblyEvaluate(new bi(X),h.canonical),v["text-size"].possiblyEvaluate(new bi(se),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:X,maxZoom:se}=h.bucket.iconSizeData;E.compositeIconSizes=[v["icon-size"].possiblyEvaluate(new bi(X),h.canonical),v["icon-size"].possiblyEvaluate(new bi(se),h.canonical)]}const M=f.get("text-line-height")*Ss,D=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",G=f.get("text-keep-upright"),$=f.get("text-size");for(const X of h.bucket.features){const se=f.get("text-font").evaluate(X,{},h.canonical).join(","),Ae=$.evaluate(X,{},h.canonical),me=E.layoutTextSize.evaluate(X,{},h.canonical),Be=E.layoutIconSize.evaluate(X,{},h.canonical),Te={horizontal:{},vertical:void 0},ke=X.text;let je,$e=[0,0];if(ke){const tt=ke.toString(),gt=f.get("text-letter-spacing").evaluate(X,{},h.canonical)*Ss,St=Ei(tt)?gt:0,Xt=f.get("text-anchor").evaluate(X,{},h.canonical),xi=af(c,X,h.canonical);if(!xi){const ai=f.get("text-radial-offset").evaluate(X,{},h.canonical);$e=ai?x_(Xt,[ai*Ss,Ip]):f.get("text-offset").evaluate(X,{},h.canonical).map(Zt=>Zt*Ss)}let oi=D?"center":f.get("text-justify").evaluate(X,{},h.canonical);const Ai=f.get("symbol-placement"),fi=Ai==="point"?f.get("text-max-width").evaluate(X,{},h.canonical)*Ss:0,Fi=()=>{h.bucket.allowVerticalPlacement&&Kl(tt)&&(Te.vertical=Xd(ke,h.glyphMap,h.glyphPositions,h.imagePositions,se,fi,M,Xt,"left",St,$e,s.ai.vertical,!0,Ai,me,Ae))};if(!D&&xi){const ai=new Set;if(oi==="auto")for(let Vi=0;Vi<xi.values.length;Vi+=2)ai.add(Lp(xi.values[Vi]));else ai.add(oi);let Zt=!1;for(const Vi of ai)if(!Te.horizontal[Vi])if(Zt)Te.horizontal[Vi]=Te.horizontal[0];else{const Qi=Xd(ke,h.glyphMap,h.glyphPositions,h.imagePositions,se,fi,M,"center",Vi,St,$e,s.ai.horizontal,!1,Ai,me,Ae);Qi&&(Te.horizontal[Vi]=Qi,Zt=Qi.positionedLines.length===1)}Fi()}else{oi==="auto"&&(oi=Lp(Xt));const ai=Xd(ke,h.glyphMap,h.glyphPositions,h.imagePositions,se,fi,M,Xt,oi,St,$e,s.ai.horizontal,!1,Ai,me,Ae);ai&&(Te.horizontal[oi]=ai),Fi(),Kl(tt)&&D&&G&&(Te.vertical=Xd(ke,h.glyphMap,h.glyphPositions,h.imagePositions,se,fi,M,Xt,oi,St,$e,s.ai.vertical,!1,Ai,me,Ae))}}let ct=!1;if(X.icon&&X.icon.name){const tt=h.imageMap[X.icon.name];tt&&(je=Sm(h.imagePositions[X.icon.name],f.get("icon-offset").evaluate(X,{},h.canonical),f.get("icon-anchor").evaluate(X,{},h.canonical)),ct=!!tt.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=ct:h.bucket.sdfIcons!==ct&&We("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tt.pixelRatio!==h.bucket.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const Ye=Mp(Te.horizontal)||Te.vertical;h.bucket.iconsInText=!!Ye&&Ye.iconsInText,(Ye||je)&&$x(h.bucket,X,Te,je,h.imageMap,E,me,Be,$e,ct,h.canonical)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},s.br=j0,s.bs=N0,s.bt=H0,s.bu=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},s.bv=Bm,s.bw=hA,s.bx=function(h,c,f,v,E){return g(this,void 0,void 0,function*(){if(_e())try{return yield Wt(h,c,f,v,E)}catch{}return function(M,D,G,$,X){const se=M.width,Ae=M.height;Se&&Xe||(Se=new OffscreenCanvas(se,Ae),Xe=Se.getContext("2d",{willReadFrequently:!0})),Se.width=se,Se.height=Ae,Xe.drawImage(M,0,0,se,Ae);const me=Xe.getImageData(D,G,$,X);return Xe.clearRect(0,0,se,Ae),me.data}(h,c,f,v,E)})},s.by=p_,s.bz=b,s.c=wt,s.d=function(h,c){const f=new Image;f.onload=()=>{c(null,f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Mt})},f.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(h)],{type:"image/png"});f.src=h.byteLength?URL.createObjectURL(v):Mt},s.e=Ue,s.f=function(h,c){return gi(Ue(h,{type:"json"}),c)},s.g=Ht,s.h=ft,s.i=Lt,s.j=Ri,s.k=xt,s.l=mi,s.m=gi,s.n=function(h){return new Bm(h).readFields(gp,[])},s.o=function(h,c,f){if(!h.length)return f(null,[]);let v=h.length;const E=new Array(h.length);let M=null;h.forEach((D,G)=>{c(D,($,X)=>{$&&(M=$),E[G]=X,--v==0&&f(M,E)})})},s.p=_p,s.q=yc,s.r=tn,s.s=Mi,s.t=an,s.u=Li,s.v=ut,s.w=We,s.x=Fa,s.y=Zr,s.z=function(h){let[c,f,v]=h;return f+=90,f*=Math.PI/180,v*=Math.PI/180,{x:c*Math.cos(f)*Math.sin(v),y:c*Math.sin(f)*Math.sin(v),z:c*Math.cos(v)}}}),o(["./shared"],function(s){class g{constructor(ee){this.keyCache={},ee&&this.replace(ee)}replace(ee){this._layerConfigs={},this._layers={},this.update(ee,[])}update(ee,le){for(const ve of ee){this._layerConfigs[ve.id]=ve;const Ce=this._layers[ve.id]=s.aC(ve);Ce._featureFilter=s.a6(Ce.filter),this.keyCache[ve.id]&&delete this.keyCache[ve.id]}for(const ve of le)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const ge=s.bl(Object.values(this._layerConfigs),this.keyCache);for(const ve of ge){const Ce=ve.map(yt=>this._layers[yt.id]),be=Ce[0];if(be.visibility==="none")continue;const Pe=be.source||"";let Oe=this.familiesBySource[Pe];Oe||(Oe=this.familiesBySource[Pe]={});const Ge=be.sourceLayer||"_geojsonTileLayer";let rt=Oe[Ge];rt||(rt=Oe[Ge]=[]),rt.push(Ce)}}}class b{constructor(ee){const le={},ge=[];for(const Pe in ee){const Oe=ee[Pe],Ge=le[Pe]={};for(const rt in Oe){const yt=Oe[+rt];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;const Et={x:0,y:0,w:yt.bitmap.width+2,h:yt.bitmap.height+2};ge.push(Et),Ge[rt]={rect:Et,metrics:yt.metrics}}}const{w:ve,h:Ce}=s.p(ge),be=new s.q({width:ve||1,height:Ce||1});for(const Pe in ee){const Oe=ee[Pe];for(const Ge in Oe){const rt=Oe[+Ge];if(!rt||rt.bitmap.width===0||rt.bitmap.height===0)continue;const yt=le[Pe][Ge].rect;s.q.copy(rt.bitmap,be,{x:0,y:0},{x:yt.x+1,y:yt.y+1},rt.bitmap)}}this.image=be,this.positions=le}}s.bm("GlyphAtlas",b);class T{constructor(ee){this.tileID=new s.O(ee.tileID.overscaledZ,ee.tileID.wrap,ee.tileID.canonical.z,ee.tileID.canonical.x,ee.tileID.canonical.y),this.uid=ee.uid,this.zoom=ee.zoom,this.pixelRatio=ee.pixelRatio,this.tileSize=ee.tileSize,this.source=ee.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ee.showCollisionBoxes,this.collectResourceTiming=!!ee.collectResourceTiming,this.returnDependencies=!!ee.returnDependencies,this.promoteId=ee.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(ee,le,ge,ve,Ce){this.status="parsing",this.data=ee,this.collisionBoxArray=new s.a3;const be=new s.bn(Object.keys(ee.layers).sort()),Pe=new s.bo(this.tileID,this.promoteId);Pe.bucketLayerIDs=[];const Oe={},Ge={featureIndex:Pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ge},rt=le.familiesBySource[this.source];for(const Ui in rt){const st=ee.layers[Ui];if(!st)continue;st.version===1&&s.w(`Vector tile source "${this.source}" layer "${Ui}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ti=be.encode(Ui),zt=[];for(let zi=0;zi<st.length;zi++){const hr=st.feature(zi),sn=Pe.getId(hr,Ui);zt.push({feature:hr,id:sn,index:zi,sourceLayerIndex:ti})}for(const zi of rt[Ui]){const hr=zi[0];hr.source!==this.source&&s.w(`layer.source = ${hr.source} does not equal this.source = ${this.source}`),hr.minzoom&&this.zoom<Math.floor(hr.minzoom)||hr.maxzoom&&this.zoom>=hr.maxzoom||hr.visibility!=="none"&&(F(zi,this.zoom,ge),(Oe[hr.id]=hr.createBucket({index:Pe.bucketLayerIDs.length,layers:zi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ti,sourceID:this.source})).populate(zt,Ge,this.tileID.canonical),Pe.bucketLayerIDs.push(zi.map(sn=>sn.id)))}}let yt,Et,Yt,qt;const Kt=s.aH(Ge.glyphDependencies,Ui=>Object.keys(Ui).map(Number));this.inFlightDependencies.forEach(Ui=>Ui==null?void 0:Ui.cancel()),this.inFlightDependencies=[];const si=++this.dependencySentinel;Object.keys(Kt).length?this.inFlightDependencies.push(ve.send("getGlyphs",{uid:this.uid,stacks:Kt,source:this.source,tileID:this.tileID,type:"glyphs"},(Ui,st)=>{si===this.dependencySentinel&&(yt||(yt=Ui,Et=st,wi.call(this)))})):Et={};const Ci=Object.keys(Ge.iconDependencies);Ci.length?this.inFlightDependencies.push(ve.send("getImages",{icons:Ci,source:this.source,tileID:this.tileID,type:"icons"},(Ui,st)=>{si===this.dependencySentinel&&(yt||(yt=Ui,Yt=st,wi.call(this)))})):Yt={};const Hi=Object.keys(Ge.patternDependencies);function wi(){if(yt)return Ce(yt);if(Et&&Yt&&qt){const Ui=new b(Et),st=new s.bp(Yt,qt);for(const ti in Oe){const zt=Oe[ti];zt instanceof s.a4?(F(zt.layers,this.zoom,ge),s.bq({bucket:zt,glyphMap:Et,glyphPositions:Ui.positions,imageMap:Yt,imagePositions:st.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):zt.hasPattern&&(zt instanceof s.br||zt instanceof s.bs||zt instanceof s.bt)&&(F(zt.layers,this.zoom,ge),zt.addFeatures(Ge,this.tileID.canonical,st.patternPositions))}this.status="done",Ce(null,{buckets:Object.values(Oe).filter(ti=>!ti.isEmpty()),featureIndex:Pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ui.image,imageAtlas:st,glyphMap:this.returnDependencies?Et:null,iconMap:this.returnDependencies?Yt:null,glyphPositions:this.returnDependencies?Ui.positions:null})}}Hi.length?this.inFlightDependencies.push(ve.send("getImages",{icons:Hi,source:this.source,tileID:this.tileID,type:"patterns"},(Ui,st)=>{si===this.dependencySentinel&&(yt||(yt=Ui,qt=st,wi.call(this)))})):qt={},wi.call(this)}}function F(oe,ee,le){const ge=new s.a8(ee);for(const ve of oe)ve.recalculate(ge,le)}function k(oe,ee){const le=s.l(oe.request,(ge,ve,Ce,be)=>{if(ge)ee(ge);else if(ve)try{const Pe=new s.bw.VectorTile(new s.bv(ve));ee(null,{vectorTile:Pe,rawData:ve,cacheControl:Ce,expires:be})}catch(Pe){const Oe=new Uint8Array(ve);let Ge=`Unable to parse the tile at ${oe.request.url}, `;Ge+=Oe[0]===31&&Oe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Pe.messge}`,ee(new Error(Ge))}});return()=>{le.cancel(),ee()}}class z{constructor(ee,le,ge,ve){this.actor=ee,this.layerIndex=le,this.availableImages=ge,this.loadVectorData=ve||k,this.fetching={},this.loading={},this.loaded={}}loadTile(ee,le){const ge=ee.uid;this.loading||(this.loading={});const ve=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new s.bu(ee.request),Ce=this.loading[ge]=new T(ee);Ce.abort=this.loadVectorData(ee,(be,Pe)=>{if(delete this.loading[ge],be||!Pe)return Ce.status="done",this.loaded[ge]=Ce,le(be);const Oe=Pe.rawData,Ge={};Pe.expires&&(Ge.expires=Pe.expires),Pe.cacheControl&&(Ge.cacheControl=Pe.cacheControl);const rt={};if(ve){const yt=ve.finish();yt&&(rt.resourceTiming=JSON.parse(JSON.stringify(yt)))}Ce.vectorTile=Pe.vectorTile,Ce.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor,(yt,Et)=>{if(delete this.fetching[ge],yt||!Et)return le(yt);le(null,s.e({rawTileData:Oe.slice(0)},Et,Ge,rt))}),this.loaded=this.loaded||{},this.loaded[ge]=Ce,this.fetching[ge]={rawTileData:Oe,cacheControl:Ge,resourceTiming:rt}})}reloadTile(ee,le){const ge=this.loaded,ve=ee.uid;if(ge&&ge[ve]){const Ce=ge[ve];Ce.showCollisionBoxes=ee.showCollisionBoxes,Ce.status==="parsing"?Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.actor,(be,Pe)=>{if(be||!Pe)return le(be,Pe);let Oe;if(this.fetching[ve]){const{rawTileData:Ge,cacheControl:rt,resourceTiming:yt}=this.fetching[ve];delete this.fetching[ve],Oe=s.e({rawTileData:Ge.slice(0)},Pe,rt,yt)}else Oe=Pe;le(null,Oe)}):Ce.status==="done"&&(Ce.vectorTile?Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.actor,le):le())}}abortTile(ee,le){const ge=this.loading,ve=ee.uid;ge&&ge[ve]&&ge[ve].abort&&(ge[ve].abort(),delete ge[ve]),le()}removeTile(ee,le){const ge=this.loaded,ve=ee.uid;ge&&ge[ve]&&delete ge[ve],le()}}class J{constructor(){this.loaded={}}loadTile(ee,le){return s._(this,void 0,void 0,function*(){const{uid:ge,encoding:ve,rawImageData:Ce,redFactor:be,greenFactor:Pe,blueFactor:Oe,baseShift:Ge}=ee,rt=Ce.width+2,yt=Ce.height+2,Et=s.a(Ce)?new s.R({width:rt,height:yt},yield s.bx(Ce,-1,-1,rt,yt)):Ce,Yt=new s.by(ge,Et,ve,be,Pe,Oe,Ge);this.loaded=this.loaded||{},this.loaded[ge]=Yt,le(null,Yt)})}removeTile(ee){const le=this.loaded,ge=ee.uid;le&&le[ge]&&delete le[ge]}}function te(oe,ee){if(oe.length!==0){ue(oe[0],ee);for(var le=1;le<oe.length;le++)ue(oe[le],!ee)}}function ue(oe,ee){for(var le=0,ge=0,ve=0,Ce=oe.length,be=Ce-1;ve<Ce;be=ve++){var Pe=(oe[ve][0]-oe[be][0])*(oe[be][1]+oe[ve][1]),Oe=le+Pe;ge+=Math.abs(le)>=Math.abs(Pe)?le-Oe+Pe:Pe-Oe+le,le=Oe}le+ge>=0!=!!ee&&oe.reverse()}var ce=s.bz(function oe(ee,le){var ge,ve=ee&&ee.type;if(ve==="FeatureCollection")for(ge=0;ge<ee.features.length;ge++)oe(ee.features[ge],le);else if(ve==="GeometryCollection")for(ge=0;ge<ee.geometries.length;ge++)oe(ee.geometries[ge],le);else if(ve==="Feature")oe(ee.geometry,le);else if(ve==="Polygon")te(ee.coordinates,le);else if(ve==="MultiPolygon")for(ge=0;ge<ee.coordinates.length;ge++)te(ee.coordinates[ge],le);return ee});const de=s.bw.VectorTileFeature.prototype.toGeoJSON;var _e={exports:{}},Ee=s.bA,He=s.bw.VectorTileFeature,Ve=qe;function qe(oe,ee){this.options=ee||{},this.features=oe,this.length=oe.length}function Ue(oe,ee){this.id=typeof oe.id=="number"?oe.id:void 0,this.type=oe.type,this.rawGeometry=oe.type===1?[oe.geometry]:oe.geometry,this.properties=oe.tags,this.extent=ee||4096}qe.prototype.feature=function(oe){return new Ue(this.features[oe],this.options.extent)},Ue.prototype.loadGeometry=function(){var oe=this.rawGeometry;this.geometry=[];for(var ee=0;ee<oe.length;ee++){for(var le=oe[ee],ge=[],ve=0;ve<le.length;ve++)ge.push(new Ee(le[ve][0],le[ve][1]));this.geometry.push(ge)}return this.geometry},Ue.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var oe=this.geometry,ee=1/0,le=-1/0,ge=1/0,ve=-1/0,Ce=0;Ce<oe.length;Ce++)for(var be=oe[Ce],Pe=0;Pe<be.length;Pe++){var Oe=be[Pe];ee=Math.min(ee,Oe.x),le=Math.max(le,Oe.x),ge=Math.min(ge,Oe.y),ve=Math.max(ve,Oe.y)}return[ee,ge,le,ve]},Ue.prototype.toGeoJSON=He.prototype.toGeoJSON;var ot=s.bB,it=Ve;function De(oe){var ee=new ot;return function(le,ge){for(var ve in le.layers)ge.writeMessage(3,Me,le.layers[ve])}(oe,ee),ee.finish()}function Me(oe,ee){var le;ee.writeVarintField(15,oe.version||1),ee.writeStringField(1,oe.name||""),ee.writeVarintField(5,oe.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<oe.length;le++)ge.feature=oe.feature(le),ee.writeMessage(2,Ze,ge);var ve=ge.keys;for(le=0;le<ve.length;le++)ee.writeStringField(3,ve[le]);var Ce=ge.values;for(le=0;le<Ce.length;le++)ee.writeMessage(4,_t,Ce[le])}function Ze(oe,ee){var le=oe.feature;le.id!==void 0&&ee.writeVarintField(1,le.id),ee.writeMessage(2,We,oe),ee.writeVarintField(3,le.type),ee.writeMessage(4,Lt,le)}function We(oe,ee){var le=oe.feature,ge=oe.keys,ve=oe.values,Ce=oe.keycache,be=oe.valuecache;for(var Pe in le.properties){var Oe=le.properties[Pe],Ge=Ce[Pe];if(Oe!==null){Ge===void 0&&(ge.push(Pe),Ce[Pe]=Ge=ge.length-1),ee.writeVarint(Ge);var rt=typeof Oe;rt!=="string"&&rt!=="boolean"&&rt!=="number"&&(Oe=JSON.stringify(Oe));var yt=rt+":"+Oe,Et=be[yt];Et===void 0&&(ve.push(Oe),be[yt]=Et=ve.length-1),ee.writeVarint(Et)}}}function Bt(oe,ee){return(ee<<3)+(7&oe)}function Ct(oe){return oe<<1^oe>>31}function Lt(oe,ee){for(var le=oe.loadGeometry(),ge=oe.type,ve=0,Ce=0,be=le.length,Pe=0;Pe<be;Pe++){var Oe=le[Pe],Ge=1;ge===1&&(Ge=Oe.length),ee.writeVarint(Bt(1,Ge));for(var rt=ge===3?Oe.length-1:Oe.length,yt=0;yt<rt;yt++){yt===1&&ge!==1&&ee.writeVarint(Bt(2,rt-1));var Et=Oe[yt].x-ve,Yt=Oe[yt].y-Ce;ee.writeVarint(Ct(Et)),ee.writeVarint(Ct(Yt)),ve+=Et,Ce+=Yt}ge===3&&ee.writeVarint(Bt(7,1))}}function _t(oe,ee){var le=typeof oe;le==="string"?ee.writeStringField(1,oe):le==="boolean"?ee.writeBooleanField(7,oe):le==="number"&&(oe%1!=0?ee.writeDoubleField(3,oe):oe<0?ee.writeSVarintField(6,oe):ee.writeVarintField(5,oe))}_e.exports=De,_e.exports.fromVectorTileJs=De,_e.exports.fromGeojsonVt=function(oe,ee){ee=ee||{};var le={};for(var ge in oe)le[ge]=new it(oe[ge].features,ee),le[ge].name=ge,le[ge].version=ee.version,le[ge].extent=ee.extent;return De({layers:le})},_e.exports.GeoJSONWrapper=it;var Ft=s.bz(_e.exports);const Mt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:oe=>oe},Wt=Math.fround||(Se=new Float32Array(1),oe=>(Se[0]=+oe,Se[0]));var Se;const Xe=3,et=5,At=6;class ft{constructor(ee){this.options=Object.assign(Object.create(Mt),ee),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ee){const{log:le,minZoom:ge,maxZoom:ve}=this.options;le&&console.time("total time");const Ce=`prepare ${ee.length} points`;le&&console.time(Ce),this.points=ee;const be=[];for(let Oe=0;Oe<ee.length;Oe++){const Ge=ee[Oe];if(!Ge.geometry)continue;const[rt,yt]=Ge.geometry.coordinates,Et=Wt(It(rt)),Yt=Wt(Ht(yt));be.push(Et,Yt,1/0,Oe,-1,1),this.options.reduce&&be.push(0)}let Pe=this.trees[ve+1]=this._createTree(be);le&&console.timeEnd(Ce);for(let Oe=ve;Oe>=ge;Oe--){const Ge=+Date.now();Pe=this.trees[Oe]=this._createTree(this._cluster(Pe,Oe)),le&&console.log("z%d: %d clusters in %dms",Oe,Pe.numItems,+Date.now()-Ge)}return le&&console.timeEnd("total time"),this}getClusters(ee,le){let ge=((ee[0]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,ee[1]));let Ce=ee[2]===180?180:((ee[2]+180)%360+360)%360-180;const be=Math.max(-90,Math.min(90,ee[3]));if(ee[2]-ee[0]>=360)ge=-180,Ce=180;else if(ge>Ce){const yt=this.getClusters([ge,ve,180,be],le),Et=this.getClusters([-180,ve,Ce,be],le);return yt.concat(Et)}const Pe=this.trees[this._limitZoom(le)],Oe=Pe.range(It(ge),Ht(be),It(Ce),Ht(ve)),Ge=Pe.data,rt=[];for(const yt of Oe){const Et=this.stride*yt;rt.push(Ge[Et+et]>1?wt(Ge,Et,this.clusterProps):this.points[Ge[Et+Xe]])}return rt}getChildren(ee){const le=this._getOriginId(ee),ge=this._getOriginZoom(ee),ve="No cluster with the specified id.",Ce=this.trees[ge];if(!Ce)throw new Error(ve);const be=Ce.data;if(le*this.stride>=be.length)throw new Error(ve);const Pe=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),Oe=Ce.within(be[le*this.stride],be[le*this.stride+1],Pe),Ge=[];for(const rt of Oe){const yt=rt*this.stride;be[yt+4]===ee&&Ge.push(be[yt+et]>1?wt(be,yt,this.clusterProps):this.points[be[yt+Xe]])}if(Ge.length===0)throw new Error(ve);return Ge}getLeaves(ee,le,ge){const ve=[];return this._appendLeaves(ve,ee,le=le||10,ge=ge||0,0),ve}getTile(ee,le,ge){const ve=this.trees[this._limitZoom(ee)],Ce=Math.pow(2,ee),{extent:be,radius:Pe}=this.options,Oe=Pe/be,Ge=(ge-Oe)/Ce,rt=(ge+1+Oe)/Ce,yt={features:[]};return this._addTileFeatures(ve.range((le-Oe)/Ce,Ge,(le+1+Oe)/Ce,rt),ve.data,le,ge,Ce,yt),le===0&&this._addTileFeatures(ve.range(1-Oe/Ce,Ge,1,rt),ve.data,Ce,ge,Ce,yt),le===Ce-1&&this._addTileFeatures(ve.range(0,Ge,Oe/Ce,rt),ve.data,-1,ge,Ce,yt),yt.features.length?yt:null}getClusterExpansionZoom(ee){let le=this._getOriginZoom(ee)-1;for(;le<=this.options.maxZoom;){const ge=this.getChildren(ee);if(le++,ge.length!==1)break;ee=ge[0].properties.cluster_id}return le}_appendLeaves(ee,le,ge,ve,Ce){const be=this.getChildren(le);for(const Pe of be){const Oe=Pe.properties;if(Oe&&Oe.cluster?Ce+Oe.point_count<=ve?Ce+=Oe.point_count:Ce=this._appendLeaves(ee,Oe.cluster_id,ge,ve,Ce):Ce<ve?Ce++:ee.push(Pe),ee.length===ge)break}return Ce}_createTree(ee){const le=new s.av(ee.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<ee.length;ge+=this.stride)le.add(ee[ge],ee[ge+1]);return le.finish(),le.data=ee,le}_addTileFeatures(ee,le,ge,ve,Ce,be){for(const Pe of ee){const Oe=Pe*this.stride,Ge=le[Oe+et]>1;let rt,yt,Et;if(Ge)rt=Pt(le,Oe,this.clusterProps),yt=le[Oe],Et=le[Oe+1];else{const Kt=this.points[le[Oe+Xe]];rt=Kt.properties;const[si,Ci]=Kt.geometry.coordinates;yt=It(si),Et=Ht(Ci)}const Yt={type:1,geometry:[[Math.round(this.options.extent*(yt*Ce-ge)),Math.round(this.options.extent*(Et*Ce-ve))]],tags:rt};let qt;qt=Ge||this.options.generateId?le[Oe+Xe]:this.points[le[Oe+Xe]].id,qt!==void 0&&(Yt.id=qt),be.features.push(Yt)}}_limitZoom(ee){return Math.max(this.options.minZoom,Math.min(Math.floor(+ee),this.options.maxZoom+1))}_cluster(ee,le){const{radius:ge,extent:ve,reduce:Ce,minPoints:be}=this.options,Pe=ge/(ve*Math.pow(2,le)),Oe=ee.data,Ge=[],rt=this.stride;for(let yt=0;yt<Oe.length;yt+=rt){if(Oe[yt+2]<=le)continue;Oe[yt+2]=le;const Et=Oe[yt],Yt=Oe[yt+1],qt=ee.within(Oe[yt],Oe[yt+1],Pe),Kt=Oe[yt+et];let si=Kt;for(const Ci of qt){const Hi=Ci*rt;Oe[Hi+2]>le&&(si+=Oe[Hi+et])}if(si>Kt&&si>=be){let Ci,Hi=Et*Kt,wi=Yt*Kt,Ui=-1;const st=((yt/rt|0)<<5)+(le+1)+this.points.length;for(const ti of qt){const zt=ti*rt;if(Oe[zt+2]<=le)continue;Oe[zt+2]=le;const zi=Oe[zt+et];Hi+=Oe[zt]*zi,wi+=Oe[zt+1]*zi,Oe[zt+4]=st,Ce&&(Ci||(Ci=this._map(Oe,yt,!0),Ui=this.clusterProps.length,this.clusterProps.push(Ci)),Ce(Ci,this._map(Oe,zt)))}Oe[yt+4]=st,Ge.push(Hi/si,wi/si,1/0,st,-1,si),Ce&&Ge.push(Ui)}else{for(let Ci=0;Ci<rt;Ci++)Ge.push(Oe[yt+Ci]);if(si>1)for(const Ci of qt){const Hi=Ci*rt;if(!(Oe[Hi+2]<=le)){Oe[Hi+2]=le;for(let wi=0;wi<rt;wi++)Ge.push(Oe[Hi+wi])}}}}return Ge}_getOriginId(ee){return ee-this.points.length>>5}_getOriginZoom(ee){return(ee-this.points.length)%32}_map(ee,le,ge){if(ee[le+et]>1){const be=this.clusterProps[ee[le+At]];return ge?Object.assign({},be):be}const ve=this.points[ee[le+Xe]].properties,Ce=this.options.map(ve);return ge&&Ce===ve?Object.assign({},Ce):Ce}}function wt(oe,ee,le){return{type:"Feature",id:oe[ee+Xe],properties:Pt(oe,ee,le),geometry:{type:"Point",coordinates:[(ge=oe[ee],360*(ge-.5)),ii(oe[ee+1])]}};var ge}function Pt(oe,ee,le){const ge=oe[ee+et],ve=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Ce=oe[ee+At],be=Ce===-1?{}:Object.assign({},le[Ce]);return Object.assign(be,{cluster:!0,cluster_id:oe[ee+Xe],point_count:ge,point_count_abbreviated:ve})}function It(oe){return oe/360+.5}function Ht(oe){const ee=Math.sin(oe*Math.PI/180),le=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return le<0?0:le>1?1:le}function ii(oe){const ee=(180-360*oe)*Math.PI/180;return 360*Math.atan(Math.exp(ee))/Math.PI-90}function gi(oe,ee,le,ge){for(var ve,Ce=ge,be=le-ee>>1,Pe=le-ee,Oe=oe[ee],Ge=oe[ee+1],rt=oe[le],yt=oe[le+1],Et=ee+3;Et<le;Et+=3){var Yt=mi(oe[Et],oe[Et+1],Oe,Ge,rt,yt);if(Yt>Ce)ve=Et,Ce=Yt;else if(Yt===Ce){var qt=Math.abs(Et-be);qt<Pe&&(ve=Et,Pe=qt)}}Ce>ge&&(ve-ee>3&&gi(oe,ee,ve,ge),oe[ve+2]=Ce,le-ve>3&&gi(oe,ve,le,ge))}function mi(oe,ee,le,ge,ve,Ce){var be=ve-le,Pe=Ce-ge;if(be!==0||Pe!==0){var Oe=((oe-le)*be+(ee-ge)*Pe)/(be*be+Pe*Pe);Oe>1?(le=ve,ge=Ce):Oe>0&&(le+=be*Oe,ge+=Pe*Oe)}return(be=oe-le)*be+(Pe=ee-ge)*Pe}function Mi(oe,ee,le,ge){var ve={id:oe===void 0?null:oe,type:ee,geometry:le,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ce){var be=Ce.geometry,Pe=Ce.type;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")kt(Ce,be);else if(Pe==="Polygon"||Pe==="MultiLineString")for(var Oe=0;Oe<be.length;Oe++)kt(Ce,be[Oe]);else if(Pe==="MultiPolygon")for(Oe=0;Oe<be.length;Oe++)for(var Ge=0;Ge<be[Oe].length;Ge++)kt(Ce,be[Oe][Ge])}(ve),ve}function kt(oe,ee){for(var le=0;le<ee.length;le+=3)oe.minX=Math.min(oe.minX,ee[le]),oe.minY=Math.min(oe.minY,ee[le+1]),oe.maxX=Math.max(oe.maxX,ee[le]),oe.maxY=Math.max(oe.maxY,ee[le+1])}function at(oe,ee,le,ge){if(ee.geometry){var ve=ee.geometry.coordinates,Ce=ee.geometry.type,be=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2),Pe=[],Oe=ee.id;if(le.promoteId?Oe=ee.properties[le.promoteId]:le.generateId&&(Oe=ge||0),Ce==="Point")xt(ve,Pe);else if(Ce==="MultiPoint")for(var Ge=0;Ge<ve.length;Ge++)xt(ve[Ge],Pe);else if(Ce==="LineString")Ri(ve,Pe,be,!1);else if(Ce==="MultiLineString"){if(le.lineMetrics){for(Ge=0;Ge<ve.length;Ge++)Ri(ve[Ge],Pe=[],be,!1),oe.push(Mi(Oe,"LineString",Pe,ee.properties));return}ei(ve,Pe,be,!1)}else if(Ce==="Polygon")ei(ve,Pe,be,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(Ge=0;Ge<ee.geometry.geometries.length;Ge++)at(oe,{id:Oe,geometry:ee.geometry.geometries[Ge],properties:ee.properties},le,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ge=0;Ge<ve.length;Ge++){var rt=[];ei(ve[Ge],rt,be,!0),Pe.push(rt)}}oe.push(Mi(Oe,Ce,Pe,ee.properties))}}function xt(oe,ee){ee.push(ut(oe[0])),ee.push(jt(oe[1])),ee.push(0)}function Ri(oe,ee,le,ge){for(var ve,Ce,be=0,Pe=0;Pe<oe.length;Pe++){var Oe=ut(oe[Pe][0]),Ge=jt(oe[Pe][1]);ee.push(Oe),ee.push(Ge),ee.push(0),Pe>0&&(be+=ge?(ve*Ge-Oe*Ce)/2:Math.sqrt(Math.pow(Oe-ve,2)+Math.pow(Ge-Ce,2))),ve=Oe,Ce=Ge}var rt=ee.length-3;ee[2]=1,gi(ee,0,rt,le),ee[rt+2]=1,ee.size=Math.abs(be),ee.start=0,ee.end=ee.size}function ei(oe,ee,le,ge){for(var ve=0;ve<oe.length;ve++){var Ce=[];Ri(oe[ve],Ce,le,ge),ee.push(Ce)}}function ut(oe){return oe/360+.5}function jt(oe){var ee=Math.sin(oe*Math.PI/180),le=.5-.25*Math.log((1+ee)/(1-ee))/Math.PI;return le<0?0:le>1?1:le}function ni(oe,ee,le,ge,ve,Ce,be,Pe){if(ge/=ee,Ce>=(le/=ee)&&be<ge)return oe;if(be<le||Ce>=ge)return null;for(var Oe=[],Ge=0;Ge<oe.length;Ge++){var rt=oe[Ge],yt=rt.geometry,Et=rt.type,Yt=ve===0?rt.minX:rt.minY,qt=ve===0?rt.maxX:rt.maxY;if(Yt>=le&&qt<ge)Oe.push(rt);else if(!(qt<le||Yt>=ge)){var Kt=[];if(Et==="Point"||Et==="MultiPoint")di(yt,Kt,le,ge,ve);else if(Et==="LineString")li(yt,Kt,le,ge,ve,!1,Pe.lineMetrics);else if(Et==="MultiLineString")tr(yt,Kt,le,ge,ve,!1);else if(Et==="Polygon")tr(yt,Kt,le,ge,ve,!0);else if(Et==="MultiPolygon")for(var si=0;si<yt.length;si++){var Ci=[];tr(yt[si],Ci,le,ge,ve,!0),Ci.length&&Kt.push(Ci)}if(Kt.length){if(Pe.lineMetrics&&Et==="LineString"){for(si=0;si<Kt.length;si++)Oe.push(Mi(rt.id,Et,Kt[si],rt.tags));continue}Et!=="LineString"&&Et!=="MultiLineString"||(Kt.length===1?(Et="LineString",Kt=Kt[0]):Et="MultiLineString"),Et!=="Point"&&Et!=="MultiPoint"||(Et=Kt.length===3?"Point":"MultiPoint"),Oe.push(Mi(rt.id,Et,Kt,rt.tags))}}}return Oe.length?Oe:null}function di(oe,ee,le,ge,ve){for(var Ce=0;Ce<oe.length;Ce+=3){var be=oe[Ce+ve];be>=le&&be<=ge&&(ee.push(oe[Ce]),ee.push(oe[Ce+1]),ee.push(oe[Ce+2]))}}function li(oe,ee,le,ge,ve,Ce,be){for(var Pe,Oe,Ge=Ki(oe),rt=ve===0?Er:Nt,yt=oe.start,Et=0;Et<oe.length-3;Et+=3){var Yt=oe[Et],qt=oe[Et+1],Kt=oe[Et+2],si=oe[Et+3],Ci=oe[Et+4],Hi=ve===0?Yt:qt,wi=ve===0?si:Ci,Ui=!1;be&&(Pe=Math.sqrt(Math.pow(Yt-si,2)+Math.pow(qt-Ci,2))),Hi<le?wi>le&&(Oe=rt(Ge,Yt,qt,si,Ci,le),be&&(Ge.start=yt+Pe*Oe)):Hi>ge?wi<ge&&(Oe=rt(Ge,Yt,qt,si,Ci,ge),be&&(Ge.start=yt+Pe*Oe)):Ar(Ge,Yt,qt,Kt),wi<le&&Hi>=le&&(Oe=rt(Ge,Yt,qt,si,Ci,le),Ui=!0),wi>ge&&Hi<=ge&&(Oe=rt(Ge,Yt,qt,si,Ci,ge),Ui=!0),!Ce&&Ui&&(be&&(Ge.end=yt+Pe*Oe),ee.push(Ge),Ge=Ki(oe)),be&&(yt+=Pe)}var st=oe.length-3;Yt=oe[st],qt=oe[st+1],Kt=oe[st+2],(Hi=ve===0?Yt:qt)>=le&&Hi<=ge&&Ar(Ge,Yt,qt,Kt),st=Ge.length-3,Ce&&st>=3&&(Ge[st]!==Ge[0]||Ge[st+1]!==Ge[1])&&Ar(Ge,Ge[0],Ge[1],Ge[2]),Ge.length&&ee.push(Ge)}function Ki(oe){var ee=[];return ee.size=oe.size,ee.start=oe.start,ee.end=oe.end,ee}function tr(oe,ee,le,ge,ve,Ce){for(var be=0;be<oe.length;be++)li(oe[be],ee,le,ge,ve,Ce,!1)}function Ar(oe,ee,le,ge){oe.push(ee),oe.push(le),oe.push(ge)}function Er(oe,ee,le,ge,ve,Ce){var be=(Ce-ee)/(ge-ee);return oe.push(Ce),oe.push(le+(ve-le)*be),oe.push(1),be}function Nt(oe,ee,le,ge,ve,Ce){var be=(Ce-le)/(ve-le);return oe.push(ee+(ge-ee)*be),oe.push(Ce),oe.push(1),be}function Ji(oe,ee){for(var le=[],ge=0;ge<oe.length;ge++){var ve,Ce=oe[ge],be=Ce.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")ve=ci(Ce.geometry,ee);else if(be==="MultiLineString"||be==="Polygon"){ve=[];for(var Pe=0;Pe<Ce.geometry.length;Pe++)ve.push(ci(Ce.geometry[Pe],ee))}else if(be==="MultiPolygon")for(ve=[],Pe=0;Pe<Ce.geometry.length;Pe++){for(var Oe=[],Ge=0;Ge<Ce.geometry[Pe].length;Ge++)Oe.push(ci(Ce.geometry[Pe][Ge],ee));ve.push(Oe)}le.push(Mi(Ce.id,be,ve,Ce.tags))}return le}function ci(oe,ee){var le=[];le.size=oe.size,oe.start!==void 0&&(le.start=oe.start,le.end=oe.end);for(var ge=0;ge<oe.length;ge+=3)le.push(oe[ge]+ee,oe[ge+1],oe[ge+2]);return le}function $t(oe,ee){if(oe.transformed)return oe;var le,ge,ve,Ce=1<<oe.z,be=oe.x,Pe=oe.y;for(le=0;le<oe.features.length;le++){var Oe=oe.features[le],Ge=Oe.geometry,rt=Oe.type;if(Oe.geometry=[],rt===1)for(ge=0;ge<Ge.length;ge+=2)Oe.geometry.push(Zi(Ge[ge],Ge[ge+1],ee,Ce,be,Pe));else for(ge=0;ge<Ge.length;ge++){var yt=[];for(ve=0;ve<Ge[ge].length;ve+=2)yt.push(Zi(Ge[ge][ve],Ge[ge][ve+1],ee,Ce,be,Pe));Oe.geometry.push(yt)}}return oe.transformed=!0,oe}function Zi(oe,ee,le,ge,ve,Ce){return[Math.round(le*(oe*ge-ve)),Math.round(le*(ee*ge-Ce))]}function Qt(oe,ee,le,ge,ve){for(var Ce=ee===ve.maxZoom?0:ve.tolerance/((1<<ee)*ve.extent),be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:le,y:ge,z:ee,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Pe=0;Pe<oe.length;Pe++){be.numFeatures++,Bi(be,oe[Pe],Ce,ve);var Oe=oe[Pe].minX,Ge=oe[Pe].minY,rt=oe[Pe].maxX,yt=oe[Pe].maxY;Oe<be.minX&&(be.minX=Oe),Ge<be.minY&&(be.minY=Ge),rt>be.maxX&&(be.maxX=rt),yt>be.maxY&&(be.maxY=yt)}return be}function Bi(oe,ee,le,ge){var ve=ee.geometry,Ce=ee.type,be=[];if(Ce==="Point"||Ce==="MultiPoint")for(var Pe=0;Pe<ve.length;Pe+=3)be.push(ve[Pe]),be.push(ve[Pe+1]),oe.numPoints++,oe.numSimplified++;else if(Ce==="LineString")Ii(be,ve,oe,le,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(Pe=0;Pe<ve.length;Pe++)Ii(be,ve[Pe],oe,le,Ce==="Polygon",Pe===0);else if(Ce==="MultiPolygon")for(var Oe=0;Oe<ve.length;Oe++){var Ge=ve[Oe];for(Pe=0;Pe<Ge.length;Pe++)Ii(be,Ge[Pe],oe,le,!0,Pe===0)}if(be.length){var rt=ee.tags||null;if(Ce==="LineString"&&ge.lineMetrics){for(var yt in rt={},ee.tags)rt[yt]=ee.tags[yt];rt.mapbox_clip_start=ve.start/ve.size,rt.mapbox_clip_end=ve.end/ve.size}var Et={geometry:be,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:rt};ee.id!==null&&(Et.id=ee.id),oe.features.push(Et)}}function Ii(oe,ee,le,ge,ve,Ce){var be=ge*ge;if(ge>0&&ee.size<(ve?be:ge))le.numPoints+=ee.length/3;else{for(var Pe=[],Oe=0;Oe<ee.length;Oe+=3)(ge===0||ee[Oe+2]>be)&&(le.numSimplified++,Pe.push(ee[Oe]),Pe.push(ee[Oe+1])),le.numPoints++;ve&&function(Ge,rt){for(var yt=0,Et=0,Yt=Ge.length,qt=Yt-2;Et<Yt;qt=Et,Et+=2)yt+=(Ge[Et]-Ge[qt])*(Ge[Et+1]+Ge[qt+1]);if(yt>0===rt)for(Et=0,Yt=Ge.length;Et<Yt/2;Et+=2){var Kt=Ge[Et],si=Ge[Et+1];Ge[Et]=Ge[Yt-2-Et],Ge[Et+1]=Ge[Yt-1-Et],Ge[Yt-2-Et]=Kt,Ge[Yt-1-Et]=si}}(Pe,Ce),oe.push(Pe)}}function Gt(oe,ee){var le=(ee=this.options=function(ve,Ce){for(var be in Ce)ve[be]=Ce[be];return ve}(Object.create(this.options),ee)).debug;if(le&&console.time("preprocess data"),ee.maxZoom<0||ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ee.promoteId&&ee.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(ve,Ce){var be=[];if(ve.type==="FeatureCollection")for(var Pe=0;Pe<ve.features.length;Pe++)at(be,ve.features[Pe],Ce,Pe);else at(be,ve.type==="Feature"?ve:{geometry:ve},Ce);return be}(oe,ee);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ee.indexMaxZoom,ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ge=function(ve,Ce){var be=Ce.buffer/Ce.extent,Pe=ve,Oe=ni(ve,1,-1-be,be,0,-1,2,Ce),Ge=ni(ve,1,1-be,2+be,0,-1,2,Ce);return(Oe||Ge)&&(Pe=ni(ve,1,-be,1+be,0,-1,2,Ce)||[],Oe&&(Pe=Ji(Oe,1).concat(Pe)),Ge&&(Pe=Pe.concat(Ji(Ge,-1)))),Pe}(ge,ee),ge.length&&this.splitTile(ge,0,0,0),le&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function vi(oe,ee,le){return 32*((1<<oe)*le+ee)+oe}function Jt(oe,ee){return ee?oe.properties[ee]:oe.id}function mr(oe,ee){if(oe==null)return!0;if(oe.type==="Feature")return Jt(oe,ee)!=null;if(oe.type==="FeatureCollection"){const le=new Set;for(const ge of oe.features){const ve=Jt(ge,ee);if(ve==null||le.has(ve))return!1;le.add(ve)}return!0}return!1}function Sr(oe,ee){const le=new Map;if(oe!=null)if(oe.type==="Feature")le.set(Jt(oe,ee),oe);else for(const ge of oe.features)le.set(Jt(ge,ee),ge);return le}Gt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Gt.prototype.splitTile=function(oe,ee,le,ge,ve,Ce,be){for(var Pe=[oe,ee,le,ge],Oe=this.options,Ge=Oe.debug;Pe.length;){ge=Pe.pop(),le=Pe.pop(),ee=Pe.pop(),oe=Pe.pop();var rt=1<<ee,yt=vi(ee,le,ge),Et=this.tiles[yt];if(!Et&&(Ge>1&&console.time("creation"),Et=this.tiles[yt]=Qt(oe,ee,le,ge,Oe),this.tileCoords.push({z:ee,x:le,y:ge}),Ge)){Ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ee,le,ge,Et.numFeatures,Et.numPoints,Et.numSimplified),console.timeEnd("creation"));var Yt="z"+ee;this.stats[Yt]=(this.stats[Yt]||0)+1,this.total++}if(Et.source=oe,ve){if(ee===Oe.maxZoom||ee===ve)continue;var qt=1<<ve-ee;if(le!==Math.floor(Ce/qt)||ge!==Math.floor(be/qt))continue}else if(ee===Oe.indexMaxZoom||Et.numPoints<=Oe.indexMaxPoints)continue;if(Et.source=null,oe.length!==0){Ge>1&&console.time("clipping");var Kt,si,Ci,Hi,wi,Ui,st=.5*Oe.buffer/Oe.extent,ti=.5-st,zt=.5+st,zi=1+st;Kt=si=Ci=Hi=null,wi=ni(oe,rt,le-st,le+zt,0,Et.minX,Et.maxX,Oe),Ui=ni(oe,rt,le+ti,le+zi,0,Et.minX,Et.maxX,Oe),oe=null,wi&&(Kt=ni(wi,rt,ge-st,ge+zt,1,Et.minY,Et.maxY,Oe),si=ni(wi,rt,ge+ti,ge+zi,1,Et.minY,Et.maxY,Oe),wi=null),Ui&&(Ci=ni(Ui,rt,ge-st,ge+zt,1,Et.minY,Et.maxY,Oe),Hi=ni(Ui,rt,ge+ti,ge+zi,1,Et.minY,Et.maxY,Oe),Ui=null),Ge>1&&console.timeEnd("clipping"),Pe.push(Kt||[],ee+1,2*le,2*ge),Pe.push(si||[],ee+1,2*le,2*ge+1),Pe.push(Ci||[],ee+1,2*le+1,2*ge),Pe.push(Hi||[],ee+1,2*le+1,2*ge+1)}}},Gt.prototype.getTile=function(oe,ee,le){var ge=this.options,ve=ge.extent,Ce=ge.debug;if(oe<0||oe>24)return null;var be=1<<oe,Pe=vi(oe,ee=(ee%be+be)%be,le);if(this.tiles[Pe])return $t(this.tiles[Pe],ve);Ce>1&&console.log("drilling down to z%d-%d-%d",oe,ee,le);for(var Oe,Ge=oe,rt=ee,yt=le;!Oe&&Ge>0;)Ge--,rt=Math.floor(rt/2),yt=Math.floor(yt/2),Oe=this.tiles[vi(Ge,rt,yt)];return Oe&&Oe.source?(Ce>1&&console.log("found parent tile z%d-%d-%d",Ge,rt,yt),Ce>1&&console.time("drilling down"),this.splitTile(Oe.source,Ge,rt,yt,oe,ee,le),Ce>1&&console.timeEnd("drilling down"),this.tiles[Pe]?$t(this.tiles[Pe],ve):null):null};class ze extends z{constructor(ee,le,ge,ve){super(ee,le,ge),this._dataUpdateable=new Map,this.loadGeoJSON=(Ce,be)=>{const{promoteId:Pe}=Ce;if(Ce.request)return s.f(Ce.request,(Oe,Ge,rt,yt)=>{this._dataUpdateable=mr(Ge,Pe)?Sr(Ge,Pe):void 0,be(Oe,Ge,rt,yt)});if(typeof Ce.data=="string")try{const Oe=JSON.parse(Ce.data);this._dataUpdateable=mr(Oe,Pe)?Sr(Oe,Pe):void 0,be(null,Oe)}catch{be(new Error(`Input data given to '${Ce.source}' is not a valid GeoJSON object.`))}else Ce.dataDiff?this._dataUpdateable?(function(Oe,Ge,rt){var yt,Et,Yt,qt;if(Ge.removeAll&&Oe.clear(),Ge.remove)for(const Kt of Ge.remove)Oe.delete(Kt);if(Ge.add)for(const Kt of Ge.add){const si=Jt(Kt,rt);si!=null&&Oe.set(si,Kt)}if(Ge.update)for(const Kt of Ge.update){let si=Oe.get(Kt.id);if(si==null)continue;const Ci=!Kt.removeAllProperties&&(((yt=Kt.removeProperties)===null||yt===void 0?void 0:yt.length)>0||((Et=Kt.addOrUpdateProperties)===null||Et===void 0?void 0:Et.length)>0);if((Kt.newGeometry||Kt.removeAllProperties||Ci)&&(si=Object.assign({},si),Oe.set(Kt.id,si),Ci&&(si.properties=Object.assign({},si.properties))),Kt.newGeometry&&(si.geometry=Kt.newGeometry),Kt.removeAllProperties)si.properties={};else if(((Yt=Kt.removeProperties)===null||Yt===void 0?void 0:Yt.length)>0)for(const Hi of Kt.removeProperties)Object.prototype.hasOwnProperty.call(si.properties,Hi)&&delete si.properties[Hi];if(((qt=Kt.addOrUpdateProperties)===null||qt===void 0?void 0:qt.length)>0)for(const{key:Hi,value:wi}of Kt.addOrUpdateProperties)si.properties[Hi]=wi}}(this._dataUpdateable,Ce.dataDiff,Pe),be(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):be(new Error(`Cannot update existing geojson data in ${Ce.source}`)):be(new Error(`Input data given to '${Ce.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,ve&&(this.loadGeoJSON=ve)}loadGeoJSONTile(ee,le){const ge=ee.tileID.canonical;if(!this._geoJSONIndex)return le(null,null);const ve=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);if(!ve)return le(null,null);const Ce=new class{constructor(Pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.N,this.length=Pe.length,this._features=Pe}feature(Pe){return new class{constructor(Oe){this._feature=Oe,this.extent=s.N,this.type=Oe.type,this.properties=Oe.tags,"id"in Oe&&!isNaN(Oe.id)&&(this.id=parseInt(Oe.id,10))}loadGeometry(){if(this._feature.type===1){const Oe=[];for(const Ge of this._feature.geometry)Oe.push([new s.P(Ge[0],Ge[1])]);return Oe}{const Oe=[];for(const Ge of this._feature.geometry){const rt=[];for(const yt of Ge)rt.push(new s.P(yt[0],yt[1]));Oe.push(rt)}return Oe}}toGeoJSON(Oe,Ge,rt){return de.call(this,Oe,Ge,rt)}}(this._features[Pe])}}(ve.features);let be=Ft(Ce);be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),le(null,{vectorTile:Ce,rawData:be.buffer})}loadData(ee,le){var ge;(ge=this._pendingRequest)===null||ge===void 0||ge.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const ve=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new s.bu(ee.request);this._pendingCallback=le,this._pendingRequest=this.loadGeoJSON(ee,(Ce,be)=>{if(delete this._pendingCallback,delete this._pendingRequest,Ce||!be)return le(Ce);if(typeof be!="object")return le(new Error(`Input data given to '${ee.source}' is not a valid GeoJSON object.`));{ce(be,!0);try{if(ee.filter){const Oe=s.bC(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Oe.result==="error")throw new Error(Oe.value.map(rt=>`${rt.key}: ${rt.message}`).join(", "));be={type:"FeatureCollection",features:be.features.filter(rt=>Oe.value.evaluate({zoom:0},rt))}}this._geoJSONIndex=ee.cluster?new ft(function(Oe){let{superclusterOptions:Ge,clusterProperties:rt}=Oe;if(!rt||!Ge)return Ge;const yt={},Et={},Yt={accumulated:null,zoom:0},qt={properties:null},Kt=Object.keys(rt);for(const si of Kt){const[Ci,Hi]=rt[si],wi=s.bC(Hi),Ui=s.bC(typeof Ci=="string"?[Ci,["accumulated"],["get",si]]:Ci);yt[si]=wi.value,Et[si]=Ui.value}return Ge.map=si=>{qt.properties=si;const Ci={};for(const Hi of Kt)Ci[Hi]=yt[Hi].evaluate(Yt,qt);return Ci},Ge.reduce=(si,Ci)=>{qt.properties=Ci;for(const Hi of Kt)Yt.accumulated=si[Hi],si[Hi]=Et[Hi].evaluate(Yt,qt)},Ge}(ee)).load(be.features):function(Oe,Ge){return new Gt(Oe,Ge)}(be,ee.geojsonVtOptions)}catch(Oe){return le(Oe)}this.loaded={};const Pe={};if(ve){const Oe=ve.finish();Oe&&(Pe.resourceTiming={},Pe.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Oe)))}le(null,Pe)}})}reloadTile(ee,le){const ge=this.loaded;return ge&&ge[ee.uid]?super.reloadTile(ee,le):this.loadTile(ee,le)}removeSource(ee,le){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),le()}getClusterExpansionZoom(ee,le){try{le(null,this._geoJSONIndex.getClusterExpansionZoom(ee.clusterId))}catch(ge){le(ge)}}getClusterChildren(ee,le){try{le(null,this._geoJSONIndex.getChildren(ee.clusterId))}catch(ge){le(ge)}}getClusterLeaves(ee,le){try{le(null,this._geoJSONIndex.getLeaves(ee.clusterId,ee.limit,ee.offset))}catch(ge){le(ge)}}}class we{constructor(ee){this.self=ee,this.actor=new s.C(ee,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:z,geojson:ze},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(le,ge)=>{if(this.workerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.workerSourceTypes[le]=ge},this.self.registerRTLTextPlugin=le=>{if(s.bD.isParsed())throw new Error("RTL text plugin already registered.");s.bD.applyArabicShaping=le.applyArabicShaping,s.bD.processBidirectionalText=le.processBidirectionalText,s.bD.processStyledBidirectionalText=le.processStyledBidirectionalText}}setReferrer(ee,le){this.referrer=le}setImages(ee,le,ge){this.availableImages[ee]=le;for(const ve in this.workerSources[ee]){const Ce=this.workerSources[ee][ve];for(const be in Ce)Ce[be].availableImages=le}ge()}setLayers(ee,le,ge){this.getLayerIndex(ee).replace(le),ge()}updateLayers(ee,le,ge){this.getLayerIndex(ee).update(le.layers,le.removedIds),ge()}loadTile(ee,le,ge){this.getWorkerSource(ee,le.type,le.source).loadTile(le,ge)}loadDEMTile(ee,le,ge){this.getDEMWorkerSource(ee,le.source).loadTile(le,ge)}reloadTile(ee,le,ge){this.getWorkerSource(ee,le.type,le.source).reloadTile(le,ge)}abortTile(ee,le,ge){this.getWorkerSource(ee,le.type,le.source).abortTile(le,ge)}removeTile(ee,le,ge){this.getWorkerSource(ee,le.type,le.source).removeTile(le,ge)}removeDEMTile(ee,le){this.getDEMWorkerSource(ee,le.source).removeTile(le)}removeSource(ee,le,ge){if(!this.workerSources[ee]||!this.workerSources[ee][le.type]||!this.workerSources[ee][le.type][le.source])return;const ve=this.workerSources[ee][le.type][le.source];delete this.workerSources[ee][le.type][le.source],ve.removeSource!==void 0?ve.removeSource(le,ge):ge()}loadWorkerSource(ee,le,ge){try{this.self.importScripts(le.url),ge()}catch(ve){ge(ve.toString())}}syncRTLPluginState(ee,le,ge){try{s.bD.setState(le);const ve=s.bD.getPluginURL();if(s.bD.isLoaded()&&!s.bD.isParsed()&&ve!=null){this.self.importScripts(ve);const Ce=s.bD.isParsed();ge(Ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ve}`),Ce)}}catch(ve){ge(ve.toString())}}getAvailableImages(ee){let le=this.availableImages[ee];return le||(le=[]),le}getLayerIndex(ee){let le=this.layerIndexes[ee];return le||(le=this.layerIndexes[ee]=new g),le}getWorkerSource(ee,le,ge){return this.workerSources[ee]||(this.workerSources[ee]={}),this.workerSources[ee][le]||(this.workerSources[ee][le]={}),this.workerSources[ee][le][ge]||(this.workerSources[ee][le][ge]=new this.workerSourceTypes[le]({send:(ve,Ce,be)=>{this.actor.send(ve,Ce,be,ee)}},this.getLayerIndex(ee),this.getAvailableImages(ee))),this.workerSources[ee][le][ge]}getDEMWorkerSource(ee,le){return this.demWorkerSources[ee]||(this.demWorkerSources[ee]={}),this.demWorkerSources[ee][le]||(this.demWorkerSources[ee][le]=new J),this.demWorkerSources[ee][le]}}return s.i()&&(self.worker=new we(self)),we}),o(["./shared"],function(s){var g="3.6.2";class b{static testProp(A){if(!b.docStyle)return A[0];for(let x=0;x<A.length;x++)if(A[x]in b.docStyle)return A[x];return A[0]}static create(A,x,L){const O=window.document.createElement(A);return x!==void 0&&(O.className=x),L&&L.appendChild(O),O}static createNS(A,x){return window.document.createElementNS(A,x)}static disableDrag(){b.docStyle&&b.selectProp&&(b.userSelect=b.docStyle[b.selectProp],b.docStyle[b.selectProp]="none")}static enableDrag(){b.docStyle&&b.selectProp&&(b.docStyle[b.selectProp]=b.userSelect)}static setTransform(A,x){A.style[b.transformProp]=x}static addEventListener(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};A.addEventListener(x,L,"passive"in O?O:O.capture)}static removeEventListener(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};A.removeEventListener(x,L,"passive"in O?O:O.capture)}static suppressClickInternal(A){A.preventDefault(),A.stopPropagation(),window.removeEventListener("click",b.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",b.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",b.suppressClickInternal,!0)},0)}static mousePos(A,x){const L=A.getBoundingClientRect();return new s.P(x.clientX-L.left-A.clientLeft,x.clientY-L.top-A.clientTop)}static touchPos(A,x){const L=A.getBoundingClientRect(),O=[];for(let y=0;y<x.length;y++)O.push(new s.P(x[y].clientX-L.left-A.clientLeft,x[y].clientY-L.top-A.clientTop));return O}static mouseButton(A){return A.button}static remove(A){A.parentNode&&A.parentNode.removeChild(A)}}b.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,b.selectProp=b.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),b.transformProp=b.testProp(["transform","WebkitTransform"]);const T={supported:!1,testSupport:function(N){!z&&k&&(J?te(N):F=N)}};let F,k,z=!1,J=!1;function te(N){const A=N.createTexture();N.bindTexture(N.TEXTURE_2D,A);try{if(N.texImage2D(N.TEXTURE_2D,0,N.RGBA,N.RGBA,N.UNSIGNED_BYTE,k),N.isContextLost())return;T.supported=!0}catch{}N.deleteTexture(A),z=!0}var ue,ce;typeof document<"u"&&(k=document.createElement("img"),k.onload=function(){F&&te(F),F=null,J=!0},k.onerror=function(){z=!0,F=null},k.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(N){let A,x,L,O;N.resetRequestQueue=()=>{A=[],x=0,L=0,O={}},N.addThrottleControl=B=>{const S=L++;return O[S]=B,S},N.removeThrottleControl=B=>{delete O[B],d()},N.getImage=function(B,S){let U=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;T.supported&&(B.headers||(B.headers={}),B.headers.accept="image/webp,*/*");const H={requestParameters:B,supportImageRefresh:U,callback:S,cancelled:!1,completed:!1,cancel:()=>{H.completed||H.cancelled||(H.cancelled=!0,H.innerRequest&&(H.innerRequest.cancel(),x--),d())}};return A.push(H),d(),H};const y=B=>{const{requestParameters:S,supportImageRefresh:U,callback:H}=B;return s.e(S,{type:"image"}),(U!==!1||s.i()||s.g(S.url)||S.headers&&!Object.keys(S.headers).reduce((q,w)=>q&&w==="accept",!0)?s.m:_)(S,(q,w,I,R)=>{a(B,H,q,w,I,R)})},a=(B,S,U,H,q,w)=>{U?S(U):H instanceof HTMLImageElement||s.a(H)?S(null,H):H&&((I,R)=>{typeof createImageBitmap=="function"?s.b(I,R):s.d(I,R)})(H,(I,R)=>{I!=null?S(I):R!=null&&S(null,R,{cacheControl:q,expires:w})}),B.cancelled||(B.completed=!0,x--,d())},d=()=>{const B=(()=>{const S=Object.keys(O);let U=!1;if(S.length>0){for(const H of S)if(U=O[H](),U)break}return U})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let S=x;S<B&&A.length>0;S++){const U=A.shift();if(U.cancelled){S--;continue}const H=y(U);x++,U.innerRequest=H}},_=(B,S)=>{const U=new Image,H=B.url;let q=!1;const w=B.credentials;return w&&w==="include"?U.crossOrigin="use-credentials":(w&&w==="same-origin"||!s.s(H))&&(U.crossOrigin="anonymous"),U.fetchPriority="high",U.onload=()=>{S(null,U),U.onerror=U.onload=null},U.onerror=()=>{q||S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),U.onerror=U.onload=null},U.src=H,{cancel:()=>{q=!0,U.src=""}}}}(ue||(ue={})),ue.resetRequestQueue(),function(N){N.Glyphs="Glyphs",N.Image="Image",N.Source="Source",N.SpriteImage="SpriteImage",N.SpriteJSON="SpriteJSON",N.Style="Style",N.Tile="Tile",N.Unknown="Unknown"}(ce||(ce={}));class de{constructor(A){this._transformRequestFn=A}transformRequest(A,x){return this._transformRequestFn&&this._transformRequestFn(A,x)||{url:A}}normalizeSpriteURL(A,x,L){const O=function(y){const a=y.match(_e);if(!a)throw new Error(`Unable to parse URL "${y}"`);return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}(A);return O.path+=`${x}${L}`,function(y){const a=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${a}`}(O)}setTransformRequest(A){this._transformRequestFn=A}}const _e=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ee(N){var A=new s.A(3);return A[0]=N[0],A[1]=N[1],A[2]=N[2],A}var He,Ve=function(N,A,x){return N[0]=A[0]-x[0],N[1]=A[1]-x[1],N[2]=A[2]-x[2],N};He=new s.A(3),s.A!=Float32Array&&(He[0]=0,He[1]=0,He[2]=0);var qe=function(N){var A=N[0],x=N[1];return A*A+x*x};function Ue(N){const A=[];if(typeof N=="string")A.push({id:"default",url:N});else if(N&&N.length>0){const x=[];for(const{id:L,url:O}of N){const y=`${L}${O}`;x.indexOf(y)===-1&&(x.push(y),A.push({id:L,url:O}))}}return A}function ot(N,A,x,L,O){if(L)return void N(L);if(O!==Object.values(A).length||O!==Object.values(x).length)return;const y={};for(const a in A){y[a]={};const d=s.h.getImageCanvasContext(x[a]),_=A[a];for(const B in _){const{width:S,height:U,x:H,y:q,sdf:w,pixelRatio:I,stretchX:R,stretchY:j,content:Z}=_[B];y[a][B]={data:null,pixelRatio:I,sdf:w,stretchX:R,stretchY:j,content:Z,spriteData:{width:S,height:U,x:H,y:q,context:d}}}}N(null,y)}(function(){var N=new s.A(2);s.A!=Float32Array&&(N[0]=0,N[1]=0)})();class it{constructor(A,x,L,O){this.context=A,this.format=L,this.texture=A.gl.createTexture(),this.update(x,O)}update(A,x,L){const{width:O,height:y}=A,a=!(this.size&&this.size[0]===O&&this.size[1]===y||L),{context:d}=this,{gl:_}=d;if(this.useMipmap=!!(x&&x.useMipmap),_.bindTexture(_.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!x||x.premultiply!==!1)),a)this.size=[O,y],A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof HTMLVideoElement||A instanceof ImageData||s.a(A)?_.texImage2D(_.TEXTURE_2D,0,this.format,this.format,_.UNSIGNED_BYTE,A):_.texImage2D(_.TEXTURE_2D,0,this.format,O,y,0,this.format,_.UNSIGNED_BYTE,A.data);else{const{x:B,y:S}=L||{x:0,y:0};A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof HTMLVideoElement||A instanceof ImageData||s.a(A)?_.texSubImage2D(_.TEXTURE_2D,0,B,S,_.RGBA,_.UNSIGNED_BYTE,A):_.texSubImage2D(_.TEXTURE_2D,0,B,S,O,y,_.RGBA,_.UNSIGNED_BYTE,A.data)}this.useMipmap&&this.isSizePowerOfTwo()&&_.generateMipmap(_.TEXTURE_2D)}bind(A,x,L){const{context:O}=this,{gl:y}=O;y.bindTexture(y.TEXTURE_2D,this.texture),L!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(L=y.LINEAR),A!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,A),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,L||A),this.filter=A),x!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,x),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,x),this.wrap=x)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:A}=this.context;A.deleteTexture(this.texture),this.texture=null}}function De(N){const{userImage:A}=N;return!!(A&&A.render&&A.render())&&(N.data.replace(new Uint8Array(A.data.buffer)),!0)}class Me extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(A){if(this.loaded!==A&&(this.loaded=A,A)){for(const{ids:x,callback:L}of this.requestors)this._notify(x,L);this.requestors=[]}}getImage(A){const x=this.images[A];if(x&&!x.data&&x.spriteData){const L=x.spriteData;x.data=new s.R({width:L.width,height:L.height},L.context.getImageData(L.x,L.y,L.width,L.height).data),x.spriteData=null}return x}addImage(A,x){if(this.images[A])throw new Error(`Image id ${A} already exist, use updateImage instead`);this._validate(A,x)&&(this.images[A]=x)}_validate(A,x){let L=!0;const O=x.data||x.spriteData;return this._validateStretch(x.stretchX,O&&O.width)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "stretchX" value`))),L=!1),this._validateStretch(x.stretchY,O&&O.height)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "stretchY" value`))),L=!1),this._validateContent(x.content,x)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "content" value`))),L=!1),L}_validateStretch(A,x){if(!A)return!0;let L=0;for(const O of A){if(O[0]<L||O[1]<O[0]||x<O[1])return!1;L=O[1]}return!0}_validateContent(A,x){if(!A)return!0;if(A.length!==4)return!1;const L=x.spriteData,O=L&&L.width||x.data.width,y=L&&L.height||x.data.height;return!(A[0]<0||O<A[0]||A[1]<0||y<A[1]||A[2]<0||O<A[2]||A[3]<0||y<A[3]||A[2]<A[0]||A[3]<A[1])}updateImage(A,x){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const O=this.getImage(A);if(L&&(O.data.width!==x.data.width||O.data.height!==x.data.height))throw new Error(`size mismatch between old image (${O.data.width}x${O.data.height}) and new image (${x.data.width}x${x.data.height}).`);x.version=O.version+1,this.images[A]=x,this.updatedImages[A]=!0}removeImage(A){const x=this.images[A];delete this.images[A],delete this.patterns[A],x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(A,x){let L=!0;if(!this.isLoaded())for(const O of A)this.images[O]||(L=!1);this.isLoaded()||L?this._notify(A,x):this.requestors.push({ids:A,callback:x})}_notify(A,x){const L={};for(const O of A){let y=this.getImage(O);y||(this.fire(new s.k("styleimagemissing",{id:O})),y=this.getImage(O)),y?L[O]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:s.w(`Image "${O}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}x(null,L)}getPixelSize(){const{width:A,height:x}=this.atlasImage;return{width:A,height:x}}getPattern(A){const x=this.patterns[A],L=this.getImage(A);if(!L)return null;if(x&&x.position.version===L.version)return x.position;if(x)x.position.version=L.version;else{const O={w:L.data.width+2,h:L.data.height+2,x:0,y:0},y=new s.I(O,L);this.patterns[A]={bin:O,position:y}}return this._updatePatternAtlas(),this.patterns[A].position}bind(A){const x=A.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new it(A,this.atlasImage,x.RGBA),this.atlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE)}_updatePatternAtlas(){const A=[];for(const y in this.patterns)A.push(this.patterns[y].bin);const{w:x,h:L}=s.p(A),O=this.atlasImage;O.resize({width:x||1,height:L||1});for(const y in this.patterns){const{bin:a}=this.patterns[y],d=a.x+1,_=a.y+1,B=this.getImage(y).data,S=B.width,U=B.height;s.R.copy(B,O,{x:0,y:0},{x:d,y:_},{width:S,height:U}),s.R.copy(B,O,{x:0,y:U-1},{x:d,y:_-1},{width:S,height:1}),s.R.copy(B,O,{x:0,y:0},{x:d,y:_+U},{width:S,height:1}),s.R.copy(B,O,{x:S-1,y:0},{x:d-1,y:_},{width:1,height:U}),s.R.copy(B,O,{x:0,y:0},{x:d+S,y:_},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(A){for(const x of A){if(this.callbackDispatchedThisFrame[x])continue;this.callbackDispatchedThisFrame[x]=!0;const L=this.getImage(x);L||s.w(`Image with ID: "${x}" was not found`),De(L)&&this.updateImage(x,L)}}}const Ze=1e20;function We(N,A,x,L,O,y,a,d,_){for(let B=A;B<A+L;B++)Bt(N,x*y+B,y,O,a,d,_);for(let B=x;B<x+O;B++)Bt(N,B*y+A,1,L,a,d,_)}function Bt(N,A,x,L,O,y,a){y[0]=0,a[0]=-Ze,a[1]=Ze,O[0]=N[A];for(let d=1,_=0,B=0;d<L;d++){O[d]=N[A+d*x];const S=d*d;do{const U=y[_];B=(O[d]-O[U]+S-U*U)/(d-U)/2}while(B<=a[_]&&--_>-1);_++,y[_]=d,a[_]=B,a[_+1]=Ze}for(let d=0,_=0;d<L;d++){for(;a[_+1]<d;)_++;const B=y[_],S=d-B;N[A+d*x]=O[B]+S*S}}class Ct{constructor(A,x){this.requestManager=A,this.localIdeographFontFamily=x,this.entries={}}setURL(A){this.url=A}getGlyphs(A,x){const L=[];for(const O in A)for(const y of A[O])L.push({stack:O,id:y});s.o(L,(O,y)=>{let{stack:a,id:d}=O,_=this.entries[a];_||(_=this.entries[a]={glyphs:{},requests:{},ranges:{}});let B=_.glyphs[d];if(B!==void 0)return void y(null,{stack:a,id:d,glyph:B});if(B=this._tinySDF(_,a,d),B)return _.glyphs[d]=B,void y(null,{stack:a,id:d,glyph:B});const S=Math.floor(d/256);if(256*S>65535)return void y(new Error("glyphs > 65535 not supported"));if(_.ranges[S])return void y(null,{stack:a,id:d,glyph:B});if(!this.url)return void y(new Error("glyphsUrl is not set"));let U=_.requests[S];U||(U=_.requests[S]=[],Ct.loadGlyphRange(a,S,this.url,this.requestManager,(H,q)=>{if(q){for(const w in q)this._doesCharSupportLocalGlyph(+w)||(_.glyphs[+w]=q[+w]);_.ranges[S]=!0}for(const w of U)w(H,q);delete _.requests[S]})),U.push((H,q)=>{H?y(H):q&&y(null,{stack:a,id:d,glyph:q[d]||null})})},(O,y)=>{if(O)x(O);else if(y){const a={};for(const{stack:d,id:_,glyph:B}of y)(a[d]||(a[d]={}))[_]=B&&{id:B.id,bitmap:B.bitmap.clone(),metrics:B.metrics};x(null,a)}})}_doesCharSupportLocalGlyph(A){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](A)||s.u["Hangul Syllables"](A)||s.u.Hiragana(A)||s.u.Katakana(A))}_tinySDF(A,x,L){const O=this.localIdeographFontFamily;if(!O||!this._doesCharSupportLocalGlyph(L))return;let y=A.tinySDF;if(!y){let d="400";/bold/i.test(x)?d="900":/medium/i.test(x)?d="500":/light/i.test(x)&&(d="200"),y=A.tinySDF=new Ct.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:O,fontWeight:d})}const a=y.draw(String.fromCharCode(L));return{id:L,bitmap:new s.q({width:a.width||60,height:a.height||60},a.data),metrics:{width:a.glyphWidth/2||24,height:a.glyphHeight/2||24,left:a.glyphLeft/2+.5||0,top:a.glyphTop/2-27.5||-8,advance:a.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ct.loadGlyphRange=function(N,A,x,L,O){const y=256*A,a=y+255,d=L.transformRequest(x.replace("{fontstack}",N).replace("{range}",`${y}-${a}`),ce.Glyphs);s.l(d,(_,B)=>{if(_)O(_);else if(B){const S={};for(const U of s.n(B))S[U.id]=U;O(null,S)}})},Ct.TinySDF=class{constructor(){let{fontSize:N=24,buffer:A=3,radius:x=8,cutoff:L=.25,fontFamily:O="sans-serif",fontWeight:y="normal",fontStyle:a="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=A,this.cutoff=L,this.radius=x;const d=this.size=N+4*A,_=this._createCanvas(d),B=this.ctx=_.getContext("2d",{willReadFrequently:!0});B.font=`${a} ${y} ${N}px ${O}`,B.textBaseline="alphabetic",B.textAlign="left",B.fillStyle="black",this.gridOuter=new Float64Array(d*d),this.gridInner=new Float64Array(d*d),this.f=new Float64Array(d),this.z=new Float64Array(d+1),this.v=new Uint16Array(d)}_createCanvas(N){const A=document.createElement("canvas");return A.width=A.height=N,A}draw(N){const{width:A,actualBoundingBoxAscent:x,actualBoundingBoxDescent:L,actualBoundingBoxLeft:O,actualBoundingBoxRight:y}=this.ctx.measureText(N),a=Math.ceil(x),d=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-O))),_=Math.min(this.size-this.buffer,a+Math.ceil(L)),B=d+2*this.buffer,S=_+2*this.buffer,U=Math.max(B*S,0),H=new Uint8ClampedArray(U),q={data:H,width:B,height:S,glyphWidth:d,glyphHeight:_,glyphTop:a,glyphLeft:0,glyphAdvance:A};if(d===0||_===0)return q;const{ctx:w,buffer:I,gridInner:R,gridOuter:j}=this;w.clearRect(I,I,d,_),w.fillText(N,I,I+a);const Z=w.getImageData(I,I,d,_);j.fill(Ze,0,U),R.fill(0,0,U);for(let W=0;W<_;W++)for(let Y=0;Y<d;Y++){const ie=Z.data[4*(W*d+Y)+3]/255;if(ie===0)continue;const ae=(W+I)*B+Y+I;if(ie===1)j[ae]=0,R[ae]=Ze;else{const fe=.5-ie;j[ae]=fe>0?fe*fe:0,R[ae]=fe<0?fe*fe:0}}We(j,0,0,B,S,B,this.f,this.v,this.z),We(R,I,I,d,_,B,this.f,this.v,this.z);for(let W=0;W<U;W++){const Y=Math.sqrt(j[W])-Math.sqrt(R[W]);H[W]=Math.round(255-255*(Y/this.radius+this.cutoff))}return q}};class Lt{constructor(){this.specification=s.v.light.position}possiblyEvaluate(A,x){return s.z(A.expression.evaluate(x))}interpolate(A,x,L){return{x:s.B.number(A.x,x.x,L),y:s.B.number(A.y,x.y,L),z:s.B.number(A.z,x.z,L)}}}let _t;class Ft extends s.E{constructor(A){super(),_t=_t||new s.r({anchor:new s.D(s.v.light.anchor),position:new Lt,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(_t),this.setLight(A),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(s.t,A,x))for(const L in A){const O=A[L];L.endsWith("-transition")?this._transitionable.setTransition(L.slice(0,-11),O):this._transitionable.setValue(L,O)}}updateTransitions(A){this._transitioning=this._transitionable.transitioned(A,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(A){this.properties=this._transitioning.possiblyEvaluate(A)}_validate(A,x,L){return(!L||L.validate!==!1)&&s.x(this,A.call(s.y,s.e({value:x,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}}class Mt{constructor(A,x){this.width=A,this.height=x,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(A,x){const L=A.join(",")+String(x);return this.dashEntry[L]||(this.dashEntry[L]=this.addDash(A,x)),this.dashEntry[L]}getDashRanges(A,x,L){const O=[];let y=A.length%2==1?-A[A.length-1]*L:0,a=A[0]*L,d=!0;O.push({left:y,right:a,isDash:d,zeroLength:A[0]===0});let _=A[0];for(let B=1;B<A.length;B++){d=!d;const S=A[B];y=_*L,_+=S,a=_*L,O.push({left:y,right:a,isDash:d,zeroLength:S===0})}return O}addRoundDash(A,x,L){const O=x/2;for(let y=-L;y<=L;y++){const a=this.width*(this.nextRow+L+y);let d=0,_=A[d];for(let B=0;B<this.width;B++){B/_.right>1&&(_=A[++d]);const S=Math.abs(B-_.left),U=Math.abs(B-_.right),H=Math.min(S,U);let q;const w=y/L*(O+1);if(_.isDash){const I=O-Math.abs(w);q=Math.sqrt(H*H+I*I)}else q=O-Math.sqrt(H*H+w*w);this.data[a+B]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(A){for(let d=A.length-1;d>=0;--d){const _=A[d],B=A[d+1];_.zeroLength?A.splice(d,1):B&&B.isDash===_.isDash&&(B.left=_.left,A.splice(d,1))}const x=A[0],L=A[A.length-1];x.isDash===L.isDash&&(x.left=L.left-this.width,L.right=x.right+this.width);const O=this.width*this.nextRow;let y=0,a=A[y];for(let d=0;d<this.width;d++){d/a.right>1&&(a=A[++y]);const _=Math.abs(d-a.left),B=Math.abs(d-a.right),S=Math.min(_,B);this.data[O+d]=Math.max(0,Math.min(255,(a.isDash?S:-S)+128))}}addDash(A,x){const L=x?7:0,O=2*L+1;if(this.nextRow+O>this.height)return s.w("LineAtlas out of space"),null;let y=0;for(let d=0;d<A.length;d++)y+=A[d];if(y!==0){const d=this.width/y,_=this.getDashRanges(A,this.width,d);x?this.addRoundDash(_,d,L):this.addRegularDash(_)}const a={y:(this.nextRow+L+.5)/this.height,height:2*L/this.height,width:y};return this.nextRow+=O,this.dirty=!0,a}bind(A){const x=A.gl;this.texture?(x.bindTexture(x.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,x.texSubImage2D(x.TEXTURE_2D,0,0,0,this.width,this.height,x.ALPHA,x.UNSIGNED_BYTE,this.data))):(this.texture=x.createTexture(),x.bindTexture(x.TEXTURE_2D,this.texture),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR),x.texImage2D(x.TEXTURE_2D,0,x.ALPHA,this.width,this.height,0,x.ALPHA,x.UNSIGNED_BYTE,this.data))}}class Wt{constructor(A,x,L){this.workerPool=A,this.actors=[],this.currentActor=0,this.id=L;const O=this.workerPool.acquire(L);for(let y=0;y<O.length;y++){const a=new s.C(O[y],x,L);a.name=`Worker ${y}`,this.actors.push(a)}if(!this.actors.length)throw new Error("No actors found")}broadcast(A,x,L){s.o(this.actors,(O,y)=>{O.send(A,x,y)},L=L||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(x=>{x.remove()}),this.actors=[],A&&this.workerPool.release(this.id)}}function Se(N,A,x){const L=function(O,y){if(O)return x(O);if(y){const a=s.F(s.e(y,N),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(a.vectorLayers=y.vector_layers,a.vectorLayerIds=a.vectorLayers.map(d=>d.id)),x(null,a)}};return N.url?s.f(A.transformRequest(N.url,ce.Source),L):s.h.frame(()=>L(null,N))}class Xe{constructor(A,x){A&&(x?this.setSouthWest(A).setNorthEast(x):Array.isArray(A)&&(A.length===4?this.setSouthWest([A[0],A[1]]).setNorthEast([A[2],A[3]]):this.setSouthWest(A[0]).setNorthEast(A[1])))}setNorthEast(A){return this._ne=A instanceof s.L?new s.L(A.lng,A.lat):s.L.convert(A),this}setSouthWest(A){return this._sw=A instanceof s.L?new s.L(A.lng,A.lat):s.L.convert(A),this}extend(A){const x=this._sw,L=this._ne;let O,y;if(A instanceof s.L)O=A,y=A;else{if(!(A instanceof Xe))return Array.isArray(A)?A.length===4||A.every(Array.isArray)?this.extend(Xe.convert(A)):this.extend(s.L.convert(A)):A&&("lng"in A||"lon"in A)&&"lat"in A?this.extend(s.L.convert(A)):this;if(O=A._sw,y=A._ne,!O||!y)return this}return x||L?(x.lng=Math.min(O.lng,x.lng),x.lat=Math.min(O.lat,x.lat),L.lng=Math.max(y.lng,L.lng),L.lat=Math.max(y.lat,L.lat)):(this._sw=new s.L(O.lng,O.lat),this._ne=new s.L(y.lng,y.lat)),this}getCenter(){return new s.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.L(this.getWest(),this.getNorth())}getSouthEast(){return new s.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(A){const{lng:x,lat:L}=s.L.convert(A);let O=this._sw.lng<=x&&x<=this._ne.lng;return this._sw.lng>this._ne.lng&&(O=this._sw.lng>=x&&x>=this._ne.lng),this._sw.lat<=L&&L<=this._ne.lat&&O}static convert(A){return A instanceof Xe?A:A&&new Xe(A)}static fromLngLat(A){const L=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,O=L/Math.cos(Math.PI/180*A.lat);return new Xe(new s.L(A.lng-O,A.lat-L),new s.L(A.lng+O,A.lat+L))}}class et{constructor(A,x,L){this.bounds=Xe.convert(this.validateBounds(A)),this.minzoom=x||0,this.maxzoom=L||24}validateBounds(A){return Array.isArray(A)&&A.length===4?[Math.max(-180,A[0]),Math.max(-90,A[1]),Math.min(180,A[2]),Math.min(90,A[3])]:[-180,-90,180,90]}contains(A){const x=Math.pow(2,A.z),L=Math.floor(s.G(this.bounds.getWest())*x),O=Math.floor(s.H(this.bounds.getNorth())*x),y=Math.ceil(s.G(this.bounds.getEast())*x),a=Math.ceil(s.H(this.bounds.getSouth())*x);return A.x>=L&&A.x<y&&A.y>=O&&A.y<a}}class At extends s.E{constructor(A,x,L,O){if(super(),this.load=()=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Se(this._options,this.map._requestManager,(y,a)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),y?this.fire(new s.j(y)):a&&(s.e(this,a),a.bounds&&(this.tileBounds=new et(a.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>s.e({},this._options),this.id=A,this.dispatcher=L,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.F(x,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},x),this._collectResourceTiming=x.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(O)}loaded(){return this._loaded}hasTile(A){return!this.tileBounds||this.tileBounds.contains(A.canonical)}onAdd(A){this.map=A,this.load()}setSourceProperty(A){this._tileJSONRequest&&this._tileJSONRequest.cancel(),A(),this.load()}setTiles(A){return this.setSourceProperty(()=>{this._options.tiles=A}),this}setUrl(A){return this.setSourceProperty(()=>{this.url=A,this._options.url=A}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(A,x){const L=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),O={request:this.map._requestManager.transformRequest(L,ce.Tile),uid:A.uid,tileID:A.tileID,zoom:A.tileID.overscaledZ,tileSize:this.tileSize*A.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function y(a,d){return delete A.request,A.aborted?x(null):a&&a.status!==404?x(a):(d&&d.resourceTiming&&(A.resourceTiming=d.resourceTiming),this.map._refreshExpiredTiles&&d&&A.setExpiryData(d),A.loadVectorData(d,this.map.painter),x(null),void(A.reloadCallback&&(this.loadTile(A,A.reloadCallback),A.reloadCallback=null)))}O.request.collectResourceTiming=this._collectResourceTiming,A.actor&&A.state!=="expired"?A.state==="loading"?A.reloadCallback=x:A.request=A.actor.send("reloadTile",O,y.bind(this)):(A.actor=this.dispatcher.getActor(),A.request=A.actor.send("loadTile",O,y.bind(this)))}abortTile(A){A.request&&(A.request.cancel(),delete A.request),A.actor&&A.actor.send("abortTile",{uid:A.uid,type:this.type,source:this.id},void 0)}unloadTile(A){A.unloadVectorData(),A.actor&&A.actor.send("removeTile",{uid:A.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class ft extends s.E{constructor(A,x,L,O){super(),this.id=A,this.dispatcher=L,this.setEventedParent(O),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},x),s.e(this,s.F(x,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Se(this._options,this.map._requestManager,(A,x)=>{this._tileJSONRequest=null,this._loaded=!0,A?this.fire(new s.j(A)):x&&(s.e(this,x),x.bounds&&(this.tileBounds=new et(x.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(A){this.map=A,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(A){this._tileJSONRequest&&this._tileJSONRequest.cancel(),A(),this.load()}setTiles(A){return this.setSourceProperty(()=>{this._options.tiles=A}),this}serialize(){return s.e({},this._options)}hasTile(A){return!this.tileBounds||this.tileBounds.contains(A.canonical)}loadTile(A,x){const L=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);A.request=ue.getImage(this.map._requestManager.transformRequest(L,ce.Tile),(O,y,a)=>{if(delete A.request,A.aborted)A.state="unloaded",x(null);else if(O)A.state="errored",x(O);else if(y){this.map._refreshExpiredTiles&&a&&A.setExpiryData(a);const d=this.map.painter.context,_=d.gl;A.texture=this.map.painter.getTileTexture(y.width),A.texture?A.texture.update(y,{useMipmap:!0}):(A.texture=new it(d,y,_.RGBA,{useMipmap:!0}),A.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),d.extTextureFilterAnisotropic&&_.texParameterf(_.TEXTURE_2D,d.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,d.extTextureFilterAnisotropicMax)),A.state="loaded",x(null)}},this.map._refreshExpiredTiles)}abortTile(A,x){A.request&&(A.request.cancel(),delete A.request),x()}unloadTile(A,x){A.texture&&this.map.painter.saveTileTexture(A.texture),x()}hasTransition(){return!1}}class wt extends ft{constructor(A,x,L,O){super(A,x,L,O),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},x),this.encoding=x.encoding||"mapbox",this.redFactor=x.redFactor,this.greenFactor=x.greenFactor,this.blueFactor=x.blueFactor,this.baseShift=x.baseShift}loadTile(A,x){const L=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),O=this.map._requestManager.transformRequest(L,ce.Tile);function y(a,d){a&&(A.state="errored",x(a)),d&&(A.dem=d,A.needsHillshadePrepare=!0,A.needsTerrainPrepare=!0,A.state="loaded",x(null))}A.neighboringTiles=this._getNeighboringTiles(A.tileID),A.request=ue.getImage(O,(a,d,_)=>s._(this,void 0,void 0,function*(){if(delete A.request,A.aborted)A.state="unloaded",x(null);else if(a)A.state="errored",x(a);else if(d){this.map._refreshExpiredTiles&&A.setExpiryData(_);const B=s.a(d)&&s.J()?d:yield function(U){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.K()){const H=U.width+2,q=U.height+2;try{return new s.R({width:H,height:q},yield s.M(U,-1,-1,H,q))}catch{}}return s.h.getImageData(U,1)})}(d),S={uid:A.uid,coord:A.tileID,source:this.id,rawImageData:B,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};A.actor&&A.state!=="expired"||(A.actor=this.dispatcher.getActor(),A.actor.send("loadDEMTile",S,y))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(A){const x=A.canonical,L=Math.pow(2,x.z),O=(x.x-1+L)%L,y=x.x===0?A.wrap-1:A.wrap,a=(x.x+1+L)%L,d=x.x+1===L?A.wrap+1:A.wrap,_={};return _[new s.O(A.overscaledZ,y,x.z,O,x.y).key]={backfilled:!1},_[new s.O(A.overscaledZ,d,x.z,a,x.y).key]={backfilled:!1},x.y>0&&(_[new s.O(A.overscaledZ,y,x.z,O,x.y-1).key]={backfilled:!1},_[new s.O(A.overscaledZ,A.wrap,x.z,x.x,x.y-1).key]={backfilled:!1},_[new s.O(A.overscaledZ,d,x.z,a,x.y-1).key]={backfilled:!1}),x.y+1<L&&(_[new s.O(A.overscaledZ,y,x.z,O,x.y+1).key]={backfilled:!1},_[new s.O(A.overscaledZ,A.wrap,x.z,x.x,x.y+1).key]={backfilled:!1},_[new s.O(A.overscaledZ,d,x.z,a,x.y+1).key]={backfilled:!1}),_}unloadTile(A){A.demTexture&&this.map.painter.saveTileTexture(A.demTexture),A.fbo&&(A.fbo.destroy(),delete A.fbo),A.dem&&delete A.dem,delete A.neighboringTiles,A.state="unloaded",A.actor&&A.actor.send("removeDEMTile",{uid:A.uid,source:this.id})}}class Pt extends s.E{constructor(A,x,L,O){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>s.e({},this._options,{type:this.type,data:this._data}),this.id=A,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=L.getActor(),this.setEventedParent(O),this._data=x.data,this._options=s.e({},x),this._collectResourceTiming=x.collectResourceTiming,x.maxzoom!==void 0&&(this.maxzoom=x.maxzoom),x.type&&(this.type=x.type),x.attribution&&(this.attribution=x.attribution),this.promoteId=x.promoteId;const y=s.N/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:x.cluster||!1,geojsonVtOptions:{buffer:(x.buffer!==void 0?x.buffer:128)*y,tolerance:(x.tolerance!==void 0?x.tolerance:.375)*y,extent:s.N,maxZoom:this.maxzoom,lineMetrics:x.lineMetrics||!1,generateId:x.generateId||!1},superclusterOptions:{maxZoom:x.clusterMaxZoom!==void 0?x.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,x.clusterMinPoints||2),extent:s.N,radius:(x.clusterRadius||50)*y,log:!1,generateId:x.generateId||!1},clusterProperties:x.clusterProperties,filter:x.filter},x.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(A){this.map=A,this.load()}setData(A){return this._data=A,this._updateWorkerData(),this}updateData(A){return this._updateWorkerData(A),this}setClusterOptions(A){return this.workerOptions.cluster=A.cluster,A&&(A.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=A.clusterRadius),A.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=A.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(A,x){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:A,source:this.id},x),this}getClusterChildren(A,x){return this.actor.send("geojson.getClusterChildren",{clusterId:A,source:this.id},x),this}getClusterLeaves(A,x,L,O){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:A,limit:x,offset:L},O),this}_updateWorkerData(A){const x=s.e({},this.workerOptions);A?x.dataDiff=A:typeof this._data=="string"?(x.request=this.map._requestManager.transformRequest(s.h.resolveURL(this._data),ce.Source),x.request.collectResourceTiming=this._collectResourceTiming):x.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,x,(L,O)=>{if(this._pendingLoads--,this._removed||O&&O.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let y=null;if(O&&O.resourceTiming&&O.resourceTiming[this.id]&&(y=O.resourceTiming[this.id].slice(0)),L)return void this.fire(new s.j(L));const a={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&s.e(a,{resourceTiming:y}),this.fire(new s.k("data",Object.assign(Object.assign({},a),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},a),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(A,x){const L=A.actor?"reloadTile":"loadTile";A.actor=this.actor;const O={type:this.type,uid:A.uid,tileID:A.tileID,zoom:A.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};A.request=this.actor.send(L,O,(y,a)=>(delete A.request,A.unloadVectorData(),A.aborted?x(null):y?x(y):(A.loadVectorData(a,this.map.painter,L==="reloadTile"),x(null))))}abortTile(A){A.request&&(A.request.cancel(),delete A.request),A.aborted=!0}unloadTile(A){A.unloadVectorData(),this.actor.send("removeTile",{uid:A.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var It=s.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ht extends s.E{constructor(A,x,L,O){super(),this.load=(y,a)=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=ue.getImage(this.map._requestManager.transformRequest(this.url,ce.Image),(d,_)=>{this._request=null,this._loaded=!0,d?this.fire(new s.j(d)):_&&(this.image=_,y&&(this.coordinates=y),a&&a(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const y=this.map.painter.context,a=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,It.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new it(y,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let d=!1;for(const _ in this.tiles){const B=this.tiles[_];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture,d=!0)}d&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=A,this.dispatcher=L,this.coordinates=x.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(O),this.options=x}loaded(){return this._loaded}updateImage(A){return A.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=A.url,this.load(A.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(A){this.map=A,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(A){this.coordinates=A;const x=A.map(s.U.fromLngLat);this.tileID=function(O){let y=1/0,a=1/0,d=-1/0,_=-1/0;for(const H of O)y=Math.min(y,H.x),a=Math.min(a,H.y),d=Math.max(d,H.x),_=Math.max(_,H.y);const B=Math.max(d-y,_-a),S=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),U=Math.pow(2,S);return new s.W(S,Math.floor((y+d)/2*U),Math.floor((a+_)/2*U))}(x),this.minzoom=this.maxzoom=this.tileID.z;const L=x.map(O=>this.tileID.getTilePoint(O)._round());return this._boundsArray=new s.V,this._boundsArray.emplaceBack(L[0].x,L[0].y,0,0),this._boundsArray.emplaceBack(L[1].x,L[1].y,s.N,0),this._boundsArray.emplaceBack(L[3].x,L[3].y,0,s.N),this._boundsArray.emplaceBack(L[2].x,L[2].y,s.N,s.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(A,x){this.tileID&&this.tileID.equals(A.tileID.canonical)?(this.tiles[String(A.tileID.wrap)]=A,A.buckets={},x(null)):(A.state="errored",x(null))}hasTransition(){return!1}}class ii extends Ht{constructor(A,x,L,O){super(A,x,L,O),this.load=()=>{this._loaded=!1;const y=this.options;this.urls=[];for(const a of y.urls)this.urls.push(this.map._requestManager.transformRequest(a,ce.Source).url);s.X(this.urls,(a,d)=>{this._loaded=!0,a?this.fire(new s.j(a)):d&&(this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,a=y.gl;this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,It.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new it(y,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let d=!1;for(const _ in this.tiles){const B=this.tiles[_];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture,d=!0)}d&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=x}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(A){if(this.video){const x=this.video.seekable;A<x.start(0)||A>x.end(0)?this.fire(new s.j(new s.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${x.start(0)} and ${x.end(0)}-second mark.`))):this.video.currentTime=A}}getVideo(){return this.video}onAdd(A){this.map||(this.map=A,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class gi extends Ht{constructor(A,x,L,O){super(A,x,L,O),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,It.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?(y||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new it(a,this.canvas,d.RGBA,{premultiply:!0});let _=!1;for(const B in this.tiles){const S=this.tiles[B];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,_=!0)}_&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),x.coordinates?Array.isArray(x.coordinates)&&x.coordinates.length===4&&!x.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(a=>typeof a!="number"))||this.fire(new s.j(new s.Y(`sources.${A}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.Y(`sources.${A}`,null,'missing required property "coordinates"'))),x.animate&&typeof x.animate!="boolean"&&this.fire(new s.j(new s.Y(`sources.${A}`,null,'optional "animate" property must be a boolean value'))),x.canvas?typeof x.canvas=="string"||x.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.Y(`sources.${A}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.Y(`sources.${A}`,null,'missing required property "canvas"'))),this.options=x,this.animate=x.animate===void 0||x.animate}getCanvas(){return this.canvas}onAdd(A){this.map=A,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const A of[this.canvas.width,this.canvas.height])if(isNaN(A)||A<=0)return!0;return!1}}const mi={},Mi=N=>{switch(N){case"geojson":return Pt;case"image":return Ht;case"raster":return ft;case"raster-dem":return wt;case"vector":return At;case"video":return ii;case"canvas":return gi}return mi[N]};function kt(N,A){const x=s.Z();return s.$(x,x,[1,1,0]),s.a0(x,x,[.5*N.width,.5*N.height,1]),s.a1(x,x,N.calculatePosMatrix(A.toUnwrapped()))}function at(N,A,x,L,O,y){const a=function(U,H,q){if(U)for(const w of U){const I=H[w];if(I&&I.source===q&&I.type==="fill-extrusion")return!0}else for(const w in H){const I=H[w];if(I.source===q&&I.type==="fill-extrusion")return!0}return!1}(O&&O.layers,A,N.id),d=y.maxPitchScaleFactor(),_=N.tilesIn(L,d,a);_.sort(xt);const B=[];for(const U of _)B.push({wrappedTileID:U.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(A,x,N._state,U.queryGeometry,U.cameraQueryGeometry,U.scale,O,y,d,kt(N.transform,U.tileID))});const S=function(U){const H={},q={};for(const w of U){const I=w.queryResults,R=w.wrappedTileID,j=q[R]=q[R]||{};for(const Z in I){const W=I[Z],Y=j[Z]=j[Z]||{},ie=H[Z]=H[Z]||[];for(const ae of W)Y[ae.featureIndex]||(Y[ae.featureIndex]=!0,ie.push(ae))}}return H}(B);for(const U in S)S[U].forEach(H=>{const q=H.feature,w=N.getFeatureState(q.layer["source-layer"],q.id);q.source=q.layer.source,q.layer["source-layer"]&&(q.sourceLayer=q.layer["source-layer"]),q.state=w});return S}function xt(N,A){const x=N.tileID,L=A.tileID;return x.overscaledZ-L.overscaledZ||x.canonical.y-L.canonical.y||x.wrap-L.wrap||x.canonical.x-L.canonical.x}class Ri{constructor(A,x){this.timeAdded=0,this.fadeEndTime=0,this.tileID=A,this.uid=s.a2(),this.uses=0,this.tileSize=x,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(A){const x=A+this.timeAdded;x<this.fadeEndTime||(this.fadeEndTime=x)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(A){this.demTexture&&A.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(A,x,L){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",A){A.featureIndex&&(this.latestFeatureIndex=A.featureIndex,A.rawTileData?(this.latestRawTileData=A.rawTileData,this.latestFeatureIndex.rawTileData=A.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=A.collisionBoxArray,this.buckets=function(O,y){const a={};if(!y)return a;for(const d of O){const _=d.layerIds.map(B=>y.getLayer(B)).filter(Boolean);if(_.length!==0){d.layers=_,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(B=>_.filter(S=>S.id===B)[0]));for(const B of _)a[B.id]=d}}return a}(A.buckets,x.style),this.hasSymbolBuckets=!1;for(const O in this.buckets){const y=this.buckets[O];if(y instanceof s.a4){if(this.hasSymbolBuckets=!0,!L)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const O in this.buckets){const y=this.buckets[O];if(y instanceof s.a4&&y.hasRTLText){this.hasRTLText=!0,s.a5();break}}this.queryPadding=0;for(const O in this.buckets){const y=this.buckets[O];this.queryPadding=Math.max(this.queryPadding,x.style.getLayer(O).queryRadius(y))}A.imageAtlas&&(this.imageAtlas=A.imageAtlas),A.glyphAtlasImage&&(this.glyphAtlasImage=A.glyphAtlasImage)}else this.collisionBoxArray=new s.a3}unloadVectorData(){for(const A in this.buckets)this.buckets[A].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(A){return this.buckets[A.id]}upload(A){for(const L in this.buckets){const O=this.buckets[L];O.uploadPending()&&O.upload(A)}const x=A.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new it(A,this.imageAtlas.image,x.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new it(A,this.glyphAtlasImage,x.ALPHA),this.glyphAtlasImage=null)}prepare(A){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(A,this.imageAtlasTexture)}queryRenderedFeatures(A,x,L,O,y,a,d,_,B,S){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:O,cameraQueryGeometry:y,scale:a,tileSize:this.tileSize,pixelPosMatrix:S,transform:_,params:d,queryPadding:this.queryPadding*B},A,x,L):{}}querySourceFeatures(A,x){const L=this.latestFeatureIndex;if(!L||!L.rawTileData)return;const O=L.loadVTLayers(),y=x&&x.sourceLayer?x.sourceLayer:"",a=O._geojsonTileLayer||O[y];if(!a)return;const d=s.a6(x&&x.filter),{z:_,x:B,y:S}=this.tileID.canonical,U={z:_,x:B,y:S};for(let H=0;H<a.length;H++){const q=a.feature(H);if(d.needGeometry){const R=s.a7(q,!0);if(!d.filter(new s.a8(this.tileID.overscaledZ),R,this.tileID.canonical))continue}else if(!d.filter(new s.a8(this.tileID.overscaledZ),q))continue;const w=L.getId(q,y),I=new s.a9(q,_,B,S,w);I.tile=U,A.push(I)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(A){const x=this.expirationTime;if(A.cacheControl){const L=s.aa(A.cacheControl);L["max-age"]&&(this.expirationTime=Date.now()+1e3*L["max-age"])}else A.expires&&(this.expirationTime=new Date(A.expires).getTime());if(this.expirationTime){const L=Date.now();let O=!1;if(this.expirationTime>L)O=!1;else if(x)if(this.expirationTime<x)O=!0;else{const y=this.expirationTime-x;y?this.expirationTime=L+Math.max(y,3e4):O=!0}else O=!0;O?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(A,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(A).length===0)return;const L=this.latestFeatureIndex.loadVTLayers();for(const O in this.buckets){if(!x.style.hasLayer(O))continue;const y=this.buckets[O],a=y.layers[0].sourceLayer||"_geojsonTileLayer",d=L[a],_=A[a];if(!d||!_||Object.keys(_).length===0)continue;y.update(_,d,this.imageAtlas&&this.imageAtlas.patternPositions||{});const B=x&&x.style&&x.style.getLayer(O);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(A){this.symbolFadeHoldUntil=s.h.now()+A}setDependencies(A,x){const L={};for(const O of x)L[O]=!0;this.dependencies[A]=L}hasDependency(A,x){for(const L of A){const O=this.dependencies[L];if(O){for(const y of x)if(O[y])return!0}}return!1}}class ei{constructor(A,x){this.max=A,this.onRemove=x,this.reset()}reset(){for(const A in this.data)for(const x of this.data[A])x.timeout&&clearTimeout(x.timeout),this.onRemove(x.value);return this.data={},this.order=[],this}add(A,x,L){const O=A.wrapped().key;this.data[O]===void 0&&(this.data[O]=[]);const y={value:x,timeout:void 0};if(L!==void 0&&(y.timeout=setTimeout(()=>{this.remove(A,y)},L)),this.data[O].push(y),this.order.push(O),this.order.length>this.max){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}has(A){return A.wrapped().key in this.data}getAndRemove(A){return this.has(A)?this._getAndRemoveByKey(A.wrapped().key):null}_getAndRemoveByKey(A){const x=this.data[A].shift();return x.timeout&&clearTimeout(x.timeout),this.data[A].length===0&&delete this.data[A],this.order.splice(this.order.indexOf(A),1),x.value}getByKey(A){const x=this.data[A];return x?x[0].value:null}get(A){return this.has(A)?this.data[A.wrapped().key][0].value:null}remove(A,x){if(!this.has(A))return this;const L=A.wrapped().key,O=x===void 0?0:this.data[L].indexOf(x),y=this.data[L][O];return this.data[L].splice(O,1),y.timeout&&clearTimeout(y.timeout),this.data[L].length===0&&delete this.data[L],this.onRemove(y.value),this.order.splice(this.order.indexOf(L),1),this}setMaxSize(A){for(this.max=A;this.order.length>this.max;){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}filter(A){const x=[];for(const L in this.data)for(const O of this.data[L])A(O.value)||x.push(O);for(const L of x)this.remove(L.value.tileID,L)}}class ut{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(A,x,L){const O=String(x);if(this.stateChanges[A]=this.stateChanges[A]||{},this.stateChanges[A][O]=this.stateChanges[A][O]||{},s.e(this.stateChanges[A][O],L),this.deletedStates[A]===null){this.deletedStates[A]={};for(const y in this.state[A])y!==O&&(this.deletedStates[A][y]=null)}else if(this.deletedStates[A]&&this.deletedStates[A][O]===null){this.deletedStates[A][O]={};for(const y in this.state[A][O])L[y]||(this.deletedStates[A][O][y]=null)}else for(const y in L)this.deletedStates[A]&&this.deletedStates[A][O]&&this.deletedStates[A][O][y]===null&&delete this.deletedStates[A][O][y]}removeFeatureState(A,x,L){if(this.deletedStates[A]===null)return;const O=String(x);if(this.deletedStates[A]=this.deletedStates[A]||{},L&&x!==void 0)this.deletedStates[A][O]!==null&&(this.deletedStates[A][O]=this.deletedStates[A][O]||{},this.deletedStates[A][O][L]=null);else if(x!==void 0)if(this.stateChanges[A]&&this.stateChanges[A][O])for(L in this.deletedStates[A][O]={},this.stateChanges[A][O])this.deletedStates[A][O][L]=null;else this.deletedStates[A][O]=null;else this.deletedStates[A]=null}getState(A,x){const L=String(x),O=s.e({},(this.state[A]||{})[L],(this.stateChanges[A]||{})[L]);if(this.deletedStates[A]===null)return{};if(this.deletedStates[A]){const y=this.deletedStates[A][x];if(y===null)return{};for(const a in y)delete O[a]}return O}initializeTileState(A,x){A.setFeatureState(this.state,x)}coalesceChanges(A,x){const L={};for(const O in this.stateChanges){this.state[O]=this.state[O]||{};const y={};for(const a in this.stateChanges[O])this.state[O][a]||(this.state[O][a]={}),s.e(this.state[O][a],this.stateChanges[O][a]),y[a]=this.state[O][a];L[O]=y}for(const O in this.deletedStates){this.state[O]=this.state[O]||{};const y={};if(this.deletedStates[O]===null)for(const a in this.state[O])y[a]={},this.state[O][a]={};else for(const a in this.deletedStates[O]){if(this.deletedStates[O][a]===null)this.state[O][a]={};else for(const d of Object.keys(this.deletedStates[O][a]))delete this.state[O][a][d];y[a]=this.state[O][a]}L[O]=L[O]||{},s.e(L[O],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(L).length!==0)for(const O in A)A[O].setFeatureState(L,x)}}class jt extends s.E{constructor(A,x,L){super(),this.id=A,this.dispatcher=L,this.on("data",O=>{O.dataType==="source"&&O.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&O.dataType==="source"&&O.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((O,y,a,d)=>{const _=new(Mi(y.type))(O,y,a,d);if(_.id!==O)throw new Error(`Expected Source id to be ${O} instead of ${_.id}`);return _})(A,x,L,this),this._tiles={},this._cache=new ei(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ut,this._didEmitContent=!1,this._updated=!1}onAdd(A){this.map=A,this._maxTileCacheSize=A?A._maxTileCacheSize:null,this._maxTileCacheZoomLevels=A?A._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(A)}onRemove(A){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(A)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const A in this._tiles){const x=this._tiles[A];if(x.state!=="loaded"&&x.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const A=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,A&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(A,x){return this._source.loadTile(A,x)}_unloadTile(A){if(this._source.unloadTile)return this._source.unloadTile(A,()=>{})}_abortTile(A){this._source.abortTile&&this._source.abortTile(A,()=>{}),this._source.fire(new s.k("dataabort",{tile:A,coord:A.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(A){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const x in this._tiles){const L=this._tiles[x];L.upload(A),L.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(A=>A.tileID).sort(ni).map(A=>A.key)}getRenderableIds(A){const x=[];for(const L in this._tiles)this._isIdRenderable(L,A)&&x.push(this._tiles[L]);return A?x.sort((L,O)=>{const y=L.tileID,a=O.tileID,d=new s.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),_=new s.P(a.canonical.x,a.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-a.overscaledZ||_.y-d.y||_.x-d.x}).map(L=>L.tileID.key):x.map(L=>L.tileID).sort(ni).map(L=>L.key)}hasRenderableParent(A){const x=this.findLoadedParent(A,0);return!!x&&this._isIdRenderable(x.tileID.key)}_isIdRenderable(A,x){return this._tiles[A]&&this._tiles[A].hasData()&&!this._coveredTiles[A]&&(x||!this._tiles[A].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const A in this._tiles)this._tiles[A].state!=="errored"&&this._reloadTile(A,"reloading")}}_reloadTile(A,x){const L=this._tiles[A];L&&(L.state!=="loading"&&(L.state=x),this._loadTile(L,this._tileLoaded.bind(this,L,A,x)))}_tileLoaded(A,x,L,O){if(O)return A.state="errored",void(O.status!==404?this._source.fire(new s.j(O,{tile:A})):this.update(this.transform,this.terrain));A.timeAdded=s.h.now(),L==="expired"&&(A.refreshedUponExpiration=!0),this._setTileReloadTimer(x,A),this.getSource().type==="raster-dem"&&A.dem&&this._backfillDEM(A),this._state.initializeTileState(A,this.map?this.map.painter:null),A.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:A,coord:A.tileID}))}_backfillDEM(A){const x=this.getRenderableIds();for(let O=0;O<x.length;O++){const y=x[O];if(A.neighboringTiles&&A.neighboringTiles[y]){const a=this.getTileByID(y);L(A,a),L(a,A)}}function L(O,y){O.needsHillshadePrepare=!0,O.needsTerrainPrepare=!0;let a=y.tileID.canonical.x-O.tileID.canonical.x;const d=y.tileID.canonical.y-O.tileID.canonical.y,_=Math.pow(2,O.tileID.canonical.z),B=y.tileID.key;a===0&&d===0||Math.abs(d)>1||(Math.abs(a)>1&&(Math.abs(a+_)===1?a+=_:Math.abs(a-_)===1&&(a-=_)),y.dem&&O.dem&&(O.dem.backfillBorder(y.dem,a,d),O.neighboringTiles&&O.neighboringTiles[B]&&(O.neighboringTiles[B].backfilled=!0)))}}getTile(A){return this.getTileByID(A.key)}getTileByID(A){return this._tiles[A]}_retainLoadedChildren(A,x,L,O){for(const y in this._tiles){let a=this._tiles[y];if(O[y]||!a.hasData()||a.tileID.overscaledZ<=x||a.tileID.overscaledZ>L)continue;let d=a.tileID;for(;a&&a.tileID.overscaledZ>x+1;){const B=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[B.key],a&&a.hasData()&&(d=B)}let _=d;for(;_.overscaledZ>x;)if(_=_.scaledTo(_.overscaledZ-1),A[_.key]){O[d.key]=d;break}}}findLoadedParent(A,x){if(A.key in this._loadedParentTiles){const L=this._loadedParentTiles[A.key];return L&&L.tileID.overscaledZ>=x?L:null}for(let L=A.overscaledZ-1;L>=x;L--){const O=A.scaledTo(L),y=this._getLoadedTile(O);if(y)return y}}_getLoadedTile(A){const x=this._tiles[A.key];return x&&x.hasData()?x:this._cache.getByKey(A.wrapped().key)}updateCacheSize(A){const x=Math.ceil(A.width/this._source.tileSize)+1,L=Math.ceil(A.height/this._source.tileSize)+1,O=Math.floor(x*L*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,O):O;this._cache.setMaxSize(y)}handleWrapJump(A){const x=Math.round((A-(this._prevLng===void 0?A:this._prevLng))/360);if(this._prevLng=A,x){const L={};for(const O in this._tiles){const y=this._tiles[O];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+x),L[y.tileID.key]=y}this._tiles=L;for(const O in this._timers)clearTimeout(this._timers[O]),delete this._timers[O];for(const O in this._tiles)this._setTileReloadTimer(O,this._tiles[O])}}update(A,x){if(this.transform=A,this.terrain=x,!this._sourceLoaded||this._paused)return;let L;this.updateCacheSize(A),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?L=A.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new s.O(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y)):(L=A.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:x}),this._source.hasTile&&(L=L.filter(S=>this._source.hasTile(S)))):L=[];const O=A.coveringZoomLevel(this._source),y=Math.max(O-jt.maxOverzooming,this._source.minzoom),a=Math.max(O+jt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const S={};for(const U of L)if(U.canonical.z>this._source.minzoom){const H=U.scaledTo(U.canonical.z-1);S[H.key]=H;const q=U.scaledTo(Math.max(this._source.minzoom,Math.min(U.canonical.z,5)));S[q.key]=q}L=L.concat(Object.values(S))}const d=L.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,d&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const _=this._updateRetainedTiles(L,O);if(di(this._source.type)){const S={},U={},H=Object.keys(_),q=s.h.now();for(const w of H){const I=_[w],R=this._tiles[w];if(!R||R.fadeEndTime!==0&&R.fadeEndTime<=q)continue;const j=this.findLoadedParent(I,y);j&&(this._addTile(j.tileID),S[j.tileID.key]=j.tileID),U[w]=I}this._retainLoadedChildren(U,O,a,_);for(const w in S)_[w]||(this._coveredTiles[w]=!0,_[w]=S[w]);if(x){const w={},I={};for(const R of L)this._tiles[R.key].hasData()?w[R.key]=R:I[R.key]=R;for(const R in I){const j=I[R].children(this._source.maxzoom);this._tiles[j[0].key]&&this._tiles[j[1].key]&&this._tiles[j[2].key]&&this._tiles[j[3].key]&&(w[j[0].key]=_[j[0].key]=j[0],w[j[1].key]=_[j[1].key]=j[1],w[j[2].key]=_[j[2].key]=j[2],w[j[3].key]=_[j[3].key]=j[3],delete I[R])}for(const R in I){const j=this.findLoadedParent(I[R],this._source.minzoom);if(j){w[j.tileID.key]=_[j.tileID.key]=j.tileID;for(const Z in w)w[Z].isChildOf(j.tileID)&&delete w[Z]}}for(const R in this._tiles)w[R]||(this._coveredTiles[R]=!0)}}for(const S in _)this._tiles[S].clearFadeHold();const B=s.ab(this._tiles,_);for(const S of B){const U=this._tiles[S];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(S)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const A in this._tiles)this._tiles[A].holdingForFade()&&this._removeTile(A)}_updateRetainedTiles(A,x){const L={},O={},y=Math.max(x-jt.maxOverzooming,this._source.minzoom),a=Math.max(x+jt.maxUnderzooming,this._source.minzoom),d={};for(const _ of A){const B=this._addTile(_);L[_.key]=_,B.hasData()||x<this._source.maxzoom&&(d[_.key]=_)}this._retainLoadedChildren(d,x,a,L);for(const _ of A){let B=this._tiles[_.key];if(B.hasData())continue;if(x+1>this._source.maxzoom){const U=_.children(this._source.maxzoom)[0],H=this.getTile(U);if(H&&H.hasData()){L[U.key]=U;continue}}else{const U=_.children(this._source.maxzoom);if(L[U[0].key]&&L[U[1].key]&&L[U[2].key]&&L[U[3].key])continue}let S=B.wasRequested();for(let U=_.overscaledZ-1;U>=y;--U){const H=_.scaledTo(U);if(O[H.key])break;if(O[H.key]=!0,B=this.getTile(H),!B&&S&&(B=this._addTile(H)),B){const q=B.hasData();if((S||q)&&(L[H.key]=H),S=B.wasRequested(),q)break}}}return L}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const A in this._tiles){const x=[];let L,O=this._tiles[A].tileID;for(;O.overscaledZ>0;){if(O.key in this._loadedParentTiles){L=this._loadedParentTiles[O.key];break}x.push(O.key);const y=O.scaledTo(O.overscaledZ-1);if(L=this._getLoadedTile(y),L)break;O=y}for(const y of x)this._loadedParentTiles[y]=L}}_addTile(A){let x=this._tiles[A.key];if(x)return x;x=this._cache.getAndRemove(A),x&&(this._setTileReloadTimer(A.key,x),x.tileID=A,this._state.initializeTileState(x,this.map?this.map.painter:null),this._cacheTimers[A.key]&&(clearTimeout(this._cacheTimers[A.key]),delete this._cacheTimers[A.key],this._setTileReloadTimer(A.key,x)));const L=x;return x||(x=new Ri(A,this._source.tileSize*A.overscaleFactor()),this._loadTile(x,this._tileLoaded.bind(this,x,A.key,x.state))),x.uses++,this._tiles[A.key]=x,L||this._source.fire(new s.k("dataloading",{tile:x,coord:x.tileID,dataType:"source"})),x}_setTileReloadTimer(A,x){A in this._timers&&(clearTimeout(this._timers[A]),delete this._timers[A]);const L=x.getExpiryTimeout();L&&(this._timers[A]=setTimeout(()=>{this._reloadTile(A,"expired"),delete this._timers[A]},L))}_removeTile(A){const x=this._tiles[A];x&&(x.uses--,delete this._tiles[A],this._timers[A]&&(clearTimeout(this._timers[A]),delete this._timers[A]),x.uses>0||(x.hasData()&&x.state!=="reloading"?this._cache.add(x.tileID,x,x.getExpiryTimeout()):(x.aborted=!0,this._abortTile(x),this._unloadTile(x))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const A in this._tiles)this._removeTile(A);this._cache.reset()}tilesIn(A,x,L){const O=[],y=this.transform;if(!y)return O;const a=L?y.getCameraQueryGeometry(A):A,d=A.map(w=>y.pointCoordinate(w,this.terrain)),_=a.map(w=>y.pointCoordinate(w,this.terrain)),B=this.getIds();let S=1/0,U=1/0,H=-1/0,q=-1/0;for(const w of _)S=Math.min(S,w.x),U=Math.min(U,w.y),H=Math.max(H,w.x),q=Math.max(q,w.y);for(let w=0;w<B.length;w++){const I=this._tiles[B[w]];if(I.holdingForFade())continue;const R=I.tileID,j=Math.pow(2,y.zoom-I.tileID.overscaledZ),Z=x*I.queryPadding*s.N/I.tileSize/j,W=[R.getTilePoint(new s.U(S,U)),R.getTilePoint(new s.U(H,q))];if(W[0].x-Z<s.N&&W[0].y-Z<s.N&&W[1].x+Z>=0&&W[1].y+Z>=0){const Y=d.map(ae=>R.getTilePoint(ae)),ie=_.map(ae=>R.getTilePoint(ae));O.push({tile:I,tileID:R,queryGeometry:Y,cameraQueryGeometry:ie,scale:j})}}return O}getVisibleCoordinates(A){const x=this.getRenderableIds(A).map(L=>this._tiles[L].tileID);for(const L of x)L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped());return x}hasTransition(){if(this._source.hasTransition())return!0;if(di(this._source.type)){const A=s.h.now();for(const x in this._tiles)if(this._tiles[x].fadeEndTime>=A)return!0}return!1}setFeatureState(A,x,L){this._state.updateState(A=A||"_geojsonTileLayer",x,L)}removeFeatureState(A,x,L){this._state.removeFeatureState(A=A||"_geojsonTileLayer",x,L)}getFeatureState(A,x){return this._state.getState(A=A||"_geojsonTileLayer",x)}setDependencies(A,x,L){const O=this._tiles[A];O&&O.setDependencies(x,L)}reloadTilesForDependencies(A,x){for(const L in this._tiles)this._tiles[L].hasDependency(A,x)&&this._reloadTile(L,"reloading");this._cache.filter(L=>!L.hasDependency(A,x))}}function ni(N,A){const x=Math.abs(2*N.wrap)-+(N.wrap<0),L=Math.abs(2*A.wrap)-+(A.wrap<0);return N.overscaledZ-A.overscaledZ||L-x||A.canonical.y-N.canonical.y||A.canonical.x-N.canonical.x}function di(N){return N==="raster"||N==="image"||N==="video"}jt.maxOverzooming=10,jt.maxUnderzooming=3;const li="mapboxgl_preloaded_worker_pool";class Ki{constructor(){this.active={}}acquire(A){if(!this.workers)for(this.workers=[];this.workers.length<Ki.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[A]=!0,this.workers.slice()}release(A){delete this.active[A],this.numActive()===0&&(this.workers.forEach(x=>{x.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[li]}numActive(){return Object.keys(this.active).length}}const tr=Math.floor(s.h.hardwareConcurrency/2);let Ar;function Er(){return Ar||(Ar=new Ki),Ar}Ki.workerCount=s.ac(globalThis)?Math.max(Math.min(tr,3),1):1;class Nt{constructor(A,x){this.reset(A,x)}reset(A,x){this.points=A||[],this._distances=[0];for(let L=1;L<this.points.length;L++)this._distances[L]=this._distances[L-1]+this.points[L].dist(this.points[L-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(x||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(A){if(this.points.length===1)return this.points[0];A=s.ad(A,0,1);let x=1,L=this._distances[x];const O=A*this.paddedLength+this.padding;for(;L<O&&x<this._distances.length;)L=this._distances[++x];const y=x-1,a=this._distances[y],d=L-a,_=d>0?(O-a)/d:0;return this.points[y].mult(1-_).add(this.points[x].mult(_))}}function Ji(N,A){let x=!0;return N==="always"||N!=="never"&&A!=="never"||(x=!1),x}class ci{constructor(A,x,L){const O=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(A/L),this.yCellCount=Math.ceil(x/L);for(let a=0;a<this.xCellCount*this.yCellCount;a++)O.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=A,this.height=x,this.xScale=this.xCellCount/A,this.yScale=this.yCellCount/x,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(A,x,L,O,y){this._forEachCell(x,L,O,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(A),this.bboxes.push(x),this.bboxes.push(L),this.bboxes.push(O),this.bboxes.push(y)}insertCircle(A,x,L,O){this._forEachCell(x-O,L-O,x+O,L+O,this._insertCircleCell,this.circleUid++),this.circleKeys.push(A),this.circles.push(x),this.circles.push(L),this.circles.push(O)}_insertBoxCell(A,x,L,O,y,a){this.boxCells[y].push(a)}_insertCircleCell(A,x,L,O,y,a){this.circleCells[y].push(a)}_query(A,x,L,O,y,a,d){if(L<0||A>this.width||O<0||x>this.height)return[];const _=[];if(A<=0&&x<=0&&this.width<=L&&this.height<=O){if(y)return[{key:null,x1:A,y1:x,x2:L,y2:O}];for(let B=0;B<this.boxKeys.length;B++)_.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const S=this.circles[3*B],U=this.circles[3*B+1],H=this.circles[3*B+2];_.push({key:this.circleKeys[B],x1:S-H,y1:U-H,x2:S+H,y2:U+H})}}else this._forEachCell(A,x,L,O,this._queryCell,_,{hitTest:y,overlapMode:a,seenUids:{box:{},circle:{}}},d);return _}query(A,x,L,O){return this._query(A,x,L,O,!1,null)}hitTest(A,x,L,O,y,a){return this._query(A,x,L,O,!0,y,a).length>0}hitTestCircle(A,x,L,O,y){const a=A-L,d=A+L,_=x-L,B=x+L;if(d<0||a>this.width||B<0||_>this.height)return!1;const S=[];return this._forEachCell(a,_,d,B,this._queryCellCircle,S,{hitTest:!0,overlapMode:O,circle:{x:A,y:x,radius:L},seenUids:{box:{},circle:{}}},y),S.length>0}_queryCell(A,x,L,O,y,a,d,_){const{seenUids:B,hitTest:S,overlapMode:U}=d,H=this.boxCells[y];if(H!==null){const w=this.bboxes;for(const I of H)if(!B.box[I]){B.box[I]=!0;const R=4*I,j=this.boxKeys[I];if(A<=w[R+2]&&x<=w[R+3]&&L>=w[R+0]&&O>=w[R+1]&&(!_||_(j))&&(!S||!Ji(U,j.overlapMode))&&(a.push({key:j,x1:w[R],y1:w[R+1],x2:w[R+2],y2:w[R+3]}),S))return!0}}const q=this.circleCells[y];if(q!==null){const w=this.circles;for(const I of q)if(!B.circle[I]){B.circle[I]=!0;const R=3*I,j=this.circleKeys[I];if(this._circleAndRectCollide(w[R],w[R+1],w[R+2],A,x,L,O)&&(!_||_(j))&&(!S||!Ji(U,j.overlapMode))){const Z=w[R],W=w[R+1],Y=w[R+2];if(a.push({key:j,x1:Z-Y,y1:W-Y,x2:Z+Y,y2:W+Y}),S)return!0}}}return!1}_queryCellCircle(A,x,L,O,y,a,d,_){const{circle:B,seenUids:S,overlapMode:U}=d,H=this.boxCells[y];if(H!==null){const w=this.bboxes;for(const I of H)if(!S.box[I]){S.box[I]=!0;const R=4*I,j=this.boxKeys[I];if(this._circleAndRectCollide(B.x,B.y,B.radius,w[R+0],w[R+1],w[R+2],w[R+3])&&(!_||_(j))&&!Ji(U,j.overlapMode))return a.push(!0),!0}}const q=this.circleCells[y];if(q!==null){const w=this.circles;for(const I of q)if(!S.circle[I]){S.circle[I]=!0;const R=3*I,j=this.circleKeys[I];if(this._circlesCollide(w[R],w[R+1],w[R+2],B.x,B.y,B.radius)&&(!_||_(j))&&!Ji(U,j.overlapMode))return a.push(!0),!0}}}_forEachCell(A,x,L,O,y,a,d,_){const B=this._convertToXCellCoord(A),S=this._convertToYCellCoord(x),U=this._convertToXCellCoord(L),H=this._convertToYCellCoord(O);for(let q=B;q<=U;q++)for(let w=S;w<=H;w++)if(y.call(this,A,x,L,O,this.xCellCount*w+q,a,d,_))return}_convertToXCellCoord(A){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(A*this.xScale)))}_convertToYCellCoord(A){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(A*this.yScale)))}_circlesCollide(A,x,L,O,y,a){const d=O-A,_=y-x,B=L+a;return B*B>d*d+_*_}_circleAndRectCollide(A,x,L,O,y,a,d){const _=(a-O)/2,B=Math.abs(A-(O+_));if(B>_+L)return!1;const S=(d-y)/2,U=Math.abs(x-(y+S));if(U>S+L)return!1;if(B<=_||U<=S)return!0;const H=B-_,q=U-S;return H*H+q*q<=L*L}}function $t(N,A,x,L,O){const y=s.Z();return A?(s.a0(y,y,[1/O,1/O,1]),x||s.ae(y,y,L.angle)):s.a1(y,L.labelPlaneMatrix,N),y}function Zi(N,A,x,L,O){if(A){const y=s.af(N);return s.a0(y,y,[O,O,1]),x||s.ae(y,y,-L.angle),y}return L.glCoordMatrix}function Qt(N,A,x){let L;x?(L=[N.x,N.y,x(N.x,N.y),1],s.ag(L,L,A)):(L=[N.x,N.y,0,1],ve(L,L,A));const O=L[3];return{point:new s.P(L[0]/O,L[1]/O),signedDistanceFromCamera:O}}function Bi(N,A){return .5+N/A*.5}function Ii(N,A){const x=N[0]/N[3],L=N[1]/N[3];return x>=-A[0]&&x<=A[0]&&L>=-A[1]&&L<=A[1]}function Gt(N,A,x,L,O,y,a,d,_,B){const S=L?N.textSizeData:N.iconSizeData,U=s.ah(S,x.transform.zoom),H=[256/x.width*2+1,256/x.height*2+1],q=L?N.text.dynamicLayoutVertexArray:N.icon.dynamicLayoutVertexArray;q.clear();const w=N.lineVertexArray,I=L?N.text.placedSymbolArray:N.icon.placedSymbolArray,R=x.transform.width/x.transform.height;let j=!1;for(let Z=0;Z<I.length;Z++){const W=I.get(Z);if(W.hidden||W.writingMode===s.ai.vertical&&!j){ge(W.numGlyphs,q);continue}let Y;if(j=!1,B?(Y=[W.anchorX,W.anchorY,B(W.anchorX,W.anchorY),1],s.ag(Y,Y,A)):(Y=[W.anchorX,W.anchorY,0,1],ve(Y,Y,A)),!Ii(Y,H)){ge(W.numGlyphs,q);continue}const ie=Bi(x.transform.cameraToCenterDistance,Y[3]),ae=s.aj(S,U,W),fe=a?ae/ie:ae*ie,pe=new s.P(W.anchorX,W.anchorY),xe=Qt(pe,O,B).point,Fe={projections:{},offsets:{}},Le=mr(W,fe,!1,d,A,O,y,N.glyphOffsetArray,w,q,xe,pe,Fe,R,_,B);j=Le.useVertical,(Le.notEnoughRoom||j||Le.needsFlipping&&mr(W,fe,!0,d,A,O,y,N.glyphOffsetArray,w,q,xe,pe,Fe,R,_,B).notEnoughRoom)&&ge(W.numGlyphs,q)}L?N.text.dynamicLayoutVertexBuffer.updateData(q):N.icon.dynamicLayoutVertexBuffer.updateData(q)}function vi(N,A,x,L,O,y,a,d,_,B,S,U,H){const q=d.glyphStartIndex+d.numGlyphs,w=d.lineStartIndex,I=d.lineStartIndex+d.lineLength,R=A.getoffsetX(d.glyphStartIndex),j=A.getoffsetX(q-1),Z=ee(N*R,x,L,O,y,a,d.segment,w,I,_,B,S,U,H);if(!Z)return null;const W=ee(N*j,x,L,O,y,a,d.segment,w,I,_,B,S,U,H);return W?{first:Z,last:W}:null}function Jt(N,A,x,L){return N===s.ai.horizontal&&Math.abs(x.y-A.y)>Math.abs(x.x-A.x)*L?{useVertical:!0}:(N===s.ai.vertical?A.y<x.y:A.x>x.x)?{needsFlipping:!0}:null}function mr(N,A,x,L,O,y,a,d,_,B,S,U,H,q,w,I){const R=A/24,j=N.lineOffsetX*R,Z=N.lineOffsetY*R;let W;if(N.numGlyphs>1){const Y=N.glyphStartIndex+N.numGlyphs,ie=N.lineStartIndex,ae=N.lineStartIndex+N.lineLength,fe=vi(R,d,j,Z,x,S,U,N,_,y,H,w,I);if(!fe)return{notEnoughRoom:!0};const pe=Qt(fe.first.point,a,I).point,xe=Qt(fe.last.point,a,I).point;if(L&&!x){const Fe=Jt(N.writingMode,pe,xe,q);if(Fe)return Fe}W=[fe.first];for(let Fe=N.glyphStartIndex+1;Fe<Y-1;Fe++)W.push(ee(R*d.getoffsetX(Fe),j,Z,x,S,U,N.segment,ie,ae,_,y,H,w,I));W.push(fe.last)}else{if(L&&!x){const ie=Qt(U,O,I).point,ae=N.lineStartIndex+N.segment+1,fe=new s.P(_.getx(ae),_.gety(ae)),pe=Qt(fe,O,I),xe=pe.signedDistanceFromCamera>0?pe.point:Sr(U,fe,ie,1,O,I),Fe=Jt(N.writingMode,ie,xe,q);if(Fe)return Fe}const Y=ee(R*d.getoffsetX(N.glyphStartIndex),j,Z,x,S,U,N.segment,N.lineStartIndex,N.lineStartIndex+N.lineLength,_,y,H,w,I);if(!Y)return{notEnoughRoom:!0};W=[Y]}for(const Y of W)s.ak(B,Y.point,Y.angle);return{}}function Sr(N,A,x,L,O,y){const a=Qt(N.add(N.sub(A)._unit()),O,y).point,d=x.sub(a);return x.add(d._mult(L/d.mag()))}function ze(N,A){const{projectionCache:x,lineVertexArray:L,labelPlaneMatrix:O,tileAnchorPoint:y,distanceFromAnchor:a,getElevation:d,previousVertex:_,direction:B,absOffsetX:S}=A;if(x.projections[N])return x.projections[N];const U=new s.P(L.getx(N),L.gety(N)),H=Qt(U,O,d);if(H.signedDistanceFromCamera>0)return x.projections[N]=H.point,H.point;const q=N-B;return Sr(a===0?y:new s.P(L.getx(q),L.gety(q)),U,_,S-a+1,O,d)}function we(N,A,x){return N._unit()._perp()._mult(A*x)}function oe(N,A,x,L,O,y,a,d){const{projectionCache:_,direction:B}=d;if(_.offsets[N])return _.offsets[N];const S=x.add(A);if(N+B<L||N+B>=O)return _.offsets[N]=S,S;const U=ze(N+B,d),H=we(U.sub(x),a,B),q=x.add(H),w=U.add(H);return _.offsets[N]=s.al(y,S,q,w)||S,_.offsets[N]}function ee(N,A,x,L,O,y,a,d,_,B,S,U,H,q){const w=L?N-A:N+A;let I=w>0?1:-1,R=0;L&&(I*=-1,R=Math.PI),I<0&&(R+=Math.PI);let j,Z,W=I>0?d+a:d+a+1,Y=O,ie=O,ae=0,fe=0;const pe=Math.abs(w),xe=[];let Fe;for(;ae+fe<=pe;){if(W+=I,W<d||W>=_)return null;ae+=fe,ie=Y,Z=j;const Ke={projectionCache:U,lineVertexArray:B,labelPlaneMatrix:S,tileAnchorPoint:y,distanceFromAnchor:ae,getElevation:q,previousVertex:ie,direction:I,absOffsetX:pe};if(Y=ze(W,Ke),x===0)xe.push(ie),Fe=Y.sub(ie);else{let Re;const Qe=Y.sub(ie);Re=Qe.mag()===0?we(ze(W+I,Ke).sub(Y),x,I):we(Qe,x,I),Z||(Z=ie.add(Re)),j=oe(W,Re,Y,d,_,Z,x,Ke),xe.push(Z),Fe=j.sub(Z)}fe=Fe.mag()}const Le=Fe._mult((pe-ae)/fe)._add(Z||ie),nt=R+Math.atan2(Y.y-ie.y,Y.x-ie.x);return xe.push(Le),{point:Le,angle:H?nt:0,path:xe}}const le=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ge(N,A){for(let x=0;x<N;x++){const L=A.length;A.resize(L+4),A.float32.set(le,3*L)}}function ve(N,A,x){const L=A[0],O=A[1];return N[0]=x[0]*L+x[4]*O+x[12],N[1]=x[1]*L+x[5]*O+x[13],N[3]=x[3]*L+x[7]*O+x[15],N}const Ce=100;class be{constructor(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new ci(A.width+200,A.height+200,25),L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new ci(A.width+200,A.height+200,25);this.transform=A,this.grid=x,this.ignoredGrid=L,this.pitchfactor=Math.cos(A._pitch)*A.cameraToCenterDistance,this.screenRightBoundary=A.width+Ce,this.screenBottomBoundary=A.height+Ce,this.gridRightBoundary=A.width+200,this.gridBottomBoundary=A.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(A,x,L,O,y,a){const d=this.projectAndGetPerspectiveRatio(O,A.anchorPointX,A.anchorPointY,a),_=L*d.perspectiveRatio,B=A.x1*_+d.point.x,S=A.y1*_+d.point.y,U=A.x2*_+d.point.x,H=A.y2*_+d.point.y;return!this.isInsideGrid(B,S,U,H)||x!=="always"&&this.grid.hitTest(B,S,U,H,x,y)||d.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[B,S,U,H],offscreen:this.isOffscreen(B,S,U,H)}}placeCollisionCircles(A,x,L,O,y,a,d,_,B,S,U,H,q,w){const I=[],R=new s.P(x.anchorX,x.anchorY),j=Qt(R,a,w),Z=Bi(this.transform.cameraToCenterDistance,j.signedDistanceFromCamera),W=(S?y/Z:y*Z)/s.ap,Y=Qt(R,d,w).point,ie=vi(W,O,x.lineOffsetX*W,x.lineOffsetY*W,!1,Y,R,x,L,d,{projections:{},offsets:{}},!1,w);let ae=!1,fe=!1,pe=!0;if(ie){const xe=.5*H*Z+q,Fe=new s.P(-100,-100),Le=new s.P(this.screenRightBoundary,this.screenBottomBoundary),nt=new Nt,Ke=ie.first,Re=ie.last;let Qe=[];for(let ht=Ke.path.length-1;ht>=1;ht--)Qe.push(Ke.path[ht]);for(let ht=1;ht<Re.path.length;ht++)Qe.push(Re.path[ht]);const pt=2.5*xe;if(_){const ht=Qe.map(Rt=>Qt(Rt,_,w));Qe=ht.some(Rt=>Rt.signedDistanceFromCamera<=0)?[]:ht.map(Rt=>Rt.point)}let bt=[];if(Qe.length>0){const ht=Qe[0].clone(),Rt=Qe[0].clone();for(let Dt=1;Dt<Qe.length;Dt++)ht.x=Math.min(ht.x,Qe[Dt].x),ht.y=Math.min(ht.y,Qe[Dt].y),Rt.x=Math.max(Rt.x,Qe[Dt].x),Rt.y=Math.max(Rt.y,Qe[Dt].y);bt=ht.x>=Fe.x&&Rt.x<=Le.x&&ht.y>=Fe.y&&Rt.y<=Le.y?[Qe]:Rt.x<Fe.x||ht.x>Le.x||Rt.y<Fe.y||ht.y>Le.y?[]:s.am([Qe],Fe.x,Fe.y,Le.x,Le.y)}for(const ht of bt){nt.reset(ht,.25*xe);let Rt=0;Rt=nt.length<=.5*xe?1:Math.ceil(nt.paddedLength/pt)+1;for(let Dt=0;Dt<Rt;Dt++){const hi=Dt/Math.max(Rt-1,1),Vt=nt.lerp(hi),_i=Vt.x+Ce,Si=Vt.y+Ce;I.push(_i,Si,xe,0);const Yi=_i-xe,Ti=Si-xe,yr=_i+xe,fr=Si+xe;if(pe=pe&&this.isOffscreen(Yi,Ti,yr,fr),fe=fe||this.isInsideGrid(Yi,Ti,yr,fr),A!=="always"&&this.grid.hitTestCircle(_i,Si,xe,A,U)&&(ae=!0,!B))return{circles:[],offscreen:!1,collisionDetected:ae}}}}return{circles:!B&&ae||!fe||Z<this.perspectiveRatioCutoff?[]:I,offscreen:pe,collisionDetected:ae}}queryRenderedSymbols(A){if(A.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const x=[];let L=1/0,O=1/0,y=-1/0,a=-1/0;for(const S of A){const U=new s.P(S.x+Ce,S.y+Ce);L=Math.min(L,U.x),O=Math.min(O,U.y),y=Math.max(y,U.x),a=Math.max(a,U.y),x.push(U)}const d=this.grid.query(L,O,y,a).concat(this.ignoredGrid.query(L,O,y,a)),_={},B={};for(const S of d){const U=S.key;if(_[U.bucketInstanceId]===void 0&&(_[U.bucketInstanceId]={}),_[U.bucketInstanceId][U.featureIndex])continue;const H=[new s.P(S.x1,S.y1),new s.P(S.x2,S.y1),new s.P(S.x2,S.y2),new s.P(S.x1,S.y2)];s.an(x,H)&&(_[U.bucketInstanceId][U.featureIndex]=!0,B[U.bucketInstanceId]===void 0&&(B[U.bucketInstanceId]=[]),B[U.bucketInstanceId].push(U.featureIndex))}return B}insertCollisionBox(A,x,L,O,y,a){(L?this.ignoredGrid:this.grid).insert({bucketInstanceId:O,featureIndex:y,collisionGroupID:a,overlapMode:x},A[0],A[1],A[2],A[3])}insertCollisionCircles(A,x,L,O,y,a){const d=L?this.ignoredGrid:this.grid,_={bucketInstanceId:O,featureIndex:y,collisionGroupID:a,overlapMode:x};for(let B=0;B<A.length;B+=4)d.insertCircle(_,A[B],A[B+1],A[B+2])}projectAndGetPerspectiveRatio(A,x,L,O){let y;return O?(y=[x,L,O(x,L),1],s.ag(y,y,A)):(y=[x,L,0,1],ve(y,y,A)),{point:new s.P((y[0]/y[3]+1)/2*this.transform.width+Ce,(-y[1]/y[3]+1)/2*this.transform.height+Ce),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}}isOffscreen(A,x,L,O){return L<Ce||A>=this.screenRightBoundary||O<Ce||x>this.screenBottomBoundary}isInsideGrid(A,x,L,O){return L>=0&&A<this.gridRightBoundary&&O>=0&&x<this.gridBottomBoundary}getViewportMatrix(){const A=s.ao([]);return s.$(A,A,[-100,-100,0]),A}}function Pe(N,A,x){return A*(s.N/(N.tileSize*Math.pow(2,x-N.tileID.overscaledZ)))}class Oe{constructor(A,x,L,O){this.opacity=A?Math.max(0,Math.min(1,A.opacity+(A.placed?x:-x))):O&&L?1:0,this.placed=L}isHidden(){return this.opacity===0&&!this.placed}}class Ge{constructor(A,x,L,O,y){this.text=new Oe(A?A.text:null,x,L,y),this.icon=new Oe(A?A.icon:null,x,O,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class rt{constructor(A,x,L){this.text=A,this.icon=x,this.skipFade=L}}class yt{constructor(){this.invProjMatrix=s.Z(),this.viewportMatrix=s.Z(),this.circles=[]}}class Et{constructor(A,x,L,O,y){this.bucketInstanceId=A,this.featureIndex=x,this.sourceLayerIndex=L,this.bucketIndex=O,this.tileID=y}}class Yt{constructor(A){this.crossSourceCollisions=A,this.maxGroupID=0,this.collisionGroups={}}get(A){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[A]){const x=++this.maxGroupID;this.collisionGroups[A]={ID:x,predicate:L=>L.collisionGroupID===x}}return this.collisionGroups[A]}}function qt(N,A,x,L,O){const{horizontalAlign:y,verticalAlign:a}=s.au(N);return new s.P(-(y-.5)*A+L[0]*O,-(a-.5)*x+L[1]*O)}function Kt(N,A,x,L,O,y){const{x1:a,x2:d,y1:_,y2:B,anchorPointX:S,anchorPointY:U}=N,H=new s.P(A,x);return L&&H._rotate(O?y:-y),{x1:a+H.x,y1:_+H.y,x2:d+H.x,y2:B+H.y,anchorPointX:S,anchorPointY:U}}class si{constructor(A,x,L,O,y){this.transform=A.clone(),this.terrain=x,this.collisionIndex=new be(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=L,this.retainedQueryData={},this.collisionGroups=new Yt(O),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(A,x,L,O){const y=L.getBucket(x),a=L.latestFeatureIndex;if(!y||!a||x.id!==y.layerIds[0])return;const d=L.collisionBoxArray,_=y.layers[0].layout,B=Math.pow(2,this.transform.zoom-L.tileID.overscaledZ),S=L.tileSize/s.N,U=this.transform.calculatePosMatrix(L.tileID.toUnwrapped()),H=_.get("text-pitch-alignment")==="map",q=_.get("text-rotation-alignment")==="map",w=Pe(L,1,this.transform.zoom),I=$t(U,H,q,this.transform,w);let R=null;if(H){const Z=Zi(U,H,q,this.transform,w);R=s.a1([],this.transform.labelPlaneMatrix,Z)}this.retainedQueryData[y.bucketInstanceId]=new Et(y.bucketInstanceId,a,y.sourceLayerIndex,y.index,L.tileID);const j={bucket:y,layout:_,posMatrix:U,textLabelPlaneMatrix:I,labelToScreenMatrix:R,scale:B,textPixelRatio:S,holdingForFade:L.holdingForFade(),collisionBoxArray:d,partiallyEvaluatedTextSize:s.ah(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(O)for(const Z of y.sortKeyRanges){const{sortKey:W,symbolInstanceStart:Y,symbolInstanceEnd:ie}=Z;A.push({sortKey:W,symbolInstanceStart:Y,symbolInstanceEnd:ie,parameters:j})}else A.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:j})}attemptAnchorPlacement(A,x,L,O,y,a,d,_,B,S,U,H,q,w,I,R){const j=s.aq[A.textAnchor],Z=[A.textOffset0,A.textOffset1],W=qt(j,L,O,Z,y),Y=this.collisionIndex.placeCollisionBox(Kt(x,W.x,W.y,a,d,this.transform.angle),U,_,B,S.predicate,R);if((!I||this.collisionIndex.placeCollisionBox(Kt(I,W.x,W.y,a,d,this.transform.angle),U,_,B,S.predicate,R).box.length!==0)&&Y.box.length>0){let ie;if(this.prevPlacement&&this.prevPlacement.variableOffsets[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID]&&this.prevPlacement.placements[H.crossTileID].text&&(ie=this.prevPlacement.variableOffsets[H.crossTileID].anchor),H.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[H.crossTileID]={textOffset:Z,width:L,height:O,anchor:j,textBoxScale:y,prevAnchor:ie},this.markUsedJustification(q,j,H,w),q.allowVerticalPlacement&&(this.markUsedOrientation(q,w,H),this.placedOrientations[H.crossTileID]=w),{shift:W,placedGlyphBoxes:Y}}}placeLayerBucketPart(A,x,L){const{bucket:O,layout:y,posMatrix:a,textLabelPlaneMatrix:d,labelToScreenMatrix:_,textPixelRatio:B,holdingForFade:S,collisionBoxArray:U,partiallyEvaluatedTextSize:H,collisionGroup:q}=A.parameters,w=y.get("text-optional"),I=y.get("icon-optional"),R=s.ar(y,"text-overlap","text-allow-overlap"),j=R==="always",Z=s.ar(y,"icon-overlap","icon-allow-overlap"),W=Z==="always",Y=y.get("text-rotation-alignment")==="map",ie=y.get("text-pitch-alignment")==="map",ae=y.get("icon-text-fit")!=="none",fe=y.get("symbol-z-order")==="viewport-y",pe=j&&(W||!O.hasIconData()||I),xe=W&&(j||!O.hasTextData()||w);!O.collisionArrays&&U&&O.deserializeCollisionBoxes(U);const Fe=this.retainedQueryData[O.bucketInstanceId].tileID,Le=this.terrain?(Ke,Re)=>this.terrain.getElevation(Fe,Ke,Re):null,nt=(Ke,Re)=>{var Qe,pt;if(x[Ke.crossTileID])return;if(S)return void(this.placements[Ke.crossTileID]=new rt(!1,!1,!1));let bt=!1,ht=!1,Rt=!0,Dt=null,hi={box:null,offscreen:null},Vt={box:null,offscreen:null},_i=null,Si=null,Yi=null,Ti=0,yr=0,fr=0;Re.textFeatureIndex?Ti=Re.textFeatureIndex:Ke.useRuntimeCollisionCircles&&(Ti=Ke.featureIndex),Re.verticalTextFeatureIndex&&(yr=Re.verticalTextFeatureIndex);const ji=Re.textBox;if(ji){const Mr=Nr=>{let pr=s.ai.horizontal;if(O.allowVerticalPlacement&&!Nr&&this.prevPlacement){const _r=this.prevPlacement.placedOrientations[Ke.crossTileID];_r&&(this.placedOrientations[Ke.crossTileID]=_r,pr=_r,this.markUsedOrientation(O,pr,Ke))}return pr},Kr=(Nr,pr)=>{if(O.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&Re.verticalTextBox){for(const _r of O.writingModes)if(_r===s.ai.vertical?(hi=pr(),Vt=hi):hi=Nr(),hi&&hi.box&&hi.box.length)break}else hi=Nr()},Cr=Ke.textAnchorOffsetStartIndex,ts=Ke.textAnchorOffsetEndIndex;if(ts===Cr){const Nr=(pr,_r)=>{const or=this.collisionIndex.placeCollisionBox(pr,R,B,a,q.predicate,Le);return or&&or.box&&or.box.length&&(this.markUsedOrientation(O,_r,Ke),this.placedOrientations[Ke.crossTileID]=_r),or};Kr(()=>Nr(ji,s.ai.horizontal),()=>{const pr=Re.verticalTextBox;return O.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&pr?Nr(pr,s.ai.vertical):{box:null,offscreen:null}}),Mr(hi&&hi.box&&hi.box.length)}else{let Nr=s.aq[(pt=(Qe=this.prevPlacement)===null||Qe===void 0?void 0:Qe.variableOffsets[Ke.crossTileID])===null||pt===void 0?void 0:pt.anchor];const pr=(or,ln,qr)=>{const Wr=or.x2-or.x1,Mn=or.y2-or.y1,Kn=Ke.textBoxScale,_l=ae&&Z==="never"?ln:null;let $r={box:[],offscreen:!1},_n=R==="never"?1:2,ea="never";Nr&&_n++;for(let Os=0;Os<_n;Os++){for(let Ws=Cr;Ws<ts;Ws++){const Oo=O.textAnchorOffsets.get(Ws);if(Nr&&Oo.textAnchor!==Nr)continue;const oo=this.attemptAnchorPlacement(Oo,or,Wr,Mn,Kn,Y,ie,B,a,q,ea,Ke,O,qr,_l,Le);if(oo&&($r=oo.placedGlyphBoxes,$r&&$r.box&&$r.box.length))return bt=!0,Dt=oo.shift,$r}Nr?Nr=null:ea=R}return $r};Kr(()=>pr(ji,Re.iconBox,s.ai.horizontal),()=>{const or=Re.verticalTextBox;return O.allowVerticalPlacement&&!(hi&&hi.box&&hi.box.length)&&Ke.numVerticalGlyphVertices>0&&or?pr(or,Re.verticalIconBox,s.ai.vertical):{box:null,offscreen:null}}),hi&&(bt=hi.box,Rt=hi.offscreen);const _r=Mr(hi&&hi.box);if(!bt&&this.prevPlacement){const or=this.prevPlacement.variableOffsets[Ke.crossTileID];or&&(this.variableOffsets[Ke.crossTileID]=or,this.markUsedJustification(O,or.anchor,Ke,_r))}}}if(_i=hi,bt=_i&&_i.box&&_i.box.length>0,Rt=_i&&_i.offscreen,Ke.useRuntimeCollisionCircles){const Mr=O.text.placedSymbolArray.get(Ke.centerJustifiedTextSymbolIndex),Kr=s.aj(O.textSizeData,H,Mr),Cr=y.get("text-padding");Si=this.collisionIndex.placeCollisionCircles(R,Mr,O.lineVertexArray,O.glyphOffsetArray,Kr,a,d,_,L,ie,q.predicate,Ke.collisionCircleDiameter,Cr,Le),Si.circles.length&&Si.collisionDetected&&!L&&s.w("Collisions detected, but collision boxes are not shown"),bt=j||Si.circles.length>0&&!Si.collisionDetected,Rt=Rt&&Si.offscreen}if(Re.iconFeatureIndex&&(fr=Re.iconFeatureIndex),Re.iconBox){const Mr=Kr=>{const Cr=ae&&Dt?Kt(Kr,Dt.x,Dt.y,Y,ie,this.transform.angle):Kr;return this.collisionIndex.placeCollisionBox(Cr,Z,B,a,q.predicate,Le)};Vt&&Vt.box&&Vt.box.length&&Re.verticalIconBox?(Yi=Mr(Re.verticalIconBox),ht=Yi.box.length>0):(Yi=Mr(Re.iconBox),ht=Yi.box.length>0),Rt=Rt&&Yi.offscreen}const Ur=w||Ke.numHorizontalGlyphVertices===0&&Ke.numVerticalGlyphVertices===0,rn=I||Ke.numIconVertices===0;if(Ur||rn?rn?Ur||(ht=ht&&bt):bt=ht&&bt:ht=bt=ht&&bt,bt&&_i&&_i.box&&this.collisionIndex.insertCollisionBox(_i.box,R,y.get("text-ignore-placement"),O.bucketInstanceId,Vt&&Vt.box&&yr?yr:Ti,q.ID),ht&&Yi&&this.collisionIndex.insertCollisionBox(Yi.box,Z,y.get("icon-ignore-placement"),O.bucketInstanceId,fr,q.ID),Si&&(bt&&this.collisionIndex.insertCollisionCircles(Si.circles,R,y.get("text-ignore-placement"),O.bucketInstanceId,Ti,q.ID),L)){const Mr=O.bucketInstanceId;let Kr=this.collisionCircleArrays[Mr];Kr===void 0&&(Kr=this.collisionCircleArrays[Mr]=new yt);for(let Cr=0;Cr<Si.circles.length;Cr+=4)Kr.circles.push(Si.circles[Cr+0]),Kr.circles.push(Si.circles[Cr+1]),Kr.circles.push(Si.circles[Cr+2]),Kr.circles.push(Si.collisionDetected?1:0)}if(Ke.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(O.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ke.crossTileID]=new rt(bt||pe,ht||xe,Rt||O.justReloaded),x[Ke.crossTileID]=!0};if(fe){if(A.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ke=O.getSortedSymbolIndexes(this.transform.angle);for(let Re=Ke.length-1;Re>=0;--Re){const Qe=Ke[Re];nt(O.symbolInstances.get(Qe),O.collisionArrays[Qe])}}else for(let Ke=A.symbolInstanceStart;Ke<A.symbolInstanceEnd;Ke++)nt(O.symbolInstances.get(Ke),O.collisionArrays[Ke]);if(L&&O.bucketInstanceId in this.collisionCircleArrays){const Ke=this.collisionCircleArrays[O.bucketInstanceId];s.as(Ke.invProjMatrix,a),Ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}O.justReloaded=!1}markUsedJustification(A,x,L,O){let y;y=O===s.ai.vertical?L.verticalPlacedTextSymbolIndex:{left:L.leftJustifiedTextSymbolIndex,center:L.centerJustifiedTextSymbolIndex,right:L.rightJustifiedTextSymbolIndex}[s.at(x)];const a=[L.leftJustifiedTextSymbolIndex,L.centerJustifiedTextSymbolIndex,L.rightJustifiedTextSymbolIndex,L.verticalPlacedTextSymbolIndex];for(const d of a)d>=0&&(A.text.placedSymbolArray.get(d).crossTileID=y>=0&&d!==y?0:L.crossTileID)}markUsedOrientation(A,x,L){const O=x===s.ai.horizontal||x===s.ai.horizontalOnly?x:0,y=x===s.ai.vertical?x:0,a=[L.leftJustifiedTextSymbolIndex,L.centerJustifiedTextSymbolIndex,L.rightJustifiedTextSymbolIndex];for(const d of a)A.text.placedSymbolArray.get(d).placedOrientation=O;L.verticalPlacedTextSymbolIndex&&(A.text.placedSymbolArray.get(L.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(A){this.commitTime=A,this.zoomAtLastRecencyCheck=this.transform.zoom;const x=this.prevPlacement;let L=!1;this.prevZoomAdjustment=x?x.zoomAdjustment(this.transform.zoom):0;const O=x?x.symbolFadeChange(A):1,y=x?x.opacities:{},a=x?x.variableOffsets:{},d=x?x.placedOrientations:{};for(const _ in this.placements){const B=this.placements[_],S=y[_];S?(this.opacities[_]=new Ge(S,O,B.text,B.icon),L=L||B.text!==S.text.placed||B.icon!==S.icon.placed):(this.opacities[_]=new Ge(null,O,B.text,B.icon,B.skipFade),L=L||B.text||B.icon)}for(const _ in y){const B=y[_];if(!this.opacities[_]){const S=new Ge(B,O,!1,!1);S.isHidden()||(this.opacities[_]=S,L=L||B.text.placed||B.icon.placed)}}for(const _ in a)this.variableOffsets[_]||!this.opacities[_]||this.opacities[_].isHidden()||(this.variableOffsets[_]=a[_]);for(const _ in d)this.placedOrientations[_]||!this.opacities[_]||this.opacities[_].isHidden()||(this.placedOrientations[_]=d[_]);if(x&&x.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");L?this.lastPlacementChangeTime=A:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=x?x.lastPlacementChangeTime:A)}updateLayerOpacities(A,x){const L={};for(const O of x){const y=O.getBucket(A);y&&O.latestFeatureIndex&&A.id===y.layerIds[0]&&this.updateBucketOpacities(y,L,O.collisionBoxArray)}}updateBucketOpacities(A,x,L){A.hasTextData()&&(A.text.opacityVertexArray.clear(),A.text.hasVisibleVertices=!1),A.hasIconData()&&(A.icon.opacityVertexArray.clear(),A.icon.hasVisibleVertices=!1),A.hasIconCollisionBoxData()&&A.iconCollisionBox.collisionVertexArray.clear(),A.hasTextCollisionBoxData()&&A.textCollisionBox.collisionVertexArray.clear();const O=A.layers[0],y=O.layout,a=new Ge(null,0,!1,!1,!0),d=y.get("text-allow-overlap"),_=y.get("icon-allow-overlap"),B=O._unevaluatedLayout.hasValue("text-variable-anchor")||O._unevaluatedLayout.hasValue("text-variable-anchor-offset"),S=y.get("text-rotation-alignment")==="map",U=y.get("text-pitch-alignment")==="map",H=y.get("icon-text-fit")!=="none",q=new Ge(null,0,d&&(_||!A.hasIconData()||y.get("icon-optional")),_&&(d||!A.hasTextData()||y.get("text-optional")),!0);!A.collisionArrays&&L&&(A.hasIconCollisionBoxData()||A.hasTextCollisionBoxData())&&A.deserializeCollisionBoxes(L);const w=(I,R,j)=>{for(let Z=0;Z<R/4;Z++)I.opacityVertexArray.emplaceBack(j);I.hasVisibleVertices=I.hasVisibleVertices||j!==sn};for(let I=0;I<A.symbolInstances.length;I++){const R=A.symbolInstances.get(I),{numHorizontalGlyphVertices:j,numVerticalGlyphVertices:Z,crossTileID:W}=R;let Y=this.opacities[W];x[W]?Y=a:Y||(Y=q,this.opacities[W]=Y),x[W]=!0;const ie=R.numIconVertices>0,ae=this.placedOrientations[R.crossTileID],fe=ae===s.ai.vertical,pe=ae===s.ai.horizontal||ae===s.ai.horizontalOnly;if(j>0||Z>0){const xe=hr(Y.text);w(A.text,j,fe?sn:xe),w(A.text,Z,pe?sn:xe);const Fe=Y.text.isHidden();[R.rightJustifiedTextSymbolIndex,R.centerJustifiedTextSymbolIndex,R.leftJustifiedTextSymbolIndex].forEach(Ke=>{Ke>=0&&(A.text.placedSymbolArray.get(Ke).hidden=Fe||fe?1:0)}),R.verticalPlacedTextSymbolIndex>=0&&(A.text.placedSymbolArray.get(R.verticalPlacedTextSymbolIndex).hidden=Fe||pe?1:0);const Le=this.variableOffsets[R.crossTileID];Le&&this.markUsedJustification(A,Le.anchor,R,ae);const nt=this.placedOrientations[R.crossTileID];nt&&(this.markUsedJustification(A,"left",R,nt),this.markUsedOrientation(A,nt,R))}if(ie){const xe=hr(Y.icon),Fe=!(H&&R.verticalPlacedIconSymbolIndex&&fe);R.placedIconSymbolIndex>=0&&(w(A.icon,R.numIconVertices,Fe?xe:sn),A.icon.placedSymbolArray.get(R.placedIconSymbolIndex).hidden=Y.icon.isHidden()),R.verticalPlacedIconSymbolIndex>=0&&(w(A.icon,R.numVerticalIconVertices,Fe?sn:xe),A.icon.placedSymbolArray.get(R.verticalPlacedIconSymbolIndex).hidden=Y.icon.isHidden())}if(A.hasIconCollisionBoxData()||A.hasTextCollisionBoxData()){const xe=A.collisionArrays[I];if(xe){let Fe=new s.P(0,0);if(xe.textBox||xe.verticalTextBox){let nt=!0;if(B){const Ke=this.variableOffsets[W];Ke?(Fe=qt(Ke.anchor,Ke.width,Ke.height,Ke.textOffset,Ke.textBoxScale),S&&Fe._rotate(U?this.transform.angle:-this.transform.angle)):nt=!1}xe.textBox&&Ci(A.textCollisionBox.collisionVertexArray,Y.text.placed,!nt||fe,Fe.x,Fe.y),xe.verticalTextBox&&Ci(A.textCollisionBox.collisionVertexArray,Y.text.placed,!nt||pe,Fe.x,Fe.y)}const Le=!!(!pe&&xe.verticalIconBox);xe.iconBox&&Ci(A.iconCollisionBox.collisionVertexArray,Y.icon.placed,Le,H?Fe.x:0,H?Fe.y:0),xe.verticalIconBox&&Ci(A.iconCollisionBox.collisionVertexArray,Y.icon.placed,!Le,H?Fe.x:0,H?Fe.y:0)}}}if(A.sortFeatures(this.transform.angle),this.retainedQueryData[A.bucketInstanceId]&&(this.retainedQueryData[A.bucketInstanceId].featureSortOrder=A.featureSortOrder),A.hasTextData()&&A.text.opacityVertexBuffer&&A.text.opacityVertexBuffer.updateData(A.text.opacityVertexArray),A.hasIconData()&&A.icon.opacityVertexBuffer&&A.icon.opacityVertexBuffer.updateData(A.icon.opacityVertexArray),A.hasIconCollisionBoxData()&&A.iconCollisionBox.collisionVertexBuffer&&A.iconCollisionBox.collisionVertexBuffer.updateData(A.iconCollisionBox.collisionVertexArray),A.hasTextCollisionBoxData()&&A.textCollisionBox.collisionVertexBuffer&&A.textCollisionBox.collisionVertexBuffer.updateData(A.textCollisionBox.collisionVertexArray),A.text.opacityVertexArray.length!==A.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${A.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${A.text.layoutVertexArray.length}) / 4`);if(A.icon.opacityVertexArray.length!==A.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${A.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${A.icon.layoutVertexArray.length}) / 4`);if(A.bucketInstanceId in this.collisionCircleArrays){const I=this.collisionCircleArrays[A.bucketInstanceId];A.placementInvProjMatrix=I.invProjMatrix,A.placementViewportMatrix=I.viewportMatrix,A.collisionCircleArray=I.circles,delete this.collisionCircleArrays[A.bucketInstanceId]}}symbolFadeChange(A){return this.fadeDuration===0?1:(A-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(A){return Math.max(0,(this.transform.zoom-A)/1.5)}hasTransitions(A){return this.stale||A-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(A,x){const L=this.zoomAtLastRecencyCheck===x?1-this.zoomAdjustment(x):1;return this.zoomAtLastRecencyCheck=x,this.commitTime+this.fadeDuration*L>A}setStale(){this.stale=!0}}function Ci(N,A,x,L,O){N.emplaceBack(A?1:0,x?1:0,L||0,O||0),N.emplaceBack(A?1:0,x?1:0,L||0,O||0),N.emplaceBack(A?1:0,x?1:0,L||0,O||0),N.emplaceBack(A?1:0,x?1:0,L||0,O||0)}const Hi=Math.pow(2,25),wi=Math.pow(2,24),Ui=Math.pow(2,17),st=Math.pow(2,16),ti=Math.pow(2,9),zt=Math.pow(2,8),zi=Math.pow(2,1);function hr(N){if(N.opacity===0&&!N.placed)return 0;if(N.opacity===1&&N.placed)return 4294967295;const A=N.placed?1:0,x=Math.floor(127*N.opacity);return x*Hi+A*wi+x*Ui+A*st+x*ti+A*zt+x*zi+A}const sn=0;class bn{constructor(A){this._sortAcrossTiles=A.layout.get("symbol-z-order")!=="viewport-y"&&!A.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(A,x,L,O,y){const a=this._bucketParts;for(;this._currentTileIndex<A.length;)if(x.getBucketParts(a,O,A[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((d,_)=>d.sortKey-_.sortKey));this._currentPartIndex<a.length;)if(x.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,L),this._currentPartIndex++,y())return!0;return!1}}class ur{constructor(A,x,L,O,y,a,d,_){this.placement=new si(A,x,a,d,_),this._currentPlacementIndex=L.length-1,this._forceFullPlacement=O,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(A,x,L){const O=s.h.now(),y=()=>!this._forceFullPlacement&&s.h.now()-O>2;for(;this._currentPlacementIndex>=0;){const a=x[A[this._currentPlacementIndex]],d=this.placement.collisionIndex.transform.zoom;if(a.type==="symbol"&&(!a.minzoom||a.minzoom<=d)&&(!a.maxzoom||a.maxzoom>d)){if(this._inProgressLayer||(this._inProgressLayer=new bn(a)),this._inProgressLayer.continuePlacement(L[a.source],this.placement,this._showCollisionBoxes,a,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(A){return this.placement.commit(A),this.placement}}const gn=512/s.N/2;class mn{constructor(A,x,L){this.tileID=A,this.bucketInstanceId=L,this._symbolsByKey={};const O=new Map;for(let y=0;y<x.length;y++){const a=x.get(y),d=a.key,_=O.get(d);_?_.push(a):O.set(d,[a])}for(const[y,a]of O){const d={positions:a.map(_=>({x:Math.floor(_.anchorX*gn),y:Math.floor(_.anchorY*gn)})),crossTileIDs:a.map(_=>_.crossTileID)};if(d.positions.length>128){const _=new s.av(d.positions.length,16,Uint16Array);for(const{x:B,y:S}of d.positions)_.add(B,S);_.finish(),delete d.positions,d.index=_}this._symbolsByKey[y]=d}}getScaledCoordinates(A,x){const{x:L,y:O,z:y}=this.tileID.canonical,{x:a,y:d,z:_}=x.canonical,B=gn/Math.pow(2,_-y),S=(d*s.N+A.anchorY)*B,U=O*s.N*gn;return{x:Math.floor((a*s.N+A.anchorX)*B-L*s.N*gn),y:Math.floor(S-U)}}findMatches(A,x,L){const O=this.tileID.canonical.z<x.canonical.z?1:Math.pow(2,this.tileID.canonical.z-x.canonical.z);for(let y=0;y<A.length;y++){const a=A.get(y);if(a.crossTileID)continue;const d=this._symbolsByKey[a.key];if(!d)continue;const _=this.getScaledCoordinates(a,x);if(d.index){const B=d.index.range(_.x-O,_.y-O,_.x+O,_.y+O).sort();for(const S of B){const U=d.crossTileIDs[S];if(!L[U]){L[U]=!0,a.crossTileID=U;break}}}else if(d.positions)for(let B=0;B<d.positions.length;B++){const S=d.positions[B],U=d.crossTileIDs[B];if(Math.abs(S.x-_.x)<=O&&Math.abs(S.y-_.y)<=O&&!L[U]){L[U]=!0,a.crossTileID=U;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(A=>{let{crossTileIDs:x}=A;return x})}}class lr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class kn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(A){const x=Math.round((A-this.lng)/360);if(x!==0)for(const L in this.indexes){const O=this.indexes[L],y={};for(const a in O){const d=O[a];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+x),y[d.tileID.key]=d}this.indexes[L]=y}this.lng=A}addBucket(A,x,L){if(this.indexes[A.overscaledZ]&&this.indexes[A.overscaledZ][A.key]){if(this.indexes[A.overscaledZ][A.key].bucketInstanceId===x.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(A.overscaledZ,this.indexes[A.overscaledZ][A.key])}for(let y=0;y<x.symbolInstances.length;y++)x.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[A.overscaledZ]||(this.usedCrossTileIDs[A.overscaledZ]={});const O=this.usedCrossTileIDs[A.overscaledZ];for(const y in this.indexes){const a=this.indexes[y];if(Number(y)>A.overscaledZ)for(const d in a){const _=a[d];_.tileID.isChildOf(A)&&_.findMatches(x.symbolInstances,A,O)}else{const d=a[A.scaledTo(Number(y)).key];d&&d.findMatches(x.symbolInstances,A,O)}}for(let y=0;y<x.symbolInstances.length;y++){const a=x.symbolInstances.get(y);a.crossTileID||(a.crossTileID=L.generate(),O[a.crossTileID]=!0)}return this.indexes[A.overscaledZ]===void 0&&(this.indexes[A.overscaledZ]={}),this.indexes[A.overscaledZ][A.key]=new mn(A,x.symbolInstances,x.bucketInstanceId),!0}removeBucketCrossTileIDs(A,x){for(const L of x.getCrossTileIDsLists())for(const O of L)delete this.usedCrossTileIDs[A][O]}removeStaleBuckets(A){let x=!1;for(const L in this.indexes){const O=this.indexes[L];for(const y in O)A[O[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(L,O[y]),delete O[y],x=!0)}return x}}class gs{constructor(){this.layerIndexes={},this.crossTileIDs=new lr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(A,x,L){let O=this.layerIndexes[A.id];O===void 0&&(O=this.layerIndexes[A.id]=new kn);let y=!1;const a={};O.handleWrapJump(L);for(const d of x){const _=d.getBucket(A);_&&A.id===_.layerIds[0]&&(_.bucketInstanceId||(_.bucketInstanceId=++this.maxBucketInstanceId),O.addBucket(d.tileID,_,this.crossTileIDs)&&(y=!0),a[_.bucketInstanceId]=!0)}return O.removeStaleBuckets(a)&&(y=!0),y}pruneUnusedLayers(A){const x={};A.forEach(L=>{x[L]=!0});for(const L in this.layerIndexes)x[L]||delete this.layerIndexes[L]}}const Qr=(N,A)=>s.x(N,A&&A.filter(x=>x.identifier!=="source.canvas")),xn=s.F(s.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),So=s.F(s.ax,["setCenter","setZoom","setBearing","setPitch"]),us=s.aw();class Wi extends s.E{constructor(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this.map=A,this.dispatcher=new Wt(Er(),this,A._getMapId()),this.imageManager=new Me,this.imageManager.setEventedParent(this),this.glyphManager=new Ct(A._requestManager,x.localIdeographFontFamily),this.lineAtlas=new Mt(256,512),this.crossTileSymbolIndex=new gs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.az());const L=this;this._rtlTextPluginCallback=Wi.registerForPluginStateChange(O=>{L.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:O.pluginStatus,pluginURL:O.pluginURL},(y,a)=>{if(s.aA(y),a&&a.every(d=>d))for(const d in L.sourceCaches){const _=L.sourceCaches[d].getSource().type;_!=="vector"&&_!=="geojson"||L.sourceCaches[d].reload()}})}),this.on("data",O=>{if(O.dataType!=="source"||O.sourceDataType!=="metadata")return;const y=this.sourceCaches[O.sourceId];if(!y)return;const a=y.getSource();if(a&&a.vectorLayerIds)for(const d in this._layers){const _=this._layers[d];_.source===a.id&&this._validateLayer(_)}})}loadURL(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),x.validate=typeof x.validate!="boolean"||x.validate;const O=this.map._requestManager.transformRequest(A,ce.Style);this._request=s.f(O,(y,a)=>{this._request=null,y?this.fire(new s.j(y)):a&&this._load(a,x,L)})}loadJSON(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),this._request=s.h.frame(()=>{this._request=null,x.validate=x.validate!==!1,this._load(A,x,L)})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(us,{validate:!1})}_load(A,x,L){var O;const y=x.transformStyle?x.transformStyle(L,A):A;if(!x.validate||!Qr(this,s.y(y))){this._loaded=!0,this.stylesheet=y;for(const a in y.sources)this.addSource(a,y.sources[a],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new Ft(this.stylesheet.light),this.map.setTerrain((O=this.stylesheet.terrain)!==null&&O!==void 0?O:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const A=s.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",A),this._order=A.map(x=>x.id),this._layers={},this._serializedLayers=null;for(const x of A){const L=s.aC(x);L.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=L}}_loadSprite(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;this.imageManager.setLoaded(!1),this._spriteRequest=function(O,y,a,d){const _=Ue(O),B=_.length,S=a>1?"@2x":"",U={},H={},q={};for(const{id:w,url:I}of _){const R=y.transformRequest(y.normalizeSpriteURL(I,S,".json"),ce.SpriteJSON),j=`${w}_${R.url}`;U[j]=s.f(R,(Y,ie)=>{delete U[j],H[w]=ie,ot(d,H,q,Y,B)});const Z=y.transformRequest(y.normalizeSpriteURL(I,S,".png"),ce.SpriteImage),W=`${w}_${Z.url}`;U[W]=ue.getImage(Z,(Y,ie)=>{delete U[W],q[w]=ie,ot(d,H,q,Y,B)})}return{cancel(){for(const w of Object.values(U))w.cancel()}}}(A,this.map._requestManager,this.map.getPixelRatio(),(O,y)=>{if(this._spriteRequest=null,O)this.fire(new s.j(O));else if(y)for(const a in y){this._spritesImagesIds[a]=[];const d=this._spritesImagesIds[a]?this._spritesImagesIds[a].filter(_=>!(_ in y)):[];for(const _ of d)this.imageManager.removeImage(_),this._changedImages[_]=!0;for(const _ in y[a]){const B=a==="default"?_:`${a}:${_}`;this._spritesImagesIds[a].push(B),B in this.imageManager.images?this.imageManager.updateImage(B,y[a][_],!1):this.imageManager.addImage(B,y[a][_]),x&&(this._changedImages[B]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),x&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),L&&L(O)})}_unloadSprite(){for(const A of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(A),this._changedImages[A]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(A){const x=this.sourceCaches[A.source];if(!x)return;const L=A.sourceLayer;if(!L)return;const O=x.getSource();(O.type==="geojson"||O.vectorLayerIds&&O.vectorLayerIds.indexOf(L)===-1)&&this.fire(new s.j(new Error(`Source layer "${L}" does not exist on source "${O.id}" as specified by style layer "${A.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const A in this.sourceCaches)if(!this.sourceCaches[A].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(A){const x=this._serializedAllLayers();if(!A||A.length===0)return Object.values(x);const L=[];for(const O of A)x[O]&&L.push(x[O]);return L}_serializedAllLayers(){let A=this._serializedLayers;if(A)return A;A=this._serializedLayers={};const x=Object.keys(this._layers);for(const L of x){const O=this._layers[L];O.type!=="custom"&&(A[L]=O.serialize())}return A}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const A in this.sourceCaches)if(this.sourceCaches[A].hasTransition())return!0;for(const A in this._layers)if(this._layers[A].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(A){if(!this._loaded)return;const x=this._changed;if(this._changed){const O=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(O.length||y.length)&&this._updateWorkerLayers(O,y);for(const a in this._updatedSources){const d=this._updatedSources[a];if(d==="reload")this._reloadSource(a);else{if(d!=="clear")throw new Error(`Invalid action ${d}`);this._clearSource(a)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const a in this._updatedPaintProps)this._layers[a].updateTransitions(A);this.light.updateTransitions(A),this._resetUpdates()}const L={};for(const O in this.sourceCaches){const y=this.sourceCaches[O];L[O]=y.used,y.used=!1}for(const O of this._order){const y=this._layers[O];y.recalculate(A,this._availableImages),!y.isHidden(A.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const O in L){const y=this.sourceCaches[O];L[O]!==y.used&&y.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:O}))}this.light.recalculate(A),this.z=A.zoom,x&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const A=Object.keys(this._changedImages);if(A.length){for(const x in this.sourceCaches)this.sourceCaches[x].reloadTilesForDependencies(["icons","patterns"],A);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const A in this.sourceCaches)this.sourceCaches[A].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(A,x){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(A),removedIds:x})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const L=this.serialize();if(A=x.transformStyle?x.transformStyle(L,A):A,Qr(this,s.y(A)))return!1;(A=s.aD(A)).layers=s.aB(A.layers);const O=s.aE(L,A).filter(a=>!(a.command in So));if(O.length===0)return!1;const y=O.filter(a=>!(a.command in xn));if(y.length>0)throw new Error(`Unimplemented: ${y.map(a=>a.command).join(", ")}.`);for(const a of O)a.command!=="setTransition"&&this[a.command].apply(this,a.args);return this.stylesheet=A,this._serializedLayers=null,!0}addImage(A,x){if(this.getImage(A))return this.fire(new s.j(new Error(`An image named "${A}" already exists.`)));this.imageManager.addImage(A,x),this._afterImageUpdated(A)}updateImage(A,x){this.imageManager.updateImage(A,x)}getImage(A){return this.imageManager.getImage(A)}removeImage(A){if(!this.getImage(A))return this.fire(new s.j(new Error(`An image named "${A}" does not exist.`)));this.imageManager.removeImage(A),this._afterImageUpdated(A)}_afterImageUpdated(A){this._availableImages=this.imageManager.listImages(),this._changedImages[A]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(A,x){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[A]!==void 0)throw new Error(`Source "${A}" already exists.`);if(!x.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(x).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(x.type)>=0&&this._validate(s.y.source,`sources.${A}`,x,null,L))return;this.map&&this.map._collectResourceTiming&&(x.collectResourceTiming=!0);const O=this.sourceCaches[A]=new jt(A,x,this.dispatcher);O.style=this,O.setEventedParent(this,()=>({isSourceLoaded:O.loaded(),source:O.serialize(),sourceId:A})),O.onAdd(this.map),this._changed=!0}removeSource(A){if(this._checkLoaded(),this.sourceCaches[A]===void 0)throw new Error("There is no source with this ID");for(const L in this._layers)if(this._layers[L].source===A)return this.fire(new s.j(new Error(`Source "${A}" cannot be removed while layer "${L}" is using it.`)));const x=this.sourceCaches[A];delete this.sourceCaches[A],delete this._updatedSources[A],x.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:A})),x.setEventedParent(null),x.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(A,x){if(this._checkLoaded(),this.sourceCaches[A]===void 0)throw new Error(`There is no source with this ID=${A}`);const L=this.sourceCaches[A].getSource();if(L.type!=="geojson")throw new Error(`geojsonSource.type is ${L.type}, which is !== 'geojson`);L.setData(x),this._changed=!0}getSource(A){return this.sourceCaches[A]&&this.sourceCaches[A].getSource()}addLayer(A,x){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const O=A.id;if(this.getLayer(O))return void this.fire(new s.j(new Error(`Layer "${O}" already exists on this map.`)));let y;if(A.type==="custom"){if(Qr(this,s.aF(A)))return;y=s.aC(A)}else{if("source"in A&&typeof A.source=="object"&&(this.addSource(O,A.source),A=s.aD(A),A=s.e(A,{source:O})),this._validate(s.y.layer,`layers.${O}`,A,{arrayIndex:-1},L))return;y=s.aC(A),this._validateLayer(y),y.setEventedParent(this,{layer:{id:O}})}const a=x?this._order.indexOf(x):this._order.length;if(x&&a===-1)this.fire(new s.j(new Error(`Cannot add layer "${O}" before non-existing layer "${x}".`)));else{if(this._order.splice(a,0,O),this._layerOrderChanged=!0,this._layers[O]=y,this._removedLayers[O]&&y.source&&y.type!=="custom"){const d=this._removedLayers[O];delete this._removedLayers[O],d.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(A,x){if(this._checkLoaded(),this._changed=!0,!this._layers[A])return void this.fire(new s.j(new Error(`The layer '${A}' does not exist in the map's style and cannot be moved.`)));if(A===x)return;const L=this._order.indexOf(A);this._order.splice(L,1);const O=x?this._order.indexOf(x):this._order.length;x&&O===-1?this.fire(new s.j(new Error(`Cannot move layer "${A}" before non-existing layer "${x}".`))):(this._order.splice(O,0,A),this._layerOrderChanged=!0)}removeLayer(A){this._checkLoaded();const x=this._layers[A];if(!x)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${A}".`)));x.setEventedParent(null);const L=this._order.indexOf(A);this._order.splice(L,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[A]=x,delete this._layers[A],this._serializedLayers&&delete this._serializedLayers[A],delete this._updatedLayers[A],delete this._updatedPaintProps[A],x.onRemove&&x.onRemove(this.map)}getLayer(A){return this._layers[A]}getLayersOrder(){return[...this._order]}hasLayer(A){return A in this._layers}setLayerZoomRange(A,x,L){this._checkLoaded();const O=this.getLayer(A);O?O.minzoom===x&&O.maxzoom===L||(x!=null&&(O.minzoom=x),L!=null&&(O.maxzoom=L),this._updateLayer(O)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${A}".`)))}setFilter(A,x){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const O=this.getLayer(A);if(O){if(!s.aG(O.filter,x))return x==null?(O.filter=void 0,void this._updateLayer(O)):void(this._validate(s.y.filter,`layers.${O.id}.filter`,x,null,L)||(O.filter=s.aD(x),this._updateLayer(O)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${A}".`)))}getFilter(A){return s.aD(this.getLayer(A).filter)}setLayoutProperty(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const y=this.getLayer(A);y?s.aG(y.getLayoutProperty(x),L)||(y.setLayoutProperty(x,L,O),this._updateLayer(y)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${A}".`)))}getLayoutProperty(A,x){const L=this.getLayer(A);if(L)return L.getLayoutProperty(x);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${A}".`)))}setPaintProperty(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const y=this.getLayer(A);y?s.aG(y.getPaintProperty(x),L)||(y.setPaintProperty(x,L,O)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[A]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${A}".`)))}getPaintProperty(A,x){return this.getLayer(A).getPaintProperty(x)}setFeatureState(A,x){this._checkLoaded();const L=A.source,O=A.sourceLayer,y=this.sourceCaches[L];if(y===void 0)return void this.fire(new s.j(new Error(`The source '${L}' does not exist in the map's style.`)));const a=y.getSource().type;a==="geojson"&&O?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):a!=="vector"||O?(A.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(O,A.id,x)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(A,x){this._checkLoaded();const L=A.source,O=this.sourceCaches[L];if(O===void 0)return void this.fire(new s.j(new Error(`The source '${L}' does not exist in the map's style.`)));const y=O.getSource().type,a=y==="vector"?A.sourceLayer:void 0;y!=="vector"||a?x&&typeof A.id!="string"&&typeof A.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):O.removeFeatureState(a,A.id,x):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(A){this._checkLoaded();const x=A.source,L=A.sourceLayer,O=this.sourceCaches[x];if(O!==void 0)return O.getSource().type!=="vector"||L?(A.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),O.getFeatureState(L,A.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${x}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const A=s.aH(this.sourceCaches,y=>y.serialize()),x=this._serializeByIds(this._order),L=this.map.getTerrain()||void 0,O=this.stylesheet;return s.aI({version:O.version,name:O.name,metadata:O.metadata,light:O.light,center:O.center,zoom:O.zoom,bearing:O.bearing,pitch:O.pitch,sprite:O.sprite,glyphs:O.glyphs,transition:O.transition,sources:A,layers:x,terrain:L},y=>y!==void 0)}_updateLayer(A){this._updatedLayers[A.id]=!0,A.source&&!this._updatedSources[A.source]&&this.sourceCaches[A.source].getSource().type!=="raster"&&(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(A){const x=a=>this._layers[a].type==="fill-extrusion",L={},O=[];for(let a=this._order.length-1;a>=0;a--){const d=this._order[a];if(x(d)){L[d]=a;for(const _ of A){const B=_[d];if(B)for(const S of B)O.push(S)}}}O.sort((a,d)=>d.intersectionZ-a.intersectionZ);const y=[];for(let a=this._order.length-1;a>=0;a--){const d=this._order[a];if(x(d))for(let _=O.length-1;_>=0;_--){const B=O[_].feature;if(L[B.layer.id]<a)break;y.push(B),O.pop()}else for(const _ of A){const B=_[d];if(B)for(const S of B)y.push(S.feature)}}return y}queryRenderedFeatures(A,x,L){x&&x.filter&&this._validate(s.y.filter,"queryRenderedFeatures.filter",x.filter,null,x);const O={};if(x&&x.layers){if(!Array.isArray(x.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const d of x.layers){const _=this._layers[d];if(!_)return this.fire(new s.j(new Error(`The layer '${d}' does not exist in the map's style and cannot be queried for features.`))),[];O[_.source]=!0}}const y=[];x.availableImages=this._availableImages;const a=this._serializedAllLayers();for(const d in this.sourceCaches)x.layers&&!O[d]||y.push(at(this.sourceCaches[d],this._layers,a,A,x,L));return this.placement&&y.push(function(d,_,B,S,U,H,q){const w={},I=H.queryRenderedSymbols(S),R=[];for(const j of Object.keys(I).map(Number))R.push(q[j]);R.sort(xt);for(const j of R){const Z=j.featureIndex.lookupSymbolFeatures(I[j.bucketInstanceId],_,j.bucketIndex,j.sourceLayerIndex,U.filter,U.layers,U.availableImages,d);for(const W in Z){const Y=w[W]=w[W]||[],ie=Z[W];ie.sort((ae,fe)=>{const pe=j.featureSortOrder;if(pe){const xe=pe.indexOf(ae.featureIndex);return pe.indexOf(fe.featureIndex)-xe}return fe.featureIndex-ae.featureIndex});for(const ae of ie)Y.push(ae)}}for(const j in w)w[j].forEach(Z=>{const W=Z.feature,Y=B[d[j].source].getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=Y});return w}(this._layers,a,this.sourceCaches,A,x,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(A,x){x&&x.filter&&this._validate(s.y.filter,"querySourceFeatures.filter",x.filter,null,x);const L=this.sourceCaches[A];return L?function(O,y){const a=O.getRenderableIds().map(B=>O.getTileByID(B)),d=[],_={};for(let B=0;B<a.length;B++){const S=a[B],U=S.tileID.canonical.key;_[U]||(_[U]=!0,S.querySourceFeatures(d,y))}return d}(L,x):[]}addSourceType(A,x,L){return Mi(A)?L(new Error(`A source type called "${A}" already exists.`)):(((O,y)=>{mi[O]=y})(A,x),x.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:A,url:x.workerSourceURL},L):L(null,null))}getLight(){return this.light.getLight()}setLight(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const L=this.light.getLight();let O=!1;for(const a in A)if(!s.aG(A[a],L[a])){O=!0;break}if(!O)return;const y={now:s.h.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(A,x),this.light.updateTransitions(y)}_validate(A,x,L,O){let y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!y||y.validate!==!1)&&Qr(this,A.call(s.y,s.e({key:x,style:this.serialize(),value:L,styleSpec:s.v},O)))}_remove(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const x in this._layers)this._layers[x].setEventedParent(null);for(const x in this.sourceCaches){const L=this.sourceCaches[x];L.setEventedParent(null),L.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(A)}_clearSource(A){this.sourceCaches[A].clearTiles()}_reloadSource(A){this.sourceCaches[A].resume(),this.sourceCaches[A].reload()}_updateSources(A){for(const x in this.sourceCaches)this.sourceCaches[x].update(A,this.map.terrain)}_generateCollisionBoxes(){for(const A in this.sourceCaches)this._reloadSource(A)}_updatePlacement(A,x,L,O){let y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,a=!1,d=!1;const _={};for(const B of this._order){const S=this._layers[B];if(S.type!=="symbol")continue;if(!_[S.source]){const H=this.sourceCaches[S.source];_[S.source]=H.getRenderableIds(!0).map(q=>H.getTileByID(q)).sort((q,w)=>w.tileID.overscaledZ-q.tileID.overscaledZ||(q.tileID.isLessThan(w.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(S,_[S.source],A.center.lng);a=a||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||L===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.h.now(),A.zoom))&&(this.pauseablePlacement=new ur(A,this.map.terrain,this._order,y,x,L,O,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,_),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.h.now()),d=!0),a&&this.pauseablePlacement.placement.setStale()),d||a)for(const B of this._order){const S=this._layers[B];S.type==="symbol"&&this.placement.updateLayerOpacities(S,_[S.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.h.now())}_releaseSymbolFadeTiles(){for(const A in this.sourceCaches)this.sourceCaches[A].releaseSymbolFadeTiles()}getImages(A,x,L){this.imageManager.getImages(x.icons,L),this._updateTilesForChangedImages();const O=this.sourceCaches[x.source];O&&O.setDependencies(x.tileID.key,x.type,x.icons)}getGlyphs(A,x,L){this.glyphManager.getGlyphs(x.stacks,L);const O=this.sourceCaches[x.source];O&&O.setDependencies(x.tileID.key,x.type,[""])}getResource(A,x,L){return s.m(x,L)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),A&&this._validate(s.y.glyphs,"glyphs",A,null,x)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=A,this.glyphManager.entries={},this.glyphManager.setURL(A))}addSprite(A,x){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},O=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const y=[{id:A,url:x}],a=[...Ue(this.stylesheet.sprite),...y];this._validate(s.y.sprite,"sprite",a,null,L)||(this.stylesheet.sprite=a,this._loadSprite(y,!0,O))}removeSprite(A){this._checkLoaded();const x=Ue(this.stylesheet.sprite);if(x.find(L=>L.id===A)){if(this._spritesImagesIds[A])for(const L of this._spritesImagesIds[A])this.imageManager.removeImage(L),this._changedImages[L]=!0;x.splice(x.findIndex(L=>L.id===A),1),this.stylesheet.sprite=x.length>0?x:void 0,delete this._spritesImagesIds[A],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${A}" doesn't exists on this map.`)))}getSprite(){return Ue(this.stylesheet.sprite)}setSprite(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),A&&this._validate(s.y.sprite,"sprite",A,null,x)||(this.stylesheet.sprite=A,A?this._loadSprite(A,!0,L):(this._unloadSprite(),L&&L(null)))}}Wi.registerForPluginStateChange=s.aK;var Ys=s.Q([{name:"a_pos",type:"Int16",components:2}]),Bs="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const dr={prelude:Fr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Fr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Fr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Fr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Fr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Fr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Fr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Fr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Fr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Fr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Fr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Fr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Fr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Fr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Fr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Fr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Fr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Fr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Fr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Fr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Fr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Fr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Fr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Fr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Fr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Fr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Fr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Bs),terrainDepth:Fr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Bs),terrainCoords:Fr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Bs)};function Fr(N,A){const x=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,L=A.match(/attribute ([\w]+) ([\w]+)/g),O=N.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=A.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=y?y.concat(O):O,d={};return{fragmentSource:N=N.replace(x,(_,B,S,U,H)=>(d[H]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
varying ${S} ${U} ${H};
#else
uniform ${S} ${U} u_${H};
#endif
`:`
#ifdef HAS_UNIFORM_u_${H}
    ${S} ${U} ${H} = u_${H};
#endif
`)),vertexSource:A=A.replace(x,(_,B,S,U,H)=>{const q=U==="float"?"vec2":"vec4",w=H.match(/color/)?"color":q;return d[H]?B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${S} ${q} a_${H};
varying ${S} ${U} ${H};
#else
uniform ${S} ${U} u_${H};
#endif
`:w==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${S} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${w}(a_${H}, u_${H}_t);
#else
    ${S} ${U} ${H} = u_${H};
#endif
`:B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
attribute ${S} ${q} a_${H};
#else
uniform ${S} ${U} u_${H};
#endif
`:w==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${S} ${U} ${H} = a_${H};
#else
    ${S} ${U} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${S} ${U} ${H} = unpack_mix_${w}(a_${H}, u_${H}_t);
#else
    ${S} ${U} ${H} = u_${H};
#endif
`}),staticAttributes:L,staticUniforms:a}}class Hn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(A,x,L,O,y,a,d,_,B){this.context=A;let S=this.boundPaintVertexBuffers.length!==O.length;for(let U=0;!S&&U<O.length;U++)this.boundPaintVertexBuffers[U]!==O[U]&&(S=!0);!this.vao||this.boundProgram!==x||this.boundLayoutVertexBuffer!==L||S||this.boundIndexBuffer!==y||this.boundVertexOffset!==a||this.boundDynamicVertexBuffer!==d||this.boundDynamicVertexBuffer2!==_||this.boundDynamicVertexBuffer3!==B?this.freshBind(x,L,O,y,a,d,_,B):(A.bindVertexArray.set(this.vao),d&&d.bind(),y&&y.dynamicDraw&&y.bind(),_&&_.bind(),B&&B.bind())}freshBind(A,x,L,O,y,a,d,_){const B=A.numAttributes,S=this.context,U=S.gl;this.vao&&this.destroy(),this.vao=S.createVertexArray(),S.bindVertexArray.set(this.vao),this.boundProgram=A,this.boundLayoutVertexBuffer=x,this.boundPaintVertexBuffers=L,this.boundIndexBuffer=O,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=d,this.boundDynamicVertexBuffer3=_,x.enableAttributes(U,A);for(const H of L)H.enableAttributes(U,A);a&&a.enableAttributes(U,A),d&&d.enableAttributes(U,A),_&&_.enableAttributes(U,A),x.bind(),x.setVertexAttribPointers(U,A,y);for(const H of L)H.bind(),H.setVertexAttribPointers(U,A,y);a&&(a.bind(),a.setVertexAttribPointers(U,A,y)),O&&O.bind(),d&&(d.bind(),d.setVertexAttribPointers(U,A,y)),_&&(_.bind(),_.setVertexAttribPointers(U,A,y)),S.currentNumAttributes=B}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Or(N){const A=[];for(let x=0;x<N.length;x++){if(N[x]===null)continue;const L=N[x].split(" ");A.push(L.pop())}return A}class Cn{constructor(A,x,L,O,y,a){const d=A.gl;this.program=d.createProgram();const _=Or(x.staticAttributes),B=L?L.getBinderAttributes():[],S=_.concat(B),U=dr.prelude.staticUniforms?Or(dr.prelude.staticUniforms):[],H=x.staticUniforms?Or(x.staticUniforms):[],q=L?L.getBinderUniforms():[],w=U.concat(H).concat(q),I=[];for(const ae of w)I.indexOf(ae)<0&&I.push(ae);const R=L?L.defines():[];y&&R.push("#define OVERDRAW_INSPECTOR;"),a&&R.push("#define TERRAIN3D;");const j=R.concat(dr.prelude.fragmentSource,x.fragmentSource).join(`
`),Z=R.concat(dr.prelude.vertexSource,x.vertexSource).join(`
`),W=d.createShader(d.FRAGMENT_SHADER);if(d.isContextLost())return void(this.failedToCreate=!0);if(d.shaderSource(W,j),d.compileShader(W),!d.getShaderParameter(W,d.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${d.getShaderInfoLog(W)}`);d.attachShader(this.program,W);const Y=d.createShader(d.VERTEX_SHADER);if(d.isContextLost())return void(this.failedToCreate=!0);if(d.shaderSource(Y,Z),d.compileShader(Y),!d.getShaderParameter(Y,d.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${d.getShaderInfoLog(Y)}`);d.attachShader(this.program,Y),this.attributes={};const ie={};this.numAttributes=S.length;for(let ae=0;ae<this.numAttributes;ae++)S[ae]&&(d.bindAttribLocation(this.program,ae,S[ae]),this.attributes[S[ae]]=ae);if(d.linkProgram(this.program),!d.getProgramParameter(this.program,d.LINK_STATUS))throw new Error(`Program failed to link: ${d.getProgramInfoLog(this.program)}`);d.deleteShader(Y),d.deleteShader(W);for(let ae=0;ae<I.length;ae++){const fe=I[ae];if(fe&&!ie[fe]){const pe=d.getUniformLocation(this.program,fe);pe&&(ie[fe]=pe)}}this.fixedUniforms=O(A,ie),this.terrainUniforms=((ae,fe)=>({u_depth:new s.aL(ae,fe.u_depth),u_terrain:new s.aL(ae,fe.u_terrain),u_terrain_dim:new s.aM(ae,fe.u_terrain_dim),u_terrain_matrix:new s.aN(ae,fe.u_terrain_matrix),u_terrain_unpack:new s.aO(ae,fe.u_terrain_unpack),u_terrain_exaggeration:new s.aM(ae,fe.u_terrain_exaggeration)}))(A,ie),this.binderUniforms=L?L.getUniforms(A,ie):[]}draw(A,x,L,O,y,a,d,_,B,S,U,H,q,w,I,R,j,Z){const W=A.gl;if(this.failedToCreate)return;if(A.program.set(this.program),A.setDepthMode(L),A.setStencilMode(O),A.setColorMode(y),A.setCullFace(a),_){A.activeTexture.set(W.TEXTURE2),W.bindTexture(W.TEXTURE_2D,_.depthTexture),A.activeTexture.set(W.TEXTURE3),W.bindTexture(W.TEXTURE_2D,_.texture);for(const ie in this.terrainUniforms)this.terrainUniforms[ie].set(_[ie])}for(const ie in this.fixedUniforms)this.fixedUniforms[ie].set(d[ie]);I&&I.setUniforms(A,this.binderUniforms,q,{zoom:w});let Y=0;switch(x){case W.LINES:Y=2;break;case W.TRIANGLES:Y=3;break;case W.LINE_STRIP:Y=1}for(const ie of H.get()){const ae=ie.vaos||(ie.vaos={});(ae[B]||(ae[B]=new Hn)).bind(A,this,S,I?I.getPaintVertexBuffers():[],U,ie.vertexOffset,R,j,Z),W.drawElements(x,ie.primitiveLength*Y,W.UNSIGNED_SHORT,ie.primitiveOffset*Y*2)}}}function An(N,A,x){const L=1/Pe(x,1,A.transform.tileZoom),O=Math.pow(2,x.tileID.overscaledZ),y=x.tileSize*Math.pow(2,A.transform.tileZoom)/O,a=y*(x.tileID.canonical.x+x.tileID.wrap*O),d=y*x.tileID.canonical.y;return{u_image:0,u_texsize:x.imageAtlasTexture.size,u_scale:[L,N.fromScale,N.toScale],u_fade:N.t,u_pixel_coord_upper:[a>>16,d>>16],u_pixel_coord_lower:[65535&a,65535&d]}}const Hr=(N,A,x,L)=>{const O=A.style.light,y=O.properties.get("position"),a=[y.x,y.y,y.z],d=function(){var B=new s.A(9);return s.A!=Float32Array&&(B[1]=0,B[2]=0,B[3]=0,B[5]=0,B[6]=0,B[7]=0),B[0]=1,B[4]=1,B[8]=1,B}();O.properties.get("anchor")==="viewport"&&function(B,S){var U=Math.sin(S),H=Math.cos(S);B[0]=H,B[1]=U,B[2]=0,B[3]=-U,B[4]=H,B[5]=0,B[6]=0,B[7]=0,B[8]=1}(d,-A.transform.angle),function(B,S,U){var H=S[0],q=S[1],w=S[2];B[0]=H*U[0]+q*U[3]+w*U[6],B[1]=H*U[1]+q*U[4]+w*U[7],B[2]=H*U[2]+q*U[5]+w*U[8]}(a,a,d);const _=O.properties.get("color");return{u_matrix:N,u_lightpos:a,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[_.r,_.g,_.b],u_vertical_gradient:+x,u_opacity:L}},Gs=(N,A,x,L,O,y,a)=>s.e(Hr(N,A,x,L),An(y,A,a),{u_height_factor:-Math.pow(2,O.overscaledZ)/a.tileSize/8}),ca=N=>({u_matrix:N}),uo=(N,A,x,L)=>s.e(ca(N),An(x,A,L)),Ea=(N,A)=>({u_matrix:N,u_world:A}),Ne=(N,A,x,L,O)=>s.e(uo(N,A,x,L),{u_world:O}),Je=(N,A,x,L)=>{const O=N.transform;let y,a;if(L.paint.get("circle-pitch-alignment")==="map"){const d=Pe(x,1,O.zoom);y=!0,a=[d,d]}else y=!1,a=O.pixelsToGLUnits;return{u_camera_to_center_distance:O.cameraToCenterDistance,u_scale_with_map:+(L.paint.get("circle-pitch-scale")==="map"),u_matrix:N.translatePosMatrix(A.posMatrix,x,L.paint.get("circle-translate"),L.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:N.pixelRatio,u_extrude_scale:a}},dt=(N,A,x)=>{const L=Pe(x,1,A.zoom),O=Math.pow(2,A.zoom-x.tileID.overscaledZ),y=x.tileID.overscaleFactor();return{u_matrix:N,u_camera_to_center_distance:A.cameraToCenterDistance,u_pixels_to_tile_units:L,u_extrude_scale:[A.pixelsToGLUnits[0]/(L*O),A.pixelsToGLUnits[1]/(L*O)],u_overscale_factor:y}},Ot=function(N,A){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:N,u_color:A,u_overlay:0,u_overlay_scale:x}},ui=N=>({u_matrix:N}),Gi=(N,A,x,L)=>({u_matrix:N,u_extrude_scale:Pe(A,1,x),u_intensity:L});function br(N,A){const x=Math.pow(2,A.canonical.z),L=A.canonical.y;return[new s.U(0,L/x).toLngLat().lat,new s.U(0,(L+1)/x).toLngLat().lat]}const En=(N,A,x,L)=>{const O=N.transform;return{u_matrix:$a(N,A,x,L),u_ratio:1/Pe(A,1,O.zoom),u_device_pixel_ratio:N.pixelRatio,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]]}},On=(N,A,x,L,O)=>s.e(En(N,A,x,O),{u_image:0,u_image_height:L}),rs=(N,A,x,L,O)=>{const y=N.transform,a=au(A,y);return{u_matrix:$a(N,A,x,O),u_texsize:A.imageAtlasTexture.size,u_ratio:1/Pe(A,1,y.zoom),u_device_pixel_ratio:N.pixelRatio,u_image:0,u_scale:[a,L.fromScale,L.toScale],u_fade:L.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},wn=(N,A,x,L,O,y)=>{const a=N.lineAtlas,d=au(A,N.transform),_=x.layout.get("line-cap")==="round",B=a.getDash(L.from,_),S=a.getDash(L.to,_),U=B.width*O.fromScale,H=S.width*O.toScale;return s.e(En(N,A,x,y),{u_patternscale_a:[d/U,-B.height/2],u_patternscale_b:[d/H,-S.height/2],u_sdfgamma:a.width/(256*Math.min(U,H)*N.pixelRatio)/2,u_image:0,u_tex_y_a:B.y,u_tex_y_b:S.y,u_mix:O.t})};function au(N,A){return 1/Pe(N,1,A.tileZoom)}function $a(N,A,x,L){return N.translatePosMatrix(L?L.posMatrix:A.tileID.posMatrix,A,x.paint.get("line-translate"),x.paint.get("line-translate-anchor"))}const Tr=(N,A,x,L,O)=>{return{u_matrix:N,u_tl_parent:A,u_scale_parent:x,u_buffer_scale:1,u_fade_t:L.mix,u_opacity:L.opacity*O.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:O.paint.get("raster-brightness-min"),u_brightness_high:O.paint.get("raster-brightness-max"),u_saturation_factor:(a=O.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(y=O.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Ka(O.paint.get("raster-hue-rotate"))};var y,a};function Ka(N){N*=Math.PI/180;const A=Math.sin(N),x=Math.cos(N);return[(2*x+1)/3,(-Math.sqrt(3)*A-x+1)/3,(Math.sqrt(3)*A-x+1)/3]}const Ul=(N,A,x,L,O,y,a,d,_,B)=>{const S=O.transform;return{u_is_size_zoom_constant:+(N==="constant"||N==="source"),u_is_size_feature_constant:+(N==="constant"||N==="camera"),u_size_t:A?A.uSizeT:0,u_size:A?A.uSize:0,u_camera_to_center_distance:S.cameraToCenterDistance,u_pitch:S.pitch/360*2*Math.PI,u_rotate_symbol:+x,u_aspect_ratio:S.width/S.height,u_fade_change:O.options.fadeDuration?O.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:a,u_coord_matrix:d,u_is_text:+_,u_pitch_with_map:+L,u_texsize:B,u_texture:0}},Yn=(N,A,x,L,O,y,a,d,_,B,S)=>{const U=O.transform;return s.e(Ul(N,A,x,L,O,y,a,d,_,B),{u_gamma_scale:L?Math.cos(U._pitch)*U.cameraToCenterDistance:1,u_device_pixel_ratio:O.pixelRatio,u_is_halo:+S})},To=(N,A,x,L,O,y,a,d,_,B)=>s.e(Yn(N,A,x,L,O,y,a,d,!0,_,!0),{u_texsize_icon:B,u_texture_icon:1}),Wa=(N,A,x)=>({u_matrix:N,u_opacity:A,u_color:x}),ms=(N,A,x,L,O,y)=>s.e(function(a,d,_,B){const S=_.imageManager.getPattern(a.from.toString()),U=_.imageManager.getPattern(a.to.toString()),{width:H,height:q}=_.imageManager.getPixelSize(),w=Math.pow(2,B.tileID.overscaledZ),I=B.tileSize*Math.pow(2,_.transform.tileZoom)/w,R=I*(B.tileID.canonical.x+B.tileID.wrap*w),j=I*B.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:S.tl,u_pattern_br_a:S.br,u_pattern_tl_b:U.tl,u_pattern_br_b:U.br,u_texsize:[H,q],u_mix:d.t,u_pattern_size_a:S.displaySize,u_pattern_size_b:U.displaySize,u_scale_a:d.fromScale,u_scale_b:d.toScale,u_tile_units_to_pixels:1/Pe(B,1,_.transform.tileZoom),u_pixel_coord_upper:[R>>16,j>>16],u_pixel_coord_lower:[65535&R,65535&j]}}(L,y,x,O),{u_matrix:N,u_opacity:A}),ua={fillExtrusion:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_lightpos:new s.aP(N,A.u_lightpos),u_lightintensity:new s.aM(N,A.u_lightintensity),u_lightcolor:new s.aP(N,A.u_lightcolor),u_vertical_gradient:new s.aM(N,A.u_vertical_gradient),u_opacity:new s.aM(N,A.u_opacity)}),fillExtrusionPattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_lightpos:new s.aP(N,A.u_lightpos),u_lightintensity:new s.aM(N,A.u_lightintensity),u_lightcolor:new s.aP(N,A.u_lightcolor),u_vertical_gradient:new s.aM(N,A.u_vertical_gradient),u_height_factor:new s.aM(N,A.u_height_factor),u_image:new s.aL(N,A.u_image),u_texsize:new s.aQ(N,A.u_texsize),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade),u_opacity:new s.aM(N,A.u_opacity)}),fill:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix)}),fillPattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_image:new s.aL(N,A.u_image),u_texsize:new s.aQ(N,A.u_texsize),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade)}),fillOutline:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_world:new s.aQ(N,A.u_world)}),fillOutlinePattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_world:new s.aQ(N,A.u_world),u_image:new s.aL(N,A.u_image),u_texsize:new s.aQ(N,A.u_texsize),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade)}),circle:(N,A)=>({u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_scale_with_map:new s.aL(N,A.u_scale_with_map),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_extrude_scale:new s.aQ(N,A.u_extrude_scale),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_matrix:new s.aN(N,A.u_matrix)}),collisionBox:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aM(N,A.u_pixels_to_tile_units),u_extrude_scale:new s.aQ(N,A.u_extrude_scale),u_overscale_factor:new s.aM(N,A.u_overscale_factor)}),collisionCircle:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_inv_matrix:new s.aN(N,A.u_inv_matrix),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_viewport_size:new s.aQ(N,A.u_viewport_size)}),debug:(N,A)=>({u_color:new s.aR(N,A.u_color),u_matrix:new s.aN(N,A.u_matrix),u_overlay:new s.aL(N,A.u_overlay),u_overlay_scale:new s.aM(N,A.u_overlay_scale)}),clippingMask:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix)}),heatmap:(N,A)=>({u_extrude_scale:new s.aM(N,A.u_extrude_scale),u_intensity:new s.aM(N,A.u_intensity),u_matrix:new s.aN(N,A.u_matrix)}),heatmapTexture:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_world:new s.aQ(N,A.u_world),u_image:new s.aL(N,A.u_image),u_color_ramp:new s.aL(N,A.u_color_ramp),u_opacity:new s.aM(N,A.u_opacity)}),hillshade:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_image:new s.aL(N,A.u_image),u_latrange:new s.aQ(N,A.u_latrange),u_light:new s.aQ(N,A.u_light),u_shadow:new s.aR(N,A.u_shadow),u_highlight:new s.aR(N,A.u_highlight),u_accent:new s.aR(N,A.u_accent)}),hillshadePrepare:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_image:new s.aL(N,A.u_image),u_dimension:new s.aQ(N,A.u_dimension),u_zoom:new s.aM(N,A.u_zoom),u_unpack:new s.aO(N,A.u_unpack)}),line:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels)}),lineGradient:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels),u_image:new s.aL(N,A.u_image),u_image_height:new s.aM(N,A.u_image_height)}),linePattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_texsize:new s.aQ(N,A.u_texsize),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_image:new s.aL(N,A.u_image),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade)}),lineSDF:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels),u_patternscale_a:new s.aQ(N,A.u_patternscale_a),u_patternscale_b:new s.aQ(N,A.u_patternscale_b),u_sdfgamma:new s.aM(N,A.u_sdfgamma),u_image:new s.aL(N,A.u_image),u_tex_y_a:new s.aM(N,A.u_tex_y_a),u_tex_y_b:new s.aM(N,A.u_tex_y_b),u_mix:new s.aM(N,A.u_mix)}),raster:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_tl_parent:new s.aQ(N,A.u_tl_parent),u_scale_parent:new s.aM(N,A.u_scale_parent),u_buffer_scale:new s.aM(N,A.u_buffer_scale),u_fade_t:new s.aM(N,A.u_fade_t),u_opacity:new s.aM(N,A.u_opacity),u_image0:new s.aL(N,A.u_image0),u_image1:new s.aL(N,A.u_image1),u_brightness_low:new s.aM(N,A.u_brightness_low),u_brightness_high:new s.aM(N,A.u_brightness_high),u_saturation_factor:new s.aM(N,A.u_saturation_factor),u_contrast_factor:new s.aM(N,A.u_contrast_factor),u_spin_weights:new s.aP(N,A.u_spin_weights)}),symbolIcon:(N,A)=>({u_is_size_zoom_constant:new s.aL(N,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(N,A.u_is_size_feature_constant),u_size_t:new s.aM(N,A.u_size_t),u_size:new s.aM(N,A.u_size),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pitch:new s.aM(N,A.u_pitch),u_rotate_symbol:new s.aL(N,A.u_rotate_symbol),u_aspect_ratio:new s.aM(N,A.u_aspect_ratio),u_fade_change:new s.aM(N,A.u_fade_change),u_matrix:new s.aN(N,A.u_matrix),u_label_plane_matrix:new s.aN(N,A.u_label_plane_matrix),u_coord_matrix:new s.aN(N,A.u_coord_matrix),u_is_text:new s.aL(N,A.u_is_text),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_texsize:new s.aQ(N,A.u_texsize),u_texture:new s.aL(N,A.u_texture)}),symbolSDF:(N,A)=>({u_is_size_zoom_constant:new s.aL(N,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(N,A.u_is_size_feature_constant),u_size_t:new s.aM(N,A.u_size_t),u_size:new s.aM(N,A.u_size),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pitch:new s.aM(N,A.u_pitch),u_rotate_symbol:new s.aL(N,A.u_rotate_symbol),u_aspect_ratio:new s.aM(N,A.u_aspect_ratio),u_fade_change:new s.aM(N,A.u_fade_change),u_matrix:new s.aN(N,A.u_matrix),u_label_plane_matrix:new s.aN(N,A.u_label_plane_matrix),u_coord_matrix:new s.aN(N,A.u_coord_matrix),u_is_text:new s.aL(N,A.u_is_text),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_texsize:new s.aQ(N,A.u_texsize),u_texture:new s.aL(N,A.u_texture),u_gamma_scale:new s.aM(N,A.u_gamma_scale),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_is_halo:new s.aL(N,A.u_is_halo)}),symbolTextAndIcon:(N,A)=>({u_is_size_zoom_constant:new s.aL(N,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(N,A.u_is_size_feature_constant),u_size_t:new s.aM(N,A.u_size_t),u_size:new s.aM(N,A.u_size),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pitch:new s.aM(N,A.u_pitch),u_rotate_symbol:new s.aL(N,A.u_rotate_symbol),u_aspect_ratio:new s.aM(N,A.u_aspect_ratio),u_fade_change:new s.aM(N,A.u_fade_change),u_matrix:new s.aN(N,A.u_matrix),u_label_plane_matrix:new s.aN(N,A.u_label_plane_matrix),u_coord_matrix:new s.aN(N,A.u_coord_matrix),u_is_text:new s.aL(N,A.u_is_text),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_texsize:new s.aQ(N,A.u_texsize),u_texsize_icon:new s.aQ(N,A.u_texsize_icon),u_texture:new s.aL(N,A.u_texture),u_texture_icon:new s.aL(N,A.u_texture_icon),u_gamma_scale:new s.aM(N,A.u_gamma_scale),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_is_halo:new s.aL(N,A.u_is_halo)}),background:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_opacity:new s.aM(N,A.u_opacity),u_color:new s.aR(N,A.u_color)}),backgroundPattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_opacity:new s.aM(N,A.u_opacity),u_image:new s.aL(N,A.u_image),u_pattern_tl_a:new s.aQ(N,A.u_pattern_tl_a),u_pattern_br_a:new s.aQ(N,A.u_pattern_br_a),u_pattern_tl_b:new s.aQ(N,A.u_pattern_tl_b),u_pattern_br_b:new s.aQ(N,A.u_pattern_br_b),u_texsize:new s.aQ(N,A.u_texsize),u_mix:new s.aM(N,A.u_mix),u_pattern_size_a:new s.aQ(N,A.u_pattern_size_a),u_pattern_size_b:new s.aQ(N,A.u_pattern_size_b),u_scale_a:new s.aM(N,A.u_scale_a),u_scale_b:new s.aM(N,A.u_scale_b),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aM(N,A.u_tile_units_to_pixels)}),terrain:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_texture:new s.aL(N,A.u_texture),u_ele_delta:new s.aM(N,A.u_ele_delta)}),terrainDepth:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ele_delta:new s.aM(N,A.u_ele_delta)}),terrainCoords:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_texture:new s.aL(N,A.u_texture),u_terrain_coords_id:new s.aM(N,A.u_terrain_coords_id),u_ele_delta:new s.aM(N,A.u_ele_delta)})};class Xa{constructor(A,x,L){this.context=A;const O=A.gl;this.buffer=O.createBuffer(),this.dynamicDraw=!!L,this.context.unbindVAO(),A.bindElementBuffer.set(this.buffer),O.bufferData(O.ELEMENT_ARRAY_BUFFER,x.arrayBuffer,this.dynamicDraw?O.DYNAMIC_DRAW:O.STATIC_DRAW),this.dynamicDraw||delete x.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(A){const x=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),x.bufferSubData(x.ELEMENT_ARRAY_BUFFER,0,A.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Sa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fc{constructor(A,x,L,O){this.length=x.length,this.attributes=L,this.itemSize=x.bytesPerElement,this.dynamicDraw=O,this.context=A;const y=A.gl;this.buffer=y.createBuffer(),A.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,x.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete x.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(A){if(A.length!==this.length)throw new Error(`Length of new data is ${A.length}, which doesn't match current length of ${this.length}`);const x=this.context.gl;this.bind(),x.bufferSubData(x.ARRAY_BUFFER,0,A.arrayBuffer)}enableAttributes(A,x){for(let L=0;L<this.attributes.length;L++){const O=x.attributes[this.attributes[L].name];O!==void 0&&A.enableVertexAttribArray(O)}}setVertexAttribPointers(A,x,L){for(let O=0;O<this.attributes.length;O++){const y=this.attributes[O],a=x.attributes[y.name];a!==void 0&&A.vertexAttribPointer(a,y.components,A[Sa[y.type]],!1,this.itemSize,y.offset+this.itemSize*(L||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Za=new WeakMap;function ho(N){var A;if(Za.has(N))return Za.get(N);{const x=(A=N.getParameter(N.VERSION))===null||A===void 0?void 0:A.startsWith("WebGL 2.0");return Za.set(N,x),x}}class Pr{constructor(A){this.gl=A.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(A){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ha extends Pr{getDefault(){return s.aT.transparent}set(A){const x=this.current;(A.r!==x.r||A.g!==x.g||A.b!==x.b||A.a!==x.a||this.dirty)&&(this.gl.clearColor(A.r,A.g,A.b,A.a),this.current=A,this.dirty=!1)}}class hs extends Pr{getDefault(){return 1}set(A){(A!==this.current||this.dirty)&&(this.gl.clearDepth(A),this.current=A,this.dirty=!1)}}class dn extends Pr{getDefault(){return 0}set(A){(A!==this.current||this.dirty)&&(this.gl.clearStencil(A),this.current=A,this.dirty=!1)}}class ns extends Pr{getDefault(){return[!0,!0,!0,!0]}set(A){const x=this.current;(A[0]!==x[0]||A[1]!==x[1]||A[2]!==x[2]||A[3]!==x[3]||this.dirty)&&(this.gl.colorMask(A[0],A[1],A[2],A[3]),this.current=A,this.dirty=!1)}}class Vr extends Pr{getDefault(){return!0}set(A){(A!==this.current||this.dirty)&&(this.gl.depthMask(A),this.current=A,this.dirty=!1)}}class Ja extends Pr{getDefault(){return 255}set(A){(A!==this.current||this.dirty)&&(this.gl.stencilMask(A),this.current=A,this.dirty=!1)}}class cl extends Pr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(A){const x=this.current;(A.func!==x.func||A.ref!==x.ref||A.mask!==x.mask||this.dirty)&&(this.gl.stencilFunc(A.func,A.ref,A.mask),this.current=A,this.dirty=!1)}}class Nl extends Pr{getDefault(){const A=this.gl;return[A.KEEP,A.KEEP,A.KEEP]}set(A){const x=this.current;(A[0]!==x[0]||A[1]!==x[1]||A[2]!==x[2]||this.dirty)&&(this.gl.stencilOp(A[0],A[1],A[2]),this.current=A,this.dirty=!1)}}class Io extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;A?x.enable(x.STENCIL_TEST):x.disable(x.STENCIL_TEST),this.current=A,this.dirty=!1}}class Ko extends Pr{getDefault(){return[0,1]}set(A){const x=this.current;(A[0]!==x[0]||A[1]!==x[1]||this.dirty)&&(this.gl.depthRange(A[0],A[1]),this.current=A,this.dirty=!1)}}class dc extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;A?x.enable(x.DEPTH_TEST):x.disable(x.DEPTH_TEST),this.current=A,this.dirty=!1}}class Wo extends Pr{getDefault(){return this.gl.LESS}set(A){(A!==this.current||this.dirty)&&(this.gl.depthFunc(A),this.current=A,this.dirty=!1)}}class Ao extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;A?x.enable(x.BLEND):x.disable(x.BLEND),this.current=A,this.dirty=!1}}class fc extends Pr{getDefault(){const A=this.gl;return[A.ONE,A.ZERO]}set(A){const x=this.current;(A[0]!==x[0]||A[1]!==x[1]||this.dirty)&&(this.gl.blendFunc(A[0],A[1]),this.current=A,this.dirty=!1)}}class Xo extends Pr{getDefault(){return s.aT.transparent}set(A){const x=this.current;(A.r!==x.r||A.g!==x.g||A.b!==x.b||A.a!==x.a||this.dirty)&&(this.gl.blendColor(A.r,A.g,A.b,A.a),this.current=A,this.dirty=!1)}}class zl extends Pr{getDefault(){return this.gl.FUNC_ADD}set(A){(A!==this.current||this.dirty)&&(this.gl.blendEquation(A),this.current=A,this.dirty=!1)}}class Dc extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;A?x.enable(x.CULL_FACE):x.disable(x.CULL_FACE),this.current=A,this.dirty=!1}}class vh extends Pr{getDefault(){return this.gl.BACK}set(A){(A!==this.current||this.dirty)&&(this.gl.cullFace(A),this.current=A,this.dirty=!1)}}class lu extends Pr{getDefault(){return this.gl.CCW}set(A){(A!==this.current||this.dirty)&&(this.gl.frontFace(A),this.current=A,this.dirty=!1)}}class cu extends Pr{getDefault(){return null}set(A){(A!==this.current||this.dirty)&&(this.gl.useProgram(A),this.current=A,this.dirty=!1)}}class Ru extends Pr{getDefault(){return this.gl.TEXTURE0}set(A){(A!==this.current||this.dirty)&&(this.gl.activeTexture(A),this.current=A,this.dirty=!1)}}class Ql extends Pr{getDefault(){const A=this.gl;return[0,0,A.drawingBufferWidth,A.drawingBufferHeight]}set(A){const x=this.current;(A[0]!==x[0]||A[1]!==x[1]||A[2]!==x[2]||A[3]!==x[3]||this.dirty)&&(this.gl.viewport(A[0],A[1],A[2],A[3]),this.current=A,this.dirty=!1)}}class Ya extends Pr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;x.bindFramebuffer(x.FRAMEBUFFER,A),this.current=A,this.dirty=!1}}class el extends Pr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;x.bindRenderbuffer(x.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class Vl extends Pr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;x.bindTexture(x.TEXTURE_2D,A),this.current=A,this.dirty=!1}}class tl extends Pr{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;x.bindBuffer(x.ARRAY_BUFFER,A),this.current=A,this.dirty=!1}}class Aa extends Pr{getDefault(){return null}set(A){const x=this.gl;x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,A),this.current=A,this.dirty=!1}}class ul extends Pr{getDefault(){return null}set(A){var x;if(A===this.current&&!this.dirty)return;const L=this.gl;ho(L)?L.bindVertexArray(A):(x=L.getExtension("OES_vertex_array_object"))===null||x===void 0||x.bindVertexArrayOES(A),this.current=A,this.dirty=!1}}class Hl extends Pr{getDefault(){return 4}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;x.pixelStorei(x.UNPACK_ALIGNMENT,A),this.current=A,this.dirty=!1}}class eo extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A),this.current=A,this.dirty=!1}}class da extends Pr{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const x=this.gl;x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,A),this.current=A,this.dirty=!1}}class ne extends Pr{constructor(A,x){super(A),this.context=A,this.parent=x}getDefault(){return null}}class Ie extends ne{setDirty(){this.dirty=!0}set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const x=this.gl;x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,A,0),this.current=A,this.dirty=!1}}class lt extends ne{set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const x=this.gl;x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class mt extends ne{set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const x=this.gl;x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_STENCIL_ATTACHMENT,x.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class vt{constructor(A,x,L,O,y){this.context=A,this.width=x,this.height=L;const a=A.gl,d=this.framebuffer=a.createFramebuffer();if(this.colorAttachment=new Ie(A,d),O)this.depthAttachment=y?new mt(A,d):new lt(A,d);else if(y)throw new Error("Stencil cannot be setted without depth");if(a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const A=this.context.gl,x=this.colorAttachment.get();if(x&&A.deleteTexture(x),this.depthAttachment){const L=this.depthAttachment.get();L&&A.deleteRenderbuffer(L)}A.deleteFramebuffer(this.framebuffer)}}class Tt{constructor(A,x,L){this.blendFunction=A,this.blendColor=x,this.mask=L}}Tt.Replace=[1,0],Tt.disabled=new Tt(Tt.Replace,s.aT.transparent,[!1,!1,!1,!1]),Tt.unblended=new Tt(Tt.Replace,s.aT.transparent,[!0,!0,!0,!0]),Tt.alphaBlended=new Tt([1,771],s.aT.transparent,[!0,!0,!0,!0]);class pi{constructor(A){var x,L;if(this.gl=A,this.clearColor=new ha(this),this.clearDepth=new hs(this),this.clearStencil=new dn(this),this.colorMask=new ns(this),this.depthMask=new Vr(this),this.stencilMask=new Ja(this),this.stencilFunc=new cl(this),this.stencilOp=new Nl(this),this.stencilTest=new Io(this),this.depthRange=new Ko(this),this.depthTest=new dc(this),this.depthFunc=new Wo(this),this.blend=new Ao(this),this.blendFunc=new fc(this),this.blendColor=new Xo(this),this.blendEquation=new zl(this),this.cullFace=new Dc(this),this.cullFaceSide=new vh(this),this.frontFace=new lu(this),this.program=new cu(this),this.activeTexture=new Ru(this),this.viewport=new Ql(this),this.bindFramebuffer=new Ya(this),this.bindRenderbuffer=new el(this),this.bindTexture=new Vl(this),this.bindVertexBuffer=new tl(this),this.bindElementBuffer=new Aa(this),this.bindVertexArray=new ul(this),this.pixelStoreUnpack=new Hl(this),this.pixelStoreUnpackPremultiplyAlpha=new eo(this),this.pixelStoreUnpackFlipY=new da(this),this.extTextureFilterAnisotropic=A.getExtension("EXT_texture_filter_anisotropic")||A.getExtension("MOZ_EXT_texture_filter_anisotropic")||A.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=A.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=A.getParameter(A.MAX_TEXTURE_SIZE),ho(A)){this.HALF_FLOAT=A.HALF_FLOAT;const O=A.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(x=A.RGBA16F)!==null&&x!==void 0?x:O==null?void 0:O.RGBA16F_EXT,this.RGB16F=(L=A.RGB16F)!==null&&L!==void 0?L:O==null?void 0:O.RGB16F_EXT,A.getExtension("EXT_color_buffer_float")}else{A.getExtension("EXT_color_buffer_half_float"),A.getExtension("OES_texture_half_float_linear");const O=A.getExtension("OES_texture_half_float");this.HALF_FLOAT=O==null?void 0:O.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(A,x){return new Xa(this,A,x)}createVertexBuffer(A,x,L){return new Fc(this,A,x,L)}createRenderbuffer(A,x,L){const O=this.gl,y=O.createRenderbuffer();return this.bindRenderbuffer.set(y),O.renderbufferStorage(O.RENDERBUFFER,A,x,L),this.bindRenderbuffer.set(null),y}createFramebuffer(A,x,L,O){return new vt(this,A,x,L,O)}clear(A){let{color:x,depth:L,stencil:O}=A;const y=this.gl;let a=0;x&&(a|=y.COLOR_BUFFER_BIT,this.clearColor.set(x),this.colorMask.set([!0,!0,!0,!0])),L!==void 0&&(a|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(L),this.depthMask.set(!0)),O!==void 0&&(a|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(O),this.stencilMask.set(255)),y.clear(a)}setCullFace(A){A.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(A.mode),this.frontFace.set(A.frontFace))}setDepthMode(A){A.func!==this.gl.ALWAYS||A.mask?(this.depthTest.set(!0),this.depthFunc.set(A.func),this.depthMask.set(A.mask),this.depthRange.set(A.range)):this.depthTest.set(!1)}setStencilMode(A){A.test.func!==this.gl.ALWAYS||A.mask?(this.stencilTest.set(!0),this.stencilMask.set(A.mask),this.stencilOp.set([A.fail,A.depthFail,A.pass]),this.stencilFunc.set({func:A.test.func,ref:A.ref,mask:A.test.mask})):this.stencilTest.set(!1)}setColorMode(A){s.aG(A.blendFunction,Tt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(A.blendFunction),this.blendColor.set(A.blendColor)),this.colorMask.set(A.mask)}createVertexArray(){var A;return ho(this.gl)?this.gl.createVertexArray():(A=this.gl.getExtension("OES_vertex_array_object"))===null||A===void 0?void 0:A.createVertexArrayOES()}deleteVertexArray(A){var x;return ho(this.gl)?this.gl.deleteVertexArray(A):(x=this.gl.getExtension("OES_vertex_array_object"))===null||x===void 0?void 0:x.deleteVertexArrayOES(A)}unbindVAO(){this.bindVertexArray.set(null)}}class ri{constructor(A,x,L){this.func=A,this.mask=x,this.range=L}}ri.ReadOnly=!1,ri.ReadWrite=!0,ri.disabled=new ri(519,ri.ReadOnly,[0,1]);const rr=7680;class qi{constructor(A,x,L,O,y,a){this.test=A,this.ref=x,this.mask=L,this.fail=O,this.depthFail=y,this.pass=a}}qi.disabled=new qi({func:519,mask:0},0,0,rr,rr,rr);class ki{constructor(A,x,L){this.enable=A,this.mode=x,this.frontFace=L}}let jr;function nr(N,A,x,L,O,y,a){const d=N.context,_=d.gl,B=N.useProgram("collisionBox"),S=[];let U=0,H=0;for(let W=0;W<L.length;W++){const Y=L[W],ie=A.getTile(Y),ae=ie.getBucket(x);if(!ae)continue;let fe=Y.posMatrix;O[0]===0&&O[1]===0||(fe=N.translatePosMatrix(Y.posMatrix,ie,O,y));const pe=a?ae.textCollisionBox:ae.iconCollisionBox,xe=ae.collisionCircleArray;if(xe.length>0){const Fe=s.Z(),Le=fe;s.aU(Fe,ae.placementInvProjMatrix,N.transform.glCoordMatrix),s.aU(Fe,Fe,ae.placementViewportMatrix),S.push({circleArray:xe,circleOffset:H,transform:Le,invTransform:Fe,coord:Y}),U+=xe.length/4,H=U}pe&&B.draw(d,_.LINES,ri.disabled,qi.disabled,N.colorModeForRenderPass(),ki.disabled,dt(fe,N.transform,ie),N.style.map.terrain&&N.style.map.terrain.getTerrainData(Y),x.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,null,N.transform.zoom,null,null,pe.collisionVertexBuffer)}if(!a||!S.length)return;const q=N.useProgram("collisionCircle"),w=new s.aV;w.resize(4*U),w._trim();let I=0;for(const W of S)for(let Y=0;Y<W.circleArray.length/4;Y++){const ie=4*Y,ae=W.circleArray[ie+0],fe=W.circleArray[ie+1],pe=W.circleArray[ie+2],xe=W.circleArray[ie+3];w.emplace(I++,ae,fe,pe,xe,0),w.emplace(I++,ae,fe,pe,xe,1),w.emplace(I++,ae,fe,pe,xe,2),w.emplace(I++,ae,fe,pe,xe,3)}(!jr||jr.length<2*U)&&(jr=function(W){const Y=2*W,ie=new s.aX;ie.resize(Y),ie._trim();for(let ae=0;ae<Y;ae++){const fe=6*ae;ie.uint16[fe+0]=4*ae+0,ie.uint16[fe+1]=4*ae+1,ie.uint16[fe+2]=4*ae+2,ie.uint16[fe+3]=4*ae+2,ie.uint16[fe+4]=4*ae+3,ie.uint16[fe+5]=4*ae+0}return ie}(U));const R=d.createIndexBuffer(jr,!0),j=d.createVertexBuffer(w,s.aW.members,!0);for(const W of S){const Y={u_matrix:W.transform,u_inv_matrix:W.invTransform,u_camera_to_center_distance:(Z=N.transform).cameraToCenterDistance,u_viewport_size:[Z.width,Z.height]};q.draw(d,_.TRIANGLES,ri.disabled,qi.disabled,N.colorModeForRenderPass(),ki.disabled,Y,N.style.map.terrain&&N.style.map.terrain.getTerrainData(W.coord),x.id,j,R,s.S.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,N.transform.zoom,null,null,null)}var Z;j.destroy(),R.destroy()}ki.disabled=new ki(!1,1029,2305),ki.backCCW=new ki(!0,1029,2305);const Gn=s.ao(new Float32Array(16));function Br(N,A,x,L,O,y){const{horizontalAlign:a,verticalAlign:d}=s.au(N);return new s.P((-(a-.5)*A/O+L[0])*y,(-(d-.5)*x/O+L[1])*y)}function Lr(N,A,x,L,O,y,a,d,_,B,S){const U=N.text.placedSymbolArray,H=N.text.dynamicLayoutVertexArray,q=N.icon.dynamicLayoutVertexArray,w={};H.clear();for(let I=0;I<U.length;I++){const R=U.get(I),j=R.hidden||!R.crossTileID||N.allowVerticalPlacement&&!R.placedOrientation?null:L[R.crossTileID];if(j){const Z=new s.P(R.anchorX,R.anchorY),W=Qt(Z,x?a:y,S),Y=Bi(O.cameraToCenterDistance,W.signedDistanceFromCamera);let ie=s.aj(N.textSizeData,_,R)*Y/s.ap;x&&(ie*=N.tilePixelRatio/d);const{width:ae,height:fe,anchor:pe,textOffset:xe,textBoxScale:Fe}=j,Le=Br(pe,ae,fe,xe,Fe,ie),nt=x?Qt(Z.add(Le),y,S).point:W.point.add(A?Le.rotate(-O.angle):Le),Ke=N.allowVerticalPlacement&&R.placedOrientation===s.ai.vertical?Math.PI/2:0;for(let Re=0;Re<R.numGlyphs;Re++)s.ak(H,nt,Ke);B&&R.associatedIconIndex>=0&&(w[R.associatedIconIndex]={shiftedAnchor:nt,angle:Ke})}else ge(R.numGlyphs,H)}if(B){q.clear();const I=N.icon.placedSymbolArray;for(let R=0;R<I.length;R++){const j=I.get(R);if(j.hidden)ge(j.numGlyphs,q);else{const Z=w[R];if(Z)for(let W=0;W<j.numGlyphs;W++)s.ak(q,Z.shiftedAnchor,Z.angle);else ge(j.numGlyphs,q)}}N.icon.dynamicLayoutVertexBuffer.updateData(q)}N.text.dynamicLayoutVertexBuffer.updateData(H)}function Un(N,A,x){return x.iconsInText&&A?"symbolTextAndIcon":N?"symbolSDF":"symbolIcon"}function $s(N,A,x,L,O,y,a,d,_,B,S,U){const H=N.context,q=H.gl,w=N.transform,I=d==="map",R=_==="map",j=d!=="viewport"&&x.layout.get("symbol-placement")!=="point",Z=I&&!R&&!j,W=!x.layout.get("symbol-sort-key").isConstant();let Y=!1;const ie=N.depthModeForSublayer(0,ri.ReadOnly),ae=x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"),fe=[];for(const pe of L){const xe=A.getTile(pe),Fe=xe.getBucket(x);if(!Fe)continue;const Le=O?Fe.text:Fe.icon;if(!Le||!Le.segments.get().length||!Le.hasVisibleVertices)continue;const nt=Le.programConfigurations.get(x.id),Ke=O||Fe.sdfIcons,Re=O?Fe.textSizeData:Fe.iconSizeData,Qe=R||w.pitch!==0,pt=N.useProgram(Un(Ke,O,Fe),nt),bt=s.ah(Re,w.zoom),ht=N.style.map.terrain&&N.style.map.terrain.getTerrainData(pe);let Rt,Dt,hi,Vt,_i=[0,0],Si=null;if(O)Dt=xe.glyphAtlasTexture,hi=q.LINEAR,Rt=xe.glyphAtlasTexture.size,Fe.iconsInText&&(_i=xe.imageAtlasTexture.size,Si=xe.imageAtlasTexture,Vt=Qe||N.options.rotating||N.options.zooming||Re.kind==="composite"||Re.kind==="camera"?q.LINEAR:q.NEAREST);else{const Nr=x.layout.get("icon-size").constantOr(0)!==1||Fe.iconsNeedLinear;Dt=xe.imageAtlasTexture,hi=Ke||N.options.rotating||N.options.zooming||Nr||Qe?q.LINEAR:q.NEAREST,Rt=xe.imageAtlasTexture.size}const Yi=Pe(xe,1,N.transform.zoom),Ti=$t(pe.posMatrix,R,I,N.transform,Yi),yr=Zi(pe.posMatrix,R,I,N.transform,Yi),fr=ae&&Fe.hasTextData(),ji=x.layout.get("icon-text-fit")!=="none"&&fr&&Fe.hasIconData();if(j){const Nr=N.style.map.terrain?(_r,or)=>N.style.map.terrain.getElevation(pe,_r,or):null,pr=x.layout.get("text-rotation-alignment")==="map";Gt(Fe,pe.posMatrix,N,O,Ti,yr,R,B,pr,Nr)}const Ur=N.translatePosMatrix(pe.posMatrix,xe,y,a),rn=j||O&&ae||ji?Gn:Ti,Mr=N.translatePosMatrix(yr,xe,y,a,!0),Kr=Ke&&x.paint.get(O?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Cr;Cr=Ke?Fe.iconsInText?To(Re.kind,bt,Z,R,N,Ur,rn,Mr,Rt,_i):Yn(Re.kind,bt,Z,R,N,Ur,rn,Mr,O,Rt,!0):Ul(Re.kind,bt,Z,R,N,Ur,rn,Mr,O,Rt);const ts={program:pt,buffers:Le,uniformValues:Cr,atlasTexture:Dt,atlasTextureIcon:Si,atlasInterpolation:hi,atlasInterpolationIcon:Vt,isSDF:Ke,hasHalo:Kr};if(W&&Fe.canOverlap){Y=!0;const Nr=Le.segments.get();for(const pr of Nr)fe.push({segments:new s.S([pr]),sortKey:pr.sortKey,state:ts,terrainData:ht})}else fe.push({segments:Le.segments,sortKey:0,state:ts,terrainData:ht})}Y&&fe.sort((pe,xe)=>pe.sortKey-xe.sortKey);for(const pe of fe){const xe=pe.state;if(H.activeTexture.set(q.TEXTURE0),xe.atlasTexture.bind(xe.atlasInterpolation,q.CLAMP_TO_EDGE),xe.atlasTextureIcon&&(H.activeTexture.set(q.TEXTURE1),xe.atlasTextureIcon&&xe.atlasTextureIcon.bind(xe.atlasInterpolationIcon,q.CLAMP_TO_EDGE)),xe.isSDF){const Fe=xe.uniformValues;xe.hasHalo&&(Fe.u_is_halo=1,to(xe.buffers,pe.segments,x,N,xe.program,ie,S,U,Fe,pe.terrainData)),Fe.u_is_halo=0}to(xe.buffers,pe.segments,x,N,xe.program,ie,S,U,xe.uniformValues,pe.terrainData)}}function to(N,A,x,L,O,y,a,d,_,B){const S=L.context;O.draw(S,S.gl.TRIANGLES,y,a,d,ki.disabled,_,B,x.id,N.layoutVertexBuffer,N.indexBuffer,A,x.paint,L.transform.zoom,N.programConfigurations.get(x.id),N.dynamicLayoutVertexBuffer,N.opacityVertexBuffer)}function Lo(N,A,x,L,O){if(!x||!L||!L.imageAtlas)return;const y=L.imageAtlas.patternPositions;let a=y[x.to.toString()],d=y[x.from.toString()];if(!a&&d&&(a=d),!d&&a&&(d=a),!a||!d){const _=O.getPaintProperty(A);a=y[_],d=y[_]}a&&d&&N.setConstantPatternPositions(a,d)}function Ta(N,A,x,L,O,y,a){const d=N.context.gl,_="fill-pattern",B=x.paint.get(_),S=B&&B.constantOr(1),U=x.getCrossfadeParameters();let H,q,w,I,R;a?(q=S&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=d.LINES):(q=S?"fillPattern":"fill",H=d.TRIANGLES);const j=B.constantOr(null);for(const Z of L){const W=A.getTile(Z);if(S&&!W.patternsLoaded())continue;const Y=W.getBucket(x);if(!Y)continue;const ie=Y.programConfigurations.get(x.id),ae=N.useProgram(q,ie),fe=N.style.map.terrain&&N.style.map.terrain.getTerrainData(Z);S&&(N.context.activeTexture.set(d.TEXTURE0),W.imageAtlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),ie.updatePaintBuffers(U)),Lo(ie,_,j,W,x);const pe=fe?Z:null,xe=N.translatePosMatrix(pe?pe.posMatrix:Z.posMatrix,W,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));if(a){I=Y.indexBuffer2,R=Y.segments2;const Fe=[d.drawingBufferWidth,d.drawingBufferHeight];w=q==="fillOutlinePattern"&&S?Ne(xe,N,U,W,Fe):Ea(xe,Fe)}else I=Y.indexBuffer,R=Y.segments,w=S?uo(xe,N,U,W):ca(xe);ae.draw(N.context,H,O,N.stencilModeForClipping(Z),y,ki.disabled,w,fe,x.id,Y.layoutVertexBuffer,I,R,x.paint,N.transform.zoom,ie)}}function fa(N,A,x,L,O,y,a){const d=N.context,_=d.gl,B="fill-extrusion-pattern",S=x.paint.get(B),U=S.constantOr(1),H=x.getCrossfadeParameters(),q=x.paint.get("fill-extrusion-opacity"),w=S.constantOr(null);for(const I of L){const R=A.getTile(I),j=R.getBucket(x);if(!j)continue;const Z=N.style.map.terrain&&N.style.map.terrain.getTerrainData(I),W=j.programConfigurations.get(x.id),Y=N.useProgram(U?"fillExtrusionPattern":"fillExtrusion",W);U&&(N.context.activeTexture.set(_.TEXTURE0),R.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),W.updatePaintBuffers(H)),Lo(W,B,w,R,x);const ie=N.translatePosMatrix(I.posMatrix,R,x.paint.get("fill-extrusion-translate"),x.paint.get("fill-extrusion-translate-anchor")),ae=x.paint.get("fill-extrusion-vertical-gradient"),fe=U?Gs(ie,N,ae,q,I,H,R):Hr(ie,N,ae,q);Y.draw(d,d.gl.TRIANGLES,O,y,a,ki.backCCW,fe,Z,x.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,x.paint,N.transform.zoom,W,N.style.map.terrain&&j.centroidVertexBuffer)}}function Gl(N,A,x,L,O,y,a){const d=N.context,_=d.gl,B=x.fbo;if(!B)return;const S=N.useProgram("hillshade"),U=N.style.map.terrain&&N.style.map.terrain.getTerrainData(A);d.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,B.colorAttachment.get()),S.draw(d,_.TRIANGLES,O,y,a,ki.disabled,((H,q,w,I)=>{const R=w.paint.get("hillshade-shadow-color"),j=w.paint.get("hillshade-highlight-color"),Z=w.paint.get("hillshade-accent-color");let W=w.paint.get("hillshade-illumination-direction")*(Math.PI/180);w.paint.get("hillshade-illumination-anchor")==="viewport"&&(W-=H.transform.angle);const Y=!H.options.moving;return{u_matrix:I?I.posMatrix:H.transform.calculatePosMatrix(q.tileID.toUnwrapped(),Y),u_image:0,u_latrange:br(0,q.tileID),u_light:[w.paint.get("hillshade-exaggeration"),W],u_shadow:R,u_highlight:j,u_accent:Z}})(N,x,L,U?A:null),U,L.id,N.rasterBoundsBuffer,N.quadTriangleIndexBuffer,N.rasterBoundsSegments)}function hl(N,A,x,L,O,y){const a=N.context,d=a.gl,_=A.dem;if(_&&_.data){const B=_.dim,S=_.stride,U=_.getPixels();if(a.activeTexture.set(d.TEXTURE1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),A.demTexture=A.demTexture||N.getTileTexture(S),A.demTexture){const q=A.demTexture;q.update(U,{premultiply:!1}),q.bind(d.NEAREST,d.CLAMP_TO_EDGE)}else A.demTexture=new it(a,U,d.RGBA,{premultiply:!1}),A.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE);a.activeTexture.set(d.TEXTURE0);let H=A.fbo;if(!H){const q=new it(a,{width:B,height:B,data:null},d.RGBA);q.bind(d.LINEAR,d.CLAMP_TO_EDGE),H=A.fbo=a.createFramebuffer(B,B,!0,!1),H.colorAttachment.set(q.texture)}a.bindFramebuffer.set(H.framebuffer),a.viewport.set([0,0,B,B]),N.useProgram("hillshadePrepare").draw(a,d.TRIANGLES,L,O,y,ki.disabled,((q,w)=>{const I=w.stride,R=s.Z();return s.aS(R,0,s.N,-s.N,0,0,1),s.$(R,R,[0,-s.N,0]),{u_matrix:R,u_image:1,u_dimension:[I,I],u_zoom:q.overscaledZ,u_unpack:w.getUnpackVector()}})(A.tileID,_),null,x.id,N.rasterBoundsBuffer,N.quadTriangleIndexBuffer,N.rasterBoundsSegments),A.needsHillshadePrepare=!1}}function jl(N,A,x,L,O,y){const a=L.paint.get("raster-fade-duration");if(!y&&a>0){const d=s.h.now(),_=(d-N.timeAdded)/a,B=A?(d-A.timeAdded)/a:-1,S=x.getSource(),U=O.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),H=!A||Math.abs(A.tileID.overscaledZ-U)>Math.abs(N.tileID.overscaledZ-U),q=H&&N.refreshedUponExpiration?1:s.ad(H?_:1-B,0,1);return N.refreshedUponExpiration&&_>=1&&(N.refreshedUponExpiration=!1),A?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}const pc=new s.aT(1,0,0,1),pa=new s.aT(0,1,0,1),Fs=new s.aT(0,0,1,1),Al=new s.aT(1,0,1,1),ql=new s.aT(0,1,1,1);function Ia(N,A,x,L){Ds(N,0,A+x/2,N.transform.width,x,L)}function La(N,A,x,L){Ds(N,A-x/2,0,x,N.transform.height,L)}function Ds(N,A,x,L,O,y){const a=N.context,d=a.gl;d.enable(d.SCISSOR_TEST),d.scissor(A*N.pixelRatio,x*N.pixelRatio,L*N.pixelRatio,O*N.pixelRatio),a.clear({color:y}),d.disable(d.SCISSOR_TEST)}function ku(N,A,x){const L=N.context,O=L.gl,y=x.posMatrix,a=N.useProgram("debug"),d=ri.disabled,_=qi.disabled,B=N.colorModeForRenderPass(),S="$debug",U=N.style.map.terrain&&N.style.map.terrain.getTerrainData(x);L.activeTexture.set(O.TEXTURE0);const H=A.getTileByID(x.key).latestRawTileData,q=Math.floor((H&&H.byteLength||0)/1024),w=A.getTile(x).tileSize,I=512/Math.min(w,512)*(x.overscaledZ/N.transform.zoom)*.5;let R=x.canonical.toString();x.overscaledZ!==x.canonical.z&&(R+=` => ${x.overscaledZ}`),function(j,Z){j.initDebugOverlayCanvas();const W=j.debugOverlayCanvas,Y=j.context.gl,ie=j.debugOverlayCanvas.getContext("2d");ie.clearRect(0,0,W.width,W.height),ie.shadowColor="white",ie.shadowBlur=2,ie.lineWidth=1.5,ie.strokeStyle="white",ie.textBaseline="top",ie.font="bold 36px Open Sans, sans-serif",ie.fillText(Z,5,5),ie.strokeText(Z,5,5),j.debugOverlayTexture.update(W),j.debugOverlayTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE)}(N,`${R} ${q}kB`),a.draw(L,O.TRIANGLES,d,_,Tt.alphaBlended,ki.disabled,Ot(y,s.aT.transparent,I),null,S,N.debugBuffer,N.quadTriangleIndexBuffer,N.debugSegments),a.draw(L,O.LINE_STRIP,d,_,B,ki.disabled,Ot(y,s.aT.red),U,S,N.debugBuffer,N.tileBorderIndexBuffer,N.debugSegments)}function Sn(N,A,x){const L=N.context,O=L.gl,y=N.colorModeForRenderPass(),a=new ri(O.LEQUAL,ri.ReadWrite,N.depthRangeFor3D),d=N.useProgram("terrain"),_=A.getTerrainMesh();L.bindFramebuffer.set(null),L.viewport.set([0,0,N.width,N.height]);for(const B of x){const S=N.renderToTexture.getTexture(B),U=A.getTerrainData(B.tileID);L.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,S.texture);const H={u_matrix:N.transform.calculatePosMatrix(B.tileID.toUnwrapped()),u_texture:0,u_ele_delta:A.getMeshFrameDelta(N.transform.zoom)};d.draw(L,O.TRIANGLES,a,qi.disabled,y,ki.backCCW,H,U,"terrain",_.vertexBuffer,_.indexBuffer,_.segments)}}class on{constructor(A,x){this.context=new pi(A),this.transform=x,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.Z(),renderTime:0},this.setup(),this.numSublayers=jt.maxUnderzooming+jt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new gs}resize(A,x,L){if(this.width=Math.floor(A*L),this.height=Math.floor(x*L),this.pixelRatio=L,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const O of this.style._order)this.style._layers[O].resize()}setup(){const A=this.context,x=new s.a_;x.emplaceBack(0,0),x.emplaceBack(s.N,0),x.emplaceBack(0,s.N),x.emplaceBack(s.N,s.N),this.tileExtentBuffer=A.createVertexBuffer(x,Ys.members),this.tileExtentSegments=s.S.simpleSegment(0,0,4,2);const L=new s.a_;L.emplaceBack(0,0),L.emplaceBack(s.N,0),L.emplaceBack(0,s.N),L.emplaceBack(s.N,s.N),this.debugBuffer=A.createVertexBuffer(L,Ys.members),this.debugSegments=s.S.simpleSegment(0,0,4,5);const O=new s.V;O.emplaceBack(0,0,0,0),O.emplaceBack(s.N,0,s.N,0),O.emplaceBack(0,s.N,0,s.N),O.emplaceBack(s.N,s.N,s.N,s.N),this.rasterBoundsBuffer=A.createVertexBuffer(O,It.members),this.rasterBoundsSegments=s.S.simpleSegment(0,0,4,2);const y=new s.a_;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=A.createVertexBuffer(y,Ys.members),this.viewportSegments=s.S.simpleSegment(0,0,4,2);const a=new s.a$;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=A.createIndexBuffer(a);const d=new s.b0;d.emplaceBack(0,1,2),d.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=A.createIndexBuffer(d);const _=this.context.gl;this.stencilClearMode=new qi({func:_.ALWAYS,mask:0},0,255,_.ZERO,_.ZERO,_.ZERO)}clearStencil(){const A=this.context,x=A.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const L=s.Z();s.aS(L,0,this.width,this.height,0,0,1),s.a0(L,L,[x.drawingBufferWidth,x.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(A,x.TRIANGLES,ri.disabled,this.stencilClearMode,Tt.disabled,ki.disabled,ui(L),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(A,x){if(this.currentStencilSource===A.source||!A.isTileClipped()||!x||!x.length)return;this.currentStencilSource=A.source;const L=this.context,O=L.gl;this.nextStencilID+x.length>256&&this.clearStencil(),L.setColorMode(Tt.disabled),L.setDepthMode(ri.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const a of x){const d=this._tileClippingMaskIDs[a.key]=this.nextStencilID++,_=this.style.map.terrain&&this.style.map.terrain.getTerrainData(a);y.draw(L,O.TRIANGLES,ri.disabled,new qi({func:O.ALWAYS,mask:0},d,255,O.KEEP,O.KEEP,O.REPLACE),Tt.disabled,ki.disabled,ui(a.posMatrix),_,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const A=this.nextStencilID++,x=this.context.gl;return new qi({func:x.NOTEQUAL,mask:255},A,255,x.KEEP,x.KEEP,x.REPLACE)}stencilModeForClipping(A){const x=this.context.gl;return new qi({func:x.EQUAL,mask:255},this._tileClippingMaskIDs[A.key],0,x.KEEP,x.KEEP,x.REPLACE)}stencilConfigForOverlap(A){const x=this.context.gl,L=A.sort((a,d)=>d.overscaledZ-a.overscaledZ),O=L[L.length-1].overscaledZ,y=L[0].overscaledZ-O+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const a={};for(let d=0;d<y;d++)a[d+O]=new qi({func:x.GEQUAL,mask:255},d+this.nextStencilID,255,x.KEEP,x.KEEP,x.REPLACE);return this.nextStencilID+=y,[a,L]}return[{[O]:qi.disabled},L]}colorModeForRenderPass(){const A=this.context.gl;return this._showOverdrawInspector?new Tt([A.CONSTANT_COLOR,A.ONE],new s.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Tt.unblended:Tt.alphaBlended}depthModeForSublayer(A,x,L){if(!this.opaquePassEnabledForLayer())return ri.disabled;const O=1-((1+this.currentLayer)*this.numSublayers+A)*this.depthEpsilon;return new ri(L||this.context.gl.LEQUAL,x,[O,O])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(A,x){this.style=A,this.options=x,this.lineAtlas=A.lineAtlas,this.imageManager=A.imageManager,this.glyphManager=A.glyphManager,this.symbolFadeChange=A.placement.symbolFadeChange(s.h.now()),this.imageManager.beginFrame();const L=this.style._order,O=this.style.sourceCaches,y={},a={},d={};for(const _ in O){const B=O[_];B.used&&B.prepare(this.context),y[_]=B.getVisibleCoordinates(),a[_]=y[_].slice().reverse(),d[_]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let _=0;_<L.length;_++)if(this.style._layers[L[_]].is3D()){this.opaquePassCutoff=_;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const _=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||_.length)&&(s.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(B,S){const U=B.context,H=U.gl,q=Tt.unblended,w=new ri(H.LEQUAL,ri.ReadWrite,[0,1]),I=S.getTerrainMesh(),R=S.sourceCache.getRenderableTiles(),j=B.useProgram("terrainDepth");U.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),U.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),U.clear({color:s.aT.transparent,depth:1});for(const Z of R){const W=S.getTerrainData(Z.tileID),Y={u_matrix:B.transform.calculatePosMatrix(Z.tileID.toUnwrapped()),u_ele_delta:S.getMeshFrameDelta(B.transform.zoom)};j.draw(U,H.TRIANGLES,w,qi.disabled,q,ki.backCCW,Y,W,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}U.bindFramebuffer.set(null),U.viewport.set([0,0,B.width,B.height])}(this,this.style.map.terrain),function(B,S){const U=B.context,H=U.gl,q=Tt.unblended,w=new ri(H.LEQUAL,ri.ReadWrite,[0,1]),I=S.getTerrainMesh(),R=S.getCoordsTexture(),j=S.sourceCache.getRenderableTiles(),Z=B.useProgram("terrainCoords");U.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),U.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),U.clear({color:s.aT.transparent,depth:1}),S.coordsIndex=[];for(const W of j){const Y=S.getTerrainData(W.tileID);U.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,R.texture);const ie={u_matrix:B.transform.calculatePosMatrix(W.tileID.toUnwrapped()),u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(B.transform.zoom)};Z.draw(U,H.TRIANGLES,w,qi.disabled,q,ki.backCCW,ie,Y,"terrain",I.vertexBuffer,I.indexBuffer,I.segments),S.coordsIndex.push(W.tileID.key)}U.bindFramebuffer.set(null),U.viewport.set([0,0,B.width,B.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const _ of L){const B=this.style._layers[_];if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const S=a[B.source];(B.type==="custom"||S.length)&&this.renderLayer(this,O[B.source],B,S)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:x.showOverdrawInspector?s.aT.black:s.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=x.showOverdrawInspector,this.depthRangeFor3D=[0,1-(A._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=L.length-1;this.currentLayer>=0;this.currentLayer--){const _=this.style._layers[L[this.currentLayer]],B=O[_.source],S=y[_.source];this._renderTileClippingMasks(_,S),this.renderLayer(this,B,_,S)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const _=this.style._layers[L[this.currentLayer]],B=O[_.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(_))continue;const S=(_.type==="symbol"?d:a)[_.source];this._renderTileClippingMasks(_,y[_.source]),this.renderLayer(this,B,_,S)}if(this.options.showTileBoundaries){const _=function(B,S){let U=null;const H=Object.values(B._layers).flatMap(R=>R.source&&!R.isHidden(S)?[B.sourceCaches[R.source]]:[]),q=H.filter(R=>R.getSource().type==="vector"),w=H.filter(R=>R.getSource().type!=="vector"),I=R=>{(!U||U.getSource().maxzoom<R.getSource().maxzoom)&&(U=R)};return q.forEach(R=>I(R)),U||w.forEach(R=>I(R)),U}(this.style,this.transform.zoom);_&&function(B,S,U){for(let H=0;H<U.length;H++)ku(B,S,U[H])}(this,_,_.getVisibleCoordinates())}this.options.showPadding&&function(_){const B=_.transform.padding;Ia(_,_.transform.height-(B.top||0),3,pc),Ia(_,B.bottom||0,3,pa),La(_,B.left||0,3,Fs),La(_,_.transform.width-(B.right||0),3,Al);const S=_.transform.centerPoint;(function(U,H,q,w){Ds(U,H-1,q-10,2,20,w),Ds(U,H-10,q-1,20,2,w)})(_,S.x,_.transform.height-S.y,ql)}(this),this.context.setDefault()}renderLayer(A,x,L,O){if(!L.isHidden(this.transform.zoom)&&(L.type==="background"||L.type==="custom"||(O||[]).length))switch(this.id=L.id,L.type){case"symbol":(function(y,a,d,_,B){if(y.renderPass!=="translucent")return;const S=qi.disabled,U=y.colorModeForRenderPass();(d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(H,q,w,I,R,j,Z){const W=q.transform,Y=R==="map",ie=j==="map";for(const ae of H){const fe=I.getTile(ae),pe=fe.getBucket(w);if(!pe||!pe.text||!pe.text.segments.get().length)continue;const xe=s.ah(pe.textSizeData,W.zoom),Fe=Pe(fe,1,q.transform.zoom),Le=$t(ae.posMatrix,ie,Y,q.transform,Fe),nt=w.layout.get("icon-text-fit")!=="none"&&pe.hasIconData();if(xe){const Ke=Math.pow(2,W.zoom-fe.tileID.overscaledZ);Lr(pe,Y,ie,Z,W,Le,ae.posMatrix,Ke,xe,nt,q.style.map.terrain?(Re,Qe)=>q.style.map.terrain.getElevation(ae,Re,Qe):null)}}}(_,y,d,a,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),B),d.paint.get("icon-opacity").constantOr(1)!==0&&$s(y,a,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),S,U),d.paint.get("text-opacity").constantOr(1)!==0&&$s(y,a,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),S,U),a.map.showCollisionBoxes&&(nr(y,a,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),nr(y,a,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))})(A,x,L,O,this.style.placement.variableOffsets);break;case"circle":(function(y,a,d,_){if(y.renderPass!=="translucent")return;const B=d.paint.get("circle-opacity"),S=d.paint.get("circle-stroke-width"),U=d.paint.get("circle-stroke-opacity"),H=!d.layout.get("circle-sort-key").isConstant();if(B.constantOr(1)===0&&(S.constantOr(1)===0||U.constantOr(1)===0))return;const q=y.context,w=q.gl,I=y.depthModeForSublayer(0,ri.ReadOnly),R=qi.disabled,j=y.colorModeForRenderPass(),Z=[];for(let W=0;W<_.length;W++){const Y=_[W],ie=a.getTile(Y),ae=ie.getBucket(d);if(!ae)continue;const fe=ae.programConfigurations.get(d.id),pe=y.useProgram("circle",fe),xe=ae.layoutVertexBuffer,Fe=ae.indexBuffer,Le=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Y),nt={programConfiguration:fe,program:pe,layoutVertexBuffer:xe,indexBuffer:Fe,uniformValues:Je(y,Y,ie,d),terrainData:Le};if(H){const Ke=ae.segments.get();for(const Re of Ke)Z.push({segments:new s.S([Re]),sortKey:Re.sortKey,state:nt})}else Z.push({segments:ae.segments,sortKey:0,state:nt})}H&&Z.sort((W,Y)=>W.sortKey-Y.sortKey);for(const W of Z){const{programConfiguration:Y,program:ie,layoutVertexBuffer:ae,indexBuffer:fe,uniformValues:pe,terrainData:xe}=W.state;ie.draw(q,w.TRIANGLES,I,R,j,ki.disabled,pe,xe,d.id,ae,fe,W.segments,d.paint,y.transform.zoom,Y)}})(A,x,L,O);break;case"heatmap":(function(y,a,d,_){if(d.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const B=y.context,S=B.gl,U=qi.disabled,H=new Tt([S.ONE,S.ONE],s.aT.transparent,[!0,!0,!0,!0]);(function(q,w,I){const R=q.gl;q.activeTexture.set(R.TEXTURE1),q.viewport.set([0,0,w.width/4,w.height/4]);let j=I.heatmapFbo;if(j)R.bindTexture(R.TEXTURE_2D,j.colorAttachment.get()),q.bindFramebuffer.set(j.framebuffer);else{const Z=R.createTexture();R.bindTexture(R.TEXTURE_2D,Z),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,R.LINEAR),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,R.LINEAR),j=I.heatmapFbo=q.createFramebuffer(w.width/4,w.height/4,!1,!1),function(W,Y,ie,ae){var fe,pe;const xe=W.gl,Fe=(fe=W.HALF_FLOAT)!==null&&fe!==void 0?fe:xe.UNSIGNED_BYTE,Le=(pe=W.RGBA16F)!==null&&pe!==void 0?pe:xe.RGBA;xe.texImage2D(xe.TEXTURE_2D,0,Le,Y.width/4,Y.height/4,0,xe.RGBA,Fe,null),ae.colorAttachment.set(ie)}(q,w,Z,j)}})(B,y,d),B.clear({color:s.aT.transparent});for(let q=0;q<_.length;q++){const w=_[q];if(a.hasRenderableParent(w))continue;const I=a.getTile(w),R=I.getBucket(d);if(!R)continue;const j=R.programConfigurations.get(d.id),Z=y.useProgram("heatmap",j),{zoom:W}=y.transform;Z.draw(B,S.TRIANGLES,ri.disabled,U,H,ki.disabled,Gi(w.posMatrix,I,W,d.paint.get("heatmap-intensity")),null,d.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,d.paint,y.transform.zoom,j)}B.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(B,S){const U=B.context,H=U.gl,q=S.heatmapFbo;if(!q)return;U.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,q.colorAttachment.get()),U.activeTexture.set(H.TEXTURE1);let w=S.colorRampTexture;w||(w=S.colorRampTexture=new it(U,S.colorRamp,H.RGBA)),w.bind(H.LINEAR,H.CLAMP_TO_EDGE),B.useProgram("heatmapTexture").draw(U,H.TRIANGLES,ri.disabled,qi.disabled,B.colorModeForRenderPass(),ki.disabled,((I,R,j,Z)=>{const W=s.Z();s.aS(W,0,I.width,I.height,0,0,1);const Y=I.context.gl;return{u_matrix:W,u_world:[Y.drawingBufferWidth,Y.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}})(B,S),null,S.id,B.viewportBuffer,B.quadTriangleIndexBuffer,B.viewportSegments,S.paint,B.transform.zoom)}(y,d))})(A,x,L,O);break;case"line":(function(y,a,d,_){if(y.renderPass!=="translucent")return;const B=d.paint.get("line-opacity"),S=d.paint.get("line-width");if(B.constantOr(1)===0||S.constantOr(1)===0)return;const U=y.depthModeForSublayer(0,ri.ReadOnly),H=y.colorModeForRenderPass(),q=d.paint.get("line-dasharray"),w=d.paint.get("line-pattern"),I=w.constantOr(1),R=d.paint.get("line-gradient"),j=d.getCrossfadeParameters(),Z=I?"linePattern":q?"lineSDF":R?"lineGradient":"line",W=y.context,Y=W.gl;let ie=!0;for(const ae of _){const fe=a.getTile(ae);if(I&&!fe.patternsLoaded())continue;const pe=fe.getBucket(d);if(!pe)continue;const xe=pe.programConfigurations.get(d.id),Fe=y.context.program.get(),Le=y.useProgram(Z,xe),nt=ie||Le.program!==Fe,Ke=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ae),Re=w.constantOr(null);if(Re&&fe.imageAtlas){const bt=fe.imageAtlas,ht=bt.patternPositions[Re.to.toString()],Rt=bt.patternPositions[Re.from.toString()];ht&&Rt&&xe.setConstantPatternPositions(ht,Rt)}const Qe=Ke?ae:null,pt=I?rs(y,fe,d,j,Qe):q?wn(y,fe,d,q,j,Qe):R?On(y,fe,d,pe.lineClipsArray.length,Qe):En(y,fe,d,Qe);if(I)W.activeTexture.set(Y.TEXTURE0),fe.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),xe.updatePaintBuffers(j);else if(q&&(nt||y.lineAtlas.dirty))W.activeTexture.set(Y.TEXTURE0),y.lineAtlas.bind(W);else if(R){const bt=pe.gradients[d.id];let ht=bt.texture;if(d.gradientVersion!==bt.version){let Rt=256;if(d.stepInterpolant){const Dt=a.getSource().maxzoom,hi=ae.canonical.z===Dt?Math.ceil(1<<y.transform.maxZoom-ae.canonical.z):1;Rt=s.ad(s.aY(pe.maxLineLength/s.N*1024*hi),256,W.maxTextureSize)}bt.gradient=s.aZ({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Rt,image:bt.gradient||void 0,clips:pe.lineClipsArray}),bt.texture?bt.texture.update(bt.gradient):bt.texture=new it(W,bt.gradient,Y.RGBA),bt.version=d.gradientVersion,ht=bt.texture}W.activeTexture.set(Y.TEXTURE0),ht.bind(d.stepInterpolant?Y.NEAREST:Y.LINEAR,Y.CLAMP_TO_EDGE)}Le.draw(W,Y.TRIANGLES,U,y.stencilModeForClipping(ae),H,ki.disabled,pt,Ke,d.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,d.paint,y.transform.zoom,xe,pe.layoutVertexBuffer2),ie=!1}})(A,x,L,O);break;case"fill":(function(y,a,d,_){const B=d.paint.get("fill-color"),S=d.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const U=y.colorModeForRenderPass(),H=d.paint.get("fill-pattern"),q=y.opaquePassEnabledForLayer()&&!H.constantOr(1)&&B.constantOr(s.aT.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===q){const w=y.depthModeForSublayer(1,y.renderPass==="opaque"?ri.ReadWrite:ri.ReadOnly);Ta(y,a,d,_,w,U,!1)}if(y.renderPass==="translucent"&&d.paint.get("fill-antialias")){const w=y.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,ri.ReadOnly);Ta(y,a,d,_,w,U,!0)}})(A,x,L,O);break;case"fill-extrusion":(function(y,a,d,_){const B=d.paint.get("fill-extrusion-opacity");if(B!==0&&y.renderPass==="translucent"){const S=new ri(y.context.gl.LEQUAL,ri.ReadWrite,y.depthRangeFor3D);if(B!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))fa(y,a,d,_,S,qi.disabled,Tt.disabled),fa(y,a,d,_,S,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const U=y.colorModeForRenderPass();fa(y,a,d,_,S,qi.disabled,U)}}})(A,x,L,O);break;case"hillshade":(function(y,a,d,_){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const B=y.context,S=y.depthModeForSublayer(0,ri.ReadOnly),U=y.colorModeForRenderPass(),[H,q]=y.renderPass==="translucent"?y.stencilConfigForOverlap(_):[{},_];for(const w of q){const I=a.getTile(w);I.needsHillshadePrepare!==void 0&&I.needsHillshadePrepare&&y.renderPass==="offscreen"?hl(y,I,d,S,qi.disabled,U):y.renderPass==="translucent"&&Gl(y,w,I,d,S,H[w.overscaledZ],U)}B.viewport.set([0,0,y.width,y.height])})(A,x,L,O);break;case"raster":(function(y,a,d,_){if(y.renderPass!=="translucent"||d.paint.get("raster-opacity")===0||!_.length)return;const B=y.context,S=B.gl,U=a.getSource(),H=y.useProgram("raster"),q=y.colorModeForRenderPass(),[w,I]=U instanceof Ht?[{},_]:y.stencilConfigForOverlap(_),R=I[I.length-1].overscaledZ,j=!y.options.moving;for(const Z of I){const W=y.depthModeForSublayer(Z.overscaledZ-R,d.paint.get("raster-opacity")===1?ri.ReadWrite:ri.ReadOnly,S.LESS),Y=a.getTile(Z);Y.registerFadeDuration(d.paint.get("raster-fade-duration"));const ie=a.findLoadedParent(Z,0),ae=jl(Y,ie,a,d,y.transform,y.style.map.terrain);let fe,pe;const xe=d.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;B.activeTexture.set(S.TEXTURE0),Y.texture.bind(xe,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),B.activeTexture.set(S.TEXTURE1),ie?(ie.texture.bind(xe,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),fe=Math.pow(2,ie.tileID.overscaledZ-Y.tileID.overscaledZ),pe=[Y.tileID.canonical.x*fe%1,Y.tileID.canonical.y*fe%1]):Y.texture.bind(xe,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST);const Fe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Z),Le=Fe?Z:null,nt=Le?Le.posMatrix:y.transform.calculatePosMatrix(Z.toUnwrapped(),j),Ke=Tr(nt,pe||[0,0],fe||1,ae,d);U instanceof Ht?H.draw(B,S.TRIANGLES,W,qi.disabled,q,ki.disabled,Ke,Fe,d.id,U.boundsBuffer,y.quadTriangleIndexBuffer,U.boundsSegments):H.draw(B,S.TRIANGLES,W,w[Z.overscaledZ],q,ki.disabled,Ke,Fe,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(A,x,L,O);break;case"background":(function(y,a,d,_){const B=d.paint.get("background-color"),S=d.paint.get("background-opacity");if(S===0)return;const U=y.context,H=U.gl,q=y.transform,w=q.tileSize,I=d.paint.get("background-pattern");if(y.isPatternMissing(I))return;const R=!I&&B.a===1&&S===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==R)return;const j=qi.disabled,Z=y.depthModeForSublayer(0,R==="opaque"?ri.ReadWrite:ri.ReadOnly),W=y.colorModeForRenderPass(),Y=y.useProgram(I?"backgroundPattern":"background"),ie=_||q.coveringTiles({tileSize:w,terrain:y.style.map.terrain});I&&(U.activeTexture.set(H.TEXTURE0),y.imageManager.bind(y.context));const ae=d.getCrossfadeParameters();for(const fe of ie){const pe=_?fe.posMatrix:y.transform.calculatePosMatrix(fe.toUnwrapped()),xe=I?ms(pe,S,y,I,{tileID:fe,tileSize:w},ae):Wa(pe,S,B),Fe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(fe);Y.draw(U,H.TRIANGLES,Z,j,W,ki.disabled,xe,Fe,d.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(A,0,L,O);break;case"custom":(function(y,a,d){const _=y.context,B=d.implementation;if(y.renderPass==="offscreen"){const S=B.prerender;S&&(y.setCustomLayerDefaults(),_.setColorMode(y.colorModeForRenderPass()),S.call(B,_.gl,y.transform.customLayerMatrix()),_.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),_.setColorMode(y.colorModeForRenderPass()),_.setStencilMode(qi.disabled);const S=B.renderingMode==="3d"?new ri(y.context.gl.LEQUAL,ri.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,ri.ReadOnly);_.setDepthMode(S),B.render(_.gl,y.transform.customLayerMatrix()),_.setDirty(),y.setBaseState(),_.bindFramebuffer.set(null)}})(A,0,L)}}translatePosMatrix(A,x,L,O,y){if(!L[0]&&!L[1])return A;const a=y?O==="map"?this.transform.angle:0:O==="viewport"?-this.transform.angle:0;if(a){const B=Math.sin(a),S=Math.cos(a);L=[L[0]*S-L[1]*B,L[0]*B+L[1]*S]}const d=[y?L[0]:Pe(x,L[0],this.transform.zoom),y?L[1]:Pe(x,L[1],this.transform.zoom),0],_=new Float32Array(16);return s.$(_,A,d),_}saveTileTexture(A){const x=this._tileTextures[A.size[0]];x?x.push(A):this._tileTextures[A.size[0]]=[A]}getTileTexture(A){const x=this._tileTextures[A];return x&&x.length>0?x.pop():null}isPatternMissing(A){if(!A)return!1;if(!A.from||!A.to)return!0;const x=this.imageManager.getPattern(A.from.toString()),L=this.imageManager.getPattern(A.to.toString());return!x||!L}useProgram(A,x){this.cache=this.cache||{};const L=A+(x?x.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[L]||(this.cache[L]=new Cn(this.context,dr[A],x,ua[A],this._showOverdrawInspector,this.style.map.terrain)),this.cache[L]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const A=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(A.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new it(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:A,drawingBufferHeight:x}=this.context.gl;return this.width!==A||this.height!==x}}class fn{constructor(A,x){this.points=A,this.planes=x}static fromInvProjectionMatrix(A,x,L){const O=Math.pow(2,L),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(d=>{const _=1/(d=s.ag([],d,A))[3]/x*O;return s.b3(d,d,[_,_,1/d[3],_])}),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(d=>{const _=function(H,q){var w=q[0],I=q[1],R=q[2],j=w*w+I*I+R*R;return j>0&&(j=1/Math.sqrt(j)),H[0]=q[0]*j,H[1]=q[1]*j,H[2]=q[2]*j,H}([],function(H,q,w){var I=q[0],R=q[1],j=q[2],Z=w[0],W=w[1],Y=w[2];return H[0]=R*Y-j*W,H[1]=j*Z-I*Y,H[2]=I*W-R*Z,H}([],Ve([],y[d[0]],y[d[1]]),Ve([],y[d[2]],y[d[1]]))),B=-((S=_)[0]*(U=y[d[1]])[0]+S[1]*U[1]+S[2]*U[2]);var S,U;return _.concat(B)});return new fn(y,a)}}class es{constructor(A,x){this.min=A,this.max=x,this.center=function(L,O,y){return L[0]=.5*O[0],L[1]=.5*O[1],L[2]=.5*O[2],L}([],function(L,O,y){return L[0]=O[0]+y[0],L[1]=O[1]+y[1],L[2]=O[2]+y[2],L}([],this.min,this.max))}quadrant(A){const x=[A%2==0,A<2],L=Ee(this.min),O=Ee(this.max);for(let y=0;y<x.length;y++)L[y]=x[y]?this.min[y]:this.center[y],O[y]=x[y]?this.center[y]:this.max[y];return O[2]=this.max[2],new es(L,O)}distanceX(A){return Math.max(Math.min(this.max[0],A[0]),this.min[0])-A[0]}distanceY(A){return Math.max(Math.min(this.max[1],A[1]),this.min[1])-A[1]}intersects(A){const x=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let L=!0;for(let O=0;O<A.planes.length;O++){const y=A.planes[O];let a=0;for(let d=0;d<x.length;d++)s.b4(y,x[d])>=0&&a++;if(a===0)return 0;a!==x.length&&(L=!1)}if(L)return 2;for(let O=0;O<3;O++){let y=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let d=0;d<A.points.length;d++){const _=A.points[d][O]-this.min[O];y=Math.min(y,_),a=Math.max(a,_)}if(a<0||y>this.max[O]-this.min[O])return 0}return 1}}class dl{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(A)||A<0||isNaN(x)||x<0||isNaN(L)||L<0||isNaN(O)||O<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=A,this.bottom=x,this.left=L,this.right=O}interpolate(A,x,L){return x.top!=null&&A.top!=null&&(this.top=s.B.number(A.top,x.top,L)),x.bottom!=null&&A.bottom!=null&&(this.bottom=s.B.number(A.bottom,x.bottom,L)),x.left!=null&&A.left!=null&&(this.left=s.B.number(A.left,x.left,L)),x.right!=null&&A.right!=null&&(this.right=s.B.number(A.right,x.right,L)),this}getCenter(A,x){const L=s.ad((this.left+A-this.right)/2,0,A),O=s.ad((this.top+x-this.bottom)/2,0,x);return new s.P(L,O)}equals(A){return this.top===A.top&&this.bottom===A.bottom&&this.left===A.left&&this.right===A.right}clone(){return new dl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class fl{constructor(A,x,L,O,y){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=y===void 0||!!y,this._minZoom=A||0,this._maxZoom=x||22,this._minPitch=L??0,this._maxPitch=O??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new dl,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const A=new fl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return A.apply(this),A}apply(A){this.tileSize=A.tileSize,this.latRange=A.latRange,this.width=A.width,this.height=A.height,this._center=A._center,this._elevation=A._elevation,this._minEleveationForCurrentTile=A._minEleveationForCurrentTile,this.zoom=A.zoom,this.angle=A.angle,this._fov=A._fov,this._pitch=A._pitch,this._unmodified=A._unmodified,this._edgeInsets=A._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(A){this._minZoom!==A&&(this._minZoom=A,this.zoom=Math.max(this.zoom,A))}get maxZoom(){return this._maxZoom}set maxZoom(A){this._maxZoom!==A&&(this._maxZoom=A,this.zoom=Math.min(this.zoom,A))}get minPitch(){return this._minPitch}set minPitch(A){this._minPitch!==A&&(this._minPitch=A,this.pitch=Math.max(this.pitch,A))}get maxPitch(){return this._maxPitch}set maxPitch(A){this._maxPitch!==A&&(this._maxPitch=A,this.pitch=Math.min(this.pitch,A))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(A){A===void 0?A=!0:A===null&&(A=!1),this._renderWorldCopies=A}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(A){const x=-s.b5(A,-180,180)*Math.PI/180;this.angle!==x&&(this._unmodified=!1,this.angle=x,this._calcMatrices(),this.rotationMatrix=function(){var L=new s.A(4);return s.A!=Float32Array&&(L[1]=0,L[2]=0),L[0]=1,L[3]=1,L}(),function(L,O,y){var a=O[0],d=O[1],_=O[2],B=O[3],S=Math.sin(y),U=Math.cos(y);L[0]=a*U+_*S,L[1]=d*U+B*S,L[2]=a*-S+_*U,L[3]=d*-S+B*U}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(A){const x=s.ad(A,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==x&&(this._unmodified=!1,this._pitch=x,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(A){A=Math.max(.01,Math.min(60,A)),this._fov!==A&&(this._unmodified=!1,this._fov=A/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(A){const x=Math.min(Math.max(A,this.minZoom),this.maxZoom);this._zoom!==x&&(this._unmodified=!1,this._zoom=x,this.tileZoom=Math.max(0,Math.floor(x)),this.scale=this.zoomScale(x),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(A){A.lat===this._center.lat&&A.lng===this._center.lng||(this._unmodified=!1,this._center=A,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(A){A!==this._elevation&&(this._elevation=A,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(A){this._edgeInsets.equals(A)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,A,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(A){return this._edgeInsets.equals(A)}interpolatePadding(A,x,L){this._unmodified=!1,this._edgeInsets.interpolate(A,x,L),this._constrain(),this._calcMatrices()}coveringZoomLevel(A){const x=(A.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/A.tileSize));return Math.max(0,x)}getVisibleUnwrappedCoordinates(A){const x=[new s.b6(0,A)];if(this._renderWorldCopies){const L=this.pointCoordinate(new s.P(0,0)),O=this.pointCoordinate(new s.P(this.width,0)),y=this.pointCoordinate(new s.P(this.width,this.height)),a=this.pointCoordinate(new s.P(0,this.height)),d=Math.floor(Math.min(L.x,O.x,y.x,a.x)),_=Math.floor(Math.max(L.x,O.x,y.x,a.x)),B=1;for(let S=d-B;S<=_+B;S++)S!==0&&x.push(new s.b6(S,A))}return x}coveringTiles(A){var x,L;let O=this.coveringZoomLevel(A);const y=O;if(A.minzoom!==void 0&&O<A.minzoom)return[];A.maxzoom!==void 0&&O>A.maxzoom&&(O=A.maxzoom);const a=this.pointCoordinate(this.getCameraPoint()),d=s.U.fromLngLat(this.center),_=Math.pow(2,O),B=[_*a.x,_*a.y,0],S=[_*d.x,_*d.y,0],U=fn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,O);let H=A.minzoom||0;!A.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(H=O);const q=A.terrain?2/Math.min(this.tileSize,A.tileSize)*this.tileSize:3,w=W=>({aabb:new es([W*_,0,0],[(W+1)*_,_,0]),zoom:0,x:0,y:0,wrap:W,fullyVisible:!1}),I=[],R=[],j=O,Z=A.reparseOverscaled?y:O;if(this._renderWorldCopies)for(let W=1;W<=3;W++)I.push(w(-W)),I.push(w(W));for(I.push(w(0));I.length>0;){const W=I.pop(),Y=W.x,ie=W.y;let ae=W.fullyVisible;if(!ae){const Le=W.aabb.intersects(U);if(Le===0)continue;ae=Le===2}const fe=A.terrain?B:S,pe=W.aabb.distanceX(fe),xe=W.aabb.distanceY(fe),Fe=Math.max(Math.abs(pe),Math.abs(xe));if(W.zoom===j||Fe>q+(1<<j-W.zoom)-2&&W.zoom>=H){const Le=j-W.zoom,nt=B[0]-.5-(Y<<Le),Ke=B[1]-.5-(ie<<Le);R.push({tileID:new s.O(W.zoom===j?Z:W.zoom,W.wrap,W.zoom,Y,ie),distanceSq:qe([S[0]-.5-Y,S[1]-.5-ie]),tileDistanceToCamera:Math.sqrt(nt*nt+Ke*Ke)})}else for(let Le=0;Le<4;Le++){const nt=(Y<<1)+Le%2,Ke=(ie<<1)+(Le>>1),Re=W.zoom+1;let Qe=W.aabb.quadrant(Le);if(A.terrain){const pt=new s.O(Re,W.wrap,Re,nt,Ke),bt=A.terrain.getMinMaxElevation(pt),ht=(x=bt.minElevation)!==null&&x!==void 0?x:this.elevation,Rt=(L=bt.maxElevation)!==null&&L!==void 0?L:this.elevation;Qe=new es([Qe.min[0],Qe.min[1],ht],[Qe.max[0],Qe.max[1],Rt])}I.push({aabb:Qe,zoom:Re,x:nt,y:Ke,wrap:W.wrap,fullyVisible:ae})}}return R.sort((W,Y)=>W.distanceSq-Y.distanceSq).map(W=>W.tileID)}resize(A,x){this.width=A,this.height=x,this.pixelsToGLUnits=[2/A,-2/x],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(A){return Math.pow(2,A)}scaleZoom(A){return Math.log(A)/Math.LN2}project(A){const x=s.ad(A.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.P(s.G(A.lng)*this.worldSize,s.H(x)*this.worldSize)}unproject(A){return new s.U(A.x/this.worldSize,A.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(A){const x=this.pointLocation(this.centerPoint,A),L=A.getElevationForLngLatZoom(x,this.tileZoom);if(!(this.elevation-L))return;const O=this.getCameraPosition(),y=s.U.fromLngLat(O.lngLat,O.altitude),a=s.U.fromLngLat(x,L),d=y.x-a.x,_=y.y-a.y,B=y.z-a.z,S=Math.sqrt(d*d+_*_+B*B),U=this.scaleZoom(this.cameraToCenterDistance/S/this.tileSize);this._elevation=L,this._center=x,this.zoom=U}setLocationAtPoint(A,x){const L=this.pointCoordinate(x),O=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(A),a=new s.U(y.x-(L.x-O.x),y.y-(L.y-O.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(A,x){return x?this.coordinatePoint(this.locationCoordinate(A),x.getElevationForLngLatZoom(A,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(A))}pointLocation(A,x){return this.coordinateLocation(this.pointCoordinate(A,x))}locationCoordinate(A){return s.U.fromLngLat(A)}coordinateLocation(A){return A&&A.toLngLat()}pointCoordinate(A,x){if(x){const H=x.pointCoordinate(A);if(H!=null)return H}const L=[A.x,A.y,0,1],O=[A.x,A.y,1,1];s.ag(L,L,this.pixelMatrixInverse),s.ag(O,O,this.pixelMatrixInverse);const y=L[3],a=O[3],d=L[1]/y,_=O[1]/a,B=L[2]/y,S=O[2]/a,U=B===S?0:(0-B)/(S-B);return new s.U(s.B.number(L[0]/y,O[0]/a,U)/this.worldSize,s.B.number(d,_,U)/this.worldSize)}coordinatePoint(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const O=[A.x*this.worldSize,A.y*this.worldSize,x,1];return s.ag(O,O,L),new s.P(O[0]/O[3],O[1]/O[3])}getBounds(){const A=Math.max(0,this.height/2-this.getHorizon());return new Xe().extend(this.pointLocation(new s.P(0,A))).extend(this.pointLocation(new s.P(this.width,A))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Xe([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(A){A?(this.lngRange=[A.getWest(),A.getEast()],this.latRange=[A.getSouth(),A.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const L=A.key,O=x?this._alignedPosMatrixCache:this._posMatrixCache;if(O[L])return O[L];const y=A.canonical,a=this.worldSize/this.zoomScale(y.z),d=y.x+Math.pow(2,y.z)*A.wrap,_=s.ao(new Float64Array(16));return s.$(_,_,[d*a,y.y*a,0]),s.a0(_,_,[a/s.N,a/s.N,1]),s.a1(_,x?this.alignedProjMatrix:this.projMatrix,_),O[L]=new Float32Array(_),O[L]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let A,x,L,O,y=-90,a=90,d=-180,_=180;const B=this.size,S=this._unmodified;if(this.latRange){const q=this.latRange;y=s.H(q[1])*this.worldSize,a=s.H(q[0])*this.worldSize,A=a-y<B.y?B.y/(a-y):0}if(this.lngRange){const q=this.lngRange;d=s.b5(s.G(q[0])*this.worldSize,0,this.worldSize),_=s.b5(s.G(q[1])*this.worldSize,0,this.worldSize),_<d&&(_+=this.worldSize),x=_-d<B.x?B.x/(_-d):0}const U=this.point,H=Math.max(x||0,A||0);if(H)return this.center=this.unproject(new s.P(x?(_+d)/2:U.x,A?(a+y)/2:U.y)),this.zoom+=this.scaleZoom(H),this._unmodified=S,void(this._constraining=!1);if(this.latRange){const q=U.y,w=B.y/2;q-w<y&&(O=y+w),q+w>a&&(O=a-w)}if(this.lngRange){const q=(d+_)/2,w=s.b5(U.x,q-this.worldSize/2,q+this.worldSize/2),I=B.x/2;w-I<d&&(L=d+I),w+I>_&&(L=_-I)}L===void 0&&O===void 0||(this.center=this.unproject(new s.P(L!==void 0?L:U.x,O!==void 0?O:U.y)).wrap()),this._unmodified=S,this._constraining=!1}_calcMatrices(){if(!this.height)return;const A=this.centerOffset,x=this.point.x,L=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b7(1,this.center.lat)*this.worldSize;let O=s.ao(new Float64Array(16));s.a0(O,O,[this.width/2,-this.height/2,1]),s.$(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=s.ao(new Float64Array(16)),s.a0(O,O,[1,-1,1]),s.$(O,O,[-1,-1,0]),s.a0(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),a=Math.min(this.elevation,this._minEleveationForCurrentTile),d=y-a*this._pixelPerMeter/Math.cos(this._pitch),_=a<0?d:y,B=Math.PI/2+this._pitch,S=this._fov*(.5+A.y/this.height),U=Math.sin(S)*_/Math.sin(s.ad(Math.PI-B-S,.01,Math.PI-.01)),H=this.getHorizon(),q=2*Math.atan(H/this.cameraToCenterDistance)*(.5+A.y/(2*H)),w=Math.sin(q)*_/Math.sin(s.ad(Math.PI-B-q,.01,Math.PI-.01)),I=Math.min(U,w),R=1.01*(Math.cos(Math.PI/2-this._pitch)*I+_),j=this.height/50;O=new Float64Array(16),s.b8(O,this._fov,this.width/this.height,j,R),O[8]=2*-A.x/this.width,O[9]=2*A.y/this.height,s.a0(O,O,[1,-1,1]),s.$(O,O,[0,0,-this.cameraToCenterDistance]),s.b9(O,O,this._pitch),s.ae(O,O,this.angle),s.$(O,O,[-x,-L,0]),this.mercatorMatrix=s.a0([],O,[this.worldSize,this.worldSize,this.worldSize]),s.a0(O,O,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.a1(new Float64Array(16),this.labelPlaneMatrix,O),s.$(O,O,[0,0,-this.elevation]),this.projMatrix=O,this.invProjMatrix=s.as([],O),this.pixelMatrix3D=s.a1(new Float64Array(16),this.labelPlaneMatrix,O);const Z=this.width%2/2,W=this.height%2/2,Y=Math.cos(this.angle),ie=Math.sin(this.angle),ae=x-Math.round(x)+Y*Z+ie*W,fe=L-Math.round(L)+Y*W+ie*Z,pe=new Float64Array(O);if(s.$(pe,pe,[ae>.5?ae-1:ae,fe>.5?fe-1:fe,0]),this.alignedProjMatrix=pe,O=s.as(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");this.pixelMatrixInverse=O,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const A=this.pointCoordinate(new s.P(0,0)),x=[A.x*this.worldSize,A.y*this.worldSize,0,1];return s.ag(x,x,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const A=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,A))}getCameraQueryGeometry(A){const x=this.getCameraPoint();if(A.length===1)return[A[0],x];{let L=x.x,O=x.y,y=x.x,a=x.y;for(const d of A)L=Math.min(L,d.x),O=Math.min(O,d.y),y=Math.max(y,d.x),a=Math.max(a,d.y);return[new s.P(L,O),new s.P(y,O),new s.P(y,a),new s.P(L,a),new s.P(L,O)]}}}function fo(N,A){var x=this;let L,O=!1,y=null,a=null;const d=()=>{y=null,O&&(N.apply(a,L),y=setTimeout(d,A),O=!1)};return function(){for(var _=arguments.length,B=new Array(_),S=0;S<_;S++)B[S]=arguments[S];return O=!0,a=x,L=B,y||d(),y}}class ss{constructor(A){this._getCurrentHash=()=>{const x=window.location.hash.replace("#","");if(this._hashName){let L;return x.split("&").map(O=>O.split("=")).forEach(O=>{O[0]===this._hashName&&(L=O)}),(L&&L[1]||"").split("/")}return x.split("/")},this._onHashChange=()=>{const x=this._getCurrentHash();if(x.length>=3&&!x.some(L=>isNaN(L))){const L=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(x[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+x[2],+x[1]],zoom:+x[0],bearing:L,pitch:+(x[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const x=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,x)}catch{}},this._updateHash=fo(this._updateHashUnthrottled,300),this._hashName=A&&encodeURIComponent(A)}addTo(A){return this._map=A,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(A){const x=this._map.getCenter(),L=Math.round(100*this._map.getZoom())/100,O=Math.ceil((L*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,O),a=Math.round(x.lng*y)/y,d=Math.round(x.lat*y)/y,_=this._map.getBearing(),B=this._map.getPitch();let S="";if(S+=A?`/${a}/${d}/${L}`:`${L}/${d}/${a}`,(_||B)&&(S+="/"+Math.round(10*_)/10),B&&(S+=`/${Math.round(B)}`),this._hashName){const U=this._hashName;let H=!1;const q=window.location.hash.slice(1).split("&").map(w=>{const I=w.split("=")[0];return I===U?(H=!0,`${I}=${S}`):w}).filter(w=>w);return H||q.push(`${U}=${S}`),`#${q.join("&")}`}return`#${S}`}}const os={linearity:.3,easing:s.ba(0,0,.3,1)},Mo=s.e({deceleration:2500,maxSpeed:1400},os),Po=s.e({deceleration:20,maxSpeed:1400},os),ga=s.e({deceleration:1e3,maxSpeed:360},os),pl=s.e({deceleration:1e3,maxSpeed:90},os);class io{constructor(A){this._map=A,this.clear()}clear(){this._inertiaBuffer=[]}record(A){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.h.now(),settings:A})}_drainInertiaBuffer(){const A=this._inertiaBuffer,x=s.h.now();for(;A.length>0&&x-A[0].time>160;)A.shift()}_onMoveEnd(A){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const x={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)x.zoom+=y.zoomDelta||0,x.bearing+=y.bearingDelta||0,x.pitch+=y.pitchDelta||0,y.panDelta&&x.pan._add(y.panDelta),y.around&&(x.around=y.around),y.pinchAround&&(x.pinchAround=y.pinchAround);const L=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,O={};if(x.pan.mag()){const y=po(x.pan.mag(),L,s.e({},Mo,A||{}));O.offset=x.pan.mult(y.amount/x.pan.mag()),O.center=this._map.transform.center,ro(O,y)}if(x.zoom){const y=po(x.zoom,L,Po);O.zoom=this._map.transform.zoom+y.amount,ro(O,y)}if(x.bearing){const y=po(x.bearing,L,ga);O.bearing=this._map.transform.bearing+s.ad(y.amount,-179,179),ro(O,y)}if(x.pitch){const y=po(x.pitch,L,pl);O.pitch=this._map.transform.pitch+y.amount,ro(O,y)}if(O.zoom||O.bearing){const y=x.pinchAround===void 0?x.around:x.pinchAround;O.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),s.e(O,{noMoveStart:!0})}}function ro(N,A){(!N.duration||N.duration<A.duration)&&(N.duration=A.duration,N.easing=A.easing)}function po(N,A,x){const{maxSpeed:L,linearity:O,deceleration:y}=x,a=s.ad(N*O/(A/1e3),-L,L),d=Math.abs(a)/(y*O);return{easing:x.easing,duration:1e3*d,amount:a*(d/2)}}class ys extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const y=b.mousePos(x.getCanvasContainer(),L),a=x.unproject(y);super(A,s.e({point:y,lngLat:a,originalEvent:L},O)),this._defaultPrevented=!1,this.target=x}}class no extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,x,L){const O=A==="touchend"?L.changedTouches:L.touches,y=b.touchPos(x.getCanvasContainer(),O),a=y.map(_=>x.unproject(_)),d=y.reduce((_,B,S,U)=>_.add(B.div(U.length)),new s.P(0,0));super(A,{points:y,point:d,lngLats:a,lngLat:x.unproject(d),originalEvent:L}),this._defaultPrevented=!1}}class Ma extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,x,L){super(A,{originalEvent:L}),this._defaultPrevented=!1}}class ma{constructor(A,x){this._map=A,this._clickTolerance=x.clickTolerance}reset(){delete this._mousedownPos}wheel(A){return this._firePreventable(new Ma(A.type,this._map,A))}mousedown(A,x){return this._mousedownPos=x,this._firePreventable(new ys(A.type,this._map,A))}mouseup(A){this._map.fire(new ys(A.type,this._map,A))}click(A,x){this._mousedownPos&&this._mousedownPos.dist(x)>=this._clickTolerance||this._map.fire(new ys(A.type,this._map,A))}dblclick(A){return this._firePreventable(new ys(A.type,this._map,A))}mouseover(A){this._map.fire(new ys(A.type,this._map,A))}mouseout(A){this._map.fire(new ys(A.type,this._map,A))}touchstart(A){return this._firePreventable(new no(A.type,this._map,A))}touchmove(A){this._map.fire(new no(A.type,this._map,A))}touchend(A){this._map.fire(new no(A.type,this._map,A))}touchcancel(A){this._map.fire(new no(A.type,this._map,A))}_firePreventable(A){if(this._map.fire(A),A.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pa{constructor(A){this._map=A}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(A){this._map.fire(new ys(A.type,this._map,A))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ys("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(A){this._delayContextMenu?this._contextMenuEvent=A:this._ignoreContextMenu||this._map.fire(new ys(A.type,this._map,A)),this._map.listens("contextmenu")&&A.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tn{constructor(A){this._map=A}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(A){return this.transform.pointLocation(s.P.convert(A),this._map.terrain)}}class Fo{constructor(A,x){this._map=A,this._tr=new Tn(A),this._el=A.getCanvasContainer(),this._container=A.getContainer(),this._clickTolerance=x.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(A,x){this.isEnabled()&&A.shiftKey&&A.button===0&&(b.disableDrag(),this._startPos=this._lastPos=x,this._active=!0)}mousemoveWindow(A,x){if(!this._active)return;const L=x;if(this._lastPos.equals(L)||!this._box&&L.dist(this._startPos)<this._clickTolerance)return;const O=this._startPos;this._lastPos=L,this._box||(this._box=b.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",A));const y=Math.min(O.x,L.x),a=Math.max(O.x,L.x),d=Math.min(O.y,L.y),_=Math.max(O.y,L.y);b.setTransform(this._box,`translate(${y}px,${d}px)`),this._box.style.width=a-y+"px",this._box.style.height=_-d+"px"}mouseupWindow(A,x){if(!this._active||A.button!==0)return;const L=this._startPos,O=x;if(this.reset(),b.suppressClick(),L.x!==O.x||L.y!==O.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:A})),{cameraAnimation:y=>y.fitScreenCoordinates(L,O,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",A)}keydown(A){this._active&&A.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",A))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(b.remove(this._box),this._box=null),b.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(A,x){return this._map.fire(new s.k(A,{originalEvent:x}))}}function As(N,A){if(N.length!==A.length)throw new Error(`The number of touches and points are not equal - touches ${N.length}, points ${A.length}`);const x={};for(let L=0;L<N.length;L++)x[N[L].identifier]=A[L];return x}class _s{constructor(A){this.reset(),this.numTouches=A.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(A,x,L){(this.centroid||L.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=A.timeStamp),L.length===this.numTouches&&(this.centroid=function(O){const y=new s.P(0,0);for(const a of O)y._add(a);return y.div(O.length)}(x),this.touches=As(L,x)))}touchmove(A,x,L){if(this.aborted||!this.centroid)return;const O=As(L,x);for(const y in this.touches){const a=O[y];(!a||a.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(A,x,L){if((!this.centroid||A.timeStamp-this.startTime>500)&&(this.aborted=!0),L.length===0){const O=!this.aborted&&this.centroid;if(this.reset(),O)return O}}}class ds{constructor(A){this.singleTap=new _s(A),this.numTaps=A.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(A,x,L){this.singleTap.touchstart(A,x,L)}touchmove(A,x,L){this.singleTap.touchmove(A,x,L)}touchend(A,x,L){const O=this.singleTap.touchend(A,x,L);if(O){const y=A.timeStamp-this.lastTime<500,a=!this.lastTap||this.lastTap.dist(O)<30;if(y&&a||this.reset(),this.count++,this.lastTime=A.timeStamp,this.lastTap=O,this.count===this.numTaps)return this.reset(),O}}}class Ir{constructor(A){this._tr=new Tn(A),this._zoomIn=new ds({numTouches:1,numTaps:2}),this._zoomOut=new ds({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(A,x,L){this._zoomIn.touchstart(A,x,L),this._zoomOut.touchstart(A,x,L)}touchmove(A,x,L){this._zoomIn.touchmove(A,x,L),this._zoomOut.touchmove(A,x,L)}touchend(A,x,L){const O=this._zoomIn.touchend(A,x,L),y=this._zoomOut.touchend(A,x,L),a=this._tr;return O?(this._active=!0,A.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:d=>d.easeTo({duration:300,zoom:a.zoom+1,around:a.unproject(O)},{originalEvent:A})}):y?(this._active=!0,A.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:d=>d.easeTo({duration:300,zoom:a.zoom-1,around:a.unproject(y)},{originalEvent:A})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zr{constructor(A){this._enabled=!!A.enable,this._moveStateManager=A.moveStateManager,this._clickTolerance=A.clickTolerance||1,this._moveFunction=A.move,this._activateOnStart=!!A.activateOnStart,A.assignEvents(this),this.reset()}reset(A){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(A)}_move(){const A=this._moveFunction(...arguments);if(A.bearingDelta||A.pitchDelta||A.around||A.panDelta)return this._active=!0,A}dragStart(A,x){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(A)&&(this._moveStateManager.startMove(A),this._lastPoint=x.length?x[0]:x,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(A,x){if(!this.isEnabled())return;const L=this._lastPoint;if(!L)return;if(A.preventDefault(),!this._moveStateManager.isValidMoveEvent(A))return void this.reset(A);const O=x.length?x[0]:x;return!this._moved&&O.dist(L)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=O,this._move(L,O))}dragEnd(A){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(A)&&(this._moved&&b.suppressClick(),this.reset(A))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const an={0:1,2:2};class jn{constructor(A){this._correctEvent=A.checkCorrectEvent}startMove(A){const x=b.mouseButton(A);this._eventButton=x}endMove(A){delete this._eventButton}isValidStartEvent(A){return this._correctEvent(A)}isValidMoveEvent(A){return!function(x,L){const O=an[L];return x.buttons===void 0||(x.buttons&O)!==O}(A,this._eventButton)}isValidEndEvent(A){return b.mouseButton(A)===this._eventButton}}class ya{constructor(){this._firstTouch=void 0}_isOneFingerTouch(A){return A.targetTouches.length===1}_isSameTouchEvent(A){return A.targetTouches[0].identifier===this._firstTouch}startMove(A){this._firstTouch=A.targetTouches[0].identifier}endMove(A){delete this._firstTouch}isValidStartEvent(A){return this._isOneFingerTouch(A)}isValidMoveEvent(A){return this._isOneFingerTouch(A)&&this._isSameTouchEvent(A)}isValidEndEvent(A){return this._isOneFingerTouch(A)&&this._isSameTouchEvent(A)}}const Fa=N=>{N.mousedown=N.dragStart,N.mousemoveWindow=N.dragMove,N.mouseup=N.dragEnd,N.contextmenu=function(A){A.preventDefault()}},go=N=>{let{enable:A,clickTolerance:x,bearingDegreesPerPixelMoved:L=.8}=N;const O=new jn({checkCorrectEvent:y=>b.mouseButton(y)===0&&y.ctrlKey||b.mouseButton(y)===2});return new Zr({clickTolerance:x,move:(y,a)=>({bearingDelta:(a.x-y.x)*L}),moveStateManager:O,enable:A,assignEvents:Fa})},Zo=N=>{let{enable:A,clickTolerance:x,pitchDegreesPerPixelMoved:L=-.5}=N;const O=new jn({checkCorrectEvent:y=>b.mouseButton(y)===0&&y.ctrlKey||b.mouseButton(y)===2});return new Zr({clickTolerance:x,move:(y,a)=>({pitchDelta:(a.y-y.y)*L}),moveStateManager:O,enable:A,assignEvents:Fa})};class Oi{constructor(A,x){this._minTouches=A.cooperativeGestures?2:1,this._clickTolerance=A.clickTolerance||1,this._map=x,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(A,x,L){return this._calculateTransform(A,x,L)}touchmove(A,x,L){if(this._map._cooperativeGestures&&(this._minTouches===2&&L.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(A,!1,L.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(L.length<this._minTouches))return A.preventDefault(),this._calculateTransform(A,x,L)}touchend(A,x,L){this._calculateTransform(A,x,L),this._active&&L.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(A,x,L){L.length>0&&(this._active=!0);const O=As(L,x),y=new s.P(0,0),a=new s.P(0,0);let d=0;for(const B in O){const S=O[B],U=this._touches[B];U&&(y._add(S),a._add(S.sub(U)),d++,O[B]=S)}if(this._touches=O,d<this._minTouches||!a.mag())return;const _=a.div(d);return this._sum._add(_),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(d),panDelta:_}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(A,x,L){this._firstTwoTouches||L.length<2||(this._firstTwoTouches=[L[0].identifier,L[1].identifier],this._start([x[0],x[1]]))}touchmove(A,x,L){if(!this._firstTwoTouches)return;A.preventDefault();const[O,y]=this._firstTwoTouches,a=Pi(L,x,O),d=Pi(L,x,y);if(!a||!d)return;const _=this._aroundCenter?null:a.add(d).div(2);return this._move([a,d],_,A)}touchend(A,x,L){if(!this._firstTwoTouches)return;const[O,y]=this._firstTwoTouches,a=Pi(L,x,O),d=Pi(L,x,y);a&&d||(this._active&&b.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(A){this._enabled=!0,this._aroundCenter=!!A&&A.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Pi(N,A,x){for(let L=0;L<N.length;L++)if(N[L].identifier===x)return A[L]}function gl(N,A){return Math.log(N/A)/Math.LN2}class $l extends Jo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(A){this._startDistance=this._distance=A[0].dist(A[1])}_move(A,x){const L=this._distance;if(this._distance=A[0].dist(A[1]),this._active||!(Math.abs(gl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:gl(this._distance,L),pinchAround:x}}}function Li(N,A){return 180*N.angleWith(A)/Math.PI}class Kl extends Jo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(A){this._startVector=this._vector=A[0].sub(A[1]),this._minDiameter=A[0].dist(A[1])}_move(A,x){const L=this._vector;if(this._vector=A[0].sub(A[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Li(this._vector,L),pinchAround:x}}_isBelowThreshold(A){this._minDiameter=Math.min(this._minDiameter,A.mag());const x=25/(Math.PI*this._minDiameter)*360,L=Li(A,this._startVector);return Math.abs(L)<x}}function Ei(N){return Math.abs(N.y)>Math.abs(N.x)}class so extends Jo{constructor(A){super(),this._map=A}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(A,x,L){super.touchstart(A,x,L),this._currentTouchCount=L.length}_start(A){this._lastPoints=A,Ei(A[0].sub(A[1]))&&(this._valid=!1)}_move(A,x,L){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const O=A[0].sub(this._lastPoints[0]),y=A[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(O,y,L.timeStamp),this._valid?(this._lastPoints=A,this._active=!0,{pitchDelta:(O.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(A,x,L){if(this._valid!==void 0)return this._valid;const O=A.mag()>=2,y=x.mag()>=2;if(!O&&!y)return;if(!O||!y)return this._firstMove===void 0&&(this._firstMove=L),L-this._firstMove<100&&void 0;const a=A.y>0==x.y>0;return Ei(A)&&Ei(x)&&a}}const mo={panStep:100,bearingStep:15,pitchStep:10};class Rc{constructor(A){this._tr=new Tn(A);const x=mo;this._panStep=x.panStep,this._bearingStep=x.bearingStep,this._pitchStep=x.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(A){if(A.altKey||A.ctrlKey||A.metaKey)return;let x=0,L=0,O=0,y=0,a=0;switch(A.keyCode){case 61:case 107:case 171:case 187:x=1;break;case 189:case 109:case 173:x=-1;break;case 37:A.shiftKey?L=-1:(A.preventDefault(),y=-1);break;case 39:A.shiftKey?L=1:(A.preventDefault(),y=1);break;case 38:A.shiftKey?O=1:(A.preventDefault(),a=-1);break;case 40:A.shiftKey?O=-1:(A.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(L=0,O=0),{cameraAnimation:d=>{const _=this._tr;d.easeTo({duration:300,easeId:"keyboardHandler",easing:Wl,zoom:x?Math.round(_.zoom)+x*(A.shiftKey?2:1):_.zoom,bearing:_.bearing+L*this._bearingStep,pitch:_.pitch+O*this._pitchStep,offset:[-y*this._panStep,-a*this._panStep],center:_.center},{originalEvent:A})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wl(N){return N*(2-N)}const kc=4.000244140625;class Oc{constructor(A,x){this._onTimeout=L=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(L)},this._map=A,this._tr=new Tn(A),this._el=A.getCanvasContainer(),this._triggerRenderFrame=x,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(A){this._defaultZoomRate=A}setWheelZoomRate(A){this._wheelZoomRate=A}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(A){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!A&&A.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(A){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!A[this._map._metaKey])return;A.preventDefault()}let x=A.deltaMode===WheelEvent.DOM_DELTA_LINE?40*A.deltaY:A.deltaY;const L=s.h.now(),O=L-(this._lastWheelEventTime||0);this._lastWheelEventTime=L,x!==0&&x%kc==0?this._type="wheel":x!==0&&Math.abs(x)<4?this._type="trackpad":O>400?(this._type=null,this._lastValue=x,this._timeout=setTimeout(this._onTimeout,40,A)):this._type||(this._type=Math.abs(O*x)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,x+=this._lastValue)),A.shiftKey&&x&&(x/=4),this._type&&(this._lastWheelEvent=A,this._delta-=x,this._active||this._start(A)),A.preventDefault()}_start(A){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const x=b.mousePos(this._el,A),L=this._tr;this._around=s.L.convert(this._aroundCenter?L.center:L.unproject(x)),this._aroundPoint=L.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const A=this._tr.transform;if(this._delta!==0){const d=this._type==="wheel"&&Math.abs(this._delta)>kc?this._wheelZoomRate:this._defaultZoomRate;let _=2/(1+Math.exp(-Math.abs(this._delta*d)));this._delta<0&&_!==0&&(_=1/_);const B=typeof this._targetZoom=="number"?A.zoomScale(this._targetZoom):A.scale;this._targetZoom=Math.min(A.maxZoom,Math.max(A.minZoom,A.scaleZoom(B*_))),this._type==="wheel"&&(this._startZoom=A.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const x=typeof this._targetZoom=="number"?this._targetZoom:A.zoom,L=this._startZoom,O=this._easing;let y,a=!1;if(this._type==="wheel"&&L&&O){const d=Math.min((s.h.now()-this._lastWheelEventTime)/200,1),_=O(d);y=s.B.number(L,x,_),d<1?this._frameId||(this._frameId=!0):a=!0}else y=x,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:y-A.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(A){let x=s.bb;if(this._prevEase){const L=this._prevEase,O=(s.h.now()-L.start)/L.duration,y=L.easing(O+.01)-L.easing(O),a=.27/Math.sqrt(y*y+1e-4)*.01,d=Math.sqrt(.0729-a*a);x=s.ba(a,d,.25,1)}return this._prevEase={start:s.h.now(),duration:A,easing:x},x}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Uc{constructor(A,x){this._clickZoom=A,this._tapZoom=x}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Nc{constructor(A){this._tr=new Tn(A),this.reset()}reset(){this._active=!1}dblclick(A,x){return A.preventDefault(),{cameraAnimation:L=>{L.easeTo({duration:300,zoom:this._tr.zoom+(A.shiftKey?-1:1),around:this._tr.unproject(x)},{originalEvent:A})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class il{constructor(){this._tap=new ds({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(A,x,L){if(!this._swipePoint)if(this._tapTime){const O=x[0],y=A.timeStamp-this._tapTime<500,a=this._tapPoint.dist(O)<30;y&&a?L.length>0&&(this._swipePoint=O,this._swipeTouch=L[0].identifier):this.reset()}else this._tap.touchstart(A,x,L)}touchmove(A,x,L){if(this._tapTime){if(this._swipePoint){if(L[0].identifier!==this._swipeTouch)return;const O=x[0],y=O.y-this._swipePoint.y;return this._swipePoint=O,A.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(A,x,L)}touchend(A,x,L){if(this._tapTime)this._swipePoint&&L.length===0&&this.reset();else{const O=this._tap.touchend(A,x,L);O&&(this._tapTime=A.timeStamp,this._tapPoint=O)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yn{constructor(A,x,L){this._el=A,this._mousePan=x,this._touchPan=L}enable(A){this._inertiaOptions=A||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Cs{constructor(A,x,L){this._pitchWithRotate=A.pitchWithRotate,this._mouseRotate=x,this._mousePitch=L}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Do{constructor(A,x,L,O){this._el=A,this._touchZoom=x,this._touchRotate=L,this._tapDragZoom=O,this._rotationDisabled=!1,this._enabled=!0}enable(A){this._touchZoom.enable(A),this._rotationDisabled||this._touchRotate.enable(A),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Xl=N=>N.zoom||N.drag||N.pitch||N.rotate;class Ou extends s.k{}function gc(N){return N.panDelta&&N.panDelta.mag()||N.zoomDelta||N.bearingDelta||N.pitchDelta}class uu{constructor(A,x){this.handleWindowEvent=O=>{this.handleEvent(O,`${O.type}Window`)},this.handleEvent=(O,y)=>{if(O.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const a=O.type==="renderFrame"?void 0:O,d={needsRenderFrame:!1},_={},B={},S=O.touches,U=S?this._getMapTouches(S):void 0,H=U?b.touchPos(this._el,U):b.mousePos(this._el,O);for(const{handlerName:I,handler:R,allowed:j}of this._handlers){if(!R.isEnabled())continue;let Z;this._blockedByActive(B,j,I)?R.reset():R[y||O.type]&&(Z=R[y||O.type](O,H,U),this.mergeHandlerResult(d,_,Z,I,a),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||R.isActive())&&(B[I]=R)}const q={};for(const I in this._previousActiveHandlers)B[I]||(q[I]=a);this._previousActiveHandlers=B,(Object.keys(q).length||gc(d))&&(this._changes.push([d,_,q]),this._triggerRenderFrame()),(Object.keys(B).length||gc(d))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:w}=d;w&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],w(this._map))},this._map=A,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new io(A),this._bearingSnap=x.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(x);const L=this._el;this._listeners=[[L,"touchstart",{passive:!0}],[L,"touchmove",{passive:!1}],[L,"touchend",void 0],[L,"touchcancel",void 0],[L,"mousedown",void 0],[L,"mousemove",void 0],[L,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[L,"mouseover",void 0],[L,"mouseout",void 0],[L,"dblclick",void 0],[L,"click",void 0],[L,"keydown",{capture:!1}],[L,"keyup",void 0],[L,"wheel",{passive:!1}],[L,"contextmenu",void 0],[window,"blur",void 0]];for(const[O,y,a]of this._listeners)b.addEventListener(O,y,O===document?this.handleWindowEvent:this.handleEvent,a)}destroy(){for(const[A,x,L]of this._listeners)b.removeEventListener(A,x,A===document?this.handleWindowEvent:this.handleEvent,L)}_addDefaultHandlers(A){const x=this._map,L=x.getCanvasContainer();this._add("mapEvent",new ma(x,A));const O=x.boxZoom=new Fo(x,A);this._add("boxZoom",O),A.interactive&&A.boxZoom&&O.enable();const y=new Ir(x),a=new Nc(x);x.doubleClickZoom=new Uc(a,y),this._add("tapZoom",y),this._add("clickZoom",a),A.interactive&&A.doubleClickZoom&&x.doubleClickZoom.enable();const d=new il;this._add("tapDragZoom",d);const _=x.touchPitch=new so(x);this._add("touchPitch",_),A.interactive&&A.touchPitch&&x.touchPitch.enable(A.touchPitch);const B=go(A),S=Zo(A);x.dragRotate=new Cs(A,B,S),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",S,["mouseRotate"]),A.interactive&&A.dragRotate&&x.dragRotate.enable();const U=(j=>{let{enable:Z,clickTolerance:W}=j;const Y=new jn({checkCorrectEvent:ie=>b.mouseButton(ie)===0&&!ie.ctrlKey});return new Zr({clickTolerance:W,move:(ie,ae)=>({around:ae,panDelta:ae.sub(ie)}),activateOnStart:!0,moveStateManager:Y,enable:Z,assignEvents:Fa})})(A),H=new Oi(A,x);x.dragPan=new yn(L,U,H),this._add("mousePan",U),this._add("touchPan",H,["touchZoom","touchRotate"]),A.interactive&&A.dragPan&&x.dragPan.enable(A.dragPan);const q=new Kl,w=new $l;x.touchZoomRotate=new Do(L,w,q,d),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",w,["touchPan","touchRotate"]),A.interactive&&A.touchZoomRotate&&x.touchZoomRotate.enable(A.touchZoomRotate);const I=x.scrollZoom=new Oc(x,()=>this._triggerRenderFrame());this._add("scrollZoom",I,["mousePan"]),A.interactive&&A.scrollZoom&&x.scrollZoom.enable(A.scrollZoom);const R=x.keyboard=new Rc(x);this._add("keyboard",R),A.interactive&&A.keyboard&&x.keyboard.enable(),this._add("blockableMapEvent",new Pa(x))}_add(A,x,L){this._handlers.push({handlerName:A,handler:x,allowed:L}),this._handlersById[A]=x}stop(A){if(!this._updatingCamera){for(const{handler:x}of this._handlers)x.reset();this._inertia.clear(),this._fireEvents({},{},A),this._changes=[]}}isActive(){for(const{handler:A}of this._handlers)if(A.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Xl(this._eventsInProgress)||this.isZooming()}_blockedByActive(A,x,L){for(const O in A)if(O!==L&&(!x||x.indexOf(O)<0))return!0;return!1}_getMapTouches(A){const x=[];for(const L of A)this._el.contains(L.target)&&x.push(L);return x}mergeHandlerResult(A,x,L,O,y){if(!L)return;s.e(A,L);const a={handlerName:O,originalEvent:L.originalEvent||y};L.zoomDelta!==void 0&&(x.zoom=a),L.panDelta!==void 0&&(x.drag=a),L.pitchDelta!==void 0&&(x.pitch=a),L.bearingDelta!==void 0&&(x.rotate=a)}_applyChanges(){const A={},x={},L={};for(const[O,y,a]of this._changes)O.panDelta&&(A.panDelta=(A.panDelta||new s.P(0,0))._add(O.panDelta)),O.zoomDelta&&(A.zoomDelta=(A.zoomDelta||0)+O.zoomDelta),O.bearingDelta&&(A.bearingDelta=(A.bearingDelta||0)+O.bearingDelta),O.pitchDelta&&(A.pitchDelta=(A.pitchDelta||0)+O.pitchDelta),O.around!==void 0&&(A.around=O.around),O.pinchAround!==void 0&&(A.pinchAround=O.pinchAround),O.noInertia&&(A.noInertia=O.noInertia),s.e(x,y),s.e(L,a);this._updateMapTransform(A,x,L),this._changes=[]}_updateMapTransform(A,x,L){const O=this._map,y=O._getTransformForUpdate(),a=O.terrain;if(!(gc(A)||a&&this._terrainMovement))return this._fireEvents(x,L,!0);let{panDelta:d,zoomDelta:_,bearingDelta:B,pitchDelta:S,around:U,pinchAround:H}=A;H!==void 0&&(U=H),O._stop(!0),U=U||O.transform.centerPoint;const q=y.pointLocation(d?U.sub(d):U);B&&(y.bearing+=B),S&&(y.pitch+=S),_&&(y.zoom+=_),a?this._terrainMovement||!x.drag&&!x.zoom?x.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(d)):y.setLocationAtPoint(q,U):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(q,U),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,y.recalculateZoom(O.terrain)})):y.setLocationAtPoint(q,U),O._applyUpdatedTransform(y),this._map._update(),A.noInertia||this._inertia.record(A),this._fireEvents(x,L,!0)}_fireEvents(A,x,L){const O=Xl(this._eventsInProgress),y=Xl(A),a={};for(const S in A){const{originalEvent:U}=A[S];this._eventsInProgress[S]||(a[`${S}start`]=U),this._eventsInProgress[S]=A[S]}!O&&y&&this._fireEvent("movestart",y.originalEvent);for(const S in a)this._fireEvent(S,a[S]);y&&this._fireEvent("move",y.originalEvent);for(const S in A){const{originalEvent:U}=A[S];this._fireEvent(S,U)}const d={};let _;for(const S in this._eventsInProgress){const{handlerName:U,originalEvent:H}=this._eventsInProgress[S];this._handlersById[U].isActive()||(delete this._eventsInProgress[S],_=x[U]||H,d[`${S}end`]=_)}for(const S in d)this._fireEvent(S,d[S]);const B=Xl(this._eventsInProgress);if(L&&(O||y)&&!B){this._updatingCamera=!0;const S=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;!S||!S.essential&&s.h.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:_})),U(this._map.getBearing())&&this._map.resetNorth()):(U(S.bearing||this._map.getBearing())&&(S.bearing=0),S.freezeElevation=!0,this._map.easeTo(S,{originalEvent:_})),this._updatingCamera=!1}}_fireEvent(A,x){this._map.fire(new s.k(A,x?{originalEvent:x}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(A=>{delete this._frameId,this.handleEvent(new Ou("renderFrame",{timeStamp:A})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class _a extends s.E{constructor(A,x){super(),this._renderFrameCallback=()=>{const L=Math.min((s.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(L)),L<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=A,this._bearingSnap=x.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(A,x){return this.jumpTo({center:A},x)}panBy(A,x,L){return A=s.P.convert(A).mult(-1),this.panTo(this.transform.center,s.e({offset:A},x),L)}panTo(A,x,L){return this.easeTo(s.e({center:A},x),L)}getZoom(){return this.transform.zoom}setZoom(A,x){return this.jumpTo({zoom:A},x),this}zoomTo(A,x,L){return this.easeTo(s.e({zoom:A},x),L)}zoomIn(A,x){return this.zoomTo(this.getZoom()+1,A,x),this}zoomOut(A,x){return this.zoomTo(this.getZoom()-1,A,x),this}getBearing(){return this.transform.bearing}setBearing(A,x){return this.jumpTo({bearing:A},x),this}getPadding(){return this.transform.padding}setPadding(A,x){return this.jumpTo({padding:A},x),this}rotateTo(A,x,L){return this.easeTo(s.e({bearing:A},x),L)}resetNorth(A,x){return this.rotateTo(0,s.e({duration:1e3},A),x),this}resetNorthPitch(A,x){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},A),x),this}snapToNorth(A,x){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(A,x):this}getPitch(){return this.transform.pitch}setPitch(A,x){return this.jumpTo({pitch:A},x),this}cameraForBounds(A,x){A=Xe.convert(A);const L=x&&x.bearing||0;return this._cameraForBoxAndBearing(A.getNorthWest(),A.getSouthEast(),L,x)}_cameraForBoxAndBearing(A,x,L,O){const y={top:0,bottom:0,right:0,left:0};if(typeof(O=s.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},O)).padding=="number"){const ie=O.padding;O.padding={top:ie,bottom:ie,right:ie,left:ie}}O.padding=s.e(y,O.padding);const a=this.transform,d=a.padding,_=a.project(s.L.convert(A)),B=a.project(s.L.convert(x)),S=_.rotate(-L*Math.PI/180),U=B.rotate(-L*Math.PI/180),H=new s.P(Math.max(S.x,U.x),Math.max(S.y,U.y)),q=new s.P(Math.min(S.x,U.x),Math.min(S.y,U.y)),w=H.sub(q),I=(a.width-(d.left+d.right+O.padding.left+O.padding.right))/w.x,R=(a.height-(d.top+d.bottom+O.padding.top+O.padding.bottom))/w.y;if(R<0||I<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const j=Math.min(a.scaleZoom(a.scale*Math.min(I,R)),O.maxZoom),Z=s.P.convert(O.offset),W=new s.P((O.padding.left-O.padding.right)/2,(O.padding.top-O.padding.bottom)/2).rotate(L*Math.PI/180),Y=Z.add(W).mult(a.scale/a.zoomScale(j));return{center:a.unproject(_.add(B).div(2).sub(Y)),zoom:j,bearing:L}}fitBounds(A,x,L){return this._fitInternal(this.cameraForBounds(A,x),x,L)}fitScreenCoordinates(A,x,L,O,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(A)),this.transform.pointLocation(s.P.convert(x)),L,O),O,y)}_fitInternal(A,x,L){return A?(delete(x=s.e(A,x)).padding,x.linear?this.easeTo(x,L):this.flyTo(x,L)):this}jumpTo(A,x){this.stop();const L=this._getTransformForUpdate();let O=!1,y=!1,a=!1;return"zoom"in A&&L.zoom!==+A.zoom&&(O=!0,L.zoom=+A.zoom),A.center!==void 0&&(L.center=s.L.convert(A.center)),"bearing"in A&&L.bearing!==+A.bearing&&(y=!0,L.bearing=+A.bearing),"pitch"in A&&L.pitch!==+A.pitch&&(a=!0,L.pitch=+A.pitch),A.padding==null||L.isPaddingEqual(A.padding)||(L.padding=A.padding),this._applyUpdatedTransform(L),this.fire(new s.k("movestart",x)).fire(new s.k("move",x)),O&&this.fire(new s.k("zoomstart",x)).fire(new s.k("zoom",x)).fire(new s.k("zoomend",x)),y&&this.fire(new s.k("rotatestart",x)).fire(new s.k("rotate",x)).fire(new s.k("rotateend",x)),a&&this.fire(new s.k("pitchstart",x)).fire(new s.k("pitch",x)).fire(new s.k("pitchend",x)),this.fire(new s.k("moveend",x))}calculateCameraOptionsFromTo(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const y=s.U.fromLngLat(A,x),a=s.U.fromLngLat(L,O),d=a.x-y.x,_=a.y-y.y,B=a.z-y.z,S=Math.hypot(d,_,B);if(S===0)throw new Error("Can't calculate camera options with same From and To");const U=Math.hypot(d,_),H=this.transform.scaleZoom(this.transform.cameraToCenterDistance/S/this.transform.tileSize),q=180*Math.atan2(d,-_)/Math.PI;let w=180*Math.acos(U/S)/Math.PI;return w=B<0?90-w:90+w,{center:a.toLngLat(),zoom:H,pitch:w,bearing:q}}easeTo(A,x){this._stop(!1,A.easeId),((A=s.e({offset:[0,0],duration:500,easing:s.bb},A)).animate===!1||!A.essential&&s.h.prefersReducedMotion)&&(A.duration=0);const L=this._getTransformForUpdate(),O=this.getZoom(),y=this.getBearing(),a=this.getPitch(),d=this.getPadding(),_="zoom"in A?+A.zoom:O,B="bearing"in A?this._normalizeBearing(A.bearing,y):y,S="pitch"in A?+A.pitch:a,U="padding"in A?A.padding:L.padding,H=s.P.convert(A.offset);let q=L.centerPoint.add(H);const w=L.pointLocation(q),I=s.L.convert(A.center||w);this._normalizeCenter(I);const R=L.project(w),j=L.project(I).sub(R),Z=L.zoomScale(_-O);let W,Y;A.around&&(W=s.L.convert(A.around),Y=L.locationPoint(W));const ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||_!==O,this._rotating=this._rotating||y!==B,this._pitching=this._pitching||S!==a,this._padding=!L.isPaddingEqual(U),this._easeId=A.easeId,this._prepareEase(x,A.noMoveStart,ie),this.terrain&&this._prepareElevation(I),this._ease(ae=>{if(this._zooming&&(L.zoom=s.B.number(O,_,ae)),this._rotating&&(L.bearing=s.B.number(y,B,ae)),this._pitching&&(L.pitch=s.B.number(a,S,ae)),this._padding&&(L.interpolatePadding(d,U,ae),q=L.centerPoint.add(H)),this.terrain&&!A.freezeElevation&&this._updateElevation(ae),W)L.setLocationAtPoint(W,Y);else{const fe=L.zoomScale(L.zoom-O),pe=_>O?Math.min(2,Z):Math.max(.5,Z),xe=Math.pow(pe,1-ae),Fe=L.unproject(R.add(j.mult(ae*xe)).mult(fe));L.setLocationAtPoint(L.renderWorldCopies?Fe.wrap():Fe,q)}this._applyUpdatedTransform(L),this._fireMoveEvents(x)},ae=>{this.terrain&&this._finalizeElevation(),this._afterEase(x,ae)},A),this}_prepareEase(A,x){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,x||L.moving||this.fire(new s.k("movestart",A)),this._zooming&&!L.zooming&&this.fire(new s.k("zoomstart",A)),this._rotating&&!L.rotating&&this.fire(new s.k("rotatestart",A)),this._pitching&&!L.pitching&&this.fire(new s.k("pitchstart",A))}_prepareElevation(A){this._elevationCenter=A,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(A,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(A){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const x=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(A<1&&x!==this._elevationTarget){const L=this._elevationTarget-this._elevationStart;this._elevationStart+=A*(L-(x-(L*A+this._elevationStart))/(1-A)),this._elevationTarget=x}this.transform.elevation=s.B.number(this._elevationStart,this._elevationTarget,A)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(A){if(!this.transformCameraUpdate)return;const x=A.clone(),{center:L,zoom:O,pitch:y,bearing:a,elevation:d}=this.transformCameraUpdate(x);L&&(x.center=L),O!==void 0&&(x.zoom=O),y!==void 0&&(x.pitch=y),a!==void 0&&(x.bearing=a),d!==void 0&&(x.elevation=d),this.transform.apply(x)}_fireMoveEvents(A){this.fire(new s.k("move",A)),this._zooming&&this.fire(new s.k("zoom",A)),this._rotating&&this.fire(new s.k("rotate",A)),this._pitching&&this.fire(new s.k("pitch",A))}_afterEase(A,x){if(this._easeId&&x&&this._easeId===x)return;delete this._easeId;const L=this._zooming,O=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,L&&this.fire(new s.k("zoomend",A)),O&&this.fire(new s.k("rotateend",A)),y&&this.fire(new s.k("pitchend",A)),this.fire(new s.k("moveend",A))}flyTo(A,x){if(!A.essential&&s.h.prefersReducedMotion){const Qe=s.F(A,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Qe,x)}this.stop(),A=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.bb},A);const L=this._getTransformForUpdate(),O=this.getZoom(),y=this.getBearing(),a=this.getPitch(),d=this.getPadding(),_="zoom"in A?s.ad(+A.zoom,L.minZoom,L.maxZoom):O,B="bearing"in A?this._normalizeBearing(A.bearing,y):y,S="pitch"in A?+A.pitch:a,U="padding"in A?A.padding:L.padding,H=L.zoomScale(_-O),q=s.P.convert(A.offset);let w=L.centerPoint.add(q);const I=L.pointLocation(w),R=s.L.convert(A.center||I);this._normalizeCenter(R);const j=L.project(I),Z=L.project(R).sub(j);let W=A.curve;const Y=Math.max(L.width,L.height),ie=Y/H,ae=Z.mag();if("minZoom"in A){const Qe=s.ad(Math.min(A.minZoom,O,_),L.minZoom,L.maxZoom),pt=Y/L.zoomScale(Qe-O);W=Math.sqrt(pt/ae*2)}const fe=W*W;function pe(Qe){const pt=(ie*ie-Y*Y+(Qe?-1:1)*fe*fe*ae*ae)/(2*(Qe?ie:Y)*fe*ae);return Math.log(Math.sqrt(pt*pt+1)-pt)}function xe(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function Fe(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const Le=pe(!1);let nt=function(Qe){return Fe(Le)/Fe(Le+W*Qe)},Ke=function(Qe){return Y*((Fe(Le)*(xe(pt=Le+W*Qe)/Fe(pt))-xe(Le))/fe)/ae;var pt},Re=(pe(!0)-Le)/W;if(Math.abs(ae)<1e-6||!isFinite(Re)){if(Math.abs(Y-ie)<1e-6)return this.easeTo(A,x);const Qe=ie<Y?-1:1;Re=Math.abs(Math.log(ie/Y))/W,Ke=function(){return 0},nt=function(pt){return Math.exp(Qe*W*pt)}}return A.duration="duration"in A?+A.duration:1e3*Re/("screenSpeed"in A?+A.screenSpeed/W:+A.speed),A.maxDuration&&A.duration>A.maxDuration&&(A.duration=0),this._zooming=!0,this._rotating=y!==B,this._pitching=S!==a,this._padding=!L.isPaddingEqual(U),this._prepareEase(x,!1),this.terrain&&this._prepareElevation(R),this._ease(Qe=>{const pt=Qe*Re,bt=1/nt(pt);L.zoom=Qe===1?_:O+L.scaleZoom(bt),this._rotating&&(L.bearing=s.B.number(y,B,Qe)),this._pitching&&(L.pitch=s.B.number(a,S,Qe)),this._padding&&(L.interpolatePadding(d,U,Qe),w=L.centerPoint.add(q)),this.terrain&&!A.freezeElevation&&this._updateElevation(Qe);const ht=Qe===1?R:L.unproject(j.add(Z.mult(Ke(pt))).mult(bt));L.setLocationAtPoint(L.renderWorldCopies?ht.wrap():ht,w),this._applyUpdatedTransform(L),this._fireMoveEvents(x)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(x)},A),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(A,x){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const L=this._onEaseEnd;delete this._onEaseEnd,L.call(this,x)}if(!A){const L=this.handlers;L&&L.stop(!1)}return this}_ease(A,x,L){L.animate===!1||L.duration===0?(A(1),x()):(this._easeStart=s.h.now(),this._easeOptions=L,this._onEaseFrame=A,this._onEaseEnd=x,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(A,x){A=s.b5(A,-180,180);const L=Math.abs(A-x);return Math.abs(A-360-x)<L&&(A-=360),Math.abs(A+360-x)<L&&(A+=360),A}_normalizeCenter(A){const x=this.transform;if(!x.renderWorldCopies||x.lngRange)return;const L=A.lng-x.center.lng;A.lng+=L>180?-360:L<-180?360:0}queryTerrainElevation(A){return this.terrain?this.terrain.getElevationForLngLatZoom(s.L.convert(A),this.transform.tileZoom)-this.transform.elevation:null}}class Ks{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=x=>{!x||x.sourceDataType!=="metadata"&&x.sourceDataType!=="visibility"&&x.dataType!=="style"&&x.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=A}getDefaultPosition(){return"bottom-right"}onAdd(A){return this._map=A,this._compact=this.options&&this.options.compact,this._container=b.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=b.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=b.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){b.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(A,x){const L=this._map._getUIString(`AttributionControl.${x}`);A.title=L,A.setAttribute("aria-label",L)}_updateAttributions(){if(!this._map.style)return;let A=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?A=A.concat(this.options.customAttribution.map(O=>typeof O!="string"?"":O)):typeof this.options.customAttribution=="string"&&A.push(this.options.customAttribution)),this._map.style.stylesheet){const O=this._map.style.stylesheet;this.styleOwner=O.owner,this.styleId=O.id}const x=this._map.style.sourceCaches;for(const O in x){const y=x[O];if(y.used||y.usedForTerrain){const a=y.getSource();a.attribution&&A.indexOf(a.attribution)<0&&A.push(a.attribution)}}A=A.filter(O=>String(O).trim()),A.sort((O,y)=>O.length-y.length),A=A.filter((O,y)=>{for(let a=y+1;a<A.length;a++)if(A[a].indexOf(O)>=0)return!1;return!0});const L=A.join(" | ");L!==this._attribHTML&&(this._attribHTML=L,A.length?(this._innerContainer.innerHTML=L,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class bi{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const x=this._container.children;if(x.length){const L=x[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&L.classList.add("maplibregl-compact"):L.classList.remove("maplibregl-compact")}},this.options=A}getDefaultPosition(){return"bottom-left"}onAdd(A){this._map=A,this._compact=this.options&&this.options.compact,this._container=b.create("div","maplibregl-ctrl");const x=b.create("a","maplibregl-ctrl-logo");return x.target="_blank",x.rel="noopener nofollow",x.href="https://maplibre.org/",x.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),x.setAttribute("rel","noopener nofollow"),this._container.appendChild(x),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){b.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class sr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(A){const x=++this._id;return this._queue.push({callback:A,id:x,cancelled:!1}),x}remove(A){const x=this._currentlyRunning,L=x?this._queue.concat(x):this._queue;for(const O of L)if(O.id===A)return void(O.cancelled=!0)}run(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const x=this._currentlyRunning=this._queue;this._queue=[];for(const L of x)if(!L.cancelled&&(L.callback(A),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Zl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var zc=s.Q([{name:"a_pos3d",type:"Int16",components:3}]);class Qc extends s.E{constructor(A){super(),this.sourceCache=A,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,A.usedForTerrain=!0,A.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(A,x){this.sourceCache.update(A,x),this._renderableTilesKeys=[];const L={};for(const O of A.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:x}))L[O.key]=!0,this._renderableTilesKeys.push(O.key),this._tiles[O.key]||(O.posMatrix=new Float64Array(16),s.aS(O.posMatrix,0,s.N,0,s.N,0,1),this._tiles[O.key]=new Ri(O,this.tileSize));for(const O in this._tiles)L[O]||delete this._tiles[O]}freeRtt(A){for(const x in this._tiles){const L=this._tiles[x];(!A||L.tileID.equals(A)||L.tileID.isChildOf(A)||A.isChildOf(L.tileID))&&(L.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(A=>this.getTileByID(A))}getTileByID(A){return this._tiles[A]}getTerrainCoords(A){const x={};for(const L of this._renderableTilesKeys){const O=this._tiles[L].tileID;if(O.canonical.equals(A.canonical)){const y=A.clone();y.posMatrix=new Float64Array(16),s.aS(y.posMatrix,0,s.N,0,s.N,0,1),x[L]=y}else if(O.canonical.isChildOf(A.canonical)){const y=A.clone();y.posMatrix=new Float64Array(16);const a=O.canonical.z-A.canonical.z,d=O.canonical.x-(O.canonical.x>>a<<a),_=O.canonical.y-(O.canonical.y>>a<<a),B=s.N>>a;s.aS(y.posMatrix,0,B,0,B,0,1),s.$(y.posMatrix,y.posMatrix,[-d*B,-_*B,0]),x[L]=y}else if(A.canonical.isChildOf(O.canonical)){const y=A.clone();y.posMatrix=new Float64Array(16);const a=A.canonical.z-O.canonical.z,d=A.canonical.x-(A.canonical.x>>a<<a),_=A.canonical.y-(A.canonical.y>>a<<a),B=s.N>>a;s.aS(y.posMatrix,0,s.N,0,s.N,0,1),s.$(y.posMatrix,y.posMatrix,[d*B,_*B,0]),s.a0(y.posMatrix,y.posMatrix,[1/2**a,1/2**a,0]),x[L]=y}}return x}getSourceTile(A,x){const L=this.sourceCache._source;let O=A.overscaledZ-this.deltaZoom;if(O>L.maxzoom&&(O=L.maxzoom),O<L.minzoom)return null;this._sourceTileCache[A.key]||(this._sourceTileCache[A.key]=A.scaledTo(O).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[A.key]);if((!y||!y.dem)&&x)for(;O>=L.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(A.scaledTo(O--).key);return y}tilesAfterTime(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(x=>x.timeAdded>=A)}}class Es{constructor(A,x,L){this.painter=A,this.sourceCache=new Qc(x),this.options=L,this.exaggeration=typeof L.exaggeration=="number"?L.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.N;var y;if(!(x>=0&&x<O&&L>=0&&L<O))return 0;const a=this.getTerrainData(A),d=(y=a.tile)===null||y===void 0?void 0:y.dem;if(!d)return 0;const _=function(w,I,R){var j=I[0],Z=I[1];return w[0]=R[0]*j+R[4]*Z+R[12],w[1]=R[1]*j+R[5]*Z+R[13],w}([],[x/O*s.N,L/O*s.N],a.u_terrain_matrix),B=[_[0]*d.dim,_[1]*d.dim],S=Math.floor(B[0]),U=Math.floor(B[1]),H=B[0]-S,q=B[1]-U;return d.get(S,U)*(1-H)*(1-q)+d.get(S+1,U)*H*(1-q)+d.get(S,U+1)*(1-H)*q+d.get(S+1,U+1)*H*q}getElevationForLngLatZoom(A,x){const{tileID:L,mercatorX:O,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(A,x);return this.getElevation(L,O%s.N,y%s.N,s.N)}getElevation(A,x,L){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.N;return this.getDEMElevation(A,x,L,O)*this.exaggeration}getTerrainData(A){if(!this._emptyDemTexture){const O=this.painter.context,y=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new it(O,y,O.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new it(O,new s.R({width:1,height:1}),O.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(O.gl.NEAREST,O.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ao([])}const x=this.sourceCache.getSourceTile(A,!0);if(x&&x.dem&&(!x.demTexture||x.needsTerrainPrepare)){const O=this.painter.context;x.demTexture=this.painter.getTileTexture(x.dem.stride),x.demTexture?x.demTexture.update(x.dem.getPixels(),{premultiply:!1}):x.demTexture=new it(O,x.dem.getPixels(),O.gl.RGBA,{premultiply:!1}),x.demTexture.bind(O.gl.NEAREST,O.gl.CLAMP_TO_EDGE),x.needsTerrainPrepare=!1}const L=x&&x+x.tileID.key+A.key;if(L&&!this._demMatrixCache[L]){const O=this.sourceCache.sourceCache._source.maxzoom;let y=A.canonical.z-x.tileID.canonical.z;A.overscaledZ>A.canonical.z&&(A.canonical.z>=O?y=A.canonical.z-O:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const a=A.canonical.x-(A.canonical.x>>y<<y),d=A.canonical.y-(A.canonical.y>>y<<y),_=s.bc(new Float64Array(16),[1/(s.N<<y),1/(s.N<<y),0]);s.$(_,_,[a*s.N,d*s.N,0]),this._demMatrixCache[A.key]={matrix:_,coord:A}}return{u_depth:2,u_terrain:3,u_terrain_dim:x&&x.dem&&x.dem.dim||1,u_terrain_matrix:L?this._demMatrixCache[A.key].matrix:this._emptyDemMatrix,u_terrain_unpack:x&&x.dem&&x.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(x&&x.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:x}}getFramebuffer(A){const x=this.painter,L=x.width/devicePixelRatio,O=x.height/devicePixelRatio;return!this._fbo||this._fbo.width===L&&this._fbo.height===O||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new it(x.context,{width:L,height:O,data:null},x.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(x.context.gl.NEAREST,x.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new it(x.context,{width:L,height:O,data:null},x.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(x.context.gl.NEAREST,x.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=x.context.createFramebuffer(L,O,!0,!1),this._fbo.depthAttachment.set(x.context.createRenderbuffer(x.context.gl.DEPTH_COMPONENT16,L,O))),this._fbo.colorAttachment.set(A==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const A=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const x=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,a=0;y<this._coordsTextureSize;y++)for(let d=0;d<this._coordsTextureSize;d++,a+=4)x[a+0]=255&d,x[a+1]=255&y,x[a+2]=d>>8<<4|y>>8,x[a+3]=0;const L=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(x.buffer)),O=new it(A,L,A.gl.RGBA,{premultiply:!1});return O.bind(A.gl.NEAREST,A.gl.CLAMP_TO_EDGE),this._coordsTexture=O,O}pointCoordinate(A){const x=new Uint8Array(4),L=this.painter.context,O=L.gl;L.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),O.readPixels(A.x,this.painter.height/devicePixelRatio-A.y-1,1,1,O.RGBA,O.UNSIGNED_BYTE,x),L.bindFramebuffer.set(null);const y=x[0]+(x[2]>>4<<8),a=x[1]+((15&x[2])<<8),d=this.coordsIndex[255-x[3]],_=d&&this.sourceCache.getTileByID(d);if(!_)return null;const B=this._coordsTextureSize,S=(1<<_.tileID.canonical.z)*B;return new s.U(this._allowMercatorOverflow(A,(_.tileID.canonical.x*B+y)/S),(_.tileID.canonical.y*B+a)/S,this.getElevation(_.tileID,y,a,B))}getTerrainMesh(){if(this._mesh)return this._mesh;const A=this.painter.context,x=new s.bd,L=new s.b0,O=this.meshSize,y=s.N/O,a=O*O;for(let U=0;U<=O;U++)for(let H=0;H<=O;H++)x.emplaceBack(H*y,U*y,0);for(let U=0;U<a;U+=O+1)for(let H=0;H<O;H++)L.emplaceBack(H+U,O+H+U+1,O+H+U+2),L.emplaceBack(H+U,O+H+U+2,H+U+1);const d=x.length,_=d+2*(O+1);for(const U of[0,1])for(let H=0;H<=O;H++)for(const q of[0,1])x.emplaceBack(H*y,U*s.N,q);for(let U=0;U<2*O;U+=2)L.emplaceBack(_+U,_+U+1,_+U+3),L.emplaceBack(_+U,_+U+3,_+U+2),L.emplaceBack(d+U,d+U+3,d+U+1),L.emplaceBack(d+U,d+U+2,d+U+3);const B=x.length,S=B+2*(O+1);for(const U of[0,1])for(let H=0;H<=O;H++)for(const q of[0,1])x.emplaceBack(U*s.N,H*y,q);for(let U=0;U<2*O;U+=2)L.emplaceBack(B+U,B+U+1,B+U+3),L.emplaceBack(B+U,B+U+3,B+U+2),L.emplaceBack(S+U,S+U+3,S+U+1),L.emplaceBack(S+U,S+U+2,S+U+3);return this._mesh={indexBuffer:A.createIndexBuffer(L),vertexBuffer:A.createVertexBuffer(x,zc.members),segments:s.S.simpleSegment(0,0,x.length,L.length)},this._mesh}getMeshFrameDelta(A){return 2*Math.PI*s.be/Math.pow(2,A)/5}getMinTileElevationForLngLatZoom(A,x){var L;const{tileID:O}=this._getOverscaledTileIDFromLngLatZoom(A,x);return(L=this.getMinMaxElevation(O).minElevation)!==null&&L!==void 0?L:0}getMinMaxElevation(A){const x=this.getTerrainData(A).tile,L={minElevation:null,maxElevation:null};return x&&x.dem&&(L.minElevation=x.dem.min*this.exaggeration,L.maxElevation=x.dem.max*this.exaggeration),L}_getOverscaledTileIDFromLngLatZoom(A,x){const L=s.U.fromLngLat(A.wrap()),O=(1<<x)*s.N,y=L.x*O,a=L.y*O,d=Math.floor(y/s.N),_=Math.floor(a/s.N);return{tileID:new s.O(x,0,x,d,_),mercatorX:y,mercatorY:a}}_allowMercatorOverflow(A,x){const L=A.x<this.painter.width/2;let O=s.bf(x);const y=this.painter.transform.center.lng;return L&&Math.sign(O)>0&&Math.sign(y)<0||!L&&Math.sign(O)<0&&Math.sign(y)>0?(O=360*Math.sign(y)+O,s.G(O)):x}}class bh{constructor(A,x,L){this._context=A,this._size=x,this._tileSize=L,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const A of this._objects)A.texture.destroy(),A.fbo.destroy()}_createObject(A){const x=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),L=new it(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return L.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),x.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),x.colorAttachment.set(L.texture),{id:A,fbo:x,texture:L,stamp:-1,inUse:!1}}getObjectForId(A){return this._objects[A]}useObject(A){A.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(x=>A.id!==x),this._recentlyUsed.push(A.id)}stampObject(A){A.stamp=++this._stamp}getOrCreateFreeObject(){for(const x of this._recentlyUsed)if(!this._objects[x].inUse)return this._objects[x];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const A=this._createObject(this._objects.length);return this._objects.push(A),A}freeObject(A){A.inUse=!1}freeAllObjects(){for(const A of this._objects)this.freeObject(A)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(A=>!A.inUse)===!1}}const qn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class hu{constructor(A,x){this.painter=A,this.terrain=x,this.pool=new bh(A.context,30,x.sourceCache.tileSize*x.qualityFactor)}destruct(){this.pool.destruct()}getTexture(A){return this.pool.getObjectForId(A.rtt[this._stacks.length-1].id).texture}prepareForRender(A,x){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=A._order.filter(L=>!A._layers[L].isHidden(x)),this._coordsDescendingInv={};for(const L in A.sourceCaches){this._coordsDescendingInv[L]={};const O=A.sourceCaches[L].getVisibleCoordinates();for(const y of O){const a=this.terrain.sourceCache.getTerrainCoords(y);for(const d in a)this._coordsDescendingInv[L][d]||(this._coordsDescendingInv[L][d]=[]),this._coordsDescendingInv[L][d].push(a[d])}}this._coordsDescendingInvStr={};for(const L of A._order){const O=A._layers[L],y=O.source;if(qn[O.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const a in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][a]=this._coordsDescendingInv[y][a].map(d=>d.key).sort().join()}}for(const L of this._renderableTiles)for(const O in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[O][L.tileID.key];y&&y!==L.rttCoords[O]&&(L.rtt=[])}}renderLayer(A){if(A.isHidden(this.painter.transform.zoom))return!1;const x=A.type,L=this.painter,O=this._renderableLayerIds[this._renderableLayerIds.length-1]===A.id;if(qn[x]&&(this._prevType&&qn[this._prevType]||this._stacks.push([]),this._prevType=x,this._stacks[this._stacks.length-1].push(A.id),!O))return!0;if(qn[this._prevType]||qn[x]&&O){this._prevType=x;const y=this._stacks.length-1,a=this._stacks[y]||[];for(const d of this._renderableTiles){if(this.pool.isFull()&&(Sn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(d),d.rtt[y]){const B=this.pool.getObjectForId(d.rtt[y].id);if(B.stamp===d.rtt[y].stamp){this.pool.useObject(B);continue}}const _=this.pool.getOrCreateFreeObject();this.pool.useObject(_),this.pool.stampObject(_),d.rtt[y]={id:_.id,stamp:_.stamp},L.context.bindFramebuffer.set(_.fbo.framebuffer),L.context.clear({color:s.aT.transparent,stencil:0}),L.currentStencilSource=void 0;for(let B=0;B<a.length;B++){const S=L.style._layers[a[B]],U=S.source?this._coordsDescendingInv[S.source][d.tileID.key]:[d.tileID];L.context.viewport.set([0,0,_.fbo.width,_.fbo.height]),L._renderTileClippingMasks(S,U),L.renderLayer(L,L.style.sourceCaches[S.source],S,U),S.source&&(d.rttCoords[S.source]=this._coordsDescendingInvStr[S.source][d.tileID.key])}}return Sn(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),qn[x]}return!1}}const $i=g,Ni={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},$n=N=>{N.touchstart=N.dragStart,N.touchmoveWindow=N.dragMove,N.touchend=N.dragEnd},Uu={showCompass:!0,showZoom:!0,visualizePitch:!1};class Rs{constructor(A,x){let L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=a=>{this.startMouse(s.e({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),b.mousePos(this.element,a)),b.addEventListener(window,"mousemove",this.mousemove),b.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=a=>{this.moveMouse(a,b.mousePos(this.element,a))},this.mouseup=a=>{this.mouseRotate.dragEnd(a),this.mousePitch&&this.mousePitch.dragEnd(a),this.offTemp()},this.touchstart=a=>{a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=b.touchPos(this.element,a.targetTouches)[0],this.startTouch(a,this._startPos),b.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.addEventListener(window,"touchend",this.touchend))},this.touchmove=a=>{a.targetTouches.length!==1?this.reset():(this._lastPos=b.touchPos(this.element,a.targetTouches)[0],this.moveTouch(a,this._lastPos))},this.touchend=a=>{a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const O=A.dragRotate._mouseRotate.getClickTolerance(),y=A.dragRotate._mousePitch.getClickTolerance();this.element=x,this.mouseRotate=go({clickTolerance:O,enable:!0}),this.touchRotate=(a=>{let{enable:d,clickTolerance:_,bearingDegreesPerPixelMoved:B=.8}=a;const S=new ya;return new Zr({clickTolerance:_,move:(U,H)=>({bearingDelta:(H.x-U.x)*B}),moveStateManager:S,enable:d,assignEvents:$n})})({clickTolerance:O,enable:!0}),this.map=A,L&&(this.mousePitch=Zo({clickTolerance:y,enable:!0}),this.touchPitch=(a=>{let{enable:d,clickTolerance:_,pitchDegreesPerPixelMoved:B=-.5}=a;const S=new ya;return new Zr({clickTolerance:_,move:(U,H)=>({pitchDelta:(H.y-U.y)*B}),moveStateManager:S,enable:d,assignEvents:$n})})({clickTolerance:y,enable:!0})),b.addEventListener(x,"mousedown",this.mousedown),b.addEventListener(x,"touchstart",this.touchstart,{passive:!1}),b.addEventListener(x,"touchcancel",this.reset)}startMouse(A,x){this.mouseRotate.dragStart(A,x),this.mousePitch&&this.mousePitch.dragStart(A,x),b.disableDrag()}startTouch(A,x){this.touchRotate.dragStart(A,x),this.touchPitch&&this.touchPitch.dragStart(A,x),b.disableDrag()}moveMouse(A,x){const L=this.map,{bearingDelta:O}=this.mouseRotate.dragMove(A,x)||{};if(O&&L.setBearing(L.getBearing()+O),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(A,x)||{};y&&L.setPitch(L.getPitch()+y)}}moveTouch(A,x){const L=this.map,{bearingDelta:O}=this.touchRotate.dragMove(A,x)||{};if(O&&L.setBearing(L.getBearing()+O),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(A,x)||{};y&&L.setPitch(L.getPitch()+y)}}off(){const A=this.element;b.removeEventListener(A,"mousedown",this.mousedown),b.removeEventListener(A,"touchstart",this.touchstart,{passive:!1}),b.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.removeEventListener(window,"touchend",this.touchend),b.removeEventListener(A,"touchcancel",this.reset),this.offTemp()}offTemp(){b.enableDrag(),b.removeEventListener(window,"mousemove",this.mousemove),b.removeEventListener(window,"mouseup",this.mouseup),b.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.removeEventListener(window,"touchend",this.touchend)}}let tn;function Yo(N,A,x){if(N=new s.L(N.lng,N.lat),A){const L=new s.L(N.lng-360,N.lat),O=new s.L(N.lng+360,N.lat),y=x.locationPoint(N).distSqr(A);x.locationPoint(L).distSqr(A)<y?N=L:x.locationPoint(O).distSqr(A)<y&&(N=O)}for(;Math.abs(N.lng-x.center.lng)>180;){const L=x.locationPoint(N);if(L.x>=0&&L.y>=0&&L.x<=x.width&&L.y<=x.height)break;N.lng>x.center.lng?N.lng-=360:N.lng+=360}return N}const Ro={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Au(N,A,x){const L=N.classList;for(const O in Ro)L.remove(`maplibregl-${x}-anchor-${O}`);L.add(`maplibregl-${x}-anchor-${A}`)}class ks extends s.E{constructor(A){if(super(),this._onKeyPress=x=>{const L=x.code,O=x.charCode||x.keyCode;L!=="Space"&&L!=="Enter"&&O!==32&&O!==13||this.togglePopup()},this._onMapClick=x=>{const L=x.originalEvent.target,O=this._element;this._popup&&(L===O||O.contains(L))&&this.togglePopup()},this._update=x=>{if(!this._map)return;const L=this._map.loaded()&&!this._map.isMoving();((x==null?void 0:x.type)==="terrain"||(x==null?void 0:x.type)==="render"&&!L)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Yo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let O="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?O=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(O=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),x&&x.type!=="moveend"||(this._pos=this._pos.round()),b.setTransform(this._element,`${Ro[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${O}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const a=this._map.unproject(this._pos),d=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=a.distanceTo(this._lngLat)>20*d?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=x=>{if(!this._isDragging){const L=this._clickTolerance||this._map._clickTolerance;this._isDragging=x.point.dist(this._pointerdownPos)>=L}this._isDragging&&(this._pos=x.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=x=>{this._element.contains(x.originalEvent.target)&&(x.preventDefault(),this._positionDelta=x.point.sub(this._pos).add(this._offset),this._pointerdownPos=x.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=A&&A.anchor||"center",this._color=A&&A.color||"#3FB1CE",this._scale=A&&A.scale||1,this._draggable=A&&A.draggable||!1,this._clickTolerance=A&&A.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=A&&A.rotation||0,this._rotationAlignment=A&&A.rotationAlignment||"auto",this._pitchAlignment=A&&A.pitchAlignment&&A.pitchAlignment!=="auto"?A.pitchAlignment:this._rotationAlignment,A&&A.element)this._element=A.element,this._offset=s.P.convert(A&&A.offset||[0,0]);else{this._defaultMarker=!0,this._element=b.create("div"),this._element.setAttribute("aria-label","Map marker");const x=b.createNS("http://www.w3.org/2000/svg","svg"),L=41,O=27;x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height",`${L}px`),x.setAttributeNS(null,"width",`${O}px`),x.setAttributeNS(null,"viewBox",`0 0 ${O} ${L}`);const y=b.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const a=b.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");const d=b.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"transform","translate(3.0, 29.0)"),d.setAttributeNS(null,"fill","#000000");const _=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const j of _){const Z=b.createNS("http://www.w3.org/2000/svg","ellipse");Z.setAttributeNS(null,"opacity","0.04"),Z.setAttributeNS(null,"cx","10.5"),Z.setAttributeNS(null,"cy","5.80029008"),Z.setAttributeNS(null,"rx",j.rx),Z.setAttributeNS(null,"ry",j.ry),d.appendChild(Z)}const B=b.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill",this._color);const S=b.createNS("http://www.w3.org/2000/svg","path");S.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),B.appendChild(S);const U=b.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"opacity","0.25"),U.setAttributeNS(null,"fill","#000000");const H=b.createNS("http://www.w3.org/2000/svg","path");H.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),U.appendChild(H);const q=b.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");const w=b.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(8.0, 8.0)");const I=b.createNS("http://www.w3.org/2000/svg","circle");I.setAttributeNS(null,"fill","#000000"),I.setAttributeNS(null,"opacity","0.25"),I.setAttributeNS(null,"cx","5.5"),I.setAttributeNS(null,"cy","5.5"),I.setAttributeNS(null,"r","5.4999962");const R=b.createNS("http://www.w3.org/2000/svg","circle");R.setAttributeNS(null,"fill","#FFFFFF"),R.setAttributeNS(null,"cx","5.5"),R.setAttributeNS(null,"cy","5.5"),R.setAttributeNS(null,"r","5.4999962"),w.appendChild(I),w.appendChild(R),a.appendChild(d),a.appendChild(B),a.appendChild(U),a.appendChild(q),a.appendChild(w),x.appendChild(a),x.setAttributeNS(null,"height",L*this._scale+"px"),x.setAttributeNS(null,"width",O*this._scale+"px"),this._element.appendChild(x),this._offset=s.P.convert(A&&A.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()}),Au(this._element,this._anchor,"marker"),A&&A.className)for(const x of A.className.split(" "))this._element.classList.add(x);this._popup=null}addTo(A){return this.remove(),this._map=A,A.getCanvasContainer().appendChild(this._element),A.on("move",this._update),A.on("moveend",this._update),A.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),b.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(A){return this._lngLat=s.L.convert(A),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(A){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),A){if(!("offset"in A.options)){const O=Math.abs(13.5)/Math.SQRT2;A.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[O,-1*(38.1-13.5+O)],"bottom-right":[-O,-1*(38.1-13.5+O)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=A,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const A=this._popup;return A?(A.isOpen()?A.remove():A.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(A){return this._offset=s.P.convert(A),this._update(),this}addClassName(A){this._element.classList.add(A)}removeClassName(A){this._element.classList.remove(A)}toggleClassName(A){return this._element.classList.toggle(A)}setDraggable(A){return this._draggable=!!A,this._map&&(A?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(A){return this._rotation=A||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(A){return this._rotationAlignment=A||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(A){return this._pitchAlignment=A&&A!=="auto"?A:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Jr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Nn=0,ko=!1;const ml={maxWidth:100,unit:"metric"};function rl(N,A,x){const L=x&&x.maxWidth||100,O=N._container.clientHeight/2,y=N.unproject([0,O]),a=N.unproject([L,O]),d=y.distanceTo(a);if(x&&x.unit==="imperial"){const _=3.2808*d;_>5280?Da(A,L,_/5280,N._getUIString("ScaleControl.Miles")):Da(A,L,_,N._getUIString("ScaleControl.Feet"))}else x&&x.unit==="nautical"?Da(A,L,d/1852,N._getUIString("ScaleControl.NauticalMiles")):d>=1e3?Da(A,L,d/1e3,N._getUIString("ScaleControl.Kilometers")):Da(A,L,d,N._getUIString("ScaleControl.Meters"))}function Da(N,A,x,L){const O=function(y){const a=Math.pow(10,`${Math.floor(y)}`.length-1);let d=y/a;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:d>=1?1:function(_){const B=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*B)/B}(d),a*d}(x);N.style.width=A*(O/x)+"px",N.innerHTML=`${O}&nbsp;${L}`}const Jl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},du=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function yo(N){if(N){if(typeof N=="number"){const A=Math.round(Math.abs(N)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,N),"top-left":new s.P(A,A),"top-right":new s.P(-A,A),bottom:new s.P(0,-N),"bottom-left":new s.P(A,-A),"bottom-right":new s.P(-A,-A),left:new s.P(N,0),right:new s.P(-N,0)}}if(N instanceof s.P||Array.isArray(N)){const A=s.P.convert(N);return{center:A,top:A,"top-left":A,"top-right":A,bottom:A,"bottom-left":A,"bottom-right":A,left:A,right:A}}return{center:s.P.convert(N.center||[0,0]),top:s.P.convert(N.top||[0,0]),"top-left":s.P.convert(N["top-left"]||[0,0]),"top-right":s.P.convert(N["top-right"]||[0,0]),bottom:s.P.convert(N.bottom||[0,0]),"bottom-left":s.P.convert(N["bottom-left"]||[0,0]),"bottom-right":s.P.convert(N["bottom-right"]||[0,0]),left:s.P.convert(N.left||[0,0]),right:s.P.convert(N.right||[0,0])}}return yo(new s.P(0,0))}const va={extend:function(N){for(var A=arguments.length,x=new Array(A>1?A-1:0),L=1;L<A;L++)x[L-1]=arguments[L];return s.e(N,...x)},run(N){N()},logToElement(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"log";const L=window.document.getElementById(x);L&&(A&&(L.innerHTML=""),L.innerHTML+=`<br>${N}`)}},yl=g;class Gr{static get version(){return yl}static get workerCount(){return Ki.workerCount}static set workerCount(A){Ki.workerCount=A}static get maxParallelImageRequests(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(A){s.c.MAX_PARALLEL_IMAGE_REQUESTS=A}static get workerUrl(){return s.c.WORKER_URL}static set workerUrl(A){s.c.WORKER_URL=A}static addProtocol(A,x){s.c.REGISTERED_PROTOCOLS[A]=x}static removeProtocol(A){delete s.c.REGISTERED_PROTOCOLS[A]}}return Gr.Map=class extends _a{constructor(N){if(s.bg.mark(s.bh.create),(N=s.e({},Ni,N)).minZoom!=null&&N.maxZoom!=null&&N.minZoom>N.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(N.minPitch!=null&&N.maxPitch!=null&&N.minPitch>N.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(N.minPitch!=null&&N.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(N.maxPitch!=null&&N.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new fl(N.minZoom,N.maxZoom,N.minPitch,N.maxPitch,N.renderWorldCopies),{bearingSnap:N.bearingSnap}),this._cooperativeGesturesOnWheel=A=>{this._onCooperativeGesture(A,A[this._metaKey],1)},this._contextLost=A=>{A.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.k("webglcontextlost",{originalEvent:A}))},this._contextRestored=A=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:A}))},this._onMapScroll=A=>{if(A.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=N.interactive,this._cooperativeGestures=N.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=N.maxTileCacheSize,this._maxTileCacheZoomLevels=N.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=N.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=N.preserveDrawingBuffer,this._antialias=N.antialias,this._trackResize=N.trackResize,this._bearingSnap=N.bearingSnap,this._refreshExpiredTiles=N.refreshExpiredTiles,this._fadeDuration=N.fadeDuration,this._crossSourceCollisions=N.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=N.collectResourceTiming,this._renderTaskQueue=new sr,this._controls=[],this._mapId=s.a2(),this._locale=s.e({},Zl,N.locale),this._clickTolerance=N.clickTolerance,this._overridePixelRatio=N.pixelRatio,this._maxCanvasSize=N.maxCanvasSize,this.transformCameraUpdate=N.transformCameraUpdate,this._imageQueueHandle=ue.addThrottleControl(()=>this.isMoving()),this._requestManager=new de(N.transformRequest),typeof N.container=="string"){if(this._container=document.getElementById(N.container),!this._container)throw new Error(`Container '${N.container}' not found.`)}else{if(!(N.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=N.container}if(N.maxBounds&&this.setMaxBounds(N.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let A=!1;const x=fo(L=>{this._trackResize&&!this._removed&&this.resize(L)._update()},50);this._resizeObserver=new ResizeObserver(L=>{A?x(L):A=!0}),this._resizeObserver.observe(this._container)}this.handlers=new uu(this,N),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=N.hash&&new ss(typeof N.hash=="string"&&N.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:N.center,zoom:N.zoom,bearing:N.bearing,pitch:N.pitch}),N.bounds&&(this.resize(),this.fitBounds(N.bounds,s.e({},N.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=N.localIdeographFontFamily,this._validateStyle=N.validateStyle,N.style&&this.setStyle(N.style,{localIdeographFontFamily:N.localIdeographFontFamily}),N.attributionControl&&this.addControl(new Ks({customAttribution:N.customAttribution})),N.maplibreLogo&&this.addControl(new bi,N.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",A=>{this._update(A.dataType==="style"),this.fire(new s.k(`${A.dataType}data`,A))}),this.on("dataloading",A=>{this.fire(new s.k(`${A.dataType}dataloading`,A))}),this.on("dataabort",A=>{this.fire(new s.k("sourcedataabort",A))})}_getMapId(){return this._mapId}addControl(N,A){if(A===void 0&&(A=N.getDefaultPosition?N.getDefaultPosition():"top-right"),!N||!N.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const x=N.onAdd(this);this._controls.push(N);const L=this._controlPositions[A];return A.indexOf("bottom")!==-1?L.insertBefore(x,L.firstChild):L.appendChild(x),this}removeControl(N){if(!N||!N.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const A=this._controls.indexOf(N);return A>-1&&this._controls.splice(A,1),N.onRemove(this),this}hasControl(N){return this._controls.indexOf(N)>-1}calculateCameraOptionsFromTo(N,A,x,L){return L==null&&this.terrain&&(L=this.terrain.getElevationForLngLatZoom(x,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(N,A,x,L)}resize(N){var A;const x=this._containerDimensions(),L=x[0],O=x[1],y=this._getClampedPixelRatio(L,O);if(this._resizeCanvas(L,O,y),this.painter.resize(L,O,y),this.painter.overLimit()){const d=this.painter.context.gl;this._maxCanvasSize=[d.drawingBufferWidth,d.drawingBufferHeight];const _=this._getClampedPixelRatio(L,O);this._resizeCanvas(L,O,_),this.painter.resize(L,O,_)}this.transform.resize(L,O),(A=this._requestedCameraState)===null||A===void 0||A.resize(L,O);const a=!this._moving;return a&&(this.stop(),this.fire(new s.k("movestart",N)).fire(new s.k("move",N))),this.fire(new s.k("resize",N)),a&&this.fire(new s.k("moveend",N)),this}_getClampedPixelRatio(N,A){const{0:x,1:L}=this._maxCanvasSize,O=this.getPixelRatio(),y=N*O,a=A*O;return Math.min(y>x?x/y:1,a>L?L/a:1)*O}getPixelRatio(){var N;return(N=this._overridePixelRatio)!==null&&N!==void 0?N:devicePixelRatio}setPixelRatio(N){this._overridePixelRatio=N,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(N){return this.transform.setMaxBounds(Xe.convert(N)),this._update()}setMinZoom(N){if((N=N??-2)>=-2&&N<=this.transform.maxZoom)return this.transform.minZoom=N,this._update(),this.getZoom()<N&&this.setZoom(N),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(N){if((N=N??22)>=this.transform.minZoom)return this.transform.maxZoom=N,this._update(),this.getZoom()>N&&this.setZoom(N),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(N){if((N=N??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(N>=0&&N<=this.transform.maxPitch)return this.transform.minPitch=N,this._update(),this.getPitch()<N&&this.setPitch(N),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(N){if((N=N??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(N>=this.transform.minPitch)return this.transform.maxPitch=N,this._update(),this.getPitch()>N&&this.setPitch(N),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(N){return this.transform.renderWorldCopies=N,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(N){return this._cooperativeGestures=N,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(N){return this.transform.locationPoint(s.L.convert(N),this.style&&this.terrain)}unproject(N){return this.transform.pointLocation(s.P.convert(N),this.terrain)}isMoving(){var N;return this._moving||((N=this.handlers)===null||N===void 0?void 0:N.isMoving())}isZooming(){var N;return this._zooming||((N=this.handlers)===null||N===void 0?void 0:N.isZooming())}isRotating(){var N;return this._rotating||((N=this.handlers)===null||N===void 0?void 0:N.isRotating())}_createDelegatedListener(N,A,x){if(N==="mouseenter"||N==="mouseover"){let L=!1;return{layer:A,listener:x,delegates:{mousemove:y=>{const a=this.getLayer(A)?this.queryRenderedFeatures(y.point,{layers:[A]}):[];a.length?L||(L=!0,x.call(this,new ys(N,this,y.originalEvent,{features:a}))):L=!1},mouseout:()=>{L=!1}}}}if(N==="mouseleave"||N==="mouseout"){let L=!1;return{layer:A,listener:x,delegates:{mousemove:a=>{(this.getLayer(A)?this.queryRenderedFeatures(a.point,{layers:[A]}):[]).length?L=!0:L&&(L=!1,x.call(this,new ys(N,this,a.originalEvent)))},mouseout:a=>{L&&(L=!1,x.call(this,new ys(N,this,a.originalEvent)))}}}}{const L=O=>{const y=this.getLayer(A)?this.queryRenderedFeatures(O.point,{layers:[A]}):[];y.length&&(O.features=y,x.call(this,O),delete O.features)};return{layer:A,listener:x,delegates:{[N]:L}}}}on(N,A,x){if(x===void 0)return super.on(N,A);const L=this._createDelegatedListener(N,A,x);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[N]=this._delegatedListeners[N]||[],this._delegatedListeners[N].push(L);for(const O in L.delegates)this.on(O,L.delegates[O]);return this}once(N,A,x){if(x===void 0)return super.once(N,A);const L=this._createDelegatedListener(N,A,x);for(const O in L.delegates)this.once(O,L.delegates[O]);return this}off(N,A,x){return x===void 0?super.off(N,A):(this._delegatedListeners&&this._delegatedListeners[N]&&(L=>{const O=this._delegatedListeners[N];for(let y=0;y<O.length;y++){const a=O[y];if(a.layer===A&&a.listener===x){for(const d in a.delegates)this.off(d,a.delegates[d]);return O.splice(y,1),this}}})(),this)}queryRenderedFeatures(N,A){if(!this.style)return[];let x;const L=N instanceof s.P||Array.isArray(N),O=L?N:[[0,0],[this.transform.width,this.transform.height]];if(A=A||(L?{}:N)||{},O instanceof s.P||typeof O[0]=="number")x=[s.P.convert(O)];else{const y=s.P.convert(O[0]),a=s.P.convert(O[1]);x=[y,new s.P(a.x,y.y),a,new s.P(y.x,a.y),y]}return this.style.queryRenderedFeatures(x,A,this.transform)}querySourceFeatures(N,A){return this.style.querySourceFeatures(N,A)}setStyle(N,A){return(A=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},A)).diff!==!1&&A.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&N?(this._diffStyle(N,A),this):(this._localIdeographFontFamily=A.localIdeographFontFamily,this._updateStyle(N,A))}setTransformRequest(N){return this._requestManager.setTransformRequest(N),this}_getUIString(N){const A=this._locale[N];if(A==null)throw new Error(`Missing UI string '${N}'`);return A}_updateStyle(N,A){if(A.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(N,A));const x=this.style&&A.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!N)),N?(this.style=new Wi(this,A||{}),this.style.setEventedParent(this,{style:this.style}),typeof N=="string"?this.style.loadURL(N,A,x):this.style.loadJSON(N,A,x),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Wi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(N,A){if(typeof N=="string"){const x=this._requestManager.transformRequest(N,ce.Style);s.f(x,(L,O)=>{L?this.fire(new s.j(L)):O&&this._updateDiff(O,A)})}else typeof N=="object"&&this._updateDiff(N,A)}_updateDiff(N,A){try{this.style.setState(N,A)&&this._update(!0)}catch(x){s.w(`Unable to perform style diff: ${x.message||x.error||x}.  Rebuilding the style from scratch.`),this._updateStyle(N,A)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(N,A){return this._lazyInitEmptyStyle(),this.style.addSource(N,A),this._update(!0)}isSourceLoaded(N){const A=this.style&&this.style.sourceCaches[N];if(A!==void 0)return A.loaded();this.fire(new s.j(new Error(`There is no source with ID '${N}'`)))}setTerrain(N){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),N){const A=this.style.sourceCaches[N.source];if(!A)throw new Error(`cannot load terrain, because there exists no source with ID: ${N.source}`);for(const x in this.style._layers){const L=this.style._layers[x];L.type==="hillshade"&&L.source===N.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Es(this.painter,A,N),this.painter.renderToTexture=new hu(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=x=>{x.dataType==="style"?this.terrain.sourceCache.freeRtt():x.dataType==="source"&&x.tile&&(x.sourceId!==N.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(x.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:N})),this}getTerrain(){var N,A;return(A=(N=this.terrain)===null||N===void 0?void 0:N.options)!==null&&A!==void 0?A:null}areTilesLoaded(){const N=this.style&&this.style.sourceCaches;for(const A in N){const x=N[A]._tiles;for(const L in x){const O=x[L];if(O.state!=="loaded"&&O.state!=="errored")return!1}}return!0}addSourceType(N,A,x){return this._lazyInitEmptyStyle(),this.style.addSourceType(N,A,x)}removeSource(N){return this.style.removeSource(N),this._update(!0)}getSource(N){return this.style.getSource(N)}addImage(N,A){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:L=1,sdf:O=!1,stretchX:y,stretchY:a,content:d}=x;if(this._lazyInitEmptyStyle(),!(A instanceof HTMLImageElement||s.a(A))){if(A.width===void 0||A.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:_,height:B,data:S}=A,U=A;return this.style.addImage(N,{data:new s.R({width:_,height:B},new Uint8Array(S)),pixelRatio:L,stretchX:y,stretchY:a,content:d,sdf:O,version:0,userImage:U}),U.onAdd&&U.onAdd(this,N),this}}{const{width:_,height:B,data:S}=s.h.getImageData(A);this.style.addImage(N,{data:new s.R({width:_,height:B},S),pixelRatio:L,stretchX:y,stretchY:a,content:d,sdf:O,version:0})}}updateImage(N,A){const x=this.style.getImage(N);if(!x)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const L=A instanceof HTMLImageElement||s.a(A)?s.h.getImageData(A):A,{width:O,height:y,data:a}=L;if(O===void 0||y===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(O!==x.data.width||y!==x.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const d=!(A instanceof HTMLImageElement||s.a(A));return x.data.replace(a,d),this.style.updateImage(N,x),this}getImage(N){return this.style.getImage(N)}hasImage(N){return N?!!this.style.getImage(N):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(N){this.style.removeImage(N)}loadImage(N,A){ue.getImage(this._requestManager.transformRequest(N,ce.Image),A)}listImages(){return this.style.listImages()}addLayer(N,A){return this._lazyInitEmptyStyle(),this.style.addLayer(N,A),this._update(!0)}moveLayer(N,A){return this.style.moveLayer(N,A),this._update(!0)}removeLayer(N){return this.style.removeLayer(N),this._update(!0)}getLayer(N){return this.style.getLayer(N)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(N,A,x){return this.style.setLayerZoomRange(N,A,x),this._update(!0)}setFilter(N,A){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(N,A,x),this._update(!0)}getFilter(N){return this.style.getFilter(N)}setPaintProperty(N,A,x){let L=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(N,A,x,L),this._update(!0)}getPaintProperty(N,A){return this.style.getPaintProperty(N,A)}setLayoutProperty(N,A,x){let L=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(N,A,x,L),this._update(!0)}getLayoutProperty(N,A){return this.style.getLayoutProperty(N,A)}setGlyphs(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(N,A),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(N,A){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(N,A,x,L=>{L||this._update(!0)}),this}removeSprite(N){return this._lazyInitEmptyStyle(),this.style.removeSprite(N),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(N,A,x=>{x||this._update(!0)}),this}setLight(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(N,A),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(N,A){return this.style.setFeatureState(N,A),this._update()}removeFeatureState(N,A){return this.style.removeFeatureState(N,A),this._update()}getFeatureState(N){return this.style.getFeatureState(N)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let N=0,A=0;return this._container&&(N=this._container.clientWidth||400,A=this._container.clientHeight||300),[N,A]}_setupContainer(){const N=this._container;N.classList.add("maplibregl-map");const A=this._canvasContainer=b.create("div","maplibregl-canvas-container",N);this._interactive&&A.classList.add("maplibregl-interactive"),this._canvas=b.create("canvas","maplibregl-canvas",A),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const x=this._containerDimensions(),L=this._getClampedPixelRatio(x[0],x[1]);this._resizeCanvas(x[0],x[1],L);const O=this._controlContainer=b.create("div","maplibregl-control-container",N),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(a=>{y[a]=b.create("div",`maplibregl-ctrl-${a} `,O)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=b.create("div","maplibregl-cooperative-gesture-screen",this._container);let N=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(N=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${N}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){b.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(N,A,x){this._canvas.width=Math.floor(x*N),this._canvas.height=Math.floor(x*A),this._canvas.style.width=`${N}px`,this._canvas.style.height=`${A}px`}_setupPainter(){const N={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let A=null;this._canvas.addEventListener("webglcontextcreationerror",L=>{A={requestedAttributes:N},L&&(A.statusMessage=L.statusMessage,A.type=L.type)},{once:!0});const x=this._canvas.getContext("webgl2",N)||this._canvas.getContext("webgl",N);if(!x){const L="Failed to initialize WebGL";throw A?(A.message=L,new Error(JSON.stringify(A))):new Error(L)}this.painter=new on(x,this.transform),T.testSupport(x)}_onCooperativeGesture(N,A,x){return!A&&x<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(N){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||N,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(N){return this._update(),this._renderTaskQueue.add(N)}_cancelRenderFrame(N){this._renderTaskQueue.remove(N)}_render(N){const A=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(N),this._removed)return;let x=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,y=s.h.now();this.style.zoomHistory.update(O,y);const a=new s.a8(O,{now:y,fadeDuration:A,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),d=a.crossFadingFactor();d===1&&d===this._crossFadingFactor||(x=!0,this._crossFadingFactor=d),this.style.update(a)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,A,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:A,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bg.mark(s.bh.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const L=this._sourcesDirty||this._styleDirty||this._placementDirty;return L||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,s.bg.mark(s.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var N;this._hash&&this._hash.remove();for(const x of this._controls)x.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ue.removeThrottleControl(this._imageQueueHandle),(N=this._resizeObserver)===null||N===void 0||N.disconnect();const A=this.painter.context.gl.getExtension("WEBGL_lose_context");A&&A.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),b.remove(this._canvasContainer),b.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),s.bg.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=s.h.frame(N=>{s.bg.frame(N),this._frame=null,this._render(N)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(N){this._showTileBoundaries!==N&&(this._showTileBoundaries=N,this._update())}get showPadding(){return!!this._showPadding}set showPadding(N){this._showPadding!==N&&(this._showPadding=N,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(N){this._showCollisionBoxes!==N&&(this._showCollisionBoxes=N,N?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(N){this._showOverdrawInspector!==N&&(this._showOverdrawInspector=N,this._update())}get repaint(){return!!this._repaint}set repaint(N){this._repaint!==N&&(this._repaint=N,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(N){this._vertices=N,this._update()}get version(){return $i}getCameraTargetElevation(){return this.transform.elevation}},Gr.NavigationControl=class{constructor(N){this._updateZoomButtons=()=>{const A=this._map.getZoom(),x=A===this._map.getMaxZoom(),L=A===this._map.getMinZoom();this._zoomInButton.disabled=x,this._zoomOutButton.disabled=L,this._zoomInButton.setAttribute("aria-disabled",x.toString()),this._zoomOutButton.setAttribute("aria-disabled",L.toString())},this._rotateCompassArrow=()=>{const A=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=A},this._setButtonTitle=(A,x)=>{const L=this._map._getUIString(`NavigationControl.${x}`);A.title=L,A.setAttribute("aria-label",L)},this.options=s.e({},Uu,N),this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",A=>A.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",A=>this._map.zoomIn({},{originalEvent:A})),b.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",A=>this._map.zoomOut({},{originalEvent:A})),b.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",A=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:A}):this._map.resetNorth({},{originalEvent:A})}),this._compassIcon=b.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(N){return this._map=N,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Rs(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){b.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(N,A){const x=b.create("button",N,this._container);return x.type="button",x.addEventListener("click",A),x}},Gr.GeolocateControl=class extends s.E{constructor(N){super(),this._onSuccess=A=>{if(this._map){if(this._isOutOfMapMaxBounds(A))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",A)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=A,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(A),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(A),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",A)),this._finish()}},this._updateCamera=A=>{const x=new s.L(A.coords.longitude,A.coords.latitude),L=A.coords.accuracy,O=this._map.getBearing(),y=s.e({bearing:O},this.options.fitBoundsOptions),a=Xe.fromLngLat(x,L);this._map.fitBounds(a,y,{geolocateSource:!0})},this._updateMarker=A=>{if(A){const x=new s.L(A.coords.longitude,A.coords.latitude);this._accuracyCircleMarker.setLngLat(x).addTo(this._map),this._userLocationDotMarker.setLngLat(x).addTo(this._map),this._accuracy=A.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=A=>{if(this._map){if(this.options.trackUserLocation)if(A.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(A.code===3&&ko)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",A)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=A=>{if(this._map){if(this._container.addEventListener("contextmenu",x=>x.preventDefault()),this._geolocateButton=b.create("button","maplibregl-ctrl-geolocate",this._container),b.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",A===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}else{const x=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=b.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ks({element:this._dotElement}),this._circleElement=b.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ks({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",x=>{x.geolocateSource||this._watchState!=="ACTIVE_LOCK"||x.originalEvent&&x.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},Jr,N)}onAdd(N){return this._map=N,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(A){let x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;tn===void 0||x?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(L=>{tn=L.state!=="denied",A(tn)}).catch(()=>{tn=!!window.navigator.geolocation,A(tn)}):(tn=!!window.navigator.geolocation,A(tn)):A(tn)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),b.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Nn=0,ko=!1}_isOutOfMapMaxBounds(N){const A=this._map.getMaxBounds(),x=N.coords;return A&&(x.longitude<A.getWest()||x.longitude>A.getEast()||x.latitude<A.getSouth()||x.latitude>A.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const N=this._map.getBounds(),A=N.getSouthEast(),x=N.getNorthEast(),L=A.distanceTo(x),O=Math.ceil(this._accuracy/(L/this._map._container.clientHeight)*2);this._circleElement.style.width=`${O}px`,this._circleElement.style.height=`${O}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Nn--,ko=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let N;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Nn++,Nn>1?(N={maximumAge:6e5,timeout:0},ko=!0):(N=this.options.positionOptions,ko=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,N)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Gr.AttributionControl=Ks,Gr.LogoControl=bi,Gr.ScaleControl=class{constructor(N){this._onMove=()=>{rl(this._map,this._container,this.options)},this.setUnit=A=>{this.options.unit=A,rl(this._map,this._container,this.options)},this.options=s.e({},ml,N)}getDefaultPosition(){return"bottom-left"}onAdd(N){return this._map=N,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-scale",N.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){b.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Gr.FullscreenControl=class extends s.E{constructor(){let N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,N&&N.container&&(N.container instanceof HTMLElement?this._container=N.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(N){return this._map=N,this._container||(this._container=this._map.getContainer()),this._controlContainer=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){b.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const N=this._fullscreenButton=b.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);b.create("span","maplibregl-ctrl-icon",N).setAttribute("aria-hidden","true"),N.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const N=this._getTitle();this._fullscreenButton.setAttribute("aria-label",N),this._fullscreenButton.title=N}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Gr.TerrainControl=class{constructor(N){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=N}onAdd(N){return this._map=N,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=b.create("button","maplibregl-ctrl-terrain",this._container),b.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){b.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Gr.Popup=class extends s.E{constructor(N){super(),this.remove=()=>(this._content&&b.remove(this._content),this._container&&(b.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.k("close")),this),this._onMouseUp=A=>{this._update(A.point)},this._onMouseMove=A=>{this._update(A.point)},this._onDrag=A=>{this._update(A.point)},this._update=A=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=b.create("div","maplibregl-popup",this._map.getContainer()),this._tip=b.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const a of this.options.className.split(" "))this._container.classList.add(a);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Yo(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!A)return;const x=this._pos=this._trackPointer&&A?A:this._map.project(this._lngLat);let L=this.options.anchor;const O=yo(this.options.offset);if(!L){const a=this._container.offsetWidth,d=this._container.offsetHeight;let _;_=x.y+O.bottom.y<d?["top"]:x.y>this._map.transform.height-d?["bottom"]:[],x.x<a/2?_.push("left"):x.x>this._map.transform.width-a/2&&_.push("right"),L=_.length===0?"bottom":_.join("-")}const y=x.add(O[L]).round();b.setTransform(this._container,`${Ro[L]} translate(${y.x}px,${y.y}px)`),Au(this._container,L,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(Jl),N)}addTo(N){return this._map&&this.remove(),this._map=N,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(N){return this._lngLat=s.L.convert(N),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(N){return this.setDOMContent(document.createTextNode(N))}setHTML(N){const A=document.createDocumentFragment(),x=document.createElement("body");let L;for(x.innerHTML=N;L=x.firstChild,L;)A.appendChild(L);return this.setDOMContent(A)}getMaxWidth(){var N;return(N=this._container)===null||N===void 0?void 0:N.style.maxWidth}setMaxWidth(N){return this.options.maxWidth=N,this._update(),this}setDOMContent(N){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=b.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(N),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(N){this._container&&this._container.classList.add(N)}removeClassName(N){this._container&&this._container.classList.remove(N)}setOffset(N){return this.options.offset=N,this._update(),this}toggleClassName(N){if(this._container)return this._container.classList.toggle(N)}_createCloseButton(){this.options.closeButton&&(this._closeButton=b.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const N=this._container.querySelector(du);N&&N.focus()}},Gr.Marker=ks,Gr.Style=Wi,Gr.LngLat=s.L,Gr.LngLatBounds=Xe,Gr.Point=s.P,Gr.MercatorCoordinate=s.U,Gr.Evented=s.E,Gr.AJAXError=s.bi,Gr.config=s.c,Gr.CanvasSource=gi,Gr.GeoJSONSource=Pt,Gr.ImageSource=Ht,Gr.RasterDEMTileSource=wt,Gr.RasterTileSource=ft,Gr.VectorTileSource=At,Gr.VideoSource=ii,Gr.setRTLTextPlugin=s.bj,Gr.getRTLTextPluginStatus=s.bk,Gr.prewarm=function(){Er().acquire(li)},Gr.clearPrewarmedResources=function(){const N=Ar;N&&(N.isPreloaded()&&N.numActive()===1?(N.release(li),Ar=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},va.extend(Gr,{isSafari:s.ac,getPerformanceMetrics:s.bg.getPerformanceMetrics}),Gr});var l=n;return l})})(c4);var xie=c4.exports,wie=Object.defineProperty,Bie=(i,e,t)=>e in i?wie(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ms=(i,e,t)=>(Bie(i,typeof e!="symbol"?e+"":e,t),t);let Cie=class{constructor(e){Ms(this,"map"),Ms(this,"width"),Ms(this,"height"),Ms(this,"svgCanvas"),Ms(this,"xLine"),Ms(this,"yLine"),Ms(this,"color","#535353"),this.map=e,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var e,t;this.width=(e=this.map)==null?void 0:e.getCanvas().clientWidth,this.height=(t=this.map)==null?void 0:t.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const e=this.width/2,t=this.height/2;this.yLine.setAttribute("x1",`${e}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${e}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${t}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${t}px`)}else console.error("element value is null")}createCanvas(e){if(this.width!==void 0&&this.height!==void 0){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.style.position="relative",t.setAttribute("width",`${this.width}px`),t.setAttribute("height",`${this.height}px`);const r=this.width/2,n=this.height/2;this.yLine=t.appendChild(this.createLine(r,0,r,this.height,this.color,"2px")),this.xLine=t.appendChild(this.createLine(0,n,this.width,n,this.color,"2px")),e==null||e.appendChild(t),this.svgCanvas=t}}createLine(e,t,r,n,o,l){const s=document.createElementNS("http://www.w3.org/2000/svg","line");return s.setAttribute("x1",e),s.setAttribute("y1",t),s.setAttribute("x2",r),s.setAttribute("y2",n),s.setAttribute("stroke-dasharray","5,5"),s.setAttribute("stroke",o),s.setAttribute("stroke-width",l),s}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}};function Jn(i){"@babel/helpers - typeof";return Jn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jn(i)}var sc=Uint8Array,oc=Uint16Array,Ry=Uint32Array,$1=new sc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),K1=new sc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),AC=new sc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u4=function(i,e){for(var t=new oc(31),r=0;r<31;++r)t[r]=e+=1<<i[r-1];for(var n=new Ry(t[30]),r=1;r<30;++r)for(var o=t[r];o<t[r+1];++o)n[o]=o-t[r]<<5|r;return[t,n]},h4=u4($1,2),A4=h4[0],dC=h4[1];A4[28]=258,dC[258]=28;for(var d4=u4(K1,0),Eie=d4[0],f4=d4[1],fC=new oc(32768),qs=0;qs<32768;++qs){var pd=(qs&43690)>>>1|(qs&21845)<<1;pd=(pd&52428)>>>2|(pd&13107)<<2,pd=(pd&61680)>>>4|(pd&3855)<<4,fC[qs]=((pd&65280)>>>8|(pd&255)<<8)>>>1}for(var qh=function(i,e,t){for(var r=i.length,n=0,o=new oc(e);n<r;++n)++o[i[n]-1];var l=new oc(e);for(n=0;n<e;++n)l[n]=l[n-1]+o[n-1]<<1;var s;if(t){s=new oc(1<<e);var g=15-e;for(n=0;n<r;++n)if(i[n])for(var b=n<<4|i[n],T=e-i[n],F=l[i[n]-1]++<<T,k=F|(1<<T)-1;F<=k;++F)s[fC[F]>>>g]=b}else for(s=new oc(r),n=0;n<r;++n)s[n]=fC[l[i[n]-1]++]>>>15-i[n];return s},gd=new sc(288),qs=0;qs<144;++qs)gd[qs]=8;for(var qs=144;qs<256;++qs)gd[qs]=9;for(var qs=256;qs<280;++qs)gd[qs]=7;for(var qs=280;qs<288;++qs)gd[qs]=8;for(var ky=new sc(32),qs=0;qs<32;++qs)ky[qs]=5;var Sie=qh(gd,9,0),Tie=qh(gd,9,1),Iie=qh(ky,5,0),Lie=qh(ky,5,1),pC=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},ah=function(i,e,t){var r=e/8>>0;return(i[r]|i[r+1]<<8)>>>(e&7)&t},gC=function(i,e){var t=e/8>>0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>>(e&7)},mC=function(i){return(i/8>>0)+(i&7&&1)},p4=function(i,e,t){(e==null||e<0)&&(e=0),(t==null||t>i.length)&&(t=i.length);var r=new(i instanceof oc?oc:i instanceof Ry?Ry:sc)(t-e);return r.set(i.subarray(e,t)),r},Mie=function(i,e,t){var r=i.length,n=!e||t,o=!t||t.i;t||(t={}),e||(e=new sc(r*3));var l=function(ft){var wt=e.length;if(ft>wt){var Pt=new sc(Math.max(wt*2,ft));Pt.set(e),e=Pt}},s=t.f||0,g=t.p||0,b=t.b||0,T=t.l,F=t.d,k=t.m,z=t.n,J=r*8;do{if(!T){t.f=s=ah(i,g,1);var te=ah(i,g+1,3);if(g+=3,te)if(te==1)T=Tie,F=Lie,k=9,z=5;else if(te==2){var ue=ah(i,g,31)+257,ce=ah(i,g+10,15)+4,de=ue+ah(i,g+5,31)+1;g+=14;for(var _e=new sc(de),Ee=new sc(19),He=0;He<ce;++He)Ee[AC[He]]=ah(i,g+He*3,7);g+=ce*3;var Ve=pC(Ee),qe=(1<<Ve)-1;if(!o&&g+de*(Ve+7)>J)break;for(var Ue=qh(Ee,Ve,1),He=0;He<de;){var ot=Ue[ah(i,g,qe)];g+=ot&15;var it=ot>>>4;if(it<16)_e[He++]=it;else{var De=0,Me=0;for(it==16?(Me=3+ah(i,g,3),g+=2,De=_e[He-1]):it==17?(Me=3+ah(i,g,7),g+=3):it==18&&(Me=11+ah(i,g,127),g+=7);Me--;)_e[He++]=De}}var Ze=_e.subarray(0,ue),We=_e.subarray(ue);k=pC(Ze),z=pC(We),T=qh(Ze,k,1),F=qh(We,z,1)}else throw"invalid block type";else{var it=mC(g)+4,Bt=i[it-4]|i[it-3]<<8,Ct=it+Bt;if(Ct>r){if(o)throw"unexpected EOF";break}n&&l(b+Bt),e.set(i.subarray(it,Ct),b),t.b=b+=Bt,t.p=g=Ct*8;continue}if(g>J)throw"unexpected EOF"}n&&l(b+131072);for(var Lt=(1<<k)-1,_t=(1<<z)-1,Ft=k+z+18;o||g+Ft<J;){var De=T[gC(i,g)&Lt],Mt=De>>>4;if(g+=De&15,g>J)throw"unexpected EOF";if(!De)throw"invalid length/literal";if(Mt<256)e[b++]=Mt;else if(Mt==256){T=null;break}else{var Wt=Mt-254;if(Mt>264){var He=Mt-257,Se=$1[He];Wt=ah(i,g,(1<<Se)-1)+A4[He],g+=Se}var Xe=F[gC(i,g)&_t],et=Xe>>>4;if(!Xe)throw"invalid distance";g+=Xe&15;var We=Eie[et];if(et>3){var Se=K1[et];We+=gC(i,g)&(1<<Se)-1,g+=Se}if(g>J)throw"unexpected EOF";n&&l(b+131072);for(var At=b+Wt;b<At;b+=4)e[b]=e[b-We],e[b+1]=e[b+1-We],e[b+2]=e[b+2-We],e[b+3]=e[b+3-We];b=At}}t.l=T,t.p=g,t.b=b,T&&(s=1,t.m=k,t.d=F,t.n=z)}while(!s);return b==e.length?e:p4(e,0,b)},MA=function(i,e,t){t<<=e&7;var r=e/8>>0;i[r]|=t,i[r+1]|=t>>>8},Oy=function(i,e,t){t<<=e&7;var r=e/8>>0;i[r]|=t,i[r+1]|=t>>>8,i[r+2]|=t>>>16},yC=function(i,e){for(var t=[],r=0;r<i.length;++r)i[r]&&t.push({s:r,f:i[r]});var n=t.length,o=t.slice();if(!n)return[new sc(0),0];if(n==1){var l=new sc(t[0].s+1);return l[t[0].s]=1,[l,1]}t.sort(function(He,Ve){return He.f-Ve.f}),t.push({s:-1,f:25001});var s=t[0],g=t[1],b=0,T=1,F=2;for(t[0]={s:-1,f:s.f+g.f,l:s,r:g};T!=n-1;)s=t[t[b].f<t[F].f?b++:F++],g=t[b!=T&&t[b].f<t[F].f?b++:F++],t[T++]={s:-1,f:s.f+g.f,l:s,r:g};for(var k=o[0].s,r=1;r<n;++r)o[r].s>k&&(k=o[r].s);var z=new oc(k+1),J=_C(t[T-1],z,0);if(J>e){var r=0,te=0,ue=J-e,ce=1<<ue;for(o.sort(function(Ve,qe){return z[qe.s]-z[Ve.s]||Ve.f-qe.f});r<n;++r){var de=o[r].s;if(z[de]>e)te+=ce-(1<<J-z[de]),z[de]=e;else break}for(te>>>=ue;te>0;){var _e=o[r].s;z[_e]<e?te-=1<<e-z[_e]++-1:++r}for(;r>=0&&te;--r){var Ee=o[r].s;z[Ee]==e&&(--z[Ee],++te)}J=e}return[new sc(z),J]},_C=function(i,e,t){return i.s==-1?Math.max(_C(i.l,e,t+1),_C(i.r,e,t+1)):e[i.s]=t},g4=function(i){for(var e=i.length;e&&!i[--e];);for(var t=new oc(++e),r=0,n=i[0],o=1,l=function(g){t[r++]=g},s=1;s<=e;++s)if(i[s]==n&&s!=e)++o;else{if(!n&&o>2){for(;o>138;o-=138)l(32754);o>2&&(l(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(l(n),--o;o>6;o-=6)l(8304);o>2&&(l(o-3<<5|8208),o=0)}for(;o--;)l(n);o=1,n=i[s]}return[t.subarray(0,r),e]},Uy=function(i,e){for(var t=0,r=0;r<e.length;++r)t+=i[r]*e[r];return t},W1=function(i,e,t){var r=t.length,n=mC(e+2);i[n]=r&255,i[n+1]=r>>>8,i[n+2]=i[n]^255,i[n+3]=i[n+1]^255;for(var o=0;o<r;++o)i[n+o+4]=t[o];return(n+4+r)*8},m4=function(i,e,t,r,n,o,l,s,g,b,T){MA(e,T++,t),++n[256];for(var F=yC(n,15),k=F[0],z=F[1],J=yC(o,15),te=J[0],ue=J[1],ce=g4(k),de=ce[0],_e=ce[1],Ee=g4(te),He=Ee[0],Ve=Ee[1],qe=new oc(19),Ue=0;Ue<de.length;++Ue)qe[de[Ue]&31]++;for(var Ue=0;Ue<He.length;++Ue)qe[He[Ue]&31]++;for(var ot=yC(qe,7),it=ot[0],De=ot[1],Me=19;Me>4&&!it[AC[Me-1]];--Me);var Ze=b+5<<3,We=Uy(n,gd)+Uy(o,ky)+l,Bt=Uy(n,k)+Uy(o,te)+l+14+3*Me+Uy(qe,it)+(2*qe[16]+3*qe[17]+7*qe[18]);if(Ze<=We&&Ze<=Bt)return W1(e,T,i.subarray(g,g+b));var Ct,Lt,_t,Ft;if(MA(e,T,1+(Bt<We)),T+=2,Bt<We){Ct=qh(k,z,0),Lt=k,_t=qh(te,ue,0),Ft=te;var Mt=qh(it,De,0);MA(e,T,_e-257),MA(e,T+5,Ve-1),MA(e,T+10,Me-4),T+=14;for(var Ue=0;Ue<Me;++Ue)MA(e,T+3*Ue,it[AC[Ue]]);T+=3*Me;for(var Wt=[de,He],Se=0;Se<2;++Se)for(var Xe=Wt[Se],Ue=0;Ue<Xe.length;++Ue){var et=Xe[Ue]&31;MA(e,T,Mt[et]),T+=it[et],et>15&&(MA(e,T,Xe[Ue]>>>5&127),T+=Xe[Ue]>>>12)}}else Ct=Sie,Lt=gd,_t=Iie,Ft=ky;for(var Ue=0;Ue<s;++Ue)if(r[Ue]>255){var et=r[Ue]>>>18&31;Oy(e,T,Ct[et+257]),T+=Lt[et+257],et>7&&(MA(e,T,r[Ue]>>>23&31),T+=$1[et]);var At=r[Ue]&31;Oy(e,T,_t[At]),T+=Ft[At],At>3&&(Oy(e,T,r[Ue]>>>5&8191),T+=K1[At])}else Oy(e,T,Ct[r[Ue]]),T+=Lt[r[Ue]];return Oy(e,T,Ct[256]),T+Lt[256]},Pie=new Ry([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Fie=new sc(0),Die=function(i,e,t,r,n,o){var l=i.length,s=new sc(r+l+5*(1+Math.floor(l/7e3))+n),g=s.subarray(r,s.length-n),b=0;if(!e||l<8)for(var T=0;T<=l;T+=65535){var F=T+65535;F<l?b=W1(g,b,i.subarray(T,F)):(g[T]=o,b=W1(g,b,i.subarray(T,l)))}else{for(var k=Pie[e-1],z=k>>>13,J=k&8191,te=(1<<t)-1,ue=new oc(32768),ce=new oc(te+1),de=Math.ceil(t/3),_e=2*de,Ee=function(Mi){return(i[Mi]^i[Mi+1]<<de^i[Mi+2]<<_e)&te},He=new Ry(25e3),Ve=new oc(288),qe=new oc(32),Ue=0,ot=0,T=0,it=0,De=0,Me=0;T<l;++T){var Ze=Ee(T),We=T&32767,Bt=ce[Ze];if(ue[We]=Bt,ce[Ze]=We,De<=T){var Ct=l-T;if((Ue>7e3||it>24576)&&Ct>423){b=m4(i,g,0,He,Ve,qe,ot,it,Me,T-Me,b),it=Ue=ot=0,Me=T;for(var Lt=0;Lt<286;++Lt)Ve[Lt]=0;for(var Lt=0;Lt<30;++Lt)qe[Lt]=0}var _t=2,Ft=0,Mt=J,Wt=We-Bt&32767;if(Ct>2&&Ze==Ee(T-Wt))for(var Se=Math.min(z,Ct)-1,Xe=Math.min(32767,T),et=Math.min(258,Ct);Wt<=Xe&&--Mt&&We!=Bt;){if(i[T+_t]==i[T+_t-Wt]){for(var At=0;At<et&&i[T+At]==i[T+At-Wt];++At);if(At>_t){if(_t=At,Ft=Wt,At>Se)break;for(var ft=Math.min(Wt,At-2),wt=0,Lt=0;Lt<ft;++Lt){var Pt=T-Wt+Lt+32768&32767,It=ue[Pt],Ht=Pt-It+32768&32767;Ht>wt&&(wt=Ht,Bt=Pt)}}}We=Bt,Bt=ue[We],Wt+=We-Bt+32768&32767}if(Ft){He[it++]=268435456|dC[_t]<<18|f4[Ft];var ii=dC[_t]&31,gi=f4[Ft]&31;ot+=$1[ii]+K1[gi],++Ve[257+ii],++qe[gi],De=T+_t,++Ue}else He[it++]=i[T],++Ve[i[T]]}}b=m4(i,g,o,He,Ve,qe,ot,it,Me,T-Me,b),o||(b=W1(g,b,Fie))}return p4(s,0,r+mC(b)+n)},Rie=function(){var i=1,e=0;return{p:function(t){for(var r=i,n=e,o=t.length,l=0;l!=o;){for(var s=Math.min(l+5552,o);l<s;++l)r+=t[l],n+=r;r%=65521,n%=65521}i=r,e=n},d:function(){return(i>>>8<<16|(e&255)<<8|e>>>8)+((i&255)<<23)*2}}},kie=function(i,e,t,r,n){return Die(i,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(i.length)))*1.5):12+e.mem,t,r,!n)},Oie=function(i,e,t){for(;t;++e)i[e]=t,t>>>=8},Uie=function(i,e){var t=e.level,r=t==0?0:t<6?1:t==9?3:2;i[0]=120,i[1]=r<<6|(r?32-2*r:1)},Nie=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function vC(i,e){e===void 0&&(e={});var t=Rie();t.p(i);var r=kie(i,e,2,4);return Uie(r,e),Oie(r,r.length-4,t.d()),r}function zie(i,e){return Mie((Nie(i),i.subarray(2,-4)),e)}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.1 Built on 2022-01-28T15:37:57.791Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Hollnder <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var Rr=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function bC(){Rr.console&&typeof Rr.console.log=="function"&&Rr.console.log.apply(Rr.console,arguments)}var Ps={log:bC,warn:function(i){Rr.console&&(typeof Rr.console.warn=="function"?Rr.console.warn.apply(Rr.console,arguments):bC.call(null,arguments))},error:function(i){Rr.console&&(typeof Rr.console.error=="function"?Rr.console.error.apply(Rr.console,arguments):bC(i))}};function xC(i,e,t){var r=new XMLHttpRequest;r.open("GET",i),r.responseType="blob",r.onload=function(){Tf(r.response,e,t)},r.onerror=function(){Ps.error("could not download file")},r.send()}function y4(i){var e=new XMLHttpRequest;e.open("HEAD",i,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function X1(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(e)}}var Ny,wC,Tf=Rr.saveAs||((typeof window>"u"?"undefined":Jn(window))!=="object"||window!==Rr?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(i,e,t){var r=Rr.URL||Rr.webkitURL,n=document.createElement("a");e=e||i.name||"download",n.download=e,n.rel="noopener",typeof i=="string"?(n.href=i,n.origin!==location.origin?y4(n.href)?xC(i,e,t):X1(n,n.target="_blank"):X1(n)):(n.href=r.createObjectURL(i),setTimeout(function(){r.revokeObjectURL(n.href)},4e4),setTimeout(function(){X1(n)},0))}:"msSaveOrOpenBlob"in navigator?function(i,e,t){if(e=e||i.name||"download",typeof i=="string")if(y4(i))xC(i,e,t);else{var r=document.createElement("a");r.href=i,r.target="_blank",setTimeout(function(){X1(r)})}else navigator.msSaveOrOpenBlob(function(n,o){return o===void 0?o={autoBom:!1}:Jn(o)!=="object"&&(Ps.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}(i,t),e)}:function(i,e,t,r){if((r=r||open("","_blank"))&&(r.document.title=r.document.body.innerText="downloading..."),typeof i=="string")return xC(i,e,t);var n=i.type==="application/octet-stream",o=/constructor/i.test(Rr.HTMLElement)||Rr.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||n&&o)&&(typeof FileReader>"u"?"undefined":Jn(FileReader))==="object"){var s=new FileReader;s.onloadend=function(){var T=s.result;T=l?T:T.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=T:location=T,r=null},s.readAsDataURL(i)}else{var g=Rr.URL||Rr.webkitURL,b=g.createObjectURL(i);r?r.location=b:location.href=b,r=null,setTimeout(function(){g.revokeObjectURL(b)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function _4(i){var e;i=i||"",this.ok=!1,i.charAt(0)=="#"&&(i=i.substr(1,6)),i={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[i=(i=i.replace(/ /g,"")).toLowerCase()]||i;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(s){return[parseInt(s[1]),parseInt(s[2]),parseInt(s[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(s){return[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(s){return[parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16),parseInt(s[3]+s[3],16)]}}],r=0;r<t.length;r++){var n=t[r].re,o=t[r].process,l=n.exec(i);l&&(e=o(l),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var s=this.r.toString(16),g=this.g.toString(16),b=this.b.toString(16);return s.length==1&&(s="0"+s),g.length==1&&(g="0"+g),b.length==1&&(b="0"+b),"#"+s+g+b}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function BC(i,e){var t=i[0],r=i[1],n=i[2],o=i[3];t=Ll(t,r,n,o,e[0],7,-680876936),o=Ll(o,t,r,n,e[1],12,-389564586),n=Ll(n,o,t,r,e[2],17,606105819),r=Ll(r,n,o,t,e[3],22,-1044525330),t=Ll(t,r,n,o,e[4],7,-176418897),o=Ll(o,t,r,n,e[5],12,1200080426),n=Ll(n,o,t,r,e[6],17,-1473231341),r=Ll(r,n,o,t,e[7],22,-45705983),t=Ll(t,r,n,o,e[8],7,1770035416),o=Ll(o,t,r,n,e[9],12,-1958414417),n=Ll(n,o,t,r,e[10],17,-42063),r=Ll(r,n,o,t,e[11],22,-1990404162),t=Ll(t,r,n,o,e[12],7,1804603682),o=Ll(o,t,r,n,e[13],12,-40341101),n=Ll(n,o,t,r,e[14],17,-1502002290),t=Ml(t,r=Ll(r,n,o,t,e[15],22,1236535329),n,o,e[1],5,-165796510),o=Ml(o,t,r,n,e[6],9,-1069501632),n=Ml(n,o,t,r,e[11],14,643717713),r=Ml(r,n,o,t,e[0],20,-373897302),t=Ml(t,r,n,o,e[5],5,-701558691),o=Ml(o,t,r,n,e[10],9,38016083),n=Ml(n,o,t,r,e[15],14,-660478335),r=Ml(r,n,o,t,e[4],20,-405537848),t=Ml(t,r,n,o,e[9],5,568446438),o=Ml(o,t,r,n,e[14],9,-1019803690),n=Ml(n,o,t,r,e[3],14,-187363961),r=Ml(r,n,o,t,e[8],20,1163531501),t=Ml(t,r,n,o,e[13],5,-1444681467),o=Ml(o,t,r,n,e[2],9,-51403784),n=Ml(n,o,t,r,e[7],14,1735328473),t=Pl(t,r=Ml(r,n,o,t,e[12],20,-1926607734),n,o,e[5],4,-378558),o=Pl(o,t,r,n,e[8],11,-2022574463),n=Pl(n,o,t,r,e[11],16,1839030562),r=Pl(r,n,o,t,e[14],23,-35309556),t=Pl(t,r,n,o,e[1],4,-1530992060),o=Pl(o,t,r,n,e[4],11,1272893353),n=Pl(n,o,t,r,e[7],16,-155497632),r=Pl(r,n,o,t,e[10],23,-1094730640),t=Pl(t,r,n,o,e[13],4,681279174),o=Pl(o,t,r,n,e[0],11,-358537222),n=Pl(n,o,t,r,e[3],16,-722521979),r=Pl(r,n,o,t,e[6],23,76029189),t=Pl(t,r,n,o,e[9],4,-640364487),o=Pl(o,t,r,n,e[12],11,-421815835),n=Pl(n,o,t,r,e[15],16,530742520),t=Fl(t,r=Pl(r,n,o,t,e[2],23,-995338651),n,o,e[0],6,-198630844),o=Fl(o,t,r,n,e[7],10,1126891415),n=Fl(n,o,t,r,e[14],15,-1416354905),r=Fl(r,n,o,t,e[5],21,-57434055),t=Fl(t,r,n,o,e[12],6,1700485571),o=Fl(o,t,r,n,e[3],10,-1894986606),n=Fl(n,o,t,r,e[10],15,-1051523),r=Fl(r,n,o,t,e[1],21,-2054922799),t=Fl(t,r,n,o,e[8],6,1873313359),o=Fl(o,t,r,n,e[15],10,-30611744),n=Fl(n,o,t,r,e[6],15,-1560198380),r=Fl(r,n,o,t,e[13],21,1309151649),t=Fl(t,r,n,o,e[4],6,-145523070),o=Fl(o,t,r,n,e[11],10,-1120210379),n=Fl(n,o,t,r,e[2],15,718787259),r=Fl(r,n,o,t,e[9],21,-343485551),i[0]=md(t,i[0]),i[1]=md(r,i[1]),i[2]=md(n,i[2]),i[3]=md(o,i[3])}function Z1(i,e,t,r,n,o){return e=md(md(e,i),md(r,o)),md(e<<n|e>>>32-n,t)}function Ll(i,e,t,r,n,o,l){return Z1(e&t|~e&r,i,e,n,o,l)}function Ml(i,e,t,r,n,o,l){return Z1(e&r|t&~r,i,e,n,o,l)}function Pl(i,e,t,r,n,o,l){return Z1(e^t^r,i,e,n,o,l)}function Fl(i,e,t,r,n,o,l){return Z1(t^(e|~r),i,e,n,o,l)}function v4(i){var e,t=i.length,r=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=i.length;e+=64)BC(r,Qie(i.substring(e-64,e)));i=i.substring(e-64);var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<i.length;e++)n[e>>2]|=i.charCodeAt(e)<<(e%4<<3);if(n[e>>2]|=128<<(e%4<<3),e>55)for(BC(r,n),e=0;e<16;e++)n[e]=0;return n[14]=8*t,BC(r,n),r}function Qie(i){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=i.charCodeAt(e)+(i.charCodeAt(e+1)<<8)+(i.charCodeAt(e+2)<<16)+(i.charCodeAt(e+3)<<24);return t}Ny=Rr.atob.bind(Rr),wC=Rr.btoa.bind(Rr);var b4="0123456789abcdef".split("");function Vie(i){for(var e="",t=0;t<4;t++)e+=b4[i>>8*t+4&15]+b4[i>>8*t&15];return e}function Hie(i){return String.fromCharCode((255&i)>>0,(65280&i)>>8,(16711680&i)>>16,(4278190080&i)>>24)}function CC(i){return v4(i).map(Hie).join("")}var Gie=function(i){for(var e=0;e<i.length;e++)i[e]=Vie(i[e]);return i.join("")}(v4("hello"))!="5d41402abc4b2a76b9719d911017c592";function md(i,e){if(Gie){var t=(65535&i)+(65535&e);return(i>>16)+(e>>16)+(t>>16)<<16|65535&t}return i+e&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function EC(i,e){var t,r,n,o;if(i!==t){for(var l=(n=i,o=1+(256/i.length>>0),new Array(o+1).join(n)),s=[],g=0;g<256;g++)s[g]=g;var b=0;for(g=0;g<256;g++){var T=s[g];b=(b+T+l.charCodeAt(g))%256,s[g]=s[b],s[b]=T}t=i,r=s}else s=r;var F=e.length,k=0,z=0,J="";for(g=0;g<F;g++)z=(z+(T=s[k=(k+1)%256]))%256,s[k]=s[z],s[z]=T,l=s[(s[k]+s[z])%256],J+=String.fromCharCode(e.charCodeAt(g)^l);return J}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var x4={print:4,modify:8,copy:16,"annot-forms":32};function bg(i,e,t,r){this.v=1,this.r=2;var n=192;i.forEach(function(s){if(x4.perm!==void 0)throw new Error("Invalid permission: "+s);n+=x4[s]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var o=(e+this.padding).substr(0,32),l=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(o,l),this.P=-(1+(255^n)),this.encryptionKey=CC(o+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(r)).substr(0,5),this.U=EC(this.encryptionKey,this.padding)}function xg(i){if(/[^\u0000-\u00ff]/.test(i))throw new Error("Invalid PDF Name Object: "+i+", Only accept ASCII characters.");for(var e="",t=i.length,r=0;r<t;r++){var n=i.charCodeAt(r);n<33||n===35||n===37||n===40||n===41||n===47||n===60||n===62||n===91||n===93||n===123||n===125||n>126?e+="#"+("0"+n.toString(16)).slice(-2):e+=i[r]}return e}function w4(i){if(Jn(i)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,r,n){if(n=n||!1,typeof t!="string"||typeof r!="function"||typeof n!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var o=Math.random().toString(35);return e[t][o]=[r,!!n],o},this.unsubscribe=function(t){for(var r in e)if(e[r][t])return delete e[r][t],Object.keys(e[r]).length===0&&delete e[r],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var r=Array.prototype.slice.call(arguments,1),n=[];for(var o in e[t]){var l=e[t][o];try{l[0].apply(i,r)}catch(s){Rr.console&&Ps.error("jsPDF PubSub Error",s.message,s)}l[1]&&n.push(o)}n.length&&n.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function J1(i){if(!(this instanceof J1))return new J1(i);var e="opacity,stroke-opacity".split(",");for(var t in i)i.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=i[t]);this.id="",this.objectNumber=-1}function B4(i,e){this.gState=i,this.matrix=e,this.id="",this.objectNumber=-1}function If(i,e,t,r,n){if(!(this instanceof If))return new If(i,e,t,r,n);this.type=i==="axial"?2:3,this.coords=e,this.colors=t,B4.call(this,r,n)}function wg(i,e,t,r,n){if(!(this instanceof wg))return new wg(i,e,t,r,n);this.boundingBox=i,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,B4.call(this,r,n)}function kr(i){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",r=arguments[1],n=arguments[2],o=arguments[3],l=[],s=1,g=16,b="S",T=null;Jn(i=i||{})==="object"&&(t=i.orientation,r=i.unit||r,n=i.format||n,o=i.compress||i.compressPdf||o,(T=i.encryption||null)!==null&&(T.userPassword=T.userPassword||"",T.ownerPassword=T.ownerPassword||"",T.userPermissions=T.userPermissions||[]),s=typeof i.userUnit=="number"?Math.abs(i.userUnit):1,i.precision!==void 0&&(e=i.precision),i.floatPrecision!==void 0&&(g=i.floatPrecision),b=i.defaultPathOperation||"S"),l=i.filters||(o===!0?["FlateEncode"]:l),r=r||"mm",t=(""+(t||"P")).toLowerCase();var F=i.putOnlyUsedFonts||!1,k={},z={internal:{},__private__:{}};z.__private__.PubSub=w4;var J="1.3",te=z.__private__.getPdfVersion=function(){return J};z.__private__.setPdfVersion=function(ne){J=ne};var ue={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};z.__private__.getPageFormats=function(){return ue};var ce=z.__private__.getPageFormat=function(ne){return ue[ne]};n=n||"a4";var de={COMPAT:"compat",ADVANCED:"advanced"},_e=de.COMPAT;function Ee(){this.saveGraphicsState(),at(new be(ci,0,0,-ci,0,eo()*ci).toString()+" cm"),this.setFontSize(this.getFontSize()/ci),b="n",_e=de.ADVANCED}function He(){this.restoreGraphicsState(),b="S",_e=de.COMPAT}var Ve=z.__private__.combineFontStyleAndFontWeight=function(ne,Ie){if(ne=="bold"&&Ie=="normal"||ne=="bold"&&Ie==400||ne=="normal"&&Ie=="italic"||ne=="bold"&&Ie=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Ie&&(ne=Ie==400||Ie==="normal"?ne==="italic"?"italic":"normal":Ie!=700&&Ie!=="bold"||ne!=="normal"?(Ie==700?"bold":Ie)+""+ne:"bold"),ne};z.advancedAPI=function(ne){var Ie=_e===de.COMPAT;return Ie&&Ee.call(this),typeof ne!="function"||(ne(this),Ie&&He.call(this)),this},z.compatAPI=function(ne){var Ie=_e===de.ADVANCED;return Ie&&He.call(this),typeof ne!="function"||(ne(this),Ie&&Ee.call(this)),this},z.isAdvancedAPI=function(){return _e===de.ADVANCED};var qe,Ue=function(ne){if(_e!==de.ADVANCED)throw new Error(ne+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},ot=z.roundToPrecision=z.__private__.roundToPrecision=function(ne,Ie){var lt=e||Ie;if(isNaN(ne)||isNaN(lt))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return ne.toFixed(lt).replace(/0+$/,"")};qe=z.hpf=z.__private__.hpf=typeof g=="number"?function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.hpf");return ot(ne,g)}:g==="smart"?function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.hpf");return ot(ne,ne>-1&&ne<1?16:5)}:function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.hpf");return ot(ne,16)};var it=z.f2=z.__private__.f2=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.f2");return ot(ne,2)},De=z.__private__.f3=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.f3");return ot(ne,3)},Me=z.scale=z.__private__.scale=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.scale");return _e===de.COMPAT?ne*ci:_e===de.ADVANCED?ne:void 0},Ze=function(ne){return _e===de.COMPAT?eo()-ne:_e===de.ADVANCED?ne:void 0},We=function(ne){return Me(Ze(ne))};z.__private__.setPrecision=z.setPrecision=function(ne){typeof parseInt(ne,10)=="number"&&(e=parseInt(ne,10))};var Bt,Ct="00000000000000000000000000000000",Lt=z.__private__.getFileId=function(){return Ct},_t=z.__private__.setFileId=function(ne){return Ct=ne!==void 0&&/^[a-fA-F0-9]{32}$/.test(ne)?ne.toUpperCase():Ct.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),T!==null&&(wn=new bg(T.userPermissions,T.userPassword,T.ownerPassword,Ct)),Ct};z.setFileId=function(ne){return _t(ne),this},z.getFileId=function(){return Lt()};var Ft=z.__private__.convertDateToPDFDate=function(ne){var Ie=ne.getTimezoneOffset(),lt=Ie<0?"+":"-",mt=Math.floor(Math.abs(Ie/60)),vt=Math.abs(Ie%60),Tt=[lt,et(mt),"'",et(vt),"'"].join("");return["D:",ne.getFullYear(),et(ne.getMonth()+1),et(ne.getDate()),et(ne.getHours()),et(ne.getMinutes()),et(ne.getSeconds()),Tt].join("")},Mt=z.__private__.convertPDFDateToDate=function(ne){var Ie=parseInt(ne.substr(2,4),10),lt=parseInt(ne.substr(6,2),10)-1,mt=parseInt(ne.substr(8,2),10),vt=parseInt(ne.substr(10,2),10),Tt=parseInt(ne.substr(12,2),10),pi=parseInt(ne.substr(14,2),10);return new Date(Ie,lt,mt,vt,Tt,pi,0)},Wt=z.__private__.setCreationDate=function(ne){var Ie;if(ne===void 0&&(ne=new Date),ne instanceof Date)Ie=Ft(ne);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(ne))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Ie=ne}return Bt=Ie},Se=z.__private__.getCreationDate=function(ne){var Ie=Bt;return ne==="jsDate"&&(Ie=Mt(Bt)),Ie};z.setCreationDate=function(ne){return Wt(ne),this},z.getCreationDate=function(ne){return Se(ne)};var Xe,et=z.__private__.padd2=function(ne){return("0"+parseInt(ne)).slice(-2)},At=z.__private__.padd2Hex=function(ne){return("00"+(ne=ne.toString())).substr(ne.length)},ft=0,wt=[],Pt=[],It=0,Ht=[],ii=[],gi=!1,mi=Pt,Mi=function(){ft=0,It=0,Pt=[],wt=[],Ht=[],qt=yt(),Kt=yt()};z.__private__.setCustomOutputDestination=function(ne){gi=!0,mi=ne};var kt=function(ne){gi||(mi=ne)};z.__private__.resetCustomOutputDestination=function(){gi=!1,mi=Pt};var at=z.__private__.out=function(ne){return ne=ne.toString(),It+=ne.length+1,mi.push(ne),mi},xt=z.__private__.write=function(ne){return at(arguments.length===1?ne.toString():Array.prototype.join.call(arguments," "))},Ri=z.__private__.getArrayBuffer=function(ne){for(var Ie=ne.length,lt=new ArrayBuffer(Ie),mt=new Uint8Array(lt);Ie--;)mt[Ie]=ne.charCodeAt(Ie);return lt},ei=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];z.__private__.getStandardFonts=function(){return ei};var ut=i.fontSize||16;z.__private__.setFontSize=z.setFontSize=function(ne){return ut=_e===de.ADVANCED?ne/ci:ne,this};var jt,ni=z.__private__.getFontSize=z.getFontSize=function(){return _e===de.COMPAT?ut:ut*ci},di=i.R2L||!1;z.__private__.setR2L=z.setR2L=function(ne){return di=ne,this},z.__private__.getR2L=z.getR2L=function(){return di};var li,Ki=z.__private__.setZoomMode=function(ne){var Ie=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(ne))jt=ne;else if(isNaN(ne)){if(Ie.indexOf(ne)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+ne+'" is not recognized.');jt=ne}else jt=parseInt(ne,10)};z.__private__.getZoomMode=function(){return jt};var tr,Ar=z.__private__.setPageMode=function(ne){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(ne)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+ne+'" is not recognized.');li=ne};z.__private__.getPageMode=function(){return li};var Er=z.__private__.setLayoutMode=function(ne){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(ne)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+ne+'" is not recognized.');tr=ne};z.__private__.getLayoutMode=function(){return tr},z.__private__.setDisplayMode=z.setDisplayMode=function(ne,Ie,lt){return Ki(ne),Er(Ie),Ar(lt),this};var Nt={title:"",subject:"",author:"",keywords:"",creator:""};z.__private__.getDocumentProperty=function(ne){if(Object.keys(Nt).indexOf(ne)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Nt[ne]},z.__private__.getDocumentProperties=function(){return Nt},z.__private__.setDocumentProperties=z.setProperties=z.setDocumentProperties=function(ne){for(var Ie in Nt)Nt.hasOwnProperty(Ie)&&ne[Ie]&&(Nt[Ie]=ne[Ie]);return this},z.__private__.setDocumentProperty=function(ne,Ie){if(Object.keys(Nt).indexOf(ne)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Nt[ne]=Ie};var Ji,ci,$t,Zi,Qt,Bi={},Ii={},Gt=[],vi={},Jt={},mr={},Sr={},ze=null,we=0,oe=[],ee=new w4(z),le=i.hotfixes||[],ge={},ve={},Ce=[],be=function ne(Ie,lt,mt,vt,Tt,pi){if(!(this instanceof ne))return new ne(Ie,lt,mt,vt,Tt,pi);isNaN(Ie)&&(Ie=1),isNaN(lt)&&(lt=0),isNaN(mt)&&(mt=0),isNaN(vt)&&(vt=1),isNaN(Tt)&&(Tt=0),isNaN(pi)&&(pi=0),this._matrix=[Ie,lt,mt,vt,Tt,pi]};Object.defineProperty(be.prototype,"sx",{get:function(){return this._matrix[0]},set:function(ne){this._matrix[0]=ne}}),Object.defineProperty(be.prototype,"shy",{get:function(){return this._matrix[1]},set:function(ne){this._matrix[1]=ne}}),Object.defineProperty(be.prototype,"shx",{get:function(){return this._matrix[2]},set:function(ne){this._matrix[2]=ne}}),Object.defineProperty(be.prototype,"sy",{get:function(){return this._matrix[3]},set:function(ne){this._matrix[3]=ne}}),Object.defineProperty(be.prototype,"tx",{get:function(){return this._matrix[4]},set:function(ne){this._matrix[4]=ne}}),Object.defineProperty(be.prototype,"ty",{get:function(){return this._matrix[5]},set:function(ne){this._matrix[5]=ne}}),Object.defineProperty(be.prototype,"a",{get:function(){return this._matrix[0]},set:function(ne){this._matrix[0]=ne}}),Object.defineProperty(be.prototype,"b",{get:function(){return this._matrix[1]},set:function(ne){this._matrix[1]=ne}}),Object.defineProperty(be.prototype,"c",{get:function(){return this._matrix[2]},set:function(ne){this._matrix[2]=ne}}),Object.defineProperty(be.prototype,"d",{get:function(){return this._matrix[3]},set:function(ne){this._matrix[3]=ne}}),Object.defineProperty(be.prototype,"e",{get:function(){return this._matrix[4]},set:function(ne){this._matrix[4]=ne}}),Object.defineProperty(be.prototype,"f",{get:function(){return this._matrix[5]},set:function(ne){this._matrix[5]=ne}}),Object.defineProperty(be.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(be.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(be.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(be.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),be.prototype.join=function(ne){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(qe).join(ne)},be.prototype.multiply=function(ne){var Ie=ne.sx*this.sx+ne.shy*this.shx,lt=ne.sx*this.shy+ne.shy*this.sy,mt=ne.shx*this.sx+ne.sy*this.shx,vt=ne.shx*this.shy+ne.sy*this.sy,Tt=ne.tx*this.sx+ne.ty*this.shx+this.tx,pi=ne.tx*this.shy+ne.ty*this.sy+this.ty;return new be(Ie,lt,mt,vt,Tt,pi)},be.prototype.decompose=function(){var ne=this.sx,Ie=this.shy,lt=this.shx,mt=this.sy,vt=this.tx,Tt=this.ty,pi=Math.sqrt(ne*ne+Ie*Ie),ri=(ne/=pi)*lt+(Ie/=pi)*mt;lt-=ne*ri,mt-=Ie*ri;var rr=Math.sqrt(lt*lt+mt*mt);return ri/=rr,ne*(mt/=rr)<Ie*(lt/=rr)&&(ne=-ne,Ie=-Ie,ri=-ri,pi=-pi),{scale:new be(pi,0,0,rr,0,0),translate:new be(1,0,0,1,vt,Tt),rotate:new be(ne,Ie,-Ie,ne,0,0),skew:new be(1,0,ri,1,0,0)}},be.prototype.toString=function(ne){return this.join(" ")},be.prototype.inversed=function(){var ne=this.sx,Ie=this.shy,lt=this.shx,mt=this.sy,vt=this.tx,Tt=this.ty,pi=1/(ne*mt-Ie*lt),ri=mt*pi,rr=-Ie*pi,qi=-lt*pi,ki=ne*pi;return new be(ri,rr,qi,ki,-ri*vt-qi*Tt,-rr*vt-ki*Tt)},be.prototype.applyToPoint=function(ne){var Ie=ne.x*this.sx+ne.y*this.shx+this.tx,lt=ne.x*this.shy+ne.y*this.sy+this.ty;return new Ql(Ie,lt)},be.prototype.applyToRectangle=function(ne){var Ie=this.applyToPoint(ne),lt=this.applyToPoint(new Ql(ne.x+ne.w,ne.y+ne.h));return new Ya(Ie.x,Ie.y,lt.x-Ie.x,lt.y-Ie.y)},be.prototype.clone=function(){var ne=this.sx,Ie=this.shy,lt=this.shx,mt=this.sy,vt=this.tx,Tt=this.ty;return new be(ne,Ie,lt,mt,vt,Tt)},z.Matrix=be;var Pe=z.matrixMult=function(ne,Ie){return Ie.multiply(ne)},Oe=new be(1,0,0,1,0,0);z.unitMatrix=z.identityMatrix=Oe;var Ge=function(ne,Ie){if(!Jt[ne]){var lt=(Ie instanceof If?"Sh":"P")+(Object.keys(vi).length+1).toString(10);Ie.id=lt,Jt[ne]=lt,vi[lt]=Ie,ee.publish("addPattern",Ie)}};z.ShadingPattern=If,z.TilingPattern=wg,z.addShadingPattern=function(ne,Ie){return Ue("addShadingPattern()"),Ge(ne,Ie),this},z.beginTilingPattern=function(ne){Ue("beginTilingPattern()"),Vl(ne.boundingBox[0],ne.boundingBox[1],ne.boundingBox[2]-ne.boundingBox[0],ne.boundingBox[3]-ne.boundingBox[1],ne.matrix)},z.endTilingPattern=function(ne,Ie){Ue("endTilingPattern()"),Ie.stream=ii[Xe].join(`
`),Ge(ne,Ie),ee.publish("endTilingPattern",Ie),Ce.pop().restore()};var rt=z.__private__.newObject=function(){var ne=yt();return Et(ne,!0),ne},yt=z.__private__.newObjectDeferred=function(){return ft++,wt[ft]=function(){return It},ft},Et=function(ne,Ie){return Ie=typeof Ie=="boolean"&&Ie,wt[ne]=It,Ie&&at(ne+" 0 obj"),ne},Yt=z.__private__.newAdditionalObject=function(){var ne={objId:yt(),content:""};return Ht.push(ne),ne},qt=yt(),Kt=yt(),si=z.__private__.decodeColorString=function(ne){var Ie=ne.split(" ");if(Ie.length!==2||Ie[1]!=="g"&&Ie[1]!=="G")Ie.length===5&&(Ie[4]==="k"||Ie[4]==="K")&&(Ie=[(1-Ie[0])*(1-Ie[3]),(1-Ie[1])*(1-Ie[3]),(1-Ie[2])*(1-Ie[3]),"r"]);else{var lt=parseFloat(Ie[0]);Ie=[lt,lt,lt,"r"]}for(var mt="#",vt=0;vt<3;vt++)mt+=("0"+Math.floor(255*parseFloat(Ie[vt])).toString(16)).slice(-2);return mt},Ci=z.__private__.encodeColorString=function(ne){var Ie;typeof ne=="string"&&(ne={ch1:ne});var lt=ne.ch1,mt=ne.ch2,vt=ne.ch3,Tt=ne.ch4,pi=ne.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof lt=="string"&&lt.charAt(0)!=="#"){var ri=new _4(lt);if(ri.ok)lt=ri.toHex();else if(!/^\d*\.?\d*$/.test(lt))throw new Error('Invalid color "'+lt+'" passed to jsPDF.encodeColorString.')}if(typeof lt=="string"&&/^#[0-9A-Fa-f]{3}$/.test(lt)&&(lt="#"+lt[1]+lt[1]+lt[2]+lt[2]+lt[3]+lt[3]),typeof lt=="string"&&/^#[0-9A-Fa-f]{6}$/.test(lt)){var rr=parseInt(lt.substr(1),16);lt=rr>>16&255,mt=rr>>8&255,vt=255&rr}if(mt===void 0||Tt===void 0&&lt===mt&&mt===vt)if(typeof lt=="string")Ie=lt+" "+pi[0];else switch(ne.precision){case 2:Ie=it(lt/255)+" "+pi[0];break;case 3:default:Ie=De(lt/255)+" "+pi[0]}else if(Tt===void 0||Jn(Tt)==="object"){if(Tt&&!isNaN(Tt.a)&&Tt.a===0)return Ie=["1.","1.","1.",pi[1]].join(" ");if(typeof lt=="string")Ie=[lt,mt,vt,pi[1]].join(" ");else switch(ne.precision){case 2:Ie=[it(lt/255),it(mt/255),it(vt/255),pi[1]].join(" ");break;default:case 3:Ie=[De(lt/255),De(mt/255),De(vt/255),pi[1]].join(" ")}}else if(typeof lt=="string")Ie=[lt,mt,vt,Tt,pi[2]].join(" ");else switch(ne.precision){case 2:Ie=[it(lt),it(mt),it(vt),it(Tt),pi[2]].join(" ");break;case 3:default:Ie=[De(lt),De(mt),De(vt),De(Tt),pi[2]].join(" ")}return Ie},Hi=z.__private__.getFilters=function(){return l},wi=z.__private__.putStream=function(ne){var Ie=(ne=ne||{}).data||"",lt=ne.filters||Hi(),mt=ne.alreadyAppliedFilters||[],vt=ne.addLength1||!1,Tt=Ie.length,pi=ne.objectId,ri=function(Lr){return Lr};if(T!==null&&pi===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");T!==null&&(ri=wn.encryptor(pi,0));var rr={};lt===!0&&(lt=["FlateEncode"]);var qi=ne.additionalKeyValues||[],ki=(rr=kr.API.processDataByFilters!==void 0?kr.API.processDataByFilters(Ie,lt):{data:Ie,reverseChain:[]}).reverseChain+(Array.isArray(mt)?mt.join(" "):mt.toString());if(rr.data.length!==0&&(qi.push({key:"Length",value:rr.data.length}),vt===!0&&qi.push({key:"Length1",value:Tt})),ki.length!=0)if(ki.split("/").length-1==1)qi.push({key:"Filter",value:ki});else{qi.push({key:"Filter",value:"["+ki+"]"});for(var jr=0;jr<qi.length;jr+=1)if(qi[jr].key==="DecodeParms"){for(var nr=[],Gn=0;Gn<rr.reverseChain.split("/").length-1;Gn+=1)nr.push("null");nr.push(qi[jr].value),qi[jr].value="["+nr.join(" ")+"]"}}at("<<");for(var Br=0;Br<qi.length;Br++)at("/"+qi[Br].key+" "+qi[Br].value);at(">>"),rr.data.length!==0&&(at("stream"),at(ri(rr.data)),at("endstream"))},Ui=z.__private__.putPage=function(ne){var Ie=ne.number,lt=ne.data,mt=ne.objId,vt=ne.contentsObjId;Et(mt,!0),at("<</Type /Page"),at("/Parent "+ne.rootDictionaryObjId+" 0 R"),at("/Resources "+ne.resourceDictionaryObjId+" 0 R"),at("/MediaBox ["+parseFloat(qe(ne.mediaBox.bottomLeftX))+" "+parseFloat(qe(ne.mediaBox.bottomLeftY))+" "+qe(ne.mediaBox.topRightX)+" "+qe(ne.mediaBox.topRightY)+"]"),ne.cropBox!==null&&at("/CropBox ["+qe(ne.cropBox.bottomLeftX)+" "+qe(ne.cropBox.bottomLeftY)+" "+qe(ne.cropBox.topRightX)+" "+qe(ne.cropBox.topRightY)+"]"),ne.bleedBox!==null&&at("/BleedBox ["+qe(ne.bleedBox.bottomLeftX)+" "+qe(ne.bleedBox.bottomLeftY)+" "+qe(ne.bleedBox.topRightX)+" "+qe(ne.bleedBox.topRightY)+"]"),ne.trimBox!==null&&at("/TrimBox ["+qe(ne.trimBox.bottomLeftX)+" "+qe(ne.trimBox.bottomLeftY)+" "+qe(ne.trimBox.topRightX)+" "+qe(ne.trimBox.topRightY)+"]"),ne.artBox!==null&&at("/ArtBox ["+qe(ne.artBox.bottomLeftX)+" "+qe(ne.artBox.bottomLeftY)+" "+qe(ne.artBox.topRightX)+" "+qe(ne.artBox.topRightY)+"]"),typeof ne.userUnit=="number"&&ne.userUnit!==1&&at("/UserUnit "+ne.userUnit),ee.publish("putPage",{objId:mt,pageContext:oe[Ie],pageNumber:Ie,page:lt}),at("/Contents "+vt+" 0 R"),at(">>"),at("endobj");var Tt=lt.join(`
`);return _e===de.ADVANCED&&(Tt+=`
Q`),Et(vt,!0),wi({data:Tt,filters:Hi(),objectId:vt}),at("endobj"),mt},st=z.__private__.putPages=function(){var ne,Ie,lt=[];for(ne=1;ne<=we;ne++)oe[ne].objId=yt(),oe[ne].contentsObjId=yt();for(ne=1;ne<=we;ne++)lt.push(Ui({number:ne,data:ii[ne],objId:oe[ne].objId,contentsObjId:oe[ne].contentsObjId,mediaBox:oe[ne].mediaBox,cropBox:oe[ne].cropBox,bleedBox:oe[ne].bleedBox,trimBox:oe[ne].trimBox,artBox:oe[ne].artBox,userUnit:oe[ne].userUnit,rootDictionaryObjId:qt,resourceDictionaryObjId:Kt}));Et(qt,!0),at("<</Type /Pages");var mt="/Kids [";for(Ie=0;Ie<we;Ie++)mt+=lt[Ie]+" 0 R ";at(mt+"]"),at("/Count "+we),at(">>"),at("endobj"),ee.publish("postPutPages")},ti=function(ne){ee.publish("putFont",{font:ne,out:at,newObject:rt,putStream:wi}),ne.isAlreadyPutted!==!0&&(ne.objectNumber=rt(),at("<<"),at("/Type /Font"),at("/BaseFont /"+xg(ne.postScriptName)),at("/Subtype /Type1"),typeof ne.encoding=="string"&&at("/Encoding /"+ne.encoding),at("/FirstChar 32"),at("/LastChar 255"),at(">>"),at("endobj"))},zt=function(){for(var ne in Bi)Bi.hasOwnProperty(ne)&&(F===!1||F===!0&&k.hasOwnProperty(ne))&&ti(Bi[ne])},zi=function(ne){ne.objectNumber=rt();var Ie=[];Ie.push({key:"Type",value:"/XObject"}),Ie.push({key:"Subtype",value:"/Form"}),Ie.push({key:"BBox",value:"["+[qe(ne.x),qe(ne.y),qe(ne.x+ne.width),qe(ne.y+ne.height)].join(" ")+"]"}),Ie.push({key:"Matrix",value:"["+ne.matrix.toString()+"]"});var lt=ne.pages[1].join(`
`);wi({data:lt,additionalKeyValues:Ie,objectId:ne.objectNumber}),at("endobj")},hr=function(){for(var ne in ge)ge.hasOwnProperty(ne)&&zi(ge[ne])},sn=function(ne,Ie){var lt,mt=[],vt=1/(Ie-1);for(lt=0;lt<1;lt+=vt)mt.push(lt);if(mt.push(1),ne[0].offset!=0){var Tt={offset:0,color:ne[0].color};ne.unshift(Tt)}if(ne[ne.length-1].offset!=1){var pi={offset:1,color:ne[ne.length-1].color};ne.push(pi)}for(var ri="",rr=0,qi=0;qi<mt.length;qi++){for(lt=mt[qi];lt>ne[rr+1].offset;)rr++;var ki=ne[rr].offset,jr=(lt-ki)/(ne[rr+1].offset-ki),nr=ne[rr].color,Gn=ne[rr+1].color;ri+=At(Math.round((1-jr)*nr[0]+jr*Gn[0]).toString(16))+At(Math.round((1-jr)*nr[1]+jr*Gn[1]).toString(16))+At(Math.round((1-jr)*nr[2]+jr*Gn[2]).toString(16))}return ri.trim()},bn=function(ne,Ie){Ie||(Ie=21);var lt=rt(),mt=sn(ne.colors,Ie),vt=[];vt.push({key:"FunctionType",value:"0"}),vt.push({key:"Domain",value:"[0.0 1.0]"}),vt.push({key:"Size",value:"["+Ie+"]"}),vt.push({key:"BitsPerSample",value:"8"}),vt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),vt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),wi({data:mt,additionalKeyValues:vt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:lt}),at("endobj"),ne.objectNumber=rt(),at("<< /ShadingType "+ne.type),at("/ColorSpace /DeviceRGB");var Tt="/Coords ["+qe(parseFloat(ne.coords[0]))+" "+qe(parseFloat(ne.coords[1]))+" ";ne.type===2?Tt+=qe(parseFloat(ne.coords[2]))+" "+qe(parseFloat(ne.coords[3])):Tt+=qe(parseFloat(ne.coords[2]))+" "+qe(parseFloat(ne.coords[3]))+" "+qe(parseFloat(ne.coords[4]))+" "+qe(parseFloat(ne.coords[5])),at(Tt+="]"),ne.matrix&&at("/Matrix ["+ne.matrix.toString()+"]"),at("/Function "+lt+" 0 R"),at("/Extend [true true]"),at(">>"),at("endobj")},ur=function(ne,Ie){var lt=yt(),mt=rt();Ie.push({resourcesOid:lt,objectOid:mt}),ne.objectNumber=mt;var vt=[];vt.push({key:"Type",value:"/Pattern"}),vt.push({key:"PatternType",value:"1"}),vt.push({key:"PaintType",value:"1"}),vt.push({key:"TilingType",value:"1"}),vt.push({key:"BBox",value:"["+ne.boundingBox.map(qe).join(" ")+"]"}),vt.push({key:"XStep",value:qe(ne.xStep)}),vt.push({key:"YStep",value:qe(ne.yStep)}),vt.push({key:"Resources",value:lt+" 0 R"}),ne.matrix&&vt.push({key:"Matrix",value:"["+ne.matrix.toString()+"]"}),wi({data:ne.stream,additionalKeyValues:vt,objectId:ne.objectNumber}),at("endobj")},gn=function(ne){var Ie;for(Ie in vi)vi.hasOwnProperty(Ie)&&(vi[Ie]instanceof If?bn(vi[Ie]):vi[Ie]instanceof wg&&ur(vi[Ie],ne))},mn=function(ne){for(var Ie in ne.objectNumber=rt(),at("<<"),ne)switch(Ie){case"opacity":at("/ca "+it(ne[Ie]));break;case"stroke-opacity":at("/CA "+it(ne[Ie]))}at(">>"),at("endobj")},lr=function(){var ne;for(ne in mr)mr.hasOwnProperty(ne)&&mn(mr[ne])},kn=function(){for(var ne in at("/XObject <<"),ge)ge.hasOwnProperty(ne)&&ge[ne].objectNumber>=0&&at("/"+ne+" "+ge[ne].objectNumber+" 0 R");ee.publish("putXobjectDict"),at(">>")},gs=function(){wn.oid=rt(),at("<<"),at("/Filter /Standard"),at("/V "+wn.v),at("/R "+wn.r),at("/U <"+wn.toHexString(wn.U)+">"),at("/O <"+wn.toHexString(wn.O)+">"),at("/P "+wn.P),at(">>"),at("endobj")},Qr=function(){for(var ne in at("/Font <<"),Bi)Bi.hasOwnProperty(ne)&&(F===!1||F===!0&&k.hasOwnProperty(ne))&&at("/"+ne+" "+Bi[ne].objectNumber+" 0 R");at(">>")},xn=function(){if(Object.keys(vi).length>0){for(var ne in at("/Shading <<"),vi)vi.hasOwnProperty(ne)&&vi[ne]instanceof If&&vi[ne].objectNumber>=0&&at("/"+ne+" "+vi[ne].objectNumber+" 0 R");ee.publish("putShadingPatternDict"),at(">>")}},So=function(ne){if(Object.keys(vi).length>0){for(var Ie in at("/Pattern <<"),vi)vi.hasOwnProperty(Ie)&&vi[Ie]instanceof z.TilingPattern&&vi[Ie].objectNumber>=0&&vi[Ie].objectNumber<ne&&at("/"+Ie+" "+vi[Ie].objectNumber+" 0 R");ee.publish("putTilingPatternDict"),at(">>")}},us=function(){if(Object.keys(mr).length>0){var ne;for(ne in at("/ExtGState <<"),mr)mr.hasOwnProperty(ne)&&mr[ne].objectNumber>=0&&at("/"+ne+" "+mr[ne].objectNumber+" 0 R");ee.publish("putGStateDict"),at(">>")}},Wi=function(ne){Et(ne.resourcesOid,!0),at("<<"),at("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Qr(),xn(),So(ne.objectOid),us(),kn(),at(">>"),at("endobj")},Ys=function(){var ne=[];zt(),lr(),hr(),gn(ne),ee.publish("putResources"),ne.forEach(Wi),Wi({resourcesOid:Kt,objectOid:Number.MAX_SAFE_INTEGER}),ee.publish("postPutResources")},Bs=function(){ee.publish("putAdditionalObjects");for(var ne=0;ne<Ht.length;ne++){var Ie=Ht[ne];Et(Ie.objId,!0),at(Ie.content),at("endobj")}ee.publish("postPutAdditionalObjects")},dr=function(ne){Ii[ne.fontName]=Ii[ne.fontName]||{},Ii[ne.fontName][ne.fontStyle]=ne.id},Fr=function(ne,Ie,lt,mt,vt){var Tt={id:"F"+(Object.keys(Bi).length+1).toString(10),postScriptName:ne,fontName:Ie,fontStyle:lt,encoding:mt,isStandardFont:vt||!1,metadata:{}};return ee.publish("addFont",{font:Tt,instance:this}),Bi[Tt.id]=Tt,dr(Tt),Tt.id},Hn=function(ne){for(var Ie=0,lt=ei.length;Ie<lt;Ie++){var mt=Fr.call(this,ne[Ie][0],ne[Ie][1],ne[Ie][2],ei[Ie][3],!0);F===!1&&(k[mt]=!0);var vt=ne[Ie][0].split("-");dr({id:mt,fontName:vt[0],fontStyle:vt[1]||""})}ee.publish("addFonts",{fonts:Bi,dictionary:Ii})},Or=function(ne){return ne.foo=function(){try{return ne.apply(this,arguments)}catch(mt){var Ie=mt.stack||"";~Ie.indexOf(" at ")&&(Ie=Ie.split(" at ")[1]);var lt="Error in function "+Ie.split(`
`)[0].split("<")[0]+": "+mt.message;if(!Rr.console)throw new Error(lt);Rr.console.error(lt,mt),Rr.alert&&alert(lt)}},ne.foo.bar=ne,ne.foo},Cn=function(ne,Ie){var lt,mt,vt,Tt,pi,ri,rr,qi,ki;if(vt=(Ie=Ie||{}).sourceEncoding||"Unicode",pi=Ie.outputEncoding,(Ie.autoencode||pi)&&Bi[Ji].metadata&&Bi[Ji].metadata[vt]&&Bi[Ji].metadata[vt].encoding&&(Tt=Bi[Ji].metadata[vt].encoding,!pi&&Bi[Ji].encoding&&(pi=Bi[Ji].encoding),!pi&&Tt.codePages&&(pi=Tt.codePages[0]),typeof pi=="string"&&(pi=Tt[pi]),pi)){for(rr=!1,ri=[],lt=0,mt=ne.length;lt<mt;lt++)(qi=pi[ne.charCodeAt(lt)])?ri.push(String.fromCharCode(qi)):ri.push(ne[lt]),ri[lt].charCodeAt(0)>>8&&(rr=!0);ne=ri.join("")}for(lt=ne.length;rr===void 0&&lt!==0;)ne.charCodeAt(lt-1)>>8&&(rr=!0),lt--;if(!rr)return ne;for(ri=Ie.noBOM?[]:[254,255],lt=0,mt=ne.length;lt<mt;lt++){if((ki=(qi=ne.charCodeAt(lt))>>8)>>8)throw new Error("Character at position "+lt+" of string '"+ne+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");ri.push(ki),ri.push(qi-(ki<<8))}return String.fromCharCode.apply(void 0,ri)},An=z.__private__.pdfEscape=z.pdfEscape=function(ne,Ie){return Cn(ne,Ie).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Hr=z.__private__.beginPage=function(ne){ii[++we]=[],oe[we]={objId:0,contentsObjId:0,userUnit:Number(s),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(ne[0]),topRightY:Number(ne[1])}},uo(we),kt(ii[Xe])},Gs=function(ne,Ie){var lt,mt,vt;switch(t=Ie||t,typeof ne=="string"&&(lt=ce(ne.toLowerCase()),Array.isArray(lt)&&(mt=lt[0],vt=lt[1])),Array.isArray(ne)&&(mt=ne[0]*ci,vt=ne[1]*ci),isNaN(mt)&&(mt=n[0],vt=n[1]),(mt>14400||vt>14400)&&(Ps.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),mt=Math.min(14400,mt),vt=Math.min(14400,vt)),n=[mt,vt],t.substr(0,1)){case"l":vt>mt&&(n=[vt,mt]);break;case"p":mt>vt&&(n=[vt,mt])}Hr(n),Vr(dn),at(Ao),lu!==0&&at(lu+" J"),cu!==0&&at(cu+" j"),ee.publish("addPage",{pageNumber:we})},ca=function(ne){ne>0&&ne<=we&&(ii.splice(ne,1),oe.splice(ne,1),we--,Xe>we&&(Xe=we),this.setPage(Xe))},uo=function(ne){ne>0&&ne<=we&&(Xe=ne)},Ea=z.__private__.getNumberOfPages=z.getNumberOfPages=function(){return ii.length-1},Ne=function(ne,Ie,lt){var mt,vt=void 0;return lt=lt||{},ne=ne!==void 0?ne:Bi[Ji].fontName,Ie=Ie!==void 0?Ie:Bi[Ji].fontStyle,mt=ne.toLowerCase(),Ii[mt]!==void 0&&Ii[mt][Ie]!==void 0?vt=Ii[mt][Ie]:Ii[ne]!==void 0&&Ii[ne][Ie]!==void 0?vt=Ii[ne][Ie]:lt.disableWarning===!1&&Ps.warn("Unable to look up font label for font '"+ne+"', '"+Ie+"'. Refer to getFontList() for available fonts."),vt||lt.noFallback||(vt=Ii.times[Ie])==null&&(vt=Ii.times.normal),vt},Je=z.__private__.putInfo=function(){var ne=rt(),Ie=function(mt){return mt};for(var lt in T!==null&&(Ie=wn.encryptor(ne,0)),at("<<"),at("/Producer ("+An(Ie("jsPDF "+kr.version))+")"),Nt)Nt.hasOwnProperty(lt)&&Nt[lt]&&at("/"+lt.substr(0,1).toUpperCase()+lt.substr(1)+" ("+An(Ie(Nt[lt]))+")");at("/CreationDate ("+An(Ie(Bt))+")"),at(">>"),at("endobj")},dt=z.__private__.putCatalog=function(ne){var Ie=(ne=ne||{}).rootDictionaryObjId||qt;switch(rt(),at("<<"),at("/Type /Catalog"),at("/Pages "+Ie+" 0 R"),jt||(jt="fullwidth"),jt){case"fullwidth":at("/OpenAction [3 0 R /FitH null]");break;case"fullheight":at("/OpenAction [3 0 R /FitV null]");break;case"fullpage":at("/OpenAction [3 0 R /Fit]");break;case"original":at("/OpenAction [3 0 R /XYZ null null 1]");break;default:var lt=""+jt;lt.substr(lt.length-1)==="%"&&(jt=parseInt(jt)/100),typeof jt=="number"&&at("/OpenAction [3 0 R /XYZ null null "+it(jt)+"]")}switch(tr||(tr="continuous"),tr){case"continuous":at("/PageLayout /OneColumn");break;case"single":at("/PageLayout /SinglePage");break;case"two":case"twoleft":at("/PageLayout /TwoColumnLeft");break;case"tworight":at("/PageLayout /TwoColumnRight")}li&&at("/PageMode /"+li),ee.publish("putCatalog"),at(">>"),at("endobj")},Ot=z.__private__.putTrailer=function(){at("trailer"),at("<<"),at("/Size "+(ft+1)),at("/Root "+ft+" 0 R"),at("/Info "+(ft-1)+" 0 R"),T!==null&&at("/Encrypt "+wn.oid+" 0 R"),at("/ID [ <"+Ct+"> <"+Ct+"> ]"),at(">>")},ui=z.__private__.putHeader=function(){at("%PDF-"+J),at("%")},Gi=z.__private__.putXRef=function(){var ne="0000000000";at("xref"),at("0 "+(ft+1)),at("0000000000 65535 f ");for(var Ie=1;Ie<=ft;Ie++)typeof wt[Ie]=="function"?at((ne+wt[Ie]()).slice(-10)+" 00000 n "):wt[Ie]!==void 0?at((ne+wt[Ie]).slice(-10)+" 00000 n "):at("0000000000 00000 n ")},br=z.__private__.buildDocument=function(){Mi(),kt(Pt),ee.publish("buildDocument"),ui(),st(),Bs(),Ys(),T!==null&&gs(),Je(),dt();var ne=It;return Gi(),Ot(),at("startxref"),at(""+ne),at("%%EOF"),kt(ii[Xe]),Pt.join(`
`)},En=z.__private__.getBlob=function(ne){return new Blob([Ri(ne)],{type:"application/pdf"})},On=z.output=z.__private__.output=Or(function(ne,Ie){switch(typeof(Ie=Ie||{})=="string"?Ie={filename:Ie}:Ie.filename=Ie.filename||"generated.pdf",ne){case void 0:return br();case"save":z.save(Ie.filename);break;case"arraybuffer":return Ri(br());case"blob":return En(br());case"bloburi":case"bloburl":if(Rr.URL!==void 0&&typeof Rr.URL.createObjectURL=="function")return Rr.URL&&Rr.URL.createObjectURL(En(br()))||void 0;Ps.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var lt="",mt=br();try{lt=wC(mt)}catch{lt=wC(unescape(encodeURIComponent(mt)))}return"data:application/pdf;filename="+Ie.filename+";base64,"+lt;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Rr)==="[object Window]"){var vt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Tt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Ie.pdfObjectUrl&&(vt=Ie.pdfObjectUrl,Tt="");var pi='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+vt+'"'+Tt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Ie)+");<\/script></body></html>",ri=Rr.open();return ri!==null&&ri.document.write(pi),ri}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Rr)==="[object Window]"){var rr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Ie.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Ie.filename+'" width="500px" height="400px" /></body></html>',qi=Rr.open();if(qi!==null){qi.document.write(rr);var ki=this;qi.document.documentElement.querySelector("#pdfViewer").onload=function(){qi.document.title=Ie.filename,qi.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(ki.output("bloburl"))}}return qi}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Rr)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var jr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Ie)+'"></iframe></body></html>',nr=Rr.open();if(nr!==null&&(nr.document.write(jr),nr.document.title=Ie.filename),nr||typeof safari>"u")return nr;break;case"datauri":case"dataurl":return Rr.document.location.href=this.output("datauristring",Ie);default:return null}}),rs=function(ne){return Array.isArray(le)===!0&&le.indexOf(ne)>-1};switch(r){case"pt":ci=1;break;case"mm":ci=72/25.4;break;case"cm":ci=72/2.54;break;case"in":ci=72;break;case"px":ci=rs("px_scaling")==1?.75:96/72;break;case"pc":case"em":ci=12;break;case"ex":ci=6;break;default:if(typeof r!="number")throw new Error("Invalid unit: "+r);ci=r}var wn=null;Wt(),_t();var au=function(ne){return T!==null?wn.encryptor(ne,0):function(Ie){return Ie}},$a=z.__private__.getPageInfo=z.getPageInfo=function(ne){if(isNaN(ne)||ne%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:oe[ne].objId,pageNumber:ne,pageContext:oe[ne]}},Tr=z.__private__.getPageInfoByObjId=function(ne){if(isNaN(ne)||ne%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Ie in oe)if(oe[Ie].objId===ne)break;return $a(Ie)},Ka=z.__private__.getCurrentPageInfo=z.getCurrentPageInfo=function(){return{objId:oe[Xe].objId,pageNumber:Xe,pageContext:oe[Xe]}};z.addPage=function(){return Gs.apply(this,arguments),this},z.setPage=function(){return uo.apply(this,arguments),kt.call(this,ii[Xe]),this},z.insertPage=function(ne){return this.addPage(),this.movePage(Xe,ne),this},z.movePage=function(ne,Ie){var lt,mt;if(ne>Ie){lt=ii[ne],mt=oe[ne];for(var vt=ne;vt>Ie;vt--)ii[vt]=ii[vt-1],oe[vt]=oe[vt-1];ii[Ie]=lt,oe[Ie]=mt,this.setPage(Ie)}else if(ne<Ie){lt=ii[ne],mt=oe[ne];for(var Tt=ne;Tt<Ie;Tt++)ii[Tt]=ii[Tt+1],oe[Tt]=oe[Tt+1];ii[Ie]=lt,oe[Ie]=mt,this.setPage(Ie)}return this},z.deletePage=function(){return ca.apply(this,arguments),this},z.__private__.text=z.text=function(ne,Ie,lt,mt,vt){var Tt,pi,ri,rr,qi,ki,jr,nr,Gn,Br=(mt=mt||{}).scope||this;if(typeof ne=="number"&&typeof Ie=="number"&&(typeof lt=="string"||Array.isArray(lt))){var Lr=lt;lt=Ie,Ie=ne,ne=Lr}if(arguments[3]instanceof be?(Ue("The transform parameter of text() with a Matrix value"),Gn=vt):(ri=arguments[4],rr=arguments[5],Jn(jr=arguments[3])==="object"&&jr!==null||(typeof ri=="string"&&(rr=ri,ri=null),typeof jr=="string"&&(rr=jr,jr=null),typeof jr=="number"&&(ri=jr,jr=null),mt={flags:jr,angle:ri,align:rr})),isNaN(Ie)||isNaN(lt)||ne==null)throw new Error("Invalid arguments passed to jsPDF.text");if(ne.length===0)return Br;var Un="",$s=!1,to=typeof mt.lineHeightFactor=="number"?mt.lineHeightFactor:hs,Lo=Br.internal.scaleFactor;function Ta(Ir){return Ir=Ir.split("	").join(Array(mt.TabLen||9).join(" ")),An(Ir,jr)}function fa(Ir){for(var Zr,an=Ir.concat(),jn=[],ya=an.length;ya--;)typeof(Zr=an.shift())=="string"?jn.push(Zr):Array.isArray(Ir)&&(Zr.length===1||Zr[1]===void 0&&Zr[2]===void 0)?jn.push(Zr[0]):jn.push([Zr[0],Zr[1],Zr[2]]);return jn}function Gl(Ir,Zr){var an;if(typeof Ir=="string")an=Zr(Ir)[0];else if(Array.isArray(Ir)){for(var jn,ya,Fa=Ir.concat(),go=[],Zo=Fa.length;Zo--;)typeof(jn=Fa.shift())=="string"?go.push(Zr(jn)[0]):Array.isArray(jn)&&typeof jn[0]=="string"&&(ya=Zr(jn[0],jn[1],jn[2]),go.push([ya[0],ya[1],ya[2]]));an=go}return an}var hl=!1,jl=!0;if(typeof ne=="string")hl=!0;else if(Array.isArray(ne)){var pc=ne.concat();pi=[];for(var pa,Fs=pc.length;Fs--;)(typeof(pa=pc.shift())!="string"||Array.isArray(pa)&&typeof pa[0]!="string")&&(jl=!1);hl=jl}if(hl===!1)throw new Error('Type of text must be string or Array. "'+ne+'" is not recognized.');typeof ne=="string"&&(ne=ne.match(/[\r?\n]/)?ne.split(/\r\n|\r|\n/g):[ne]);var Al=ut/Br.internal.scaleFactor,ql=Al*(to-1);switch(mt.baseline){case"bottom":lt-=ql;break;case"top":lt+=Al-ql;break;case"hanging":lt+=Al-2*ql;break;case"middle":lt+=Al/2-ql}if((ki=mt.maxWidth||0)>0&&(typeof ne=="string"?ne=Br.splitTextToSize(ne,ki):Object.prototype.toString.call(ne)==="[object Array]"&&(ne=ne.reduce(function(Ir,Zr){return Ir.concat(Br.splitTextToSize(Zr,ki))},[]))),Tt={text:ne,x:Ie,y:lt,options:mt,mutex:{pdfEscape:An,activeFontKey:Ji,fonts:Bi,activeFontSize:ut}},ee.publish("preProcessText",Tt),ne=Tt.text,ri=(mt=Tt.options).angle,!(Gn instanceof be)&&ri&&typeof ri=="number"){ri*=Math.PI/180,mt.rotationDirection===0&&(ri=-ri),_e===de.ADVANCED&&(ri=-ri);var Ia=Math.cos(ri),La=Math.sin(ri);Gn=new be(Ia,La,-La,Ia,0,0)}else ri&&ri instanceof be&&(Gn=ri);_e!==de.ADVANCED||Gn||(Gn=Oe),(qi=mt.charSpace||Dc)!==void 0&&(Un+=qe(Me(qi))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(nr=mt.horizontalScale)!==void 0&&(Un+=qe(100*nr)+` Tz
`),mt.lang;var Ds=-1,ku=mt.renderingMode!==void 0?mt.renderingMode:mt.stroke,Sn=Br.internal.getCurrentPageInfo().pageContext;switch(ku){case 0:case!1:case"fill":Ds=0;break;case 1:case!0:case"stroke":Ds=1;break;case 2:case"fillThenStroke":Ds=2;break;case 3:case"invisible":Ds=3;break;case 4:case"fillAndAddForClipping":Ds=4;break;case 5:case"strokeAndAddPathForClipping":Ds=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Ds=6;break;case 7:case"addToPathForClipping":Ds=7}var on=Sn.usedRenderingMode!==void 0?Sn.usedRenderingMode:-1;Ds!==-1?Un+=Ds+` Tr
`:on!==-1&&(Un+=`0 Tr
`),Ds!==-1&&(Sn.usedRenderingMode=Ds),rr=mt.align||"left";var fn,es=ut*to,dl=Br.internal.pageSize.getWidth(),fl=Bi[Ji];qi=mt.charSpace||Dc,ki=mt.maxWidth||0,jr=Object.assign({autoencode:!0,noBOM:!0},mt.flags);var fo=[];if(Object.prototype.toString.call(ne)==="[object Array]"){var ss;pi=fa(ne),rr!=="left"&&(fn=pi.map(function(Ir){return Br.getStringUnitWidth(Ir,{font:fl,charSpace:qi,fontSize:ut,doKerning:!1})*ut/Lo}));var os,Mo=0;if(rr==="right"){Ie-=fn[0],ne=[],Fs=pi.length;for(var Po=0;Po<Fs;Po++)Po===0?(os=Io(Ie),ss=Ko(lt)):(os=Me(Mo-fn[Po]),ss=-es),ne.push([pi[Po],os,ss]),Mo=fn[Po]}else if(rr==="center"){Ie-=fn[0]/2,ne=[],Fs=pi.length;for(var ga=0;ga<Fs;ga++)ga===0?(os=Io(Ie),ss=Ko(lt)):(os=Me((Mo-fn[ga])/2),ss=-es),ne.push([pi[ga],os,ss]),Mo=fn[ga]}else if(rr==="left"){ne=[],Fs=pi.length;for(var pl=0;pl<Fs;pl++)ne.push(pi[pl])}else{if(rr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');ne=[],Fs=pi.length,ki=ki!==0?ki:dl;for(var io=0;io<Fs;io++)ss=io===0?Ko(lt):-es,os=io===0?Io(Ie):0,io<Fs-1?fo.push(qe(Me((ki-fn[io])/(pi[io].split(" ").length-1)))):fo.push(0),ne.push([pi[io],os,ss])}}var ro=typeof mt.R2L=="boolean"?mt.R2L:di;ro===!0&&(ne=Gl(ne,function(Ir,Zr,an){return[Ir.split("").reverse().join(""),Zr,an]})),Tt={text:ne,x:Ie,y:lt,options:mt,mutex:{pdfEscape:An,activeFontKey:Ji,fonts:Bi,activeFontSize:ut}},ee.publish("postProcessText",Tt),ne=Tt.text,$s=Tt.mutex.isHex||!1;var po=Bi[Ji].encoding;po!=="WinAnsiEncoding"&&po!=="StandardEncoding"||(ne=Gl(ne,function(Ir,Zr,an){return[Ta(Ir),Zr,an]})),pi=fa(ne),ne=[];for(var ys,no,Ma,ma=0,Pa=1,Tn=Array.isArray(pi[0])?Pa:ma,Fo="",As=function(Ir,Zr,an){var jn="";return an instanceof be?(an=typeof mt.angle=="number"?Pe(an,new be(1,0,0,1,Ir,Zr)):Pe(new be(1,0,0,1,Ir,Zr),an),_e===de.ADVANCED&&(an=Pe(new be(1,0,0,-1,0,0),an)),jn=an.join(" ")+` Tm
`):jn=qe(Ir)+" "+qe(Zr)+` Td
`,jn},_s=0;_s<pi.length;_s++){switch(Fo="",Tn){case Pa:Ma=($s?"<":"(")+pi[_s][0]+($s?">":")"),ys=parseFloat(pi[_s][1]),no=parseFloat(pi[_s][2]);break;case ma:Ma=($s?"<":"(")+pi[_s]+($s?">":")"),ys=Io(Ie),no=Ko(lt)}fo!==void 0&&fo[_s]!==void 0&&(Fo=fo[_s]+` Tw
`),_s===0?ne.push(Fo+As(ys,no,Gn)+Ma):Tn===ma?ne.push(Fo+Ma):Tn===Pa&&ne.push(Fo+As(ys,no,Gn)+Ma)}ne=Tn===ma?ne.join(` Tj
T* `):ne.join(` Tj
`),ne+=` Tj
`;var ds=`BT
/`;return ds+=Ji+" "+ut+` Tf
`,ds+=qe(ut*to)+` TL
`,ds+=Xo+`
`,ds+=Un,ds+=ne,at(ds+="ET"),k[Ji]=!0,Br};var Ul=z.__private__.clip=z.clip=function(ne){return at(ne==="evenodd"?"W*":"W"),this};z.clipEvenOdd=function(){return Ul("evenodd")},z.__private__.discardPath=z.discardPath=function(){return at("n"),this};var Yn=z.__private__.isValidStyle=function(ne){var Ie=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(ne)!==-1&&(Ie=!0),Ie};z.__private__.setDefaultPathOperation=z.setDefaultPathOperation=function(ne){return Yn(ne)&&(b=ne),this};var To=z.__private__.getStyle=z.getStyle=function(ne){var Ie=b;switch(ne){case"D":case"S":Ie="S";break;case"F":Ie="f";break;case"FD":case"DF":Ie="B";break;case"f":case"f*":case"B":case"B*":Ie=ne}return Ie},Wa=z.close=function(){return at("h"),this};z.stroke=function(){return at("S"),this},z.fill=function(ne){return ms("f",ne),this},z.fillEvenOdd=function(ne){return ms("f*",ne),this},z.fillStroke=function(ne){return ms("B",ne),this},z.fillStrokeEvenOdd=function(ne){return ms("B*",ne),this};var ms=function(ne,Ie){Jn(Ie)==="object"?Sa(Ie,ne):at(ne)},ua=function(ne){ne===null||_e===de.ADVANCED&&ne===void 0||(ne=To(ne),at(ne))};function Xa(ne,Ie,lt,mt,vt){var Tt=new wg(Ie||this.boundingBox,lt||this.xStep,mt||this.yStep,this.gState,vt||this.matrix);Tt.stream=this.stream;var pi=ne+"$$"+this.cloneIndex+++"$$";return Ge(pi,Tt),Tt}var Sa=function(ne,Ie){var lt=Jt[ne.key],mt=vi[lt];if(mt instanceof If)at("q"),at(Fc(Ie)),mt.gState&&z.setGState(mt.gState),at(ne.matrix.toString()+" cm"),at("/"+lt+" sh"),at("Q");else if(mt instanceof wg){var vt=new be(1,0,0,-1,0,eo());ne.matrix&&(vt=vt.multiply(ne.matrix||Oe),lt=Xa.call(mt,ne.key,ne.boundingBox,ne.xStep,ne.yStep,vt).id),at("q"),at("/Pattern cs"),at("/"+lt+" scn"),mt.gState&&z.setGState(mt.gState),at(Ie),at("Q")}},Fc=function(ne){switch(ne){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},Za=z.moveTo=function(ne,Ie){return at(qe(Me(ne))+" "+qe(We(Ie))+" m"),this},ho=z.lineTo=function(ne,Ie){return at(qe(Me(ne))+" "+qe(We(Ie))+" l"),this},Pr=z.curveTo=function(ne,Ie,lt,mt,vt,Tt){return at([qe(Me(ne)),qe(We(Ie)),qe(Me(lt)),qe(We(mt)),qe(Me(vt)),qe(We(Tt)),"c"].join(" ")),this};z.__private__.line=z.line=function(ne,Ie,lt,mt,vt){if(isNaN(ne)||isNaN(Ie)||isNaN(lt)||isNaN(mt)||!Yn(vt))throw new Error("Invalid arguments passed to jsPDF.line");return _e===de.COMPAT?this.lines([[lt-ne,mt-Ie]],ne,Ie,[1,1],vt||"S"):this.lines([[lt-ne,mt-Ie]],ne,Ie,[1,1]).stroke()},z.__private__.lines=z.lines=function(ne,Ie,lt,mt,vt,Tt){var pi,ri,rr,qi,ki,jr,nr,Gn,Br,Lr,Un,$s;if(typeof ne=="number"&&($s=lt,lt=Ie,Ie=ne,ne=$s),mt=mt||[1,1],Tt=Tt||!1,isNaN(Ie)||isNaN(lt)||!Array.isArray(ne)||!Array.isArray(mt)||!Yn(vt)||typeof Tt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Za(Ie,lt),pi=mt[0],ri=mt[1],qi=ne.length,Lr=Ie,Un=lt,rr=0;rr<qi;rr++)(ki=ne[rr]).length===2?(Lr=ki[0]*pi+Lr,Un=ki[1]*ri+Un,ho(Lr,Un)):(jr=ki[0]*pi+Lr,nr=ki[1]*ri+Un,Gn=ki[2]*pi+Lr,Br=ki[3]*ri+Un,Lr=ki[4]*pi+Lr,Un=ki[5]*ri+Un,Pr(jr,nr,Gn,Br,Lr,Un));return Tt&&Wa(),ua(vt),this},z.path=function(ne){for(var Ie=0;Ie<ne.length;Ie++){var lt=ne[Ie],mt=lt.c;switch(lt.op){case"m":Za(mt[0],mt[1]);break;case"l":ho(mt[0],mt[1]);break;case"c":Pr.apply(this,mt);break;case"h":Wa()}}return this},z.__private__.rect=z.rect=function(ne,Ie,lt,mt,vt){if(isNaN(ne)||isNaN(Ie)||isNaN(lt)||isNaN(mt)||!Yn(vt))throw new Error("Invalid arguments passed to jsPDF.rect");return _e===de.COMPAT&&(mt=-mt),at([qe(Me(ne)),qe(We(Ie)),qe(Me(lt)),qe(Me(mt)),"re"].join(" ")),ua(vt),this},z.__private__.triangle=z.triangle=function(ne,Ie,lt,mt,vt,Tt,pi){if(isNaN(ne)||isNaN(Ie)||isNaN(lt)||isNaN(mt)||isNaN(vt)||isNaN(Tt)||!Yn(pi))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[lt-ne,mt-Ie],[vt-lt,Tt-mt],[ne-vt,Ie-Tt]],ne,Ie,[1,1],pi,!0),this},z.__private__.roundedRect=z.roundedRect=function(ne,Ie,lt,mt,vt,Tt,pi){if(isNaN(ne)||isNaN(Ie)||isNaN(lt)||isNaN(mt)||isNaN(vt)||isNaN(Tt)||!Yn(pi))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var ri=4/3*(Math.SQRT2-1);return vt=Math.min(vt,.5*lt),Tt=Math.min(Tt,.5*mt),this.lines([[lt-2*vt,0],[vt*ri,0,vt,Tt-Tt*ri,vt,Tt],[0,mt-2*Tt],[0,Tt*ri,-vt*ri,Tt,-vt,Tt],[2*vt-lt,0],[-vt*ri,0,-vt,-Tt*ri,-vt,-Tt],[0,2*Tt-mt],[0,-Tt*ri,vt*ri,-Tt,vt,-Tt]],ne+vt,Ie,[1,1],pi,!0),this},z.__private__.ellipse=z.ellipse=function(ne,Ie,lt,mt,vt){if(isNaN(ne)||isNaN(Ie)||isNaN(lt)||isNaN(mt)||!Yn(vt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Tt=4/3*(Math.SQRT2-1)*lt,pi=4/3*(Math.SQRT2-1)*mt;return Za(ne+lt,Ie),Pr(ne+lt,Ie-pi,ne+Tt,Ie-mt,ne,Ie-mt),Pr(ne-Tt,Ie-mt,ne-lt,Ie-pi,ne-lt,Ie),Pr(ne-lt,Ie+pi,ne-Tt,Ie+mt,ne,Ie+mt),Pr(ne+Tt,Ie+mt,ne+lt,Ie+pi,ne+lt,Ie),ua(vt),this},z.__private__.circle=z.circle=function(ne,Ie,lt,mt){if(isNaN(ne)||isNaN(Ie)||isNaN(lt)||!Yn(mt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(ne,Ie,lt,lt,mt)},z.setFont=function(ne,Ie,lt){return lt&&(Ie=Ve(Ie,lt)),Ji=Ne(ne,Ie,{disableWarning:!1}),this};var ha=z.__private__.getFont=z.getFont=function(){return Bi[Ne.apply(z,arguments)]};z.__private__.getFontList=z.getFontList=function(){var ne,Ie,lt={};for(ne in Ii)if(Ii.hasOwnProperty(ne))for(Ie in lt[ne]=[],Ii[ne])Ii[ne].hasOwnProperty(Ie)&&lt[ne].push(Ie);return lt},z.addFont=function(ne,Ie,lt,mt,vt){var Tt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Tt.indexOf(arguments[3])!==-1?vt=arguments[3]:arguments[3]&&Tt.indexOf(arguments[3])==-1&&(lt=Ve(lt,mt)),vt=vt||"Identity-H",Fr.call(this,ne,Ie,lt,vt)};var hs,dn=i.lineWidth||.200025,ns=z.__private__.getLineWidth=z.getLineWidth=function(){return dn},Vr=z.__private__.setLineWidth=z.setLineWidth=function(ne){return dn=ne,at(qe(Me(ne))+" w"),this};z.__private__.setLineDash=kr.API.setLineDash=kr.API.setLineDashPattern=function(ne,Ie){if(ne=ne||[],Ie=Ie||0,isNaN(Ie)||!Array.isArray(ne))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return ne=ne.map(function(lt){return qe(Me(lt))}).join(" "),Ie=qe(Me(Ie)),at("["+ne+"] "+Ie+" d"),this};var Ja=z.__private__.getLineHeight=z.getLineHeight=function(){return ut*hs};z.__private__.getLineHeight=z.getLineHeight=function(){return ut*hs};var cl=z.__private__.setLineHeightFactor=z.setLineHeightFactor=function(ne){return typeof(ne=ne||1.15)=="number"&&(hs=ne),this},Nl=z.__private__.getLineHeightFactor=z.getLineHeightFactor=function(){return hs};cl(i.lineHeight);var Io=z.__private__.getHorizontalCoordinate=function(ne){return Me(ne)},Ko=z.__private__.getVerticalCoordinate=function(ne){return _e===de.ADVANCED?ne:oe[Xe].mediaBox.topRightY-oe[Xe].mediaBox.bottomLeftY-Me(ne)},dc=z.__private__.getHorizontalCoordinateString=z.getHorizontalCoordinateString=function(ne){return qe(Io(ne))},Wo=z.__private__.getVerticalCoordinateString=z.getVerticalCoordinateString=function(ne){return qe(Ko(ne))},Ao=i.strokeColor||"0 G";z.__private__.getStrokeColor=z.getDrawColor=function(){return si(Ao)},z.__private__.setStrokeColor=z.setDrawColor=function(ne,Ie,lt,mt){return Ao=Ci({ch1:ne,ch2:Ie,ch3:lt,ch4:mt,pdfColorType:"draw",precision:2}),at(Ao),this};var fc=i.fillColor||"0 g";z.__private__.getFillColor=z.getFillColor=function(){return si(fc)},z.__private__.setFillColor=z.setFillColor=function(ne,Ie,lt,mt){return fc=Ci({ch1:ne,ch2:Ie,ch3:lt,ch4:mt,pdfColorType:"fill",precision:2}),at(fc),this};var Xo=i.textColor||"0 g",zl=z.__private__.getTextColor=z.getTextColor=function(){return si(Xo)};z.__private__.setTextColor=z.setTextColor=function(ne,Ie,lt,mt){return Xo=Ci({ch1:ne,ch2:Ie,ch3:lt,ch4:mt,pdfColorType:"text",precision:3}),this};var Dc=i.charSpace,vh=z.__private__.getCharSpace=z.getCharSpace=function(){return parseFloat(Dc||0)};z.__private__.setCharSpace=z.setCharSpace=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Dc=ne,this};var lu=0;z.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},z.__private__.setLineCap=z.setLineCap=function(ne){var Ie=z.CapJoinStyles[ne];if(Ie===void 0)throw new Error("Line cap style of '"+ne+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return lu=Ie,at(Ie+" J"),this};var cu=0;z.__private__.setLineJoin=z.setLineJoin=function(ne){var Ie=z.CapJoinStyles[ne];if(Ie===void 0)throw new Error("Line join style of '"+ne+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return cu=Ie,at(Ie+" j"),this},z.__private__.setLineMiterLimit=z.__private__.setMiterLimit=z.setLineMiterLimit=z.setMiterLimit=function(ne){if(ne=ne||0,isNaN(ne))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return at(qe(Me(ne))+" M"),this},z.GState=J1,z.setGState=function(ne){(ne=typeof ne=="string"?mr[Sr[ne]]:Ru(null,ne)).equals(ze)||(at("/"+ne.id+" gs"),ze=ne)};var Ru=function(ne,Ie){if(!ne||!Sr[ne]){var lt=!1;for(var mt in mr)if(mr.hasOwnProperty(mt)&&mr[mt].equals(Ie)){lt=!0;break}if(lt)Ie=mr[mt];else{var vt="GS"+(Object.keys(mr).length+1).toString(10);mr[vt]=Ie,Ie.id=vt}return ne&&(Sr[ne]=Ie.id),ee.publish("addGState",Ie),Ie}};z.addGState=function(ne,Ie){return Ru(ne,Ie),this},z.saveGraphicsState=function(){return at("q"),Gt.push({key:Ji,size:ut,color:Xo}),this},z.restoreGraphicsState=function(){at("Q");var ne=Gt.pop();return Ji=ne.key,ut=ne.size,Xo=ne.color,ze=null,this},z.setCurrentTransformationMatrix=function(ne){return at(ne.toString()+" cm"),this},z.comment=function(ne){return at("#"+ne),this};var Ql=function(ne,Ie){var lt=ne||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return lt},set:function(Tt){isNaN(Tt)||(lt=parseFloat(Tt))}});var mt=Ie||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return mt},set:function(Tt){isNaN(Tt)||(mt=parseFloat(Tt))}});var vt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return vt},set:function(Tt){vt=Tt.toString()}}),this},Ya=function(ne,Ie,lt,mt){Ql.call(this,ne,Ie),this.type="rect";var vt=lt||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return vt},set:function(pi){isNaN(pi)||(vt=parseFloat(pi))}});var Tt=mt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Tt},set:function(pi){isNaN(pi)||(Tt=parseFloat(pi))}}),this},el=function(){this.page=we,this.currentPage=Xe,this.pages=ii.slice(0),this.pagesContext=oe.slice(0),this.x=$t,this.y=Zi,this.matrix=Qt,this.width=ul(Xe),this.height=eo(Xe),this.outputDestination=mi,this.id="",this.objectNumber=-1};el.prototype.restore=function(){we=this.page,Xe=this.currentPage,oe=this.pagesContext,ii=this.pages,$t=this.x,Zi=this.y,Qt=this.matrix,Hl(Xe,this.width),da(Xe,this.height),mi=this.outputDestination};var Vl=function(ne,Ie,lt,mt,vt){Ce.push(new el),we=Xe=0,ii=[],$t=ne,Zi=Ie,Qt=vt,Hr([lt,mt])},tl=function(ne){if(ve[ne])Ce.pop().restore();else{var Ie=new el,lt="Xo"+(Object.keys(ge).length+1).toString(10);Ie.id=lt,ve[ne]=lt,ge[lt]=Ie,ee.publish("addFormObject",Ie),Ce.pop().restore()}};for(var Aa in z.beginFormObject=function(ne,Ie,lt,mt,vt){return Vl(ne,Ie,lt,mt,vt),this},z.endFormObject=function(ne){return tl(ne),this},z.doFormObject=function(ne,Ie){var lt=ge[ve[ne]];return at("q"),at(Ie.toString()+" cm"),at("/"+lt.id+" Do"),at("Q"),this},z.getFormObject=function(ne){var Ie=ge[ve[ne]];return{x:Ie.x,y:Ie.y,width:Ie.width,height:Ie.height,matrix:Ie.matrix}},z.save=function(ne,Ie){return ne=ne||"generated.pdf",(Ie=Ie||{}).returnPromise=Ie.returnPromise||!1,Ie.returnPromise===!1?(Tf(En(br()),ne),typeof Tf.unload=="function"&&Rr.setTimeout&&setTimeout(Tf.unload,911),this):new Promise(function(lt,mt){try{var vt=Tf(En(br()),ne);typeof Tf.unload=="function"&&Rr.setTimeout&&setTimeout(Tf.unload,911),lt(vt)}catch(Tt){mt(Tt.message)}})},kr.API)kr.API.hasOwnProperty(Aa)&&(Aa==="events"&&kr.API.events.length?function(ne,Ie){var lt,mt,vt;for(vt=Ie.length-1;vt!==-1;vt--)lt=Ie[vt][0],mt=Ie[vt][1],ne.subscribe.apply(ne,[lt].concat(typeof mt=="function"?[mt]:mt))}(ee,kr.API.events):z[Aa]=kr.API[Aa]);var ul=z.getPageWidth=function(ne){return(oe[ne=ne||Xe].mediaBox.topRightX-oe[ne].mediaBox.bottomLeftX)/ci},Hl=z.setPageWidth=function(ne,Ie){oe[ne].mediaBox.topRightX=Ie*ci+oe[ne].mediaBox.bottomLeftX},eo=z.getPageHeight=function(ne){return(oe[ne=ne||Xe].mediaBox.topRightY-oe[ne].mediaBox.bottomLeftY)/ci},da=z.setPageHeight=function(ne,Ie){oe[ne].mediaBox.topRightY=Ie*ci+oe[ne].mediaBox.bottomLeftY};return z.internal={pdfEscape:An,getStyle:To,getFont:ha,getFontSize:ni,getCharSpace:vh,getTextColor:zl,getLineHeight:Ja,getLineHeightFactor:Nl,getLineWidth:ns,write:xt,getHorizontalCoordinate:Io,getVerticalCoordinate:Ko,getCoordinateString:dc,getVerticalCoordinateString:Wo,collections:{},newObject:rt,newAdditionalObject:Yt,newObjectDeferred:yt,newObjectDeferredBegin:Et,getFilters:Hi,putStream:wi,events:ee,scaleFactor:ci,pageSize:{getWidth:function(){return ul(Xe)},setWidth:function(ne){Hl(Xe,ne)},getHeight:function(){return eo(Xe)},setHeight:function(ne){da(Xe,ne)}},encryptionOptions:T,encryption:wn,getEncryptor:au,output:On,getNumberOfPages:Ea,pages:ii,out:at,f2:it,f3:De,getPageInfo:$a,getPageInfoByObjId:Tr,getCurrentPageInfo:Ka,getPDFVersion:te,Point:Ql,Rectangle:Ya,Matrix:be,hasHotfix:rs},Object.defineProperty(z.internal.pageSize,"width",{get:function(){return ul(Xe)},set:function(ne){Hl(Xe,ne)},enumerable:!0,configurable:!0}),Object.defineProperty(z.internal.pageSize,"height",{get:function(){return eo(Xe)},set:function(ne){da(Xe,ne)},enumerable:!0,configurable:!0}),Hn.call(z,ei),Ji="F1",Gs(n,t),ee.publish("initialized"),z}bg.prototype.lsbFirstWord=function(i){return String.fromCharCode(i>>0&255,i>>8&255,i>>16&255,i>>24&255)},bg.prototype.toHexString=function(i){return i.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},bg.prototype.hexToBytes=function(i){for(var e=[],t=0;t<i.length;t+=2)e.push(String.fromCharCode(parseInt(i.substr(t,2),16)));return e.join("")},bg.prototype.processOwnerPassword=function(i,e){return EC(CC(e).substr(0,5),i)},bg.prototype.encryptor=function(i,e){var t=CC(this.encryptionKey+String.fromCharCode(255&i,i>>8&255,i>>16&255,255&e,e>>8&255)).substr(0,10);return function(r){return EC(t,r)}},J1.prototype.equals=function(i){var e,t="id,objectNumber,equals";if(!i||Jn(i)!==Jn(this))return!1;var r=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!i.hasOwnProperty(e)||this[e]!==i[e])return!1;r++}for(e in i)i.hasOwnProperty(e)&&t.indexOf(e)<0&&r--;return r===0},kr.API={events:[]},kr.version="2.5.1";var Bo=kr.API,SC=1,Lf=function(i){return i.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Bg=function(i){return i.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Xr=function(i){return i.toFixed(2)},yd=function(i){return i.toFixed(5)};Bo.__acroform__={};var Ic=function(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i},C4=function(i){return i*SC},$h=function(i){var e=new S4,t=cr.internal.getHeight(i)||0,r=cr.internal.getWidth(i)||0;return e.BBox=[0,0,Number(Xr(r)),Number(Xr(t))],e},jie=Bo.__acroform__.setBit=function(i,e){if(i=i||0,e=e||0,isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return i|=1<<e},qie=Bo.__acroform__.clearBit=function(i,e){if(i=i||0,e=e||0,isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return i&=~(1<<e)},$ie=Bo.__acroform__.getBit=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return i&1<<e?1:0},Qo=Bo.__acroform__.getBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return $ie(i,e-1)},Vo=Bo.__acroform__.setBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return jie(i,e-1)},Ho=Bo.__acroform__.clearBitForPdf=function(i,e){if(isNaN(i)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return qie(i,e-1)},Kie=Bo.__acroform__.calculateCoordinates=function(i,e){var t=e.internal.getHorizontalCoordinate,r=e.internal.getVerticalCoordinate,n=i[0],o=i[1],l=i[2],s=i[3],g={};return g.lowerLeft_X=t(n)||0,g.lowerLeft_Y=r(o+s)||0,g.upperRight_X=t(n+l)||0,g.upperRight_Y=r(o)||0,[Number(Xr(g.lowerLeft_X)),Number(Xr(g.lowerLeft_Y)),Number(Xr(g.upperRight_X)),Number(Xr(g.upperRight_Y))]},Wie=function(i){if(i.appearanceStreamContent)return i.appearanceStreamContent;if(i.V||i.DV){var e=[],t=i._V||i.DV,r=TC(i,t),n=i.scope.internal.getFont(i.fontName,i.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(i.scope.__private__.encodeColorString(i.color)),e.push("/"+n+" "+Xr(r.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(r.text),e.push("ET"),e.push("Q"),e.push("EMC");var o=$h(i);return o.scope=i.scope,o.stream=e.join(`
`),o}},TC=function(i,e){var t=i.fontSize===0?i.maxFontSize:i.fontSize,r={text:"",fontSize:""},n=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");n=i.multiline?n.map(function(De){return De.split(`
`)}):n.map(function(De){return[De]});var o=t,l=cr.internal.getHeight(i)||0;l=l<0?-l:l;var s=cr.internal.getWidth(i)||0;s=s<0?-s:s;var g=function(De,Me,Ze){if(De+1<n.length){var We=Me+" "+n[De+1][0];return Y1(We,i,Ze).width<=s-4}return!1};o++;e:for(;o>0;){e="",o--;var b,T,F=Y1("3",i,o).height,k=i.multiline?l-o:(l-F)/2,z=k+=2,J=0,te=0,ue=0;if(o<=0){e=`(...) Tj
`,e+="% Width of Text: "+Y1(e,i,o=12).width+", FieldWidth:"+s+`
`;break}for(var ce="",de=0,_e=0;_e<n.length;_e++)if(n.hasOwnProperty(_e)){var Ee=!1;if(n[_e].length!==1&&ue!==n[_e].length-1){if((F+2)*(de+2)+2>l)continue e;ce+=n[_e][ue],Ee=!0,te=_e,_e--}else{ce=(ce+=n[_e][ue]+" ").substr(ce.length-1)==" "?ce.substr(0,ce.length-1):ce;var He=parseInt(_e),Ve=g(He,ce,o),qe=_e>=n.length-1;if(Ve&&!qe){ce+=" ",ue=0;continue}if(Ve||qe){if(qe)te=He;else if(i.multiline&&(F+2)*(de+2)+2>l)continue e}else{if(!i.multiline||(F+2)*(de+2)+2>l)continue e;te=He}}for(var Ue="",ot=J;ot<=te;ot++){var it=n[ot];if(i.multiline){if(ot===te){Ue+=it[ue]+" ",ue=(ue+1)%it.length;continue}if(ot===J){Ue+=it[it.length-1]+" ";continue}}Ue+=it[0]+" "}switch(Ue=Ue.substr(Ue.length-1)==" "?Ue.substr(0,Ue.length-1):Ue,T=Y1(Ue,i,o).width,i.textAlign){case"right":b=s-T-2;break;case"center":b=(s-T)/2;break;case"left":default:b=2}e+=Xr(b)+" "+Xr(z)+` Td
`,e+="("+Lf(Ue)+`) Tj
`,e+=-Xr(b)+` 0 Td
`,z=-(o+2),T=0,J=Ee?te:te+1,de++,ce=""}break}return r.text=e,r.fontSize=o,r},Y1=function(i,e,t){var r=e.scope.internal.getFont(e.fontName,e.fontStyle),n=e.scope.getStringUnitWidth(i,{font:r,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:r,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:n}},Xie={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},Zie=function(i,e){var t={type:"reference",object:i};e.internal.getPageInfo(i.page).pageContext.annotations.find(function(r){return r.type===t.type&&r.object===t.object})===void 0&&e.internal.getPageInfo(i.page).pageContext.annotations.push(t)},Jie=function(i,e){for(var t in i)if(i.hasOwnProperty(t)){var r=t,n=i[t];e.internal.newObjectDeferredBegin(n.objId,!0),Jn(n)==="object"&&typeof n.putStream=="function"&&n.putStream(),delete i[r]}},Yie=function(i,e){if(e.scope=i,i.internal!==void 0&&(i.internal.acroformPlugin===void 0||i.internal.acroformPlugin.isInitialized===!1)){if(lh.FieldNum=0,i.internal.acroformPlugin=JSON.parse(JSON.stringify(Xie)),i.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");SC=i.internal.scaleFactor,i.internal.acroformPlugin.acroFormDictionaryRoot=new T4,i.internal.acroformPlugin.acroFormDictionaryRoot.scope=i,i.internal.acroformPlugin.acroFormDictionaryRoot._eventID=i.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(i)}),i.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var r=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in r)if(r.hasOwnProperty(n)){var o=r[n];o.objId=void 0,o.hasAnnotation&&Zie(o,t)}})(i)}),i.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(i)}),i.internal.events.subscribe("postPutPages",function(t){(function(r,n){var o=!r;for(var l in r||(n.internal.newObjectDeferredBegin(n.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),n.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),r=r||n.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(r.hasOwnProperty(l)){var s=r[l],g=[],b=s.Rect;if(s.Rect&&(s.Rect=Kie(s.Rect,n)),n.internal.newObjectDeferredBegin(s.objId,!0),s.DA=cr.createDefaultAppearanceStream(s),Jn(s)==="object"&&typeof s.getKeyValueListForStream=="function"&&(g=s.getKeyValueListForStream()),s.Rect=b,s.hasAppearanceStream&&!s.appearanceStreamContent){var T=Wie(s);g.push({key:"AP",value:"<</N "+T+">>"}),n.internal.acroformPlugin.xForms.push(T)}if(s.appearanceStreamContent){var F="";for(var k in s.appearanceStreamContent)if(s.appearanceStreamContent.hasOwnProperty(k)){var z=s.appearanceStreamContent[k];if(F+="/"+k+" ",F+="<<",Object.keys(z).length>=1||Array.isArray(z)){for(var l in z)if(z.hasOwnProperty(l)){var J=z[l];typeof J=="function"&&(J=J.call(n,s)),F+="/"+l+" "+J+" ",n.internal.acroformPlugin.xForms.indexOf(J)>=0||n.internal.acroformPlugin.xForms.push(J)}}else typeof(J=z)=="function"&&(J=J.call(n,s)),F+="/"+l+" "+J,n.internal.acroformPlugin.xForms.indexOf(J)>=0||n.internal.acroformPlugin.xForms.push(J);F+=">>"}g.push({key:"AP",value:`<<
`+F+">>"})}n.internal.putStream({additionalKeyValues:g,objectId:s.objId}),n.internal.out("endobj")}o&&Jie(n.internal.acroformPlugin.xForms,n)})(t,i)}),i.internal.acroformPlugin.isInitialized=!0}},E4=Bo.__acroform__.arrayToPdfArray=function(i,e,t){var r=function(l){return l};if(Array.isArray(i)){for(var n="[",o=0;o<i.length;o++)switch(o!==0&&(n+=" "),Jn(i[o])){case"boolean":case"number":case"object":n+=i[o].toString();break;case"string":i[o].substr(0,1)!=="/"?(e!==void 0&&t&&(r=t.internal.getEncryptor(e)),n+="("+Lf(r(i[o].toString()))+")"):n+=i[o].toString()}return n+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},IC=function(i,e,t){var r=function(n){return n};return e!==void 0&&t&&(r=t.internal.getEncryptor(e)),(i=i||"").toString(),i="("+Lf(r(i))+")"},Kh=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(i){this._objId=i}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Kh.prototype.toString=function(){return this.objId+" 0 R"},Kh.prototype.putStream=function(){var i=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:i,objectId:this.objId}),this.scope.internal.out("endobj")},Kh.prototype.getKeyValueListForStream=function(){var i=[],e=Object.getOwnPropertyNames(this).filter(function(o){return o!="content"&&o!="appearanceStreamContent"&&o!="scope"&&o!="objId"&&o.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var r=e[t],n=this[r];n&&(Array.isArray(n)?i.push({key:r,value:E4(n,this.objId,this.scope)}):n instanceof Kh?(n.scope=this.scope,i.push({key:r,value:n.objId+" 0 R"})):typeof n!="function"&&i.push({key:r,value:n}))}return i};var S4=function(){Kh.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var i,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){i=t.trim()},get:function(){return i||null}})};Ic(S4,Kh);var T4=function(){Kh.call(this);var i,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(i){var t=function(r){return r};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Lf(t(i))+")"}},set:function(t){i=t}})};Ic(T4,Kh);var lh=function i(){Kh.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(ce){if(isNaN(ce))throw new Error('Invalid value "'+ce+'" for attribute F supplied.');e=ce}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Qo(e,3)},set:function(ce){ce?this.F=Vo(e,3):this.F=Ho(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(ce){if(isNaN(ce))throw new Error('Invalid value "'+ce+'" for attribute Ff supplied.');t=ce}});var r=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(r.length!==0)return r},set:function(ce){r=ce!==void 0?ce:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[0])?0:r[0]},set:function(ce){r[0]=ce}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[1])?0:r[1]},set:function(ce){r[1]=ce}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[2])?0:r[2]},set:function(ce){r[2]=ce}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!r||isNaN(r[3])?0:r[3]},set:function(ce){r[3]=ce}});var n="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return n},set:function(ce){switch(ce){case"/Btn":case"/Tx":case"/Ch":case"/Sig":n=ce;break;default:throw new Error('Invalid value "'+ce+'" for attribute FT supplied.')}}});var o=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!o||o.length<1){if(this instanceof iv)return;o="FieldObject"+i.FieldNum++}var ce=function(de){return de};return this.scope&&(ce=this.scope.internal.getEncryptor(this.objId)),"("+Lf(ce(o))+")"},set:function(ce){o=ce.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return o},set:function(ce){o=ce}});var l="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return l},set:function(ce){l=ce}});var s="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return s},set:function(ce){s=ce}});var g=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return g},set:function(ce){g=ce}});var b=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return b===void 0?50/SC:b},set:function(ce){b=ce}});var T="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return T},set:function(ce){T=ce}});var F="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!F||this instanceof iv||this instanceof Mf))return IC(F,this.objId,this.scope)},set:function(ce){ce=ce.toString(),F=ce}});var k=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(k)return this instanceof Ha?k:IC(k,this.objId,this.scope)},set:function(ce){ce=ce.toString(),k=this instanceof Ha?ce:ce.substr(0,1)==="("?Bg(ce.substr(1,ce.length-2)):Bg(ce)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ha?Bg(k.substr(1,k.length-1)):k},set:function(ce){ce=ce.toString(),k=this instanceof Ha?"/"+ce:ce}});var z=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(z)return z},set:function(ce){this.V=ce}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(z)return this instanceof Ha?z:IC(z,this.objId,this.scope)},set:function(ce){ce=ce.toString(),z=this instanceof Ha?ce:ce.substr(0,1)==="("?Bg(ce.substr(1,ce.length-2)):Bg(ce)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Ha?Bg(z.substr(1,z.length-1)):z},set:function(ce){ce=ce.toString(),z=this instanceof Ha?"/"+ce:ce}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var J,te=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return te},set:function(ce){ce=!!ce,te=ce}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(J)return J},set:function(ce){J=ce}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,1)},set:function(ce){ce?this.Ff=Vo(this.Ff,1):this.Ff=Ho(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,2)},set:function(ce){ce?this.Ff=Vo(this.Ff,2):this.Ff=Ho(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,3)},set:function(ce){ce?this.Ff=Vo(this.Ff,3):this.Ff=Ho(this.Ff,3)}});var ue=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(ue!==null)return ue},set:function(ce){if([0,1,2].indexOf(ce)===-1)throw new Error('Invalid value "'+ce+'" for attribute Q supplied.');ue=ce}}),Object.defineProperty(this,"textAlign",{get:function(){var ce;switch(ue){case 0:default:ce="left";break;case 1:ce="center";break;case 2:ce="right"}return ce},configurable:!0,enumerable:!0,set:function(ce){switch(ce){case"right":case 2:ue=2;break;case"center":case 1:ue=1;break;case"left":case 0:default:ue=0}}})};Ic(lh,Kh);var Cg=function(){lh.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var i=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return i},set:function(t){i=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return E4(e,this.objId,this.scope)},set:function(t){var r,n;n=[],typeof(r=t)=="string"&&(n=function(o,l,s){s||(s=1);for(var g,b=[];g=l.exec(o);)b.push(g[s]);return b}(r,/\((.*?)\)/g)),e=n}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,r){for(r=r||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),r!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,18)},set:function(t){t?this.Ff=Vo(this.Ff,18):this.Ff=Ho(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=Vo(this.Ff,19):this.Ff=Ho(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,20)},set:function(t){t?(this.Ff=Vo(this.Ff,20),e.sort()):this.Ff=Ho(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,22)},set:function(t){t?this.Ff=Vo(this.Ff,22):this.Ff=Ho(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,23)},set:function(t){t?this.Ff=Vo(this.Ff,23):this.Ff=Ho(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,27)},set:function(t){t?this.Ff=Vo(this.Ff,27):this.Ff=Ho(this.Ff,27)}}),this.hasAppearanceStream=!1};Ic(Cg,lh);var Eg=function(){Cg.call(this),this.fontName="helvetica",this.combo=!1};Ic(Eg,Cg);var Sg=function(){Eg.call(this),this.combo=!0};Ic(Sg,Eg);var ev=function(){Sg.call(this),this.edit=!0};Ic(ev,Sg);var Ha=function(){lh.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,15)},set:function(t){t?this.Ff=Vo(this.Ff,15):this.Ff=Ho(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,16)},set:function(t){t?this.Ff=Vo(this.Ff,16):this.Ff=Ho(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,17)},set:function(t){t?this.Ff=Vo(this.Ff,17):this.Ff=Ho(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,26)},set:function(t){t?this.Ff=Vo(this.Ff,26):this.Ff=Ho(this.Ff,26)}});var i,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(o){return o};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var r,n=[];for(r in n.push("<<"),e)n.push("/"+r+" ("+Lf(t(e[r]))+")");return n.push(">>"),n.join(`
`)}},set:function(t){Jn(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return i},set:function(t){i=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return i.substr(1,i.length-1)},set:function(t){i="/"+t}})};Ic(Ha,lh);var tv=function(){Ha.call(this),this.pushButton=!0};Ic(tv,Ha);var Tg=function(){Ha.call(this),this.radio=!0,this.pushButton=!1;var i=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){i=e!==void 0?e:[]}})};Ic(Tg,Ha);var iv=function(){var i,e;lh.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return i},set:function(n){i=n}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(n){e=n}});var t,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var n=function(s){return s};this.scope&&(n=this.scope.internal.getEncryptor(this.objId));var o,l=[];for(o in l.push("<<"),r)l.push("/"+o+" ("+Lf(n(r[o]))+")");return l.push(">>"),l.join(`
`)},set:function(n){Jn(n)==="object"&&(r=n)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(n){typeof n=="string"&&(r.CA=n)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(n){t=n}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(n){t="/"+n}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=cr.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Ic(iv,lh),Tg.prototype.setAppearance=function(i){if(!("createAppearanceStream"in i)||!("getCA"in i))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=i.createAppearanceStream(t.optionName),t.caption=i.getCA()}},Tg.prototype.createOption=function(i){var e=new iv;return e.Parent=this,e.optionName=i,this.Kids.push(e),ere.call(this.scope,e),e};var rv=function(){Ha.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=cr.CheckBox.createAppearanceStream()};Ic(rv,Ha);var Mf=function(){lh.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,13)},set:function(e){e?this.Ff=Vo(this.Ff,13):this.Ff=Ho(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,21)},set:function(e){e?this.Ff=Vo(this.Ff,21):this.Ff=Ho(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,23)},set:function(e){e?this.Ff=Vo(this.Ff,23):this.Ff=Ho(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,24)},set:function(e){e?this.Ff=Vo(this.Ff,24):this.Ff=Ho(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,25)},set:function(e){e?this.Ff=Vo(this.Ff,25):this.Ff=Ho(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,26)},set:function(e){e?this.Ff=Vo(this.Ff,26):this.Ff=Ho(this.Ff,26)}});var i=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return i},set:function(e){Number.isInteger(e)&&(i=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Ic(Mf,lh);var nv=function(){Mf.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Qo(this.Ff,14)},set:function(i){i?this.Ff=Vo(this.Ff,14):this.Ff=Ho(this.Ff,14)}}),this.password=!0};Ic(nv,Mf);var cr={CheckBox:{createAppearanceStream:function(){return{N:{On:cr.CheckBox.YesNormal},D:{On:cr.CheckBox.YesPushDown,Off:cr.CheckBox.OffPushDown}}},YesPushDown:function(i){var e=$h(i);e.scope=i.scope;var t=[],r=i.scope.internal.getFont(i.fontName,i.fontStyle).id,n=i.scope.__private__.encodeColorString(i.color),o=TC(i,i.caption);return t.push("0.749023 g"),t.push("0 0 "+Xr(cr.internal.getWidth(i))+" "+Xr(cr.internal.getHeight(i))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+r+" "+Xr(o.fontSize)+" Tf "+n),t.push("BT"),t.push(o.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(i){var e=$h(i);e.scope=i.scope;var t=i.scope.internal.getFont(i.fontName,i.fontStyle).id,r=i.scope.__private__.encodeColorString(i.color),n=[],o=cr.internal.getHeight(i),l=cr.internal.getWidth(i),s=TC(i,i.caption);return n.push("1 g"),n.push("0 0 "+Xr(l)+" "+Xr(o)+" re"),n.push("f"),n.push("q"),n.push("0 0 1 rg"),n.push("0 0 "+Xr(l-1)+" "+Xr(o-1)+" re"),n.push("W"),n.push("n"),n.push("0 g"),n.push("BT"),n.push("/"+t+" "+Xr(s.fontSize)+" Tf "+r),n.push(s.text),n.push("ET"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(i){var e=$h(i);e.scope=i.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Xr(cr.internal.getWidth(i))+" "+Xr(cr.internal.getHeight(i))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(i){var e={D:{Off:cr.RadioButton.Circle.OffPushDown},N:{}};return e.N[i]=cr.RadioButton.Circle.YesNormal,e.D[i]=cr.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(i){var e=$h(i);e.scope=i.scope;var t=[],r=cr.internal.getWidth(i)<=cr.internal.getHeight(i)?cr.internal.getWidth(i)/4:cr.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=cr.internal.Bezier_C,o=Number((r*n).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+yd(cr.internal.getWidth(i)/2)+" "+yd(cr.internal.getHeight(i)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+o+" "+o+" "+r+" 0 "+r+" c"),t.push("-"+o+" "+r+" -"+r+" "+o+" -"+r+" 0 c"),t.push("-"+r+" -"+o+" -"+o+" -"+r+" 0 -"+r+" c"),t.push(o+" -"+r+" "+r+" -"+o+" "+r+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(i){var e=$h(i);e.scope=i.scope;var t=[],r=cr.internal.getWidth(i)<=cr.internal.getHeight(i)?cr.internal.getWidth(i)/4:cr.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=Number((2*r).toFixed(5)),o=Number((n*cr.internal.Bezier_C).toFixed(5)),l=Number((r*cr.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+yd(cr.internal.getWidth(i)/2)+" "+yd(cr.internal.getHeight(i)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),t.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),t.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),t.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+yd(cr.internal.getWidth(i)/2)+" "+yd(cr.internal.getHeight(i)/2)+" cm"),t.push(r+" 0 m"),t.push(r+" "+l+" "+l+" "+r+" 0 "+r+" c"),t.push("-"+l+" "+r+" -"+r+" "+l+" -"+r+" 0 c"),t.push("-"+r+" -"+l+" -"+l+" -"+r+" 0 -"+r+" c"),t.push(l+" -"+r+" "+r+" -"+l+" "+r+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(i){var e=$h(i);e.scope=i.scope;var t=[],r=cr.internal.getWidth(i)<=cr.internal.getHeight(i)?cr.internal.getWidth(i)/4:cr.internal.getHeight(i)/4;r=Number((.9*r).toFixed(5));var n=Number((2*r).toFixed(5)),o=Number((n*cr.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+yd(cr.internal.getWidth(i)/2)+" "+yd(cr.internal.getHeight(i)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),t.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),t.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),t.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(i){var e={D:{Off:cr.RadioButton.Cross.OffPushDown},N:{}};return e.N[i]=cr.RadioButton.Cross.YesNormal,e.D[i]=cr.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(i){var e=$h(i);e.scope=i.scope;var t=[],r=cr.internal.calculateCross(i);return t.push("q"),t.push("1 1 "+Xr(cr.internal.getWidth(i)-2)+" "+Xr(cr.internal.getHeight(i)-2)+" re"),t.push("W"),t.push("n"),t.push(Xr(r.x1.x)+" "+Xr(r.x1.y)+" m"),t.push(Xr(r.x2.x)+" "+Xr(r.x2.y)+" l"),t.push(Xr(r.x4.x)+" "+Xr(r.x4.y)+" m"),t.push(Xr(r.x3.x)+" "+Xr(r.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(i){var e=$h(i);e.scope=i.scope;var t=cr.internal.calculateCross(i),r=[];return r.push("0.749023 g"),r.push("0 0 "+Xr(cr.internal.getWidth(i))+" "+Xr(cr.internal.getHeight(i))+" re"),r.push("f"),r.push("q"),r.push("1 1 "+Xr(cr.internal.getWidth(i)-2)+" "+Xr(cr.internal.getHeight(i)-2)+" re"),r.push("W"),r.push("n"),r.push(Xr(t.x1.x)+" "+Xr(t.x1.y)+" m"),r.push(Xr(t.x2.x)+" "+Xr(t.x2.y)+" l"),r.push(Xr(t.x4.x)+" "+Xr(t.x4.y)+" m"),r.push(Xr(t.x3.x)+" "+Xr(t.x3.y)+" l"),r.push("s"),r.push("Q"),e.stream=r.join(`
`),e},OffPushDown:function(i){var e=$h(i);e.scope=i.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Xr(cr.internal.getWidth(i))+" "+Xr(cr.internal.getHeight(i))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(i){var e=i.scope.internal.getFont(i.fontName,i.fontStyle).id,t=i.scope.__private__.encodeColorString(i.color);return"/"+e+" "+i.fontSize+" Tf "+t}};cr.internal={Bezier_C:.551915024494,calculateCross:function(i){var e=cr.internal.getWidth(i),t=cr.internal.getHeight(i),r=Math.min(e,t);return{x1:{x:(e-r)/2,y:(t-r)/2+r},x2:{x:(e-r)/2+r,y:(t-r)/2},x3:{x:(e-r)/2,y:(t-r)/2},x4:{x:(e-r)/2+r,y:(t-r)/2+r}}}},cr.internal.getWidth=function(i){var e=0;return Jn(i)==="object"&&(e=C4(i.Rect[2])),e},cr.internal.getHeight=function(i){var e=0;return Jn(i)==="object"&&(e=C4(i.Rect[3])),e};var ere=Bo.addField=function(i){if(Yie(this,i),!(i instanceof lh))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=i).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),i.page=i.scope.internal.getCurrentPageInfo().pageNumber,this};Bo.AcroFormChoiceField=Cg,Bo.AcroFormListBox=Eg,Bo.AcroFormComboBox=Sg,Bo.AcroFormEditBox=ev,Bo.AcroFormButton=Ha,Bo.AcroFormPushButton=tv,Bo.AcroFormRadioButton=Tg,Bo.AcroFormCheckBox=rv,Bo.AcroFormTextField=Mf,Bo.AcroFormPasswordField=nv,Bo.AcroFormAppearance=cr,Bo.AcroForm={ChoiceField:Cg,ListBox:Eg,ComboBox:Sg,EditBox:ev,Button:Ha,PushButton:tv,RadioButton:Tg,CheckBox:rv,TextField:Mf,PasswordField:nv,Appearance:cr},kr.AcroForm={ChoiceField:Cg,ListBox:Eg,ComboBox:Sg,EditBox:ev,Button:Ha,PushButton:tv,RadioButton:Tg,CheckBox:rv,TextField:Mf,PasswordField:nv,Appearance:cr};function I4(i){return i.reduce(function(e,t,r){return e[t]=r,e},{})}(function(i){i.__addimage__={};var e="UNKNOWN",t={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},r=i.__addimage__.getImageFileTypeByImageData=function(De,Me){var Ze,We,Bt,Ct,Lt,_t=e;if((Me=Me||e)==="RGBA"||De.data!==void 0&&De.data instanceof Uint8ClampedArray&&"height"in De&&"width"in De)return"RGBA";if(Ve(De))for(Lt in t)for(Bt=t[Lt],Ze=0;Ze<Bt.length;Ze+=1){for(Ct=!0,We=0;We<Bt[Ze].length;We+=1)if(Bt[Ze][We]!==void 0&&Bt[Ze][We]!==De[We]){Ct=!1;break}if(Ct===!0){_t=Lt;break}}else for(Lt in t)for(Bt=t[Lt],Ze=0;Ze<Bt.length;Ze+=1){for(Ct=!0,We=0;We<Bt[Ze].length;We+=1)if(Bt[Ze][We]!==void 0&&Bt[Ze][We]!==De.charCodeAt(We)){Ct=!1;break}if(Ct===!0){_t=Lt;break}}return _t===e&&Me!==e&&(_t=Me),_t},n=function De(Me){for(var Ze=this.internal.write,We=this.internal.putStream,Bt=(0,this.internal.getFilters)();Bt.indexOf("FlateEncode")!==-1;)Bt.splice(Bt.indexOf("FlateEncode"),1);Me.objectId=this.internal.newObject();var Ct=[];if(Ct.push({key:"Type",value:"/XObject"}),Ct.push({key:"Subtype",value:"/Image"}),Ct.push({key:"Width",value:Me.width}),Ct.push({key:"Height",value:Me.height}),Me.colorSpace===ue.INDEXED?Ct.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(Me.palette.length/3-1)+" "+("sMask"in Me&&Me.sMask!==void 0?Me.objectId+2:Me.objectId+1)+" 0 R]"}):(Ct.push({key:"ColorSpace",value:"/"+Me.colorSpace}),Me.colorSpace===ue.DEVICE_CMYK&&Ct.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Ct.push({key:"BitsPerComponent",value:Me.bitsPerComponent}),"decodeParameters"in Me&&Me.decodeParameters!==void 0&&Ct.push({key:"DecodeParms",value:"<<"+Me.decodeParameters+">>"}),"transparency"in Me&&Array.isArray(Me.transparency)){for(var Lt="",_t=0,Ft=Me.transparency.length;_t<Ft;_t++)Lt+=Me.transparency[_t]+" "+Me.transparency[_t]+" ";Ct.push({key:"Mask",value:"["+Lt+"]"})}Me.sMask!==void 0&&Ct.push({key:"SMask",value:Me.objectId+1+" 0 R"});var Mt=Me.filter!==void 0?["/"+Me.filter]:void 0;if(We({data:Me.data,additionalKeyValues:Ct,alreadyAppliedFilters:Mt,objectId:Me.objectId}),Ze("endobj"),"sMask"in Me&&Me.sMask!==void 0){var Wt="/Predictor "+Me.predictor+" /Colors 1 /BitsPerComponent "+Me.bitsPerComponent+" /Columns "+Me.width,Se={width:Me.width,height:Me.height,colorSpace:"DeviceGray",bitsPerComponent:Me.bitsPerComponent,decodeParameters:Wt,data:Me.sMask};"filter"in Me&&(Se.filter=Me.filter),De.call(this,Se)}if(Me.colorSpace===ue.INDEXED){var Xe=this.internal.newObject();We({data:Ue(new Uint8Array(Me.palette)),objectId:Xe}),Ze("endobj")}},o=function(){var De=this.internal.collections.addImage_images;for(var Me in De)n.call(this,De[Me])},l=function(){var De,Me=this.internal.collections.addImage_images,Ze=this.internal.write;for(var We in Me)Ze("/I"+(De=Me[We]).index,De.objectId,"0","R")},s=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",l))},g=function(){var De=this.internal.collections.addImage_images;return s.call(this),De},b=function(){return Object.keys(this.internal.collections.addImage_images).length},T=function(De){return typeof i["process"+De.toUpperCase()]=="function"},F=function(De){return Jn(De)==="object"&&De.nodeType===1},k=function(De,Me){if(De.nodeName==="IMG"&&De.hasAttribute("src")){var Ze=""+De.getAttribute("src");if(Ze.indexOf("data:image/")===0)return Ny(unescape(Ze).split("base64,").pop());var We=i.loadFile(Ze,!0);if(We!==void 0)return We}if(De.nodeName==="CANVAS"){if(De.width===0||De.height===0)throw new Error("Given canvas must have data. Canvas width: "+De.width+", height: "+De.height);var Bt;switch(Me){case"PNG":Bt="image/png";break;case"WEBP":Bt="image/webp";break;case"JPEG":case"JPG":default:Bt="image/jpeg"}return Ny(De.toDataURL(Bt,1).split("base64,").pop())}},z=function(De){var Me=this.internal.collections.addImage_images;if(Me){for(var Ze in Me)if(De===Me[Ze].alias)return Me[Ze]}},J=function(De,Me,Ze){return De||Me||(De=-96,Me=-96),De<0&&(De=-1*Ze.width*72/De/this.internal.scaleFactor),Me<0&&(Me=-1*Ze.height*72/Me/this.internal.scaleFactor),De===0&&(De=Me*Ze.width/Ze.height),Me===0&&(Me=De*Ze.height/Ze.width),[De,Me]},te=function(De,Me,Ze,We,Bt,Ct){var Lt=J.call(this,Ze,We,Bt),_t=this.internal.getCoordinateString,Ft=this.internal.getVerticalCoordinateString,Mt=g.call(this);if(Ze=Lt[0],We=Lt[1],Mt[Bt.index]=Bt,Ct){Ct*=Math.PI/180;var Wt=Math.cos(Ct),Se=Math.sin(Ct),Xe=function(At){return At.toFixed(4)},et=[Xe(Wt),Xe(Se),Xe(-1*Se),Xe(Wt),0,0,"cm"]}this.internal.write("q"),Ct?(this.internal.write([1,"0","0",1,_t(De),Ft(Me+We),"cm"].join(" ")),this.internal.write(et.join(" ")),this.internal.write([_t(Ze),"0","0",_t(We),"0","0","cm"].join(" "))):this.internal.write([_t(Ze),"0","0",_t(We),_t(De),Ft(Me+We),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Bt.index+" Do"),this.internal.write("Q")},ue=i.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};i.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var ce=i.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},de=i.__addimage__.sHashCode=function(De){var Me,Ze,We=0;if(typeof De=="string")for(Ze=De.length,Me=0;Me<Ze;Me++)We=(We<<5)-We+De.charCodeAt(Me),We|=0;else if(Ve(De))for(Ze=De.byteLength/2,Me=0;Me<Ze;Me++)We=(We<<5)-We+De[Me],We|=0;return We},_e=i.__addimage__.validateStringAsBase64=function(De){(De=De||"").toString().trim();var Me=!0;return De.length===0&&(Me=!1),De.length%4!=0&&(Me=!1),/^[A-Za-z0-9+/]+$/.test(De.substr(0,De.length-2))===!1&&(Me=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(De.substr(-2))===!1&&(Me=!1),Me},Ee=i.__addimage__.extractImageFromDataUrl=function(De){var Me=(De=De||"").split("base64,"),Ze=null;if(Me.length===2){var We=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(Me[0]);Array.isArray(We)&&(Ze={mimeType:We[1],charset:We[2],data:Me[1]})}return Ze},He=i.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};i.__addimage__.isArrayBuffer=function(De){return He()&&De instanceof ArrayBuffer};var Ve=i.__addimage__.isArrayBufferView=function(De){return He()&&typeof Uint32Array<"u"&&(De instanceof Int8Array||De instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&De instanceof Uint8ClampedArray||De instanceof Int16Array||De instanceof Uint16Array||De instanceof Int32Array||De instanceof Uint32Array||De instanceof Float32Array||De instanceof Float64Array)},qe=i.__addimage__.binaryStringToUint8Array=function(De){for(var Me=De.length,Ze=new Uint8Array(Me),We=0;We<Me;We++)Ze[We]=De.charCodeAt(We);return Ze},Ue=i.__addimage__.arrayBufferToBinaryString=function(De){for(var Me="",Ze=Ve(De)?De:new Uint8Array(De),We=0;We<Ze.length;We+=8192)Me+=String.fromCharCode.apply(null,Ze.subarray(We,We+8192));return Me};i.addImage=function(){var De,Me,Ze,We,Bt,Ct,Lt,_t,Ft;if(typeof arguments[1]=="number"?(Me=e,Ze=arguments[1],We=arguments[2],Bt=arguments[3],Ct=arguments[4],Lt=arguments[5],_t=arguments[6],Ft=arguments[7]):(Me=arguments[1],Ze=arguments[2],We=arguments[3],Bt=arguments[4],Ct=arguments[5],Lt=arguments[6],_t=arguments[7],Ft=arguments[8]),Jn(De=arguments[0])==="object"&&!F(De)&&"imageData"in De){var Mt=De;De=Mt.imageData,Me=Mt.format||Me||e,Ze=Mt.x||Ze||0,We=Mt.y||We||0,Bt=Mt.w||Mt.width||Bt,Ct=Mt.h||Mt.height||Ct,Lt=Mt.alias||Lt,_t=Mt.compression||_t,Ft=Mt.rotation||Mt.angle||Ft}var Wt=this.internal.getFilters();if(_t===void 0&&Wt.indexOf("FlateEncode")!==-1&&(_t="SLOW"),isNaN(Ze)||isNaN(We))throw new Error("Invalid coordinates passed to jsPDF.addImage");s.call(this);var Se=ot.call(this,De,Me,Lt,_t);return te.call(this,Ze,We,Bt,Ct,Se,Ft),this};var ot=function(De,Me,Ze,We){var Bt,Ct,Lt;if(typeof De=="string"&&r(De)===e){De=unescape(De);var _t=it(De,!1);(_t!==""||(_t=i.loadFile(De,!0))!==void 0)&&(De=_t)}if(F(De)&&(De=k(De,Me)),Me=r(De,Me),!T(Me))throw new Error("addImage does not support files of type '"+Me+"', please ensure that a plugin for '"+Me+"' support is added.");if(((Lt=Ze)==null||Lt.length===0)&&(Ze=function(Ft){return typeof Ft=="string"||Ve(Ft)?de(Ft):Ve(Ft.data)?de(Ft.data):null}(De)),(Bt=z.call(this,Ze))||(He()&&(De instanceof Uint8Array||Me==="RGBA"||(Ct=De,De=qe(De))),Bt=this["process"+Me.toUpperCase()](De,b.call(this),Ze,function(Ft){return Ft&&typeof Ft=="string"&&(Ft=Ft.toUpperCase()),Ft in i.image_compression?Ft:ce.NONE}(We),Ct)),!Bt)throw new Error("An unknown error occurred whilst processing the image.");return Bt},it=i.__addimage__.convertBase64ToBinaryString=function(De,Me){var Ze;Me=typeof Me!="boolean"||Me;var We,Bt="";if(typeof De=="string"){We=(Ze=Ee(De))!==null?Ze.data:De;try{Bt=Ny(We)}catch(Ct){if(Me)throw _e(We)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Ct.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Bt};i.getImageProperties=function(De){var Me,Ze,We="";if(F(De)&&(De=k(De)),typeof De=="string"&&r(De)===e&&((We=it(De,!1))===""&&(We=i.loadFile(De)||""),De=We),Ze=r(De),!T(Ze))throw new Error("addImage does not support files of type '"+Ze+"', please ensure that a plugin for '"+Ze+"' support is added.");if(!He()||De instanceof Uint8Array||(De=qe(De)),!(Me=this["process"+Ze.toUpperCase()](De)))throw new Error("An unknown error occurred whilst processing the image");return Me.fileType=Ze,Me}})(kr.API),function(i){var e=function(t){if(t!==void 0&&t!="")return!0};kr.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),i.events.push(["putPage",function(t){for(var r,n,o,l=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,g=this.internal.getPageInfoByObjId(t.objId),b=t.pageContext.annotations,T=!1,F=0;F<b.length&&!T;F++)switch((r=b[F]).type){case"link":(e(r.options.url)||e(r.options.pageNumber))&&(T=!0);break;case"reference":case"text":case"freetext":T=!0}if(T!=0){this.internal.write("/Annots [");for(var k=0;k<b.length;k++){r=b[k];var z=this.internal.pdfEscape,J=this.internal.getEncryptor(t.objId);switch(r.type){case"reference":this.internal.write(" "+r.object.objId+" 0 R ");break;case"text":var te=this.internal.newAdditionalObject(),ue=this.internal.newAdditionalObject(),ce=this.internal.getEncryptor(te.objId),de=r.title||"Note";o="<</Type /Annot /Subtype /Text "+(n="/Rect ["+l(r.bounds.x)+" "+s(r.bounds.y+r.bounds.h)+" "+l(r.bounds.x+r.bounds.w)+" "+s(r.bounds.y)+"] ")+"/Contents ("+z(ce(r.contents))+")",o+=" /Popup "+ue.objId+" 0 R",o+=" /P "+g.objId+" 0 R",o+=" /T ("+z(ce(de))+") >>",te.content=o;var _e=te.objId+" 0 R";o="<</Type /Annot /Subtype /Popup "+(n="/Rect ["+l(r.bounds.x+30)+" "+s(r.bounds.y+r.bounds.h)+" "+l(r.bounds.x+r.bounds.w+30)+" "+s(r.bounds.y)+"] ")+" /Parent "+_e,r.open&&(o+=" /Open true"),o+=" >>",ue.content=o,this.internal.write(te.objId,"0 R",ue.objId,"0 R");break;case"freetext":n="/Rect ["+l(r.bounds.x)+" "+s(r.bounds.y)+" "+l(r.bounds.x+r.bounds.w)+" "+s(r.bounds.y+r.bounds.h)+"] ";var Ee=r.color||"#000000";o="<</Type /Annot /Subtype /FreeText "+n+"/Contents ("+z(J(r.contents))+")",o+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+Ee+")",o+=" /Border [0 0 0]",o+=" >>",this.internal.write(o);break;case"link":if(r.options.name){var He=this.annotations._nameMap[r.options.name];r.options.pageNumber=He.page,r.options.top=He.y}else r.options.top||(r.options.top=0);if(n="/Rect ["+r.finalBounds.x+" "+r.finalBounds.y+" "+r.finalBounds.w+" "+r.finalBounds.h+"] ",o="",r.options.url)o="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /A <</S /URI /URI ("+z(J(r.options.url))+") >>";else if(r.options.pageNumber)switch(o="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(r.options.pageNumber).objId+" 0 R",r.options.magFactor=r.options.magFactor||"XYZ",r.options.magFactor){case"Fit":o+=" /Fit]";break;case"FitH":o+=" /FitH "+r.options.top+"]";break;case"FitV":r.options.left=r.options.left||0,o+=" /FitV "+r.options.left+"]";break;case"XYZ":default:var Ve=s(r.options.top);r.options.left=r.options.left||0,r.options.zoom===void 0&&(r.options.zoom=0),o+=" /XYZ "+r.options.left+" "+Ve+" "+r.options.zoom+"]"}o!=""&&(o+=" >>",this.internal.write(o))}}this.internal.write("]")}}]),i.createAnnotation=function(t){var r=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":r.pageContext.annotations.push(t)}},i.link=function(t,r,n,o,l){var s=this.internal.getCurrentPageInfo(),g=this.internal.getCoordinateString,b=this.internal.getVerticalCoordinateString;s.pageContext.annotations.push({finalBounds:{x:g(t),y:b(r),w:g(t+n),h:b(r+o)},options:l,type:"link"})},i.textWithLink=function(t,r,n,o){var l,s,g=this.getTextWidth(t),b=this.internal.getLineHeight()/this.internal.scaleFactor;if(o.maxWidth!==void 0){s=o.maxWidth;var T=this.splitTextToSize(t,s).length;l=Math.ceil(b*T)}else s=g,l=b;return this.text(t,r,n,o),n+=.2*b,o.align==="center"&&(r-=g/2),o.align==="right"&&(r-=g),this.link(r,n-b,s,l,o),g},i.getTextWidth=function(t){var r=this.internal.getFontSize();return this.getStringUnitWidth(t)*r/this.internal.scaleFactor}}(kr.API),function(i){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},r={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},n=[1570,1571,1573,1575];i.__arabicParser__={};var o=i.__arabicParser__.isInArabicSubstitutionA=function(te){return e[te.charCodeAt(0)]!==void 0},l=i.__arabicParser__.isArabicLetter=function(te){return typeof te=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(te)},s=i.__arabicParser__.isArabicEndLetter=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length<=2},g=i.__arabicParser__.isArabicAlfLetter=function(te){return l(te)&&n.indexOf(te.charCodeAt(0))>=0};i.__arabicParser__.arabicLetterHasIsolatedForm=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length>=1};var b=i.__arabicParser__.arabicLetterHasFinalForm=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length>=2};i.__arabicParser__.arabicLetterHasInitialForm=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length>=3};var T=i.__arabicParser__.arabicLetterHasMedialForm=function(te){return l(te)&&o(te)&&e[te.charCodeAt(0)].length==4},F=i.__arabicParser__.resolveLigatures=function(te){var ue=0,ce=t,de="",_e=0;for(ue=0;ue<te.length;ue+=1)ce[te.charCodeAt(ue)]!==void 0?(_e++,typeof(ce=ce[te.charCodeAt(ue)])=="number"&&(de+=String.fromCharCode(ce),ce=t,_e=0),ue===te.length-1&&(ce=t,de+=te.charAt(ue-(_e-1)),ue-=_e-1,_e=0)):(ce=t,de+=te.charAt(ue-_e),ue-=_e,_e=0);return de};i.__arabicParser__.isArabicDiacritic=function(te){return te!==void 0&&r[te.charCodeAt(0)]!==void 0};var k=i.__arabicParser__.getCorrectForm=function(te,ue,ce){return l(te)?o(te)===!1?-1:!b(te)||!l(ue)&&!l(ce)||!l(ce)&&s(ue)||s(te)&&!l(ue)||s(te)&&g(ue)||s(te)&&s(ue)?0:T(te)&&l(ue)&&!s(ue)&&l(ce)&&b(ce)?3:s(te)||!l(ce)?1:2:-1},z=function(te){var ue=0,ce=0,de=0,_e="",Ee="",He="",Ve=(te=te||"").split("\\s+"),qe=[];for(ue=0;ue<Ve.length;ue+=1){for(qe.push(""),ce=0;ce<Ve[ue].length;ce+=1)_e=Ve[ue][ce],Ee=Ve[ue][ce-1],He=Ve[ue][ce+1],l(_e)?(de=k(_e,Ee,He),qe[ue]+=de!==-1?String.fromCharCode(e[_e.charCodeAt(0)][de]):_e):qe[ue]+=_e;qe[ue]=F(qe[ue])}return qe.join(" ")},J=i.__arabicParser__.processArabic=i.processArabic=function(){var te,ue=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,ce=[];if(Array.isArray(ue)){var de=0;for(ce=[],de=0;de<ue.length;de+=1)Array.isArray(ue[de])?ce.push([z(ue[de][0]),ue[de][1],ue[de][2]]):ce.push([z(ue[de])]);te=ce}else te=z(ue);return typeof arguments[0]=="string"?te:(arguments[0].text=te,arguments[0])};i.events.push(["preProcessText",J])}(kr.API),kr.API.autoPrint=function(i){var e;switch((i=i||{}).variant=i.variant||"non-conform",i.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})}return this},function(i){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(s){t=s}});var r=150;Object.defineProperty(this,"width",{get:function(){return r},set:function(s){r=isNaN(s)||Number.isInteger(s)===!1||s<0?150:s,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=r+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(s){n=isNaN(s)||Number.isInteger(s)===!1||s<0?300:s,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var o=[];Object.defineProperty(this,"childNodes",{get:function(){return o},set:function(s){o=s}});var l={};Object.defineProperty(this,"style",{get:function(){return l},set:function(s){l=s}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,r){var n;if((t=t||"2d")!=="2d")return null;for(n in r)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=r[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},i.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(kr.API),function(i){var e={left:0,top:0,bottom:0,right:0},t=!1,r=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),n.call(this))},n=function(){this.internal.__cell__.lastCell=new o,this.internal.__cell__.pages=1},o=function(){var g=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return g},set:function(te){g=te}});var b=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return b},set:function(te){b=te}});var T=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return T},set:function(te){T=te}});var F=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return F},set:function(te){F=te}});var k=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return k},set:function(te){k=te}});var z=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return z},set:function(te){z=te}});var J=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return J},set:function(te){J=te}}),this};o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},o.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},i.setHeaderFunction=function(g){return r.call(this),this.internal.__cell__.headerFunction=typeof g=="function"?g:void 0,this},i.getTextDimensions=function(g,b){r.call(this);var T=(b=b||{}).fontSize||this.getFontSize(),F=b.font||this.getFont(),k=b.scaleFactor||this.internal.scaleFactor,z=0,J=0,te=0,ue=this;if(!Array.isArray(g)&&typeof g!="string"){if(typeof g!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");g=String(g)}var ce=b.maxWidth;ce>0?typeof g=="string"?g=this.splitTextToSize(g,ce):Object.prototype.toString.call(g)==="[object Array]"&&(g=g.reduce(function(_e,Ee){return _e.concat(ue.splitTextToSize(Ee,ce))},[])):g=Array.isArray(g)?g:[g];for(var de=0;de<g.length;de++)z<(te=this.getStringUnitWidth(g[de],{font:F})*T)&&(z=te);return z!==0&&(J=g.length),{w:z/=k,h:Math.max((J*T*this.getLineHeightFactor()-T*(this.getLineHeightFactor()-1))/k,0)}},i.cellAddPage=function(){r.call(this),this.addPage();var g=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new o(g.left,g.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var l=i.cell=function(){var g;g=arguments[0]instanceof o?arguments[0]:new o(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),r.call(this);var b=this.internal.__cell__.lastCell,T=this.internal.__cell__.padding,F=this.internal.__cell__.margins||e,k=this.internal.__cell__.tableHeaderRow,z=this.internal.__cell__.printHeaders;return b.lineNumber!==void 0&&(b.lineNumber===g.lineNumber?(g.x=(b.x||0)+(b.width||0),g.y=b.y||0):b.y+b.height+g.height+F.bottom>this.getPageHeight()?(this.cellAddPage(),g.y=F.top,z&&k&&(this.printHeaderRow(g.lineNumber,!0),g.y+=k[0].height)):g.y=b.y+b.height||g.y),g.text[0]!==void 0&&(this.rect(g.x,g.y,g.width,g.height,t===!0?"FD":void 0),g.align==="right"?this.text(g.text,g.x+g.width-T,g.y+T,{align:"right",baseline:"top"}):g.align==="center"?this.text(g.text,g.x+g.width/2,g.y+T,{align:"center",baseline:"top",maxWidth:g.width-T-T}):this.text(g.text,g.x+T,g.y+T,{align:"left",baseline:"top",maxWidth:g.width-T-T})),this.internal.__cell__.lastCell=g,this};i.table=function(g,b,T,F,k){if(r.call(this),!T)throw new Error("No data for PDF table.");var z,J,te,ue,ce=[],de=[],_e=[],Ee={},He={},Ve=[],qe=[],Ue=(k=k||{}).autoSize||!1,ot=k.printHeaders!==!1,it=k.css&&k.css["font-size"]!==void 0?16*k.css["font-size"]:k.fontSize||12,De=k.margins||Object.assign({width:this.getPageWidth()},e),Me=typeof k.padding=="number"?k.padding:3,Ze=k.headerBackgroundColor||"#c8c8c8",We=k.headerTextColor||"#000";if(n.call(this),this.internal.__cell__.printHeaders=ot,this.internal.__cell__.margins=De,this.internal.__cell__.table_font_size=it,this.internal.__cell__.padding=Me,this.internal.__cell__.headerBackgroundColor=Ze,this.internal.__cell__.headerTextColor=We,this.setFontSize(it),F==null)de=ce=Object.keys(T[0]),_e=ce.map(function(){return"left"});else if(Array.isArray(F)&&Jn(F[0])==="object")for(ce=F.map(function(Mt){return Mt.name}),de=F.map(function(Mt){return Mt.prompt||Mt.name||""}),_e=F.map(function(Mt){return Mt.align||"left"}),z=0;z<F.length;z+=1)He[F[z].name]=F[z].width*(19.049976/25.4);else Array.isArray(F)&&typeof F[0]=="string"&&(de=ce=F,_e=ce.map(function(){return"left"}));if(Ue||Array.isArray(F)&&typeof F[0]=="string")for(z=0;z<ce.length;z+=1){for(Ee[ue=ce[z]]=T.map(function(Mt){return Mt[ue]}),this.setFont(void 0,"bold"),Ve.push(this.getTextDimensions(de[z],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),J=Ee[ue],this.setFont(void 0,"normal"),te=0;te<J.length;te+=1)Ve.push(this.getTextDimensions(J[te],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);He[ue]=Math.max.apply(null,Ve)+Me+Me,Ve=[]}if(ot){var Bt={};for(z=0;z<ce.length;z+=1)Bt[ce[z]]={},Bt[ce[z]].text=de[z],Bt[ce[z]].align=_e[z];var Ct=s.call(this,Bt,He);qe=ce.map(function(Mt){return new o(g,b,He[Mt],Ct,Bt[Mt].text,void 0,Bt[Mt].align)}),this.setTableHeaderRow(qe),this.printHeaderRow(1,!1)}var Lt=F.reduce(function(Mt,Wt){return Mt[Wt.name]=Wt.align,Mt},{});for(z=0;z<T.length;z+=1){"rowStart"in k&&k.rowStart instanceof Function&&k.rowStart({row:z,data:T[z]},this);var _t=s.call(this,T[z],He);for(te=0;te<ce.length;te+=1){var Ft=T[z][ce[te]];"cellStart"in k&&k.cellStart instanceof Function&&k.cellStart({row:z,col:te,data:Ft},this),l.call(this,new o(g,b,He[ce[te]],_t,Ft,z+2,Lt[ce[te]]))}}return this.internal.__cell__.table_x=g,this.internal.__cell__.table_y=b,this};var s=function(g,b){var T=this.internal.__cell__.padding,F=this.internal.__cell__.table_font_size,k=this.internal.scaleFactor;return Object.keys(g).map(function(z){var J=g[z];return this.splitTextToSize(J.hasOwnProperty("text")?J.text:J,b[z]-T-T)},this).map(function(z){return this.getLineHeightFactor()*z.length*F/k+T+T},this).reduce(function(z,J){return Math.max(z,J)},0)};i.setTableHeaderRow=function(g){r.call(this),this.internal.__cell__.tableHeaderRow=g},i.printHeaderRow=function(g,b){if(r.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var T;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var F=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new o(F[0],F[1],F[2],F[3],void 0,-1)}this.setFont(void 0,"bold");for(var k=[],z=0;z<this.internal.__cell__.tableHeaderRow.length;z+=1){T=this.internal.__cell__.tableHeaderRow[z].clone(),b&&(T.y=this.internal.__cell__.margins.top||0,k.push(T)),T.lineNumber=g;var J=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),l.call(this,T),this.setTextColor(J)}k.length>0&&this.setTableHeaderRow(k),this.setFont(void 0,"normal"),t=!1}}(kr.API);var L4={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},M4=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],LC=I4(M4),P4=[100,200,300,400,500,600,700,800,900],tre=I4(P4);function MC(i){var e=i.family.replace(/"|'/g,"").toLowerCase(),t=function(o){return L4[o=o||"normal"]?o:"normal"}(i.style),r=function(o){if(!o)return 400;if(typeof o=="number")return o>=100&&o<=900&&o%100==0?o:400;if(/^\d00$/.test(o))return parseInt(o);switch(o){case"bold":return 700;case"normal":default:return 400}}(i.weight),n=function(o){return typeof LC[o=o||"normal"]=="number"?o:"normal"}(i.stretch);return{family:e,style:t,weight:r,stretch:n,src:i.src||[],ref:i.ref||{name:e,style:[n,t,r].join(" ")}}}function F4(i,e,t,r){var n;for(n=t;n>=0&&n<e.length;n+=r)if(i[e[n]])return i[e[n]];for(n=t;n>=0&&n<e.length;n-=r)if(i[e[n]])return i[e[n]]}var ire={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},D4={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function R4(i){return[i.stretch,i.style,i.weight,i.family].join(" ")}function rre(i,e,t){for(var r=(t=t||{}).defaultFontFamily||"times",n=Object.assign({},ire,t.genericFontFamilies||{}),o=null,l=null,s=0;s<e.length;++s)if(n[(o=MC(e[s])).family]&&(o.family=n[o.family]),i.hasOwnProperty(o.family)){l=i[o.family];break}if(!(l=l||i[r]))throw new Error("Could not find a font-family for the rule '"+R4(o)+"' and default family '"+r+"'.");if(l=function(g,b){if(b[g])return b[g];var T=LC[g],F=T<=LC.normal?-1:1,k=F4(b,M4,T,F);if(!k)throw new Error("Could not find a matching font-stretch value for "+g);return k}(o.stretch,l),l=function(g,b){if(b[g])return b[g];for(var T=L4[g],F=0;F<T.length;++F)if(b[T[F]])return b[T[F]];throw new Error("Could not find a matching font-style for "+g)}(o.style,l),!(l=function(g,b){if(b[g])return b[g];if(g===400&&b[500])return b[500];if(g===500&&b[400])return b[400];var T=tre[g],F=F4(b,P4,T,g<400?-1:1);if(!F)throw new Error("Could not find a matching font-weight for value "+g);return F}(o.weight,l)))throw new Error("Failed to resolve a font for the rule '"+R4(o)+"'.");return l}function k4(i){return i.trimLeft()}function nre(i,e){for(var t=0;t<i.length;){if(i.charAt(t)===e)return[i.substring(0,t),i.substring(t+1)];t+=1}return null}function sre(i){var e=i.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],i.substring(e[0].length)]}var sv,O4,U4,N4=["times"];(function(i){var e,t,r,n,o,l,s,g,b,T=function(Se){return Se=Se||{},this.isStrokeTransparent=Se.isStrokeTransparent||!1,this.strokeOpacity=Se.strokeOpacity||1,this.strokeStyle=Se.strokeStyle||"#000000",this.fillStyle=Se.fillStyle||"#000000",this.isFillTransparent=Se.isFillTransparent||!1,this.fillOpacity=Se.fillOpacity||1,this.font=Se.font||"10px sans-serif",this.textBaseline=Se.textBaseline||"alphabetic",this.textAlign=Se.textAlign||"left",this.lineWidth=Se.lineWidth||1,this.lineJoin=Se.lineJoin||"miter",this.lineCap=Se.lineCap||"butt",this.path=Se.path||[],this.transform=Se.transform!==void 0?Se.transform.clone():new g,this.globalCompositeOperation=Se.globalCompositeOperation||"normal",this.globalAlpha=Se.globalAlpha||1,this.clip_path=Se.clip_path||[],this.currentPoint=Se.currentPoint||new l,this.miterLimit=Se.miterLimit||10,this.lastPoint=Se.lastPoint||new l,this.lineDashOffset=Se.lineDashOffset||0,this.lineDash=Se.lineDash||[],this.margin=Se.margin||[0,0,0,0],this.prevPageLastElemOffset=Se.prevPageLastElemOffset||0,this.ignoreClearRect=typeof Se.ignoreClearRect!="boolean"||Se.ignoreClearRect,this};i.events.push(["initialized",function(){this.context2d=new F(this),e=this.internal.f2,t=this.internal.getCoordinateString,r=this.internal.getVerticalCoordinateString,n=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,l=this.internal.Point,s=this.internal.Rectangle,g=this.internal.Matrix,b=new T}]);var F=function(Se){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Xe=Se;Object.defineProperty(this,"pdf",{get:function(){return Xe}});var et=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return et},set:function(kt){et=!!kt}});var At=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return At},set:function(kt){At=!!kt}});var ft=0;Object.defineProperty(this,"posX",{get:function(){return ft},set:function(kt){isNaN(kt)||(ft=kt)}});var wt=0;Object.defineProperty(this,"posY",{get:function(){return wt},set:function(kt){isNaN(kt)||(wt=kt)}}),Object.defineProperty(this,"margin",{get:function(){return b.margin},set:function(kt){var at;typeof kt=="number"?at=[kt,kt,kt,kt]:((at=new Array(4))[0]=kt[0],at[1]=kt.length>=2?kt[1]:at[0],at[2]=kt.length>=3?kt[2]:at[0],at[3]=kt.length>=4?kt[3]:at[1]),b.margin=at}});var Pt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Pt},set:function(kt){Pt=kt}});var It=0;Object.defineProperty(this,"lastBreak",{get:function(){return It},set:function(kt){It=kt}});var Ht=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Ht},set:function(kt){Ht=kt}}),Object.defineProperty(this,"ctx",{get:function(){return b},set:function(kt){kt instanceof T&&(b=kt)}}),Object.defineProperty(this,"path",{get:function(){return b.path},set:function(kt){b.path=kt}});var ii=[];Object.defineProperty(this,"ctxStack",{get:function(){return ii},set:function(kt){ii=kt}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(kt){var at;at=k(kt),this.ctx.fillStyle=at.style,this.ctx.isFillTransparent=at.a===0,this.ctx.fillOpacity=at.a,this.pdf.setFillColor(at.r,at.g,at.b,{a:at.a}),this.pdf.setTextColor(at.r,at.g,at.b,{a:at.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(kt){var at=k(kt);this.ctx.strokeStyle=at.style,this.ctx.isStrokeTransparent=at.a===0,this.ctx.strokeOpacity=at.a,at.a===0?this.pdf.setDrawColor(255,255,255):(at.a,this.pdf.setDrawColor(at.r,at.g,at.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(kt){["butt","round","square"].indexOf(kt)!==-1&&(this.ctx.lineCap=kt,this.pdf.setLineCap(kt))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(kt){isNaN(kt)||(this.ctx.lineWidth=kt,this.pdf.setLineWidth(kt))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(kt){["bevel","round","miter"].indexOf(kt)!==-1&&(this.ctx.lineJoin=kt,this.pdf.setLineJoin(kt))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(kt){isNaN(kt)||(this.ctx.miterLimit=kt,this.pdf.setMiterLimit(kt))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(kt){this.ctx.textBaseline=kt}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(kt){["right","end","center","left","start"].indexOf(kt)!==-1&&(this.ctx.textAlign=kt)}});var gi=null;function mi(kt,at){if(gi===null){var xt=function(Ri){var ei=[];return Object.keys(Ri).forEach(function(ut){Ri[ut].forEach(function(jt){var ni=null;switch(jt){case"bold":ni={family:ut,weight:"bold"};break;case"italic":ni={family:ut,style:"italic"};break;case"bolditalic":ni={family:ut,weight:"bold",style:"italic"};break;case"":case"normal":ni={family:ut}}ni!==null&&(ni.ref={name:ut,style:jt},ei.push(ni))})}),ei}(kt.getFontList());gi=function(Ri){for(var ei={},ut=0;ut<Ri.length;++ut){var jt=MC(Ri[ut]),ni=jt.family,di=jt.stretch,li=jt.style,Ki=jt.weight;ei[ni]=ei[ni]||{},ei[ni][di]=ei[ni][di]||{},ei[ni][di][li]=ei[ni][di][li]||{},ei[ni][di][li][Ki]=jt}return ei}(xt.concat(at))}return gi}var Mi=null;Object.defineProperty(this,"fontFaces",{get:function(){return Mi},set:function(kt){gi=null,Mi=kt}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(kt){var at;if(this.ctx.font=kt,(at=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(kt))!==null){var xt=at[1],Ri=(at[2],at[3]),ei=at[4],ut=(at[5],at[6]),jt=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(ei)[2];ei=Math.floor(jt==="px"?parseFloat(ei)*this.pdf.internal.scaleFactor:jt==="em"?parseFloat(ei)*this.pdf.getFontSize():parseFloat(ei)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(ei);var ni=function(Nt){var Ji,ci,$t=[],Zi=Nt.trim();if(Zi==="")return N4;if(Zi in D4)return[D4[Zi]];for(;Zi!=="";){switch(ci=null,Ji=(Zi=k4(Zi)).charAt(0)){case'"':case"'":ci=nre(Zi.substring(1),Ji);break;default:ci=sre(Zi)}if(ci===null||($t.push(ci[0]),(Zi=k4(ci[1]))!==""&&Zi.charAt(0)!==","))return N4;Zi=Zi.replace(/^,/,"")}return $t}(ut);if(this.fontFaces){var di=rre(mi(this.pdf,this.fontFaces),ni.map(function(Nt){return{family:Nt,stretch:"normal",weight:Ri,style:xt}}));this.pdf.setFont(di.ref.name,di.ref.style)}else{var li="";(Ri==="bold"||parseInt(Ri,10)>=700||xt==="bold")&&(li="bold"),xt==="italic"&&(li+="italic"),li.length===0&&(li="normal");for(var Ki="",tr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Ar=0;Ar<ni.length;Ar++){if(this.pdf.internal.getFont(ni[Ar],li,{noFallback:!0,disableWarning:!0})!==void 0){Ki=ni[Ar];break}if(li==="bolditalic"&&this.pdf.internal.getFont(ni[Ar],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Ki=ni[Ar],li="bold";else if(this.pdf.internal.getFont(ni[Ar],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Ki=ni[Ar],li="normal";break}}if(Ki===""){for(var Er=0;Er<ni.length;Er++)if(tr[ni[Er]]){Ki=tr[ni[Er]];break}}Ki=Ki===""?"Times":Ki,this.pdf.setFont(Ki,li)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(kt){this.ctx.globalCompositeOperation=kt}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(kt){this.ctx.globalAlpha=kt}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(kt){this.ctx.lineDashOffset=kt,Wt.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(kt){this.ctx.lineDash=kt,Wt.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(kt){this.ctx.ignoreClearRect=!!kt}})};F.prototype.setLineDash=function(Se){this.lineDash=Se},F.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},F.prototype.fill=function(){Ee.call(this,"fill",!1)},F.prototype.stroke=function(){Ee.call(this,"stroke",!1)},F.prototype.beginPath=function(){this.path=[{type:"begin"}]},F.prototype.moveTo=function(Se,Xe){if(isNaN(Se)||isNaN(Xe))throw Ps.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var et=this.ctx.transform.applyToPoint(new l(Se,Xe));this.path.push({type:"mt",x:et.x,y:et.y}),this.ctx.lastPoint=new l(Se,Xe)},F.prototype.closePath=function(){var Se=new l(0,0),Xe=0;for(Xe=this.path.length-1;Xe!==-1;Xe--)if(this.path[Xe].type==="begin"&&Jn(this.path[Xe+1])==="object"&&typeof this.path[Xe+1].x=="number"){Se=new l(this.path[Xe+1].x,this.path[Xe+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new l(Se.x,Se.y)},F.prototype.lineTo=function(Se,Xe){if(isNaN(Se)||isNaN(Xe))throw Ps.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var et=this.ctx.transform.applyToPoint(new l(Se,Xe));this.path.push({type:"lt",x:et.x,y:et.y}),this.ctx.lastPoint=new l(et.x,et.y)},F.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),Ee.call(this,null,!0)},F.prototype.quadraticCurveTo=function(Se,Xe,et,At){if(isNaN(et)||isNaN(At)||isNaN(Se)||isNaN(Xe))throw Ps.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var ft=this.ctx.transform.applyToPoint(new l(et,At)),wt=this.ctx.transform.applyToPoint(new l(Se,Xe));this.path.push({type:"qct",x1:wt.x,y1:wt.y,x:ft.x,y:ft.y}),this.ctx.lastPoint=new l(ft.x,ft.y)},F.prototype.bezierCurveTo=function(Se,Xe,et,At,ft,wt){if(isNaN(ft)||isNaN(wt)||isNaN(Se)||isNaN(Xe)||isNaN(et)||isNaN(At))throw Ps.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Pt=this.ctx.transform.applyToPoint(new l(ft,wt)),It=this.ctx.transform.applyToPoint(new l(Se,Xe)),Ht=this.ctx.transform.applyToPoint(new l(et,At));this.path.push({type:"bct",x1:It.x,y1:It.y,x2:Ht.x,y2:Ht.y,x:Pt.x,y:Pt.y}),this.ctx.lastPoint=new l(Pt.x,Pt.y)},F.prototype.arc=function(Se,Xe,et,At,ft,wt){if(isNaN(Se)||isNaN(Xe)||isNaN(et)||isNaN(At)||isNaN(ft))throw Ps.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(wt=!!wt,!this.ctx.transform.isIdentity){var Pt=this.ctx.transform.applyToPoint(new l(Se,Xe));Se=Pt.x,Xe=Pt.y;var It=this.ctx.transform.applyToPoint(new l(0,et)),Ht=this.ctx.transform.applyToPoint(new l(0,0));et=Math.sqrt(Math.pow(It.x-Ht.x,2)+Math.pow(It.y-Ht.y,2))}Math.abs(ft-At)>=2*Math.PI&&(At=0,ft=2*Math.PI),this.path.push({type:"arc",x:Se,y:Xe,radius:et,startAngle:At,endAngle:ft,counterclockwise:wt})},F.prototype.arcTo=function(Se,Xe,et,At,ft){throw new Error("arcTo not implemented.")},F.prototype.rect=function(Se,Xe,et,At){if(isNaN(Se)||isNaN(Xe)||isNaN(et)||isNaN(At))throw Ps.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(Se,Xe),this.lineTo(Se+et,Xe),this.lineTo(Se+et,Xe+At),this.lineTo(Se,Xe+At),this.lineTo(Se,Xe),this.lineTo(Se+et,Xe),this.lineTo(Se,Xe)},F.prototype.fillRect=function(Se,Xe,et,At){if(isNaN(Se)||isNaN(Xe)||isNaN(et)||isNaN(At))throw Ps.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!z.call(this)){var ft={};this.lineCap!=="butt"&&(ft.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(ft.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(Se,Xe,et,At),this.fill(),ft.hasOwnProperty("lineCap")&&(this.lineCap=ft.lineCap),ft.hasOwnProperty("lineJoin")&&(this.lineJoin=ft.lineJoin)}},F.prototype.strokeRect=function(Se,Xe,et,At){if(isNaN(Se)||isNaN(Xe)||isNaN(et)||isNaN(At))throw Ps.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");J.call(this)||(this.beginPath(),this.rect(Se,Xe,et,At),this.stroke())},F.prototype.clearRect=function(Se,Xe,et,At){if(isNaN(Se)||isNaN(Xe)||isNaN(et)||isNaN(At))throw Ps.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(Se,Xe,et,At))},F.prototype.save=function(Se){Se=typeof Se!="boolean"||Se;for(var Xe=this.pdf.internal.getCurrentPageInfo().pageNumber,et=0;et<this.pdf.internal.getNumberOfPages();et++)this.pdf.setPage(et+1),this.pdf.internal.out("q");if(this.pdf.setPage(Xe),Se){this.ctx.fontSize=this.pdf.internal.getFontSize();var At=new T(this.ctx);this.ctxStack.push(this.ctx),this.ctx=At}},F.prototype.restore=function(Se){Se=typeof Se!="boolean"||Se;for(var Xe=this.pdf.internal.getCurrentPageInfo().pageNumber,et=0;et<this.pdf.internal.getNumberOfPages();et++)this.pdf.setPage(et+1),this.pdf.internal.out("Q");this.pdf.setPage(Xe),Se&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},F.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var k=function(Se){var Xe,et,At,ft;if(Se.isCanvasGradient===!0&&(Se=Se.getColor()),!Se)return{r:0,g:0,b:0,a:0,style:Se};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(Se))Xe=0,et=0,At=0,ft=0;else{var wt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(Se);if(wt!==null)Xe=parseInt(wt[1]),et=parseInt(wt[2]),At=parseInt(wt[3]),ft=1;else if((wt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(Se))!==null)Xe=parseInt(wt[1]),et=parseInt(wt[2]),At=parseInt(wt[3]),ft=parseFloat(wt[4]);else{if(ft=1,typeof Se=="string"&&Se.charAt(0)!=="#"){var Pt=new _4(Se);Se=Pt.ok?Pt.toHex():"#000000"}Se.length===4?(Xe=Se.substring(1,2),Xe+=Xe,et=Se.substring(2,3),et+=et,At=Se.substring(3,4),At+=At):(Xe=Se.substring(1,3),et=Se.substring(3,5),At=Se.substring(5,7)),Xe=parseInt(Xe,16),et=parseInt(et,16),At=parseInt(At,16)}}return{r:Xe,g:et,b:At,a:ft,style:Se}},z=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},J=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};F.prototype.fillText=function(Se,Xe,et,At){if(isNaN(Xe)||isNaN(et)||typeof Se!="string")throw Ps.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(At=isNaN(At)?void 0:At,!z.call(this)){var ft=_t(this.ctx.transform.rotation),wt=this.ctx.transform.scaleX;Me.call(this,{text:Se,x:Xe,y:et,scale:wt,angle:ft,align:this.textAlign,maxWidth:At})}},F.prototype.strokeText=function(Se,Xe,et,At){if(isNaN(Xe)||isNaN(et)||typeof Se!="string")throw Ps.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!J.call(this)){At=isNaN(At)?void 0:At;var ft=_t(this.ctx.transform.rotation),wt=this.ctx.transform.scaleX;Me.call(this,{text:Se,x:Xe,y:et,scale:wt,renderingMode:"stroke",angle:ft,align:this.textAlign,maxWidth:At})}},F.prototype.measureText=function(Se){if(typeof Se!="string")throw Ps.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Xe=this.pdf,et=this.pdf.internal.scaleFactor,At=Xe.internal.getFontSize(),ft=Xe.getStringUnitWidth(Se)*At/Xe.internal.scaleFactor,wt=function(Pt){var It=(Pt=Pt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return It}}),this};return new wt({width:ft*=Math.round(96*et/72*1e4)/1e4})},F.prototype.scale=function(Se,Xe){if(isNaN(Se)||isNaN(Xe))throw Ps.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var et=new g(Se,0,0,Xe,0,0);this.ctx.transform=this.ctx.transform.multiply(et)},F.prototype.rotate=function(Se){if(isNaN(Se))throw Ps.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Xe=new g(Math.cos(Se),Math.sin(Se),-Math.sin(Se),Math.cos(Se),0,0);this.ctx.transform=this.ctx.transform.multiply(Xe)},F.prototype.translate=function(Se,Xe){if(isNaN(Se)||isNaN(Xe))throw Ps.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var et=new g(1,0,0,1,Se,Xe);this.ctx.transform=this.ctx.transform.multiply(et)},F.prototype.transform=function(Se,Xe,et,At,ft,wt){if(isNaN(Se)||isNaN(Xe)||isNaN(et)||isNaN(At)||isNaN(ft)||isNaN(wt))throw Ps.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Pt=new g(Se,Xe,et,At,ft,wt);this.ctx.transform=this.ctx.transform.multiply(Pt)},F.prototype.setTransform=function(Se,Xe,et,At,ft,wt){Se=isNaN(Se)?1:Se,Xe=isNaN(Xe)?0:Xe,et=isNaN(et)?0:et,At=isNaN(At)?1:At,ft=isNaN(ft)?0:ft,wt=isNaN(wt)?0:wt,this.ctx.transform=new g(Se,Xe,et,At,ft,wt)};var te=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};F.prototype.drawImage=function(Se,Xe,et,At,ft,wt,Pt,It,Ht){var ii=this.pdf.getImageProperties(Se),gi=1,mi=1,Mi=1,kt=1;At!==void 0&&It!==void 0&&(Mi=It/At,kt=Ht/ft,gi=ii.width/At*It/At,mi=ii.height/ft*Ht/ft),wt===void 0&&(wt=Xe,Pt=et,Xe=0,et=0),At!==void 0&&It===void 0&&(It=At,Ht=ft),At===void 0&&It===void 0&&(It=ii.width,Ht=ii.height);for(var at,xt=this.ctx.transform.decompose(),Ri=_t(xt.rotate.shx),ei=new g,ut=(ei=(ei=(ei=ei.multiply(xt.translate)).multiply(xt.skew)).multiply(xt.scale)).applyToRectangle(new s(wt-Xe*Mi,Pt-et*kt,At*gi,ft*mi)),jt=ue.call(this,ut),ni=[],di=0;di<jt.length;di+=1)ni.indexOf(jt[di])===-1&&ni.push(jt[di]);if(_e(ni),this.autoPaging)for(var li=ni[0],Ki=ni[ni.length-1],tr=li;tr<Ki+1;tr++){this.pdf.setPage(tr);var Ar=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Er=tr===1?this.posY+this.margin[0]:this.margin[0],Nt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ji=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],ci=tr===1?0:Nt+(tr-2)*Ji;if(this.ctx.clip_path.length!==0){var $t=this.path;at=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=de(at,this.posX+this.margin[3],-ci+Er+this.ctx.prevPageLastElemOffset),He.call(this,"fill",!0),this.path=$t}var Zi=JSON.parse(JSON.stringify(ut));Zi=de([Zi],this.posX+this.margin[3],-ci+Er+this.ctx.prevPageLastElemOffset)[0];var Qt=(tr>li||tr<Ki)&&te.call(this);Qt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ar,Ji,null).clip().discardPath()),this.pdf.addImage(Se,"JPEG",Zi.x,Zi.y,Zi.w,Zi.h,null,null,Ri),Qt&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(Se,"JPEG",ut.x,ut.y,ut.w,ut.h,null,null,Ri)};var ue=function(Se,Xe,et){var At=[];Xe=Xe||this.pdf.internal.pageSize.width,et=et||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var ft=this.posY+this.ctx.prevPageLastElemOffset;switch(Se.type){default:case"mt":case"lt":At.push(Math.floor((Se.y+ft)/et)+1);break;case"arc":At.push(Math.floor((Se.y+ft-Se.radius)/et)+1),At.push(Math.floor((Se.y+ft+Se.radius)/et)+1);break;case"qct":var wt=Ft(this.ctx.lastPoint.x,this.ctx.lastPoint.y,Se.x1,Se.y1,Se.x,Se.y);At.push(Math.floor((wt.y+ft)/et)+1),At.push(Math.floor((wt.y+wt.h+ft)/et)+1);break;case"bct":var Pt=Mt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,Se.x1,Se.y1,Se.x2,Se.y2,Se.x,Se.y);At.push(Math.floor((Pt.y+ft)/et)+1),At.push(Math.floor((Pt.y+Pt.h+ft)/et)+1);break;case"rect":At.push(Math.floor((Se.y+ft)/et)+1),At.push(Math.floor((Se.y+Se.h+ft)/et)+1)}for(var It=0;It<At.length;It+=1)for(;this.pdf.internal.getNumberOfPages()<At[It];)ce.call(this);return At},ce=function(){var Se=this.fillStyle,Xe=this.strokeStyle,et=this.font,At=this.lineCap,ft=this.lineWidth,wt=this.lineJoin;this.pdf.addPage(),this.fillStyle=Se,this.strokeStyle=Xe,this.font=et,this.lineCap=At,this.lineWidth=ft,this.lineJoin=wt},de=function(Se,Xe,et){for(var At=0;At<Se.length;At++)switch(Se[At].type){case"bct":Se[At].x2+=Xe,Se[At].y2+=et;case"qct":Se[At].x1+=Xe,Se[At].y1+=et;case"mt":case"lt":case"arc":default:Se[At].x+=Xe,Se[At].y+=et}return Se},_e=function(Se){return Se.sort(function(Xe,et){return Xe-et})},Ee=function(Se,Xe){for(var et,At,ft=this.fillStyle,wt=this.strokeStyle,Pt=this.lineCap,It=this.lineWidth,Ht=Math.abs(It*this.ctx.transform.scaleX),ii=this.lineJoin,gi=JSON.parse(JSON.stringify(this.path)),mi=JSON.parse(JSON.stringify(this.path)),Mi=[],kt=0;kt<mi.length;kt++)if(mi[kt].x!==void 0)for(var at=ue.call(this,mi[kt]),xt=0;xt<at.length;xt+=1)Mi.indexOf(at[xt])===-1&&Mi.push(at[xt]);for(var Ri=0;Ri<Mi.length;Ri++)for(;this.pdf.internal.getNumberOfPages()<Mi[Ri];)ce.call(this);if(_e(Mi),this.autoPaging)for(var ei=Mi[0],ut=Mi[Mi.length-1],jt=ei;jt<ut+1;jt++){this.pdf.setPage(jt),this.fillStyle=ft,this.strokeStyle=wt,this.lineCap=Pt,this.lineWidth=Ht,this.lineJoin=ii;var ni=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],di=jt===1?this.posY+this.margin[0]:this.margin[0],li=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ki=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],tr=jt===1?0:li+(jt-2)*Ki;if(this.ctx.clip_path.length!==0){var Ar=this.path;et=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=de(et,this.posX+this.margin[3],-tr+di+this.ctx.prevPageLastElemOffset),He.call(this,Se,!0),this.path=Ar}if(At=JSON.parse(JSON.stringify(gi)),this.path=de(At,this.posX+this.margin[3],-tr+di+this.ctx.prevPageLastElemOffset),Xe===!1||jt===0){var Er=(jt>ei||jt<ut)&&te.call(this);Er&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ni,Ki,null).clip().discardPath()),He.call(this,Se,Xe),Er&&this.pdf.restoreGraphicsState()}this.lineWidth=It}else this.lineWidth=Ht,He.call(this,Se,Xe),this.lineWidth=It;this.path=gi},He=function(Se,Xe){if((Se!=="stroke"||Xe||!J.call(this))&&(Se==="stroke"||Xe||!z.call(this))){for(var et,At,ft=[],wt=this.path,Pt=0;Pt<wt.length;Pt++){var It=wt[Pt];switch(It.type){case"begin":ft.push({begin:!0});break;case"close":ft.push({close:!0});break;case"mt":ft.push({start:It,deltas:[],abs:[]});break;case"lt":var Ht=ft.length;if(wt[Pt-1]&&!isNaN(wt[Pt-1].x)&&(et=[It.x-wt[Pt-1].x,It.y-wt[Pt-1].y],Ht>0)){for(;Ht>=0;Ht--)if(ft[Ht-1].close!==!0&&ft[Ht-1].begin!==!0){ft[Ht-1].deltas.push(et),ft[Ht-1].abs.push(It);break}}break;case"bct":et=[It.x1-wt[Pt-1].x,It.y1-wt[Pt-1].y,It.x2-wt[Pt-1].x,It.y2-wt[Pt-1].y,It.x-wt[Pt-1].x,It.y-wt[Pt-1].y],ft[ft.length-1].deltas.push(et);break;case"qct":var ii=wt[Pt-1].x+2/3*(It.x1-wt[Pt-1].x),gi=wt[Pt-1].y+2/3*(It.y1-wt[Pt-1].y),mi=It.x+2/3*(It.x1-It.x),Mi=It.y+2/3*(It.y1-It.y),kt=It.x,at=It.y;et=[ii-wt[Pt-1].x,gi-wt[Pt-1].y,mi-wt[Pt-1].x,Mi-wt[Pt-1].y,kt-wt[Pt-1].x,at-wt[Pt-1].y],ft[ft.length-1].deltas.push(et);break;case"arc":ft.push({deltas:[],abs:[],arc:!0}),Array.isArray(ft[ft.length-1].abs)&&ft[ft.length-1].abs.push(It)}}At=Xe?null:Se==="stroke"?"stroke":"fill";for(var xt=!1,Ri=0;Ri<ft.length;Ri++)if(ft[Ri].arc)for(var ei=ft[Ri].abs,ut=0;ut<ei.length;ut++){var jt=ei[ut];jt.type==="arc"?Ue.call(this,jt.x,jt.y,jt.radius,jt.startAngle,jt.endAngle,jt.counterclockwise,void 0,Xe,!xt):Ze.call(this,jt.x,jt.y),xt=!0}else if(ft[Ri].close===!0)this.pdf.internal.out("h"),xt=!1;else if(ft[Ri].begin!==!0){var ni=ft[Ri].start.x,di=ft[Ri].start.y;We.call(this,ft[Ri].deltas,ni,di),xt=!0}At&&ot.call(this,At),Xe&&it.call(this)}},Ve=function(Se){var Xe=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,et=Xe*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return Se-et;case"top":return Se+Xe-et;case"hanging":return Se+Xe-2*et;case"middle":return Se+Xe/2-et;case"ideographic":return Se;case"alphabetic":default:return Se}},qe=function(Se){return Se+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};F.prototype.createLinearGradient=function(){var Se=function(){};return Se.colorStops=[],Se.addColorStop=function(Xe,et){this.colorStops.push([Xe,et])},Se.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},Se.isCanvasGradient=!0,Se},F.prototype.createPattern=function(){return this.createLinearGradient()},F.prototype.createRadialGradient=function(){return this.createLinearGradient()};var Ue=function(Se,Xe,et,At,ft,wt,Pt,It,Ht){for(var ii=Ct.call(this,et,At,ft,wt),gi=0;gi<ii.length;gi++){var mi=ii[gi];gi===0&&(Ht?De.call(this,mi.x1+Se,mi.y1+Xe):Ze.call(this,mi.x1+Se,mi.y1+Xe)),Bt.call(this,Se,Xe,mi.x2,mi.y2,mi.x3,mi.y3,mi.x4,mi.y4)}It?it.call(this):ot.call(this,Pt)},ot=function(Se){switch(Se){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},it=function(){this.pdf.clip(),this.pdf.discardPath()},De=function(Se,Xe){this.pdf.internal.out(t(Se)+" "+r(Xe)+" m")},Me=function(Se){var Xe;switch(Se.align){case"right":case"end":Xe="right";break;case"center":Xe="center";break;case"left":case"start":default:Xe="left"}var et=this.pdf.getTextDimensions(Se.text),At=Ve.call(this,Se.y),ft=qe.call(this,At)-et.h,wt=this.ctx.transform.applyToPoint(new l(Se.x,At)),Pt=this.ctx.transform.decompose(),It=new g;It=(It=(It=It.multiply(Pt.translate)).multiply(Pt.skew)).multiply(Pt.scale);for(var Ht,ii,gi,mi=this.ctx.transform.applyToRectangle(new s(Se.x,At,et.w,et.h)),Mi=It.applyToRectangle(new s(Se.x,ft,et.w,et.h)),kt=ue.call(this,Mi),at=[],xt=0;xt<kt.length;xt+=1)at.indexOf(kt[xt])===-1&&at.push(kt[xt]);if(_e(at),this.autoPaging)for(var Ri=at[0],ei=at[at.length-1],ut=Ri;ut<ei+1;ut++){this.pdf.setPage(ut);var jt=ut===1?this.posY+this.margin[0]:this.margin[0],ni=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],di=this.pdf.internal.pageSize.height-this.margin[2],li=di-this.margin[0],Ki=this.pdf.internal.pageSize.width-this.margin[1],tr=Ki-this.margin[3],Ar=ut===1?0:ni+(ut-2)*li;if(this.ctx.clip_path.length!==0){var Er=this.path;Ht=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=de(Ht,this.posX+this.margin[3],-1*Ar+jt),He.call(this,"fill",!0),this.path=Er}var Nt=de([JSON.parse(JSON.stringify(Mi))],this.posX+this.margin[3],-Ar+jt+this.ctx.prevPageLastElemOffset)[0];Se.scale>=.01&&(ii=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ii*Se.scale),gi=this.lineWidth,this.lineWidth=gi*Se.scale);var Ji=this.autoPaging!=="text";if(Ji||Nt.y+Nt.h<=di){if(Ji||Nt.y>=jt&&Nt.x<=Ki){var ci=Ji?Se.text:this.pdf.splitTextToSize(Se.text,Se.maxWidth||Ki-Nt.x)[0],$t=de([JSON.parse(JSON.stringify(mi))],this.posX+this.margin[3],-Ar+jt+this.ctx.prevPageLastElemOffset)[0],Zi=Ji&&(ut>Ri||ut<ei)&&te.call(this);Zi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],tr,li,null).clip().discardPath()),this.pdf.text(ci,$t.x,$t.y,{angle:Se.angle,align:Xe,renderingMode:Se.renderingMode}),Zi&&this.pdf.restoreGraphicsState()}}else Nt.y<di&&(this.ctx.prevPageLastElemOffset+=di-Nt.y);Se.scale>=.01&&(this.pdf.setFontSize(ii),this.lineWidth=gi)}else Se.scale>=.01&&(ii=this.pdf.internal.getFontSize(),this.pdf.setFontSize(ii*Se.scale),gi=this.lineWidth,this.lineWidth=gi*Se.scale),this.pdf.text(Se.text,wt.x+this.posX,wt.y+this.posY,{angle:Se.angle,align:Xe,renderingMode:Se.renderingMode,maxWidth:Se.maxWidth}),Se.scale>=.01&&(this.pdf.setFontSize(ii),this.lineWidth=gi)},Ze=function(Se,Xe,et,At){et=et||0,At=At||0,this.pdf.internal.out(t(Se+et)+" "+r(Xe+At)+" l")},We=function(Se,Xe,et){return this.pdf.lines(Se,Xe,et,null,null)},Bt=function(Se,Xe,et,At,ft,wt,Pt,It){this.pdf.internal.out([e(n(et+Se)),e(o(At+Xe)),e(n(ft+Se)),e(o(wt+Xe)),e(n(Pt+Se)),e(o(It+Xe)),"c"].join(" "))},Ct=function(Se,Xe,et,At){for(var ft=2*Math.PI,wt=Math.PI/2;Xe>et;)Xe-=ft;var Pt=Math.abs(et-Xe);Pt<ft&&At&&(Pt=ft-Pt);for(var It=[],Ht=At?-1:1,ii=Xe;Pt>1e-5;){var gi=ii+Ht*Math.min(Pt,wt);It.push(Lt.call(this,Se,ii,gi)),Pt-=Math.abs(gi-ii),ii=gi}return It},Lt=function(Se,Xe,et){var At=(et-Xe)/2,ft=Se*Math.cos(At),wt=Se*Math.sin(At),Pt=ft,It=-wt,Ht=Pt*Pt+It*It,ii=Ht+Pt*ft+It*wt,gi=4/3*(Math.sqrt(2*Ht*ii)-ii)/(Pt*wt-It*ft),mi=Pt-gi*It,Mi=It+gi*Pt,kt=mi,at=-Mi,xt=At+Xe,Ri=Math.cos(xt),ei=Math.sin(xt);return{x1:Se*Math.cos(Xe),y1:Se*Math.sin(Xe),x2:mi*Ri-Mi*ei,y2:mi*ei+Mi*Ri,x3:kt*Ri-at*ei,y3:kt*ei+at*Ri,x4:Se*Math.cos(et),y4:Se*Math.sin(et)}},_t=function(Se){return 180*Se/Math.PI},Ft=function(Se,Xe,et,At,ft,wt){var Pt=Se+.5*(et-Se),It=Xe+.5*(At-Xe),Ht=ft+.5*(et-ft),ii=wt+.5*(At-wt),gi=Math.min(Se,ft,Pt,Ht),mi=Math.max(Se,ft,Pt,Ht),Mi=Math.min(Xe,wt,It,ii),kt=Math.max(Xe,wt,It,ii);return new s(gi,Mi,mi-gi,kt-Mi)},Mt=function(Se,Xe,et,At,ft,wt,Pt,It){var Ht,ii,gi,mi,Mi,kt,at,xt,Ri,ei,ut,jt,ni,di,li=et-Se,Ki=At-Xe,tr=ft-et,Ar=wt-At,Er=Pt-ft,Nt=It-wt;for(ii=0;ii<41;ii++)Ri=(at=(gi=Se+(Ht=ii/40)*li)+Ht*((Mi=et+Ht*tr)-gi))+Ht*(Mi+Ht*(ft+Ht*Er-Mi)-at),ei=(xt=(mi=Xe+Ht*Ki)+Ht*((kt=At+Ht*Ar)-mi))+Ht*(kt+Ht*(wt+Ht*Nt-kt)-xt),ii==0?(ut=Ri,jt=ei,ni=Ri,di=ei):(ut=Math.min(ut,Ri),jt=Math.min(jt,ei),ni=Math.max(ni,Ri),di=Math.max(di,ei));return new s(Math.round(ut),Math.round(jt),Math.round(ni-ut),Math.round(di-jt))},Wt=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var Se,Xe,et=(Se=this.ctx.lineDash,Xe=this.ctx.lineDashOffset,JSON.stringify({lineDash:Se,lineDashOffset:Xe}));this.prevLineDash!==et&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=et)}}})(kr.API),function(i){var e=function(o){var l,s,g,b,T,F,k,z,J,te;for(s=[],g=0,b=(o+=l="\0\0\0\0".slice(o.length%4||4)).length;b>g;g+=4)(T=(o.charCodeAt(g)<<24)+(o.charCodeAt(g+1)<<16)+(o.charCodeAt(g+2)<<8)+o.charCodeAt(g+3))!==0?(F=(T=((T=((T=((T=(T-(te=T%85))/85)-(J=T%85))/85)-(z=T%85))/85)-(k=T%85))/85)%85,s.push(F+33,k+33,z+33,J+33,te+33)):s.push(122);return function(ue,ce){for(var de=ce;de>0;de--)ue.pop()}(s,l.length),String.fromCharCode.apply(String,s)+"~>"},t=function(o){var l,s,g,b,T,F=String,k="length",z=255,J="charCodeAt",te="slice",ue="replace";for(o[te](-2),o=o[te](0,-2)[ue](/\s/g,"")[ue]("z","!!!!!"),g=[],b=0,T=(o+=l="uuuuu"[te](o[k]%5||5))[k];T>b;b+=5)s=52200625*(o[J](b)-33)+614125*(o[J](b+1)-33)+7225*(o[J](b+2)-33)+85*(o[J](b+3)-33)+(o[J](b+4)-33),g.push(z&s>>24,z&s>>16,z&s>>8,z&s);return function(ce,de){for(var _e=de;_e>0;_e--)ce.pop()}(g,l[k]),F.fromCharCode.apply(F,g)},r=function(o){var l=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),l.test(o)===!1)return"";for(var s="",g=0;g<o.length;g+=2)s+=String.fromCharCode("0x"+(o[g]+o[g+1]));return s},n=function(o){for(var l=new Uint8Array(o.length),s=o.length;s--;)l[s]=o.charCodeAt(s);return o=(l=vC(l)).reduce(function(g,b){return g+String.fromCharCode(b)},"")};i.processDataByFilters=function(o,l){var s=0,g=o||"",b=[];for(typeof(l=l||[])=="string"&&(l=[l]),s=0;s<l.length;s+=1)switch(l[s]){case"ASCII85Decode":case"/ASCII85Decode":g=t(g),b.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":g=e(g),b.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":g=r(g),b.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":g=g.split("").map(function(T){return("0"+T.charCodeAt().toString(16)).slice(-2)}).join("")+">",b.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":g=n(g),b.push("/FlateDecode");break;default:throw new Error('The filter: "'+l[s]+'" is not implemented')}return{data:g,reverseChain:b.reverse().join(" ")}}}(kr.API),function(i){i.loadFile=function(e,t,r){return function(n,o,l){o=o!==!1,l=typeof l=="function"?l:function(){};var s=void 0;try{s=function(g,b,T){var F=new XMLHttpRequest,k=0,z=function(J){var te=J.length,ue=[],ce=String.fromCharCode;for(k=0;k<te;k+=1)ue.push(ce(255&J.charCodeAt(k)));return ue.join("")};if(F.open("GET",g,!b),F.overrideMimeType("text/plain; charset=x-user-defined"),b===!1&&(F.onload=function(){F.status===200?T(z(this.responseText)):T(void 0)}),F.send(null),b&&F.status===200)return z(F.responseText)}(n,o,l)}catch{}return s}(e,t,r)},i.loadImageFile=i.loadFile}(kr.API),function(i){function e(){return(Rr.html2canvas?Promise.resolve(Rr.html2canvas):Promise.resolve().then(()=>sue)).catch(function(l){return Promise.reject(new Error("Could not load html2canvas: "+l))}).then(function(l){return l.default?l.default:l})}function t(){return(Rr.DOMPurify?Promise.resolve(Rr.DOMPurify):Promise.resolve().then(()=>Rue)).catch(function(l){return Promise.reject(new Error("Could not load dompurify: "+l))}).then(function(l){return l.default?l.default:l})}var r=function(l){var s=Jn(l);return s==="undefined"?"undefined":s==="string"||l instanceof String?"string":s==="number"||l instanceof Number?"number":s==="function"||l instanceof Function?"function":l&&l.constructor===Array?"array":l&&l.nodeType===1?"element":s==="object"?"object":"unknown"},n=function(l,s){var g=document.createElement(l);for(var b in s.className&&(g.className=s.className),s.innerHTML&&s.dompurify&&(g.innerHTML=s.dompurify.sanitize(s.innerHTML)),s.style)g.style[b]=s.style[b];return g},o=function l(s){var g=Object.assign(l.convert(Promise.resolve()),JSON.parse(JSON.stringify(l.template))),b=l.convert(Promise.resolve(),g);return b=(b=b.setProgress(1,l,1,[l])).set(s)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(l,s){return l.__proto__=s||o.prototype,l},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(l,s){return this.then(function(){switch(s=s||function(g){switch(r(g)){case"string":return"string";case"element":return g.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(l)){case"string":return this.then(t).then(function(g){return this.set({src:n("div",{innerHTML:l,dompurify:g})})});case"element":return this.set({src:l});case"canvas":return this.set({canvas:l});case"img":return this.set({img:l});default:return this.error("Unknown source type.")}})},o.prototype.to=function(l){switch(l){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var l={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},s=function g(b,T){for(var F=b.nodeType===3?document.createTextNode(b.nodeValue):b.cloneNode(!1),k=b.firstChild;k;k=k.nextSibling)T!==!0&&k.nodeType===1&&k.nodeName==="SCRIPT"||F.appendChild(g(k,T));return b.nodeType===1&&(b.nodeName==="CANVAS"?(F.width=b.width,F.height=b.height,F.getContext("2d").drawImage(b,0,0)):b.nodeName!=="TEXTAREA"&&b.nodeName!=="SELECT"||(F.value=b.value),F.addEventListener("load",function(){F.scrollTop=b.scrollTop,F.scrollLeft=b.scrollLeft},!0)),F}(this.prop.src,this.opt.html2canvas.javascriptEnabled);s.tagName==="BODY"&&(l.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=n("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=n("div",{className:"html2pdf__container",style:l}),this.prop.container.appendChild(s),this.prop.container.firstChild.appendChild(n("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(s){var g=Object.assign({},this.opt.html2canvas);return delete g.onrendered,s(this.prop.container,g)}).then(function(s){(this.opt.html2canvas.onrendered||function(){})(s),this.prop.canvas=s,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var l=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(l).then(e).then(function(s){var g=this.opt.jsPDF,b=this.opt.fontFaces,T=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,F=Object.assign({async:!0,allowTaint:!0,scale:T,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete F.onrendered,g.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,g.context2d.posX=this.opt.x,g.context2d.posY=this.opt.y,g.context2d.margin=this.opt.margin,g.context2d.fontFaces=b,b)for(var k=0;k<b.length;++k){var z=b[k],J=z.src.find(function(te){return te.format==="truetype"});J&&g.addFont(J.url,z.ref.name,z.ref.style)}return F.windowHeight=F.windowHeight||0,F.windowHeight=F.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):F.windowHeight,g.context2d.save(!0),s(this.prop.container,F)}).then(function(s){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(s),this.prop.canvas=s,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var l=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=l})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(l,s,g){return(g=g||"pdf").toLowerCase()==="img"||g.toLowerCase()==="image"?this.outputImg(l,s):this.outputPdf(l,s)},o.prototype.outputPdf=function(l,s){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(l,s)})},o.prototype.outputImg=function(l){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(l){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+l+'" is not supported.'}})},o.prototype.save=function(l){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(l?{filename:l}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(l){if(r(l)!=="object")return this;var s=Object.keys(l||{}).map(function(g){if(g in o.template.prop)return function(){this.prop[g]=l[g]};switch(g){case"margin":return this.setMargin.bind(this,l.margin);case"jsPDF":return function(){return this.opt.jsPDF=l.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,l.pageSize);default:return function(){this.opt[g]=l[g]}}},this);return this.then(function(){return this.thenList(s)})},o.prototype.get=function(l,s){return this.then(function(){var g=l in o.template.prop?this.prop[l]:this.opt[l];return s?s(g):g})},o.prototype.setMargin=function(l){return this.then(function(){switch(r(l)){case"number":l=[l,l,l,l];case"array":if(l.length===2&&(l=[l[0],l[1],l[0],l[1]]),l.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=l}).then(this.setPageSize)},o.prototype.setPageSize=function(l){function s(g,b){return Math.floor(g*b/72*96)}return this.then(function(){(l=l||kr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(l.inner={width:l.width-this.opt.margin[1]-this.opt.margin[3],height:l.height-this.opt.margin[0]-this.opt.margin[2]},l.inner.px={width:s(l.inner.width,l.k),height:s(l.inner.height,l.k)},l.inner.ratio=l.inner.height/l.inner.width),this.prop.pageSize=l})},o.prototype.setProgress=function(l,s,g,b){return l!=null&&(this.progress.val=l),s!=null&&(this.progress.state=s),g!=null&&(this.progress.n=g),b!=null&&(this.progress.stack=b),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(l,s,g,b){return this.setProgress(l?this.progress.val+l:null,s||null,g?this.progress.n+g:null,b?this.progress.stack.concat(b):null)},o.prototype.then=function(l,s){var g=this;return this.thenCore(l,s,function(b,T){return g.updateProgress(null,null,1,[b]),Promise.prototype.then.call(this,function(F){return g.updateProgress(null,b),F}).then(b,T).then(function(F){return g.updateProgress(1),F})})},o.prototype.thenCore=function(l,s,g){g=g||Promise.prototype.then,l&&(l=l.bind(this)),s&&(s=s.bind(this));var b=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:o.convert(Object.assign({},this),Promise.prototype),T=g.call(b,l,s);return o.convert(T,this.__proto__)},o.prototype.thenExternal=function(l,s){return Promise.prototype.then.call(this,l,s)},o.prototype.thenList=function(l){var s=this;return l.forEach(function(g){s=s.thenCore(g)}),s},o.prototype.catch=function(l){l&&(l=l.bind(this));var s=Promise.prototype.catch.call(this,l);return o.convert(s,this)},o.prototype.catchExternal=function(l){return Promise.prototype.catch.call(this,l)},o.prototype.error=function(l){return this.then(function(){throw new Error(l)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,kr.getPageSize=function(l,s,g){if(Jn(l)==="object"){var b=l;l=b.orientation,s=b.unit||s,g=b.format||g}s=s||"mm",g=g||"a4",l=(""+(l||"P")).toLowerCase();var T,F=(""+g).toLowerCase(),k={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(s){case"pt":T=1;break;case"mm":T=72/25.4;break;case"cm":T=72/2.54;break;case"in":T=72;break;case"px":T=.75;break;case"pc":case"em":T=12;break;case"ex":T=6;break;default:throw"Invalid unit: "+s}var z,J=0,te=0;if(k.hasOwnProperty(F))J=k[F][1]/T,te=k[F][0]/T;else try{J=g[1],te=g[0]}catch{throw new Error("Invalid format: "+g)}if(l==="p"||l==="portrait")l="p",te>J&&(z=te,te=J,J=z);else{if(l!=="l"&&l!=="landscape")throw"Invalid orientation: "+l;l="l",J>te&&(z=te,te=J,J=z)}return{width:te,height:J,unit:s,k:T,orientation:l}},i.html=function(l,s){(s=s||{}).callback=s.callback||function(){},s.html2canvas=s.html2canvas||{},s.html2canvas.canvas=s.html2canvas.canvas||this.canvas,s.jsPDF=s.jsPDF||this,s.fontFaces=s.fontFaces?s.fontFaces.map(MC):null;var g=new o(s);return s.worker?g:g.from(l).doCallback()}}(kr.API),kr.API.addJS=function(i){return U4=i,this.internal.events.subscribe("postPutResources",function(){sv=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(sv+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),O4=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+U4+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){sv!==void 0&&O4!==void 0&&this.internal.out("/Names <</JavaScript "+sv+" 0 R>>")}),this},function(i){var e;i.events.push(["postPutResources",function(){var t=this,r=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var n=t.outline.render().split(/\r\n/),o=0;o<n.length;o++){var l=n[o],s=r.exec(l);if(s!=null){var g=s[1];t.internal.newObjectDeferredBegin(g,!1)}t.internal.write(l)}if(this.outline.createNamedDestinations){var b=this.internal.pages.length,T=[];for(o=0;o<b;o++){var F=t.internal.newObject();T.push(F);var k=t.internal.getPageInfo(o+1);t.internal.write("<< /D["+k.objId+" 0 R /XYZ null null null]>> endobj")}var z=t.internal.newObject();for(t.internal.write("<< /Names [ "),o=0;o<T.length;o++)t.internal.write("(page_"+(o+1)+")"+T[o]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+z+" 0 R"),t.internal.write(">>","endobj")}}]),i.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+e+" 0 R"))}]),i.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(r,n,o){var l={title:n,options:o,children:[]};return r==null&&(r=this.root),r.children.push(l),l},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(r){r.id=t.internal.newObjectDeferred();for(var n=0;n<r.children.length;n++)this.genIds_r(r.children[n])},t.outline.renderRoot=function(r){this.objStart(r),this.line("/Type /Outlines"),r.children.length>0&&(this.line("/First "+this.makeRef(r.children[0])),this.line("/Last "+this.makeRef(r.children[r.children.length-1]))),this.line("/Count "+this.count_r({count:0},r)),this.objEnd()},t.outline.renderItems=function(r){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,o=0;o<r.children.length;o++){var l=r.children[o];this.objStart(l),this.line("/Title "+this.makeString(l.title)),this.line("/Parent "+this.makeRef(r)),o>0&&this.line("/Prev "+this.makeRef(r.children[o-1])),o<r.children.length-1&&this.line("/Next "+this.makeRef(r.children[o+1])),l.children.length>0&&(this.line("/First "+this.makeRef(l.children[0])),this.line("/Last "+this.makeRef(l.children[l.children.length-1])));var s=this.count=this.count_r({count:0},l);if(s>0&&this.line("/Count "+s),l.options&&l.options.pageNumber){var g=t.internal.getPageInfo(l.options.pageNumber);this.line("/Dest ["+g.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var b=0;b<r.children.length;b++)this.renderItems(r.children[b])},t.outline.line=function(r){this.ctx.val+=r+`\r
`},t.outline.makeRef=function(r){return r.id+" 0 R"},t.outline.makeString=function(r){return"("+t.internal.pdfEscape(r)+")"},t.outline.objStart=function(r){this.ctx.val+=`\r
`+r.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(r,n){for(var o=0;o<n.children.length;o++)r.count++,this.count_r(r,n.children[o]);return r.count}}])}(kr.API),function(i){var e=[192,193,194,195,196,197,198,199];i.processJPEG=function(t,r,n,o,l,s){var g,b=this.decode.DCT_DECODE,T=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=l||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,(g=function(F){for(var k,z=256*F.charCodeAt(4)+F.charCodeAt(5),J=F.length,te={width:0,height:0,numcomponents:1},ue=4;ue<J;ue+=2){if(ue+=z,e.indexOf(F.charCodeAt(ue+1))!==-1){k=256*F.charCodeAt(ue+5)+F.charCodeAt(ue+6),te={width:256*F.charCodeAt(ue+7)+F.charCodeAt(ue+8),height:k,numcomponents:F.charCodeAt(ue+9)};break}z=256*F.charCodeAt(ue+2)+F.charCodeAt(ue+3)}return te}(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t)).numcomponents){case 1:s=this.color_spaces.DEVICE_GRAY;break;case 4:s=this.color_spaces.DEVICE_CMYK;break;case 3:s=this.color_spaces.DEVICE_RGB}T={data:t,width:g.width,height:g.height,colorSpace:s,bitsPerComponent:8,filter:b,index:r,alias:n}}return T}}(kr.API);var Ig,ov,z4,Q4,V4,ore=function(){var i,e,t;function r(o){var l,s,g,b,T,F,k,z,J,te,ue,ce,de,_e;for(this.data=o,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},F=null;;){switch(l=this.readUInt32(),J=(function(){var Ee,He;for(He=[],Ee=0;Ee<4;++Ee)He.push(String.fromCharCode(this.data[this.pos++]));return He}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(l);break;case"fcTL":F&&this.animation.frames.push(F),this.pos+=4,F={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},T=this.readUInt16(),b=this.readUInt16()||100,F.delay=1e3*T/b,F.disposeOp=this.data[this.pos++],F.blendOp=this.data[this.pos++],F.data=[];break;case"IDAT":case"fdAT":for(J==="fdAT"&&(this.pos+=4,l-=4),o=(F!=null?F.data:void 0)||this.imgData,ce=0;0<=l?ce<l:ce>l;0<=l?++ce:--ce)o.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(g=this.palette.length/3,this.transparency.indexed=this.read(l),this.transparency.indexed.length>g)throw new Error("More transparent colors than palette size");if((te=g-this.transparency.indexed.length)>0)for(de=0;0<=te?de<te:de>te;0<=te?++de:--de)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(l)[0];break;case 2:this.transparency.rgb=this.read(l)}break;case"tEXt":k=(ue=this.read(l)).indexOf(0),z=String.fromCharCode.apply(String,ue.slice(0,k)),this.text[z]=String.fromCharCode.apply(String,ue.slice(k+1));break;case"IEND":return F&&this.animation.frames.push(F),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(_e=this.colorType)===4||_e===6,s=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*s,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=l}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}r.prototype.read=function(o){var l,s;for(s=[],l=0;0<=o?l<o:l>o;0<=o?++l:--l)s.push(this.data[this.pos++]);return s},r.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},r.prototype.decodePixels=function(o){var l=this.pixelBitlength/8,s=new Uint8Array(this.width*this.height*l),g=0,b=this;if(o==null&&(o=this.imgData),o.length===0)return new Uint8Array(0);function T(F,k,z,J){var te,ue,ce,de,_e,Ee,He,Ve,qe,Ue,ot,it,De,Me,Ze,We,Bt,Ct,Lt,_t,Ft,Mt=Math.ceil((b.width-F)/z),Wt=Math.ceil((b.height-k)/J),Se=b.width==Mt&&b.height==Wt;for(Me=l*Mt,it=Se?s:new Uint8Array(Me*Wt),Ee=o.length,De=0,ue=0;De<Wt&&g<Ee;){switch(o[g++]){case 0:for(de=Bt=0;Bt<Me;de=Bt+=1)it[ue++]=o[g++];break;case 1:for(de=Ct=0;Ct<Me;de=Ct+=1)te=o[g++],_e=de<l?0:it[ue-l],it[ue++]=(te+_e)%256;break;case 2:for(de=Lt=0;Lt<Me;de=Lt+=1)te=o[g++],ce=(de-de%l)/l,Ze=De&&it[(De-1)*Me+ce*l+de%l],it[ue++]=(Ze+te)%256;break;case 3:for(de=_t=0;_t<Me;de=_t+=1)te=o[g++],ce=(de-de%l)/l,_e=de<l?0:it[ue-l],Ze=De&&it[(De-1)*Me+ce*l+de%l],it[ue++]=(te+Math.floor((_e+Ze)/2))%256;break;case 4:for(de=Ft=0;Ft<Me;de=Ft+=1)te=o[g++],ce=(de-de%l)/l,_e=de<l?0:it[ue-l],De===0?Ze=We=0:(Ze=it[(De-1)*Me+ce*l+de%l],We=ce&&it[(De-1)*Me+(ce-1)*l+de%l]),He=_e+Ze-We,Ve=Math.abs(He-_e),Ue=Math.abs(He-Ze),ot=Math.abs(He-We),qe=Ve<=Ue&&Ve<=ot?_e:Ue<=ot?Ze:We,it[ue++]=(te+qe)%256;break;default:throw new Error("Invalid filter algorithm: "+o[g-1])}if(!Se){var Xe=((k+De*J)*b.width+F)*l,et=De*Me;for(de=0;de<Mt;de+=1){for(var At=0;At<l;At+=1)s[Xe++]=it[et++];Xe+=(z-1)*l}}De++}}return o=zie(o),b.interlaceMethod==1?(T(0,0,8,8),T(4,0,8,8),T(0,4,4,8),T(2,0,4,4),T(0,2,2,4),T(1,0,2,2),T(0,1,1,2)):T(0,0,1,1),s},r.prototype.decodePalette=function(){var o,l,s,g,b,T,F,k,z;for(s=this.palette,T=this.transparency.indexed||[],b=new Uint8Array((T.length||0)+s.length),g=0,o=0,l=F=0,k=s.length;F<k;l=F+=3)b[g++]=s[l],b[g++]=s[l+1],b[g++]=s[l+2],b[g++]=(z=T[o++])!=null?z:255;return b},r.prototype.copyToImageData=function(o,l){var s,g,b,T,F,k,z,J,te,ue,ce;if(g=this.colors,te=null,s=this.hasAlphaChannel,this.palette.length&&(te=(ce=this._decodedPalette)!=null?ce:this._decodedPalette=this.decodePalette(),g=4,s=!0),J=(b=o.data||o).length,F=te||l,T=k=0,g===1)for(;T<J;)z=te?4*l[T/4]:k,ue=F[z++],b[T++]=ue,b[T++]=ue,b[T++]=ue,b[T++]=s?F[z++]:255,k=z;else for(;T<J;)z=te?4*l[T/4]:k,b[T++]=F[z++],b[T++]=F[z++],b[T++]=F[z++],b[T++]=s?F[z++]:255,k=z},r.prototype.decode=function(){var o;return o=new Uint8Array(this.width*this.height*4),this.copyToImageData(o,this.decodePixels()),o};var n=function(){if(Object.prototype.toString.call(Rr)==="[object Window]"){try{e=Rr.document.createElement("canvas"),t=e.getContext("2d")}catch{return!1}return!0}return!1};return n(),i=function(o){var l;if(n()===!0)return t.width=o.width,t.height=o.height,t.clearRect(0,0,o.width,o.height),t.putImageData(o,0,0),(l=new Image).src=e.toDataURL(),l;throw new Error("This method requires a Browser with Canvas-capability.")},r.prototype.decodeFrames=function(o){var l,s,g,b,T,F,k,z;if(this.animation){for(z=[],s=T=0,F=(k=this.animation.frames).length;T<F;s=++T)l=k[s],g=o.createImageData(l.width,l.height),b=this.decodePixels(new Uint8Array(l.data)),this.copyToImageData(g,b),l.imageData=g,z.push(l.image=i(g));return z}},r.prototype.renderFrame=function(o,l){var s,g,b;return s=(g=this.animation.frames)[l],b=g[l-1],l===0&&o.clearRect(0,0,this.width,this.height),(b!=null?b.disposeOp:void 0)===1?o.clearRect(b.xOffset,b.yOffset,b.width,b.height):(b!=null?b.disposeOp:void 0)===2&&o.putImageData(b.imageData,b.xOffset,b.yOffset),s.blendOp===0&&o.clearRect(s.xOffset,s.yOffset,s.width,s.height),o.drawImage(s.image,s.xOffset,s.yOffset)},r.prototype.animate=function(o){var l,s,g,b,T,F,k=this;return s=0,F=this.animation,b=F.numFrames,g=F.frames,T=F.numPlays,(l=function(){var z,J;if(z=s++%b,J=g[z],k.renderFrame(o,z),b>1&&s/b<T)return k.animation._timeout=setTimeout(l,J.delay)})()},r.prototype.stopAnimation=function(){var o;return clearTimeout((o=this.animation)!=null?o._timeout:void 0)},r.prototype.render=function(o){var l,s;return o._png&&o._png.stopAnimation(),o._png=this,o.width=this.width,o.height=this.height,l=o.getContext("2d"),this.animation?(this.decodeFrames(l),this.animate(l)):(s=l.createImageData(this.width,this.height),this.copyToImageData(s,this.decodePixels()),l.putImageData(s,0,0))},r}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function are(i){var e=0;if(i[e++]!==71||i[e++]!==73||i[e++]!==70||i[e++]!==56||(i[e++]+1&253)!=56||i[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=i[e++]|i[e++]<<8,r=i[e++]|i[e++]<<8,n=i[e++],o=n>>7,l=1<<(7&n)+1;i[e++],i[e++];var s=null,g=null;o&&(s=e,g=l,e+=3*l);var b=!0,T=[],F=0,k=null,z=0,J=null;for(this.width=t,this.height=r;b&&e<i.length;)switch(i[e++]){case 33:switch(i[e++]){case 255:if(i[e]!==11||i[e+1]==78&&i[e+2]==69&&i[e+3]==84&&i[e+4]==83&&i[e+5]==67&&i[e+6]==65&&i[e+7]==80&&i[e+8]==69&&i[e+9]==50&&i[e+10]==46&&i[e+11]==48&&i[e+12]==3&&i[e+13]==1&&i[e+16]==0)e+=14,J=i[e++]|i[e++]<<8,e++;else for(e+=12;;){if(!((De=i[e++])>=0))throw Error("Invalid block size");if(De===0)break;e+=De}break;case 249:if(i[e++]!==4||i[e+4]!==0)throw new Error("Invalid graphics extension block.");var te=i[e++];F=i[e++]|i[e++]<<8,k=i[e++],!(1&te)&&(k=null),z=te>>2&7,e++;break;case 254:for(;;){if(!((De=i[e++])>=0))throw Error("Invalid block size");if(De===0)break;e+=De}break;default:throw new Error("Unknown graphic control label: 0x"+i[e-1].toString(16))}break;case 44:var ue=i[e++]|i[e++]<<8,ce=i[e++]|i[e++]<<8,de=i[e++]|i[e++]<<8,_e=i[e++]|i[e++]<<8,Ee=i[e++],He=Ee>>6&1,Ve=1<<(7&Ee)+1,qe=s,Ue=g,ot=!1;Ee>>7&&(ot=!0,qe=e,Ue=Ve,e+=3*Ve);var it=e;for(e++;;){var De;if(!((De=i[e++])>=0))throw Error("Invalid block size");if(De===0)break;e+=De}T.push({x:ue,y:ce,width:de,height:_e,has_local_palette:ot,palette_offset:qe,palette_size:Ue,data_offset:it,data_length:e-it,transparent_index:k,interlaced:!!He,delay:F,disposal:z});break;case 59:b=!1;break;default:throw new Error("Unknown gif block: 0x"+i[e-1].toString(16))}this.numFrames=function(){return T.length},this.loopCount=function(){return J},this.frameInfo=function(Me){if(Me<0||Me>=T.length)throw new Error("Frame index out of range.");return T[Me]},this.decodeAndBlitFrameBGRA=function(Me,Ze){var We=this.frameInfo(Me),Bt=We.width*We.height,Ct=new Uint8Array(Bt);H4(i,We.data_offset,Ct,Bt);var Lt=We.palette_offset,_t=We.transparent_index;_t===null&&(_t=256);var Ft=We.width,Mt=t-Ft,Wt=Ft,Se=4*(We.y*t+We.x),Xe=4*((We.y+We.height)*t+We.x),et=Se,At=4*Mt;We.interlaced===!0&&(At+=4*t*7);for(var ft=8,wt=0,Pt=Ct.length;wt<Pt;++wt){var It=Ct[wt];if(Wt===0&&(Wt=Ft,(et+=At)>=Xe&&(At=4*Mt+4*t*(ft-1),et=Se+(Ft+Mt)*(ft<<1),ft>>=1)),It===_t)et+=4;else{var Ht=i[Lt+3*It],ii=i[Lt+3*It+1],gi=i[Lt+3*It+2];Ze[et++]=gi,Ze[et++]=ii,Ze[et++]=Ht,Ze[et++]=255}--Wt}},this.decodeAndBlitFrameRGBA=function(Me,Ze){var We=this.frameInfo(Me),Bt=We.width*We.height,Ct=new Uint8Array(Bt);H4(i,We.data_offset,Ct,Bt);var Lt=We.palette_offset,_t=We.transparent_index;_t===null&&(_t=256);var Ft=We.width,Mt=t-Ft,Wt=Ft,Se=4*(We.y*t+We.x),Xe=4*((We.y+We.height)*t+We.x),et=Se,At=4*Mt;We.interlaced===!0&&(At+=4*t*7);for(var ft=8,wt=0,Pt=Ct.length;wt<Pt;++wt){var It=Ct[wt];if(Wt===0&&(Wt=Ft,(et+=At)>=Xe&&(At=4*Mt+4*t*(ft-1),et=Se+(Ft+Mt)*(ft<<1),ft>>=1)),It===_t)et+=4;else{var Ht=i[Lt+3*It],ii=i[Lt+3*It+1],gi=i[Lt+3*It+2];Ze[et++]=Ht,Ze[et++]=ii,Ze[et++]=gi,Ze[et++]=255}--Wt}}}function H4(i,e,t,r){for(var n=i[e++],o=1<<n,l=o+1,s=l+1,g=n+1,b=(1<<g)-1,T=0,F=0,k=0,z=i[e++],J=new Int32Array(4096),te=null;;){for(;T<16&&z!==0;)F|=i[e++]<<T,T+=8,z===1?z=i[e++]:--z;if(T<g)break;var ue=F&b;if(F>>=g,T-=g,ue!==o){if(ue===l)break;for(var ce=ue<s?ue:te,de=0,_e=ce;_e>o;)_e=J[_e]>>8,++de;var Ee=_e;if(k+de+(ce!==ue?1:0)>r)return void Ps.log("Warning, gif stream longer than expected.");t[k++]=Ee;var He=k+=de;for(ce!==ue&&(t[k++]=Ee),_e=ce;de--;)_e=J[_e],t[--He]=255&_e,_e>>=8;te!==null&&s<4096&&(J[s++]=te<<8|Ee,s>=b+1&&g<12&&(++g,b=b<<1|1)),te=ue}else s=l+1,b=(1<<(g=n+1))-1,te=null}return k!==r&&Ps.log("Warning, gif stream shorter than expected."),t}/**
	 * @license
	  Copyright (c) 2008, Adobe Systems Incorporated
	  All rights reserved.

	  Redistribution and use in source and binary forms, with or without 
	  modification, are permitted provided that the following conditions are
	  met:

	  * Redistributions of source code must retain the above copyright notice, 
	    this list of conditions and the following disclaimer.
	  
	  * Redistributions in binary form must reproduce the above copyright
	    notice, this list of conditions and the following disclaimer in the 
	    documentation and/or other materials provided with the distribution.
	  
	  * Neither the name of Adobe Systems Incorporated nor the names of its 
	    contributors may be used to endorse or promote products derived from 
	    this software without specific prior written permission.

	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
	  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
	  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
	  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
	  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
	  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
	  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
	  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
	  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/function PC(i){var e,t,r,n,o,l=Math.floor,s=new Array(64),g=new Array(64),b=new Array(64),T=new Array(64),F=new Array(65535),k=new Array(65535),z=new Array(64),J=new Array(64),te=[],ue=0,ce=7,de=new Array(64),_e=new Array(64),Ee=new Array(64),He=new Array(256),Ve=new Array(2048),qe=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Ue=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],ot=[0,1,2,3,4,5,6,7,8,9,10,11],it=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],De=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],Me=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Ze=[0,1,2,3,4,5,6,7,8,9,10,11],We=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Bt=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Ct(Se,Xe){for(var et=0,At=0,ft=new Array,wt=1;wt<=16;wt++){for(var Pt=1;Pt<=Se[wt];Pt++)ft[Xe[At]]=[],ft[Xe[At]][0]=et,ft[Xe[At]][1]=wt,At++,et++;et*=2}return ft}function Lt(Se){for(var Xe=Se[0],et=Se[1]-1;et>=0;)Xe&1<<et&&(ue|=1<<ce),et--,--ce<0&&(ue==255?(_t(255),_t(0)):_t(ue),ce=7,ue=0)}function _t(Se){te.push(Se)}function Ft(Se){_t(Se>>8&255),_t(255&Se)}function Mt(Se,Xe,et,At,ft){for(var wt,Pt=ft[0],It=ft[240],Ht=function(ei,ut){var jt,ni,di,li,Ki,tr,Ar,Er,Nt,Ji,ci=0;for(Nt=0;Nt<8;++Nt){jt=ei[ci],ni=ei[ci+1],di=ei[ci+2],li=ei[ci+3],Ki=ei[ci+4],tr=ei[ci+5],Ar=ei[ci+6];var $t=jt+(Er=ei[ci+7]),Zi=jt-Er,Qt=ni+Ar,Bi=ni-Ar,Ii=di+tr,Gt=di-tr,vi=li+Ki,Jt=li-Ki,mr=$t+vi,Sr=$t-vi,ze=Qt+Ii,we=Qt-Ii;ei[ci]=mr+ze,ei[ci+4]=mr-ze;var oe=.707106781*(we+Sr);ei[ci+2]=Sr+oe,ei[ci+6]=Sr-oe;var ee=.382683433*((mr=Jt+Gt)-(we=Bi+Zi)),le=.5411961*mr+ee,ge=1.306562965*we+ee,ve=.707106781*(ze=Gt+Bi),Ce=Zi+ve,be=Zi-ve;ei[ci+5]=be+le,ei[ci+3]=be-le,ei[ci+1]=Ce+ge,ei[ci+7]=Ce-ge,ci+=8}for(ci=0,Nt=0;Nt<8;++Nt){jt=ei[ci],ni=ei[ci+8],di=ei[ci+16],li=ei[ci+24],Ki=ei[ci+32],tr=ei[ci+40],Ar=ei[ci+48];var Pe=jt+(Er=ei[ci+56]),Oe=jt-Er,Ge=ni+Ar,rt=ni-Ar,yt=di+tr,Et=di-tr,Yt=li+Ki,qt=li-Ki,Kt=Pe+Yt,si=Pe-Yt,Ci=Ge+yt,Hi=Ge-yt;ei[ci]=Kt+Ci,ei[ci+32]=Kt-Ci;var wi=.707106781*(Hi+si);ei[ci+16]=si+wi,ei[ci+48]=si-wi;var Ui=.382683433*((Kt=qt+Et)-(Hi=rt+Oe)),st=.5411961*Kt+Ui,ti=1.306562965*Hi+Ui,zt=.707106781*(Ci=Et+rt),zi=Oe+zt,hr=Oe-zt;ei[ci+40]=hr+st,ei[ci+24]=hr-st,ei[ci+8]=zi+ti,ei[ci+56]=zi-ti,ci++}for(Nt=0;Nt<64;++Nt)Ji=ei[Nt]*ut[Nt],z[Nt]=Ji>0?Ji+.5|0:Ji-.5|0;return z}(Se,Xe),ii=0;ii<64;++ii)J[qe[ii]]=Ht[ii];var gi=J[0]-et;et=J[0],gi==0?Lt(At[0]):(Lt(At[k[wt=32767+gi]]),Lt(F[wt]));for(var mi=63;mi>0&&J[mi]==0;)mi--;if(mi==0)return Lt(Pt),et;for(var Mi,kt=1;kt<=mi;){for(var at=kt;J[kt]==0&&kt<=mi;)++kt;var xt=kt-at;if(xt>=16){Mi=xt>>4;for(var Ri=1;Ri<=Mi;++Ri)Lt(It);xt&=15}wt=32767+J[kt],Lt(ft[(xt<<4)+k[wt]]),Lt(F[wt]),kt++}return mi!=63&&Lt(Pt),et}function Wt(Se){Se=Math.min(Math.max(Se,1),100),o!=Se&&(function(Xe){for(var et=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],At=0;At<64;At++){var ft=l((et[At]*Xe+50)/100);ft=Math.min(Math.max(ft,1),255),s[qe[At]]=ft}for(var wt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Pt=0;Pt<64;Pt++){var It=l((wt[Pt]*Xe+50)/100);It=Math.min(Math.max(It,1),255),g[qe[Pt]]=It}for(var Ht=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ii=0,gi=0;gi<8;gi++)for(var mi=0;mi<8;mi++)b[ii]=1/(s[qe[ii]]*Ht[gi]*Ht[mi]*8),T[ii]=1/(g[qe[ii]]*Ht[gi]*Ht[mi]*8),ii++}(Se<50?Math.floor(5e3/Se):Math.floor(200-2*Se)),o=Se)}this.encode=function(Se,Xe){Xe&&Wt(Xe),te=new Array,ue=0,ce=7,Ft(65496),Ft(65504),Ft(16),_t(74),_t(70),_t(73),_t(70),_t(0),_t(1),_t(1),_t(0),Ft(1),Ft(1),_t(0),_t(0),function(){Ft(65499),Ft(132),_t(0);for(var ni=0;ni<64;ni++)_t(s[ni]);_t(1);for(var di=0;di<64;di++)_t(g[di])}(),function(ni,di){Ft(65472),Ft(17),_t(8),Ft(di),Ft(ni),_t(3),_t(1),_t(17),_t(0),_t(2),_t(17),_t(1),_t(3),_t(17),_t(1)}(Se.width,Se.height),function(){Ft(65476),Ft(418),_t(0);for(var ni=0;ni<16;ni++)_t(Ue[ni+1]);for(var di=0;di<=11;di++)_t(ot[di]);_t(16);for(var li=0;li<16;li++)_t(it[li+1]);for(var Ki=0;Ki<=161;Ki++)_t(De[Ki]);_t(1);for(var tr=0;tr<16;tr++)_t(Me[tr+1]);for(var Ar=0;Ar<=11;Ar++)_t(Ze[Ar]);_t(17);for(var Er=0;Er<16;Er++)_t(We[Er+1]);for(var Nt=0;Nt<=161;Nt++)_t(Bt[Nt])}(),Ft(65498),Ft(12),_t(3),_t(1),_t(0),_t(2),_t(17),_t(3),_t(17),_t(0),_t(63),_t(0);var et=0,At=0,ft=0;ue=0,ce=7,this.encode.displayName="_encode_";for(var wt,Pt,It,Ht,ii,gi,mi,Mi,kt,at=Se.data,xt=Se.width,Ri=Se.height,ei=4*xt,ut=0;ut<Ri;){for(wt=0;wt<ei;){for(ii=ei*ut+wt,mi=-1,Mi=0,kt=0;kt<64;kt++)gi=ii+(Mi=kt>>3)*ei+(mi=4*(7&kt)),ut+Mi>=Ri&&(gi-=ei*(ut+1+Mi-Ri)),wt+mi>=ei&&(gi-=wt+mi-ei+4),Pt=at[gi++],It=at[gi++],Ht=at[gi++],de[kt]=(Ve[Pt]+Ve[It+256>>0]+Ve[Ht+512>>0]>>16)-128,_e[kt]=(Ve[Pt+768>>0]+Ve[It+1024>>0]+Ve[Ht+1280>>0]>>16)-128,Ee[kt]=(Ve[Pt+1280>>0]+Ve[It+1536>>0]+Ve[Ht+1792>>0]>>16)-128;et=Mt(de,b,et,e,r),At=Mt(_e,T,At,t,n),ft=Mt(Ee,T,ft,t,n),wt+=32}ut+=8}if(ce>=0){var jt=[];jt[1]=ce+1,jt[0]=(1<<ce+1)-1,Lt(jt)}return Ft(65497),new Uint8Array(te)},i=i||50,function(){for(var Se=String.fromCharCode,Xe=0;Xe<256;Xe++)He[Xe]=Se(Xe)}(),e=Ct(Ue,ot),t=Ct(Me,Ze),r=Ct(it,De),n=Ct(We,Bt),function(){for(var Se=1,Xe=2,et=1;et<=15;et++){for(var At=Se;At<Xe;At++)k[32767+At]=et,F[32767+At]=[],F[32767+At][1]=et,F[32767+At][0]=At;for(var ft=-(Xe-1);ft<=-Se;ft++)k[32767+ft]=et,F[32767+ft]=[],F[32767+ft][1]=et,F[32767+ft][0]=Xe-1+ft;Se<<=1,Xe<<=1}}(),function(){for(var Se=0;Se<256;Se++)Ve[Se]=19595*Se,Ve[Se+256>>0]=38470*Se,Ve[Se+512>>0]=7471*Se+32768,Ve[Se+768>>0]=-11059*Se,Ve[Se+1024>>0]=-21709*Se,Ve[Se+1280>>0]=32768*Se+8421375,Ve[Se+1536>>0]=-27439*Se,Ve[Se+1792>>0]=-5329*Se}(),Wt(i)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function ch(i,e){if(this.pos=0,this.buffer=i,this.datav=new DataView(i.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function G4(i){function e(Ue){if(!Ue)throw Error("assert :P")}function t(Ue,ot,it){for(var De=0;4>De;De++)if(Ue[ot+De]!=it.charCodeAt(De))return!0;return!1}function r(Ue,ot,it,De,Me){for(var Ze=0;Ze<Me;Ze++)Ue[ot+Ze]=it[De+Ze]}function n(Ue,ot,it,De){for(var Me=0;Me<De;Me++)Ue[ot+Me]=it}function o(Ue){return new Int32Array(Ue)}function l(Ue,ot){for(var it=[],De=0;De<Ue;De++)it.push(new ot);return it}function s(Ue,ot){var it=[];return function De(Me,Ze,We){for(var Bt=We[Ze],Ct=0;Ct<Bt&&(Me.push(We.length>Ze+1?[]:new ot),!(We.length<Ze+1));Ct++)De(Me[Ct],Ze+1,We)}(it,0,Ue),it}var g=function(){var Ue=this;function ot(w,I){for(var R=1<<I-1>>>0;w&R;)R>>>=1;return R?(w&R-1)+R:w}function it(w,I,R,j,Z){e(!(j%R));do w[I+(j-=R)]=Z;while(0<j)}function De(w,I,R,j,Z){if(e(2328>=Z),512>=Z)var W=o(512);else if((W=o(Z))==null)return 0;return function(Y,ie,ae,fe,pe,xe){var Fe,Le,nt=ie,Ke=1<<ae,Re=o(16),Qe=o(16);for(e(pe!=0),e(fe!=null),e(Y!=null),e(0<ae),Le=0;Le<pe;++Le){if(15<fe[Le])return 0;++Re[fe[Le]]}if(Re[0]==pe)return 0;for(Qe[1]=0,Fe=1;15>Fe;++Fe){if(Re[Fe]>1<<Fe)return 0;Qe[Fe+1]=Qe[Fe]+Re[Fe]}for(Le=0;Le<pe;++Le)Fe=fe[Le],0<fe[Le]&&(xe[Qe[Fe]++]=Le);if(Qe[15]==1)return(fe=new Me).g=0,fe.value=xe[0],it(Y,nt,1,Ke,fe),Ke;var pt,bt=-1,ht=Ke-1,Rt=0,Dt=1,hi=1,Vt=1<<ae;for(Le=0,Fe=1,pe=2;Fe<=ae;++Fe,pe<<=1){if(Dt+=hi<<=1,0>(hi-=Re[Fe]))return 0;for(;0<Re[Fe];--Re[Fe])(fe=new Me).g=Fe,fe.value=xe[Le++],it(Y,nt+Rt,pe,Vt,fe),Rt=ot(Rt,Fe)}for(Fe=ae+1,pe=2;15>=Fe;++Fe,pe<<=1){if(Dt+=hi<<=1,0>(hi-=Re[Fe]))return 0;for(;0<Re[Fe];--Re[Fe]){if(fe=new Me,(Rt&ht)!=bt){for(nt+=Vt,pt=1<<(bt=Fe)-ae;15>bt&&!(0>=(pt-=Re[bt]));)++bt,pt<<=1;Ke+=Vt=1<<(pt=bt-ae),Y[ie+(bt=Rt&ht)].g=pt+ae,Y[ie+bt].value=nt-ie-bt}fe.g=Fe-ae,fe.value=xe[Le++],it(Y,nt+(Rt>>ae),pe,Vt,fe),Rt=ot(Rt,Fe)}}return Dt!=2*Qe[15]-1?0:Ke}(w,I,R,j,Z,W)}function Me(){this.value=this.g=0}function Ze(){this.value=this.g=0}function We(){this.G=l(5,Me),this.H=o(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=l(Fs,Ze)}function Bt(w,I,R,j){e(w!=null),e(I!=null),e(2147483648>j),w.Ca=254,w.I=0,w.b=-8,w.Ka=0,w.oa=I,w.pa=R,w.Jd=I,w.Yc=R+j,w.Zc=4<=j?R+j-4+1:R,wt(w)}function Ct(w,I){for(var R=0;0<I--;)R|=It(w,128)<<I;return R}function Lt(w,I){var R=Ct(w,I);return Pt(w)?-R:R}function _t(w,I,R,j){var Z,W=0;for(e(w!=null),e(I!=null),e(4294967288>j),w.Sb=j,w.Ra=0,w.u=0,w.h=0,4<j&&(j=4),Z=0;Z<j;++Z)W+=I[R+Z]<<8*Z;w.Ra=W,w.bb=j,w.oa=I,w.pa=R}function Ft(w){for(;8<=w.u&&w.bb<w.Sb;)w.Ra>>>=8,w.Ra+=w.oa[w.pa+w.bb]<<Ia-8>>>0,++w.bb,w.u-=8;et(w)&&(w.h=1,w.u=0)}function Mt(w,I){if(e(0<=I),!w.h&&I<=ql){var R=Xe(w)&Al[I];return w.u+=I,Ft(w),R}return w.h=1,w.u=0}function Wt(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Se(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Xe(w){return w.Ra>>>(w.u&Ia-1)>>>0}function et(w){return e(w.bb<=w.Sb),w.h||w.bb==w.Sb&&w.u>Ia}function At(w,I){w.u=I,w.h=et(w)}function ft(w){w.u>=La&&(e(w.u>=La),Ft(w))}function wt(w){e(w!=null&&w.oa!=null),w.pa<w.Zc?(w.I=(w.oa[w.pa++]|w.I<<8)>>>0,w.b+=8):(e(w!=null&&w.oa!=null),w.pa<w.Yc?(w.b+=8,w.I=w.oa[w.pa++]|w.I<<8):w.Ka?w.b=0:(w.I<<=8,w.b+=8,w.Ka=1))}function Pt(w){return Ct(w,1)}function It(w,I){var R=w.Ca;0>w.b&&wt(w);var j=w.b,Z=R*I>>>8,W=(w.I>>>j>Z)+0;for(W?(R-=Z,w.I-=Z+1<<j>>>0):R=Z+1,j=R,Z=0;256<=j;)Z+=8,j>>=8;return j=7^Z+Ds[j],w.b-=j,w.Ca=(R<<j)-1,W}function Ht(w,I,R){w[I+0]=R>>24&255,w[I+1]=R>>16&255,w[I+2]=R>>8&255,w[I+3]=R>>0&255}function ii(w,I){return w[I+0]<<0|w[I+1]<<8}function gi(w,I){return ii(w,I)|w[I+2]<<16}function mi(w,I){return ii(w,I)|ii(w,I+2)<<16}function Mi(w,I){var R=1<<I;return e(w!=null),e(0<I),w.X=o(R),w.X==null?0:(w.Mb=32-I,w.Xa=I,1)}function kt(w,I){e(w!=null),e(I!=null),e(w.Xa==I.Xa),r(I.X,0,w.X,0,1<<I.Xa)}function at(){this.X=[],this.Xa=this.Mb=0}function xt(w,I,R,j){e(R!=null),e(j!=null);var Z=R[0],W=j[0];return Z==0&&(Z=(w*W+I/2)/I),W==0&&(W=(I*Z+w/2)/w),0>=Z||0>=W?0:(R[0]=Z,j[0]=W,1)}function Ri(w,I){return w+(1<<I)-1>>>I}function ei(w,I){return((4278255360&w)+(4278255360&I)>>>0&4278255360)+((16711935&w)+(16711935&I)>>>0&16711935)>>>0}function ut(w,I){Ue[I]=function(R,j,Z,W,Y,ie,ae){var fe;for(fe=0;fe<Y;++fe){var pe=Ue[w](ie[ae+fe-1],Z,W+fe);ie[ae+fe]=ei(R[j+fe],pe)}}}function jt(){this.ud=this.hd=this.jd=0}function ni(w,I){return((4278124286&(w^I))>>>1)+(w&I)>>>0}function di(w){return 0<=w&&256>w?w:0>w?0:255<w?255:void 0}function li(w,I){return di(w+(w-I+.5>>1))}function Ki(w,I,R){return Math.abs(I-R)-Math.abs(w-R)}function tr(w,I,R,j,Z,W,Y){for(j=W[Y-1],R=0;R<Z;++R)W[Y+R]=j=ei(w[I+R],j)}function Ar(w,I,R,j,Z){var W;for(W=0;W<R;++W){var Y=w[I+W],ie=Y>>8&255,ae=16711935&(ae=(ae=16711935&Y)+((ie<<16)+ie));j[Z+W]=(4278255360&Y)+ae>>>0}}function Er(w,I){I.jd=w>>0&255,I.hd=w>>8&255,I.ud=w>>16&255}function Nt(w,I,R,j,Z,W){var Y;for(Y=0;Y<j;++Y){var ie=I[R+Y],ae=ie>>>8,fe=ie,pe=255&(pe=(pe=ie>>>16)+((w.jd<<24>>24)*(ae<<24>>24)>>>5));fe=255&(fe=(fe=fe+((w.hd<<24>>24)*(ae<<24>>24)>>>5))+((w.ud<<24>>24)*(pe<<24>>24)>>>5)),Z[W+Y]=(4278255360&ie)+(pe<<16)+fe}}function Ji(w,I,R,j,Z){Ue[I]=function(W,Y,ie,ae,fe,pe,xe,Fe,Le){for(ae=xe;ae<Fe;++ae)for(xe=0;xe<Le;++xe)fe[pe++]=Z(ie[j(W[Y++])])},Ue[w]=function(W,Y,ie,ae,fe,pe,xe){var Fe=8>>W.b,Le=W.Ea,nt=W.K[0],Ke=W.w;if(8>Fe)for(W=(1<<W.b)-1,Ke=(1<<Fe)-1;Y<ie;++Y){var Re,Qe=0;for(Re=0;Re<Le;++Re)Re&W||(Qe=j(ae[fe++])),pe[xe++]=Z(nt[Qe&Ke]),Qe>>=Fe}else Ue["VP8LMapColor"+R](ae,fe,nt,Ke,pe,xe,Y,ie,Le)}}function ci(w,I,R,j,Z){for(R=I+R;I<R;){var W=w[I++];j[Z++]=W>>16&255,j[Z++]=W>>8&255,j[Z++]=W>>0&255}}function $t(w,I,R,j,Z){for(R=I+R;I<R;){var W=w[I++];j[Z++]=W>>16&255,j[Z++]=W>>8&255,j[Z++]=W>>0&255,j[Z++]=W>>24&255}}function Zi(w,I,R,j,Z){for(R=I+R;I<R;){var W=(Y=w[I++])>>16&240|Y>>12&15,Y=Y>>0&240|Y>>28&15;j[Z++]=W,j[Z++]=Y}}function Qt(w,I,R,j,Z){for(R=I+R;I<R;){var W=(Y=w[I++])>>16&248|Y>>13&7,Y=Y>>5&224|Y>>3&31;j[Z++]=W,j[Z++]=Y}}function Bi(w,I,R,j,Z){for(R=I+R;I<R;){var W=w[I++];j[Z++]=W>>0&255,j[Z++]=W>>8&255,j[Z++]=W>>16&255}}function Ii(w,I,R,j,Z,W){if(W==0)for(R=I+R;I<R;)Ht(j,((W=w[I++])[0]>>24|W[1]>>8&65280|W[2]<<8&16711680|W[3]<<24)>>>0),Z+=32;else r(j,Z,w,I,R)}function Gt(w,I){Ue[I][0]=Ue[w+"0"],Ue[I][1]=Ue[w+"1"],Ue[I][2]=Ue[w+"2"],Ue[I][3]=Ue[w+"3"],Ue[I][4]=Ue[w+"4"],Ue[I][5]=Ue[w+"5"],Ue[I][6]=Ue[w+"6"],Ue[I][7]=Ue[w+"7"],Ue[I][8]=Ue[w+"8"],Ue[I][9]=Ue[w+"9"],Ue[I][10]=Ue[w+"10"],Ue[I][11]=Ue[w+"11"],Ue[I][12]=Ue[w+"12"],Ue[I][13]=Ue[w+"13"],Ue[I][14]=Ue[w+"0"],Ue[I][15]=Ue[w+"0"]}function vi(w){return w==yn||w==Cs||w==Do||w==Xl}function Jt(){this.eb=[],this.size=this.A=this.fb=0}function mr(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Sr(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Jt,this.f.kb=new mr,this.sd=null}function ze(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function we(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function oe(w){return alert("todo:WebPSamplerProcessPlane"),w.T}function ee(w,I){var R=w.T,j=I.ba.f.RGBA,Z=j.eb,W=j.fb+w.ka*j.A,Y=Jr[I.ba.S],ie=w.y,ae=w.O,fe=w.f,pe=w.N,xe=w.ea,Fe=w.W,Le=I.cc,nt=I.dc,Ke=I.Mc,Re=I.Nc,Qe=w.ka,pt=w.ka+w.T,bt=w.U,ht=bt+1>>1;for(Qe==0?Y(ie,ae,null,null,fe,pe,xe,Fe,fe,pe,xe,Fe,Z,W,null,null,bt):(Y(I.ec,I.fc,ie,ae,Le,nt,Ke,Re,fe,pe,xe,Fe,Z,W-j.A,Z,W,bt),++R);Qe+2<pt;Qe+=2)Le=fe,nt=pe,Ke=xe,Re=Fe,pe+=w.Rc,Fe+=w.Rc,W+=2*j.A,Y(ie,(ae+=2*w.fa)-w.fa,ie,ae,Le,nt,Ke,Re,fe,pe,xe,Fe,Z,W-j.A,Z,W,bt);return ae+=w.fa,w.j+pt<w.o?(r(I.ec,I.fc,ie,ae,bt),r(I.cc,I.dc,fe,pe,ht),r(I.Mc,I.Nc,xe,Fe,ht),R--):1&pt||Y(ie,ae,null,null,fe,pe,xe,Fe,fe,pe,xe,Fe,Z,W+j.A,null,null,bt),R}function le(w,I,R){var j=w.F,Z=[w.J];if(j!=null){var W=w.U,Y=I.ba.S,ie=Y==Uc||Y==Do;I=I.ba.f.RGBA;var ae=[0],fe=w.ka;ae[0]=w.T,w.Kb&&(fe==0?--ae[0]:(--fe,Z[0]-=w.width),w.j+w.ka+w.T==w.o&&(ae[0]=w.o-w.j-fe));var pe=I.eb;fe=I.fb+fe*I.A,w=Zo(j,Z[0],w.width,W,ae,pe,fe+(ie?0:3),I.A),e(R==ae),w&&vi(Y)&&Fa(pe,fe,ie,W,ae,I.A)}return 0}function ge(w){var I=w.ma,R=I.ba.S,j=11>R,Z=R==Wl||R==Oc||R==Uc||R==Nc||R==12||vi(R);if(I.memory=null,I.Ib=null,I.Jb=null,I.Nd=null,!jl(I.Oa,w,Z?11:12))return 0;if(Z&&vi(R)&&pi(),w.da)alert("todo:use_scaling");else{if(j){if(I.Ib=oe,w.Kb){if(R=w.U+1>>1,I.memory=o(w.U+2*R),I.memory==null)return 0;I.ec=I.memory,I.fc=0,I.cc=I.ec,I.dc=I.fc+w.U,I.Mc=I.cc,I.Nc=I.dc+R,I.Ib=ee,pi()}}else alert("todo:EmitYUV");Z&&(I.Jb=le,j&&vt())}if(j&&!x){for(w=0;256>w;++w)L[w]=89858*(w-128)+va>>yo,a[w]=-22014*(w-128)+va,y[w]=-45773*(w-128),O[w]=113618*(w-128)+va>>yo;for(w=yl;w<Gr;++w)I=76283*(w-16)+va>>yo,d[w-yl]=to(I,255),_[w-yl]=to(I+8>>4,15);x=1}return 1}function ve(w){var I=w.ma,R=w.U,j=w.T;return e(!(1&w.ka)),0>=R||0>=j?0:(R=I.Ib(w,I),I.Jb!=null&&I.Jb(w,I,R),I.Dc+=R,1)}function Ce(w){w.ma.memory=null}function be(w,I,R,j){return Mt(w,8)!=47?0:(I[0]=Mt(w,14)+1,R[0]=Mt(w,14)+1,j[0]=Mt(w,1),Mt(w,3)!=0?0:!w.h)}function Pe(w,I){if(4>w)return w+1;var R=w-2>>1;return(2+(1&w)<<R)+Mt(I,R)+1}function Oe(w,I){return 120<I?I-120:1<=(R=((R=bi[I-1])>>4)*w+(8-(15&R)))?R:1;var R}function Ge(w,I,R){var j=Xe(R),Z=w[I+=255&j].g-8;return 0<Z&&(At(R,R.u+8),j=Xe(R),I+=w[I].value,I+=j&(1<<Z)-1),At(R,R.u+w[I].g),w[I].value}function rt(w,I,R){return R.g+=w.g,R.value+=w.value<<I>>>0,e(8>=R.g),w.g}function yt(w,I,R){var j=w.xc;return e((I=j==0?0:w.vc[w.md*(R>>j)+(I>>j)])<w.Wb),w.Ya[I]}function Et(w,I,R,j){var Z=w.ab,W=w.c*I,Y=w.C;I=Y+I;var ie=R,ae=j;for(j=w.Ta,R=w.Ua;0<Z--;){var fe=w.gc[Z],pe=Y,xe=I,Fe=ie,Le=ae,nt=(ae=j,ie=R,fe.Ea);switch(e(pe<xe),e(xe<=fe.nc),fe.hc){case 2:on(Fe,Le,(xe-pe)*nt,ae,ie);break;case 0:var Ke=pe,Re=xe,Qe=ae,pt=ie,bt=(Vt=fe).Ea;Ke==0&&(ku(Fe,Le,null,null,1,Qe,pt),tr(Fe,Le+1,0,0,bt-1,Qe,pt+1),Le+=bt,pt+=bt,++Ke);for(var ht=1<<Vt.b,Rt=ht-1,Dt=Ri(bt,Vt.b),hi=Vt.K,Vt=Vt.w+(Ke>>Vt.b)*Dt;Ke<Re;){var _i=hi,Si=Vt,Yi=1;for(Sn(Fe,Le,Qe,pt-bt,1,Qe,pt);Yi<bt;){var Ti=(Yi&~Rt)+ht;Ti>bt&&(Ti=bt),(0,fo[_i[Si++]>>8&15])(Fe,Le+ +Yi,Qe,pt+Yi-bt,Ti-Yi,Qe,pt+Yi),Yi=Ti}Le+=bt,pt+=bt,++Ke&Rt||(Vt+=Dt)}xe!=fe.nc&&r(ae,ie-nt,ae,ie+(xe-pe-1)*nt,nt);break;case 1:for(nt=Fe,Re=Le,bt=(Fe=fe.Ea)-(pt=Fe&~(Qe=(Le=1<<fe.b)-1)),Ke=Ri(Fe,fe.b),ht=fe.K,fe=fe.w+(pe>>fe.b)*Ke;pe<xe;){for(Rt=ht,Dt=fe,hi=new jt,Vt=Re+pt,_i=Re+Fe;Re<Vt;)Er(Rt[Dt++],hi),ss(hi,nt,Re,Le,ae,ie),Re+=Le,ie+=Le;Re<_i&&(Er(Rt[Dt++],hi),ss(hi,nt,Re,bt,ae,ie),Re+=bt,ie+=bt),++pe&Qe||(fe+=Ke)}break;case 3:if(Fe==ae&&Le==ie&&0<fe.b){for(Re=ae,Fe=nt=ie+(xe-pe)*nt-(pt=(xe-pe)*Ri(fe.Ea,fe.b)),Le=ae,Qe=ie,Ke=[],pt=(bt=pt)-1;0<=pt;--pt)Ke[pt]=Le[Qe+pt];for(pt=bt-1;0<=pt;--pt)Re[Fe+pt]=Ke[pt];fn(fe,pe,xe,ae,nt,ae,ie)}else fn(fe,pe,xe,Fe,Le,ae,ie)}ie=j,ae=R}ae!=R&&r(j,R,ie,ae,W)}function Yt(w,I){var R=w.V,j=w.Ba+w.c*w.C,Z=I-w.C;if(e(I<=w.l.o),e(16>=Z),0<Z){var W=w.l,Y=w.Ta,ie=w.Ua,ae=W.width;if(Et(w,Z,R,j),Z=ie=[ie],e((R=w.C)<(j=I)),e(W.v<W.va),j>W.o&&(j=W.o),R<W.j){var fe=W.j-R;R=W.j,Z[0]+=fe*ae}if(R>=j?R=0:(Z[0]+=4*W.v,W.ka=R-W.j,W.U=W.va-W.v,W.T=j-R,R=1),R){if(ie=ie[0],11>(R=w.ca).S){var pe=R.f.RGBA,xe=(j=R.S,Z=W.U,W=W.T,fe=pe.eb,pe.A),Fe=W;for(pe=pe.fb+w.Ma*pe.A;0<Fe--;){var Le=Y,nt=ie,Ke=Z,Re=fe,Qe=pe;switch(j){case Rc:os(Le,nt,Ke,Re,Qe);break;case Wl:Mo(Le,nt,Ke,Re,Qe);break;case yn:Mo(Le,nt,Ke,Re,Qe),Fa(Re,Qe,0,Ke,1,0);break;case kc:pl(Le,nt,Ke,Re,Qe);break;case Oc:Ii(Le,nt,Ke,Re,Qe,1);break;case Cs:Ii(Le,nt,Ke,Re,Qe,1),Fa(Re,Qe,0,Ke,1,0);break;case Uc:Ii(Le,nt,Ke,Re,Qe,0);break;case Do:Ii(Le,nt,Ke,Re,Qe,0),Fa(Re,Qe,1,Ke,1,0);break;case Nc:Po(Le,nt,Ke,Re,Qe);break;case Xl:Po(Le,nt,Ke,Re,Qe),go(Re,Qe,Ke,1,0);break;case il:ga(Le,nt,Ke,Re,Qe);break;default:e(0)}ie+=ae,pe+=xe}w.Ma+=W}else alert("todo:EmitRescaledRowsYUVA");e(w.Ma<=R.height)}}w.C=I,e(w.C<=w.i)}function qt(w){var I;if(0<w.ua)return 0;for(I=0;I<w.Wb;++I){var R=w.Ya[I].G,j=w.Ya[I].H;if(0<R[1][j[1]+0].g||0<R[2][j[2]+0].g||0<R[3][j[3]+0].g)return 0}return 1}function Kt(w,I,R,j,Z,W){if(w.Z!=0){var Y=w.qd,ie=w.rd;for(e(ks[w.Z]!=null);I<R;++I)ks[w.Z](Y,ie,j,Z,j,Z,W),Y=j,ie=Z,Z+=W;w.qd=Y,w.rd=ie}}function si(w,I){var R=w.l.ma,j=R.Z==0||R.Z==1?w.l.j:w.C;if(j=w.C<j?j:w.C,e(I<=w.l.o),I>j){var Z=w.l.width,W=R.ca,Y=R.tb+Z*j,ie=w.V,ae=w.Ba+w.c*j,fe=w.gc;e(w.ab==1),e(fe[0].hc==3),dl(fe[0],j,I,ie,ae,W,Y),Kt(R,j,I,W,Y,Z)}w.C=w.Ma=I}function Ci(w,I,R,j,Z,W,Y){var ie=w.$/j,ae=w.$%j,fe=w.m,pe=w.s,xe=R+w.$,Fe=xe;Z=R+j*Z;var Le=R+j*W,nt=280+pe.ua,Ke=w.Pb?ie:16777216,Re=0<pe.ua?pe.Wa:null,Qe=pe.wc,pt=xe<Le?yt(pe,ae,ie):null;e(w.C<W),e(Le<=Z);var bt=!1;e:for(;;){for(;bt||xe<Le;){var ht=0;if(ie>=Ke){var Rt=xe-R;e((Ke=w).Pb),Ke.wd=Ke.m,Ke.xd=Rt,0<Ke.s.ua&&kt(Ke.s.Wa,Ke.s.vb),Ke=ie+Zl}if(ae&Qe||(pt=yt(pe,ae,ie)),e(pt!=null),pt.Qb&&(I[xe]=pt.qb,bt=!0),!bt)if(ft(fe),pt.jc){ht=fe,Rt=I;var Dt=xe,hi=pt.pd[Xe(ht)&Fs-1];e(pt.jc),256>hi.g?(At(ht,ht.u+hi.g),Rt[Dt]=hi.value,ht=0):(At(ht,ht.u+hi.g-256),e(256<=hi.value),ht=hi.value),ht==0&&(bt=!0)}else ht=Ge(pt.G[0],pt.H[0],fe);if(fe.h)break;if(bt||256>ht){if(!bt)if(pt.nd)I[xe]=(pt.qb|ht<<8)>>>0;else{if(ft(fe),bt=Ge(pt.G[1],pt.H[1],fe),ft(fe),Rt=Ge(pt.G[2],pt.H[2],fe),Dt=Ge(pt.G[3],pt.H[3],fe),fe.h)break;I[xe]=(Dt<<24|bt<<16|ht<<8|Rt)>>>0}if(bt=!1,++xe,++ae>=j&&(ae=0,++ie,Y!=null&&ie<=W&&!(ie%16)&&Y(w,ie),Re!=null))for(;Fe<xe;)ht=I[Fe++],Re.X[(506832829*ht&4294967295)>>>Re.Mb]=ht}else if(280>ht){if(ht=Pe(ht-256,fe),Rt=Ge(pt.G[4],pt.H[4],fe),ft(fe),Rt=Oe(j,Rt=Pe(Rt,fe)),fe.h)break;if(xe-R<Rt||Z-xe<ht)break e;for(Dt=0;Dt<ht;++Dt)I[xe+Dt]=I[xe+Dt-Rt];for(xe+=ht,ae+=ht;ae>=j;)ae-=j,++ie,Y!=null&&ie<=W&&!(ie%16)&&Y(w,ie);if(e(xe<=Z),ae&Qe&&(pt=yt(pe,ae,ie)),Re!=null)for(;Fe<xe;)ht=I[Fe++],Re.X[(506832829*ht&4294967295)>>>Re.Mb]=ht}else{if(!(ht<nt))break e;for(bt=ht-280,e(Re!=null);Fe<xe;)ht=I[Fe++],Re.X[(506832829*ht&4294967295)>>>Re.Mb]=ht;ht=xe,e(!(bt>>>(Rt=Re).Xa)),I[ht]=Rt.X[bt],bt=!0}bt||e(fe.h==et(fe))}if(w.Pb&&fe.h&&xe<Z)e(w.m.h),w.a=5,w.m=w.wd,w.$=w.xd,0<w.s.ua&&kt(w.s.vb,w.s.Wa);else{if(fe.h)break e;Y!=null&&Y(w,ie>W?W:ie),w.a=0,w.$=xe-R}return 1}return w.a=3,0}function Hi(w){e(w!=null),w.vc=null,w.yc=null,w.Ya=null;var I=w.Wa;I!=null&&(I.X=null),w.vb=null,e(w!=null)}function wi(){var w=new tl;return w==null?null:(w.a=0,w.xb=Au,Gt("Predictor","VP8LPredictors"),Gt("Predictor","VP8LPredictors_C"),Gt("PredictorAdd","VP8LPredictorsAdd"),Gt("PredictorAdd","VP8LPredictorsAdd_C"),on=Ar,ss=Nt,os=ci,Mo=$t,Po=Zi,ga=Qt,pl=Bi,Ue.VP8LMapColor32b=es,Ue.VP8LMapColor8b=fl,w)}function Ui(w,I,R,j,Z){var W=1,Y=[w],ie=[I],ae=j.m,fe=j.s,pe=null,xe=0;e:for(;;){if(R)for(;W&&Mt(ae,1);){var Fe=Y,Le=ie,nt=j,Ke=1,Re=nt.m,Qe=nt.gc[nt.ab],pt=Mt(Re,2);if(nt.Oc&1<<pt)W=0;else{switch(nt.Oc|=1<<pt,Qe.hc=pt,Qe.Ea=Fe[0],Qe.nc=Le[0],Qe.K=[null],++nt.ab,e(4>=nt.ab),pt){case 0:case 1:Qe.b=Mt(Re,3)+2,Ke=Ui(Ri(Qe.Ea,Qe.b),Ri(Qe.nc,Qe.b),0,nt,Qe.K),Qe.K=Qe.K[0];break;case 3:var bt,ht=Mt(Re,8)+1,Rt=16<ht?0:4<ht?1:2<ht?2:3;if(Fe[0]=Ri(Qe.Ea,Rt),Qe.b=Rt,bt=Ke=Ui(ht,1,0,nt,Qe.K)){var Dt,hi=ht,Vt=Qe,_i=1<<(8>>Vt.b),Si=o(_i);if(Si==null)bt=0;else{var Yi=Vt.K[0],Ti=Vt.w;for(Si[0]=Vt.K[0][0],Dt=1;Dt<1*hi;++Dt)Si[Dt]=ei(Yi[Ti+Dt],Si[Dt-1]);for(;Dt<4*_i;++Dt)Si[Dt]=0;Vt.K[0]=null,Vt.K[0]=Si,bt=1}}Ke=bt;break;case 2:break;default:e(0)}W=Ke}}if(Y=Y[0],ie=ie[0],W&&Mt(ae,1)&&!(W=1<=(xe=Mt(ae,4))&&11>=xe)){j.a=3;break e}var yr;if(yr=W)t:{var fr,ji,Ur,rn=j,Mr=Y,Kr=ie,Cr=xe,ts=R,Nr=rn.m,pr=rn.s,_r=[null],or=1,ln=0,qr=sr[Cr];i:for(;;){if(ts&&Mt(Nr,1)){var Wr=Mt(Nr,3)+2,Mn=Ri(Mr,Wr),Kn=Ri(Kr,Wr),_l=Mn*Kn;if(!Ui(Mn,Kn,0,rn,_r))break i;for(_r=_r[0],pr.xc=Wr,fr=0;fr<_l;++fr){var $r=_r[fr]>>8&65535;_r[fr]=$r,$r>=or&&(or=$r+1)}}if(Nr.h)break i;for(ji=0;5>ji;++ji){var _n=uu[ji];!ji&&0<Cr&&(_n+=1<<Cr),ln<_n&&(ln=_n)}var ea=l(or*qr,Me),Os=or,Ws=l(Os,We);if(Ws==null)var Oo=null;else e(65536>=Os),Oo=Ws;var oo=o(ln);if(Oo==null||oo==null||ea==null){rn.a=1;break i}var Nu=ea;for(fr=Ur=0;fr<or;++fr){var Ra=Oo[fr],In=Ra.G,mc=Ra.H,fu=0,Vc=1,Hc=0;for(ji=0;5>ji;++ji){_n=uu[ji],In[ji]=Nu,mc[ji]=Ur,!ji&&0<Cr&&(_n+=1<<Cr);n:{var zu,nA=_n,Gc=rn,GA=oo,sA=Nu,Rd=Ur,Qu=0,pu=Gc.m,kd=Mt(pu,1);if(n(GA,0,0,nA),kd){var um=Mt(pu,1)+1,ta=Mt(pu,1),Yl=Mt(pu,ta==0?1:8);GA[Yl]=1,um==2&&(GA[Yl=Mt(pu,8)]=1);var oA=1}else{var xh=o(19),gu=Mt(pu,4)+4;if(19<gu){Gc.a=3;var wh=0;break n}for(zu=0;zu<gu;++zu)xh[Ks[zu]]=Mt(pu,3);var Bh=void 0,aA=void 0,Jf=Gc,ia=xh,jc=nA,Od=GA,lA=0,vl=Jf.m,Ud=8,mu=l(128,Me);r:for(;De(mu,0,7,ia,19);){if(Mt(vl,1)){var bl=2+2*Mt(vl,3);if((Bh=2+Mt(vl,bl))>jc)break r}else Bh=jc;for(aA=0;aA<jc&&Bh--;){ft(vl);var Nd=mu[0+(127&Xe(vl))];At(vl,vl.u+Nd.g);var Ch=Nd.value;if(16>Ch)Od[aA++]=Ch,Ch!=0&&(Ud=Ch);else{var Yf=Ch==16,hm=Ch-16,ep=gc[hm],tp=Mt(vl,Ou[hm])+ep;if(aA+tp>jc)break r;for(var ip=Yf?Ud:0;0<tp--;)Od[aA++]=ip}}lA=1;break r}lA||(Jf.a=3),oA=lA}(oA=oA&&!pu.h)&&(Qu=De(sA,Rd,8,GA,nA)),oA&&Qu!=0?wh=Qu:(Gc.a=3,wh=0)}if(wh==0)break i;if(Vc&&_a[ji]==1&&(Vc=Nu[Ur].g==0),fu+=Nu[Ur].g,Ur+=wh,3>=ji){var yc,Uo=oo[0];for(yc=1;yc<_n;++yc)oo[yc]>Uo&&(Uo=oo[yc]);Hc+=Uo}}if(Ra.nd=Vc,Ra.Qb=0,Vc&&(Ra.qb=(In[3][mc[3]+0].value<<24|In[1][mc[1]+0].value<<16|In[2][mc[2]+0].value)>>>0,fu==0&&256>In[0][mc[0]+0].value&&(Ra.Qb=1,Ra.qb+=In[0][mc[0]+0].value<<8)),Ra.jc=!Ra.Qb&&6>Hc,Ra.jc){var cA,ka=Ra;for(cA=0;cA<Fs;++cA){var xl=cA,Vu=ka.pd[xl],zd=ka.G[0][ka.H[0]+xl];256<=zd.value?(Vu.g=zd.g+256,Vu.value=zd.value):(Vu.g=0,Vu.value=0,xl>>=rt(zd,8,Vu),xl>>=rt(ka.G[1][ka.H[1]+xl],16,Vu),xl>>=rt(ka.G[2][ka.H[2]+xl],0,Vu),rt(ka.G[3][ka.H[3]+xl],24,Vu))}}}pr.vc=_r,pr.Wb=or,pr.Ya=Oo,pr.yc=ea,yr=1;break t}yr=0}if(!(W=yr)){j.a=3;break e}if(0<xe){if(fe.ua=1<<xe,!Mi(fe.Wa,xe)){j.a=1,W=0;break e}}else fe.ua=0;var rp=j,Am=Y,np=ie,uA=rp.s,Qd=uA.xc;if(rp.c=Am,rp.i=np,uA.md=Ri(Am,Qd),uA.wc=Qd==0?-1:(1<<Qd)-1,R){j.xb=Ro;break e}if((pe=o(Y*ie))==null){j.a=1,W=0;break e}W=(W=Ci(j,pe,0,Y,ie,ie,null))&&!ae.h;break e}return W?(Z!=null?Z[0]=pe:(e(pe==null),e(R)),j.$=0,R||Hi(fe)):Hi(fe),W}function st(w,I){var R=w.c*w.i,j=R+I+16*I;return e(w.c<=I),w.V=o(j),w.V==null?(w.Ta=null,w.Ua=0,w.a=1,0):(w.Ta=w.V,w.Ua=w.Ba+R+I,1)}function ti(w,I){var R=w.C,j=I-R,Z=w.V,W=w.Ba+w.c*R;for(e(I<=w.l.o);0<j;){var Y=16<j?16:j,ie=w.l.ma,ae=w.l.width,fe=ae*Y,pe=ie.ca,xe=ie.tb+ae*R,Fe=w.Ta,Le=w.Ua;Et(w,Y,Z,W),Oi(Fe,Le,pe,xe,fe),Kt(ie,R,R+Y,pe,xe,ae),j-=Y,Z+=Y*w.c,R+=Y}e(R==I),w.C=w.Ma=I}function zt(){this.ub=this.yd=this.td=this.Rb=0}function zi(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function hr(){this.Fb=this.Bb=this.Cb=0,this.Zb=o(4),this.Lb=o(4)}function sn(){this.Yb=function(){var w=[];return function I(R,j,Z){for(var W=Z[j],Y=0;Y<W&&(R.push(Z.length>j+1?[]:0),!(Z.length<j+1));Y++)I(R[Y],j+1,Z)}(w,0,[3,11]),w}()}function bn(){this.jb=o(3),this.Wc=s([4,8],sn),this.Xc=s([4,17],sn)}function ur(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new o(4),this.od=new o(4)}function gn(){this.ld=this.La=this.dd=this.tc=0}function mn(){this.Na=this.la=0}function lr(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function kn(){this.ad=o(384),this.Za=0,this.Ob=o(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function gs(){this.uc=this.M=this.Nb=0,this.wa=Array(new gn),this.Y=0,this.ya=Array(new kn),this.aa=0,this.l=new So}function Qr(){this.y=o(16),this.f=o(8),this.ea=o(8)}function xn(){this.cb=this.a=0,this.sc="",this.m=new Wt,this.Od=new zt,this.Kc=new zi,this.ed=new ur,this.Qa=new hr,this.Ic=this.$c=this.Aa=0,this.D=new gs,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=l(8,Wt),this.ia=0,this.pb=l(4,lr),this.Pa=new bn,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Qr),this.Hd=0,this.rb=Array(new mn),this.sb=0,this.wa=Array(new gn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new kn),this.L=this.aa=0,this.gd=s([4,2],gn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function So(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function us(){var w=new xn;return w!=null&&(w.a=0,w.sc="OK",w.cb=0,w.Xb=0,Es||(Es=dr)),w}function Wi(w,I,R){return w.a==0&&(w.a=I,w.sc=R,w.cb=0),0}function Ys(w,I,R){return 3<=R&&w[I+0]==157&&w[I+1]==1&&w[I+2]==42}function Bs(w,I){if(w==null)return 0;if(w.a=0,w.sc="OK",I==null)return Wi(w,2,"null VP8Io passed to VP8GetHeaders()");var R=I.data,j=I.w,Z=I.ha;if(4>Z)return Wi(w,7,"Truncated header.");var W=R[j+0]|R[j+1]<<8|R[j+2]<<16,Y=w.Od;if(Y.Rb=!(1&W),Y.td=W>>1&7,Y.yd=W>>4&1,Y.ub=W>>5,3<Y.td)return Wi(w,3,"Incorrect keyframe parameters.");if(!Y.yd)return Wi(w,4,"Frame not displayable.");j+=3,Z-=3;var ie=w.Kc;if(Y.Rb){if(7>Z)return Wi(w,7,"cannot parse picture header");if(!Ys(R,j,Z))return Wi(w,3,"Bad code word");ie.c=16383&(R[j+4]<<8|R[j+3]),ie.Td=R[j+4]>>6,ie.i=16383&(R[j+6]<<8|R[j+5]),ie.Ud=R[j+6]>>6,j+=7,Z-=7,w.za=ie.c+15>>4,w.Ub=ie.i+15>>4,I.width=ie.c,I.height=ie.i,I.Da=0,I.j=0,I.v=0,I.va=I.width,I.o=I.height,I.da=0,I.ib=I.width,I.hb=I.height,I.U=I.width,I.T=I.height,n((W=w.Pa).jb,0,255,W.jb.length),e((W=w.Qa)!=null),W.Cb=0,W.Bb=0,W.Fb=1,n(W.Zb,0,0,W.Zb.length),n(W.Lb,0,0,W.Lb)}if(Y.ub>Z)return Wi(w,7,"bad partition length");Bt(W=w.m,R,j,Y.ub),j+=Y.ub,Z-=Y.ub,Y.Rb&&(ie.Ld=Pt(W),ie.Kd=Pt(W)),ie=w.Qa;var ae,fe=w.Pa;if(e(W!=null),e(ie!=null),ie.Cb=Pt(W),ie.Cb){if(ie.Bb=Pt(W),Pt(W)){for(ie.Fb=Pt(W),ae=0;4>ae;++ae)ie.Zb[ae]=Pt(W)?Lt(W,7):0;for(ae=0;4>ae;++ae)ie.Lb[ae]=Pt(W)?Lt(W,6):0}if(ie.Bb)for(ae=0;3>ae;++ae)fe.jb[ae]=Pt(W)?Ct(W,8):255}else ie.Bb=0;if(W.Ka)return Wi(w,3,"cannot parse segment header");if((ie=w.ed).zd=Pt(W),ie.Tb=Ct(W,6),ie.wb=Ct(W,3),ie.Pc=Pt(W),ie.Pc&&Pt(W)){for(fe=0;4>fe;++fe)Pt(W)&&(ie.vd[fe]=Lt(W,6));for(fe=0;4>fe;++fe)Pt(W)&&(ie.od[fe]=Lt(W,6))}if(w.L=ie.Tb==0?0:ie.zd?1:2,W.Ka)return Wi(w,3,"cannot parse filter header");var pe=Z;if(Z=ae=j,j=ae+pe,ie=pe,w.Xb=(1<<Ct(w.m,2))-1,pe<3*(fe=w.Xb))R=7;else{for(ae+=3*fe,ie-=3*fe,pe=0;pe<fe;++pe){var xe=R[Z+0]|R[Z+1]<<8|R[Z+2]<<16;xe>ie&&(xe=ie),Bt(w.Jc[+pe],R,ae,xe),ae+=xe,ie-=xe,Z+=3}Bt(w.Jc[+fe],R,ae,ie),R=ae<j?0:5}if(R!=0)return Wi(w,R,"cannot parse partitions");for(R=Ct(ae=w.m,7),Z=Pt(ae)?Lt(ae,4):0,j=Pt(ae)?Lt(ae,4):0,ie=Pt(ae)?Lt(ae,4):0,fe=Pt(ae)?Lt(ae,4):0,ae=Pt(ae)?Lt(ae,4):0,pe=w.Qa,xe=0;4>xe;++xe){if(pe.Cb){var Fe=pe.Zb[xe];pe.Fb||(Fe+=R)}else{if(0<xe){w.pb[xe]=w.pb[0];continue}Fe=R}var Le=w.pb[xe];Le.Sc[0]=zc[to(Fe+Z,127)],Le.Sc[1]=Qc[to(Fe+0,127)],Le.Eb[0]=2*zc[to(Fe+j,127)],Le.Eb[1]=101581*Qc[to(Fe+ie,127)]>>16,8>Le.Eb[1]&&(Le.Eb[1]=8),Le.Qc[0]=zc[to(Fe+fe,117)],Le.Qc[1]=Qc[to(Fe+ae,127)],Le.lc=Fe+ae}if(!Y.Rb)return Wi(w,4,"Not a key frame.");for(Pt(W),Y=w.Pa,R=0;4>R;++R){for(Z=0;8>Z;++Z)for(j=0;3>j;++j)for(ie=0;11>ie;++ie)fe=It(W,$n[R][Z][j][ie])?Ct(W,8):$i[R][Z][j][ie],Y.Wc[R][Z].Yb[j][ie]=fe;for(Z=0;17>Z;++Z)Y.Xc[R][Z]=Y.Wc[R][Uu[Z]]}return w.kc=Pt(W),w.kc&&(w.Bd=Ct(W,8)),w.cb=1}function dr(w,I,R,j,Z,W,Y){var ie=I[Z].Yb[R];for(R=0;16>Z;++Z){if(!It(w,ie[R+0]))return Z;for(;!It(w,ie[R+1]);)if(ie=I[++Z].Yb[0],R=0,Z==16)return 16;var ae=I[Z+1].Yb;if(It(w,ie[R+2])){var fe=w,pe=0;if(It(fe,(Fe=ie)[(xe=R)+3]))if(It(fe,Fe[xe+6])){for(ie=0,xe=2*(pe=It(fe,Fe[xe+8]))+(Fe=It(fe,Fe[xe+9+pe])),pe=0,Fe=bh[xe];Fe[ie];++ie)pe+=pe+It(fe,Fe[ie]);pe+=3+(8<<xe)}else It(fe,Fe[xe+7])?(pe=7+2*It(fe,165),pe+=It(fe,145)):pe=5+It(fe,159);else pe=It(fe,Fe[xe+4])?3+It(fe,Fe[xe+5]):2;ie=ae[2]}else pe=1,ie=ae[1];ae=Y+qn[Z],0>(fe=w).b&&wt(fe);var xe,Fe=fe.b,Le=(xe=fe.Ca>>1)-(fe.I>>Fe)>>31;--fe.b,fe.Ca+=Le,fe.Ca|=1,fe.I-=(xe+1&Le)<<Fe,W[ae]=((pe^Le)-Le)*j[(0<Z)+0]}return 16}function Fr(w){var I=w.rb[w.sb-1];I.la=0,I.Na=0,n(w.zc,0,0,w.zc.length),w.ja=0}function Hn(w,I){if(w==null)return 0;if(I==null)return Wi(w,2,"NULL VP8Io parameter in VP8Decode().");if(!w.cb&&!Bs(w,I))return 0;if(e(w.cb),I.ac==null||I.ac(I)){I.ob&&(w.L=0);var R=S[w.L];if(w.L==2?(w.yb=0,w.zb=0):(w.yb=I.v-R>>4,w.zb=I.j-R>>4,0>w.yb&&(w.yb=0),0>w.zb&&(w.zb=0)),w.Va=I.o+15+R>>4,w.Hb=I.va+15+R>>4,w.Hb>w.za&&(w.Hb=w.za),w.Va>w.Ub&&(w.Va=w.Ub),0<w.L){var j=w.ed;for(R=0;4>R;++R){var Z;if(w.Qa.Cb){var W=w.Qa.Lb[R];w.Qa.Fb||(W+=j.Tb)}else W=j.Tb;for(Z=0;1>=Z;++Z){var Y=w.gd[R][Z],ie=W;if(j.Pc&&(ie+=j.vd[0],Z&&(ie+=j.od[0])),0<(ie=0>ie?0:63<ie?63:ie)){var ae=ie;0<j.wb&&(ae=4<j.wb?ae>>2:ae>>1)>9-j.wb&&(ae=9-j.wb),1>ae&&(ae=1),Y.dd=ae,Y.tc=2*ie+ae,Y.ld=40<=ie?2:15<=ie?1:0}else Y.tc=0;Y.La=Z}}}R=0}else Wi(w,6,"Frame setup failed"),R=w.a;if(R=R==0){if(R){w.$c=0,0<w.Aa||(w.Ic=H);e:{R=w.Ic,j=4*(ae=w.za);var fe=32*ae,pe=ae+1,xe=0<w.L?ae*(0<w.Aa?2:1):0,Fe=(w.Aa==2?2:1)*ae;if((Y=j+832+(Z=3*(16*R+S[w.L])/2*fe)+(W=w.Fa!=null&&0<w.Fa.length?w.Kc.c*w.Kc.i:0))!=Y)R=0;else{if(Y>w.Vb){if(w.Vb=0,w.Ec=o(Y),w.Fc=0,w.Ec==null){R=Wi(w,1,"no memory during frame initialization.");break e}w.Vb=Y}Y=w.Ec,ie=w.Fc,w.Ac=Y,w.Bc=ie,ie+=j,w.Gd=l(fe,Qr),w.Hd=0,w.rb=l(pe+1,mn),w.sb=1,w.wa=xe?l(xe,gn):null,w.Y=0,w.D.Nb=0,w.D.wa=w.wa,w.D.Y=w.Y,0<w.Aa&&(w.D.Y+=ae),e(!0),w.oc=Y,w.pc=ie,ie+=832,w.ya=l(Fe,kn),w.aa=0,w.D.ya=w.ya,w.D.aa=w.aa,w.Aa==2&&(w.D.aa+=ae),w.R=16*ae,w.B=8*ae,ae=(fe=S[w.L])*w.R,fe=fe/2*w.B,w.sa=Y,w.ta=ie+ae,w.qa=w.sa,w.ra=w.ta+16*R*w.R+fe,w.Ha=w.qa,w.Ia=w.ra+8*R*w.B+fe,w.$c=0,ie+=Z,w.mb=W?Y:null,w.nb=W?ie:null,e(ie+W<=w.Fc+w.Vb),Fr(w),n(w.Ac,w.Bc,0,j),R=1}}if(R){if(I.ka=0,I.y=w.sa,I.O=w.ta,I.f=w.qa,I.N=w.ra,I.ea=w.Ha,I.Vd=w.Ia,I.fa=w.R,I.Rc=w.B,I.F=null,I.J=0,!Li){for(R=-255;255>=R;++R)Jo[255+R]=0>R?-R:R;for(R=-1020;1020>=R;++R)Pi[1020+R]=-128>R?-128:127<R?127:R;for(R=-112;112>=R;++R)gl[112+R]=-16>R?-16:15<R?15:R;for(R=-255;510>=R;++R)$l[255+R]=0>R?0:255<R?255:R;Li=1}io=Je,ro=ca,ys=uo,no=Ea,Ma=Ne,po=Gs,ma=fc,Pa=Xo,Tn=vh,Fo=lu,As=zl,_s=Dc,ds=cu,Ir=Ru,Zr=Nl,an=Io,jn=Ko,ya=dc,tn[0]=Yn,tn[1]=Ot,tn[2]=Ka,tn[3]=Ul,tn[4]=To,tn[5]=ms,tn[6]=Wa,tn[7]=ua,tn[8]=Sa,tn[9]=Xa,Rs[0]=rs,Rs[1]=Gi,Rs[2]=br,Rs[3]=En,Rs[4]=wn,Rs[5]=au,Rs[6]=$a,Yo[0]=Pr,Yo[1]=ui,Yo[2]=Fc,Yo[3]=Za,Yo[4]=hs,Yo[5]=ha,Yo[6]=dn,R=1}else R=0}R&&(R=function(Le,nt){for(Le.M=0;Le.M<Le.Va;++Le.M){var Ke,Re=Le.Jc[Le.M&Le.Xb],Qe=Le.m,pt=Le;for(Ke=0;Ke<pt.za;++Ke){var bt=Qe,ht=pt,Rt=ht.Ac,Dt=ht.Bc+4*Ke,hi=ht.zc,Vt=ht.ya[ht.aa+Ke];if(ht.Qa.Bb?Vt.$b=It(bt,ht.Pa.jb[0])?2+It(bt,ht.Pa.jb[2]):It(bt,ht.Pa.jb[1]):Vt.$b=0,ht.kc&&(Vt.Ad=It(bt,ht.Bd)),Vt.Za=!It(bt,145)+0,Vt.Za){var _i=Vt.Ob,Si=0;for(ht=0;4>ht;++ht){var Yi,Ti=hi[0+ht];for(Yi=0;4>Yi;++Yi){Ti=Ni[Rt[Dt+Yi]][Ti];for(var yr=hu[It(bt,Ti[0])];0<yr;)yr=hu[2*yr+It(bt,Ti[yr])];Ti=-yr,Rt[Dt+Yi]=Ti}r(_i,Si,Rt,Dt,4),Si+=4,hi[0+ht]=Ti}}else Ti=It(bt,156)?It(bt,128)?1:3:It(bt,163)?2:0,Vt.Ob[0]=Ti,n(Rt,Dt,Ti,4),n(hi,0,Ti,4);Vt.Dd=It(bt,142)?It(bt,114)?It(bt,183)?1:3:2:0}if(pt.m.Ka)return Wi(Le,7,"Premature end-of-partition0 encountered.");for(;Le.ja<Le.za;++Le.ja){if(pt=Re,bt=(Qe=Le).rb[Qe.sb-1],Rt=Qe.rb[Qe.sb+Qe.ja],Ke=Qe.ya[Qe.aa+Qe.ja],Dt=Qe.kc?Ke.Ad:0)bt.la=Rt.la=0,Ke.Za||(bt.Na=Rt.Na=0),Ke.Hc=0,Ke.Gc=0,Ke.ia=0;else{var fr,ji;if(bt=Rt,Rt=pt,Dt=Qe.Pa.Xc,hi=Qe.ya[Qe.aa+Qe.ja],Vt=Qe.pb[hi.$b],ht=hi.ad,_i=0,Si=Qe.rb[Qe.sb-1],Ti=Yi=0,n(ht,_i,0,384),hi.Za)var Ur=0,rn=Dt[3];else{yr=o(16);var Mr=bt.Na+Si.Na;if(Mr=Es(Rt,Dt[1],Mr,Vt.Eb,0,yr,0),bt.Na=Si.Na=(0<Mr)+0,1<Mr)io(yr,0,ht,_i);else{var Kr=yr[0]+3>>3;for(yr=0;256>yr;yr+=16)ht[_i+yr]=Kr}Ur=1,rn=Dt[0]}var Cr=15&bt.la,ts=15&Si.la;for(yr=0;4>yr;++yr){var Nr=1&ts;for(Kr=ji=0;4>Kr;++Kr)Cr=Cr>>1|(Nr=(Mr=Es(Rt,rn,Mr=Nr+(1&Cr),Vt.Sc,Ur,ht,_i))>Ur)<<7,ji=ji<<2|(3<Mr?3:1<Mr?2:ht[_i+0]!=0),_i+=16;Cr>>=4,ts=ts>>1|Nr<<7,Yi=(Yi<<8|ji)>>>0}for(rn=Cr,Ur=ts>>4,fr=0;4>fr;fr+=2){for(ji=0,Cr=bt.la>>4+fr,ts=Si.la>>4+fr,yr=0;2>yr;++yr){for(Nr=1&ts,Kr=0;2>Kr;++Kr)Mr=Nr+(1&Cr),Cr=Cr>>1|(Nr=0<(Mr=Es(Rt,Dt[2],Mr,Vt.Qc,0,ht,_i)))<<3,ji=ji<<2|(3<Mr?3:1<Mr?2:ht[_i+0]!=0),_i+=16;Cr>>=2,ts=ts>>1|Nr<<5}Ti|=ji<<4*fr,rn|=Cr<<4<<fr,Ur|=(240&ts)<<fr}bt.la=rn,Si.la=Ur,hi.Hc=Yi,hi.Gc=Ti,hi.ia=43690&Ti?0:Vt.ia,Dt=!(Yi|Ti)}if(0<Qe.L&&(Qe.wa[Qe.Y+Qe.ja]=Qe.gd[Ke.$b][Ke.Za],Qe.wa[Qe.Y+Qe.ja].La|=!Dt),pt.Ka)return Wi(Le,7,"Premature end-of-file encountered.")}if(Fr(Le),Qe=nt,pt=1,Ke=(Re=Le).D,bt=0<Re.L&&Re.M>=Re.zb&&Re.M<=Re.Va,Re.Aa==0)e:{if(Ke.M=Re.M,Ke.uc=bt,Gl(Re,Ke),pt=1,Ke=(ji=Re.D).Nb,bt=(Ti=S[Re.L])*Re.R,Rt=Ti/2*Re.B,yr=16*Ke*Re.R,Kr=8*Ke*Re.B,Dt=Re.sa,hi=Re.ta-bt+yr,Vt=Re.qa,ht=Re.ra-Rt+Kr,_i=Re.Ha,Si=Re.Ia-Rt+Kr,ts=(Cr=ji.M)==0,Yi=Cr>=Re.Va-1,Re.Aa==2&&Gl(Re,ji),ji.uc)for(Nr=(Mr=Re).D.M,e(Mr.D.uc),ji=Mr.yb;ji<Mr.Hb;++ji){Ur=ji,rn=Nr;var pr=(_r=(_n=Mr).D).Nb;fr=_n.R;var _r=_r.wa[_r.Y+Ur],or=_n.sa,ln=_n.ta+16*pr*fr+16*Ur,qr=_r.dd,Wr=_r.tc;if(Wr!=0)if(e(3<=Wr),_n.L==1)0<Ur&&an(or,ln,fr,Wr+4),_r.La&&ya(or,ln,fr,Wr),0<rn&&Zr(or,ln,fr,Wr+4),_r.La&&jn(or,ln,fr,Wr);else{var Mn=_n.B,Kn=_n.qa,_l=_n.ra+8*pr*Mn+8*Ur,$r=_n.Ha,_n=_n.Ia+8*pr*Mn+8*Ur;pr=_r.ld,0<Ur&&(Pa(or,ln,fr,Wr+4,qr,pr),Fo(Kn,_l,$r,_n,Mn,Wr+4,qr,pr)),_r.La&&(_s(or,ln,fr,Wr,qr,pr),Ir(Kn,_l,$r,_n,Mn,Wr,qr,pr)),0<rn&&(ma(or,ln,fr,Wr+4,qr,pr),Tn(Kn,_l,$r,_n,Mn,Wr+4,qr,pr)),_r.La&&(As(or,ln,fr,Wr,qr,pr),ds(Kn,_l,$r,_n,Mn,Wr,qr,pr))}}if(Re.ia&&alert("todo:DitherRow"),Qe.put!=null){if(ji=16*Cr,Cr=16*(Cr+1),ts?(Qe.y=Re.sa,Qe.O=Re.ta+yr,Qe.f=Re.qa,Qe.N=Re.ra+Kr,Qe.ea=Re.Ha,Qe.W=Re.Ia+Kr):(ji-=Ti,Qe.y=Dt,Qe.O=hi,Qe.f=Vt,Qe.N=ht,Qe.ea=_i,Qe.W=Si),Yi||(Cr-=Ti),Cr>Qe.o&&(Cr=Qe.o),Qe.F=null,Qe.J=null,Re.Fa!=null&&0<Re.Fa.length&&ji<Cr&&(Qe.J=da(Re,Qe,ji,Cr-ji),Qe.F=Re.mb,Qe.F==null&&Qe.F.length==0)){pt=Wi(Re,3,"Could not decode alpha data.");break e}ji<Qe.j&&(Ti=Qe.j-ji,ji=Qe.j,e(!(1&Ti)),Qe.O+=Re.R*Ti,Qe.N+=Re.B*(Ti>>1),Qe.W+=Re.B*(Ti>>1),Qe.F!=null&&(Qe.J+=Qe.width*Ti)),ji<Cr&&(Qe.O+=Qe.v,Qe.N+=Qe.v>>1,Qe.W+=Qe.v>>1,Qe.F!=null&&(Qe.J+=Qe.v),Qe.ka=ji-Qe.j,Qe.U=Qe.va-Qe.v,Qe.T=Cr-ji,pt=Qe.put(Qe))}Ke+1!=Re.Ic||Yi||(r(Re.sa,Re.ta-bt,Dt,hi+16*Re.R,bt),r(Re.qa,Re.ra-Rt,Vt,ht+8*Re.B,Rt),r(Re.Ha,Re.Ia-Rt,_i,Si+8*Re.B,Rt))}if(!pt)return Wi(Le,6,"Output aborted.")}return 1}(w,I)),I.bc!=null&&I.bc(I),R&=1}return R?(w.cb=0,R):0}function Or(w,I,R,j,Z){Z=w[I+R+32*j]+(Z>>3),w[I+R+32*j]=-256&Z?0>Z?0:255:Z}function Cn(w,I,R,j,Z,W){Or(w,I,0,R,j+Z),Or(w,I,1,R,j+W),Or(w,I,2,R,j-W),Or(w,I,3,R,j-Z)}function An(w){return(20091*w>>16)+w}function Hr(w,I,R,j){var Z,W=0,Y=o(16);for(Z=0;4>Z;++Z){var ie=w[I+0]+w[I+8],ae=w[I+0]-w[I+8],fe=(35468*w[I+4]>>16)-An(w[I+12]),pe=An(w[I+4])+(35468*w[I+12]>>16);Y[W+0]=ie+pe,Y[W+1]=ae+fe,Y[W+2]=ae-fe,Y[W+3]=ie-pe,W+=4,I++}for(Z=W=0;4>Z;++Z)ie=(w=Y[W+0]+4)+Y[W+8],ae=w-Y[W+8],fe=(35468*Y[W+4]>>16)-An(Y[W+12]),Or(R,j,0,0,ie+(pe=An(Y[W+4])+(35468*Y[W+12]>>16))),Or(R,j,1,0,ae+fe),Or(R,j,2,0,ae-fe),Or(R,j,3,0,ie-pe),W++,j+=32}function Gs(w,I,R,j){var Z=w[I+0]+4,W=35468*w[I+4]>>16,Y=An(w[I+4]),ie=35468*w[I+1]>>16;Cn(R,j,0,Z+Y,w=An(w[I+1]),ie),Cn(R,j,1,Z+W,w,ie),Cn(R,j,2,Z-W,w,ie),Cn(R,j,3,Z-Y,w,ie)}function ca(w,I,R,j,Z){Hr(w,I,R,j),Z&&Hr(w,I+16,R,j+4)}function uo(w,I,R,j){ro(w,I+0,R,j,1),ro(w,I+32,R,j+128,1)}function Ea(w,I,R,j){var Z;for(w=w[I+0]+4,Z=0;4>Z;++Z)for(I=0;4>I;++I)Or(R,j,I,Z,w)}function Ne(w,I,R,j){w[I+0]&&no(w,I+0,R,j),w[I+16]&&no(w,I+16,R,j+4),w[I+32]&&no(w,I+32,R,j+128),w[I+48]&&no(w,I+48,R,j+128+4)}function Je(w,I,R,j){var Z,W=o(16);for(Z=0;4>Z;++Z){var Y=w[I+0+Z]+w[I+12+Z],ie=w[I+4+Z]+w[I+8+Z],ae=w[I+4+Z]-w[I+8+Z],fe=w[I+0+Z]-w[I+12+Z];W[0+Z]=Y+ie,W[8+Z]=Y-ie,W[4+Z]=fe+ae,W[12+Z]=fe-ae}for(Z=0;4>Z;++Z)Y=(w=W[0+4*Z]+3)+W[3+4*Z],ie=W[1+4*Z]+W[2+4*Z],ae=W[1+4*Z]-W[2+4*Z],fe=w-W[3+4*Z],R[j+0]=Y+ie>>3,R[j+16]=fe+ae>>3,R[j+32]=Y-ie>>3,R[j+48]=fe-ae>>3,j+=64}function dt(w,I,R){var j,Z=I-32,W=so,Y=255-w[Z-1];for(j=0;j<R;++j){var ie,ae=W,fe=Y+w[I-1];for(ie=0;ie<R;++ie)w[I+ie]=ae[fe+w[Z+ie]];I+=32}}function Ot(w,I){dt(w,I,4)}function ui(w,I){dt(w,I,8)}function Gi(w,I){dt(w,I,16)}function br(w,I){var R;for(R=0;16>R;++R)r(w,I+32*R,w,I-32,16)}function En(w,I){var R;for(R=16;0<R;--R)n(w,I,w[I-1],16),I+=32}function On(w,I,R){var j;for(j=0;16>j;++j)n(I,R+32*j,w,16)}function rs(w,I){var R,j=16;for(R=0;16>R;++R)j+=w[I-1+32*R]+w[I+R-32];On(j>>5,w,I)}function wn(w,I){var R,j=8;for(R=0;16>R;++R)j+=w[I-1+32*R];On(j>>4,w,I)}function au(w,I){var R,j=8;for(R=0;16>R;++R)j+=w[I+R-32];On(j>>4,w,I)}function $a(w,I){On(128,w,I)}function Tr(w,I,R){return w+2*I+R+2>>2}function Ka(w,I){var R,j=I-32;for(j=new Uint8Array([Tr(w[j-1],w[j+0],w[j+1]),Tr(w[j+0],w[j+1],w[j+2]),Tr(w[j+1],w[j+2],w[j+3]),Tr(w[j+2],w[j+3],w[j+4])]),R=0;4>R;++R)r(w,I+32*R,j,0,j.length)}function Ul(w,I){var R=w[I-1],j=w[I-1+32],Z=w[I-1+64],W=w[I-1+96];Ht(w,I+0,16843009*Tr(w[I-1-32],R,j)),Ht(w,I+32,16843009*Tr(R,j,Z)),Ht(w,I+64,16843009*Tr(j,Z,W)),Ht(w,I+96,16843009*Tr(Z,W,W))}function Yn(w,I){var R,j=4;for(R=0;4>R;++R)j+=w[I+R-32]+w[I-1+32*R];for(j>>=3,R=0;4>R;++R)n(w,I+32*R,j,4)}function To(w,I){var R=w[I-1+0],j=w[I-1+32],Z=w[I-1+64],W=w[I-1-32],Y=w[I+0-32],ie=w[I+1-32],ae=w[I+2-32],fe=w[I+3-32];w[I+0+96]=Tr(j,Z,w[I-1+96]),w[I+1+96]=w[I+0+64]=Tr(R,j,Z),w[I+2+96]=w[I+1+64]=w[I+0+32]=Tr(W,R,j),w[I+3+96]=w[I+2+64]=w[I+1+32]=w[I+0+0]=Tr(Y,W,R),w[I+3+64]=w[I+2+32]=w[I+1+0]=Tr(ie,Y,W),w[I+3+32]=w[I+2+0]=Tr(ae,ie,Y),w[I+3+0]=Tr(fe,ae,ie)}function Wa(w,I){var R=w[I+1-32],j=w[I+2-32],Z=w[I+3-32],W=w[I+4-32],Y=w[I+5-32],ie=w[I+6-32],ae=w[I+7-32];w[I+0+0]=Tr(w[I+0-32],R,j),w[I+1+0]=w[I+0+32]=Tr(R,j,Z),w[I+2+0]=w[I+1+32]=w[I+0+64]=Tr(j,Z,W),w[I+3+0]=w[I+2+32]=w[I+1+64]=w[I+0+96]=Tr(Z,W,Y),w[I+3+32]=w[I+2+64]=w[I+1+96]=Tr(W,Y,ie),w[I+3+64]=w[I+2+96]=Tr(Y,ie,ae),w[I+3+96]=Tr(ie,ae,ae)}function ms(w,I){var R=w[I-1+0],j=w[I-1+32],Z=w[I-1+64],W=w[I-1-32],Y=w[I+0-32],ie=w[I+1-32],ae=w[I+2-32],fe=w[I+3-32];w[I+0+0]=w[I+1+64]=W+Y+1>>1,w[I+1+0]=w[I+2+64]=Y+ie+1>>1,w[I+2+0]=w[I+3+64]=ie+ae+1>>1,w[I+3+0]=ae+fe+1>>1,w[I+0+96]=Tr(Z,j,R),w[I+0+64]=Tr(j,R,W),w[I+0+32]=w[I+1+96]=Tr(R,W,Y),w[I+1+32]=w[I+2+96]=Tr(W,Y,ie),w[I+2+32]=w[I+3+96]=Tr(Y,ie,ae),w[I+3+32]=Tr(ie,ae,fe)}function ua(w,I){var R=w[I+0-32],j=w[I+1-32],Z=w[I+2-32],W=w[I+3-32],Y=w[I+4-32],ie=w[I+5-32],ae=w[I+6-32],fe=w[I+7-32];w[I+0+0]=R+j+1>>1,w[I+1+0]=w[I+0+64]=j+Z+1>>1,w[I+2+0]=w[I+1+64]=Z+W+1>>1,w[I+3+0]=w[I+2+64]=W+Y+1>>1,w[I+0+32]=Tr(R,j,Z),w[I+1+32]=w[I+0+96]=Tr(j,Z,W),w[I+2+32]=w[I+1+96]=Tr(Z,W,Y),w[I+3+32]=w[I+2+96]=Tr(W,Y,ie),w[I+3+64]=Tr(Y,ie,ae),w[I+3+96]=Tr(ie,ae,fe)}function Xa(w,I){var R=w[I-1+0],j=w[I-1+32],Z=w[I-1+64],W=w[I-1+96];w[I+0+0]=R+j+1>>1,w[I+2+0]=w[I+0+32]=j+Z+1>>1,w[I+2+32]=w[I+0+64]=Z+W+1>>1,w[I+1+0]=Tr(R,j,Z),w[I+3+0]=w[I+1+32]=Tr(j,Z,W),w[I+3+32]=w[I+1+64]=Tr(Z,W,W),w[I+3+64]=w[I+2+64]=w[I+0+96]=w[I+1+96]=w[I+2+96]=w[I+3+96]=W}function Sa(w,I){var R=w[I-1+0],j=w[I-1+32],Z=w[I-1+64],W=w[I-1+96],Y=w[I-1-32],ie=w[I+0-32],ae=w[I+1-32],fe=w[I+2-32];w[I+0+0]=w[I+2+32]=R+Y+1>>1,w[I+0+32]=w[I+2+64]=j+R+1>>1,w[I+0+64]=w[I+2+96]=Z+j+1>>1,w[I+0+96]=W+Z+1>>1,w[I+3+0]=Tr(ie,ae,fe),w[I+2+0]=Tr(Y,ie,ae),w[I+1+0]=w[I+3+32]=Tr(R,Y,ie),w[I+1+32]=w[I+3+64]=Tr(j,R,Y),w[I+1+64]=w[I+3+96]=Tr(Z,j,R),w[I+1+96]=Tr(W,Z,j)}function Fc(w,I){var R;for(R=0;8>R;++R)r(w,I+32*R,w,I-32,8)}function Za(w,I){var R;for(R=0;8>R;++R)n(w,I,w[I-1],8),I+=32}function ho(w,I,R){var j;for(j=0;8>j;++j)n(I,R+32*j,w,8)}function Pr(w,I){var R,j=8;for(R=0;8>R;++R)j+=w[I+R-32]+w[I-1+32*R];ho(j>>4,w,I)}function ha(w,I){var R,j=4;for(R=0;8>R;++R)j+=w[I+R-32];ho(j>>3,w,I)}function hs(w,I){var R,j=4;for(R=0;8>R;++R)j+=w[I-1+32*R];ho(j>>3,w,I)}function dn(w,I){ho(128,w,I)}function ns(w,I,R){var j=w[I-R],Z=w[I+0],W=3*(Z-j)+Kl[1020+w[I-2*R]-w[I+R]],Y=Ei[112+(W+4>>3)];w[I-R]=so[255+j+Ei[112+(W+3>>3)]],w[I+0]=so[255+Z-Y]}function Vr(w,I,R,j){var Z=w[I+0],W=w[I+R];return mo[255+w[I-2*R]-w[I-R]]>j||mo[255+W-Z]>j}function Ja(w,I,R,j){return 4*mo[255+w[I-R]-w[I+0]]+mo[255+w[I-2*R]-w[I+R]]<=j}function cl(w,I,R,j,Z){var W=w[I-3*R],Y=w[I-2*R],ie=w[I-R],ae=w[I+0],fe=w[I+R],pe=w[I+2*R],xe=w[I+3*R];return 4*mo[255+ie-ae]+mo[255+Y-fe]>j?0:mo[255+w[I-4*R]-W]<=Z&&mo[255+W-Y]<=Z&&mo[255+Y-ie]<=Z&&mo[255+xe-pe]<=Z&&mo[255+pe-fe]<=Z&&mo[255+fe-ae]<=Z}function Nl(w,I,R,j){var Z=2*j+1;for(j=0;16>j;++j)Ja(w,I+j,R,Z)&&ns(w,I+j,R)}function Io(w,I,R,j){var Z=2*j+1;for(j=0;16>j;++j)Ja(w,I+j*R,1,Z)&&ns(w,I+j*R,1)}function Ko(w,I,R,j){var Z;for(Z=3;0<Z;--Z)Nl(w,I+=4*R,R,j)}function dc(w,I,R,j){var Z;for(Z=3;0<Z;--Z)Io(w,I+=4,R,j)}function Wo(w,I,R,j,Z,W,Y,ie){for(W=2*W+1;0<Z--;){if(cl(w,I,R,W,Y))if(Vr(w,I,R,ie))ns(w,I,R);else{var ae=w,fe=I,pe=R,xe=ae[fe-2*pe],Fe=ae[fe-pe],Le=ae[fe+0],nt=ae[fe+pe],Ke=ae[fe+2*pe],Re=27*(pt=Kl[1020+3*(Le-Fe)+Kl[1020+xe-nt]])+63>>7,Qe=18*pt+63>>7,pt=9*pt+63>>7;ae[fe-3*pe]=so[255+ae[fe-3*pe]+pt],ae[fe-2*pe]=so[255+xe+Qe],ae[fe-pe]=so[255+Fe+Re],ae[fe+0]=so[255+Le-Re],ae[fe+pe]=so[255+nt-Qe],ae[fe+2*pe]=so[255+Ke-pt]}I+=j}}function Ao(w,I,R,j,Z,W,Y,ie){for(W=2*W+1;0<Z--;){if(cl(w,I,R,W,Y))if(Vr(w,I,R,ie))ns(w,I,R);else{var ae=w,fe=I,pe=R,xe=ae[fe-pe],Fe=ae[fe+0],Le=ae[fe+pe],nt=Ei[112+((Ke=3*(Fe-xe))+4>>3)],Ke=Ei[112+(Ke+3>>3)],Re=nt+1>>1;ae[fe-2*pe]=so[255+ae[fe-2*pe]+Re],ae[fe-pe]=so[255+xe+Ke],ae[fe+0]=so[255+Fe-nt],ae[fe+pe]=so[255+Le-Re]}I+=j}}function fc(w,I,R,j,Z,W){Wo(w,I,R,1,16,j,Z,W)}function Xo(w,I,R,j,Z,W){Wo(w,I,1,R,16,j,Z,W)}function zl(w,I,R,j,Z,W){var Y;for(Y=3;0<Y;--Y)Ao(w,I+=4*R,R,1,16,j,Z,W)}function Dc(w,I,R,j,Z,W){var Y;for(Y=3;0<Y;--Y)Ao(w,I+=4,1,R,16,j,Z,W)}function vh(w,I,R,j,Z,W,Y,ie){Wo(w,I,Z,1,8,W,Y,ie),Wo(R,j,Z,1,8,W,Y,ie)}function lu(w,I,R,j,Z,W,Y,ie){Wo(w,I,1,Z,8,W,Y,ie),Wo(R,j,1,Z,8,W,Y,ie)}function cu(w,I,R,j,Z,W,Y,ie){Ao(w,I+4*Z,Z,1,8,W,Y,ie),Ao(R,j+4*Z,Z,1,8,W,Y,ie)}function Ru(w,I,R,j,Z,W,Y,ie){Ao(w,I+4,1,Z,8,W,Y,ie),Ao(R,j+4,1,Z,8,W,Y,ie)}function Ql(){this.ba=new Sr,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new we,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Ya(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function el(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Vl(){this.ua=0,this.Wa=new at,this.vb=new at,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new We,this.yc=new Me}function tl(){this.xb=this.a=0,this.l=new So,this.ca=new Sr,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Se,this.Pb=0,this.wd=new Se,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Vl,this.ab=0,this.gc=l(4,el),this.Oc=0}function Aa(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new So,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ul(w,I,R,j,Z,W,Y){for(w=w==null?0:w[I+0],I=0;I<Y;++I)Z[W+I]=w+R[j+I]&255,w=Z[W+I]}function Hl(w,I,R,j,Z,W,Y){var ie;if(w==null)ul(null,null,R,j,Z,W,Y);else for(ie=0;ie<Y;++ie)Z[W+ie]=w[I+ie]+R[j+ie]&255}function eo(w,I,R,j,Z,W,Y){if(w==null)ul(null,null,R,j,Z,W,Y);else{var ie,ae=w[I+0],fe=ae,pe=ae;for(ie=0;ie<Y;++ie)fe=pe+(ae=w[I+ie])-fe,pe=R[j+ie]+(-256&fe?0>fe?0:255:fe)&255,fe=ae,Z[W+ie]=pe}}function da(w,I,R,j){var Z=I.width,W=I.o;if(e(w!=null&&I!=null),0>R||0>=j||R+j>W)return null;if(!w.Cc){if(w.ga==null){var Y;if(w.ga=new Aa,(Y=w.ga==null)||(Y=I.width*I.o,e(w.Gb.length==0),w.Gb=o(Y),w.Uc=0,w.Gb==null?Y=0:(w.mb=w.Gb,w.nb=w.Uc,w.rc=null,Y=1),Y=!Y),!Y){Y=w.ga;var ie=w.Fa,ae=w.P,fe=w.qc,pe=w.mb,xe=w.nb,Fe=ae+1,Le=fe-1,nt=Y.l;if(e(ie!=null&&pe!=null&&I!=null),ks[0]=null,ks[1]=ul,ks[2]=Hl,ks[3]=eo,Y.ca=pe,Y.tb=xe,Y.c=I.width,Y.i=I.height,e(0<Y.c&&0<Y.i),1>=fe)I=0;else if(Y.$a=ie[ae+0]>>0&3,Y.Z=ie[ae+0]>>2&3,Y.Lc=ie[ae+0]>>4&3,ae=ie[ae+0]>>6&3,0>Y.$a||1<Y.$a||4<=Y.Z||1<Y.Lc||ae)I=0;else if(nt.put=ve,nt.ac=ge,nt.bc=Ce,nt.ma=Y,nt.width=I.width,nt.height=I.height,nt.Da=I.Da,nt.v=I.v,nt.va=I.va,nt.j=I.j,nt.o=I.o,Y.$a)e:{e(Y.$a==1),I=wi();t:for(;;){if(I==null){I=0;break e}if(e(Y!=null),Y.mc=I,I.c=Y.c,I.i=Y.i,I.l=Y.l,I.l.ma=Y,I.l.width=Y.c,I.l.height=Y.i,I.a=0,_t(I.m,ie,Fe,Le),!Ui(Y.c,Y.i,1,I,null)||(I.ab==1&&I.gc[0].hc==3&&qt(I.s)?(Y.ic=1,ie=I.c*I.i,I.Ta=null,I.Ua=0,I.V=o(ie),I.Ba=0,I.V==null?(I.a=1,I=0):I=1):(Y.ic=0,I=st(I,Y.c)),!I))break t;I=1;break e}Y.mc=null,I=0}else I=Le>=Y.c*Y.i;Y=!I}if(Y)return null;w.ga.Lc!=1?w.Ga=0:j=W-R}e(w.ga!=null),e(R+j<=W);e:{if(I=(ie=w.ga).c,W=ie.l.o,ie.$a==0){if(Fe=w.rc,Le=w.Vc,nt=w.Fa,ae=w.P+1+R*I,fe=w.mb,pe=w.nb+R*I,e(ae<=w.P+w.qc),ie.Z!=0)for(e(ks[ie.Z]!=null),Y=0;Y<j;++Y)ks[ie.Z](Fe,Le,nt,ae,fe,pe,I),Fe=fe,Le=pe,pe+=I,ae+=I;else for(Y=0;Y<j;++Y)r(fe,pe,nt,ae,I),Fe=fe,Le=pe,pe+=I,ae+=I;w.rc=Fe,w.Vc=Le}else{if(e(ie.mc!=null),I=R+j,e((Y=ie.mc)!=null),e(I<=Y.i),Y.C>=I)I=1;else if(ie.ic||vt(),ie.ic){ie=Y.V,Fe=Y.Ba,Le=Y.c;var Ke=Y.i,Re=(nt=1,ae=Y.$/Le,fe=Y.$%Le,pe=Y.m,xe=Y.s,Y.$),Qe=Le*Ke,pt=Le*I,bt=xe.wc,ht=Re<pt?yt(xe,fe,ae):null;e(Re<=Qe),e(I<=Ke),e(qt(xe));t:for(;;){for(;!pe.h&&Re<pt;){if(fe&bt||(ht=yt(xe,fe,ae)),e(ht!=null),ft(pe),256>(Ke=Ge(ht.G[0],ht.H[0],pe)))ie[Fe+Re]=Ke,++Re,++fe>=Le&&(fe=0,++ae<=I&&!(ae%16)&&si(Y,ae));else{if(!(280>Ke)){nt=0;break t}Ke=Pe(Ke-256,pe);var Rt,Dt=Ge(ht.G[4],ht.H[4],pe);if(ft(pe),!(Re>=(Dt=Oe(Le,Dt=Pe(Dt,pe)))&&Qe-Re>=Ke)){nt=0;break t}for(Rt=0;Rt<Ke;++Rt)ie[Fe+Re+Rt]=ie[Fe+Re+Rt-Dt];for(Re+=Ke,fe+=Ke;fe>=Le;)fe-=Le,++ae<=I&&!(ae%16)&&si(Y,ae);Re<pt&&fe&bt&&(ht=yt(xe,fe,ae))}e(pe.h==et(pe))}si(Y,ae>I?I:ae);break t}!nt||pe.h&&Re<Qe?(nt=0,Y.a=pe.h?5:3):Y.$=Re,I=nt}else I=Ci(Y,Y.V,Y.Ba,Y.c,Y.i,I,ti);if(!I){j=0;break e}}R+j>=W&&(w.Cc=1),j=1}if(!j)return null;if(w.Cc&&((j=w.ga)!=null&&(j.mc=null),w.ga=null,0<w.Ga))return alert("todo:WebPDequantizeLevels"),null}return w.nb+R*Z}function ne(w,I,R,j,Z,W){for(;0<Z--;){var Y,ie=w,ae=I+(R?1:0),fe=w,pe=I+(R?0:3);for(Y=0;Y<j;++Y){var xe=fe[pe+4*Y];xe!=255&&(xe*=32897,ie[ae+4*Y+0]=ie[ae+4*Y+0]*xe>>23,ie[ae+4*Y+1]=ie[ae+4*Y+1]*xe>>23,ie[ae+4*Y+2]=ie[ae+4*Y+2]*xe>>23)}I+=W}}function Ie(w,I,R,j,Z){for(;0<j--;){var W;for(W=0;W<R;++W){var Y=w[I+2*W+0],ie=15&(fe=w[I+2*W+1]),ae=4369*ie,fe=(240&fe|fe>>4)*ae>>16;w[I+2*W+0]=(240&Y|Y>>4)*ae>>16&240|(15&Y|Y<<4)*ae>>16>>4&15,w[I+2*W+1]=240&fe|ie}I+=Z}}function lt(w,I,R,j,Z,W,Y,ie){var ae,fe,pe=255;for(fe=0;fe<Z;++fe){for(ae=0;ae<j;++ae){var xe=w[I+ae];W[Y+4*ae]=xe,pe&=xe}I+=R,Y+=ie}return pe!=255}function mt(w,I,R,j,Z){var W;for(W=0;W<Z;++W)R[j+W]=w[I+W]>>8}function vt(){Fa=ne,go=Ie,Zo=lt,Oi=mt}function Tt(w,I,R){Ue[w]=function(j,Z,W,Y,ie,ae,fe,pe,xe,Fe,Le,nt,Ke,Re,Qe,pt,bt){var ht,Rt=bt-1>>1,Dt=ie[ae+0]|fe[pe+0]<<16,hi=xe[Fe+0]|Le[nt+0]<<16;e(j!=null);var Vt=3*Dt+hi+131074>>2;for(I(j[Z+0],255&Vt,Vt>>16,Ke,Re),W!=null&&(Vt=3*hi+Dt+131074>>2,I(W[Y+0],255&Vt,Vt>>16,Qe,pt)),ht=1;ht<=Rt;++ht){var _i=ie[ae+ht]|fe[pe+ht]<<16,Si=xe[Fe+ht]|Le[nt+ht]<<16,Yi=Dt+_i+hi+Si+524296,Ti=Yi+2*(_i+hi)>>3;Vt=Ti+Dt>>1,Dt=(Yi=Yi+2*(Dt+Si)>>3)+_i>>1,I(j[Z+2*ht-1],255&Vt,Vt>>16,Ke,Re+(2*ht-1)*R),I(j[Z+2*ht-0],255&Dt,Dt>>16,Ke,Re+(2*ht-0)*R),W!=null&&(Vt=Yi+hi>>1,Dt=Ti+Si>>1,I(W[Y+2*ht-1],255&Vt,Vt>>16,Qe,pt+(2*ht-1)*R),I(W[Y+2*ht+0],255&Dt,Dt>>16,Qe,pt+(2*ht+0)*R)),Dt=_i,hi=Si}1&bt||(Vt=3*Dt+hi+131074>>2,I(j[Z+bt-1],255&Vt,Vt>>16,Ke,Re+(bt-1)*R),W!=null&&(Vt=3*hi+Dt+131074>>2,I(W[Y+bt-1],255&Vt,Vt>>16,Qe,pt+(bt-1)*R)))}}function pi(){Jr[Rc]=Nn,Jr[Wl]=ml,Jr[kc]=ko,Jr[Oc]=rl,Jr[Uc]=Da,Jr[Nc]=Jl,Jr[il]=du,Jr[yn]=ml,Jr[Cs]=rl,Jr[Do]=Da,Jr[Xl]=Jl}function ri(w){return w&~A?0>w?0:255:w>>N}function rr(w,I){return ri((19077*w>>8)+(26149*I>>8)-14234)}function qi(w,I,R){return ri((19077*w>>8)-(6419*I>>8)-(13320*R>>8)+8708)}function ki(w,I){return ri((19077*w>>8)+(33050*I>>8)-17685)}function jr(w,I,R,j,Z){j[Z+0]=rr(w,R),j[Z+1]=qi(w,I,R),j[Z+2]=ki(w,I)}function nr(w,I,R,j,Z){j[Z+0]=ki(w,I),j[Z+1]=qi(w,I,R),j[Z+2]=rr(w,R)}function Gn(w,I,R,j,Z){var W=qi(w,I,R);I=W<<3&224|ki(w,I)>>3,j[Z+0]=248&rr(w,R)|W>>5,j[Z+1]=I}function Br(w,I,R,j,Z){var W=240&ki(w,I)|15;j[Z+0]=240&rr(w,R)|qi(w,I,R)>>4,j[Z+1]=W}function Lr(w,I,R,j,Z){j[Z+0]=255,jr(w,I,R,j,Z+1)}function Un(w,I,R,j,Z){nr(w,I,R,j,Z),j[Z+3]=255}function $s(w,I,R,j,Z){jr(w,I,R,j,Z),j[Z+3]=255}function to(w,I){return 0>w?0:w>I?I:w}function Lo(w,I,R){Ue[w]=function(j,Z,W,Y,ie,ae,fe,pe,xe){for(var Fe=pe+(-2&xe)*R;pe!=Fe;)I(j[Z+0],W[Y+0],ie[ae+0],fe,pe),I(j[Z+1],W[Y+0],ie[ae+0],fe,pe+R),Z+=2,++Y,++ae,pe+=2*R;1&xe&&I(j[Z+0],W[Y+0],ie[ae+0],fe,pe)}}function Ta(w,I,R){return R==0?w==0?I==0?6:5:I==0?4:0:R}function fa(w,I,R,j,Z){switch(w>>>30){case 3:ro(I,R,j,Z,0);break;case 2:po(I,R,j,Z);break;case 1:no(I,R,j,Z)}}function Gl(w,I){var R,j,Z=I.M,W=I.Nb,Y=w.oc,ie=w.pc+40,ae=w.oc,fe=w.pc+584,pe=w.oc,xe=w.pc+600;for(R=0;16>R;++R)Y[ie+32*R-1]=129;for(R=0;8>R;++R)ae[fe+32*R-1]=129,pe[xe+32*R-1]=129;for(0<Z?Y[ie-1-32]=ae[fe-1-32]=pe[xe-1-32]=129:(n(Y,ie-32-1,127,21),n(ae,fe-32-1,127,9),n(pe,xe-32-1,127,9)),j=0;j<w.za;++j){var Fe=I.ya[I.aa+j];if(0<j){for(R=-1;16>R;++R)r(Y,ie+32*R-4,Y,ie+32*R+12,4);for(R=-1;8>R;++R)r(ae,fe+32*R-4,ae,fe+32*R+4,4),r(pe,xe+32*R-4,pe,xe+32*R+4,4)}var Le=w.Gd,nt=w.Hd+j,Ke=Fe.ad,Re=Fe.Hc;if(0<Z&&(r(Y,ie-32,Le[nt].y,0,16),r(ae,fe-32,Le[nt].f,0,8),r(pe,xe-32,Le[nt].ea,0,8)),Fe.Za){var Qe=Y,pt=ie-32+16;for(0<Z&&(j>=w.za-1?n(Qe,pt,Le[nt].y[15],4):r(Qe,pt,Le[nt+1].y,0,4)),R=0;4>R;R++)Qe[pt+128+R]=Qe[pt+256+R]=Qe[pt+384+R]=Qe[pt+0+R];for(R=0;16>R;++R,Re<<=2)Qe=Y,pt=ie+B[R],tn[Fe.Ob[R]](Qe,pt),fa(Re,Ke,16*+R,Qe,pt)}else if(Qe=Ta(j,Z,Fe.Ob[0]),Rs[Qe](Y,ie),Re!=0)for(R=0;16>R;++R,Re<<=2)fa(Re,Ke,16*+R,Y,ie+B[R]);for(R=Fe.Gc,Qe=Ta(j,Z,Fe.Dd),Yo[Qe](ae,fe),Yo[Qe](pe,xe),Re=Ke,Qe=ae,pt=fe,255&(Fe=R>>0)&&(170&Fe?ys(Re,256,Qe,pt):Ma(Re,256,Qe,pt)),Fe=pe,Re=xe,255&(R>>=8)&&(170&R?ys(Ke,320,Fe,Re):Ma(Ke,320,Fe,Re)),Z<w.Ub-1&&(r(Le[nt].y,0,Y,ie+480,16),r(Le[nt].f,0,ae,fe+224,8),r(Le[nt].ea,0,pe,xe+224,8)),R=8*W*w.B,Le=w.sa,nt=w.ta+16*j+16*W*w.R,Ke=w.qa,Fe=w.ra+8*j+R,Re=w.Ha,Qe=w.Ia+8*j+R,R=0;16>R;++R)r(Le,nt+R*w.R,Y,ie+32*R,16);for(R=0;8>R;++R)r(Ke,Fe+R*w.B,ae,fe+32*R,8),r(Re,Qe+R*w.B,pe,xe+32*R,8)}}function hl(w,I,R,j,Z,W,Y,ie,ae){var fe=[0],pe=[0],xe=0,Fe=ae!=null?ae.kd:0,Le=ae??new Ya;if(w==null||12>R)return 7;Le.data=w,Le.w=I,Le.ha=R,I=[I],R=[R],Le.gb=[Le.gb];e:{var nt=I,Ke=R,Re=Le.gb;if(e(w!=null),e(Ke!=null),e(Re!=null),Re[0]=0,12<=Ke[0]&&!t(w,nt[0],"RIFF")){if(t(w,nt[0]+8,"WEBP")){Re=3;break e}var Qe=mi(w,nt[0]+4);if(12>Qe||4294967286<Qe){Re=3;break e}if(Fe&&Qe>Ke[0]-8){Re=7;break e}Re[0]=Qe,nt[0]+=12,Ke[0]-=12}Re=0}if(Re!=0)return Re;for(Qe=0<Le.gb[0],R=R[0];;){e:{var pt=w;Ke=I,Re=R;var bt=fe,ht=pe,Rt=nt=[0];if((Vt=xe=[xe])[0]=0,8>Re[0])Re=7;else{if(!t(pt,Ke[0],"VP8X")){if(mi(pt,Ke[0]+4)!=10){Re=3;break e}if(18>Re[0]){Re=7;break e}var Dt=mi(pt,Ke[0]+8),hi=1+gi(pt,Ke[0]+12);if(2147483648<=hi*(pt=1+gi(pt,Ke[0]+15))){Re=3;break e}Rt!=null&&(Rt[0]=Dt),bt!=null&&(bt[0]=hi),ht!=null&&(ht[0]=pt),Ke[0]+=18,Re[0]-=18,Vt[0]=1}Re=0}}if(xe=xe[0],nt=nt[0],Re!=0)return Re;if(Ke=!!(2&nt),!Qe&&xe)return 3;if(W!=null&&(W[0]=!!(16&nt)),Y!=null&&(Y[0]=Ke),ie!=null&&(ie[0]=0),Y=fe[0],nt=pe[0],xe&&Ke&&ae==null){Re=0;break}if(4>R){Re=7;break}if(Qe&&xe||!Qe&&!xe&&!t(w,I[0],"ALPH")){R=[R],Le.na=[Le.na],Le.P=[Le.P],Le.Sa=[Le.Sa];e:{Dt=w,Re=I,Qe=R;var Vt=Le.gb;bt=Le.na,ht=Le.P,Rt=Le.Sa,hi=22,e(Dt!=null),e(Qe!=null),pt=Re[0];var _i=Qe[0];for(e(bt!=null),e(Rt!=null),bt[0]=null,ht[0]=null,Rt[0]=0;;){if(Re[0]=pt,Qe[0]=_i,8>_i){Re=7;break e}var Si=mi(Dt,pt+4);if(4294967286<Si){Re=3;break e}var Yi=8+Si+1&-2;if(hi+=Yi,0<Vt&&hi>Vt){Re=3;break e}if(!t(Dt,pt,"VP8 ")||!t(Dt,pt,"VP8L")){Re=0;break e}if(_i[0]<Yi){Re=7;break e}t(Dt,pt,"ALPH")||(bt[0]=Dt,ht[0]=pt+8,Rt[0]=Si),pt+=Yi,_i-=Yi}}if(R=R[0],Le.na=Le.na[0],Le.P=Le.P[0],Le.Sa=Le.Sa[0],Re!=0)break}R=[R],Le.Ja=[Le.Ja],Le.xa=[Le.xa];e:if(Vt=w,Re=I,Qe=R,bt=Le.gb[0],ht=Le.Ja,Rt=Le.xa,Dt=Re[0],pt=!t(Vt,Dt,"VP8 "),hi=!t(Vt,Dt,"VP8L"),e(Vt!=null),e(Qe!=null),e(ht!=null),e(Rt!=null),8>Qe[0])Re=7;else{if(pt||hi){if(Vt=mi(Vt,Dt+4),12<=bt&&Vt>bt-12){Re=3;break e}if(Fe&&Vt>Qe[0]-8){Re=7;break e}ht[0]=Vt,Re[0]+=8,Qe[0]-=8,Rt[0]=hi}else Rt[0]=5<=Qe[0]&&Vt[Dt+0]==47&&!(Vt[Dt+4]>>5),ht[0]=Qe[0];Re=0}if(R=R[0],Le.Ja=Le.Ja[0],Le.xa=Le.xa[0],I=I[0],Re!=0)break;if(4294967286<Le.Ja)return 3;if(ie==null||Ke||(ie[0]=Le.xa?2:1),Y=[Y],nt=[nt],Le.xa){if(5>R){Re=7;break}ie=Y,Fe=nt,Ke=W,w==null||5>R?w=0:5<=R&&w[I+0]==47&&!(w[I+4]>>5)?(Qe=[0],Vt=[0],bt=[0],_t(ht=new Se,w,I,R),be(ht,Qe,Vt,bt)?(ie!=null&&(ie[0]=Qe[0]),Fe!=null&&(Fe[0]=Vt[0]),Ke!=null&&(Ke[0]=bt[0]),w=1):w=0):w=0}else{if(10>R){Re=7;break}ie=nt,w==null||10>R||!Ys(w,I+3,R-3)?w=0:(Fe=w[I+0]|w[I+1]<<8|w[I+2]<<16,Ke=16383&(w[I+7]<<8|w[I+6]),w=16383&(w[I+9]<<8|w[I+8]),1&Fe||3<(Fe>>1&7)||!(Fe>>4&1)||Fe>>5>=Le.Ja||!Ke||!w?w=0:(Y&&(Y[0]=Ke),ie&&(ie[0]=w),w=1))}if(!w||(Y=Y[0],nt=nt[0],xe&&(fe[0]!=Y||pe[0]!=nt)))return 3;ae!=null&&(ae[0]=Le,ae.offset=I-ae.w,e(4294967286>I-ae.w),e(ae.offset==ae.ha-R));break}return Re==0||Re==7&&xe&&ae==null?(W!=null&&(W[0]|=Le.na!=null&&0<Le.na.length),j!=null&&(j[0]=Y),Z!=null&&(Z[0]=nt),0):Re}function jl(w,I,R){var j=I.width,Z=I.height,W=0,Y=0,ie=j,ae=Z;if(I.Da=w!=null&&0<w.Da,I.Da&&(ie=w.cd,ae=w.bd,W=w.v,Y=w.j,11>R||(W&=-2,Y&=-2),0>W||0>Y||0>=ie||0>=ae||W+ie>j||Y+ae>Z))return 0;if(I.v=W,I.j=Y,I.va=W+ie,I.o=Y+ae,I.U=ie,I.T=ae,I.da=w!=null&&0<w.da,I.da){if(!xt(ie,ae,R=[w.ib],W=[w.hb]))return 0;I.ib=R[0],I.hb=W[0]}return I.ob=w!=null&&w.ob,I.Kb=w==null||!w.Sd,I.da&&(I.ob=I.ib<3*j/4&&I.hb<3*Z/4,I.Kb=0),1}function pc(w){if(w==null)return 2;if(11>w.S){var I=w.f.RGBA;I.fb+=(w.height-1)*I.A,I.A=-I.A}else I=w.f.kb,w=w.height,I.O+=(w-1)*I.fa,I.fa=-I.fa,I.N+=(w-1>>1)*I.Ab,I.Ab=-I.Ab,I.W+=(w-1>>1)*I.Db,I.Db=-I.Db,I.F!=null&&(I.J+=(w-1)*I.lb,I.lb=-I.lb);return 0}function pa(w,I,R,j){if(j==null||0>=w||0>=I)return 2;if(R!=null){if(R.Da){var Z=R.cd,W=R.bd,Y=-2&R.v,ie=-2&R.j;if(0>Y||0>ie||0>=Z||0>=W||Y+Z>w||ie+W>I)return 2;w=Z,I=W}if(R.da){if(!xt(w,I,Z=[R.ib],W=[R.hb]))return 2;w=Z[0],I=W[0]}}j.width=w,j.height=I;e:{var ae=j.width,fe=j.height;if(w=j.S,0>=ae||0>=fe||!(w>=Rc&&13>w))w=2;else{if(0>=j.Rd&&j.sd==null){Y=W=Z=I=0;var pe=(ie=ae*q[w])*fe;if(11>w||(W=(fe+1)/2*(I=(ae+1)/2),w==12&&(Y=(Z=ae)*fe)),(fe=o(pe+2*W+Y))==null){w=1;break e}j.sd=fe,11>w?((ae=j.f.RGBA).eb=fe,ae.fb=0,ae.A=ie,ae.size=pe):((ae=j.f.kb).y=fe,ae.O=0,ae.fa=ie,ae.Fd=pe,ae.f=fe,ae.N=0+pe,ae.Ab=I,ae.Cd=W,ae.ea=fe,ae.W=0+pe+W,ae.Db=I,ae.Ed=W,w==12&&(ae.F=fe,ae.J=0+pe+2*W),ae.Tc=Y,ae.lb=Z)}if(I=1,Z=j.S,W=j.width,Y=j.height,Z>=Rc&&13>Z)if(11>Z)w=j.f.RGBA,I&=(ie=Math.abs(w.A))*(Y-1)+W<=w.size,I&=ie>=W*q[Z],I&=w.eb!=null;else{w=j.f.kb,ie=(W+1)/2,pe=(Y+1)/2,ae=Math.abs(w.fa),fe=Math.abs(w.Ab);var xe=Math.abs(w.Db),Fe=Math.abs(w.lb),Le=Fe*(Y-1)+W;I&=ae*(Y-1)+W<=w.Fd,I&=fe*(pe-1)+ie<=w.Cd,I=(I&=xe*(pe-1)+ie<=w.Ed)&ae>=W&fe>=ie&xe>=ie,I&=w.y!=null,I&=w.f!=null,I&=w.ea!=null,Z==12&&(I&=Fe>=W,I&=Le<=w.Tc,I&=w.F!=null)}else I=0;w=I?0:2}}return w!=0||R!=null&&R.fd&&(w=pc(j)),w}var Fs=64,Al=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],ql=24,Ia=32,La=8,Ds=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];ut("Predictor0","PredictorAdd0"),Ue.Predictor0=function(){return 4278190080},Ue.Predictor1=function(w){return w},Ue.Predictor2=function(w,I,R){return I[R+0]},Ue.Predictor3=function(w,I,R){return I[R+1]},Ue.Predictor4=function(w,I,R){return I[R-1]},Ue.Predictor5=function(w,I,R){return ni(ni(w,I[R+1]),I[R+0])},Ue.Predictor6=function(w,I,R){return ni(w,I[R-1])},Ue.Predictor7=function(w,I,R){return ni(w,I[R+0])},Ue.Predictor8=function(w,I,R){return ni(I[R-1],I[R+0])},Ue.Predictor9=function(w,I,R){return ni(I[R+0],I[R+1])},Ue.Predictor10=function(w,I,R){return ni(ni(w,I[R-1]),ni(I[R+0],I[R+1]))},Ue.Predictor11=function(w,I,R){var j=I[R+0];return 0>=Ki(j>>24&255,w>>24&255,(I=I[R-1])>>24&255)+Ki(j>>16&255,w>>16&255,I>>16&255)+Ki(j>>8&255,w>>8&255,I>>8&255)+Ki(255&j,255&w,255&I)?j:w},Ue.Predictor12=function(w,I,R){var j=I[R+0];return(di((w>>24&255)+(j>>24&255)-((I=I[R-1])>>24&255))<<24|di((w>>16&255)+(j>>16&255)-(I>>16&255))<<16|di((w>>8&255)+(j>>8&255)-(I>>8&255))<<8|di((255&w)+(255&j)-(255&I)))>>>0},Ue.Predictor13=function(w,I,R){var j=I[R-1];return(li((w=ni(w,I[R+0]))>>24&255,j>>24&255)<<24|li(w>>16&255,j>>16&255)<<16|li(w>>8&255,j>>8&255)<<8|li(w>>0&255,j>>0&255))>>>0};var ku=Ue.PredictorAdd0;Ue.PredictorAdd1=tr,ut("Predictor2","PredictorAdd2"),ut("Predictor3","PredictorAdd3"),ut("Predictor4","PredictorAdd4"),ut("Predictor5","PredictorAdd5"),ut("Predictor6","PredictorAdd6"),ut("Predictor7","PredictorAdd7"),ut("Predictor8","PredictorAdd8"),ut("Predictor9","PredictorAdd9"),ut("Predictor10","PredictorAdd10"),ut("Predictor11","PredictorAdd11"),ut("Predictor12","PredictorAdd12"),ut("Predictor13","PredictorAdd13");var Sn=Ue.PredictorAdd2;Ji("ColorIndexInverseTransform","MapARGB","32b",function(w){return w>>8&255},function(w){return w}),Ji("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(w){return w},function(w){return w>>8&255});var on,fn=Ue.ColorIndexInverseTransform,es=Ue.MapARGB,dl=Ue.VP8LColorIndexInverseTransformAlpha,fl=Ue.MapAlpha,fo=Ue.VP8LPredictorsAdd=[];fo.length=16,(Ue.VP8LPredictors=[]).length=16,(Ue.VP8LPredictorsAdd_C=[]).length=16,(Ue.VP8LPredictors_C=[]).length=16;var ss,os,Mo,Po,ga,pl,io,ro,po,ys,no,Ma,ma,Pa,Tn,Fo,As,_s,ds,Ir,Zr,an,jn,ya,Fa,go,Zo,Oi,Jo=o(511),Pi=o(2041),gl=o(225),$l=o(767),Li=0,Kl=Pi,Ei=gl,so=$l,mo=Jo,Rc=0,Wl=1,kc=2,Oc=3,Uc=4,Nc=5,il=6,yn=7,Cs=8,Do=9,Xl=10,Ou=[2,3,7],gc=[3,3,11],uu=[280,256,256,256,40],_a=[0,1,1,1,0],Ks=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],bi=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],sr=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],Zl=8,zc=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Qc=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Es=null,bh=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],qn=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],hu=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],$i=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Ni=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],$n=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Uu=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Rs=[],tn=[],Yo=[],Ro=1,Au=2,ks=[],Jr=[];Tt("UpsampleRgbLinePair",jr,3),Tt("UpsampleBgrLinePair",nr,3),Tt("UpsampleRgbaLinePair",$s,4),Tt("UpsampleBgraLinePair",Un,4),Tt("UpsampleArgbLinePair",Lr,4),Tt("UpsampleRgba4444LinePair",Br,2),Tt("UpsampleRgb565LinePair",Gn,2);var Nn=Ue.UpsampleRgbLinePair,ko=Ue.UpsampleBgrLinePair,ml=Ue.UpsampleRgbaLinePair,rl=Ue.UpsampleBgraLinePair,Da=Ue.UpsampleArgbLinePair,Jl=Ue.UpsampleRgba4444LinePair,du=Ue.UpsampleRgb565LinePair,yo=16,va=1<<yo-1,yl=-227,Gr=482,N=6,A=(256<<N)-1,x=0,L=o(256),O=o(256),y=o(256),a=o(256),d=o(Gr-yl),_=o(Gr-yl);Lo("YuvToRgbRow",jr,3),Lo("YuvToBgrRow",nr,3),Lo("YuvToRgbaRow",$s,4),Lo("YuvToBgraRow",Un,4),Lo("YuvToArgbRow",Lr,4),Lo("YuvToRgba4444Row",Br,2),Lo("YuvToRgb565Row",Gn,2);var B=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],S=[0,2,8],U=[8,7,6,4,4,2,2,2,1,1,1,1],H=1;this.WebPDecodeRGBA=function(w,I,R,j,Z){var W=Wl,Y=new Ql,ie=new Sr;Y.ba=ie,ie.S=W,ie.width=[ie.width],ie.height=[ie.height];var ae=ie.width,fe=ie.height,pe=new ze;if(pe==null||w==null)var xe=2;else e(pe!=null),xe=hl(w,I,R,pe.width,pe.height,pe.Pd,pe.Qd,pe.format,null);if(xe!=0?ae=0:(ae!=null&&(ae[0]=pe.width[0]),fe!=null&&(fe[0]=pe.height[0]),ae=1),ae){ie.width=ie.width[0],ie.height=ie.height[0],j!=null&&(j[0]=ie.width),Z!=null&&(Z[0]=ie.height);e:{if(j=new So,(Z=new Ya).data=w,Z.w=I,Z.ha=R,Z.kd=1,I=[0],e(Z!=null),((w=hl(Z.data,Z.w,Z.ha,null,null,null,I,null,Z))==0||w==7)&&I[0]&&(w=4),(I=w)==0){if(e(Y!=null),j.data=Z.data,j.w=Z.w+Z.offset,j.ha=Z.ha-Z.offset,j.put=ve,j.ac=ge,j.bc=Ce,j.ma=Y,Z.xa){if((w=wi())==null){Y=1;break e}if(function(Fe,Le){var nt=[0],Ke=[0],Re=[0];t:for(;;){if(Fe==null)return 0;if(Le==null)return Fe.a=2,0;if(Fe.l=Le,Fe.a=0,_t(Fe.m,Le.data,Le.w,Le.ha),!be(Fe.m,nt,Ke,Re)){Fe.a=3;break t}if(Fe.xb=Au,Le.width=nt[0],Le.height=Ke[0],!Ui(nt[0],Ke[0],1,Fe,null))break t;return 1}return e(Fe.a!=0),0}(w,j)){if(j=(I=pa(j.width,j.height,Y.Oa,Y.ba))==0){t:{j=w;i:for(;;){if(j==null){j=0;break t}if(e(j.s.yc!=null),e(j.s.Ya!=null),e(0<j.s.Wb),e((R=j.l)!=null),e((Z=R.ma)!=null),j.xb!=0){if(j.ca=Z.ba,j.tb=Z.tb,e(j.ca!=null),!jl(Z.Oa,R,Oc)){j.a=2;break i}if(!st(j,R.width)||R.da)break i;if((R.da||vi(j.ca.S))&&vt(),11>j.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),j.ca.f.kb.F!=null&&vt()),j.Pb&&0<j.s.ua&&j.s.vb.X==null&&!Mi(j.s.vb,j.s.Wa.Xa)){j.a=1;break i}j.xb=0}if(!Ci(j,j.V,j.Ba,j.c,j.i,R.o,Yt))break i;Z.Dc=j.Ma,j=1;break t}e(j.a!=0),j=0}j=!j}j&&(I=w.a)}else I=w.a}else{if((w=new us)==null){Y=1;break e}if(w.Fa=Z.na,w.P=Z.P,w.qc=Z.Sa,Bs(w,j)){if((I=pa(j.width,j.height,Y.Oa,Y.ba))==0){if(w.Aa=0,R=Y.Oa,e((Z=w)!=null),R!=null){if(0<(ae=0>(ae=R.Md)?0:100<ae?255:255*ae/100)){for(fe=pe=0;4>fe;++fe)12>(xe=Z.pb[fe]).lc&&(xe.ia=ae*U[0>xe.lc?0:xe.lc]>>3),pe|=xe.ia;pe&&(alert("todo:VP8InitRandom"),Z.ia=1)}Z.Ga=R.Id,100<Z.Ga?Z.Ga=100:0>Z.Ga&&(Z.Ga=0)}Hn(w,j)||(I=w.a)}}else I=w.a}I==0&&Y.Oa!=null&&Y.Oa.fd&&(I=pc(Y.ba))}Y=I}W=Y!=0?null:11>W?ie.f.RGBA.eb:ie.f.kb.y}else W=null;return W};var q=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function b(Ue,ot){for(var it="",De=0;De<4;De++)it+=String.fromCharCode(Ue[ot++]);return it}function T(Ue,ot){return(Ue[ot+0]<<0|Ue[ot+1]<<8|Ue[ot+2]<<16)>>>0}function F(Ue,ot){return(Ue[ot+0]<<0|Ue[ot+1]<<8|Ue[ot+2]<<16|Ue[ot+3]<<24)>>>0}new g;var k=[0],z=[0],J=[],te=new g,ue=i,ce=function(Ue,ot){var it={},De=0,Me=!1,Ze=0,We=0;if(it.frames=[],!function(Xe,et,At,ft){for(var wt=0;wt<ft;wt++)if(Xe[et+wt]!=At.charCodeAt(wt))return!0;return!1}(Ue,ot,"RIFF",4)){var Bt,Ct;for(F(Ue,ot+=4),ot+=8;ot<Ue.length;){var Lt=b(Ue,ot),_t=F(Ue,ot+=4);ot+=4;var Ft=_t+(1&_t);switch(Lt){case"VP8 ":case"VP8L":it.frames[De]===void 0&&(it.frames[De]={}),(Se=it.frames[De]).src_off=Me?We:ot-8,Se.src_size=Ze+_t+8,De++,Me&&(Me=!1,Ze=0,We=0);break;case"VP8X":(Se=it.header={}).feature_flags=Ue[ot];var Mt=ot+4;Se.canvas_width=1+T(Ue,Mt),Mt+=3,Se.canvas_height=1+T(Ue,Mt),Mt+=3;break;case"ALPH":Me=!0,Ze=Ft+8,We=ot-8;break;case"ANIM":(Se=it.header).bgcolor=F(Ue,ot),Mt=ot+4,Se.loop_count=(Bt=Ue)[(Ct=Mt)+0]<<0|Bt[Ct+1]<<8,Mt+=2;break;case"ANMF":var Wt,Se;(Se=it.frames[De]={}).offset_x=2*T(Ue,ot),ot+=3,Se.offset_y=2*T(Ue,ot),ot+=3,Se.width=1+T(Ue,ot),ot+=3,Se.height=1+T(Ue,ot),ot+=3,Se.duration=T(Ue,ot),ot+=3,Wt=Ue[ot++],Se.dispose=1&Wt,Se.blend=Wt>>1&1}Lt!="ANMF"&&(ot+=Ft)}return it}}(ue,0);ce.response=ue,ce.rgbaoutput=!0,ce.dataurl=!1;var de=ce.header?ce.header:null,_e=ce.frames?ce.frames:null;if(de){de.loop_counter=de.loop_count,k=[de.canvas_height],z=[de.canvas_width];for(var Ee=0;Ee<_e.length&&_e[Ee].blend!=0;Ee++);}var He=_e[0],Ve=te.WebPDecodeRGBA(ue,He.src_off,He.src_size,z,k);He.rgba=Ve,He.imgwidth=z[0],He.imgheight=k[0];for(var qe=0;qe<z[0]*k[0]*4;qe++)J[qe]=Ve[qe];return this.width=z,this.height=k,this.data=J,this}(function(i){var e=function(){return typeof vC=="function"},t=function(k,z,J,te){var ue=4,ce=l;switch(te){case i.image_compression.FAST:ue=1,ce=o;break;case i.image_compression.MEDIUM:ue=6,ce=s;break;case i.image_compression.SLOW:ue=9,ce=g}k=r(k,z,J,ce);var de=vC(k,{level:ue});return i.__addimage__.arrayBufferToBinaryString(de)},r=function(k,z,J,te){for(var ue,ce,de,_e=k.length/z,Ee=new Uint8Array(k.length+_e),He=T(),Ve=0;Ve<_e;Ve+=1){if(de=Ve*z,ue=k.subarray(de,de+z),te)Ee.set(te(ue,J,ce),de+Ve);else{for(var qe,Ue=He.length,ot=[];qe<Ue;qe+=1)ot[qe]=He[qe](ue,J,ce);var it=F(ot.concat());Ee.set(ot[it],de+Ve)}ce=ue}return Ee},n=function(k){var z=Array.apply([],k);return z.unshift(0),z},o=function(k,z){var J,te=[],ue=k.length;te[0]=1;for(var ce=0;ce<ue;ce+=1)J=k[ce-z]||0,te[ce+1]=k[ce]-J+256&255;return te},l=function(k,z,J){var te,ue=[],ce=k.length;ue[0]=2;for(var de=0;de<ce;de+=1)te=J&&J[de]||0,ue[de+1]=k[de]-te+256&255;return ue},s=function(k,z,J){var te,ue,ce=[],de=k.length;ce[0]=3;for(var _e=0;_e<de;_e+=1)te=k[_e-z]||0,ue=J&&J[_e]||0,ce[_e+1]=k[_e]+256-(te+ue>>>1)&255;return ce},g=function(k,z,J){var te,ue,ce,de,_e=[],Ee=k.length;_e[0]=4;for(var He=0;He<Ee;He+=1)te=k[He-z]||0,ue=J&&J[He]||0,ce=J&&J[He-z]||0,de=b(te,ue,ce),_e[He+1]=k[He]-de+256&255;return _e},b=function(k,z,J){if(k===z&&z===J)return k;var te=Math.abs(z-J),ue=Math.abs(k-J),ce=Math.abs(k+z-J-J);return te<=ue&&te<=ce?k:ue<=ce?z:J},T=function(){return[n,o,l,s,g]},F=function(k){var z=k.map(function(J){return J.reduce(function(te,ue){return te+Math.abs(ue)},0)});return z.indexOf(Math.min.apply(null,z))};i.processPNG=function(k,z,J,te){var ue,ce,de,_e,Ee,He,Ve,qe,Ue,ot,it,De,Me,Ze,We,Bt=this.decode.FLATE_DECODE,Ct="";if(this.__addimage__.isArrayBuffer(k)&&(k=new Uint8Array(k)),this.__addimage__.isArrayBufferView(k)){if(k=(de=new ore(k)).imgData,ce=de.bits,ue=de.colorSpace,Ee=de.colors,[4,6].indexOf(de.colorType)!==-1){if(de.bits===8){Ue=(qe=de.pixelBitlength==32?new Uint32Array(de.decodePixels().buffer):de.pixelBitlength==16?new Uint16Array(de.decodePixels().buffer):new Uint8Array(de.decodePixels().buffer)).length,it=new Uint8Array(Ue*de.colors),ot=new Uint8Array(Ue);var Lt,_t=de.pixelBitlength-de.bits;for(Ze=0,We=0;Ze<Ue;Ze++){for(Me=qe[Ze],Lt=0;Lt<_t;)it[We++]=Me>>>Lt&255,Lt+=de.bits;ot[Ze]=Me>>>Lt&255}}if(de.bits===16){Ue=(qe=new Uint32Array(de.decodePixels().buffer)).length,it=new Uint8Array(Ue*(32/de.pixelBitlength)*de.colors),ot=new Uint8Array(Ue*(32/de.pixelBitlength)),De=de.colors>1,Ze=0,We=0;for(var Ft=0;Ze<Ue;)Me=qe[Ze++],it[We++]=Me>>>0&255,De&&(it[We++]=Me>>>16&255,Me=qe[Ze++],it[We++]=Me>>>0&255),ot[Ft++]=Me>>>16&255;ce=8}te!==i.image_compression.NONE&&e()?(k=t(it,de.width*de.colors,de.colors,te),Ve=t(ot,de.width,1,te)):(k=it,Ve=ot,Bt=void 0)}if(de.colorType===3&&(ue=this.color_spaces.INDEXED,He=de.palette,de.transparency.indexed)){var Mt=de.transparency.indexed,Wt=0;for(Ze=0,Ue=Mt.length;Ze<Ue;++Ze)Wt+=Mt[Ze];if((Wt/=255)===Ue-1&&Mt.indexOf(0)!==-1)_e=[Mt.indexOf(0)];else if(Wt!==Ue){for(qe=de.decodePixels(),ot=new Uint8Array(qe.length),Ze=0,Ue=qe.length;Ze<Ue;Ze++)ot[Ze]=Mt[qe[Ze]];Ve=t(ot,de.width,1)}}var Se=function(Xe){var et;switch(Xe){case i.image_compression.FAST:et=11;break;case i.image_compression.MEDIUM:et=13;break;case i.image_compression.SLOW:et=14;break;default:et=12}return et}(te);return Bt===this.decode.FLATE_DECODE&&(Ct="/Predictor "+Se+" "),Ct+="/Colors "+Ee+" /BitsPerComponent "+ce+" /Columns "+de.width,(this.__addimage__.isArrayBuffer(k)||this.__addimage__.isArrayBufferView(k))&&(k=this.__addimage__.arrayBufferToBinaryString(k)),(Ve&&this.__addimage__.isArrayBuffer(Ve)||this.__addimage__.isArrayBufferView(Ve))&&(Ve=this.__addimage__.arrayBufferToBinaryString(Ve)),{alias:J,data:k,index:z,filter:Bt,decodeParameters:Ct,transparency:_e,palette:He,sMask:Ve,predictor:Se,width:de.width,height:de.height,bitsPerComponent:ce,colorSpace:ue}}}})(kr.API),function(i){i.processGIF89A=function(e,t,r,n){var o=new are(e),l=o.width,s=o.height,g=[];o.decodeAndBlitFrameRGBA(0,g);var b={data:g,width:l,height:s},T=new PC(100).encode(b,100);return i.processJPEG.call(this,T,t,r,n)},i.processGIF87A=i.processGIF89A}(kr.API),ch.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var i=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(i);for(var e=0;e<i;e++){var t=this.datav.getUint8(this.pos++,!0),r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:n,green:r,blue:t,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},ch.prototype.parseBGR=function(){this.pos=this.offset;try{var i="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[i]()}catch(t){Ps.log("bit decode error:"+t)}},ch.prototype.bit1=function(){var i,e=Math.ceil(this.width/8),t=e%4;for(i=this.height-1;i>=0;i--){for(var r=this.bottom_up?i:this.height-1-i,n=0;n<e;n++)for(var o=this.datav.getUint8(this.pos++,!0),l=r*this.width*4+8*n*4,s=0;s<8&&8*n+s<this.width;s++){var g=this.palette[o>>7-s&1];this.data[l+4*s]=g.blue,this.data[l+4*s+1]=g.green,this.data[l+4*s+2]=g.red,this.data[l+4*s+3]=255}t!==0&&(this.pos+=4-t)}},ch.prototype.bit4=function(){for(var i=Math.ceil(this.width/2),e=i%4,t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<i;n++){var o=this.datav.getUint8(this.pos++,!0),l=r*this.width*4+2*n*4,s=o>>4,g=15&o,b=this.palette[s];if(this.data[l]=b.blue,this.data[l+1]=b.green,this.data[l+2]=b.red,this.data[l+3]=255,2*n+1>=this.width)break;b=this.palette[g],this.data[l+4]=b.blue,this.data[l+4+1]=b.green,this.data[l+4+2]=b.red,this.data[l+4+3]=255}e!==0&&(this.pos+=4-e)}},ch.prototype.bit8=function(){for(var i=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,r=0;r<this.width;r++){var n=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*r;if(n<this.palette.length){var l=this.palette[n];this.data[o]=l.red,this.data[o+1]=l.green,this.data[o+2]=l.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}i!==0&&(this.pos+=4-i)}},ch.prototype.bit15=function(){for(var i=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(o&e)/e*255|0,s=(o>>5&e)/e*255|0,g=(o>>10&e)/e*255|0,b=o>>15?255:0,T=r*this.width*4+4*n;this.data[T]=g,this.data[T+1]=s,this.data[T+2]=l,this.data[T+3]=b}this.pos+=i}},ch.prototype.bit16=function(){for(var i=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,o=0;o<this.width;o++){var l=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(l&e)/e*255|0,g=(l>>5&t)/t*255|0,b=(l>>11)/e*255|0,T=n*this.width*4+4*o;this.data[T]=b,this.data[T+1]=g,this.data[T+2]=s,this.data[T+3]=255}this.pos+=i}},ch.prototype.bit24=function(){for(var i=this.height-1;i>=0;i--){for(var e=this.bottom_up?i:this.height-1-i,t=0;t<this.width;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),l=e*this.width*4+4*t;this.data[l]=o,this.data[l+1]=n,this.data[l+2]=r,this.data[l+3]=255}this.pos+=this.width%4}},ch.prototype.bit32=function(){for(var i=this.height-1;i>=0;i--)for(var e=this.bottom_up?i:this.height-1-i,t=0;t<this.width;t++){var r=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),l=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*t;this.data[s]=o,this.data[s+1]=n,this.data[s+2]=r,this.data[s+3]=l}},ch.prototype.getData=function(){return this.data},function(i){i.processBMP=function(e,t,r,n){var o=new ch(e,!1),l=o.width,s=o.height,g={data:o.getData(),width:l,height:s},b=new PC(100).encode(g,100);return i.processJPEG.call(this,b,t,r,n)}}(kr.API),G4.prototype.getData=function(){return this.data},function(i){i.processWEBP=function(e,t,r,n){var o=new G4(e),l=o.width,s=o.height,g={data:o.getData(),width:l,height:s},b=new PC(100).encode(g,100);return i.processJPEG.call(this,b,t,r,n)}}(kr.API),kr.API.processRGBA=function(i,e,t){for(var r=i.data,n=r.length,o=new Uint8Array(n/4*3),l=new Uint8Array(n/4),s=0,g=0,b=0;b<n;b+=4){var T=r[b],F=r[b+1],k=r[b+2],z=r[b+3];o[s++]=T,o[s++]=F,o[s++]=k,l[g++]=z}var J=this.__addimage__.arrayBufferToBinaryString(o);return{alpha:this.__addimage__.arrayBufferToBinaryString(l),data:J,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:i.width,height:i.height}},kr.API.setLanguage=function(i){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[i]!==void 0&&(this.internal.languageSettings.languageCode=i,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Ig=kr.API,ov=Ig.getCharWidthsArray=function(i,e){var t,r,n=(e=e||{}).font||this.internal.getFont(),o=e.fontSize||this.internal.getFontSize(),l=e.charSpace||this.internal.getCharSpace(),s=e.widths?e.widths:n.metadata.Unicode.widths,g=s.fof?s.fof:1,b=e.kerning?e.kerning:n.metadata.Unicode.kerning,T=b.fof?b.fof:1,F=e.doKerning!==!1,k=0,z=i.length,J=0,te=s[0]||g,ue=[];for(t=0;t<z;t++)r=i.charCodeAt(t),typeof n.metadata.widthOfString=="function"?ue.push((n.metadata.widthOfGlyph(n.metadata.characterToGlyph(r))+l*(1e3/o)||0)/1e3):(k=F&&Jn(b[r])==="object"&&!isNaN(parseInt(b[r][J],10))?b[r][J]/T:0,ue.push((s[r]||te)/g+k)),J=r;return ue},z4=Ig.getStringUnitWidth=function(i,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),r=e.font||this.internal.getFont(),n=e.charSpace||this.internal.getCharSpace();return Ig.processArabic&&(i=Ig.processArabic(i)),typeof r.metadata.widthOfString=="function"?r.metadata.widthOfString(i,t,n)/t:ov.apply(this,arguments).reduce(function(o,l){return o+l},0)},Q4=function(i,e,t,r){for(var n=[],o=0,l=i.length,s=0;o!==l&&s+e[o]<t;)s+=e[o],o++;n.push(i.slice(0,o));var g=o;for(s=0;o!==l;)s+e[o]>r&&(n.push(i.slice(g,o)),s=0,g=o),s+=e[o],o++;return g!==o&&n.push(i.slice(g,o)),n},V4=function(i,e,t){t||(t={});var r,n,o,l,s,g,b,T=[],F=[T],k=t.textIndent||0,z=0,J=0,te=i.split(" "),ue=ov.apply(this,[" ",t])[0];if(g=t.lineIndent===-1?te[0].length+2:t.lineIndent||0){var ce=Array(g).join(" "),de=[];te.map(function(Ee){(Ee=Ee.split(/\s*\n/)).length>1?de=de.concat(Ee.map(function(He,Ve){return(Ve&&He.length?`
`:"")+He})):de.push(Ee[0])}),te=de,g=z4.apply(this,[ce,t])}for(o=0,l=te.length;o<l;o++){var _e=0;if(r=te[o],g&&r[0]==`
`&&(r=r.substr(1),_e=1),k+z+(J=(n=ov.apply(this,[r,t])).reduce(function(Ee,He){return Ee+He},0))>e||_e){if(J>e){for(s=Q4.apply(this,[r,n,e-(k+z),e]),T.push(s.shift()),T=[s.pop()];s.length;)F.push([s.shift()]);J=n.slice(r.length-(T[0]?T[0].length:0)).reduce(function(Ee,He){return Ee+He},0)}else T=[r];F.push(T),k=J+g,z=ue}else T.push(r),k+=z+J,z=ue}return b=g?function(Ee,He){return(He?ce:"")+Ee.join(" ")}:function(Ee){return Ee.join(" ")},F.map(b)},Ig.splitTextToSize=function(i,e,t){var r,n=(t=t||{}).fontSize||this.internal.getFontSize(),o=(function(T){if(T.widths&&T.kerning)return{widths:T.widths,kerning:T.kerning};var F=this.internal.getFont(T.fontName,T.fontStyle);return F.metadata.Unicode?{widths:F.metadata.Unicode.widths||{0:1},kerning:F.metadata.Unicode.kerning||{}}:{font:F.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);r=Array.isArray(i)?i:String(i).split(/\r?\n/);var l=1*this.internal.scaleFactor*e/n;o.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/n:0,o.lineIndent=t.lineIndent;var s,g,b=[];for(s=0,g=r.length;s<g;s++)b=b.concat(V4.apply(this,[r[s],l,o]));return b},function(i){i.__fontmetrics__=i.__fontmetrics__||{};for(var e="klmnopqrstuvwxyz",t={},r={},n=0;n<e.length;n++)t[e[n]]="0123456789abcdef"[n],r["0123456789abcdef"[n]]=e[n];var o=function(F){return"0x"+parseInt(F,10).toString(16)},l=i.__fontmetrics__.compress=function(F){var k,z,J,te,ue=["{"];for(var ce in F){if(k=F[ce],isNaN(parseInt(ce,10))?z="'"+ce+"'":(ce=parseInt(ce,10),z=(z=o(ce).slice(2)).slice(0,-1)+r[z.slice(-1)]),typeof k=="number")k<0?(J=o(k).slice(3),te="-"):(J=o(k).slice(2),te=""),J=te+J.slice(0,-1)+r[J.slice(-1)];else{if(Jn(k)!=="object")throw new Error("Don't know what to do with value type "+Jn(k)+".");J=l(k)}ue.push(z+J)}return ue.push("}"),ue.join("")},s=i.__fontmetrics__.uncompress=function(F){if(typeof F!="string")throw new Error("Invalid argument passed to uncompress.");for(var k,z,J,te,ue={},ce=1,de=ue,_e=[],Ee="",He="",Ve=F.length-1,qe=1;qe<Ve;qe+=1)(te=F[qe])=="'"?k?(J=k.join(""),k=void 0):k=[]:k?k.push(te):te=="{"?(_e.push([de,J]),de={},J=void 0):te=="}"?((z=_e.pop())[0][z[1]]=de,J=void 0,de=z[0]):te=="-"?ce=-1:J===void 0?t.hasOwnProperty(te)?(Ee+=t[te],J=parseInt(Ee,16)*ce,ce=1,Ee=""):Ee+=te:t.hasOwnProperty(te)?(He+=t[te],de[J]=parseInt(He,16)*ce,ce=1,J=void 0,He=""):He+=te;return ue},g={codePages:["WinAnsiEncoding"],WinAnsiEncoding:s("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},b={Unicode:{Courier:g,"Courier-Bold":g,"Courier-BoldOblique":g,"Courier-Oblique":g,Helvetica:g,"Helvetica-Bold":g,"Helvetica-BoldOblique":g,"Helvetica-Oblique":g,"Times-Roman":g,"Times-Bold":g,"Times-BoldItalic":g,"Times-Italic":g}},T={Unicode:{"Courier-Oblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":s("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":s("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:s("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:s("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":s("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":s("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};i.events.push(["addFont",function(F){var k=F.font,z=T.Unicode[k.postScriptName];z&&(k.metadata.Unicode={},k.metadata.Unicode.widths=z.widths,k.metadata.Unicode.kerning=z.kerning);var J=b.Unicode[k.postScriptName];J&&(k.metadata.Unicode.encoding=J,k.encoding=J.codePages[0])}])}(kr.API),function(i){var e=function(t){for(var r=t.length,n=new Uint8Array(r),o=0;o<r;o++)n[o]=t.charCodeAt(o);return n};i.API.events.push(["addFont",function(t){var r=void 0,n=t.font,o=t.instance;if(!n.isStandardFont){if(o===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");if(typeof(r=o.existsFileInVFS(n.postScriptName)===!1?o.loadFile(n.postScriptName):o.getFileFromVFS(n.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");(function(l,s){s=/^\x00\x01\x00\x00/.test(s)?e(s):e(Ny(s)),l.metadata=i.API.TTFFont.open(s),l.metadata.Unicode=l.metadata.Unicode||{encoding:{},kerning:{},widths:[]},l.metadata.glyIdsUsed=[0]})(n,r)}}])}(kr),function(i){function e(){return(Rr.canvg?Promise.resolve(Rr.canvg):Promise.resolve().then(()=>Dve)).catch(function(t){return Promise.reject(new Error("Could not load canvg: "+t))}).then(function(t){return t.default?t.default:t})}kr.API.addSvgAsImage=function(t,r,n,o,l,s,g,b){if(isNaN(r)||isNaN(n))throw Ps.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(o)||isNaN(l))throw Ps.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var T=document.createElement("canvas");T.width=o,T.height=l;var F=T.getContext("2d");F.fillStyle="#fff",F.fillRect(0,0,T.width,T.height);var k={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},z=this;return e().then(function(J){return J.fromString(F,t,k)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(J){return J.render(k)}).then(function(){z.addImage(T.toDataURL("image/jpeg",1),r,n,o,l,g,b)})}}(),kr.API.putTotalPages=function(i){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(i,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(i,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var r=1;r<=this.internal.getNumberOfPages();r++)for(var n=0;n<this.internal.pages[r].length;n++)this.internal.pages[r][n]=this.internal.pages[r][n].replace(e,t);return this},kr.API.viewerPreferences=function(i,e){var t;i=i||{},e=e||!1;var r,n,o,l={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},s=Object.keys(l),g=[],b=0,T=0,F=0;function k(J,te){var ue,ce=!1;for(ue=0;ue<J.length;ue+=1)J[ue]===te&&(ce=!0);return ce}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(l)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,i==="reset"||e===!0){var z=s.length;for(F=0;F<z;F+=1)t[s[F]].value=t[s[F]].defaultValue,t[s[F]].explicitSet=!1}if(Jn(i)==="object"){for(n in i)if(o=i[n],k(s,n)&&o!==void 0){if(t[n].type==="boolean"&&typeof o=="boolean")t[n].value=o;else if(t[n].type==="name"&&k(t[n].valueSet,o))t[n].value=o;else if(t[n].type==="integer"&&Number.isInteger(o))t[n].value=o;else if(t[n].type==="array"){for(b=0;b<o.length;b+=1)if(r=!0,o[b].length===1&&typeof o[b][0]=="number")g.push(String(o[b]-1));else if(o[b].length>1){for(T=0;T<o[b].length;T+=1)typeof o[b][T]!="number"&&(r=!1);r===!0&&g.push([o[b][0]-1,o[b][1]-1].join(" "))}t[n].value="["+g.join(" ")+"]"}else t[n].value=t[n].defaultValue;t[n].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var J,te=[];for(J in t)t[J].explicitSet===!0&&(t[J].type==="name"?te.push("/"+J+" /"+t[J].value):te.push("/"+J+" "+t[J].value));te.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+te.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},function(i){var e=function(){var r='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',n=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),o=unescape(encodeURIComponent(r)),l=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),s=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),g=unescape(encodeURIComponent("</x:xmpmeta>")),b=o.length+l.length+s.length+n.length+g.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+b+" >>"),this.internal.write("stream"),this.internal.write(n+o+l+s+g),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};i.addMetadata=function(r,n){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:r,namespaceuri:n||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}}(kr.API),function(i){var e=i.API,t=e.pdfEscape16=function(o,l){for(var s,g=l.metadata.Unicode.widths,b=["","0","00","000","0000"],T=[""],F=0,k=o.length;F<k;++F){if(s=l.metadata.characterToGlyph(o.charCodeAt(F)),l.metadata.glyIdsUsed.push(s),l.metadata.toUnicode[s]=o.charCodeAt(F),g.indexOf(s)==-1&&(g.push(s),g.push([parseInt(l.metadata.widthOfGlyph(s),10)])),s=="0")return T.join("");s=s.toString(16),T.push(b[4-s.length],s)}return T.join("")},r=function(o){var l,s,g,b,T,F,k;for(T=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,g=[],F=0,k=(s=Object.keys(o).sort(function(z,J){return z-J})).length;F<k;F++)l=s[F],g.length>=100&&(T+=`
`+g.length+` beginbfchar
`+g.join(`
`)+`
endbfchar`,g=[]),o[l]!==void 0&&o[l]!==null&&typeof o[l].toString=="function"&&(b=("0000"+o[l].toString(16)).slice(-4),l=("0000"+(+l).toString(16)).slice(-4),g.push("<"+l+"><"+b+">"));return g.length&&(T+=`
`+g.length+` beginbfchar
`+g.join(`
`)+`
endbfchar
`),T+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(o){(function(l){var s=l.font,g=l.out,b=l.newObject,T=l.putStream;if(s.metadata instanceof i.API.TTFFont&&s.encoding==="Identity-H"){for(var F=s.metadata.Unicode.widths,k=s.metadata.subset.encode(s.metadata.glyIdsUsed,1),z="",J=0;J<k.length;J++)z+=String.fromCharCode(k[J]);var te=b();T({data:z,addLength1:!0,objectId:te}),g("endobj");var ue=b();T({data:r(s.metadata.toUnicode),addLength1:!0,objectId:ue}),g("endobj");var ce=b();g("<<"),g("/Type /FontDescriptor"),g("/FontName /"+xg(s.fontName)),g("/FontFile2 "+te+" 0 R"),g("/FontBBox "+i.API.PDFObject.convert(s.metadata.bbox)),g("/Flags "+s.metadata.flags),g("/StemV "+s.metadata.stemV),g("/ItalicAngle "+s.metadata.italicAngle),g("/Ascent "+s.metadata.ascender),g("/Descent "+s.metadata.decender),g("/CapHeight "+s.metadata.capHeight),g(">>"),g("endobj");var de=b();g("<<"),g("/Type /Font"),g("/BaseFont /"+xg(s.fontName)),g("/FontDescriptor "+ce+" 0 R"),g("/W "+i.API.PDFObject.convert(F)),g("/CIDToGIDMap /Identity"),g("/DW 1000"),g("/Subtype /CIDFontType2"),g("/CIDSystemInfo"),g("<<"),g("/Supplement 0"),g("/Registry (Adobe)"),g("/Ordering ("+s.encoding+")"),g(">>"),g(">>"),g("endobj"),s.objectNumber=b(),g("<<"),g("/Type /Font"),g("/Subtype /Type0"),g("/ToUnicode "+ue+" 0 R"),g("/BaseFont /"+xg(s.fontName)),g("/Encoding /"+s.encoding),g("/DescendantFonts ["+de+" 0 R]"),g(">>"),g("endobj"),s.isAlreadyPutted=!0}})(o)}]),e.events.push(["putFont",function(o){(function(l){var s=l.font,g=l.out,b=l.newObject,T=l.putStream;if(s.metadata instanceof i.API.TTFFont&&s.encoding==="WinAnsiEncoding"){for(var F=s.metadata.rawData,k="",z=0;z<F.length;z++)k+=String.fromCharCode(F[z]);var J=b();T({data:k,addLength1:!0,objectId:J}),g("endobj");var te=b();T({data:r(s.metadata.toUnicode),addLength1:!0,objectId:te}),g("endobj");var ue=b();g("<<"),g("/Descent "+s.metadata.decender),g("/CapHeight "+s.metadata.capHeight),g("/StemV "+s.metadata.stemV),g("/Type /FontDescriptor"),g("/FontFile2 "+J+" 0 R"),g("/Flags 96"),g("/FontBBox "+i.API.PDFObject.convert(s.metadata.bbox)),g("/FontName /"+xg(s.fontName)),g("/ItalicAngle "+s.metadata.italicAngle),g("/Ascent "+s.metadata.ascender),g(">>"),g("endobj"),s.objectNumber=b();for(var ce=0;ce<s.metadata.hmtx.widths.length;ce++)s.metadata.hmtx.widths[ce]=parseInt(s.metadata.hmtx.widths[ce]*(1e3/s.metadata.head.unitsPerEm));g("<</Subtype/TrueType/Type/Font/ToUnicode "+te+" 0 R/BaseFont/"+xg(s.fontName)+"/FontDescriptor "+ue+" 0 R/Encoding/"+s.encoding+" /FirstChar 29 /LastChar 255 /Widths "+i.API.PDFObject.convert(s.metadata.hmtx.widths)+">>"),g("endobj"),s.isAlreadyPutted=!0}})(o)}]);var n=function(o){var l,s=o.text||"",g=o.x,b=o.y,T=o.options||{},F=o.mutex||{},k=F.pdfEscape,z=F.activeFontKey,J=F.fonts,te=z,ue="",ce=0,de="",_e=J[te].encoding;if(J[te].encoding!=="Identity-H")return{text:s,x:g,y:b,options:T,mutex:F};for(de=s,te=z,Array.isArray(s)&&(de=s[0]),ce=0;ce<de.length;ce+=1)J[te].metadata.hasOwnProperty("cmap")&&(l=J[te].metadata.cmap.unicode.codeMap[de[ce].charCodeAt(0)]),l||de[ce].charCodeAt(0)<256&&J[te].metadata.hasOwnProperty("Unicode")?ue+=de[ce]:ue+="";var Ee="";return parseInt(te.slice(1))<14||_e==="WinAnsiEncoding"?Ee=k(ue,te).split("").map(function(He){return He.charCodeAt(0).toString(16)}).join(""):_e==="Identity-H"&&(Ee=t(ue,J[te])),F.isHex=!0,{text:Ee,x:g,y:b,options:T,mutex:F}};e.events.push(["postProcessText",function(o){var l=o.text||"",s=[],g={text:l,x:o.x,y:o.y,options:o.options,mutex:o.mutex};if(Array.isArray(l)){var b=0;for(b=0;b<l.length;b+=1)Array.isArray(l[b])&&l[b].length===3?s.push([n(Object.assign({},g,{text:l[b][0]})).text,l[b][1],l[b][2]]):s.push(n(Object.assign({},g,{text:l[b]})).text);o.text=s}else o.text=n(Object.assign({},g,{text:l})).text}])}(kr),function(i){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};i.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},i.addFileToVFS=function(t,r){return e.call(this),this.internal.vFS[t]=r,this},i.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}}(kr.API),function(i){i.__bidiEngine__=i.prototype.__bidiEngine__=function(r){var n,o,l,s,g,b,T,F=e,k=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],z=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],J={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},te={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},ue=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],ce=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),de=!1,_e=0;this.__bidiEngine__={};var Ee=function(De){var Me=De.charCodeAt(),Ze=Me>>8,We=te[Ze];return We!==void 0?F[256*We+(255&Me)]:Ze===252||Ze===253?"AL":ce.test(Ze)?"L":Ze===8?"R":"N"},He=function(De){for(var Me,Ze=0;Ze<De.length;Ze++){if((Me=Ee(De.charAt(Ze)))==="L")return!1;if(Me==="R")return!0}return!1},Ve=function(De,Me,Ze,We){var Bt,Ct,Lt,_t,Ft=Me[We];switch(Ft){case"L":case"R":de=!1;break;case"N":case"AN":break;case"EN":de&&(Ft="AN");break;case"AL":de=!0,Ft="R";break;case"WS":Ft="N";break;case"CS":We<1||We+1>=Me.length||(Bt=Ze[We-1])!=="EN"&&Bt!=="AN"||(Ct=Me[We+1])!=="EN"&&Ct!=="AN"?Ft="N":de&&(Ct="AN"),Ft=Ct===Bt?Ct:"N";break;case"ES":Ft=(Bt=We>0?Ze[We-1]:"B")==="EN"&&We+1<Me.length&&Me[We+1]==="EN"?"EN":"N";break;case"ET":if(We>0&&Ze[We-1]==="EN"){Ft="EN";break}if(de){Ft="N";break}for(Lt=We+1,_t=Me.length;Lt<_t&&Me[Lt]==="ET";)Lt++;Ft=Lt<_t&&Me[Lt]==="EN"?"EN":"N";break;case"NSM":if(l&&!s){for(_t=Me.length,Lt=We+1;Lt<_t&&Me[Lt]==="NSM";)Lt++;if(Lt<_t){var Mt=De[We],Wt=Mt>=1425&&Mt<=2303||Mt===64286;if(Bt=Me[Lt],Wt&&(Bt==="R"||Bt==="AL")){Ft="R";break}}}Ft=We<1||(Bt=Me[We-1])==="B"?"N":Ze[We-1];break;case"B":de=!1,n=!0,Ft=_e;break;case"S":o=!0,Ft="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":de=!1;break;case"BN":Ft="N"}return Ft},qe=function(De,Me,Ze){var We=De.split("");return Ze&&Ue(We,Ze,{hiLevel:_e}),We.reverse(),Me&&Me.reverse(),We.join("")},Ue=function(De,Me,Ze){var We,Bt,Ct,Lt,_t,Ft=-1,Mt=De.length,Wt=0,Se=[],Xe=_e?z:k,et=[];for(de=!1,n=!1,o=!1,Bt=0;Bt<Mt;Bt++)et[Bt]=Ee(De[Bt]);for(Ct=0;Ct<Mt;Ct++){if(_t=Wt,Se[Ct]=Ve(De,et,Se,Ct),We=240&(Wt=Xe[_t][J[Se[Ct]]]),Wt&=15,Me[Ct]=Lt=Xe[Wt][5],We>0)if(We===16){for(Bt=Ft;Bt<Ct;Bt++)Me[Bt]=1;Ft=-1}else Ft=-1;if(Xe[Wt][6])Ft===-1&&(Ft=Ct);else if(Ft>-1){for(Bt=Ft;Bt<Ct;Bt++)Me[Bt]=Lt;Ft=-1}et[Ct]==="B"&&(Me[Ct]=0),Ze.hiLevel|=Lt}o&&function(At,ft,wt){for(var Pt=0;Pt<wt;Pt++)if(At[Pt]==="S"){ft[Pt]=_e;for(var It=Pt-1;It>=0&&At[It]==="WS";It--)ft[It]=_e}}(et,Me,Mt)},ot=function(De,Me,Ze,We,Bt){if(!(Bt.hiLevel<De)){if(De===1&&_e===1&&!n)return Me.reverse(),void(Ze&&Ze.reverse());for(var Ct,Lt,_t,Ft,Mt=Me.length,Wt=0;Wt<Mt;){if(We[Wt]>=De){for(_t=Wt+1;_t<Mt&&We[_t]>=De;)_t++;for(Ft=Wt,Lt=_t-1;Ft<Lt;Ft++,Lt--)Ct=Me[Ft],Me[Ft]=Me[Lt],Me[Lt]=Ct,Ze&&(Ct=Ze[Ft],Ze[Ft]=Ze[Lt],Ze[Lt]=Ct);Wt=_t}Wt++}}},it=function(De,Me,Ze){var We=De.split(""),Bt={hiLevel:_e};return Ze||(Ze=[]),Ue(We,Ze,Bt),function(Ct,Lt,_t){if(_t.hiLevel!==0&&T)for(var Ft,Mt=0;Mt<Ct.length;Mt++)Lt[Mt]===1&&(Ft=ue.indexOf(Ct[Mt]))>=0&&(Ct[Mt]=ue[Ft+1])}(We,Ze,Bt),ot(2,We,Me,Ze,Bt),ot(1,We,Me,Ze,Bt),We.join("")};return this.__bidiEngine__.doBidiReorder=function(De,Me,Ze){if(function(Bt,Ct){if(Ct)for(var Lt=0;Lt<Bt.length;Lt++)Ct[Lt]=Lt;s===void 0&&(s=He(Bt)),b===void 0&&(b=He(Bt))}(De,Me),l||!g||b)if(l&&g&&s^b)_e=s?1:0,De=qe(De,Me,Ze);else if(!l&&g&&b)_e=s?1:0,De=it(De,Me,Ze),De=qe(De,Me);else if(!l||s||g||b){if(l&&!g&&s^b)De=qe(De,Me),s?(_e=0,De=it(De,Me,Ze)):(_e=1,De=it(De,Me,Ze),De=qe(De,Me));else if(l&&s&&!g&&b)_e=1,De=it(De,Me,Ze),De=qe(De,Me);else if(!l&&!g&&s^b){var We=T;s?(_e=1,De=it(De,Me,Ze),_e=0,T=!1,De=it(De,Me,Ze),T=We):(_e=0,De=it(De,Me,Ze),De=qe(De,Me),_e=1,T=!1,De=it(De,Me,Ze),T=We,De=qe(De,Me))}}else _e=0,De=it(De,Me,Ze);else _e=s?1:0,De=it(De,Me,Ze);return De},this.__bidiEngine__.setOptions=function(De){De&&(l=De.isInputVisual,g=De.isOutputVisual,s=De.isInputRtl,b=De.isOutputRtl,T=De.isSymmetricSwapping)},this.__bidiEngine__.setOptions(r),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new i.__bidiEngine__({isInputVisual:!0});i.API.events.push(["postProcessText",function(r){var n=r.text,o=(r.x,r.y,r.options||{}),l=(r.mutex,o.lang,[]);if(o.isInputVisual=typeof o.isInputVisual!="boolean"||o.isInputVisual,t.setOptions(o),Object.prototype.toString.call(n)==="[object Array]"){var s=0;for(l=[],s=0;s<n.length;s+=1)Object.prototype.toString.call(n[s])==="[object Array]"?l.push([t.doBidiReorder(n[s][0]),n[s][1],n[s][2]]):l.push([t.doBidiReorder(n[s])]);r.text=l}else r.text=t.doBidiReorder(n);t.setOptions({isInputVisual:!0})}])}(kr),kr.API.TTFFont=function(){function i(e){var t;if(this.rawData=e,t=this.contents=new _d(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new xre(this),this.registerTTF()}return i.open=function(e){return new i(e)},i.prototype.parse=function(){return this.directory=new lre(this.contents),this.head=new ure(this),this.name=new pre(this),this.cmap=new q4(this),this.toUnicode={},this.hhea=new hre(this),this.maxp=new gre(this),this.hmtx=new mre(this),this.post=new dre(this),this.os2=new Are(this),this.loca=new bre(this),this.glyf=new yre(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},i.prototype.registerTTF=function(){var e,t,r,n,o;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var l,s,g,b;for(b=[],l=0,s=(g=this.bbox).length;l<s;l++)e=g[l],b.push(Math.round(e*this.scaleFactor));return b}).call(this),this.stemV=0,this.post.exists?(r=255&(n=this.post.italic_angle),32768&(t=n>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+r)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(o=this.familyClass)===1||o===2||o===3||o===4||o===5||o===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},i.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},i.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},i.prototype.widthOfString=function(e,t,r){var n,o,l,s;for(l=0,o=0,s=(e=""+e).length;0<=s?o<s:o>s;o=0<=s?++o:--o)n=e.charCodeAt(o),l+=this.widthOfGlyph(this.characterToGlyph(n))+r*(1e3/t)||0;return l*(t/1e3)},i.prototype.lineHeight=function(e,t){var r;return t==null&&(t=!1),r=t?this.lineGap:0,(this.ascender+r-this.decender)/1e3*e},i}();var uh,_d=function(){function i(e){this.data=e??[],this.pos=0,this.length=this.data.length}return i.prototype.readByte=function(){return this.data[this.pos++]},i.prototype.writeByte=function(e){return this.data[this.pos++]=e},i.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},i.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},i.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},i.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},i.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},i.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},i.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},i.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},i.prototype.readString=function(e){var t,r;for(r=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)r[t]=String.fromCharCode(this.readByte());return r.join("")},i.prototype.writeString=function(e){var t,r,n;for(n=[],t=0,r=e.length;0<=r?t<r:t>r;t=0<=r?++t:--t)n.push(this.writeByte(e.charCodeAt(t)));return n},i.prototype.readShort=function(){return this.readInt16()},i.prototype.writeShort=function(e){return this.writeInt16(e)},i.prototype.readLongLong=function(){var e,t,r,n,o,l,s,g;return e=this.readByte(),t=this.readByte(),r=this.readByte(),n=this.readByte(),o=this.readByte(),l=this.readByte(),s=this.readByte(),g=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^r)+4294967296*(255^n)+16777216*(255^o)+65536*(255^l)+256*(255^s)+(255^g)+1):72057594037927940*e+281474976710656*t+1099511627776*r+4294967296*n+16777216*o+65536*l+256*s+g},i.prototype.writeLongLong=function(e){var t,r;return t=Math.floor(e/4294967296),r=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(r>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},i.prototype.readInt=function(){return this.readInt32()},i.prototype.writeInt=function(e){return this.writeInt32(e)},i.prototype.read=function(e){var t,r;for(t=[],r=0;0<=e?r<e:r>e;r=0<=e?++r:--r)t.push(this.readByte());return t},i.prototype.write=function(e){var t,r,n,o;for(o=[],r=0,n=e.length;r<n;r++)t=e[r],o.push(this.writeByte(t));return o},i}(),lre=function(){var i;function e(t){var r,n,o;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},n=0,o=this.tableCount;0<=o?n<o:n>o;n=0<=o?++n:--n)r={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[r.tag]=r}return e.prototype.encode=function(t){var r,n,o,l,s,g,b,T,F,k,z,J,te;for(te in z=Object.keys(t).length,g=Math.log(2),F=16*Math.floor(Math.log(z)/g),l=Math.floor(F/g),T=16*z-F,(n=new _d).writeInt(this.scalarType),n.writeShort(z),n.writeShort(F),n.writeShort(l),n.writeShort(T),o=16*z,b=n.pos+o,s=null,J=[],t)for(k=t[te],n.writeString(te),n.writeInt(i(k)),n.writeInt(b),n.writeInt(k.length),J=J.concat(k),te==="head"&&(s=b),b+=k.length;b%4;)J.push(0),b++;return n.write(J),r=2981146554-i(n.data),n.pos=s+8,n.writeUInt32(r),n.data},i=function(t){var r,n,o,l;for(t=$4.call(t);t.length%4;)t.push(0);for(o=new _d(t),n=0,r=0,l=t.length;r<l;r=r+=4)n+=o.readUInt32();return 4294967295&n},e}(),cre={}.hasOwnProperty,Wh=function(i,e){for(var t in e)cre.call(e,t)&&(i[t]=e[t]);function r(){this.constructor=i}return r.prototype=e.prototype,i.prototype=new r,i.__super__=e.prototype,i};uh=function(){function i(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return i.prototype.parse=function(){},i.prototype.encode=function(){},i.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},i}();var ure=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,uh),e.prototype.tag="head",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},e.prototype.encode=function(t){var r;return(r=new _d).writeInt(this.version),r.writeInt(this.revision),r.writeInt(this.checkSumAdjustment),r.writeInt(this.magicNumber),r.writeShort(this.flags),r.writeShort(this.unitsPerEm),r.writeLongLong(this.created),r.writeLongLong(this.modified),r.writeShort(this.xMin),r.writeShort(this.yMin),r.writeShort(this.xMax),r.writeShort(this.yMax),r.writeShort(this.macStyle),r.writeShort(this.lowestRecPPEM),r.writeShort(this.fontDirectionHint),r.writeShort(t),r.writeShort(this.glyphDataFormat),r.data},e}(),j4=function(){function i(e,t){var r,n,o,l,s,g,b,T,F,k,z,J,te,ue,ce,de,_e;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),F=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(g=0;g<256;++g)this.codeMap[g]=e.readByte();break;case 4:for(z=e.readUInt16(),k=z/2,e.pos+=6,o=function(){var Ee,He;for(He=[],g=Ee=0;0<=k?Ee<k:Ee>k;g=0<=k?++Ee:--Ee)He.push(e.readUInt16());return He}(),e.pos+=2,te=function(){var Ee,He;for(He=[],g=Ee=0;0<=k?Ee<k:Ee>k;g=0<=k?++Ee:--Ee)He.push(e.readUInt16());return He}(),b=function(){var Ee,He;for(He=[],g=Ee=0;0<=k?Ee<k:Ee>k;g=0<=k?++Ee:--Ee)He.push(e.readUInt16());return He}(),T=function(){var Ee,He;for(He=[],g=Ee=0;0<=k?Ee<k:Ee>k;g=0<=k?++Ee:--Ee)He.push(e.readUInt16());return He}(),n=(this.length-e.pos+this.offset)/2,s=function(){var Ee,He;for(He=[],g=Ee=0;0<=n?Ee<n:Ee>n;g=0<=n?++Ee:--Ee)He.push(e.readUInt16());return He}(),g=ce=0,_e=o.length;ce<_e;g=++ce)for(ue=o[g],r=de=J=te[g];J<=ue?de<=ue:de>=ue;r=J<=ue?++de:--de)T[g]===0?l=r+b[g]:(l=s[T[g]/2+(r-J)-(k-g)]||0)!==0&&(l+=b[g]),this.codeMap[r]=65535&l}e.pos=F}return i.encode=function(e,t){var r,n,o,l,s,g,b,T,F,k,z,J,te,ue,ce,de,_e,Ee,He,Ve,qe,Ue,ot,it,De,Me,Ze,We,Bt,Ct,Lt,_t,Ft,Mt,Wt,Se,Xe,et,At,ft,wt,Pt,It,Ht,ii,gi;switch(We=new _d,l=Object.keys(e).sort(function(mi,Mi){return mi-Mi}),t){case"macroman":for(te=0,ue=function(){var mi=[];for(J=0;J<256;++J)mi.push(0);return mi}(),de={0:0},o={},Bt=0,Ft=l.length;Bt<Ft;Bt++)de[It=e[n=l[Bt]]]==null&&(de[It]=++te),o[n]={old:e[n],new:de[e[n]]},ue[n]=de[e[n]];return We.writeUInt16(1),We.writeUInt16(0),We.writeUInt32(12),We.writeUInt16(0),We.writeUInt16(262),We.writeUInt16(0),We.write(ue),{charMap:o,subtable:We.data,maxGlyphID:te+1};case"unicode":for(Me=[],F=[],_e=0,de={},r={},ce=b=null,Ct=0,Mt=l.length;Ct<Mt;Ct++)de[He=e[n=l[Ct]]]==null&&(de[He]=++_e),r[n]={old:He,new:de[He]},s=de[He]-n,ce!=null&&s===b||(ce&&F.push(ce),Me.push(n),b=s),ce=n;for(ce&&F.push(ce),F.push(65535),Me.push(65535),it=2*(ot=Me.length),Ue=2*Math.pow(Math.log(ot)/Math.LN2,2),k=Math.log(Ue/2)/Math.LN2,qe=2*ot-Ue,g=[],Ve=[],z=[],J=Lt=0,Wt=Me.length;Lt<Wt;J=++Lt){if(De=Me[J],T=F[J],De===65535){g.push(0),Ve.push(0);break}if(De-(Ze=r[De].new)>=32768)for(g.push(0),Ve.push(2*(z.length+ot-J)),n=_t=De;De<=T?_t<=T:_t>=T;n=De<=T?++_t:--_t)z.push(r[n].new);else g.push(Ze-De),Ve.push(0)}for(We.writeUInt16(3),We.writeUInt16(1),We.writeUInt32(12),We.writeUInt16(4),We.writeUInt16(16+8*ot+2*z.length),We.writeUInt16(0),We.writeUInt16(it),We.writeUInt16(Ue),We.writeUInt16(k),We.writeUInt16(qe),wt=0,Se=F.length;wt<Se;wt++)n=F[wt],We.writeUInt16(n);for(We.writeUInt16(0),Pt=0,Xe=Me.length;Pt<Xe;Pt++)n=Me[Pt],We.writeUInt16(n);for(Ht=0,et=g.length;Ht<et;Ht++)s=g[Ht],We.writeUInt16(s);for(ii=0,At=Ve.length;ii<At;ii++)Ee=Ve[ii],We.writeUInt16(Ee);for(gi=0,ft=z.length;gi<ft;gi++)te=z[gi],We.writeUInt16(te);return{charMap:r,subtable:We.data,maxGlyphID:_e+1}}},i}(),q4=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,uh),e.prototype.tag="cmap",e.prototype.parse=function(t){var r,n,o;for(t.pos=this.offset,this.version=t.readUInt16(),o=t.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=o?n<o:n>o;n=0<=o?++n:--n)r=new j4(t,this.offset),this.tables.push(r),r.isUnicode&&this.unicode==null&&(this.unicode=r);return!0},e.encode=function(t,r){var n,o;return r==null&&(r="macroman"),n=j4.encode(t,r),(o=new _d).writeUInt16(0),o.writeUInt16(1),n.table=o.data.concat(n.subtable),n},e}(),hre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,uh),e.prototype.tag="hhea",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},e}(),Are=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,uh),e.prototype.tag="OS/2",e.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var r,n;for(n=[],r=0;r<10;++r)n.push(t.readByte());return n}(),this.charRange=function(){var r,n;for(n=[],r=0;r<4;++r)n.push(t.readInt());return n}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var r,n;for(n=[],r=0;r<2;r=++r)n.push(t.readInt());return n}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},e}(),dre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,uh),e.prototype.tag="post",e.prototype.parse=function(t){var r,n,o;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:break;case 131072:var l;for(n=t.readUInt16(),this.glyphNameIndex=[],l=0;0<=n?l<n:l>n;l=0<=n?++l:--l)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],o=[];t.pos<this.offset+this.length;)r=t.readByte(),o.push(this.names.push(t.readString(r)));return o;case 151552:return n=t.readUInt16(),this.offsets=t.read(n);case 196608:break;case 262144:return this.map=(function(){var s,g,b;for(b=[],l=s=0,g=this.file.maxp.numGlyphs;0<=g?s<g:s>g;l=0<=g?++s:--s)b.push(t.readUInt32());return b}).call(this)}},e}(),fre=function(i,e){this.raw=i,this.length=i.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},pre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,uh),e.prototype.tag="name",e.prototype.parse=function(t){var r,n,o,l,s,g,b,T,F,k,z;for(t.pos=this.offset,t.readShort(),r=t.readShort(),g=t.readShort(),n=[],l=0;0<=r?l<r:l>r;l=0<=r?++l:--l)n.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+g+t.readShort()});for(b={},l=F=0,k=n.length;F<k;l=++F)o=n[l],t.pos=o.offset,T=t.readString(o.length),s=new fre(T,o),b[z=o.nameID]==null&&(b[z]=[]),b[o.nameID].push(s);this.strings=b,this.copyright=b[0],this.fontFamily=b[1],this.fontSubfamily=b[2],this.uniqueSubfamily=b[3],this.fontName=b[4],this.version=b[5];try{this.postscriptName=b[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=b[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=b[7],this.manufacturer=b[8],this.designer=b[9],this.description=b[10],this.vendorUrl=b[11],this.designerUrl=b[12],this.license=b[13],this.licenseUrl=b[14],this.preferredFamily=b[15],this.preferredSubfamily=b[17],this.compatibleFull=b[18],this.sampleText=b[19]},e}(),gre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,uh),e.prototype.tag="maxp",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},e}(),mre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,uh),e.prototype.tag="hmtx",e.prototype.parse=function(t){var r,n,o,l,s,g,b;for(t.pos=this.offset,this.metrics=[],r=0,g=this.file.hhea.numberOfMetrics;0<=g?r<g:r>g;r=0<=g?++r:--r)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(o=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var T,F;for(F=[],r=T=0;0<=o?T<o:T>o;r=0<=o?++T:--T)F.push(t.readInt16());return F}(),this.widths=(function(){var T,F,k,z;for(z=[],T=0,F=(k=this.metrics).length;T<F;T++)l=k[T],z.push(l.advance);return z}).call(this),n=this.widths[this.widths.length-1],b=[],r=s=0;0<=o?s<o:s>o;r=0<=o?++s:--s)b.push(this.widths.push(n));return b},e.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},e}(),$4=[].slice,yre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,uh),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(t){var r,n,o,l,s,g,b,T,F,k;return t in this.cache?this.cache[t]:(l=this.file.loca,r=this.file.contents,n=l.indexOf(t),(o=l.lengthOf(t))===0?this.cache[t]=null:(r.pos=this.offset+n,s=(g=new _d(r.read(o))).readShort(),T=g.readShort(),k=g.readShort(),b=g.readShort(),F=g.readShort(),this.cache[t]=s===-1?new vre(g,T,k,b,F):new _re(g,s,T,k,b,F),this.cache[t]))},e.prototype.encode=function(t,r,n){var o,l,s,g,b;for(s=[],l=[],g=0,b=r.length;g<b;g++)o=t[r[g]],l.push(s.length),o&&(s=s.concat(o.encode(n)));return l.push(s.length),{table:s,offsets:l}},e}(),_re=function(){function i(e,t,r,n,o,l){this.raw=e,this.numberOfContours=t,this.xMin=r,this.yMin=n,this.xMax=o,this.yMax=l,this.compound=!1}return i.prototype.encode=function(){return this.raw.data},i}(),vre=function(){function i(e,t,r,n,o){var l,s;for(this.raw=e,this.xMin=t,this.yMin=r,this.xMax=n,this.yMax=o,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],l=this.raw;s=l.readShort(),this.glyphOffsets.push(l.pos),this.glyphIDs.push(l.readUInt16()),32&s;)l.pos+=1&s?4:2,128&s?l.pos+=8:64&s?l.pos+=4:8&s&&(l.pos+=2)}return i.prototype.encode=function(){var e,t,r;for(t=new _d($4.call(this.raw.data)),e=0,r=this.glyphIDs.length;e<r;++e)t.pos=this.glyphOffsets[e];return t.data},i}(),bre=function(i){function e(){return e.__super__.constructor.apply(this,arguments)}return Wh(e,uh),e.prototype.tag="loca",e.prototype.parse=function(t){var r,n;return t.pos=this.offset,r=this.file.head.indexToLocFormat,this.offsets=r===0?(function(){var o,l;for(l=[],n=0,o=this.length;n<o;n+=2)l.push(2*t.readUInt16());return l}).call(this):(function(){var o,l;for(l=[],n=0,o=this.length;n<o;n+=4)l.push(t.readUInt32());return l}).call(this)},e.prototype.indexOf=function(t){return this.offsets[t]},e.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},e.prototype.encode=function(t,r){for(var n=new Uint32Array(this.offsets.length),o=0,l=0,s=0;s<n.length;++s)if(n[s]=o,l<r.length&&r[l]==s){++l,n[s]=o;var g=this.offsets[s],b=this.offsets[s+1]-g;b>0&&(o+=b)}for(var T=new Array(4*n.length),F=0;F<n.length;++F)T[4*F+3]=255&n[F],T[4*F+2]=(65280&n[F])>>8,T[4*F+1]=(16711680&n[F])>>16,T[4*F]=(4278190080&n[F])>>24;return T},e}(),xre=function(){function i(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return i.prototype.generateCmap=function(){var e,t,r,n,o;for(t in n=this.font.cmap.tables[0].codeMap,e={},o=this.subset)r=o[t],e[t]=n[r];return e},i.prototype.glyphsFor=function(e){var t,r,n,o,l,s,g;for(n={},l=0,s=e.length;l<s;l++)n[o=e[l]]=this.font.glyf.glyphFor(o);for(o in t=[],n)(r=n[o])!=null&&r.compound&&t.push.apply(t,r.glyphIDs);if(t.length>0)for(o in g=this.glyphsFor(t))r=g[o],n[o]=r;return n},i.prototype.encode=function(e,t){var r,n,o,l,s,g,b,T,F,k,z,J,te,ue,ce;for(n in r=q4.encode(this.generateCmap(),"unicode"),l=this.glyphsFor(e),z={0:0},ce=r.charMap)z[(g=ce[n]).old]=g.new;for(J in k=r.maxGlyphID,l)J in z||(z[J]=k++);return T=function(de){var _e,Ee;for(_e in Ee={},de)Ee[de[_e]]=_e;return Ee}(z),F=Object.keys(T).sort(function(de,_e){return de-_e}),te=function(){var de,_e,Ee;for(Ee=[],de=0,_e=F.length;de<_e;de++)s=F[de],Ee.push(T[s]);return Ee}(),o=this.font.glyf.encode(l,te,z),b=this.font.loca.encode(o.offsets,te),ue={cmap:this.font.cmap.raw(),glyf:o.table,loca:b,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(ue["OS/2"]=this.font.os2.raw()),this.font.directory.encode(ue)},i}();kr.API.PDFObject=function(){var i;function e(){}return i=function(t,r){return(Array(r+1).join("0")+t).slice(-r)},e.convert=function(t){var r,n,o,l;if(Array.isArray(t))return"["+function(){var s,g,b;for(b=[],s=0,g=t.length;s<g;s++)r=t[s],b.push(e.convert(r));return b}().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t!=null&&t.isString)return"("+t+")";if(t instanceof Date)return"(D:"+i(t.getUTCFullYear(),4)+i(t.getUTCMonth(),2)+i(t.getUTCDate(),2)+i(t.getUTCHours(),2)+i(t.getUTCMinutes(),2)+i(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(n in o=["<<"],t)l=t[n],o.push("/"+n+" "+e.convert(l));return o.push(">>"),o.join(`
`)}return""+t},e}(),function(i){var e={};function t(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return i[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=i,t.c=e,t.d=function(r,n,o){t.o(r,n)||Object.defineProperty(r,n,{enumerable:!0,get:o})},t.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,n){if(1&n&&(r=t(r)),8&n||4&n&&typeof r=="object"&&r&&r.__esModule)return r;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:r}),2&n&&typeof r!="string")for(var l in r)t.d(o,l,(function(s){return r[s]}).bind(null,l));return o},t.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(n,"a",n),n},t.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},t.p="",t(t.s=0)}([function(i,e,t){i.exports=t(1)},function(i,e){function t(n,o){for(var l=0;l<o.length;l++){var s=o[l];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}var r=function(){function n(){(function(s,g){if(!(s instanceof g))throw new TypeError("Cannot call a class as a function")})(this,n),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var o,l;return o=n,(l=[{key:"show",value:function(s){this.setOptions(s),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var s=document.getElementById("loading-overlay-stylesheet");s&&(s.disabled=!0,s.parentNode.removeChild(s),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(s){if(s!==void 0)for(var g in s)this.options[g]=s[g]}},{key:"generateAndAddOverlayElement",value:function(){var s="50%";this.options.offsetX!==0&&(s="calc(50% + "+this.options.offsetX+")");var g="50%";if(this.options.offsetY!==0&&(g="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var b='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(g,"; left: ").concat(s,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),T=document.getElementById(this.options.containerID);return T.style.position="relative",void T.insertAdjacentHTML("beforeend",b)}var F='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(g,"; left: ").concat(s,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",F)}},{key:"generateSpinnerElement",value:function(){var s=this,g=Object.keys(this.numberOfEmptyDivForSpinner).find(function(T){return T===s.options.spinnerIcon}),b=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[g]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(b,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var s=document.createElement("link");s.setAttribute("id","loading-overlay-stylesheet"),s.setAttribute("rel","stylesheet"),s.setAttribute("type","text/css"),s.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(s)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(s){for(var g="",b=1;b<=s;b++)g+="<div></div>";return g}}])&&t(o.prototype,l),n}();window.JsLoadingOverlay=new r,i.exports=JsLoadingOverlay}]);const vd={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},zy={in:"in",mm:"mm"},Lg={A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},Qy={Landscape:"landscape",Portrait:"portrait"},FC={72:72,96:96,200:200,300:300,400:400};let wre=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Lg.A4,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:vd.PNG.toString(),o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:zy.mm,l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map";Ms(this,"map"),Ms(this,"width"),Ms(this,"height"),Ms(this,"dpi"),Ms(this,"format"),Ms(this,"unit"),Ms(this,"fileName"),this.map=e,this.width=t[0],this.height=t[1],this.dpi=r,this.format=n,this.unit=o,this.fileName=l}generate(){const e=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const t=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return e.dpi/96}});const r=document.createElement("div");r.className="hidden-map",document.body.appendChild(r);const n=document.createElement("div");n.style.width=this.toPixels(this.width),n.style.height=this.toPixels(this.height),r.appendChild(n);const o=this.map.getStyle();if(o&&o.sources){const s=o.sources;Object.keys(s).forEach(g=>{const b=s[g];Object.keys(b).forEach(T=>{b[T]||delete b[T]})})}const l=new xie.Map({container:n,style:o,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,attributionControl:!1,transformRequest:this.map._requestManager._transformRequestFn});l.once("idle",()=>{var s;const g=l.getCanvas(),b=`${this.fileName}.${e.format}`;switch(e.format){case vd.PNG:e.toPNG(g,b);break;case vd.JPEG:e.toJPEG(g,b);break;case vd.PDF:e.toPDF(l,b);break;case vd.SVG:e.toSVG(g,b);break;default:console.error(`Invalid file format: ${e.format}`);break}l.remove(),(s=r.parentNode)==null||s.removeChild(r),Object.defineProperty(window,"devicePixelRatio",{get(){return t}}),r.remove(),JsLoadingOverlay.hide()})}toPNG(e,t){const r=document.createElement("a");r.href=e.toDataURL(),r.download=t,r.click(),r.remove()}toJPEG(e,t){const r=e.toDataURL("image/jpeg",.85);if(e.msToBlob){const n=this.toBlob(r);window.navigator.msSaveBlob(n,t)}else{const n=document.createElement("a");n.href=r,n.download=t,n.click(),n.remove()}}toPDF(e,t){const r=e.getCanvas(),n=new kr({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});n.addImage(r.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:o,lat:l}=e.getCenter();n.setProperties({title:e.getStyle().name,subject:`center: [${o}, ${l}], zoom: ${e.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),n.save(t)}toSVG(e,t){const r=e.toDataURL("image/png"),n=Number(this.toPixels(this.width,this.dpi).replace("px","")),o=Number(this.toPixels(this.height,this.dpi).replace("px","")),l=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${n}" 
      height="${o}" 
      viewBox="0 0 ${n} ${o}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${r}" width="${n}" height="${o}"></image>
    </svg>`,s=document.createElement("a");s.href=`data:application/xml,${encodeURIComponent(l)}`,s.download=t,s.click(),s.remove()}toPixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===zy.mm&&(t/=25.4),`${t*e}px`}toBlob(e){const t=atob(e.replace(/^.*,/,"")),r=new Uint8Array(t.length);for(let n=0;n<t.length;n+=1)r[n]=t.charCodeAt(n);return new Blob([r.buffer],{type:"image/png"})}},Bre=class{constructor(e){Ms(this,"map"),Ms(this,"width"),Ms(this,"height"),Ms(this,"unit"),Ms(this,"svgCanvas"),Ms(this,"svgPath");var t,r,n;if(this.map=e,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const o=(t=this.map)==null?void 0:t.getCanvas().clientWidth,l=(r=this.map)==null?void 0:r.getCanvas().clientHeight,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.setAttribute("width",`${o}px`),s.setAttribute("height",`${l}px`);const g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("style","fill:#888888;stroke-width:0"),g.setAttribute("fill-opacity","0.5"),s.append(g),(n=this.map)==null||n.getCanvasContainer().appendChild(s),this.svgCanvas=s,this.svgPath=g}mapResize(){this.generateCutOut()}updateArea(e,t){this.width=e,this.height=t,this.unit=zy.mm,this.generateCutOut()}generateCutOut(){var e,t;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const r=this.toPixels(this.width),n=this.toPixels(this.height),o=(e=this.map)==null?void 0:e.getCanvas().clientWidth,l=(t=this.map)==null?void 0:t.getCanvas().clientHeight,s=o/2-r/2,g=s+r,b=l/2-n/2,T=b+n;this.svgCanvas.setAttribute("width",`${o}px`),this.svgCanvas.setAttribute("height",`${l}px`),this.svgPath.setAttribute("d",`M 0 0 L ${o} 0 L ${o} ${l} L 0 ${l} M ${s} ${b} L ${s} ${T} L ${g} ${T} L ${g} ${b}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===zy.mm&&(t/=25.4),t*e}};const K4={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate"},Cre={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Gnrer"},Ere={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi"},Sre={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflsung",Generate:"Erstellen"},Tre={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera"},Ire={PageSize:"Tamao de pgina",PageOrientation:"Orientacin de pgina",Format:"Formato",DPI:"DPI",Generate:"Generar"},Lre={PageSize:"Kch thc trang",PageOrientation:"Loi trang",Format:"nh dng",DPI:"Mt  im nh (DPI)",Generate:"To"},Mre={PageSize:" ",PageOrientation:" ",Format:"",DPI:"DPI",Generate:""},Pre={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:""},Fre={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:""},Dre={PageSize:"",PageOrientation:"",Format:"",DPI:"DPI",Generate:""};let Rre=class{constructor(e){Ms(this,"controlContainer"),Ms(this,"exportContainer"),Ms(this,"crosshair"),Ms(this,"printableArea"),Ms(this,"map"),Ms(this,"exportButton"),Ms(this,"options",{PageSize:Lg.A4,PageOrientation:Qy.Landscape,Format:vd.PDF,DPI:FC[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(Lg),Filename:"map"}),e&&(this.options=Object.assign(this.options,e)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){switch(this.options.Local){case"de":return Sre;case"en":return K4;case"fr":return Cre;case"fi":return Ere;case"sv":return Tre;case"es":return Ire;case"vi":return Lre;case"uk":return Mre;case"zhHans":return Pre;case"zhHant":return Fre;case"ja":return Dre;default:return K4}}onAdd(e){var t;this.map=e,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add("maplibregl-export-list"),this.exportButton=document.createElement("button"),this.exportButton.classList.add("maplibregl-ctrl-icon"),this.exportButton.classList.add("maplibregl-export-control"),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const r=document.createElement("TABLE");r.className="print-table";const n={};(t=this.options.AllowedSizes)==null||t.forEach(T=>{Lg[T]&&(n[T]=Lg[T])});const o=this.createSelection(n,this.getTranslation().PageSize,"page-size",this.options.PageSize,(T,F)=>JSON.stringify(T[F]));r.appendChild(o);const l=this.createSelection(Qy,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(T,F)=>T[F]);r.appendChild(l);const s=this.createSelection(vd,this.getTranslation().Format,"format-type",this.options.Format,(T,F)=>T[F]);r.appendChild(s);const g=this.createSelection(FC,this.getTranslation().DPI,"dpi-type",this.options.DPI,(T,F)=>T[F]);r.appendChild(g),this.exportContainer.appendChild(r);const b=document.createElement("button");return b.type="button",b.textContent=this.getTranslation().Generate,b.classList.add("generate-button"),b.addEventListener("click",()=>{const T=document.getElementById("mapbox-gl-export-page-size"),F=document.getElementById("mapbox-gl-export-page-orientation"),k=document.getElementById("mapbox-gl-export-format-type"),z=document.getElementById("mapbox-gl-export-dpi-type"),J=F.value;let te=JSON.parse(T.value);J===Qy.Portrait&&(te=te.reverse()),new wre(e,te,Number(z.value),k.value,zy.mm,this.options.Filename).generate()}),this.exportContainer.appendChild(b),this.controlContainer}createSelection(e,t,r,n,o){const l=document.createElement("label");l.textContent=t;const s=document.createElement("select");s.setAttribute("id",`mapbox-gl-export-${r}`),s.style.width="100%",Object.keys(e).forEach(F=>{const k=document.createElement("option");k.setAttribute("value",o(e,F)),k.appendChild(document.createTextNode(F)),k.setAttribute("name",r),n===e[F]&&(k.selected=!0),s.appendChild(k)}),s.addEventListener("change",()=>{this.updatePrintableArea()});const g=document.createElement("TR"),b=document.createElement("TD"),T=document.createElement("TD");return b.appendChild(l),T.appendChild(s),g.appendChild(b),g.appendChild(T),g}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.map=void 0)}onDocumentClick(e){this.controlContainer&&!this.controlContainer.contains(e.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(e){this.options.Crosshair===!0&&(e===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new Cie(this.map),this.crosshair.create()))}togglePrintableArea(e){this.options.PrintableArea===!0&&(e===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new Bre(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const e=document.getElementById("mapbox-gl-export-page-size"),t=document.getElementById("mapbox-gl-export-page-orientation").value;let r=JSON.parse(e.value);t===Qy.Portrait&&(r=r.reverse()),this.printableArea.updateArea(r[0],r[1])}};var W4=Ore,kre=Object.prototype.hasOwnProperty;function Ore(){for(var i={},e=0;e<arguments.length;e++){var t=arguments[e];for(var r in t)kre.call(t,r)&&(i[r]=t[r])}return i}var X4={exports:{}};(function(i,e){(function(){var t={};i.exports=t,t.simpleFilter=function(r,n){return n.filter(function(o){return t.test(r,o)})},t.test=function(r,n){return t.match(r,n)!==null},t.match=function(r,n,o){o=o||{};var l=0,s=[],g=n.length,b=0,T=0,F=o.pre||"",k=o.post||"",z=o.caseSensitive&&n||n.toLowerCase(),J;r=o.caseSensitive&&r||r.toLowerCase();for(var te=0;te<g;te++)J=n[te],z[te]===r[l]?(J=F+J+k,l+=1,T+=1+T):T=0,b+=T,s[s.length]=J;return l===r.length?(b=z===r?1/0:b,{rendered:s.join(""),score:b}):null},t.filter=function(r,n,o){return!n||n.length===0?[]:typeof r!="string"?n:(o=o||{},n.reduce(function(l,s,g,b){var T=s;o.extract&&(T=o.extract(s));var F=t.match(r,T,o);return F!=null&&(l[l.length]={string:F.rendered,score:F.score,index:g,original:s}),l},[]).sort(function(l,s){var g=s.score-l.score;return g||l.index-s.index}))}})()})(X4);var Ure=X4.exports,Lc=function(i){return this.component=i,this.items=[],this.active=i.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,i.el.parentNode.insertBefore(this.wrapper,i.el.nextSibling),this};Lc.prototype.show=function(){this.element.style.display="block"},Lc.prototype.hide=function(){this.element.style.display="none"},Lc.prototype.add=function(i){this.items.push(i)},Lc.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},Lc.prototype.isEmpty=function(){return!this.items.length},Lc.prototype.isVisible=function(){return this.element.style.display==="block"},Lc.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var i=0;i<this.items.length;i++)this.drawItem(this.items[i],this.active===i);this.show()},Lc.prototype.drawItem=function(i,e){var t=document.createElement("li"),r=document.createElement("a");e&&(t.className+=" active"),r.innerHTML=i.string,t.appendChild(r),this.element.appendChild(t),t.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),t.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,i)}).bind(this))},Lc.prototype.handleMouseUp=function(i){this.selectingListItem=!1,this.component.value(i.original),this.clear(),this.draw()},Lc.prototype.move=function(i){this.active=i,this.draw()},Lc.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},Lc.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},Lc.prototype.drawError=function(i){var e=document.createElement("li");e.innerHTML=i,this.element.appendChild(e),this.show()};var Nre=Lc,zre=W4,Qre=Ure,Vre=Nre,Dl=function(i,e,t){return t=t||{},this.options=zre({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},t),this.el=i,this.data=e||[],this.list=new Vre(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(r){this.handleKeyUp(r.keyCode,r)}).bind(this),!1),this.el.addEventListener("keydown",(function(r){this.handleKeyDown(r)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(r){this.handlePaste(r)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Dl.prototype.handleKeyUp=function(i,e){if(!(i===40||i===38||i===27||i===9)){if(i===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),e.stopPropagation());return}this.handleInputChange(this.el.value)}},Dl.prototype.handleKeyDown=function(i){switch(i.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&i.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},Dl.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},Dl.prototype.handlePaste=function(i){if(i.clipboardData)this.handleInputChange(i.clipboardData.getData("Text"));else{var e=this;setTimeout(function(){e.handleInputChange(i.target.value)},100)}},Dl.prototype.handleInputChange=function(i){if(this.query=this.normalize(i),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(e){for(var t=0;t<e.length&&(this.list.add(e[t]),t!==this.options.limit-1);t++);this.list.draw()}).bind(this))},Dl.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},Dl.prototype.update=function(i){this.data=i,this.handleKeyUp()},Dl.prototype.clear=function(){this.data=[],this.list.clear()},Dl.prototype.normalize=function(i){return i=i.toLowerCase(),i},Dl.prototype.match=function(i,e){return i.indexOf(e)>-1},Dl.prototype.value=function(i){if(this.selected=i,this.el.value=this.getItemValue(i||{place_name:this.query}),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")},Dl.prototype.getCandidates=function(i){var e={pre:"<strong>",post:"</strong>",extract:(function(r){return this.getItemValue(r)}).bind(this)},t;this.options.filter?(t=Qre.filter(this.query,this.data,e),t=t.map((function(r){return{original:r.original,string:this.render(r.original,r.string)}}).bind(this))):t=this.data.map((function(r){var n=this.render(r);return{original:r,string:n}}).bind(this)),i(t)},Dl.prototype.getItemValue=function(i){return i},Dl.prototype.render=function(i,e){if(e)return e;for(var t=i.original?this.getItemValue(i.original):this.getItemValue(i),r=this.normalize(t),n=r.lastIndexOf(this.query);n>-1;){var o=n+this.query.length;t=t.slice(0,n)+"<strong>"+t.slice(n,o)+"</strong>"+t.slice(o),n=r.slice(0,n).lastIndexOf(this.query)}return t},Dl.prototype.renderError=function(i){this.list.drawError(i)};var Hre=Dl,Z4=Hre,Gre=Z4;typeof window<"u"&&(window.Suggestions=Z4);var jre="Expected a function",J4=NaN,qre="[object Symbol]",$re=/^\s+|\s+$/g,Kre=/^[-+]0x[0-9a-f]+$/i,Wre=/^0b[01]+$/i,Xre=/^0o[0-7]+$/i,Zre=parseInt,Jre=typeof lf=="object"&&lf&&lf.Object===Object&&lf,Yre=typeof self=="object"&&self&&self.Object===Object&&self,ene=Jre||Yre||Function("return this")(),tne=Object.prototype,ine=tne.toString,rne=Math.max,nne=Math.min,DC=function(){return ene.Date.now()};function sne(i,e,t){var r,n,o,l,s,g,b=0,T=!1,F=!1,k=!0;if(typeof i!="function")throw new TypeError(jre);e=Y4(e)||0,RC(t)&&(T=!!t.leading,F="maxWait"in t,o=F?rne(Y4(t.maxWait)||0,e):o,k="trailing"in t?!!t.trailing:k);function z(Ve){var qe=r,Ue=n;return r=n=void 0,b=Ve,l=i.apply(Ue,qe),l}function J(Ve){return b=Ve,s=setTimeout(ce,e),T?z(Ve):l}function te(Ve){var qe=Ve-g,Ue=Ve-b,ot=e-qe;return F?nne(ot,o-Ue):ot}function ue(Ve){var qe=Ve-g,Ue=Ve-b;return g===void 0||qe>=e||qe<0||F&&Ue>=o}function ce(){var Ve=DC();if(ue(Ve))return de(Ve);s=setTimeout(ce,te(Ve))}function de(Ve){return s=void 0,k&&r?z(Ve):(r=n=void 0,l)}function _e(){s!==void 0&&clearTimeout(s),b=0,r=g=n=s=void 0}function Ee(){return s===void 0?l:de(DC())}function He(){var Ve=DC(),qe=ue(Ve);if(r=arguments,n=this,g=Ve,qe){if(s===void 0)return J(g);if(F)return s=setTimeout(ce,e),z(g)}return s===void 0&&(s=setTimeout(ce,e)),l}return He.cancel=_e,He.flush=Ee,He}function RC(i){var e=typeof i;return!!i&&(e=="object"||e=="function")}function one(i){return!!i&&typeof i=="object"}function ane(i){return typeof i=="symbol"||one(i)&&ine.call(i)==qre}function Y4(i){if(typeof i=="number")return i;if(ane(i))return J4;if(RC(i)){var e=typeof i.valueOf=="function"?i.valueOf():i;i=RC(e)?e+"":e}if(typeof i!="string")return i===0?i:+i;i=i.replace($re,"");var t=Wre.test(i);return t||Xre.test(i)?Zre(i.slice(2),t?2:8):Kre.test(i)?J4:+i}var lne=sne,kC={exports:{}},Mg=typeof Reflect=="object"?Reflect:null,eD=Mg&&typeof Mg.apply=="function"?Mg.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)},av;Mg&&typeof Mg.ownKeys=="function"?av=Mg.ownKeys:Object.getOwnPropertySymbols?av=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:av=function(e){return Object.getOwnPropertyNames(e)};function cne(i){console&&console.warn&&console.warn(i)}var tD=Number.isNaN||function(e){return e!==e};function xs(){xs.init.call(this)}kC.exports=xs,kC.exports.once=dne,xs.EventEmitter=xs,xs.prototype._events=void 0,xs.prototype._eventsCount=0,xs.prototype._maxListeners=void 0;var iD=10;function lv(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(xs,"defaultMaxListeners",{enumerable:!0,get:function(){return iD},set:function(i){if(typeof i!="number"||i<0||tD(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");iD=i}}),xs.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},xs.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||tD(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function rD(i){return i._maxListeners===void 0?xs.defaultMaxListeners:i._maxListeners}xs.prototype.getMaxListeners=function(){return rD(this)},xs.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var n=e==="error",o=this._events;if(o!==void 0)n=n&&o.error===void 0;else if(!n)return!1;if(n){var l;if(t.length>0&&(l=t[0]),l instanceof Error)throw l;var s=new Error("Unhandled error."+(l?" ("+l.message+")":""));throw s.context=l,s}var g=o[e];if(g===void 0)return!1;if(typeof g=="function")eD(g,this,t);else for(var b=g.length,T=lD(g,b),r=0;r<b;++r)eD(T[r],this,t);return!0};function nD(i,e,t,r){var n,o,l;if(lv(t),o=i._events,o===void 0?(o=i._events=Object.create(null),i._eventsCount=0):(o.newListener!==void 0&&(i.emit("newListener",e,t.listener?t.listener:t),o=i._events),l=o[e]),l===void 0)l=o[e]=t,++i._eventsCount;else if(typeof l=="function"?l=o[e]=r?[t,l]:[l,t]:r?l.unshift(t):l.push(t),n=rD(i),n>0&&l.length>n&&!l.warned){l.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=i,s.type=e,s.count=l.length,cne(s)}return i}xs.prototype.addListener=function(e,t){return nD(this,e,t,!1)},xs.prototype.on=xs.prototype.addListener,xs.prototype.prependListener=function(e,t){return nD(this,e,t,!0)};function une(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function sD(i,e,t){var r={fired:!1,wrapFn:void 0,target:i,type:e,listener:t},n=une.bind(r);return n.listener=t,r.wrapFn=n,n}xs.prototype.once=function(e,t){return lv(t),this.on(e,sD(this,e,t)),this},xs.prototype.prependOnceListener=function(e,t){return lv(t),this.prependListener(e,sD(this,e,t)),this},xs.prototype.removeListener=function(e,t){var r,n,o,l,s;if(lv(t),n=this._events,n===void 0)return this;if(r=n[e],r===void 0)return this;if(r===t||r.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if(typeof r!="function"){for(o=-1,l=r.length-1;l>=0;l--)if(r[l]===t||r[l].listener===t){s=r[l].listener,o=l;break}if(o<0)return this;o===0?r.shift():hne(r,o),r.length===1&&(n[e]=r[0]),n.removeListener!==void 0&&this.emit("removeListener",e,s||t)}return this},xs.prototype.off=xs.prototype.removeListener,xs.prototype.removeAllListeners=function(e){var t,r,n;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var o=Object.keys(r),l;for(n=0;n<o.length;++n)l=o[n],l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=r[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this};function oD(i,e,t){var r=i._events;if(r===void 0)return[];var n=r[e];return n===void 0?[]:typeof n=="function"?t?[n.listener||n]:[n]:t?Ane(n):lD(n,n.length)}xs.prototype.listeners=function(e){return oD(this,e,!0)},xs.prototype.rawListeners=function(e){return oD(this,e,!1)},xs.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):aD.call(i,e)},xs.prototype.listenerCount=aD;function aD(i){var e=this._events;if(e!==void 0){var t=e[i];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}xs.prototype.eventNames=function(){return this._eventsCount>0?av(this._events):[]};function lD(i,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=i[r];return t}function hne(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function Ane(i){for(var e=new Array(i.length),t=0;t<e.length;++t)e[t]=i[t].listener||i[t];return e}function dne(i,e){return new Promise(function(t,r){function n(l){i.removeListener(e,o),r(l)}function o(){typeof i.removeListener=="function"&&i.removeListener("error",n),t([].slice.call(arguments))}cD(i,e,o,{once:!0}),e!=="error"&&fne(i,n,{once:!0})})}function fne(i,e,t){typeof i.on=="function"&&cD(i,"error",e,t)}function cD(i,e,t,r){if(typeof i.on=="function")r.once?i.once(e,t):i.on(e,t);else if(typeof i.addEventListener=="function")i.addEventListener(e,function n(o){r.once&&i.removeEventListener(e,n),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var uD=kC.exports,pne={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},gne={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},mne={placeholder:gne},hD={exports:{}};(function(i){(function(e,t,r){i.exports?i.exports=r():e[t]=r()})(lf,"subtag",function(){var e="",t=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function r(g){return g.match(t)||[]}function n(g){return r(g).filter(function(b,T){return b&&T})}function o(g){return g=r(g),{language:g[1]||e,extlang:g[2]||e,script:g[3]||e,region:g[4]||e}}function l(g,b,T){Object.defineProperty(g,b,{value:T,enumerable:!0})}function s(g,b,T){function F(k){return r(k)[g]||e}l(F,"pattern",b),l(o,T,F)}return s(1,/^[a-zA-Z]{2,3}$/,"language"),s(2,/^[a-zA-Z]{3}$/,"extlang"),s(3,/^[a-zA-Z]{4}$/,"script"),s(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),l(o,"split",n),o})})(hD);var yne=hD.exports,_ne=Gre,vne=lne,nu=W4,bne=uD.EventEmitter,AD=pne,xne=mne,wne=yne;function dD(i,e){this._eventEmitter=new bne,this.options=nu({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=i}dD.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(i){return i.text!==void 0?i.text:i.place_name},render:function(i){if(i.geometry){var s=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+s[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+s.splice(1,s.length).join(",")+"</div></div></div>"}else{var e=i.text,t=e.toLowerCase().indexOf(this.query.toLowerCase()),r=this.query.length,n=e.substring(0,t),o=e.substring(t,t+r),l=e.substring(t+r);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+n+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+o+"</span>"+l+"</div></div></div>"}},popupRender:function(i){var e=i.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(i){function e(r,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var o=r.onAdd();n.appendChild(o)}if(i._controlContainer)i.addControl(this);else if(i instanceof HTMLElement)e(this,i);else if(typeof i=="string"){var t=document.querySelectorAll(i);if(t.length===0)throw new Error("Element ",i,"not found.");if(t.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,t[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(i){if(i&&typeof i!="string"&&(this._map=i),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var t=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",vne(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var r=document.createElement("div");r.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var n=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(n),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),r.appendChild(this._clearEl),r.appendChild(this._loadingEl),e.appendChild(t),e.appendChild(this._inputEl),e.appendChild(r),this._typeahead=new _ne(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),e},createIcon:function(i,e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+i+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+i),t.setAttribute("viewBox","0 0 18 18"),t.setAttribute("xml:space","preserve"),t.setAttribute("width",18),t.setAttribute("height",18),"innerHTML"in t)t.innerHTML=e;else{var r=document.createElement("div");r.innerHTML="<svg>"+e.valueOf().toString()+"</svg>";var n=r.firstChild,o=n.firstChild;t.appendChild(o)}return t},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(i){var e=(i.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(e)},_onKeyDown:function(i){var e=27,t=9;if(i.keyCode===e&&this.options.clearAndBlurOnEsc)return this._clear(i),this._inputEl.blur();var r=i.target&&i.target.shadowRoot?i.target.shadowRoot.activeElement:i.target,n=r?r.value:"";if(!n)return this.fresh=!0,i.keyCode!==t&&this.clear(i),this._clearEl.style.display="none";if(!(i.metaKey||[t,e,37,39,38,40].indexOf(i.keyCode)!==-1)){if(i.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(r.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(r.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}r.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(r.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(i){this.options.clearOnBlur&&this._clearOnBlur(i),this.options.collapsed&&this._collapse()},_onChange:function(){var i=this._typeahead.selected;if(i&&!i.geometry)i.placeId?this._geocode(i.placeId,!0,!0):this._geocode(i.text,!0);else if(i&&JSON.stringify(i)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var e;if(this._removeResultMarkers(),i.properties&&AD[i.properties.short_code])e=nu({},this.options.flyTo),this._map&&this._map.fitBounds(AD[i.properties.short_code].bbox,e);else if(i.bbox){var t=i.bbox;e=nu({},this.options.flyTo),this._map&&this._map.fitBounds([[t[0],t[1]],[t[2],t[3]]],e)}else{var r={zoom:this.options.zoom};e=nu({},r,this.options.flyTo),i.center?e.center=i.center:i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(e.center=i.geometry.coordinates),this._map&&this._map.flyTo(e)}}this.options.marker&&this._maplibregl&&this._handleMarker(i),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(i),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:i})}},_getConfigForRequest:function(){var i=["bbox","limit","proximity","countries","types","language","reverseMode"],e=this,t=i.reduce(function(r,n){return e.options[n]&&(["countries","types","language"].indexOf(n)>-1?r[n]=e.options[n].split(/[\s,]+/):r[n]=e.options[n],n==="proximity"&&e.options[n]&&typeof e.options[n].longitude=="number"&&typeof e.options[n].latitude=="number"&&(r[n]=[e.options[n].longitude,e.options[n].latitude])),r},{});return t},_geocode:function(i,e,t){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:i}),this.inputString=i;var r=null,n=this._getConfigForRequest(),o;if(this.options.localGeocoderOnly)o=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(i)){var l=i.split(/[\s(,)?]+/).map(function(b){return parseFloat(b,10)}).reverse();n.types&&n.types[0],n=nu(n,{query:l,limit:1}),"proximity"in n&&delete n.proximity,o=this.geocoderApi.reverseGeocode(n)}else n=nu(n,{query:i}),this.geocoderApi.getSuggestions?e?this.geocoderApi.searchByPlaceId&&t?o=this.geocoderApi.searchByPlaceId(n):o=this.geocoderApi.forwardGeocode(n):o=this.geocoderApi.getSuggestions(n):o=this.geocoderApi.forwardGeocode(n);var s=[];this.options.localGeocoder&&(s=this.options.localGeocoder(i),s||(s=[]));var g=[];return o.catch((function(b){r=b}).bind(this)).then((function(b){this._loadingEl.style.display="none";var T={};return b?T=b:T={type:"FeatureCollection",features:[]},T.config=n,this.fresh&&(this.fresh=!1),T.features=T.features?s.concat(T.features):s,this.options.externalGeocoder?(g=this.options.externalGeocoder(i,T.features,n)||[],g.then(function(F){return T.features=T.features?F.concat(T.features):F,T},function(){return T})):T}).bind(this)).then((function(b){if(r)throw r;this.options.filter&&b.features.length&&(b.features=b.features.filter(this.options.filter));var T=[];b.suggestions?T=b.suggestions:b.place?T=[b.place]:T=b.features,T.length?(this._clearEl.style.display="block",this._typeahead.update(T),(!this.options.showResultsWhileTyping||e)&&this.options.showResultMarkers&&(b.features.length>0||b.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",b)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",b))}).bind(this)).catch((function(b){this._loadingEl.style.display="none",s.length&&this.options.localGeocoder||g.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(s)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:s}),this._eventEmitter.emit("error",{error:b})}).bind(this)),o},_clear:function(i){i&&i.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(i){this._clear(i),this._inputEl.focus()},_clearOnBlur:function(i){var e=this;i.relatedTarget&&e._clear(i)},_onQueryResult:function(i){var e=i;if(e.features.length){var t=e.features[0];this._typeahead.selected=t,this._inputEl.value=t.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var i=this._map.getCenter().wrap();this.setProximity({longitude:i.lng,latitude:i.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(i){return this._geocode(i).then(this._onQueryResult),this},_renderError:function(){var i="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(i)},_renderNoResults:function(){var i="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(i)},_renderMessage:function(i){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(i)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var i=this.options.language.split(",")[0],e=wne.language(i),t=xne.placeholder[e];if(t)return t}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var i=this._typeahead.data.filter(function(n){return typeof n!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var e={padding:100},t=nu({},e,this.options.flyTo),r=new this._maplibregl.LngLatBounds;i.forEach(function(n){r.extend(n.geometry.coordinates)}),this._map.fitBounds(r.toArray(),t)}return i.length>0&&this._maplibregl&&this._handleResultMarkers(i),this}},setInput:function(i){return this._inputEl.value=i,this._typeahead.selected=null,this._typeahead.clear(),i.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(i),this},setProximity:function(i){return this.options.proximity=i,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(i){return i&&typeof i=="function"&&(this._typeahead.render=i),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(i){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=i||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(i){return this.options.zoom=i,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(i){return this.options.flyTo=i,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(i){return this.placeholder=i||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(i){return this.options.bbox=i,this},getCountries:function(){return this.options.countries},setCountries:function(i){return this.options.countries=i,this},getTypes:function(){return this.options.types},setTypes:function(i){return this.options.types=i,this},getMinLength:function(){return this.options.minLength},setMinLength:function(i){return this.options.minLength=i,this._typeahead&&(this._typeahead.options.minLength=i),this},getLimit:function(){return this.options.limit},setLimit:function(i){return this.options.limit=i,this._typeahead&&(this._typeahead.options.limit=i),this},getFilter:function(){return this.options.filter},setFilter:function(i){return this.options.filter=i,this},setGeocoderApi:function(i){return this.geocoderApi=i,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(i){if(this._map){this._removeMarker();var e={color:"#4668F2"},t=nu({},e,this.options.marker);this.mapMarker=new this._maplibregl.Marker(t);var r;if(this.options.popup){var n={},o=nu({},n,this.options.popup);r=new this._maplibregl.Popup(o).setHTML(this.options.popupRender(i))}return i.center?(this.mapMarker.setLngLat(i.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(r)):i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(this.mapMarker.setLngLat(i.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(r)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(i){if(this._map){this._removeResultMarkers();var e={color:"#4668F2"},t=nu({},e,this.options.showResultMarkers);return i.forEach((function(r){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var n=this.options.showResultMarkers.element.cloneNode(!0);t=nu(t,{element:n})}var o=new this._maplibregl.Marker(nu({},t,{element:n})),l;if(this.options.popup){var s={},g=nu({},s,this.options.popup);l=new this._maplibregl.Popup(g).setHTML(this.options.popupRender(r))}r.center?(o.setLngLat(r.center).addTo(this._map),this.options.popup&&o.setPopup(l)):r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(o.setLngLat(r.geometry.coordinates).addTo(this._map),this.options.popup&&o.setPopup(l)),this.resultMarkers.push(o)}).bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(i){i.remove()}),this.resultMarkers=[])},on:function(i,e){return this._eventEmitter.on(i,e),this},off:function(i,e){return this._eventEmitter.removeListener(i,e),this}};var Bne=dD;const Cne=C_(Bne),Rn={limitsUrl:"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json",geocoder:{peliasUrl1:"https://eines.icgc.cat/geocodificador/autocompletar?text=",peliasUrl2:"&layers=topo1%2Ctopo2%2Caddress&size=5"},mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json.json",maxZoom:18,maxPitch:85},logoOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/ICGC_color_norma.svg",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/ICGC_white_norma.svg",logoLink:"https://www.icgc.cat",logoTitle:"Institut Cartogrfic i Geolgic de Catalunya",logoWidth:100},map3dOptions:{spaceErrorFactor:2,exaggeration:1,zfactor:49,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"https://tilemaps.icgc.cat/vector/3dtiles/ciutats/v1/tilesetV1.0.json",layerIdOrder:"place-isolated",sourceLayerFilterId:"place",minZoomFilter:15,layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d",imageIcon:"https://tilemaps.icgc.cat/cdn/images/stick.png"},baseStyles:{0:{key:"TOPO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},1:{key:"ORTO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},2:{key:"ORTO3D",url:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},3:{key:"ADMIN",url:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},4:{key:"DARK",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},5:{key:"LIGHT",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},6:{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"}},urlTerrainICGC:{0:{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},1:{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}},ortoLayersICGC:{0:{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},1:{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},2:{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},3:{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},4:{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},5:{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},6:{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},7:{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},8:{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},9:{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},10:{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},11:{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},12:{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},13:{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},14:{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},15:{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},16:{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},17:{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},18:{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},19:{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},20:{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},21:{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},22:{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},23:{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},24:{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},25:{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},26:{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},27:{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},28:{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},29:{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},30:{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},31:{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},32:{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},33:{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},34:{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},35:{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},36:{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},37:{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},38:{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},39:{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},40:{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},41:{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},42:{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},43:{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},44:{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},45:{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}},vectorLayersICGC:{0:{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015"},1:{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016"},2:{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017"},3:{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018"},4:{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019"},5:{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020"},6:{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021"},7:{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent"},8:{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text"},9:{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019"},10:{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020"},11:{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022"},12:{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent"},13:{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text"},14:{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent"},15:{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent"},16:{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text"},17:{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent"},18:{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent"},19:{name:"catalunyaVigent",key:"catalunya_vigent"},20:{name:"catalunyaVigentText",key:"catalunya_vigent_text"},21:{name:"comarques2022",key:"comarques_2022"},22:{name:"comarquesVigent",key:"comarques_vigent"},23:{name:"comarquesVigentText",key:"comarques_vigent_text"},24:{name:"districtesCensals2002",key:"districtes_censals_2002"},25:{name:"districtesCensals2003",key:"districtes_censals_2003"},26:{name:"districtesCensals2004",key:"districtes_censals_2004"},27:{name:"districtesCensals2005",key:"districtes_censals_2005"},28:{name:"districtesCensals2006",key:"districtes_censals_2006"},29:{name:"districtesCensals2007",key:"districtes_censals_2007"},30:{name:"districtesCensals2008",key:"districtes_censals_2008"},31:{name:"districtesCensals2009",key:"districtes_censals_2009"},32:{name:"districtesCensals2010",key:"districtes_censals_2010"},33:{name:"districtesCensals2011",key:"districtes_censals_2011"},34:{name:"districtesCensals2012",key:"districtes_censals_2012"},35:{name:"districtesCensals2013",key:"districtes_censals_2013"},36:{name:"districtesCensals2014",key:"districtes_censals_2014"},37:{name:"districtesCensals2015",key:"districtes_censals_2015"},38:{name:"districtesCensals2016",key:"districtes_censals_2016"},39:{name:"districtesCensals2017",key:"districtes_censals_2017"},40:{name:"districtesCensals2018",key:"districtes_censals_2018"},41:{name:"districtesCensals2019",key:"districtes_censals_2019"},42:{name:"districtesCensals2020",key:"districtes_censals_2020"},43:{name:"districtesCensals2021",key:"districtes_censals_2021"},44:{name:"districtesCensals2022",key:"districtes_censals_2022"},45:{name:"districtesCensalsVigent",key:"districtes_censals_vigent"},46:{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text"},47:{name:"incendisForestalsVigent",key:"incendis_forestals_vigent"},48:{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text"},49:{name:"municipis2022",key:"municipis_2022"},50:{name:"municipis2022Text",key:"municipis_2022_text"},51:{name:"municipisVigent",key:"municipis_vigent"},52:{name:"municipisVigentText",key:"municipis_vigent_text"},53:{name:"partitsJudicialsVigent",key:"partits_judicials_vigent"},54:{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text"},55:{name:"plaTerritorial2015",key:"pla_territorial_2015"},56:{name:"plaTerritorialVigent",key:"pla_territorial_vigent"},57:{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text"},58:{name:"provinciesVigent",key:"provincies_vigent"},59:{name:"provinciesVigentText",key:"provincies_vigent_text"},60:{name:"regionsPolicialsVigent",key:"regions_policials_vigent"},61:{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text"},62:{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent"},63:{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text"},64:{name:"seccionsCensals2002",key:"seccions_censals_2002"},65:{name:"seccionsCensals2003",key:"seccions_censals_2003"},66:{name:"seccionsCensals2004",key:"seccions_censals_2004"},67:{name:"seccionsCensals2005",key:"seccions_censals_2005"},68:{name:"seccionsCensals2006",key:"seccions_censals_2006"},69:{name:"seccionsCensals2007",key:"seccions_censals_2007"},70:{name:"seccionsCensals2008",key:"seccions_censals_2008"},71:{name:"seccionsCensals2009",key:"seccions_censals_2009"},72:{name:"seccionsCensals2010",key:"seccions_censals_2010"},73:{name:"seccionsCensals2011",key:"seccions_censals_2011"},74:{name:"seccionsCensals2012",key:"seccions_censals_2012"},75:{name:"seccionsCensals2013",key:"seccions_censals_2013"},76:{name:"seccionsCensals2014",key:"seccions_censals_2014"},77:{name:"seccionsCensals2015",key:"seccions_censals_2015"},78:{name:"seccionsCensals2016",key:"seccions_censals_2016"},79:{name:"seccionsCensals2017",key:"seccions_censals_2017"},80:{name:"seccionsCensals2018",key:"seccions_censals_2018"},81:{name:"seccionsCensals2019",key:"seccions_censals_2019"},82:{name:"seccionsCensals2020",key:"seccions_censals_2020"},83:{name:"seccionsCensals2021",key:"seccions_censals_2021"},84:{name:"seccionsCensals2022",key:"seccions_censals_2022"},85:{name:"seccionsCensalsVigent",key:"seccions_censals_vigent"},86:{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text"},87:{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent"},88:{name:"vegueriesVigent",key:"vegueries_vigent"},89:{name:"vegueriesVigentText",key:"vegueries_vigent_text"}},vectorLayers:{0:{key:"altimetria",layer:"",url:"https://betaserver.icgc.cat/tileserver3/tileserver.php/alti_bt5m/{z}/{x}/{y}.pbf"},1:{key:"cobertes2018",url:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"}},wmsLayers:{0:{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},1:{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},2:{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},3:{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},4:{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},5:{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},6:{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}},fgbLayers:{0:{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},1:{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},2:{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},3:{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},4:{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},5:{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},6:{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},7:{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},8:{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},9:{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},10:{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},11:{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},12:{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},13:{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},14:{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},15:{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},16:{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},17:{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},18:{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},19:{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},20:{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},21:{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},22:{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},23:{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},24:{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},25:{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},26:{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},27:{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},28:{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},29:{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},30:{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},31:{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},32:{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},33:{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}}};class Ene{constructor(e){this.options=e}onAdd(e){return this._map=e,this._img=document.createElement("img"),this._img.className="maplibregl-ctrl",this._img.src=this.options.color?Rn.logoOptions.logoUrlColor:Rn.logoOptions.logoUrlWhite,this._img.width=Rn.logoOptions.logoWidth,this._img.title=Rn.logoOptions.logoTitle,this.link=document.createElement("a"),this.link.href=Rn.logoOptions.logoLink,this.link.target="_blank",this.link.appendChild(this._img),this._container=document.createElement("div"),this._container.className="maplibregl-ctrl",this._container.style=`width:${Rn.logoOptions.logoWidth}px`,this._container.appendChild(this.link),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}const cv={ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},Pg={TOPO:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard_general.json",ORTO:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",ORTO3D:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",ADMIN:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",DARK:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json"},Ga={Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"agrupacions_censals_2015",agrupacionsCensals2016:"agrupacions_censals_2016",agrupacionsCensals2017:"agrupacions_censals_2017",agrupacionsCensals2018:"agrupacions_censals_2018",agrupacionsCensals2019:"agrupacions_censals_2019",agrupacionsCensals2020:"agrupacions_censals_2020",agrupacionsCensals2021:"agrupacions_censals_2021",agrupacionsCensalsVigent:"agrupacions_censals_vigent",agrupacionsCensalsVigentText:"agrupacions_censals_vigent_text",areesBasiquesPolicials2019:"arees_basiques_policials_2019",areesBasiquesPolicials2020:"arees_basiques_policials_2020",areesBasiquesPolicials2022:"arees_basiques_policials_2022",areesBasiquesPolicialsVigent:"arees_basiques_policials_vigent",areesBasiquesPolicialsVigentText:"arees_basiques_policials_vigent_text",areesBasiquesSalutVigent:"arees_basiques_salut_vigent",areesBasiquesServeisSocialsVigent:"arees_basiques_serveis_socials_vigent",areesBasiquesServeisSocialsVigentText:"arees_basiques_serveis_socials_vigent_text",areesGestioAssistencialVigent:"arees_gestio_assistencial_vigent",areesHidrogeologiquesAquifersVigent:"arees_hidrogeologiques_aquifers_vigent",catalunyaVigent:"catalunya_vigent",catalunyaVigentText:"catalunya_vigent_text",comarques2022:"comarques_2022",comarquesVigent:"comarques_vigent",comarquesVigentText:"comarques_vigent_text",districtesCensals2002:"districtes_censals_2002",districtesCensals2003:"districtes_censals_2003",districtesCensals2004:"districtes_censals_2004",districtesCensals2005:"districtes_censals_2005",districtesCensals2006:"districtes_censals_2006",districtesCensals2007:"districtes_censals_2007",districtesCensals2008:"districtes_censals_2008",districtesCensals2009:"districtes_censals_2009",districtesCensals2010:"districtes_censals_2010",districtesCensals2011:"districtes_censals_2011",districtesCensals2012:"districtes_censals_2012",districtesCensals2013:"districtes_censals_2013",districtesCensals2014:"districtes_censals_2014",districtesCensals2015:"districtes_censals_2015",districtesCensals2016:"districtes_censals_2016",districtesCensals2017:"districtes_censals_2017",districtesCensals2018:"districtes_censals_2018",districtesCensals2019:"districtes_censals_2019",districtesCensals2020:"districtes_censals_2020",districtesCensals2021:"districtes_censals_2021",districtesCensals2022:"districtes_censals_2022",districtesCensalsVigent:"districtes_censals_vigent",districtesCensalsVigentText:"districtes_censals_vigent_text",incendisForestalsVigent:"incendis_forestals_vigent",incendisForestalsVigentText:"incendis_forestals_vigent_text",municipis2022:"municipis_2022",municipis2022Text:"municipis_2022_text",municipisVigent:"municipis_vigent",municipisVigentText:"municipis_vigent_text",partitsJudicialsVigent:"partits_judicials_vigent",partitsJudicialsVigentText:"partits_judicials_vigent_text",plaTerritorial2015:"pla_territorial_2015",plaTerritorialVigent:"pla_territorial_vigent",plaTerritorialVigentText:"pla_territorial_vigent_text",provinciesVigent:"provincies_vigent",provinciesVigentText:"provincies_vigent_text",regionsPolicialsVigent:"regions_policials_vigent",regionsPolicialsVigentText:"regions_policials_vigent_text",regionsSanitariesVigent:"regions_sanitaries_vigent",regionsSanitariesVigentText:"regions_sanitaries_vigent_text",seccionsCensals2002:"seccions_censals_2002",seccionsCensals2003:"seccions_censals_2003",seccionsCensals2004:"seccions_censals_2004",seccionsCensals2005:"seccions_censals_2005",seccionsCensals2006:"seccions_censals_2006",seccionsCensals2007:"seccions_censals_2007",seccionsCensals2008:"seccions_censals_2008",seccionsCensals2009:"seccions_censals_2009",seccionsCensals2010:"seccions_censals_2010",seccionsCensals2011:"seccions_censals_2011",seccionsCensals2012:"seccions_censals_2012",seccionsCensals2013:"seccions_censals_2013",seccionsCensals2014:"seccions_censals_2014",seccionsCensals2015:"seccions_censals_2015",seccionsCensals2016:"seccions_censals_2016",seccionsCensals2017:"seccions_censals_2017",seccionsCensals2018:"seccions_censals_2018",seccionsCensals2019:"seccions_censals_2019",seccionsCensals2020:"seccions_censals_2020",seccionsCensals2021:"seccions_censals_2021",seccionsCensals2022:"seccions_censals_2022",seccionsCensalsVigent:"seccions_censals_vigent",seccionsCensalsVigentText:"seccions_censals_vigent_text",sectorsSanitarisVigent:"sectors_sanitaris_vigent",vegueriesVigent:"vegueries_vigent",vegueriesVigentText:"vegueries_vigent_text"},FGBAdmin:{agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"},Vector:{altimetria:"https://betaserver.icgc.cat/tileserver3/tileserver.php/alti_bt5m/{z}/{x}/{y}.pbf",cobertes2018:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"}};let Sne=class{constructor(e){if(!e)e=Rn.mapOptions;else for(const t in Rn.mapOptions){let r=[Rn.mapOptions.center[0],Rn.mapOptions.center[1]];Rn.mapOptions.center=r,e.hasOwnProperty(t)||(e[t]=Rn.mapOptions[t])}e.maxPitch=85,e.maplibreLogo=!1,e.attributionControl=!1,this.map=new ic.Map(e),this.map.options=e,this.map.addControl(new ic.AttributionControl({compact:!0})),this.map.on("load",async()=>{const t=this.map.getStyle().name;if(window.document.querySelector(".maplibregl-compact-show")){var r=window.document.querySelector(".maplibregl-compact-show");r.classList.remove("maplibregl-compact-show")}this.map.addControl(new Ene({color:t.indexOf("orto")===-1}),"bottom-left"),this._dealOrto3dStyle(t)})}addGeocoderICGC(e){try{e===void 0&&(e="top-right");let t={collapsed:!0,marker:!0,popup:!0,showResultMarkers:!0,maplibregl:ic,showResultsWhileTyping:!0,minLength:2};const r={forwardGeocode:async o=>{const l=[];try{const s=Rn.geocoder.peliasUrl1+encodeURIComponent(o.query)+Rn.geocoder.peliasUrl2,b=await(await fetch(s)).json();for(const T of b.features){const F=T.geometry.coordinates,k={type:"Feature",geometry:{type:"Point",coordinates:F},place_name:T.properties.label,properties:T.properties,text:T.properties.label,place_type:["place"],center:F};l.push(k)}}catch(s){console.error(`Failed to forwardGeocode with error: ${s}`)}return{features:l}}};this.map.addControl(new Cne(r,t),e);let n=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");n[0].attributes[2].nodeValue="Cerca...",n[0].addEventListener("input",function(o){o.target.value.length>3})}catch(t){console.error(`Error adding ICGC geocoder: ${t.message}`)}}getStyle(){try{return this.map.getStyle()}catch(e){console.error(`Error getting style: ${e.message}`)}}async loadImage(e){try{return this.map.loadImage(e)}catch(t){console.error(`Error getting loadImage: ${t.message}`)}}addImage(e,t){try{return this.map.addImage(e,t)}catch(r){console.error(`Error getting addImage: ${r.message}`)}}getConfigStyles(){try{let e=[];for(const t of Pg)e.push(t.name);return e}catch(e){console.error(`Error retrieving base styles: ${e.message}`)}}getConfigWMSLayers(){try{let e=[];for(const t in Ga.WMS)Ga.WMS.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving WMS layers: ${e.message}`)}}getConfigOrtoLayers(){try{let e=[];for(const t in Ga.Orto)Ga.Orto.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving orto image layers: ${e.message}`)}}getConfigVectorLayers(){try{let e=[];for(const t in Ga.Vector)Ga.Vector.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vector layers: ${e.message}`)}}getConfigVectorAdminLayers(){try{let e=[];for(const t in Ga.VectorAdmin)Ga.VectorAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vectorAdmin layers: ${e.message}`)}}getConfigFGBAdminLayers(){try{let e=[];for(const t in Ga.FGBAdmin)Ga.FGBAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving FGBAdmin layers: ${e.message}`)}}async fetchData(e,t,r){try{const o=await(await fetch(e)).json();let l=o.features[0].geometry.type;l.includes("ine")&&(r!==void 0?map.addLayer({id:t,type:"line",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:r}):map.addLayer({id:t,type:"line",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}})),l.includes("olygon")&&(r!==void 0?map.addLayer({id:t,type:"fill",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:r}):map.addLayer({id:t,type:"fill",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}})),l.includes("oint")&&(r!==void 0?map.addLayer({id:t,type:"circle",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:r}):map.addLayer({id:t,type:"circle",source:{type:"geojson",data:o},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}}))}catch(n){console.error(`Error fetching data: ${n.message}`)}}async fetchDataAndMenu(e,t,r,n){try{const l=await(await fetch(e)).json(),s=document.getElementById("menu-group");if(r!=="all"){const b=document.createElement("div");b.id="titleDivMenu",b.textContent=t,s.appendChild(b);const T=document.createElement("div");T.id="titleDivMenuSub",T.textContent=` ${r}`,s.appendChild(T)}let g=l.features[0].geometry.type;if(r==="all")g.includes("ine")&&(n!==void 0?map.addLayer({id:t,type:"line",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:n}):map.addLayer({id:t,type:"line",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}})),g.includes("olygon")&&(n!==void 0?map.addLayer({id:t,type:"fill",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:n}):map.addLayer({id:t,type:"fill",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}})),g.includes("oint")&&(n!==void 0?map.addLayer({id:t,type:"circle",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:n}):map.addLayer({id:t,type:"circle",source:{type:"geojson",data:l},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}})),map.addMenuItem(t);else{let b=r;const T={};l.features.forEach(F=>{const k=F.properties[b];k!==null&&(T[k]||(g.includes("ine")&&(n!==void 0?map.addLayer({id:k,type:"line",source:{type:"geojson",data:l},layout:{visibility:"visible"},filter:["==",`${b}`,k],paint:n}):map.addLayer({id:k,type:"line",source:{type:"geojson",data:l},layout:{visibility:"visible"},filter:["==",`${b}`,k],paint:{"line-color":"black","line-width":2,"line-opacity":1}})),g.includes("olygon")&&(n!==void 0?map.addLayer({id:k,type:"fill",source:{type:"geojson",data:l},layout:{visibility:"visible"},filter:["==",`${b}`,k],paint:n}):map.addLayer({id:k,type:"fill",source:{type:"geojson",data:l},layout:{visibility:"visible"},filter:["==",`${b}`,k],paint:{"fill-color":"blue","fill-opacity":.6}})),g.includes("oint")&&(n!==void 0?map.addLayer({id:k,type:"circle",source:{type:"geojson",data:l},layout:{visibility:"visible"},filter:["==",`${b}`,k],paint:n}):map.addLayer({id:k,type:"circle",source:{type:"geojson",data:l},layout:{visibility:"visible"},filter:["==",`${b}`,k],paint:{"circle-color":"red","circle-opacity":.85}})),T[k]=!0,map.addMenuItem(k)))})}}catch(o){console.error(`Error fetching data: ${o.message}`)}}on(e,t){try{this.map.on(e,t)}catch(r){console.error(`Error adding event listener: ${r.message}`)}}getSource(e){try{return this.map.getSource(e)}catch(t){console.error(`Error getting source: ${t.message}`)}}addSource(e,t){try{this.map.addSource(e,t)}catch(r){console.error(`Error adding source: ${r.message}`)}}setStyle(e,t){try{t!==void 0?this.map.setStyle(e,t):this.map.setStyle(e),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var r=window.document.querySelector(".maplibregl-compact-show");r.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(r){console.error(`Error setting style: ${r.message}`)}}getLayer(e){try{return this.map.getLayer(e)}catch(t){console.error(`Error getting layer: ${t.message}`)}}setFilter(e,t,r){try{return this.map.setFilter(e,t,r)}catch(n){console.error(`Error setting filter: ${n.message}`)}}jumpTo(e){try{this.map.jumpTo(e)}catch(t){console.error(`Error jumping to ${e}: ${t.message}`)}}setLayoutProperty(e,t,r){try{this.map.setLayoutProperty(e,t,r)}catch(n){console.error(`Error setting layout property: ${n.message}`)}}setPaintProperty(e,t,r){try{this.map.setPaintProperty(e,t,r)}catch(n){console.error(`Error setting paint property: ${n.message}`)}}addControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(e,t)}catch(r){console.error(`Error adding control: ${r.message}`)}}getZoom(){try{return this.map.getZoom()}catch(e){console.error(`Error getting zoom level: ${e.message}`)}}addMouseCoordControl(){try{this.map.on("mousemove",function(e){const t=e.lngLat.lat,n="Lon/Lat (WGS 84)   Lon: "+e.lngLat.lng.toFixed(6)+"  Lat: "+t.toFixed(6),o=document.getElementById("divInfo"),l=document.createElement("div");l.className="coordControl",l.innerHTML=n+" - ZL: "+map.getZoom().toFixed(1),o.appendChild(l)})}catch(e){console.error(`Error adding mouse coordinate control: ${e.message}`)}}addGeolocateControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new ic.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),t):this.map.addControl(new ic.GeolocateControl(e),t)}catch(r){console.error(`Error adding geolocate control: ${r.message}`)}}getBounds(){try{return this.map.getBounds()}catch(e){console.error(`Error getting bounds: ${e.message}`)}}getCenter(){try{return this.map.getCenter()}catch(e){console.error(`Error getting center: ${e.message}`)}}setTerrain(e){try{return this.map.setTerrain(e)}catch(t){console.error(`Error setting terrain: ${t.message}`)}}setLayerZoomRange(e,t,r){try{return this.map.setLayerZoomRange(e,t,r)}catch(n){console.error(`Error setting terrain: ${n.message}`)}}getCanvas(){try{return this.map.getCanvas()}catch(e){console.error(`Error getting canvas: ${e.message}`)}}setCenter(e){try{return this.map.setCenter(e)}catch(t){console.error(`Error setting center: ${t.message}`)}}addLayer(e,t){try{this.map.addLayer(e,t)}catch(r){console.error(`Error adding layer: ${r.message}`)}}addLayerGeoJSON(e){try{this.map.addSource(`${e.id}-sourceIcgcMap`,{type:"geojson",data:e.data}),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:e.layerType,source:`${e.id}-sourceIcgcMap`,layout:e.layout,paint:e.paint})}catch(t){console.error(`Error adding GeoJSON layer: ${t.message}`)}}addLayerWMS(e){try{console.log("holaaddlayerwms",e),this.map.addSource(`${e.id}-sourceIcgcMap`,{type:"raster",tiles:[e.tiles],tileSize:256}),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:"raster",source:`${e.id}-sourceIcgcMap`,paint:{}})}catch(t){console.error(`Error adding WMS layer: ${t.message}`)}}removeControl(e){try{this.map.removeControl(e)}catch(t){console.error(`Error removing control: ${t.message}`)}}removeLayer(e){try{this.map.removeLayer(e)}catch(t){console.error(`Error removing layer: ${t.message}`)}}removeSource(e){try{this.map.removeSource(e)}catch(t){console.error(`Error removing source: ${t.message}`)}}addLogo(e){try{const t=document.createElement("img");t.src=e.url,t.style.height="62px";const r=document.getElementById("logos"),n=document.createElement("a");n.id=e.id,n.href=e.href,n.target="_blank",n.style.position="relative",n.style.bottom="1px",n.appendChild(t),r.appendChild(n)}catch(t){console.error(`Error adding logo: ${t.message}`)}}addBasemapsICGC(e){try{const t=n=>{this.map.setStyle(n)},r=document.getElementById("basemap-group");for(const n of e)for(const o of Object.keys(Rn.baseStyles)){const l=Rn.baseStyles[o];if(n===l.url){const s=document.createElement("div");s.className="basemap-item",s.title=l.key,s.style.backgroundImage=`url('${l.image}')`,r.appendChild(s),s.addEventListener("click",()=>t(l.url))}}}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addBasemaps(e){try{const t=n=>{console.log("base",n),this.map.setStyle(n.url)},r=document.getElementById("basemap-group");e.forEach(n=>{const o=document.createElement("div");o.className="basemap-item",o.title=n.label,o.style.backgroundImage=`url('${n.image}')`,r.appendChild(o),o.addEventListener("click",()=>t(n))})}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addFeatureQuery(e,t){try{let r;this.map.on("mouseenter",e,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",e,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",n=>{let o=this.map.queryRenderedFeatures(n.point);if(o&&o[0].source===e){let l=[n.lngLat.lng,n.lngLat.lat];if(console.log("es aqui3331??",t.length),t!==void 0&&t.length>0){if(t!==null){let s="";t.forEach(g=>{let b=o[0].properties[g];s=s+`<h4>${b}</h4>`}),r=s,map.addPopup(l,r)}}else{let s="";for(const g in o[0].properties)s+="<b>"+g+"</b>:"+o[0].properties[g]+"<br>";r=s,map.addPopup(l,r)}}})}catch(r){console.error(`Error adding feature query: ${r.message}`)}}addScaleControl(e,t){try{var r=new ic.ScaleControl(e);this.map.addControl(r,t)}catch(n){console.error(`Error adding scale: ${n.message}`)}}addExportControl(e,t){try{typeof e=="string"&&(t=e,e=void 0),e===void 0&&(e={PageSize:Lg.A4,PageOrientation:Qy.Landscape,Format:vd.PNG,DPI:FC[300],Crosshair:!0,PrintableArea:!0},t="top-right"),map.addControl(new Rre(e),t)}catch(r){console.error(`Error adding export control: ${r.message}`)}}addPopup(e,t){try{new ic.Popup().setLngLat(e).setHTML(t).addTo(this.map)}catch{}}addMarker(e){try{let t,r;return e.text===void 0?t=new ic.Marker(e.options).setLngLat(e.coord).addTo(this.map):(r=new ic.Popup({offset:e.textOffset}).setText(e.text),t=new ic.Marker().setLngLat(e.coord).setPopup(r).addTo(this.map)),t}catch(t){return console.error(`Error adding marker: ${t.message}`),null}}addPopup(e,t){try{return new ic.Popup().setLngLat(e).setHTML(t).addTo(this.map)}catch(r){return console.error(`Error adding popup: ${r.message}`),null}}addFullScreen(e){try{e===void 0&&(e="top-right"),this.map.addControl(new ic.FullscreenControl,e)}catch(t){console.error(`Error adding fullscreen control: ${t.message}`)}}addMenuItem(e){try{if(e.length>0){const t=document.getElementById("menu-group"),r=document.createElement("input");r.type="checkbox",r.id=e,r.checked=!0,t.appendChild(r);const n=document.createElement("label");n.setAttribute("for",e),n.textContent=e,t.appendChild(n),r.addEventListener("change",o=>{this.map.setLayoutProperty(e,"visibility",o.target.checked?"visible":"none")})}}catch(t){console.error(`Error adding menu item: ${t.message}`)}}addLayerTree(e){try{let t=e.features;const r=document.getElementById("filter-group"),n=this.map.getStyle().layers;let o;console.log("es aqui12??",n.length);for(let l=0;l<n.length;l++)if(n[l].type==="symbol"){o=n[l].id;break}this.map.addSource(`${e.id}-source`,{type:e.type,data:t}),t.features.forEach(l=>{const s=l.properties.icon,g=`poi-${s}`;if(!this.map.getLayer(g)){this.map.addLayer({id:g,type:"circle",source:`${e.id}-source`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",s]},o);const b=document.createElement("input");b.type="checkbox",b.id=g,b.checked=!0,r.appendChild(b);const T=document.createElement("label");T.setAttribute("for",g),T.textContent=s,r.appendChild(T),b.addEventListener("change",F=>{this.map.setLayoutProperty(g,"visibility",F.target.checked?"visible":"none")})}})}catch(t){console.error(`Error adding layer tree: ${t.message}`)}}createNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new ic.NavigationControl(e),t)}catch(r){return console.error(`Error creating navigation control: ${r.message}`),null}}addNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new ic.NavigationControl(e),t)}catch(r){console.error(`Error adding navigation control: ${r.message}`)}}addAttributionControl(e){try{this.map.addControl(new ic.AttributionControl(e.options),e.position)}catch(t){console.error(`Error adding attribution control: ${t.message}`)}}_dealStyleMaps(e){try{if(e&&e.indexOf("icgc.cat")!=-1){for(const t in Pg)if(Pg.hasOwnProperty(t)){const r=Pg[t];if(t===e)return r}return Pg[0]}else return e}catch(t){return console.error(`Error dealing with map styles: ${t.message}`),null}}addImageLayerICGC(e){try{let r=function(o,l,s,g,b){console.log("hola",e);const T=[l,s,g,b];for(const F of T)for(const[k,z]of Object.entries(F))if(z===o)return k;return null};console.log("name",e);let t=null;t=r(e,Ga.Orto,Ga.VectorAdmin,Ga.WMS,Ga.Vector),console.log("op",t),t||console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");let n={id:t,tiles:e};console.log("source",n),this.addLayerWMS(n)}catch(t){console.error(`Error adding ICGC image layer: ${t.message}`)}}async addVectorLayerICGC(e,t){try{let r=e;if(r===null)console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",r,"font-weight: bold; font-style: italic;");else{let n="limitsSource";this.map.addSource(n,{type:"vector",url:Rn.limitsUrl}),this.map.addLayer({id:r+"-fill",type:"fill",source:n,"source-layer":r,paint:{"fill-color":"#0000FF","fill-opacity":0}}),this.map.addLayer({id:r+"-underline",type:"line",source:n,"source-layer":r,paint:{"line-color":"#ffffff","line-opacity":1,"line-width":3}}),t?this.map.addLayer({id:r+"-line",type:"line",source:n,"source-layer":r,paint:t}):this.map.addLayer({id:r+"-line",type:"line",source:n,"source-layer":r,paint:{"line-color":"#4832a8","line-opacity":1,"line-width":1}})}}catch(r){console.error(`Error adding ICGC vector layer: ${r.message}`)}}async addFGBLayerICGC(e,t,r){try{let o=function(l){for(const s in Ga.FGBAdmin)if(Ga.FGBAdmin.hasOwnProperty(s)&&Ga.FGBAdmin[s]===l)return s;return null}(e);if(o===null)console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",o,"font-weight: bold; font-style: italic;");else{const l=await fetch(e),s={type:"FeatureCollection",features:[]};for await(const b of zz(l.body))s.features.push(b);let g=o+"-source";if(this.map.addSource(g,{type:"geojson",data:s}),e.includes("text"))this.map.addLayer({id:o,type:"symbol",source:g,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:t,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}});else{this.map.addLayer({id:o+"-fill",type:"fill",source:g,paint:{"fill-color":"#0000FF","fill-opacity":0}}),this.map.addLayer({id:o+"-underline",type:"line",source:g,paint:{"line-color":"#ffffff","line-opacity":1,"line-width":3}}),r?this.map.addLayer({id:o+"-line",type:"line",source:g,paint:r}):this.map.addLayer({id:o+"-line",type:"line",source:g,paint:{"line-color":"#4832a8","line-opacity":1,"line-width":1}});let b=o+"Text";this.map.addLayer({id:b,type:"symbol",source:g,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:t,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}})}}}catch(n){console.error(`Error adding ICGC vector layer: ${n.message}`)}}addTerrainICGC(e,t){try{let r;for(const o in cv)if(cv.hasOwnProperty(o)){const l=cv[o];l===e&&(r=l)}let n=r;e.includes("terrarium")?this.map.addSource("terrainICGC-src",{type:"raster-dem",tiles:[n],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC-src",{type:"raster-dem",tiles:[n],tileSize:512,maxzoom:16}),this.map.setTerrain({source:"terrainICGC-src",exaggeration:1.5}),t===void 0&&(t="top-right"),this.map.addControl(new Qz({pitch:90,bearing:null,minpitchzoom:null}),t)}catch(r){console.error(`Error adding 3D terrain: ${r.message}`)}}async _raiseText3DStyle(){try{const e=await this.map.loadImage(Rn.map3dOptions.imageIcon);this.map.addImage("stick",e.data),this.map.getStyle().layers.forEach(t=>{if(t["source-layer"]===Rn.map3dOptions.sourceLayerFilterId&&t.minzoom>=Rn.map3dOptions.minZoomFilter&&e){const r=t.id;this.map.setLayoutProperty(r,"icon-image","stick"),this.map.setLayoutProperty(r,"text-offset",[0,-9]),this.map.setLayoutProperty(r,"symbol-placement","point"),this.map.setLayoutProperty(r,"symbol-avoid-edges",!1),this.map.setLayoutProperty(r,"text-allow-overlap",!0),this.map.setLayoutProperty(r,"text-ignore-placement",!1),this.map.setLayoutProperty(r,"text-pitch-alignment","auto"),this.map.setLayoutProperty(r,"text-rotation-alignment","auto"),this.map.setLayoutProperty(r,"text-justify","center"),this.map.setLayoutProperty(r,"text-anchor","bottom"),this.map.setLayoutProperty(r,"icon-anchor","bottom"),this.map.setPaintProperty(r,"text-color","#ffffff"),this.map.setPaintProperty(r,"text-halo-color","#000000"),this.map.setPaintProperty(r,"text-halo-width",2)}})}catch(e){return console.error(`Error dealing orto 3D: ${e.message}`),null}}_dealOrto3dStyle(e){try{if(e=="orto3d"){this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const t=new kL({intensity:4}),r=new Q2({ambientLight:t});this.map.setTerrain({source:Rn.map3dOptions.terrainSource,exaggeration:Rn.map3dOptions.exaggeration});const n=this._createCitiesMapboxLayer();this.map.getLayer(Rn.map3dOptions.layerId3d)||(this.map.addLayer(n,Rn.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(Rn.map3dOptions.layerId3d,Rn.map3dOptions.minZoomRange,Rn.map3dOptions.maxZoomRange),n.deck.setProps({effects:[r]}),this._raiseText3DStyle())}else this.map.getLayer(Rn.map3dOptions.layerId3d)&&(this.map.removeLayer(Rn.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_createCitiesMapboxLayer(){try{return new yX({id:Rn.map3dOptions.layerId3d,type:hC,data:Rn.map3dOptions.urlTilesetCities,loader:uC,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!1,maximumScreenSpaceError:Rn.map3dOptions.spaceErrorFactor}},onTilesetLoad:t=>{t.options.maximumScreenSpaceError=Rn.map3dOptions.spaceErrorFactor},onTileLoad:t=>{t.content.cartographicOrigin.z-=Rn.map3dOptions.zfactor},operation:"terrain+draw"})}catch(e){return console.error(`Error adding MapboxLayer: ${e.message}`),null}}};var fD={exports:{}};function Tne(i,e){var t=i.getCenter(),r=i.getZoom(),n=i.getBearing(),o=i.getPitch();e.forEach(function(l){l.jumpTo({center:t,zoom:r,bearing:n,pitch:o})})}function Ine(){var i,e=arguments.length;if(e===1)i=arguments[0];else{i=[];for(var t=0;t<e;t++)i.push(arguments[t])}var r=[];i.forEach(function(s,g){r[g]=l.bind(null,s,i.filter(function(b,T){return T!==g}))});function n(){i.forEach(function(s,g){s.on("move",r[g])})}function o(){i.forEach(function(s,g){s.off("move",r[g])})}function l(s,g){o(),Tne(s,g),n()}return n(),function(){o(),r=[],i=[]}}var Lne=Ine;(function(i){var e=Lne,t=uD.EventEmitter;function r(n,o,l,s){if(this.options=s||{},this._mapA=n,this._mapB=o,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new t,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof l=="string"&&document.body.querySelectorAll){var g=document.body.querySelectorAll(l)[0];if(!g)throw new Error("Cannot find element with specified container selector.");g.appendChild(this._controlContainer)}else if(l instanceof Element&&l.appendChild)l.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=o.getContainer().getBoundingClientRect();var b=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(b),this._clearSync=e(n,o),this._onResize=(function(){this._bounds=o.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),o.on("resize",this._onResize),this.options&&this.options.mousemove&&(n.getContainer().addEventListener("mousemove",this._onMove),o.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}r.prototype={_setPointerEvents:function(n){this._controlContainer.style.pointerEvents=n,this._swiper.style.pointerEvents=n},_onDown:function(n){n.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(n){n=Math.min(n,this._horizontal?this._bounds.height:this._bounds.width);var o=this._horizontal?"translate(0, "+n+"px)":"translate("+n+"px, 0)";this._controlContainer.style.transform=o,this._controlContainer.style.WebkitTransform=o;var l=this._horizontal?"rect(0, 999em, "+n+"px, 0)":"rect(0, "+n+"px, "+this._bounds.height+"px, 0)",s=this._horizontal?"rect("+n+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+n+"px)";this._mapA.getContainer().style.clip=l,this._mapB.getContainer().style.clip=s,this.currentPosition=n},_onMove:function(n){this.options&&this.options.mousemove&&this._setPointerEvents(n.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(n)):this._setPosition(this._getX(n))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(n){n=n.touches?n.touches[0]:n;var o=n.clientX-this._bounds.left;return o<0&&(o=0),o>this._bounds.width&&(o=this._bounds.width),o},_getY:function(n){n=n.touches?n.touches[0]:n;var o=n.clientY-this._bounds.top;return o<0&&(o=0),o>this._bounds.height&&(o=this._bounds.height),o},setSlider:function(n){this._setPosition(n)},on:function(n,o){return this._ev.on(n,o),this},fire:function(n,o){return this._ev.emit(n,o),this},off:function(n,o){return this._ev.removeListener(n,o),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var n=this._mapA.getContainer();n&&(n.style.clip=null,n.removeEventListener("mousemove",this._onMove));var o=this._mapB.getContainer();o&&(o.style.clip=null,o.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=r:i.exports=r})(fD);var Mne=fD.exports;const Pne=C_(Mne);class Fne{constructor(e,t,r,n){this.mapCompare=new Pne(e.map,t.map,r,{})}}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var OC=function(i,e){return OC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])},OC(i,e)};function hh(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");OC(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var UC=function(){return UC=Object.assign||function(i){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n])}return i},UC.apply(this,arguments)};function ac(i,e,t,r){function n(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function s(T){try{b(r.next(T))}catch(F){l(F)}}function g(T){try{b(r.throw(T))}catch(F){l(F)}}function b(T){T.done?o(T.value):n(T.value).then(s,g)}b((r=r.apply(i,e||[])).next())})}function Rl(i,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,n,o,l;return l={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function s(b){return function(T){return g([b,T])}}function g(b){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,n&&(o=b[0]&2?n.return:b[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,b[1])).done)return o;switch(n=0,o&&(b=[b[0]&2,o.value]),b[0]){case 0:case 1:o=b;break;case 4:return t.label++,{value:b[1],done:!1};case 5:t.label++,n=b[1],b=[0];continue;case 7:b=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(b[0]===6||b[0]===2)){t=0;continue}if(b[0]===3&&(!o||b[1]>o[0]&&b[1]<o[3])){t.label=b[1];break}if(b[0]===6&&t.label<o[1]){t.label=o[1],o=b;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(b);break}o[2]&&t.ops.pop(),t.trys.pop();continue}b=e.call(i,t)}catch(T){b=[6,T],n=0}finally{r=o=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function uv(i,e,t){if(t||arguments.length===2)for(var r=0,n=e.length,o;r<n;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return i.concat(o||e)}for(var PA=function(){function i(e,t,r,n){this.left=e,this.top=t,this.width=r,this.height=n}return i.prototype.add=function(e,t,r,n){return new i(this.left+e,this.top+t,this.width+r,this.height+n)},i.fromClientRect=function(e,t){return new i(t.left+e.windowBounds.left,t.top+e.windowBounds.top,t.width,t.height)},i.fromDOMRectList=function(e,t){var r=Array.from(t).find(function(n){return n.width!==0});return r?new i(r.left+e.windowBounds.left,r.top+e.windowBounds.top,r.width,r.height):i.EMPTY},i.EMPTY=new i(0,0,0,0),i}(),hv=function(i,e){return PA.fromClientRect(i,e.getBoundingClientRect())},Dne=function(i){var e=i.body,t=i.documentElement;if(!e||!t)throw new Error("Unable to get document size");var r=Math.max(Math.max(e.scrollWidth,t.scrollWidth),Math.max(e.offsetWidth,t.offsetWidth),Math.max(e.clientWidth,t.clientWidth)),n=Math.max(Math.max(e.scrollHeight,t.scrollHeight),Math.max(e.offsetHeight,t.offsetHeight),Math.max(e.clientHeight,t.clientHeight));return new PA(0,0,r,n)},Av=function(i){for(var e=[],t=0,r=i.length;t<r;){var n=i.charCodeAt(t++);if(n>=55296&&n<=56319&&t<r){var o=i.charCodeAt(t++);(o&64512)===56320?e.push(((n&1023)<<10)+(o&1023)+65536):(e.push(n),t--)}else e.push(n)}return e},Go=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,i);var t=i.length;if(!t)return"";for(var r=[],n=-1,o="";++n<t;){var l=i[n];l<=65535?r.push(l):(l-=65536,r.push((l>>10)+55296,l%1024+56320)),(n+1===t||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},pD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Rne=typeof Uint8Array>"u"?[]:new Uint8Array(256),dv=0;dv<pD.length;dv++)Rne[pD.charCodeAt(dv)]=dv;for(var gD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Vy=typeof Uint8Array>"u"?[]:new Uint8Array(256),fv=0;fv<gD.length;fv++)Vy[gD.charCodeAt(fv)]=fv;for(var kne=function(i){var e=i.length*.75,t=i.length,r,n=0,o,l,s,g;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);var b=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),T=Array.isArray(b)?b:new Uint8Array(b);for(r=0;r<t;r+=4)o=Vy[i.charCodeAt(r)],l=Vy[i.charCodeAt(r+1)],s=Vy[i.charCodeAt(r+2)],g=Vy[i.charCodeAt(r+3)],T[n++]=o<<2|l>>4,T[n++]=(l&15)<<4|s>>2,T[n++]=(s&3)<<6|g&63;return b},One=function(i){for(var e=i.length,t=[],r=0;r<e;r+=2)t.push(i[r+1]<<8|i[r]);return t},Une=function(i){for(var e=i.length,t=[],r=0;r<e;r+=4)t.push(i[r+3]<<24|i[r+2]<<16|i[r+1]<<8|i[r]);return t},Pf=5,NC=11,zC=2,Nne=NC-Pf,mD=65536>>Pf,zne=1<<Pf,QC=zne-1,Qne=1024>>Pf,Vne=mD+Qne,Hne=Vne,Gne=32,jne=Hne+Gne,qne=65536>>NC,$ne=1<<Nne,Kne=$ne-1,yD=function(i,e,t){return i.slice?i.slice(e,t):new Uint16Array(Array.prototype.slice.call(i,e,t))},Wne=function(i,e,t){return i.slice?i.slice(e,t):new Uint32Array(Array.prototype.slice.call(i,e,t))},Xne=function(i,e){var t=kne(i),r=Array.isArray(t)?Une(t):new Uint32Array(t),n=Array.isArray(t)?One(t):new Uint16Array(t),o=24,l=yD(n,o/2,r[4]/2),s=r[5]===2?yD(n,(o+r[4])/2):Wne(r,Math.ceil((o+r[4])/4));return new Zne(r[0],r[1],r[2],r[3],l,s)},Zne=function(){function i(e,t,r,n,o,l){this.initialValue=e,this.errorValue=t,this.highStart=r,this.highValueIndex=n,this.index=o,this.data=l}return i.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>Pf],t=(t<<zC)+(e&QC),this.data[t];if(e<=65535)return t=this.index[mD+(e-55296>>Pf)],t=(t<<zC)+(e&QC),this.data[t];if(e<this.highStart)return t=jne-qne+(e>>NC),t=this.index[t],t+=e>>Pf&Kne,t=this.index[t],t=(t<<zC)+(e&QC),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},i}(),_D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Jne=typeof Uint8Array>"u"?[]:new Uint8Array(256),pv=0;pv<_D.length;pv++)Jne[_D.charCodeAt(pv)]=pv;var Yne="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",vD=50,ese=1,bD=2,xD=3,tse=4,ise=5,wD=7,BD=8,CD=9,bd=10,VC=11,ED=12,HC=13,rse=14,Hy=15,GC=16,gv=17,Gy=18,nse=19,SD=20,jC=21,jy=22,qC=23,Fg=24,su=25,qy=26,$y=27,Dg=28,sse=29,Rg=30,ose=31,mv=32,yv=33,$C=34,KC=35,WC=36,Ky=37,XC=38,_v=39,vv=40,ZC=41,TD=42,ase=43,lse=[9001,65288],ID="!",lc="",bv="",JC=Xne(Yne),FA=[Rg,WC],YC=[ese,bD,xD,ise],LD=[bd,BD],MD=[$y,qy],cse=YC.concat(LD),PD=[XC,_v,vv,$C,KC],use=[Hy,HC],hse=function(i,e){e===void 0&&(e="strict");var t=[],r=[],n=[];return i.forEach(function(o,l){var s=JC.get(o);if(s>vD?(n.push(!0),s-=vD):n.push(!1),["normal","auto","loose"].indexOf(e)!==-1&&[8208,8211,12316,12448].indexOf(o)!==-1)return r.push(l),t.push(GC);if(s===tse||s===VC){if(l===0)return r.push(l),t.push(Rg);var g=t[l-1];return cse.indexOf(g)===-1?(r.push(r[l-1]),t.push(g)):(r.push(l),t.push(Rg))}if(r.push(l),s===ose)return t.push(e==="strict"?jC:Ky);if(s===TD||s===sse)return t.push(Rg);if(s===ase)return o>=131072&&o<=196605||o>=196608&&o<=262141?t.push(Ky):t.push(Rg);t.push(s)}),[r,t,n]},eE=function(i,e,t,r){var n=r[t];if(Array.isArray(i)?i.indexOf(n)!==-1:i===n)for(var o=t;o<=r.length;){o++;var l=r[o];if(l===e)return!0;if(l!==bd)break}if(n===bd)for(var o=t;o>0;){o--;var s=r[o];if(Array.isArray(i)?i.indexOf(s)!==-1:i===s)for(var g=t;g<=r.length;){g++;var l=r[g];if(l===e)return!0;if(l!==bd)break}if(s!==bd)break}return!1},FD=function(i,e){for(var t=i;t>=0;){var r=e[t];if(r===bd)t--;else return r}return 0},Ase=function(i,e,t,r,n){if(t[r]===0)return lc;var o=r-1;if(Array.isArray(n)&&n[o]===!0)return lc;var l=o-1,s=o+1,g=e[o],b=l>=0?e[l]:0,T=e[s];if(g===bD&&T===xD)return lc;if(YC.indexOf(g)!==-1)return ID;if(YC.indexOf(T)!==-1||LD.indexOf(T)!==-1)return lc;if(FD(o,e)===BD)return bv;if(JC.get(i[o])===VC||(g===mv||g===yv)&&JC.get(i[s])===VC||g===wD||T===wD||g===CD||[bd,HC,Hy].indexOf(g)===-1&&T===CD||[gv,Gy,nse,Fg,Dg].indexOf(T)!==-1||FD(o,e)===jy||eE(qC,jy,o,e)||eE([gv,Gy],jC,o,e)||eE(ED,ED,o,e))return lc;if(g===bd)return bv;if(g===qC||T===qC)return lc;if(T===GC||g===GC)return bv;if([HC,Hy,jC].indexOf(T)!==-1||g===rse||b===WC&&use.indexOf(g)!==-1||g===Dg&&T===WC||T===SD||FA.indexOf(T)!==-1&&g===su||FA.indexOf(g)!==-1&&T===su||g===$y&&[Ky,mv,yv].indexOf(T)!==-1||[Ky,mv,yv].indexOf(g)!==-1&&T===qy||FA.indexOf(g)!==-1&&MD.indexOf(T)!==-1||MD.indexOf(g)!==-1&&FA.indexOf(T)!==-1||[$y,qy].indexOf(g)!==-1&&(T===su||[jy,Hy].indexOf(T)!==-1&&e[s+1]===su)||[jy,Hy].indexOf(g)!==-1&&T===su||g===su&&[su,Dg,Fg].indexOf(T)!==-1)return lc;if([su,Dg,Fg,gv,Gy].indexOf(T)!==-1)for(var F=o;F>=0;){var k=e[F];if(k===su)return lc;if([Dg,Fg].indexOf(k)!==-1)F--;else break}if([$y,qy].indexOf(T)!==-1)for(var F=[gv,Gy].indexOf(g)!==-1?l:o;F>=0;){var k=e[F];if(k===su)return lc;if([Dg,Fg].indexOf(k)!==-1)F--;else break}if(XC===g&&[XC,_v,$C,KC].indexOf(T)!==-1||[_v,$C].indexOf(g)!==-1&&[_v,vv].indexOf(T)!==-1||[vv,KC].indexOf(g)!==-1&&T===vv||PD.indexOf(g)!==-1&&[SD,qy].indexOf(T)!==-1||PD.indexOf(T)!==-1&&g===$y||FA.indexOf(g)!==-1&&FA.indexOf(T)!==-1||g===Fg&&FA.indexOf(T)!==-1||FA.concat(su).indexOf(g)!==-1&&T===jy&&lse.indexOf(i[s])===-1||FA.concat(su).indexOf(T)!==-1&&g===Gy)return lc;if(g===ZC&&T===ZC){for(var z=t[o],J=1;z>0&&(z--,e[z]===ZC);)J++;if(J%2!==0)return lc}return g===mv&&T===yv?lc:bv},dse=function(i,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var t=hse(i,e.lineBreak),r=t[0],n=t[1],o=t[2];(e.wordBreak==="break-all"||e.wordBreak==="break-word")&&(n=n.map(function(s){return[su,Rg,TD].indexOf(s)!==-1?Ky:s}));var l=e.wordBreak==="keep-all"?o.map(function(s,g){return s&&i[g]>=19968&&i[g]<=40959}):void 0;return[r,n,l]},fse=function(){function i(e,t,r,n){this.codePoints=e,this.required=t===ID,this.start=r,this.end=n}return i.prototype.slice=function(){return Go.apply(void 0,this.codePoints.slice(this.start,this.end))},i}(),pse=function(i,e){var t=Av(i),r=dse(t,e),n=r[0],o=r[1],l=r[2],s=t.length,g=0,b=0;return{next:function(){if(b>=s)return{done:!0,value:null};for(var T=lc;b<s&&(T=Ase(t,o,n,++b,l))===lc;);if(T!==lc||b===s){var F=new fse(t,T,g,b);return g=b,{value:F,done:!1}}return{done:!0,value:null}}}},gse=1,mse=2,Wy=4,DD=8,xv=10,RD=47,Xy=92,yse=9,_se=32,wv=34,Zy=61,vse=35,bse=36,xse=37,Bv=39,Cv=40,Jy=41,wse=95,Mc=45,Bse=33,Cse=60,Ese=62,Sse=64,Tse=91,Ise=93,Lse=61,Mse=123,Ev=63,Pse=125,kD=124,Fse=126,Dse=128,OD=65533,tE=42,Ff=43,Rse=44,kse=58,Ose=59,Yy=46,Use=0,Nse=8,zse=11,Qse=14,Vse=31,Hse=127,Xh=-1,UD=48,ND=97,zD=101,Gse=102,jse=117,qse=122,QD=65,VD=69,HD=70,$se=85,Kse=90,cc=function(i){return i>=UD&&i<=57},Wse=function(i){return i>=55296&&i<=57343},kg=function(i){return cc(i)||i>=QD&&i<=HD||i>=ND&&i<=Gse},Xse=function(i){return i>=ND&&i<=qse},Zse=function(i){return i>=QD&&i<=Kse},Jse=function(i){return Xse(i)||Zse(i)},Yse=function(i){return i>=Dse},Sv=function(i){return i===xv||i===yse||i===_se},Tv=function(i){return Jse(i)||Yse(i)||i===wse},GD=function(i){return Tv(i)||cc(i)||i===Mc},eoe=function(i){return i>=Use&&i<=Nse||i===zse||i>=Qse&&i<=Vse||i===Hse},xd=function(i,e){return i!==Xy?!1:e!==xv},Iv=function(i,e,t){return i===Mc?Tv(e)||xd(e,t):Tv(i)?!0:!!(i===Xy&&xd(i,e))},iE=function(i,e,t){return i===Ff||i===Mc?cc(e)?!0:e===Yy&&cc(t):cc(i===Yy?e:i)},toe=function(i){var e=0,t=1;(i[e]===Ff||i[e]===Mc)&&(i[e]===Mc&&(t=-1),e++);for(var r=[];cc(i[e]);)r.push(i[e++]);var n=r.length?parseInt(Go.apply(void 0,r),10):0;i[e]===Yy&&e++;for(var o=[];cc(i[e]);)o.push(i[e++]);var l=o.length,s=l?parseInt(Go.apply(void 0,o),10):0;(i[e]===VD||i[e]===zD)&&e++;var g=1;(i[e]===Ff||i[e]===Mc)&&(i[e]===Mc&&(g=-1),e++);for(var b=[];cc(i[e]);)b.push(i[e++]);var T=b.length?parseInt(Go.apply(void 0,b),10):0;return t*(n+s*Math.pow(10,-l))*Math.pow(10,g*T)},ioe={type:2},roe={type:3},noe={type:4},soe={type:13},ooe={type:8},aoe={type:21},loe={type:9},coe={type:10},uoe={type:11},hoe={type:12},Aoe={type:14},Lv={type:23},doe={type:1},foe={type:25},poe={type:24},goe={type:26},moe={type:27},yoe={type:28},_oe={type:29},voe={type:31},rE={type:32},jD=function(){function i(){this._value=[]}return i.prototype.write=function(e){this._value=this._value.concat(Av(e))},i.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==rE;)e.push(t),t=this.consumeToken();return e},i.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case wv:return this.consumeStringToken(wv);case vse:var t=this.peekCodePoint(0),r=this.peekCodePoint(1),n=this.peekCodePoint(2);if(GD(t)||xd(r,n)){var o=Iv(t,r,n)?mse:gse,l=this.consumeName();return{type:5,value:l,flags:o}}break;case bse:if(this.peekCodePoint(0)===Zy)return this.consumeCodePoint(),soe;break;case Bv:return this.consumeStringToken(Bv);case Cv:return ioe;case Jy:return roe;case tE:if(this.peekCodePoint(0)===Zy)return this.consumeCodePoint(),Aoe;break;case Ff:if(iE(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case Rse:return noe;case Mc:var s=e,g=this.peekCodePoint(0),b=this.peekCodePoint(1);if(iE(s,g,b))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(Iv(s,g,b))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(g===Mc&&b===Ese)return this.consumeCodePoint(),this.consumeCodePoint(),poe;break;case Yy:if(iE(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case RD:if(this.peekCodePoint(0)===tE)for(this.consumeCodePoint();;){var T=this.consumeCodePoint();if(T===tE&&(T=this.consumeCodePoint(),T===RD))return this.consumeToken();if(T===Xh)return this.consumeToken()}break;case kse:return goe;case Ose:return moe;case Cse:if(this.peekCodePoint(0)===Bse&&this.peekCodePoint(1)===Mc&&this.peekCodePoint(2)===Mc)return this.consumeCodePoint(),this.consumeCodePoint(),foe;break;case Sse:var F=this.peekCodePoint(0),k=this.peekCodePoint(1),z=this.peekCodePoint(2);if(Iv(F,k,z)){var l=this.consumeName();return{type:7,value:l}}break;case Tse:return yoe;case Xy:if(xd(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case Ise:return _oe;case Lse:if(this.peekCodePoint(0)===Zy)return this.consumeCodePoint(),ooe;break;case Mse:return uoe;case Pse:return hoe;case jse:case $se:var J=this.peekCodePoint(0),te=this.peekCodePoint(1);return J===Ff&&(kg(te)||te===Ev)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case kD:if(this.peekCodePoint(0)===Zy)return this.consumeCodePoint(),loe;if(this.peekCodePoint(0)===kD)return this.consumeCodePoint(),aoe;break;case Fse:if(this.peekCodePoint(0)===Zy)return this.consumeCodePoint(),coe;break;case Xh:return rE}return Sv(e)?(this.consumeWhiteSpace(),voe):cc(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):Tv(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:Go(e)}},i.prototype.consumeCodePoint=function(){var e=this._value.shift();return typeof e>"u"?-1:e},i.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},i.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},i.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();kg(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var r=!1;t===Ev&&e.length<6;)e.push(t),t=this.consumeCodePoint(),r=!0;if(r){var n=parseInt(Go.apply(void 0,e.map(function(g){return g===Ev?UD:g})),16),o=parseInt(Go.apply(void 0,e.map(function(g){return g===Ev?HD:g})),16);return{type:30,start:n,end:o}}var l=parseInt(Go.apply(void 0,e),16);if(this.peekCodePoint(0)===Mc&&kg(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var s=[];kg(t)&&s.length<6;)s.push(t),t=this.consumeCodePoint();var o=parseInt(Go.apply(void 0,s),16);return{type:30,start:l,end:o}}else return{type:30,start:l,end:l}},i.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return e.toLowerCase()==="url"&&this.peekCodePoint(0)===Cv?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===Cv?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},i.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Xh)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===Bv||t===wv){var r=this.consumeStringToken(this.consumeCodePoint());return r.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Xh||this.peekCodePoint(0)===Jy)?(this.consumeCodePoint(),{type:22,value:r.value}):(this.consumeBadUrlRemnants(),Lv)}for(;;){var n=this.consumeCodePoint();if(n===Xh||n===Jy)return{type:22,value:Go.apply(void 0,e)};if(Sv(n))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Xh||this.peekCodePoint(0)===Jy?(this.consumeCodePoint(),{type:22,value:Go.apply(void 0,e)}):(this.consumeBadUrlRemnants(),Lv);if(n===wv||n===Bv||n===Cv||eoe(n))return this.consumeBadUrlRemnants(),Lv;if(n===Xy)if(xd(n,this.peekCodePoint(0)))e.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),Lv;else e.push(n)}},i.prototype.consumeWhiteSpace=function(){for(;Sv(this.peekCodePoint(0));)this.consumeCodePoint()},i.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===Jy||e===Xh)return;xd(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},i.prototype.consumeStringSlice=function(e){for(var t=5e4,r="";e>0;){var n=Math.min(t,e);r+=Go.apply(void 0,this._value.splice(0,n)),e-=n}return this._value.shift(),r},i.prototype.consumeStringToken=function(e){var t="",r=0;do{var n=this._value[r];if(n===Xh||n===void 0||n===e)return t+=this.consumeStringSlice(r),{type:0,value:t};if(n===xv)return this._value.splice(0,r),doe;if(n===Xy){var o=this._value[r+1];o!==Xh&&o!==void 0&&(o===xv?(t+=this.consumeStringSlice(r),r=-1,this._value.shift()):xd(n,o)&&(t+=this.consumeStringSlice(r),t+=Go(this.consumeEscapedCodePoint()),r=-1))}r++}while(!0)},i.prototype.consumeNumber=function(){var e=[],t=Wy,r=this.peekCodePoint(0);for((r===Ff||r===Mc)&&e.push(this.consumeCodePoint());cc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0);var n=this.peekCodePoint(1);if(r===Yy&&cc(n))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=DD;cc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0),n=this.peekCodePoint(1);var o=this.peekCodePoint(2);if((r===VD||r===zD)&&((n===Ff||n===Mc)&&cc(o)||cc(n)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=DD;cc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[toe(e),t]},i.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],r=e[1],n=this.peekCodePoint(0),o=this.peekCodePoint(1),l=this.peekCodePoint(2);if(Iv(n,o,l)){var s=this.consumeName();return{type:15,number:t,flags:r,unit:s}}return n===xse?(this.consumeCodePoint(),{type:16,number:t,flags:r}):{type:17,number:t,flags:r}},i.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(kg(e)){for(var t=Go(e);kg(this.peekCodePoint(0))&&t.length<6;)t+=Go(this.consumeCodePoint());Sv(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(t,16);return r===0||Wse(r)||r>1114111?OD:r}return e===Xh?OD:e},i.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(GD(t))e+=Go(t);else if(xd(t,this.peekCodePoint(0)))e+=Go(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(t),e}},i}(),qD=function(){function i(e){this._tokens=e}return i.create=function(e){var t=new jD;return t.write(e),new i(t.read())},i.parseValue=function(e){return i.create(e).parseComponentValue()},i.parseValues=function(e){return i.create(e).parseComponentValues()},i.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===31;)e=this.consumeToken();if(e.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do e=this.consumeToken();while(e.type===31);if(e.type===32)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},i.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(t.type===32)return e;e.push(t),e.push()}},i.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},i.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},r=this.consumeToken();;){if(r.type===32||xoe(r,e))return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue()),r=this.consumeToken()}},i.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var r=this.consumeToken();if(r.type===32||r.type===3)return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue())}},i.prototype.consumeToken=function(){var e=this._tokens.shift();return typeof e>"u"?rE:e},i.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},i}(),e0=function(i){return i.type===15},Og=function(i){return i.type===17},ws=function(i){return i.type===20},boe=function(i){return i.type===0},nE=function(i,e){return ws(i)&&i.value===e},$D=function(i){return i.type!==31},Ug=function(i){return i.type!==31&&i.type!==4},Zh=function(i){var e=[],t=[];return i.forEach(function(r){if(r.type===4){if(t.length===0)throw new Error("Error parsing function args, zero tokens for arg");e.push(t),t=[];return}r.type!==31&&t.push(r)}),t.length&&e.push(t),e},xoe=function(i,e){return e===11&&i.type===12||e===28&&i.type===29?!0:e===2&&i.type===3},wd=function(i){return i.type===17||i.type===15},oa=function(i){return i.type===16||wd(i)},KD=function(i){return i.length>1?[i[0],i[1]]:[i[0]]},ol={type:17,number:0,flags:Wy},sE={type:16,number:50,flags:Wy},Bd={type:16,number:100,flags:Wy},t0=function(i,e,t){var r=i[0],n=i[1];return[Vs(r,e),Vs(typeof n<"u"?n:r,t)]},Vs=function(i,e){if(i.type===16)return i.number/100*e;if(e0(i))switch(i.unit){case"rem":case"em":return 16*i.number;case"px":default:return i.number}return i.number},WD="deg",XD="grad",ZD="rad",JD="turn",Mv={name:"angle",parse:function(i,e){if(e.type===15)switch(e.unit){case WD:return Math.PI*e.number/180;case XD:return Math.PI/200*e.number;case ZD:return e.number;case JD:return Math.PI*2*e.number}throw new Error("Unsupported angle type")}},YD=function(i){return i.type===15&&(i.unit===WD||i.unit===XD||i.unit===ZD||i.unit===JD)},eR=function(i){var e=i.filter(ws).map(function(t){return t.value}).join(" ");switch(e){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ol,ol];case"to top":case"bottom":return Lu(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ol,Bd];case"to right":case"left":return Lu(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Bd,Bd];case"to bottom":case"top":return Lu(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Bd,ol];case"to left":case"right":return Lu(270)}return 0},Lu=function(i){return Math.PI*i/180},Cd={name:"color",parse:function(i,e){if(e.type===18){var t=woe[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(i,e.values)}if(e.type===5){if(e.value.length===3){var r=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3);return Sd(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),1)}if(e.value.length===4){var r=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3),l=e.value.substring(3,4);return Sd(parseInt(r+r,16),parseInt(n+n,16),parseInt(o+o,16),parseInt(l+l,16)/255)}if(e.value.length===6){var r=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6);return Sd(parseInt(r,16),parseInt(n,16),parseInt(o,16),1)}if(e.value.length===8){var r=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6),l=e.value.substring(6,8);return Sd(parseInt(r,16),parseInt(n,16),parseInt(o,16),parseInt(l,16)/255)}}if(e.type===20){var s=DA[e.value.toUpperCase()];if(typeof s<"u")return s}return DA.TRANSPARENT}},Ed=function(i){return(255&i)===0},ja=function(i){var e=255&i,t=255&i>>8,r=255&i>>16,n=255&i>>24;return e<255?"rgba("+n+","+r+","+t+","+e/255+")":"rgb("+n+","+r+","+t+")"},Sd=function(i,e,t,r){return(i<<24|e<<16|t<<8|Math.round(r*255)<<0)>>>0},tR=function(i,e){if(i.type===17)return i.number;if(i.type===16){var t=e===3?1:255;return e===3?i.number/100*t:Math.round(i.number/100*t)}return 0},iR=function(i,e){var t=e.filter(Ug);if(t.length===3){var r=t.map(tR),n=r[0],o=r[1],l=r[2];return Sd(n,o,l,1)}if(t.length===4){var s=t.map(tR),n=s[0],o=s[1],l=s[2],g=s[3];return Sd(n,o,l,g)}return 0};function oE(i,e,t){return t<0&&(t+=1),t>=1&&(t-=1),t<1/6?(e-i)*t*6+i:t<1/2?e:t<2/3?(e-i)*6*(2/3-t)+i:i}var rR=function(i,e){var t=e.filter(Ug),r=t[0],n=t[1],o=t[2],l=t[3],s=(r.type===17?Lu(r.number):Mv.parse(i,r))/(Math.PI*2),g=oa(n)?n.number/100:0,b=oa(o)?o.number/100:0,T=typeof l<"u"&&oa(l)?Vs(l,1):1;if(g===0)return Sd(b*255,b*255,b*255,1);var F=b<=.5?b*(g+1):b+g-b*g,k=b*2-F,z=oE(k,F,s+1/3),J=oE(k,F,s),te=oE(k,F,s-1/3);return Sd(z*255,J*255,te*255,T)},woe={hsl:rR,hsla:rR,rgb:iR,rgba:iR},i0=function(i,e){return Cd.parse(i,qD.create(e).parseComponentValue())},DA={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},Boe={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(i,e){return e.map(function(t){if(ws(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Coe={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Pv=function(i,e){var t=Cd.parse(i,e[0]),r=e[1];return r&&oa(r)?{color:t,stop:r}:{color:t,stop:null}},nR=function(i,e){var t=i[0],r=i[i.length-1];t.stop===null&&(t.stop=ol),r.stop===null&&(r.stop=Bd);for(var n=[],o=0,l=0;l<i.length;l++){var s=i[l].stop;if(s!==null){var g=Vs(s,e);g>o?n.push(g):n.push(o),o=g}else n.push(null)}for(var b=null,l=0;l<n.length;l++){var T=n[l];if(T===null)b===null&&(b=l);else if(b!==null){for(var F=l-b,k=n[b-1],z=(T-k)/(F+1),J=1;J<=F;J++)n[b+J-1]=z*J;b=null}}return i.map(function(te,ue){var ce=te.color;return{color:ce,stop:Math.max(Math.min(1,n[ue]/e),0)}})},Eoe=function(i,e,t){var r=e/2,n=t/2,o=Vs(i[0],e)-r,l=n-Vs(i[1],t);return(Math.atan2(l,o)+Math.PI*2)%(Math.PI*2)},Soe=function(i,e,t){var r=typeof i=="number"?i:Eoe(i,e,t),n=Math.abs(e*Math.sin(r))+Math.abs(t*Math.cos(r)),o=e/2,l=t/2,s=n/2,g=Math.sin(r-Math.PI/2)*s,b=Math.cos(r-Math.PI/2)*s;return[n,o-b,o+b,l-g,l+g]},Ah=function(i,e){return Math.sqrt(i*i+e*e)},sR=function(i,e,t,r,n){var o=[[0,0],[0,e],[i,0],[i,e]];return o.reduce(function(l,s){var g=s[0],b=s[1],T=Ah(t-g,r-b);return(n?T<l.optimumDistance:T>l.optimumDistance)?{optimumCorner:s,optimumDistance:T}:l},{optimumDistance:n?1/0:-1/0,optimumCorner:null}).optimumCorner},Toe=function(i,e,t,r,n){var o=0,l=0;switch(i.size){case 0:i.shape===0?o=l=Math.min(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-n)):i.shape===1&&(o=Math.min(Math.abs(e),Math.abs(e-r)),l=Math.min(Math.abs(t),Math.abs(t-n)));break;case 2:if(i.shape===0)o=l=Math.min(Ah(e,t),Ah(e,t-n),Ah(e-r,t),Ah(e-r,t-n));else if(i.shape===1){var s=Math.min(Math.abs(t),Math.abs(t-n))/Math.min(Math.abs(e),Math.abs(e-r)),g=sR(r,n,e,t,!0),b=g[0],T=g[1];o=Ah(b-e,(T-t)/s),l=s*o}break;case 1:i.shape===0?o=l=Math.max(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-n)):i.shape===1&&(o=Math.max(Math.abs(e),Math.abs(e-r)),l=Math.max(Math.abs(t),Math.abs(t-n)));break;case 3:if(i.shape===0)o=l=Math.max(Ah(e,t),Ah(e,t-n),Ah(e-r,t),Ah(e-r,t-n));else if(i.shape===1){var s=Math.max(Math.abs(t),Math.abs(t-n))/Math.max(Math.abs(e),Math.abs(e-r)),F=sR(r,n,e,t,!1),b=F[0],T=F[1];o=Ah(b-e,(T-t)/s),l=s*o}break}return Array.isArray(i.size)&&(o=Vs(i.size[0],r),l=i.size.length===2?Vs(i.size[1],n):o),[o,l]},Ioe=function(i,e){var t=Lu(180),r=[];return Zh(e).forEach(function(n,o){if(o===0){var l=n[0];if(l.type===20&&l.value==="to"){t=eR(n);return}else if(YD(l)){t=Mv.parse(i,l);return}}var s=Pv(i,n);r.push(s)}),{angle:t,stops:r,type:1}},Fv=function(i,e){var t=Lu(180),r=[];return Zh(e).forEach(function(n,o){if(o===0){var l=n[0];if(l.type===20&&["top","left","right","bottom"].indexOf(l.value)!==-1){t=eR(n);return}else if(YD(l)){t=(Mv.parse(i,l)+Lu(270))%Lu(360);return}}var s=Pv(i,n);r.push(s)}),{angle:t,stops:r,type:1}},Loe=function(i,e){var t=Lu(180),r=[],n=1,o=0,l=3,s=[];return Zh(e).forEach(function(g,b){var T=g[0];if(b===0){if(ws(T)&&T.value==="linear"){n=1;return}else if(ws(T)&&T.value==="radial"){n=2;return}}if(T.type===18){if(T.name==="from"){var F=Cd.parse(i,T.values[0]);r.push({stop:ol,color:F})}else if(T.name==="to"){var F=Cd.parse(i,T.values[0]);r.push({stop:Bd,color:F})}else if(T.name==="color-stop"){var k=T.values.filter(Ug);if(k.length===2){var F=Cd.parse(i,k[1]),z=k[0];Og(z)&&r.push({stop:{type:16,number:z.number*100,flags:z.flags},color:F})}}}}),n===1?{angle:(t+Lu(180))%Lu(360),stops:r,type:n}:{size:l,shape:o,stops:r,position:s,type:n}},oR="closest-side",aR="farthest-side",lR="closest-corner",cR="farthest-corner",uR="circle",hR="ellipse",AR="cover",dR="contain",Moe=function(i,e){var t=0,r=3,n=[],o=[];return Zh(e).forEach(function(l,s){var g=!0;if(s===0){var b=!1;g=l.reduce(function(F,k){if(b)if(ws(k))switch(k.value){case"center":return o.push(sE),F;case"top":case"left":return o.push(ol),F;case"right":case"bottom":return o.push(Bd),F}else(oa(k)||wd(k))&&o.push(k);else if(ws(k))switch(k.value){case uR:return t=0,!1;case hR:return t=1,!1;case"at":return b=!0,!1;case oR:return r=0,!1;case AR:case aR:return r=1,!1;case dR:case lR:return r=2,!1;case cR:return r=3,!1}else if(wd(k)||oa(k))return Array.isArray(r)||(r=[]),r.push(k),!1;return F},g)}if(g){var T=Pv(i,l);n.push(T)}}),{size:r,shape:t,stops:n,position:o,type:2}},Dv=function(i,e){var t=0,r=3,n=[],o=[];return Zh(e).forEach(function(l,s){var g=!0;if(s===0?g=l.reduce(function(T,F){if(ws(F))switch(F.value){case"center":return o.push(sE),!1;case"top":case"left":return o.push(ol),!1;case"right":case"bottom":return o.push(Bd),!1}else if(oa(F)||wd(F))return o.push(F),!1;return T},g):s===1&&(g=l.reduce(function(T,F){if(ws(F))switch(F.value){case uR:return t=0,!1;case hR:return t=1,!1;case dR:case oR:return r=0,!1;case aR:return r=1,!1;case lR:return r=2,!1;case AR:case cR:return r=3,!1}else if(wd(F)||oa(F))return Array.isArray(r)||(r=[]),r.push(F),!1;return T},g)),g){var b=Pv(i,l);n.push(b)}}),{size:r,shape:t,stops:n,position:o,type:2}},Poe=function(i){return i.type===1},Foe=function(i){return i.type===2},aE={name:"image",parse:function(i,e){if(e.type===22){var t={url:e.value,type:0};return i.cache.addImage(e.value),t}if(e.type===18){var r=fR[e.name];if(typeof r>"u")throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return r(i,e.values)}throw new Error("Unsupported image type "+e.type)}};function Doe(i){return!(i.type===20&&i.value==="none")&&(i.type!==18||!!fR[i.name])}var fR={"linear-gradient":Ioe,"-moz-linear-gradient":Fv,"-ms-linear-gradient":Fv,"-o-linear-gradient":Fv,"-webkit-linear-gradient":Fv,"radial-gradient":Moe,"-moz-radial-gradient":Dv,"-ms-radial-gradient":Dv,"-o-radial-gradient":Dv,"-webkit-radial-gradient":Dv,"-webkit-gradient":Loe},Roe={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(i,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e.filter(function(r){return Ug(r)&&Doe(r)}).map(function(r){return aE.parse(i,r)})}},koe={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(i,e){return e.map(function(t){if(ws(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Ooe={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(i,e){return Zh(e).map(function(t){return t.filter(oa)}).map(KD)}},Uoe={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(i,e){return Zh(e).map(function(t){return t.filter(ws).map(function(r){return r.value}).join(" ")}).map(Noe)}},Noe=function(i){switch(i){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},Ng;(function(i){i.AUTO="auto",i.CONTAIN="contain",i.COVER="cover"})(Ng||(Ng={}));var zoe={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(i,e){return Zh(e).map(function(t){return t.filter(Qoe)})}},Qoe=function(i){return ws(i)||oa(i)},Rv=function(i){return{name:"border-"+i+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Voe=Rv("top"),Hoe=Rv("right"),Goe=Rv("bottom"),joe=Rv("left"),kv=function(i){return{name:"border-radius-"+i,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return KD(t.filter(oa))}}},qoe=kv("top-left"),$oe=kv("top-right"),Koe=kv("bottom-right"),Woe=kv("bottom-left"),Ov=function(i){return{name:"border-"+i+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},Xoe=Ov("top"),Zoe=Ov("right"),Joe=Ov("bottom"),Yoe=Ov("left"),Uv=function(i){return{name:"border-"+i+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return e0(t)?t.number:0}}},eae=Uv("top"),tae=Uv("right"),iae=Uv("bottom"),rae=Uv("left"),nae={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},sae={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(i,e){switch(e){case"rtl":return 1;case"ltr":default:return 0}}},oae={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(i,e){return e.filter(ws).reduce(function(t,r){return t|aae(r.value)},0)}},aae=function(i){switch(i){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},lae={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},cae={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(i,e){return e.type===20&&e.value==="normal"?0:e.type===17||e.type===15?e.number:0}},Nv;(function(i){i.NORMAL="normal",i.STRICT="strict"})(Nv||(Nv={}));var uae={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"strict":return Nv.STRICT;case"normal":default:return Nv.NORMAL}}},hae={name:"line-height",initialValue:"normal",prefix:!1,type:4},pR=function(i,e){return ws(i)&&i.value==="normal"?1.2*e:i.type===17?e*i.number:oa(i)?Vs(i,e):e},Aae={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(i,e){return e.type===20&&e.value==="none"?null:aE.parse(i,e)}},dae={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(i,e){switch(e){case"inside":return 0;case"outside":default:return 1}}},lE={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},zv=function(i){return{name:"margin-"+i,initialValue:"0",prefix:!1,type:4}},fae=zv("top"),pae=zv("right"),gae=zv("bottom"),mae=zv("left"),yae={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(i,e){return e.filter(ws).map(function(t){switch(t.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},_ae={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"break-word":return"break-word";case"normal":default:return"normal"}}},Qv=function(i){return{name:"padding-"+i,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},vae=Qv("top"),bae=Qv("right"),xae=Qv("bottom"),wae=Qv("left"),Bae={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(i,e){switch(e){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},Cae={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(i,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Eae={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(i,e){return e.length===1&&nE(e[0],"none")?[]:Zh(e).map(function(t){for(var r={color:DA.TRANSPARENT,offsetX:ol,offsetY:ol,blur:ol},n=0,o=0;o<t.length;o++){var l=t[o];wd(l)?(n===0?r.offsetX=l:n===1?r.offsetY=l:r.blur=l,n++):r.color=Cd.parse(i,l)}return r})}},Sae={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Tae={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(i,e){if(e.type===20&&e.value==="none")return null;if(e.type===18){var t=Mae[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}return null}},Iae=function(i){var e=i.filter(function(t){return t.type===17}).map(function(t){return t.number});return e.length===6?e:null},Lae=function(i){var e=i.filter(function(g){return g.type===17}).map(function(g){return g.number}),t=e[0],r=e[1];e[2],e[3];var n=e[4],o=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var l=e[12],s=e[13];return e[14],e[15],e.length===16?[t,r,n,o,l,s]:null},Mae={matrix:Iae,matrix3d:Lae},gR={type:16,number:50,flags:Wy},Pae=[gR,gR],Fae={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(i,e){var t=e.filter(oa);return t.length!==2?Pae:[t[0],t[1]]}},Dae={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(i,e){switch(e){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},r0;(function(i){i.NORMAL="normal",i.BREAK_ALL="break-all",i.KEEP_ALL="keep-all"})(r0||(r0={}));for(var Rae={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"break-all":return r0.BREAK_ALL;case"keep-all":return r0.KEEP_ALL;case"normal":default:return r0.NORMAL}}},kae={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(i,e){if(e.type===20)return{auto:!0,order:0};if(Og(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},mR={name:"time",parse:function(i,e){if(e.type===15)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},Oae={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(i,e){return Og(e)?e.number:1}},Uae={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Nae={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(i,e){return e.filter(ws).map(function(t){switch(t.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(t){return t!==0})}},zae={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(i,e){var t=[],r=[];return e.forEach(function(n){switch(n.type){case 20:case 0:t.push(n.value);break;case 17:t.push(n.number.toString());break;case 4:r.push(t.join(" ")),t.length=0;break}}),t.length&&r.push(t.join(" ")),r.map(function(n){return n.indexOf(" ")===-1?n:"'"+n+"'"})}},Qae={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},Vae={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(i,e){if(Og(e))return e.number;if(ws(e))switch(e.value){case"bold":return 700;case"normal":default:return 400}return 400}},Hae={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(i,e){return e.filter(ws).map(function(t){return t.value})}},Gae={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(i,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Ba=function(i,e){return(i&e)!==0},jae={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(i,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e}},qae={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(i,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;for(var r=[],n=e.filter($D),o=0;o<n.length;o++){var l=n[o],s=n[o+1];if(l.type===20){var g=s&&Og(s)?s.number:1;r.push({counter:l.value,increment:g})}}return r}},$ae={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(i,e){if(e.length===0)return[];for(var t=[],r=e.filter($D),n=0;n<r.length;n++){var o=r[n],l=r[n+1];if(ws(o)&&o.value!=="none"){var s=l&&Og(l)?l.number:0;t.push({counter:o.value,reset:s})}}return t}},Kae={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(i,e){return e.filter(e0).map(function(t){return mR.parse(i,t)})}},Wae={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(i,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;var r=[],n=e.filter(boe);if(n.length%2!==0)return null;for(var o=0;o<n.length;o+=2){var l=n[o].value,s=n[o+1].value;r.push({open:l,close:s})}return r}},yR=function(i,e,t){if(!i)return"";var r=i[Math.min(e,i.length-1)];return r?t?r.open:r.close:""},Xae={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(i,e){return e.length===1&&nE(e[0],"none")?[]:Zh(e).map(function(t){for(var r={color:255,offsetX:ol,offsetY:ol,blur:ol,spread:ol,inset:!1},n=0,o=0;o<t.length;o++){var l=t[o];nE(l,"inset")?r.inset=!0:wd(l)?(n===0?r.offsetX=l:n===1?r.offsetY=l:n===2?r.blur=l:r.spread=l,n++):r.color=Cd.parse(i,l)}return r})}},Zae={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(i,e){var t=[0,1,2],r=[];return e.filter(ws).forEach(function(n){switch(n.value){case"stroke":r.push(1);break;case"fill":r.push(0);break;case"markers":r.push(2);break}}),t.forEach(function(n){r.indexOf(n)===-1&&r.push(n)}),r}},Jae={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},Yae={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(i,e){return e0(e)?e.number:0}},ele=function(){function i(e,t){var r,n;this.animationDuration=ir(e,Kae,t.animationDuration),this.backgroundClip=ir(e,Boe,t.backgroundClip),this.backgroundColor=ir(e,Coe,t.backgroundColor),this.backgroundImage=ir(e,Roe,t.backgroundImage),this.backgroundOrigin=ir(e,koe,t.backgroundOrigin),this.backgroundPosition=ir(e,Ooe,t.backgroundPosition),this.backgroundRepeat=ir(e,Uoe,t.backgroundRepeat),this.backgroundSize=ir(e,zoe,t.backgroundSize),this.borderTopColor=ir(e,Voe,t.borderTopColor),this.borderRightColor=ir(e,Hoe,t.borderRightColor),this.borderBottomColor=ir(e,Goe,t.borderBottomColor),this.borderLeftColor=ir(e,joe,t.borderLeftColor),this.borderTopLeftRadius=ir(e,qoe,t.borderTopLeftRadius),this.borderTopRightRadius=ir(e,$oe,t.borderTopRightRadius),this.borderBottomRightRadius=ir(e,Koe,t.borderBottomRightRadius),this.borderBottomLeftRadius=ir(e,Woe,t.borderBottomLeftRadius),this.borderTopStyle=ir(e,Xoe,t.borderTopStyle),this.borderRightStyle=ir(e,Zoe,t.borderRightStyle),this.borderBottomStyle=ir(e,Joe,t.borderBottomStyle),this.borderLeftStyle=ir(e,Yoe,t.borderLeftStyle),this.borderTopWidth=ir(e,eae,t.borderTopWidth),this.borderRightWidth=ir(e,tae,t.borderRightWidth),this.borderBottomWidth=ir(e,iae,t.borderBottomWidth),this.borderLeftWidth=ir(e,rae,t.borderLeftWidth),this.boxShadow=ir(e,Xae,t.boxShadow),this.color=ir(e,nae,t.color),this.direction=ir(e,sae,t.direction),this.display=ir(e,oae,t.display),this.float=ir(e,lae,t.cssFloat),this.fontFamily=ir(e,zae,t.fontFamily),this.fontSize=ir(e,Qae,t.fontSize),this.fontStyle=ir(e,Gae,t.fontStyle),this.fontVariant=ir(e,Hae,t.fontVariant),this.fontWeight=ir(e,Vae,t.fontWeight),this.letterSpacing=ir(e,cae,t.letterSpacing),this.lineBreak=ir(e,uae,t.lineBreak),this.lineHeight=ir(e,hae,t.lineHeight),this.listStyleImage=ir(e,Aae,t.listStyleImage),this.listStylePosition=ir(e,dae,t.listStylePosition),this.listStyleType=ir(e,lE,t.listStyleType),this.marginTop=ir(e,fae,t.marginTop),this.marginRight=ir(e,pae,t.marginRight),this.marginBottom=ir(e,gae,t.marginBottom),this.marginLeft=ir(e,mae,t.marginLeft),this.opacity=ir(e,Oae,t.opacity);var o=ir(e,yae,t.overflow);this.overflowX=o[0],this.overflowY=o[o.length>1?1:0],this.overflowWrap=ir(e,_ae,t.overflowWrap),this.paddingTop=ir(e,vae,t.paddingTop),this.paddingRight=ir(e,bae,t.paddingRight),this.paddingBottom=ir(e,xae,t.paddingBottom),this.paddingLeft=ir(e,wae,t.paddingLeft),this.paintOrder=ir(e,Zae,t.paintOrder),this.position=ir(e,Cae,t.position),this.textAlign=ir(e,Bae,t.textAlign),this.textDecorationColor=ir(e,Uae,(r=t.textDecorationColor)!==null&&r!==void 0?r:t.color),this.textDecorationLine=ir(e,Nae,(n=t.textDecorationLine)!==null&&n!==void 0?n:t.textDecoration),this.textShadow=ir(e,Eae,t.textShadow),this.textTransform=ir(e,Sae,t.textTransform),this.transform=ir(e,Tae,t.transform),this.transformOrigin=ir(e,Fae,t.transformOrigin),this.visibility=ir(e,Dae,t.visibility),this.webkitTextStrokeColor=ir(e,Jae,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=ir(e,Yae,t.webkitTextStrokeWidth),this.wordBreak=ir(e,Rae,t.wordBreak),this.zIndex=ir(e,kae,t.zIndex)}return i.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},i.prototype.isTransparent=function(){return Ed(this.backgroundColor)},i.prototype.isTransformed=function(){return this.transform!==null},i.prototype.isPositioned=function(){return this.position!==0},i.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},i.prototype.isFloating=function(){return this.float!==0},i.prototype.isInlineLevel=function(){return Ba(this.display,4)||Ba(this.display,33554432)||Ba(this.display,268435456)||Ba(this.display,536870912)||Ba(this.display,67108864)||Ba(this.display,134217728)},i}(),tle=function(){function i(e,t){this.content=ir(e,jae,t.content),this.quotes=ir(e,Wae,t.quotes)}return i}(),_R=function(){function i(e,t){this.counterIncrement=ir(e,qae,t.counterIncrement),this.counterReset=ir(e,$ae,t.counterReset)}return i}(),ir=function(i,e,t){var r=new jD,n=t!==null&&typeof t<"u"?t.toString():e.initialValue;r.write(n);var o=new qD(r.read());switch(e.type){case 2:var l=o.parseComponentValue();return e.parse(i,ws(l)?l.value:e.initialValue);case 0:return e.parse(i,o.parseComponentValue());case 1:return e.parse(i,o.parseComponentValues());case 4:return o.parseComponentValue();case 3:switch(e.format){case"angle":return Mv.parse(i,o.parseComponentValue());case"color":return Cd.parse(i,o.parseComponentValue());case"image":return aE.parse(i,o.parseComponentValue());case"length":var s=o.parseComponentValue();return wd(s)?s:ol;case"length-percentage":var g=o.parseComponentValue();return oa(g)?g:ol;case"time":return mR.parse(i,o.parseComponentValue())}break}},ile="data-html2canvas-debug",rle=function(i){var e=i.getAttribute(ile);switch(e){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},cE=function(i,e){var t=rle(i);return t===1||e===t},Jh=function(){function i(e,t){if(this.context=e,this.textNodes=[],this.elements=[],this.flags=0,cE(t,3))debugger;this.styles=new ele(e,window.getComputedStyle(t,null)),xE(t)&&(this.styles.animationDuration.some(function(r){return r>0})&&(t.style.animationDuration="0s"),this.styles.transform!==null&&(t.style.transform="none")),this.bounds=hv(this.context,t),cE(t,4)&&(this.flags|=16)}return i}(),nle="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",vR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n0=typeof Uint8Array>"u"?[]:new Uint8Array(256),Vv=0;Vv<vR.length;Vv++)n0[vR.charCodeAt(Vv)]=Vv;for(var sle=function(i){var e=i.length*.75,t=i.length,r,n=0,o,l,s,g;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);var b=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),T=Array.isArray(b)?b:new Uint8Array(b);for(r=0;r<t;r+=4)o=n0[i.charCodeAt(r)],l=n0[i.charCodeAt(r+1)],s=n0[i.charCodeAt(r+2)],g=n0[i.charCodeAt(r+3)],T[n++]=o<<2|l>>4,T[n++]=(l&15)<<4|s>>2,T[n++]=(s&3)<<6|g&63;return b},ole=function(i){for(var e=i.length,t=[],r=0;r<e;r+=2)t.push(i[r+1]<<8|i[r]);return t},ale=function(i){for(var e=i.length,t=[],r=0;r<e;r+=4)t.push(i[r+3]<<24|i[r+2]<<16|i[r+1]<<8|i[r]);return t},Df=5,uE=11,hE=2,lle=uE-Df,bR=65536>>Df,cle=1<<Df,AE=cle-1,ule=1024>>Df,hle=bR+ule,Ale=hle,dle=32,fle=Ale+dle,ple=65536>>uE,gle=1<<lle,mle=gle-1,xR=function(i,e,t){return i.slice?i.slice(e,t):new Uint16Array(Array.prototype.slice.call(i,e,t))},yle=function(i,e,t){return i.slice?i.slice(e,t):new Uint32Array(Array.prototype.slice.call(i,e,t))},_le=function(i,e){var t=sle(i),r=Array.isArray(t)?ale(t):new Uint32Array(t),n=Array.isArray(t)?ole(t):new Uint16Array(t),o=24,l=xR(n,o/2,r[4]/2),s=r[5]===2?xR(n,(o+r[4])/2):yle(r,Math.ceil((o+r[4])/4));return new vle(r[0],r[1],r[2],r[3],l,s)},vle=function(){function i(e,t,r,n,o,l){this.initialValue=e,this.errorValue=t,this.highStart=r,this.highValueIndex=n,this.index=o,this.data=l}return i.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>Df],t=(t<<hE)+(e&AE),this.data[t];if(e<=65535)return t=this.index[bR+(e-55296>>Df)],t=(t<<hE)+(e&AE),this.data[t];if(e<this.highStart)return t=fle-ple+(e>>uE),t=this.index[t],t+=e>>Df&mle,t=this.index[t],t=(t<<hE)+(e&AE),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},i}(),wR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ble=typeof Uint8Array>"u"?[]:new Uint8Array(256),Hv=0;Hv<wR.length;Hv++)ble[wR.charCodeAt(Hv)]=Hv;var xle=1,dE=2,fE=3,BR=4,CR=5,wle=7,ER=8,pE=9,gE=10,SR=11,TR=12,IR=13,LR=14,mE=15,Ble=function(i){for(var e=[],t=0,r=i.length;t<r;){var n=i.charCodeAt(t++);if(n>=55296&&n<=56319&&t<r){var o=i.charCodeAt(t++);(o&64512)===56320?e.push(((n&1023)<<10)+(o&1023)+65536):(e.push(n),t--)}else e.push(n)}return e},Cle=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,i);var t=i.length;if(!t)return"";for(var r=[],n=-1,o="";++n<t;){var l=i[n];l<=65535?r.push(l):(l-=65536,r.push((l>>10)+55296,l%1024+56320)),(n+1===t||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},Ele=_le(nle),Rf="",MR="",Sle=function(i){return Ele.get(i)},Tle=function(i,e,t){var r=t-2,n=e[r],o=e[t-1],l=e[t];if(o===dE&&l===fE)return Rf;if(o===dE||o===fE||o===BR||l===dE||l===fE||l===BR)return MR;if(o===ER&&[ER,pE,SR,TR].indexOf(l)!==-1||(o===SR||o===pE)&&(l===pE||l===gE)||(o===TR||o===gE)&&l===gE||l===IR||l===CR||l===wle||o===xle)return Rf;if(o===IR&&l===LR){for(;n===CR;)n=e[--r];if(n===LR)return Rf}if(o===mE&&l===mE){for(var s=0;n===mE;)s++,n=e[--r];if(s%2===0)return Rf}return MR},Ile=function(i){var e=Ble(i),t=e.length,r=0,n=0,o=e.map(Sle);return{next:function(){if(r>=t)return{done:!0,value:null};for(var l=Rf;r<t&&(l=Tle(e,o,++r))===Rf;);if(l!==Rf||r===t){var s=Cle.apply(null,e.slice(n,r));return n=r,{value:s,done:!1}}return{done:!0,value:null}}}},Lle=function(i){for(var e=Ile(i),t=[],r;!(r=e.next()).done;)r.value&&t.push(r.value.slice());return t},Mle=function(i){var e=123;if(i.createRange){var t=i.createRange();if(t.getBoundingClientRect){var r=i.createElement("boundtest");r.style.height=e+"px",r.style.display="block",i.body.appendChild(r),t.selectNode(r);var n=t.getBoundingClientRect(),o=Math.round(n.height);if(i.body.removeChild(r),o===e)return!0}}return!1},Ple=function(i){var e=i.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",i.body.appendChild(e);var t=i.createRange();e.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var r=e.firstChild,n=Av(r.data).map(function(g){return Go(g)}),o=0,l={},s=n.every(function(g,b){t.setStart(r,o),t.setEnd(r,o+g.length);var T=t.getBoundingClientRect();o+=g.length;var F=T.x>l.x||T.y>l.y;return l=T,b===0?!0:F});return i.body.removeChild(e),s},Fle=function(){return typeof new Image().crossOrigin<"u"},Dle=function(){return typeof new XMLHttpRequest().responseType=="string"},Rle=function(i){var e=new Image,t=i.createElement("canvas"),r=t.getContext("2d");if(!r)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(e,0,0),t.toDataURL()}catch{return!1}return!0},PR=function(i){return i[0]===0&&i[1]===255&&i[2]===0&&i[3]===255},kle=function(i){var e=i.createElement("canvas"),t=100;e.width=t,e.height=t;var r=e.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,t,t);var n=new Image,o=e.toDataURL();n.src=o;var l=yE(t,t,0,0,n);return r.fillStyle="red",r.fillRect(0,0,t,t),FR(l).then(function(s){r.drawImage(s,0,0);var g=r.getImageData(0,0,t,t).data;r.fillStyle="red",r.fillRect(0,0,t,t);var b=i.createElement("div");return b.style.backgroundImage="url("+o+")",b.style.height=t+"px",PR(g)?FR(yE(t,t,0,0,b)):Promise.reject(!1)}).then(function(s){return r.drawImage(s,0,0),PR(r.getImageData(0,0,t,t).data)}).catch(function(){return!1})},yE=function(i,e,t,r,n){var o="http://www.w3.org/2000/svg",l=document.createElementNS(o,"svg"),s=document.createElementNS(o,"foreignObject");return l.setAttributeNS(null,"width",i.toString()),l.setAttributeNS(null,"height",e.toString()),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"height","100%"),s.setAttributeNS(null,"x",t.toString()),s.setAttributeNS(null,"y",r.toString()),s.setAttributeNS(null,"externalResourcesRequired","true"),l.appendChild(s),s.appendChild(n),l},FR=function(i){return new Promise(function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(i))})},al={get SUPPORT_RANGE_BOUNDS(){var i=Mle(document);return Object.defineProperty(al,"SUPPORT_RANGE_BOUNDS",{value:i}),i},get SUPPORT_WORD_BREAKING(){var i=al.SUPPORT_RANGE_BOUNDS&&Ple(document);return Object.defineProperty(al,"SUPPORT_WORD_BREAKING",{value:i}),i},get SUPPORT_SVG_DRAWING(){var i=Rle(document);return Object.defineProperty(al,"SUPPORT_SVG_DRAWING",{value:i}),i},get SUPPORT_FOREIGNOBJECT_DRAWING(){var i=typeof Array.from=="function"&&typeof window.fetch=="function"?kle(document):Promise.resolve(!1);return Object.defineProperty(al,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:i}),i},get SUPPORT_CORS_IMAGES(){var i=Fle();return Object.defineProperty(al,"SUPPORT_CORS_IMAGES",{value:i}),i},get SUPPORT_RESPONSE_TYPE(){var i=Dle();return Object.defineProperty(al,"SUPPORT_RESPONSE_TYPE",{value:i}),i},get SUPPORT_CORS_XHR(){var i="withCredentials"in new XMLHttpRequest;return Object.defineProperty(al,"SUPPORT_CORS_XHR",{value:i}),i},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var i=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(al,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:i}),i}},s0=function(){function i(e,t){this.text=e,this.bounds=t}return i}(),Ole=function(i,e,t,r){var n=zle(e,t),o=[],l=0;return n.forEach(function(s){if(t.textDecorationLine.length||s.trim().length>0)if(al.SUPPORT_RANGE_BOUNDS){var g=DR(r,l,s.length).getClientRects();if(g.length>1){var b=_E(s),T=0;b.forEach(function(k){o.push(new s0(k,PA.fromDOMRectList(i,DR(r,T+l,k.length).getClientRects()))),T+=k.length})}else o.push(new s0(s,PA.fromDOMRectList(i,g)))}else{var F=r.splitText(s.length);o.push(new s0(s,Ule(i,r))),r=F}else al.SUPPORT_RANGE_BOUNDS||(r=r.splitText(s.length));l+=s.length}),o},Ule=function(i,e){var t=e.ownerDocument;if(t){var r=t.createElement("html2canvaswrapper");r.appendChild(e.cloneNode(!0));var n=e.parentNode;if(n){n.replaceChild(r,e);var o=hv(i,r);return r.firstChild&&n.replaceChild(r.firstChild,r),o}}return PA.EMPTY},DR=function(i,e,t){var r=i.ownerDocument;if(!r)throw new Error("Node has no owner document");var n=r.createRange();return n.setStart(i,e),n.setEnd(i,e+t),n},_E=function(i){if(al.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(i)).map(function(t){return t.segment})}return Lle(i)},Nle=function(i,e){if(al.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(t.segment(i)).map(function(r){return r.segment})}return Vle(i,e)},zle=function(i,e){return e.letterSpacing!==0?_E(i):Nle(i,e)},Qle=[32,160,4961,65792,65793,4153,4241],Vle=function(i,e){for(var t=pse(i,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap==="break-word"?"break-word":e.wordBreak}),r=[],n,o=function(){if(n.value){var l=n.value.slice(),s=Av(l),g="";s.forEach(function(b){Qle.indexOf(b)===-1?g+=Go(b):(g.length&&r.push(g),r.push(Go(b)),g="")}),g.length&&r.push(g)}};!(n=t.next()).done;)o();return r},Hle=function(){function i(e,t,r){this.text=Gle(t.data,r.textTransform),this.textBounds=Ole(e,this.text,r,t)}return i}(),Gle=function(i,e){switch(e){case 1:return i.toLowerCase();case 3:return i.replace(jle,qle);case 2:return i.toUpperCase();default:return i}},jle=/(^|\s|:|-|\(|\))([a-z])/g,qle=function(i,e,t){return i.length>0?e+t.toUpperCase():i},RR=function(i){hh(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.src=r.currentSrc||r.src,n.intrinsicWidth=r.naturalWidth,n.intrinsicHeight=r.naturalHeight,n.context.cache.addImage(n.src),n}return e}(Jh),kR=function(i){hh(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.canvas=r,n.intrinsicWidth=r.width,n.intrinsicHeight=r.height,n}return e}(Jh),OR=function(i){hh(e,i);function e(t,r){var n=i.call(this,t,r)||this,o=new XMLSerializer,l=hv(t,r);return r.setAttribute("width",l.width+"px"),r.setAttribute("height",l.height+"px"),n.svg="data:image/svg+xml,"+encodeURIComponent(o.serializeToString(r)),n.intrinsicWidth=r.width.baseVal.value,n.intrinsicHeight=r.height.baseVal.value,n.context.cache.addImage(n.svg),n}return e}(Jh),UR=function(i){hh(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.value=r.value,n}return e}(Jh),vE=function(i){hh(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.start=r.start,n.reversed=typeof r.reversed=="boolean"&&r.reversed===!0,n}return e}(Jh),$le=[{type:15,flags:0,unit:"px",number:3}],Kle=[{type:16,flags:0,number:50}],Wle=function(i){return i.width>i.height?new PA(i.left+(i.width-i.height)/2,i.top,i.height,i.height):i.width<i.height?new PA(i.left,i.top+(i.height-i.width)/2,i.width,i.width):i},Xle=function(i){var e=i.type===Zle?new Array(i.value.length+1).join(""):i.value;return e.length===0?i.placeholder||"":e},Gv="checkbox",jv="radio",Zle="password",NR=707406591,bE=function(i){hh(e,i);function e(t,r){var n=i.call(this,t,r)||this;switch(n.type=r.type.toLowerCase(),n.checked=r.checked,n.value=Xle(r),(n.type===Gv||n.type===jv)&&(n.styles.backgroundColor=3739148031,n.styles.borderTopColor=n.styles.borderRightColor=n.styles.borderBottomColor=n.styles.borderLeftColor=2779096575,n.styles.borderTopWidth=n.styles.borderRightWidth=n.styles.borderBottomWidth=n.styles.borderLeftWidth=1,n.styles.borderTopStyle=n.styles.borderRightStyle=n.styles.borderBottomStyle=n.styles.borderLeftStyle=1,n.styles.backgroundClip=[0],n.styles.backgroundOrigin=[0],n.bounds=Wle(n.bounds)),n.type){case Gv:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=$le;break;case jv:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=Kle;break}return n}return e}(Jh),zR=function(i){hh(e,i);function e(t,r){var n=i.call(this,t,r)||this,o=r.options[r.selectedIndex||0];return n.value=o&&o.text||"",n}return e}(Jh),QR=function(i){hh(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.value=r.value,n}return e}(Jh),VR=function(i){hh(e,i);function e(t,r){var n=i.call(this,t,r)||this;n.src=r.src,n.width=parseInt(r.width,10)||0,n.height=parseInt(r.height,10)||0,n.backgroundColor=n.styles.backgroundColor;try{if(r.contentWindow&&r.contentWindow.document&&r.contentWindow.document.documentElement){n.tree=GR(t,r.contentWindow.document.documentElement);var o=r.contentWindow.document.documentElement?i0(t,getComputedStyle(r.contentWindow.document.documentElement).backgroundColor):DA.TRANSPARENT,l=r.contentWindow.document.body?i0(t,getComputedStyle(r.contentWindow.document.body).backgroundColor):DA.TRANSPARENT;n.backgroundColor=Ed(o)?Ed(l)?n.styles.backgroundColor:l:o}}catch{}return n}return e}(Jh),Jle=["OL","UL","MENU"],qv=function(i,e,t,r){for(var n=e.firstChild,o=void 0;n;n=o)if(o=n.nextSibling,jR(n)&&n.data.trim().length>0)t.textNodes.push(new Hle(i,n,t.styles));else if(zg(n))if(ZR(n)&&n.assignedNodes)n.assignedNodes().forEach(function(s){return qv(i,s,t,r)});else{var l=HR(i,n);l.styles.isVisible()&&(Yle(n,l,r)?l.flags|=4:ece(l.styles)&&(l.flags|=2),Jle.indexOf(n.tagName)!==-1&&(l.flags|=8),t.elements.push(l),n.slot,n.shadowRoot?qv(i,n.shadowRoot,l,r):!Kv(n)&&!qR(n)&&!Wv(n)&&qv(i,n,l,r))}},HR=function(i,e){return BE(e)?new RR(i,e):$R(e)?new kR(i,e):qR(e)?new OR(i,e):tce(e)?new UR(i,e):ice(e)?new vE(i,e):rce(e)?new bE(i,e):Wv(e)?new zR(i,e):Kv(e)?new QR(i,e):WR(e)?new VR(i,e):new Jh(i,e)},GR=function(i,e){var t=HR(i,e);return t.flags|=4,qv(i,e,t,t),t},Yle=function(i,e,t){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||wE(i)&&t.styles.isTransparent()},ece=function(i){return i.isPositioned()||i.isFloating()},jR=function(i){return i.nodeType===Node.TEXT_NODE},zg=function(i){return i.nodeType===Node.ELEMENT_NODE},xE=function(i){return zg(i)&&typeof i.style<"u"&&!$v(i)},$v=function(i){return typeof i.className=="object"},tce=function(i){return i.tagName==="LI"},ice=function(i){return i.tagName==="OL"},rce=function(i){return i.tagName==="INPUT"},nce=function(i){return i.tagName==="HTML"},qR=function(i){return i.tagName==="svg"},wE=function(i){return i.tagName==="BODY"},$R=function(i){return i.tagName==="CANVAS"},KR=function(i){return i.tagName==="VIDEO"},BE=function(i){return i.tagName==="IMG"},WR=function(i){return i.tagName==="IFRAME"},XR=function(i){return i.tagName==="STYLE"},sce=function(i){return i.tagName==="SCRIPT"},Kv=function(i){return i.tagName==="TEXTAREA"},Wv=function(i){return i.tagName==="SELECT"},ZR=function(i){return i.tagName==="SLOT"},JR=function(i){return i.tagName.indexOf("-")>0},oce=function(){function i(){this.counters={}}return i.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},i.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},i.prototype.pop=function(e){var t=this;e.forEach(function(r){return t.counters[r].pop()})},i.prototype.parse=function(e){var t=this,r=e.counterIncrement,n=e.counterReset,o=!0;r!==null&&r.forEach(function(s){var g=t.counters[s.counter];g&&s.increment!==0&&(o=!1,g.length||g.push(1),g[Math.max(0,g.length-1)]+=s.increment)});var l=[];return o&&n.forEach(function(s){var g=t.counters[s.counter];l.push(s.counter),g||(g=t.counters[s.counter]=[]),g.push(s.reset)}),l},i}(),YR={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},ek={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},ace={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},lce={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Qg=function(i,e,t,r,n,o){return i<e||i>t?a0(i,n,o.length>0):r.integers.reduce(function(l,s,g){for(;i>=s;)i-=s,l+=r.values[g];return l},"")+o},tk=function(i,e,t,r){var n="";do t||i--,n=r(i)+n,i/=e;while(i*e>=e);return n},jo=function(i,e,t,r,n){var o=t-e+1;return(i<0?"-":"")+(tk(Math.abs(i),o,r,function(l){return Go(Math.floor(l%o)+e)})+n)},kf=function(i,e,t){t===void 0&&(t=". ");var r=e.length;return tk(Math.abs(i),r,!1,function(n){return e[Math.floor(n%r)]})+t},Vg=1,Td=2,Id=4,o0=8,RA=function(i,e,t,r,n,o){if(i<-9999||i>9999)return a0(i,4,n.length>0);var l=Math.abs(i),s=n;if(l===0)return e[0]+s;for(var g=0;l>0&&g<=4;g++){var b=l%10;b===0&&Ba(o,Vg)&&s!==""?s=e[b]+s:b>1||b===1&&g===0||b===1&&g===1&&Ba(o,Td)||b===1&&g===1&&Ba(o,Id)&&i>100||b===1&&g>1&&Ba(o,o0)?s=e[b]+(g>0?t[g-1]:"")+s:b===1&&g>0&&(s=t[g-1]+s),l=Math.floor(l/10)}return(i<0?r:"")+s},ik="",rk="",nk="",CE="",a0=function(i,e,t){var r=t?". ":"",n=t?"":"",o=t?", ":"",l=t?" ":"";switch(e){case 0:return""+l;case 1:return""+l;case 2:return""+l;case 5:var s=jo(i,48,57,!0,r);return s.length<4?"0"+s:s;case 4:return kf(i,"",n);case 6:return Qg(i,1,3999,YR,3,r).toLowerCase();case 7:return Qg(i,1,3999,YR,3,r);case 8:return jo(i,945,969,!1,r);case 9:return jo(i,97,122,!1,r);case 10:return jo(i,65,90,!1,r);case 11:return jo(i,1632,1641,!0,r);case 12:case 49:return Qg(i,1,9999,ek,3,r);case 35:return Qg(i,1,9999,ek,3,r).toLowerCase();case 13:return jo(i,2534,2543,!0,r);case 14:case 30:return jo(i,6112,6121,!0,r);case 15:return kf(i,"",n);case 16:return kf(i,"",n);case 17:case 48:return RA(i,"",ik,"",n,Td|Id|o0);case 47:return RA(i,"",rk,"",n,Vg|Td|Id|o0);case 42:return RA(i,"",ik,"",n,Td|Id|o0);case 41:return RA(i,"",rk,"",n,Vg|Td|Id|o0);case 26:return RA(i,"","",nk,n,0);case 25:return RA(i,"","",nk,n,Vg|Td|Id);case 31:return RA(i,"","",CE,o,Vg|Td|Id);case 33:return RA(i,"","",CE,o,0);case 32:return RA(i,"","",CE,o,Vg|Td|Id);case 18:return jo(i,2406,2415,!0,r);case 20:return Qg(i,1,19999,lce,3,r);case 21:return jo(i,2790,2799,!0,r);case 22:return jo(i,2662,2671,!0,r);case 22:return Qg(i,1,10999,ace,3,r);case 23:return kf(i,"");case 24:return kf(i,"");case 27:return jo(i,3302,3311,!0,r);case 28:return kf(i,"",n);case 29:return kf(i,"",n);case 34:return jo(i,3792,3801,!0,r);case 37:return jo(i,6160,6169,!0,r);case 38:return jo(i,4160,4169,!0,r);case 39:return jo(i,2918,2927,!0,r);case 40:return jo(i,1776,1785,!0,r);case 43:return jo(i,3046,3055,!0,r);case 44:return jo(i,3174,3183,!0,r);case 45:return jo(i,3664,3673,!0,r);case 46:return jo(i,3872,3881,!0,r);case 3:default:return jo(i,48,57,!0,r)}},sk="data-html2canvas-ignore",ok=function(){function i(e,t,r){if(this.context=e,this.options=r,this.scrolledElements=[],this.referenceElement=t,this.counters=new oce,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return i.prototype.toIFrame=function(e,t){var r=this,n=cce(e,t);if(!n.contentWindow)return Promise.reject("Unable to find iframe window");var o=e.defaultView.pageXOffset,l=e.defaultView.pageYOffset,s=n.contentWindow,g=s.document,b=Ace(n).then(function(){return ac(r,void 0,void 0,function(){var T,F;return Rl(this,function(k){switch(k.label){case 0:return this.scrolledElements.forEach(gce),s&&(s.scrollTo(t.left,t.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(s.scrollY!==t.top||s.scrollX!==t.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(s.scrollX-t.left,s.scrollY-t.top,0,0))),T=this.options.onclone,F=this.clonedReferenceElement,typeof F>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:g.fonts&&g.fonts.ready?[4,g.fonts.ready]:[3,2];case 1:k.sent(),k.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,hce(g)]:[3,4];case 3:k.sent(),k.label=4;case 4:return typeof T=="function"?[2,Promise.resolve().then(function(){return T(g,F)}).then(function(){return n})]:[2,n]}})})});return g.open(),g.write(fce(document.doctype)+"<html></html>"),pce(this.referenceElement.ownerDocument,o,l),g.replaceChild(g.adoptNode(this.documentElement),g.documentElement),g.close(),b},i.prototype.createElementClone=function(e){if(cE(e,2))debugger;if($R(e))return this.createCanvasClone(e);if(KR(e))return this.createVideoClone(e);if(XR(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return BE(t)&&(BE(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager")),JR(t)?this.createCustomElementClone(t):t},i.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return EE(e.style,t),t},i.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var r=[].slice.call(t.cssRules,0).reduce(function(o,l){return l&&typeof l.cssText=="string"?o+l.cssText:o},""),n=e.cloneNode(!1);return n.textContent=r,n}}catch(o){if(this.context.logger.error("Unable to access cssRules property",o),o.name!=="SecurityError")throw o}return e.cloneNode(!1)},i.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var r=e.ownerDocument.createElement("img");try{return r.src=e.toDataURL(),r}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var n=e.cloneNode(!1);try{n.width=e.width,n.height=e.height;var o=e.getContext("2d"),l=n.getContext("2d");if(l)if(!this.options.allowTaint&&o)l.putImageData(o.getImageData(0,0,e.width,e.height),0,0);else{var s=(t=e.getContext("webgl2"))!==null&&t!==void 0?t:e.getContext("webgl");if(s){var g=s.getContextAttributes();(g==null?void 0:g.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}l.drawImage(e,0,0)}return n}catch{this.context.logger.info("Unable to clone canvas as it is tainted",e)}return n},i.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var r=t.getContext("2d");try{return r&&(r.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||r.getImageData(0,0,t.width,t.height)),t}catch{this.context.logger.info("Unable to clone video as it is tainted",e)}var n=e.ownerDocument.createElement("canvas");return n.width=e.offsetWidth,n.height=e.offsetHeight,n},i.prototype.appendChildNode=function(e,t,r){(!zg(t)||!sce(t)&&!t.hasAttribute(sk)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(t)))&&(!this.options.copyStyles||!zg(t)||!XR(t))&&e.appendChild(this.cloneNode(t,r))},i.prototype.cloneChildNodes=function(e,t,r){for(var n=this,o=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;o;o=o.nextSibling)if(zg(o)&&ZR(o)&&typeof o.assignedNodes=="function"){var l=o.assignedNodes();l.length&&l.forEach(function(s){return n.appendChildNode(t,s,r)})}else this.appendChildNode(t,o,r)},i.prototype.cloneNode=function(e,t){if(jR(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var r=e.ownerDocument.defaultView;if(r&&zg(e)&&(xE(e)||$v(e))){var n=this.createElementClone(e);n.style.transitionProperty="none";var o=r.getComputedStyle(e),l=r.getComputedStyle(e,":before"),s=r.getComputedStyle(e,":after");this.referenceElement===e&&xE(n)&&(this.clonedReferenceElement=n),wE(n)&&_ce(n);var g=this.counters.parse(new _R(this.context,o)),b=this.resolvePseudoContent(e,n,l,l0.BEFORE);JR(e)&&(t=!0),KR(e)||this.cloneChildNodes(e,n,t),b&&n.insertBefore(b,n.firstChild);var T=this.resolvePseudoContent(e,n,s,l0.AFTER);return T&&n.appendChild(T),this.counters.pop(g),(o&&(this.options.copyStyles||$v(e))&&!WR(e)||t)&&EE(o,n),(e.scrollTop!==0||e.scrollLeft!==0)&&this.scrolledElements.push([n,e.scrollLeft,e.scrollTop]),(Kv(e)||Wv(e))&&(Kv(n)||Wv(n))&&(n.value=e.value),n}return e.cloneNode(!1)},i.prototype.resolvePseudoContent=function(e,t,r,n){var o=this;if(r){var l=r.content,s=t.ownerDocument;if(!(!s||!l||l==="none"||l==="-moz-alt-content"||r.display==="none")){this.counters.parse(new _R(this.context,r));var g=new tle(this.context,r),b=s.createElement("html2canvaspseudoelement");EE(r,b),g.content.forEach(function(F){if(F.type===0)b.appendChild(s.createTextNode(F.value));else if(F.type===22){var k=s.createElement("img");k.src=F.value,k.style.opacity="1",b.appendChild(k)}else if(F.type===18){if(F.name==="attr"){var z=F.values.filter(ws);z.length&&b.appendChild(s.createTextNode(e.getAttribute(z[0].value)||""))}else if(F.name==="counter"){var J=F.values.filter(Ug),te=J[0],ue=J[1];if(te&&ws(te)){var ce=o.counters.getCounterValue(te.value),de=ue&&ws(ue)?lE.parse(o.context,ue.value):3;b.appendChild(s.createTextNode(a0(ce,de,!1)))}}else if(F.name==="counters"){var _e=F.values.filter(Ug),te=_e[0],Ee=_e[1],ue=_e[2];if(te&&ws(te)){var He=o.counters.getCounterValues(te.value),Ve=ue&&ws(ue)?lE.parse(o.context,ue.value):3,qe=Ee&&Ee.type===0?Ee.value:"",Ue=He.map(function(De){return a0(De,Ve,!1)}).join(qe);b.appendChild(s.createTextNode(Ue))}}}else if(F.type===20)switch(F.value){case"open-quote":b.appendChild(s.createTextNode(yR(g.quotes,o.quoteDepth++,!0)));break;case"close-quote":b.appendChild(s.createTextNode(yR(g.quotes,--o.quoteDepth,!1)));break;default:b.appendChild(s.createTextNode(F.value))}}),b.className=SE+" "+TE;var T=n===l0.BEFORE?" "+SE:" "+TE;return $v(t)?t.className.baseValue+=T:t.className+=T,b}}},i.destroy=function(e){return e.parentNode?(e.parentNode.removeChild(e),!0):!1},i}(),l0;(function(i){i[i.BEFORE=0]="BEFORE",i[i.AFTER=1]="AFTER"})(l0||(l0={}));var cce=function(i,e){var t=i.createElement("iframe");return t.className="html2canvas-container",t.style.visibility="hidden",t.style.position="fixed",t.style.left="-10000px",t.style.top="0px",t.style.border="0",t.width=e.width.toString(),t.height=e.height.toString(),t.scrolling="no",t.setAttribute(sk,"true"),i.body.appendChild(t),t},uce=function(i){return new Promise(function(e){if(i.complete){e();return}if(!i.src){e();return}i.onload=e,i.onerror=e})},hce=function(i){return Promise.all([].slice.call(i.images,0).map(uce))},Ace=function(i){return new Promise(function(e,t){var r=i.contentWindow;if(!r)return t("No window assigned for iframe");var n=r.document;r.onload=i.onload=function(){r.onload=i.onload=null;var o=setInterval(function(){n.body.childNodes.length>0&&n.readyState==="complete"&&(clearInterval(o),e(i))},50)}})},dce=["all","d","content"],EE=function(i,e){for(var t=i.length-1;t>=0;t--){var r=i.item(t);dce.indexOf(r)===-1&&e.style.setProperty(r,i.getPropertyValue(r))}return e},fce=function(i){var e="";return i&&(e+="<!DOCTYPE ",i.name&&(e+=i.name),i.internalSubset&&(e+=i.internalSubset),i.publicId&&(e+='"'+i.publicId+'"'),i.systemId&&(e+='"'+i.systemId+'"'),e+=">"),e},pce=function(i,e,t){i&&i.defaultView&&(e!==i.defaultView.pageXOffset||t!==i.defaultView.pageYOffset)&&i.defaultView.scrollTo(e,t)},gce=function(i){var e=i[0],t=i[1],r=i[2];e.scrollLeft=t,e.scrollTop=r},mce=":before",yce=":after",SE="___html2canvas___pseudoelement_before",TE="___html2canvas___pseudoelement_after",ak=`{
    content: "" !important;
    display: none !important;
}`,_ce=function(i){vce(i,"."+SE+mce+ak+`
         .`+TE+yce+ak)},vce=function(i,e){var t=i.ownerDocument;if(t){var r=t.createElement("style");r.textContent=e,i.appendChild(r)}},lk=function(){function i(){}return i.getOrigin=function(e){var t=i._link;return t?(t.href=e,t.href=t.href,t.protocol+t.hostname+t.port):"about:blank"},i.isSameOrigin=function(e){return i.getOrigin(e)===i._origin},i.setContext=function(e){i._link=e.document.createElement("a"),i._origin=i.getOrigin(e.location.href)},i._origin="about:blank",i}(),bce=function(){function i(e,t){this.context=e,this._options=t,this._cache={}}return i.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)||(LE(e)||Cce(e))&&(this._cache[e]=this.loadImage(e)).catch(function(){}),t},i.prototype.match=function(e){return this._cache[e]},i.prototype.loadImage=function(e){return ac(this,void 0,void 0,function(){var t,r,n,o,l=this;return Rl(this,function(s){switch(s.label){case 0:return t=lk.isSameOrigin(e),r=!IE(e)&&this._options.useCORS===!0&&al.SUPPORT_CORS_IMAGES&&!t,n=!IE(e)&&!t&&!LE(e)&&typeof this._options.proxy=="string"&&al.SUPPORT_CORS_XHR&&!r,!t&&this._options.allowTaint===!1&&!IE(e)&&!LE(e)&&!n&&!r?[2]:(o=e,n?[4,this.proxy(o)]:[3,2]);case 1:o=s.sent(),s.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(g,b){var T=new Image;T.onload=function(){return g(T)},T.onerror=b,(Ece(o)||r)&&(T.crossOrigin="anonymous"),T.src=o,T.complete===!0&&setTimeout(function(){return g(T)},500),l._options.imageTimeout>0&&setTimeout(function(){return b("Timed out ("+l._options.imageTimeout+"ms) loading image")},l._options.imageTimeout)})];case 3:return[2,s.sent()]}})})},i.prototype.has=function(e){return typeof this._cache[e]<"u"},i.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},i.prototype.proxy=function(e){var t=this,r=this._options.proxy;if(!r)throw new Error("No proxy defined");var n=e.substring(0,256);return new Promise(function(o,l){var s=al.SUPPORT_RESPONSE_TYPE?"blob":"text",g=new XMLHttpRequest;g.onload=function(){if(g.status===200)if(s==="text")o(g.response);else{var F=new FileReader;F.addEventListener("load",function(){return o(F.result)},!1),F.addEventListener("error",function(k){return l(k)},!1),F.readAsDataURL(g.response)}else l("Failed to proxy resource "+n+" with status code "+g.status)},g.onerror=l;var b=r.indexOf("?")>-1?"&":"?";if(g.open("GET",""+r+b+"url="+encodeURIComponent(e)+"&responseType="+s),s!=="text"&&g instanceof XMLHttpRequest&&(g.responseType=s),t._options.imageTimeout){var T=t._options.imageTimeout;g.timeout=T,g.ontimeout=function(){return l("Timed out ("+T+"ms) proxying "+n)}}g.send()})},i}(),xce=/^data:image\/svg\+xml/i,wce=/^data:image\/.*;base64,/i,Bce=/^data:image\/.*/i,Cce=function(i){return al.SUPPORT_SVG_DRAWING||!Sce(i)},IE=function(i){return Bce.test(i)},Ece=function(i){return wce.test(i)},LE=function(i){return i.substr(0,4)==="blob"},Sce=function(i){return i.substr(-3).toLowerCase()==="svg"||xce.test(i)},er=function(){function i(e,t){this.type=0,this.x=e,this.y=t}return i.prototype.add=function(e,t){return new i(this.x+e,this.y+t)},i}(),Hg=function(i,e,t){return new er(i.x+(e.x-i.x)*t,i.y+(e.y-i.y)*t)},Xv=function(){function i(e,t,r,n){this.type=1,this.start=e,this.startControl=t,this.endControl=r,this.end=n}return i.prototype.subdivide=function(e,t){var r=Hg(this.start,this.startControl,e),n=Hg(this.startControl,this.endControl,e),o=Hg(this.endControl,this.end,e),l=Hg(r,n,e),s=Hg(n,o,e),g=Hg(l,s,e);return t?new i(this.start,r,l,g):new i(g,s,o,this.end)},i.prototype.add=function(e,t){return new i(this.start.add(e,t),this.startControl.add(e,t),this.endControl.add(e,t),this.end.add(e,t))},i.prototype.reverse=function(){return new i(this.end,this.endControl,this.startControl,this.start)},i}(),Mu=function(i){return i.type===1},Tce=function(){function i(e){var t=e.styles,r=e.bounds,n=t0(t.borderTopLeftRadius,r.width,r.height),o=n[0],l=n[1],s=t0(t.borderTopRightRadius,r.width,r.height),g=s[0],b=s[1],T=t0(t.borderBottomRightRadius,r.width,r.height),F=T[0],k=T[1],z=t0(t.borderBottomLeftRadius,r.width,r.height),J=z[0],te=z[1],ue=[];ue.push((o+g)/r.width),ue.push((J+F)/r.width),ue.push((l+te)/r.height),ue.push((b+k)/r.height);var ce=Math.max.apply(Math,ue);ce>1&&(o/=ce,l/=ce,g/=ce,b/=ce,F/=ce,k/=ce,J/=ce,te/=ce);var de=r.width-g,_e=r.height-k,Ee=r.width-F,He=r.height-te,Ve=t.borderTopWidth,qe=t.borderRightWidth,Ue=t.borderBottomWidth,ot=t.borderLeftWidth,it=Vs(t.paddingTop,e.bounds.width),De=Vs(t.paddingRight,e.bounds.width),Me=Vs(t.paddingBottom,e.bounds.width),Ze=Vs(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=o>0||l>0?Js(r.left+ot/3,r.top+Ve/3,o-ot/3,l-Ve/3,ls.TOP_LEFT):new er(r.left+ot/3,r.top+Ve/3),this.topRightBorderDoubleOuterBox=o>0||l>0?Js(r.left+de,r.top+Ve/3,g-qe/3,b-Ve/3,ls.TOP_RIGHT):new er(r.left+r.width-qe/3,r.top+Ve/3),this.bottomRightBorderDoubleOuterBox=F>0||k>0?Js(r.left+Ee,r.top+_e,F-qe/3,k-Ue/3,ls.BOTTOM_RIGHT):new er(r.left+r.width-qe/3,r.top+r.height-Ue/3),this.bottomLeftBorderDoubleOuterBox=J>0||te>0?Js(r.left+ot/3,r.top+He,J-ot/3,te-Ue/3,ls.BOTTOM_LEFT):new er(r.left+ot/3,r.top+r.height-Ue/3),this.topLeftBorderDoubleInnerBox=o>0||l>0?Js(r.left+ot*2/3,r.top+Ve*2/3,o-ot*2/3,l-Ve*2/3,ls.TOP_LEFT):new er(r.left+ot*2/3,r.top+Ve*2/3),this.topRightBorderDoubleInnerBox=o>0||l>0?Js(r.left+de,r.top+Ve*2/3,g-qe*2/3,b-Ve*2/3,ls.TOP_RIGHT):new er(r.left+r.width-qe*2/3,r.top+Ve*2/3),this.bottomRightBorderDoubleInnerBox=F>0||k>0?Js(r.left+Ee,r.top+_e,F-qe*2/3,k-Ue*2/3,ls.BOTTOM_RIGHT):new er(r.left+r.width-qe*2/3,r.top+r.height-Ue*2/3),this.bottomLeftBorderDoubleInnerBox=J>0||te>0?Js(r.left+ot*2/3,r.top+He,J-ot*2/3,te-Ue*2/3,ls.BOTTOM_LEFT):new er(r.left+ot*2/3,r.top+r.height-Ue*2/3),this.topLeftBorderStroke=o>0||l>0?Js(r.left+ot/2,r.top+Ve/2,o-ot/2,l-Ve/2,ls.TOP_LEFT):new er(r.left+ot/2,r.top+Ve/2),this.topRightBorderStroke=o>0||l>0?Js(r.left+de,r.top+Ve/2,g-qe/2,b-Ve/2,ls.TOP_RIGHT):new er(r.left+r.width-qe/2,r.top+Ve/2),this.bottomRightBorderStroke=F>0||k>0?Js(r.left+Ee,r.top+_e,F-qe/2,k-Ue/2,ls.BOTTOM_RIGHT):new er(r.left+r.width-qe/2,r.top+r.height-Ue/2),this.bottomLeftBorderStroke=J>0||te>0?Js(r.left+ot/2,r.top+He,J-ot/2,te-Ue/2,ls.BOTTOM_LEFT):new er(r.left+ot/2,r.top+r.height-Ue/2),this.topLeftBorderBox=o>0||l>0?Js(r.left,r.top,o,l,ls.TOP_LEFT):new er(r.left,r.top),this.topRightBorderBox=g>0||b>0?Js(r.left+de,r.top,g,b,ls.TOP_RIGHT):new er(r.left+r.width,r.top),this.bottomRightBorderBox=F>0||k>0?Js(r.left+Ee,r.top+_e,F,k,ls.BOTTOM_RIGHT):new er(r.left+r.width,r.top+r.height),this.bottomLeftBorderBox=J>0||te>0?Js(r.left,r.top+He,J,te,ls.BOTTOM_LEFT):new er(r.left,r.top+r.height),this.topLeftPaddingBox=o>0||l>0?Js(r.left+ot,r.top+Ve,Math.max(0,o-ot),Math.max(0,l-Ve),ls.TOP_LEFT):new er(r.left+ot,r.top+Ve),this.topRightPaddingBox=g>0||b>0?Js(r.left+Math.min(de,r.width-qe),r.top+Ve,de>r.width+qe?0:Math.max(0,g-qe),Math.max(0,b-Ve),ls.TOP_RIGHT):new er(r.left+r.width-qe,r.top+Ve),this.bottomRightPaddingBox=F>0||k>0?Js(r.left+Math.min(Ee,r.width-ot),r.top+Math.min(_e,r.height-Ue),Math.max(0,F-qe),Math.max(0,k-Ue),ls.BOTTOM_RIGHT):new er(r.left+r.width-qe,r.top+r.height-Ue),this.bottomLeftPaddingBox=J>0||te>0?Js(r.left+ot,r.top+Math.min(He,r.height-Ue),Math.max(0,J-ot),Math.max(0,te-Ue),ls.BOTTOM_LEFT):new er(r.left+ot,r.top+r.height-Ue),this.topLeftContentBox=o>0||l>0?Js(r.left+ot+Ze,r.top+Ve+it,Math.max(0,o-(ot+Ze)),Math.max(0,l-(Ve+it)),ls.TOP_LEFT):new er(r.left+ot+Ze,r.top+Ve+it),this.topRightContentBox=g>0||b>0?Js(r.left+Math.min(de,r.width+ot+Ze),r.top+Ve+it,de>r.width+ot+Ze?0:g-ot+Ze,b-(Ve+it),ls.TOP_RIGHT):new er(r.left+r.width-(qe+De),r.top+Ve+it),this.bottomRightContentBox=F>0||k>0?Js(r.left+Math.min(Ee,r.width-(ot+Ze)),r.top+Math.min(_e,r.height+Ve+it),Math.max(0,F-(qe+De)),k-(Ue+Me),ls.BOTTOM_RIGHT):new er(r.left+r.width-(qe+De),r.top+r.height-(Ue+Me)),this.bottomLeftContentBox=J>0||te>0?Js(r.left+ot+Ze,r.top+He,Math.max(0,J-(ot+Ze)),te-(Ue+Me),ls.BOTTOM_LEFT):new er(r.left+ot+Ze,r.top+r.height-(Ue+Me))}return i}(),ls;(function(i){i[i.TOP_LEFT=0]="TOP_LEFT",i[i.TOP_RIGHT=1]="TOP_RIGHT",i[i.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",i[i.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(ls||(ls={}));var Js=function(i,e,t,r,n){var o=4*((Math.sqrt(2)-1)/3),l=t*o,s=r*o,g=i+t,b=e+r;switch(n){case ls.TOP_LEFT:return new Xv(new er(i,b),new er(i,b-s),new er(g-l,e),new er(g,e));case ls.TOP_RIGHT:return new Xv(new er(i,e),new er(i+l,e),new er(g,b-s),new er(g,b));case ls.BOTTOM_RIGHT:return new Xv(new er(g,e),new er(g,e+s),new er(i+l,b),new er(i,b));case ls.BOTTOM_LEFT:default:return new Xv(new er(g,b),new er(g-l,b),new er(i,e+s),new er(i,e))}},Zv=function(i){return[i.topLeftBorderBox,i.topRightBorderBox,i.bottomRightBorderBox,i.bottomLeftBorderBox]},Ice=function(i){return[i.topLeftContentBox,i.topRightContentBox,i.bottomRightContentBox,i.bottomLeftContentBox]},Jv=function(i){return[i.topLeftPaddingBox,i.topRightPaddingBox,i.bottomRightPaddingBox,i.bottomLeftPaddingBox]},Lce=function(){function i(e,t,r){this.offsetX=e,this.offsetY=t,this.matrix=r,this.type=0,this.target=6}return i}(),Yv=function(){function i(e,t){this.path=e,this.target=t,this.type=1}return i}(),Mce=function(){function i(e){this.opacity=e,this.type=2,this.target=6}return i}(),Pce=function(i){return i.type===0},ck=function(i){return i.type===1},Fce=function(i){return i.type===2},uk=function(i,e){return i.length===e.length?i.some(function(t,r){return t===e[r]}):!1},Dce=function(i,e,t,r,n){return i.map(function(o,l){switch(l){case 0:return o.add(e,t);case 1:return o.add(e+r,t);case 2:return o.add(e+r,t+n);case 3:return o.add(e,t+n)}return o})},hk=function(){function i(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return i}(),Ak=function(){function i(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new Tce(this.container),this.container.styles.opacity<1&&this.effects.push(new Mce(this.container.styles.opacity)),this.container.styles.transform!==null){var r=this.container.bounds.left+this.container.styles.transformOrigin[0].number,n=this.container.bounds.top+this.container.styles.transformOrigin[1].number,o=this.container.styles.transform;this.effects.push(new Lce(r,n,o))}if(this.container.styles.overflowX!==0){var l=Zv(this.curves),s=Jv(this.curves);uk(l,s)?this.effects.push(new Yv(l,6)):(this.effects.push(new Yv(l,2)),this.effects.push(new Yv(s,4)))}}return i.prototype.getEffects=function(e){for(var t=[2,3].indexOf(this.container.styles.position)===-1,r=this.parent,n=this.effects.slice(0);r;){var o=r.effects.filter(function(g){return!ck(g)});if(t||r.container.styles.position!==0||!r.parent){if(n.unshift.apply(n,o),t=[2,3].indexOf(r.container.styles.position)===-1,r.container.styles.overflowX!==0){var l=Zv(r.curves),s=Jv(r.curves);uk(l,s)||n.unshift(new Yv(s,6))}}else n.unshift.apply(n,o);r=r.parent}return n.filter(function(g){return Ba(g.target,e)})},i}(),ME=function(i,e,t,r){i.container.elements.forEach(function(n){var o=Ba(n.flags,4),l=Ba(n.flags,2),s=new Ak(n,i);Ba(n.styles.display,2048)&&r.push(s);var g=Ba(n.flags,8)?[]:r;if(o||l){var b=o||n.styles.isPositioned()?t:e,T=new hk(s);if(n.styles.isPositioned()||n.styles.opacity<1||n.styles.isTransformed()){var F=n.styles.zIndex.order;if(F<0){var k=0;b.negativeZIndex.some(function(J,te){return F>J.element.container.styles.zIndex.order?(k=te,!1):k>0}),b.negativeZIndex.splice(k,0,T)}else if(F>0){var z=0;b.positiveZIndex.some(function(J,te){return F>=J.element.container.styles.zIndex.order?(z=te+1,!1):z>0}),b.positiveZIndex.splice(z,0,T)}else b.zeroOrAutoZIndexOrTransformedOrOpacity.push(T)}else n.styles.isFloating()?b.nonPositionedFloats.push(T):b.nonPositionedInlineLevel.push(T);ME(s,T,o?T:t,g)}else n.styles.isInlineLevel()?e.inlineLevel.push(s):e.nonInlineLevel.push(s),ME(s,e,t,g);Ba(n.flags,8)&&dk(n,g)})},dk=function(i,e){for(var t=i instanceof vE?i.start:1,r=i instanceof vE?i.reversed:!1,n=0;n<e.length;n++){var o=e[n];o.container instanceof UR&&typeof o.container.value=="number"&&o.container.value!==0&&(t=o.container.value),o.listValue=a0(t,o.container.styles.listStyleType,!0),t+=r?-1:1}},Rce=function(i){var e=new Ak(i,null),t=new hk(e),r=[];return ME(e,t,t,r),dk(e.container,r),t},fk=function(i,e){switch(e){case 0:return Pu(i.topLeftBorderBox,i.topLeftPaddingBox,i.topRightBorderBox,i.topRightPaddingBox);case 1:return Pu(i.topRightBorderBox,i.topRightPaddingBox,i.bottomRightBorderBox,i.bottomRightPaddingBox);case 2:return Pu(i.bottomRightBorderBox,i.bottomRightPaddingBox,i.bottomLeftBorderBox,i.bottomLeftPaddingBox);case 3:default:return Pu(i.bottomLeftBorderBox,i.bottomLeftPaddingBox,i.topLeftBorderBox,i.topLeftPaddingBox)}},kce=function(i,e){switch(e){case 0:return Pu(i.topLeftBorderBox,i.topLeftBorderDoubleOuterBox,i.topRightBorderBox,i.topRightBorderDoubleOuterBox);case 1:return Pu(i.topRightBorderBox,i.topRightBorderDoubleOuterBox,i.bottomRightBorderBox,i.bottomRightBorderDoubleOuterBox);case 2:return Pu(i.bottomRightBorderBox,i.bottomRightBorderDoubleOuterBox,i.bottomLeftBorderBox,i.bottomLeftBorderDoubleOuterBox);case 3:default:return Pu(i.bottomLeftBorderBox,i.bottomLeftBorderDoubleOuterBox,i.topLeftBorderBox,i.topLeftBorderDoubleOuterBox)}},Oce=function(i,e){switch(e){case 0:return Pu(i.topLeftBorderDoubleInnerBox,i.topLeftPaddingBox,i.topRightBorderDoubleInnerBox,i.topRightPaddingBox);case 1:return Pu(i.topRightBorderDoubleInnerBox,i.topRightPaddingBox,i.bottomRightBorderDoubleInnerBox,i.bottomRightPaddingBox);case 2:return Pu(i.bottomRightBorderDoubleInnerBox,i.bottomRightPaddingBox,i.bottomLeftBorderDoubleInnerBox,i.bottomLeftPaddingBox);case 3:default:return Pu(i.bottomLeftBorderDoubleInnerBox,i.bottomLeftPaddingBox,i.topLeftBorderDoubleInnerBox,i.topLeftPaddingBox)}},Uce=function(i,e){switch(e){case 0:return eb(i.topLeftBorderStroke,i.topRightBorderStroke);case 1:return eb(i.topRightBorderStroke,i.bottomRightBorderStroke);case 2:return eb(i.bottomRightBorderStroke,i.bottomLeftBorderStroke);case 3:default:return eb(i.bottomLeftBorderStroke,i.topLeftBorderStroke)}},eb=function(i,e){var t=[];return Mu(i)?t.push(i.subdivide(.5,!1)):t.push(i),Mu(e)?t.push(e.subdivide(.5,!0)):t.push(e),t},Pu=function(i,e,t,r){var n=[];return Mu(i)?n.push(i.subdivide(.5,!1)):n.push(i),Mu(t)?n.push(t.subdivide(.5,!0)):n.push(t),Mu(r)?n.push(r.subdivide(.5,!0).reverse()):n.push(r),Mu(e)?n.push(e.subdivide(.5,!1).reverse()):n.push(e),n},pk=function(i){var e=i.bounds,t=i.styles;return e.add(t.borderLeftWidth,t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth),-(t.borderTopWidth+t.borderBottomWidth))},tb=function(i){var e=i.styles,t=i.bounds,r=Vs(e.paddingLeft,t.width),n=Vs(e.paddingRight,t.width),o=Vs(e.paddingTop,t.width),l=Vs(e.paddingBottom,t.width);return t.add(r+e.borderLeftWidth,o+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+r+n),-(e.borderTopWidth+e.borderBottomWidth+o+l))},Nce=function(i,e){return i===0?e.bounds:i===2?tb(e):pk(e)},zce=function(i,e){return i===0?e.bounds:i===2?tb(e):pk(e)},PE=function(i,e,t){var r=Nce(jg(i.styles.backgroundOrigin,e),i),n=zce(jg(i.styles.backgroundClip,e),i),o=Qce(jg(i.styles.backgroundSize,e),t,r),l=o[0],s=o[1],g=t0(jg(i.styles.backgroundPosition,e),r.width-l,r.height-s),b=Vce(jg(i.styles.backgroundRepeat,e),g,o,r,n),T=Math.round(r.left+g[0]),F=Math.round(r.top+g[1]);return[b,T,F,l,s]},Gg=function(i){return ws(i)&&i.value===Ng.AUTO},ib=function(i){return typeof i=="number"},Qce=function(i,e,t){var r=e[0],n=e[1],o=e[2],l=i[0],s=i[1];if(!l)return[0,0];if(oa(l)&&s&&oa(s))return[Vs(l,t.width),Vs(s,t.height)];var g=ib(o);if(ws(l)&&(l.value===Ng.CONTAIN||l.value===Ng.COVER)){if(ib(o)){var b=t.width/t.height;return b<o!=(l.value===Ng.COVER)?[t.width,t.width/o]:[t.height*o,t.height]}return[t.width,t.height]}var T=ib(r),F=ib(n),k=T||F;if(Gg(l)&&(!s||Gg(s))){if(T&&F)return[r,n];if(!g&&!k)return[t.width,t.height];if(k&&g){var z=T?r:n*o,J=F?n:r/o;return[z,J]}var te=T?r:t.width,ue=F?n:t.height;return[te,ue]}if(g){var ce=0,de=0;return oa(l)?ce=Vs(l,t.width):oa(s)&&(de=Vs(s,t.height)),Gg(l)?ce=de*o:(!s||Gg(s))&&(de=ce/o),[ce,de]}var _e=null,Ee=null;if(oa(l)?_e=Vs(l,t.width):s&&oa(s)&&(Ee=Vs(s,t.height)),_e!==null&&(!s||Gg(s))&&(Ee=T&&F?_e/r*n:t.height),Ee!==null&&Gg(l)&&(_e=T&&F?Ee/n*r:t.width),_e!==null&&Ee!==null)return[_e,Ee];throw new Error("Unable to calculate background-size for element")},jg=function(i,e){var t=i[e];return typeof t>"u"?i[0]:t},Vce=function(i,e,t,r,n){var o=e[0],l=e[1],s=t[0],g=t[1];switch(i){case 2:return[new er(Math.round(r.left),Math.round(r.top+l)),new er(Math.round(r.left+r.width),Math.round(r.top+l)),new er(Math.round(r.left+r.width),Math.round(g+r.top+l)),new er(Math.round(r.left),Math.round(g+r.top+l))];case 3:return[new er(Math.round(r.left+o),Math.round(r.top)),new er(Math.round(r.left+o+s),Math.round(r.top)),new er(Math.round(r.left+o+s),Math.round(r.height+r.top)),new er(Math.round(r.left+o),Math.round(r.height+r.top))];case 1:return[new er(Math.round(r.left+o),Math.round(r.top+l)),new er(Math.round(r.left+o+s),Math.round(r.top+l)),new er(Math.round(r.left+o+s),Math.round(r.top+l+g)),new er(Math.round(r.left+o),Math.round(r.top+l+g))];default:return[new er(Math.round(n.left),Math.round(n.top)),new er(Math.round(n.left+n.width),Math.round(n.top)),new er(Math.round(n.left+n.width),Math.round(n.height+n.top)),new er(Math.round(n.left),Math.round(n.height+n.top))]}},Hce="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",gk="Hidden Text",Gce=function(){function i(e){this._data={},this._document=e}return i.prototype.parseMetrics=function(e,t){var r=this._document.createElement("div"),n=this._document.createElement("img"),o=this._document.createElement("span"),l=this._document.body;r.style.visibility="hidden",r.style.fontFamily=e,r.style.fontSize=t,r.style.margin="0",r.style.padding="0",r.style.whiteSpace="nowrap",l.appendChild(r),n.src=Hce,n.width=1,n.height=1,n.style.margin="0",n.style.padding="0",n.style.verticalAlign="baseline",o.style.fontFamily=e,o.style.fontSize=t,o.style.margin="0",o.style.padding="0",o.appendChild(this._document.createTextNode(gk)),r.appendChild(o),r.appendChild(n);var s=n.offsetTop-o.offsetTop+2;r.removeChild(o),r.appendChild(this._document.createTextNode(gk)),r.style.lineHeight="normal",n.style.verticalAlign="super";var g=n.offsetTop-r.offsetTop+2;return l.removeChild(r),{baseline:s,middle:g}},i.prototype.getMetrics=function(e,t){var r=e+" "+t;return typeof this._data[r]>"u"&&(this._data[r]=this.parseMetrics(e,t)),this._data[r]},i}(),mk=function(){function i(e,t){this.context=e,this.options=t}return i}(),jce=1e4,qce=function(i){hh(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n._activeEffects=[],n.canvas=r.canvas?r.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),r.canvas||(n.canvas.width=Math.floor(r.width*r.scale),n.canvas.height=Math.floor(r.height*r.scale),n.canvas.style.width=r.width+"px",n.canvas.style.height=r.height+"px"),n.fontMetrics=new Gce(document),n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-r.x,-r.y),n.ctx.textBaseline="bottom",n._activeEffects=[],n.context.logger.debug("Canvas renderer initialized ("+r.width+"x"+r.height+") with scale "+r.scale),n}return e.prototype.applyEffects=function(t){for(var r=this;this._activeEffects.length;)this.popEffect();t.forEach(function(n){return r.applyEffect(n)})},e.prototype.applyEffect=function(t){this.ctx.save(),Fce(t)&&(this.ctx.globalAlpha=t.opacity),Pce(t)&&(this.ctx.translate(t.offsetX,t.offsetY),this.ctx.transform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this.ctx.translate(-t.offsetX,-t.offsetY)),ck(t)&&(this.path(t.path),this.ctx.clip()),this._activeEffects.push(t)},e.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},e.prototype.renderStack=function(t){return ac(this,void 0,void 0,function(){var r;return Rl(this,function(n){switch(n.label){case 0:return r=t.element.container.styles,r.isVisible()?[4,this.renderStackContent(t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},e.prototype.renderNode=function(t){return ac(this,void 0,void 0,function(){return Rl(this,function(r){switch(r.label){case 0:if(Ba(t.container.flags,16))debugger;return t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return r.sent(),[4,this.renderNodeContent(t)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.renderTextWithLetterSpacing=function(t,r,n){var o=this;if(r===0)this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+n);else{var l=_E(t.text);l.reduce(function(s,g){return o.ctx.fillText(g,s,t.bounds.top+n),s+o.ctx.measureText(g).width},t.bounds.left)}},e.prototype.createFontStyle=function(t){var r=t.fontVariant.filter(function(l){return l==="normal"||l==="small-caps"}).join(""),n=Zce(t.fontFamily).join(", "),o=e0(t.fontSize)?""+t.fontSize.number+t.fontSize.unit:t.fontSize.number+"px";return[[t.fontStyle,r,t.fontWeight,o,n].join(" "),n,o]},e.prototype.renderTextNode=function(t,r){return ac(this,void 0,void 0,function(){var n,o,l,s,g,b,T,F,k=this;return Rl(this,function(z){return n=this.createFontStyle(r),o=n[0],l=n[1],s=n[2],this.ctx.font=o,this.ctx.direction=r.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",g=this.fontMetrics.getMetrics(l,s),b=g.baseline,T=g.middle,F=r.paintOrder,t.textBounds.forEach(function(J){F.forEach(function(te){switch(te){case 0:k.ctx.fillStyle=ja(r.color),k.renderTextWithLetterSpacing(J,r.letterSpacing,b);var ue=r.textShadow;ue.length&&J.text.trim().length&&(ue.slice(0).reverse().forEach(function(ce){k.ctx.shadowColor=ja(ce.color),k.ctx.shadowOffsetX=ce.offsetX.number*k.options.scale,k.ctx.shadowOffsetY=ce.offsetY.number*k.options.scale,k.ctx.shadowBlur=ce.blur.number,k.renderTextWithLetterSpacing(J,r.letterSpacing,b)}),k.ctx.shadowColor="",k.ctx.shadowOffsetX=0,k.ctx.shadowOffsetY=0,k.ctx.shadowBlur=0),r.textDecorationLine.length&&(k.ctx.fillStyle=ja(r.textDecorationColor||r.color),r.textDecorationLine.forEach(function(ce){switch(ce){case 1:k.ctx.fillRect(J.bounds.left,Math.round(J.bounds.top+b),J.bounds.width,1);break;case 2:k.ctx.fillRect(J.bounds.left,Math.round(J.bounds.top),J.bounds.width,1);break;case 3:k.ctx.fillRect(J.bounds.left,Math.ceil(J.bounds.top+T),J.bounds.width,1);break}}));break;case 1:r.webkitTextStrokeWidth&&J.text.trim().length&&(k.ctx.strokeStyle=ja(r.webkitTextStrokeColor),k.ctx.lineWidth=r.webkitTextStrokeWidth,k.ctx.lineJoin=window.chrome?"miter":"round",k.ctx.strokeText(J.text,J.bounds.left,J.bounds.top+b)),k.ctx.strokeStyle="",k.ctx.lineWidth=0,k.ctx.lineJoin="miter";break}})}),[2]})})},e.prototype.renderReplacedElement=function(t,r,n){if(n&&t.intrinsicWidth>0&&t.intrinsicHeight>0){var o=tb(t),l=Jv(r);this.path(l),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,t.intrinsicWidth,t.intrinsicHeight,o.left,o.top,o.width,o.height),this.ctx.restore()}},e.prototype.renderNodeContent=function(t){return ac(this,void 0,void 0,function(){var r,n,o,l,s,g,de,de,b,T,F,k,Ee,z,J,He,te,ue,ce,de,_e,Ee,He;return Rl(this,function(Ve){switch(Ve.label){case 0:this.applyEffects(t.getEffects(4)),r=t.container,n=t.curves,o=r.styles,l=0,s=r.textNodes,Ve.label=1;case 1:return l<s.length?(g=s[l],[4,this.renderTextNode(g,o)]):[3,4];case 2:Ve.sent(),Ve.label=3;case 3:return l++,[3,1];case 4:if(!(r instanceof RR))return[3,8];Ve.label=5;case 5:return Ve.trys.push([5,7,,8]),[4,this.context.cache.match(r.src)];case 6:return de=Ve.sent(),this.renderReplacedElement(r,n,de),[3,8];case 7:return Ve.sent(),this.context.logger.error("Error loading image "+r.src),[3,8];case 8:if(r instanceof kR&&this.renderReplacedElement(r,n,r.canvas),!(r instanceof OR))return[3,12];Ve.label=9;case 9:return Ve.trys.push([9,11,,12]),[4,this.context.cache.match(r.svg)];case 10:return de=Ve.sent(),this.renderReplacedElement(r,n,de),[3,12];case 11:return Ve.sent(),this.context.logger.error("Error loading svg "+r.svg.substring(0,255)),[3,12];case 12:return r instanceof VR&&r.tree?(b=new e(this.context,{scale:this.options.scale,backgroundColor:r.backgroundColor,x:0,y:0,width:r.width,height:r.height}),[4,b.render(r.tree)]):[3,14];case 13:T=Ve.sent(),r.width&&r.height&&this.ctx.drawImage(T,0,0,r.width,r.height,r.bounds.left,r.bounds.top,r.bounds.width,r.bounds.height),Ve.label=14;case 14:if(r instanceof bE&&(F=Math.min(r.bounds.width,r.bounds.height),r.type===Gv?r.checked&&(this.ctx.save(),this.path([new er(r.bounds.left+F*.39363,r.bounds.top+F*.79),new er(r.bounds.left+F*.16,r.bounds.top+F*.5549),new er(r.bounds.left+F*.27347,r.bounds.top+F*.44071),new er(r.bounds.left+F*.39694,r.bounds.top+F*.5649),new er(r.bounds.left+F*.72983,r.bounds.top+F*.23),new er(r.bounds.left+F*.84,r.bounds.top+F*.34085),new er(r.bounds.left+F*.39363,r.bounds.top+F*.79)]),this.ctx.fillStyle=ja(NR),this.ctx.fill(),this.ctx.restore()):r.type===jv&&r.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(r.bounds.left+F/2,r.bounds.top+F/2,F/4,0,Math.PI*2,!0),this.ctx.fillStyle=ja(NR),this.ctx.fill(),this.ctx.restore())),$ce(r)&&r.value.length){switch(k=this.createFontStyle(o),Ee=k[0],z=k[1],J=this.fontMetrics.getMetrics(Ee,z).baseline,this.ctx.font=Ee,this.ctx.fillStyle=ja(o.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=Wce(r.styles.textAlign),He=tb(r),te=0,r.styles.textAlign){case 1:te+=He.width/2;break;case 2:te+=He.width;break}ue=He.add(te,0,0,-He.height/2+1),this.ctx.save(),this.path([new er(He.left,He.top),new er(He.left+He.width,He.top),new er(He.left+He.width,He.top+He.height),new er(He.left,He.top+He.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new s0(r.value,ue),o.letterSpacing,J),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Ba(r.styles.display,2048))return[3,20];if(r.styles.listStyleImage===null)return[3,19];if(ce=r.styles.listStyleImage,ce.type!==0)return[3,18];de=void 0,_e=ce.url,Ve.label=15;case 15:return Ve.trys.push([15,17,,18]),[4,this.context.cache.match(_e)];case 16:return de=Ve.sent(),this.ctx.drawImage(de,r.bounds.left-(de.width+10),r.bounds.top),[3,18];case 17:return Ve.sent(),this.context.logger.error("Error loading list-style-image "+_e),[3,18];case 18:return[3,20];case 19:t.listValue&&r.styles.listStyleType!==-1&&(Ee=this.createFontStyle(o)[0],this.ctx.font=Ee,this.ctx.fillStyle=ja(o.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",He=new PA(r.bounds.left,r.bounds.top+Vs(r.styles.paddingTop,r.bounds.width),r.bounds.width,pR(o.lineHeight,o.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new s0(t.listValue,He),o.letterSpacing,pR(o.lineHeight,o.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),Ve.label=20;case 20:return[2]}})})},e.prototype.renderStackContent=function(t){return ac(this,void 0,void 0,function(){var r,n,ce,o,l,ce,s,g,ce,b,T,ce,F,k,ce,z,J,ce,te,ue,ce;return Rl(this,function(de){switch(de.label){case 0:if(Ba(t.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(t.element)];case 1:de.sent(),r=0,n=t.negativeZIndex,de.label=2;case 2:return r<n.length?(ce=n[r],[4,this.renderStack(ce)]):[3,5];case 3:de.sent(),de.label=4;case 4:return r++,[3,2];case 5:return[4,this.renderNodeContent(t.element)];case 6:de.sent(),o=0,l=t.nonInlineLevel,de.label=7;case 7:return o<l.length?(ce=l[o],[4,this.renderNode(ce)]):[3,10];case 8:de.sent(),de.label=9;case 9:return o++,[3,7];case 10:s=0,g=t.nonPositionedFloats,de.label=11;case 11:return s<g.length?(ce=g[s],[4,this.renderStack(ce)]):[3,14];case 12:de.sent(),de.label=13;case 13:return s++,[3,11];case 14:b=0,T=t.nonPositionedInlineLevel,de.label=15;case 15:return b<T.length?(ce=T[b],[4,this.renderStack(ce)]):[3,18];case 16:de.sent(),de.label=17;case 17:return b++,[3,15];case 18:F=0,k=t.inlineLevel,de.label=19;case 19:return F<k.length?(ce=k[F],[4,this.renderNode(ce)]):[3,22];case 20:de.sent(),de.label=21;case 21:return F++,[3,19];case 22:z=0,J=t.zeroOrAutoZIndexOrTransformedOrOpacity,de.label=23;case 23:return z<J.length?(ce=J[z],[4,this.renderStack(ce)]):[3,26];case 24:de.sent(),de.label=25;case 25:return z++,[3,23];case 26:te=0,ue=t.positiveZIndex,de.label=27;case 27:return te<ue.length?(ce=ue[te],[4,this.renderStack(ce)]):[3,30];case 28:de.sent(),de.label=29;case 29:return te++,[3,27];case 30:return[2]}})})},e.prototype.mask=function(t){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(t.slice(0).reverse()),this.ctx.closePath()},e.prototype.path=function(t){this.ctx.beginPath(),this.formatPath(t),this.ctx.closePath()},e.prototype.formatPath=function(t){var r=this;t.forEach(function(n,o){var l=Mu(n)?n.start:n;o===0?r.ctx.moveTo(l.x,l.y):r.ctx.lineTo(l.x,l.y),Mu(n)&&r.ctx.bezierCurveTo(n.startControl.x,n.startControl.y,n.endControl.x,n.endControl.y,n.end.x,n.end.y)})},e.prototype.renderRepeat=function(t,r,n,o){this.path(t),this.ctx.fillStyle=r,this.ctx.translate(n,o),this.ctx.fill(),this.ctx.translate(-n,-o)},e.prototype.resizeImage=function(t,r,n){var o;if(t.width===r&&t.height===n)return t;var l=(o=this.canvas.ownerDocument)!==null&&o!==void 0?o:document,s=l.createElement("canvas");s.width=Math.max(1,r),s.height=Math.max(1,n);var g=s.getContext("2d");return g.drawImage(t,0,0,t.width,t.height,0,0,r,n),s},e.prototype.renderBackgroundImage=function(t){return ac(this,void 0,void 0,function(){var r,n,o,l,s,g;return Rl(this,function(b){switch(b.label){case 0:r=t.styles.backgroundImage.length-1,n=function(T){var F,k,z,it,Ct,Lt,Ze,We,Ue,J,it,Ct,Lt,Ze,We,te,ue,ce,de,_e,Ee,He,Ve,qe,Ue,ot,it,De,Me,Ze,We,Bt,Ct,Lt,_t,Ft,Mt,Wt,Se,Xe,et,At;return Rl(this,function(ft){switch(ft.label){case 0:if(T.type!==0)return[3,5];F=void 0,k=T.url,ft.label=1;case 1:return ft.trys.push([1,3,,4]),[4,o.context.cache.match(k)];case 2:return F=ft.sent(),[3,4];case 3:return ft.sent(),o.context.logger.error("Error loading background-image "+k),[3,4];case 4:return F&&(z=PE(t,r,[F.width,F.height,F.width/F.height]),it=z[0],Ct=z[1],Lt=z[2],Ze=z[3],We=z[4],Ue=o.ctx.createPattern(o.resizeImage(F,Ze,We),"repeat"),o.renderRepeat(it,Ue,Ct,Lt)),[3,6];case 5:Poe(T)?(J=PE(t,r,[null,null,null]),it=J[0],Ct=J[1],Lt=J[2],Ze=J[3],We=J[4],te=Soe(T.angle,Ze,We),ue=te[0],ce=te[1],de=te[2],_e=te[3],Ee=te[4],He=document.createElement("canvas"),He.width=Ze,He.height=We,Ve=He.getContext("2d"),qe=Ve.createLinearGradient(ce,_e,de,Ee),nR(T.stops,ue).forEach(function(wt){return qe.addColorStop(wt.stop,ja(wt.color))}),Ve.fillStyle=qe,Ve.fillRect(0,0,Ze,We),Ze>0&&We>0&&(Ue=o.ctx.createPattern(He,"repeat"),o.renderRepeat(it,Ue,Ct,Lt))):Foe(T)&&(ot=PE(t,r,[null,null,null]),it=ot[0],De=ot[1],Me=ot[2],Ze=ot[3],We=ot[4],Bt=T.position.length===0?[sE]:T.position,Ct=Vs(Bt[0],Ze),Lt=Vs(Bt[Bt.length-1],We),_t=Toe(T,Ct,Lt,Ze,We),Ft=_t[0],Mt=_t[1],Ft>0&&Mt>0&&(Wt=o.ctx.createRadialGradient(De+Ct,Me+Lt,0,De+Ct,Me+Lt,Ft),nR(T.stops,Ft*2).forEach(function(wt){return Wt.addColorStop(wt.stop,ja(wt.color))}),o.path(it),o.ctx.fillStyle=Wt,Ft!==Mt?(Se=t.bounds.left+.5*t.bounds.width,Xe=t.bounds.top+.5*t.bounds.height,et=Mt/Ft,At=1/et,o.ctx.save(),o.ctx.translate(Se,Xe),o.ctx.transform(1,0,0,et,0,0),o.ctx.translate(-Se,-Xe),o.ctx.fillRect(De,At*(Me-Xe)+Xe,Ze,We*At),o.ctx.restore()):o.ctx.fill())),ft.label=6;case 6:return r--,[2]}})},o=this,l=0,s=t.styles.backgroundImage.slice(0).reverse(),b.label=1;case 1:return l<s.length?(g=s[l],[5,n(g)]):[3,4];case 2:b.sent(),b.label=3;case 3:return l++,[3,1];case 4:return[2]}})})},e.prototype.renderSolidBorder=function(t,r,n){return ac(this,void 0,void 0,function(){return Rl(this,function(o){return this.path(fk(n,r)),this.ctx.fillStyle=ja(t),this.ctx.fill(),[2]})})},e.prototype.renderDoubleBorder=function(t,r,n,o){return ac(this,void 0,void 0,function(){var l,s;return Rl(this,function(g){switch(g.label){case 0:return r<3?[4,this.renderSolidBorder(t,n,o)]:[3,2];case 1:return g.sent(),[2];case 2:return l=kce(o,n),this.path(l),this.ctx.fillStyle=ja(t),this.ctx.fill(),s=Oce(o,n),this.path(s),this.ctx.fill(),[2]}})})},e.prototype.renderNodeBackgroundAndBorders=function(t){return ac(this,void 0,void 0,function(){var r,n,o,l,s,g,b,T,F=this;return Rl(this,function(k){switch(k.label){case 0:return this.applyEffects(t.getEffects(2)),r=t.container.styles,n=!Ed(r.backgroundColor)||r.backgroundImage.length,o=[{style:r.borderTopStyle,color:r.borderTopColor,width:r.borderTopWidth},{style:r.borderRightStyle,color:r.borderRightColor,width:r.borderRightWidth},{style:r.borderBottomStyle,color:r.borderBottomColor,width:r.borderBottomWidth},{style:r.borderLeftStyle,color:r.borderLeftColor,width:r.borderLeftWidth}],l=Kce(jg(r.backgroundClip,0),t.curves),n||r.boxShadow.length?(this.ctx.save(),this.path(l),this.ctx.clip(),Ed(r.backgroundColor)||(this.ctx.fillStyle=ja(r.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(t.container)]):[3,2];case 1:k.sent(),this.ctx.restore(),r.boxShadow.slice(0).reverse().forEach(function(z){F.ctx.save();var J=Zv(t.curves),te=z.inset?0:jce,ue=Dce(J,-te+(z.inset?1:-1)*z.spread.number,(z.inset?1:-1)*z.spread.number,z.spread.number*(z.inset?-2:2),z.spread.number*(z.inset?-2:2));z.inset?(F.path(J),F.ctx.clip(),F.mask(ue)):(F.mask(J),F.ctx.clip(),F.path(ue)),F.ctx.shadowOffsetX=z.offsetX.number+te,F.ctx.shadowOffsetY=z.offsetY.number,F.ctx.shadowColor=ja(z.color),F.ctx.shadowBlur=z.blur.number,F.ctx.fillStyle=z.inset?ja(z.color):"rgba(0,0,0,1)",F.ctx.fill(),F.ctx.restore()}),k.label=2;case 2:s=0,g=0,b=o,k.label=3;case 3:return g<b.length?(T=b[g],T.style!==0&&!Ed(T.color)&&T.width>0?T.style!==2?[3,5]:[4,this.renderDashedDottedBorder(T.color,T.width,s,t.curves,2)]:[3,11]):[3,13];case 4:return k.sent(),[3,11];case 5:return T.style!==3?[3,7]:[4,this.renderDashedDottedBorder(T.color,T.width,s,t.curves,3)];case 6:return k.sent(),[3,11];case 7:return T.style!==4?[3,9]:[4,this.renderDoubleBorder(T.color,T.width,s,t.curves)];case 8:return k.sent(),[3,11];case 9:return[4,this.renderSolidBorder(T.color,s,t.curves)];case 10:k.sent(),k.label=11;case 11:s++,k.label=12;case 12:return g++,[3,3];case 13:return[2]}})})},e.prototype.renderDashedDottedBorder=function(t,r,n,o,l){return ac(this,void 0,void 0,function(){var s,g,b,T,F,k,z,J,te,ue,ce,de,_e,Ee,He,Ve,He,Ve;return Rl(this,function(qe){return this.ctx.save(),s=Uce(o,n),g=fk(o,n),l===2&&(this.path(g),this.ctx.clip()),Mu(g[0])?(b=g[0].start.x,T=g[0].start.y):(b=g[0].x,T=g[0].y),Mu(g[1])?(F=g[1].end.x,k=g[1].end.y):(F=g[1].x,k=g[1].y),n===0||n===2?z=Math.abs(b-F):z=Math.abs(T-k),this.ctx.beginPath(),l===3?this.formatPath(s):this.formatPath(g.slice(0,2)),J=r<3?r*3:r*2,te=r<3?r*2:r,l===3&&(J=r,te=r),ue=!0,z<=J*2?ue=!1:z<=J*2+te?(ce=z/(2*J+te),J*=ce,te*=ce):(de=Math.floor((z+te)/(J+te)),_e=(z-de*J)/(de-1),Ee=(z-(de+1)*J)/de,te=Ee<=0||Math.abs(te-_e)<Math.abs(te-Ee)?_e:Ee),ue&&(l===3?this.ctx.setLineDash([0,J+te]):this.ctx.setLineDash([J,te])),l===3?(this.ctx.lineCap="round",this.ctx.lineWidth=r):this.ctx.lineWidth=r*2+1.1,this.ctx.strokeStyle=ja(t),this.ctx.stroke(),this.ctx.setLineDash([]),l===2&&(Mu(g[0])&&(He=g[3],Ve=g[0],this.ctx.beginPath(),this.formatPath([new er(He.end.x,He.end.y),new er(Ve.start.x,Ve.start.y)]),this.ctx.stroke()),Mu(g[1])&&(He=g[1],Ve=g[2],this.ctx.beginPath(),this.formatPath([new er(He.end.x,He.end.y),new er(Ve.start.x,Ve.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},e.prototype.render=function(t){return ac(this,void 0,void 0,function(){var r;return Rl(this,function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=ja(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),r=Rce(t),[4,this.renderStack(r)];case 1:return n.sent(),this.applyEffects([]),[2,this.canvas]}})})},e}(mk),$ce=function(i){return i instanceof QR||i instanceof zR?!0:i instanceof bE&&i.type!==jv&&i.type!==Gv},Kce=function(i,e){switch(i){case 0:return Zv(e);case 2:return Ice(e);case 1:default:return Jv(e)}},Wce=function(i){switch(i){case 1:return"center";case 2:return"right";case 0:default:return"left"}},Xce=["-apple-system","system-ui"],Zce=function(i){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?i.filter(function(e){return Xce.indexOf(e)===-1}):i},Jce=function(i){hh(e,i);function e(t,r){var n=i.call(this,t,r)||this;return n.canvas=r.canvas?r.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),n.options=r,n.canvas.width=Math.floor(r.width*r.scale),n.canvas.height=Math.floor(r.height*r.scale),n.canvas.style.width=r.width+"px",n.canvas.style.height=r.height+"px",n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-r.x,-r.y),n.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+r.width+"x"+r.height+" at "+r.x+","+r.y+") with scale "+r.scale),n}return e.prototype.render=function(t){return ac(this,void 0,void 0,function(){var r,n;return Rl(this,function(o){switch(o.label){case 0:return r=yE(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,Yce(r)];case 1:return n=o.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=ja(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e}(mk),Yce=function(i){return new Promise(function(e,t){var r=new Image;r.onload=function(){e(r)},r.onerror=t,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(i))})},eue=function(){function i(e){var t=e.id,r=e.enabled;this.id=t,this.enabled=r,this.start=Date.now()}return i.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,uv([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},i.prototype.getTime=function(){return Date.now()-this.start},i.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,uv([this.id,this.getTime()+"ms"],e))},i.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,uv([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},i.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,uv([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},i.instances={},i}(),tue=function(){function i(e,t){var r;this.windowBounds=t,this.instanceName="#"+i.instanceCount++,this.logger=new eue({id:this.instanceName,enabled:e.logging}),this.cache=(r=e.cache)!==null&&r!==void 0?r:new bce(this,e)}return i.instanceCount=1,i}(),iue=function(i,e){return e===void 0&&(e={}),rue(i,e)};typeof window<"u"&&lk.setContext(window);var rue=function(i,e){return ac(void 0,void 0,void 0,function(){var t,r,n,o,l,s,g,b,T,F,k,z,J,te,ue,ce,de,_e,Ee,He,qe,Ve,qe,Ue,ot,it,De,Me,Ze,We,Bt,Ct,Lt,_t,Ft,Mt,Wt,Se,Xe,et;return Rl(this,function(At){switch(At.label){case 0:if(!i||typeof i!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(t=i.ownerDocument,!t)throw new Error("Element is not attached to a Document");if(r=t.defaultView,!r)throw new Error("Document is not attached to a Window");return n={allowTaint:(Ue=e.allowTaint)!==null&&Ue!==void 0?Ue:!1,imageTimeout:(ot=e.imageTimeout)!==null&&ot!==void 0?ot:15e3,proxy:e.proxy,useCORS:(it=e.useCORS)!==null&&it!==void 0?it:!1},o=UC({logging:(De=e.logging)!==null&&De!==void 0?De:!0,cache:e.cache},n),l={windowWidth:(Me=e.windowWidth)!==null&&Me!==void 0?Me:r.innerWidth,windowHeight:(Ze=e.windowHeight)!==null&&Ze!==void 0?Ze:r.innerHeight,scrollX:(We=e.scrollX)!==null&&We!==void 0?We:r.pageXOffset,scrollY:(Bt=e.scrollY)!==null&&Bt!==void 0?Bt:r.pageYOffset},s=new PA(l.scrollX,l.scrollY,l.windowWidth,l.windowHeight),g=new tue(o,s),b=(Ct=e.foreignObjectRendering)!==null&&Ct!==void 0?Ct:!1,T={allowTaint:(Lt=e.allowTaint)!==null&&Lt!==void 0?Lt:!1,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:b,copyStyles:b},g.logger.debug("Starting document clone with size "+s.width+"x"+s.height+" scrolled to "+-s.left+","+-s.top),F=new ok(g,i,T),k=F.clonedReferenceElement,k?[4,F.toIFrame(t,s)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return z=At.sent(),J=wE(k)||nce(k)?Dne(k.ownerDocument):hv(g,k),te=J.width,ue=J.height,ce=J.left,de=J.top,_e=nue(g,k,e.backgroundColor),Ee={canvas:e.canvas,backgroundColor:_e,scale:(Ft=(_t=e.scale)!==null&&_t!==void 0?_t:r.devicePixelRatio)!==null&&Ft!==void 0?Ft:1,x:((Mt=e.x)!==null&&Mt!==void 0?Mt:0)+ce,y:((Wt=e.y)!==null&&Wt!==void 0?Wt:0)+de,width:(Se=e.width)!==null&&Se!==void 0?Se:Math.ceil(te),height:(Xe=e.height)!==null&&Xe!==void 0?Xe:Math.ceil(ue)},b?(g.logger.debug("Document cloned, using foreign object rendering"),qe=new Jce(g,Ee),[4,qe.render(k)]):[3,3];case 2:return He=At.sent(),[3,5];case 3:return g.logger.debug("Document cloned, element located at "+ce+","+de+" with size "+te+"x"+ue+" using computed rendering"),g.logger.debug("Starting DOM parsing"),Ve=GR(g,k),_e===Ve.styles.backgroundColor&&(Ve.styles.backgroundColor=DA.TRANSPARENT),g.logger.debug("Starting renderer for element at "+Ee.x+","+Ee.y+" with size "+Ee.width+"x"+Ee.height),qe=new qce(g,Ee),[4,qe.render(Ve)];case 4:He=At.sent(),At.label=5;case 5:return(!((et=e.removeContainer)!==null&&et!==void 0)||et)&&(ok.destroy(z)||g.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),g.logger.debug("Finished rendering"),[2,He]}})})},nue=function(i,e,t){var r=e.ownerDocument,n=r.documentElement?i0(i,getComputedStyle(r.documentElement).backgroundColor):DA.TRANSPARENT,o=r.body?i0(i,getComputedStyle(r.body).backgroundColor):DA.TRANSPARENT,l=typeof t=="string"?i0(i,t):t===null?DA.TRANSPARENT:4294967295;return e===r.documentElement?Ed(n)?Ed(o)?l:o:n:l};const sue=Object.freeze(Object.defineProperty({__proto__:null,default:iue},Symbol.toStringTag,{value:"Module"}));/*! @license DOMPurify 2.4.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.4.5/LICENSE */function Ld(i){"@babel/helpers - typeof";return Ld=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ld(i)}function FE(i,e){return FE=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t},FE(i,e)}function oue(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function rb(i,e,t){return oue()?rb=Reflect.construct:rb=function(r,n,o){var l=[null];l.push.apply(l,n);var s=Function.bind.apply(r,l),g=new s;return o&&FE(g,o.prototype),g},rb.apply(null,arguments)}function dh(i){return aue(i)||lue(i)||cue(i)||uue()}function aue(i){if(Array.isArray(i))return DE(i)}function lue(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function cue(i,e){if(i){if(typeof i=="string")return DE(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return DE(i,e)}}function DE(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=i[t];return r}function uue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var hue=Object.hasOwnProperty,yk=Object.setPrototypeOf,Aue=Object.isFrozen,due=Object.getPrototypeOf,fue=Object.getOwnPropertyDescriptor,uc=Object.freeze,fh=Object.seal,pue=Object.create,_k=typeof Reflect<"u"&&Reflect,nb=_k.apply,RE=_k.construct;nb||(nb=function(i,e,t){return i.apply(e,t)}),uc||(uc=function(i){return i}),fh||(fh=function(i){return i}),RE||(RE=function(i,e){return rb(i,dh(e))});var gue=Fu(Array.prototype.forEach),vk=Fu(Array.prototype.pop),c0=Fu(Array.prototype.push),sb=Fu(String.prototype.toLowerCase),kE=Fu(String.prototype.toString),mue=Fu(String.prototype.match),ph=Fu(String.prototype.replace),yue=Fu(String.prototype.indexOf),_ue=Fu(String.prototype.trim),hc=Fu(RegExp.prototype.test),OE=vue(TypeError);function Fu(i){return function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return nb(i,e,r)}}function vue(i){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return RE(i,t)}}function nn(i,e,t){t=t||sb,yk&&yk(i,null);for(var r=e.length;r--;){var n=e[r];if(typeof n=="string"){var o=t(n);o!==n&&(Aue(e)||(e[r]=o),n=o)}i[n]=!0}return i}function Of(i){var e=pue(null),t;for(t in i)nb(hue,i,[t])===!0&&(e[t]=i[t]);return e}function ob(i,e){for(;i!==null;){var t=fue(i,e);if(t){if(t.get)return Fu(t.get);if(typeof t.value=="function")return Fu(t.value)}i=due(i)}function r(n){return console.warn("fallback value for",n),null}return r}var bk=uc(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),UE=uc(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),NE=uc(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),bue=uc(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),zE=uc(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),xue=uc(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),xk=uc(["#text"]),wk=uc(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),QE=uc(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Bk=uc(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),ab=uc(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),wue=fh(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Bue=fh(/<%[\w\W]*|[\w\W]*%>/gm),Cue=fh(/\${[\w\W]*}/gm),Eue=fh(/^data-[\-\w.\u00B7-\uFFFF]/),Sue=fh(/^aria-[\-\w]+$/),Tue=fh(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Iue=fh(/^(?:\w+script|data):/i),Lue=fh(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Mue=fh(/^html$/i),Pue=function(){return typeof window>"u"?null:window},Fue=function(i,e){if(Ld(i)!=="object"||typeof i.createPolicy!="function")return null;var t=null,r="data-tt-policy-suffix";e.currentScript&&e.currentScript.hasAttribute(r)&&(t=e.currentScript.getAttribute(r));var n="dompurify"+(t?"#"+t:"");try{return i.createPolicy(n,{createHTML:function(o){return o},createScriptURL:function(o){return o}})}catch{return console.warn("TrustedTypes policy "+n+" could not be created."),null}};function Ck(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Pue(),e=function(st){return Ck(st)};if(e.version="2.4.5",e.removed=[],!i||!i.document||i.document.nodeType!==9)return e.isSupported=!1,e;var t=i.document,r=i.document,n=i.DocumentFragment,o=i.HTMLTemplateElement,l=i.Node,s=i.Element,g=i.NodeFilter,b=i.NamedNodeMap,T=b===void 0?i.NamedNodeMap||i.MozNamedAttrMap:b,F=i.HTMLFormElement,k=i.DOMParser,z=i.trustedTypes,J=s.prototype,te=ob(J,"cloneNode"),ue=ob(J,"nextSibling"),ce=ob(J,"childNodes"),de=ob(J,"parentNode");if(typeof o=="function"){var _e=r.createElement("template");_e.content&&_e.content.ownerDocument&&(r=_e.content.ownerDocument)}var Ee=Fue(z,t),He=Ee?Ee.createHTML(""):"",Ve=r,qe=Ve.implementation,Ue=Ve.createNodeIterator,ot=Ve.createDocumentFragment,it=Ve.getElementsByTagName,De=t.importNode,Me={};try{Me=Of(r).documentMode?r.documentMode:{}}catch{}var Ze={};e.isSupported=typeof de=="function"&&qe&&typeof qe.createHTMLDocument<"u"&&Me!==9;var We=wue,Bt=Bue,Ct=Cue,Lt=Eue,_t=Sue,Ft=Iue,Mt=Lue,Wt=Tue,Se=null,Xe=nn({},[].concat(dh(bk),dh(UE),dh(NE),dh(zE),dh(xk))),et=null,At=nn({},[].concat(dh(wk),dh(QE),dh(Bk),dh(ab))),ft=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),wt=null,Pt=null,It=!0,Ht=!0,ii=!1,gi=!0,mi=!1,Mi=!1,kt=!1,at=!1,xt=!1,Ri=!1,ei=!1,ut=!0,jt=!1,ni="user-content-",di=!0,li=!1,Ki={},tr=null,Ar=nn({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Er=null,Nt=nn({},["audio","video","img","source","image","track"]),Ji=null,ci=nn({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),$t="http://www.w3.org/1998/Math/MathML",Zi="http://www.w3.org/2000/svg",Qt="http://www.w3.org/1999/xhtml",Bi=Qt,Ii=!1,Gt=null,vi=nn({},[$t,Zi,Qt],kE),Jt,mr=["application/xhtml+xml","text/html"],Sr="text/html",ze,we=null,oe=r.createElement("form"),ee=function(st){return st instanceof RegExp||st instanceof Function},le=function(st){we&&we===st||((!st||Ld(st)!=="object")&&(st={}),st=Of(st),Jt=mr.indexOf(st.PARSER_MEDIA_TYPE)===-1?Jt=Sr:Jt=st.PARSER_MEDIA_TYPE,ze=Jt==="application/xhtml+xml"?kE:sb,Se="ALLOWED_TAGS"in st?nn({},st.ALLOWED_TAGS,ze):Xe,et="ALLOWED_ATTR"in st?nn({},st.ALLOWED_ATTR,ze):At,Gt="ALLOWED_NAMESPACES"in st?nn({},st.ALLOWED_NAMESPACES,kE):vi,Ji="ADD_URI_SAFE_ATTR"in st?nn(Of(ci),st.ADD_URI_SAFE_ATTR,ze):ci,Er="ADD_DATA_URI_TAGS"in st?nn(Of(Nt),st.ADD_DATA_URI_TAGS,ze):Nt,tr="FORBID_CONTENTS"in st?nn({},st.FORBID_CONTENTS,ze):Ar,wt="FORBID_TAGS"in st?nn({},st.FORBID_TAGS,ze):{},Pt="FORBID_ATTR"in st?nn({},st.FORBID_ATTR,ze):{},Ki="USE_PROFILES"in st?st.USE_PROFILES:!1,It=st.ALLOW_ARIA_ATTR!==!1,Ht=st.ALLOW_DATA_ATTR!==!1,ii=st.ALLOW_UNKNOWN_PROTOCOLS||!1,gi=st.ALLOW_SELF_CLOSE_IN_ATTR!==!1,mi=st.SAFE_FOR_TEMPLATES||!1,Mi=st.WHOLE_DOCUMENT||!1,xt=st.RETURN_DOM||!1,Ri=st.RETURN_DOM_FRAGMENT||!1,ei=st.RETURN_TRUSTED_TYPE||!1,at=st.FORCE_BODY||!1,ut=st.SANITIZE_DOM!==!1,jt=st.SANITIZE_NAMED_PROPS||!1,di=st.KEEP_CONTENT!==!1,li=st.IN_PLACE||!1,Wt=st.ALLOWED_URI_REGEXP||Wt,Bi=st.NAMESPACE||Qt,ft=st.CUSTOM_ELEMENT_HANDLING||{},st.CUSTOM_ELEMENT_HANDLING&&ee(st.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ft.tagNameCheck=st.CUSTOM_ELEMENT_HANDLING.tagNameCheck),st.CUSTOM_ELEMENT_HANDLING&&ee(st.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ft.attributeNameCheck=st.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),st.CUSTOM_ELEMENT_HANDLING&&typeof st.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ft.allowCustomizedBuiltInElements=st.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),mi&&(Ht=!1),Ri&&(xt=!0),Ki&&(Se=nn({},dh(xk)),et=[],Ki.html===!0&&(nn(Se,bk),nn(et,wk)),Ki.svg===!0&&(nn(Se,UE),nn(et,QE),nn(et,ab)),Ki.svgFilters===!0&&(nn(Se,NE),nn(et,QE),nn(et,ab)),Ki.mathMl===!0&&(nn(Se,zE),nn(et,Bk),nn(et,ab))),st.ADD_TAGS&&(Se===Xe&&(Se=Of(Se)),nn(Se,st.ADD_TAGS,ze)),st.ADD_ATTR&&(et===At&&(et=Of(et)),nn(et,st.ADD_ATTR,ze)),st.ADD_URI_SAFE_ATTR&&nn(Ji,st.ADD_URI_SAFE_ATTR,ze),st.FORBID_CONTENTS&&(tr===Ar&&(tr=Of(tr)),nn(tr,st.FORBID_CONTENTS,ze)),di&&(Se["#text"]=!0),Mi&&nn(Se,["html","head","body"]),Se.table&&(nn(Se,["tbody"]),delete wt.tbody),uc&&uc(st),we=st)},ge=nn({},["mi","mo","mn","ms","mtext"]),ve=nn({},["foreignobject","desc","title","annotation-xml"]),Ce=nn({},["title","style","font","a","script"]),be=nn({},UE);nn(be,NE),nn(be,bue);var Pe=nn({},zE);nn(Pe,xue);var Oe=function(st){var ti=de(st);(!ti||!ti.tagName)&&(ti={namespaceURI:Bi,tagName:"template"});var zt=sb(st.tagName),zi=sb(ti.tagName);return Gt[st.namespaceURI]?st.namespaceURI===Zi?ti.namespaceURI===Qt?zt==="svg":ti.namespaceURI===$t?zt==="svg"&&(zi==="annotation-xml"||ge[zi]):!!be[zt]:st.namespaceURI===$t?ti.namespaceURI===Qt?zt==="math":ti.namespaceURI===Zi?zt==="math"&&ve[zi]:!!Pe[zt]:st.namespaceURI===Qt?ti.namespaceURI===Zi&&!ve[zi]||ti.namespaceURI===$t&&!ge[zi]?!1:!Pe[zt]&&(Ce[zt]||!be[zt]):!!(Jt==="application/xhtml+xml"&&Gt[st.namespaceURI]):!1},Ge=function(st){c0(e.removed,{element:st});try{st.parentNode.removeChild(st)}catch{try{st.outerHTML=He}catch{st.remove()}}},rt=function(st,ti){try{c0(e.removed,{attribute:ti.getAttributeNode(st),from:ti})}catch{c0(e.removed,{attribute:null,from:ti})}if(ti.removeAttribute(st),st==="is"&&!et[st])if(xt||Ri)try{Ge(ti)}catch{}else try{ti.setAttribute(st,"")}catch{}},yt=function(st){var ti,zt;if(at)st="<remove></remove>"+st;else{var zi=mue(st,/^[\r\n\t ]+/);zt=zi&&zi[0]}Jt==="application/xhtml+xml"&&Bi===Qt&&(st='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+st+"</body></html>");var hr=Ee?Ee.createHTML(st):st;if(Bi===Qt)try{ti=new k().parseFromString(hr,Jt)}catch{}if(!ti||!ti.documentElement){ti=qe.createDocument(Bi,"template",null);try{ti.documentElement.innerHTML=Ii?He:hr}catch{}}var sn=ti.body||ti.documentElement;return st&&zt&&sn.insertBefore(r.createTextNode(zt),sn.childNodes[0]||null),Bi===Qt?it.call(ti,Mi?"html":"body")[0]:Mi?ti.documentElement:sn},Et=function(st){return Ue.call(st.ownerDocument||st,st,g.SHOW_ELEMENT|g.SHOW_COMMENT|g.SHOW_TEXT,null,!1)},Yt=function(st){return st instanceof F&&(typeof st.nodeName!="string"||typeof st.textContent!="string"||typeof st.removeChild!="function"||!(st.attributes instanceof T)||typeof st.removeAttribute!="function"||typeof st.setAttribute!="function"||typeof st.namespaceURI!="string"||typeof st.insertBefore!="function"||typeof st.hasChildNodes!="function")},qt=function(st){return Ld(l)==="object"?st instanceof l:st&&Ld(st)==="object"&&typeof st.nodeType=="number"&&typeof st.nodeName=="string"},Kt=function(st,ti,zt){Ze[st]&&gue(Ze[st],function(zi){zi.call(e,ti,zt,we)})},si=function(st){var ti;if(Kt("beforeSanitizeElements",st,null),Yt(st)||hc(/[\u0080-\uFFFF]/,st.nodeName))return Ge(st),!0;var zt=ze(st.nodeName);if(Kt("uponSanitizeElement",st,{tagName:zt,allowedTags:Se}),st.hasChildNodes()&&!qt(st.firstElementChild)&&(!qt(st.content)||!qt(st.content.firstElementChild))&&hc(/<[/\w]/g,st.innerHTML)&&hc(/<[/\w]/g,st.textContent)||zt==="select"&&hc(/<template/i,st.innerHTML))return Ge(st),!0;if(!Se[zt]||wt[zt]){if(!wt[zt]&&Hi(zt)&&(ft.tagNameCheck instanceof RegExp&&hc(ft.tagNameCheck,zt)||ft.tagNameCheck instanceof Function&&ft.tagNameCheck(zt)))return!1;if(di&&!tr[zt]){var zi=de(st)||st.parentNode,hr=ce(st)||st.childNodes;if(hr&&zi)for(var sn=hr.length,bn=sn-1;bn>=0;--bn)zi.insertBefore(te(hr[bn],!0),ue(st))}return Ge(st),!0}return st instanceof s&&!Oe(st)||(zt==="noscript"||zt==="noembed")&&hc(/<\/no(script|embed)/i,st.innerHTML)?(Ge(st),!0):(mi&&st.nodeType===3&&(ti=st.textContent,ti=ph(ti,We," "),ti=ph(ti,Bt," "),ti=ph(ti,Ct," "),st.textContent!==ti&&(c0(e.removed,{element:st.cloneNode()}),st.textContent=ti)),Kt("afterSanitizeElements",st,null),!1)},Ci=function(st,ti,zt){if(ut&&(ti==="id"||ti==="name")&&(zt in r||zt in oe))return!1;if(!(Ht&&!Pt[ti]&&hc(Lt,ti))&&!(It&&hc(_t,ti))){if(!et[ti]||Pt[ti]){if(!(Hi(st)&&(ft.tagNameCheck instanceof RegExp&&hc(ft.tagNameCheck,st)||ft.tagNameCheck instanceof Function&&ft.tagNameCheck(st))&&(ft.attributeNameCheck instanceof RegExp&&hc(ft.attributeNameCheck,ti)||ft.attributeNameCheck instanceof Function&&ft.attributeNameCheck(ti))||ti==="is"&&ft.allowCustomizedBuiltInElements&&(ft.tagNameCheck instanceof RegExp&&hc(ft.tagNameCheck,zt)||ft.tagNameCheck instanceof Function&&ft.tagNameCheck(zt))))return!1}else if(!Ji[ti]&&!hc(Wt,ph(zt,Mt,""))&&!((ti==="src"||ti==="xlink:href"||ti==="href")&&st!=="script"&&yue(zt,"data:")===0&&Er[st])&&!(ii&&!hc(Ft,ph(zt,Mt,"")))&&zt)return!1}return!0},Hi=function(st){return st.indexOf("-")>0},wi=function(st){var ti,zt,zi,hr;Kt("beforeSanitizeAttributes",st,null);var sn=st.attributes;if(sn){var bn={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:et};for(hr=sn.length;hr--;){ti=sn[hr];var ur=ti,gn=ur.name,mn=ur.namespaceURI;if(zt=gn==="value"?ti.value:_ue(ti.value),zi=ze(gn),bn.attrName=zi,bn.attrValue=zt,bn.keepAttr=!0,bn.forceKeepAttr=void 0,Kt("uponSanitizeAttribute",st,bn),zt=bn.attrValue,!bn.forceKeepAttr&&(rt(gn,st),!!bn.keepAttr)){if(!gi&&hc(/\/>/i,zt)){rt(gn,st);continue}mi&&(zt=ph(zt,We," "),zt=ph(zt,Bt," "),zt=ph(zt,Ct," "));var lr=ze(st.nodeName);if(Ci(lr,zi,zt)){if(jt&&(zi==="id"||zi==="name")&&(rt(gn,st),zt=ni+zt),Ee&&Ld(z)==="object"&&typeof z.getAttributeType=="function"&&!mn)switch(z.getAttributeType(lr,zi)){case"TrustedHTML":zt=Ee.createHTML(zt);break;case"TrustedScriptURL":zt=Ee.createScriptURL(zt);break}try{mn?st.setAttributeNS(mn,gn,zt):st.setAttribute(gn,zt),vk(e.removed)}catch{}}}}Kt("afterSanitizeAttributes",st,null)}},Ui=function st(ti){var zt,zi=Et(ti);for(Kt("beforeSanitizeShadowDOM",ti,null);zt=zi.nextNode();)Kt("uponSanitizeShadowNode",zt,null),!si(zt)&&(zt.content instanceof n&&st(zt.content),wi(zt));Kt("afterSanitizeShadowDOM",ti,null)};return e.sanitize=function(st){var ti=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},zt,zi,hr,sn,bn;if(Ii=!st,Ii&&(st="<!-->"),typeof st!="string"&&!qt(st)){if(typeof st.toString!="function")throw OE("toString is not a function");if(st=st.toString(),typeof st!="string")throw OE("dirty is not a string, aborting")}if(!e.isSupported){if(Ld(i.toStaticHTML)==="object"||typeof i.toStaticHTML=="function"){if(typeof st=="string")return i.toStaticHTML(st);if(qt(st))return i.toStaticHTML(st.outerHTML)}return st}if(kt||le(ti),e.removed=[],typeof st=="string"&&(li=!1),li){if(st.nodeName){var ur=ze(st.nodeName);if(!Se[ur]||wt[ur])throw OE("root node is forbidden and cannot be sanitized in-place")}}else if(st instanceof l)zt=yt("<!---->"),zi=zt.ownerDocument.importNode(st,!0),zi.nodeType===1&&zi.nodeName==="BODY"||zi.nodeName==="HTML"?zt=zi:zt.appendChild(zi);else{if(!xt&&!mi&&!Mi&&st.indexOf("<")===-1)return Ee&&ei?Ee.createHTML(st):st;if(zt=yt(st),!zt)return xt?null:ei?He:""}zt&&at&&Ge(zt.firstChild);for(var gn=Et(li?st:zt);hr=gn.nextNode();)hr.nodeType===3&&hr===sn||si(hr)||(hr.content instanceof n&&Ui(hr.content),wi(hr),sn=hr);if(sn=null,li)return st;if(xt){if(Ri)for(bn=ot.call(zt.ownerDocument);zt.firstChild;)bn.appendChild(zt.firstChild);else bn=zt;return(et.shadowroot||et.shadowrootmod)&&(bn=De.call(t,bn,!0)),bn}var mn=Mi?zt.outerHTML:zt.innerHTML;return Mi&&Se["!doctype"]&&zt.ownerDocument&&zt.ownerDocument.doctype&&zt.ownerDocument.doctype.name&&hc(Mue,zt.ownerDocument.doctype.name)&&(mn="<!DOCTYPE "+zt.ownerDocument.doctype.name+`>
`+mn),mi&&(mn=ph(mn,We," "),mn=ph(mn,Bt," "),mn=ph(mn,Ct," ")),Ee&&ei?Ee.createHTML(mn):mn},e.setConfig=function(st){le(st),kt=!0},e.clearConfig=function(){we=null,kt=!1},e.isValidAttribute=function(st,ti,zt){we||le({});var zi=ze(st),hr=ze(ti);return Ci(zi,hr,zt)},e.addHook=function(st,ti){typeof ti=="function"&&(Ze[st]=Ze[st]||[],c0(Ze[st],ti))},e.removeHook=function(st){if(Ze[st])return vk(Ze[st])},e.removeHooks=function(st){Ze[st]&&(Ze[st]=[])},e.removeAllHooks=function(){Ze={}},e}var Due=Ck();const Rue=Object.freeze(Object.defineProperty({__proto__:null,default:Due},Symbol.toStringTag,{value:"Module"}));var u0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ek(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var lb=function(i){return i&&i.Math==Math&&i},Ca=lb(typeof globalThis=="object"&&globalThis)||lb(typeof window=="object"&&window)||lb(typeof self=="object"&&self)||lb(typeof u0=="object"&&u0)||function(){return this}()||u0||Function("return this")(),qg={},qo=function(i){try{return!!i()}catch{return!0}},kue=qo,Yh=!kue(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Oue=qo,cb=!Oue(function(){var i=(function(){}).bind();return typeof i!="function"||i.hasOwnProperty("prototype")}),Uue=cb,ub=Function.prototype.call,ll=Uue?ub.bind(ub):function(){return ub.apply(ub,arguments)},Sk={},Tk={}.propertyIsEnumerable,Ik=Object.getOwnPropertyDescriptor,Nue=Ik&&!Tk.call({1:2},1);Sk.f=Nue?function(i){var e=Ik(this,i);return!!e&&e.enumerable}:Tk;var hb=function(i,e){return{enumerable:!(i&1),configurable:!(i&2),writable:!(i&4),value:e}},Lk=cb,Mk=Function.prototype,VE=Mk.call,zue=Lk&&Mk.bind.bind(VE,VE),$o=Lk?zue:function(i){return function(){return VE.apply(i,arguments)}},Pk=$o,Que=Pk({}.toString),Vue=Pk("".slice),Uf=function(i){return Vue(Que(i),8,-1)},Hue=$o,Gue=qo,jue=Uf,HE=Object,que=Hue("".split),Fk=Gue(function(){return!HE("z").propertyIsEnumerable(0)})?function(i){return jue(i)=="String"?que(i,""):HE(i)}:HE,Nf=function(i){return i==null},$ue=Nf,Kue=TypeError,eA=function(i){if($ue(i))throw Kue("Can't call method on "+i);return i},Wue=Fk,Xue=eA,h0=function(i){return Wue(Xue(i))},GE=typeof document=="object"&&document.all,Zue=typeof GE>"u"&&GE!==void 0,Dk={all:GE,IS_HTMLDDA:Zue},Rk=Dk,Jue=Rk.all,Co=Rk.IS_HTMLDDA?function(i){return typeof i=="function"||i===Jue}:function(i){return typeof i=="function"},kk=Co,Ok=Dk,Yue=Ok.all,kA=Ok.IS_HTMLDDA?function(i){return typeof i=="object"?i!==null:kk(i)||i===Yue}:function(i){return typeof i=="object"?i!==null:kk(i)},jE=Ca,ehe=Co,the=function(i){return ehe(i)?i:void 0},zf=function(i,e){return arguments.length<2?the(jE[i]):jE[i]&&jE[i][e]},ihe=$o,Ab=ihe({}.isPrototypeOf),db=typeof navigator<"u"&&String(navigator.userAgent)||"",Uk=Ca,qE=db,Nk=Uk.process,zk=Uk.Deno,Qk=Nk&&Nk.versions||zk&&zk.version,Vk=Qk&&Qk.v8,gh,fb;Vk&&(gh=Vk.split("."),fb=gh[0]>0&&gh[0]<4?1:+(gh[0]+gh[1])),!fb&&qE&&(gh=qE.match(/Edge\/(\d+)/),(!gh||gh[1]>=74)&&(gh=qE.match(/Chrome\/(\d+)/),gh&&(fb=+gh[1])));var $E=fb,Hk=$E,rhe=qo,nhe=Ca,she=nhe.String,Gk=!!Object.getOwnPropertySymbols&&!rhe(function(){var i=Symbol();return!she(i)||!(Object(i)instanceof Symbol)||!Symbol.sham&&Hk&&Hk<41}),ohe=Gk,jk=ohe&&!Symbol.sham&&typeof Symbol.iterator=="symbol",ahe=zf,lhe=Co,che=Ab,uhe=jk,hhe=Object,qk=uhe?function(i){return typeof i=="symbol"}:function(i){var e=ahe("Symbol");return lhe(e)&&che(e.prototype,hhe(i))},Ahe=String,pb=function(i){try{return Ahe(i)}catch{return"Object"}},dhe=Co,fhe=pb,phe=TypeError,OA=function(i){if(dhe(i))return i;throw phe(fhe(i)+" is not a function")},ghe=OA,mhe=Nf,$g=function(i,e){var t=i[e];return mhe(t)?void 0:ghe(t)},KE=ll,WE=Co,XE=kA,yhe=TypeError,_he=function(i,e){var t,r;if(e==="string"&&WE(t=i.toString)&&!XE(r=KE(t,i))||WE(t=i.valueOf)&&!XE(r=KE(t,i))||e!=="string"&&WE(t=i.toString)&&!XE(r=KE(t,i)))return r;throw yhe("Can't convert object to primitive value")},$k={exports:{}},Kk=Ca,vhe=Object.defineProperty,ZE=function(i,e){try{vhe(Kk,i,{value:e,configurable:!0,writable:!0})}catch{Kk[i]=e}return e},bhe=Ca,xhe=ZE,Wk="__core-js_shared__",whe=bhe[Wk]||xhe(Wk,{}),JE=whe,Xk=JE;($k.exports=function(i,e){return Xk[i]||(Xk[i]=e!==void 0?e:{})})("versions",[]).push({version:"3.30.2",mode:"global",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"});var YE=$k.exports,Bhe=eA,Che=Object,gb=function(i){return Che(Bhe(i))},Ehe=$o,She=gb,The=Ehe({}.hasOwnProperty),mh=Object.hasOwn||function(i,e){return The(She(i),e)},Ihe=$o,Lhe=0,Mhe=Math.random(),Phe=Ihe(1 .toString),Zk=function(i){return"Symbol("+(i===void 0?"":i)+")_"+Phe(++Lhe+Mhe,36)},Fhe=Ca,Dhe=YE,Jk=mh,Rhe=Zk,khe=Gk,Ohe=jk,Kg=Fhe.Symbol,eS=Dhe("wks"),Uhe=Ohe?Kg.for||Kg:Kg&&Kg.withoutSetter||Rhe,qa=function(i){return Jk(eS,i)||(eS[i]=khe&&Jk(Kg,i)?Kg[i]:Uhe("Symbol."+i)),eS[i]},Nhe=ll,Yk=kA,eO=qk,zhe=$g,Qhe=_he,Vhe=qa,Hhe=TypeError,Ghe=Vhe("toPrimitive"),jhe=function(i,e){if(!Yk(i)||eO(i))return i;var t=zhe(i,Ghe),r;if(t){if(e===void 0&&(e="default"),r=Nhe(t,i,e),!Yk(r)||eO(r))return r;throw Hhe("Can't convert object to primitive value")}return e===void 0&&(e="number"),Qhe(i,e)},qhe=jhe,$he=qk,tS=function(i){var e=qhe(i,"string");return $he(e)?e:e+""},Khe=Ca,tO=kA,iS=Khe.document,Whe=tO(iS)&&tO(iS.createElement),mb=function(i){return Whe?iS.createElement(i):{}},Xhe=Yh,Zhe=qo,Jhe=mb,iO=!Xhe&&!Zhe(function(){return Object.defineProperty(Jhe("div"),"a",{get:function(){return 7}}).a!=7}),Yhe=Yh,eAe=ll,tAe=Sk,iAe=hb,rAe=h0,nAe=tS,sAe=mh,oAe=iO,rO=Object.getOwnPropertyDescriptor;qg.f=Yhe?rO:function(i,e){if(i=rAe(i),e=nAe(e),oAe)try{return rO(i,e)}catch{}if(sAe(i,e))return iAe(!eAe(tAe.f,i,e),i[e])};var tA={},aAe=Yh,lAe=qo,nO=aAe&&lAe(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),cAe=kA,uAe=String,hAe=TypeError,kl=function(i){if(cAe(i))return i;throw hAe(uAe(i)+" is not an object")},AAe=Yh,dAe=iO,fAe=nO,yb=kl,sO=tS,pAe=TypeError,rS=Object.defineProperty,gAe=Object.getOwnPropertyDescriptor,nS="enumerable",sS="configurable",oS="writable";tA.f=AAe?fAe?function(i,e,t){if(yb(i),e=sO(e),yb(t),typeof i=="function"&&e==="prototype"&&"value"in t&&oS in t&&!t[oS]){var r=gAe(i,e);r&&r[oS]&&(i[e]=t.value,t={configurable:sS in t?t[sS]:r[sS],enumerable:nS in t?t[nS]:r[nS],writable:!1})}return rS(i,e,t)}:rS:function(i,e,t){if(yb(i),e=sO(e),yb(t),dAe)try{return rS(i,e,t)}catch{}if("get"in t||"set"in t)throw pAe("Accessors not supported");return"value"in t&&(i[e]=t.value),i};var mAe=Yh,yAe=tA,_Ae=hb,A0=mAe?function(i,e,t){return yAe.f(i,e,_Ae(1,t))}:function(i,e,t){return i[e]=t,i},oO={exports:{}},aS=Yh,vAe=mh,aO=Function.prototype,bAe=aS&&Object.getOwnPropertyDescriptor,lS=vAe(aO,"name"),xAe=lS&&(function(){}).name==="something",wAe=lS&&(!aS||aS&&bAe(aO,"name").configurable),_b={EXISTS:lS,PROPER:xAe,CONFIGURABLE:wAe},BAe=$o,CAe=Co,cS=JE,EAe=BAe(Function.toString);CAe(cS.inspectSource)||(cS.inspectSource=function(i){return EAe(i)});var uS=cS.inspectSource,SAe=Ca,TAe=Co,lO=SAe.WeakMap,IAe=TAe(lO)&&/native code/.test(String(lO)),LAe=YE,MAe=Zk,cO=LAe("keys"),hS=function(i){return cO[i]||(cO[i]=MAe(i))},AS={},PAe=IAe,uO=Ca,FAe=kA,DAe=A0,dS=mh,fS=JE,RAe=hS,kAe=AS,hO="Object already initialized",pS=uO.TypeError,OAe=uO.WeakMap,vb,d0,bb,UAe=function(i){return bb(i)?d0(i):vb(i,{})},NAe=function(i){return function(e){var t;if(!FAe(e)||(t=d0(e)).type!==i)throw pS("Incompatible receiver, "+i+" required");return t}};if(PAe||fS.state){var iA=fS.state||(fS.state=new OAe);iA.get=iA.get,iA.has=iA.has,iA.set=iA.set,vb=function(i,e){if(iA.has(i))throw pS(hO);return e.facade=i,iA.set(i,e),e},d0=function(i){return iA.get(i)||{}},bb=function(i){return iA.has(i)}}else{var Wg=RAe("state");kAe[Wg]=!0,vb=function(i,e){if(dS(i,Wg))throw pS(hO);return e.facade=i,DAe(i,Wg,e),e},d0=function(i){return dS(i,Wg)?i[Wg]:{}},bb=function(i){return dS(i,Wg)}}var xb={set:vb,get:d0,has:bb,enforce:UAe,getterFor:NAe},gS=$o,zAe=qo,QAe=Co,wb=mh,mS=Yh,VAe=_b.CONFIGURABLE,HAe=uS,AO=xb,GAe=AO.enforce,jAe=AO.get,dO=String,Bb=Object.defineProperty,qAe=gS("".slice),$Ae=gS("".replace),KAe=gS([].join),WAe=mS&&!zAe(function(){return Bb(function(){},"length",{value:8}).length!==8}),XAe=String(String).split("String"),ZAe=oO.exports=function(i,e,t){qAe(dO(e),0,7)==="Symbol("&&(e="["+$Ae(dO(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!wb(i,"name")||VAe&&i.name!==e)&&(mS?Bb(i,"name",{value:e,configurable:!0}):i.name=e),WAe&&t&&wb(t,"arity")&&i.length!==t.arity&&Bb(i,"length",{value:t.arity});try{t&&wb(t,"constructor")&&t.constructor?mS&&Bb(i,"prototype",{writable:!1}):i.prototype&&(i.prototype=void 0)}catch{}var r=GAe(i);return wb(r,"source")||(r.source=KAe(XAe,typeof e=="string"?e:"")),i};Function.prototype.toString=ZAe(function(){return QAe(this)&&jAe(this).source||HAe(this)},"toString");var fO=oO.exports,JAe=Co,YAe=tA,ede=fO,tde=ZE,Qf=function(i,e,t,r){r||(r={});var n=r.enumerable,o=r.name!==void 0?r.name:e;if(JAe(t)&&ede(t,o,r),r.global)n?i[e]=t:tde(e,t);else{try{r.unsafe?i[e]&&(n=!0):delete i[e]}catch{}n?i[e]=t:YAe.f(i,e,{value:t,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return i},pO={},ide=Math.ceil,rde=Math.floor,nde=Math.trunc||function(i){var e=+i;return(e>0?rde:ide)(e)},sde=nde,Cb=function(i){var e=+i;return e!==e||e===0?0:sde(e)},ode=Cb,ade=Math.max,lde=Math.min,gO=function(i,e){var t=ode(i);return t<0?ade(t+e,0):lde(t,e)},cde=Cb,ude=Math.min,Xg=function(i){return i>0?ude(cde(i),9007199254740991):0},hde=Xg,Eb=function(i){return hde(i.length)},Ade=h0,dde=gO,fde=Eb,mO=function(i){return function(e,t,r){var n=Ade(e),o=fde(n),l=dde(r,o),s;if(i&&t!=t){for(;o>l;)if(s=n[l++],s!=s)return!0}else for(;o>l;l++)if((i||l in n)&&n[l]===t)return i||l||0;return!i&&-1}},yO={includes:mO(!0),indexOf:mO(!1)},pde=$o,yS=mh,gde=h0,mde=yO.indexOf,yde=AS,_O=pde([].push),vO=function(i,e){var t=gde(i),r=0,n=[],o;for(o in t)!yS(yde,o)&&yS(t,o)&&_O(n,o);for(;e.length>r;)yS(t,o=e[r++])&&(~mde(n,o)||_O(n,o));return n},_S=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],_de=vO,vde=_S,bde=vde.concat("length","prototype");pO.f=Object.getOwnPropertyNames||function(i){return _de(i,bde)};var bO={};bO.f=Object.getOwnPropertySymbols;var xde=zf,wde=$o,Bde=pO,Cde=bO,Ede=kl,Sde=wde([].concat),Tde=xde("Reflect","ownKeys")||function(i){var e=Bde.f(Ede(i)),t=Cde.f;return t?Sde(e,t(i)):e},xO=mh,Ide=Tde,Lde=qg,Mde=tA,Pde=function(i,e,t){for(var r=Ide(e),n=Mde.f,o=Lde.f,l=0;l<r.length;l++){var s=r[l];!xO(i,s)&&!(t&&xO(t,s))&&n(i,s,o(e,s))}},Fde=qo,Dde=Co,Rde=/#|\.prototype\./,f0=function(i,e){var t=Ode[kde(i)];return t==Nde?!0:t==Ude?!1:Dde(e)?Fde(e):!!e},kde=f0.normalize=function(i){return String(i).replace(Rde,".").toLowerCase()},Ode=f0.data={},Ude=f0.NATIVE="N",Nde=f0.POLYFILL="P",wO=f0,vS=Ca,zde=qg.f,Qde=A0,Vde=Qf,Hde=ZE,Gde=Pde,jde=wO,Ac=function(i,e){var t=i.target,r=i.global,n=i.stat,o,l,s,g,b,T;if(r?l=vS:n?l=vS[t]||Hde(t,{}):l=(vS[t]||{}).prototype,l)for(s in e){if(b=e[s],i.dontCallGetSet?(T=zde(l,s),g=T&&T.value):g=l[s],o=jde(r?s:t+(n?".":"#")+s,i.forced),!o&&g!==void 0){if(typeof b==typeof g)continue;Gde(b,g)}(i.sham||g&&g.sham)&&Qde(b,"sham",!0),Vde(l,s,b,i)}},qde=Uf,p0=typeof process<"u"&&qde(process)=="process",$de=$o,Kde=OA,Wde=function(i,e,t){try{return $de(Kde(Object.getOwnPropertyDescriptor(i,e)[t]))}catch{}},Xde=Co,Zde=String,Jde=TypeError,Yde=function(i){if(typeof i=="object"||Xde(i))return i;throw Jde("Can't set "+Zde(i)+" as a prototype")},efe=Wde,tfe=kl,ife=Yde,BO=Object.setPrototypeOf||("__proto__"in{}?function(){var i=!1,e={},t;try{t=efe(Object.prototype,"__proto__","set"),t(e,[]),i=e instanceof Array}catch{}return function(r,n){return tfe(r),ife(n),i?t(r,n):r.__proto__=n,r}}():void 0),rfe=tA.f,nfe=mh,sfe=qa,CO=sfe("toStringTag"),bS=function(i,e,t){i&&!t&&(i=i.prototype),i&&!nfe(i,CO)&&rfe(i,CO,{configurable:!0,value:e})},EO=fO,ofe=tA,afe=function(i,e,t){return t.get&&EO(t.get,e,{getter:!0}),t.set&&EO(t.set,e,{setter:!0}),ofe.f(i,e,t)},lfe=zf,cfe=afe,ufe=qa,hfe=Yh,SO=ufe("species"),Afe=function(i){var e=lfe(i);hfe&&e&&!e[SO]&&cfe(e,SO,{configurable:!0,get:function(){return this}})},dfe=Ab,ffe=TypeError,pfe=function(i,e){if(dfe(e,i))return i;throw ffe("Incorrect invocation")},gfe=qa,mfe=gfe("toStringTag"),TO={};TO[mfe]="z";var yfe=String(TO)==="[object z]",_fe=yfe,vfe=Co,Sb=Uf,bfe=qa,xfe=bfe("toStringTag"),wfe=Object,Bfe=Sb(function(){return arguments}())=="Arguments",Cfe=function(i,e){try{return i[e]}catch{}},xS=_fe?Sb:function(i){var e,t,r;return i===void 0?"Undefined":i===null?"Null":typeof(t=Cfe(e=wfe(i),xfe))=="string"?t:Bfe?Sb(e):(r=Sb(e))=="Object"&&vfe(e.callee)?"Arguments":r},Efe=$o,Sfe=qo,IO=Co,Tfe=xS,Ife=zf,Lfe=uS,LO=function(){},Mfe=[],MO=Ife("Reflect","construct"),wS=/^\s*(?:class|function)\b/,Pfe=Efe(wS.exec),Ffe=!wS.exec(LO),g0=function(i){if(!IO(i))return!1;try{return MO(LO,Mfe,i),!0}catch{return!1}},PO=function(i){if(!IO(i))return!1;switch(Tfe(i)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ffe||!!Pfe(wS,Lfe(i))}catch{return!0}};PO.sham=!0;var Dfe=!MO||Sfe(function(){var i;return g0(g0.call)||!g0(Object)||!g0(function(){i=!0})||i})?PO:g0,Rfe=Dfe,kfe=pb,Ofe=TypeError,Ufe=function(i){if(Rfe(i))return i;throw Ofe(kfe(i)+" is not a constructor")},FO=kl,Nfe=Ufe,zfe=Nf,Qfe=qa,Vfe=Qfe("species"),DO=function(i,e){var t=FO(i).constructor,r;return t===void 0||zfe(r=FO(t)[Vfe])?e:Nfe(r)},Hfe=cb,RO=Function.prototype,kO=RO.apply,OO=RO.call,BS=typeof Reflect=="object"&&Reflect.apply||(Hfe?OO.bind(kO):function(){return OO.apply(kO,arguments)}),Gfe=Uf,jfe=$o,m0=function(i){if(Gfe(i)==="Function")return jfe(i)},UO=m0,qfe=OA,$fe=cb,Kfe=UO(UO.bind),CS=function(i,e){return qfe(i),e===void 0?i:$fe?Kfe(i,e):function(){return i.apply(e,arguments)}},Wfe=zf,NO=Wfe("document","documentElement"),Xfe=$o,Zfe=Xfe([].slice),Jfe=TypeError,Yfe=function(i,e){if(i<e)throw Jfe("Not enough arguments");return i},epe=db,zO=/(?:ipad|iphone|ipod).*applewebkit/i.test(epe),ou=Ca,tpe=BS,ipe=CS,QO=Co,rpe=mh,VO=qo,HO=NO,npe=Zfe,GO=mb,spe=Yfe,ope=zO,ape=p0,ES=ou.setImmediate,SS=ou.clearImmediate,lpe=ou.process,TS=ou.Dispatch,cpe=ou.Function,jO=ou.MessageChannel,upe=ou.String,IS=0,y0={},qO="onreadystatechange",_0,Vf,LS,MS;VO(function(){_0=ou.location});var PS=function(i){if(rpe(y0,i)){var e=y0[i];delete y0[i],e()}},FS=function(i){return function(){PS(i)}},$O=function(i){PS(i.data)},KO=function(i){ou.postMessage(upe(i),_0.protocol+"//"+_0.host)};(!ES||!SS)&&(ES=function(i){spe(arguments.length,1);var e=QO(i)?i:cpe(i),t=npe(arguments,1);return y0[++IS]=function(){tpe(e,void 0,t)},Vf(IS),IS},SS=function(i){delete y0[i]},ape?Vf=function(i){lpe.nextTick(FS(i))}:TS&&TS.now?Vf=function(i){TS.now(FS(i))}:jO&&!ope?(LS=new jO,MS=LS.port2,LS.port1.onmessage=$O,Vf=ipe(MS.postMessage,MS)):ou.addEventListener&&QO(ou.postMessage)&&!ou.importScripts&&_0&&_0.protocol!=="file:"&&!VO(KO)?(Vf=KO,ou.addEventListener("message",$O,!1)):qO in GO("script")?Vf=function(i){HO.appendChild(GO("script"))[qO]=function(){HO.removeChild(this),PS(i)}}:Vf=function(i){setTimeout(FS(i),0)});var WO={set:ES,clear:SS},XO=function(){this.head=null,this.tail=null};XO.prototype={add:function(i){var e={item:i,next:null},t=this.tail;t?t.next=e:this.head=e,this.tail=e},get:function(){var i=this.head;if(i){var e=this.head=i.next;return e===null&&(this.tail=null),i.item}}};var ZO=XO,hpe=db,Ape=/ipad|iphone|ipod/i.test(hpe)&&typeof Pebble<"u",dpe=db,fpe=/web0s(?!.*chrome)/i.test(dpe),Hf=Ca,JO=CS,ppe=qg.f,DS=WO.set,gpe=ZO,mpe=zO,ype=Ape,_pe=fpe,RS=p0,YO=Hf.MutationObserver||Hf.WebKitMutationObserver,eU=Hf.document,tU=Hf.process,Tb=Hf.Promise,iU=ppe(Hf,"queueMicrotask"),kS=iU&&iU.value,Zg,OS,US,Ib,rU;if(!kS){var Lb=new gpe,Mb=function(){var i,e;for(RS&&(i=tU.domain)&&i.exit();e=Lb.get();)try{e()}catch(t){throw Lb.head&&Zg(),t}i&&i.enter()};!mpe&&!RS&&!_pe&&YO&&eU?(OS=!0,US=eU.createTextNode(""),new YO(Mb).observe(US,{characterData:!0}),Zg=function(){US.data=OS=!OS}):!ype&&Tb&&Tb.resolve?(Ib=Tb.resolve(void 0),Ib.constructor=Tb,rU=JO(Ib.then,Ib),Zg=function(){rU(Mb)}):RS?Zg=function(){tU.nextTick(Mb)}:(DS=JO(DS,Hf),Zg=function(){DS(Mb)}),kS=function(i){Lb.head||Zg(),Lb.add(i)}}var vpe=kS,bpe=function(i,e){try{arguments.length==1?console.error(i):console.error(i,e)}catch{}},NS=function(i){try{return{error:!1,value:i()}}catch(e){return{error:!0,value:e}}},xpe=Ca,Pb=xpe.Promise,nU=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",wpe=nU,Bpe=p0,Cpe=!wpe&&!Bpe&&typeof window=="object"&&typeof document=="object",Epe=Ca,v0=Pb,Spe=Co,Tpe=wO,Ipe=uS,Lpe=qa,Mpe=Cpe,Ppe=nU,zS=$E;v0&&v0.prototype;var Fpe=Lpe("species"),QS=!1,sU=Spe(Epe.PromiseRejectionEvent),Dpe=Tpe("Promise",function(){var i=Ipe(v0),e=i!==String(v0);if(!e&&zS===66)return!0;if(!zS||zS<51||!/native code/.test(i)){var t=new v0(function(o){o(1)}),r=function(o){o(function(){},function(){})},n=t.constructor={};if(n[Fpe]=r,QS=t.then(function(){})instanceof r,!QS)return!0}return!e&&(Mpe||Ppe)&&!sU}),b0={CONSTRUCTOR:Dpe,REJECTION_EVENT:sU,SUBCLASSING:QS},Jg={},oU=OA,Rpe=TypeError,kpe=function(i){var e,t;this.promise=new i(function(r,n){if(e!==void 0||t!==void 0)throw Rpe("Bad Promise constructor");e=r,t=n}),this.resolve=oU(e),this.reject=oU(t)};Jg.f=function(i){return new kpe(i)};var Ope=Ac,Fb=p0,Md=Ca,Yg=ll,aU=Qf,lU=BO,Upe=bS,Npe=Afe,zpe=OA,Db=Co,Qpe=kA,Vpe=pfe,Hpe=DO,cU=WO.set,VS=vpe,Gpe=bpe,jpe=NS,qpe=ZO,uU=xb,Rb=Pb,HS=b0,hU=Jg,kb="Promise",AU=HS.CONSTRUCTOR,$pe=HS.REJECTION_EVENT,Kpe=HS.SUBCLASSING,GS=uU.getterFor(kb),Wpe=uU.set,em=Rb&&Rb.prototype,Gf=Rb,Ob=em,dU=Md.TypeError,jS=Md.document,qS=Md.process,$S=hU.f,Xpe=$S,Zpe=!!(jS&&jS.createEvent&&Md.dispatchEvent),fU="unhandledrejection",Jpe="rejectionhandled",pU=0,gU=1,Ype=2,KS=1,mU=2,Ub,yU,ege,_U,vU=function(i){var e;return Qpe(i)&&Db(e=i.then)?e:!1},bU=function(i,e){var t=e.value,r=e.state==gU,n=r?i.ok:i.fail,o=i.resolve,l=i.reject,s=i.domain,g,b,T;try{n?(r||(e.rejection===mU&&ige(e),e.rejection=KS),n===!0?g=t:(s&&s.enter(),g=n(t),s&&(s.exit(),T=!0)),g===i.promise?l(dU("Promise-chain cycle")):(b=vU(g))?Yg(b,g,o,l):o(g)):l(t)}catch(F){s&&!T&&s.exit(),l(F)}},xU=function(i,e){i.notified||(i.notified=!0,VS(function(){for(var t=i.reactions,r;r=t.get();)bU(r,i);i.notified=!1,e&&!i.rejection&&tge(i)}))},wU=function(i,e,t){var r,n;Zpe?(r=jS.createEvent("Event"),r.promise=e,r.reason=t,r.initEvent(i,!1,!0),Md.dispatchEvent(r)):r={promise:e,reason:t},!$pe&&(n=Md["on"+i])?n(r):i===fU&&Gpe("Unhandled promise rejection",t)},tge=function(i){Yg(cU,Md,function(){var e=i.facade,t=i.value,r=BU(i),n;if(r&&(n=jpe(function(){Fb?qS.emit("unhandledRejection",t,e):wU(fU,e,t)}),i.rejection=Fb||BU(i)?mU:KS,n.error))throw n.value})},BU=function(i){return i.rejection!==KS&&!i.parent},ige=function(i){Yg(cU,Md,function(){var e=i.facade;Fb?qS.emit("rejectionHandled",e):wU(Jpe,e,i.value)})},tm=function(i,e,t){return function(r){i(e,r,t)}},im=function(i,e,t){i.done||(i.done=!0,t&&(i=t),i.value=e,i.state=Ype,xU(i,!0))},WS=function(i,e,t){if(!i.done){i.done=!0,t&&(i=t);try{if(i.facade===e)throw dU("Promise can't be resolved itself");var r=vU(e);r?VS(function(){var n={done:!1};try{Yg(r,e,tm(WS,n,i),tm(im,n,i))}catch(o){im(n,o,i)}}):(i.value=e,i.state=gU,xU(i,!1))}catch(n){im({done:!1},n,i)}}};if(AU&&(Gf=function(i){Vpe(this,Ob),zpe(i),Yg(Ub,this);var e=GS(this);try{i(tm(WS,e),tm(im,e))}catch(t){im(e,t)}},Ob=Gf.prototype,Ub=function(i){Wpe(this,{type:kb,done:!1,notified:!1,parent:!1,reactions:new qpe,rejection:!1,state:pU,value:void 0})},Ub.prototype=aU(Ob,"then",function(i,e){var t=GS(this),r=$S(Hpe(this,Gf));return t.parent=!0,r.ok=Db(i)?i:!0,r.fail=Db(e)&&e,r.domain=Fb?qS.domain:void 0,t.state==pU?t.reactions.add(r):VS(function(){bU(r,t)}),r.promise}),yU=function(){var i=new Ub,e=GS(i);this.promise=i,this.resolve=tm(WS,e),this.reject=tm(im,e)},hU.f=$S=function(i){return i===Gf||i===ege?new yU(i):Xpe(i)},Db(Rb)&&em!==Object.prototype)){_U=em.then,Kpe||aU(em,"then",function(i,e){var t=this;return new Gf(function(r,n){Yg(_U,t,r,n)}).then(i,e)},{unsafe:!0});try{delete em.constructor}catch{}lU&&lU(em,Ob)}Ope({global:!0,constructor:!0,wrap:!0,forced:AU},{Promise:Gf}),Upe(Gf,kb,!1),Npe(kb);var x0={},rge=qa,nge=x0,sge=rge("iterator"),oge=Array.prototype,age=function(i){return i!==void 0&&(nge.Array===i||oge[sge]===i)},lge=xS,CU=$g,cge=Nf,uge=x0,hge=qa,Age=hge("iterator"),EU=function(i){if(!cge(i))return CU(i,Age)||CU(i,"@@iterator")||uge[lge(i)]},dge=ll,fge=OA,pge=kl,gge=pb,mge=EU,yge=TypeError,_ge=function(i,e){var t=arguments.length<2?mge(i):e;if(fge(t))return pge(dge(t,i));throw yge(gge(i)+" is not iterable")},vge=ll,SU=kl,bge=$g,xge=function(i,e,t){var r,n;SU(i);try{if(r=bge(i,"return"),!r){if(e==="throw")throw t;return t}r=vge(r,i)}catch(o){n=!0,r=o}if(e==="throw")throw t;if(n)throw r;return SU(r),t},wge=CS,Bge=ll,Cge=kl,Ege=pb,Sge=age,Tge=Eb,TU=Ab,Ige=_ge,Lge=EU,IU=xge,Mge=TypeError,Nb=function(i,e){this.stopped=i,this.result=e},LU=Nb.prototype,MU=function(i,e,t){var r=t&&t.that,n=!!(t&&t.AS_ENTRIES),o=!!(t&&t.IS_RECORD),l=!!(t&&t.IS_ITERATOR),s=!!(t&&t.INTERRUPTED),g=wge(e,r),b,T,F,k,z,J,te,ue=function(de){return b&&IU(b,"normal",de),new Nb(!0,de)},ce=function(de){return n?(Cge(de),s?g(de[0],de[1],ue):g(de[0],de[1])):s?g(de,ue):g(de)};if(o)b=i.iterator;else if(l)b=i;else{if(T=Lge(i),!T)throw Mge(Ege(i)+" is not iterable");if(Sge(T)){for(F=0,k=Tge(i);k>F;F++)if(z=ce(i[F]),z&&TU(LU,z))return z;return new Nb(!1)}b=Ige(i,T)}for(J=o?i.next:b.next;!(te=Bge(J,b)).done;){try{z=ce(te.value)}catch(de){IU(b,"throw",de)}if(typeof z=="object"&&z&&TU(LU,z))return z}return new Nb(!1)},Pge=qa,PU=Pge("iterator"),FU=!1;try{var Fge=0,DU={next:function(){return{done:!!Fge++}},return:function(){FU=!0}};DU[PU]=function(){return this},Array.from(DU,function(){throw 2})}catch{}var Dge=function(i,e){if(!e&&!FU)return!1;var t=!1;try{var r={};r[PU]=function(){return{next:function(){return{done:t=!0}}}},i(r)}catch{}return t},Rge=Pb,kge=Dge,Oge=b0.CONSTRUCTOR,RU=Oge||!kge(function(i){Rge.all(i).then(void 0,function(){})}),Uge=Ac,Nge=ll,zge=OA,Qge=Jg,Vge=NS,Hge=MU,Gge=RU;Uge({target:"Promise",stat:!0,forced:Gge},{all:function(i){var e=this,t=Qge.f(e),r=t.resolve,n=t.reject,o=Vge(function(){var l=zge(e.resolve),s=[],g=0,b=1;Hge(i,function(T){var F=g++,k=!1;b++,Nge(l,e,T).then(function(z){k||(k=!0,s[F]=z,--b||r(s))},n)}),--b||r(s)});return o.error&&n(o.value),t.promise}});var jge=Ac,qge=b0.CONSTRUCTOR,XS=Pb,$ge=zf,Kge=Co,Wge=Qf,kU=XS&&XS.prototype;if(jge({target:"Promise",proto:!0,forced:qge,real:!0},{catch:function(i){return this.then(void 0,i)}}),Kge(XS)){var OU=$ge("Promise").prototype.catch;kU.catch!==OU&&Wge(kU,"catch",OU,{unsafe:!0})}var Xge=Ac,Zge=ll,Jge=OA,Yge=Jg,eme=NS,tme=MU,ime=RU;Xge({target:"Promise",stat:!0,forced:ime},{race:function(i){var e=this,t=Yge.f(e),r=t.reject,n=eme(function(){var o=Jge(e.resolve);tme(i,function(l){Zge(o,e,l).then(t.resolve,r)})});return n.error&&r(n.value),t.promise}});var rme=Ac,nme=ll,sme=Jg,ome=b0.CONSTRUCTOR;rme({target:"Promise",stat:!0,forced:ome},{reject:function(i){var e=sme.f(this);return nme(e.reject,void 0,i),e.promise}});var ame=kl,lme=kA,cme=Jg,ume=function(i,e){if(ame(i),lme(e)&&e.constructor===i)return e;var t=cme.f(i),r=t.resolve;return r(e),t.promise},hme=Ac,Ame=zf,dme=b0.CONSTRUCTOR,fme=ume;Ame("Promise"),hme({target:"Promise",stat:!0,forced:dme},{resolve:function(i){return fme(this,i)}});function UU(i,e,t,r,n,o,l){try{var s=i[o](l),g=s.value}catch(b){t(b);return}s.done?e(g):Promise.resolve(g).then(r,n)}function UA(i){return function(){var e=this,t=arguments;return new Promise(function(r,n){var o=i.apply(e,t);function l(g){UU(o,r,n,l,s,"next",g)}function s(g){UU(o,r,n,l,s,"throw",g)}l(void 0)})}}var pme=xS,gme=String,rA=function(i){if(pme(i)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return gme(i)},mme=kl,NU=function(){var i=mme(this),e="";return i.hasIndices&&(e+="d"),i.global&&(e+="g"),i.ignoreCase&&(e+="i"),i.multiline&&(e+="m"),i.dotAll&&(e+="s"),i.unicode&&(e+="u"),i.unicodeSets&&(e+="v"),i.sticky&&(e+="y"),e},ZS=qo,yme=Ca,JS=yme.RegExp,YS=ZS(function(){var i=JS("a","y");return i.lastIndex=2,i.exec("abcd")!=null}),_me=YS||ZS(function(){return!JS("a","y").sticky}),vme=YS||ZS(function(){var i=JS("^r","gy");return i.lastIndex=2,i.exec("str")!=null}),zU={BROKEN_CARET:vme,MISSED_STICKY:_me,UNSUPPORTED_Y:YS},QU={},bme=vO,xme=_S,wme=Object.keys||function(i){return bme(i,xme)},Bme=Yh,Cme=nO,Eme=tA,Sme=kl,Tme=h0,Ime=wme;QU.f=Bme&&!Cme?Object.defineProperties:function(i,e){Sme(i);for(var t=Tme(e),r=Ime(e),n=r.length,o=0,l;n>o;)Eme.f(i,l=r[o++],t[l]);return i};var Lme=kl,Mme=QU,VU=_S,Pme=AS,Fme=NO,Dme=mb,Rme=hS,HU=">",GU="<",eT="prototype",tT="script",jU=Rme("IE_PROTO"),iT=function(){},qU=function(i){return GU+tT+HU+i+GU+"/"+tT+HU},$U=function(i){i.write(qU("")),i.close();var e=i.parentWindow.Object;return i=null,e},kme=function(){var i=Dme("iframe"),e="java"+tT+":",t;return i.style.display="none",Fme.appendChild(i),i.src=String(e),t=i.contentWindow.document,t.open(),t.write(qU("document.F=Object")),t.close(),t.F},zb,Qb=function(){try{zb=new ActiveXObject("htmlfile")}catch{}Qb=typeof document<"u"?document.domain&&zb?$U(zb):kme():$U(zb);for(var i=VU.length;i--;)delete Qb[eT][VU[i]];return Qb()};Pme[jU]=!0;var rT=Object.create||function(i,e){var t;return i!==null?(iT[eT]=Lme(i),t=new iT,iT[eT]=null,t[jU]=i):t=Qb(),e===void 0?t:Mme.f(t,e)},Ome=qo,Ume=Ca,Nme=Ume.RegExp,zme=Ome(function(){var i=Nme(".","s");return!(i.dotAll&&i.exec(`
`)&&i.flags==="s")}),Qme=qo,Vme=Ca,Hme=Vme.RegExp,Gme=Qme(function(){var i=Hme("(?<a>b)","g");return i.exec("b").groups.a!=="b"||"b".replace(i,"$<a>c")!=="bc"}),rm=ll,Vb=$o,jme=rA,qme=NU,$me=zU,Kme=YE,Wme=rT,Xme=xb.get,Zme=zme,Jme=Gme,Yme=Kme("native-string-replace",String.prototype.replace),Hb=RegExp.prototype.exec,nT=Hb,eye=Vb("".charAt),tye=Vb("".indexOf),iye=Vb("".replace),sT=Vb("".slice),oT=function(){var i=/a/,e=/b*/g;return rm(Hb,i,"a"),rm(Hb,e,"a"),i.lastIndex!==0||e.lastIndex!==0}(),KU=$me.BROKEN_CARET,aT=/()??/.exec("")[1]!==void 0,rye=oT||aT||KU||Zme||Jme;rye&&(nT=function(i){var e=this,t=Xme(e),r=jme(i),n=t.raw,o,l,s,g,b,T,F;if(n)return n.lastIndex=e.lastIndex,o=rm(nT,n,r),e.lastIndex=n.lastIndex,o;var k=t.groups,z=KU&&e.sticky,J=rm(qme,e),te=e.source,ue=0,ce=r;if(z&&(J=iye(J,"y",""),tye(J,"g")===-1&&(J+="g"),ce=sT(r,e.lastIndex),e.lastIndex>0&&(!e.multiline||e.multiline&&eye(r,e.lastIndex-1)!==`
`)&&(te="(?: "+te+")",ce=" "+ce,ue++),l=new RegExp("^(?:"+te+")",J)),aT&&(l=new RegExp("^"+te+"$(?!\\s)",J)),oT&&(s=e.lastIndex),g=rm(Hb,z?l:e,ce),z?g?(g.input=sT(g.input,ue),g[0]=sT(g[0],ue),g.index=e.lastIndex,e.lastIndex+=g[0].length):e.lastIndex=0:oT&&g&&(e.lastIndex=e.global?g.index+g[0].length:s),aT&&g&&g.length>1&&rm(Yme,g[0],l,function(){for(b=1;b<arguments.length-2;b++)arguments[b]===void 0&&(g[b]=void 0)}),g&&k)for(g.groups=T=Wme(null),b=0;b<k.length;b++)F=k[b],T[F[0]]=g[F[1]];return g});var Gb=nT,nye=Ac,WU=Gb;nye({target:"RegExp",proto:!0,forced:/./.exec!==WU},{exec:WU});var XU=m0,ZU=Qf,sye=Gb,JU=qo,YU=qa,oye=A0,aye=YU("species"),lT=RegExp.prototype,cT=function(i,e,t,r){var n=YU(i),o=!JU(function(){var b={};return b[n]=function(){return 7},""[i](b)!=7}),l=o&&!JU(function(){var b=!1,T=/a/;return i==="split"&&(T={},T.constructor={},T.constructor[aye]=function(){return T},T.flags="",T[n]=/./[n]),T.exec=function(){return b=!0,null},T[n](""),!b});if(!o||!l||t){var s=XU(/./[n]),g=e(n,""[i],function(b,T,F,k,z){var J=XU(b),te=T.exec;return te===sye||te===lT.exec?o&&!z?{done:!0,value:s(T,F,k)}:{done:!0,value:J(F,T,k)}:{done:!1}});ZU(String.prototype,i,g[0]),ZU(lT,n,g[1])}r&&oye(lT[n],"sham",!0)},uT=$o,lye=Cb,cye=rA,uye=eA,hye=uT("".charAt),e6=uT("".charCodeAt),Aye=uT("".slice),t6=function(i){return function(e,t){var r=cye(uye(e)),n=lye(t),o=r.length,l,s;return n<0||n>=o?i?"":void 0:(l=e6(r,n),l<55296||l>56319||n+1===o||(s=e6(r,n+1))<56320||s>57343?i?hye(r,n):l:i?Aye(r,n,n+2):(l-55296<<10)+(s-56320)+65536)}},dye={codeAt:t6(!1),charAt:t6(!0)},fye=dye.charAt,hT=function(i,e,t){return e+(t?fye(i,e).length:1)},i6=ll,pye=kl,gye=Co,mye=Uf,yye=Gb,_ye=TypeError,AT=function(i,e){var t=i.exec;if(gye(t)){var r=i6(t,i,e);return r!==null&&pye(r),r}if(mye(i)==="RegExp")return i6(yye,i,e);throw _ye("RegExp#exec called on incompatible receiver")},vye=ll,bye=cT,xye=kl,wye=Nf,Bye=Xg,dT=rA,Cye=eA,Eye=$g,Sye=hT,r6=AT;bye("match",function(i,e,t){return[function(r){var n=Cye(this),o=wye(r)?void 0:Eye(r,i);return o?vye(o,r,n):new RegExp(r)[i](dT(n))},function(r){var n=xye(this),o=dT(r),l=t(e,n,o);if(l.done)return l.value;if(!n.global)return r6(n,o);var s=n.unicode;n.lastIndex=0;for(var g=[],b=0,T;(T=r6(n,o))!==null;){var F=dT(T[0]);g[b]=F,F===""&&(n.lastIndex=Sye(o,Bye(n.lastIndex),s)),b++}return b===0?null:g}]});var fT=$o,Tye=gb,Iye=Math.floor,pT=fT("".charAt),Lye=fT("".replace),gT=fT("".slice),Mye=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Pye=/\$([$&'`]|\d{1,2})/g,Fye=function(i,e,t,r,n,o){var l=t+i.length,s=r.length,g=Pye;return n!==void 0&&(n=Tye(n),g=Mye),Lye(o,g,function(b,T){var F;switch(pT(T,0)){case"$":return"$";case"&":return i;case"`":return gT(e,0,t);case"'":return gT(e,l);case"<":F=n[gT(T,1,-1)];break;default:var k=+T;if(k===0)return b;if(k>s){var z=Iye(k/10);return z===0?b:z<=s?r[z-1]===void 0?pT(T,1):r[z-1]+pT(T,1):b}F=r[k-1]}return F===void 0?"":F})},Dye=BS,n6=ll,jb=$o,Rye=cT,kye=qo,Oye=kl,Uye=Co,Nye=Nf,zye=Cb,Qye=Xg,nm=rA,Vye=eA,Hye=hT,Gye=$g,jye=Fye,qye=AT,$ye=qa,mT=$ye("replace"),Kye=Math.max,Wye=Math.min,Xye=jb([].concat),yT=jb([].push),s6=jb("".indexOf),o6=jb("".slice),Zye=function(i){return i===void 0?i:String(i)},Jye=function(){return"a".replace(/./,"$0")==="$0"}(),a6=function(){return/./[mT]?/./[mT]("a","$0")==="":!1}(),Yye=!kye(function(){var i=/./;return i.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(i,"$<a>")!=="7"});Rye("replace",function(i,e,t){var r=a6?"$":"$0";return[function(n,o){var l=Vye(this),s=Nye(n)?void 0:Gye(n,mT);return s?n6(s,n,l,o):n6(e,nm(l),n,o)},function(n,o){var l=Oye(this),s=nm(n);if(typeof o=="string"&&s6(o,r)===-1&&s6(o,"$<")===-1){var g=t(e,l,s,o);if(g.done)return g.value}var b=Uye(o);b||(o=nm(o));var T=l.global;if(T){var F=l.unicode;l.lastIndex=0}for(var k=[];;){var z=qye(l,s);if(z===null||(yT(k,z),!T))break;var J=nm(z[0]);J===""&&(l.lastIndex=Hye(s,Qye(l.lastIndex),F))}for(var te="",ue=0,ce=0;ce<k.length;ce++){z=k[ce];for(var de=nm(z[0]),_e=Kye(Wye(zye(z.index),s.length),0),Ee=[],He=1;He<z.length;He++)yT(Ee,Zye(z[He]));var Ve=z.groups;if(b){var qe=Xye([de],Ee,_e,s);Ve!==void 0&&yT(qe,Ve);var Ue=nm(Dye(o,void 0,qe))}else Ue=jye(de,s,_e,Ee,Ve,o);_e>=ue&&(te+=o6(s,ue,_e)+Ue,ue=_e+de.length)}return te+o6(s,ue)}]},!Yye||!Jye||a6);var e0e=kA,t0e=Uf,i0e=qa,r0e=i0e("match"),l6=function(i){var e;return e0e(i)&&((e=i[r0e])!==void 0?!!e:t0e(i)=="RegExp")},n0e=l6,s0e=TypeError,_T=function(i){if(n0e(i))throw s0e("The method doesn't accept regular expressions");return i},o0e=qa,a0e=o0e("match"),vT=function(i){var e=/./;try{"/./"[i](e)}catch{try{return e[a0e]=!1,"/./"[i](e)}catch{}}return!1},l0e=Ac,c6=m0,c0e=qg.f,u0e=Xg,u6=rA,h0e=_T,A0e=eA,d0e=vT,h6=c6("".startsWith),f0e=c6("".slice),p0e=Math.min,A6=d0e("startsWith"),g0e=!A6&&!!function(){var i=c0e(String.prototype,"startsWith");return i&&!i.writable}();l0e({target:"String",proto:!0,forced:!g0e&&!A6},{startsWith:function(i){var e=u6(A0e(this));h0e(i);var t=u0e(p0e(arguments.length>1?arguments[1]:void 0,e.length)),r=u6(i);return h6?h6(e,r,t):f0e(e,t,t+r.length)===r}});var m0e=qa,y0e=rT,_0e=tA.f,bT=m0e("unscopables"),xT=Array.prototype;xT[bT]==null&&_0e(xT,bT,{configurable:!0,value:y0e(null)});var v0e=function(i){xT[bT][i]=!0},b0e=qo,x0e=!b0e(function(){function i(){}return i.prototype.constructor=null,Object.getPrototypeOf(new i)!==i.prototype}),w0e=mh,B0e=Co,C0e=gb,E0e=hS,S0e=x0e,d6=E0e("IE_PROTO"),wT=Object,T0e=wT.prototype,f6=S0e?wT.getPrototypeOf:function(i){var e=C0e(i);if(w0e(e,d6))return e[d6];var t=e.constructor;return B0e(t)&&e instanceof t?t.prototype:e instanceof wT?T0e:null},I0e=qo,L0e=Co,M0e=kA,p6=f6,P0e=Qf,F0e=qa,BT=F0e("iterator"),g6=!1,jf,CT,ET;[].keys&&(ET=[].keys(),"next"in ET?(CT=p6(p6(ET)),CT!==Object.prototype&&(jf=CT)):g6=!0);var D0e=!M0e(jf)||I0e(function(){var i={};return jf[BT].call(i)!==i});D0e&&(jf={}),L0e(jf[BT])||P0e(jf,BT,function(){return this});var m6={IteratorPrototype:jf,BUGGY_SAFARI_ITERATORS:g6},R0e=m6.IteratorPrototype,k0e=rT,O0e=hb,U0e=bS,N0e=x0,z0e=function(){return this},Q0e=function(i,e,t,r){var n=e+" Iterator";return i.prototype=k0e(R0e,{next:O0e(+!r,t)}),U0e(i,n,!1),N0e[n]=z0e,i},V0e=Ac,H0e=ll,y6=_b,G0e=Co,j0e=Q0e,_6=f6,v6=BO,q0e=bS,$0e=A0,ST=Qf,K0e=qa,W0e=x0,b6=m6,X0e=y6.PROPER,Z0e=y6.CONFIGURABLE,x6=b6.IteratorPrototype,qb=b6.BUGGY_SAFARI_ITERATORS,w0=K0e("iterator"),w6="keys",B0="values",B6="entries",J0e=function(){return this},Y0e=function(i,e,t,r,n,o,l){j0e(t,e,r);var s=function(ce){if(ce===n&&k)return k;if(!qb&&ce in T)return T[ce];switch(ce){case w6:return function(){return new t(this,ce)};case B0:return function(){return new t(this,ce)};case B6:return function(){return new t(this,ce)}}return function(){return new t(this)}},g=e+" Iterator",b=!1,T=i.prototype,F=T[w0]||T["@@iterator"]||n&&T[n],k=!qb&&F||s(n),z=e=="Array"&&T.entries||F,J,te,ue;if(z&&(J=_6(z.call(new i)),J!==Object.prototype&&J.next&&(_6(J)!==x6&&(v6?v6(J,x6):G0e(J[w0])||ST(J,w0,J0e)),q0e(J,g,!0))),X0e&&n==B0&&F&&F.name!==B0&&(Z0e?$0e(T,"name",B0):(b=!0,k=function(){return H0e(F,this)})),n)if(te={values:s(B0),keys:o?k:s(w6),entries:s(B6)},l)for(ue in te)(qb||b||!(ue in T))&&ST(T,ue,te[ue]);else V0e({target:e,proto:!0,forced:qb||b},te);return T[w0]!==k&&ST(T,w0,k,{name:n}),W0e[e]=k,te},e_e=function(i,e){return{value:i,done:e}},t_e=h0,TT=v0e,C6=x0,E6=xb,i_e=tA.f,r_e=Y0e,$b=e_e,n_e=Yh,S6="Array Iterator",s_e=E6.set,o_e=E6.getterFor(S6),a_e=r_e(Array,"Array",function(i,e){s_e(this,{type:S6,target:t_e(i),index:0,kind:e})},function(){var i=o_e(this),e=i.target,t=i.kind,r=i.index++;return!e||r>=e.length?(i.target=void 0,$b(void 0,!0)):t=="keys"?$b(r,!1):t=="values"?$b(e[r],!1):$b([r,e[r]],!1)},"values"),T6=C6.Arguments=C6.Array;if(TT("keys"),TT("values"),TT("entries"),n_e&&T6.name!=="values")try{i_e(T6,"name",{value:"values"})}catch{}var l_e={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},c_e=mb,IT=c_e("span").classList,I6=IT&&IT.constructor&&IT.constructor.prototype,u_e=I6===Object.prototype?void 0:I6,L6=Ca,M6=l_e,h_e=u_e,C0=a_e,LT=A0,P6=qa,MT=P6("iterator"),F6=P6("toStringTag"),PT=C0.values,D6=function(i,e){if(i){if(i[MT]!==PT)try{LT(i,MT,PT)}catch{i[MT]=PT}if(i[F6]||LT(i,F6,e),M6[e]){for(var t in C0)if(i[t]!==C0[t])try{LT(i,t,C0[t])}catch{i[t]=C0[t]}}}};for(var FT in M6)D6(L6[FT]&&L6[FT].prototype,FT);D6(h_e,"DOMTokenList");function A_e(i,e){if(Jn(i)!=="object"||i===null)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var r=t.call(i,e||"default");if(Jn(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function d_e(i){var e=A_e(i,"string");return Jn(e)==="symbol"?e:String(e)}function DT(i,e,t){return e=d_e(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}var f_e=OA,p_e=gb,g_e=Fk,m_e=Eb,y_e=TypeError,R6=function(i){return function(e,t,r,n){f_e(t);var o=p_e(e),l=g_e(o),s=m_e(o),g=i?s-1:0,b=i?-1:1;if(r<2)for(;;){if(g in l){n=l[g],g+=b;break}if(g+=b,i?g<0:s<=g)throw y_e("Reduce of empty array with no initial value")}for(;i?g>=0:s>g;g+=b)g in l&&(n=t(n,l[g],g,o));return n}},__e={left:R6(!1),right:R6(!0)},v_e=qo,k6=function(i,e){var t=[][i];return!!t&&v_e(function(){t.call(null,e||function(){return 1},1)})},b_e=Ac,x_e=__e.left,w_e=k6,O6=$E,B_e=p0,C_e=!B_e&&O6>79&&O6<83,E_e=C_e||!w_e("reduce");b_e({target:"Array",proto:!0,forced:E_e},{reduce:function(i){var e=arguments.length;return x_e(this,i,e,e>1?arguments[1]:void 0)}});var S_e=Ac,U6=m0,T_e=qg.f,I_e=Xg,N6=rA,L_e=_T,M_e=eA,P_e=vT,z6=U6("".endsWith),F_e=U6("".slice),D_e=Math.min,Q6=P_e("endsWith"),R_e=!Q6&&!!function(){var i=T_e(String.prototype,"endsWith");return i&&!i.writable}();S_e({target:"String",proto:!0,forced:!R_e&&!Q6},{endsWith:function(i){var e=N6(M_e(this));L_e(i);var t=arguments.length>1?arguments[1]:void 0,r=e.length,n=t===void 0?r:D_e(I_e(t),r),o=N6(i);return z6?z6(e,o,n):F_e(e,n-o.length,n)===o}});var k_e=tS,O_e=tA,U_e=hb,N_e=function(i,e,t){var r=k_e(e);r in i?O_e.f(i,r,U_e(0,t)):i[r]=t},V6=gO,z_e=Eb,Q_e=N_e,V_e=Array,H_e=Math.max,G_e=function(i,e,t){for(var r=z_e(i),n=V6(e,r),o=V6(t===void 0?r:t,r),l=V_e(H_e(o-n,0)),s=0;n<o;n++,s++)Q_e(l,s,i[n]);return l.length=s,l},j_e=BS,E0=ll,RT=$o,q_e=cT,$_e=kl,K_e=Nf,W_e=l6,H6=eA,X_e=DO,Z_e=hT,J_e=Xg,kT=rA,Y_e=$g,G6=G_e,j6=AT,e1e=Gb,t1e=zU,i1e=qo,sm=t1e.UNSUPPORTED_Y,q6=4294967295,r1e=Math.min,$6=[].push,n1e=RT(/./.exec),om=RT($6),S0=RT("".slice),s1e=!i1e(function(){var i=/(?:)/,e=i.exec;i.exec=function(){return e.apply(this,arguments)};var t="ab".split(i);return t.length!==2||t[0]!=="a"||t[1]!=="b"});q_e("split",function(i,e,t){var r;return"abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?r=function(n,o){var l=kT(H6(this)),s=o===void 0?q6:o>>>0;if(s===0)return[];if(n===void 0)return[l];if(!W_e(n))return E0(e,l,n,s);for(var g=[],b=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(n.sticky?"y":""),T=0,F=new RegExp(n.source,b+"g"),k,z,J;(k=E0(e1e,F,l))&&(z=F.lastIndex,!(z>T&&(om(g,S0(l,T,k.index)),k.length>1&&k.index<l.length&&j_e($6,g,G6(k,1)),J=k[0].length,T=z,g.length>=s)));)F.lastIndex===k.index&&F.lastIndex++;return T===l.length?(J||!n1e(F,""))&&om(g,""):om(g,S0(l,T)),g.length>s?G6(g,0,s):g}:"0".split(void 0,0).length?r=function(n,o){return n===void 0&&o===0?[]:E0(e,this,n,o)}:r=e,[function(n,o){var l=H6(this),s=K_e(n)?void 0:Y_e(n,i);return s?E0(s,n,l,o):E0(r,kT(l),n,o)},function(n,o){var l=$_e(this),s=kT(n),g=t(r,l,s,o,r!==e);if(g.done)return g.value;var b=X_e(l,RegExp),T=l.unicode,F=(l.ignoreCase?"i":"")+(l.multiline?"m":"")+(l.unicode?"u":"")+(sm?"g":"y"),k=new b(sm?"^(?:"+l.source+")":l,F),z=o===void 0?q6:o>>>0;if(z===0)return[];if(s.length===0)return j6(k,s)===null?[s]:[];for(var J=0,te=0,ue=[];te<s.length;){k.lastIndex=sm?0:te;var ce=j6(k,sm?S0(s,te):s),de;if(ce===null||(de=r1e(J_e(k.lastIndex+(sm?te:0)),s.length))===J)te=Z_e(s,te,T);else{if(om(ue,S0(s,J,te)),ue.length===z)return ue;for(var _e=1;_e<=ce.length-1;_e++)if(om(ue,ce[_e]),ue.length===z)return ue;te=J=de}}return om(ue,S0(s,J)),ue}]},!s1e,sm);var Kb={exports:{}},T0={exports:{}};(function(){var i,e,t,r,n,o;typeof performance<"u"&&performance!==null&&performance.now?T0.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(T0.exports=function(){return(i()-n)/1e6},e=process.hrtime,i=function(){var l;return l=e(),l[0]*1e9+l[1]},r=i(),o=process.uptime()*1e9,n=r-o):Date.now?(T0.exports=function(){return Date.now()-t},t=Date.now()):(T0.exports=function(){return new Date().getTime()-t},t=new Date().getTime())}).call(u0);for(var o1e=T0.exports,a1e=o1e,NA=typeof window>"u"?u0:window,Wb=["moz","webkit"],am="AnimationFrame",lm=NA["request"+am],I0=NA["cancel"+am]||NA["cancelRequest"+am],L0=0;!lm&&L0<Wb.length;L0++)lm=NA[Wb[L0]+"Request"+am],I0=NA[Wb[L0]+"Cancel"+am]||NA[Wb[L0]+"CancelRequest"+am];if(!lm||!I0){var OT=0,K6=0,qf=[],l1e=1e3/60;lm=function(i){if(qf.length===0){var e=a1e(),t=Math.max(0,l1e-(e-OT));OT=t+e,setTimeout(function(){var r=qf.slice(0);qf.length=0;for(var n=0;n<r.length;n++)if(!r[n].cancelled)try{r[n].callback(OT)}catch(o){setTimeout(function(){throw o},0)}},Math.round(t))}return qf.push({handle:++K6,callback:i,cancelled:!1}),K6},I0=function(i){for(var e=0;e<qf.length;e++)qf[e].handle===i&&(qf[e].cancelled=!0)}}Kb.exports=function(i){return lm.call(NA,i)},Kb.exports.cancel=function(){I0.apply(NA,arguments)},Kb.exports.polyfill=function(i){i||(i=NA),i.requestAnimationFrame=lm,i.cancelAnimationFrame=I0};var c1e=Kb.exports;const UT=Ek(c1e);var W6=`	
\v\f\r \u2028\u2029\uFEFF`,u1e=$o,h1e=eA,A1e=rA,NT=W6,X6=u1e("".replace),d1e=RegExp("^["+NT+"]+"),f1e=RegExp("(^|[^"+NT+"])["+NT+"]+$"),zT=function(i){return function(e){var t=A1e(h1e(e));return i&1&&(t=X6(t,d1e,"")),i&2&&(t=X6(t,f1e,"$1")),t}},p1e={start:zT(1),end:zT(2),trim:zT(3)},g1e=_b.PROPER,m1e=qo,Z6=W6,J6="",y1e=function(i){return m1e(function(){return!!Z6[i]()||J6[i]()!==J6||g1e&&Z6[i].name!==i})},_1e=Ac,v1e=p1e.trim,b1e=y1e;_1e({target:"String",proto:!0,forced:b1e("trim")},{trim:function(){return v1e(this)}});var x1e=function(i){this.ok=!1,this.alpha=1,i.charAt(0)=="#"&&(i=i.substr(1,6)),i=i.replace(/ /g,""),i=i.toLowerCase();var e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};i=e[i]||i;for(var t=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(g){return[parseInt(g[1]),parseInt(g[2]),parseInt(g[3]),parseFloat(g[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(g){return[parseInt(g[1]),parseInt(g[2]),parseInt(g[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(g){return[parseInt(g[1],16),parseInt(g[2],16),parseInt(g[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(g){return[parseInt(g[1]+g[1],16),parseInt(g[2]+g[2],16),parseInt(g[3]+g[3],16)]}}],r=0;r<t.length;r++){var n=t[r].re,o=t[r].process,l=n.exec(i);if(l){var s=o(l);this.r=s[0],this.g=s[1],this.b=s[2],s.length>3&&(this.alpha=s[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var g=this.r.toString(16),b=this.g.toString(16),T=this.b.toString(16);return g.length==1&&(g="0"+g),b.length==1&&(b="0"+b),T.length==1&&(T="0"+T),"#"+g+b+T},this.getHelpXML=function(){for(var g=new Array,b=0;b<t.length;b++)for(var T=t[b].example,F=0;F<T.length;F++)g[g.length]=T[F];for(var k in e)g[g.length]=k;var z=document.createElement("ul");z.setAttribute("id","rgbcolor-examples");for(var b=0;b<g.length;b++)try{var J=document.createElement("li"),te=new RGBColor(g[b]),ue=document.createElement("div");ue.style.cssText="margin: 3px; border: 1px solid black; background:"+te.toHex()+"; color:"+te.toHex(),ue.appendChild(document.createTextNode("test"));var ce=document.createTextNode(" "+g[b]+" -> "+te.toRGB()+" -> "+te.toHex());J.appendChild(ue),J.appendChild(ce),z.appendChild(J)}catch{}return z}};const QT=Ek(x1e);var w1e=Ac,B1e=m0,C1e=yO.indexOf,E1e=k6,VT=B1e([].indexOf),Y6=!!VT&&1/VT([1],1,-0)<0,S1e=Y6||!E1e("indexOf");w1e({target:"Array",proto:!0,forced:S1e},{indexOf:function(i){var e=arguments.length>1?arguments[1]:void 0;return Y6?VT(this,i,e)||0:C1e(this,i,e)}});var T1e=Ac,I1e=$o,L1e=_T,M1e=eA,eN=rA,P1e=vT,F1e=I1e("".indexOf);T1e({target:"String",proto:!0,forced:!P1e("includes")},{includes:function(i){return!!~F1e(eN(M1e(this)),eN(L1e(i)),arguments.length>1?arguments[1]:void 0)}});var D1e=Uf,R1e=Array.isArray||function(i){return D1e(i)=="Array"},k1e=Ac,O1e=$o,U1e=R1e,N1e=O1e([].reverse),tN=[1,2];k1e({target:"Array",proto:!0,forced:String(tN)===String(tN.reverse())},{reverse:function(){return U1e(this)&&(this.length=this.length),N1e(this)}});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var iN=function(i,e){return(iN=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])})(i,e)};function rN(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=i}iN(i,e),i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function z1e(i){var e="";Array.isArray(i)||(i=[i]);for(var t=0;t<i.length;t++){var r=i[t];if(r.type===yi.CLOSE_PATH)e+="z";else if(r.type===yi.HORIZ_LINE_TO)e+=(r.relative?"h":"H")+r.x;else if(r.type===yi.VERT_LINE_TO)e+=(r.relative?"v":"V")+r.y;else if(r.type===yi.MOVE_TO)e+=(r.relative?"m":"M")+r.x+" "+r.y;else if(r.type===yi.LINE_TO)e+=(r.relative?"l":"L")+r.x+" "+r.y;else if(r.type===yi.CURVE_TO)e+=(r.relative?"c":"C")+r.x1+" "+r.y1+" "+r.x2+" "+r.y2+" "+r.x+" "+r.y;else if(r.type===yi.SMOOTH_CURVE_TO)e+=(r.relative?"s":"S")+r.x2+" "+r.y2+" "+r.x+" "+r.y;else if(r.type===yi.QUAD_TO)e+=(r.relative?"q":"Q")+r.x1+" "+r.y1+" "+r.x+" "+r.y;else if(r.type===yi.SMOOTH_QUAD_TO)e+=(r.relative?"t":"T")+r.x+" "+r.y;else{if(r.type!==yi.ARC)throw new Error('Unexpected command type "'+r.type+'" at index '+t+".");e+=(r.relative?"a":"A")+r.rX+" "+r.rY+" "+r.xRot+" "+ +r.lArcFlag+" "+ +r.sweepFlag+" "+r.x+" "+r.y}}return e}function HT(i,e){var t=i[0],r=i[1];return[t*Math.cos(e)-r*Math.sin(e),t*Math.sin(e)+r*Math.cos(e)]}function yh(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];for(var t=0;t<i.length;t++)if(typeof i[t]!="number")throw new Error("assertNumbers arguments["+t+"] is not a number. "+typeof i[t]+" == typeof "+i[t]);return!0}var Pd=Math.PI;function GT(i,e,t){i.lArcFlag=i.lArcFlag===0?0:1,i.sweepFlag=i.sweepFlag===0?0:1;var r=i.rX,n=i.rY,o=i.x,l=i.y;r=Math.abs(i.rX),n=Math.abs(i.rY);var s=HT([(e-o)/2,(t-l)/2],-i.xRot/180*Pd),g=s[0],b=s[1],T=Math.pow(g,2)/Math.pow(r,2)+Math.pow(b,2)/Math.pow(n,2);1<T&&(r*=Math.sqrt(T),n*=Math.sqrt(T)),i.rX=r,i.rY=n;var F=Math.pow(r,2)*Math.pow(b,2)+Math.pow(n,2)*Math.pow(g,2),k=(i.lArcFlag!==i.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(r,2)*Math.pow(n,2)-F)/F)),z=r*b/n*k,J=-n*g/r*k,te=HT([z,J],i.xRot/180*Pd);i.cX=te[0]+(e+o)/2,i.cY=te[1]+(t+l)/2,i.phi1=Math.atan2((b-J)/n,(g-z)/r),i.phi2=Math.atan2((-b-J)/n,(-g-z)/r),i.sweepFlag===0&&i.phi2>i.phi1&&(i.phi2-=2*Pd),i.sweepFlag===1&&i.phi2<i.phi1&&(i.phi2+=2*Pd),i.phi1*=180/Pd,i.phi2*=180/Pd}function nN(i,e,t){yh(i,e,t);var r=i*i+e*e-t*t;if(0>r)return[];if(r===0)return[[i*t/(i*i+e*e),e*t/(i*i+e*e)]];var n=Math.sqrt(r);return[[(i*t+e*n)/(i*i+e*e),(e*t-i*n)/(i*i+e*e)],[(i*t-e*n)/(i*i+e*e),(e*t+i*n)/(i*i+e*e)]]}var aa,zA=Math.PI/180;function sN(i,e,t){return(1-t)*i+t*e}function oN(i,e,t,r){return i+Math.cos(r/180*Pd)*e+Math.sin(r/180*Pd)*t}function aN(i,e,t,r){var n=1e-6,o=e-i,l=t-e,s=3*o+3*(r-t)-6*l,g=6*(l-o),b=3*o;return Math.abs(s)<n?[-b/g]:function(T,F,k){k===void 0&&(k=1e-6);var z=T*T/4-F;if(z<-k)return[];if(z<=k)return[-T/2];var J=Math.sqrt(z);return[-T/2-J,-T/2+J]}(g/s,b/s,n)}function lN(i,e,t,r,n){var o=1-n;return i*(o*o*o)+e*(3*o*o*n)+t*(3*o*n*n)+r*(n*n*n)}(function(i){function e(){return n(function(s,g,b){return s.relative&&(s.x1!==void 0&&(s.x1+=g),s.y1!==void 0&&(s.y1+=b),s.x2!==void 0&&(s.x2+=g),s.y2!==void 0&&(s.y2+=b),s.x!==void 0&&(s.x+=g),s.y!==void 0&&(s.y+=b),s.relative=!1),s})}function t(){var s=NaN,g=NaN,b=NaN,T=NaN;return n(function(F,k,z){return F.type&yi.SMOOTH_CURVE_TO&&(F.type=yi.CURVE_TO,s=isNaN(s)?k:s,g=isNaN(g)?z:g,F.x1=F.relative?k-s:2*k-s,F.y1=F.relative?z-g:2*z-g),F.type&yi.CURVE_TO?(s=F.relative?k+F.x2:F.x2,g=F.relative?z+F.y2:F.y2):(s=NaN,g=NaN),F.type&yi.SMOOTH_QUAD_TO&&(F.type=yi.QUAD_TO,b=isNaN(b)?k:b,T=isNaN(T)?z:T,F.x1=F.relative?k-b:2*k-b,F.y1=F.relative?z-T:2*z-T),F.type&yi.QUAD_TO?(b=F.relative?k+F.x1:F.x1,T=F.relative?z+F.y1:F.y1):(b=NaN,T=NaN),F})}function r(){var s=NaN,g=NaN;return n(function(b,T,F){if(b.type&yi.SMOOTH_QUAD_TO&&(b.type=yi.QUAD_TO,s=isNaN(s)?T:s,g=isNaN(g)?F:g,b.x1=b.relative?T-s:2*T-s,b.y1=b.relative?F-g:2*F-g),b.type&yi.QUAD_TO){s=b.relative?T+b.x1:b.x1,g=b.relative?F+b.y1:b.y1;var k=b.x1,z=b.y1;b.type=yi.CURVE_TO,b.x1=((b.relative?0:T)+2*k)/3,b.y1=((b.relative?0:F)+2*z)/3,b.x2=(b.x+2*k)/3,b.y2=(b.y+2*z)/3}else s=NaN,g=NaN;return b})}function n(s){var g=0,b=0,T=NaN,F=NaN;return function(k){if(isNaN(T)&&!(k.type&yi.MOVE_TO))throw new Error("path must start with moveto");var z=s(k,g,b,T,F);return k.type&yi.CLOSE_PATH&&(g=T,b=F),k.x!==void 0&&(g=k.relative?g+k.x:k.x),k.y!==void 0&&(b=k.relative?b+k.y:k.y),k.type&yi.MOVE_TO&&(T=g,F=b),z}}function o(s,g,b,T,F,k){return yh(s,g,b,T,F,k),n(function(z,J,te,ue){var ce=z.x1,de=z.x2,_e=z.relative&&!isNaN(ue),Ee=z.x!==void 0?z.x:_e?0:J,He=z.y!==void 0?z.y:_e?0:te;function Ve(Se){return Se*Se}z.type&yi.HORIZ_LINE_TO&&g!==0&&(z.type=yi.LINE_TO,z.y=z.relative?0:te),z.type&yi.VERT_LINE_TO&&b!==0&&(z.type=yi.LINE_TO,z.x=z.relative?0:J),z.x!==void 0&&(z.x=z.x*s+He*b+(_e?0:F)),z.y!==void 0&&(z.y=Ee*g+z.y*T+(_e?0:k)),z.x1!==void 0&&(z.x1=z.x1*s+z.y1*b+(_e?0:F)),z.y1!==void 0&&(z.y1=ce*g+z.y1*T+(_e?0:k)),z.x2!==void 0&&(z.x2=z.x2*s+z.y2*b+(_e?0:F)),z.y2!==void 0&&(z.y2=de*g+z.y2*T+(_e?0:k));var qe=s*T-g*b;if(z.xRot!==void 0&&(s!==1||g!==0||b!==0||T!==1))if(qe===0)delete z.rX,delete z.rY,delete z.xRot,delete z.lArcFlag,delete z.sweepFlag,z.type=yi.LINE_TO;else{var Ue=z.xRot*Math.PI/180,ot=Math.sin(Ue),it=Math.cos(Ue),De=1/Ve(z.rX),Me=1/Ve(z.rY),Ze=Ve(it)*De+Ve(ot)*Me,We=2*ot*it*(De-Me),Bt=Ve(ot)*De+Ve(it)*Me,Ct=Ze*T*T-We*g*T+Bt*g*g,Lt=We*(s*T+g*b)-2*(Ze*b*T+Bt*s*g),_t=Ze*b*b-We*s*b+Bt*s*s,Ft=(Math.atan2(Lt,Ct-_t)+Math.PI)%Math.PI/2,Mt=Math.sin(Ft),Wt=Math.cos(Ft);z.rX=Math.abs(qe)/Math.sqrt(Ct*Ve(Wt)+Lt*Mt*Wt+_t*Ve(Mt)),z.rY=Math.abs(qe)/Math.sqrt(Ct*Ve(Mt)-Lt*Mt*Wt+_t*Ve(Wt)),z.xRot=180*Ft/Math.PI}return z.sweepFlag!==void 0&&0>qe&&(z.sweepFlag=+!z.sweepFlag),z})}function l(){return function(s){var g={};for(var b in s)g[b]=s[b];return g}}i.ROUND=function(s){function g(b){return Math.round(b*s)/s}return s===void 0&&(s=1e13),yh(s),function(b){return b.x1!==void 0&&(b.x1=g(b.x1)),b.y1!==void 0&&(b.y1=g(b.y1)),b.x2!==void 0&&(b.x2=g(b.x2)),b.y2!==void 0&&(b.y2=g(b.y2)),b.x!==void 0&&(b.x=g(b.x)),b.y!==void 0&&(b.y=g(b.y)),b.rX!==void 0&&(b.rX=g(b.rX)),b.rY!==void 0&&(b.rY=g(b.rY)),b}},i.TO_ABS=e,i.TO_REL=function(){return n(function(s,g,b){return s.relative||(s.x1!==void 0&&(s.x1-=g),s.y1!==void 0&&(s.y1-=b),s.x2!==void 0&&(s.x2-=g),s.y2!==void 0&&(s.y2-=b),s.x!==void 0&&(s.x-=g),s.y!==void 0&&(s.y-=b),s.relative=!0),s})},i.NORMALIZE_HVZ=function(s,g,b){return s===void 0&&(s=!0),g===void 0&&(g=!0),b===void 0&&(b=!0),n(function(T,F,k,z,J){if(isNaN(z)&&!(T.type&yi.MOVE_TO))throw new Error("path must start with moveto");return g&&T.type&yi.HORIZ_LINE_TO&&(T.type=yi.LINE_TO,T.y=T.relative?0:k),b&&T.type&yi.VERT_LINE_TO&&(T.type=yi.LINE_TO,T.x=T.relative?0:F),s&&T.type&yi.CLOSE_PATH&&(T.type=yi.LINE_TO,T.x=T.relative?z-F:z,T.y=T.relative?J-k:J),T.type&yi.ARC&&(T.rX===0||T.rY===0)&&(T.type=yi.LINE_TO,delete T.rX,delete T.rY,delete T.xRot,delete T.lArcFlag,delete T.sweepFlag),T})},i.NORMALIZE_ST=t,i.QT_TO_C=r,i.INFO=n,i.SANITIZE=function(s){s===void 0&&(s=0),yh(s);var g=NaN,b=NaN,T=NaN,F=NaN;return n(function(k,z,J,te,ue){var ce=Math.abs,de=!1,_e=0,Ee=0;if(k.type&yi.SMOOTH_CURVE_TO&&(_e=isNaN(g)?0:z-g,Ee=isNaN(b)?0:J-b),k.type&(yi.CURVE_TO|yi.SMOOTH_CURVE_TO)?(g=k.relative?z+k.x2:k.x2,b=k.relative?J+k.y2:k.y2):(g=NaN,b=NaN),k.type&yi.SMOOTH_QUAD_TO?(T=isNaN(T)?z:2*z-T,F=isNaN(F)?J:2*J-F):k.type&yi.QUAD_TO?(T=k.relative?z+k.x1:k.x1,F=k.relative?J+k.y1:k.y2):(T=NaN,F=NaN),k.type&yi.LINE_COMMANDS||k.type&yi.ARC&&(k.rX===0||k.rY===0||!k.lArcFlag)||k.type&yi.CURVE_TO||k.type&yi.SMOOTH_CURVE_TO||k.type&yi.QUAD_TO||k.type&yi.SMOOTH_QUAD_TO){var He=k.x===void 0?0:k.relative?k.x:k.x-z,Ve=k.y===void 0?0:k.relative?k.y:k.y-J;_e=isNaN(T)?k.x1===void 0?_e:k.relative?k.x:k.x1-z:T-z,Ee=isNaN(F)?k.y1===void 0?Ee:k.relative?k.y:k.y1-J:F-J;var qe=k.x2===void 0?0:k.relative?k.x:k.x2-z,Ue=k.y2===void 0?0:k.relative?k.y:k.y2-J;ce(He)<=s&&ce(Ve)<=s&&ce(_e)<=s&&ce(Ee)<=s&&ce(qe)<=s&&ce(Ue)<=s&&(de=!0)}return k.type&yi.CLOSE_PATH&&ce(z-te)<=s&&ce(J-ue)<=s&&(de=!0),de?[]:k})},i.MATRIX=o,i.ROTATE=function(s,g,b){g===void 0&&(g=0),b===void 0&&(b=0),yh(s,g,b);var T=Math.sin(s),F=Math.cos(s);return o(F,T,-T,F,g-g*F+b*T,b-g*T-b*F)},i.TRANSLATE=function(s,g){return g===void 0&&(g=0),yh(s,g),o(1,0,0,1,s,g)},i.SCALE=function(s,g){return g===void 0&&(g=s),yh(s,g),o(s,0,0,g,0,0)},i.SKEW_X=function(s){return yh(s),o(1,0,Math.atan(s),1,0,0)},i.SKEW_Y=function(s){return yh(s),o(1,Math.atan(s),0,1,0,0)},i.X_AXIS_SYMMETRY=function(s){return s===void 0&&(s=0),yh(s),o(-1,0,0,1,s,0)},i.Y_AXIS_SYMMETRY=function(s){return s===void 0&&(s=0),yh(s),o(1,0,0,-1,0,s)},i.A_TO_C=function(){return n(function(s,g,b){return yi.ARC===s.type?function(T,F,k){var z,J,te,ue;T.cX||GT(T,F,k);for(var ce=Math.min(T.phi1,T.phi2),de=Math.max(T.phi1,T.phi2)-ce,_e=Math.ceil(de/90),Ee=new Array(_e),He=F,Ve=k,qe=0;qe<_e;qe++){var Ue=sN(T.phi1,T.phi2,qe/_e),ot=sN(T.phi1,T.phi2,(qe+1)/_e),it=ot-Ue,De=4/3*Math.tan(it*zA/4),Me=[Math.cos(Ue*zA)-De*Math.sin(Ue*zA),Math.sin(Ue*zA)+De*Math.cos(Ue*zA)],Ze=Me[0],We=Me[1],Bt=[Math.cos(ot*zA),Math.sin(ot*zA)],Ct=Bt[0],Lt=Bt[1],_t=[Ct+De*Math.sin(ot*zA),Lt-De*Math.cos(ot*zA)],Ft=_t[0],Mt=_t[1];Ee[qe]={relative:T.relative,type:yi.CURVE_TO};var Wt=function(Se,Xe){var et=HT([Se*T.rX,Xe*T.rY],T.xRot),At=et[0],ft=et[1];return[T.cX+At,T.cY+ft]};z=Wt(Ze,We),Ee[qe].x1=z[0],Ee[qe].y1=z[1],J=Wt(Ft,Mt),Ee[qe].x2=J[0],Ee[qe].y2=J[1],te=Wt(Ct,Lt),Ee[qe].x=te[0],Ee[qe].y=te[1],T.relative&&(Ee[qe].x1-=He,Ee[qe].y1-=Ve,Ee[qe].x2-=He,Ee[qe].y2-=Ve,Ee[qe].x-=He,Ee[qe].y-=Ve),He=(ue=[Ee[qe].x,Ee[qe].y])[0],Ve=ue[1]}return Ee}(s,s.relative?0:g,s.relative?0:b):s})},i.ANNOTATE_ARCS=function(){return n(function(s,g,b){return s.relative&&(g=0,b=0),yi.ARC===s.type&&GT(s,g,b),s})},i.CLONE=l,i.CALCULATE_BOUNDS=function(){var s=function(k){var z={};for(var J in k)z[J]=k[J];return z},g=e(),b=r(),T=t(),F=n(function(k,z,J){var te=T(b(g(s(k))));function ue(Mt){Mt>F.maxX&&(F.maxX=Mt),Mt<F.minX&&(F.minX=Mt)}function ce(Mt){Mt>F.maxY&&(F.maxY=Mt),Mt<F.minY&&(F.minY=Mt)}if(te.type&yi.DRAWING_COMMANDS&&(ue(z),ce(J)),te.type&yi.HORIZ_LINE_TO&&ue(te.x),te.type&yi.VERT_LINE_TO&&ce(te.y),te.type&yi.LINE_TO&&(ue(te.x),ce(te.y)),te.type&yi.CURVE_TO){ue(te.x),ce(te.y);for(var de=0,_e=aN(z,te.x1,te.x2,te.x);de<_e.length;de++)0<(Ft=_e[de])&&1>Ft&&ue(lN(z,te.x1,te.x2,te.x,Ft));for(var Ee=0,He=aN(J,te.y1,te.y2,te.y);Ee<He.length;Ee++)0<(Ft=He[Ee])&&1>Ft&&ce(lN(J,te.y1,te.y2,te.y,Ft))}if(te.type&yi.ARC){ue(te.x),ce(te.y),GT(te,z,J);for(var Ve=te.xRot/180*Math.PI,qe=Math.cos(Ve)*te.rX,Ue=Math.sin(Ve)*te.rX,ot=-Math.sin(Ve)*te.rY,it=Math.cos(Ve)*te.rY,De=te.phi1<te.phi2?[te.phi1,te.phi2]:-180>te.phi2?[te.phi2+360,te.phi1+360]:[te.phi2,te.phi1],Me=De[0],Ze=De[1],We=function(Mt){var Wt=Mt[0],Se=Mt[1],Xe=180*Math.atan2(Se,Wt)/Math.PI;return Xe<Me?Xe+360:Xe},Bt=0,Ct=nN(ot,-qe,0).map(We);Bt<Ct.length;Bt++)(Ft=Ct[Bt])>Me&&Ft<Ze&&ue(oN(te.cX,qe,ot,Ft));for(var Lt=0,_t=nN(it,-Ue,0).map(We);Lt<_t.length;Lt++){var Ft;(Ft=_t[Lt])>Me&&Ft<Ze&&ce(oN(te.cY,Ue,it,Ft))}}return k});return F.minX=1/0,F.maxX=-1/0,F.minY=1/0,F.maxY=-1/0,F}})(aa||(aa={}));var _h,cN=function(){function i(){}return i.prototype.round=function(e){return this.transform(aa.ROUND(e))},i.prototype.toAbs=function(){return this.transform(aa.TO_ABS())},i.prototype.toRel=function(){return this.transform(aa.TO_REL())},i.prototype.normalizeHVZ=function(e,t,r){return this.transform(aa.NORMALIZE_HVZ(e,t,r))},i.prototype.normalizeST=function(){return this.transform(aa.NORMALIZE_ST())},i.prototype.qtToC=function(){return this.transform(aa.QT_TO_C())},i.prototype.aToC=function(){return this.transform(aa.A_TO_C())},i.prototype.sanitize=function(e){return this.transform(aa.SANITIZE(e))},i.prototype.translate=function(e,t){return this.transform(aa.TRANSLATE(e,t))},i.prototype.scale=function(e,t){return this.transform(aa.SCALE(e,t))},i.prototype.rotate=function(e,t,r){return this.transform(aa.ROTATE(e,t,r))},i.prototype.matrix=function(e,t,r,n,o,l){return this.transform(aa.MATRIX(e,t,r,n,o,l))},i.prototype.skewX=function(e){return this.transform(aa.SKEW_X(e))},i.prototype.skewY=function(e){return this.transform(aa.SKEW_Y(e))},i.prototype.xSymmetry=function(e){return this.transform(aa.X_AXIS_SYMMETRY(e))},i.prototype.ySymmetry=function(e){return this.transform(aa.Y_AXIS_SYMMETRY(e))},i.prototype.annotateArcs=function(){return this.transform(aa.ANNOTATE_ARCS())},i}(),Q1e=function(i){return i===" "||i==="	"||i==="\r"||i===`
`},uN=function(i){return 48<=i.charCodeAt(0)&&i.charCodeAt(0)<=57},V1e=function(i){function e(){var t=i.call(this)||this;return t.curNumber="",t.curCommandType=-1,t.curCommandRelative=!1,t.canParseCommandOrComma=!0,t.curNumberHasExp=!1,t.curNumberHasExpDigits=!1,t.curNumberHasDecimal=!1,t.curArgs=[],t}return rN(e,i),e.prototype.finish=function(t){if(t===void 0&&(t=[]),this.parse(" ",t),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return t},e.prototype.parse=function(t,r){var n=this;r===void 0&&(r=[]);for(var o=function(F){r.push(F),n.curArgs.length=0,n.canParseCommandOrComma=!0},l=0;l<t.length;l++){var s=t[l],g=!(this.curCommandType!==yi.ARC||this.curArgs.length!==3&&this.curArgs.length!==4||this.curNumber.length!==1||this.curNumber!=="0"&&this.curNumber!=="1"),b=uN(s)&&(this.curNumber==="0"&&s==="0"||g);if(!uN(s)||b)if(s!=="e"&&s!=="E")if(s!=="-"&&s!=="+"||!this.curNumberHasExp||this.curNumberHasExpDigits)if(s!=="."||this.curNumberHasExp||this.curNumberHasDecimal||g){if(this.curNumber&&this.curCommandType!==-1){var T=Number(this.curNumber);if(isNaN(T))throw new SyntaxError("Invalid number ending at "+l);if(this.curCommandType===yi.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>T)throw new SyntaxError('Expected positive number, got "'+T+'" at index "'+l+'"')}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+l+'"')}this.curArgs.push(T),this.curArgs.length===H1e[this.curCommandType]&&(yi.HORIZ_LINE_TO===this.curCommandType?o({type:yi.HORIZ_LINE_TO,relative:this.curCommandRelative,x:T}):yi.VERT_LINE_TO===this.curCommandType?o({type:yi.VERT_LINE_TO,relative:this.curCommandRelative,y:T}):this.curCommandType===yi.MOVE_TO||this.curCommandType===yi.LINE_TO||this.curCommandType===yi.SMOOTH_QUAD_TO?(o({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),yi.MOVE_TO===this.curCommandType&&(this.curCommandType=yi.LINE_TO)):this.curCommandType===yi.CURVE_TO?o({type:yi.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===yi.SMOOTH_CURVE_TO?o({type:yi.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===yi.QUAD_TO?o({type:yi.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===yi.ARC&&o({type:yi.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!Q1e(s))if(s===","&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if(s!=="+"&&s!=="-"&&s!==".")if(b)this.curNumber=s,this.curNumberHasDecimal=!1;else{if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index "+l+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+s+'" at index '+l+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,s!=="z"&&s!=="Z")if(s==="h"||s==="H")this.curCommandType=yi.HORIZ_LINE_TO,this.curCommandRelative=s==="h";else if(s==="v"||s==="V")this.curCommandType=yi.VERT_LINE_TO,this.curCommandRelative=s==="v";else if(s==="m"||s==="M")this.curCommandType=yi.MOVE_TO,this.curCommandRelative=s==="m";else if(s==="l"||s==="L")this.curCommandType=yi.LINE_TO,this.curCommandRelative=s==="l";else if(s==="c"||s==="C")this.curCommandType=yi.CURVE_TO,this.curCommandRelative=s==="c";else if(s==="s"||s==="S")this.curCommandType=yi.SMOOTH_CURVE_TO,this.curCommandRelative=s==="s";else if(s==="q"||s==="Q")this.curCommandType=yi.QUAD_TO,this.curCommandRelative=s==="q";else if(s==="t"||s==="T")this.curCommandType=yi.SMOOTH_QUAD_TO,this.curCommandRelative=s==="t";else{if(s!=="a"&&s!=="A")throw new SyntaxError('Unexpected character "'+s+'" at index '+l+".");this.curCommandType=yi.ARC,this.curCommandRelative=s==="a"}else r.push({type:yi.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=s,this.curNumberHasDecimal=s==="."}else this.curNumber+=s,this.curNumberHasDecimal=!0;else this.curNumber+=s;else this.curNumber+=s,this.curNumberHasExp=!0;else this.curNumber+=s,this.curNumberHasExpDigits=this.curNumberHasExp}return r},e.prototype.transform=function(t){return Object.create(this,{parse:{value:function(r,n){n===void 0&&(n=[]);for(var o=0,l=Object.getPrototypeOf(this).parse.call(this,r);o<l.length;o++){var s=l[o],g=t(s);Array.isArray(g)?n.push.apply(n,g):n.push(g)}return n}}})},e}(cN),yi=function(i){function e(t){var r=i.call(this)||this;return r.commands=typeof t=="string"?e.parse(t):t,r}return rN(e,i),e.prototype.encode=function(){return e.encode(this.commands)},e.prototype.getBounds=function(){var t=aa.CALCULATE_BOUNDS();return this.transform(t),t},e.prototype.transform=function(t){for(var r=[],n=0,o=this.commands;n<o.length;n++){var l=t(o[n]);Array.isArray(l)?r.push.apply(r,l):r.push(l)}return this.commands=r,this},e.encode=function(t){return z1e(t)},e.parse=function(t){var r=new V1e,n=[];return r.parse(t,n),r.finish(n),n},e.CLOSE_PATH=1,e.MOVE_TO=2,e.HORIZ_LINE_TO=4,e.VERT_LINE_TO=8,e.LINE_TO=16,e.CURVE_TO=32,e.SMOOTH_CURVE_TO=64,e.QUAD_TO=128,e.SMOOTH_QUAD_TO=256,e.ARC=512,e.LINE_COMMANDS=e.LINE_TO|e.HORIZ_LINE_TO|e.VERT_LINE_TO,e.DRAWING_COMMANDS=e.HORIZ_LINE_TO|e.VERT_LINE_TO|e.LINE_TO|e.CURVE_TO|e.SMOOTH_CURVE_TO|e.QUAD_TO|e.SMOOTH_QUAD_TO|e.ARC,e}(cN),H1e=((_h={})[yi.MOVE_TO]=2,_h[yi.LINE_TO]=2,_h[yi.HORIZ_LINE_TO]=1,_h[yi.VERT_LINE_TO]=1,_h[yi.CLOSE_PATH]=0,_h[yi.QUAD_TO]=4,_h[yi.SMOOTH_QUAD_TO]=2,_h[yi.CURVE_TO]=6,_h[yi.SMOOTH_CURVE_TO]=4,_h[yi.ARC]=7,_h),G1e=ll,j1e=mh,q1e=Ab,$1e=NU,hN=RegExp.prototype,K1e=function(i){var e=i.flags;return e===void 0&&!("flags"in hN)&&!j1e(i,"flags")&&q1e(hN,i)?G1e($1e,i):e},W1e=_b.PROPER,X1e=Qf,Z1e=kl,AN=rA,J1e=qo,Y1e=K1e,jT="toString",eve=RegExp.prototype,dN=eve[jT],tve=J1e(function(){return dN.call({source:"a",flags:"b"})!="/a/b"}),ive=W1e&&dN.name!=jT;(tve||ive)&&X1e(RegExp.prototype,jT,function(){var i=Z1e(this),e=AN(i.source),t=AN(Y1e(i));return"/"+e+"/"+t},{unsafe:!0});function Xb(i){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Xb=function(e){return typeof e}:Xb=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xb(i)}function rve(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}var nve=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],sve=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function ove(i,e,t,r,n){if(typeof i=="string"&&(i=document.getElementById(i)),!i||Xb(i)!=="object"||!("getContext"in i))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var o=i.getContext("2d");try{return o.getImageData(e,t,r,n)}catch(l){throw new Error("unable to access image data: "+l)}}function ave(i,e,t,r,n,o){if(!(isNaN(o)||o<1)){o|=0;var l=ove(i,e,t,r,n);l=lve(l,e,t,r,n,o),i.getContext("2d").putImageData(l,e,t)}}function lve(i,e,t,r,n,o){for(var l=i.data,s=2*o+1,g=r-1,b=n-1,T=o+1,F=T*(T+1)/2,k=new fN,z=k,J,te=1;te<s;te++)z=z.next=new fN,te===T&&(J=z);z.next=k;for(var ue=null,ce=null,de=0,_e=0,Ee=nve[o],He=sve[o],Ve=0;Ve<n;Ve++){z=k;for(var qe=l[_e],Ue=l[_e+1],ot=l[_e+2],it=l[_e+3],De=0;De<T;De++)z.r=qe,z.g=Ue,z.b=ot,z.a=it,z=z.next;for(var Me=0,Ze=0,We=0,Bt=0,Ct=T*qe,Lt=T*Ue,_t=T*ot,Ft=T*it,Mt=F*qe,Wt=F*Ue,Se=F*ot,Xe=F*it,et=1;et<T;et++){var At=_e+((g<et?g:et)<<2),ft=l[At],wt=l[At+1],Pt=l[At+2],It=l[At+3],Ht=T-et;Mt+=(z.r=ft)*Ht,Wt+=(z.g=wt)*Ht,Se+=(z.b=Pt)*Ht,Xe+=(z.a=It)*Ht,Me+=ft,Ze+=wt,We+=Pt,Bt+=It,z=z.next}ue=k,ce=J;for(var ii=0;ii<r;ii++){var gi=Xe*Ee>>He;if(l[_e+3]=gi,gi!==0){var mi=255/gi;l[_e]=(Mt*Ee>>He)*mi,l[_e+1]=(Wt*Ee>>He)*mi,l[_e+2]=(Se*Ee>>He)*mi}else l[_e]=l[_e+1]=l[_e+2]=0;Mt-=Ct,Wt-=Lt,Se-=_t,Xe-=Ft,Ct-=ue.r,Lt-=ue.g,_t-=ue.b,Ft-=ue.a;var Mi=ii+o+1;Mi=de+(Mi<g?Mi:g)<<2,Me+=ue.r=l[Mi],Ze+=ue.g=l[Mi+1],We+=ue.b=l[Mi+2],Bt+=ue.a=l[Mi+3],Mt+=Me,Wt+=Ze,Se+=We,Xe+=Bt,ue=ue.next;var kt=ce,at=kt.r,xt=kt.g,Ri=kt.b,ei=kt.a;Ct+=at,Lt+=xt,_t+=Ri,Ft+=ei,Me-=at,Ze-=xt,We-=Ri,Bt-=ei,ce=ce.next,_e+=4}de+=r}for(var ut=0;ut<r;ut++){_e=ut<<2;var jt=l[_e],ni=l[_e+1],di=l[_e+2],li=l[_e+3],Ki=T*jt,tr=T*ni,Ar=T*di,Er=T*li,Nt=F*jt,Ji=F*ni,ci=F*di,$t=F*li;z=k;for(var Zi=0;Zi<T;Zi++)z.r=jt,z.g=ni,z.b=di,z.a=li,z=z.next;for(var Qt=r,Bi=0,Ii=0,Gt=0,vi=0,Jt=1;Jt<=o;Jt++){_e=Qt+ut<<2;var mr=T-Jt;Nt+=(z.r=jt=l[_e])*mr,Ji+=(z.g=ni=l[_e+1])*mr,ci+=(z.b=di=l[_e+2])*mr,$t+=(z.a=li=l[_e+3])*mr,vi+=jt,Bi+=ni,Ii+=di,Gt+=li,z=z.next,Jt<b&&(Qt+=r)}_e=ut,ue=k,ce=J;for(var Sr=0;Sr<n;Sr++){var ze=_e<<2;l[ze+3]=li=$t*Ee>>He,li>0?(li=255/li,l[ze]=(Nt*Ee>>He)*li,l[ze+1]=(Ji*Ee>>He)*li,l[ze+2]=(ci*Ee>>He)*li):l[ze]=l[ze+1]=l[ze+2]=0,Nt-=Ki,Ji-=tr,ci-=Ar,$t-=Er,Ki-=ue.r,tr-=ue.g,Ar-=ue.b,Er-=ue.a,ze=ut+((ze=Sr+T)<b?ze:b)*r<<2,Nt+=vi+=ue.r=l[ze],Ji+=Bi+=ue.g=l[ze+1],ci+=Ii+=ue.b=l[ze+2],$t+=Gt+=ue.a=l[ze+3],ue=ue.next,Ki+=jt=ce.r,tr+=ni=ce.g,Ar+=di=ce.b,Er+=li=ce.a,vi-=jt,Bi-=ni,Ii-=di,Gt-=li,ce=ce.next,_e+=r}}return i}var fN=function i(){rve(this,i),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function cve(){var{DOMParser:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e={window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:i,createCanvas(t,r){return new OffscreenCanvas(t,r)},createImage(t){return UA(function*(){var r=yield fetch(t),n=yield r.blob(),o=yield createImageBitmap(n);return o})()}};return(typeof DOMParser<"u"||typeof i>"u")&&Reflect.deleteProperty(e,"DOMParser"),e}function uve(i){var{DOMParser:e,canvas:t,fetch:r}=i;return{window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:e,fetch:r,createCanvas:t.createCanvas,createImage:t.loadImage}}var hve=Object.freeze({__proto__:null,offscreen:cve,node:uve});function $f(i){return i.replace(/(?!\u3000)\s+/gm," ")}function pN(i){return i.replace(/^[\n \t]+/,"")}function gN(i){return i.replace(/[\n \t]+$/,"")}function Pc(i){var e=(i||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[];return e.map(parseFloat)}var Ave=/^[A-Z-]+$/;function mN(i){return Ave.test(i)?i.toLowerCase():i}function qT(i){var e=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(i)||[];return e[2]||e[3]||e[4]}function yN(i){if(!i.startsWith("rgb"))return i;var e=3,t=i.replace(/\d+(\.\d+)?/g,(r,n)=>e--&&n?String(Math.round(parseFloat(r))):r);return t}var dve=/(\[[^\]]+\])/g,fve=/(#[^\s+>~.[:]+)/g,pve=/(\.[^\s+>~.[:]+)/g,gve=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,mve=/(:[\w-]+\([^)]*\))/gi,yve=/(:[^\s+>~.[:]+)/g,_ve=/([^\s+>~.[:]+)/g;function Kf(i,e){var t=e.exec(i);return t?[i.replace(e," "),t.length]:[i,0]}function _N(i){var e=[0,0,0],t=i.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),r=0;return[t,r]=Kf(t,dve),e[1]+=r,[t,r]=Kf(t,fve),e[0]+=r,[t,r]=Kf(t,pve),e[1]+=r,[t,r]=Kf(t,gve),e[2]+=r,[t,r]=Kf(t,mve),e[1]+=r,[t,r]=Kf(t,yve),e[1]+=r,t=t.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[t,r]=Kf(t,_ve),e[2]+=r,e.join("")}var Wf=1e-8;function $T(i){return Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2))}function Zb(i,e){return(i[0]*e[0]+i[1]*e[1])/($T(i)*$T(e))}function KT(i,e){return(i[0]*e[1]<i[1]*e[0]?-1:1)*Math.acos(Zb(i,e))}function WT(i){return i*i*i}function XT(i){return 3*i*i*(1-i)}function ZT(i){return 3*i*(1-i)*(1-i)}function JT(i){return(1-i)*(1-i)*(1-i)}function YT(i){return i*i}function eI(i){return 2*i*(1-i)}function tI(i){return(1-i)*(1-i)}class wr{constructor(e,t,r){this.document=e,this.name=t,this.value=r,this.isNormalizedColor=!1}static empty(e){return new wr(e,"EMPTY","")}split(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ",{document:t,name:r}=this;return $f(this.getString()).trim().split(e).map(n=>new wr(t,r,n))}hasValue(e){var{value:t}=this;return t!==null&&t!==""&&(e||t!==0)&&typeof t<"u"}isString(e){var{value:t}=this,r=typeof t=="string";return!r||!e?r:e.test(t)}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;var e=this.getString();switch(!0){case e.endsWith("px"):case/^[0-9]+$/.test(e):return!0;default:return!1}}setValue(e){return this.value=e,this}getValue(e){return typeof e>"u"||this.hasValue()?this.value:e}getNumber(e){if(!this.hasValue())return typeof e>"u"?0:parseFloat(e);var{value:t}=this,r=parseFloat(t);return this.isString(/%$/)&&(r/=100),r}getString(e){return typeof e>"u"||this.hasValue()?typeof this.value>"u"?"":String(this.value):String(e)}getColor(e){var t=this.getString(e);return this.isNormalizedColor||(this.isNormalizedColor=!0,t=yN(t),this.value=t),t}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasValue())return 0;var[r,n]=typeof e=="boolean"?[void 0,e]:[e],{viewPort:o}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(o.computeSize("x"),o.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(o.computeSize("x"),o.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*o.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*o.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case(this.isString(/%$/)&&n):return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*o.computeSize(r);default:{var l=this.getNumber();return t&&l<1?l*o.computeSize(r):l}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){var e=this.getString(),t=/#([^)'"]+)/.exec(e);return t&&(t=t[1]),t||(t=e),this.document.definitions[t]}getFillStyleDefinition(e,t){var r=this.getDefinition();if(!r)return null;if(typeof r.createGradient=="function")return r.createGradient(this.document.ctx,e,t);if(typeof r.createPattern=="function"){if(r.getHrefAttribute().hasValue()){var n=r.getAttribute("patternTransform");r=r.getHrefAttribute().getDefinition(),n.hasValue()&&r.getAttribute("patternTransform",!0).setValue(n.value)}return r.createPattern(this.document.ctx,e,t)}return null}getTextBaseline(){return this.hasValue()?wr.textBaselineMapping[this.getString()]:null}addOpacity(e){for(var t=this.getColor(),r=t.length,n=0,o=0;o<r&&(t[o]===","&&n++,n!==3);o++);if(e.hasValue()&&this.isString()&&n!==3){var l=new QT(t);l.ok&&(l.alpha=e.getNumber(),t=l.toRGBA())}return new wr(this.document,this.name,t)}}wr.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class vN{constructor(){this.viewPorts=[]}clear(){this.viewPorts=[]}setCurrent(e,t){this.viewPorts.push({width:e,height:t})}removeCurrent(){this.viewPorts.pop()}getCurrent(){var{viewPorts:e}=this;return e[e.length-1]}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(e){return typeof e=="number"?e:e==="x"?this.width:e==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}}class Eo{constructor(e,t){this.x=e,this.y=t}static parse(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,[r=t,n=t]=Pc(e);return new Eo(r,n)}static parseScale(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,[r=t,n=r]=Pc(e);return new Eo(r,n)}static parsePath(e){for(var t=Pc(e),r=t.length,n=[],o=0;o<r;o+=2)n.push(new Eo(t[o],t[o+1]));return n}angleTo(e){return Math.atan2(e.y-this.y,e.x-this.x)}applyTransform(e){var{x:t,y:r}=this,n=t*e[0]+r*e[2]+e[4],o=t*e[1]+r*e[3]+e[5];this.x=n,this.y=o}}class bN{constructor(e){this.screen=e,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}isWorking(){return this.working}start(){if(!this.working){var{screen:e,onClick:t,onMouseMove:r}=this,n=e.ctx.canvas;n.onclick=t,n.onmousemove=r,this.working=!0}}stop(){if(this.working){var e=this.screen.ctx.canvas;this.working=!1,e.onclick=null,e.onmousemove=null}}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(this.working){var{screen:e,events:t,eventElements:r}=this,{style:n}=e.ctx.canvas;n&&(n.cursor=""),t.forEach((o,l)=>{for(var{run:s}=o,g=r[l];g;)s(g),g=g.parent}),this.events=[],this.eventElements=[]}}checkPath(e,t){if(!(!this.working||!t)){var{events:r,eventElements:n}=this;r.forEach((o,l)=>{var{x:s,y:g}=o;!n[l]&&t.isPointInPath&&t.isPointInPath(s,g)&&(n[l]=e)})}}checkBoundingBox(e,t){if(!(!this.working||!t)){var{events:r,eventElements:n}=this;r.forEach((o,l)=>{var{x:s,y:g}=o;!n[l]&&t.isPointInBox(s,g)&&(n[l]=e)})}}mapXY(e,t){for(var{window:r,ctx:n}=this.screen,o=new Eo(e,t),l=n.canvas;l;)o.x-=l.offsetLeft,o.y-=l.offsetTop,l=l.offsetParent;return r.scrollX&&(o.x+=r.scrollX),r.scrollY&&(o.y+=r.scrollY),o}onClick(e){var{x:t,y:r}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onclick",x:t,y:r,run(n){n.onClick&&n.onClick()}})}onMouseMove(e){var{x:t,y:r}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onmousemove",x:t,y:r,run(n){n.onMouseMove&&n.onMouseMove()}})}}var xN=typeof window<"u"?window:null,wN=typeof fetch<"u"?fetch.bind(void 0):null;class M0{constructor(e){var{fetch:t=wN,window:r=xN}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ctx=e,this.FRAMERATE=30,this.MAX_VIRTUAL_PIXELS=3e4,this.CLIENT_WIDTH=800,this.CLIENT_HEIGHT=600,this.viewPort=new vN,this.mouse=new bN(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=r,this.fetch=t}wait(e){this.waits.push(e)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;var e=this.waits.every(t=>t());return e&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=e,e}setDefaults(e){e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4}setViewBox(e){var{document:t,ctx:r,aspectRatio:n,width:o,desiredWidth:l,height:s,desiredHeight:g,minX:b=0,minY:T=0,refX:F,refY:k,clip:z=!1,clipX:J=0,clipY:te=0}=e,ue=$f(n).replace(/^defer\s/,""),[ce,de]=ue.split(" "),_e=ce||"xMidYMid",Ee=de||"meet",He=o/l,Ve=s/g,qe=Math.min(He,Ve),Ue=Math.max(He,Ve),ot=l,it=g;Ee==="meet"&&(ot*=qe,it*=qe),Ee==="slice"&&(ot*=Ue,it*=Ue);var De=new wr(t,"refX",F),Me=new wr(t,"refY",k),Ze=De.hasValue()&&Me.hasValue();if(Ze&&r.translate(-qe*De.getPixels("x"),-qe*Me.getPixels("y")),z){var We=qe*J,Bt=qe*te;r.beginPath(),r.moveTo(We,Bt),r.lineTo(o,Bt),r.lineTo(o,s),r.lineTo(We,s),r.closePath(),r.clip()}if(!Ze){var Ct=Ee==="meet"&&qe===Ve,Lt=Ee==="slice"&&Ue===Ve,_t=Ee==="meet"&&qe===He,Ft=Ee==="slice"&&Ue===He;_e.startsWith("xMid")&&(Ct||Lt)&&r.translate(o/2-ot/2,0),_e.endsWith("YMid")&&(_t||Ft)&&r.translate(0,s/2-it/2),_e.startsWith("xMax")&&(Ct||Lt)&&r.translate(o-ot,0),_e.endsWith("YMax")&&(_t||Ft)&&r.translate(0,s-it)}switch(!0){case _e==="none":r.scale(He,Ve);break;case Ee==="meet":r.scale(qe,qe);break;case Ee==="slice":r.scale(Ue,Ue);break}r.translate(-b,-T)}start(e){var{enableRedraw:t=!1,ignoreMouse:r=!1,ignoreAnimation:n=!1,ignoreDimensions:o=!1,ignoreClear:l=!1,forceRedraw:s,scaleWidth:g,scaleHeight:b,offsetX:T,offsetY:F}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{FRAMERATE:k,mouse:z}=this,J=1e3/k;if(this.frameDuration=J,this.readyPromise=new Promise(_e=>{this.resolveReady=_e}),this.isReady()&&this.render(e,o,l,g,b,T,F),!!t){var te=Date.now(),ue=te,ce=0,de=()=>{te=Date.now(),ce=te-ue,ce>=J&&(ue=te-ce%J,this.shouldUpdate(n,s)&&(this.render(e,o,l,g,b,T,F),z.runEvents())),this.intervalId=UT(de)};r||z.start(),this.intervalId=UT(de)}}stop(){this.intervalId&&(UT.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(e,t){if(!e){var{frameDuration:r}=this,n=this.animations.reduce((o,l)=>l.update(r)||o,!1);if(n)return!0}return!!(typeof t=="function"&&t()||!this.isReadyLock&&this.isReady()||this.mouse.hasEvents())}render(e,t,r,n,o,l,s){var{CLIENT_WIDTH:g,CLIENT_HEIGHT:b,viewPort:T,ctx:F,isFirstRender:k}=this,z=F.canvas;T.clear(),z.width&&z.height?T.setCurrent(z.width,z.height):T.setCurrent(g,b);var J=e.getStyle("width"),te=e.getStyle("height");!t&&(k||typeof n!="number"&&typeof o!="number")&&(J.hasValue()&&(z.width=J.getPixels("x"),z.style&&(z.style.width="".concat(z.width,"px"))),te.hasValue()&&(z.height=te.getPixels("y"),z.style&&(z.style.height="".concat(z.height,"px"))));var ue=z.clientWidth||z.width,ce=z.clientHeight||z.height;if(t&&J.hasValue()&&te.hasValue()&&(ue=J.getPixels("x"),ce=te.getPixels("y")),T.setCurrent(ue,ce),typeof l=="number"&&e.getAttribute("x",!0).setValue(l),typeof s=="number"&&e.getAttribute("y",!0).setValue(s),typeof n=="number"||typeof o=="number"){var de=Pc(e.getAttribute("viewBox").getString()),_e=0,Ee=0;if(typeof n=="number"){var He=e.getStyle("width");He.hasValue()?_e=He.getPixels("x")/n:isNaN(de[2])||(_e=de[2]/n)}if(typeof o=="number"){var Ve=e.getStyle("height");Ve.hasValue()?Ee=Ve.getPixels("y")/o:isNaN(de[3])||(Ee=de[3]/o)}_e||(_e=Ee),Ee||(Ee=_e),e.getAttribute("width",!0).setValue(n),e.getAttribute("height",!0).setValue(o);var qe=e.getStyle("transform",!0,!0);qe.setValue("".concat(qe.getString()," scale(").concat(1/_e,", ").concat(1/Ee,")"))}r||F.clearRect(0,0,ue,ce),e.render(F),k&&(this.isFirstRender=!1)}}M0.defaultWindow=xN,M0.defaultFetch=wN;var{defaultFetch:vve}=M0,bve=typeof DOMParser<"u"?DOMParser:null;class Jb{constructor(){var{fetch:e=vve,DOMParser:t=bve}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fetch=e,this.DOMParser=t}parse(e){var t=this;return UA(function*(){return e.startsWith("<")?t.parseFromString(e):t.load(e)})()}parseFromString(e){var t=new this.DOMParser;try{return this.checkDocument(t.parseFromString(e,"image/svg+xml"))}catch{return this.checkDocument(t.parseFromString(e,"text/xml"))}}checkDocument(e){var t=e.getElementsByTagName("parsererror")[0];if(t)throw new Error(t.textContent);return e}load(e){var t=this;return UA(function*(){var r=yield t.fetch(e),n=yield r.text();return t.parseFromString(n)})()}}class BN{constructor(e,t){this.type="translate",this.point=null,this.point=Eo.parse(t)}apply(e){var{x:t,y:r}=this.point;e.translate(t||0,r||0)}unapply(e){var{x:t,y:r}=this.point;e.translate(-1*t||0,-1*r||0)}applyToPoint(e){var{x:t,y:r}=this.point;e.applyTransform([1,0,0,1,t||0,r||0])}}class CN{constructor(e,t,r){this.type="rotate",this.angle=null,this.originX=null,this.originY=null,this.cx=0,this.cy=0;var n=Pc(t);this.angle=new wr(e,"angle",n[0]),this.originX=r[0],this.originY=r[1],this.cx=n[1]||0,this.cy=n[2]||0}apply(e){var{cx:t,cy:r,originX:n,originY:o,angle:l}=this,s=t+n.getPixels("x"),g=r+o.getPixels("y");e.translate(s,g),e.rotate(l.getRadians()),e.translate(-s,-g)}unapply(e){var{cx:t,cy:r,originX:n,originY:o,angle:l}=this,s=t+n.getPixels("x"),g=r+o.getPixels("y");e.translate(s,g),e.rotate(-1*l.getRadians()),e.translate(-s,-g)}applyToPoint(e){var{cx:t,cy:r,angle:n}=this,o=n.getRadians();e.applyTransform([1,0,0,1,t||0,r||0]),e.applyTransform([Math.cos(o),Math.sin(o),-Math.sin(o),Math.cos(o),0,0]),e.applyTransform([1,0,0,1,-t||0,-r||0])}}class EN{constructor(e,t,r){this.type="scale",this.scale=null,this.originX=null,this.originY=null;var n=Eo.parseScale(t);(n.x===0||n.y===0)&&(n.x=Wf,n.y=Wf),this.scale=n,this.originX=r[0],this.originY=r[1]}apply(e){var{scale:{x:t,y:r},originX:n,originY:o}=this,l=n.getPixels("x"),s=o.getPixels("y");e.translate(l,s),e.scale(t,r||t),e.translate(-l,-s)}unapply(e){var{scale:{x:t,y:r},originX:n,originY:o}=this,l=n.getPixels("x"),s=o.getPixels("y");e.translate(l,s),e.scale(1/t,1/r||t),e.translate(-l,-s)}applyToPoint(e){var{x:t,y:r}=this.scale;e.applyTransform([t||0,0,0,r||0,0,0])}}class iI{constructor(e,t,r){this.type="matrix",this.matrix=[],this.originX=null,this.originY=null,this.matrix=Pc(t),this.originX=r[0],this.originY=r[1]}apply(e){var{originX:t,originY:r,matrix:n}=this,o=t.getPixels("x"),l=r.getPixels("y");e.translate(o,l),e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),e.translate(-o,-l)}unapply(e){var{originX:t,originY:r,matrix:n}=this,o=n[0],l=n[2],s=n[4],g=n[1],b=n[3],T=n[5],F=0,k=0,z=1,J=1/(o*(b*z-T*k)-l*(g*z-T*F)+s*(g*k-b*F)),te=t.getPixels("x"),ue=r.getPixels("y");e.translate(te,ue),e.transform(J*(b*z-T*k),J*(T*F-g*z),J*(s*k-l*z),J*(o*z-s*F),J*(l*T-s*b),J*(s*g-o*T)),e.translate(-te,-ue)}applyToPoint(e){e.applyTransform(this.matrix)}}class rI extends iI{constructor(e,t,r){super(e,t,r),this.type="skew",this.angle=null,this.angle=new wr(e,"angle",t)}}class SN extends rI{constructor(e,t,r){super(e,t,r),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class TN extends rI{constructor(e,t,r){super(e,t,r),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function xve(i){return $f(i).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function wve(i){var[e,t]=i.split("(");return[e.trim(),t.trim().replace(")","")]}class Fd{constructor(e,t,r){this.document=e,this.transforms=[];var n=xve(t);n.forEach(o=>{if(o!=="none"){var[l,s]=wve(o),g=Fd.transformTypes[l];typeof g<"u"&&this.transforms.push(new g(this.document,s,r))}})}static fromElement(e,t){var r=t.getStyle("transform",!1,!0),[n,o=n]=t.getStyle("transform-origin",!1,!0).split(),l=[n,o];return r.hasValue()?new Fd(e,r.getString(),l):null}apply(e){for(var{transforms:t}=this,r=t.length,n=0;n<r;n++)t[n].apply(e)}unapply(e){for(var{transforms:t}=this,r=t.length,n=r-1;n>=0;n--)t[n].unapply(e)}applyToPoint(e){for(var{transforms:t}=this,r=t.length,n=0;n<r;n++)t[n].applyToPoint(e)}}Fd.transformTypes={translate:BN,rotate:CN,scale:EN,matrix:iI,skewX:SN,skewY:TN};class Hs{constructor(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this.document=e,this.node=t,this.captureTextNodes=r,this.attributes={},this.styles={},this.stylesSpecificity={},this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!(!t||t.nodeType!==1)){if(Array.from(t.attributes).forEach(s=>{var g=mN(s.nodeName);this.attributes[g]=new wr(e,g,s.value)}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()){var n=this.getAttribute("style").getString().split(";").map(s=>s.trim());n.forEach(s=>{if(s){var[g,b]=s.split(":").map(T=>T.trim());this.styles[g]=new wr(e,g,b)}})}var{definitions:o}=e,l=this.getAttribute("id");l.hasValue()&&(o[l.getString()]||(o[l.getString()]=this)),Array.from(t.childNodes).forEach(s=>{if(s.nodeType===1)this.addChild(s);else if(r&&(s.nodeType===3||s.nodeType===4)){var g=e.createTextNode(s);g.getText().length>0&&this.addChild(g)}})}}getAttribute(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=this.attributes[e];if(!r&&t){var n=new wr(this.document,e,"");return this.attributes[e]=n,n}return r||wr.empty(this.document)}getHrefAttribute(){for(var e in this.attributes)if(e==="href"||e.endsWith(":href"))return this.attributes[e];return wr.empty(this.document)}getStyle(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=this.styles[e];if(n)return n;var o=this.getAttribute(e);if(o!=null&&o.hasValue())return this.styles[e]=o,o;if(!r){var{parent:l}=this;if(l){var s=l.getStyle(e);if(s!=null&&s.hasValue())return s}}if(t){var g=new wr(this.document,e,"");return this.styles[e]=g,g}return n||wr.empty(this.document)}render(e){if(!(this.getStyle("display").getString()==="none"||this.getStyle("visibility").getString()==="hidden")){if(e.save(),this.getStyle("mask").hasValue()){var t=this.getStyle("mask").getDefinition();t&&(this.applyEffects(e),t.apply(e,this))}else if(this.getStyle("filter").getValue("none")!=="none"){var r=this.getStyle("filter").getDefinition();r&&(this.applyEffects(e),r.apply(e,this))}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}}setContext(e){}applyEffects(e){var t=Fd.fromElement(this.document,this);t&&t.apply(e);var r=this.getStyle("clip-path",!1,!0);if(r.hasValue()){var n=r.getDefinition();n&&n.apply(e)}}clearContext(e){}renderChildren(e){this.children.forEach(t=>{t.render(e)})}addChild(e){var t=e instanceof Hs?e:this.document.createElement(e);t.parent=this,Hs.ignoreChildTypes.includes(t.type)||this.children.push(t)}matchesSelector(e){var t,{node:r}=this;if(typeof r.matches=="function")return r.matches(e);var n=(t=r.getAttribute)===null||t===void 0?void 0:t.call(r,"class");return!n||n===""?!1:n.split(" ").some(o=>".".concat(o)===e)}addStylesFromStyleDefinition(){var{styles:e,stylesSpecificity:t}=this.document;for(var r in e)if(!r.startsWith("@")&&this.matchesSelector(r)){var n=e[r],o=t[r];if(n)for(var l in n){var s=this.stylesSpecificity[l];typeof s>"u"&&(s="000"),o>=s&&(this.styles[l]=n[l],this.stylesSpecificity[l]=o)}}}removeStyles(e,t){var r=t.reduce((n,o)=>{var l=e.getStyle(o);if(!l.hasValue())return n;var s=l.getString();return l.setValue(""),[...n,[o,s]]},[]);return r}restoreStyles(e,t){t.forEach(r=>{var[n,o]=r;e.getStyle(n,!0).setValue(o)})}isFirstChild(){var e;return((e=this.parent)===null||e===void 0?void 0:e.children.indexOf(this))===0}}Hs.ignoreChildTypes=["title"];class IN extends Hs{constructor(e,t,r){super(e,t,r)}}function Bve(i){var e=i.trim();return/^('|")/.test(e)?e:'"'.concat(e,'"')}function Cve(i){return typeof process>"u"?i:i.trim().split(",").map(Bve).join(",")}function Eve(i){if(!i)return"";var e=i.trim().toLowerCase();switch(e){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return e;default:return/^oblique\s+(-|)\d+deg$/.test(e)?e:""}}function Sve(i){if(!i)return"";var e=i.trim().toLowerCase();switch(e){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return e;default:return/^[\d.]+$/.test(e)?e:""}}class Ol{constructor(e,t,r,n,o,l){var s=l?typeof l=="string"?Ol.parse(l):l:{};this.fontFamily=o||s.fontFamily,this.fontSize=n||s.fontSize,this.fontStyle=e||s.fontStyle,this.fontWeight=r||s.fontWeight,this.fontVariant=t||s.fontVariant}static parse(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,r="",n="",o="",l="",s="",g=$f(e).trim().split(" "),b={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return g.forEach(T=>{switch(!0){case(!b.fontStyle&&Ol.styles.includes(T)):T!=="inherit"&&(r=T),b.fontStyle=!0;break;case(!b.fontVariant&&Ol.variants.includes(T)):T!=="inherit"&&(n=T),b.fontStyle=!0,b.fontVariant=!0;break;case(!b.fontWeight&&Ol.weights.includes(T)):T!=="inherit"&&(o=T),b.fontStyle=!0,b.fontVariant=!0,b.fontWeight=!0;break;case!b.fontSize:T!=="inherit"&&([l]=T.split("/")),b.fontStyle=!0,b.fontVariant=!0,b.fontWeight=!0,b.fontSize=!0;break;default:T!=="inherit"&&(s+=T)}}),new Ol(r,n,o,l,s,t)}toString(){return[Eve(this.fontStyle),this.fontVariant,Sve(this.fontWeight),this.fontSize,Cve(this.fontFamily)].join(" ").trim()}}Ol.styles="normal|italic|oblique|inherit",Ol.variants="normal|small-caps|inherit",Ol.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class Du{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.NaN,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.NaN,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.NaN,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.NaN;this.x1=e,this.y1=t,this.x2=r,this.y2=n,this.addPoint(e,t),this.addPoint(r,n)}get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(e,t){typeof e<"u"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),typeof t<"u"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))}addX(e){this.addPoint(e,null)}addY(e){this.addPoint(null,e)}addBoundingBox(e){if(e){var{x1:t,y1:r,x2:n,y2:o}=e;this.addPoint(t,r),this.addPoint(n,o)}}sumCubic(e,t,r,n,o){return Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*r+3*(1-e)*Math.pow(e,2)*n+Math.pow(e,3)*o}bezierCurveAdd(e,t,r,n,o){var l=6*t-12*r+6*n,s=-3*t+9*r-9*n+3*o,g=3*r-3*t;if(s===0){if(l===0)return;var b=-g/l;0<b&&b<1&&(e?this.addX(this.sumCubic(b,t,r,n,o)):this.addY(this.sumCubic(b,t,r,n,o)));return}var T=Math.pow(l,2)-4*g*s;if(!(T<0)){var F=(-l+Math.sqrt(T))/(2*s);0<F&&F<1&&(e?this.addX(this.sumCubic(F,t,r,n,o)):this.addY(this.sumCubic(F,t,r,n,o)));var k=(-l-Math.sqrt(T))/(2*s);0<k&&k<1&&(e?this.addX(this.sumCubic(k,t,r,n,o)):this.addY(this.sumCubic(k,t,r,n,o)))}}addBezierCurve(e,t,r,n,o,l,s,g){this.addPoint(e,t),this.addPoint(s,g),this.bezierCurveAdd(!0,e,r,o,s),this.bezierCurveAdd(!1,t,n,l,g)}addQuadraticCurve(e,t,r,n,o,l){var s=e+.6666666666666666*(r-e),g=t+2/3*(n-t),b=s+1/3*(o-e),T=g+1/3*(l-t);this.addBezierCurve(e,t,s,b,g,T,o,l)}isPointInBox(e,t){var{x1:r,y1:n,x2:o,y2:l}=this;return r<=e&&e<=o&&n<=t&&t<=l}}class Yr extends yi{constructor(e){super(e.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=null,this.start=null,this.current=null,this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new Eo(0,0),this.control=new Eo(0,0),this.current=new Eo(0,0),this.points=[],this.angles=[]}isEnd(){var{i:e,commands:t}=this;return e>=t.length-1}next(){var e=this.commands[++this.i];return this.previousCommand=this.command,this.command=e,e}getPoint(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y",r=new Eo(this.command[e],this.command[t]);return this.makeAbsolute(r)}getAsControlPoint(e,t){var r=this.getPoint(e,t);return this.control=r,r}getAsCurrentPoint(e,t){var r=this.getPoint(e,t);return this.current=r,r}getReflectedControlPoint(){var e=this.previousCommand.type;if(e!==yi.CURVE_TO&&e!==yi.SMOOTH_CURVE_TO&&e!==yi.QUAD_TO&&e!==yi.SMOOTH_QUAD_TO)return this.current;var{current:{x:t,y:r},control:{x:n,y:o}}=this,l=new Eo(2*t-n,2*r-o);return l}makeAbsolute(e){if(this.command.relative){var{x:t,y:r}=this.current;e.x+=t,e.y+=r}return e}addMarker(e,t,r){var{points:n,angles:o}=this;r&&o.length>0&&!o[o.length-1]&&(o[o.length-1]=n[n.length-1].angleTo(r)),this.addMarkerAngle(e,t?t.angleTo(e):null)}addMarkerAngle(e,t){this.points.push(e),this.angles.push(t)}getMarkerPoints(){return this.points}getMarkerAngles(){for(var{angles:e}=this,t=e.length,r=0;r<t;r++)if(!e[r]){for(var n=r+1;n<t;n++)if(e[n]){e[r]=e[n];break}}return e}}class Dd extends Hs{constructor(){super(...arguments),this.modifiedEmSizeStack=!1}calculateOpacity(){for(var e=1,t=this;t;){var r=t.getStyle("opacity",!1,!0);r.hasValue(!0)&&(e*=r.getNumber()),t=t.parent}return e}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!t){var r=this.getStyle("fill"),n=this.getStyle("fill-opacity"),o=this.getStyle("stroke"),l=this.getStyle("stroke-opacity");if(r.isUrlDefinition()){var s=r.getFillStyleDefinition(this,n);s&&(e.fillStyle=s)}else if(r.hasValue()){r.getString()==="currentColor"&&r.setValue(this.getStyle("color").getColor());var g=r.getColor();g!=="inherit"&&(e.fillStyle=g==="none"?"rgba(0,0,0,0)":g)}if(n.hasValue()){var b=new wr(this.document,"fill",e.fillStyle).addOpacity(n).getColor();e.fillStyle=b}if(o.isUrlDefinition()){var T=o.getFillStyleDefinition(this,l);T&&(e.strokeStyle=T)}else if(o.hasValue()){o.getString()==="currentColor"&&o.setValue(this.getStyle("color").getColor());var F=o.getString();F!=="inherit"&&(e.strokeStyle=F==="none"?"rgba(0,0,0,0)":F)}if(l.hasValue()){var k=new wr(this.document,"stroke",e.strokeStyle).addOpacity(l).getString();e.strokeStyle=k}var z=this.getStyle("stroke-width");if(z.hasValue()){var J=z.getPixels();e.lineWidth=J||Wf}var te=this.getStyle("stroke-linecap"),ue=this.getStyle("stroke-linejoin"),ce=this.getStyle("stroke-miterlimit"),de=this.getStyle("stroke-dasharray"),_e=this.getStyle("stroke-dashoffset");if(te.hasValue()&&(e.lineCap=te.getString()),ue.hasValue()&&(e.lineJoin=ue.getString()),ce.hasValue()&&(e.miterLimit=ce.getNumber()),de.hasValue()&&de.getString()!=="none"){var Ee=Pc(de.getString());typeof e.setLineDash<"u"?e.setLineDash(Ee):typeof e.webkitLineDash<"u"?e.webkitLineDash=Ee:typeof e.mozDash<"u"&&!(Ee.length===1&&Ee[0]===0)&&(e.mozDash=Ee);var He=_e.getPixels();typeof e.lineDashOffset<"u"?e.lineDashOffset=He:typeof e.webkitLineDashOffset<"u"?e.webkitLineDashOffset=He:typeof e.mozDashOffset<"u"&&(e.mozDashOffset=He)}}if(this.modifiedEmSizeStack=!1,typeof e.font<"u"){var Ve=this.getStyle("font"),qe=this.getStyle("font-style"),Ue=this.getStyle("font-variant"),ot=this.getStyle("font-weight"),it=this.getStyle("font-size"),De=this.getStyle("font-family"),Me=new Ol(qe.getString(),Ue.getString(),ot.getString(),it.hasValue()?"".concat(it.getPixels(!0),"px"):"",De.getString(),Ol.parse(Ve.getString(),e.font));qe.setValue(Me.fontStyle),Ue.setValue(Me.fontVariant),ot.setValue(Me.fontWeight),it.setValue(Me.fontSize),De.setValue(Me.fontFamily),e.font=Me.toString(),it.isPixels()&&(this.document.emSize=it.getPixels(),this.modifiedEmSizeStack=!0)}t||(this.applyEffects(e),e.globalAlpha=this.calculateOpacity())}clearContext(e){super.clearContext(e),this.modifiedEmSizeStack&&this.document.popEmSize()}}class cs extends Dd{constructor(e,t,r){super(e,t,r),this.type="path",this.pathParser=null,this.pathParser=new Yr(this.getAttribute("d").getString())}path(e){var{pathParser:t}=this,r=new Du;for(t.reset(),e&&e.beginPath();!t.isEnd();)switch(t.next().type){case Yr.MOVE_TO:this.pathM(e,r);break;case Yr.LINE_TO:this.pathL(e,r);break;case Yr.HORIZ_LINE_TO:this.pathH(e,r);break;case Yr.VERT_LINE_TO:this.pathV(e,r);break;case Yr.CURVE_TO:this.pathC(e,r);break;case Yr.SMOOTH_CURVE_TO:this.pathS(e,r);break;case Yr.QUAD_TO:this.pathQ(e,r);break;case Yr.SMOOTH_QUAD_TO:this.pathT(e,r);break;case Yr.ARC:this.pathA(e,r);break;case Yr.CLOSE_PATH:this.pathZ(e,r);break}return r}getBoundingBox(e){return this.path()}getMarkers(){var{pathParser:e}=this,t=e.getMarkerPoints(),r=e.getMarkerAngles(),n=t.map((o,l)=>[o,r[l]]);return n}renderChildren(e){this.path(e),this.document.screen.mouse.checkPath(this,e);var t=this.getStyle("fill-rule");e.fillStyle!==""&&(t.getString("inherit")!=="inherit"?e.fill(t.getString()):e.fill()),e.strokeStyle!==""&&(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"?(e.save(),e.setTransform(1,0,0,1,0,0),e.stroke(),e.restore()):e.stroke());var r=this.getMarkers();if(r){var n=r.length-1,o=this.getStyle("marker-start"),l=this.getStyle("marker-mid"),s=this.getStyle("marker-end");if(o.isUrlDefinition()){var g=o.getDefinition(),[b,T]=r[0];g.render(e,b,T)}if(l.isUrlDefinition())for(var F=l.getDefinition(),k=1;k<n;k++){var[z,J]=r[k];F.render(e,z,J)}if(s.isUrlDefinition()){var te=s.getDefinition(),[ue,ce]=r[n];te.render(e,ue,ce)}}}static pathM(e){var t=e.getAsCurrentPoint();return e.start=e.current,{point:t}}pathM(e,t){var{pathParser:r}=this,{point:n}=cs.pathM(r),{x:o,y:l}=n;r.addMarker(n),t.addPoint(o,l),e&&e.moveTo(o,l)}static pathL(e){var{current:t}=e,r=e.getAsCurrentPoint();return{current:t,point:r}}pathL(e,t){var{pathParser:r}=this,{current:n,point:o}=cs.pathL(r),{x:l,y:s}=o;r.addMarker(o,n),t.addPoint(l,s),e&&e.lineTo(l,s)}static pathH(e){var{current:t,command:r}=e,n=new Eo((r.relative?t.x:0)+r.x,t.y);return e.current=n,{current:t,point:n}}pathH(e,t){var{pathParser:r}=this,{current:n,point:o}=cs.pathH(r),{x:l,y:s}=o;r.addMarker(o,n),t.addPoint(l,s),e&&e.lineTo(l,s)}static pathV(e){var{current:t,command:r}=e,n=new Eo(t.x,(r.relative?t.y:0)+r.y);return e.current=n,{current:t,point:n}}pathV(e,t){var{pathParser:r}=this,{current:n,point:o}=cs.pathV(r),{x:l,y:s}=o;r.addMarker(o,n),t.addPoint(l,s),e&&e.lineTo(l,s)}static pathC(e){var{current:t}=e,r=e.getPoint("x1","y1"),n=e.getAsControlPoint("x2","y2"),o=e.getAsCurrentPoint();return{current:t,point:r,controlPoint:n,currentPoint:o}}pathC(e,t){var{pathParser:r}=this,{current:n,point:o,controlPoint:l,currentPoint:s}=cs.pathC(r);r.addMarker(s,l,o),t.addBezierCurve(n.x,n.y,o.x,o.y,l.x,l.y,s.x,s.y),e&&e.bezierCurveTo(o.x,o.y,l.x,l.y,s.x,s.y)}static pathS(e){var{current:t}=e,r=e.getReflectedControlPoint(),n=e.getAsControlPoint("x2","y2"),o=e.getAsCurrentPoint();return{current:t,point:r,controlPoint:n,currentPoint:o}}pathS(e,t){var{pathParser:r}=this,{current:n,point:o,controlPoint:l,currentPoint:s}=cs.pathS(r);r.addMarker(s,l,o),t.addBezierCurve(n.x,n.y,o.x,o.y,l.x,l.y,s.x,s.y),e&&e.bezierCurveTo(o.x,o.y,l.x,l.y,s.x,s.y)}static pathQ(e){var{current:t}=e,r=e.getAsControlPoint("x1","y1"),n=e.getAsCurrentPoint();return{current:t,controlPoint:r,currentPoint:n}}pathQ(e,t){var{pathParser:r}=this,{current:n,controlPoint:o,currentPoint:l}=cs.pathQ(r);r.addMarker(l,o,o),t.addQuadraticCurve(n.x,n.y,o.x,o.y,l.x,l.y),e&&e.quadraticCurveTo(o.x,o.y,l.x,l.y)}static pathT(e){var{current:t}=e,r=e.getReflectedControlPoint();e.control=r;var n=e.getAsCurrentPoint();return{current:t,controlPoint:r,currentPoint:n}}pathT(e,t){var{pathParser:r}=this,{current:n,controlPoint:o,currentPoint:l}=cs.pathT(r);r.addMarker(l,o,o),t.addQuadraticCurve(n.x,n.y,o.x,o.y,l.x,l.y),e&&e.quadraticCurveTo(o.x,o.y,l.x,l.y)}static pathA(e){var{current:t,command:r}=e,{rX:n,rY:o,xRot:l,lArcFlag:s,sweepFlag:g}=r,b=l*(Math.PI/180),T=e.getAsCurrentPoint(),F=new Eo(Math.cos(b)*(t.x-T.x)/2+Math.sin(b)*(t.y-T.y)/2,-Math.sin(b)*(t.x-T.x)/2+Math.cos(b)*(t.y-T.y)/2),k=Math.pow(F.x,2)/Math.pow(n,2)+Math.pow(F.y,2)/Math.pow(o,2);k>1&&(n*=Math.sqrt(k),o*=Math.sqrt(k));var z=(s===g?-1:1)*Math.sqrt((Math.pow(n,2)*Math.pow(o,2)-Math.pow(n,2)*Math.pow(F.y,2)-Math.pow(o,2)*Math.pow(F.x,2))/(Math.pow(n,2)*Math.pow(F.y,2)+Math.pow(o,2)*Math.pow(F.x,2)));isNaN(z)&&(z=0);var J=new Eo(z*n*F.y/o,z*-o*F.x/n),te=new Eo((t.x+T.x)/2+Math.cos(b)*J.x-Math.sin(b)*J.y,(t.y+T.y)/2+Math.sin(b)*J.x+Math.cos(b)*J.y),ue=KT([1,0],[(F.x-J.x)/n,(F.y-J.y)/o]),ce=[(F.x-J.x)/n,(F.y-J.y)/o],de=[(-F.x-J.x)/n,(-F.y-J.y)/o],_e=KT(ce,de);return Zb(ce,de)<=-1&&(_e=Math.PI),Zb(ce,de)>=1&&(_e=0),{currentPoint:T,rX:n,rY:o,sweepFlag:g,xAxisRotation:b,centp:te,a1:ue,ad:_e}}pathA(e,t){var{pathParser:r}=this,{currentPoint:n,rX:o,rY:l,sweepFlag:s,xAxisRotation:g,centp:b,a1:T,ad:F}=cs.pathA(r),k=1-s?1:-1,z=T+k*(F/2),J=new Eo(b.x+o*Math.cos(z),b.y+l*Math.sin(z));if(r.addMarkerAngle(J,z-k*Math.PI/2),r.addMarkerAngle(n,z-k*Math.PI),t.addPoint(n.x,n.y),e&&!isNaN(T)&&!isNaN(F)){var te=o>l?o:l,ue=o>l?1:o/l,ce=o>l?l/o:1;e.translate(b.x,b.y),e.rotate(g),e.scale(ue,ce),e.arc(0,0,te,T,T+F,!!(1-s)),e.scale(1/ue,1/ce),e.rotate(-g),e.translate(-b.x,-b.y)}}static pathZ(e){e.current=e.start}pathZ(e,t){cs.pathZ(this.pathParser),e&&t.x1!==t.x2&&t.y1!==t.y2&&e.closePath()}}class nI extends cs{constructor(e,t,r){super(e,t,r),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}}class QA extends Dd{constructor(e,t,r){super(e,t,new.target===QA?!0:r),this.type="text",this.x=0,this.y=0,this.measureCache=-1}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.setContext(e,t);var r=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();r&&(e.textBaseline=r)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(e){if(this.type!=="text")return this.getTElementBoundingBox(e);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e);var t=null;return this.children.forEach((r,n)=>{var o=this.getChildBoundingBox(e,this,this,n);t?t.addBoundingBox(o):t=o}),t}getFontSize(){var{document:e,parent:t}=this,r=Ol.parse(e.ctx.font).fontSize,n=t.getStyle("font-size").getNumber(r);return n}getTElementBoundingBox(e){var t=this.getFontSize();return new Du(this.x,this.y-t,this.x+this.measureText(e),this.y)}getGlyph(e,t,r){var n=t[r],o=null;if(e.isArabic){var l=t.length,s=t[r-1],g=t[r+1],b="isolated";if((r===0||s===" ")&&r<l-1&&g!==" "&&(b="terminal"),r>0&&s!==" "&&r<l-1&&g!==" "&&(b="medial"),r>0&&s!==" "&&(r===l-1||g===" ")&&(b="initial"),typeof e.glyphs[n]<"u"){var T=e.glyphs[n];o=T instanceof nI?T:T[b]}}else o=e.glyphs[n];return o||(o=e.missingGlyph),o}getText(){return""}getTextFromNode(e){var t=e||this.node,r=Array.from(t.parentNode.childNodes),n=r.indexOf(t),o=r.length-1,l=$f(t.textContent||"");return n===0&&(l=pN(l)),n===o&&(l=gN(l)),l}renderChildren(e){if(this.type!=="text"){this.renderTElementChildren(e);return}this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e),this.children.forEach((r,n)=>{this.renderChild(e,this,this,n)});var{mouse:t}=this.document.screen;t.isWorking()&&t.checkBoundingBox(this,this.getBoundingBox(e))}renderTElementChildren(e){var{document:t,parent:r}=this,n=this.getText(),o=r.getStyle("font-family").getDefinition();if(o){for(var{unitsPerEm:l}=o.fontFace,s=Ol.parse(t.ctx.font),g=r.getStyle("font-size").getNumber(s.fontSize),b=r.getStyle("font-style").getString(s.fontStyle),T=g/l,F=o.isRTL?n.split("").reverse().join(""):n,k=Pc(r.getAttribute("dx").getString()),z=F.length,J=0;J<z;J++){var te=this.getGlyph(o,F,J);e.translate(this.x,this.y),e.scale(T,-T);var ue=e.lineWidth;e.lineWidth=e.lineWidth*l/g,b==="italic"&&e.transform(1,0,.4,1,0,0),te.render(e),b==="italic"&&e.transform(1,0,-.4,1,0,0),e.lineWidth=ue,e.scale(1/T,-1/T),e.translate(-this.x,-this.y),this.x+=g*(te.horizAdvX||o.horizAdvX)/l,typeof k[J]<"u"&&!isNaN(k[J])&&(this.x+=k[J])}return}var{x:ce,y:de}=this;e.fillStyle&&e.fillText(n,ce,de),e.strokeStyle&&e.strokeText(n,ce,de)}applyAnchoring(){if(!(this.textChunkStart>=this.leafTexts.length)){var e=this.leafTexts[this.textChunkStart],t=e.getStyle("text-anchor").getString("start"),r=!1,n=0;t==="start"&&!r||t==="end"&&r?n=e.x-this.minX:t==="end"&&!r||t==="start"&&r?n=e.x-this.maxX:n=e.x-(this.minX+this.maxX)/2;for(var o=this.textChunkStart;o<this.leafTexts.length;o++)this.leafTexts[o].x+=n;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}}adjustChildCoordinatesRecursive(e){this.children.forEach((t,r)=>{this.adjustChildCoordinatesRecursiveCore(e,this,this,r)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(e,t,r,n){var o=r.children[n];o.children.length>0?o.children.forEach((l,s)=>{t.adjustChildCoordinatesRecursiveCore(e,t,o,s)}):this.adjustChildCoordinates(e,t,r,n)}adjustChildCoordinates(e,t,r,n){var o=r.children[n];if(typeof o.measureText!="function")return o;e.save(),o.setContext(e,!0);var l=o.getAttribute("x"),s=o.getAttribute("y"),g=o.getAttribute("dx"),b=o.getAttribute("dy"),T=o.getStyle("font-family").getDefinition(),F=!!T&&T.isRTL;n===0&&(l.hasValue()||l.setValue(o.getInheritedAttribute("x")),s.hasValue()||s.setValue(o.getInheritedAttribute("y")),g.hasValue()||g.setValue(o.getInheritedAttribute("dx")),b.hasValue()||b.setValue(o.getInheritedAttribute("dy")));var k=o.measureText(e);return F&&(t.x-=k),l.hasValue()?(t.applyAnchoring(),o.x=l.getPixels("x"),g.hasValue()&&(o.x+=g.getPixels("x"))):(g.hasValue()&&(t.x+=g.getPixels("x")),o.x=t.x),t.x=o.x,F||(t.x+=k),s.hasValue()?(o.y=s.getPixels("y"),b.hasValue()&&(o.y+=b.getPixels("y"))):(b.hasValue()&&(t.y+=b.getPixels("y")),o.y=t.y),t.y=o.y,t.leafTexts.push(o),t.minX=Math.min(t.minX,o.x,o.x+k),t.maxX=Math.max(t.maxX,o.x,o.x+k),o.clearContext(e),e.restore(),o}getChildBoundingBox(e,t,r,n){var o=r.children[n];if(typeof o.getBoundingBox!="function")return null;var l=o.getBoundingBox(e);return l?(o.children.forEach((s,g)=>{var b=t.getChildBoundingBox(e,t,o,g);l.addBoundingBox(b)}),l):null}renderChild(e,t,r,n){var o=r.children[n];o.render(e),o.children.forEach((l,s)=>{t.renderChild(e,t,o,s)})}measureText(e){var{measureCache:t}=this;if(~t)return t;var r=this.getText(),n=this.measureTargetText(e,r);return this.measureCache=n,n}measureTargetText(e,t){if(!t.length)return 0;var{parent:r}=this,n=r.getStyle("font-family").getDefinition();if(n){for(var o=this.getFontSize(),l=n.isRTL?t.split("").reverse().join(""):t,s=Pc(r.getAttribute("dx").getString()),g=l.length,b=0,T=0;T<g;T++){var F=this.getGlyph(n,l,T);b+=(F.horizAdvX||n.horizAdvX)*o/n.fontFace.unitsPerEm,typeof s[T]<"u"&&!isNaN(s[T])&&(b+=s[T])}return b}if(!e.measureText)return t.length*10;e.save(),this.setContext(e,!0);var{width:k}=e.measureText(t);return this.clearContext(e),e.restore(),k}getInheritedAttribute(e){for(var t=this;t instanceof QA&&t.isFirstChild();){var r=t.parent.getAttribute(e);if(r.hasValue(!0))return r.getValue("0");t=t.parent}return null}}class P0 extends QA{constructor(e,t,r){super(e,t,new.target===P0?!0:r),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}getText(){return this.text}}class Tve extends P0{constructor(){super(...arguments),this.type="textNode"}}class cm extends Dd{constructor(){super(...arguments),this.type="svg",this.root=!1}setContext(e){var t,{document:r}=this,{screen:n,window:o}=r,l=e.canvas;if(n.setDefaults(e),l.style&&typeof e.font<"u"&&o&&typeof o.getComputedStyle<"u"){e.font=o.getComputedStyle(l).getPropertyValue("font");var s=new wr(r,"fontSize",Ol.parse(e.font).fontSize);s.hasValue()&&(r.rootEmSize=s.getPixels("y"),r.emSize=r.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);var{width:g,height:b}=n.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");var T=this.getAttribute("refX"),F=this.getAttribute("refY"),k=this.getAttribute("viewBox"),z=k.hasValue()?Pc(k.getString()):null,J=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible",te=0,ue=0,ce=0,de=0;z&&(te=z[0],ue=z[1]),this.root||(g=this.getStyle("width").getPixels("x"),b=this.getStyle("height").getPixels("y"),this.type==="marker"&&(ce=te,de=ue,te=0,ue=0)),n.viewPort.setCurrent(g,b),this.node&&(!this.parent||((t=this.node.parentNode)===null||t===void 0?void 0:t.nodeName)==="foreignObject")&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(e),e.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),z&&(g=z[2],b=z[3]),r.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:n.viewPort.width,desiredWidth:g,height:n.viewPort.height,desiredHeight:b,minX:te,minY:ue,refX:T.getValue(),refY:F.getValue(),clip:J,clipX:ce,clipY:de}),z&&(n.viewPort.removeCurrent(),n.viewPort.setCurrent(g,b))}clearContext(e){super.clearContext(e),this.document.screen.viewPort.removeCurrent()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=this.getAttribute("width",!0),o=this.getAttribute("height",!0),l=this.getAttribute("viewBox"),s=this.getAttribute("style"),g=n.getNumber(0),b=o.getNumber(0);if(r)if(typeof r=="string")this.getAttribute("preserveAspectRatio",!0).setValue(r);else{var T=this.getAttribute("preserveAspectRatio");T.hasValue()&&T.setValue(T.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(n.setValue(e),o.setValue(t),l.hasValue()||l.setValue("0 0 ".concat(g||e," ").concat(b||t)),s.hasValue()){var F=this.getStyle("width"),k=this.getStyle("height");F.hasValue()&&F.setValue("".concat(e,"px")),k.hasValue()&&k.setValue("".concat(t,"px"))}}}class sI extends cs{constructor(){super(...arguments),this.type="rect"}path(e){var t=this.getAttribute("x").getPixels("x"),r=this.getAttribute("y").getPixels("y"),n=this.getStyle("width",!1,!0).getPixels("x"),o=this.getStyle("height",!1,!0).getPixels("y"),l=this.getAttribute("rx"),s=this.getAttribute("ry"),g=l.getPixels("x"),b=s.getPixels("y");if(l.hasValue()&&!s.hasValue()&&(b=g),s.hasValue()&&!l.hasValue()&&(g=b),g=Math.min(g,n/2),b=Math.min(b,o/2),e){var T=4*((Math.sqrt(2)-1)/3);e.beginPath(),o>0&&n>0&&(e.moveTo(t+g,r),e.lineTo(t+n-g,r),e.bezierCurveTo(t+n-g+T*g,r,t+n,r+b-T*b,t+n,r+b),e.lineTo(t+n,r+o-b),e.bezierCurveTo(t+n,r+o-b+T*b,t+n-g+T*g,r+o,t+n-g,r+o),e.lineTo(t+g,r+o),e.bezierCurveTo(t+g-T*g,r+o,t,r+o-b+T*b,t,r+o-b),e.lineTo(t,r+b),e.bezierCurveTo(t,r+b-T*b,t+g-T*g,r,t+g,r),e.closePath())}return new Du(t,r,t+n,r+o)}getMarkers(){return null}}class LN extends cs{constructor(){super(...arguments),this.type="circle"}path(e){var t=this.getAttribute("cx").getPixels("x"),r=this.getAttribute("cy").getPixels("y"),n=this.getAttribute("r").getPixels();return e&&n>0&&(e.beginPath(),e.arc(t,r,n,0,Math.PI*2,!1),e.closePath()),new Du(t-n,r-n,t+n,r+n)}getMarkers(){return null}}class MN extends cs{constructor(){super(...arguments),this.type="ellipse"}path(e){var t=4*((Math.sqrt(2)-1)/3),r=this.getAttribute("rx").getPixels("x"),n=this.getAttribute("ry").getPixels("y"),o=this.getAttribute("cx").getPixels("x"),l=this.getAttribute("cy").getPixels("y");return e&&r>0&&n>0&&(e.beginPath(),e.moveTo(o+r,l),e.bezierCurveTo(o+r,l+t*n,o+t*r,l+n,o,l+n),e.bezierCurveTo(o-t*r,l+n,o-r,l+t*n,o-r,l),e.bezierCurveTo(o-r,l-t*n,o-t*r,l-n,o,l-n),e.bezierCurveTo(o+t*r,l-n,o+r,l-t*n,o+r,l),e.closePath()),new Du(o-r,l-n,o+r,l+n)}getMarkers(){return null}}class PN extends cs{constructor(){super(...arguments),this.type="line"}getPoints(){return[new Eo(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new Eo(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(e){var[{x:t,y:r},{x:n,y:o}]=this.getPoints();return e&&(e.beginPath(),e.moveTo(t,r),e.lineTo(n,o)),new Du(t,r,n,o)}getMarkers(){var[e,t]=this.getPoints(),r=e.angleTo(t);return[[e,r],[t,r]]}}class oI extends cs{constructor(e,t,r){super(e,t,r),this.type="polyline",this.points=[],this.points=Eo.parsePath(this.getAttribute("points").getString())}path(e){var{points:t}=this,[{x:r,y:n}]=t,o=new Du(r,n);return e&&(e.beginPath(),e.moveTo(r,n)),t.forEach(l=>{var{x:s,y:g}=l;o.addPoint(s,g),e&&e.lineTo(s,g)}),o}getMarkers(){var{points:e}=this,t=e.length-1,r=[];return e.forEach((n,o)=>{o!==t&&r.push([n,n.angleTo(e[o+1])])}),r.length>0&&r.push([e[e.length-1],r[r.length-1][1]]),r}}class FN extends oI{constructor(){super(...arguments),this.type="polygon"}path(e){var t=super.path(e),[{x:r,y:n}]=this.points;return e&&(e.lineTo(r,n),e.closePath()),t}}class DN extends Hs{constructor(){super(...arguments),this.type="pattern"}createPattern(e,t,r){var n=this.getStyle("width").getPixels("x",!0),o=this.getStyle("height").getPixels("y",!0),l=new cm(this.document,null);l.attributes.viewBox=new wr(this.document,"viewBox",this.getAttribute("viewBox").getValue()),l.attributes.width=new wr(this.document,"width","".concat(n,"px")),l.attributes.height=new wr(this.document,"height","".concat(o,"px")),l.attributes.transform=new wr(this.document,"transform",this.getAttribute("patternTransform").getValue()),l.children=this.children;var s=this.document.createCanvas(n,o),g=s.getContext("2d"),b=this.getAttribute("x"),T=this.getAttribute("y");b.hasValue()&&T.hasValue()&&g.translate(b.getPixels("x",!0),T.getPixels("y",!0)),r.hasValue()?this.styles["fill-opacity"]=r:Reflect.deleteProperty(this.styles,"fill-opacity");for(var F=-1;F<=1;F++)for(var k=-1;k<=1;k++)g.save(),l.attributes.x=new wr(this.document,"x",F*s.width),l.attributes.y=new wr(this.document,"y",k*s.height),l.render(g),g.restore();var z=e.createPattern(s,"repeat");return z}}class RN extends Hs{constructor(){super(...arguments),this.type="marker"}render(e,t,r){if(t){var{x:n,y:o}=t,l=this.getAttribute("orient").getString("auto"),s=this.getAttribute("markerUnits").getString("strokeWidth");e.translate(n,o),l==="auto"&&e.rotate(r),s==="strokeWidth"&&e.scale(e.lineWidth,e.lineWidth),e.save();var g=new cm(this.document,null);g.type=this.type,g.attributes.viewBox=new wr(this.document,"viewBox",this.getAttribute("viewBox").getValue()),g.attributes.refX=new wr(this.document,"refX",this.getAttribute("refX").getValue()),g.attributes.refY=new wr(this.document,"refY",this.getAttribute("refY").getValue()),g.attributes.width=new wr(this.document,"width",this.getAttribute("markerWidth").getValue()),g.attributes.height=new wr(this.document,"height",this.getAttribute("markerHeight").getValue()),g.attributes.overflow=new wr(this.document,"overflow",this.getAttribute("overflow").getValue()),g.attributes.fill=new wr(this.document,"fill",this.getAttribute("fill").getColor("black")),g.attributes.stroke=new wr(this.document,"stroke",this.getAttribute("stroke").getValue("none")),g.children=this.children,g.render(e),e.restore(),s==="strokeWidth"&&e.scale(1/e.lineWidth,1/e.lineWidth),l==="auto"&&e.rotate(-r),e.translate(-n,-o)}}}class kN extends Hs{constructor(){super(...arguments),this.type="defs"}render(){}}class Yb extends Dd{constructor(){super(...arguments),this.type="g"}getBoundingBox(e){var t=new Du;return this.children.forEach(r=>{t.addBoundingBox(r.getBoundingBox(e))}),t}}class aI extends Hs{constructor(e,t,r){super(e,t,r),this.attributesToInherit=["gradientUnits"],this.stops=[];var{stops:n,children:o}=this;o.forEach(l=>{l.type==="stop"&&n.push(l)})}getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(e,t,r){var n=this;this.getHrefAttribute().hasValue()&&(n=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(n));var{stops:o}=n,l=this.getGradient(e,t);if(!l)return this.addParentOpacity(r,o[o.length-1].color);if(o.forEach(ue=>{l.addColorStop(ue.offset,this.addParentOpacity(r,ue.color))}),this.getAttribute("gradientTransform").hasValue()){var{document:s}=this,{MAX_VIRTUAL_PIXELS:g,viewPort:b}=s.screen,[T]=b.viewPorts,F=new sI(s,null);F.attributes.x=new wr(s,"x",-g/3),F.attributes.y=new wr(s,"y",-g/3),F.attributes.width=new wr(s,"width",g),F.attributes.height=new wr(s,"height",g);var k=new Yb(s,null);k.attributes.transform=new wr(s,"transform",this.getAttribute("gradientTransform").getValue()),k.children=[F];var z=new cm(s,null);z.attributes.x=new wr(s,"x",0),z.attributes.y=new wr(s,"y",0),z.attributes.width=new wr(s,"width",T.width),z.attributes.height=new wr(s,"height",T.height),z.children=[k];var J=s.createCanvas(T.width,T.height),te=J.getContext("2d");return te.fillStyle=l,z.render(te),te.createPattern(J,"no-repeat")}return l}inheritStopContainer(e){this.attributesToInherit.forEach(t=>{!this.getAttribute(t).hasValue()&&e.getAttribute(t).hasValue()&&this.getAttribute(t,!0).setValue(e.getAttribute(t).getValue())})}addParentOpacity(e,t){if(e.hasValue()){var r=new wr(this.document,"color",t);return r.addOpacity(e).getColor()}return t}}class ON extends aI{constructor(e,t,r){super(e,t,r),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}getGradient(e,t){var r=this.getGradientUnits()==="objectBoundingBox",n=r?t.getBoundingBox(e):null;if(r&&!n)return null;!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()&&(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));var o=r?n.x+n.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),l=r?n.y+n.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),s=r?n.x+n.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),g=r?n.y+n.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return o===s&&l===g?null:e.createLinearGradient(o,l,s,g)}}class UN extends aI{constructor(e,t,r){super(e,t,r),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}getGradient(e,t){var r=this.getGradientUnits()==="objectBoundingBox",n=t.getBoundingBox(e);if(r&&!n)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");var o=r?n.x+n.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),l=r?n.y+n.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y"),s=o,g=l;this.getAttribute("fx").hasValue()&&(s=r?n.x+n.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(g=r?n.y+n.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));var b=r?(n.width+n.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),T=this.getAttribute("fr").getPixels();return e.createRadialGradient(s,g,T,o,l,b)}}class NN extends Hs{constructor(e,t,r){super(e,t,r),this.type="stop";var n=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),o=this.getStyle("stop-opacity"),l=this.getStyle("stop-color",!0);l.getString()===""&&l.setValue("#000"),o.hasValue()&&(l=l.addOpacity(o)),this.offset=n,this.color=l.getColor()}}class ex extends Hs{constructor(e,t,r){super(e,t,r),this.type="animate",this.duration=0,this.initialValue=null,this.initialUnits="",this.removed=!1,this.frozen=!1,e.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new wr(e,"values",null);var n=this.getAttribute("values");n.hasValue()&&this.values.setValue(n.getString().split(";"))}getProperty(){var e=this.getAttribute("attributeType").getString(),t=this.getAttribute("attributeName").getString();return e==="CSS"?this.parent.getStyle(t,!0):this.parent.getAttribute(t,!0)}calcValue(){var{initialUnits:e}=this,{progress:t,from:r,to:n}=this.getProgress(),o=r.getNumber()+(n.getNumber()-r.getNumber())*t;return e==="%"&&(o*=100),"".concat(o).concat(e)}update(e){var{parent:t}=this,r=this.getProperty();if(this.initialValue||(this.initialValue=r.getString(),this.initialUnits=r.getUnits()),this.duration>this.maxDuration){var n=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(n==="freeze"&&!this.frozen)this.frozen=!0,t.animationFrozen=!0,t.animationFrozenValue=r.getString();else if(n==="remove"&&!this.removed)return this.removed=!0,r.setValue(t.animationFrozen?t.animationFrozenValue:this.initialValue),!0;return!1}this.duration+=e;var o=!1;if(this.begin<this.duration){var l=this.calcValue(),s=this.getAttribute("type");if(s.hasValue()){var g=s.getString();l="".concat(g,"(").concat(l,")")}r.setValue(l),o=!0}return o}getProgress(){var{document:e,values:t}=this,r={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(t.hasValue()){var n=r.progress*(t.getValue().length-1),o=Math.floor(n),l=Math.ceil(n);r.from=new wr(e,"from",parseFloat(t.getValue()[o])),r.to=new wr(e,"to",parseFloat(t.getValue()[l])),r.progress=(n-o)/(l-o)}else r.from=this.from,r.to=this.to;return r}}class zN extends ex{constructor(){super(...arguments),this.type="animateColor"}calcValue(){var{progress:e,from:t,to:r}=this.getProgress(),n=new QT(t.getColor()),o=new QT(r.getColor());if(n.ok&&o.ok){var l=n.r+(o.r-n.r)*e,s=n.g+(o.g-n.g)*e,g=n.b+(o.b-n.b)*e;return"rgb(".concat(Math.floor(l),", ").concat(Math.floor(s),", ").concat(Math.floor(g),")")}return this.getAttribute("from").getColor()}}class QN extends ex{constructor(){super(...arguments),this.type="animateTransform"}calcValue(){var{progress:e,from:t,to:r}=this.getProgress(),n=Pc(t.getString()),o=Pc(r.getString()),l=n.map((s,g)=>{var b=o[g];return s+(b-s)*e}).join(" ");return l}}class VN extends Hs{constructor(e,t,r){super(e,t,r),this.type="font",this.glyphs={},this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();var{definitions:n}=e,{children:o}=this;for(var l of o)switch(l.type){case"font-face":{this.fontFace=l;var s=l.getStyle("font-family");s.hasValue()&&(n[s.getString()]=this);break}case"missing-glyph":this.missingGlyph=l;break;case"glyph":{var g=l;g.arabicForm?(this.isRTL=!0,this.isArabic=!0,typeof this.glyphs[g.unicode]>"u"&&(this.glyphs[g.unicode]={}),this.glyphs[g.unicode][g.arabicForm]=g):this.glyphs[g.unicode]=g;break}}}render(){}}class HN extends Hs{constructor(e,t,r){super(e,t,r),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class GN extends cs{constructor(){super(...arguments),this.type="missing-glyph",this.horizAdvX=0}}class jN extends QA{constructor(){super(...arguments),this.type="tref"}getText(){var e=this.getHrefAttribute().getDefinition();if(e){var t=e.children[0];if(t)return t.getText()}return""}}class qN extends QA{constructor(e,t,r){super(e,t,r),this.type="a";var{childNodes:n}=t,o=n[0],l=n.length>0&&Array.from(n).every(s=>s.nodeType===3);this.hasText=l,this.text=l?this.getTextFromNode(o):""}getText(){return this.text}renderChildren(e){if(this.hasText){super.renderChildren(e);var{document:t,x:r,y:n}=this,{mouse:o}=t.screen,l=new wr(t,"fontSize",Ol.parse(t.ctx.font).fontSize);o.isWorking()&&o.checkBoundingBox(this,new Du(r,n-l.getPixels("y"),r+this.measureText(e),n))}else if(this.children.length>0){var s=new Yb(this.document,null);s.children=this.children,s.parent=this,s.render(e)}}onClick(){var{window:e}=this.document;e&&e.open(this.getHrefAttribute().getString())}onMouseMove(){var e=this.document.ctx;e.canvas.style.cursor="pointer"}}function $N(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function tx(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?$N(Object(t),!0).forEach(function(r){DT(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):$N(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}class KN extends QA{constructor(e,t,r){super(e,t,r),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);var n=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(n)}getText(){return this.text}path(e){var{dataArray:t}=this;e&&e.beginPath(),t.forEach(r=>{var{type:n,points:o}=r;switch(n){case Yr.LINE_TO:e&&e.lineTo(o[0],o[1]);break;case Yr.MOVE_TO:e&&e.moveTo(o[0],o[1]);break;case Yr.CURVE_TO:e&&e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case Yr.QUAD_TO:e&&e.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case Yr.ARC:{var[l,s,g,b,T,F,k,z]=o,J=g>b?g:b,te=g>b?1:g/b,ue=g>b?b/g:1;e&&(e.translate(l,s),e.rotate(k),e.scale(te,ue),e.arc(0,0,J,T,T+F,!!(1-z)),e.scale(1/te,1/ue),e.rotate(-k),e.translate(-l,-s));break}case Yr.CLOSE_PATH:e&&e.closePath();break}})}renderChildren(e){this.setTextData(e),e.save();var t=this.parent.getStyle("text-decoration").getString(),r=this.getFontSize(),{glyphInfo:n}=this,o=e.fillStyle;t==="underline"&&e.beginPath(),n.forEach((l,s)=>{var{p0:g,p1:b,rotation:T,text:F}=l;e.save(),e.translate(g.x,g.y),e.rotate(T),e.fillStyle&&e.fillText(F,0,0),e.strokeStyle&&e.strokeText(F,0,0),e.restore(),t==="underline"&&(s===0&&e.moveTo(g.x,g.y+r/8),e.lineTo(b.x,b.y+r/5))}),t==="underline"&&(e.lineWidth=r/20,e.strokeStyle=o,e.stroke(),e.closePath()),e.restore()}getLetterSpacingAt(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[e]||0}findSegmentToFitChar(e,t,r,n,o,l,s,g,b){var T=l,F=this.measureText(e,g);g===" "&&t==="justify"&&r<n&&(F+=(n-r)/o),b>-1&&(T+=this.getLetterSpacingAt(b));var k=this.textHeight/20,z=this.getEquidistantPointOnPath(T,k,0),J=this.getEquidistantPointOnPath(T+F,k,0),te={p0:z,p1:J},ue=z&&J?Math.atan2(J.y-z.y,J.x-z.x):0;if(s){var ce=Math.cos(Math.PI/2+ue)*s,de=Math.cos(-ue)*s;te.p0=tx(tx({},z),{},{x:z.x+ce,y:z.y+de}),te.p1=tx(tx({},J),{},{x:J.x+ce,y:J.y+de})}return T+=F,{offset:T,segment:te,rotation:ue}}measureText(e,t){var{measuresCache:r}=this,n=t||this.getText();if(r.has(n))return r.get(n);var o=this.measureTargetText(e,n);return r.set(n,o),o}setTextData(e){if(!this.glyphInfo){var t=this.getText(),r=t.split(""),n=t.split(" ").length-1,o=this.parent.getAttribute("dx").split().map(Ee=>Ee.getPixels("x")),l=this.parent.getAttribute("dy").getPixels("y"),s=this.parent.getStyle("text-anchor").getString("start"),g=this.getStyle("letter-spacing"),b=this.parent.getStyle("letter-spacing"),T=0;!g.hasValue()||g.getValue()==="inherit"?T=b.getPixels():g.hasValue()&&g.getValue()!=="initial"&&g.getValue()!=="unset"&&(T=g.getPixels());var F=[],k=t.length;this.letterSpacingCache=F;for(var z=0;z<k;z++)F.push(typeof o[z]<"u"?o[z]:T);var J=F.reduce((Ee,He,Ve)=>Ve===0?0:Ee+He||0,0),te=this.measureText(e),ue=Math.max(te+J,0);this.textWidth=te,this.textHeight=this.getFontSize(),this.glyphInfo=[];var ce=this.getPathLength(),de=this.getStyle("startOffset").getNumber(0)*ce,_e=0;(s==="middle"||s==="center")&&(_e=-ue/2),(s==="end"||s==="right")&&(_e=-ue),_e+=de,r.forEach((Ee,He)=>{var{offset:Ve,segment:qe,rotation:Ue}=this.findSegmentToFitChar(e,s,ue,ce,n,_e,l,Ee,He);_e=Ve,!(!qe.p0||!qe.p1)&&this.glyphInfo.push({text:r[He],p0:qe.p0,p1:qe.p1,rotation:Ue})})}}parsePathData(e){if(this.pathLength=-1,!e)return[];var t=[],{pathParser:r}=e;for(r.reset();!r.isEnd();){var{current:n}=r,o=n?n.x:0,l=n?n.y:0,s=r.next(),g=s.type,b=[];switch(s.type){case Yr.MOVE_TO:this.pathM(r,b);break;case Yr.LINE_TO:g=this.pathL(r,b);break;case Yr.HORIZ_LINE_TO:g=this.pathH(r,b);break;case Yr.VERT_LINE_TO:g=this.pathV(r,b);break;case Yr.CURVE_TO:this.pathC(r,b);break;case Yr.SMOOTH_CURVE_TO:g=this.pathS(r,b);break;case Yr.QUAD_TO:this.pathQ(r,b);break;case Yr.SMOOTH_QUAD_TO:g=this.pathT(r,b);break;case Yr.ARC:b=this.pathA(r);break;case Yr.CLOSE_PATH:cs.pathZ(r);break}s.type!==Yr.CLOSE_PATH?t.push({type:g,points:b,start:{x:o,y:l},pathLength:this.calcLength(o,l,g,b)}):t.push({type:Yr.CLOSE_PATH,points:[],pathLength:0})}return t}pathM(e,t){var{x:r,y:n}=cs.pathM(e).point;t.push(r,n)}pathL(e,t){var{x:r,y:n}=cs.pathL(e).point;return t.push(r,n),Yr.LINE_TO}pathH(e,t){var{x:r,y:n}=cs.pathH(e).point;return t.push(r,n),Yr.LINE_TO}pathV(e,t){var{x:r,y:n}=cs.pathV(e).point;return t.push(r,n),Yr.LINE_TO}pathC(e,t){var{point:r,controlPoint:n,currentPoint:o}=cs.pathC(e);t.push(r.x,r.y,n.x,n.y,o.x,o.y)}pathS(e,t){var{point:r,controlPoint:n,currentPoint:o}=cs.pathS(e);return t.push(r.x,r.y,n.x,n.y,o.x,o.y),Yr.CURVE_TO}pathQ(e,t){var{controlPoint:r,currentPoint:n}=cs.pathQ(e);t.push(r.x,r.y,n.x,n.y)}pathT(e,t){var{controlPoint:r,currentPoint:n}=cs.pathT(e);return t.push(r.x,r.y,n.x,n.y),Yr.QUAD_TO}pathA(e){var{rX:t,rY:r,sweepFlag:n,xAxisRotation:o,centp:l,a1:s,ad:g}=cs.pathA(e);return n===0&&g>0&&(g-=2*Math.PI),n===1&&g<0&&(g+=2*Math.PI),[l.x,l.y,t,r,s,g,o,n]}calcLength(e,t,r,n){var o=0,l=null,s=null,g=0;switch(r){case Yr.LINE_TO:return this.getLineLength(e,t,n[0],n[1]);case Yr.CURVE_TO:for(o=0,l=this.getPointOnCubicBezier(0,e,t,n[0],n[1],n[2],n[3],n[4],n[5]),g=.01;g<=1;g+=.01)s=this.getPointOnCubicBezier(g,e,t,n[0],n[1],n[2],n[3],n[4],n[5]),o+=this.getLineLength(l.x,l.y,s.x,s.y),l=s;return o;case Yr.QUAD_TO:for(o=0,l=this.getPointOnQuadraticBezier(0,e,t,n[0],n[1],n[2],n[3]),g=.01;g<=1;g+=.01)s=this.getPointOnQuadraticBezier(g,e,t,n[0],n[1],n[2],n[3]),o+=this.getLineLength(l.x,l.y,s.x,s.y),l=s;return o;case Yr.ARC:{o=0;var b=n[4],T=n[5],F=n[4]+T,k=Math.PI/180;if(Math.abs(b-F)<k&&(k=Math.abs(b-F)),l=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],b,0),T<0)for(g=b-k;g>F;g-=k)s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],g,0),o+=this.getLineLength(l.x,l.y,s.x,s.y),l=s;else for(g=b+k;g<F;g+=k)s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],g,0),o+=this.getLineLength(l.x,l.y,s.x,s.y),l=s;return s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],F,0),o+=this.getLineLength(l.x,l.y,s.x,s.y),o}}return 0}getPointOnLine(e,t,r,n,o){var l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:t,s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:r,g=(o-r)/(n-t+Wf),b=Math.sqrt(e*e/(1+g*g));n<t&&(b*=-1);var T=g*b,F=null;if(n===t)F={x:l,y:s+T};else if((s-r)/(l-t+Wf)===g)F={x:l+b,y:s+T};else{var k=0,z=0,J=this.getLineLength(t,r,n,o);if(J<Wf)return null;var te=(l-t)*(n-t)+(s-r)*(o-r);te/=J*J,k=t+te*(n-t),z=r+te*(o-r);var ue=this.getLineLength(l,s,k,z),ce=Math.sqrt(e*e-ue*ue);b=Math.sqrt(ce*ce/(1+g*g)),n<t&&(b*=-1),T=g*b,F={x:k+b,y:z+T}}return F}getPointOnPath(e){var t=this.getPathLength(),r=0,n=null;if(e<-5e-5||e-5e-5>t)return null;var{dataArray:o}=this;for(var l of o){if(l&&(l.pathLength<5e-5||r+l.pathLength+5e-5<e)){r+=l.pathLength;continue}var s=e-r,g=0;switch(l.type){case Yr.LINE_TO:n=this.getPointOnLine(s,l.start.x,l.start.y,l.points[0],l.points[1],l.start.x,l.start.y);break;case Yr.ARC:{var b=l.points[4],T=l.points[5],F=l.points[4]+T;if(g=b+s/l.pathLength*T,T<0&&g<F||T>=0&&g>F)break;n=this.getPointOnEllipticalArc(l.points[0],l.points[1],l.points[2],l.points[3],g,l.points[6]);break}case Yr.CURVE_TO:g=s/l.pathLength,g>1&&(g=1),n=this.getPointOnCubicBezier(g,l.start.x,l.start.y,l.points[0],l.points[1],l.points[2],l.points[3],l.points[4],l.points[5]);break;case Yr.QUAD_TO:g=s/l.pathLength,g>1&&(g=1),n=this.getPointOnQuadraticBezier(g,l.start.x,l.start.y,l.points[0],l.points[1],l.points[2],l.points[3]);break}if(n)return n;break}return null}getLineLength(e,t,r,n){return Math.sqrt((r-e)*(r-e)+(n-t)*(n-t))}getPathLength(){return this.pathLength===-1&&(this.pathLength=this.dataArray.reduce((e,t)=>t.pathLength>0?e+t.pathLength:e,0)),this.pathLength}getPointOnCubicBezier(e,t,r,n,o,l,s,g,b){var T=g*WT(e)+l*XT(e)+n*ZT(e)+t*JT(e),F=b*WT(e)+s*XT(e)+o*ZT(e)+r*JT(e);return{x:T,y:F}}getPointOnQuadraticBezier(e,t,r,n,o,l,s){var g=l*YT(e)+n*eI(e)+t*tI(e),b=s*YT(e)+o*eI(e)+r*tI(e);return{x:g,y:b}}getPointOnEllipticalArc(e,t,r,n,o,l){var s=Math.cos(l),g=Math.sin(l),b={x:r*Math.cos(o),y:n*Math.sin(o)};return{x:e+(b.x*s-b.y*g),y:t+(b.x*g+b.y*s)}}buildEquidistantCache(e,t){var r=this.getPathLength(),n=t||.25,o=e||r/100;if(!this.equidistantCache||this.equidistantCache.step!==o||this.equidistantCache.precision!==n){this.equidistantCache={step:o,precision:n,points:[]};for(var l=0,s=0;s<=r;s+=n){var g=this.getPointOnPath(s),b=this.getPointOnPath(s+n);!g||!b||(l+=this.getLineLength(g.x,g.y,b.x,b.y),l>=o&&(this.equidistantCache.points.push({x:g.x,y:g.y,distance:s}),l-=o))}}}getEquidistantPointOnPath(e,t,r){if(this.buildEquidistantCache(t,r),e<0||e-this.getPathLength()>5e-5)return null;var n=Math.round(e/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[n]||null}}var Ive=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class WN extends Dd{constructor(e,t,r){super(e,t,r),this.type="image",this.loaded=!1;var n=this.getHrefAttribute().getString();if(n){var o=n.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(n);e.images.push(this),o?this.loadSvg(n):this.loadImage(n),this.isSvg=o}}loadImage(e){var t=this;return UA(function*(){try{var r=yield t.document.createImage(e);t.image=r}catch(n){console.error('Error while loading image "'.concat(e,'":'),n)}t.loaded=!0})()}loadSvg(e){var t=this;return UA(function*(){var r=Ive.exec(e);if(r){var n=r[5];r[4]==="base64"?t.image=atob(n):t.image=decodeURIComponent(n)}else try{var o=yield t.document.fetch(e),l=yield o.text();t.image=l}catch(s){console.error('Error while loading image "'.concat(e,'":'),s)}t.loaded=!0})()}renderChildren(e){var{document:t,image:r,loaded:n}=this,o=this.getAttribute("x").getPixels("x"),l=this.getAttribute("y").getPixels("y"),s=this.getStyle("width").getPixels("x"),g=this.getStyle("height").getPixels("y");if(!(!n||!r||!s||!g)){if(e.save(),e.translate(o,l),this.isSvg){var b=t.canvg.forkString(e,this.image,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:s,scaleHeight:g});b.document.documentElement.parent=this,b.render()}else{var T=this.image;t.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:s,desiredWidth:T.width,height:g,desiredHeight:T.height}),this.loaded&&(typeof T.complete>"u"||T.complete)&&e.drawImage(T,0,0)}e.restore()}}getBoundingBox(){var e=this.getAttribute("x").getPixels("x"),t=this.getAttribute("y").getPixels("y"),r=this.getStyle("width").getPixels("x"),n=this.getStyle("height").getPixels("y");return new Du(e,t,e+r,t+n)}}class XN extends Dd{constructor(){super(...arguments),this.type="symbol"}render(e){}}class ZN{constructor(e){this.document=e,this.loaded=!1,e.fonts.push(this)}load(e,t){var r=this;return UA(function*(){try{var{document:n}=r,o=yield n.canvg.parser.load(t),l=o.getElementsByTagName("font");Array.from(l).forEach(s=>{var g=n.createElement(s);n.definitions[e]=g})}catch(s){console.error('Error while loading font "'.concat(t,'":'),s)}r.loaded=!0})()}}class lI extends Hs{constructor(e,t,r){super(e,t,r),this.type="style";var n=$f(Array.from(t.childNodes).map(l=>l.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")),o=n.split("}");o.forEach(l=>{var s=l.trim();if(s){var g=s.split("{"),b=g[0].split(","),T=g[1].split(";");b.forEach(F=>{var k=F.trim();if(k){var z=e.styles[k]||{};if(T.forEach(ue=>{var ce=ue.indexOf(":"),de=ue.substr(0,ce).trim(),_e=ue.substr(ce+1,ue.length-ce).trim();de&&_e&&(z[de]=new wr(e,de,_e))}),e.styles[k]=z,e.stylesSpecificity[k]=_N(k),k==="@font-face"){var J=z["font-family"].getString().replace(/"|'/g,""),te=z.src.getString().split(",");te.forEach(ue=>{if(ue.indexOf('format("svg")')>0){var ce=qT(ue);ce&&new ZN(e).load(J,ce)}})}}})}})}}lI.parseExternalUrl=qT;class JN extends Dd{constructor(){super(...arguments),this.type="use"}setContext(e){super.setContext(e);var t=this.getAttribute("x"),r=this.getAttribute("y");t.hasValue()&&e.translate(t.getPixels("x"),0),r.hasValue()&&e.translate(0,r.getPixels("y"))}path(e){var{element:t}=this;t&&t.path(e)}renderChildren(e){var{document:t,element:r}=this;if(r){var n=r;if(r.type==="symbol"&&(n=new cm(t,null),n.attributes.viewBox=new wr(t,"viewBox",r.getAttribute("viewBox").getString()),n.attributes.preserveAspectRatio=new wr(t,"preserveAspectRatio",r.getAttribute("preserveAspectRatio").getString()),n.attributes.overflow=new wr(t,"overflow",r.getAttribute("overflow").getString()),n.children=r.children,r.styles.opacity=new wr(t,"opacity",this.calculateOpacity())),n.type==="svg"){var o=this.getStyle("width",!1,!0),l=this.getStyle("height",!1,!0);o.hasValue()&&(n.attributes.width=new wr(t,"width",o.getString())),l.hasValue()&&(n.attributes.height=new wr(t,"height",l.getString()))}var s=n.parent;n.parent=this,n.render(e),n.parent=s}}getBoundingBox(e){var{element:t}=this;return t?t.getBoundingBox(e):null}elementTransform(){var{document:e,element:t}=this;return Fd.fromElement(e,t)}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}}function ix(i,e,t,r,n,o){return i[t*r*4+e*4+o]}function rx(i,e,t,r,n,o,l){i[t*r*4+e*4+o]=l}function la(i,e,t){var r=i[e];return r*t}function VA(i,e,t,r){return e+Math.cos(i)*t+Math.sin(i)*r}class cI extends Hs{constructor(e,t,r){super(e,t,r),this.type="feColorMatrix";var n=Pc(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{var o=n[0];n=[.213+.787*o,.715-.715*o,.072-.072*o,0,0,.213-.213*o,.715+.285*o,.072-.072*o,0,0,.213-.213*o,.715-.715*o,.072+.928*o,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{var l=n[0]*Math.PI/180;n=[VA(l,.213,.787,-.213),VA(l,.715,-.715,-.715),VA(l,.072,-.072,.928),0,0,VA(l,.213,-.213,.143),VA(l,.715,.285,.14),VA(l,.072,-.072,-.283),0,0,VA(l,.213,-.213,-.787),VA(l,.715,-.715,.715),VA(l,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=n,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}apply(e,t,r,n,o){for(var{includeOpacity:l,matrix:s}=this,g=e.getImageData(0,0,n,o),b=0;b<o;b++)for(var T=0;T<n;T++){var F=ix(g.data,T,b,n,o,0),k=ix(g.data,T,b,n,o,1),z=ix(g.data,T,b,n,o,2),J=ix(g.data,T,b,n,o,3),te=la(s,0,F)+la(s,1,k)+la(s,2,z)+la(s,3,J)+la(s,4,1),ue=la(s,5,F)+la(s,6,k)+la(s,7,z)+la(s,8,J)+la(s,9,1),ce=la(s,10,F)+la(s,11,k)+la(s,12,z)+la(s,13,J)+la(s,14,1),de=la(s,15,F)+la(s,16,k)+la(s,17,z)+la(s,18,J)+la(s,19,1);l&&(te=0,ue=0,ce=0,de*=J/255),rx(g.data,T,b,n,o,0,te),rx(g.data,T,b,n,o,1,ue),rx(g.data,T,b,n,o,2,ce),rx(g.data,T,b,n,o,3,de)}e.clearRect(0,0,n,o),e.putImageData(g,0,0)}}class F0 extends Hs{constructor(){super(...arguments),this.type="mask"}apply(e,t){var{document:r}=this,n=this.getAttribute("x").getPixels("x"),o=this.getAttribute("y").getPixels("y"),l=this.getStyle("width").getPixels("x"),s=this.getStyle("height").getPixels("y");if(!l&&!s){var g=new Du;this.children.forEach(J=>{g.addBoundingBox(J.getBoundingBox(e))}),n=Math.floor(g.x1),o=Math.floor(g.y1),l=Math.floor(g.width),s=Math.floor(g.height)}var b=this.removeStyles(t,F0.ignoreStyles),T=r.createCanvas(n+l,o+s),F=T.getContext("2d");r.screen.setDefaults(F),this.renderChildren(F),new cI(r,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(F,0,0,n+l,o+s);var k=r.createCanvas(n+l,o+s),z=k.getContext("2d");r.screen.setDefaults(z),t.render(z),z.globalCompositeOperation="destination-in",z.fillStyle=F.createPattern(T,"no-repeat"),z.fillRect(0,0,n+l,o+s),e.fillStyle=z.createPattern(k,"no-repeat"),e.fillRect(0,0,n+l,o+s),this.restoreStyles(t,b)}render(e){}}F0.ignoreStyles=["mask","transform","clip-path"];var YN=()=>{};class ez extends Hs{constructor(){super(...arguments),this.type="clipPath"}apply(e){var{document:t}=this,r=Reflect.getPrototypeOf(e),{beginPath:n,closePath:o}=e;r&&(r.beginPath=YN,r.closePath=YN),Reflect.apply(n,e,[]),this.children.forEach(l=>{if(!(typeof l.path>"u")){var s=typeof l.elementTransform<"u"?l.elementTransform():null;s||(s=Fd.fromElement(t,l)),s&&s.apply(e),l.path(e),r&&(r.closePath=o),s&&s.unapply(e)}}),Reflect.apply(o,e,[]),e.clip(),r&&(r.beginPath=n,r.closePath=o)}render(e){}}class D0 extends Hs{constructor(){super(...arguments),this.type="filter"}apply(e,t){var{document:r,children:n}=this,o=t.getBoundingBox(e);if(o){var l=0,s=0;n.forEach(ce=>{var de=ce.extraFilterDistance||0;l=Math.max(l,de),s=Math.max(s,de)});var g=Math.floor(o.width),b=Math.floor(o.height),T=g+2*l,F=b+2*s;if(!(T<1||F<1)){var k=Math.floor(o.x),z=Math.floor(o.y),J=this.removeStyles(t,D0.ignoreStyles),te=r.createCanvas(T,F),ue=te.getContext("2d");r.screen.setDefaults(ue),ue.translate(-k+l,-z+s),t.render(ue),n.forEach(ce=>{typeof ce.apply=="function"&&ce.apply(ue,0,0,T,F)}),e.drawImage(te,0,0,T,F,k-l,z-s,T,F),this.restoreStyles(t,J)}}}render(e){}}D0.ignoreStyles=["filter","transform","clip-path"];class tz extends Hs{constructor(e,t,r){super(e,t,r),this.type="feDropShadow",this.addStylesFromStyleDefinition()}apply(e,t,r,n,o){}}class iz extends Hs{constructor(){super(...arguments),this.type="feMorphology"}apply(e,t,r,n,o){}}class rz extends Hs{constructor(){super(...arguments),this.type="feComposite"}apply(e,t,r,n,o){}}class nz extends Hs{constructor(e,t,r){super(e,t,r),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}apply(e,t,r,n,o){var{document:l,blurRadius:s}=this,g=l.window?l.window.document.body:null,b=e.canvas;b.id=l.getUniqueId(),g&&(b.style.display="none",g.appendChild(b)),ave(b,t,r,n,o,s),g&&g.removeChild(b)}}class sz extends Hs{constructor(){super(...arguments),this.type="title"}}class oz extends Hs{constructor(){super(...arguments),this.type="desc"}}var Lve={svg:cm,rect:sI,circle:LN,ellipse:MN,line:PN,polyline:oI,polygon:FN,path:cs,pattern:DN,marker:RN,defs:kN,linearGradient:ON,radialGradient:UN,stop:NN,animate:ex,animateColor:zN,animateTransform:QN,font:VN,"font-face":HN,"missing-glyph":GN,glyph:nI,text:QA,tspan:P0,tref:jN,a:qN,textPath:KN,image:WN,g:Yb,symbol:XN,style:lI,use:JN,mask:F0,clipPath:ez,filter:D0,feDropShadow:tz,feMorphology:iz,feComposite:rz,feColorMatrix:cI,feGaussianBlur:nz,title:sz,desc:oz};function az(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function Mve(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?az(Object(t),!0).forEach(function(r){DT(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):az(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}function Pve(i,e){var t=document.createElement("canvas");return t.width=i,t.height=e,t}function Fve(i){return uI.apply(this,arguments)}function uI(){return uI=UA(function*(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=document.createElement("img");return e&&(t.crossOrigin="Anonymous"),new Promise((r,n)=>{t.onload=()=>{r(t)},t.onerror=(o,l,s,g,b)=>{n(b)},t.src=i})}),uI.apply(this,arguments)}class HA{constructor(e){var{rootEmSize:t=12,emSize:r=12,createCanvas:n=HA.createCanvas,createImage:o=HA.createImage,anonymousCrossOrigin:l}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.canvg=e,this.definitions={},this.styles={},this.stylesSpecificity={},this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=e.screen,this.rootEmSize=t,this.emSize=r,this.createCanvas=n,this.createImage=this.bindCreateImage(o,l),this.screen.wait(this.isImagesLoaded.bind(this)),this.screen.wait(this.isFontsLoaded.bind(this))}bindCreateImage(e,t){return typeof t=="boolean"?(r,n)=>e(r,typeof n=="boolean"?n:t):e}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){var{emSizeStack:e}=this;return e[e.length-1]}set emSize(e){var{emSizeStack:t}=this;t.push(e)}popEmSize(){var{emSizeStack:e}=this;e.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(e=>e.loaded)}isFontsLoaded(){return this.fonts.every(e=>e.loaded)}createDocumentElement(e){var t=this.createElement(e.documentElement);return t.root=!0,t.addStylesFromStyleDefinition(),this.documentElement=t,t}createElement(e){var t=e.nodeName.replace(/^[^:]+:/,""),r=HA.elementTypes[t];return typeof r<"u"?new r(this,e):new IN(this,e)}createTextNode(e){return new Tve(this,e)}setViewBox(e){this.screen.setViewBox(Mve({document:this},e))}}HA.createCanvas=Pve,HA.createImage=Fve,HA.elementTypes=Lve;function lz(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,r)}return t}function Xf(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?lz(Object(t),!0).forEach(function(r){DT(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):lz(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}class Zf{constructor(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.parser=new Jb(r),this.screen=new M0(e,r),this.options=r;var n=new HA(this,r),o=n.createDocumentElement(t);this.document=n,this.documentElement=o}static from(e,t){var r=arguments;return UA(function*(){var n=r.length>2&&r[2]!==void 0?r[2]:{},o=new Jb(n),l=yield o.parse(t);return new Zf(e,l,n)})()}static fromString(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=new Jb(r),o=n.parseFromString(t);return new Zf(e,o,r)}fork(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Zf.from(e,t,Xf(Xf({},this.options),r))}forkString(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Zf.fromString(e,t,Xf(Xf({},this.options),r))}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}render(){var e=arguments,t=this;return UA(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:{};t.start(Xf({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0},r)),yield t.ready(),t.stop()})()}start(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{documentElement:t,screen:r,options:n}=this;r.start(t,Xf(Xf({enableRedraw:!0},n),e))}stop(){this.screen.stop()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.documentElement.resize(e,t,r)}}const Dve=Object.freeze(Object.defineProperty({__proto__:null,AElement:qN,AnimateColorElement:zN,AnimateElement:ex,AnimateTransformElement:QN,BoundingBox:Du,CB1:WT,CB2:XT,CB3:ZT,CB4:JT,Canvg:Zf,CircleElement:LN,ClipPathElement:ez,DefsElement:kN,DescElement:oz,Document:HA,Element:Hs,EllipseElement:MN,FeColorMatrixElement:cI,FeCompositeElement:rz,FeDropShadowElement:tz,FeGaussianBlurElement:nz,FeMorphologyElement:iz,FilterElement:D0,Font:Ol,FontElement:VN,FontFaceElement:HN,GElement:Yb,GlyphElement:nI,GradientElement:aI,ImageElement:WN,LineElement:PN,LinearGradientElement:ON,MarkerElement:RN,MaskElement:F0,Matrix:iI,MissingGlyphElement:GN,Mouse:bN,PSEUDO_ZERO:Wf,Parser:Jb,PathElement:cs,PathParser:Yr,PatternElement:DN,Point:Eo,PolygonElement:FN,PolylineElement:oI,Property:wr,QB1:YT,QB2:eI,QB3:tI,RadialGradientElement:UN,RectElement:sI,RenderedElement:Dd,Rotate:CN,SVGElement:cm,SVGFontLoader:ZN,Scale:EN,Screen:M0,Skew:rI,SkewX:SN,SkewY:TN,StopElement:NN,StyleElement:lI,SymbolElement:XN,TRefElement:jN,TSpanElement:P0,TextElement:QA,TextPathElement:KN,TitleElement:sz,Transform:Fd,Translate:BN,UnknownElement:IN,UseElement:JN,ViewPort:vN,compressSpaces:$f,default:Zf,getSelectorSpecificity:_N,normalizeAttributeName:mN,normalizeColor:yN,parseExternalUrl:qT,presets:hve,toNumbers:Pc,trimLeft:pN,trimRight:gN,vectorMagnitude:$T,vectorsAngle:KT,vectorsRatio:Zb},Symbol.toStringTag,{value:"Module"}));Rh.CompareMaps=Fne,Rh.Layers=Ga,Rh.Map=Sne,Rh.Styles=Pg,Rh.Terrains=cv,Object.defineProperty(Rh,Symbol.toStringTag,{value:"Module"})});
