(function(CA,Sf){typeof exports=="object"&&typeof module<"u"?Sf(exports):typeof define=="function"&&define.amd?define(["exports"],Sf):(CA=typeof globalThis<"u"?globalThis:CA||self,Sf(CA.mapicgcgl={}))})(this,function(CA){"use strict";function Sf(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var by={exports:{}},z9=by.exports,OI;function Q9(){return OI||(OI=1,function(r,e){(function(t,n){r.exports=n()})(z9,function(){var t={},n={};function i(a,o,u){if(n[a]=u,a==="index"){var d="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",p={};return n.shared(p),n.index(t,p),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([d],{type:"text/javascript"}))),t}}i("shared",["exports"],function(a){function o(A,c,h,g){return new(h||(h=Promise))(function(_,x){function T(U){try{F(g.next(U))}catch(z){x(z)}}function S(U){try{F(g.throw(U))}catch(z){x(z)}}function F(U){var z;U.done?_(U.value):(z=U.value,z instanceof h?z:new h(function(K){K(z)})).then(T,S)}F((g=g.apply(A,c||[])).next())})}function u(A,c){this.x=A,this.y=c}function d(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}var p,b;typeof SuppressedError=="function"&&SuppressedError,u.prototype={clone(){return new u(this.x,this.y)},add(A){return this.clone()._add(A)},sub(A){return this.clone()._sub(A)},multByPoint(A){return this.clone()._multByPoint(A)},divByPoint(A){return this.clone()._divByPoint(A)},mult(A){return this.clone()._mult(A)},div(A){return this.clone()._div(A)},rotate(A){return this.clone()._rotate(A)},rotateAround(A,c){return this.clone()._rotateAround(A,c)},matMult(A){return this.clone()._matMult(A)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(A){return this.x===A.x&&this.y===A.y},dist(A){return Math.sqrt(this.distSqr(A))},distSqr(A){const c=A.x-this.x,h=A.y-this.y;return c*c+h*h},angle(){return Math.atan2(this.y,this.x)},angleTo(A){return Math.atan2(this.y-A.y,this.x-A.x)},angleWith(A){return this.angleWithSep(A.x,A.y)},angleWithSep(A,c){return Math.atan2(this.x*c-this.y*A,this.x*A+this.y*c)},_matMult(A){const c=A[2]*this.x+A[3]*this.y;return this.x=A[0]*this.x+A[1]*this.y,this.y=c,this},_add(A){return this.x+=A.x,this.y+=A.y,this},_sub(A){return this.x-=A.x,this.y-=A.y,this},_mult(A){return this.x*=A,this.y*=A,this},_div(A){return this.x/=A,this.y/=A,this},_multByPoint(A){return this.x*=A.x,this.y*=A.y,this},_divByPoint(A){return this.x/=A.x,this.y/=A.y,this},_unit(){return this._div(this.mag()),this},_perp(){const A=this.y;return this.y=this.x,this.x=-A,this},_rotate(A){const c=Math.cos(A),h=Math.sin(A),g=h*this.x+c*this.y;return this.x=c*this.x-h*this.y,this.y=g,this},_rotateAround(A,c){const h=Math.cos(A),g=Math.sin(A),_=c.y+g*(this.x-c.x)+h*(this.y-c.y);return this.x=c.x+h*(this.x-c.x)-g*(this.y-c.y),this.y=_,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:u},u.convert=function(A){if(A instanceof u)return A;if(Array.isArray(A))return new u(+A[0],+A[1]);if(A.x!==void 0&&A.y!==void 0)return new u(+A.x,+A.y);throw new Error("Expected [x, y] or {x, y} point format")};var C=function(){if(b)return p;function A(c,h,g,_){this.cx=3*c,this.bx=3*(g-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(_-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=h,this.p2x=g,this.p2y=_}return b=1,p=A,A.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,h){if(h===void 0&&(h=1e-6),c<0)return 0;if(c>1)return 1;for(var g=c,_=0;_<8;_++){var x=this.sampleCurveX(g)-c;if(Math.abs(x)<h)return g;var T=this.sampleCurveDerivativeX(g);if(Math.abs(T)<1e-6)break;g-=x/T}var S=0,F=1;for(g=c,_=0;_<20&&(x=this.sampleCurveX(g),!(Math.abs(x-c)<h));_++)c>x?S=g:F=g,g=.5*(F-S)+S;return g},solve:function(c,h){return this.sampleCurveY(this.solveCurveX(c,h))}},p}(),w=d(C);let M,P;function k(){return M==null&&(M=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),M}function D(){if(P==null&&(P=!1,k())){const c=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(c){for(let g=0;g<5*5;g++){const _=4*g;c.fillStyle=`rgb(${_},${_+1},${_+2})`,c.fillRect(g%5,Math.floor(g/5),1,1)}const h=c.getImageData(0,0,5,5).data;for(let g=0;g<5*5*4;g++)if(g%4!=3&&h[g]!==g){P=!0;break}}}return P||!1}var j=1e-6,H=typeof Float32Array<"u"?Float32Array:Array;function N(){var A=new H(9);return H!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}function q(A){return A[0]=1,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=1,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=1,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A}function W(){var A=new H(3);return H!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),A}function ie(A){var c=A[0],h=A[1],g=A[2];return Math.sqrt(c*c+h*h+g*g)}function se(A,c,h){var g=new H(3);return g[0]=A,g[1]=c,g[2]=h,g}function Z(A,c,h){return A[0]=c[0]+h[0],A[1]=c[1]+h[1],A[2]=c[2]+h[2],A}function fe(A,c,h){return A[0]=c[0]*h,A[1]=c[1]*h,A[2]=c[2]*h,A}function te(A,c,h){var g=c[0],_=c[1],x=c[2],T=h[0],S=h[1],F=h[2];return A[0]=_*F-x*S,A[1]=x*T-g*F,A[2]=g*S-_*T,A}var ce,ve=ie;function me(A,c,h){var g=c[0],_=c[1],x=c[2],T=c[3];return A[0]=h[0]*g+h[4]*_+h[8]*x+h[12]*T,A[1]=h[1]*g+h[5]*_+h[9]*x+h[13]*T,A[2]=h[2]*g+h[6]*_+h[10]*x+h[14]*T,A[3]=h[3]*g+h[7]*_+h[11]*x+h[15]*T,A}function qe(){var A=new H(4);return H!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),A[3]=1,A}function ot(A,c,h,g){var _=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",x=Math.PI/360;c*=x,g*=x,h*=x;var T=Math.sin(c),S=Math.cos(c),F=Math.sin(h),U=Math.cos(h),z=Math.sin(g),K=Math.cos(g);switch(_){case"xyz":A[0]=T*U*K+S*F*z,A[1]=S*F*K-T*U*z,A[2]=S*U*z+T*F*K,A[3]=S*U*K-T*F*z;break;case"xzy":A[0]=T*U*K-S*F*z,A[1]=S*F*K-T*U*z,A[2]=S*U*z+T*F*K,A[3]=S*U*K+T*F*z;break;case"yxz":A[0]=T*U*K+S*F*z,A[1]=S*F*K-T*U*z,A[2]=S*U*z-T*F*K,A[3]=S*U*K+T*F*z;break;case"yzx":A[0]=T*U*K+S*F*z,A[1]=S*F*K+T*U*z,A[2]=S*U*z-T*F*K,A[3]=S*U*K-T*F*z;break;case"zxy":A[0]=T*U*K-S*F*z,A[1]=S*F*K+T*U*z,A[2]=S*U*z+T*F*K,A[3]=S*U*K-T*F*z;break;case"zyx":A[0]=T*U*K-S*F*z,A[1]=S*F*K+T*U*z,A[2]=S*U*z-T*F*K,A[3]=S*U*K+T*F*z;break;default:throw new Error("Unknown angle order "+_)}return A}function st(){var A=new H(2);return H!=Float32Array&&(A[0]=0,A[1]=0),A}function Ye(A,c){var h=new H(2);return h[0]=A,h[1]=c,h}W(),ce=new H(4),H!=Float32Array&&(ce[0]=0,ce[1]=0,ce[2]=0,ce[3]=0),W(),se(1,0,0),se(0,1,0),qe(),qe(),N(),st();const Xe=8192;function wt(A,c,h){return c*(Xe/(A.tileSize*Math.pow(2,h-A.tileID.overscaledZ)))}function ht(A,c){return(A%c+c)%c}function he(A,c,h){return A*(1-h)+c*h}function Be(A){if(A<=0)return 0;if(A>=1)return 1;const c=A*A,h=c*A;return 4*(A<.5?h:3*(A-c)+h-.75)}function Le(A,c,h,g){const _=new w(A,c,h,g);return x=>_.solve(x)}const He=Le(.25,.1,.25,1);function rt(A,c,h){return Math.min(h,Math.max(c,A))}function it(A,c,h){const g=h-c,_=((A-c)%g+g)%g+c;return _===c?h:_}function Pt(A,...c){for(const h of c)for(const g in h)A[g]=h[g];return A}let Bt=1;function Dt(A,c,h){const g={};for(const _ in A)g[_]=c.call(this,A[_],_,A);return g}function Yt(A,c,h){const g={};for(const _ in A)c.call(this,A[_],_,A)&&(g[_]=A[_]);return g}function nr(A){return Array.isArray(A)?A.map(nr):typeof A=="object"&&A?Dt(A,nr):A}const ur={};function xt(A){ur[A]||(typeof console<"u"&&console.warn(A),ur[A]=!0)}function Re(A,c,h){return(h.y-A.y)*(c.x-A.x)>(c.y-A.y)*(h.x-A.x)}function Kr(A){return typeof WorkerGlobalScope<"u"&&A!==void 0&&A instanceof WorkerGlobalScope}let Ur=null;function Er(A){if(Ur==null){const c=A.navigator?A.navigator.userAgent:null;Ur=!!A.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Ur}function Kt(A){return typeof ImageBitmap<"u"&&A instanceof ImageBitmap}const Br="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ar(A,c,h,g,_){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(A,{timestamp:0});try{const T=x?.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const S=T.startsWith("BGR"),F=new Uint8ClampedArray(g*_*4);if(yield x.copyTo(F,function(U,z,K,ee,oe){const le=4*Math.max(-z,0),pe=(Math.max(0,K)-K)*ee*4+le,Ce=4*ee,Ue=Math.max(0,z),At=Math.max(0,K);return{rect:{x:Ue,y:At,width:Math.min(U.width,z+ee)-Ue,height:Math.min(U.height,K+oe)-At},layout:[{offset:pe,stride:Ce}]}}(A,c,h,g,_)),S)for(let U=0;U<F.length;U+=4){const z=F[U];F[U]=F[U+2],F[U+2]=z}return F}finally{x.close()}})}let Lr,vr;function kt(A,c,h,g){return A.addEventListener(c,h,g),{unsubscribe:()=>{A.removeEventListener(c,h,g)}}}function ir(A){return A*Math.PI/180}function hr(A){return A/Math.PI*180}const Mr={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Cr={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},wr="AbortError";function Ne(){return new Error(wr)}const re={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ae(A){return re.REGISTERED_PROTOCOLS[A.substring(0,A.indexOf("://"))]}const ge="global-dispatcher";class xe extends Error{constructor(c,h,g,_){super(`AJAXError: ${h} (${c}): ${g}`),this.status=c,this.statusText=h,this.url=g,this.body=_}}const Me=()=>Kr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,We=function(A,c){if(/:\/\//.test(A.url)&&!/^https?:|^file:/.test(A.url)){const g=ae(A.url);if(g)return g(A,c);if(Kr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:A,targetMapId:ge},c)}if(!(/^file:/.test(h=A.url)||/^file:/.test(Me())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(g,_){return o(this,void 0,void 0,function*(){const x=new Request(g.url,{method:g.method||"GET",body:g.body,credentials:g.credentials,headers:g.headers,cache:g.cache,referrer:Me(),signal:_.signal});let T,S;g.type!=="json"||x.headers.has("Accept")||x.headers.set("Accept","application/json");try{T=yield fetch(x)}catch(U){throw new xe(0,U.message,g.url,new Blob)}if(!T.ok){const U=yield T.blob();throw new xe(T.status,T.statusText,g.url,U)}S=g.type==="arrayBuffer"||g.type==="image"?T.arrayBuffer():g.type==="json"?T.json():T.text();const F=yield S;if(_.signal.aborted)throw Ne();return{data:F,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}})}(A,c);if(Kr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:A,mustQueue:!0,targetMapId:ge},c)}var h;return function(g,_){return new Promise((x,T)=>{var S;const F=new XMLHttpRequest;F.open(g.method||"GET",g.url,!0),g.type!=="arrayBuffer"&&g.type!=="image"||(F.responseType="arraybuffer");for(const U in g.headers)F.setRequestHeader(U,g.headers[U]);g.type==="json"&&(F.responseType="text",!((S=g.headers)===null||S===void 0)&&S.Accept||F.setRequestHeader("Accept","application/json")),F.withCredentials=g.credentials==="include",F.onerror=()=>{T(new Error(F.statusText))},F.onload=()=>{if(!_.signal.aborted)if((F.status>=200&&F.status<300||F.status===0)&&F.response!==null){let U=F.response;if(g.type==="json")try{U=JSON.parse(F.response)}catch(z){return void T(z)}x({data:U,cacheControl:F.getResponseHeader("Cache-Control"),expires:F.getResponseHeader("Expires")})}else{const U=new Blob([F.response],{type:F.getResponseHeader("Content-Type")});T(new xe(F.status,F.statusText,g.url,U))}},_.signal.addEventListener("abort",()=>{F.abort(),T(Ne())}),F.send(g.body)})}(A,c)};function nt(A){if(!A||A.indexOf("://")<=0||A.indexOf("data:image/")===0||A.indexOf("blob:")===0)return!0;const c=new URL(A),h=window.location;return c.protocol===h.protocol&&c.host===h.host}function Ge(A,c,h){h[A]&&h[A].indexOf(c)!==-1||(h[A]=h[A]||[],h[A].push(c))}function lt(A,c,h){if(h&&h[A]){const g=h[A].indexOf(c);g!==-1&&h[A].splice(g,1)}}class Lt{constructor(c,h={}){Pt(this,h),this.type=c}}class Ft extends Lt{constructor(c,h={}){super("error",Pt({error:c},h))}}class Wt{on(c,h){return this._listeners=this._listeners||{},Ge(c,h,this._listeners),{unsubscribe:()=>{this.off(c,h)}}}off(c,h){return lt(c,h,this._listeners),lt(c,h,this._oneTimeListeners),this}once(c,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},Ge(c,h,this._oneTimeListeners),this):new Promise(g=>this.once(c,g))}fire(c,h){typeof c=="string"&&(c=new Lt(c,h||{}));const g=c.type;if(this.listens(g)){c.target=this;const _=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const S of _)S.call(this,c);const x=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const S of x)lt(g,S,this._oneTimeListeners),S.call(this,c);const T=this._eventedParent;T&&(Pt(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(c))}else c instanceof Ft&&console.error(c.error);return this}listens(c){return this._listeners&&this._listeners[c]&&this._listeners[c].length>0||this._oneTimeListeners&&this._oneTimeListeners[c]&&this._oneTimeListeners[c].length>0||this._eventedParent&&this._eventedParent.listens(c)}setEventedParent(c,h){return this._eventedParent=c,this._eventedParentData=h,this}}var Ze={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Sr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function an(A,c){const h={};for(const g in A)g!=="ref"&&(h[g]=A[g]);return Sr.forEach(g=>{g in c&&(h[g]=c[g])}),h}function yr(A,c){if(Array.isArray(A)){if(!Array.isArray(c)||A.length!==c.length)return!1;for(let h=0;h<A.length;h++)if(!yr(A[h],c[h]))return!1;return!0}if(typeof A=="object"&&A!==null&&c!==null){if(typeof c!="object"||Object.keys(A).length!==Object.keys(c).length)return!1;for(const h in A)if(!yr(A[h],c[h]))return!1;return!0}return A===c}function sn(A,c){A.push(c)}function fn(A,c,h){sn(h,{command:"addSource",args:[A,c[A]]})}function Ir(A,c,h){sn(c,{command:"removeSource",args:[A]}),h[A]=!0}function Gn(A,c,h,g){Ir(A,h,g),fn(A,c,h)}function ii(A,c,h){let g;for(g in A[h])if(Object.prototype.hasOwnProperty.call(A[h],g)&&g!=="data"&&!yr(A[h][g],c[h][g]))return!1;for(g in c[h])if(Object.prototype.hasOwnProperty.call(c[h],g)&&g!=="data"&&!yr(A[h][g],c[h][g]))return!1;return!0}function On(A,c,h,g,_,x){A=A||{},c=c||{};for(const T in A)Object.prototype.hasOwnProperty.call(A,T)&&(yr(A[T],c[T])||h.push({command:x,args:[g,T,c[T],_]}));for(const T in c)Object.prototype.hasOwnProperty.call(c,T)&&!Object.prototype.hasOwnProperty.call(A,T)&&(yr(A[T],c[T])||h.push({command:x,args:[g,T,c[T],_]}))}function pn(A){return A.id}function ln(A,c){return A[c.id]=c,A}class Ot{constructor(c,h,g,_){this.message=(c?`${c}: `:"")+g,_&&(this.identifier=_),h!=null&&h.__line__&&(this.line=h.__line__)}}function vn(A,...c){for(const h of c)for(const g in h)A[g]=h[g];return A}class wi extends Error{constructor(c,h){super(h),this.message=h,this.key=c}}class Qs{constructor(c,h=[]){this.parent=c,this.bindings={};for(const[g,_]of h)this.bindings[g]=_}concat(c){return new Qs(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(`${c} not found in scope.`)}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}const Un={kind:"null"},er={kind:"number"},Xr={kind:"string"},Zr={kind:"boolean"},yi={kind:"color"},Xo={kind:"projectionDefinition"},Ke={kind:"object"},Vt={kind:"value"},Ar={kind:"collator"},xn={kind:"formatted"},Jn={kind:"padding"},Wn={kind:"colorArray"},Xi={kind:"numberArray"},os={kind:"resolvedImage"},Di={kind:"variableAnchorOffsetCollection"};function qn(A,c){return{kind:"array",itemType:A,N:c}}function Nr(A){if(A.kind==="array"){const c=Nr(A.itemType);return typeof A.N=="number"?`array<${c}, ${A.N}>`:A.itemType.kind==="value"?"array":`array<${c}>`}return A.kind}const cu=[Un,er,Xr,Zr,yi,Xo,xn,Ke,qn(Vt),Jn,Xi,Wn,os,Di];function ma(A,c){if(c.kind==="error")return null;if(A.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!ma(A.itemType,c.itemType))&&(typeof A.N!="number"||A.N===c.N))return null}else{if(A.kind===c.kind)return null;if(A.kind==="value"){for(const h of cu)if(!ma(h,c))return null}}return`Expected ${Nr(A)} but found ${Nr(c)} instead.`}function al(A,c){return c.some(h=>h.kind===A.kind)}function Da(A,c){return c.some(h=>h==="null"?A===null:h==="array"?Array.isArray(A):h==="object"?A&&!Array.isArray(A)&&typeof A=="object":h===typeof A)}function ka(A,c){return A.kind==="array"&&c.kind==="array"?A.itemType.kind===c.itemType.kind&&typeof A.N=="number":A.kind===c.kind}const uu=.96422,eA=.82521,Yi=4/29,ll=6/29,tA=3*ll*ll,Pl=ll*ll*ll,hu=Math.PI/180,Na=180/Math.PI;function cc(A){return(A%=360)<0&&(A+=360),A}function Vi([A,c,h,g]){let _,x;const T=th((.2225045*(A=Au(A))+.7168786*(c=Au(c))+.0606169*(h=Au(h)))/1);A===c&&c===h?_=x=T:(_=th((.4360747*A+.3850649*c+.1430804*h)/uu),x=th((.0139322*A+.0971045*c+.7141733*h)/eA));const S=116*T-16;return[S<0?0:S,500*(_-T),200*(T-x),g]}function Au(A){return A<=.04045?A/12.92:Math.pow((A+.055)/1.055,2.4)}function th(A){return A>Pl?Math.pow(A,1/3):A/tA+Yi}function uc([A,c,h,g]){let _=(A+16)/116,x=isNaN(c)?_:_+c/500,T=isNaN(h)?_:_-h/200;return _=1*_a(_),x=uu*_a(x),T=eA*_a(T),[rA(3.1338561*x-1.6168667*_-.4906146*T),rA(-.9787684*x+1.9161415*_+.033454*T),rA(.0719453*x-.2289914*_+1.4052427*T),g]}function rA(A){return(A=A<=.00304?12.92*A:1.055*Math.pow(A,1/2.4)-.055)<0?0:A>1?1:A}function _a(A){return A>ll?A*A*A:tA*(A-Yi)}const hc=Object.hasOwn||function(A,c){return Object.prototype.hasOwnProperty.call(A,c)};function Ac(A,c){return hc(A,c)?A[c]:void 0}function za(A){return parseInt(A.padEnd(2,A),16)/255}function rh(A,c){return Ml(c?A/100:A,0,1)}function Ml(A,c,h){return Math.min(Math.max(c,A),h)}function nA(A){return!A.some(Number.isNaN)}const ya={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function hn(A,c,h){return A+h*(c-A)}function Hs(A,c,h){return A.map((g,_)=>hn(g,c[_],h))}class en{constructor(c,h,g,_=1,x=!0){this.r=c,this.g=h,this.b=g,this.a=_,x||(this.r*=_,this.g*=_,this.b*=_,_||this.overwriteGetter("rgb",[c,h,g,_]))}static parse(c){if(c instanceof en)return c;if(typeof c!="string")return;const h=function(g){if((g=g.toLowerCase().trim())==="transparent")return[0,0,0,0];const _=Ac(ya,g);if(_){const[T,S,F]=_;return[T/255,S/255,F/255,1]}if(g.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(g)){const T=g.length<6?1:2;let S=1;return[za(g.slice(S,S+=T)),za(g.slice(S,S+=T)),za(g.slice(S,S+=T)),za(g.slice(S,S+T)||"ff")]}if(g.startsWith("rgb")){const T=g.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[S,F,U,z,K,ee,oe,le,pe,Ce,Ue,At]=T,Ve=[z||" ",oe||" ",Ce].join("");if(Ve==="  "||Ve==="  /"||Ve===",,"||Ve===",,,"){const et=[U,ee,pe].join(""),Tt=et==="%%%"?100:et===""?255:0;if(Tt){const Rt=[Ml(+F/Tt,0,1),Ml(+K/Tt,0,1),Ml(+le/Tt,0,1),Ue?rh(+Ue,At):1];if(nA(Rt))return Rt}}return}}const x=g.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[T,S,F,U,z,K,ee,oe,le]=x,pe=[F||" ",z||" ",ee].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){const Ce=[+S,Ml(+U,0,100),Ml(+K,0,100),oe?rh(+oe,le):1];if(nA(Ce))return function([Ue,At,Ve,et]){function Tt(Rt){const qt=(Rt+Ue/30)%12,mr=At*Math.min(Ve,1-Ve);return Ve-mr*Math.max(-1,Math.min(qt-3,9-qt,1))}return Ue=cc(Ue),At/=100,Ve/=100,[Tt(0),Tt(8),Tt(4),et]}(Ce)}}}(c);return h?new en(...h,!1):void 0}get rgb(){const{r:c,g:h,b:g,a:_}=this,x=_||1/0;return this.overwriteGetter("rgb",[c/x,h/x,g/x,_])}get hcl(){return this.overwriteGetter("hcl",function(c){const[h,g,_,x]=Vi(c),T=Math.sqrt(g*g+_*_);return[Math.round(1e4*T)?cc(Math.atan2(_,g)*Na):NaN,T,h,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Vi(this.rgb))}overwriteGetter(c,h){return Object.defineProperty(this,c,{value:h}),h}toString(){const[c,h,g,_]=this.rgb;return`rgba(${[c,h,g].map(x=>Math.round(255*x)).join(",")},${_})`}static interpolate(c,h,g,_="rgb"){switch(_){case"rgb":{const[x,T,S,F]=Hs(c.rgb,h.rgb,g);return new en(x,T,S,F,!1)}case"hcl":{const[x,T,S,F]=c.hcl,[U,z,K,ee]=h.hcl;let oe,le;if(isNaN(x)||isNaN(U))isNaN(x)?isNaN(U)?oe=NaN:(oe=U,S!==1&&S!==0||(le=z)):(oe=x,K!==1&&K!==0||(le=T));else{let Ve=U-x;U>x&&Ve>180?Ve-=360:U<x&&x-U>180&&(Ve+=360),oe=x+g*Ve}const[pe,Ce,Ue,At]=function([Ve,et,Tt,Rt]){return Ve=isNaN(Ve)?0:Ve*hu,uc([Tt,Math.cos(Ve)*et,Math.sin(Ve)*et,Rt])}([oe,le??hn(T,z,g),hn(S,K,g),hn(F,ee,g)]);return new en(pe,Ce,Ue,At,!1)}case"lab":{const[x,T,S,F]=uc(Hs(c.lab,h.lab,g));return new en(x,T,S,F,!1)}}}}en.black=new en(0,0,0,1),en.white=new en(1,1,1,1),en.transparent=new en(0,0,0,0),en.red=new en(1,0,0,1);class nh{constructor(c,h,g){this.sensitivity=c?h?"variant":"case":h?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,h){return this.collator.compare(c,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const fc=["bottom","center","top"];class Fl{constructor(c,h,g,_,x,T){this.text=c,this.image=h,this.scale=g,this.fontStack=_,this.textColor=x,this.verticalAlign=T}}class Qr{constructor(c){this.sections=c}static fromString(c){return new Qr([new Fl(c,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.name.length!==0)}static factory(c){return c instanceof Qr?c:Qr.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}}class as{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof as)return c;if(typeof c=="number")return new as([c,c,c,c]);if(Array.isArray(c)&&!(c.length<1||c.length>4)){for(const h of c)if(typeof h!="number")return;switch(c.length){case 1:c=[c[0],c[0],c[0],c[0]];break;case 2:c=[c[0],c[1],c[0],c[1]];break;case 3:c=[c[0],c[1],c[2],c[1]]}return new as(c)}}toString(){return JSON.stringify(this.values)}static interpolate(c,h,g){return new as(Hs(c.values,h.values,g))}}class Ss{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Ss)return c;if(typeof c=="number")return new Ss([c]);if(Array.isArray(c)){for(const h of c)if(typeof h!="number")return;return new Ss(c)}}toString(){return JSON.stringify(this.values)}static interpolate(c,h,g){return new Ss(Hs(c.values,h.values,g))}}class Zi{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Zi)return c;if(typeof c=="string"){const g=en.parse(c);return g?new Zi([g]):void 0}if(!Array.isArray(c))return;const h=[];for(const g of c){if(typeof g!="string")return;const _=en.parse(g);if(!_)return;h.push(_)}return new Zi(h)}toString(){return JSON.stringify(this.values)}static interpolate(c,h,g,_="rgb"){const x=[];if(c.values.length!=h.values.length)throw new Error(`colorArray: Arrays have mismatched length (${c.values.length} vs. ${h.values.length}), cannot interpolate.`);for(let T=0;T<c.values.length;T++)x.push(en.interpolate(c.values[T],h.values[T],g,_));return new Zi(x)}}class si extends Error{constructor(c){super(c),this.name="RuntimeError"}toJSON(){return this.message}}const Rl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class xi{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof xi)return c;if(Array.isArray(c)&&!(c.length<1)&&c.length%2==0){for(let h=0;h<c.length;h+=2){const g=c[h],_=c[h+1];if(typeof g!="string"||!Rl.has(g)||!Array.isArray(_)||_.length!==2||typeof _[0]!="number"||typeof _[1]!="number")return}return new xi(c)}}toString(){return JSON.stringify(this.values)}static interpolate(c,h,g){const _=c.values,x=h.values;if(_.length!==x.length)throw new si(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${h.toString()}`);const T=[];for(let S=0;S<_.length;S+=2){if(_[S]!==x[S])throw new si(`Cannot interpolate values containing mismatched anchors. from[${S}]: ${_[S]}, to[${S}]: ${x[S]}`);T.push(_[S]);const[F,U]=_[S+1],[z,K]=x[S+1];T.push([hn(F,z,g),hn(U,K,g)])}return new xi(T)}}class As{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new As({name:c,available:!1}):null}}class no{constructor(c,h,g){this.from=c,this.to=h,this.transition=g}static interpolate(c,h,g){return new no(c,h,g)}static parse(c){return c instanceof no?c:Array.isArray(c)&&c.length===3&&typeof c[0]=="string"&&typeof c[1]=="string"&&typeof c[2]=="number"?new no(c[0],c[1],c[2]):typeof c=="object"&&typeof c.from=="string"&&typeof c.to=="string"&&typeof c.transition=="number"?new no(c.from,c.to,c.transition):typeof c=="string"?new no(c,c,1):void 0}}function dc(A,c,h,g){return typeof A=="number"&&A>=0&&A<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof h=="number"&&h>=0&&h<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:`Invalid rgba value [${[A,c,h,g].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof g=="number"?[A,c,h,g]:[A,c,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cl(A){if(A===null||typeof A=="string"||typeof A=="boolean"||typeof A=="number"||A instanceof no||A instanceof en||A instanceof nh||A instanceof Qr||A instanceof as||A instanceof Ss||A instanceof Zi||A instanceof xi||A instanceof As)return!0;if(Array.isArray(A)){for(const c of A)if(!cl(c))return!1;return!0}if(typeof A=="object"){for(const c in A)if(!cl(A[c]))return!1;return!0}return!1}function Kn(A){if(A===null)return Un;if(typeof A=="string")return Xr;if(typeof A=="boolean")return Zr;if(typeof A=="number")return er;if(A instanceof en)return yi;if(A instanceof no)return Xo;if(A instanceof nh)return Ar;if(A instanceof Qr)return xn;if(A instanceof as)return Jn;if(A instanceof Ss)return Xi;if(A instanceof Zi)return Wn;if(A instanceof xi)return Di;if(A instanceof As)return os;if(Array.isArray(A)){const c=A.length;let h;for(const g of A){const _=Kn(g);if(h){if(h===_)continue;h=Vt;break}h=_}return qn(h||Vt,c)}return Ke}function kn(A){const c=typeof A;return A===null?"":c==="string"||c==="number"||c==="boolean"?String(A):A instanceof en||A instanceof no||A instanceof Qr||A instanceof as||A instanceof Ss||A instanceof Zi||A instanceof xi||A instanceof As?A.toString():JSON.stringify(A)}class ko{constructor(c,h){this.type=c,this.value=h}static parse(c,h){if(c.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!cl(c[1]))return h.error("invalid value");const g=c[1];let _=Kn(g);const x=h.expectedType;return _.kind!=="array"||_.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(_=x),new ko(_,g)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Tn={string:Xr,number:er,boolean:Zr,object:Ke};class Yr{constructor(c,h){this.type=c,this.args=h}static parse(c,h){if(c.length<2)return h.error("Expected at least one argument.");let g,_=1;const x=c[0];if(x==="array"){let S,F;if(c.length>2){const U=c[1];if(typeof U!="string"||!(U in Tn)||U==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);S=Tn[U],_++}else S=Vt;if(c.length>3){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return h.error('The length argument to "array" must be a positive integer literal',2);F=c[2],_++}g=qn(S,F)}else{if(!Tn[x])throw new Error(`Types doesn't contain name = ${x}`);g=Tn[x]}const T=[];for(;_<c.length;_++){const S=h.parse(c[_],_,Vt);if(!S)return null;T.push(S)}return new Yr(g,T)}evaluate(c){for(let h=0;h<this.args.length;h++){const g=this.args[h].evaluate(c);if(!ma(this.type,Kn(g)))return g;if(h===this.args.length-1)throw new si(`Expected value to be of type ${Nr(this.type)}, but found ${Nr(Kn(g))} instead.`)}throw new Error}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const pc={"to-boolean":Zr,"to-color":yi,"to-number":er,"to-string":Xr};class An{constructor(c,h){this.type=c,this.args=h}static parse(c,h){if(c.length<2)return h.error("Expected at least one argument.");const g=c[0];if(!pc[g])throw new Error(`Can't parse ${g} as it is not part of the known types`);if((g==="to-boolean"||g==="to-string")&&c.length!==2)return h.error("Expected one argument.");const _=pc[g],x=[];for(let T=1;T<c.length;T++){const S=h.parse(c[T],T,Vt);if(!S)return null;x.push(S)}return new An(_,x)}evaluate(c){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(c);case"color":{let h,g;for(const _ of this.args){if(h=_.evaluate(c),g=null,h instanceof en)return h;if(typeof h=="string"){const x=c.parseColor(h);if(x)return x}else if(Array.isArray(h)&&(g=h.length<3||h.length>4?`Invalid rgba value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:dc(h[0],h[1],h[2],h[3]),!g))return new en(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new si(g||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const g of this.args){h=g.evaluate(c);const _=as.parse(h);if(_)return _}throw new si(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"numberArray":{let h;for(const g of this.args){h=g.evaluate(c);const _=Ss.parse(h);if(_)return _}throw new si(`Could not parse numberArray from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"colorArray":{let h;for(const g of this.args){h=g.evaluate(c);const _=Zi.parse(h);if(_)return _}throw new si(`Could not parse colorArray from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const g of this.args){h=g.evaluate(c);const _=xi.parse(h);if(_)return _}throw new si(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const g of this.args){if(h=g.evaluate(c),h===null)return 0;const _=Number(h);if(!isNaN(_))return _}throw new si(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Qr.fromString(kn(this.args[0].evaluate(c)));case"resolvedImage":return As.fromString(kn(this.args[0].evaluate(c)));case"projectionDefinition":return this.args[0].evaluate(c);default:return kn(this.args[0].evaluate(c))}}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const Ll=["Unknown","Point","LineString","Polygon"];class No{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ll[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(c){let h=this._parseColorCache.get(c);return h||(h=en.parse(c),this._parseColorCache.set(c,h)),h}}class Qa{constructor(c,h,g=[],_,x=new Qs,T=[]){this.registry=c,this.path=g,this.key=g.map(S=>`[${S}]`).join(""),this.scope=x,this.errors=T,this.expectedType=_,this._isConstant=h}parse(c,h,g,_,x={}){return h?this.concat(h,g,_)._parse(c,x):this._parse(c,x)}_parse(c,h){function g(_,x,T){return T==="assert"?new Yr(x,[_]):T==="coerce"?new An(x,[_]):_}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=c[0];if(typeof _!="string")return this.error(`Expression name must be a string, but found ${typeof _} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[_];if(x){let T=x.parse(c,this);if(!T)return null;if(this.expectedType){const S=this.expectedType,F=T.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||F.kind!=="value"){if(S.kind==="projectionDefinition"&&["string","array"].includes(F.kind)||["color","formatted","resolvedImage"].includes(S.kind)&&["value","string"].includes(F.kind)||["padding","numberArray"].includes(S.kind)&&["value","number","array"].includes(F.kind)||S.kind==="colorArray"&&["value","string","array"].includes(F.kind)||S.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(F.kind))T=g(T,S,h.typeAnnotation||"coerce");else if(this.checkSubtype(S,F))return null}else T=g(T,S,h.typeAnnotation||"assert")}if(!(T instanceof ko)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const S=new No;try{T=new ko(T.type,T.evaluate(S))}catch(F){return this.error(F.message),null}}return T}return this.error(`Unknown expression "${_}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(c===void 0?"'undefined' value invalid. Use null instead.":typeof c=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof c} instead.`)}concat(c,h,g){const _=typeof c=="number"?this.path.concat(c):this.path,x=g?this.scope.concat(g):this.scope;return new Qa(this.registry,this._isConstant,_,h||null,x,this.errors)}error(c,...h){const g=`${this.key}${h.map(_=>`[${_}]`).join("")}`;this.errors.push(new wi(g,c))}checkSubtype(c,h){const g=ma(c,h);return g&&this.error(g),g}}class Ha{constructor(c,h){this.type=h.type,this.bindings=[].concat(c),this.result=h}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const h of this.bindings)c(h[1]);c(this.result)}static parse(c,h){if(c.length<4)return h.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);const g=[];for(let x=1;x<c.length-1;x+=2){const T=c[x];if(typeof T!="string")return h.error(`Expected string, but found ${typeof T} instead.`,x);if(/[^a-zA-Z0-9_]/.test(T))return h.error("Variable names must contain only alphanumeric characters or '_'.",x);const S=h.parse(c[x+1],x+1);if(!S)return null;g.push([T,S])}const _=h.parse(c[c.length-1],c.length-1,h.expectedType,g);return _?new Ha(g,_):null}outputDefined(){return this.result.outputDefined()}}class Va{constructor(c,h){this.type=h.type,this.name=c,this.boundExpression=h}static parse(c,h){if(c.length!==2||typeof c[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const g=c[1];return h.scope.has(g)?new Va(g,h.scope.get(g)):h.error(`Unknown variable "${g}". Make sure "${g}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}}class Ol{constructor(c,h,g){this.type=c,this.index=h,this.input=g}static parse(c,h){if(c.length!==3)return h.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const g=h.parse(c[1],1,er),_=h.parse(c[2],2,qn(h.expectedType||Vt));return g&&_?new Ol(_.type.itemType,g,_):null}evaluate(c){const h=this.index.evaluate(c),g=this.input.evaluate(c);if(h<0)throw new si(`Array index out of bounds: ${h} < 0.`);if(h>=g.length)throw new si(`Array index out of bounds: ${h} > ${g.length-1}.`);if(h!==Math.floor(h))throw new si(`Array index must be an integer, but found ${h} instead.`);return g[h]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}}class gc{constructor(c,h){this.type=Zr,this.needle=c,this.haystack=h}static parse(c,h){if(c.length!==3)return h.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const g=h.parse(c[1],1,Vt),_=h.parse(c[2],2,Vt);return g&&_?al(g.type,[Zr,Xr,er,Un,Vt])?new gc(g,_):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(g.type)} instead`):null}evaluate(c){const h=this.needle.evaluate(c),g=this.haystack.evaluate(c);if(!g)return!1;if(!Da(h,["boolean","string","number","null"]))throw new si(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(Kn(h))} instead.`);if(!Da(g,["string","array"]))throw new si(`Expected second argument to be of type array or string, but found ${Nr(Kn(g))} instead.`);return g.indexOf(h)>=0}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}}class io{constructor(c,h,g){this.type=er,this.needle=c,this.haystack=h,this.fromIndex=g}static parse(c,h){if(c.length<=2||c.length>=5)return h.error(`Expected 2 or 3 arguments, but found ${c.length-1} instead.`);const g=h.parse(c[1],1,Vt),_=h.parse(c[2],2,Vt);if(!g||!_)return null;if(!al(g.type,[Zr,Xr,er,Un,Vt]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(g.type)} instead`);if(c.length===4){const x=h.parse(c[3],3,er);return x?new io(g,_,x):null}return new io(g,_)}evaluate(c){const h=this.needle.evaluate(c),g=this.haystack.evaluate(c);if(!Da(h,["boolean","string","number","null"]))throw new si(`Expected first argument to be of type boolean, string, number or null, but found ${Nr(Kn(h))} instead.`);let _;if(this.fromIndex&&(_=this.fromIndex.evaluate(c)),Da(g,["string"])){const x=g.indexOf(h,_);return x===-1?-1:[...g.slice(0,x)].length}if(Da(g,["array"]))return g.indexOf(h,_);throw new si(`Expected second argument to be of type array or string, but found ${Nr(Kn(g))} instead.`)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}}class Yo{constructor(c,h,g,_,x,T){this.inputType=c,this.type=h,this.input=g,this.cases=_,this.outputs=x,this.otherwise=T}static parse(c,h){if(c.length<5)return h.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return h.error("Expected an even number of arguments.");let g,_;h.expectedType&&h.expectedType.kind!=="value"&&(_=h.expectedType);const x={},T=[];for(let U=2;U<c.length-1;U+=2){let z=c[U];const K=c[U+1];Array.isArray(z)||(z=[z]);const ee=h.concat(U);if(z.length===0)return ee.error("Expected at least one branch label.");for(const le of z){if(typeof le!="number"&&typeof le!="string")return ee.error("Branch labels must be numbers or strings.");if(typeof le=="number"&&Math.abs(le)>Number.MAX_SAFE_INTEGER)return ee.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof le=="number"&&Math.floor(le)!==le)return ee.error("Numeric branch labels must be integer values.");if(g){if(ee.checkSubtype(g,Kn(le)))return null}else g=Kn(le);if(x[String(le)]!==void 0)return ee.error("Branch labels must be unique.");x[String(le)]=T.length}const oe=h.parse(K,U,_);if(!oe)return null;_=_||oe.type,T.push(oe)}const S=h.parse(c[1],1,Vt);if(!S)return null;const F=h.parse(c[c.length-1],c.length-1,_);return F?S.type.kind!=="value"&&h.concat(1).checkSubtype(g,S.type)?null:new Yo(g,_,S,x,T,F):null}evaluate(c){const h=this.input.evaluate(c);return(Kn(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}}class Q{constructor(c,h,g){this.type=c,this.branches=h,this.otherwise=g}static parse(c,h){if(c.length<4)return h.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return h.error("Expected an odd number of arguments.");let g;h.expectedType&&h.expectedType.kind!=="value"&&(g=h.expectedType);const _=[];for(let T=1;T<c.length-1;T+=2){const S=h.parse(c[T],T,Zr);if(!S)return null;const F=h.parse(c[T+1],T+1,g);if(!F)return null;_.push([S,F]),g=g||F.type}const x=h.parse(c[c.length-1],c.length-1,g);if(!x)return null;if(!g)throw new Error("Can't infer output type");return new Q(g,_,x)}evaluate(c){for(const[h,g]of this.branches)if(h.evaluate(c))return g.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(const[h,g]of this.branches)c(h),c(g);c(this.otherwise)}outputDefined(){return this.branches.every(([c,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class ue{constructor(c,h,g,_){this.type=c,this.input=h,this.beginIndex=g,this.endIndex=_}static parse(c,h){if(c.length<=2||c.length>=5)return h.error(`Expected 2 or 3 arguments, but found ${c.length-1} instead.`);const g=h.parse(c[1],1,Vt),_=h.parse(c[2],2,er);if(!g||!_)return null;if(!al(g.type,[qn(Vt),Xr,Vt]))return h.error(`Expected first argument to be of type array or string, but found ${Nr(g.type)} instead`);if(c.length===4){const x=h.parse(c[3],3,er);return x?new ue(g.type,g,_,x):null}return new ue(g.type,g,_)}evaluate(c){const h=this.input.evaluate(c),g=this.beginIndex.evaluate(c);let _;if(this.endIndex&&(_=this.endIndex.evaluate(c)),Da(h,["string"]))return[...h].slice(g,_).join("");if(Da(h,["array"]))return h.slice(g,_);throw new si(`Expected first argument to be of type array or string, but found ${Nr(Kn(h))} instead.`)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}}function Fe(A,c){const h=A.length-1;let g,_,x=0,T=h,S=0;for(;x<=T;)if(S=Math.floor((x+T)/2),g=A[S],_=A[S+1],g<=c){if(S===h||c<_)return S;x=S+1}else{if(!(g>c))throw new si("Input is not a number.");T=S-1}return 0}class tt{constructor(c,h,g){this.type=c,this.input=h,this.labels=[],this.outputs=[];for(const[_,x]of g)this.labels.push(_),this.outputs.push(x)}static parse(c,h){if(c.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return h.error("Expected an even number of arguments.");const g=h.parse(c[1],1,er);if(!g)return null;const _=[];let x=null;h.expectedType&&h.expectedType.kind!=="value"&&(x=h.expectedType);for(let T=1;T<c.length;T+=2){const S=T===1?-1/0:c[T],F=c[T+1],U=T,z=T+1;if(typeof S!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(_.length&&_[_.length-1][0]>=S)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',U);const K=h.parse(F,z,x);if(!K)return null;x=x||K.type,_.push([S,K])}return new tt(x,g,_)}evaluate(c){const h=this.labels,g=this.outputs;if(h.length===1)return g[0].evaluate(c);const _=this.input.evaluate(c);if(_<=h[0])return g[0].evaluate(c);const x=h.length;return _>=h[x-1]?g[x-1].evaluate(c):g[Fe(h,_)].evaluate(c)}eachChild(c){c(this.input);for(const h of this.outputs)c(h)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function mt(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}var Qt,jt,Dr=function(){if(jt)return Qt;function A(c,h,g,_){this.cx=3*c,this.bx=3*(g-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*h,this.by=3*(_-h)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=h,this.p2x=g,this.p2y=_}return jt=1,Qt=A,A.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,h){if(h===void 0&&(h=1e-6),c<0)return 0;if(c>1)return 1;for(var g=c,_=0;_<8;_++){var x=this.sampleCurveX(g)-c;if(Math.abs(x)<h)return g;var T=this.sampleCurveDerivativeX(g);if(Math.abs(T)<1e-6)break;g-=x/T}var S=0,F=1;for(g=c,_=0;_<20&&(x=this.sampleCurveX(g),!(Math.abs(x-c)<h));_++)c>x?S=g:F=g,g=.5*(F-S)+S;return g},solve:function(c,h){return this.sampleCurveY(this.solveCurveX(c,h))}},Qt}(),Hr=mt(Dr);class Vr{constructor(c,h,g,_,x){this.type=c,this.operator=h,this.interpolation=g,this.input=_,this.labels=[],this.outputs=[];for(const[T,S]of x)this.labels.push(T),this.outputs.push(S)}static interpolationFactor(c,h,g,_){let x=0;if(c.name==="exponential")x=gn(h,c.base,g,_);else if(c.name==="linear")x=gn(h,1,g,_);else if(c.name==="cubic-bezier"){const T=c.controlPoints;x=new Hr(T[0],T[1],T[2],T[3]).solve(gn(h,1,g,_))}return x}static parse(c,h){let[g,_,x,...T]=c;if(!Array.isArray(_)||_.length===0)return h.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const U=_[1];if(typeof U!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:U}}else{if(_[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const U=_.slice(1);if(U.length!==4||U.some(z=>typeof z!="number"||z<0||z>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:U}}}if(c.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(x=h.parse(x,2,er),!x)return null;const S=[];let F=null;g!=="interpolate-hcl"&&g!=="interpolate-lab"||h.expectedType==Wn?h.expectedType&&h.expectedType.kind!=="value"&&(F=h.expectedType):F=yi;for(let U=0;U<T.length;U+=2){const z=T[U],K=T[U+1],ee=U+3,oe=U+4;if(typeof z!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ee);if(S.length&&S[S.length-1][0]>=z)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ee);const le=h.parse(K,oe,F);if(!le)return null;F=F||le.type,S.push([z,le])}return ka(F,er)||ka(F,Xo)||ka(F,yi)||ka(F,Jn)||ka(F,Xi)||ka(F,Wn)||ka(F,Di)||ka(F,qn(er))?new Vr(F,g,_,x,S):h.error(`Type ${Nr(F)} is not interpolatable.`)}evaluate(c){const h=this.labels,g=this.outputs;if(h.length===1)return g[0].evaluate(c);const _=this.input.evaluate(c);if(_<=h[0])return g[0].evaluate(c);const x=h.length;if(_>=h[x-1])return g[x-1].evaluate(c);const T=Fe(h,_),S=Vr.interpolationFactor(this.interpolation,_,h[T],h[T+1]),F=g[T].evaluate(c),U=g[T+1].evaluate(c);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return hn(F,U,S);case"color":return en.interpolate(F,U,S);case"padding":return as.interpolate(F,U,S);case"colorArray":return Zi.interpolate(F,U,S);case"numberArray":return Ss.interpolate(F,U,S);case"variableAnchorOffsetCollection":return xi.interpolate(F,U,S);case"array":return Hs(F,U,S);case"projectionDefinition":return no.interpolate(F,U,S)}case"interpolate-hcl":switch(this.type.kind){case"color":return en.interpolate(F,U,S,"hcl");case"colorArray":return Zi.interpolate(F,U,S,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return en.interpolate(F,U,S,"lab");case"colorArray":return Zi.interpolate(F,U,S,"lab")}}}eachChild(c){c(this.input);for(const h of this.outputs)c(h)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function gn(A,c,h,g){const _=g-h,x=A-h;return _===0?0:c===1?x/_:(Math.pow(c,x)-1)/(Math.pow(c,_)-1)}const dn={color:en.interpolate,number:hn,padding:as.interpolate,numberArray:Ss.interpolate,colorArray:Zi.interpolate,variableAnchorOffsetCollection:xi.interpolate,array:Hs};class ei{constructor(c,h){this.type=c,this.args=h}static parse(c,h){if(c.length<2)return h.error("Expected at least one argument.");let g=null;const _=h.expectedType;_&&_.kind!=="value"&&(g=_);const x=[];for(const S of c.slice(1)){const F=h.parse(S,1+x.length,g,void 0,{typeAnnotation:"omit"});if(!F)return null;g=g||F.type,x.push(F)}if(!g)throw new Error("No output type");const T=_&&x.some(S=>ma(_,S.type));return new ei(T?Vt:g,x)}evaluate(c){let h,g=null,_=0;for(const x of this.args)if(_++,g=x.evaluate(c),g&&g instanceof As&&!g.available&&(h||(h=g.name),g=null,_===this.args.length&&(g=h)),g!==null)break;return g}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}function ji(A,c){return A==="=="||A==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function ti(A,c,h,g){return g.compare(c,h)===0}function Bi(A,c,h){const g=A!=="=="&&A!=="!=";return class P9{constructor(x,T,S){this.type=Zr,this.lhs=x,this.rhs=T,this.collator=S,this.hasUntypedArgument=x.type.kind==="value"||T.type.kind==="value"}static parse(x,T){if(x.length!==3&&x.length!==4)return T.error("Expected two or three arguments.");const S=x[0];let F=T.parse(x[1],1,Vt);if(!F)return null;if(!ji(S,F.type))return T.concat(1).error(`"${S}" comparisons are not supported for type '${Nr(F.type)}'.`);let U=T.parse(x[2],2,Vt);if(!U)return null;if(!ji(S,U.type))return T.concat(2).error(`"${S}" comparisons are not supported for type '${Nr(U.type)}'.`);if(F.type.kind!==U.type.kind&&F.type.kind!=="value"&&U.type.kind!=="value")return T.error(`Cannot compare types '${Nr(F.type)}' and '${Nr(U.type)}'.`);g&&(F.type.kind==="value"&&U.type.kind!=="value"?F=new Yr(U.type,[F]):F.type.kind!=="value"&&U.type.kind==="value"&&(U=new Yr(F.type,[U])));let z=null;if(x.length===4){if(F.type.kind!=="string"&&U.type.kind!=="string"&&F.type.kind!=="value"&&U.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(z=T.parse(x[3],3,Ar),!z)return null}return new P9(F,U,z)}evaluate(x){const T=this.lhs.evaluate(x),S=this.rhs.evaluate(x);if(g&&this.hasUntypedArgument){const F=Kn(T),U=Kn(S);if(F.kind!==U.kind||F.kind!=="string"&&F.kind!=="number")throw new si(`Expected arguments for "${A}" to be (string, string) or (number, number), but found (${F.kind}, ${U.kind}) instead.`)}if(this.collator&&!g&&this.hasUntypedArgument){const F=Kn(T),U=Kn(S);if(F.kind!=="string"||U.kind!=="string")return c(x,T,S)}return this.collator?h(x,T,S,this.collator.evaluate(x)):c(x,T,S)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const ki=Bi("==",function(A,c,h){return c===h},ti),ls=Bi("!=",function(A,c,h){return c!==h},function(A,c,h,g){return!ti(0,c,h,g)}),fs=Bi("<",function(A,c,h){return c<h},function(A,c,h,g){return g.compare(c,h)<0}),Ul=Bi(">",function(A,c,h){return c>h},function(A,c,h,g){return g.compare(c,h)>0}),ih=Bi("<=",function(A,c,h){return c<=h},function(A,c,h,g){return g.compare(c,h)<=0}),uf=Bi(">=",function(A,c,h){return c>=h},function(A,c,h,g){return g.compare(c,h)>=0});class ba{constructor(c,h,g){this.type=Ar,this.locale=g,this.caseSensitive=c,this.diacriticSensitive=h}static parse(c,h){if(c.length!==2)return h.error("Expected one argument.");const g=c[1];if(typeof g!="object"||Array.isArray(g))return h.error("Collator options argument must be an object.");const _=h.parse(g["case-sensitive"]!==void 0&&g["case-sensitive"],1,Zr);if(!_)return null;const x=h.parse(g["diacritic-sensitive"]!==void 0&&g["diacritic-sensitive"],1,Zr);if(!x)return null;let T=null;return g.locale&&(T=h.parse(g.locale,1,Xr),!T)?null:new ba(_,x,T)}evaluate(c){return new nh(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}}class Zo{constructor(c,h,g,_,x){this.type=Xr,this.number=c,this.locale=h,this.currency=g,this.minFractionDigits=_,this.maxFractionDigits=x}static parse(c,h){if(c.length!==3)return h.error("Expected two arguments.");const g=h.parse(c[1],1,er);if(!g)return null;const _=c[2];if(typeof _!="object"||Array.isArray(_))return h.error("NumberFormat options argument must be an object.");let x=null;if(_.locale&&(x=h.parse(_.locale,1,Xr),!x))return null;let T=null;if(_.currency&&(T=h.parse(_.currency,1,Xr),!T))return null;let S=null;if(_["min-fraction-digits"]&&(S=h.parse(_["min-fraction-digits"],1,er),!S))return null;let F=null;return _["max-fraction-digits"]&&(F=h.parse(_["max-fraction-digits"],1,er),!F)?null:new Zo(g,x,T,S,F)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}}class mc{constructor(c){this.type=xn,this.sections=c}static parse(c,h){if(c.length<2)return h.error("Expected at least one argument.");const g=c[1];if(!Array.isArray(g)&&typeof g=="object")return h.error("First argument must be an image or text section.");const _=[];let x=!1;for(let T=1;T<=c.length-1;++T){const S=c[T];if(x&&typeof S=="object"&&!Array.isArray(S)){x=!1;let F=null;if(S["font-scale"]&&(F=h.parse(S["font-scale"],1,er),!F))return null;let U=null;if(S["text-font"]&&(U=h.parse(S["text-font"],1,qn(Xr)),!U))return null;let z=null;if(S["text-color"]&&(z=h.parse(S["text-color"],1,yi),!z))return null;let K=null;if(S["vertical-align"]){if(typeof S["vertical-align"]=="string"&&!fc.includes(S["vertical-align"]))return h.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${S["vertical-align"]}' instead.`);if(K=h.parse(S["vertical-align"],1,Xr),!K)return null}const ee=_[_.length-1];ee.scale=F,ee.font=U,ee.textColor=z,ee.verticalAlign=K}else{const F=h.parse(c[T],1,Vt);if(!F)return null;const U=F.type.kind;if(U!=="string"&&U!=="value"&&U!=="null"&&U!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,_.push({content:F,scale:null,font:null,textColor:null,verticalAlign:null})}}return new mc(_)}evaluate(c){return new Qr(this.sections.map(h=>{const g=h.content.evaluate(c);return Kn(g)===os?new Fl("",g,null,null,null,h.verticalAlign?h.verticalAlign.evaluate(c):null):new Fl(kn(g),null,h.scale?h.scale.evaluate(c):null,h.font?h.font.evaluate(c).join(","):null,h.textColor?h.textColor.evaluate(c):null,h.verticalAlign?h.verticalAlign.evaluate(c):null)}))}eachChild(c){for(const h of this.sections)c(h.content),h.scale&&c(h.scale),h.font&&c(h.font),h.textColor&&c(h.textColor),h.verticalAlign&&c(h.verticalAlign)}outputDefined(){return!1}}class _c{constructor(c){this.type=os,this.input=c}static parse(c,h){if(c.length!==2)return h.error("Expected two arguments.");const g=h.parse(c[1],1,Xr);return g?new _c(g):h.error("No image name provided.")}evaluate(c){const h=this.input.evaluate(c),g=As.fromString(h);return g&&c.availableImages&&(g.available=c.availableImages.indexOf(h)>-1),g}eachChild(c){c(this.input)}outputDefined(){return!1}}class ul{constructor(c){this.type=er,this.input=c}static parse(c,h){if(c.length!==2)return h.error(`Expected 1 argument, but found ${c.length-1} instead.`);const g=h.parse(c[1],1);return g?g.type.kind!=="array"&&g.type.kind!=="string"&&g.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${Nr(g.type)} instead.`):new ul(g):null}evaluate(c){const h=this.input.evaluate(c);if(typeof h=="string")return[...h].length;if(Array.isArray(h))return h.length;throw new si(`Expected value to be of type string or array, but found ${Nr(Kn(h))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}}const Xn=8192;function Dl(A,c){const h=(180+A[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+A[1]*Math.PI/360)))/360,_=Math.pow(2,c.z);return[Math.round(h*_*Xn),Math.round(g*_*Xn)]}function va(A,c){const h=Math.pow(2,c.z);return[(_=(A[0]/Xn+c.x)/h,360*_-180),(g=(A[1]/Xn+c.y)/h,360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90)];var g,_}function ja(A,c){A[0]=Math.min(A[0],c[0]),A[1]=Math.min(A[1],c[1]),A[2]=Math.max(A[2],c[0]),A[3]=Math.max(A[3],c[1])}function kl(A,c){return!(A[0]<=c[0]||A[2]>=c[2]||A[1]<=c[1]||A[3]>=c[3])}function so(A,c,h){const g=A[0]-c[0],_=A[1]-c[1],x=A[0]-h[0],T=A[1]-h[1];return g*T-x*_==0&&g*x<=0&&_*T<=0}function fu(A,c,h,g){return(_=[g[0]-h[0],g[1]-h[1]])[0]*(x=[c[0]-A[0],c[1]-A[1]])[1]-_[1]*x[0]!=0&&!(!du(A,c,h,g)||!du(h,g,A,c));var _,x}function sh(A,c,h){for(const g of h)for(let _=0;_<g.length-1;++_)if(fu(A,c,g[_],g[_+1]))return!0;return!1}function Nl(A,c,h=!1){let g=!1;for(const S of c)for(let F=0;F<S.length-1;F++){if(so(A,S[F],S[F+1]))return h;(x=S[F])[1]>(_=A)[1]!=(T=S[F+1])[1]>_[1]&&_[0]<(T[0]-x[0])*(_[1]-x[1])/(T[1]-x[1])+x[0]&&(g=!g)}var _,x,T;return g}function Is(A,c){for(const h of c)if(Nl(A,h))return!0;return!1}function Jo(A,c){for(const h of A)if(!Nl(h,c))return!1;for(let h=0;h<A.length-1;++h)if(sh(A[h],A[h+1],c))return!1;return!0}function oh(A,c){for(const h of c)if(Jo(A,h))return!0;return!1}function du(A,c,h,g){const _=g[0]-h[0],x=g[1]-h[1],T=(A[0]-h[0])*x-_*(A[1]-h[1]),S=(c[0]-h[0])*x-_*(c[1]-h[1]);return T>0&&S<0||T<0&&S>0}function $a(A,c,h){const g=[];for(let _=0;_<A.length;_++){const x=[];for(let T=0;T<A[_].length;T++){const S=Dl(A[_][T],h);ja(c,S),x.push(S)}g.push(x)}return g}function pu(A,c,h){const g=[];for(let _=0;_<A.length;_++){const x=$a(A[_],c,h);g.push(x)}return g}function wo(A,c,h,g){if(A[0]<h[0]||A[0]>h[2]){const _=.5*g;let x=A[0]-h[0]>_?-g:h[0]-A[0]>_?g:0;x===0&&(x=A[0]-h[2]>_?-g:h[2]-A[0]>_?g:0),A[0]+=x}ja(c,A)}function xo(A,c,h,g){const _=Math.pow(2,g.z)*Xn,x=[g.x*Xn,g.y*Xn],T=[];for(const S of A)for(const F of S){const U=[F.x+x[0],F.y+x[1]];wo(U,c,h,_),T.push(U)}return T}function yc(A,c,h,g){const _=Math.pow(2,g.z)*Xn,x=[g.x*Xn,g.y*Xn],T=[];for(const F of A){const U=[];for(const z of F){const K=[z.x+x[0],z.y+x[1]];ja(c,K),U.push(K)}T.push(U)}if(c[2]-c[0]<=_/2){(S=c)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const F of T)for(const U of F)wo(U,c,h,_)}var S;return T}class ds{constructor(c,h){this.type=Zr,this.geojson=c,this.geometries=h}static parse(c,h){if(c.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(cl(c[1])){const g=c[1];if(g.type==="FeatureCollection"){const _=[];for(const x of g.features){const{type:T,coordinates:S}=x.geometry;T==="Polygon"&&_.push(S),T==="MultiPolygon"&&_.push(...S)}if(_.length)return new ds(g,{type:"MultiPolygon",coordinates:_})}else if(g.type==="Feature"){const _=g.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new ds(g,g.geometry)}else if(g.type==="Polygon"||g.type==="MultiPolygon")return new ds(g,g)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(h,g){const _=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],T=h.canonicalID();if(g.type==="Polygon"){const S=$a(g.coordinates,x,T),F=xo(h.geometry(),_,x,T);if(!kl(_,x))return!1;for(const U of F)if(!Nl(U,S))return!1}if(g.type==="MultiPolygon"){const S=pu(g.coordinates,x,T),F=xo(h.geometry(),_,x,T);if(!kl(_,x))return!1;for(const U of F)if(!Is(U,S))return!1}return!0}(c,this.geometries);if(c.geometryType()==="LineString")return function(h,g){const _=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],T=h.canonicalID();if(g.type==="Polygon"){const S=$a(g.coordinates,x,T),F=yc(h.geometry(),_,x,T);if(!kl(_,x))return!1;for(const U of F)if(!Jo(U,S))return!1}if(g.type==="MultiPolygon"){const S=pu(g.coordinates,x,T),F=yc(h.geometry(),_,x,T);if(!kl(_,x))return!1;for(const U of F)if(!oh(U,S))return!1}return!0}(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let zl=class{constructor(A=[],c=(h,g)=>h<g?-1:h>g?1:0){if(this.data=A,this.length=this.data.length,this.compare=c,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(A){this.data.push(A),this._up(this.length++)}pop(){if(this.length===0)return;const A=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),A}peek(){return this.data[0]}_up(A){const{data:c,compare:h}=this,g=c[A];for(;A>0;){const _=A-1>>1,x=c[_];if(h(g,x)>=0)break;c[A]=x,A=_}c[A]=g}_down(A){const{data:c,compare:h}=this,g=this.length>>1,_=c[A];for(;A<g;){let x=1+(A<<1);const T=x+1;if(T<this.length&&h(c[T],c[x])<0&&(x=T),h(c[x],_)>=0)break;c[A]=c[x],A=x}c[A]=_}};function ah(A,c,h=0,g=A.length-1,_=Ji){for(;g>h;){if(g-h>600){const F=g-h+1,U=c-h+1,z=Math.log(F),K=.5*Math.exp(2*z/3),ee=.5*Math.sqrt(z*K*(F-K)/F)*(U-F/2<0?-1:1);ah(A,c,Math.max(h,Math.floor(c-U*K/F+ee)),Math.min(g,Math.floor(c+(F-U)*K/F+ee)),_)}const x=A[c];let T=h,S=g;for(wa(A,h,c),_(A[g],x)>0&&wa(A,h,g);T<S;){for(wa(A,T,S),T++,S--;_(A[T],x)<0;)T++;for(;_(A[S],x)>0;)S--}_(A[h],x)===0?wa(A,h,S):(S++,wa(A,S,g)),S<=c&&(h=S+1),c<=S&&(g=S-1)}}function wa(A,c,h){const g=A[c];A[c]=A[h],A[h]=g}function Ji(A,c){return A<c?-1:A>c?1:0}function bc(A,c){if(A.length<=1)return[A];const h=[];let g,_;for(const x of A){const T=hl(x);T!==0&&(x.area=Math.abs(T),_===void 0&&(_=T<0),_===T<0?(g&&h.push(g),g=[x]):g.push(x))}if(g&&h.push(g),c>1)for(let x=0;x<h.length;x++)h[x].length<=c||(ah(h[x],c,1,h[x].length-1,Ga),h[x]=h[x].slice(0,c));return h}function Ga(A,c){return c.area-A.area}function hl(A){let c=0;for(let h,g,_=0,x=A.length,T=x-1;_<x;T=_++)h=A[_],g=A[T],c+=(g.x-h.x)*(h.y+g.y);return c}const gu=1/298.257223563,mu=gu*(2-gu),vc=Math.PI/180;class wc{constructor(c){const h=6378.137*vc*1e3,g=Math.cos(c*vc),_=1/(1-mu*(1-g*g)),x=Math.sqrt(_);this.kx=h*x*g,this.ky=h*x*_*(1-mu)}distance(c,h){const g=this.wrap(c[0]-h[0])*this.kx,_=(c[1]-h[1])*this.ky;return Math.sqrt(g*g+_*_)}pointOnLine(c,h){let g,_,x,T,S=1/0;for(let F=0;F<c.length-1;F++){let U=c[F][0],z=c[F][1],K=this.wrap(c[F+1][0]-U)*this.kx,ee=(c[F+1][1]-z)*this.ky,oe=0;K===0&&ee===0||(oe=(this.wrap(h[0]-U)*this.kx*K+(h[1]-z)*this.ky*ee)/(K*K+ee*ee),oe>1?(U=c[F+1][0],z=c[F+1][1]):oe>0&&(U+=K/this.kx*oe,z+=ee/this.ky*oe)),K=this.wrap(h[0]-U)*this.kx,ee=(h[1]-z)*this.ky;const le=K*K+ee*ee;le<S&&(S=le,g=U,_=z,x=F,T=oe)}return{point:[g,_],index:x,t:Math.max(0,Math.min(1,T))}}wrap(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}}function xc(A,c){return c[0]-A[0]}function Al(A){return A[1]-A[0]+1}function Ps(A,c){return A[1]>=A[0]&&A[1]<c}function _u(A,c){if(A[0]>A[1])return[null,null];const h=Al(A);if(c){if(h===2)return[A,null];const _=Math.floor(h/2);return[[A[0],A[0]+_],[A[0]+_,A[1]]]}if(h===1)return[A,null];const g=Math.floor(h/2)-1;return[[A[0],A[0]+g],[A[0]+g+1,A[1]]]}function Bo(A,c){if(!Ps(c,A.length))return[1/0,1/0,-1/0,-1/0];const h=[1/0,1/0,-1/0,-1/0];for(let g=c[0];g<=c[1];++g)ja(h,A[g]);return h}function xa(A){const c=[1/0,1/0,-1/0,-1/0];for(const h of A)for(const g of h)ja(c,g);return c}function Ai(A){return A[0]!==-1/0&&A[1]!==-1/0&&A[2]!==1/0&&A[3]!==1/0}function Gr(A,c,h){if(!Ai(A)||!Ai(c))return NaN;let g=0,_=0;return A[2]<c[0]&&(g=c[0]-A[2]),A[0]>c[2]&&(g=A[0]-c[2]),A[1]>c[3]&&(_=A[1]-c[3]),A[3]<c[1]&&(_=c[1]-A[3]),h.distance([0,0],[g,_])}function fi(A,c,h){const g=h.pointOnLine(c,A);return h.distance(A,g.point)}function Ni(A,c,h,g,_){const x=Math.min(fi(A,[h,g],_),fi(c,[h,g],_)),T=Math.min(fi(h,[A,c],_),fi(g,[A,c],_));return Math.min(x,T)}function Ql(A,c,h,g,_){if(!Ps(c,A.length)||!Ps(g,h.length))return 1/0;let x=1/0;for(let T=c[0];T<c[1];++T){const S=A[T],F=A[T+1];for(let U=g[0];U<g[1];++U){const z=h[U],K=h[U+1];if(fu(S,F,z,K))return 0;x=Math.min(x,Ni(S,F,z,K,_))}}return x}function lh(A,c,h,g,_){if(!Ps(c,A.length)||!Ps(g,h.length))return NaN;let x=1/0;for(let T=c[0];T<=c[1];++T)for(let S=g[0];S<=g[1];++S)if(x=Math.min(x,_.distance(A[T],h[S])),x===0)return x;return x}function fl(A,c,h){if(Nl(A,c,!0))return 0;let g=1/0;for(const _ of c){const x=_[0],T=_[_.length-1];if(x!==T&&(g=Math.min(g,fi(A,[T,x],h)),g===0))return g;const S=h.pointOnLine(_,A);if(g=Math.min(g,h.distance(A,S.point)),g===0)return g}return g}function iA(A,c,h,g){if(!Ps(c,A.length))return NaN;for(let x=c[0];x<=c[1];++x)if(Nl(A[x],h,!0))return 0;let _=1/0;for(let x=c[0];x<c[1];++x){const T=A[x],S=A[x+1];for(const F of h)for(let U=0,z=F.length,K=z-1;U<z;K=U++){const ee=F[K],oe=F[U];if(fu(T,S,ee,oe))return 0;_=Math.min(_,Ni(T,S,ee,oe,g))}}return _}function Rd(A,c){for(const h of A)for(const g of h)if(Nl(g,c,!0))return!0;return!1}function Eg(A,c,h,g=1/0){const _=xa(A),x=xa(c);if(g!==1/0&&Gr(_,x,h)>=g)return g;if(kl(_,x)){if(Rd(A,c))return 0}else if(Rd(c,A))return 0;let T=1/0;for(const S of A)for(let F=0,U=S.length,z=U-1;F<U;z=F++){const K=S[z],ee=S[F];for(const oe of c)for(let le=0,pe=oe.length,Ce=pe-1;le<pe;Ce=le++){const Ue=oe[Ce],At=oe[le];if(fu(K,ee,Ue,At))return 0;T=Math.min(T,Ni(K,ee,Ue,At,h))}}return T}function Ld(A,c,h,g,_,x){if(!x)return;const T=Gr(Bo(g,x),_,h);T<c&&A.push([T,x,[0,0]])}function sA(A,c,h,g,_,x,T){if(!x||!T)return;const S=Gr(Bo(g,x),Bo(_,T),h);S<c&&A.push([S,x,T])}function oA(A,c,h,g,_=1/0){let x=Math.min(g.distance(A[0],h[0][0]),_);if(x===0)return x;const T=new zl([[0,[0,A.length-1],[0,0]]],xc),S=xa(h);for(;T.length>0;){const F=T.pop();if(F[0]>=x)continue;const U=F[1],z=c?50:100;if(Al(U)<=z){if(!Ps(U,A.length))return NaN;if(c){const K=iA(A,U,h,g);if(isNaN(K)||K===0)return K;x=Math.min(x,K)}else for(let K=U[0];K<=U[1];++K){const ee=fl(A[K],h,g);if(x=Math.min(x,ee),x===0)return 0}}else{const K=_u(U,c);Ld(T,x,g,A,S,K[0]),Ld(T,x,g,A,S,K[1])}}return x}function aA(A,c,h,g,_,x=1/0){let T=Math.min(x,_.distance(A[0],h[0]));if(T===0)return T;const S=new zl([[0,[0,A.length-1],[0,h.length-1]]],xc);for(;S.length>0;){const F=S.pop();if(F[0]>=T)continue;const U=F[1],z=F[2],K=c?50:100,ee=g?50:100;if(Al(U)<=K&&Al(z)<=ee){if(!Ps(U,A.length)&&Ps(z,h.length))return NaN;let oe;if(c&&g)oe=Ql(A,U,h,z,_),T=Math.min(T,oe);else if(c&&!g){const le=A.slice(U[0],U[1]+1);for(let pe=z[0];pe<=z[1];++pe)if(oe=fi(h[pe],le,_),T=Math.min(T,oe),T===0)return T}else if(!c&&g){const le=h.slice(z[0],z[1]+1);for(let pe=U[0];pe<=U[1];++pe)if(oe=fi(A[pe],le,_),T=Math.min(T,oe),T===0)return T}else oe=lh(A,U,h,z,_),T=Math.min(T,oe)}else{const oe=_u(U,c),le=_u(z,g);sA(S,T,_,A,h,oe[0],le[0]),sA(S,T,_,A,h,oe[0],le[1]),sA(S,T,_,A,h,oe[1],le[0]),sA(S,T,_,A,h,oe[1],le[1])}}return T}function hf(A){return A.type==="MultiPolygon"?A.coordinates.map(c=>({type:"Polygon",coordinates:c})):A.type==="MultiLineString"?A.coordinates.map(c=>({type:"LineString",coordinates:c})):A.type==="MultiPoint"?A.coordinates.map(c=>({type:"Point",coordinates:c})):[A]}class Bc{constructor(c,h){this.type=er,this.geojson=c,this.geometries=h}static parse(c,h){if(c.length!==2)return h.error(`'distance' expression requires exactly one argument, but found ${c.length-1} instead.`);if(cl(c[1])){const g=c[1];if(g.type==="FeatureCollection")return new Bc(g,g.features.map(_=>hf(_.geometry)).flat());if(g.type==="Feature")return new Bc(g,hf(g.geometry));if("type"in g&&"coordinates"in g)return new Bc(g,hf(g))}return h.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(h,g){const _=h.geometry(),x=_.flat().map(F=>va([F.x,F.y],h.canonical));if(_.length===0)return NaN;const T=new wc(x[0][1]);let S=1/0;for(const F of g){switch(F.type){case"Point":S=Math.min(S,aA(x,!1,[F.coordinates],!1,T,S));break;case"LineString":S=Math.min(S,aA(x,!1,F.coordinates,!0,T,S));break;case"Polygon":S=Math.min(S,oA(x,!1,F.coordinates,T,S))}if(S===0)return S}return S}(c,this.geometries);if(c.geometryType()==="LineString")return function(h,g){const _=h.geometry(),x=_.flat().map(F=>va([F.x,F.y],h.canonical));if(_.length===0)return NaN;const T=new wc(x[0][1]);let S=1/0;for(const F of g){switch(F.type){case"Point":S=Math.min(S,aA(x,!0,[F.coordinates],!1,T,S));break;case"LineString":S=Math.min(S,aA(x,!0,F.coordinates,!0,T,S));break;case"Polygon":S=Math.min(S,oA(x,!0,F.coordinates,T,S))}if(S===0)return S}return S}(c,this.geometries);if(c.geometryType()==="Polygon")return function(h,g){const _=h.geometry();if(_.length===0||_[0].length===0)return NaN;const x=bc(_,0).map(F=>F.map(U=>U.map(z=>va([z.x,z.y],h.canonical)))),T=new wc(x[0][0][0][1]);let S=1/0;for(const F of g)for(const U of x){switch(F.type){case"Point":S=Math.min(S,oA([F.coordinates],!1,U,T,S));break;case"LineString":S=Math.min(S,oA(F.coordinates,!0,U,T,S));break;case"Polygon":S=Math.min(S,Eg(U,F.coordinates,T,S))}if(S===0)return S}return S}(c,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ch{constructor(c){this.type=Vt,this.key=c}static parse(c,h){if(c.length!==2)return h.error(`Expected 1 argument, but found ${c.length-1} instead.`);const g=c[1];return g==null?h.error("Global state property must be defined."):typeof g!="string"?h.error(`Global state property must be string, but found ${typeof c[1]} instead.`):new ch(g)}evaluate(c){var h;const g=(h=c.globals)===null||h===void 0?void 0:h.globalState;return g&&Object.keys(g).length!==0?Ac(g,this.key):null}eachChild(){}outputDefined(){return!1}}const yu={"==":ki,"!=":ls,">":Ul,"<":fs,">=":uf,"<=":ih,array:Yr,at:Ol,boolean:Yr,case:Q,coalesce:ei,collator:ba,format:mc,image:_c,in:gc,"index-of":io,interpolate:Vr,"interpolate-hcl":Vr,"interpolate-lab":Vr,length:ul,let:Ha,literal:ko,match:Yo,number:Yr,"number-format":Zo,object:Yr,slice:ue,step:tt,string:Yr,"to-boolean":An,"to-color":An,"to-number":An,"to-string":An,var:Va,within:ds,distance:Bc,"global-state":ch};class ea{constructor(c,h,g,_){this.name=c,this.type=h,this._evaluate=g,this.args=_}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}static parse(c,h){const g=c[0],_=ea.definitions[g];if(!_)return h.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(_)?_[0]:_.type,T=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,S=T.filter(([U])=>!Array.isArray(U)||U.length===c.length-1);let F=null;for(const[U,z]of S){F=new Qa(h.registry,lA,h.path,null,h.scope);const K=[];let ee=!1;for(let oe=1;oe<c.length;oe++){const le=c[oe],pe=Array.isArray(U)?U[oe-1]:U.type,Ce=F.parse(le,1+K.length,pe);if(!Ce){ee=!0;break}K.push(Ce)}if(!ee)if(Array.isArray(U)&&U.length!==K.length)F.error(`Expected ${U.length} arguments, but found ${K.length} instead.`);else{for(let oe=0;oe<K.length;oe++){const le=Array.isArray(U)?U[oe]:U.type,pe=K[oe];F.concat(oe+1).checkSubtype(le,pe.type)}if(F.errors.length===0)return new ea(g,x,z,K)}}if(S.length===1)h.errors.push(...F.errors);else{const U=(S.length?S:T).map(([K])=>{return ee=K,Array.isArray(ee)?`(${ee.map(Nr).join(", ")})`:`(${Nr(ee.type)}...)`;var ee}).join(" | "),z=[];for(let K=1;K<c.length;K++){const ee=h.parse(c[K],1+z.length);if(!ee)return null;z.push(Nr(ee.type))}h.error(`Expected arguments of type ${U}, but found (${z.join(", ")}) instead.`)}return null}static register(c,h){ea.definitions=h;for(const g in h)c[g]=ea}}function Od(A,[c,h,g,_]){c=c.evaluate(A),h=h.evaluate(A),g=g.evaluate(A);const x=_?_.evaluate(A):1,T=dc(c,h,g,x);if(T)throw new si(T);return new en(c/255,h/255,g/255,x,!1)}function uh(A,c){return A in c}function Af(A,c){const h=c[A];return h===void 0?null:h}function Cc(A){return{type:A}}function lA(A){if(A instanceof Va)return lA(A.boundExpression);if(A instanceof ea&&A.name==="error"||A instanceof ba||A instanceof ds||A instanceof Bc||A instanceof ch)return!1;const c=A instanceof An||A instanceof Yr;let h=!0;return A.eachChild(g=>{h=c?h&&lA(g):h&&g instanceof ko}),!!h&&cA(A)&&uA(A,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function cA(A){if(A instanceof ea&&(A.name==="get"&&A.args.length===1||A.name==="feature-state"||A.name==="has"&&A.args.length===1||A.name==="properties"||A.name==="geometry-type"||A.name==="id"||/^filter-/.test(A.name))||A instanceof ds||A instanceof Bc)return!1;let c=!0;return A.eachChild(h=>{c&&!cA(h)&&(c=!1)}),c}function hh(A){if(A instanceof ea&&A.name==="feature-state")return!1;let c=!0;return A.eachChild(h=>{c&&!hh(h)&&(c=!1)}),c}function uA(A,c){if(A instanceof ea&&c.indexOf(A.name)>=0)return!1;let h=!0;return A.eachChild(g=>{h&&!uA(g,c)&&(h=!1)}),h}function Ud(A){return{result:"success",value:A}}function bu(A){return{result:"error",value:A}}function Tc(A){return A["property-type"]==="data-driven"||A["property-type"]==="cross-faded-data-driven"}function hA(A){return!!A.expression&&A.expression.parameters.indexOf("zoom")>-1}function Co(A){return!!A.expression&&A.expression.interpolated}function on(A){return A instanceof Number?"number":A instanceof String?"string":A instanceof Boolean?"boolean":Array.isArray(A)?"array":A===null?"null":typeof A}function Hl(A){return typeof A=="object"&&A!==null&&!Array.isArray(A)&&Kn(A)===Ke}function ff(A){return A}function Dd(A,c){const h=A.stops&&typeof A.stops[0][0]=="object",g=h||!(h||A.property!==void 0),_=A.type||(Co(c)?"exponential":"interval"),x=function(z){switch(z.type){case"color":return en.parse;case"padding":return as.parse;case"numberArray":return Ss.parse;case"colorArray":return Zi.parse;default:return null}}(c);if(x&&((A=vn({},A)).stops&&(A.stops=A.stops.map(z=>[z[0],x(z[1])])),A.default=x(A.default?A.default:c.default)),A.colorSpace&&(T=A.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${A.colorSpace}"`);var T;const S=function(z){switch(z){case"exponential":return Nd;case"interval":return kd;case"categorical":return AA;case"identity":return Ah;default:throw new Error(`Unknown function type "${z}"`)}}(_);let F,U;if(_==="categorical"){F=Object.create(null);for(const z of A.stops)F[z[0]]=z[1];U=typeof A.stops[0][0]}if(h){const z={},K=[];for(let le=0;le<A.stops.length;le++){const pe=A.stops[le],Ce=pe[0].zoom;z[Ce]===void 0&&(z[Ce]={zoom:Ce,type:A.type,property:A.property,default:A.default,stops:[]},K.push(Ce)),z[Ce].stops.push([pe[0].value,pe[1]])}const ee=[];for(const le of K)ee.push([z[le].zoom,Dd(z[le],c)]);const oe={name:"linear"};return{kind:"composite",interpolationType:oe,interpolationFactor:Vr.interpolationFactor.bind(void 0,oe),zoomStops:ee.map(le=>le[0]),evaluate:({zoom:le},pe)=>Nd({stops:ee,base:A.base},c,le).evaluate(le,pe)}}if(g){const z=_==="exponential"?{name:"exponential",base:A.base!==void 0?A.base:1}:null;return{kind:"camera",interpolationType:z,interpolationFactor:Vr.interpolationFactor.bind(void 0,z),zoomStops:A.stops.map(K=>K[0]),evaluate:({zoom:K})=>S(A,c,K,F,U)}}return{kind:"source",evaluate(z,K){const ee=K&&K.properties?K.properties[A.property]:void 0;return ee===void 0?Ec(A.default,c.default):S(A,c,ee,F,U)}}}function Ec(A,c,h){return A!==void 0?A:c!==void 0?c:h!==void 0?h:void 0}function AA(A,c,h,g,_){return Ec(typeof h===_?g[h]:void 0,A.default,c.default)}function kd(A,c,h){if(on(h)!=="number")return Ec(A.default,c.default);const g=A.stops.length;if(g===1||h<=A.stops[0][0])return A.stops[0][1];if(h>=A.stops[g-1][0])return A.stops[g-1][1];const _=Fe(A.stops.map(x=>x[0]),h);return A.stops[_][1]}function Nd(A,c,h){const g=A.base!==void 0?A.base:1;if(on(h)!=="number")return Ec(A.default,c.default);const _=A.stops.length;if(_===1||h<=A.stops[0][0])return A.stops[0][1];if(h>=A.stops[_-1][0])return A.stops[_-1][1];const x=Fe(A.stops.map(z=>z[0]),h),T=function(z,K,ee,oe){const le=oe-ee,pe=z-ee;return le===0?0:K===1?pe/le:(Math.pow(K,pe)-1)/(Math.pow(K,le)-1)}(h,g,A.stops[x][0],A.stops[x+1][0]),S=A.stops[x][1],F=A.stops[x+1][1],U=dn[c.type]||ff;return typeof S.evaluate=="function"?{evaluate(...z){const K=S.evaluate.apply(void 0,z),ee=F.evaluate.apply(void 0,z);if(K!==void 0&&ee!==void 0)return U(K,ee,T,A.colorSpace)}}:U(S,F,T,A.colorSpace)}function Ah(A,c,h){switch(c.type){case"color":h=en.parse(h);break;case"formatted":h=Qr.fromString(h.toString());break;case"resolvedImage":h=As.fromString(h.toString());break;case"padding":h=as.parse(h);break;case"colorArray":h=Zi.parse(h);break;case"numberArray":h=Ss.parse(h);break;default:on(h)===c.type||c.type==="enum"&&c.values[h]||(h=void 0)}return Ec(h,A.default,c.default)}ea.register(yu,{error:[{kind:"error"},[Xr],(A,[c])=>{throw new si(c.evaluate(A))}],typeof:[Xr,[Vt],(A,[c])=>Nr(Kn(c.evaluate(A)))],"to-rgba":[qn(er,4),[yi],(A,[c])=>{const[h,g,_,x]=c.evaluate(A).rgb;return[255*h,255*g,255*_,x]}],rgb:[yi,[er,er,er],Od],rgba:[yi,[er,er,er,er],Od],has:{type:Zr,overloads:[[[Xr],(A,[c])=>uh(c.evaluate(A),A.properties())],[[Xr,Ke],(A,[c,h])=>uh(c.evaluate(A),h.evaluate(A))]]},get:{type:Vt,overloads:[[[Xr],(A,[c])=>Af(c.evaluate(A),A.properties())],[[Xr,Ke],(A,[c,h])=>Af(c.evaluate(A),h.evaluate(A))]]},"feature-state":[Vt,[Xr],(A,[c])=>Af(c.evaluate(A),A.featureState||{})],properties:[Ke,[],A=>A.properties()],"geometry-type":[Xr,[],A=>A.geometryType()],id:[Vt,[],A=>A.id()],zoom:[er,[],A=>A.globals.zoom],"heatmap-density":[er,[],A=>A.globals.heatmapDensity||0],elevation:[er,[],A=>A.globals.elevation||0],"line-progress":[er,[],A=>A.globals.lineProgress||0],accumulated:[Vt,[],A=>A.globals.accumulated===void 0?null:A.globals.accumulated],"+":[er,Cc(er),(A,c)=>{let h=0;for(const g of c)h+=g.evaluate(A);return h}],"*":[er,Cc(er),(A,c)=>{let h=1;for(const g of c)h*=g.evaluate(A);return h}],"-":{type:er,overloads:[[[er,er],(A,[c,h])=>c.evaluate(A)-h.evaluate(A)],[[er],(A,[c])=>-c.evaluate(A)]]},"/":[er,[er,er],(A,[c,h])=>c.evaluate(A)/h.evaluate(A)],"%":[er,[er,er],(A,[c,h])=>c.evaluate(A)%h.evaluate(A)],ln2:[er,[],()=>Math.LN2],pi:[er,[],()=>Math.PI],e:[er,[],()=>Math.E],"^":[er,[er,er],(A,[c,h])=>Math.pow(c.evaluate(A),h.evaluate(A))],sqrt:[er,[er],(A,[c])=>Math.sqrt(c.evaluate(A))],log10:[er,[er],(A,[c])=>Math.log(c.evaluate(A))/Math.LN10],ln:[er,[er],(A,[c])=>Math.log(c.evaluate(A))],log2:[er,[er],(A,[c])=>Math.log(c.evaluate(A))/Math.LN2],sin:[er,[er],(A,[c])=>Math.sin(c.evaluate(A))],cos:[er,[er],(A,[c])=>Math.cos(c.evaluate(A))],tan:[er,[er],(A,[c])=>Math.tan(c.evaluate(A))],asin:[er,[er],(A,[c])=>Math.asin(c.evaluate(A))],acos:[er,[er],(A,[c])=>Math.acos(c.evaluate(A))],atan:[er,[er],(A,[c])=>Math.atan(c.evaluate(A))],min:[er,Cc(er),(A,c)=>Math.min(...c.map(h=>h.evaluate(A)))],max:[er,Cc(er),(A,c)=>Math.max(...c.map(h=>h.evaluate(A)))],abs:[er,[er],(A,[c])=>Math.abs(c.evaluate(A))],round:[er,[er],(A,[c])=>{const h=c.evaluate(A);return h<0?-Math.round(-h):Math.round(h)}],floor:[er,[er],(A,[c])=>Math.floor(c.evaluate(A))],ceil:[er,[er],(A,[c])=>Math.ceil(c.evaluate(A))],"filter-==":[Zr,[Xr,Vt],(A,[c,h])=>A.properties()[c.value]===h.value],"filter-id-==":[Zr,[Vt],(A,[c])=>A.id()===c.value],"filter-type-==":[Zr,[Xr],(A,[c])=>A.geometryType()===c.value],"filter-<":[Zr,[Xr,Vt],(A,[c,h])=>{const g=A.properties()[c.value],_=h.value;return typeof g==typeof _&&g<_}],"filter-id-<":[Zr,[Vt],(A,[c])=>{const h=A.id(),g=c.value;return typeof h==typeof g&&h<g}],"filter->":[Zr,[Xr,Vt],(A,[c,h])=>{const g=A.properties()[c.value],_=h.value;return typeof g==typeof _&&g>_}],"filter-id->":[Zr,[Vt],(A,[c])=>{const h=A.id(),g=c.value;return typeof h==typeof g&&h>g}],"filter-<=":[Zr,[Xr,Vt],(A,[c,h])=>{const g=A.properties()[c.value],_=h.value;return typeof g==typeof _&&g<=_}],"filter-id-<=":[Zr,[Vt],(A,[c])=>{const h=A.id(),g=c.value;return typeof h==typeof g&&h<=g}],"filter->=":[Zr,[Xr,Vt],(A,[c,h])=>{const g=A.properties()[c.value],_=h.value;return typeof g==typeof _&&g>=_}],"filter-id->=":[Zr,[Vt],(A,[c])=>{const h=A.id(),g=c.value;return typeof h==typeof g&&h>=g}],"filter-has":[Zr,[Vt],(A,[c])=>c.value in A.properties()],"filter-has-id":[Zr,[],A=>A.id()!==null&&A.id()!==void 0],"filter-type-in":[Zr,[qn(Xr)],(A,[c])=>c.value.indexOf(A.geometryType())>=0],"filter-id-in":[Zr,[qn(Vt)],(A,[c])=>c.value.indexOf(A.id())>=0],"filter-in-small":[Zr,[Xr,qn(Vt)],(A,[c,h])=>h.value.indexOf(A.properties()[c.value])>=0],"filter-in-large":[Zr,[Xr,qn(Vt)],(A,[c,h])=>function(g,_,x,T){for(;x<=T;){const S=x+T>>1;if(_[S]===g)return!0;_[S]>g?T=S-1:x=S+1}return!1}(A.properties()[c.value],h.value,0,h.value.length-1)],all:{type:Zr,overloads:[[[Zr,Zr],(A,[c,h])=>c.evaluate(A)&&h.evaluate(A)],[Cc(Zr),(A,c)=>{for(const h of c)if(!h.evaluate(A))return!1;return!0}]]},any:{type:Zr,overloads:[[[Zr,Zr],(A,[c,h])=>c.evaluate(A)||h.evaluate(A)],[Cc(Zr),(A,c)=>{for(const h of c)if(h.evaluate(A))return!0;return!1}]]},"!":[Zr,[Zr],(A,[c])=>!c.evaluate(A)],"is-supported-script":[Zr,[Xr],(A,[c])=>{const h=A.globals&&A.globals.isSupportedScript;return!h||h(c.evaluate(A))}],upcase:[Xr,[Xr],(A,[c])=>c.evaluate(A).toUpperCase()],downcase:[Xr,[Xr],(A,[c])=>c.evaluate(A).toLowerCase()],concat:[Xr,Cc(Vt),(A,c)=>c.map(h=>kn(h.evaluate(A))).join("")],"resolved-locale":[Xr,[Ar],(A,[c])=>c.evaluate(A).resolvedLocale()]});class fh{constructor(c,h,g){this.expression=c,this._warningHistory={},this._evaluator=new No,this._defaultValue=h?function(_){if(_.type==="color"&&Hl(_.default))return new en(0,0,0,0);switch(_.type){case"color":return en.parse(_.default)||null;case"padding":return as.parse(_.default)||null;case"numberArray":return Ss.parse(_.default)||null;case"colorArray":return Zi.parse(_.default)||null;case"variableAnchorOffsetCollection":return xi.parse(_.default)||null;case"projectionDefinition":return no.parse(_.default)||null;default:return _.default===void 0?null:_.default}}(h):null,this._enumValues=h&&h.type==="enum"?h.values:null,this._globalState=g}evaluateWithoutErrorHandling(c,h,g,_,x,T){return this._globalState&&(c=ph(c,this._globalState)),this._evaluator.globals=c,this._evaluator.feature=h,this._evaluator.featureState=g,this._evaluator.canonical=_,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(c,h,g,_,x,T){this._globalState&&(c=ph(c,this._globalState)),this._evaluator.globals=c,this._evaluator.feature=h||null,this._evaluator.featureState=g||null,this._evaluator.canonical=_,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=T||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new si(`Expected value to be one of ${Object.keys(this._enumValues).map(F=>JSON.stringify(F)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(S.message)),this._defaultValue}}}function vu(A){return Array.isArray(A)&&A.length>0&&typeof A[0]=="string"&&A[0]in yu}function dh(A,c,h){const g=new Qa(yu,lA,[],c?function(x){const T={color:yi,string:Xr,number:er,enum:Xr,boolean:Zr,formatted:xn,padding:Jn,numberArray:Xi,colorArray:Wn,projectionDefinition:Xo,resolvedImage:os,variableAnchorOffsetCollection:Di};return x.type==="array"?qn(T[x.value]||Vt,x.length):T[x.type]}(c):void 0),_=g.parse(A,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?Ud(new fh(_,c,h)):bu(g.errors)}class df{constructor(c,h,g){this.kind=c,this._styleExpression=h,this.isStateDependent=c!=="constant"&&!hh(h.expression),this.globalStateRefs=pf(h.expression),this._globalState=g}evaluateWithoutErrorHandling(c,h,g,_,x,T){return this._globalState&&(c=ph(c,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(c,h,g,_,x,T)}evaluate(c,h,g,_,x,T){return this._globalState&&(c=ph(c,this._globalState)),this._styleExpression.evaluate(c,h,g,_,x,T)}}class zd{constructor(c,h,g,_,x){this.kind=c,this.zoomStops=g,this._styleExpression=h,this.isStateDependent=c!=="camera"&&!hh(h.expression),this.globalStateRefs=pf(h.expression),this.interpolationType=_,this._globalState=x}evaluateWithoutErrorHandling(c,h,g,_,x,T){return this._globalState&&(c=ph(c,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(c,h,g,_,x,T)}evaluate(c,h,g,_,x,T){return this._globalState&&(c=ph(c,this._globalState)),this._styleExpression.evaluate(c,h,g,_,x,T)}interpolationFactor(c,h,g){return this.interpolationType?Vr.interpolationFactor(this.interpolationType,c,h,g):0}}function Qd(A,c,h){const g=dh(A,c,h);if(g.result==="error")return g;const _=g.value.expression,x=cA(_);if(!x&&!Tc(c))return bu([new wi("","data expressions not supported")]);const T=uA(_,["zoom"]);if(!T&&!hA(c))return bu([new wi("","zoom expressions not supported")]);const S=dA(_);return S||T?S instanceof wi?bu([S]):S instanceof Vr&&!Co(c)?bu([new wi("",'"interpolate" expressions cannot be used with this property')]):Ud(S?new zd(x?"camera":"composite",g.value,S.labels,S instanceof Vr?S.interpolation:void 0,h):new df(x?"constant":"source",g.value,h)):bu([new wi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class fA{constructor(c,h){this._parameters=c,this._specification=h,vn(this,Dd(this._parameters,this._specification))}static deserialize(c){return new fA(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function dA(A){let c=null;if(A instanceof Ha)c=dA(A.result);else if(A instanceof ei){for(const h of A.args)if(c=dA(h),c)break}else(A instanceof tt||A instanceof Vr)&&A.input instanceof ea&&A.input.name==="zoom"&&(c=A);return c instanceof wi||A.eachChild(h=>{const g=dA(h);g instanceof wi?c=g:!c&&g?c=new wi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):c&&g&&c!==g&&(c=new wi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),c}function pf(A,c=new Set){return A instanceof ch&&c.add(A.key),A.eachChild(h=>{pf(h,c)}),c}function ph(A,c){const{zoom:h,heatmapDensity:g,elevation:_,lineProgress:x,isSupportedScript:T,accumulated:S}=A??{};return{zoom:h,heatmapDensity:g,elevation:_,lineProgress:x,isSupportedScript:T,accumulated:S,globalState:c}}function gf(A){if(A===!0||A===!1)return!0;if(!Array.isArray(A)||A.length===0)return!1;switch(A[0]){case"has":return A.length>=2&&A[1]!=="$id"&&A[1]!=="$type";case"in":return A.length>=3&&(typeof A[1]!="string"||Array.isArray(A[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return A.length!==3||Array.isArray(A[1])||Array.isArray(A[2]);case"any":case"all":for(const c of A.slice(1))if(!gf(c)&&typeof c!="boolean")return!1;return!0;default:return!0}}const mf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Sc(A,c){if(A==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};gf(A)||(A=_f(A));const h=dh(A,mf,c);if(h.result==="error")throw new Error(h.value.map(g=>`${g.key}: ${g.message}`).join(", "));return{filter:(g,_,x)=>h.value.evaluate(g,_,{},x),needGeometry:Sg(A),getGlobalStateRefs:()=>pf(h.value.expression)}}function pA(A,c){return A<c?-1:A>c?1:0}function Sg(A){if(!Array.isArray(A))return!1;if(A[0]==="within"||A[0]==="distance")return!0;for(let c=1;c<A.length;c++)if(Sg(A[c]))return!0;return!1}function _f(A){if(!A)return!0;const c=A[0];return A.length<=1?c!=="any":c==="=="?yf(A[1],A[2],"=="):c==="!="?gh(yf(A[1],A[2],"==")):c==="<"||c===">"||c==="<="||c===">="?yf(A[1],A[2],c):c==="any"?(h=A.slice(1),["any"].concat(h.map(_f))):c==="all"?["all"].concat(A.slice(1).map(_f)):c==="none"?["all"].concat(A.slice(1).map(_f).map(gh)):c==="in"?Hd(A[1],A.slice(2)):c==="!in"?gh(Hd(A[1],A.slice(2))):c==="has"?Vd(A[1]):c!=="!has"||gh(Vd(A[1]));var h}function yf(A,c,h){switch(A){case"$type":return[`filter-type-${h}`,c];case"$id":return[`filter-id-${h}`,c];default:return[`filter-${h}`,A,c]}}function Hd(A,c){if(c.length===0)return!1;switch(A){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some(h=>typeof h!=typeof c[0])?["filter-in-large",A,["literal",c.sort(pA)]]:["filter-in-small",A,["literal",c]]}}function Vd(A){switch(A){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",A]}}function gh(A){return["!",A]}function gA(A){const c=typeof A;if(c==="number"||c==="boolean"||c==="string"||A==null)return JSON.stringify(A);if(Array.isArray(A)){let _="[";for(const x of A)_+=`${gA(x)},`;return`${_}]`}const h=Object.keys(A).sort();let g="{";for(let _=0;_<h.length;_++)g+=`${JSON.stringify(h[_])}:${gA(A[h[_]])},`;return`${g}}`}function dl(A){let c="";for(const h of Sr)c+=`/${gA(A[h])}`;return c}function zo(A){const c=A.value;return c?[new Ot(A.key,c,"constants have been deprecated as of v8")]:[]}function Vn(A){return A instanceof Number||A instanceof String||A instanceof Boolean?A.valueOf():A}function wu(A){if(Array.isArray(A))return A.map(wu);if(A instanceof Object&&!(A instanceof Number||A instanceof String||A instanceof Boolean)){const c={};for(const h in A)c[h]=wu(A[h]);return c}return Vn(A)}function ta(A){const c=A.key,h=A.value,g=A.valueSpec||{},_=A.objectElementValidators||{},x=A.style,T=A.styleSpec,S=A.validateSpec;let F=[];const U=on(h);if(U!=="object")return[new Ot(c,h,`object expected, ${U} found`)];for(const z in h){const K=z.split(".")[0],ee=Ac(g,K)||g["*"];let oe;if(Ac(_,K))oe=_[K];else if(Ac(g,K))oe=S;else if(_["*"])oe=_["*"];else{if(!g["*"]){F.push(new Ot(c,h[z],`unknown property "${z}"`));continue}oe=S}F=F.concat(oe({key:(c&&`${c}.`)+z,value:h[z],valueSpec:ee,style:x,styleSpec:T,object:h,objectKey:z,validateSpec:S},h))}for(const z in g)_[z]||g[z].required&&g[z].default===void 0&&h[z]===void 0&&F.push(new Ot(c,h,`missing required property "${z}"`));return F}function pl(A){const c=A.value,h=A.valueSpec,g=A.style,_=A.styleSpec,x=A.key,T=A.arrayElementValidator||A.validateSpec;if(on(c)!=="array")return[new Ot(x,c,`array expected, ${on(c)} found`)];if(h.length&&c.length!==h.length)return[new Ot(x,c,`array length ${h.length} expected, length ${c.length} found`)];if(h["min-length"]&&c.length<h["min-length"])return[new Ot(x,c,`array length at least ${h["min-length"]} expected, length ${c.length} found`)];let S={type:h.value,values:h.values};_.$version<7&&(S.function=h.function),on(h.value)==="object"&&(S=h.value);let F=[];for(let U=0;U<c.length;U++)F=F.concat(T({array:c,arrayIndex:U,value:c[U],valueSpec:S,validateSpec:A.validateSpec,style:g,styleSpec:_,key:`${x}[${U}]`}));return F}function To(A){const c=A.key,h=A.value,g=A.valueSpec;let _=on(h);return _==="number"&&h!=h&&(_="NaN"),_!=="number"?[new Ot(c,h,`number expected, ${_} found`)]:"minimum"in g&&h<g.minimum?[new Ot(c,h,`${h} is less than the minimum value ${g.minimum}`)]:"maximum"in g&&h>g.maximum?[new Ot(c,h,`${h} is greater than the maximum value ${g.maximum}`)]:[]}function Ig(A){const c=A.valueSpec,h=Vn(A.value.type);let g,_,x,T={};const S=h!=="categorical"&&A.value.property===void 0,F=!S,U=on(A.value.stops)==="array"&&on(A.value.stops[0])==="array"&&on(A.value.stops[0][0])==="object",z=ta({key:A.key,value:A.value,valueSpec:A.styleSpec.function,validateSpec:A.validateSpec,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{stops:function(oe){if(h==="identity")return[new Ot(oe.key,oe.value,'identity function may not have a "stops" property')];let le=[];const pe=oe.value;return le=le.concat(pl({key:oe.key,value:pe,valueSpec:oe.valueSpec,validateSpec:oe.validateSpec,style:oe.style,styleSpec:oe.styleSpec,arrayElementValidator:K})),on(pe)==="array"&&pe.length===0&&le.push(new Ot(oe.key,pe,"array must have at least one stop")),le},default:function(oe){return oe.validateSpec({key:oe.key,value:oe.value,valueSpec:c,validateSpec:oe.validateSpec,style:oe.style,styleSpec:oe.styleSpec})}}});return h==="identity"&&S&&z.push(new Ot(A.key,A.value,'missing required property "property"')),h==="identity"||A.value.stops||z.push(new Ot(A.key,A.value,'missing required property "stops"')),h==="exponential"&&A.valueSpec.expression&&!Co(A.valueSpec)&&z.push(new Ot(A.key,A.value,"exponential functions not supported")),A.styleSpec.$version>=8&&(F&&!Tc(A.valueSpec)?z.push(new Ot(A.key,A.value,"property functions not supported")):S&&!hA(A.valueSpec)&&z.push(new Ot(A.key,A.value,"zoom functions not supported"))),h!=="categorical"&&!U||A.value.property!==void 0||z.push(new Ot(A.key,A.value,'"property" property is required')),z;function K(oe){let le=[];const pe=oe.value,Ce=oe.key;if(on(pe)!=="array")return[new Ot(Ce,pe,`array expected, ${on(pe)} found`)];if(pe.length!==2)return[new Ot(Ce,pe,`array length 2 expected, length ${pe.length} found`)];if(U){if(on(pe[0])!=="object")return[new Ot(Ce,pe,`object expected, ${on(pe[0])} found`)];if(pe[0].zoom===void 0)return[new Ot(Ce,pe,"object stop key must have zoom")];if(pe[0].value===void 0)return[new Ot(Ce,pe,"object stop key must have value")];if(x&&x>Vn(pe[0].zoom))return[new Ot(Ce,pe[0].zoom,"stop zoom values must appear in ascending order")];Vn(pe[0].zoom)!==x&&(x=Vn(pe[0].zoom),_=void 0,T={}),le=le.concat(ta({key:`${Ce}[0]`,value:pe[0],valueSpec:{zoom:{}},validateSpec:oe.validateSpec,style:oe.style,styleSpec:oe.styleSpec,objectElementValidators:{zoom:To,value:ee}}))}else le=le.concat(ee({key:`${Ce}[0]`,value:pe[0],validateSpec:oe.validateSpec,style:oe.style,styleSpec:oe.styleSpec},pe));return vu(wu(pe[1]))?le.concat([new Ot(`${Ce}[1]`,pe[1],"expressions are not allowed in function stops.")]):le.concat(oe.validateSpec({key:`${Ce}[1]`,value:pe[1],valueSpec:c,validateSpec:oe.validateSpec,style:oe.style,styleSpec:oe.styleSpec}))}function ee(oe,le){const pe=on(oe.value),Ce=Vn(oe.value),Ue=oe.value!==null?oe.value:le;if(g){if(pe!==g)return[new Ot(oe.key,Ue,`${pe} stop domain type must match previous stop domain type ${g}`)]}else g=pe;if(pe!=="number"&&pe!=="string"&&pe!=="boolean")return[new Ot(oe.key,Ue,"stop domain value must be a number, string, or boolean")];if(pe!=="number"&&h!=="categorical"){let At=`number expected, ${pe} found`;return Tc(c)&&h===void 0&&(At+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ot(oe.key,Ue,At)]}return h!=="categorical"||pe!=="number"||isFinite(Ce)&&Math.floor(Ce)===Ce?h!=="categorical"&&pe==="number"&&_!==void 0&&Ce<_?[new Ot(oe.key,Ue,"stop domain values must appear in ascending order")]:(_=Ce,h==="categorical"&&Ce in T?[new Ot(oe.key,Ue,"stop domain values must be unique")]:(T[Ce]=!0,[])):[new Ot(oe.key,Ue,`integer expected, found ${Ce}`)]}}function mh(A){const c=(A.expressionContext==="property"?Qd:dh)(wu(A.value),A.valueSpec);if(c.result==="error")return c.value.map(g=>new Ot(`${A.key}${g.key}`,A.value,g.message));const h=c.value.expression||c.value._styleExpression.expression;if(A.expressionContext==="property"&&A.propertyKey==="text-font"&&!h.outputDefined())return[new Ot(A.key,A.value,`Invalid data expression for "${A.propertyKey}". Output values must be contained as literals within the expression.`)];if(A.expressionContext==="property"&&A.propertyType==="layout"&&!hh(h))return[new Ot(A.key,A.value,'"feature-state" data expressions are not supported with layout properties.')];if(A.expressionContext==="filter"&&!hh(h))return[new Ot(A.key,A.value,'"feature-state" data expressions are not supported with filters.')];if(A.expressionContext&&A.expressionContext.indexOf("cluster")===0){if(!uA(h,["zoom","feature-state"]))return[new Ot(A.key,A.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(A.expressionContext==="cluster-initial"&&!cA(h))return[new Ot(A.key,A.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function mA(A){const c=A.key,h=A.value,g=on(h);return g!=="string"?[new Ot(c,h,`color expected, ${g} found`)]:en.parse(String(h))?[]:[new Ot(c,h,`color expected, "${h}" found`)]}function xu(A){const c=A.key,h=A.value,g=A.valueSpec,_=[];return Array.isArray(g.values)?g.values.indexOf(Vn(h))===-1&&_.push(new Ot(c,h,`expected one of [${g.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(g.values).indexOf(Vn(h))===-1&&_.push(new Ot(c,h,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(h)} found`)),_}function Bu(A){return gf(wu(A.value))?mh(vn({},A,{expressionContext:"filter",valueSpec:{value:"boolean"}})):jd(A)}function jd(A){const c=A.value,h=A.key;if(on(c)!=="array")return[new Ot(h,c,`array expected, ${on(c)} found`)];const g=A.styleSpec;let _,x=[];if(c.length<1)return[new Ot(h,c,"filter array must have at least 1 element")];switch(x=x.concat(xu({key:`${h}[0]`,value:c[0],valueSpec:g.filter_operator,style:A.style,styleSpec:A.styleSpec})),Vn(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&Vn(c[1])==="$type"&&x.push(new Ot(h,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&x.push(new Ot(h,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(_=on(c[1]),_!=="string"&&x.push(new Ot(`${h}[1]`,c[1],`string expected, ${_} found`)));for(let T=2;T<c.length;T++)_=on(c[T]),Vn(c[1])==="$type"?x=x.concat(xu({key:`${h}[${T}]`,value:c[T],valueSpec:g.geometry_type,style:A.style,styleSpec:A.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&x.push(new Ot(`${h}[${T}]`,c[T],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let T=1;T<c.length;T++)x=x.concat(jd({key:`${h}[${T}]`,value:c[T],style:A.style,styleSpec:A.styleSpec}));break;case"has":case"!has":_=on(c[1]),c.length!==2?x.push(new Ot(h,c,`filter array for "${c[0]}" operator must have 2 elements`)):_!=="string"&&x.push(new Ot(`${h}[1]`,c[1],`string expected, ${_} found`))}return x}function $d(A,c){const h=A.key,g=A.validateSpec,_=A.style,x=A.styleSpec,T=A.value,S=A.objectKey,F=x[`${c}_${A.layerType}`];if(!F)return[];const U=S.match(/^(.*)-transition$/);if(c==="paint"&&U&&F[U[1]]&&F[U[1]].transition)return g({key:h,value:T,valueSpec:x.transition,style:_,styleSpec:x});const z=A.valueSpec||F[S];if(!z)return[new Ot(h,T,`unknown property "${S}"`)];let K;if(on(T)==="string"&&Tc(z)&&!z.tokens&&(K=/^{([^}]+)}$/.exec(T)))return[new Ot(h,T,`"${S}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(K[1])} }\`.`)];const ee=[];return A.layerType==="symbol"&&(S==="text-field"&&_&&!_.glyphs&&ee.push(new Ot(h,T,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Hl(wu(T))&&Vn(T.type)==="identity"&&ee.push(new Ot(h,T,'"text-font" does not support identity functions'))),ee.concat(g({key:A.key,value:T,valueSpec:z,style:_,styleSpec:x,expressionContext:"property",propertyType:c,propertyKey:S}))}function _h(A){return $d(A,"paint")}function _A(A){return $d(A,"layout")}function Cu(A){let c=[];const h=A.value,g=A.key,_=A.style,x=A.styleSpec;if(on(h)!=="object")return[new Ot(g,h,`object expected, ${on(h)} found`)];h.type||h.ref||c.push(new Ot(g,h,'either "type" or "ref" is required'));let T=Vn(h.type);const S=Vn(h.ref);if(h.id){const F=Vn(h.id);for(let U=0;U<A.arrayIndex;U++){const z=_.layers[U];Vn(z.id)===F&&c.push(new Ot(g,h.id,`duplicate layer id "${h.id}", previously used at line ${z.id.__line__}`))}}if("ref"in h){let F;["type","source","source-layer","filter","layout"].forEach(U=>{U in h&&c.push(new Ot(g,h[U],`"${U}" is prohibited for ref layers`))}),_.layers.forEach(U=>{Vn(U.id)===S&&(F=U)}),F?F.ref?c.push(new Ot(g,h.ref,"ref cannot reference another ref layer")):T=Vn(F.type):c.push(new Ot(g,h.ref,`ref layer "${S}" not found`))}else if(T!=="background")if(h.source){const F=_.sources&&_.sources[h.source],U=F&&Vn(F.type);F?U==="vector"&&T==="raster"?c.push(new Ot(g,h.source,`layer "${h.id}" requires a raster source`)):U!=="raster-dem"&&T==="hillshade"||U!=="raster-dem"&&T==="color-relief"?c.push(new Ot(g,h.source,`layer "${h.id}" requires a raster-dem source`)):U==="raster"&&T!=="raster"?c.push(new Ot(g,h.source,`layer "${h.id}" requires a vector source`)):U!=="vector"||h["source-layer"]?U==="raster-dem"&&T!=="hillshade"&&T!=="color-relief"?c.push(new Ot(g,h.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):T!=="line"||!h.paint||!h.paint["line-gradient"]||U==="geojson"&&F.lineMetrics||c.push(new Ot(g,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new Ot(g,h,`layer "${h.id}" must specify a "source-layer"`)):c.push(new Ot(g,h.source,`source "${h.source}" not found`))}else c.push(new Ot(g,h,'missing required property "source"'));return c=c.concat(ta({key:g,value:h,valueSpec:x.layer,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,objectElementValidators:{"*":()=>[],type:()=>A.validateSpec({key:`${g}.type`,value:h.type,valueSpec:x.layer.type,style:A.style,styleSpec:A.styleSpec,validateSpec:A.validateSpec,object:h,objectKey:"type"}),filter:Bu,layout:F=>ta({layer:h,key:F.key,value:F.value,style:F.style,styleSpec:F.styleSpec,validateSpec:F.validateSpec,objectElementValidators:{"*":U=>_A(vn({layerType:T},U))}}),paint:F=>ta({layer:h,key:F.key,value:F.value,style:F.style,styleSpec:F.styleSpec,validateSpec:F.validateSpec,objectElementValidators:{"*":U=>_h(vn({layerType:T},U))}})}})),c}function gl(A){const c=A.value,h=A.key,g=on(c);return g!=="string"?[new Ot(h,c,`string expected, ${g} found`)]:[]}const yh={promoteId:function({key:A,value:c}){if(on(c)==="string")return gl({key:A,value:c});{const h=[];for(const g in c)h.push(...gl({key:`${A}.${g}`,value:c[g]}));return h}}};function Gd(A){const c=A.value,h=A.key,g=A.styleSpec,_=A.style,x=A.validateSpec;if(!c.type)return[new Ot(h,c,'"type" is required')];const T=Vn(c.type);let S;switch(T){case"vector":case"raster":return S=ta({key:h,value:c,valueSpec:g[`source_${T.replace("-","_")}`],style:A.style,styleSpec:g,objectElementValidators:yh,validateSpec:x}),S;case"raster-dem":return S=function(F){var U;const z=(U=F.sourceName)!==null&&U!==void 0?U:"",K=F.value,ee=F.styleSpec,oe=ee.source_raster_dem,le=F.style;let pe=[];const Ce=on(K);if(K===void 0)return pe;if(Ce!=="object")return pe.push(new Ot("source_raster_dem",K,`object expected, ${Ce} found`)),pe;const Ue=Vn(K.encoding)==="custom",At=["redFactor","greenFactor","blueFactor","baseShift"],Ve=F.value.encoding?`"${F.value.encoding}"`:"Default";for(const et in K)!Ue&&At.includes(et)?pe.push(new Ot(et,K[et],`In "${z}": "${et}" is only valid when "encoding" is set to "custom". ${Ve} encoding found`)):oe[et]?pe=pe.concat(F.validateSpec({key:et,value:K[et],valueSpec:oe[et],validateSpec:F.validateSpec,style:le,styleSpec:ee})):pe.push(new Ot(et,K[et],`unknown property "${et}"`));return pe}({sourceName:h,value:c,style:A.style,styleSpec:g,validateSpec:x}),S;case"geojson":if(S=ta({key:h,value:c,valueSpec:g.source_geojson,style:_,styleSpec:g,validateSpec:x,objectElementValidators:yh}),c.cluster)for(const F in c.clusterProperties){const[U,z]=c.clusterProperties[F],K=typeof U=="string"?[U,["accumulated"],["get",F]]:U;S.push(...mh({key:`${h}.${F}.map`,value:z,expressionContext:"cluster-map"})),S.push(...mh({key:`${h}.${F}.reduce`,value:K,expressionContext:"cluster-reduce"}))}return S;case"video":return ta({key:h,value:c,valueSpec:g.source_video,style:_,validateSpec:x,styleSpec:g});case"image":return ta({key:h,value:c,valueSpec:g.source_image,style:_,validateSpec:x,styleSpec:g});case"canvas":return[new Ot(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xu({key:`${h}.type`,value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Pg(A){const c=A.value,h=A.styleSpec,g=h.light,_=A.style;let x=[];const T=on(c);if(c===void 0)return x;if(T!=="object")return x=x.concat([new Ot("light",c,`object expected, ${T} found`)]),x;for(const S in c){const F=S.match(/^(.*)-transition$/);x=x.concat(F&&g[F[1]]&&g[F[1]].transition?A.validateSpec({key:S,value:c[S],valueSpec:h.transition,validateSpec:A.validateSpec,style:_,styleSpec:h}):g[S]?A.validateSpec({key:S,value:c[S],valueSpec:g[S],validateSpec:A.validateSpec,style:_,styleSpec:h}):[new Ot(S,c[S],`unknown property "${S}"`)])}return x}function Mg(A){const c=A.value,h=A.styleSpec,g=h.sky,_=A.style,x=on(c);if(c===void 0)return[];if(x!=="object")return[new Ot("sky",c,`object expected, ${x} found`)];let T=[];for(const S in c)T=T.concat(g[S]?A.validateSpec({key:S,value:c[S],valueSpec:g[S],style:_,styleSpec:h}):[new Ot(S,c[S],`unknown property "${S}"`)]);return T}function Fg(A){const c=A.value,h=A.styleSpec,g=h.terrain,_=A.style;let x=[];const T=on(c);if(c===void 0)return x;if(T!=="object")return x=x.concat([new Ot("terrain",c,`object expected, ${T} found`)]),x;for(const S in c)x=x.concat(g[S]?A.validateSpec({key:S,value:c[S],valueSpec:g[S],validateSpec:A.validateSpec,style:_,styleSpec:h}):[new Ot(S,c[S],`unknown property "${S}"`)]);return x}function Rg(A){let c=[];const h=A.value,g=A.key;if(Array.isArray(h)){const _=[],x=[];for(const T in h)h[T].id&&_.includes(h[T].id)&&c.push(new Ot(g,h,`all the sprites' ids must be unique, but ${h[T].id} is duplicated`)),_.push(h[T].id),h[T].url&&x.includes(h[T].url)&&c.push(new Ot(g,h,`all the sprites' URLs must be unique, but ${h[T].url} is duplicated`)),x.push(h[T].url),c=c.concat(ta({key:`${g}[${T}]`,value:h[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:A.validateSpec}));return c}return gl({key:g,value:h})}function Lg(A){return c=A.value,c&&c.constructor===Object?[]:[new Ot(A.key,A.value,`object expected, ${on(A.value)} found`)];var c}const bh={"*":()=>[],array:pl,boolean:function(A){const c=A.value,h=A.key,g=on(c);return g!=="boolean"?[new Ot(h,c,`boolean expected, ${g} found`)]:[]},number:To,color:mA,constants:zo,enum:xu,filter:Bu,function:Ig,layer:Cu,object:ta,source:Gd,light:Pg,sky:Mg,terrain:Fg,projection:function(A){const c=A.value,h=A.styleSpec,g=h.projection,_=A.style,x=on(c);if(c===void 0)return[];if(x!=="object")return[new Ot("projection",c,`object expected, ${x} found`)];let T=[];for(const S in c)T=T.concat(g[S]?A.validateSpec({key:S,value:c[S],valueSpec:g[S],style:_,styleSpec:h}):[new Ot(S,c[S],`unknown property "${S}"`)]);return T},projectionDefinition:function(A){const c=A.key;let h=A.value;h=h instanceof String?h.valueOf():h;const g=on(h);return g!=="array"||function(_){return Array.isArray(_)&&_.length===3&&typeof _[0]=="string"&&typeof _[1]=="string"&&typeof _[2]=="number"}(h)||function(_){return!!["interpolate","step","literal"].includes(_[0])}(h)?["array","string"].includes(g)?[]:[new Ot(c,h,`projection expected, invalid type "${g}" found`)]:[new Ot(c,h,`projection expected, invalid array ${JSON.stringify(h)} found`)]},string:gl,formatted:function(A){return gl(A).length===0?[]:mh(A)},resolvedImage:function(A){return gl(A).length===0?[]:mh(A)},padding:function(A){const c=A.key,h=A.value;if(on(h)==="array"){if(h.length<1||h.length>4)return[new Ot(c,h,`padding requires 1 to 4 values; ${h.length} values found`)];const g={type:"number"};let _=[];for(let x=0;x<h.length;x++)_=_.concat(A.validateSpec({key:`${c}[${x}]`,value:h[x],validateSpec:A.validateSpec,valueSpec:g}));return _}return To({key:c,value:h,valueSpec:{}})},numberArray:function(A){const c=A.key,h=A.value;if(on(h)==="array"){const g={type:"number"};if(h.length<1)return[new Ot(c,h,"array length at least 1 expected, length 0 found")];let _=[];for(let x=0;x<h.length;x++)_=_.concat(A.validateSpec({key:`${c}[${x}]`,value:h[x],validateSpec:A.validateSpec,valueSpec:g}));return _}return To({key:c,value:h,valueSpec:{}})},colorArray:function(A){const c=A.key,h=A.value;if(on(h)==="array"){if(h.length<1)return[new Ot(c,h,"array length at least 1 expected, length 0 found")];let g=[];for(let _=0;_<h.length;_++)g=g.concat(mA({key:`${c}[${_}]`,value:h[_]}));return g}return mA({key:c,value:h})},variableAnchorOffsetCollection:function(A){const c=A.key,h=A.value,g=on(h),_=A.styleSpec;if(g!=="array"||h.length<1||h.length%2!=0)return[new Ot(c,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let T=0;T<h.length;T+=2)x=x.concat(xu({key:`${c}[${T}]`,value:h[T],valueSpec:_.layout_symbol["text-anchor"]})),x=x.concat(pl({key:`${c}[${T+1}]`,value:h[T+1],valueSpec:{length:2,value:"number"},validateSpec:A.validateSpec,style:A.style,styleSpec:_}));return x},sprite:Rg,state:Lg};function Vl(A){const c=A.value,h=A.valueSpec,g=A.styleSpec;return A.validateSpec=Vl,h.expression&&Hl(Vn(c))?Ig(A):h.expression&&vu(wu(c))?mh(A):h.type&&bh[h.type]?bh[h.type](A):ta(vn({},A,{valueSpec:h.type?g[h.type]:h}))}function Vs(A){const c=A.value,h=A.key,g=gl(A);return g.length||(c.indexOf("{fontstack}")===-1&&g.push(new Ot(h,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&g.push(new Ot(h,c,'"glyphs" url must include a "{range}" token'))),g}function oo(A,c=Ze){let h=[];return h=h.concat(Vl({key:"",value:A,valueSpec:c.$root,styleSpec:c,style:A,validateSpec:Vl,objectElementValidators:{glyphs:Vs,"*":()=>[]}})),A.constants&&(h=h.concat(zo({key:"constants",value:A.constants}))),Wd(h)}function Ba(A){return function(c){return A(Object.assign({},c,{validateSpec:Vl}))}}function Wd(A){return[].concat(A).sort((c,h)=>c.line-h.line)}function I(A){return function(...c){return Wd(A.apply(this,c))}}oo.source=I(Ba(Gd)),oo.sprite=I(Ba(Rg)),oo.glyphs=I(Ba(Vs)),oo.light=I(Ba(Pg)),oo.sky=I(Ba(Mg)),oo.terrain=I(Ba(Fg)),oo.state=I(Ba(Lg)),oo.layer=I(Ba(Cu)),oo.filter=I(Ba(Bu)),oo.paintProperty=I(Ba(_h)),oo.layoutProperty=I(Ba(_A));const L=oo,$=L.light,Y=L.sky,Ae=L.paintProperty,_e=L.layoutProperty;function ye(A,c){let h=!1;if(c&&c.length)for(const g of c)A.fire(new Ft(new Error(g.message))),h=!0;return h}class we{constructor(c,h,g){const _=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;const T=new Int32Array(this.arrayBuffer);c=T[0],this.d=(h=T[1])+2*(g=T[2]);for(let F=0;F<this.d*this.d;F++){const U=T[3+F],z=T[3+F+1];_.push(U===z?null:T.subarray(U,z))}const S=T[3+_.length+1];this.keys=T.subarray(T[3+_.length],S),this.bboxes=T.subarray(S),this.insert=this._insertReadonly}else{this.d=h+2*g;for(let T=0;T<this.d*this.d;T++)_.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=c,this.padding=g,this.scale=h/c,this.uid=0;const x=g/h*c;this.min=-x,this.max=c+x}insert(c,h,g,_,x){this._forEachCell(h,g,_,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(c),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(_),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,h,g,_,x,T){this.cells[x].push(T)}query(c,h,g,_,x){const T=this.min,S=this.max;if(c<=T&&h<=T&&S<=g&&S<=_&&!x)return Array.prototype.slice.call(this.keys);{const F=[];return this._forEachCell(c,h,g,_,this._queryCell,F,{},x),F}}_queryCell(c,h,g,_,x,T,S,F){const U=this.cells[x];if(U!==null){const z=this.keys,K=this.bboxes;for(let ee=0;ee<U.length;ee++){const oe=U[ee];if(S[oe]===void 0){const le=4*oe;(F?F(K[le+0],K[le+1],K[le+2],K[le+3]):c<=K[le+2]&&h<=K[le+3]&&g>=K[le+0]&&_>=K[le+1])?(S[oe]=!0,T.push(z[oe])):S[oe]=!1}}}}_forEachCell(c,h,g,_,x,T,S,F){const U=this._convertToCellCoord(c),z=this._convertToCellCoord(h),K=this._convertToCellCoord(g),ee=this._convertToCellCoord(_);for(let oe=U;oe<=K;oe++)for(let le=z;le<=ee;le++){const pe=this.d*le+oe;if((!F||F(this._convertFromCellCoord(oe),this._convertFromCellCoord(le),this._convertFromCellCoord(oe+1),this._convertFromCellCoord(le+1)))&&x.call(this,c,h,g,_,pe,T,S,F))return}}_convertFromCellCoord(c){return(c-this.padding)/this.scale}_convertToCellCoord(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const c=this.cells,h=3+this.cells.length+1+1;let g=0;for(let T=0;T<this.cells.length;T++)g+=this.cells[T].length;const _=new Int32Array(h+g+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;let x=h;for(let T=0;T<c.length;T++){const S=c[T];_[3+T]=x,_.set(S,x),x+=S.length}return _[3+c.length]=x,_.set(this.keys,x),x+=this.keys.length,_[3+c.length+1]=x,_.set(this.bboxes,x),x+=this.bboxes.length,_.buffer}static serialize(c,h){const g=c.toArrayBuffer();return h&&h.push(g),{buffer:g}}static deserialize(c){return new we(c.buffer)}}const Te={};function be(A,c,h={}){if(Te[A])throw new Error(`${A} is already registered.`);Object.defineProperty(c,"_classRegistryKey",{value:A,writeable:!1}),Te[A]={klass:c,omit:h.omit||[],shallow:h.shallow||[]}}be("Object",Object),be("Set",Set),be("TransferableGridIndex",we),be("Color",en),be("Error",Error),be("AJAXError",xe),be("ResolvedImage",As),be("StylePropertyFunction",fA),be("StyleExpression",fh,{omit:["_evaluator"]}),be("ZoomDependentExpression",zd),be("ZoomConstantExpression",df),be("CompoundExpression",ea,{omit:["_evaluate"]});for(const A in yu)yu[A]._classRegistryKey||be(`Expression_${A}`,yu[A]);function ct(A){return A&&typeof ArrayBuffer<"u"&&(A instanceof ArrayBuffer||A.constructor&&A.constructor.name==="ArrayBuffer")}function Et(A){return A.$name||A.constructor._classRegistryKey}function ke(A){return!function(c){if(c===null||typeof c!="object")return!1;const h=Et(c);return!(!h||h==="Object")}(A)&&(A==null||typeof A=="boolean"||typeof A=="number"||typeof A=="string"||A instanceof Boolean||A instanceof Number||A instanceof String||A instanceof Date||A instanceof RegExp||A instanceof Blob||A instanceof Error||ct(A)||Kt(A)||ArrayBuffer.isView(A)||A instanceof ImageData)}function ft(A,c){if(ke(A))return(ct(A)||Kt(A))&&c&&c.push(A),ArrayBuffer.isView(A)&&c&&c.push(A.buffer),A instanceof ImageData&&c&&c.push(A.data.buffer),A;if(Array.isArray(A)){const x=[];for(const T of A)x.push(ft(T,c));return x}if(typeof A!="object")throw new Error("can't serialize object of type "+typeof A);const h=Et(A);if(!h)throw new Error(`can't serialize object of unregistered class ${A.constructor.name}`);if(!Te[h])throw new Error(`${h} is not registered.`);const{klass:g}=Te[h],_=g.serialize?g.serialize(A,c):{};if(g.serialize){if(c&&_===c[c.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in A){if(!A.hasOwnProperty(x)||Te[h].omit.indexOf(x)>=0)continue;const T=A[x];_[x]=Te[h].shallow.indexOf(x)>=0?T:ft(T,c)}A instanceof Error&&(_.message=A.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(_.$name=h),_}function _t(A){if(ke(A))return A;if(Array.isArray(A))return A.map(_t);if(typeof A!="object")throw new Error("can't deserialize object of type "+typeof A);const c=Et(A)||"Object";if(!Te[c])throw new Error(`can't deserialize unregistered class ${c}`);const{klass:h}=Te[c];if(!h)throw new Error(`can't deserialize unregistered class ${c}`);if(h.deserialize)return h.deserialize(A);const g=Object.create(h.prototype);for(const _ of Object.keys(A)){if(_==="$name")continue;const x=A[_];g[_]=Te[c].shallow.indexOf(_)>=0?x:_t(x)}return g}class Nt{constructor(){this.first=!0}update(c,h){const g=Math.floor(c);return this.first?(this.first=!1,this.lastIntegerZoom=g,this.lastIntegerZoomTime=0,this.lastZoom=c,this.lastFloorZoom=g,!0):(this.lastFloorZoom>g?(this.lastIntegerZoom=g+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<g&&(this.lastIntegerZoom=g,this.lastIntegerZoomTime=h),c!==this.lastZoom&&(this.lastZoom=c,this.lastFloorZoom=g,!0))}}const ut={"Latin-1 Supplement":A=>A>=128&&A<=255,"Hangul Jamo":A=>A>=4352&&A<=4607,Khmer:A=>A>=6016&&A<=6143,"General Punctuation":A=>A>=8192&&A<=8303,"Letterlike Symbols":A=>A>=8448&&A<=8527,"Number Forms":A=>A>=8528&&A<=8591,"Miscellaneous Technical":A=>A>=8960&&A<=9215,"Control Pictures":A=>A>=9216&&A<=9279,"Optical Character Recognition":A=>A>=9280&&A<=9311,"Enclosed Alphanumerics":A=>A>=9312&&A<=9471,"Geometric Shapes":A=>A>=9632&&A<=9727,"Miscellaneous Symbols":A=>A>=9728&&A<=9983,"Miscellaneous Symbols and Arrows":A=>A>=11008&&A<=11263,"Ideographic Description Characters":A=>A>=12272&&A<=12287,"CJK Symbols and Punctuation":A=>A>=12288&&A<=12351,Hiragana:A=>A>=12352&&A<=12447,Katakana:A=>A>=12448&&A<=12543,Kanbun:A=>A>=12688&&A<=12703,"CJK Strokes":A=>A>=12736&&A<=12783,"Enclosed CJK Letters and Months":A=>A>=12800&&A<=13055,"CJK Compatibility":A=>A>=13056&&A<=13311,"Yijing Hexagram Symbols":A=>A>=19904&&A<=19967,"CJK Unified Ideographs":A=>A>=19968&&A<=40959,"Hangul Syllables":A=>A>=44032&&A<=55215,"Private Use Area":A=>A>=57344&&A<=63743,"Vertical Forms":A=>A>=65040&&A<=65055,"CJK Compatibility Forms":A=>A>=65072&&A<=65103,"Small Form Variants":A=>A>=65104&&A<=65135,"Halfwidth and Fullwidth Forms":A=>A>=65280&&A<=65519};function zt(A){for(const c of A)if(mn(c.charCodeAt(0)))return!0;return!1}function Gt(A){for(const c of A)if(!Wr(c.charCodeAt(0)))return!1;return!0}function sr(A){const c=A.map(h=>{try{return new RegExp(`\\p{sc=${h}}`,"u").source}catch{return null}}).filter(h=>h);return new RegExp(c.join("|"),"u")}const tr=sr(["Arab","Dupl","Mong","Ougr","Syrc"]);function Wr(A){return!tr.test(String.fromCodePoint(A))}const Fr=sr(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function mn(A){return!(A!==746&&A!==747&&(A<4352||!(ut["CJK Compatibility Forms"](A)&&!(A>=65097&&A<=65103)||ut["CJK Compatibility"](A)||ut["CJK Strokes"](A)||!(!ut["CJK Symbols and Punctuation"](A)||A>=12296&&A<=12305||A>=12308&&A<=12319||A===12336)||ut["Enclosed CJK Letters and Months"](A)||ut["Ideographic Description Characters"](A)||ut.Kanbun(A)||ut.Katakana(A)&&A!==12540||!(!ut["Halfwidth and Fullwidth Forms"](A)||A===65288||A===65289||A===65293||A>=65306&&A<=65310||A===65339||A===65341||A===65343||A>=65371&&A<=65503||A===65507||A>=65512&&A<=65519)||!(!ut["Small Form Variants"](A)||A>=65112&&A<=65118||A>=65123&&A<=65126)||ut["Vertical Forms"](A)||ut["Yijing Hexagram Symbols"](A)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(A))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(A))||Fr.test(String.fromCodePoint(A)))))}function zr(A){return!(mn(A)||function(c){return!!(ut["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||ut["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||ut["Letterlike Symbols"](c)||ut["Number Forms"](c)||ut["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||ut["Control Pictures"](c)&&c!==9251||ut["Optical Character Recognition"](c)||ut["Enclosed Alphanumerics"](c)||ut["Geometric Shapes"](c)||ut["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||ut["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||ut["CJK Symbols and Punctuation"](c)||ut.Katakana(c)||ut["Private Use Area"](c)||ut["CJK Compatibility Forms"](c)||ut["Small Form Variants"](c)||ut["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)}(A))}const Fn=sr(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function cs(A){return Fn.test(String.fromCodePoint(A))}function wn(A,c){return!(!c&&cs(A)||A>=2304&&A<=3583||A>=3840&&A<=4255||ut.Khmer(A))}function jr(A){for(const c of A)if(cs(c.charCodeAt(0)))return!0;return!1}const _r=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(A){this.pluginStatus=A.pluginStatus,this.pluginURL=A.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(A){if(_r.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=A.applyArabicShaping,this.processBidirectionalText=A.processBidirectionalText,this.processStyledBidirectionalText=A.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(A,c){return o(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(A.pluginStatus!=="loading")return this.setState(A),A;const h=A.pluginURL,g=new Promise(x=>{this.loadScriptResolve=x});c(h);const _=new Promise(x=>setTimeout(()=>x(),this.TIMEOUT));if(yield Promise.race([g,_]),this.isParsed()){const x={pluginStatus:"loaded",pluginURL:h};return this.setState(x),x}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${h}`)})}};class cn{constructor(c,h){this.isSupportedScript=bn,this.zoom=c,h?(this.now=h.now||0,this.fadeDuration=h.fadeDuration||0,this.zoomHistory=h.zoomHistory||new Nt,this.transition=h.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Nt,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const c=this.zoom,h=c-Math.floor(c),g=this.crossFadingFactor();return c>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*g}:{fromScale:.5,toScale:1,t:1-(1-g)*h}}}function bn(A){return function(c,h){for(const g of c)if(!wn(g.charCodeAt(0),h))return!1;return!0}(A,_r.getRTLTextPluginStatus()==="loaded")}class Pn{constructor(c,h,g){this.property=c,this.value=h,this.expression=function(_,x,T){if(Hl(_))return new fA(_,x);if(vu(_)){const S=Qd(_,x,T);if(S.result==="error")throw new Error(S.value.map(F=>`${F.key}: ${F.message}`).join(", "));return S.value}{let S=_;return x.type==="color"&&typeof _=="string"?S=en.parse(_):x.type!=="padding"||typeof _!="number"&&!Array.isArray(_)?x.type!=="numberArray"||typeof _!="number"&&!Array.isArray(_)?x.type!=="colorArray"||typeof _!="string"&&!Array.isArray(_)?x.type==="variableAnchorOffsetCollection"&&Array.isArray(_)?S=xi.parse(_):x.type==="projectionDefinition"&&typeof _=="string"&&(S=no.parse(_)):S=Zi.parse(_):S=Ss.parse(_):S=as.parse(_),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>S}}}(h===void 0?c.specification.default:h,c.specification,g)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(c,h,g){return this.property.possiblyEvaluate(this,c,h,g)}}class oi{constructor(c,h){this.property=c,this.value=new Pn(c,void 0,h)}transitioned(c,h){return new js(this.property,this.value,h,Pt({},c.transition,this.transition),c.now)}untransitioned(){return new js(this.property,this.value,null,{},0)}}class ps{constructor(c,h){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues),this._globalState=h}getValue(c){return nr(this._values[c].value.value)}setValue(c,h){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new oi(this._values[c].property,this._globalState)),this._values[c].value=new Pn(this._values[c].property,h===null?void 0:nr(h),this._globalState)}getTransition(c){return nr(this._values[c].transition)}setTransition(c,h){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new oi(this._values[c].property,this._globalState)),this._values[c].transition=nr(h)||void 0}serialize(){const c={};for(const h of Object.keys(this._values)){const g=this.getValue(h);g!==void 0&&(c[h]=g);const _=this.getTransition(h);_!==void 0&&(c[`${h}-transition`]=_)}return c}transitioned(c,h){const g=new Pi(this._properties);for(const _ of Object.keys(this._values))g._values[_]=this._values[_].transitioned(c,h._values[_]);return g}untransitioned(){const c=new Pi(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].untransitioned();return c}}class js{constructor(c,h,g,_,x){this.property=c,this.value=h,this.begin=x+_.delay||0,this.end=this.begin+_.duration||0,c.specification.transition&&(_.delay||_.duration)&&(this.prior=g)}possiblyEvaluate(c,h,g){const _=c.now||0,x=this.value.possiblyEvaluate(c,h,g),T=this.prior;if(T){if(_>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(_<this.begin)return T.possiblyEvaluate(c,h,g);{const S=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(c,h,g),x,Be(S))}}return x}}class Pi{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,h,g){const _=new Fi(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(c,h,g);return _}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class gs{constructor(c,h){this._properties=c,this._values=Object.create(c.defaultPropertyValues),this._globalState=h}hasValue(c){return this._values[c].value!==void 0}getValue(c){return nr(this._values[c].value)}setValue(c,h){this._values[c]=new Pn(this._values[c].property,h===null?void 0:nr(h),this._globalState)}serialize(){const c={};for(const h of Object.keys(this._values)){const g=this.getValue(h);g!==void 0&&(c[h]=g)}return c}possiblyEvaluate(c,h,g){const _=new Fi(this._properties);for(const x of Object.keys(this._values))_._values[x]=this._values[x].possiblyEvaluate(c,h,g);return _}}class Mi{constructor(c,h,g){this.property=c,this.value=h,this.parameters=g}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,h,g,_){return this.property.evaluate(this.value,this.parameters,c,h,g,_)}}class Fi{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class or{constructor(c){this.specification=c}possiblyEvaluate(c,h){if(c.isDataDriven())throw new Error("Value should not be data driven");return c.expression.evaluate(h)}interpolate(c,h,g){const _=dn[this.specification.type];return _?_(c,h,g):c}}class br{constructor(c,h){this.specification=c,this.overrides=h}possiblyEvaluate(c,h,g,_){return new Mi(this,c.expression.kind==="constant"||c.expression.kind==="camera"?{kind:"constant",value:c.expression.evaluate(h,null,{},g,_)}:c.expression,h)}interpolate(c,h,g){if(c.value.kind!=="constant"||h.value.kind!=="constant")return c;if(c.value.value===void 0||h.value.value===void 0)return new Mi(this,{kind:"constant",value:void 0},c.parameters);const _=dn[this.specification.type];if(_){const x=_(c.value.value,h.value.value,g);return new Mi(this,{kind:"constant",value:x},c.parameters)}return c}evaluate(c,h,g,_,x,T){return c.kind==="constant"?c.value:c.evaluate(h,g,_,x,T)}}class di extends br{possiblyEvaluate(c,h,g,_){if(c.value===void 0)return new Mi(this,{kind:"constant",value:void 0},h);if(c.expression.kind==="constant"){const x=c.expression.evaluate(h,null,{},g,_),T=c.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,S=this._calculate(T,T,T,h);return new Mi(this,{kind:"constant",value:S},h)}if(c.expression.kind==="camera"){const x=this._calculate(c.expression.evaluate({zoom:h.zoom-1}),c.expression.evaluate({zoom:h.zoom}),c.expression.evaluate({zoom:h.zoom+1}),h);return new Mi(this,{kind:"constant",value:x},h)}return new Mi(this,c.expression,h)}evaluate(c,h,g,_,x,T){if(c.kind==="source"){const S=c.evaluate(h,g,_,x,T);return this._calculate(S,S,S,h)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(h.zoom)-1},g,_),c.evaluate({zoom:Math.floor(h.zoom)},g,_),c.evaluate({zoom:Math.floor(h.zoom)+1},g,_),h):c.value}_calculate(c,h,g,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:c,to:h}:{from:g,to:h}}interpolate(c){return c}}class jn{constructor(c){this.specification=c}possiblyEvaluate(c,h,g,_){if(c.value!==void 0){if(c.expression.kind==="constant"){const x=c.expression.evaluate(h,null,{},g,_);return this._calculate(x,x,x,h)}return this._calculate(c.expression.evaluate(new cn(Math.floor(h.zoom-1),h)),c.expression.evaluate(new cn(Math.floor(h.zoom),h)),c.expression.evaluate(new cn(Math.floor(h.zoom+1),h)),h)}}_calculate(c,h,g,_){return _.zoom>_.zoomHistory.lastIntegerZoom?{from:c,to:h}:{from:g,to:h}}interpolate(c){return c}}class es{constructor(c){this.specification=c}possiblyEvaluate(c,h,g,_){return!!c.expression.evaluate(h,null,{},g,_)}interpolate(){return!1}}class Ci{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in c){const g=c[h];g.specification.overridable&&this.overridableProperties.push(h);const _=this.defaultPropertyValues[h]=new Pn(g,void 0,void 0),x=this.defaultTransitionablePropertyValues[h]=new oi(g,void 0);this.defaultTransitioningPropertyValues[h]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=_.possiblyEvaluate({})}}}be("DataDrivenProperty",br),be("DataConstantProperty",or),be("CrossFadedDataDrivenProperty",di),be("CrossFadedProperty",jn),be("ColorRampProperty",es);const $i="-transition";class Ri extends Wt{constructor(c,h,g){if(super(),this.id=c.id,this.type=c.type,this._globalState=g,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter,this._featureFilter=Sc(c.filter,g)),h.layout&&(this._unevaluatedLayout=new gs(h.layout,g)),h.paint)){this._transitionablePaint=new ps(h.paint,g);for(const _ in c.paint)this.setPaintProperty(_,c.paint[_],{validate:!1});for(const _ in c.layout)this.setLayoutProperty(_,c.layout[_],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Fi(h.paint)}}setFilter(c){this.filter=c,this._featureFilter=Sc(c,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}getLayoutAffectingGlobalStateRefs(){const c=new Set;if(this._unevaluatedLayout)for(const h in this._unevaluatedLayout._values){const g=this._unevaluatedLayout._values[h];for(const _ of g.getGlobalStateRefs())c.add(_)}for(const h of this._featureFilter.getGlobalStateRefs())c.add(h);return c}getPaintAffectingGlobalStateRefs(){var c;const h=new globalThis.Map;if(this._transitionablePaint)for(const g in this._transitionablePaint._values){const _=this._transitionablePaint._values[g].value;for(const x of _.getGlobalStateRefs()){const T=(c=h.get(x))!==null&&c!==void 0?c:[];T.push({name:g,value:_.value}),h.set(x,T)}}return h}setLayoutProperty(c,h,g={}){h!=null&&this._validate(_e,`layers.${this.id}.layout.${c}`,c,h,g)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,h):this.visibility=h)}getPaintProperty(c){return c.endsWith($i)?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)}setPaintProperty(c,h,g={}){if(h!=null&&this._validate(Ae,`layers.${this.id}.paint.${c}`,c,h,g))return!1;if(c.endsWith($i))return this._transitionablePaint.setTransition(c.slice(0,-11),h||void 0),!1;{const _=this._transitionablePaint._values[c],x=_.property.specification["property-type"]==="cross-faded-data-driven",T=_.value.isDataDriven(),S=_.value;this._transitionablePaint.setValue(c,h),this._handleSpecialPaintPropertyUpdate(c);const F=this._transitionablePaint._values[c].value;return F.isDataDriven()||T||x||this._handleOverridablePaintPropertyUpdate(c,S,F)}}_handleSpecialPaintPropertyUpdate(c){}_handleOverridablePaintPropertyUpdate(c,h,g){return!1}isHidden(c,h=!1){return!!(this.minzoom&&c<(h?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,h){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,h)}serialize(){const c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),Yt(c,(h,g)=>!(h===void 0||g==="layout"&&!Object.keys(h).length||g==="paint"&&!Object.keys(h).length))}_validate(c,h,g,_,x={}){return(!x||x.validate!==!1)&&ye(this,c.call(L,{key:h,layerType:this.type,objectKey:g,value:_,styleSpec:Ze,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const c in this.paint._values){const h=this.paint.get(c);if(h instanceof Mi&&Tc(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}let ai;var ms={get paint(){return ai=ai||new Ci({"raster-opacity":new or(Ze.paint_raster["raster-opacity"]),"raster-hue-rotate":new or(Ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new or(Ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new or(Ze.paint_raster["raster-brightness-max"]),"raster-saturation":new or(Ze.paint_raster["raster-saturation"]),"raster-contrast":new or(Ze.paint_raster["raster-contrast"]),"raster-resampling":new or(Ze.paint_raster["raster-resampling"]),"raster-fade-duration":new or(Ze.paint_raster["raster-fade-duration"])})}};class Ms extends Ri{constructor(c,h){super(c,ms,h)}}const Eo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $s{constructor(c,h){this._structArray=c,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Rn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,h){return c._trim(),h&&(c.isTransferred=!0,h.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){const h=Object.create(this.prototype);return h.arrayBuffer=c.arrayBuffer,h.length=c.length,h.capacity=c.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){if(c>this.capacity){this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ln(A,c=1){let h=0,g=0;return{members:A.map(_=>{const x=Eo[_.type].BYTES_PER_ELEMENT,T=h=Qo(h,Math.max(c,x)),S=_.components||1;return g=Math.max(g,x),h+=x*S,{name:_.name,type:_.type,components:S,offset:T}}),size:Qo(h,Math.max(g,c)),alignment:c}}function Qo(A,c){return Math.ceil(A/c)*c}class Yn extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h){const g=this.length;return this.resize(g+1),this.emplace(g,c,h)}emplace(c,h,g){const _=2*c;return this.int16[_+0]=h,this.int16[_+1]=g,c}}Yn.prototype.bytesPerElement=4,be("StructArrayLayout2i4",Yn);class Gi extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,c,h,g)}emplace(c,h,g,_){const x=3*c;return this.int16[x+0]=h,this.int16[x+1]=g,this.int16[x+2]=_,c}}Gi.prototype.bytesPerElement=6,be("StructArrayLayout3i6",Gi);class Ho extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,c,h,g,_)}emplace(c,h,g,_,x){const T=4*c;return this.int16[T+0]=h,this.int16[T+1]=g,this.int16[T+2]=_,this.int16[T+3]=x,c}}Ho.prototype.bytesPerElement=8,be("StructArrayLayout4i8",Ho);class Wa extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,g,_,x,T){const S=this.length;return this.resize(S+1),this.emplace(S,c,h,g,_,x,T)}emplace(c,h,g,_,x,T,S){const F=6*c;return this.int16[F+0]=h,this.int16[F+1]=g,this.int16[F+2]=_,this.int16[F+3]=x,this.int16[F+4]=T,this.int16[F+5]=S,c}}Wa.prototype.bytesPerElement=12,be("StructArrayLayout2i4i12",Wa);class Ca extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,g,_,x,T){const S=this.length;return this.resize(S+1),this.emplace(S,c,h,g,_,x,T)}emplace(c,h,g,_,x,T,S){const F=4*c,U=8*c;return this.int16[F+0]=h,this.int16[F+1]=g,this.uint8[U+4]=_,this.uint8[U+5]=x,this.uint8[U+6]=T,this.uint8[U+7]=S,c}}Ca.prototype.bytesPerElement=8,be("StructArrayLayout2i4ub8",Ca);class zi extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h){const g=this.length;return this.resize(g+1),this.emplace(g,c,h)}emplace(c,h,g){const _=2*c;return this.float32[_+0]=h,this.float32[_+1]=g,c}}zi.prototype.bytesPerElement=8,be("StructArrayLayout2f8",zi);class vh extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,g,_,x,T,S,F,U,z){const K=this.length;return this.resize(K+1),this.emplace(K,c,h,g,_,x,T,S,F,U,z)}emplace(c,h,g,_,x,T,S,F,U,z,K){const ee=10*c;return this.uint16[ee+0]=h,this.uint16[ee+1]=g,this.uint16[ee+2]=_,this.uint16[ee+3]=x,this.uint16[ee+4]=T,this.uint16[ee+5]=S,this.uint16[ee+6]=F,this.uint16[ee+7]=U,this.uint16[ee+8]=z,this.uint16[ee+9]=K,c}}vh.prototype.bytesPerElement=20,be("StructArrayLayout10ui20",vh);class Ic extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,g,_,x,T,S,F){const U=this.length;return this.resize(U+1),this.emplace(U,c,h,g,_,x,T,S,F)}emplace(c,h,g,_,x,T,S,F,U){const z=8*c;return this.uint16[z+0]=h,this.uint16[z+1]=g,this.uint16[z+2]=_,this.uint16[z+3]=x,this.uint16[z+4]=T,this.uint16[z+5]=S,this.uint16[z+6]=F,this.uint16[z+7]=U,c}}Ic.prototype.bytesPerElement=16,be("StructArrayLayout8ui16",Ic);class ml extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,g,_,x,T,S,F,U,z,K,ee){const oe=this.length;return this.resize(oe+1),this.emplace(oe,c,h,g,_,x,T,S,F,U,z,K,ee)}emplace(c,h,g,_,x,T,S,F,U,z,K,ee,oe){const le=12*c;return this.int16[le+0]=h,this.int16[le+1]=g,this.int16[le+2]=_,this.int16[le+3]=x,this.uint16[le+4]=T,this.uint16[le+5]=S,this.uint16[le+6]=F,this.uint16[le+7]=U,this.int16[le+8]=z,this.int16[le+9]=K,this.int16[le+10]=ee,this.int16[le+11]=oe,c}}ml.prototype.bytesPerElement=24,be("StructArrayLayout4i4ui4i24",ml);class Tu extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,c,h,g)}emplace(c,h,g,_){const x=3*c;return this.float32[x+0]=h,this.float32[x+1]=g,this.float32[x+2]=_,c}}Tu.prototype.bytesPerElement=12,be("StructArrayLayout3f12",Tu);class bf extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){const h=this.length;return this.resize(h+1),this.emplace(h,c)}emplace(c,h){return this.uint32[1*c+0]=h,c}}bf.prototype.bytesPerElement=4,be("StructArrayLayout1ul4",bf);class Eu extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,g,_,x,T,S,F,U){const z=this.length;return this.resize(z+1),this.emplace(z,c,h,g,_,x,T,S,F,U)}emplace(c,h,g,_,x,T,S,F,U,z){const K=10*c,ee=5*c;return this.int16[K+0]=h,this.int16[K+1]=g,this.int16[K+2]=_,this.int16[K+3]=x,this.int16[K+4]=T,this.int16[K+5]=S,this.uint32[ee+3]=F,this.uint16[K+8]=U,this.uint16[K+9]=z,c}}Eu.prototype.bytesPerElement=20,be("StructArrayLayout6i1ul2ui20",Eu);class yA extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,g,_,x,T){const S=this.length;return this.resize(S+1),this.emplace(S,c,h,g,_,x,T)}emplace(c,h,g,_,x,T,S){const F=6*c;return this.int16[F+0]=h,this.int16[F+1]=g,this.int16[F+2]=_,this.int16[F+3]=x,this.int16[F+4]=T,this.int16[F+5]=S,c}}yA.prototype.bytesPerElement=12,be("StructArrayLayout2i2i2i12",yA);class _l extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,g,_,x){const T=this.length;return this.resize(T+1),this.emplace(T,c,h,g,_,x)}emplace(c,h,g,_,x,T){const S=4*c,F=8*c;return this.float32[S+0]=h,this.float32[S+1]=g,this.float32[S+2]=_,this.int16[F+6]=x,this.int16[F+7]=T,c}}_l.prototype.bytesPerElement=16,be("StructArrayLayout2f1f2i16",_l);class vf extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,h,g,_,x,T){const S=this.length;return this.resize(S+1),this.emplace(S,c,h,g,_,x,T)}emplace(c,h,g,_,x,T,S){const F=16*c,U=4*c,z=8*c;return this.uint8[F+0]=h,this.uint8[F+1]=g,this.float32[U+1]=_,this.float32[U+2]=x,this.int16[z+6]=T,this.int16[z+7]=S,c}}vf.prototype.bytesPerElement=16,be("StructArrayLayout2ub2f2i16",vf);class wf extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,c,h,g)}emplace(c,h,g,_){const x=3*c;return this.uint16[x+0]=h,this.uint16[x+1]=g,this.uint16[x+2]=_,c}}wf.prototype.bytesPerElement=6,be("StructArrayLayout3ui6",wf);class v extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,g,_,x,T,S,F,U,z,K,ee,oe,le,pe,Ce,Ue){const At=this.length;return this.resize(At+1),this.emplace(At,c,h,g,_,x,T,S,F,U,z,K,ee,oe,le,pe,Ce,Ue)}emplace(c,h,g,_,x,T,S,F,U,z,K,ee,oe,le,pe,Ce,Ue,At){const Ve=24*c,et=12*c,Tt=48*c;return this.int16[Ve+0]=h,this.int16[Ve+1]=g,this.uint16[Ve+2]=_,this.uint16[Ve+3]=x,this.uint32[et+2]=T,this.uint32[et+3]=S,this.uint32[et+4]=F,this.uint16[Ve+10]=U,this.uint16[Ve+11]=z,this.uint16[Ve+12]=K,this.float32[et+7]=ee,this.float32[et+8]=oe,this.uint8[Tt+36]=le,this.uint8[Tt+37]=pe,this.uint8[Tt+38]=Ce,this.uint32[et+10]=Ue,this.int16[Ve+22]=At,c}}v.prototype.bytesPerElement=48,be("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",v);class l extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,g,_,x,T,S,F,U,z,K,ee,oe,le,pe,Ce,Ue,At,Ve,et,Tt,Rt,qt,mr,cr,dr,kr,fr){const pr=this.length;return this.resize(pr+1),this.emplace(pr,c,h,g,_,x,T,S,F,U,z,K,ee,oe,le,pe,Ce,Ue,At,Ve,et,Tt,Rt,qt,mr,cr,dr,kr,fr)}emplace(c,h,g,_,x,T,S,F,U,z,K,ee,oe,le,pe,Ce,Ue,At,Ve,et,Tt,Rt,qt,mr,cr,dr,kr,fr,pr){const Ht=32*c,rn=16*c;return this.int16[Ht+0]=h,this.int16[Ht+1]=g,this.int16[Ht+2]=_,this.int16[Ht+3]=x,this.int16[Ht+4]=T,this.int16[Ht+5]=S,this.int16[Ht+6]=F,this.int16[Ht+7]=U,this.uint16[Ht+8]=z,this.uint16[Ht+9]=K,this.uint16[Ht+10]=ee,this.uint16[Ht+11]=oe,this.uint16[Ht+12]=le,this.uint16[Ht+13]=pe,this.uint16[Ht+14]=Ce,this.uint16[Ht+15]=Ue,this.uint16[Ht+16]=At,this.uint16[Ht+17]=Ve,this.uint16[Ht+18]=et,this.uint16[Ht+19]=Tt,this.uint16[Ht+20]=Rt,this.uint16[Ht+21]=qt,this.uint16[Ht+22]=mr,this.uint32[rn+12]=cr,this.float32[rn+13]=dr,this.float32[rn+14]=kr,this.uint16[Ht+30]=fr,this.uint16[Ht+31]=pr,c}}l.prototype.bytesPerElement=64,be("StructArrayLayout8i15ui1ul2f2ui64",l);class f extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){const h=this.length;return this.resize(h+1),this.emplace(h,c)}emplace(c,h){return this.float32[1*c+0]=h,c}}f.prototype.bytesPerElement=4,be("StructArrayLayout1f4",f);class m extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,c,h,g)}emplace(c,h,g,_){const x=3*c;return this.uint16[6*c+0]=h,this.float32[x+1]=g,this.float32[x+2]=_,c}}m.prototype.bytesPerElement=12,be("StructArrayLayout1ui2f12",m);class y extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,c,h,g)}emplace(c,h,g,_){const x=4*c;return this.uint32[2*c+0]=h,this.uint16[x+2]=g,this.uint16[x+3]=_,c}}y.prototype.bytesPerElement=8,be("StructArrayLayout1ul2ui8",y);class B extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,h){const g=this.length;return this.resize(g+1),this.emplace(g,c,h)}emplace(c,h,g){const _=2*c;return this.uint16[_+0]=h,this.uint16[_+1]=g,c}}B.prototype.bytesPerElement=4,be("StructArrayLayout2ui4",B);class E extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){const h=this.length;return this.resize(h+1),this.emplace(h,c)}emplace(c,h){return this.uint16[1*c+0]=h,c}}E.prototype.bytesPerElement=2,be("StructArrayLayout1ui2",E);class R extends Rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,h,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,c,h,g,_)}emplace(c,h,g,_,x){const T=4*c;return this.float32[T+0]=h,this.float32[T+1]=g,this.float32[T+2]=_,this.float32[T+3]=x,c}}R.prototype.bytesPerElement=16,be("StructArrayLayout4f16",R);class O extends $s{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new u(this.anchorPointX,this.anchorPointY)}}O.prototype.size=20;class V extends Eu{get(c){return new O(this,c)}}be("CollisionBoxArray",V);class G extends $s{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(c){this._structArray.uint8[this._pos1+37]=c}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(c){this._structArray.uint8[this._pos1+38]=c}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(c){this._structArray.uint32[this._pos4+10]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}G.prototype.size=48;class J extends v{get(c){return new G(this,c)}}be("PlacedSymbolArray",J);class X extends $s{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(c){this._structArray.uint32[this._pos4+12]=c}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}X.prototype.size=64;class ne extends l{get(c){return new X(this,c)}}be("SymbolInstanceArray",ne);class de extends f{getoffsetX(c){return this.float32[1*c+0]}}be("GlyphOffsetArray",de);class Ee extends Gi{getx(c){return this.int16[3*c+0]}gety(c){return this.int16[3*c+1]}gettileUnitDistanceFromAnchor(c){return this.int16[3*c+2]}}be("SymbolLineVertexArray",Ee);class Se extends $s{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Se.prototype.size=12;class Ie extends m{get(c){return new Se(this,c)}}be("TextAnchorOffsetArray",Ie);class Oe extends $s{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Oe.prototype.size=8;class je extends y{get(c){return new Oe(this,c)}}be("FeatureIndexArray",je);class De extends Yn{}class $e extends Yn{}class Je extends Yn{}class Qe extends Wa{}class at extends Ca{}class Mt extends zi{}class yt extends vh{}class bt extends Ic{}class Ct extends ml{}class Zt extends Tu{}class rr extends bf{}class $t extends yA{}class Tr extends vf{}class tn extends wf{}class Dn extends B{}const li=Ln([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ti}=li;class Bn{constructor(c=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=c}prepareSegment(c,h,g,_){const x=this.segments[this.segments.length-1];return c>Bn.MAX_VERTEX_ARRAY_LENGTH&&xt(`Max vertices per segment is ${Bn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${c}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Bn.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!x||x.vertexLength+c>Bn.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==_?this.createNewSegment(h,g,_):x}createNewSegment(c,h,g){const _={vertexOffset:c.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0,vaos:{}};return g!==void 0&&(_.sortKey=g),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(_),_}getOrCreateLatestSegment(c,h,g){return this.prepareSegment(0,c,h,g)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const c of this.segments)for(const h in c.vaos)c.vaos[h].destroy()}static simpleSegment(c,h,g,_){return new Bn([{vertexOffset:c,primitiveOffset:h,vertexLength:g,primitiveLength:_,vaos:{},sortKey:0}])}}function bi(A,c){return 256*(A=rt(Math.floor(A),0,255))+rt(Math.floor(c),0,255)}Bn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,be("SegmentVector",Bn);const Gs=Ln([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Wi=Ln([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var ao,us,_s,lo={exports:{}},wh={exports:{}},xh={exports:{}},bA=function(){if(_s)return lo.exports;_s=1;var A=(ao||(ao=1,wh.exports=function(h,g){var _,x,T,S,F,U,z,K;for(x=h.length-(_=3&h.length),T=g,F=3432918353,U=461845907,K=0;K<x;)z=255&h.charCodeAt(K)|(255&h.charCodeAt(++K))<<8|(255&h.charCodeAt(++K))<<16|(255&h.charCodeAt(++K))<<24,++K,T=27492+(65535&(S=5*(65535&(T=(T^=z=(65535&(z=(z=(65535&z)*F+(((z>>>16)*F&65535)<<16)&4294967295)<<15|z>>>17))*U+(((z>>>16)*U&65535)<<16)&4294967295)<<13|T>>>19))+((5*(T>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(z=0,_){case 3:z^=(255&h.charCodeAt(K+2))<<16;case 2:z^=(255&h.charCodeAt(K+1))<<8;case 1:T^=z=(65535&(z=(z=(65535&(z^=255&h.charCodeAt(K)))*F+(((z>>>16)*F&65535)<<16)&4294967295)<<15|z>>>17))*U+(((z>>>16)*U&65535)<<16)&4294967295}return T^=h.length,T=2246822507*(65535&(T^=T>>>16))+((2246822507*(T>>>16)&65535)<<16)&4294967295,T=3266489909*(65535&(T^=T>>>13))+((3266489909*(T>>>16)&65535)<<16)&4294967295,(T^=T>>>16)>>>0}),wh.exports),c=(us||(us=1,xh.exports=function(h,g){for(var _,x=h.length,T=g^x,S=0;x>=4;)_=1540483477*(65535&(_=255&h.charCodeAt(S)|(255&h.charCodeAt(++S))<<8|(255&h.charCodeAt(++S))<<16|(255&h.charCodeAt(++S))<<24))+((1540483477*(_>>>16)&65535)<<16),T=1540483477*(65535&T)+((1540483477*(T>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),x-=4,++S;switch(x){case 3:T^=(255&h.charCodeAt(S+2))<<16;case 2:T^=(255&h.charCodeAt(S+1))<<8;case 1:T=1540483477*(65535&(T^=255&h.charCodeAt(S)))+((1540483477*(T>>>16)&65535)<<16)}return T=1540483477*(65535&(T^=T>>>13))+((1540483477*(T>>>16)&65535)<<16),(T^=T>>>15)>>>0}),xh.exports);return lo.exports=A,lo.exports.murmur3=A,lo.exports.murmur2=c,lo.exports}(),Bh=d(bA);class vA{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,h,g,_){this.ids.push(qd(c)),this.positions.push(h,g,_)}getPositions(c){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=qd(c);let g=0,_=this.ids.length-1;for(;g<_;){const T=g+_>>1;this.ids[T]>=h?_=T:g=T+1}const x=[];for(;this.ids[g]===h;)x.push({index:this.positions[3*g],start:this.positions[3*g+1],end:this.positions[3*g+2]}),g++;return x}static serialize(c,h){const g=new Float64Array(c.ids),_=new Uint32Array(c.positions);return Ch(g,_,0,g.length-1),h&&h.push(g.buffer,_.buffer),{ids:g,positions:_}}static deserialize(c){const h=new vA;return h.ids=c.ids,h.positions=c.positions,h.indexed=!0,h}}function qd(A){const c=+A;return!isNaN(c)&&c<=Number.MAX_SAFE_INTEGER?c:Bh(String(A))}function Ch(A,c,h,g){for(;h<g;){const _=A[h+g>>1];let x=h-1,T=g+1;for(;;){do x++;while(A[x]<_);do T--;while(A[T]>_);if(x>=T)break;ra(A,x,T),ra(c,3*x,3*T),ra(c,3*x+1,3*T+1),ra(c,3*x+2,3*T+2)}T-h<g-T?(Ch(A,c,h,T),h=T+1):(Ch(A,c,T+1,g),g=T)}}function ra(A,c,h){const g=A[c];A[c]=A[h],A[h]=g}be("FeaturePositionMap",vA);class Vo{constructor(c,h){this.gl=c.gl,this.location=h}}class Pc extends Vo{constructor(c,h){super(c,h),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class xf extends Vo{constructor(c,h){super(c,h),this.current=[0,0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))}}class Fs extends Vo{constructor(c,h){super(c,h),this.current=en.transparent}set(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))}}const co=new Float32Array(16);function Ta(A){return[bi(255*A.r,255*A.g),bi(255*A.b,255*A.a)]}class hs{constructor(c,h,g){this.value=c,this.uniformNames=h.map(_=>`u_${_}`),this.type=g}setUniform(c,h,g){c.set(g.constantOr(this.value))}getBinding(c,h,g){return this.type==="color"?new Fs(c,h):new Pc(c,h)}}class wA{constructor(c,h){this.uniformNames=h.map(g=>`u_${g}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(c,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=c.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=c.tlbr}setConstantDashPositions(c,h){this.dashTo=[0,c.y,c.height,c.width],this.dashFrom=[0,h.y,h.height,h.width]}setUniform(c,h,g,_){let x=null;_==="u_pattern_to"?x=this.patternTo:_==="u_pattern_from"?x=this.patternFrom:_==="u_dasharray_to"?x=this.dashTo:_==="u_dasharray_from"?x=this.dashFrom:_==="u_pixel_ratio_to"?x=this.pixelRatioTo:_==="u_pixel_ratio_from"&&(x=this.pixelRatioFrom),x!==null&&c.set(x)}getBinding(c,h,g){return g.substr(0,9)==="u_pattern"||g.substr(0,12)==="u_dasharray_"?new xf(c,h):new Pc(c,h)}}class Su{constructor(c,h,g,_){this.expression=c,this.type=g,this.maxValue=0,this.paintVertexAttributes=h.map(x=>({name:`a_${x}`,type:"Float32",components:g==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(c,h,g){const _=this.paintVertexArray.length,x=this.expression.evaluate(new cn(0,g),h,{},g.canonical,[],g.formattedSection);this.paintVertexArray.resize(c),this._setPaintValue(_,c,x)}updatePaintArray(c,h,g,_,x){const T=this.expression.evaluate(new cn(0,x),g,_);this._setPaintValue(c,h,T)}_setPaintValue(c,h,g){if(this.type==="color"){const _=Ta(g);for(let x=c;x<h;x++)this.paintVertexArray.emplace(x,_[0],_[1])}else{for(let _=c;_<h;_++)this.paintVertexArray.emplace(_,g);this.maxValue=Math.max(this.maxValue,Math.abs(g))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jl{constructor(c,h,g,_,x,T){this.expression=c,this.uniformNames=h.map(S=>`u_${S}_t`),this.type=g,this.useIntegerZoom=_,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=h.map(S=>({name:`a_${S}`,type:"Float32",components:g==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(c,h,g){const _=this.expression.evaluate(new cn(this.zoom,g),h,{},g.canonical,[],g.formattedSection),x=this.expression.evaluate(new cn(this.zoom+1,g),h,{},g.canonical,[],g.formattedSection),T=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(T,c,_,x)}updatePaintArray(c,h,g,_,x){const T=this.expression.evaluate(new cn(this.zoom,x),g,_),S=this.expression.evaluate(new cn(this.zoom+1,x),g,_);this._setPaintValue(c,h,T,S)}_setPaintValue(c,h,g,_){if(this.type==="color"){const x=Ta(g),T=Ta(_);for(let S=c;S<h;S++)this.paintVertexArray.emplace(S,x[0],x[1],T[0],T[1])}else{for(let x=c;x<h;x++)this.paintVertexArray.emplace(x,g,_);this.maxValue=Math.max(this.maxValue,Math.abs(g),Math.abs(_))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,h){const g=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,_=rt(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);c.set(_)}getBinding(c,h,g){return new Pc(c,h)}}class Th{constructor(c,h,g,_,x,T){this.expression=c,this.type=h,this.useIntegerZoom=g,this.zoom=_,this.layerId=T,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(c,h,g){const _=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(c),this.zoomOutPaintVertexArray.resize(c),this._setPaintValues(_,c,this.getPositionIds(h),g)}updatePaintArray(c,h,g,_,x){this._setPaintValues(c,h,this.getPositionIds(g),x)}_setPaintValues(c,h,g,_){const x=this.getPositions(_);if(!x||!g)return;const T=x[g.min],S=x[g.mid],F=x[g.max];if(T&&S&&F)for(let U=c;U<h;U++)this.emplace(this.zoomInPaintVertexArray,U,S,T),this.emplace(this.zoomOutPaintVertexArray,U,S,F)}upload(c){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const h=this.getVertexAttributes();this.zoomInPaintVertexBuffer=c.createVertexBuffer(this.zoomInPaintVertexArray,h,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=c.createVertexBuffer(this.zoomOutPaintVertexArray,h,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class hv extends Th{getPositions(c){return c.imagePositions}getPositionIds(c){return c.patterns&&c.patterns[this.layerId]}getVertexAttributes(){return Gs.members}emplace(c,h,g,_){c.emplace(h,g.tlbr[0],g.tlbr[1],g.tlbr[2],g.tlbr[3],_.tlbr[0],_.tlbr[1],_.tlbr[2],_.tlbr[3],g.pixelRatio,_.pixelRatio)}}class Av extends Th{getPositions(c){return c.dashPositions}getPositionIds(c){return c.dashes&&c.dashes[this.layerId]}getVertexAttributes(){return Wi.members}emplace(c,h,g,_){c.emplace(h,0,g.y,g.height,g.width,0,_.y,_.height,_.width)}}class Eh{constructor(c,h,g){this.binders={},this._buffers=[];const _=[];for(const x in c.paint._values){if(!g(x))continue;const T=c.paint.get(x);if(!(T instanceof Mi&&Tc(T.property.specification)))continue;const S=fv(x,c.type),F=T.value,U=T.property.specification.type,z=T.property.useIntegerZoom,K=T.property.specification["property-type"],ee=K==="cross-faded"||K==="cross-faded-data-driven";if(F.kind==="constant")this.binders[x]=ee?new wA(F.value,S):new hs(F.value,S,U),_.push(`/u_${x}`);else if(F.kind==="source"||ee){const oe=ey(x,U,"source");this.binders[x]=ee?x==="line-dasharray"?new Av(F,U,z,h,oe,c.id):new hv(F,U,z,h,oe,c.id):new Su(F,S,U,oe),_.push(`/a_${x}`)}else{const oe=ey(x,U,"composite");this.binders[x]=new jl(F,S,U,z,h,oe),_.push(`/z_${x}`)}}this.cacheKey=_.sort().join("")}getMaxValue(c){const h=this.binders[c];return h instanceof Su||h instanceof jl?h.maxValue:0}populatePaintArrays(c,h,g){for(const _ in this.binders){const x=this.binders[_];(x instanceof Su||x instanceof jl||x instanceof Th)&&x.populatePaintArray(c,h,g)}}setConstantPatternPositions(c,h){for(const g in this.binders){const _=this.binders[g];_ instanceof wA&&_.setConstantPatternPositions(c,h)}}setConstantDashPositions(c,h){for(const g in this.binders){const _=this.binders[g];_ instanceof wA&&_.setConstantDashPositions(c,h)}}updatePaintArrays(c,h,g,_,x){let T=!1;for(const S in c){const F=h.getPositions(S);for(const U of F){const z=g.feature(U.index);for(const K in this.binders){const ee=this.binders[K];if((ee instanceof Su||ee instanceof jl||ee instanceof Th)&&ee.expression.isStateDependent===!0){const oe=_.paint.get(K);ee.expression=oe.value,ee.updatePaintArray(U.start,U.end,z,c[S],x),T=!0}}}}return T}defines(){const c=[];for(const h in this.binders){const g=this.binders[h];(g instanceof hs||g instanceof wA)&&c.push(...g.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return c}getBinderAttributes(){const c=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof Su||g instanceof jl)for(let _=0;_<g.paintVertexAttributes.length;_++)c.push(g.paintVertexAttributes[_].name);else if(g instanceof Th){const _=g.getVertexAttributes();for(const x of _)c.push(x.name)}}return c}getBinderUniforms(){const c=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof hs||g instanceof wA||g instanceof jl)for(const _ of g.uniformNames)c.push(_)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c,h){const g=[];for(const _ in this.binders){const x=this.binders[_];if(x instanceof hs||x instanceof wA||x instanceof jl){for(const T of x.uniformNames)if(h[T]){const S=x.getBinding(c,h[T],T);g.push({name:T,property:_,binding:S})}}}return g}setUniforms(c,h,g,_){for(const{name:x,property:T,binding:S}of h)this.binders[T].setUniform(S,_,g.get(T),x)}updatePaintBuffers(c){this._buffers=[];for(const h in this.binders){const g=this.binders[h];if(c&&g instanceof Th){const _=c.fromScale===2?g.zoomInPaintVertexBuffer:g.zoomOutPaintVertexBuffer;_&&this._buffers.push(_)}else(g instanceof Su||g instanceof jl)&&g.paintVertexBuffer&&this._buffers.push(g.paintVertexBuffer)}}upload(c){for(const h in this.binders){const g=this.binders[h];(g instanceof Su||g instanceof jl||g instanceof Th)&&g.upload(c)}this.updatePaintBuffers()}destroy(){for(const c in this.binders){const h=this.binders[c];(h instanceof Su||h instanceof jl||h instanceof Th)&&h.destroy()}}}class Sh{constructor(c,h,g=()=>!0){this.programConfigurations={};for(const _ of c)this.programConfigurations[_.id]=new Eh(_,h,g);this.needsUpload=!1,this._featureMap=new vA,this._bufferOffset=0}populatePaintArrays(c,h,g,_){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(c,h,_);h.id!==void 0&&this._featureMap.add(h.id,g,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,h,g,_){for(const x of g)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(c,this._featureMap,h,x,_)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}function fv(A,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[A]||[A.replace(`${c}-`,"").replace(/-/g,"_")]}function ey(A,c,h){const g={color:{source:zi,composite:R},number:{source:f,composite:zi}},_=function(x){return{"line-pattern":{source:yt,composite:yt},"fill-pattern":{source:yt,composite:yt},"fill-extrusion-pattern":{source:yt,composite:yt},"line-dasharray":{source:bt,composite:bt}}[x]}(A);return _&&_[h]||g[c][h]}be("ConstantBinder",hs),be("CrossFadedConstantBinder",wA),be("SourceExpressionBinder",Su),be("CrossFadedPatternBinder",hv),be("CrossFadedDasharrayBinder",Av),be("CompositeExpressionBinder",jl),be("ProgramConfiguration",Eh,{omit:["_buffers"]}),be("ProgramConfigurationSet",Sh);const Kd=Math.pow(2,14)-1,ty=-Kd-1;function Iu(A){const c=Xe/A.extent,h=A.loadGeometry();for(let g=0;g<h.length;g++){const _=h[g];for(let x=0;x<_.length;x++){const T=_[x],S=Math.round(T.x*c),F=Math.round(T.y*c);T.x=rt(S,ty,Kd),T.y=rt(F,ty,Kd),(S<T.x||S>T.x+1||F<T.y||F>T.y+1)&&xt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function Xd(A,c){return{type:A.type,id:A.id,properties:A.properties,geometry:c?Iu(A):[]}}const Y7=-32768;function Xwe(A,c,h,g,_){A.emplaceBack(Y7+8*c+g,Y7+8*h+_)}class K3{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasDependencies=!1,this.layoutVertexArray=new $e,this.indexArray=new tn,this.segments=new Bn,this.programConfigurations=new Sh(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(c,h,g){const _=this.layers[0],x=[];let T=null,S=!1,F=_.type==="heatmap";if(_.type==="circle"){const z=_;T=z.layout.get("circle-sort-key"),S=!T.isConstant(),F=F||z.paint.get("circle-pitch-alignment")==="map"}const U=F?h.subdivisionGranularity.circle:1;for(const{feature:z,id:K,index:ee,sourceLayerIndex:oe}of c){const le=this.layers[0]._featureFilter.needGeometry,pe=Xd(z,le);if(!this.layers[0]._featureFilter.filter(new cn(this.zoom),pe,g))continue;const Ce=S?T.evaluate(pe,{},g):void 0,Ue={id:K,properties:z.properties,type:z.type,sourceLayerIndex:oe,index:ee,geometry:le?pe.geometry:Iu(z),patterns:{},sortKey:Ce};x.push(Ue)}S&&x.sort((z,K)=>z.sortKey-K.sortKey);for(const z of x){const{geometry:K,index:ee,sourceLayerIndex:oe}=z,le=c[ee].feature;this.addFeature(z,K,ee,g,U),h.featureIndex.insert(le,K,ee,oe,this.index)}}update(c,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,{imagePositions:g})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Ti),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,h,g,_,x=1){let T;switch(x){case 1:T=[0,7];break;case 3:T=[0,2,5,7];break;case 5:T=[0,1,3,4,6,7];break;case 7:T=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${x}; valid values are 1, 3, 5, 7.`)}const S=T.length;for(const F of h)for(const U of F){const z=U.x,K=U.y;if(z<0||z>=Xe||K<0||K>=Xe)continue;const ee=this.segments.prepareSegment(S*S,this.layoutVertexArray,this.indexArray,c.sortKey),oe=ee.vertexLength;for(let le=0;le<S;le++)for(let pe=0;pe<S;pe++)Xwe(this.layoutVertexArray,z,K,T[pe],T[le]);for(let le=0;le<S-1;le++)for(let pe=0;pe<S-1;pe++){const Ce=oe+le*S+pe,Ue=oe+(le+1)*S+pe;this.indexArray.emplaceBack(Ce,Ue+1,Ce+1),this.indexArray.emplaceBack(Ce,Ue,Ue+1)}ee.vertexLength+=S*S,ee.primitiveLength+=(S-1)*(S-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,g,{imagePositions:{},canonical:_})}}function Z7(A,c){for(let h=0;h<A.length;h++)if(Og(c,A[h]))return!0;for(let h=0;h<c.length;h++)if(Og(A,c[h]))return!0;return!!X3(A,c)}function dv(A,c,h){return!!Og(A,c)||!!Y3(c,A,h)}function J7(A,c){if(A.length===1)return tV(c,A[0]);for(let h=0;h<c.length;h++){const g=c[h];for(let _=0;_<g.length;_++)if(Og(A,g[_]))return!0}for(let h=0;h<A.length;h++)if(tV(c,A[h]))return!0;for(let h=0;h<c.length;h++)if(X3(A,c[h]))return!0;return!1}function Ywe(A,c,h){if(A.length>1){if(X3(A,c))return!0;for(let g=0;g<c.length;g++)if(Y3(c[g],A,h))return!0}for(let g=0;g<A.length;g++)if(Y3(A[g],c,h))return!0;return!1}function X3(A,c){if(A.length===0||c.length===0)return!1;for(let h=0;h<A.length-1;h++){const g=A[h],_=A[h+1];for(let x=0;x<c.length-1;x++)if(Zwe(g,_,c[x],c[x+1]))return!0}return!1}function Zwe(A,c,h,g){return Re(A,h,g)!==Re(c,h,g)&&Re(A,c,h)!==Re(A,c,g)}function Y3(A,c,h){const g=h*h;if(c.length===1)return A.distSqr(c[0])<g;for(let _=1;_<c.length;_++)if(eV(A,c[_-1],c[_])<g)return!0;return!1}function eV(A,c,h){const g=c.distSqr(h);if(g===0)return A.distSqr(c);const _=((A.x-c.x)*(h.x-c.x)+(A.y-c.y)*(h.y-c.y))/g;return A.distSqr(_<0?c:_>1?h:h.sub(c)._mult(_)._add(c))}function tV(A,c){let h,g,_,x=!1;for(let T=0;T<A.length;T++){h=A[T];for(let S=0,F=h.length-1;S<h.length;F=S++)g=h[S],_=h[F],g.y>c.y!=_.y>c.y&&c.x<(_.x-g.x)*(c.y-g.y)/(_.y-g.y)+g.x&&(x=!x)}return x}function Og(A,c){let h=!1;for(let g=0,_=A.length-1;g<A.length;_=g++){const x=A[g],T=A[_];x.y>c.y!=T.y>c.y&&c.x<(T.x-x.x)*(c.y-x.y)/(T.y-x.y)+x.x&&(h=!h)}return h}function Jwe(A,c,h){const g=h[0],_=h[2];if(A.x<g.x&&c.x<g.x||A.x>_.x&&c.x>_.x||A.y<g.y&&c.y<g.y||A.y>_.y&&c.y>_.y)return!1;const x=Re(A,c,h[0]);return x!==Re(A,c,h[1])||x!==Re(A,c,h[2])||x!==Re(A,c,h[3])}function Ug(A,c,h){const g=c.paint.get(A).value;return g.kind==="constant"?g.value:h.programConfigurations.get(c.id).getMaxValue(A)}function pv(A){return Math.sqrt(A[0]*A[0]+A[1]*A[1])}function gv(A,c,h,g,_){if(!c[0]&&!c[1])return A;const x=u.convert(c)._mult(_);h==="viewport"&&x._rotate(-g);const T=[];for(let S=0;S<A.length;S++)T.push(A[S].sub(x));return T}function e2e({queryGeometry:A,size:c},h){return dv(A,h,c)}function t2e({queryGeometry:A,size:c,transform:h,unwrappedTileID:g,getElevation:_},x){return dv(A,x,c*(h.projectTileCoordinates(x.x,x.y,g,_).signedDistanceFromCamera/h.cameraToCenterDistance))}function r2e({queryGeometry:A,size:c,transform:h,unwrappedTileID:g,getElevation:_},x){const T=h.projectTileCoordinates(x.x,x.y,g,_).signedDistanceFromCamera,S=c*(h.cameraToCenterDistance/T);return dv(A,Z3(x,h,g,_),S)}function n2e({queryGeometry:A,size:c,transform:h,unwrappedTileID:g,getElevation:_},x){return dv(A,Z3(x,h,g,_),c)}function rV({queryGeometry:A,size:c,transform:h,unwrappedTileID:g,getElevation:_,pitchAlignment:x="map",pitchScale:T="map"},S){const F=x==="map"?T==="map"?e2e:t2e:T==="map"?r2e:n2e,U={queryGeometry:A,size:c,transform:h,unwrappedTileID:g,getElevation:_};for(const z of S)for(const K of z)if(F(U,K))return!0;return!1}function Z3(A,c,h,g){const _=c.projectTileCoordinates(A.x,A.y,h,g).point;return new u((.5*_.x+.5)*c.width,(.5*-_.y+.5)*c.height)}let nV,iV;be("CircleBucket",K3,{omit:["layers"]});var i2e={get paint(){return iV=iV||new Ci({"circle-radius":new br(Ze.paint_circle["circle-radius"]),"circle-color":new br(Ze.paint_circle["circle-color"]),"circle-blur":new br(Ze.paint_circle["circle-blur"]),"circle-opacity":new br(Ze.paint_circle["circle-opacity"]),"circle-translate":new or(Ze.paint_circle["circle-translate"]),"circle-translate-anchor":new or(Ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new or(Ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new or(Ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new br(Ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new br(Ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new br(Ze.paint_circle["circle-stroke-opacity"])})},get layout(){return nV=nV||new Ci({"circle-sort-key":new br(Ze.layout_circle["circle-sort-key"])})}};class s2e extends Ri{constructor(c,h){super(c,i2e,h)}createBucket(c){return new K3(c)}queryRadius(c){const h=c;return Ug("circle-radius",this,h)+Ug("circle-stroke-width",this,h)+pv(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:c,feature:h,featureState:g,geometry:_,transform:x,pixelsToTileUnits:T,unwrappedTileID:S,getElevation:F}){const U=gv(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-x.bearingInRadians,T),z=this.paint.get("circle-radius").evaluate(h,g)+this.paint.get("circle-stroke-width").evaluate(h,g),K=this.paint.get("circle-pitch-scale"),ee=this.paint.get("circle-pitch-alignment");let oe,le;return ee==="map"?(oe=U,le=z*T):(oe=function(pe,Ce,Ue,At){return pe.map(Ve=>Z3(Ve,Ce,Ue,At))}(U,x,S,F),le=z),rV({queryGeometry:oe,size:le,transform:x,unwrappedTileID:S,getElevation:F,pitchAlignment:ee,pitchScale:K},_)}}class sV extends K3{}let oV;be("HeatmapBucket",sV,{omit:["layers"]});var o2e={get paint(){return oV=oV||new Ci({"heatmap-radius":new br(Ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new br(Ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new or(Ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new es(Ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new or(Ze.paint_heatmap["heatmap-opacity"])})}};function J3(A,{width:c,height:h},g,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==c*h*g)throw new RangeError(`mismatched image size. expected: ${_.length} but got: ${c*h*g}`)}else _=new Uint8Array(c*h*g);return A.width=c,A.height=h,A.data=_,A}function aV(A,{width:c,height:h},g){if(c===A.width&&h===A.height)return;const _=J3({},{width:c,height:h},g);eI(A,_,{x:0,y:0},{x:0,y:0},{width:Math.min(A.width,c),height:Math.min(A.height,h)},g),A.width=c,A.height=h,A.data=_.data}function eI(A,c,h,g,_,x){if(_.width===0||_.height===0)return c;if(_.width>A.width||_.height>A.height||h.x>A.width-_.width||h.y>A.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>c.width||_.height>c.height||g.x>c.width-_.width||g.y>c.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const T=A.data,S=c.data;if(T===S)throw new Error("srcData equals dstData, so image is already copied");for(let F=0;F<_.height;F++){const U=((h.y+F)*A.width+h.x)*x,z=((g.y+F)*c.width+g.x)*x;for(let K=0;K<_.width*x;K++)S[z+K]=T[U+K]}return c}class ry{constructor(c,h){J3(this,c,1,h)}resize(c){aV(this,c,1)}clone(){return new ry({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,h,g,_,x){eI(c,h,g,_,x,1)}}class qa{constructor(c,h){J3(this,c,4,h)}resize(c){aV(this,c,4)}replace(c,h){h?this.data.set(c):this.data=c instanceof Uint8ClampedArray?new Uint8Array(c.buffer):c}clone(){return new qa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,h,g,_,x){eI(c,h,g,_,x,4)}setPixel(c,h,g){const _=4*(c*this.width+h);this.data[_+0]=Math.round(255*g.r/g.a),this.data[_+1]=Math.round(255*g.g/g.a),this.data[_+2]=Math.round(255*g.b/g.a),this.data[_+3]=Math.round(255*g.a)}}function lV(A){const c={},h=A.resolution||256,g=A.clips?A.clips.length:1,_=A.image||new qa({width:h,height:g});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const x=(T,S,F)=>{c[A.evaluationKey]=F;const U=A.expression.evaluate(c);_.setPixel(T/4/h,S/4,U)};if(A.clips)for(let T=0,S=0;T<g;++T,S+=4*h)for(let F=0,U=0;F<h;F++,U+=4){const z=F/(h-1),{start:K,end:ee}=A.clips[T];x(S,U,K*(1-z)+ee*z)}else for(let T=0,S=0;T<h;T++,S+=4)x(0,S,T/(h-1));return _}be("AlphaImage",ry),be("RGBAImage",qa);const tI="big-fb";class a2e extends Ri{createBucket(c){return new sV(c)}constructor(c,h){super(c,o2e,h),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=lV({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(tI)&&this.heatmapFbos.delete(tI)}queryRadius(c){return Ug("heatmap-radius",this,c)}queryIntersectsFeature({queryGeometry:c,feature:h,featureState:g,geometry:_,transform:x,pixelsToTileUnits:T,unwrappedTileID:S,getElevation:F}){return rV({queryGeometry:c,size:this.paint.get("heatmap-radius").evaluate(h,g)*T,transform:x,unwrappedTileID:S,getElevation:F},_)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let cV;var l2e={get paint(){return cV=cV||new Ci({"hillshade-illumination-direction":new or(Ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new or(Ze.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new or(Ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new or(Ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new or(Ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new or(Ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new or(Ze.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new or(Ze.paint_hillshade["hillshade-method"])})}};class c2e extends Ri{constructor(c,h){super(c,l2e,h),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let c=this.paint.get("hillshade-illumination-direction").values,h=this.paint.get("hillshade-illumination-altitude").values,g=this.paint.get("hillshade-highlight-color").values,_=this.paint.get("hillshade-shadow-color").values;const x=Math.max(c.length,h.length,g.length,_.length);c=c.concat(Array(x-c.length).fill(c.at(-1))),h=h.concat(Array(x-h.length).fill(h.at(-1))),g=g.concat(Array(x-g.length).fill(g.at(-1))),_=_.concat(Array(x-_.length).fill(_.at(-1)));const T=h.map(ir);return{directionRadians:c.map(ir),altitudeRadians:T,shadowColor:_,highlightColor:g}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let uV;var u2e={get paint(){return uV=uV||new Ci({"color-relief-opacity":new or(Ze["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new es(Ze["paint_color-relief"]["color-relief-color"])})}};class rI{constructor(c,h,g,_){this.context=c,this.format=g,this.texture=c.gl.createTexture(),this.update(h,_)}update(c,h,g){const{width:_,height:x}=c,T=!(this.size&&this.size[0]===_&&this.size[1]===x||g),{context:S}=this,{gl:F}=S;if(this.useMipmap=!!(h&&h.useMipmap),F.bindTexture(F.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===F.RGBA&&(!h||h.premultiply!==!1)),T)this.size=[_,x],c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||Kt(c)?F.texImage2D(F.TEXTURE_2D,0,this.format,this.format,F.UNSIGNED_BYTE,c):F.texImage2D(F.TEXTURE_2D,0,this.format,_,x,0,this.format,F.UNSIGNED_BYTE,c.data);else{const{x:U,y:z}=g||{x:0,y:0};c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||Kt(c)?F.texSubImage2D(F.TEXTURE_2D,0,U,z,F.RGBA,F.UNSIGNED_BYTE,c):F.texSubImage2D(F.TEXTURE_2D,0,U,z,_,x,F.RGBA,F.UNSIGNED_BYTE,c.data)}this.useMipmap&&this.isSizePowerOfTwo()&&F.generateMipmap(F.TEXTURE_2D),S.pixelStoreUnpackFlipY.setDefault(),S.pixelStoreUnpack.setDefault(),S.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(c,h,g){const{context:_}=this,{gl:x}=_;x.bindTexture(x.TEXTURE_2D,this.texture),g!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(g=x.LINEAR),c!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,c),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,g||c),this.filter=c),h!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,h),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}}class hV{constructor(c,h,g,_=1,x=1,T=1,S=0){if(this.uid=c,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(g&&!["mapbox","terrarium","custom"].includes(g))return void xt(`"${g}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const F=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),g){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=_,this.greenFactor=x,this.blueFactor=T,this.baseShift=S;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let U=0;U<F;U++)this.data[this._idx(-1,U)]=this.data[this._idx(0,U)],this.data[this._idx(F,U)]=this.data[this._idx(F-1,U)],this.data[this._idx(U,-1)]=this.data[this._idx(U,0)],this.data[this._idx(U,F)]=this.data[this._idx(U,F-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(F,-1)]=this.data[this._idx(F-1,0)],this.data[this._idx(-1,F)]=this.data[this._idx(0,F-1)],this.data[this._idx(F,F)]=this.data[this._idx(F-1,F-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let U=0;U<F;U++)for(let z=0;z<F;z++){const K=this.get(U,z);K>this.max&&(this.max=K),K<this.min&&(this.min=K)}}get(c,h){const g=new Uint8Array(this.data.buffer),_=4*this._idx(c,h);return this.unpack(g[_],g[_+1],g[_+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(c,h){if(c<-1||c>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(c+1)}unpack(c,h,g){return c*this.redFactor+h*this.greenFactor+g*this.blueFactor-this.baseShift}pack(c){return AV(c,this.getUnpackVector())}getPixels(){return new qa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(c,h,g){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let _=h*this.dim,x=h*this.dim+this.dim,T=g*this.dim,S=g*this.dim+this.dim;switch(h){case-1:_=x-1;break;case 1:x=_+1}switch(g){case-1:T=S-1;break;case 1:S=T+1}const F=-h*this.dim,U=-g*this.dim;for(let z=T;z<S;z++)for(let K=_;K<x;K++)this.data[this._idx(K,z)]=c.data[this._idx(K+F,z+U)]}}function AV(A,c){const h=c[0],g=c[1],_=c[2],x=c[3],T=Math.min(h,g,_),S=Math.round((A+x)/T);return{r:Math.floor(S*T/h)%256,g:Math.floor(S*T/g)%256,b:Math.floor(S*T/_)%256}}be("DEMData",hV);class h2e extends Ri{constructor(c,h){super(c,u2e,h)}_createColorRamp(c){const h={elevationStops:[],colorStops:[]},g=this._transitionablePaint._values["color-relief-color"].value.expression;if(g instanceof df&&g._styleExpression.expression instanceof Vr){this.colorRampExpression=g;const T=g._styleExpression.expression;h.elevationStops=T.labels,h.colorStops=[];for(const S of h.elevationStops)h.colorStops.push(T.evaluate({globals:{elevation:S}}))}if(h.elevationStops.length<1&&(h.elevationStops=[0],h.colorStops=[en.transparent]),h.elevationStops.length<2&&(h.elevationStops.push(h.elevationStops[0]+1),h.colorStops.push(h.colorStops[0])),h.elevationStops.length<=c)return h;const _={elevationStops:[],colorStops:[]},x=(h.elevationStops.length-1)/(c-1);for(let T=0;T<h.elevationStops.length-.5;T+=x)_.elevationStops.push(h.elevationStops[Math.round(T)]),_.colorStops.push(h.colorStops[Math.round(T)]);return xt(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),_}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(c,h,g){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const _=this._createColorRamp(h),x=new qa({width:_.colorStops.length,height:1}),T=new qa({width:_.colorStops.length,height:1});for(let S=0;S<_.elevationStops.length;S++){const F=AV(_.elevationStops[S],g);T.setPixel(0,S,new en(F.r/255,F.g/255,F.b/255,1)),x.setPixel(0,S,_.colorStops[S])}return this.colorRampTextures={elevationTexture:new rI(c,T,c.gl.RGBA),colorTexture:new rI(c,x,c.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const A2e=Ln([{name:"a_pos",components:2,type:"Int16"}],4),{members:f2e}=A2e;function mv(A,c,h){const g=h.patternDependencies;let _=!1;for(const x of c){const T=x.paint.get(`${A}-pattern`);T.isConstant()||(_=!0);const S=T.constantOr(null);S&&(_=!0,g[S.to]=!0,g[S.from]=!0)}return _}function nI(A,c,h,g,_){const{zoom:x}=g,T=_.patternDependencies;for(const S of c){const F=S.paint.get(`${A}-pattern`).value;if(F.kind!=="constant"){let U=F.evaluate({zoom:x-1},h,{},_.availableImages),z=F.evaluate({zoom:x},h,{},_.availableImages),K=F.evaluate({zoom:x+1},h,{},_.availableImages);U=U&&U.name?U.name:U,z=z&&z.name?z.name:z,K=K&&K.name?K.name:K,T[U]=!0,T[z]=!0,T[K]=!0,h.patterns[S.id]={min:U,mid:z,max:K}}}return h}function fV(A,c,h,g,_){let x;if(_===function(T,S,F,U){let z=0;for(let K=S,ee=F-U;K<F;K+=U)z+=(T[ee]-T[K])*(T[K+1]+T[ee+1]),ee=K;return z}(A,c,h,g)>0)for(let T=c;T<h;T+=g)x=mV(T/g|0,A[T],A[T+1],x);else for(let T=h-g;T>=c;T-=g)x=mV(T/g|0,A[T],A[T+1],x);return x&&Dg(x,x.next)&&(oy(x),x=x.next),x}function Yd(A,c){if(!A)return A;c||(c=A);let h,g=A;do if(h=!1,g.steiner||!Dg(g,g.next)&&ys(g.prev,g,g.next)!==0)g=g.next;else{if(oy(g),g=c=g.prev,g===g.next)break;h=!0}while(h||g!==c);return c}function ny(A,c,h,g,_,x,T){if(!A)return;!T&&x&&function(F,U,z,K){let ee=F;do ee.z===0&&(ee.z=iI(ee.x,ee.y,U,z,K)),ee.prevZ=ee.prev,ee.nextZ=ee.next,ee=ee.next;while(ee!==F);ee.prevZ.nextZ=null,ee.prevZ=null,function(oe){let le,pe=1;do{let Ce,Ue=oe;oe=null;let At=null;for(le=0;Ue;){le++;let Ve=Ue,et=0;for(let Rt=0;Rt<pe&&(et++,Ve=Ve.nextZ,Ve);Rt++);let Tt=pe;for(;et>0||Tt>0&&Ve;)et!==0&&(Tt===0||!Ve||Ue.z<=Ve.z)?(Ce=Ue,Ue=Ue.nextZ,et--):(Ce=Ve,Ve=Ve.nextZ,Tt--),At?At.nextZ=Ce:oe=Ce,Ce.prevZ=At,At=Ce;Ue=Ve}At.nextZ=null,pe*=2}while(le>1)}(ee)}(A,g,_,x);let S=A;for(;A.prev!==A.next;){const F=A.prev,U=A.next;if(x?p2e(A,g,_,x):d2e(A))c.push(F.i,A.i,U.i),oy(A),A=U.next,S=U.next;else if((A=U)===S){T?T===1?ny(A=g2e(Yd(A),c),c,h,g,_,x,2):T===2&&m2e(A,c,h,g,_,x):ny(Yd(A),c,h,g,_,x,1);break}}}function d2e(A){const c=A.prev,h=A,g=A.next;if(ys(c,h,g)>=0)return!1;const _=c.x,x=h.x,T=g.x,S=c.y,F=h.y,U=g.y,z=Math.min(_,x,T),K=Math.min(S,F,U),ee=Math.max(_,x,T),oe=Math.max(S,F,U);let le=g.next;for(;le!==c;){if(le.x>=z&&le.x<=ee&&le.y>=K&&le.y<=oe&&iy(_,S,x,F,T,U,le.x,le.y)&&ys(le.prev,le,le.next)>=0)return!1;le=le.next}return!0}function p2e(A,c,h,g){const _=A.prev,x=A,T=A.next;if(ys(_,x,T)>=0)return!1;const S=_.x,F=x.x,U=T.x,z=_.y,K=x.y,ee=T.y,oe=Math.min(S,F,U),le=Math.min(z,K,ee),pe=Math.max(S,F,U),Ce=Math.max(z,K,ee),Ue=iI(oe,le,c,h,g),At=iI(pe,Ce,c,h,g);let Ve=A.prevZ,et=A.nextZ;for(;Ve&&Ve.z>=Ue&&et&&et.z<=At;){if(Ve.x>=oe&&Ve.x<=pe&&Ve.y>=le&&Ve.y<=Ce&&Ve!==_&&Ve!==T&&iy(S,z,F,K,U,ee,Ve.x,Ve.y)&&ys(Ve.prev,Ve,Ve.next)>=0||(Ve=Ve.prevZ,et.x>=oe&&et.x<=pe&&et.y>=le&&et.y<=Ce&&et!==_&&et!==T&&iy(S,z,F,K,U,ee,et.x,et.y)&&ys(et.prev,et,et.next)>=0))return!1;et=et.nextZ}for(;Ve&&Ve.z>=Ue;){if(Ve.x>=oe&&Ve.x<=pe&&Ve.y>=le&&Ve.y<=Ce&&Ve!==_&&Ve!==T&&iy(S,z,F,K,U,ee,Ve.x,Ve.y)&&ys(Ve.prev,Ve,Ve.next)>=0)return!1;Ve=Ve.prevZ}for(;et&&et.z<=At;){if(et.x>=oe&&et.x<=pe&&et.y>=le&&et.y<=Ce&&et!==_&&et!==T&&iy(S,z,F,K,U,ee,et.x,et.y)&&ys(et.prev,et,et.next)>=0)return!1;et=et.nextZ}return!0}function g2e(A,c){let h=A;do{const g=h.prev,_=h.next.next;!Dg(g,_)&&pV(g,h,h.next,_)&&sy(g,_)&&sy(_,g)&&(c.push(g.i,h.i,_.i),oy(h),oy(h.next),h=A=_),h=h.next}while(h!==A);return Yd(h)}function m2e(A,c,h,g,_,x){let T=A;do{let S=T.next.next;for(;S!==T.prev;){if(T.i!==S.i&&w2e(T,S)){let F=gV(T,S);return T=Yd(T,T.next),F=Yd(F,F.next),ny(T,c,h,g,_,x,0),void ny(F,c,h,g,_,x,0)}S=S.next}T=T.next}while(T!==A)}function _2e(A,c){let h=A.x-c.x;return h===0&&(h=A.y-c.y,h===0)&&(h=(A.next.y-A.y)/(A.next.x-A.x)-(c.next.y-c.y)/(c.next.x-c.x)),h}function y2e(A,c){const h=function(_,x){let T=x;const S=_.x,F=_.y;let U,z=-1/0;if(Dg(_,T))return T;do{if(Dg(_,T.next))return T.next;if(F<=T.y&&F>=T.next.y&&T.next.y!==T.y){const pe=T.x+(F-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(pe<=S&&pe>z&&(z=pe,U=T.x<T.next.x?T:T.next,pe===S))return U}T=T.next}while(T!==x);if(!U)return null;const K=U,ee=U.x,oe=U.y;let le=1/0;T=U;do{if(S>=T.x&&T.x>=ee&&S!==T.x&&dV(F<oe?S:z,F,ee,oe,F<oe?z:S,F,T.x,T.y)){const pe=Math.abs(F-T.y)/(S-T.x);sy(T,_)&&(pe<le||pe===le&&(T.x>U.x||T.x===U.x&&b2e(U,T)))&&(U=T,le=pe)}T=T.next}while(T!==K);return U}(A,c);if(!h)return c;const g=gV(h,A);return Yd(g,g.next),Yd(h,h.next)}function b2e(A,c){return ys(A.prev,A,c.prev)<0&&ys(c.next,A,A.next)<0}function iI(A,c,h,g,_){return(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A=(A-h)*_|0)|A<<8))|A<<4))|A<<2))|A<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-g)*_|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function v2e(A){let c=A,h=A;do(c.x<h.x||c.x===h.x&&c.y<h.y)&&(h=c),c=c.next;while(c!==A);return h}function dV(A,c,h,g,_,x,T,S){return(_-T)*(c-S)>=(A-T)*(x-S)&&(A-T)*(g-S)>=(h-T)*(c-S)&&(h-T)*(x-S)>=(_-T)*(g-S)}function iy(A,c,h,g,_,x,T,S){return!(A===T&&c===S)&&dV(A,c,h,g,_,x,T,S)}function w2e(A,c){return A.next.i!==c.i&&A.prev.i!==c.i&&!function(h,g){let _=h;do{if(_.i!==h.i&&_.next.i!==h.i&&_.i!==g.i&&_.next.i!==g.i&&pV(_,_.next,h,g))return!0;_=_.next}while(_!==h);return!1}(A,c)&&(sy(A,c)&&sy(c,A)&&function(h,g){let _=h,x=!1;const T=(h.x+g.x)/2,S=(h.y+g.y)/2;do _.y>S!=_.next.y>S&&_.next.y!==_.y&&T<(_.next.x-_.x)*(S-_.y)/(_.next.y-_.y)+_.x&&(x=!x),_=_.next;while(_!==h);return x}(A,c)&&(ys(A.prev,A,c.prev)||ys(A,c.prev,c))||Dg(A,c)&&ys(A.prev,A,A.next)>0&&ys(c.prev,c,c.next)>0)}function ys(A,c,h){return(c.y-A.y)*(h.x-c.x)-(c.x-A.x)*(h.y-c.y)}function Dg(A,c){return A.x===c.x&&A.y===c.y}function pV(A,c,h,g){const _=yv(ys(A,c,h)),x=yv(ys(A,c,g)),T=yv(ys(h,g,A)),S=yv(ys(h,g,c));return _!==x&&T!==S||!(_!==0||!_v(A,h,c))||!(x!==0||!_v(A,g,c))||!(T!==0||!_v(h,A,g))||!(S!==0||!_v(h,c,g))}function _v(A,c,h){return c.x<=Math.max(A.x,h.x)&&c.x>=Math.min(A.x,h.x)&&c.y<=Math.max(A.y,h.y)&&c.y>=Math.min(A.y,h.y)}function yv(A){return A>0?1:A<0?-1:0}function sy(A,c){return ys(A.prev,A,A.next)<0?ys(A,c,A.next)>=0&&ys(A,A.prev,c)>=0:ys(A,c,A.prev)<0||ys(A,A.next,c)<0}function gV(A,c){const h=sI(A.i,A.x,A.y),g=sI(c.i,c.x,c.y),_=A.next,x=c.prev;return A.next=c,c.prev=A,h.next=_,_.prev=h,g.next=h,h.prev=g,x.next=g,g.prev=x,g}function mV(A,c,h,g){const _=sI(A,c,h);return g?(_.next=g.next,_.prev=g,g.next.prev=_,g.next=_):(_.prev=_,_.next=_),_}function oy(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function sI(A,c,h){return{i:A,x:c,y:h,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class kg{constructor(c,h){if(h>c)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=c,this._minGranularity=h}getGranularityForZoomLevel(c){return Math.max(Math.floor(this._baseZoomGranularity/(1<<c)),this._minGranularity,1)}}class bv{constructor(c){this.fill=c.fill,this.line=c.line,this.tile=c.tile,this.stencil=c.stencil,this.circle=c.circle}}bv.noSubdivision=new bv({fill:new kg(0,0),line:new kg(0,0),tile:new kg(0,0),stencil:new kg(0,0),circle:1}),be("SubdivisionGranularityExpression",kg),be("SubdivisionGranularitySetting",bv);const Ng=-32768,ay=32767;class x2e{constructor(c,h){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=c,this._granularityCellSize=Xe/c,this._canonical=h}_getKey(c,h){return(c+=32768)<<16|h+32768}_vertexToIndex(c,h){if(c<-32768||h<-32768||c>32767||h>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const g=0|Math.round(c),_=0|Math.round(h),x=this._getKey(g,_);if(this._vertexDictionary.has(x))return this._vertexDictionary.get(x);const T=this._vertexBuffer.length/2;return this._vertexDictionary.set(x,T),this._vertexBuffer.push(g,_),T}_subdivideTrianglesScanline(c){if(this._granularity<2)return function(_,x){const T=[];for(let S=0;S<x.length;S+=3){const F=x[S],U=x[S+1],z=x[S+2],K=_[2*F],ee=_[2*F+1];(_[2*U]-K)*(_[2*z+1]-ee)-(_[2*U+1]-ee)*(_[2*z]-K)>0?(T.push(F),T.push(z),T.push(U)):(T.push(F),T.push(U),T.push(z))}return T}(this._vertexBuffer,c);const h=[],g=c.length;for(let _=0;_<g;_+=3){const x=[c[_+0],c[_+1],c[_+2]],T=[this._vertexBuffer[2*c[_+0]+0],this._vertexBuffer[2*c[_+0]+1],this._vertexBuffer[2*c[_+1]+0],this._vertexBuffer[2*c[_+1]+1],this._vertexBuffer[2*c[_+2]+0],this._vertexBuffer[2*c[_+2]+1]];let S=1/0,F=1/0,U=-1/0,z=-1/0;for(let pe=0;pe<3;pe++){const Ce=T[2*pe],Ue=T[2*pe+1];S=Math.min(S,Ce),U=Math.max(U,Ce),F=Math.min(F,Ue),z=Math.max(z,Ue)}if(S===U||F===z)continue;const K=Math.floor(S/this._granularityCellSize),ee=Math.ceil(U/this._granularityCellSize),oe=Math.floor(F/this._granularityCellSize),le=Math.ceil(z/this._granularityCellSize);if(K!==ee||oe!==le)for(let pe=oe;pe<le;pe++){const Ce=this._scanlineGenerateVertexRingForCellRow(pe,T,x);B2e(this._vertexBuffer,Ce,h)}else h.push(...x)}return h}_scanlineGenerateVertexRingForCellRow(c,h,g){const _=c*this._granularityCellSize,x=_+this._granularityCellSize,T=[];for(let S=0;S<3;S++){const F=h[2*S],U=h[2*S+1],z=h[2*(S+1)%6],K=h[(2*(S+1)+1)%6],ee=h[2*(S+2)%6],oe=h[(2*(S+2)+1)%6],le=z-F,pe=K-U,Ce=le===0,Ue=pe===0,At=(_-U)/pe,Ve=(x-U)/pe,et=Math.min(At,Ve),Tt=Math.max(At,Ve);if(!Ue&&(et>=1||Tt<=0)||Ue&&(U<_||U>x)){K>=_&&K<=x&&T.push(g[(S+1)%3]);continue}!Ue&&et>0&&T.push(this._vertexToIndex(F+le*et,U+pe*et));const Rt=F+le*Math.max(et,0),qt=F+le*Math.min(Tt,1);Ce||this._generateIntraEdgeVertices(T,F,U,z,K,Rt,qt),!Ue&&Tt<1&&T.push(this._vertexToIndex(F+le*Tt,U+pe*Tt)),(Ue||K>=_&&K<=x)&&T.push(g[(S+1)%3]),!Ue&&(K<=_||K>=x)&&this._generateInterEdgeVertices(T,F,U,z,K,ee,oe,qt,_,x)}return T}_generateIntraEdgeVertices(c,h,g,_,x,T,S){const F=_-h,U=x-g,z=U===0,K=z?Math.min(h,_):Math.min(T,S),ee=z?Math.max(h,_):Math.max(T,S),oe=Math.floor(K/this._granularityCellSize)+1,le=Math.ceil(ee/this._granularityCellSize)-1;if(z?h<_:T<S)for(let pe=oe;pe<=le;pe++){const Ce=pe*this._granularityCellSize;c.push(this._vertexToIndex(Ce,g+U*(Ce-h)/F))}else for(let pe=le;pe>=oe;pe--){const Ce=pe*this._granularityCellSize;c.push(this._vertexToIndex(Ce,g+U*(Ce-h)/F))}}_generateInterEdgeVertices(c,h,g,_,x,T,S,F,U,z){const K=x-g,ee=T-_,oe=S-x,le=(U-x)/oe,pe=(z-x)/oe,Ce=Math.min(le,pe),Ue=Math.max(le,pe),At=_+ee*Ce;let Ve=Math.floor(Math.min(At,F)/this._granularityCellSize)+1,et=Math.ceil(Math.max(At,F)/this._granularityCellSize)-1,Tt=F<At;const Rt=oe===0;if(Rt&&(S===U||S===z))return;if(Rt||Ce>=1||Ue<=0){const mr=g-S,cr=T+(h-T)*Math.min((U-S)/mr,(z-S)/mr);Ve=Math.floor(Math.min(cr,F)/this._granularityCellSize)+1,et=Math.ceil(Math.max(cr,F)/this._granularityCellSize)-1,Tt=F<cr}const qt=K>0?z:U;if(Tt)for(let mr=Ve;mr<=et;mr++)c.push(this._vertexToIndex(mr*this._granularityCellSize,qt));else for(let mr=et;mr>=Ve;mr--)c.push(this._vertexToIndex(mr*this._granularityCellSize,qt))}_generateOutline(c){const h=[];for(const g of c){const _=Zd(g,this._granularity,!0),x=this._pointArrayToIndices(_),T=[];for(let S=1;S<x.length;S++)T.push(x[S-1]),T.push(x[S]);h.push(T)}return h}_handlePoles(c){let h=!1,g=!1;this._canonical&&(this._canonical.y===0&&(h=!0),this._canonical.y===(1<<this._canonical.z)-1&&(g=!0)),(h||g)&&this._fillPoles(c,h,g)}_ensureNoPoleVertices(){const c=this._vertexBuffer;for(let h=0;h<c.length;h+=2){const g=c[h+1];g===Ng&&(c[h+1]=-32767),g===ay&&(c[h+1]=32766)}}_generatePoleQuad(c,h,g,_,x,T){_>x!=(T===Ng)?(c.push(h),c.push(g),c.push(this._vertexToIndex(_,T)),c.push(g),c.push(this._vertexToIndex(x,T)),c.push(this._vertexToIndex(_,T))):(c.push(g),c.push(h),c.push(this._vertexToIndex(_,T)),c.push(this._vertexToIndex(x,T)),c.push(g),c.push(this._vertexToIndex(_,T)))}_fillPoles(c,h,g){const _=this._vertexBuffer,x=Xe,T=c.length;for(let S=2;S<T;S+=3){const F=c[S-2],U=c[S-1],z=c[S],K=_[2*F],ee=_[2*F+1],oe=_[2*U],le=_[2*U+1],pe=_[2*z],Ce=_[2*z+1];h&&(ee===0&&le===0&&this._generatePoleQuad(c,F,U,K,oe,Ng),le===0&&Ce===0&&this._generatePoleQuad(c,U,z,oe,pe,Ng),Ce===0&&ee===0&&this._generatePoleQuad(c,z,F,pe,K,Ng)),g&&(ee===x&&le===x&&this._generatePoleQuad(c,F,U,K,oe,ay),le===x&&Ce===x&&this._generatePoleQuad(c,U,z,oe,pe,ay),Ce===x&&ee===x&&this._generatePoleQuad(c,z,F,pe,K,ay))}}_initializeVertices(c){for(let h=0;h<c.length;h+=2)this._vertexToIndex(c[h],c[h+1])}subdividePolygonInternal(c,h){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:g,holeIndices:_}=function(S){const F=[],U=[];for(const z of S)if(z.length!==0){z!==S[0]&&F.push(U.length/2);for(let K=0;K<z.length;K++)U.push(z[K].x),U.push(z[K].y)}return{flattened:U,holeIndices:F}}(c);let x;this._initializeVertices(g);try{const S=function(U,z,K=2){const ee=z&&z.length,oe=ee?z[0]*K:U.length;let le=fV(U,0,oe,K,!0);const pe=[];if(!le||le.next===le.prev)return pe;let Ce,Ue,At;if(ee&&(le=function(Ve,et,Tt,Rt){const qt=[];for(let mr=0,cr=et.length;mr<cr;mr++){const dr=fV(Ve,et[mr]*Rt,mr<cr-1?et[mr+1]*Rt:Ve.length,Rt,!1);dr===dr.next&&(dr.steiner=!0),qt.push(v2e(dr))}qt.sort(_2e);for(let mr=0;mr<qt.length;mr++)Tt=y2e(qt[mr],Tt);return Tt}(U,z,le,K)),U.length>80*K){Ce=U[0],Ue=U[1];let Ve=Ce,et=Ue;for(let Tt=K;Tt<oe;Tt+=K){const Rt=U[Tt],qt=U[Tt+1];Rt<Ce&&(Ce=Rt),qt<Ue&&(Ue=qt),Rt>Ve&&(Ve=Rt),qt>et&&(et=qt)}At=Math.max(Ve-Ce,et-Ue),At=At!==0?32767/At:0}return ny(le,pe,K,Ce,Ue,At,0),pe}(g,_),F=this._convertIndices(g,S);x=this._subdivideTrianglesScanline(F)}catch(S){console.error(S)}let T=[];return h&&(T=this._generateOutline(c)),this._ensureNoPoleVertices(),this._handlePoles(x),{verticesFlattened:this._vertexBuffer,indicesTriangles:x,indicesLineList:T}}_convertIndices(c,h){const g=[];for(let _=0;_<h.length;_++)g.push(this._vertexToIndex(c[2*h[_]],c[2*h[_]+1]));return g}_pointArrayToIndices(c){const h=[];for(let g=0;g<c.length;g++){const _=c[g];h.push(this._vertexToIndex(_.x,_.y))}return h}}function _V(A,c,h,g=!0){return new x2e(h,c).subdividePolygonInternal(A,g)}function Zd(A,c,h=!1){if(!A||A.length<1)return[];if(A.length<2)return[];const g=A[0],_=A[A.length-1],x=h&&(g.x!==_.x||g.y!==_.y);if(c<2)return x?[...A,A[0]]:[...A];const T=Math.floor(Xe/c),S=[];S.push(new u(A[0].x,A[0].y));const F=A.length,U=x?F:F-1;for(let z=0;z<U;z++){const K=A[z],ee=z<F-1?A[z+1]:A[0],oe=K.x,le=K.y,pe=ee.x,Ce=ee.y,Ue=oe!==pe,At=le!==Ce;if(!Ue&&!At)continue;const Ve=pe-oe,et=Ce-le,Tt=Math.abs(Ve),Rt=Math.abs(et);let qt=oe,mr=le;for(;;){const dr=Ve>0?(Math.floor(qt/T)+1)*T:(Math.ceil(qt/T)-1)*T,kr=et>0?(Math.floor(mr/T)+1)*T:(Math.ceil(mr/T)-1)*T,fr=Math.abs(qt-dr),pr=Math.abs(mr-kr),Ht=Math.abs(qt-pe),rn=Math.abs(mr-Ce),un=Ue?fr/Tt:Number.POSITIVE_INFINITY,qr=At?pr/Rt:Number.POSITIVE_INFINITY;if((Ht<=fr||!Ue)&&(rn<=pr||!At))break;if(un<qr&&Ue||!At){qt=dr,mr+=et*un;const Rr=new u(qt,Math.round(mr));S[S.length-1].x===Rr.x&&S[S.length-1].y===Rr.y||S.push(Rr)}else{qt+=Ve*qr,mr=kr;const Rr=new u(Math.round(qt),mr);S[S.length-1].x===Rr.x&&S[S.length-1].y===Rr.y||S.push(Rr)}}const cr=new u(pe,Ce);S[S.length-1].x===cr.x&&S[S.length-1].y===cr.y||S.push(cr)}return S}function B2e(A,c,h){if(c.length===0)throw new Error("Subdivision vertex ring is empty.");let g=0,_=A[2*c[0]];for(let F=1;F<c.length;F++){const U=A[2*c[F]];U<_&&(_=U,g=F)}const x=c.length;let T=g,S=(T+1)%x;for(;;){const F=T-1>=0?T-1:x-1,U=(S+1)%x,z=A[2*c[F]],K=A[2*c[U]],ee=A[2*c[T]],oe=A[2*c[T]+1],le=A[2*c[S]+1];let pe=!1;if(z<K)pe=!0;else if(z>K)pe=!1;else{const Ce=le-oe,Ue=-(A[2*c[S]]-ee),At=oe<le?1:-1;((z-ee)*Ce+(A[2*c[F]+1]-oe)*Ue)*At>((K-ee)*Ce+(A[2*c[U]+1]-oe)*Ue)*At&&(pe=!0)}if(pe){const Ce=c[F],Ue=c[T],At=c[S];Ce!==Ue&&Ce!==At&&Ue!==At&&h.push(At,Ue,Ce),T--,T<0&&(T=x-1)}else{const Ce=c[U],Ue=c[T],At=c[S];Ce!==Ue&&Ce!==At&&Ue!==At&&h.push(At,Ue,Ce),S++,S>=x&&(S=0)}if(F===U)break}}function yV(A,c,h,g,_,x,T,S,F){const U=_.length/2,z=T&&S&&F;if(U<Bn.MAX_VERTEX_ARRAY_LENGTH){const K=c.prepareSegment(U,h,g),ee=K.vertexLength;for(let pe=0;pe<x.length;pe+=3)g.emplaceBack(ee+x[pe],ee+x[pe+1],ee+x[pe+2]);let oe,le;K.vertexLength+=U,K.primitiveLength+=x.length/3,z&&(le=T.prepareSegment(U,h,S),oe=le.vertexLength,le.vertexLength+=U);for(let pe=0;pe<_.length;pe+=2)A(_[pe],_[pe+1]);if(z)for(let pe=0;pe<F.length;pe++){const Ce=F[pe];for(let Ue=1;Ue<Ce.length;Ue+=2)S.emplaceBack(oe+Ce[Ue-1],oe+Ce[Ue]);le.primitiveLength+=Ce.length/2}}else(function(K,ee,oe,le,pe,Ce){const Ue=[];for(let Rt=0;Rt<le.length/2;Rt++)Ue.push(-1);const At={count:0};let Ve=0,et=K.getOrCreateLatestSegment(ee,oe),Tt=et.vertexLength;for(let Rt=2;Rt<pe.length;Rt+=3){const qt=pe[Rt-2],mr=pe[Rt-1],cr=pe[Rt];let dr=Ue[qt]<Ve,kr=Ue[mr]<Ve,fr=Ue[cr]<Ve;et.vertexLength+((dr?1:0)+(kr?1:0)+(fr?1:0))>Bn.MAX_VERTEX_ARRAY_LENGTH&&(et=K.createNewSegment(ee,oe),Ve=At.count,dr=!0,kr=!0,fr=!0,Tt=0);const pr=ly(Ue,le,Ce,At,qt,dr,et),Ht=ly(Ue,le,Ce,At,mr,kr,et),rn=ly(Ue,le,Ce,At,cr,fr,et);oe.emplaceBack(Tt+pr-Ve,Tt+Ht-Ve,Tt+rn-Ve),et.primitiveLength++}})(c,h,g,_,x,A),z&&function(K,ee,oe,le,pe,Ce){const Ue=[];for(let Rt=0;Rt<le.length/2;Rt++)Ue.push(-1);const At={count:0};let Ve=0,et=K.getOrCreateLatestSegment(ee,oe),Tt=et.vertexLength;for(let Rt=0;Rt<pe.length;Rt++){const qt=pe[Rt];for(let mr=1;mr<pe[Rt].length;mr+=2){const cr=qt[mr-1],dr=qt[mr];let kr=Ue[cr]<Ve,fr=Ue[dr]<Ve;et.vertexLength+((kr?1:0)+(fr?1:0))>Bn.MAX_VERTEX_ARRAY_LENGTH&&(et=K.createNewSegment(ee,oe),Ve=At.count,kr=!0,fr=!0,Tt=0);const pr=ly(Ue,le,Ce,At,cr,kr,et),Ht=ly(Ue,le,Ce,At,dr,fr,et);oe.emplaceBack(Tt+pr-Ve,Tt+Ht-Ve),et.primitiveLength++}}}(T,h,S,_,F,A),c.forceNewSegmentOnNextPrepare(),T?.forceNewSegmentOnNextPrepare()}function ly(A,c,h,g,_,x,T){if(x){const S=g.count;return h(c[2*_],c[2*_+1]),A[_]=g.count,g.count++,T.vertexLength++,S}return A[_]}class oI{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Je,this.indexArray=new tn,this.indexArray2=new Dn,this.programConfigurations=new Sh(c.layers,c.zoom),this.segments=new Bn,this.segments2=new Bn,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(c,h,g){this.hasDependencies=mv("fill",this.layers,h);const _=this.layers[0].layout.get("fill-sort-key"),x=!_.isConstant(),T=[];for(const{feature:S,id:F,index:U,sourceLayerIndex:z}of c){const K=this.layers[0]._featureFilter.needGeometry,ee=Xd(S,K);if(!this.layers[0]._featureFilter.filter(new cn(this.zoom),ee,g))continue;const oe=x?_.evaluate(ee,{},g,h.availableImages):void 0,le={id:F,properties:S.properties,type:S.type,sourceLayerIndex:z,index:U,geometry:K?ee.geometry:Iu(S),patterns:{},sortKey:oe};T.push(le)}x&&T.sort((S,F)=>S.sortKey-F.sortKey);for(const S of T){const{geometry:F,index:U,sourceLayerIndex:z}=S;if(this.hasDependencies){const K=nI("fill",this.layers,S,{zoom:this.zoom},h);this.patternFeatures.push(K)}else this.addFeature(S,F,U,g,{},h.subdivisionGranularity);h.featureIndex.insert(c[U].feature,F,U,z,this.index)}}update(c,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,{imagePositions:g})}addFeatures(c,h,g){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,h,g,c.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,f2e),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,h,g,_,x,T){for(const S of bc(h,500)){const F=_V(S,_,T.fill.getGranularityForZoomLevel(_.z)),U=this.layoutVertexArray;yV((z,K)=>{U.emplaceBack(z,K)},this.segments,this.layoutVertexArray,this.indexArray,F.verticesFlattened,F.indicesTriangles,this.segments2,this.indexArray2,F.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,g,{imagePositions:x,canonical:_})}}let bV,vV;be("FillBucket",oI,{omit:["layers","patternFeatures"]});var C2e={get paint(){return vV=vV||new Ci({"fill-antialias":new or(Ze.paint_fill["fill-antialias"]),"fill-opacity":new br(Ze.paint_fill["fill-opacity"]),"fill-color":new br(Ze.paint_fill["fill-color"]),"fill-outline-color":new br(Ze.paint_fill["fill-outline-color"]),"fill-translate":new or(Ze.paint_fill["fill-translate"]),"fill-translate-anchor":new or(Ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new di(Ze.paint_fill["fill-pattern"])})},get layout(){return bV=bV||new Ci({"fill-sort-key":new br(Ze.layout_fill["fill-sort-key"])})}};class T2e extends Ri{constructor(c,h){super(c,C2e,h)}recalculate(c,h){super.recalculate(c,h);const g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new oI(c)}queryRadius(){return pv(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:c,geometry:h,transform:g,pixelsToTileUnits:_}){return J7(gv(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-g.bearingInRadians,_),h)}isTileClipped(){return!0}}const E2e=Ln([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),S2e=Ln([{name:"a_centroid",components:2,type:"Int16"}],4),{members:I2e}=E2e;class zg{constructor(c,h,g,_,x){this.properties={},this.extent=g,this.type=0,this.id=void 0,this._pbf=c,this._geometry=-1,this._keys=_,this._values=x,c.readFields(P2e,this,h)}loadGeometry(){const c=this._pbf;c.pos=this._geometry;const h=c.readVarint()+c.pos,g=[];let _,x=1,T=0,S=0,F=0;for(;c.pos<h;){if(T<=0){const U=c.readVarint();x=7&U,T=U>>3}if(T--,x===1||x===2)S+=c.readSVarint(),F+=c.readSVarint(),x===1&&(_&&g.push(_),_=[]),_&&_.push(new u(S,F));else{if(x!==7)throw new Error(`unknown command ${x}`);_&&_.push(_[0].clone())}}return _&&g.push(_),g}bbox(){const c=this._pbf;c.pos=this._geometry;const h=c.readVarint()+c.pos;let g=1,_=0,x=0,T=0,S=1/0,F=-1/0,U=1/0,z=-1/0;for(;c.pos<h;){if(_<=0){const K=c.readVarint();g=7&K,_=K>>3}if(_--,g===1||g===2)x+=c.readSVarint(),T+=c.readSVarint(),x<S&&(S=x),x>F&&(F=x),T<U&&(U=T),T>z&&(z=T);else if(g!==7)throw new Error(`unknown command ${g}`)}return[S,U,F,z]}toGeoJSON(c,h,g){const _=this.extent*Math.pow(2,g),x=this.extent*c,T=this.extent*h,S=this.loadGeometry();function F(ee){return[360*(ee.x+x)/_-180,360/Math.PI*Math.atan(Math.exp((1-2*(ee.y+T)/_)*Math.PI))-90]}function U(ee){return ee.map(F)}let z;if(this.type===1){const ee=[];for(const le of S)ee.push(le[0]);const oe=U(ee);z=ee.length===1?{type:"Point",coordinates:oe[0]}:{type:"MultiPoint",coordinates:oe}}else if(this.type===2){const ee=S.map(U);z=ee.length===1?{type:"LineString",coordinates:ee[0]}:{type:"MultiLineString",coordinates:ee}}else{if(this.type!==3)throw new Error("unknown feature type");{const ee=function(le){const pe=le.length;if(pe<=1)return[le];const Ce=[];let Ue,At;for(let Ve=0;Ve<pe;Ve++){const et=M2e(le[Ve]);et!==0&&(At===void 0&&(At=et<0),At===et<0?(Ue&&Ce.push(Ue),Ue=[le[Ve]]):Ue&&Ue.push(le[Ve]))}return Ue&&Ce.push(Ue),Ce}(S),oe=[];for(const le of ee)oe.push(le.map(U));z=oe.length===1?{type:"Polygon",coordinates:oe[0]}:{type:"MultiPolygon",coordinates:oe}}}const K={type:"Feature",geometry:z,properties:this.properties};return this.id!=null&&(K.id=this.id),K}}function P2e(A,c,h){A===1?c.id=h.readVarint():A===2?function(g,_){const x=g.readVarint()+g.pos;for(;g.pos<x;){const T=_._keys[g.readVarint()],S=_._values[g.readVarint()];_.properties[T]=S}}(h,c):A===3?c.type=h.readVarint():A===4&&(c._geometry=h.pos)}function M2e(A){let c=0;for(let h,g,_=0,x=A.length,T=x-1;_<x;T=_++)h=A[_],g=A[T],c+=(g.x-h.x)*(h.y+g.y);return c}zg.types=["Unknown","Point","LineString","Polygon"];class wV{constructor(c,h){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(F2e,this,h),this.length=this._features.length}feature(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];const h=this._pbf.readVarint()+this._pbf.pos;return new zg(this._pbf,h,this.extent,this._keys,this._values)}}function F2e(A,c,h){A===15?c.version=h.readVarint():A===1?c.name=h.readString():A===5?c.extent=h.readVarint():A===2?c._features.push(h.pos):A===3?c._keys.push(h.readString()):A===4&&c._values.push(function(g){let _=null;const x=g.readVarint()+g.pos;for(;g.pos<x;){const T=g.readVarint()>>3;_=T===1?g.readString():T===2?g.readFloat():T===3?g.readDouble():T===4?g.readVarint64():T===5?g.readVarint():T===6?g.readSVarint():T===7?g.readBoolean():null}if(_==null)throw new Error("unknown feature value");return _}(h))}class xV{constructor(c,h){this.layers=c.readFields(R2e,{},h)}}function R2e(A,c,h){if(A===3){const g=new wV(h,h.readVarint()+h.pos);g.length&&(c[g.name]=g)}}const aI=Math.pow(2,13);function cy(A,c,h,g,_,x,T,S){A.emplaceBack(c,h,2*Math.floor(g*aI)+T,_*aI*2,x*aI*2,Math.round(S))}class lI{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasDependencies=!1,this.layoutVertexArray=new Qe,this.centroidVertexArray=new De,this.indexArray=new tn,this.programConfigurations=new Sh(c.layers,c.zoom),this.segments=new Bn,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(c,h,g){this.features=[],this.hasDependencies=mv("fill-extrusion",this.layers,h);for(const{feature:_,id:x,index:T,sourceLayerIndex:S}of c){const F=this.layers[0]._featureFilter.needGeometry,U=Xd(_,F);if(!this.layers[0]._featureFilter.filter(new cn(this.zoom),U,g))continue;const z={id:x,sourceLayerIndex:S,index:T,geometry:F?U.geometry:Iu(_),properties:_.properties,type:_.type,patterns:{}};this.hasDependencies?this.features.push(nI("fill-extrusion",this.layers,z,{zoom:this.zoom},h)):this.addFeature(z,z.geometry,T,g,{},h.subdivisionGranularity),h.featureIndex.insert(_,z.geometry,T,S,this.index,!0)}}addFeatures(c,h,g){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,h,g,c.subdivisionGranularity)}}update(c,h,g){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,{imagePositions:g})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,I2e),this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,S2e.members,!0),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(c,h,g,_,x,T){for(const S of bc(h,500)){const F={x:0,y:0,sampleCount:0},U=this.layoutVertexArray.length;this.processPolygon(F,_,c,S,T);const z=this.layoutVertexArray.length-U,K=Math.floor(F.x/F.sampleCount),ee=Math.floor(F.y/F.sampleCount);for(let oe=0;oe<z;oe++)this.centroidVertexArray.emplaceBack(K,ee)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,g,{imagePositions:x,canonical:_})}processPolygon(c,h,g,_,x){if(_.length<1||BV(_[0]))return;for(const K of _)K.length!==0&&L2e(c,K);const T={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},S=x.fill.getGranularityForZoomLevel(h.z),F=zg.types[g.type]==="Polygon";for(const K of _){if(K.length===0||BV(K))continue;const ee=Zd(K,S,F);this._generateSideFaces(ee,T)}if(!F)return;const U=_V(_,h,S,!1),z=this.layoutVertexArray;yV((K,ee)=>{cy(z,K,ee,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,U.verticesFlattened,U.indicesTriangles)}_generateSideFaces(c,h){let g=0;for(let _=1;_<c.length;_++){const x=c[_],T=c[_-1];if(O2e(x,T))continue;h.segment.vertexLength+4>Bn.MAX_VERTEX_ARRAY_LENGTH&&(h.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const S=x.sub(T)._perp()._unit(),F=T.dist(x);g+F>32768&&(g=0),cy(this.layoutVertexArray,x.x,x.y,S.x,S.y,0,0,g),cy(this.layoutVertexArray,x.x,x.y,S.x,S.y,0,1,g),g+=F,cy(this.layoutVertexArray,T.x,T.y,S.x,S.y,0,0,g),cy(this.layoutVertexArray,T.x,T.y,S.x,S.y,0,1,g);const U=h.segment.vertexLength;this.indexArray.emplaceBack(U,U+2,U+1),this.indexArray.emplaceBack(U+1,U+2,U+3),h.segment.vertexLength+=4,h.segment.primitiveLength+=2}}}function L2e(A,c){for(let h=0;h<c.length;h++){const g=c[h];h===c.length-1&&c[0].x===g.x&&c[0].y===g.y||(A.x+=g.x,A.y+=g.y,A.sampleCount++)}}function O2e(A,c){return A.x===c.x&&(A.x<0||A.x>Xe)||A.y===c.y&&(A.y<0||A.y>Xe)}function BV(A){return A.every(c=>c.x<0)||A.every(c=>c.x>Xe)||A.every(c=>c.y<0)||A.every(c=>c.y>Xe)}let CV;be("FillExtrusionBucket",lI,{omit:["layers","features"]});var U2e={get paint(){return CV=CV||new Ci({"fill-extrusion-opacity":new or(Ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new br(Ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new or(Ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new or(Ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new di(Ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new br(Ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new br(Ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new or(Ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class D2e extends Ri{constructor(c,h){super(c,U2e,h)}createBucket(c){return new lI(c)}queryRadius(){return pv(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:c,feature:h,featureState:g,geometry:_,transform:x,pixelsToTileUnits:T,pixelPosMatrix:S}){const F=gv(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-x.bearingInRadians,T),U=this.paint.get("fill-extrusion-height").evaluate(h,g),z=this.paint.get("fill-extrusion-base").evaluate(h,g),K=function(oe,le){const pe=[];for(const Ce of oe){const Ue=[Ce.x,Ce.y,0,1];me(Ue,Ue,le),pe.push(new u(Ue[0]/Ue[3],Ue[1]/Ue[3]))}return pe}(F,S),ee=function(oe,le,pe,Ce){const Ue=[],At=[],Ve=Ce[8]*le,et=Ce[9]*le,Tt=Ce[10]*le,Rt=Ce[11]*le,qt=Ce[8]*pe,mr=Ce[9]*pe,cr=Ce[10]*pe,dr=Ce[11]*pe;for(const kr of oe){const fr=[],pr=[];for(const Ht of kr){const rn=Ht.x,un=Ht.y,qr=Ce[0]*rn+Ce[4]*un+Ce[12],Rr=Ce[1]*rn+Ce[5]*un+Ce[13],Mn=Ce[2]*rn+Ce[6]*un+Ce[14],ts=Ce[3]*rn+Ce[7]*un+Ce[15],Ws=Mn+Tt,$o=ts+Rt,Gl=qr+qt,Ka=Rr+mr,So=Mn+cr,qi=ts+dr,ho=new u((qr+Ve)/$o,(Rr+et)/$o);ho.z=Ws/$o,fr.push(ho);const Io=new u(Gl/qi,Ka/qi);Io.z=So/qi,pr.push(Io)}Ue.push(fr),At.push(pr)}return[Ue,At]}(_,z,U,S);return function(oe,le,pe){let Ce=1/0;J7(pe,le)&&(Ce=TV(pe,le[0]));for(let Ue=0;Ue<le.length;Ue++){const At=le[Ue],Ve=oe[Ue];for(let et=0;et<At.length-1;et++){const Tt=At[et],Rt=[Tt,At[et+1],Ve[et+1],Ve[et],Tt];Z7(pe,Rt)&&(Ce=Math.min(Ce,TV(pe,Rt)))}}return Ce!==1/0&&Ce}(ee[0],ee[1],K)}}function uy(A,c){return A.x*c.x+A.y*c.y}function TV(A,c){if(A.length===1){let h=0;const g=c[h++];let _;for(;!_||g.equals(_);)if(_=c[h++],!_)return 1/0;for(;h<c.length;h++){const x=c[h],T=A[0],S=_.sub(g),F=x.sub(g),U=T.sub(g),z=uy(S,S),K=uy(S,F),ee=uy(F,F),oe=uy(U,S),le=uy(U,F),pe=z*ee-K*K,Ce=(ee*oe-K*le)/pe,Ue=(z*le-K*oe)/pe,At=g.z*(1-Ce-Ue)+_.z*Ce+x.z*Ue;if(isFinite(At))return At}return 1/0}{let h=1/0;for(const g of c)h=Math.min(h,g.z);return h}}const k2e=Ln([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:N2e}=k2e,z2e=Ln([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Q2e}=z2e,H2e=Math.cos(Math.PI/180*37.5),EV=Math.pow(2,14)/.5;class cI{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(h=>h.id),this.index=c.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new at,this.layoutVertexArray2=new Mt,this.indexArray=new tn,this.programConfigurations=new Sh(c.layers,c.zoom),this.segments=new Bn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(c,h,g){this.hasDependencies=mv("line",this.layers,h)||this.hasLineDasharray(this.layers);const _=this.layers[0].layout.get("line-sort-key"),x=!_.isConstant(),T=[];for(const{feature:S,id:F,index:U,sourceLayerIndex:z}of c){const K=this.layers[0]._featureFilter.needGeometry,ee=Xd(S,K);if(!this.layers[0]._featureFilter.filter(new cn(this.zoom),ee,g))continue;const oe=x?_.evaluate(ee,{},g):void 0,le={id:F,properties:S.properties,type:S.type,sourceLayerIndex:z,index:U,geometry:K?ee.geometry:Iu(S),patterns:{},dashes:{},sortKey:oe};T.push(le)}x&&T.sort((S,F)=>S.sortKey-F.sortKey);for(const S of T){const{geometry:F,index:U,sourceLayerIndex:z}=S;this.hasDependencies?(mv("line",this.layers,h)?nI("line",this.layers,S,{zoom:this.zoom},h):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,S,this.zoom,h),this.patternFeatures.push(S)):this.addFeature(S,F,U,g,{},{},h.subdivisionGranularity),h.featureIndex.insert(c[U].feature,F,U,z,this.index)}}update(c,h,g,_){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,h,this.stateDependentLayers,{imagePositions:g,dashPositions:_})}addFeatures(c,h,g,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,h,g,_,c.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,Q2e)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,N2e),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,h,g,_,x,T,S){const F=this.layers[0].layout,U=F.get("line-join").evaluate(c,{}),z=F.get("line-cap"),K=F.get("line-miter-limit"),ee=F.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const oe of h)this.addLine(oe,c,U,z,K,ee,_,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,g,{imagePositions:x,dashPositions:T,canonical:_})}addLine(c,h,g,_,x,T,S,F){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,c=Zd(c,S?F.line.getGranularityForZoomLevel(S.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ve=0;Ve<c.length-1;Ve++)this.totalDistance+=c[Ve].dist(c[Ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const U=zg.types[h.type]==="Polygon";let z=c.length;for(;z>=2&&c[z-1].equals(c[z-2]);)z--;let K=0;for(;K<z-1&&c[K].equals(c[K+1]);)K++;if(z<(U?3:2))return;g==="bevel"&&(x=1.05);const ee=this.overscaling<=16?122880/(512*this.overscaling):0,oe=this.segments.prepareSegment(10*z,this.layoutVertexArray,this.indexArray);let le,pe,Ce,Ue,At;this.e1=this.e2=-1,U&&(le=c[z-2],At=c[K].sub(le)._unit()._perp());for(let Ve=K;Ve<z;Ve++){if(Ce=Ve===z-1?U?c[K+1]:void 0:c[Ve+1],Ce&&c[Ve].equals(Ce))continue;At&&(Ue=At),le&&(pe=le),le=c[Ve],At=Ce?Ce.sub(le)._unit()._perp():Ue,Ue=Ue||At;let et=Ue.add(At);et.x===0&&et.y===0||et._unit();const Tt=Ue.x*At.x+Ue.y*At.y,Rt=et.x*At.x+et.y*At.y,qt=Rt!==0?1/Rt:1/0,mr=2*Math.sqrt(2-2*Rt),cr=Rt<H2e&&pe&&Ce,dr=Ue.x*At.y-Ue.y*At.x>0;if(cr&&Ve>K){const pr=le.dist(pe);if(pr>2*ee){const Ht=le.sub(le.sub(pe)._mult(ee/pr)._round());this.updateDistance(pe,Ht),this.addCurrentVertex(Ht,Ue,0,0,oe),pe=Ht}}const kr=pe&&Ce;let fr=kr?g:U?"butt":_;if(kr&&fr==="round"&&(qt<T?fr="miter":qt<=2&&(fr="fakeround")),fr==="miter"&&qt>x&&(fr="bevel"),fr==="bevel"&&(qt>2&&(fr="flipbevel"),qt<x&&(fr="miter")),pe&&this.updateDistance(pe,le),fr==="miter")et._mult(qt),this.addCurrentVertex(le,et,0,0,oe);else if(fr==="flipbevel"){if(qt>100)et=At.mult(-1);else{const pr=qt*Ue.add(At).mag()/Ue.sub(At).mag();et._perp()._mult(pr*(dr?-1:1))}this.addCurrentVertex(le,et,0,0,oe),this.addCurrentVertex(le,et.mult(-1),0,0,oe)}else if(fr==="bevel"||fr==="fakeround"){const pr=-Math.sqrt(qt*qt-1),Ht=dr?pr:0,rn=dr?0:pr;if(pe&&this.addCurrentVertex(le,Ue,Ht,rn,oe),fr==="fakeround"){const un=Math.round(180*mr/Math.PI/20);for(let qr=1;qr<un;qr++){let Rr=qr/un;if(Rr!==.5){const ts=Rr-.5;Rr+=Rr*ts*(Rr-1)*((1.0904+Tt*(Tt*(3.55645-1.43519*Tt)-3.2452))*ts*ts+(.848013+Tt*(.215638*Tt-1.06021)))}const Mn=At.sub(Ue)._mult(Rr)._add(Ue)._unit()._mult(dr?-1:1);this.addHalfVertex(le,Mn.x,Mn.y,!1,dr,0,oe)}}Ce&&this.addCurrentVertex(le,At,-Ht,-rn,oe)}else if(fr==="butt")this.addCurrentVertex(le,et,0,0,oe);else if(fr==="square"){const pr=pe?1:-1;this.addCurrentVertex(le,et,pr,pr,oe)}else fr==="round"&&(pe&&(this.addCurrentVertex(le,Ue,0,0,oe),this.addCurrentVertex(le,Ue,1,1,oe,!0)),Ce&&(this.addCurrentVertex(le,At,-1,-1,oe,!0),this.addCurrentVertex(le,At,0,0,oe)));if(cr&&Ve<z-1){const pr=le.dist(Ce);if(pr>2*ee){const Ht=le.add(Ce.sub(le)._mult(ee/pr)._round());this.updateDistance(le,Ht),this.addCurrentVertex(Ht,At,0,0,oe),le=Ht}}}}addCurrentVertex(c,h,g,_,x,T=!1){const S=h.y*_-h.x,F=-h.y-h.x*_;this.addHalfVertex(c,h.x+h.y*g,h.y-h.x*g,T,!1,g,x),this.addHalfVertex(c,S,F,T,!0,-_,x),this.distance>EV/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(c,h,g,_,x,T))}addHalfVertex({x:c,y:h},g,_,x,T,S,F){const U=.5*(this.lineClips?this.scaledDistance*(EV-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((c<<1)+(x?1:0),(h<<1)+(T?1:0),Math.round(63*g)+128,Math.round(63*_)+128,1+(S===0?0:S<0?-1:1)|(63&U)<<2,U>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=F.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,z,this.e2),F.primitiveLength++),T?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(c,h){this.distance+=c.dist(h),this.updateScaledDistance()}hasLineDasharray(c){for(const h of c){const g=h.paint.get("line-dasharray");if(g&&!g.isConstant())return!0}return!1}addLineDashDependencies(c,h,g,_){for(const x of c){const T=x.paint.get("line-dasharray");if(!T||T.value.kind==="constant")continue;const S=x.layout.get("line-cap")==="round",F={dasharray:T.value.evaluate({zoom:g-1},h,{}),round:S},U={dasharray:T.value.evaluate({zoom:g},h,{}),round:S},z={dasharray:T.value.evaluate({zoom:g+1},h,{}),round:S},K=`${F.dasharray.join(",")},${F.round}`,ee=`${U.dasharray.join(",")},${U.round}`,oe=`${z.dasharray.join(",")},${z.round}`;_.dashDependencies[K]=F,_.dashDependencies[ee]=U,_.dashDependencies[oe]=z,h.dashes[x.id]={min:K,mid:ee,max:oe}}}}let SV,IV;be("LineBucket",cI,{omit:["layers","patternFeatures"]});var PV={get paint(){return IV=IV||new Ci({"line-opacity":new br(Ze.paint_line["line-opacity"]),"line-color":new br(Ze.paint_line["line-color"]),"line-translate":new or(Ze.paint_line["line-translate"]),"line-translate-anchor":new or(Ze.paint_line["line-translate-anchor"]),"line-width":new br(Ze.paint_line["line-width"]),"line-gap-width":new br(Ze.paint_line["line-gap-width"]),"line-offset":new br(Ze.paint_line["line-offset"]),"line-blur":new br(Ze.paint_line["line-blur"]),"line-dasharray":new di(Ze.paint_line["line-dasharray"]),"line-pattern":new di(Ze.paint_line["line-pattern"]),"line-gradient":new es(Ze.paint_line["line-gradient"])})},get layout(){return SV=SV||new Ci({"line-cap":new or(Ze.layout_line["line-cap"]),"line-join":new br(Ze.layout_line["line-join"]),"line-miter-limit":new or(Ze.layout_line["line-miter-limit"]),"line-round-limit":new or(Ze.layout_line["line-round-limit"]),"line-sort-key":new br(Ze.layout_line["line-sort-key"])})}};class V2e extends br{possiblyEvaluate(c,h){return h=new cn(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(c,h)}evaluate(c,h,g,_){return h=Pt({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(c,h,g,_)}}let vv;class j2e extends Ri{constructor(c,h){super(c,PV,h),this.gradientVersion=0,vv||(vv=new V2e(PV.paint.properties["line-width"].specification),vv.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(g){return g._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof tt,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,h){super.recalculate(c,h),this.paint._values["line-floorwidth"]=vv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new cI(c)}queryRadius(c){const h=c,g=MV(Ug("line-width",this,h),Ug("line-gap-width",this,h)),_=Ug("line-offset",this,h);return g/2+Math.abs(_)+pv(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:c,feature:h,featureState:g,geometry:_,transform:x,pixelsToTileUnits:T}){const S=gv(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-x.bearingInRadians,T),F=T/2*MV(this.paint.get("line-width").evaluate(h,g),this.paint.get("line-gap-width").evaluate(h,g)),U=this.paint.get("line-offset").evaluate(h,g);return U&&(_=function(z,K){const ee=[];for(let oe=0;oe<z.length;oe++){const le=z[oe],pe=[];for(let Ce=0;Ce<le.length;Ce++){const Ue=le[Ce-1],At=le[Ce],Ve=le[Ce+1],et=Ce===0?new u(0,0):At.sub(Ue)._unit()._perp(),Tt=Ce===le.length-1?new u(0,0):Ve.sub(At)._unit()._perp(),Rt=et._add(Tt)._unit(),qt=Rt.x*Tt.x+Rt.y*Tt.y;qt!==0&&Rt._mult(1/qt),pe.push(Rt._mult(K)._add(At))}ee.push(pe)}return ee}(_,U*T)),function(z,K,ee){for(let oe=0;oe<K.length;oe++){const le=K[oe];if(z.length>=3){for(let pe=0;pe<le.length;pe++)if(Og(z,le[pe]))return!0}if(Ywe(z,le,ee))return!0}return!1}(S,_,F)}isTileClipped(){return!0}}function MV(A,c){return c>0?c+2*A:A}const $2e=Ln([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),G2e=Ln([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ln([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const W2e=Ln([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Ln([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const FV=Ln([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),q2e=Ln([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function K2e(A,c,h){return A.sections.forEach(g=>{g.text=function(_,x,T){const S=x.layout.get("text-transform").evaluate(T,{});return S==="uppercase"?_=_.toLocaleUpperCase():S==="lowercase"&&(_=_.toLocaleLowerCase()),_r.applyArabicShaping&&(_=_r.applyArabicShaping(_)),_}(g.text,c,h)}),A}Ln([{name:"triangle",components:3,type:"Uint16"}]),Ln([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ln([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ln([{type:"Float32",name:"offsetX"}]),Ln([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ln([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const hy={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var uo=24;const uI=4294967296,RV=1/uI,LV=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class hI{constructor(c=new Uint8Array(16)){this.buf=ArrayBuffer.isView(c)?c:new Uint8Array(c),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(c,h,g=this.length){for(;this.pos<g;){const _=this.readVarint(),x=_>>3,T=this.pos;this.type=7&_,c(x,h,this),this.pos===T&&this.skip(_)}return h}readMessage(c,h){return this.readFields(c,h,this.readVarint()+this.pos)}readFixed32(){const c=this.dataView.getUint32(this.pos,!0);return this.pos+=4,c}readSFixed32(){const c=this.dataView.getInt32(this.pos,!0);return this.pos+=4,c}readFixed64(){const c=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*uI;return this.pos+=8,c}readSFixed64(){const c=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*uI;return this.pos+=8,c}readFloat(){const c=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,c}readDouble(){const c=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,c}readVarint(c){const h=this.buf;let g,_;return _=h[this.pos++],g=127&_,_<128?g:(_=h[this.pos++],g|=(127&_)<<7,_<128?g:(_=h[this.pos++],g|=(127&_)<<14,_<128?g:(_=h[this.pos++],g|=(127&_)<<21,_<128?g:(_=h[this.pos],g|=(15&_)<<28,function(x,T,S){const F=S.buf;let U,z;if(z=F[S.pos++],U=(112&z)>>4,z<128||(z=F[S.pos++],U|=(127&z)<<3,z<128)||(z=F[S.pos++],U|=(127&z)<<10,z<128)||(z=F[S.pos++],U|=(127&z)<<17,z<128)||(z=F[S.pos++],U|=(127&z)<<24,z<128)||(z=F[S.pos++],U|=(1&z)<<31,z<128))return Qg(x,U,T);throw new Error("Expected varint not more than 10 bytes")}(g,c,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const c=this.readVarint();return c%2==1?(c+1)/-2:c/2}readBoolean(){return!!this.readVarint()}readString(){const c=this.readVarint()+this.pos,h=this.pos;return this.pos=c,c-h>=12&&LV?LV.decode(this.buf.subarray(h,c)):function(g,_,x){let T="",S=_;for(;S<x;){const F=g[S];let U,z,K,ee=null,oe=F>239?4:F>223?3:F>191?2:1;if(S+oe>x)break;oe===1?F<128&&(ee=F):oe===2?(U=g[S+1],(192&U)==128&&(ee=(31&F)<<6|63&U,ee<=127&&(ee=null))):oe===3?(U=g[S+1],z=g[S+2],(192&U)==128&&(192&z)==128&&(ee=(15&F)<<12|(63&U)<<6|63&z,(ee<=2047||ee>=55296&&ee<=57343)&&(ee=null))):oe===4&&(U=g[S+1],z=g[S+2],K=g[S+3],(192&U)==128&&(192&z)==128&&(192&K)==128&&(ee=(15&F)<<18|(63&U)<<12|(63&z)<<6|63&K,(ee<=65535||ee>=1114112)&&(ee=null))),ee===null?(ee=65533,oe=1):ee>65535&&(ee-=65536,T+=String.fromCharCode(ee>>>10&1023|55296),ee=56320|1023&ee),T+=String.fromCharCode(ee),S+=oe}return T}(this.buf,h,c)}readBytes(){const c=this.readVarint()+this.pos,h=this.buf.subarray(this.pos,c);return this.pos=c,h}readPackedVarint(c=[],h){const g=this.readPackedEnd();for(;this.pos<g;)c.push(this.readVarint(h));return c}readPackedSVarint(c=[]){const h=this.readPackedEnd();for(;this.pos<h;)c.push(this.readSVarint());return c}readPackedBoolean(c=[]){const h=this.readPackedEnd();for(;this.pos<h;)c.push(this.readBoolean());return c}readPackedFloat(c=[]){const h=this.readPackedEnd();for(;this.pos<h;)c.push(this.readFloat());return c}readPackedDouble(c=[]){const h=this.readPackedEnd();for(;this.pos<h;)c.push(this.readDouble());return c}readPackedFixed32(c=[]){const h=this.readPackedEnd();for(;this.pos<h;)c.push(this.readFixed32());return c}readPackedSFixed32(c=[]){const h=this.readPackedEnd();for(;this.pos<h;)c.push(this.readSFixed32());return c}readPackedFixed64(c=[]){const h=this.readPackedEnd();for(;this.pos<h;)c.push(this.readFixed64());return c}readPackedSFixed64(c=[]){const h=this.readPackedEnd();for(;this.pos<h;)c.push(this.readSFixed64());return c}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(c){const h=7&c;if(h===0)for(;this.buf[this.pos++]>127;);else if(h===2)this.pos=this.readVarint()+this.pos;else if(h===5)this.pos+=4;else{if(h!==1)throw new Error(`Unimplemented type: ${h}`);this.pos+=8}}writeTag(c,h){this.writeVarint(c<<3|h)}realloc(c){let h=this.length||16;for(;h<this.pos+c;)h*=2;if(h!==this.length){const g=new Uint8Array(h);g.set(this.buf),this.buf=g,this.dataView=new DataView(g.buffer),this.length=h}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(c){this.realloc(4),this.dataView.setInt32(this.pos,c,!0),this.pos+=4}writeSFixed32(c){this.realloc(4),this.dataView.setInt32(this.pos,c,!0),this.pos+=4}writeFixed64(c){this.realloc(8),this.dataView.setInt32(this.pos,-1&c,!0),this.dataView.setInt32(this.pos+4,Math.floor(c*RV),!0),this.pos+=8}writeSFixed64(c){this.realloc(8),this.dataView.setInt32(this.pos,-1&c,!0),this.dataView.setInt32(this.pos+4,Math.floor(c*RV),!0),this.pos+=8}writeVarint(c){(c=+c||0)>268435455||c<0?function(h,g){let _,x;if(h>=0?(_=h%4294967296|0,x=h/4294967296|0):(_=~(-h%4294967296),x=~(-h/4294967296),4294967295^_?_=_+1|0:(_=0,x=x+1|0)),h>=18446744073709552e3||h<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");g.realloc(10),function(T,S,F){F.buf[F.pos++]=127&T|128,T>>>=7,F.buf[F.pos++]=127&T|128,T>>>=7,F.buf[F.pos++]=127&T|128,T>>>=7,F.buf[F.pos++]=127&T|128,F.buf[F.pos]=127&(T>>>=7)}(_,0,g),function(T,S){const F=(7&T)<<4;S.buf[S.pos++]|=F|((T>>>=3)?128:0),T&&(S.buf[S.pos++]=127&T|((T>>>=7)?128:0),T&&(S.buf[S.pos++]=127&T|((T>>>=7)?128:0),T&&(S.buf[S.pos++]=127&T|((T>>>=7)?128:0),T&&(S.buf[S.pos++]=127&T|((T>>>=7)?128:0),T&&(S.buf[S.pos++]=127&T)))))}(x,g)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))}writeSVarint(c){this.writeVarint(c<0?2*-c-1:2*c)}writeBoolean(c){this.writeVarint(+c)}writeString(c){c=String(c),this.realloc(4*c.length),this.pos++;const h=this.pos;this.pos=function(_,x,T){for(let S,F,U=0;U<x.length;U++){if(S=x.charCodeAt(U),S>55295&&S<57344){if(!F){S>56319||U+1===x.length?(_[T++]=239,_[T++]=191,_[T++]=189):F=S;continue}if(S<56320){_[T++]=239,_[T++]=191,_[T++]=189,F=S;continue}S=F-55296<<10|S-56320|65536,F=null}else F&&(_[T++]=239,_[T++]=191,_[T++]=189,F=null);S<128?_[T++]=S:(S<2048?_[T++]=S>>6|192:(S<65536?_[T++]=S>>12|224:(_[T++]=S>>18|240,_[T++]=S>>12&63|128),_[T++]=S>>6&63|128),_[T++]=63&S|128)}return T}(this.buf,c,this.pos);const g=this.pos-h;g>=128&&OV(h,g,this),this.pos=h-1,this.writeVarint(g),this.pos+=g}writeFloat(c){this.realloc(4),this.dataView.setFloat32(this.pos,c,!0),this.pos+=4}writeDouble(c){this.realloc(8),this.dataView.setFloat64(this.pos,c,!0),this.pos+=8}writeBytes(c){const h=c.length;this.writeVarint(h),this.realloc(h);for(let g=0;g<h;g++)this.buf[this.pos++]=c[g]}writeRawMessage(c,h){this.pos++;const g=this.pos;c(h,this);const _=this.pos-g;_>=128&&OV(g,_,this),this.pos=g-1,this.writeVarint(_),this.pos+=_}writeMessage(c,h,g){this.writeTag(c,2),this.writeRawMessage(h,g)}writePackedVarint(c,h){h.length&&this.writeMessage(c,X2e,h)}writePackedSVarint(c,h){h.length&&this.writeMessage(c,Y2e,h)}writePackedBoolean(c,h){h.length&&this.writeMessage(c,exe,h)}writePackedFloat(c,h){h.length&&this.writeMessage(c,Z2e,h)}writePackedDouble(c,h){h.length&&this.writeMessage(c,J2e,h)}writePackedFixed32(c,h){h.length&&this.writeMessage(c,txe,h)}writePackedSFixed32(c,h){h.length&&this.writeMessage(c,rxe,h)}writePackedFixed64(c,h){h.length&&this.writeMessage(c,nxe,h)}writePackedSFixed64(c,h){h.length&&this.writeMessage(c,ixe,h)}writeBytesField(c,h){this.writeTag(c,2),this.writeBytes(h)}writeFixed32Field(c,h){this.writeTag(c,5),this.writeFixed32(h)}writeSFixed32Field(c,h){this.writeTag(c,5),this.writeSFixed32(h)}writeFixed64Field(c,h){this.writeTag(c,1),this.writeFixed64(h)}writeSFixed64Field(c,h){this.writeTag(c,1),this.writeSFixed64(h)}writeVarintField(c,h){this.writeTag(c,0),this.writeVarint(h)}writeSVarintField(c,h){this.writeTag(c,0),this.writeSVarint(h)}writeStringField(c,h){this.writeTag(c,2),this.writeString(h)}writeFloatField(c,h){this.writeTag(c,5),this.writeFloat(h)}writeDoubleField(c,h){this.writeTag(c,1),this.writeDouble(h)}writeBooleanField(c,h){this.writeVarintField(c,+h)}}function Qg(A,c,h){return h?4294967296*c+(A>>>0):4294967296*(c>>>0)+(A>>>0)}function OV(A,c,h){const g=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));h.realloc(g);for(let _=h.pos-1;_>=A;_--)h.buf[_+g]=h.buf[_]}function X2e(A,c){for(let h=0;h<A.length;h++)c.writeVarint(A[h])}function Y2e(A,c){for(let h=0;h<A.length;h++)c.writeSVarint(A[h])}function Z2e(A,c){for(let h=0;h<A.length;h++)c.writeFloat(A[h])}function J2e(A,c){for(let h=0;h<A.length;h++)c.writeDouble(A[h])}function exe(A,c){for(let h=0;h<A.length;h++)c.writeBoolean(A[h])}function txe(A,c){for(let h=0;h<A.length;h++)c.writeFixed32(A[h])}function rxe(A,c){for(let h=0;h<A.length;h++)c.writeSFixed32(A[h])}function nxe(A,c){for(let h=0;h<A.length;h++)c.writeFixed64(A[h])}function ixe(A,c){for(let h=0;h<A.length;h++)c.writeSFixed64(A[h])}function sxe(A,c,h){A===1&&h.readMessage(oxe,c)}function oxe(A,c,h){if(A===3){const{id:g,bitmap:_,width:x,height:T,left:S,top:F,advance:U}=h.readMessage(axe,{});c.push({id:g,bitmap:new ry({width:x+6,height:T+6},_),metrics:{width:x,height:T,left:S,top:F,advance:U}})}}function axe(A,c,h){A===1?c.id=h.readVarint():A===2?c.bitmap=h.readBytes():A===3?c.width=h.readVarint():A===4?c.height=h.readVarint():A===5?c.left=h.readSVarint():A===6?c.top=h.readSVarint():A===7&&(c.advance=h.readVarint())}function UV(A){let c=0,h=0;for(const T of A)c+=T.w*T.h,h=Math.max(h,T.w);A.sort((T,S)=>S.h-T.h);const g=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),h),h:1/0}];let _=0,x=0;for(const T of A)for(let S=g.length-1;S>=0;S--){const F=g[S];if(!(T.w>F.w||T.h>F.h)){if(T.x=F.x,T.y=F.y,x=Math.max(x,T.y+T.h),_=Math.max(_,T.x+T.w),T.w===F.w&&T.h===F.h){const U=g.pop();U&&S<g.length&&(g[S]=U)}else T.h===F.h?(F.x+=T.w,F.w-=T.w):T.w===F.w?(F.y+=T.h,F.h-=T.h):(g.push({x:F.x+T.w,y:F.y,w:F.w-T.w,h:T.h}),F.y+=T.h,F.h-=T.h);break}}return{w:_,h:x,fill:c/(_*x)||0}}class AI{constructor(c,{pixelRatio:h,version:g,stretchX:_,stretchY:x,content:T,textFitWidth:S,textFitHeight:F}){this.paddedRect=c,this.pixelRatio=h,this.stretchX=_,this.stretchY=x,this.content=T,this.version=g,this.textFitWidth=S,this.textFitHeight=F}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class DV{constructor(c,h){const g={},_={};this.haveRenderCallbacks=[];const x=[];this.addImages(c,g,x),this.addImages(h,_,x);const{w:T,h:S}=UV(x),F=new qa({width:T||1,height:S||1});for(const U in c){const z=c[U],K=g[U].paddedRect;qa.copy(z.data,F,{x:0,y:0},{x:K.x+1,y:K.y+1},z.data)}for(const U in h){const z=h[U],K=_[U].paddedRect,ee=K.x+1,oe=K.y+1,le=z.data.width,pe=z.data.height;qa.copy(z.data,F,{x:0,y:0},{x:ee,y:oe},z.data),qa.copy(z.data,F,{x:0,y:pe-1},{x:ee,y:oe-1},{width:le,height:1}),qa.copy(z.data,F,{x:0,y:0},{x:ee,y:oe+pe},{width:le,height:1}),qa.copy(z.data,F,{x:le-1,y:0},{x:ee-1,y:oe},{width:1,height:pe}),qa.copy(z.data,F,{x:0,y:0},{x:ee+le,y:oe},{width:1,height:pe})}this.image=F,this.iconPositions=g,this.patternPositions=_}addImages(c,h,g){for(const _ in c){const x=c[_],T={x:0,y:0,w:x.data.width+2,h:x.data.height+2};g.push(T),h[_]=new AI(T,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(_)}}patchUpdatedImages(c,h){c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const g in c.updatedImages)this.patchUpdatedImage(this.iconPositions[g],c.getImage(g),h),this.patchUpdatedImage(this.patternPositions[g],c.getImage(g),h)}patchUpdatedImage(c,h,g){if(!c||!h||c.version===h.version)return;c.version=h.version;const[_,x]=c.tl;g.update(h.data,void 0,{x:_,y:x})}}var Bf;be("ImagePosition",AI),be("ImageAtlas",DV),a.ao=void 0,(Bf=a.ao||(a.ao={}))[Bf.none=0]="none",Bf[Bf.horizontal=1]="horizontal",Bf[Bf.vertical=2]="vertical",Bf[Bf.horizontalOnly=3]="horizontalOnly";class Ay{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(c,h,g){const _=new Ay;return _.scale=c||1,_.fontStack=h,_.verticalAlign=g||"bottom",_}static forImage(c,h){const g=new Ay;return g.imageName=c,g.verticalAlign=h||"bottom",g}}class Hg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,h){const g=new Hg;for(let _=0;_<c.sections.length;_++){const x=c.sections[_];x.image?g.addImageSection(x):g.addTextSection(x,h)}return g}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSectionIndex(c){return this.sectionIndex[c]}getCharCode(c){return this.text.charCodeAt(c)}verticalizePunctuation(){this.text=function(c){let h="";for(let g=0;g<c.length;g++){const _=c.charCodeAt(g+1)||null,x=c.charCodeAt(g-1)||null;h+=_&&zr(_)&&!hy[c[g+1]]||x&&zr(x)&&!hy[c[g-1]]||!hy[c[g]]?c[g]:hy[c[g]]}return h}(this.text)}trim(){let c=0;for(let g=0;g<this.text.length&&xv[this.text.charCodeAt(g)];g++)c++;let h=this.text.length;for(let g=this.text.length-1;g>=0&&g>=c&&xv[this.text.charCodeAt(g)];g--)h--;this.text=this.text.substring(c,h),this.sectionIndex=this.sectionIndex.slice(c,h)}substring(c,h){const g=new Hg;return g.text=this.text.substring(c,h),g.sectionIndex=this.sectionIndex.slice(c,h),g.sections=this.sections,g}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,h)=>Math.max(c,this.sections[h].scale),0)}getMaxImageSize(c){let h=0,g=0;for(let _=0;_<this.length();_++){const x=this.getSection(_);if(x.imageName){const T=c[x.imageName];if(!T)continue;const S=T.displaySize;h=Math.max(h,S[0]),g=Math.max(g,S[1])}}return{maxImageWidth:h,maxImageHeight:g}}addTextSection(c,h){this.text+=c.text,this.sections.push(Ay.forText(c.scale,c.fontStack||h,c.verticalAlign));const g=this.sections.length-1;for(let _=0;_<c.text.length;++_)this.sectionIndex.push(g)}addImageSection(c){const h=c.image?c.image.name:"";if(h.length===0)return void xt("Can't add FormattedSection with an empty image.");const g=this.getNextImageSectionCharCode();g?(this.text+=String.fromCharCode(g),this.sections.push(Ay.forImage(h,c.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):xt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wv(A,c,h,g,_,x,T,S,F,U,z,K,ee,oe,le){const pe=Hg.fromFeature(A,_);let Ce;K===a.ao.vertical&&pe.verticalizePunctuation();const{processBidirectionalText:Ue,processStyledBidirectionalText:At}=_r;if(Ue&&pe.sections.length===1){Ce=[];const Tt=Ue(pe.toString(),fI(pe,U,x,c,g,oe));for(const Rt of Tt){const qt=new Hg;qt.text=Rt,qt.sections=pe.sections;for(let mr=0;mr<Rt.length;mr++)qt.sectionIndex.push(0);Ce.push(qt)}}else if(At){Ce=[];const Tt=At(pe.text,pe.sectionIndex,fI(pe,U,x,c,g,oe));for(const Rt of Tt){const qt=new Hg;qt.text=Rt[0],qt.sectionIndex=Rt[1],qt.sections=pe.sections,Ce.push(qt)}}else Ce=function(Tt,Rt){const qt=[],mr=Tt.text;let cr=0;for(const dr of Rt)qt.push(Tt.substring(cr,dr)),cr=dr;return cr<mr.length&&qt.push(Tt.substring(cr,mr.length)),qt}(pe,fI(pe,U,x,c,g,oe));const Ve=[],et={positionedLines:Ve,text:pe.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(Tt,Rt,qt,mr,cr,dr,kr,fr,pr,Ht,rn,un){let qr=0,Rr=0,Mn=0,ts=0;const Ws=fr==="right"?1:fr==="left"?0:.5,$o=uo/un;let Gl=0;for(const qi of cr){qi.trim();const ho=qi.getMaxScale(),Io={positionedGlyphs:[],lineOffset:0};Tt.positionedLines[Gl]=Io;const Po=Io.positionedGlyphs;let Ea=0;if(!qi.length()){Rr+=dr,++Gl;continue}const Wl=hxe(mr,qi,$o);for(let Xa=0;Xa<qi.length();Xa++){const qs=qi.getSection(Xa),fo=qi.getSectionIndex(Xa),po=qi.getCharCode(Xa),Rs=Axe(pr,rn,po);let Li;if(qs.imageName){if(Tt.iconsInText=!0,qs.scale=qs.scale*$o,Li=dxe(qs,Rs,ho,Wl,mr),!Li)continue;Ea=Math.max(Ea,Li.imageOffset)}else if(Li=fxe(qs,po,Rs,Wl,Rt,qt),!Li)continue;const{rect:Pu,metrics:Gg,baselineOffset:Mu}=Li;Po.push({glyph:po,imageName:qs.imageName,x:qr,y:Rr+Mu+-17,vertical:Rs,scale:qs.scale,fontStack:qs.fontStack,sectionIndex:fo,metrics:Gg,rect:Pu}),Rs?(Tt.verticalizable=!0,qr+=(qs.imageName?Gg.advance:uo)*qs.scale+Ht):qr+=Gg.advance*qs.scale+Ht}Po.length!==0&&(Mn=Math.max(qr-Ht,Mn),pxe(Po,0,Po.length-1,Ws)),qr=0,Io.lineOffset=Math.max(Ea,(ho-1)*uo);const Ao=dr*ho+Ea;Rr+=Ao,ts=Math.max(Ao,ts),++Gl}const{horizontalAlign:Ka,verticalAlign:So}=dI(kr);(function(qi,ho,Io,Po,Ea,Wl,Ao,Xa,qs){const fo=(ho-Io)*Ea;let po=0;po=Wl!==Ao?-Xa*Po- -17:-Po*qs*Ao+.5*Ao;for(const Rs of qi)for(const Li of Rs.positionedGlyphs)Li.x+=fo,Li.y+=po})(Tt.positionedLines,Ws,Ka,So,Mn,ts,dr,Rr,cr.length),Tt.top+=-So*Rr,Tt.bottom=Tt.top+Rr,Tt.left+=-Ka*Mn,Tt.right=Tt.left+Mn}(et,c,h,g,Ce,T,S,F,K,U,ee,le),!function(Tt){for(const Rt of Tt)if(Rt.positionedGlyphs.length!==0)return!1;return!0}(Ve)&&et}const xv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},lxe={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},cxe={40:!0};function kV(A,c,h,g,_,x){if(c.imageName){const T=g[c.imageName];return T?T.displaySize[0]*c.scale*uo/x+_:0}{const T=h[c.fontStack],S=T&&T[A];return S?S.metrics.advance*c.scale+_:0}}function NV(A,c,h,g){const _=Math.pow(A-c,2);return g?A<c?_/2:2*_:_+Math.abs(h)*h}function uxe(A,c,h){let g=0;return A===10&&(g-=1e4),h&&(g+=150),A!==40&&A!==65288||(g+=50),c!==41&&c!==65289||(g+=50),g}function zV(A,c,h,g,_,x){let T=null,S=NV(c,h,_,x);for(const F of g){const U=NV(c-F.x,h,_,x)+F.badness;U<=S&&(T=F,S=U)}return{index:A,x:c,priorBreak:T,badness:S}}function QV(A){return A?QV(A.priorBreak).concat(A.index):[]}function fI(A,c,h,g,_,x){if(!A)return[];const T=[],S=function(K,ee,oe,le,pe,Ce){let Ue=0;for(let At=0;At<K.length();At++){const Ve=K.getSection(At);Ue+=kV(K.getCharCode(At),Ve,le,pe,ee,Ce)}return Ue/Math.max(1,Math.ceil(Ue/oe))}(A,c,h,g,_,x),F=A.text.indexOf("​")>=0;let U=0;for(let K=0;K<A.length();K++){const ee=A.getSection(K),oe=A.getCharCode(K);if(xv[oe]||(U+=kV(oe,ee,g,_,c,x)),K<A.length()-1){const le=!((z=oe)<11904)&&(!!ut["CJK Compatibility Forms"](z)||!!ut["CJK Compatibility"](z)||!!ut["CJK Strokes"](z)||!!ut["CJK Symbols and Punctuation"](z)||!!ut["Enclosed CJK Letters and Months"](z)||!!ut["Halfwidth and Fullwidth Forms"](z)||!!ut["Ideographic Description Characters"](z)||!!ut["Vertical Forms"](z)||Fr.test(String.fromCodePoint(z)));(lxe[oe]||le||ee.imageName||K!==A.length()-2&&cxe[A.getCharCode(K+1)])&&T.push(zV(K+1,U,S,T,uxe(oe,A.getCharCode(K+1),le&&F),!1))}}var z;return QV(zV(A.length(),U,S,T,0,!0))}function dI(A){let c=.5,h=.5;switch(A){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(A){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:c,verticalAlign:h}}function hxe(A,c,h){const g=c.getMaxScale()*uo,{maxImageWidth:_,maxImageHeight:x}=c.getMaxImageSize(A),T=Math.max(g,x*h);return{verticalLineContentWidth:Math.max(g,_*h),horizontalLineContentHeight:T}}function HV(A){switch(A){case"top":return 0;case"center":return .5;default:return 1}}function Axe(A,c,h){return!(A===a.ao.horizontal||!c&&!mn(h)||c&&(xv[h]||(g=h,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(g)))));var g}function fxe(A,c,h,g,_,x){const T=x[A.fontStack],S=function(U,z,K,ee){if(U&&U.rect)return U;const oe=z[K.fontStack],le=oe&&oe[ee];return le?{rect:null,metrics:le.metrics}:null}(T&&T[c],_,A,c);if(S===null)return null;let F;if(h)F=g.verticalLineContentWidth-A.scale*uo;else{const U=HV(A.verticalAlign);F=(g.horizontalLineContentHeight-A.scale*uo)*U}return{rect:S.rect,metrics:S.metrics,baselineOffset:F}}function dxe(A,c,h,g,_){const x=_[A.imageName];if(!x)return null;const T=x.paddedRect,S=x.displaySize,F={width:S[0],height:S[1],left:1,top:-3,advance:c?S[1]:S[0]};let U;if(c)U=g.verticalLineContentWidth-S[1]*A.scale;else{const z=HV(A.verticalAlign);U=(g.horizontalLineContentHeight-S[1]*A.scale)*z}return{rect:T,metrics:F,baselineOffset:U,imageOffset:(c?S[0]:S[1])*A.scale-uo*h}}function pxe(A,c,h,g){if(g===0)return;const _=A[h],x=(A[h].x+_.metrics.advance*_.scale)*g;for(let T=c;T<=h;T++)A[T].x-=x}function gxe(A,c,h){const{horizontalAlign:g,verticalAlign:_}=dI(h),x=c[0]-A.displaySize[0]*g,T=c[1]-A.displaySize[1]*_;return{image:A,top:T,bottom:T+A.displaySize[1],left:x,right:x+A.displaySize[0]}}function VV(A){var c,h;let g=A.left,_=A.top,x=A.right-g,T=A.bottom-_;const S=(c=A.image.textFitWidth)!==null&&c!==void 0?c:"stretchOrShrink",F=(h=A.image.textFitHeight)!==null&&h!==void 0?h:"stretchOrShrink",U=(A.image.content[2]-A.image.content[0])/(A.image.content[3]-A.image.content[1]);if(F==="proportional"){if(S==="stretchOnly"&&x/T<U||S==="proportional"){const z=Math.ceil(T*U);g*=z/x,x=z}}else if(S==="proportional"&&F==="stretchOnly"&&U!==0&&x/T>U){const z=Math.ceil(x/U);_*=z/T,T=z}return{x1:g,y1:_,x2:g+x,y2:_+T}}function jV(A,c,h,g,_,x){const T=A.image;let S;if(T.content){const Ce=T.content,Ue=T.pixelRatio||1;S=[Ce[0]/Ue,Ce[1]/Ue,T.displaySize[0]-Ce[2]/Ue,T.displaySize[1]-Ce[3]/Ue]}const F=c.left*x,U=c.right*x;let z,K,ee,oe;h==="width"||h==="both"?(oe=_[0]+F-g[3],K=_[0]+U+g[1]):(oe=_[0]+(F+U-T.displaySize[0])/2,K=oe+T.displaySize[0]);const le=c.top*x,pe=c.bottom*x;return h==="height"||h==="both"?(z=_[1]+le-g[0],ee=_[1]+pe+g[2]):(z=_[1]+(le+pe-T.displaySize[1])/2,ee=z+T.displaySize[1]),{image:T,top:z,right:K,bottom:ee,left:oe,collisionPadding:S}}const xA=128,Cf=32640;function $V(A,c){const{expression:h}=c;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new cn(A+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:g,interpolationType:_}=h;let x=0;for(;x<g.length&&g[x]<=A;)x++;x=Math.max(0,x-1);let T=x;for(;T<g.length&&g[T]<A+1;)T++;T=Math.min(g.length-1,T);const S=g[x],F=g[T];return h.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:F,interpolationType:_}:{kind:"camera",minZoom:S,maxZoom:F,minSize:h.evaluate(new cn(S)),maxSize:h.evaluate(new cn(F)),interpolationType:_}}}function pI(A,c,h){let g="never";const _=A.get(c);return _?g=_:A.get(h)&&(g="always"),g}const mxe=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bv(A,c,h,g,_,x,T,S,F,U,z,K,ee){const oe=S?Math.min(Cf,Math.round(S[0])):0,le=S?Math.min(Cf,Math.round(S[1])):0;A.emplaceBack(c,h,Math.round(32*g),Math.round(32*_),x,T,(oe<<1)+(F?1:0),le,16*U,16*z,256*K,256*ee)}function gI(A,c,h){A.emplaceBack(c.x,c.y,h),A.emplaceBack(c.x,c.y,h),A.emplaceBack(c.x,c.y,h),A.emplaceBack(c.x,c.y,h)}function _xe(A){for(const c of A.sections)if(jr(c.text))return!0;return!1}class mI{constructor(c){this.layoutVertexArray=new Ct,this.indexArray=new tn,this.programConfigurations=c,this.segments=new Bn,this.dynamicLayoutVertexArray=new Zt,this.opacityVertexArray=new rr,this.hasVisibleVertices=!1,this.placedSymbolArray=new J}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,h,g,_){this.isEmpty()||(g&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,$2e.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,G2e.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,mxe,!0),this.opacityVertexBuffer.itemSize=1),(g||_)&&this.programConfigurations.upload(c))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}be("SymbolBuffers",mI);class _I{constructor(c,h,g){this.layoutVertexArray=new c,this.layoutAttributes=h,this.indexArray=new g,this.segments=new Bn,this.collisionVertexArray=new Tr}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,W2e.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}be("CollisionBuffers",_I);class Vg{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=Er(globalThis)?Math.min(c.overscaling,128):c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(T=>T.id),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=$V(this.zoom,h["text-size"]),this.iconSizeData=$V(this.zoom,h["icon-size"]);const g=this.layers[0].layout,_=g.get("symbol-sort-key"),x=g.get("symbol-z-order");this.canOverlap=pI(g,"text-overlap","text-allow-overlap")!=="never"||pI(g,"icon-overlap","icon-allow-overlap")!=="never"||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!_.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map(T=>a.ao[T])),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=c.sourceID}createArrays(){this.text=new mI(new Sh(this.layers,this.zoom,c=>/^text/.test(c))),this.icon=new mI(new Sh(this.layers,this.zoom,c=>/^icon/.test(c))),this.glyphOffsetArray=new de,this.lineVertexArray=new Ee,this.symbolInstances=new ne,this.textAnchorOffsets=new Ie}calculateGlyphDependencies(c,h,g,_,x){for(let T=0;T<c.length;T++)if(h[c.charCodeAt(T)]=!0,(g||_)&&x){const S=hy[c.charAt(T)];S&&(h[S.charCodeAt(0)]=!0)}}populate(c,h,g){const _=this.layers[0],x=_.layout,T=x.get("text-font"),S=x.get("text-field"),F=x.get("icon-image"),U=(S.value.kind!=="constant"||S.value.value instanceof Qr&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),z=F.value.kind!=="constant"||!!F.value.value||Object.keys(F.parameters).length>0,K=x.get("symbol-sort-key");if(this.features=[],!U&&!z)return;const ee=h.iconDependencies,oe=h.glyphDependencies,le=h.availableImages,pe=new cn(this.zoom);for(const{feature:Ce,id:Ue,index:At,sourceLayerIndex:Ve}of c){const et=_._featureFilter.needGeometry,Tt=Xd(Ce,et);if(!_._featureFilter.filter(pe,Tt,g))continue;let Rt,qt;if(et||(Tt.geometry=Iu(Ce)),U){const cr=_.getValueAndResolveTokens("text-field",Tt,g,le),dr=Qr.factory(cr),kr=this.hasRTLText=this.hasRTLText||_xe(dr);(!kr||_r.getRTLTextPluginStatus()==="unavailable"||kr&&_r.isParsed())&&(Rt=K2e(dr,_,Tt))}if(z){const cr=_.getValueAndResolveTokens("icon-image",Tt,g,le);qt=cr instanceof As?cr:As.fromString(cr)}if(!Rt&&!qt)continue;const mr=this.sortFeaturesByKey?K.evaluate(Tt,{},g):void 0;if(this.features.push({id:Ue,text:Rt,icon:qt,index:At,sourceLayerIndex:Ve,geometry:Tt.geometry,properties:Ce.properties,type:zg.types[Ce.type],sortKey:mr}),qt&&(ee[qt.name]=!0),Rt){const cr=T.evaluate(Tt,{},g).join(","),dr=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ao.vertical)>=0;for(const kr of Rt.sections)if(kr.image)ee[kr.image.name]=!0;else{const fr=zt(Rt.toString()),pr=kr.fontStack||cr,Ht=oe[pr]=oe[pr]||{};this.calculateGlyphDependencies(kr.text,Ht,dr,this.allowVerticalPlacement,fr)}}}x.get("symbol-placement")==="line"&&(this.features=function(Ce){const Ue={},At={},Ve=[];let et=0;function Tt(cr){Ve.push(Ce[cr]),et++}function Rt(cr,dr,kr){const fr=At[cr];return delete At[cr],At[dr]=fr,Ve[fr].geometry[0].pop(),Ve[fr].geometry[0]=Ve[fr].geometry[0].concat(kr[0]),fr}function qt(cr,dr,kr){const fr=Ue[dr];return delete Ue[dr],Ue[cr]=fr,Ve[fr].geometry[0].shift(),Ve[fr].geometry[0]=kr[0].concat(Ve[fr].geometry[0]),fr}function mr(cr,dr,kr){const fr=kr?dr[0][dr[0].length-1]:dr[0][0];return`${cr}:${fr.x}:${fr.y}`}for(let cr=0;cr<Ce.length;cr++){const dr=Ce[cr],kr=dr.geometry,fr=dr.text?dr.text.toString():null;if(!fr){Tt(cr);continue}const pr=mr(fr,kr),Ht=mr(fr,kr,!0);if(pr in At&&Ht in Ue&&At[pr]!==Ue[Ht]){const rn=qt(pr,Ht,kr),un=Rt(pr,Ht,Ve[rn].geometry);delete Ue[pr],delete At[Ht],At[mr(fr,Ve[un].geometry,!0)]=un,Ve[rn].geometry=null}else pr in At?Rt(pr,Ht,kr):Ht in Ue?qt(pr,Ht,kr):(Tt(cr),Ue[pr]=et-1,At[Ht]=et-1)}return Ve.filter(cr=>cr.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,Ue)=>Ce.sortKey-Ue.sortKey)}update(c,h,g){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,h,this.layers,{imagePositions:g}),this.icon.programConfigurations.updatePaintArrays(c,h,this.layers,{imagePositions:g}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,h){const g=this.lineVertexArray.length;if(c.segment!==void 0){let _=c.dist(h[c.segment+1]),x=c.dist(h[c.segment]);const T={};for(let S=c.segment+1;S<h.length;S++)T[S]={x:h[S].x,y:h[S].y,tileUnitDistanceFromAnchor:_},S<h.length-1&&(_+=h[S+1].dist(h[S]));for(let S=c.segment||0;S>=0;S--)T[S]={x:h[S].x,y:h[S].y,tileUnitDistanceFromAnchor:x},S>0&&(x+=h[S-1].dist(h[S]));for(let S=0;S<h.length;S++){const F=T[S];this.lineVertexArray.emplaceBack(F.x,F.y,F.tileUnitDistanceFromAnchor)}}return{lineStartIndex:g,lineLength:this.lineVertexArray.length-g}}addSymbols(c,h,g,_,x,T,S,F,U,z,K,ee){const oe=c.indexArray,le=c.layoutVertexArray,pe=c.segments.prepareSegment(4*h.length,le,oe,this.canOverlap?T.sortKey:void 0),Ce=this.glyphOffsetArray.length,Ue=pe.vertexLength,At=this.allowVerticalPlacement&&S===a.ao.vertical?Math.PI/2:0,Ve=T.text&&T.text.sections;for(let et=0;et<h.length;et++){const{tl:Tt,tr:Rt,bl:qt,br:mr,tex:cr,pixelOffsetTL:dr,pixelOffsetBR:kr,minFontScaleX:fr,minFontScaleY:pr,glyphOffset:Ht,isSDF:rn,sectionIndex:un}=h[et],qr=pe.vertexLength,Rr=Ht[1];Bv(le,F.x,F.y,Tt.x,Rr+Tt.y,cr.x,cr.y,g,rn,dr.x,dr.y,fr,pr),Bv(le,F.x,F.y,Rt.x,Rr+Rt.y,cr.x+cr.w,cr.y,g,rn,kr.x,dr.y,fr,pr),Bv(le,F.x,F.y,qt.x,Rr+qt.y,cr.x,cr.y+cr.h,g,rn,dr.x,kr.y,fr,pr),Bv(le,F.x,F.y,mr.x,Rr+mr.y,cr.x+cr.w,cr.y+cr.h,g,rn,kr.x,kr.y,fr,pr),gI(c.dynamicLayoutVertexArray,F,At),oe.emplaceBack(qr,qr+2,qr+1),oe.emplaceBack(qr+1,qr+2,qr+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ht[0]),et!==h.length-1&&un===h[et+1].sectionIndex||c.programConfigurations.populatePaintArrays(le.length,T,T.index,{imagePositions:{},canonical:ee,formattedSection:Ve&&Ve[un]})}c.placedSymbolArray.emplaceBack(F.x,F.y,Ce,this.glyphOffsetArray.length-Ce,Ue,U,z,F.segment,g?g[0]:0,g?g[1]:0,_[0],_[1],S,0,!1,0,K)}_addCollisionDebugVertex(c,h,g,_,x,T){return h.emplaceBack(0,0),c.emplaceBack(g.x,g.y,_,x,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(c,h,g,_,x,T,S){const F=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),U=F.vertexLength,z=x.layoutVertexArray,K=x.collisionVertexArray,ee=S.anchorX,oe=S.anchorY;this._addCollisionDebugVertex(z,K,T,ee,oe,new u(c,h)),this._addCollisionDebugVertex(z,K,T,ee,oe,new u(g,h)),this._addCollisionDebugVertex(z,K,T,ee,oe,new u(g,_)),this._addCollisionDebugVertex(z,K,T,ee,oe,new u(c,_)),F.vertexLength+=4;const le=x.indexArray;le.emplaceBack(U,U+1),le.emplaceBack(U+1,U+2),le.emplaceBack(U+2,U+3),le.emplaceBack(U+3,U),F.primitiveLength+=4}addDebugCollisionBoxes(c,h,g,_){for(let x=c;x<h;x++){const T=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,_?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,g)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new _I($t,FV.members,Dn),this.iconCollisionBox=new _I($t,FV.members,Dn);for(let c=0;c<this.symbolInstances.length;c++){const h=this.symbolInstances.get(c);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(c,h,g,_,x,T,S,F,U){const z={};for(let K=h;K<g;K++){const ee=c.get(K);z.textBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},z.textFeatureIndex=ee.featureIndex;break}for(let K=_;K<x;K++){const ee=c.get(K);z.verticalTextBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},z.verticalTextFeatureIndex=ee.featureIndex;break}for(let K=T;K<S;K++){const ee=c.get(K);z.iconBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},z.iconFeatureIndex=ee.featureIndex;break}for(let K=F;K<U;K++){const ee=c.get(K);z.verticalIconBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},z.verticalIconFeatureIndex=ee.featureIndex;break}return z}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const g=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,g.textBoxStartIndex,g.textBoxEndIndex,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(c,h){const g=c.placedSymbolArray.get(h),_=g.vertexStartIndex+4*g.numGlyphs;for(let x=g.vertexStartIndex;x<_;x+=4)c.indexArray.emplaceBack(x,x+2,x+1),c.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(c),g=Math.cos(c),_=[],x=[],T=[];for(let S=0;S<this.symbolInstances.length;++S){T.push(S);const F=this.symbolInstances.get(S);_.push(0|Math.round(h*F.anchorX+g*F.anchorY)),x.push(F.featureIndex)}return T.sort((S,F)=>_[S]-_[F]||x[F]-x[S]),T}addToSortKeyRanges(c,h){const g=this.sortKeyRanges[this.sortKeyRanges.length-1];g&&g.sortKey===h?g.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const g=this.symbolInstances.get(h);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach((_,x,T)=>{_>=0&&T.indexOf(_)===x&&this.addIndicesForPlacedSymbol(this.text,_)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let GV,WV;be("SymbolBucket",Vg,{omit:["layers","collisionBoxArray","features","compareText"]}),Vg.MAX_GLYPHS=65535,Vg.addDynamicAttributes=gI;var yI={get paint(){return WV=WV||new Ci({"icon-opacity":new br(Ze.paint_symbol["icon-opacity"]),"icon-color":new br(Ze.paint_symbol["icon-color"]),"icon-halo-color":new br(Ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new br(Ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new br(Ze.paint_symbol["icon-halo-blur"]),"icon-translate":new or(Ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new or(Ze.paint_symbol["icon-translate-anchor"]),"text-opacity":new br(Ze.paint_symbol["text-opacity"]),"text-color":new br(Ze.paint_symbol["text-color"],{runtimeType:yi,getOverride:A=>A.textColor,hasOverride:A=>!!A.textColor}),"text-halo-color":new br(Ze.paint_symbol["text-halo-color"]),"text-halo-width":new br(Ze.paint_symbol["text-halo-width"]),"text-halo-blur":new br(Ze.paint_symbol["text-halo-blur"]),"text-translate":new or(Ze.paint_symbol["text-translate"]),"text-translate-anchor":new or(Ze.paint_symbol["text-translate-anchor"])})},get layout(){return GV=GV||new Ci({"symbol-placement":new or(Ze.layout_symbol["symbol-placement"]),"symbol-spacing":new or(Ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new or(Ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new br(Ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new or(Ze.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new or(Ze.layout_symbol["icon-allow-overlap"]),"icon-overlap":new or(Ze.layout_symbol["icon-overlap"]),"icon-ignore-placement":new or(Ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new or(Ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new or(Ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new br(Ze.layout_symbol["icon-size"]),"icon-text-fit":new or(Ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new or(Ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new br(Ze.layout_symbol["icon-image"]),"icon-rotate":new br(Ze.layout_symbol["icon-rotate"]),"icon-padding":new br(Ze.layout_symbol["icon-padding"]),"icon-keep-upright":new or(Ze.layout_symbol["icon-keep-upright"]),"icon-offset":new br(Ze.layout_symbol["icon-offset"]),"icon-anchor":new br(Ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new or(Ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new or(Ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new or(Ze.layout_symbol["text-rotation-alignment"]),"text-field":new br(Ze.layout_symbol["text-field"]),"text-font":new br(Ze.layout_symbol["text-font"]),"text-size":new br(Ze.layout_symbol["text-size"]),"text-max-width":new br(Ze.layout_symbol["text-max-width"]),"text-line-height":new or(Ze.layout_symbol["text-line-height"]),"text-letter-spacing":new br(Ze.layout_symbol["text-letter-spacing"]),"text-justify":new br(Ze.layout_symbol["text-justify"]),"text-radial-offset":new br(Ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new or(Ze.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new br(Ze.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new br(Ze.layout_symbol["text-anchor"]),"text-max-angle":new or(Ze.layout_symbol["text-max-angle"]),"text-writing-mode":new or(Ze.layout_symbol["text-writing-mode"]),"text-rotate":new br(Ze.layout_symbol["text-rotate"]),"text-padding":new or(Ze.layout_symbol["text-padding"]),"text-keep-upright":new or(Ze.layout_symbol["text-keep-upright"]),"text-transform":new br(Ze.layout_symbol["text-transform"]),"text-offset":new br(Ze.layout_symbol["text-offset"]),"text-allow-overlap":new or(Ze.layout_symbol["text-allow-overlap"]),"text-overlap":new or(Ze.layout_symbol["text-overlap"]),"text-ignore-placement":new or(Ze.layout_symbol["text-ignore-placement"]),"text-optional":new or(Ze.layout_symbol["text-optional"])})}};class qV{constructor(c){if(c.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=c.property.overrides?c.property.overrides.runtimeType:Un,this.defaultValue=c}evaluate(c){if(c.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(c.formattedSection))return h.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}be("FormatSectionOverride",qV,{omit:["defaultValue"]});class Cv extends Ri{constructor(c,h){super(c,yI,h)}recalculate(c,h){if(super.recalculate(c,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const g=this.layout.get("text-writing-mode");if(g){const _=[];for(const x of g)_.indexOf(x)<0&&_.push(x);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(c,h,g,_){const x=this.layout.get(c).evaluate(h,{},g,_),T=this._unevaluatedLayout._values[c];return T.isDataDriven()||vu(T.value)||!x?x:function(S,F){return F.replace(/{([^{}]+)}/g,(U,z)=>S&&z in S?String(S[z]):"")}(h.properties,x)}createBucket(c){return new Vg(c)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const c of yI.paint.overridableProperties){if(!Cv.hasPaintOverride(this.layout,c))continue;const h=this.paint.get(c),g=new qV(h),_=new fh(g,h.property.specification);let x=null;x=h.value.kind==="constant"||h.value.kind==="source"?new df("source",_):new zd("composite",_,h.value.zoomStops),this.paint._values[c]=new Mi(h.property,x,h.parameters)}}_handleOverridablePaintPropertyUpdate(c,h,g){return!(!this.layout||h.isDataDriven()||g.isDataDriven())&&Cv.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,h){const g=c.get("text-field"),_=yI.paint.properties[h];let x=!1;const T=S=>{for(const F of S)if(_.overrides&&_.overrides.hasOverride(F))return void(x=!0)};if(g.value.kind==="constant"&&g.value.value instanceof Qr)T(g.value.value.sections);else if(g.value.kind==="source"||g.value.kind==="composite"){const S=U=>{x||(U instanceof ko&&Kn(U.value)===xn?T(U.value.sections):U instanceof mc?T(U.sections):U.eachChild(S))},F=g.value;F._styleExpression&&S(F._styleExpression.expression)}return x}}let KV;var yxe={get paint(){return KV=KV||new Ci({"background-color":new or(Ze.paint_background["background-color"]),"background-pattern":new jn(Ze.paint_background["background-pattern"]),"background-opacity":new or(Ze.paint_background["background-opacity"])})}};class bxe extends Ri{constructor(c,h){super(c,yxe,h)}}class vxe extends Ri{constructor(c,h){super(c,{},h),this.onAdd=g=>{this.implementation.onAdd&&this.implementation.onAdd(g,g.painter.context.gl)},this.onRemove=g=>{this.implementation.onRemove&&this.implementation.onRemove(g,g.painter.context.gl)},this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class wxe{constructor(c){this._methodToThrottle=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const xxe={once:!0},bI=63710088e-1;class Tf{constructor(c,h){if(isNaN(c)||isNaN(h))throw new Error(`Invalid LngLat object: (${c}, ${h})`);if(this.lng=+c,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Tf(it(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){const h=Math.PI/180,g=this.lat*h,_=c.lat*h,x=Math.sin(g)*Math.sin(_)+Math.cos(g)*Math.cos(_)*Math.cos((c.lng-this.lng)*h);return bI*Math.acos(Math.min(x,1))}static convert(c){if(c instanceof Tf)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new Tf(Number(c[0]),Number(c[1]));if(!Array.isArray(c)&&typeof c=="object"&&c!==null)return new Tf(Number("lng"in c?c.lng:c.lon),Number(c.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const XV=2*Math.PI*bI;function YV(A){return XV*Math.cos(A*Math.PI/180)}function ZV(A){return(180+A)/360}function JV(A){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+A*Math.PI/360)))/360}function e9(A,c){return A/YV(c)}function vI(A){return 360/Math.PI*Math.atan(Math.exp((180-360*A)*Math.PI/180))-90}function t9(A,c){return A*YV(vI(c))}class fy{constructor(c,h,g=0){this.x=+c,this.y=+h,this.z=+g}static fromLngLat(c,h=0){const g=Tf.convert(c);return new fy(ZV(g.lng),JV(g.lat),e9(h,g.lat))}toLngLat(){return new Tf(360*this.x-180,vI(this.y))}toAltitude(){return t9(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/XV*(c=vI(this.y),1/Math.cos(c*Math.PI/180));var c}}function r9(A,c,h){var g=2*Math.PI*6378137/256/Math.pow(2,h);return[A*g-2*Math.PI*6378137/2,c*g-2*Math.PI*6378137/2]}class wI{constructor(c,h,g){if(!function(_,x,T){return!(_<0||_>25||T<0||T>=Math.pow(2,_)||x<0||x>=Math.pow(2,_))}(c,h,g))throw new Error(`x=${h}, y=${g}, z=${c} outside of bounds. 0<=x<${Math.pow(2,c)}, 0<=y<${Math.pow(2,c)} 0<=z<=25 `);this.z=c,this.x=h,this.y=g,this.key=jg(0,c,c,h,g)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,h,g){const _=(T=this.y,S=this.z,F=r9(256*(x=this.x),256*(T=Math.pow(2,S)-T-1),S),U=r9(256*(x+1),256*(T+1),S),F[0]+","+F[1]+","+U[0]+","+U[1]);var x,T,S,F,U;const z=function(K,ee,oe){let le,pe="";for(let Ce=K;Ce>0;Ce--)le=1<<Ce-1,pe+=(ee&le?1:0)+(oe&le?2:0);return pe}(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(g==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,_)}isChildOf(c){const h=this.z-c.z;return h>0&&c.x===this.x>>h&&c.y===this.y>>h}getTilePoint(c){const h=Math.pow(2,this.z);return new u((c.x*h-this.x)*Xe,(c.y*h-this.y)*Xe)}toString(){return`${this.z}/${this.x}/${this.y}`}}class n9{constructor(c,h){this.wrap=c,this.canonical=h,this.key=jg(c,h.z,h.z,h.x,h.y)}}class $l{constructor(c,h,g,_,x){if(this.terrainRttPosMatrix32f=null,c<g)throw new Error(`overscaledZ should be >= z; overscaledZ = ${c}; z = ${g}`);this.overscaledZ=c,this.wrap=h,this.canonical=new wI(g,+_,+x),this.key=jg(h,c,g,_,x)}clone(){return new $l(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-c;return c>this.canonical.z?new $l(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new $l(c,this.wrap,c,this.canonical.x>>h,this.canonical.y>>h)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(c,h){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const g=this.canonical.z-c;return c>this.canonical.z?jg(this.wrap*+h,c,this.canonical.z,this.canonical.x,this.canonical.y):jg(this.wrap*+h,c,c,this.canonical.x>>g,this.canonical.y>>g)}isChildOf(c){if(c.wrap!==this.wrap||this.overscaledZ-c.overscaledZ<=0)return!1;if(c.overscaledZ===0)return this.overscaledZ>0;const h=this.canonical.z-c.canonical.z;return!(h<0)&&c.canonical.x===this.canonical.x>>h&&c.canonical.y===this.canonical.y>>h}children(c){if(this.overscaledZ>=c)return[new $l(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,g=2*this.canonical.x,_=2*this.canonical.y;return[new $l(h,this.wrap,h,g,_),new $l(h,this.wrap,h,g+1,_),new $l(h,this.wrap,h,g,_+1),new $l(h,this.wrap,h,g+1,_+1)]}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new $l(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new $l(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new n9(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(c){return this.canonical.getTilePoint(new fy(c.x-this.wrap,c.y))}}function jg(A,c,h,g,_){(A*=2)<0&&(A=-1*A-1);const x=1<<h;return(x*x*A+x*_+g).toString(36)+h.toString(36)+c.toString(36)}function dy(A,c){return c?A.properties[c]:A.id}be("CanonicalTileID",wI),be("OverscaledTileID",$l,{omit:["terrainRttPosMatrix32f"]});class Jd{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(c){return this.minX=Math.min(this.minX,c.x),this.minY=Math.min(this.minY,c.y),this.maxX=Math.max(this.maxX,c.x),this.maxY=Math.max(this.maxY,c.y),this}expandBy(c){return this.minX-=c,this.minY-=c,this.maxX+=c,this.maxY+=c,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(c){return this.expandBy(-c)}map(c){const h=new Jd;return h.extend(c(new u(this.minX,this.minY))),h.extend(c(new u(this.maxX,this.minY))),h.extend(c(new u(this.minX,this.maxY))),h.extend(c(new u(this.maxX,this.maxY))),h}static fromPoints(c){const h=new Jd;for(const g of c)h.extend(g);return h}contains(c){return c.x>=this.minX&&c.x<=this.maxX&&c.y>=this.minY&&c.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(c){return!this.empty()&&!c.empty()&&c.minX>=this.minX&&c.maxX<=this.maxX&&c.minY>=this.minY&&c.maxY<=this.maxY}intersects(c){return!this.empty()&&!c.empty()&&c.minX<=this.maxX&&c.maxX>=this.minX&&c.minY<=this.maxY&&c.maxY>=this.minY}}class i9{constructor(c){this._stringToNumber={},this._numberToString=[];for(let h=0;h<c.length;h++){const g=c[h];this._stringToNumber[g]=h,this._numberToString[h]=g}}encode(c){return this._stringToNumber[c]}decode(c){if(c>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${c} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[c]}}class s9{constructor(c,h,g,_,x){this.type="Feature",this._vectorTileFeature=c,c._z=h,c._x=g,c._y=_,this.properties=c.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){const c={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(c[h]=this[h]);return c}}class o9{constructor(c,h){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new we(Xe,16,0),this.grid3D=new we(Xe,16,0),this.featureIndexArray=new je,this.promoteId=h}insert(c,h,g,_,x,T){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(g,_,x);const F=T?this.grid3D:this.grid;for(let U=0;U<h.length;U++){const z=h[U],K=[1/0,1/0,-1/0,-1/0];for(let ee=0;ee<z.length;ee++){const oe=z[ee];K[0]=Math.min(K[0],oe.x),K[1]=Math.min(K[1],oe.y),K[2]=Math.max(K[2],oe.x),K[3]=Math.max(K[3],oe.y)}K[0]<Xe&&K[1]<Xe&&K[2]>=0&&K[3]>=0&&F.insert(S,K[0],K[1],K[2],K[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new xV(new hI(this.rawTileData)).layers,this.sourceLayerCoder=new i9(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(c,h,g,_){this.loadVTLayers();const x=c.params,T=Xe/c.tileSize/c.scale,S=Sc(x.filter,x.globalState),F=c.queryGeometry,U=c.queryPadding*T,z=Jd.fromPoints(F),K=this.grid.query(z.minX-U,z.minY-U,z.maxX+U,z.maxY+U),ee=Jd.fromPoints(c.cameraQueryGeometry).expandBy(U),oe=this.grid3D.query(ee.minX,ee.minY,ee.maxX,ee.maxY,(Ce,Ue,At,Ve)=>function(et,Tt,Rt,qt,mr){for(const dr of et)if(Tt<=dr.x&&Rt<=dr.y&&qt>=dr.x&&mr>=dr.y)return!0;const cr=[new u(Tt,Rt),new u(Tt,mr),new u(qt,mr),new u(qt,Rt)];if(et.length>2){for(const dr of cr)if(Og(et,dr))return!0}for(let dr=0;dr<et.length-1;dr++)if(Jwe(et[dr],et[dr+1],cr))return!0;return!1}(c.cameraQueryGeometry,Ce-U,Ue-U,At+U,Ve+U));for(const Ce of oe)K.push(Ce);K.sort(Bxe);const le={};let pe;for(let Ce=0;Ce<K.length;Ce++){const Ue=K[Ce];if(Ue===pe)continue;pe=Ue;const At=this.featureIndexArray.get(Ue);let Ve=null;this.loadMatchingFeature(le,At.bucketIndex,At.sourceLayerIndex,At.featureIndex,S,x.layers,x.availableImages,h,g,_,(et,Tt,Rt)=>(Ve||(Ve=Iu(et)),Tt.queryIntersectsFeature({queryGeometry:F,feature:et,featureState:Rt,geometry:Ve,zoom:this.z,transform:c.transform,pixelsToTileUnits:T,pixelPosMatrix:c.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:c.getElevation})))}return le}loadMatchingFeature(c,h,g,_,x,T,S,F,U,z,K){const ee=this.bucketLayerIDs[h];if(T&&!ee.some(Ce=>T.has(Ce)))return;const oe=this.sourceLayerCoder.decode(g),le=this.vtLayers[oe].feature(_);if(x.needGeometry){const Ce=Xd(le,!0);if(!x.filter(new cn(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!x.filter(new cn(this.tileID.overscaledZ),le))return;const pe=this.getId(le,oe);for(let Ce=0;Ce<ee.length;Ce++){const Ue=ee[Ce];if(T&&!T.has(Ue))continue;const At=F[Ue];if(!At)continue;let Ve={};pe&&z&&(Ve=z.getState(At.sourceLayer||"_geojsonTileLayer",pe));const et=Pt({},U[Ue]);et.paint=a9(et.paint,At.paint,le,Ve,S),et.layout=a9(et.layout,At.layout,le,Ve,S);const Tt=!K||K(le,At,Ve);if(!Tt)continue;const Rt=new s9(le,this.z,this.x,this.y,pe);Rt.layer=et;let qt=c[Ue];qt===void 0&&(qt=c[Ue]=[]),qt.push({featureIndex:_,feature:Rt,intersectionZ:Tt})}}lookupSymbolFeatures(c,h,g,_,x,T,S,F){const U={};this.loadVTLayers();const z=Sc(x.filterSpec,x.globalState);for(const K of c)this.loadMatchingFeature(U,g,_,K,z,T,S,F,h);return U}hasLayer(c){for(const h of this.bucketLayerIDs)for(const g of h)if(c===g)return!0;return!1}getId(c,h){var g;let _=c.id;return this.promoteId&&(_=c.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof _=="boolean"&&(_=Number(_)),_===void 0&&(!((g=c.properties)===null||g===void 0)&&g.cluster)&&this.promoteId&&(_=Number(c.properties.cluster_id))),_}}function a9(A,c,h,g,_){return Dt(A,(x,T)=>{const S=c instanceof Fi?c.get(T):null;return S&&S.evaluate?S.evaluate(h,g,_):S})}function Bxe(A,c){return c-A}function l9(A,c,h,g,_){const x=[];for(let T=0;T<A.length;T++){const S=A[T];let F;for(let U=0;U<S.length-1;U++){let z=S[U],K=S[U+1];z.x<c&&K.x<c||(z.x<c?z=new u(c,z.y+(c-z.x)/(K.x-z.x)*(K.y-z.y))._round():K.x<c&&(K=new u(c,z.y+(c-z.x)/(K.x-z.x)*(K.y-z.y))._round()),z.y<h&&K.y<h||(z.y<h?z=new u(z.x+(h-z.y)/(K.y-z.y)*(K.x-z.x),h)._round():K.y<h&&(K=new u(z.x+(h-z.y)/(K.y-z.y)*(K.x-z.x),h)._round()),z.x>=g&&K.x>=g||(z.x>=g?z=new u(g,z.y+(g-z.x)/(K.x-z.x)*(K.y-z.y))._round():K.x>=g&&(K=new u(g,z.y+(g-z.x)/(K.x-z.x)*(K.y-z.y))._round()),z.y>=_&&K.y>=_||(z.y>=_?z=new u(z.x+(_-z.y)/(K.y-z.y)*(K.x-z.x),_)._round():K.y>=_&&(K=new u(z.x+(_-z.y)/(K.y-z.y)*(K.x-z.x),_)._round()),F&&z.equals(F[F.length-1])||(F=[z],x.push(F)),F.push(K)))))}}return x}be("FeatureIndex",o9,{omit:["rawTileData","sourceLayerCoder"]});class Ef extends u{constructor(c,h,g,_){super(c,h),this.angle=g,_!==void 0&&(this.segment=_)}clone(){return new Ef(this.x,this.y,this.angle,this.segment)}}function c9(A,c,h,g,_){if(c.segment===void 0||h===0)return!0;let x=c,T=c.segment+1,S=0;for(;S>-h/2;){if(T--,T<0)return!1;S-=A[T].dist(x),x=A[T]}S+=A[T].dist(A[T+1]),T++;const F=[];let U=0;for(;S<h/2;){const z=A[T],K=A[T+1];if(!K)return!1;let ee=A[T-1].angleTo(z)-z.angleTo(K);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),F.push({distance:S,angleDelta:ee}),U+=ee;S-F[0].distance>g;)U-=F.shift().angleDelta;if(U>_)return!1;T++,S+=z.dist(K)}return!0}function u9(A){let c=0;for(let h=0;h<A.length-1;h++)c+=A[h].dist(A[h+1]);return c}function h9(A,c,h){return A?.6*c*h:0}function A9(A,c){return Math.max(A?A.right-A.left:0,c?c.right-c.left:0)}function Cxe(A,c,h,g,_,x){const T=h9(h,_,x),S=A9(h,g)*x;let F=0;const U=u9(A)/2;for(let z=0;z<A.length-1;z++){const K=A[z],ee=A[z+1],oe=K.dist(ee);if(F+oe>U){const le=(U-F)/oe,pe=dn.number(K.x,ee.x,le),Ce=dn.number(K.y,ee.y,le),Ue=new Ef(pe,Ce,ee.angleTo(K),z);return Ue._round(),!T||c9(A,Ue,S,T,c)?Ue:void 0}F+=oe}}function Txe(A,c,h,g,_,x,T,S,F){const U=h9(g,x,T),z=A9(g,_),K=z*T,ee=A[0].x===0||A[0].x===F||A[0].y===0||A[0].y===F;return c-K<c/4&&(c=K+c/4),f9(A,ee?c/2*S%c:(z/2+2*x)*T*S%c,c,U,h,K,ee,!1,F)}function f9(A,c,h,g,_,x,T,S,F){const U=x/2,z=u9(A);let K=0,ee=c-h,oe=[];for(let le=0;le<A.length-1;le++){const pe=A[le],Ce=A[le+1],Ue=pe.dist(Ce),At=Ce.angleTo(pe);for(;ee+h<K+Ue;){ee+=h;const Ve=(ee-K)/Ue,et=dn.number(pe.x,Ce.x,Ve),Tt=dn.number(pe.y,Ce.y,Ve);if(et>=0&&et<F&&Tt>=0&&Tt<F&&ee-U>=0&&ee+U<=z){const Rt=new Ef(et,Tt,At,le);Rt._round(),g&&!c9(A,Rt,x,g,_)||oe.push(Rt)}}K+=Ue}return S||oe.length||T||(oe=f9(A,K/2,h,g,_,x,T,!0,F)),oe}function d9(A,c,h,g){const _=[],x=A.image,T=x.pixelRatio,S=x.paddedRect.w-2,F=x.paddedRect.h-2;let U={x1:A.left,y1:A.top,x2:A.right,y2:A.bottom};const z=x.stretchX||[[0,S]],K=x.stretchY||[[0,F]],ee=(Ht,rn)=>Ht+rn[1]-rn[0],oe=z.reduce(ee,0),le=K.reduce(ee,0),pe=S-oe,Ce=F-le;let Ue=0,At=oe,Ve=0,et=le,Tt=0,Rt=pe,qt=0,mr=Ce;if(x.content&&g){const Ht=x.content,rn=Ht[2]-Ht[0],un=Ht[3]-Ht[1];(x.textFitWidth||x.textFitHeight)&&(U=VV(A)),Ue=Tv(z,0,Ht[0]),Ve=Tv(K,0,Ht[1]),At=Tv(z,Ht[0],Ht[2]),et=Tv(K,Ht[1],Ht[3]),Tt=Ht[0]-Ue,qt=Ht[1]-Ve,Rt=rn-At,mr=un-et}const cr=U.x1,dr=U.y1,kr=U.x2-cr,fr=U.y2-dr,pr=(Ht,rn,un,qr)=>{const Rr=Ev(Ht.stretch-Ue,At,kr,cr),Mn=Sv(Ht.fixed-Tt,Rt,Ht.stretch,oe),ts=Ev(rn.stretch-Ve,et,fr,dr),Ws=Sv(rn.fixed-qt,mr,rn.stretch,le),$o=Ev(un.stretch-Ue,At,kr,cr),Gl=Sv(un.fixed-Tt,Rt,un.stretch,oe),Ka=Ev(qr.stretch-Ve,et,fr,dr),So=Sv(qr.fixed-qt,mr,qr.stretch,le),qi=new u(Rr,ts),ho=new u($o,ts),Io=new u($o,Ka),Po=new u(Rr,Ka),Ea=new u(Mn/T,Ws/T),Wl=new u(Gl/T,So/T),Ao=c*Math.PI/180;if(Ao){const fo=Math.sin(Ao),po=Math.cos(Ao),Rs=[po,-fo,fo,po];qi._matMult(Rs),ho._matMult(Rs),Po._matMult(Rs),Io._matMult(Rs)}const Xa=Ht.stretch+Ht.fixed,qs=rn.stretch+rn.fixed;return{tl:qi,tr:ho,bl:Po,br:Io,tex:{x:x.paddedRect.x+1+Xa,y:x.paddedRect.y+1+qs,w:un.stretch+un.fixed-Xa,h:qr.stretch+qr.fixed-qs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ea,pixelOffsetBR:Wl,minFontScaleX:Rt/T/kr,minFontScaleY:mr/T/fr,isSDF:h}};if(g&&(x.stretchX||x.stretchY)){const Ht=p9(z,pe,oe),rn=p9(K,Ce,le);for(let un=0;un<Ht.length-1;un++){const qr=Ht[un],Rr=Ht[un+1];for(let Mn=0;Mn<rn.length-1;Mn++)_.push(pr(qr,rn[Mn],Rr,rn[Mn+1]))}}else _.push(pr({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:F+1}));return _}function Tv(A,c,h){let g=0;for(const _ of A)g+=Math.max(c,Math.min(h,_[1]))-Math.max(c,Math.min(h,_[0]));return g}function p9(A,c,h){const g=[{fixed:-1,stretch:0}];for(const[_,x]of A){const T=g[g.length-1];g.push({fixed:_-T.stretch,stretch:T.stretch}),g.push({fixed:_-T.stretch,stretch:T.stretch+(x-_)})}return g.push({fixed:c+1,stretch:h}),g}function Ev(A,c,h,g){return A/c*h+g}function Sv(A,c,h,g){return A-c*h/g}be("Anchor",Ef);class Iv{constructor(c,h,g,_,x,T,S,F,U,z){var K;if(this.boxStartIndex=c.length,U){let ee=T.top,oe=T.bottom;const le=T.collisionPadding;le&&(ee-=le[1],oe+=le[3]);let pe=oe-ee;pe>0&&(pe=Math.max(10,pe),this.circleDiameter=pe)}else{const ee=!((K=T.image)===null||K===void 0)&&K.content&&(T.image.textFitWidth||T.image.textFitHeight)?VV(T):{x1:T.left,y1:T.top,x2:T.right,y2:T.bottom};ee.y1=ee.y1*S-F[0],ee.y2=ee.y2*S+F[2],ee.x1=ee.x1*S-F[3],ee.x2=ee.x2*S+F[1];const oe=T.collisionPadding;if(oe&&(ee.x1-=oe[0]*S,ee.y1-=oe[1]*S,ee.x2+=oe[2]*S,ee.y2+=oe[3]*S),z){const le=new u(ee.x1,ee.y1),pe=new u(ee.x2,ee.y1),Ce=new u(ee.x1,ee.y2),Ue=new u(ee.x2,ee.y2),At=z*Math.PI/180;le._rotate(At),pe._rotate(At),Ce._rotate(At),Ue._rotate(At),ee.x1=Math.min(le.x,pe.x,Ce.x,Ue.x),ee.x2=Math.max(le.x,pe.x,Ce.x,Ue.x),ee.y1=Math.min(le.y,pe.y,Ce.y,Ue.y),ee.y2=Math.max(le.y,pe.y,Ce.y,Ue.y)}c.emplaceBack(h.x,h.y,ee.x1,ee.y1,ee.x2,ee.y2,g,_,x)}this.boxEndIndex=c.length}}class Exe{constructor(c=[],h=(g,_)=>g<_?-1:g>_?1:0){if(this.data=c,this.length=this.data.length,this.compare=h,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;const c=this.data[0],h=this.data.pop();return--this.length>0&&(this.data[0]=h,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:h,compare:g}=this,_=h[c];for(;c>0;){const x=c-1>>1,T=h[x];if(g(_,T)>=0)break;h[c]=T,c=x}h[c]=_}_down(c){const{data:h,compare:g}=this,_=this.length>>1,x=h[c];for(;c<_;){let T=1+(c<<1);const S=T+1;if(S<this.length&&g(h[S],h[T])<0&&(T=S),g(h[T],x)>=0)break;h[c]=h[T],c=T}h[c]=x}}function Sxe(A,c=1,h=!1){const g=Jd.fromPoints(A[0]),_=Math.min(g.width(),g.height());let x=_/2;const T=new Exe([],Ixe),{minX:S,minY:F,maxX:U,maxY:z}=g;if(_===0)return new u(S,F);for(let oe=S;oe<U;oe+=_)for(let le=F;le<z;le+=_)T.push(new $g(oe+x,le+x,x,A));let K=function(oe){let le=0,pe=0,Ce=0;const Ue=oe[0];for(let At=0,Ve=Ue.length,et=Ve-1;At<Ve;et=At++){const Tt=Ue[At],Rt=Ue[et],qt=Tt.x*Rt.y-Rt.x*Tt.y;pe+=(Tt.x+Rt.x)*qt,Ce+=(Tt.y+Rt.y)*qt,le+=3*qt}return new $g(pe/le,Ce/le,0,oe)}(A),ee=T.length;for(;T.length;){const oe=T.pop();(oe.d>K.d||!K.d)&&(K=oe,h&&console.log("found best %d after %d probes",Math.round(1e4*oe.d)/1e4,ee)),oe.max-K.d<=c||(x=oe.h/2,T.push(new $g(oe.p.x-x,oe.p.y-x,x,A)),T.push(new $g(oe.p.x+x,oe.p.y-x,x,A)),T.push(new $g(oe.p.x-x,oe.p.y+x,x,A)),T.push(new $g(oe.p.x+x,oe.p.y+x,x,A)),ee+=4)}return h&&(console.log(`num probes: ${ee}`),console.log(`best distance: ${K.d}`)),K.p}function Ixe(A,c){return c.max-A.max}function $g(A,c,h,g){this.p=new u(A,c),this.h=h,this.d=function(_,x){let T=!1,S=1/0;for(let F=0;F<x.length;F++){const U=x[F];for(let z=0,K=U.length,ee=K-1;z<K;ee=z++){const oe=U[z],le=U[ee];oe.y>_.y!=le.y>_.y&&_.x<(le.x-oe.x)*(_.y-oe.y)/(le.y-oe.y)+oe.x&&(T=!T),S=Math.min(S,eV(_,oe,le))}}return(T?1:-1)*Math.sqrt(S)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}var jo;a.aE=void 0,(jo=a.aE||(a.aE={}))[jo.center=1]="center",jo[jo.left=2]="left",jo[jo.right=3]="right",jo[jo.top=4]="top",jo[jo.bottom=5]="bottom",jo[jo["top-left"]=6]="top-left",jo[jo["top-right"]=7]="top-right",jo[jo["bottom-left"]=8]="bottom-left",jo[jo["bottom-right"]=9]="bottom-right";const xI=Number.POSITIVE_INFINITY;function g9(A,c){return c[1]!==xI?function(h,g,_){let x=0,T=0;switch(g=Math.abs(g),_=Math.abs(_),h){case"top-right":case"top-left":case"top":T=_-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-_}switch(h){case"top-right":case"bottom-right":case"right":x=-g;break;case"top-left":case"bottom-left":case"left":x=g}return[x,T]}(A,c[0],c[1]):function(h,g){let _=0,x=0;g<0&&(g=0);const T=g/Math.SQRT2;switch(h){case"top-right":case"top-left":x=T-7;break;case"bottom-right":case"bottom-left":x=7-T;break;case"bottom":x=7-g;break;case"top":x=g-7}switch(h){case"top-right":case"bottom-right":_=-T;break;case"top-left":case"bottom-left":_=T;break;case"left":_=g;break;case"right":_=-g}return[_,x]}(A,c[0])}function m9(A,c,h){var g;const _=A.layout,x=(g=_.get("text-variable-anchor-offset"))===null||g===void 0?void 0:g.evaluate(c,{},h);if(x){const S=x.values,F=[];for(let U=0;U<S.length;U+=2){const z=F[U]=S[U],K=S[U+1].map(ee=>ee*uo);z.startsWith("top")?K[1]-=7:z.startsWith("bottom")&&(K[1]+=7),F[U+1]=K}return new xi(F)}const T=_.get("text-variable-anchor");if(T){let S;S=A._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[_.get("text-radial-offset").evaluate(c,{},h)*uo,xI]:_.get("text-offset").evaluate(c,{},h).map(U=>U*uo);const F=[];for(const U of T)F.push(U,g9(U,S));return new xi(F)}return null}function BI(A){switch(A){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pxe(A,c,h,g,_,x,T,S,F,U,z,K){let ee=x.textMaxSize.evaluate(c,{});ee===void 0&&(ee=T);const oe=A.layers[0].layout,le=oe.get("icon-offset").evaluate(c,{},z),pe=y9(h.horizontal),Ce=T/24,Ue=A.tilePixelRatio*Ce,At=A.tilePixelRatio*ee/24,Ve=A.tilePixelRatio*S,et=A.tilePixelRatio*oe.get("symbol-spacing"),Tt=oe.get("text-padding")*A.tilePixelRatio,Rt=function(un,qr,Rr,Mn=1){const ts=un.get("icon-padding").evaluate(qr,{},Rr),Ws=ts&&ts.values;return[Ws[0]*Mn,Ws[1]*Mn,Ws[2]*Mn,Ws[3]*Mn]}(oe,c,z,A.tilePixelRatio),qt=oe.get("text-max-angle")/180*Math.PI,mr=oe.get("text-rotation-alignment")!=="viewport"&&oe.get("symbol-placement")!=="point",cr=oe.get("icon-rotation-alignment")==="map"&&oe.get("symbol-placement")!=="point",dr=oe.get("symbol-placement"),kr=et/2,fr=oe.get("icon-text-fit");let pr;g&&fr!=="none"&&(A.allowVerticalPlacement&&h.vertical&&(pr=jV(g,h.vertical,fr,oe.get("icon-text-fit-padding"),le,Ce)),pe&&(g=jV(g,pe,fr,oe.get("icon-text-fit-padding"),le,Ce)));const Ht=z?K.line.getGranularityForZoomLevel(z.z):1,rn=(un,qr)=>{qr.x<0||qr.x>=Xe||qr.y<0||qr.y>=Xe||function(Rr,Mn,ts,Ws,$o,Gl,Ka,So,qi,ho,Io,Po,Ea,Wl,Ao,Xa,qs,fo,po,Rs,Li,Pu,Gg,Mu,Rxe){const Wg=Rr.addToLineVertexArray(Mn,ts);let ep,qg,Kg,Xg,x9=0,B9=0,C9=0,T9=0,FI=-1,RI=-1;const BA={};let E9=Bh("");if(Rr.allowVerticalPlacement&&Ws.vertical){const na=So.layout.get("text-rotate").evaluate(Li,{},Mu)+90;Kg=new Iv(qi,Mn,ho,Io,Po,Ws.vertical,Ea,Wl,Ao,na),Ka&&(Xg=new Iv(qi,Mn,ho,Io,Po,Ka,qs,fo,Ao,na))}if($o){const na=So.layout.get("icon-rotate").evaluate(Li,{}),ql=So.layout.get("icon-text-fit")!=="none",tp=d9($o,na,Gg,ql),Ru=Ka?d9(Ka,na,Gg,ql):void 0;qg=new Iv(qi,Mn,ho,Io,Po,$o,qs,fo,!1,na),x9=4*tp.length;const rp=Rr.iconSizeData;let Ih=null;rp.kind==="source"?(Ih=[xA*So.layout.get("icon-size").evaluate(Li,{})],Ih[0]>Cf&&xt(`${Rr.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):rp.kind==="composite"&&(Ih=[xA*Pu.compositeIconSizes[0].evaluate(Li,{},Mu),xA*Pu.compositeIconSizes[1].evaluate(Li,{},Mu)],(Ih[0]>Cf||Ih[1]>Cf)&&xt(`${Rr.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Rr.addSymbols(Rr.icon,tp,Ih,Rs,po,Li,a.ao.none,Mn,Wg.lineStartIndex,Wg.lineLength,-1,Mu),FI=Rr.icon.placedSymbolArray.length-1,Ru&&(B9=4*Ru.length,Rr.addSymbols(Rr.icon,Ru,Ih,Rs,po,Li,a.ao.vertical,Mn,Wg.lineStartIndex,Wg.lineLength,-1,Mu),RI=Rr.icon.placedSymbolArray.length-1)}const S9=Object.keys(Ws.horizontal);for(const na of S9){const ql=Ws.horizontal[na];if(!ep){E9=Bh(ql.text);const Ru=So.layout.get("text-rotate").evaluate(Li,{},Mu);ep=new Iv(qi,Mn,ho,Io,Po,ql,Ea,Wl,Ao,Ru)}const tp=ql.positionedLines.length===1;if(C9+=_9(Rr,Mn,ql,Gl,So,Ao,Li,Xa,Wg,Ws.vertical?a.ao.horizontal:a.ao.horizontalOnly,tp?S9:[na],BA,FI,Pu,Mu),tp)break}Ws.vertical&&(T9+=_9(Rr,Mn,Ws.vertical,Gl,So,Ao,Li,Xa,Wg,a.ao.vertical,["vertical"],BA,RI,Pu,Mu));const Lxe=ep?ep.boxStartIndex:Rr.collisionBoxArray.length,Oxe=ep?ep.boxEndIndex:Rr.collisionBoxArray.length,Uxe=Kg?Kg.boxStartIndex:Rr.collisionBoxArray.length,Dxe=Kg?Kg.boxEndIndex:Rr.collisionBoxArray.length,kxe=qg?qg.boxStartIndex:Rr.collisionBoxArray.length,Nxe=qg?qg.boxEndIndex:Rr.collisionBoxArray.length,zxe=Xg?Xg.boxStartIndex:Rr.collisionBoxArray.length,Qxe=Xg?Xg.boxEndIndex:Rr.collisionBoxArray.length;let Fu=-1;const Mv=(na,ql)=>na&&na.circleDiameter?Math.max(na.circleDiameter,ql):ql;Fu=Mv(ep,Fu),Fu=Mv(Kg,Fu),Fu=Mv(qg,Fu),Fu=Mv(Xg,Fu);const I9=Fu>-1?1:0;I9&&(Fu*=Rxe/uo),Rr.glyphOffsetArray.length>=Vg.MAX_GLYPHS&&xt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Li.sortKey!==void 0&&Rr.addToSortKeyRanges(Rr.symbolInstances.length,Li.sortKey);const Hxe=m9(So,Li,Mu),[Vxe,jxe]=function(na,ql){const tp=na.length,Ru=ql?.values;if(Ru?.length>0)for(let rp=0;rp<Ru.length;rp+=2){const Ih=Ru[rp+1];na.emplaceBack(a.aE[Ru[rp]],Ih[0],Ih[1])}return[tp,na.length]}(Rr.textAnchorOffsets,Hxe);Rr.symbolInstances.emplaceBack(Mn.x,Mn.y,BA.right>=0?BA.right:-1,BA.center>=0?BA.center:-1,BA.left>=0?BA.left:-1,BA.vertical||-1,FI,RI,E9,Lxe,Oxe,Uxe,Dxe,kxe,Nxe,zxe,Qxe,ho,C9,T9,x9,B9,I9,0,Ea,Fu,Vxe,jxe)}(A,qr,un,h,g,_,pr,A.layers[0],A.collisionBoxArray,c.index,c.sourceLayerIndex,A.index,Ue,[Tt,Tt,Tt,Tt],mr,F,Ve,Rt,cr,le,c,x,U,z,T)};if(dr==="line")for(const un of l9(c.geometry,0,0,Xe,Xe)){const qr=Zd(un,Ht),Rr=Txe(qr,et,qt,h.vertical||pe,g,24,At,A.overscaling,Xe);for(const Mn of Rr)pe&&Mxe(A,pe.text,kr,Mn)||rn(qr,Mn)}else if(dr==="line-center"){for(const un of c.geometry)if(un.length>1){const qr=Zd(un,Ht),Rr=Cxe(qr,qt,h.vertical||pe,g,24,At);Rr&&rn(qr,Rr)}}else if(c.type==="Polygon")for(const un of bc(c.geometry,0)){const qr=Sxe(un,16);rn(Zd(un[0],Ht,!0),new Ef(qr.x,qr.y,0))}else if(c.type==="LineString")for(const un of c.geometry){const qr=Zd(un,Ht);rn(qr,new Ef(qr[0].x,qr[0].y,0))}else if(c.type==="Point")for(const un of c.geometry)for(const qr of un)rn([qr],new Ef(qr.x,qr.y,0))}function _9(A,c,h,g,_,x,T,S,F,U,z,K,ee,oe,le){const pe=function(At,Ve,et,Tt,Rt,qt,mr,cr){const dr=Tt.layout.get("text-rotate").evaluate(qt,{})*Math.PI/180,kr=[];for(const fr of Ve.positionedLines)for(const pr of fr.positionedGlyphs){if(!pr.rect)continue;const Ht=pr.rect||{};let rn=4,un=!0,qr=1,Rr=0;const Mn=(Rt||cr)&&pr.vertical,ts=pr.metrics.advance*pr.scale/2;if(cr&&Ve.verticalizable&&(Rr=fr.lineOffset/2-(pr.imageName?-(uo-pr.metrics.width*pr.scale)/2:(pr.scale-1)*uo)),pr.imageName){const fo=mr[pr.imageName];un=fo.sdf,qr=fo.pixelRatio,rn=1/qr}const Ws=Rt?[pr.x+ts,pr.y]:[0,0];let $o=Rt?[0,0]:[pr.x+ts+et[0],pr.y+et[1]-Rr],Gl=[0,0];Mn&&(Gl=$o,$o=[0,0]);const Ka=pr.metrics.isDoubleResolution?2:1,So=(pr.metrics.left-rn)*pr.scale-ts+$o[0],qi=(-pr.metrics.top-rn)*pr.scale+$o[1],ho=So+Ht.w/Ka*pr.scale/qr,Io=qi+Ht.h/Ka*pr.scale/qr,Po=new u(So,qi),Ea=new u(ho,qi),Wl=new u(So,Io),Ao=new u(ho,Io);if(Mn){const fo=new u(-ts,ts- -17),po=-Math.PI/2,Rs=12-ts,Li=new u(22-Rs,-(pr.imageName?Rs:0)),Pu=new u(...Gl);Po._rotateAround(po,fo)._add(Li)._add(Pu),Ea._rotateAround(po,fo)._add(Li)._add(Pu),Wl._rotateAround(po,fo)._add(Li)._add(Pu),Ao._rotateAround(po,fo)._add(Li)._add(Pu)}if(dr){const fo=Math.sin(dr),po=Math.cos(dr),Rs=[po,-fo,fo,po];Po._matMult(Rs),Ea._matMult(Rs),Wl._matMult(Rs),Ao._matMult(Rs)}const Xa=new u(0,0),qs=new u(0,0);kr.push({tl:Po,tr:Ea,bl:Wl,br:Ao,tex:Ht,writingMode:Ve.writingMode,glyphOffset:Ws,sectionIndex:pr.sectionIndex,isSDF:un,pixelOffsetTL:Xa,pixelOffsetBR:qs,minFontScaleX:0,minFontScaleY:0})}return kr}(0,h,S,_,x,T,g,A.allowVerticalPlacement),Ce=A.textSizeData;let Ue=null;Ce.kind==="source"?(Ue=[xA*_.layout.get("text-size").evaluate(T,{})],Ue[0]>Cf&&xt(`${A.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Ce.kind==="composite"&&(Ue=[xA*oe.compositeTextSizes[0].evaluate(T,{},le),xA*oe.compositeTextSizes[1].evaluate(T,{},le)],(Ue[0]>Cf||Ue[1]>Cf)&&xt(`${A.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),A.addSymbols(A.text,pe,Ue,S,x,T,U,c,F.lineStartIndex,F.lineLength,ee,le);for(const At of z)K[At]=A.text.placedSymbolArray.length-1;return 4*pe.length}function y9(A){for(const c in A)return A[c];return null}function Mxe(A,c,h,g){const _=A.compareText;if(c in _){const x=_[c];for(let T=x.length-1;T>=0;T--)if(g.dist(x[T])<h)return!0}else _[c]=[];return _[c].push(g),!1}const b9=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class CI{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,g]=new Uint8Array(c,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=g>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const x=b9[15&g];if(!x)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(c,2,1),[S]=new Uint32Array(c,4,1);return new CI(S,T,x,c)}constructor(c,h=64,g=Float64Array,_){if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=g,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;const x=b9.indexOf(this.ArrayType),T=2*c*this.ArrayType.BYTES_PER_ELEMENT,S=c*this.IndexArrayType.BYTES_PER_ELEMENT,F=(8-S%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${g}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+S+F,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+T+S+F),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+S+F,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=c)}add(c,h){const g=this._pos>>1;return this.ids[g]=g,this.coords[this._pos++]=c,this.coords[this._pos++]=h,g}finish(){const c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return TI(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,h,g,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:T,nodeSize:S}=this,F=[0,x.length-1,0],U=[];for(;F.length;){const z=F.pop()||0,K=F.pop()||0,ee=F.pop()||0;if(K-ee<=S){for(let Ce=ee;Ce<=K;Ce++){const Ue=T[2*Ce],At=T[2*Ce+1];Ue>=c&&Ue<=g&&At>=h&&At<=_&&U.push(x[Ce])}continue}const oe=ee+K>>1,le=T[2*oe],pe=T[2*oe+1];le>=c&&le<=g&&pe>=h&&pe<=_&&U.push(x[oe]),(z===0?c<=le:h<=pe)&&(F.push(ee),F.push(oe-1),F.push(1-z)),(z===0?g>=le:_>=pe)&&(F.push(oe+1),F.push(K),F.push(1-z))}return U}within(c,h,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:x,nodeSize:T}=this,S=[0,_.length-1,0],F=[],U=g*g;for(;S.length;){const z=S.pop()||0,K=S.pop()||0,ee=S.pop()||0;if(K-ee<=T){for(let Ce=ee;Ce<=K;Ce++)w9(x[2*Ce],x[2*Ce+1],c,h)<=U&&F.push(_[Ce]);continue}const oe=ee+K>>1,le=x[2*oe],pe=x[2*oe+1];w9(le,pe,c,h)<=U&&F.push(_[oe]),(z===0?c-g<=le:h-g<=pe)&&(S.push(ee),S.push(oe-1),S.push(1-z)),(z===0?c+g>=le:h+g>=pe)&&(S.push(oe+1),S.push(K),S.push(1-z))}return F}}function TI(A,c,h,g,_,x){if(_-g<=h)return;const T=g+_>>1;v9(A,c,T,g,_,x),TI(A,c,h,g,T-1,1-x),TI(A,c,h,T+1,_,1-x)}function v9(A,c,h,g,_,x){for(;_>g;){if(_-g>600){const U=_-g+1,z=h-g+1,K=Math.log(U),ee=.5*Math.exp(2*K/3),oe=.5*Math.sqrt(K*ee*(U-ee)/U)*(z-U/2<0?-1:1);v9(A,c,h,Math.max(g,Math.floor(h-z*ee/U+oe)),Math.min(_,Math.floor(h+(U-z)*ee/U+oe)),x)}const T=c[2*h+x];let S=g,F=_;for(py(A,c,g,h),c[2*_+x]>T&&py(A,c,g,_);S<F;){for(py(A,c,S,F),S++,F--;c[2*S+x]<T;)S++;for(;c[2*F+x]>T;)F--}c[2*g+x]===T?py(A,c,g,F):(F++,py(A,c,F,_)),F<=h&&(g=F+1),h<=F&&(_=F-1)}}function py(A,c,h,g){EI(A,h,g),EI(c,2*h,2*g),EI(c,2*h+1,2*g+1)}function EI(A,c,h){const g=A[c];A[c]=A[h],A[h]=g}function w9(A,c,h,g){const _=A-h,x=c-g;return _*_+x*x}var SI;a.cx=void 0,(SI=a.cx||(a.cx={})).create="create",SI.load="load",SI.fullLoad="fullLoad";let Pv=null,gy=[];const II=1e3/60,PI="loadTime",MI="fullLoadTime",Fxe={mark(A){performance.mark(A)},frame(A){const c=A;Pv!=null&&gy.push(c-Pv),Pv=c},clearMetrics(){Pv=null,gy=[],performance.clearMeasures(PI),performance.clearMeasures(MI);for(const A in a.cx)performance.clearMarks(a.cx[A])},getPerformanceMetrics(){performance.measure(PI,a.cx.create,a.cx.load),performance.measure(MI,a.cx.create,a.cx.fullLoad);const A=performance.getEntriesByName(PI)[0].duration,c=performance.getEntriesByName(MI)[0].duration,h=gy.length,g=1/(gy.reduce((x,T)=>x+T,0)/h/1e3),_=gy.filter(x=>x>II).reduce((x,T)=>x+(T-II)/II,0);return{loadTime:A,fullLoadTime:c,fps:g,percentDroppedFrames:_/(h+_)*100,totalFrames:h}}};a.$=Xe,a.A=H,a.B=function([A,c,h]){return c+=90,c*=Math.PI/180,h*=Math.PI/180,{x:A*Math.cos(c)*Math.sin(h),y:A*Math.sin(c)*Math.sin(h),z:A*Math.cos(h)}},a.C=dn,a.D=or,a.E=Wt,a.F=cn,a.G=Y,a.H=Er,a.I=AI,a.J=class{constructor(A,c){this.target=A,this.mapId=c,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new wxe(()=>this.process()),this.subscription=kt(this.target,"message",h=>this.receive(h),!1),this.globalScope=Kr(self)?A:window}registerMessageHandler(A,c){this.messageHandlers[A]=c}sendAsync(A,c){return new Promise((h,g)=>{const _=Math.round(1e18*Math.random()).toString(36).substring(0,10),x=c?kt(c.signal,"abort",()=>{x?.unsubscribe(),delete this.resolveRejects[_];const F={id:_,type:"<cancel>",origin:location.origin,targetMapId:A.targetMapId,sourceMapId:this.mapId};this.target.postMessage(F)},xxe):null;this.resolveRejects[_]={resolve:F=>{x?.unsubscribe(),h(F)},reject:F=>{x?.unsubscribe(),g(F)}};const T=[],S=Object.assign(Object.assign({},A),{id:_,sourceMapId:this.mapId,origin:location.origin,data:ft(A.data,T)});this.target.postMessage(S,{transfer:T})})}receive(A){const c=A.data,h=c.id;if(!(c.origin!=="file://"&&location.origin!=="file://"&&c.origin!=="resource://android"&&location.origin!=="resource://android"&&c.origin!==location.origin||c.targetMapId&&this.mapId!==c.targetMapId)){if(c.type==="<cancel>"){delete this.tasks[h];const g=this.abortControllers[h];return delete this.abortControllers[h],void(g&&g.abort())}if(Kr(self)||c.mustQueue)return this.tasks[h]=c,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,c)}}process(){if(this.taskQueue.length===0)return;const A=this.taskQueue.shift(),c=this.tasks[A];delete this.tasks[A],this.taskQueue.length>0&&this.invoker.trigger(),c&&this.processTask(A,c)}processTask(A,c){return o(this,void 0,void 0,function*(){if(c.type==="<response>"){const _=this.resolveRejects[A];return delete this.resolveRejects[A],_?void(c.error?_.reject(_t(c.error)):_.resolve(_t(c.data))):void 0}if(!this.messageHandlers[c.type])return void this.completeTask(A,new Error(`Could not find a registered handler for ${c.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=_t(c.data),g=new AbortController;this.abortControllers[A]=g;try{const _=yield this.messageHandlers[c.type](c.sourceMapId,h,g);this.completeTask(A,null,_)}catch(_){this.completeTask(A,_)}})}completeTask(A,c,h){const g=[];delete this.abortControllers[A];const _={id:A,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:c?ft(c):null,data:ft(h,g)};this.target.postMessage(_,{transfer:g})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},a.K=ge,a.L=function(){var A=new H(16);return H!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=0,A[12]=0,A[13]=0,A[14]=0),A[0]=1,A[5]=1,A[10]=1,A[15]=1,A},a.M=function(A,c,h){var g,_,x,T,S,F,U,z,K,ee,oe,le,pe=h[0],Ce=h[1],Ue=h[2];return c===A?(A[12]=c[0]*pe+c[4]*Ce+c[8]*Ue+c[12],A[13]=c[1]*pe+c[5]*Ce+c[9]*Ue+c[13],A[14]=c[2]*pe+c[6]*Ce+c[10]*Ue+c[14],A[15]=c[3]*pe+c[7]*Ce+c[11]*Ue+c[15]):(_=c[1],x=c[2],T=c[3],S=c[4],F=c[5],U=c[6],z=c[7],K=c[8],ee=c[9],oe=c[10],le=c[11],A[0]=g=c[0],A[1]=_,A[2]=x,A[3]=T,A[4]=S,A[5]=F,A[6]=U,A[7]=z,A[8]=K,A[9]=ee,A[10]=oe,A[11]=le,A[12]=g*pe+S*Ce+K*Ue+c[12],A[13]=_*pe+F*Ce+ee*Ue+c[13],A[14]=x*pe+U*Ce+oe*Ue+c[14],A[15]=T*pe+z*Ce+le*Ue+c[15]),A},a.N=function(A,c,h){var g=h[0],_=h[1],x=h[2];return A[0]=c[0]*g,A[1]=c[1]*g,A[2]=c[2]*g,A[3]=c[3]*g,A[4]=c[4]*_,A[5]=c[5]*_,A[6]=c[6]*_,A[7]=c[7]*_,A[8]=c[8]*x,A[9]=c[9]*x,A[10]=c[10]*x,A[11]=c[11]*x,A[12]=c[12],A[13]=c[13],A[14]=c[14],A[15]=c[15],A},a.O=function(A,c,h){var g=c[0],_=c[1],x=c[2],T=c[3],S=c[4],F=c[5],U=c[6],z=c[7],K=c[8],ee=c[9],oe=c[10],le=c[11],pe=c[12],Ce=c[13],Ue=c[14],At=c[15],Ve=h[0],et=h[1],Tt=h[2],Rt=h[3];return A[0]=Ve*g+et*S+Tt*K+Rt*pe,A[1]=Ve*_+et*F+Tt*ee+Rt*Ce,A[2]=Ve*x+et*U+Tt*oe+Rt*Ue,A[3]=Ve*T+et*z+Tt*le+Rt*At,A[4]=(Ve=h[4])*g+(et=h[5])*S+(Tt=h[6])*K+(Rt=h[7])*pe,A[5]=Ve*_+et*F+Tt*ee+Rt*Ce,A[6]=Ve*x+et*U+Tt*oe+Rt*Ue,A[7]=Ve*T+et*z+Tt*le+Rt*At,A[8]=(Ve=h[8])*g+(et=h[9])*S+(Tt=h[10])*K+(Rt=h[11])*pe,A[9]=Ve*_+et*F+Tt*ee+Rt*Ce,A[10]=Ve*x+et*U+Tt*oe+Rt*Ue,A[11]=Ve*T+et*z+Tt*le+Rt*At,A[12]=(Ve=h[12])*g+(et=h[13])*S+(Tt=h[14])*K+(Rt=h[15])*pe,A[13]=Ve*_+et*F+Tt*ee+Rt*Ce,A[14]=Ve*x+et*U+Tt*oe+Rt*Ue,A[15]=Ve*T+et*z+Tt*le+Rt*At,A},a.P=u,a.Q=function(A,c){const h={};for(let g=0;g<c.length;g++){const _=c[g];_ in A&&(h[_]=A[_])}return h},a.R=qa,a.S=Tf,a.T=rI,a.U=JV,a.V=ZV,a.W=k,a.X=D,a.Y=ar,a.Z=$l,a._=o,a.a=re,a.a$=ve,a.a0=function(A,c){var h,g,_,x,T;if(!A)return c??{};if(!c)return A;let S=Object.assign({},A);if(c.removeAll&&(S={removeAll:!0}),c.remove){const F=new Set(c.remove);S.add&&(S.add=S.add.filter(z=>!F.has(z.id))),S.update&&(S.update=S.update.filter(z=>!F.has(z.id)));const U=new Set(((h=A.add)!==null&&h!==void 0?h:[]).map(z=>z.id));c.remove=c.remove.filter(z=>!U.has(z))}if(c.remove){const F=new Set(S.remove?S.remove.concat(c.remove):c.remove);S.remove=Array.from(F.values())}if(c.add){const F=S.add?S.add.concat(c.add):c.add,U=new Map(F.map(z=>[z.id,z]));S.add=Array.from(U.values())}if(c.update){const F=new Map((g=S.update)===null||g===void 0?void 0:g.map(U=>[U.id,U]));for(const U of c.update){const z=(_=F.get(U.id))!==null&&_!==void 0?_:{id:U.id};U.newGeometry&&(z.newGeometry=U.newGeometry),U.addOrUpdateProperties&&(z.addOrUpdateProperties=((x=z.addOrUpdateProperties)!==null&&x!==void 0?x:[]).concat(U.addOrUpdateProperties)),U.removeProperties&&(z.removeProperties=((T=z.removeProperties)!==null&&T!==void 0?T:[]).concat(U.removeProperties)),U.removeAllProperties&&(z.removeAllProperties=!0),F.set(U.id,z)}S.update=Array.from(F.values())}return S.remove&&S.add&&(S.remove=S.remove.filter(F=>S.add.findIndex(U=>U.id===F)===-1)),S},a.a1=fy,a.a2=Jd,a.a3=25,a.a4=wI,a.a5=A=>{const c=window.document.createElement("video");return c.muted=!0,new Promise(h=>{c.onloadstart=()=>{h(c)};for(const g of A){const _=window.document.createElement("source");nt(g)||(c.crossOrigin="Anonymous"),_.src=g,c.appendChild(_)}})},a.a6=Ot,a.a7=function(){return Bt++},a.a8=V,a.a9=Vg,a.aA=function(A){let c=1/0,h=1/0,g=-1/0,_=-1/0;for(const x of A)c=Math.min(c,x.x),h=Math.min(h,x.y),g=Math.max(g,x.x),_=Math.max(_,x.y);return[c,h,g,_]},a.aB=uo,a.aC=wt,a.aD=function(A,c,h,g,_=!1){if(!h[0]&&!h[1])return[0,0];const x=_?g==="map"?-A.bearingInRadians:0:g==="viewport"?A.bearingInRadians:0;if(x){const T=Math.sin(x),S=Math.cos(x);h=[h[0]*S-h[1]*T,h[0]*T+h[1]*S]}return[_?h[0]:wt(c,h[0],A.zoom),_?h[1]:wt(c,h[1],A.zoom)]},a.aF=pI,a.aG=BI,a.aH=dI,a.aI=CI,a.aJ=Ln,a.aK=bv,a.aL=De,a.aM=Bn,a.aN=tn,a.aO=it,a.aP=hr,a.aQ=t9,a.aR=fe,a.aS=Z,a.aT=function(A){var c=new H(3);return c[0]=A[0],c[1]=A[1],c[2]=A[2],c},a.aU=function(A,c,h){return A[0]=c[0]-h[0],A[1]=c[1]-h[1],A[2]=c[2]-h[2],A},a.aV=function(A,c){var h=c[0],g=c[1],_=c[2],x=h*h+g*g+_*_;return x>0&&(x=1/Math.sqrt(x)),A[0]=c[0]*x,A[1]=c[1]*x,A[2]=c[2]*x,A},a.aW=te,a.aX=function(A,c){return A[0]*c[0]+A[1]*c[1]+A[2]*c[2]},a.aY=function(A,c,h){return A[0]=c[0]*h[0],A[1]=c[1]*h[1],A[2]=c[2]*h[2],A[3]=c[3]*h[3],A},a.aZ=ie,a.a_=function(A,c,h){const g=c[0]*h[0]+c[1]*h[1]+c[2]*h[2];return g===0?null:(-(A[0]*h[0]+A[1]*h[1]+A[2]*h[2])-h[3])/g},a.aa=Sc,a.ab=Xd,a.ac=s9,a.ad=function(A){const c={};if(A.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,g,_,x)=>{const T=_||x;return c[g]=!T||T.toLowerCase(),""}),c["max-age"]){const h=parseInt(c["max-age"],10);isNaN(h)?delete c["max-age"]:c["max-age"]=h}return c},a.ae=rt,a.af=85.051129,a.ag=ir,a.ah=function(A){return Math.pow(2,A)},a.ai=q,a.aj=e9,a.ak=function(A){return Math.log(A)/Math.LN2},a.al=function(A){var c=A[0],h=A[1];return c*c+h*h},a.am=function(A){if(!A.length)return new Set;const c=Math.max(...A.map(F=>F.canonical.z));let h=1/0,g=-1/0,_=1/0,x=-1/0;const T=[];for(const F of A){const{x:U,y:z,z:K}=F.canonical,ee=Math.pow(2,c-K),oe=U*ee,le=z*ee;T.push({id:F,x:oe,y:le}),oe<h&&(h=oe),oe>g&&(g=oe),le<_&&(_=le),le>x&&(x=le)}const S=new Set;for(const F of T)F.x!==h&&F.x!==g&&F.y!==_&&F.y!==x||S.add(F.id);return S},a.an=function(A,c){let h=0,g=0;if(A.kind==="constant")g=A.layoutSize;else if(A.kind!=="source"){const{interpolationType:_,minZoom:x,maxZoom:T}=A,S=_?rt(Vr.interpolationFactor(_,c,x,T),0,1):0;A.kind==="camera"?g=dn.number(A.minSize,A.maxSize,S):h=S}return{uSizeT:h,uSize:g}},a.ap=function(A,{uSize:c,uSizeT:h},{lowerSize:g,upperSize:_}){return A.kind==="source"?g/xA:A.kind==="composite"?dn.number(g/xA,_/xA,h):c},a.aq=function(A,c){var h=c[0],g=c[1],_=c[2],x=c[3],T=c[4],S=c[5],F=c[6],U=c[7],z=c[8],K=c[9],ee=c[10],oe=c[11],le=c[12],pe=c[13],Ce=c[14],Ue=c[15],At=h*S-g*T,Ve=h*F-_*T,et=h*U-x*T,Tt=g*F-_*S,Rt=g*U-x*S,qt=_*U-x*F,mr=z*pe-K*le,cr=z*Ce-ee*le,dr=z*Ue-oe*le,kr=K*Ce-ee*pe,fr=K*Ue-oe*pe,pr=ee*Ue-oe*Ce,Ht=At*pr-Ve*fr+et*kr+Tt*dr-Rt*cr+qt*mr;return Ht?(A[0]=(S*pr-F*fr+U*kr)*(Ht=1/Ht),A[1]=(_*fr-g*pr-x*kr)*Ht,A[2]=(pe*qt-Ce*Rt+Ue*Tt)*Ht,A[3]=(ee*Rt-K*qt-oe*Tt)*Ht,A[4]=(F*dr-T*pr-U*cr)*Ht,A[5]=(h*pr-_*dr+x*cr)*Ht,A[6]=(Ce*et-le*qt-Ue*Ve)*Ht,A[7]=(z*qt-ee*et+oe*Ve)*Ht,A[8]=(T*fr-S*dr+U*mr)*Ht,A[9]=(g*dr-h*fr-x*mr)*Ht,A[10]=(le*Rt-pe*et+Ue*At)*Ht,A[11]=(K*et-z*Rt-oe*At)*Ht,A[12]=(S*cr-T*kr-F*mr)*Ht,A[13]=(h*kr-g*cr+_*mr)*Ht,A[14]=(pe*Ve-le*Tt-Ce*At)*Ht,A[15]=(z*Tt-K*Ve+ee*At)*Ht,A):null},a.ar=st,a.as=function(A){var c=A[0],h=A[1];return Math.sqrt(c*c+h*h)},a.at=function(A){return A[0]=0,A[1]=0,A},a.au=function(A,c,h){return A[0]=c[0]*h,A[1]=c[1]*h,A},a.av=gI,a.aw=me,a.ax=function(A,c,h,g){const _=c.y-A.y,x=c.x-A.x,T=g.y-h.y,S=g.x-h.x,F=T*x-S*_;if(F===0)return null;const U=(S*(A.y-h.y)-T*(A.x-h.x))/F;return new u(A.x+U*x,A.y+U*_)},a.ay=l9,a.az=Z7,a.b=Kt,a.b$=class extends Vo{constructor(A,c){super(A,c),this.current=new Array}set(A){if(A!=this.current){this.current=A;const c=new Float32Array(A);this.gl.uniform1fv(this.location,c)}}},a.b0=function(A,c,h){return A[0]=c[0]*h,A[1]=c[1]*h,A[2]=c[2]*h,A[3]=c[3]*h,A},a.b1=function(A,c){return A[0]*c[0]+A[1]*c[1]+A[2]*c[2]+A[3]},a.b2=n9,a.b3=jg,a.b4=function(A,c,h,g,_){var x=1/Math.tan(c/2);if(A[0]=x/h,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=x,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=-1,A[12]=0,A[13]=0,A[15]=0,_!=null&&_!==1/0){var T=1/(g-_);A[10]=(_+g)*T,A[14]=2*_*g*T}else A[10]=-1,A[14]=-2*g;return A},a.b5=function(A){var c=new H(16);return c[0]=A[0],c[1]=A[1],c[2]=A[2],c[3]=A[3],c[4]=A[4],c[5]=A[5],c[6]=A[6],c[7]=A[7],c[8]=A[8],c[9]=A[9],c[10]=A[10],c[11]=A[11],c[12]=A[12],c[13]=A[13],c[14]=A[14],c[15]=A[15],c},a.b6=function(A,c,h){var g=Math.sin(h),_=Math.cos(h),x=c[0],T=c[1],S=c[2],F=c[3],U=c[4],z=c[5],K=c[6],ee=c[7];return c!==A&&(A[8]=c[8],A[9]=c[9],A[10]=c[10],A[11]=c[11],A[12]=c[12],A[13]=c[13],A[14]=c[14],A[15]=c[15]),A[0]=x*_+U*g,A[1]=T*_+z*g,A[2]=S*_+K*g,A[3]=F*_+ee*g,A[4]=U*_-x*g,A[5]=z*_-T*g,A[6]=K*_-S*g,A[7]=ee*_-F*g,A},a.b7=function(A,c,h){var g=Math.sin(h),_=Math.cos(h),x=c[4],T=c[5],S=c[6],F=c[7],U=c[8],z=c[9],K=c[10],ee=c[11];return c!==A&&(A[0]=c[0],A[1]=c[1],A[2]=c[2],A[3]=c[3],A[12]=c[12],A[13]=c[13],A[14]=c[14],A[15]=c[15]),A[4]=x*_+U*g,A[5]=T*_+z*g,A[6]=S*_+K*g,A[7]=F*_+ee*g,A[8]=U*_-x*g,A[9]=z*_-T*g,A[10]=K*_-S*g,A[11]=ee*_-F*g,A},a.b8=function(){const A=new Float32Array(16);return q(A),A},a.b9=function(){const A=new Float64Array(16);return q(A),A},a.bA=function(A,c){const h=ht(A,360),g=ht(c,360),_=g-h,x=g>h?_-360:_+360;return Math.abs(_)<Math.abs(x)?_:x},a.bB=function(A){return A[0]=0,A[1]=0,A[2]=0,A},a.bC=function(A,c,h,g){const _=Math.sqrt(A*A+c*c),x=Math.sqrt(h*h+g*g);A/=_,c/=_,h/=x,g/=x;const T=Math.acos(A*h+c*g);return-c*h+A*g>0?T:-T},a.bD=function(A,c){const h=ht(A,2*Math.PI),g=ht(c,2*Math.PI);return Math.min(Math.abs(h-g),Math.abs(h-g+2*Math.PI),Math.abs(h-g-2*Math.PI))},a.bE=function(){const A={},c=Ze.$version;for(const h in Ze.$root){const g=Ze.$root[h];if(g.required){let _=null;_=h==="version"?c:g.type==="array"?[]:{},_!=null&&(A[h]=_)}}return A},a.bF=Nt,a.bG=Me,a.bH=function A(c,h){if(Array.isArray(c)){if(!Array.isArray(h)||c.length!==h.length)return!1;for(let g=0;g<c.length;g++)if(!A(c[g],h[g]))return!1;return!0}if(typeof c=="object"&&c!==null&&h!==null){if(typeof h!="object"||Object.keys(c).length!==Object.keys(h).length)return!1;for(const g in c)if(!A(c[g],h[g]))return!1;return!0}return c===h},a.bI=function(A){A=A.slice();const c=Object.create(null);for(let h=0;h<A.length;h++)c[A[h].id]=A[h];for(let h=0;h<A.length;h++)"ref"in A[h]&&(A[h]=an(A[h],c[A[h].ref]));return A},a.bJ=function(A,c){if(A.type==="custom")return new vxe(A,c);switch(A.type){case"background":return new bxe(A,c);case"circle":return new s2e(A,c);case"color-relief":return new h2e(A,c);case"fill":return new T2e(A,c);case"fill-extrusion":return new D2e(A,c);case"heatmap":return new a2e(A,c);case"hillshade":return new c2e(A,c);case"line":return new j2e(A,c);case"raster":return new Ms(A,c);case"symbol":return new Cv(A,c)}},a.bK=A=>A.type==="raster",a.bL=nr,a.bM=function(A,c){if(!A)return[{command:"setStyle",args:[c]}];let h=[];try{if(!yr(A.version,c.version))return[{command:"setStyle",args:[c]}];yr(A.center,c.center)||h.push({command:"setCenter",args:[c.center]}),yr(A.state,c.state)||h.push({command:"setGlobalState",args:[c.state]}),yr(A.centerAltitude,c.centerAltitude)||h.push({command:"setCenterAltitude",args:[c.centerAltitude]}),yr(A.zoom,c.zoom)||h.push({command:"setZoom",args:[c.zoom]}),yr(A.bearing,c.bearing)||h.push({command:"setBearing",args:[c.bearing]}),yr(A.pitch,c.pitch)||h.push({command:"setPitch",args:[c.pitch]}),yr(A.roll,c.roll)||h.push({command:"setRoll",args:[c.roll]}),yr(A.sprite,c.sprite)||h.push({command:"setSprite",args:[c.sprite]}),yr(A.glyphs,c.glyphs)||h.push({command:"setGlyphs",args:[c.glyphs]}),yr(A.transition,c.transition)||h.push({command:"setTransition",args:[c.transition]}),yr(A.light,c.light)||h.push({command:"setLight",args:[c.light]}),yr(A.terrain,c.terrain)||h.push({command:"setTerrain",args:[c.terrain]}),yr(A.sky,c.sky)||h.push({command:"setSky",args:[c.sky]}),yr(A.projection,c.projection)||h.push({command:"setProjection",args:[c.projection]});const g={},_=[];(function(T,S,F,U){let z;for(z in S=S||{},T=T||{})Object.prototype.hasOwnProperty.call(T,z)&&(Object.prototype.hasOwnProperty.call(S,z)||Ir(z,F,U));for(z in S)Object.prototype.hasOwnProperty.call(S,z)&&(Object.prototype.hasOwnProperty.call(T,z)?yr(T[z],S[z])||(T[z].type==="geojson"&&S[z].type==="geojson"&&ii(T,S,z)?sn(F,{command:"setGeoJSONSourceData",args:[z,S[z].data]}):Gn(z,S,F,U)):fn(z,S,F))})(A.sources,c.sources,_,g);const x=[];A.layers&&A.layers.forEach(T=>{"source"in T&&g[T.source]?h.push({command:"removeLayer",args:[T.id]}):x.push(T)}),h=h.concat(_),function(T,S,F){S=S||[];const U=(T=T||[]).map(pn),z=S.map(pn),K=T.reduce(ln,{}),ee=S.reduce(ln,{}),oe=U.slice(),le=Object.create(null);let pe,Ce,Ue,At,Ve;for(let et=0,Tt=0;et<U.length;et++)pe=U[et],Object.prototype.hasOwnProperty.call(ee,pe)?Tt++:(sn(F,{command:"removeLayer",args:[pe]}),oe.splice(oe.indexOf(pe,Tt),1));for(let et=0,Tt=0;et<z.length;et++)pe=z[z.length-1-et],oe[oe.length-1-et]!==pe&&(Object.prototype.hasOwnProperty.call(K,pe)?(sn(F,{command:"removeLayer",args:[pe]}),oe.splice(oe.lastIndexOf(pe,oe.length-Tt),1)):Tt++,At=oe[oe.length-et],sn(F,{command:"addLayer",args:[ee[pe],At]}),oe.splice(oe.length-et,0,pe),le[pe]=!0);for(let et=0;et<z.length;et++)if(pe=z[et],Ce=K[pe],Ue=ee[pe],!le[pe]&&!yr(Ce,Ue))if(yr(Ce.source,Ue.source)&&yr(Ce["source-layer"],Ue["source-layer"])&&yr(Ce.type,Ue.type)){for(Ve in On(Ce.layout,Ue.layout,F,pe,null,"setLayoutProperty"),On(Ce.paint,Ue.paint,F,pe,null,"setPaintProperty"),yr(Ce.filter,Ue.filter)||sn(F,{command:"setFilter",args:[pe,Ue.filter]}),yr(Ce.minzoom,Ue.minzoom)&&yr(Ce.maxzoom,Ue.maxzoom)||sn(F,{command:"setLayerZoomRange",args:[pe,Ue.minzoom,Ue.maxzoom]}),Ce)Object.prototype.hasOwnProperty.call(Ce,Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?On(Ce[Ve],Ue[Ve],F,pe,Ve.slice(6),"setPaintProperty"):yr(Ce[Ve],Ue[Ve])||sn(F,{command:"setLayerProperty",args:[pe,Ve,Ue[Ve]]}));for(Ve in Ue)Object.prototype.hasOwnProperty.call(Ue,Ve)&&!Object.prototype.hasOwnProperty.call(Ce,Ve)&&Ve!=="layout"&&Ve!=="paint"&&Ve!=="filter"&&Ve!=="metadata"&&Ve!=="minzoom"&&Ve!=="maxzoom"&&(Ve.indexOf("paint.")===0?On(Ce[Ve],Ue[Ve],F,pe,Ve.slice(6),"setPaintProperty"):yr(Ce[Ve],Ue[Ve])||sn(F,{command:"setLayerProperty",args:[pe,Ve,Ue[Ve]]}))}else sn(F,{command:"removeLayer",args:[pe]}),At=oe[oe.lastIndexOf(pe)+1],sn(F,{command:"addLayer",args:[Ue,At]})}(x,c.layers,h)}catch(g){console.warn("Unable to compute style diff:",g),h=[{command:"setStyle",args:[c]}]}return h},a.bN=function(A){const c=[],h=A.id;return h===void 0&&c.push({message:`layers.${h}: missing required property "id"`}),A.render===void 0&&c.push({message:`layers.${h}: missing required method "render"`}),A.renderingMode&&A.renderingMode!=="2d"&&A.renderingMode!=="3d"&&c.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),c},a.bO=Dt,a.bP=Yt,a.bQ=class extends Vo{constructor(A,c){super(A,c),this.current=0}set(A){this.current!==A&&(this.current=A,this.gl.uniform1i(this.location,A))}},a.bR=Fs,a.bS=class extends Vo{constructor(A,c){super(A,c),this.current=co}set(A){if(A[12]!==this.current[12]||A[0]!==this.current[0])return this.current=A,void this.gl.uniformMatrix4fv(this.location,!1,A);for(let c=1;c<16;c++)if(A[c]!==this.current[c]){this.current=A,this.gl.uniformMatrix4fv(this.location,!1,A);break}}},a.bT=xf,a.bU=class extends Vo{constructor(A,c){super(A,c),this.current=[0,0,0]}set(A){A[0]===this.current[0]&&A[1]===this.current[1]&&A[2]===this.current[2]||(this.current=A,this.gl.uniform3f(this.location,A[0],A[1],A[2]))}},a.bV=class extends Vo{constructor(A,c){super(A,c),this.current=[0,0]}set(A){A[0]===this.current[0]&&A[1]===this.current[1]||(this.current=A,this.gl.uniform2f(this.location,A[0],A[1]))}},a.bW=N,a.bX=function(A,c){var h=Math.sin(c),g=Math.cos(c);return A[0]=g,A[1]=h,A[2]=0,A[3]=-h,A[4]=g,A[5]=0,A[6]=0,A[7]=0,A[8]=1,A},a.bY=function(A,c,h){var g=c[0],_=c[1],x=c[2];return A[0]=g*h[0]+_*h[3]+x*h[6],A[1]=g*h[1]+_*h[4]+x*h[7],A[2]=g*h[2]+_*h[5]+x*h[8],A},a.bZ=function(A,c,h,g,_,x,T){var S=1/(c-h),F=1/(g-_),U=1/(x-T);return A[0]=-2*S,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=-2*F,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=2*U,A[11]=0,A[12]=(c+h)*S,A[13]=(_+g)*F,A[14]=(T+x)*U,A[15]=1,A},a.b_=class extends Vo{constructor(A,c){super(A,c),this.current=new Array}set(A){if(A!=this.current){this.current=A;const c=new Float32Array(4*A.length);for(let h=0;h<A.length;h++)c[4*h]=A[h].r,c[4*h+1]=A[h].g,c[4*h+2]=A[h].b,c[4*h+3]=A[h].a;this.gl.uniform4fv(this.location,c)}}},a.ba=function(){return new Float64Array(16)},a.bb=function(A,c,h){const g=new Float64Array(4);return ot(g,A,c-90,h),g},a.bc=function(A,c,h,g){var _,x,T,S,F,U=c[0],z=c[1],K=c[2],ee=c[3],oe=h[0],le=h[1],pe=h[2],Ce=h[3];return(x=U*oe+z*le+K*pe+ee*Ce)<0&&(x=-x,oe=-oe,le=-le,pe=-pe,Ce=-Ce),1-x>j?(_=Math.acos(x),T=Math.sin(_),S=Math.sin((1-g)*_)/T,F=Math.sin(g*_)/T):(S=1-g,F=g),A[0]=S*U+F*oe,A[1]=S*z+F*le,A[2]=S*K+F*pe,A[3]=S*ee+F*Ce,A},a.bd=function(A){const c=new Float64Array(9);var h,g,_,x,T,S,F,U,z,K,ee,oe,le,pe,Ce,Ue,At,Ve;K=(_=(g=A)[0])*(F=_+_),ee=(x=g[1])*F,le=(T=g[2])*F,pe=T*(U=x+x),Ue=(S=g[3])*F,At=S*U,Ve=S*(z=T+T),(h=c)[0]=1-(oe=x*U)-(Ce=T*z),h[3]=ee-Ve,h[6]=le+At,h[1]=ee+Ve,h[4]=1-K-Ce,h[7]=pe-Ue,h[2]=le-At,h[5]=pe+Ue,h[8]=1-K-oe;const et=hr(-Math.asin(rt(c[2],-1,1)));let Tt,Rt;return Math.hypot(c[5],c[8])<.001?(Tt=0,Rt=-hr(Math.atan2(c[3],c[4]))):(Tt=hr(c[5]===0&&c[8]===0?0:Math.atan2(c[5],c[8])),Rt=hr(c[1]===0&&c[0]===0?0:Math.atan2(c[1],c[0]))),{roll:Tt,pitch:et+90,bearing:Rt}},a.be=function(A,c){return A.roll==c.roll&&A.pitch==c.pitch&&A.bearing==c.bearing},a.bf=en,a.bg=Pc,a.bh=Ng,a.bi=ay,a.bj=kg,a.bk=he,a.bl=Be,a.bm=no,a.bn=function(A,c,h,g,_){return he(g,_,rt((A-c)/(h-c),0,1))},a.bo=ht,a.bp=function(){return new Float64Array(3)},a.bq=function(A,c,h,g){return A[0]=c[0]+h[0]*g,A[1]=c[1]+h[1]*g,A[2]=c[2]+h[2]*g,A},a.br=ot,a.bs=function(A,c,h){var g=h[0],_=h[1],x=h[2],T=h[3],S=c[0],F=c[1],U=c[2],z=_*U-x*F,K=x*S-g*U,ee=g*F-_*S;return A[0]=S+T*(z+=z)+_*(ee+=ee)-x*(K+=K),A[1]=F+T*K+x*z-g*ee,A[2]=U+T*ee+g*K-_*z,A},a.bt=function(A,c,h){const g=(_=[A[0],A[1],A[2],c[0],c[1],c[2],h[0],h[1],h[2]])[0]*((z=_[8])*(T=_[4])-(S=_[5])*(U=_[7]))+_[1]*(-z*(x=_[3])+S*(F=_[6]))+_[2]*(U*x-T*F);var _,x,T,S,F,U,z;if(g===0)return null;const K=te([],[c[0],c[1],c[2]],[h[0],h[1],h[2]]),ee=te([],[h[0],h[1],h[2]],[A[0],A[1],A[2]]),oe=te([],[A[0],A[1],A[2]],[c[0],c[1],c[2]]),le=fe([],K,-A[3]);return Z(le,le,fe([],ee,-c[3])),Z(le,le,fe([],oe,-h[3])),fe(le,le,1/g),le},a.bu=bI,a.bv=function(){return new Float64Array(4)},a.bw=function(A,c,h,g){var _=[],x=[];return _[0]=c[0]-h[0],_[1]=c[1]-h[1],_[2]=c[2]-h[2],x[0]=_[0]*Math.cos(g)-_[1]*Math.sin(g),x[1]=_[0]*Math.sin(g)+_[1]*Math.cos(g),x[2]=_[2],A[0]=x[0]+h[0],A[1]=x[1]+h[1],A[2]=x[2]+h[2],A},a.bx=function(A,c,h,g){var _=[],x=[];return _[0]=c[0]-h[0],_[1]=c[1]-h[1],_[2]=c[2]-h[2],x[0]=_[0],x[1]=_[1]*Math.cos(g)-_[2]*Math.sin(g),x[2]=_[1]*Math.sin(g)+_[2]*Math.cos(g),A[0]=x[0]+h[0],A[1]=x[1]+h[1],A[2]=x[2]+h[2],A},a.by=function(A,c,h,g){var _=[],x=[];return _[0]=c[0]-h[0],_[1]=c[1]-h[1],_[2]=c[2]-h[2],x[0]=_[2]*Math.sin(g)+_[0]*Math.cos(g),x[1]=_[1],x[2]=_[2]*Math.cos(g)-_[0]*Math.sin(g),A[0]=x[0]+h[0],A[1]=x[1]+h[1],A[2]=x[2]+h[2],A},a.bz=function(A,c,h){var g=Math.sin(h),_=Math.cos(h),x=c[0],T=c[1],S=c[2],F=c[3],U=c[8],z=c[9],K=c[10],ee=c[11];return c!==A&&(A[4]=c[4],A[5]=c[5],A[6]=c[6],A[7]=c[7],A[12]=c[12],A[13]=c[13],A[14]=c[14],A[15]=c[15]),A[0]=x*_-U*g,A[1]=T*_-z*g,A[2]=S*_-K*g,A[3]=F*_-ee*g,A[8]=x*g+U*_,A[9]=T*g+z*_,A[10]=S*g+K*_,A[11]=F*g+ee*_,A},a.c=Ne,a.c0=class extends _l{},a.c1=q2e,a.c2=class extends wf{},a.c3=tI,a.c4=function(A){return A<=1?1:Math.pow(2,Math.ceil(Math.log(A)/Math.LN2))},a.c5=lV,a.c6=function(A,c,h){var g=c[0],_=c[1],x=c[2],T=h[3]*g+h[7]*_+h[11]*x+h[15];return A[0]=(h[0]*g+h[4]*_+h[8]*x+h[12])/(T=T||1),A[1]=(h[1]*g+h[5]*_+h[9]*x+h[13])/T,A[2]=(h[2]*g+h[6]*_+h[10]*x+h[14])/T,A},a.c7=class extends Ho{},a.c8=class extends E{},a.c9=function(A,c){return A[0]===c[0]&&A[1]===c[1]&&A[2]===c[2]&&A[3]===c[3]&&A[4]===c[4]&&A[5]===c[5]&&A[6]===c[6]&&A[7]===c[7]&&A[8]===c[8]&&A[9]===c[9]&&A[10]===c[10]&&A[11]===c[11]&&A[12]===c[12]&&A[13]===c[13]&&A[14]===c[14]&&A[15]===c[15]},a.cA=function(A,c){re.REGISTERED_PROTOCOLS[A]=c},a.cB=function(A){delete re.REGISTERED_PROTOCOLS[A]},a.cC=function(A,c){const h={};for(let _=0;_<A.length;_++){const x=c&&c[A[_].id]||dl(A[_]);c&&(c[A[_].id]=x);let T=h[x];T||(T=h[x]=[]),T.push(A[_])}const g=[];for(const _ in h)g.push(h[_]);return g},a.cD=be,a.cE=i9,a.cF=o9,a.cG=DV,a.cH=function(A){A.bucket.createArrays(),A.bucket.tilePixelRatio=Xe/(512*A.bucket.overscaling),A.bucket.compareText={},A.bucket.iconsNeedLinear=!1;const c=A.bucket.layers[0],h=c.layout,g=c._unevaluatedLayout._values,_={layoutIconSize:g["icon-size"].possiblyEvaluate(new cn(A.bucket.zoom+1),A.canonical),layoutTextSize:g["text-size"].possiblyEvaluate(new cn(A.bucket.zoom+1),A.canonical),textMaxSize:g["text-size"].possiblyEvaluate(new cn(18))};if(A.bucket.textSizeData.kind==="composite"){const{minZoom:U,maxZoom:z}=A.bucket.textSizeData;_.compositeTextSizes=[g["text-size"].possiblyEvaluate(new cn(U),A.canonical),g["text-size"].possiblyEvaluate(new cn(z),A.canonical)]}if(A.bucket.iconSizeData.kind==="composite"){const{minZoom:U,maxZoom:z}=A.bucket.iconSizeData;_.compositeIconSizes=[g["icon-size"].possiblyEvaluate(new cn(U),A.canonical),g["icon-size"].possiblyEvaluate(new cn(z),A.canonical)]}const x=h.get("text-line-height")*uo,T=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",S=h.get("text-keep-upright"),F=h.get("text-size");for(const U of A.bucket.features){const z=h.get("text-font").evaluate(U,{},A.canonical).join(","),K=F.evaluate(U,{},A.canonical),ee=_.layoutTextSize.evaluate(U,{},A.canonical),oe=_.layoutIconSize.evaluate(U,{},A.canonical),le={horizontal:{},vertical:void 0},pe=U.text;let Ce,Ue=[0,0];if(pe){const et=pe.toString(),Tt=h.get("text-letter-spacing").evaluate(U,{},A.canonical)*uo,Rt=Gt(et)?Tt:0,qt=h.get("text-anchor").evaluate(U,{},A.canonical),mr=m9(c,U,A.canonical);if(!mr){const fr=h.get("text-radial-offset").evaluate(U,{},A.canonical);Ue=fr?g9(qt,[fr*uo,xI]):h.get("text-offset").evaluate(U,{},A.canonical).map(pr=>pr*uo)}let cr=T?"center":h.get("text-justify").evaluate(U,{},A.canonical);const dr=h.get("symbol-placement")==="point"?h.get("text-max-width").evaluate(U,{},A.canonical)*uo:1/0,kr=()=>{A.bucket.allowVerticalPlacement&&zt(et)&&(le.vertical=wv(pe,A.glyphMap,A.glyphPositions,A.imagePositions,z,dr,x,qt,"left",Rt,Ue,a.ao.vertical,!0,ee,K))};if(!T&&mr){const fr=new Set;if(cr==="auto")for(let Ht=0;Ht<mr.values.length;Ht+=2)fr.add(BI(mr.values[Ht]));else fr.add(cr);let pr=!1;for(const Ht of fr)if(!le.horizontal[Ht])if(pr)le.horizontal[Ht]=le.horizontal[0];else{const rn=wv(pe,A.glyphMap,A.glyphPositions,A.imagePositions,z,dr,x,"center",Ht,Rt,Ue,a.ao.horizontal,!1,ee,K);rn&&(le.horizontal[Ht]=rn,pr=rn.positionedLines.length===1)}kr()}else{cr==="auto"&&(cr=BI(qt));const fr=wv(pe,A.glyphMap,A.glyphPositions,A.imagePositions,z,dr,x,qt,cr,Rt,Ue,a.ao.horizontal,!1,ee,K);fr&&(le.horizontal[cr]=fr),kr(),zt(et)&&T&&S&&(le.vertical=wv(pe,A.glyphMap,A.glyphPositions,A.imagePositions,z,dr,x,qt,cr,Rt,Ue,a.ao.vertical,!1,ee,K))}}let At=!1;if(U.icon&&U.icon.name){const et=A.imageMap[U.icon.name];et&&(Ce=gxe(A.imagePositions[U.icon.name],h.get("icon-offset").evaluate(U,{},A.canonical),h.get("icon-anchor").evaluate(U,{},A.canonical)),At=!!et.sdf,A.bucket.sdfIcons===void 0?A.bucket.sdfIcons=At:A.bucket.sdfIcons!==At&&xt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(et.pixelRatio!==A.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(A.bucket.iconsNeedLinear=!0))}const Ve=y9(le.horizontal)||le.vertical;A.bucket.iconsInText=!!Ve&&Ve.iconsInText,(Ve||Ce)&&Pxe(A.bucket,U,le,Ce,A.imageMap,_,ee,oe,Ue,At,A.canonical,A.subdivisionGranularity)}A.showCollisionBoxes&&A.bucket.generateCollisionDebugBuffers()},a.cI=oI,a.cJ=lI,a.cK=cI,a.cL=xV,a.cM=hI,a.cN=class{constructor(A){this._marks={start:[A.url,"start"].join("#"),end:[A.url,"end"].join("#"),measure:A.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let A=performance.getEntriesByName(this._marks.measure);return A.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),A=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),A}},a.cO=function(A,c,h,g,_){return o(this,void 0,void 0,function*(){if(D())try{return yield ar(A,c,h,g,_)}catch{}return function(x,T,S,F,U){const z=x.width,K=x.height;Lr&&vr||(Lr=new OffscreenCanvas(z,K),vr=Lr.getContext("2d",{willReadFrequently:!0})),Lr.width=z,Lr.height=K,vr.drawImage(x,0,0,z,K);const ee=vr.getImageData(T,S,F,U);return vr.clearRect(0,0,z,K),ee.data}(A,c,h,g,_)})},a.cP=hV,a.cQ=d,a.cR=wV,a.cS=zg,a.cT=dh,a.cU=function(A,c){const h=new Map;if(A!=null)if(A.type==="Feature")h.set(dy(A,c),A);else for(const g of A.features)h.set(dy(g,c),g);return h},a.cV=function(A,c){if(A==null)return!0;if(A.type==="Feature")return dy(A,c)!=null;if(A.type==="FeatureCollection"){const h=new Set;for(const g of A.features){const _=dy(g,c);if(_==null||h.has(_))return!1;h.add(_)}return!0}return!1},a.cW=function(A,c,h){var g,_,x,T;if(c.removeAll&&A.clear(),c.remove)for(const S of c.remove)A.delete(S);if(c.add)for(const S of c.add){const F=dy(S,h);F!=null&&A.set(F,S)}if(c.update)for(const S of c.update){let F=A.get(S.id);if(F==null)continue;const U=!S.removeAllProperties&&(((g=S.removeProperties)===null||g===void 0?void 0:g.length)>0||((_=S.addOrUpdateProperties)===null||_===void 0?void 0:_.length)>0);if((S.newGeometry||S.removeAllProperties||U)&&(F=Object.assign({},F),A.set(S.id,F),U&&(F.properties=Object.assign({},F.properties))),S.newGeometry&&(F.geometry=S.newGeometry),S.removeAllProperties)F.properties={};else if(((x=S.removeProperties)===null||x===void 0?void 0:x.length)>0)for(const z of S.removeProperties)Object.prototype.hasOwnProperty.call(F.properties,z)&&delete F.properties[z];if(((T=S.addOrUpdateProperties)===null||T===void 0?void 0:T.length)>0)for(const{key:z,value:K}of S.addOrUpdateProperties)F.properties[z]=K}},a.cX=_r,a.ca=function(A,c){var h=A[0],g=A[1],_=A[2],x=A[3],T=A[4],S=A[5],F=A[6],U=A[7],z=A[8],K=A[9],ee=A[10],oe=A[11],le=A[12],pe=A[13],Ce=A[14],Ue=A[15],At=c[0],Ve=c[1],et=c[2],Tt=c[3],Rt=c[4],qt=c[5],mr=c[6],cr=c[7],dr=c[8],kr=c[9],fr=c[10],pr=c[11],Ht=c[12],rn=c[13],un=c[14],qr=c[15];return Math.abs(h-At)<=j*Math.max(1,Math.abs(h),Math.abs(At))&&Math.abs(g-Ve)<=j*Math.max(1,Math.abs(g),Math.abs(Ve))&&Math.abs(_-et)<=j*Math.max(1,Math.abs(_),Math.abs(et))&&Math.abs(x-Tt)<=j*Math.max(1,Math.abs(x),Math.abs(Tt))&&Math.abs(T-Rt)<=j*Math.max(1,Math.abs(T),Math.abs(Rt))&&Math.abs(S-qt)<=j*Math.max(1,Math.abs(S),Math.abs(qt))&&Math.abs(F-mr)<=j*Math.max(1,Math.abs(F),Math.abs(mr))&&Math.abs(U-cr)<=j*Math.max(1,Math.abs(U),Math.abs(cr))&&Math.abs(z-dr)<=j*Math.max(1,Math.abs(z),Math.abs(dr))&&Math.abs(K-kr)<=j*Math.max(1,Math.abs(K),Math.abs(kr))&&Math.abs(ee-fr)<=j*Math.max(1,Math.abs(ee),Math.abs(fr))&&Math.abs(oe-pr)<=j*Math.max(1,Math.abs(oe),Math.abs(pr))&&Math.abs(le-Ht)<=j*Math.max(1,Math.abs(le),Math.abs(Ht))&&Math.abs(pe-rn)<=j*Math.max(1,Math.abs(pe),Math.abs(rn))&&Math.abs(Ce-un)<=j*Math.max(1,Math.abs(Ce),Math.abs(un))&&Math.abs(Ue-qr)<=j*Math.max(1,Math.abs(Ue),Math.abs(qr))},a.cb=function(A,c){return A[0]=c[0],A[1]=c[1],A[2]=c[2],A[3]=c[3],A[4]=c[4],A[5]=c[5],A[6]=c[6],A[7]=c[7],A[8]=c[8],A[9]=c[9],A[10]=c[10],A[11]=c[11],A[12]=c[12],A[13]=c[13],A[14]=c[14],A[15]=c[15],A},a.cc=A=>A.type==="symbol",a.cd=A=>A.type==="circle",a.ce=A=>A.type==="heatmap",a.cf=A=>A.type==="line",a.cg=A=>A.type==="fill",a.ch=A=>A.type==="fill-extrusion",a.ci=A=>A.type==="hillshade",a.cj=A=>A.type==="color-relief",a.ck=A=>A.type==="background",a.cl=A=>A.type==="custom",a.cm=Le,a.cn=function(A,c,h){const g=Ye(c.x-h.x,c.y-h.y),_=Ye(A.x-h.x,A.y-h.y);var x,T;return hr(Math.atan2(g[0]*_[1]-g[1]*_[0],(x=g)[0]*(T=_)[0]+x[1]*T[1]))},a.co=He,a.cp=function(A,c){return Cr[c]&&(A instanceof MouseEvent||A instanceof WheelEvent)},a.cq=function(A,c){return Mr[c]&&"touches"in A},a.cr=function(A){return Mr[A]||Cr[A]},a.cs=function(A,c,h){var g=c[0],_=c[1];return A[0]=h[0]*g+h[4]*_+h[12],A[1]=h[1]*g+h[5]*_+h[13],A},a.ct=function(A,c){const{x:h,y:g}=fy.fromLngLat(c);return!(A<0||A>25||g<0||g>=1||h<0||h>=1)},a.cu=function(A,c){return A[0]=c[0],A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=c[1],A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=c[2],A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A},a.cv=class extends Gi{},a.cw=Fxe,a.cy=function(A){return A.message===wr},a.cz=xe,a.d=nt,a.e=Pt,a.f=A=>o(void 0,void 0,void 0,function*(){if(A.byteLength===0)return createImageBitmap(new ImageData(1,1));const c=new Blob([new Uint8Array(A)],{type:"image/png"});try{return createImageBitmap(c)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),a.g=ae,a.h=A=>new Promise((c,h)=>{const g=new Image;g.onload=()=>{c(g),URL.revokeObjectURL(g.src),g.onload=null,window.requestAnimationFrame(()=>{g.src=Br})},g.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const _=new Blob([new Uint8Array(A)],{type:"image/png"});g.src=A.byteLength?URL.createObjectURL(_):Br}),a.i=Kr,a.j=(A,c)=>We(Pt(A,{type:"json"}),c),a.k=Ft,a.l=Lt,a.m=We,a.n=(A,c)=>We(Pt(A,{type:"arrayBuffer"}),c),a.o=function(A){return new hI(A).readFields(sxe,[])},a.p=UV,a.q=ry,a.r=Ci,a.s=kt,a.t=ps,a.u=ut,a.v=Ze,a.w=xt,a.x=$,a.y=ye,a.z=L}),i("worker",["./shared"],function(a){class o{constructor(re,ae){this.keyCache={},re&&this.replace(re,ae)}replace(re,ae){this._layerConfigs={},this._layers={},this.update(re,[],ae)}update(re,ae,ge){for(const Me of re){this._layerConfigs[Me.id]=Me;const We=this._layers[Me.id]=a.bJ(Me,ge);We._featureFilter=a.aa(We.filter,ge),this.keyCache[Me.id]&&delete this.keyCache[Me.id]}for(const Me of ae)delete this.keyCache[Me],delete this._layerConfigs[Me],delete this._layers[Me];this.familiesBySource={};const xe=a.cC(Object.values(this._layerConfigs),this.keyCache);for(const Me of xe){const We=Me.map(Wt=>this._layers[Wt.id]),nt=We[0];if(nt.visibility==="none")continue;const Ge=nt.source||"";let lt=this.familiesBySource[Ge];lt||(lt=this.familiesBySource[Ge]={});const Lt=nt.sourceLayer||"_geojsonTileLayer";let Ft=lt[Lt];Ft||(Ft=lt[Lt]=[]),Ft.push(We)}}}class u{constructor(re){const ae={},ge=[];for(const nt in re){const Ge=re[nt],lt=ae[nt]={};for(const Lt in Ge){const Ft=Ge[+Lt];if(!Ft||Ft.bitmap.width===0||Ft.bitmap.height===0)continue;const Wt={x:0,y:0,w:Ft.bitmap.width+2,h:Ft.bitmap.height+2};ge.push(Wt),lt[Lt]={rect:Wt,metrics:Ft.metrics}}}const{w:xe,h:Me}=a.p(ge),We=new a.q({width:xe||1,height:Me||1});for(const nt in re){const Ge=re[nt];for(const lt in Ge){const Lt=Ge[+lt];if(!Lt||Lt.bitmap.width===0||Lt.bitmap.height===0)continue;const Ft=ae[nt][lt].rect;a.q.copy(Lt.bitmap,We,{x:0,y:0},{x:Ft.x+1,y:Ft.y+1},Lt.bitmap)}}this.image=We,this.positions=ae}}a.cD("GlyphAtlas",u);class d{constructor(re){this.tileID=new a.Z(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.uid=re.uid,this.zoom=re.zoom,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=re.showCollisionBoxes,this.collectResourceTiming=!!re.collectResourceTiming,this.returnDependencies=!!re.returnDependencies,this.promoteId=re.promoteId,this.inFlightDependencies=[]}parse(re,ae,ge,xe,Me){return a._(this,void 0,void 0,function*(){this.status="parsing",this.data=re,this.collisionBoxArray=new a.a8;const We=new a.cE(Object.keys(re.layers).sort()),nt=new a.cF(this.tileID,this.promoteId);nt.bucketLayerIDs=[];const Ge={},lt={featureIndex:nt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:ge,subdivisionGranularity:Me},Lt=ae.familiesBySource[this.source];for(const Ot in Lt){const vn=re.layers[Ot];if(!vn)continue;vn.version===1&&a.w(`Vector tile source "${this.source}" layer "${Ot}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const wi=We.encode(Ot),Qs=[];for(let Un=0;Un<vn.length;Un++){const er=vn.feature(Un),Xr=nt.getId(er,Ot);Qs.push({feature:er,id:Xr,index:Un,sourceLayerIndex:wi})}for(const Un of Lt[Ot]){const er=Un[0];er.source!==this.source&&a.w(`layer.source = ${er.source} does not equal this.source = ${this.source}`),er.isHidden(this.zoom,!0)||(p(Un,this.zoom,ge),(Ge[er.id]=er.createBucket({index:nt.bucketLayerIDs.length,layers:Un,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wi,sourceID:this.source})).populate(Qs,lt,this.tileID.canonical),nt.bucketLayerIDs.push(Un.map(Xr=>Xr.id)))}}const Ft=a.bO(lt.glyphDependencies,Ot=>Object.keys(Ot).map(Number));this.inFlightDependencies.forEach(Ot=>Ot?.abort()),this.inFlightDependencies=[];let Wt=Promise.resolve({});if(Object.keys(Ft).length){const Ot=new AbortController;this.inFlightDependencies.push(Ot),Wt=xe.sendAsync({type:"GG",data:{stacks:Ft,source:this.source,tileID:this.tileID,type:"glyphs"}},Ot)}const Ze=Object.keys(lt.iconDependencies);let Sr=Promise.resolve({});if(Ze.length){const Ot=new AbortController;this.inFlightDependencies.push(Ot),Sr=xe.sendAsync({type:"GI",data:{icons:Ze,source:this.source,tileID:this.tileID,type:"icons"}},Ot)}const an=Object.keys(lt.patternDependencies);let yr=Promise.resolve({});if(an.length){const Ot=new AbortController;this.inFlightDependencies.push(Ot),yr=xe.sendAsync({type:"GI",data:{icons:an,source:this.source,tileID:this.tileID,type:"patterns"}},Ot)}const sn=lt.dashDependencies;let fn=Promise.resolve({});if(Object.keys(sn).length){const Ot=new AbortController;this.inFlightDependencies.push(Ot),fn=xe.sendAsync({type:"GDA",data:{dashes:sn}},Ot)}const[Ir,Gn,ii,On]=yield Promise.all([Wt,Sr,yr,fn]),pn=new u(Ir),ln=new a.cG(Gn,ii);for(const Ot in Ge){const vn=Ge[Ot];vn instanceof a.a9?(p(vn.layers,this.zoom,ge),a.cH({bucket:vn,glyphMap:Ir,glyphPositions:pn.positions,imageMap:Gn,imagePositions:ln.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:lt.subdivisionGranularity})):vn.hasDependencies&&(vn instanceof a.cI||vn instanceof a.cJ||vn instanceof a.cK)&&(p(vn.layers,this.zoom,ge),vn.addFeatures(lt,this.tileID.canonical,ln.patternPositions,On))}return this.status="done",{buckets:Object.values(Ge).filter(Ot=>!Ot.isEmpty()),featureIndex:nt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pn.image,imageAtlas:ln,dashPositions:On,glyphMap:this.returnDependencies?Ir:null,iconMap:this.returnDependencies?Gn:null,glyphPositions:this.returnDependencies?pn.positions:null}})}}function p(Ne,re,ae){const ge=new a.F(re);for(const xe of Ne)xe.recalculate(ge,ae)}class b{constructor(re,ae,ge){this.actor=re,this.layerIndex=ae,this.availableImages=ge,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(re,ae){return a._(this,void 0,void 0,function*(){const ge=yield a.n(re.request,ae);try{return{vectorTile:new a.cL(new a.cM(ge.data)),rawData:ge.data,cacheControl:ge.cacheControl,expires:ge.expires}}catch(xe){const Me=new Uint8Array(ge.data);let We=`Unable to parse the tile at ${re.request.url}, `;throw We+=Me[0]===31&&Me[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${xe.message}`,new Error(We)}})}loadTile(re){return a._(this,void 0,void 0,function*(){const ae=re.uid,ge=!!(re&&re.request&&re.request.collectResourceTiming)&&new a.cN(re.request),xe=new d(re);this.loading[ae]=xe;const Me=new AbortController;xe.abort=Me;try{const We=yield this.loadVectorTile(re,Me);if(delete this.loading[ae],!We)return null;const nt=We.rawData,Ge={};We.expires&&(Ge.expires=We.expires),We.cacheControl&&(Ge.cacheControl=We.cacheControl);const lt={};if(ge){const Ft=ge.finish();Ft&&(lt.resourceTiming=JSON.parse(JSON.stringify(Ft)))}xe.vectorTile=We.vectorTile;const Lt=xe.parse(We.vectorTile,this.layerIndex,this.availableImages,this.actor,re.subdivisionGranularity);this.loaded[ae]=xe,this.fetching[ae]={rawTileData:nt,cacheControl:Ge,resourceTiming:lt};try{const Ft=yield Lt;return a.e({rawTileData:nt.slice(0)},Ft,Ge,lt)}finally{delete this.fetching[ae]}}catch(We){throw delete this.loading[ae],xe.status="done",this.loaded[ae]=xe,We}})}reloadTile(re){return a._(this,void 0,void 0,function*(){const ae=re.uid;if(!this.loaded||!this.loaded[ae])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ge=this.loaded[ae];if(ge.showCollisionBoxes=re.showCollisionBoxes,ge.status==="parsing"){const xe=yield ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,re.subdivisionGranularity);let Me;if(this.fetching[ae]){const{rawTileData:We,cacheControl:nt,resourceTiming:Ge}=this.fetching[ae];delete this.fetching[ae],Me=a.e({rawTileData:We.slice(0)},xe,nt,Ge)}else Me=xe;return Me}if(ge.status==="done"&&ge.vectorTile)return ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor,re.subdivisionGranularity)})}abortTile(re){return a._(this,void 0,void 0,function*(){const ae=this.loading,ge=re.uid;ae&&ae[ge]&&ae[ge].abort&&(ae[ge].abort.abort(),delete ae[ge])})}removeTile(re){return a._(this,void 0,void 0,function*(){this.loaded&&this.loaded[re.uid]&&delete this.loaded[re.uid]})}}class C{constructor(){this.loaded={}}loadTile(re){return a._(this,void 0,void 0,function*(){const{uid:ae,encoding:ge,rawImageData:xe,redFactor:Me,greenFactor:We,blueFactor:nt,baseShift:Ge}=re,lt=xe.width+2,Lt=xe.height+2,Ft=a.b(xe)?new a.R({width:lt,height:Lt},yield a.cO(xe,-1,-1,lt,Lt)):xe,Wt=new a.cP(ae,Ft,ge,Me,We,nt,Ge);return this.loaded=this.loaded||{},this.loaded[ae]=Wt,Wt})}removeTile(re){const ae=this.loaded,ge=re.uid;ae&&ae[ge]&&delete ae[ge]}}var w,M,P=function(){if(M)return w;function Ne(ae,ge){if(ae.length!==0){re(ae[0],ge);for(var xe=1;xe<ae.length;xe++)re(ae[xe],!ge)}}function re(ae,ge){for(var xe=0,Me=0,We=0,nt=ae.length,Ge=nt-1;We<nt;Ge=We++){var lt=(ae[We][0]-ae[Ge][0])*(ae[Ge][1]+ae[We][1]),Lt=xe+lt;Me+=Math.abs(xe)>=Math.abs(lt)?xe-Lt+lt:lt-Lt+xe,xe=Lt}xe+Me>=0!=!!ge&&ae.reverse()}return M=1,w=function ae(ge,xe){var Me,We=ge&&ge.type;if(We==="FeatureCollection")for(Me=0;Me<ge.features.length;Me++)ae(ge.features[Me],xe);else if(We==="GeometryCollection")for(Me=0;Me<ge.geometries.length;Me++)ae(ge.geometries[Me],xe);else if(We==="Feature")ae(ge.geometry,xe);else if(We==="Polygon")Ne(ge.coordinates,xe);else if(We==="MultiPolygon")for(Me=0;Me<ge.coordinates.length;Me++)Ne(ge.coordinates[Me],xe);return ge}}(),k=a.cQ(P);class D extends a.cS{constructor(re,ae){super(new a.cM,0,ae,[],[]),this.feature=re,this.type=re.type,this.properties=re.tags?re.tags:{},"id"in re&&(typeof re.id=="string"?this.id=parseInt(re.id,10):typeof re.id!="number"||isNaN(re.id)||(this.id=re.id))}loadGeometry(){const re=[],ae=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const ge of ae){const xe=[];for(const Me of ge)xe.push(new a.P(Me[0],Me[1]));re.push(xe)}return re}}class j extends a.cR{constructor(re,ae){super(new a.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=ae?ae.version:1,this.extent=ae?ae.extent:4096,this.length=re.length,this.features=re}feature(re){return new D(this.features[re],this.extent)}}function H(Ne,re){re.writeVarintField(15,Ne.version||1),re.writeStringField(1,Ne.name||""),re.writeVarintField(5,Ne.extent||4096);const ae={keys:[],values:[],keycache:{},valuecache:{}};for(let Me=0;Me<Ne.length;Me++)ae.feature=Ne.feature(Me),re.writeMessage(2,N,ae);const ge=ae.keys;for(const Me of ge)re.writeStringField(3,Me);const xe=ae.values;for(const Me of xe)re.writeMessage(4,Z,Me)}function N(Ne,re){if(!Ne.feature)return;const ae=Ne.feature;ae.id!==void 0&&re.writeVarintField(1,ae.id),re.writeMessage(2,q,Ne),re.writeVarintField(3,ae.type),re.writeMessage(4,se,ae)}function q(Ne,re){for(const ae in Ne.feature?.properties){let ge=Ne.feature.properties[ae],xe=Ne.keycache[ae];if(ge===null)continue;xe===void 0&&(Ne.keys.push(ae),xe=Ne.keys.length-1,Ne.keycache[ae]=xe),re.writeVarint(xe),typeof ge!="string"&&typeof ge!="boolean"&&typeof ge!="number"&&(ge=JSON.stringify(ge));const Me=typeof ge+":"+ge;let We=Ne.valuecache[Me];We===void 0&&(Ne.values.push(ge),We=Ne.values.length-1,Ne.valuecache[Me]=We),re.writeVarint(We)}}function W(Ne,re){return(re<<3)+(7&Ne)}function ie(Ne){return Ne<<1^Ne>>31}function se(Ne,re){const ae=Ne.loadGeometry(),ge=Ne.type;let xe=0,Me=0;for(const We of ae){let nt=1;ge===1&&(nt=We.length),re.writeVarint(W(1,nt));const Ge=ge===3?We.length-1:We.length;for(let lt=0;lt<Ge;lt++){lt===1&&ge!==1&&re.writeVarint(W(2,Ge-1));const Lt=We[lt].x-xe,Ft=We[lt].y-Me;re.writeVarint(ie(Lt)),re.writeVarint(ie(Ft)),xe+=Lt,Me+=Ft}Ne.type===3&&re.writeVarint(W(7,1))}}function Z(Ne,re){const ae=typeof Ne;ae==="string"?re.writeStringField(1,Ne):ae==="boolean"?re.writeBooleanField(7,Ne):ae==="number"&&(Ne%1!=0?re.writeDoubleField(3,Ne):Ne<0?re.writeSVarintField(6,Ne):re.writeVarintField(5,Ne))}const fe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ne=>Ne},te=Math.fround||(ce=new Float32Array(1),Ne=>(ce[0]=+Ne,ce[0]));var ce;class ve{constructor(re){this.options=Object.assign(Object.create(fe),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:ae,minZoom:ge,maxZoom:xe}=this.options;ae&&console.time("total time");const Me=`prepare ${re.length} points`;ae&&console.time(Me),this.points=re;const We=[];for(let Ge=0;Ge<re.length;Ge++){const lt=re[Ge];if(!lt.geometry)continue;const[Lt,Ft]=lt.geometry.coordinates,Wt=te(ot(Lt)),Ze=te(st(Ft));We.push(Wt,Ze,1/0,Ge,-1,1),this.options.reduce&&We.push(0)}let nt=this.trees[xe+1]=this._createTree(We);ae&&console.timeEnd(Me);for(let Ge=xe;Ge>=ge;Ge--){const lt=+Date.now();nt=this.trees[Ge]=this._createTree(this._cluster(nt,Ge)),ae&&console.log("z%d: %d clusters in %dms",Ge,nt.numItems,+Date.now()-lt)}return ae&&console.timeEnd("total time"),this}getClusters(re,ae){let ge=((re[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,re[1]));let Me=re[2]===180?180:((re[2]+180)%360+360)%360-180;const We=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)ge=-180,Me=180;else if(ge>Me){const Ft=this.getClusters([ge,xe,180,We],ae),Wt=this.getClusters([-180,xe,Me,We],ae);return Ft.concat(Wt)}const nt=this.trees[this._limitZoom(ae)],Ge=nt.range(ot(ge),st(We),ot(Me),st(xe)),lt=nt.data,Lt=[];for(const Ft of Ge){const Wt=this.stride*Ft;Lt.push(lt[Wt+5]>1?me(lt,Wt,this.clusterProps):this.points[lt[Wt+3]])}return Lt}getChildren(re){const ae=this._getOriginId(re),ge=this._getOriginZoom(re),xe="No cluster with the specified id.",Me=this.trees[ge];if(!Me)throw new Error(xe);const We=Me.data;if(ae*this.stride>=We.length)throw new Error(xe);const nt=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),Ge=Me.within(We[ae*this.stride],We[ae*this.stride+1],nt),lt=[];for(const Lt of Ge){const Ft=Lt*this.stride;We[Ft+4]===re&&lt.push(We[Ft+5]>1?me(We,Ft,this.clusterProps):this.points[We[Ft+3]])}if(lt.length===0)throw new Error(xe);return lt}getLeaves(re,ae,ge){const xe=[];return this._appendLeaves(xe,re,ae=ae||10,ge=ge||0,0),xe}getTile(re,ae,ge){const xe=this.trees[this._limitZoom(re)],Me=Math.pow(2,re),{extent:We,radius:nt}=this.options,Ge=nt/We,lt=(ge-Ge)/Me,Lt=(ge+1+Ge)/Me,Ft={features:[]};return this._addTileFeatures(xe.range((ae-Ge)/Me,lt,(ae+1+Ge)/Me,Lt),xe.data,ae,ge,Me,Ft),ae===0&&this._addTileFeatures(xe.range(1-Ge/Me,lt,1,Lt),xe.data,Me,ge,Me,Ft),ae===Me-1&&this._addTileFeatures(xe.range(0,lt,Ge/Me,Lt),xe.data,-1,ge,Me,Ft),Ft.features.length?Ft:null}getClusterExpansionZoom(re){let ae=this._getOriginZoom(re)-1;for(;ae<=this.options.maxZoom;){const ge=this.getChildren(re);if(ae++,ge.length!==1)break;re=ge[0].properties.cluster_id}return ae}_appendLeaves(re,ae,ge,xe,Me){const We=this.getChildren(ae);for(const nt of We){const Ge=nt.properties;if(Ge&&Ge.cluster?Me+Ge.point_count<=xe?Me+=Ge.point_count:Me=this._appendLeaves(re,Ge.cluster_id,ge,xe,Me):Me<xe?Me++:re.push(nt),re.length===ge)break}return Me}_createTree(re){const ae=new a.aI(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<re.length;ge+=this.stride)ae.add(re[ge],re[ge+1]);return ae.finish(),ae.data=re,ae}_addTileFeatures(re,ae,ge,xe,Me,We){for(const nt of re){const Ge=nt*this.stride,lt=ae[Ge+5]>1;let Lt,Ft,Wt;if(lt)Lt=qe(ae,Ge,this.clusterProps),Ft=ae[Ge],Wt=ae[Ge+1];else{const an=this.points[ae[Ge+3]];Lt=an.properties;const[yr,sn]=an.geometry.coordinates;Ft=ot(yr),Wt=st(sn)}const Ze={type:1,geometry:[[Math.round(this.options.extent*(Ft*Me-ge)),Math.round(this.options.extent*(Wt*Me-xe))]],tags:Lt};let Sr;Sr=lt||this.options.generateId?ae[Ge+3]:this.points[ae[Ge+3]].id,Sr!==void 0&&(Ze.id=Sr),We.features.push(Ze)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,ae){const{radius:ge,extent:xe,reduce:Me,minPoints:We}=this.options,nt=ge/(xe*Math.pow(2,ae)),Ge=re.data,lt=[],Lt=this.stride;for(let Ft=0;Ft<Ge.length;Ft+=Lt){if(Ge[Ft+2]<=ae)continue;Ge[Ft+2]=ae;const Wt=Ge[Ft],Ze=Ge[Ft+1],Sr=re.within(Ge[Ft],Ge[Ft+1],nt),an=Ge[Ft+5];let yr=an;for(const sn of Sr){const fn=sn*Lt;Ge[fn+2]>ae&&(yr+=Ge[fn+5])}if(yr>an&&yr>=We){let sn,fn=Wt*an,Ir=Ze*an,Gn=-1;const ii=(Ft/Lt<<5)+(ae+1)+this.points.length;for(const On of Sr){const pn=On*Lt;if(Ge[pn+2]<=ae)continue;Ge[pn+2]=ae;const ln=Ge[pn+5];fn+=Ge[pn]*ln,Ir+=Ge[pn+1]*ln,Ge[pn+4]=ii,Me&&(sn||(sn=this._map(Ge,Ft,!0),Gn=this.clusterProps.length,this.clusterProps.push(sn)),Me(sn,this._map(Ge,pn)))}Ge[Ft+4]=ii,lt.push(fn/yr,Ir/yr,1/0,ii,-1,yr),Me&&lt.push(Gn)}else{for(let sn=0;sn<Lt;sn++)lt.push(Ge[Ft+sn]);if(yr>1)for(const sn of Sr){const fn=sn*Lt;if(!(Ge[fn+2]<=ae)){Ge[fn+2]=ae;for(let Ir=0;Ir<Lt;Ir++)lt.push(Ge[fn+Ir])}}}}return lt}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,ae,ge){if(re[ae+5]>1){const We=this.clusterProps[re[ae+6]];return ge?Object.assign({},We):We}const xe=this.points[re[ae+3]].properties,Me=this.options.map(xe);return ge&&Me===xe?Object.assign({},Me):Me}}function me(Ne,re,ae){return{type:"Feature",id:Ne[re+3],properties:qe(Ne,re,ae),geometry:{type:"Point",coordinates:[(ge=Ne[re],360*(ge-.5)),Ye(Ne[re+1])]}};var ge}function qe(Ne,re,ae){const ge=Ne[re+5],xe=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Me=Ne[re+6],We=Me===-1?{}:Object.assign({},ae[Me]);return Object.assign(We,{cluster:!0,cluster_id:Ne[re+3],point_count:ge,point_count_abbreviated:xe})}function ot(Ne){return Ne/360+.5}function st(Ne){const re=Math.sin(Ne*Math.PI/180),ae=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return ae<0?0:ae>1?1:ae}function Ye(Ne){const re=(180-360*Ne)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}function Xe(Ne,re,ae,ge){let xe=ge;const Me=re+(ae-re>>1);let We,nt=ae-re;const Ge=Ne[re],lt=Ne[re+1],Lt=Ne[ae],Ft=Ne[ae+1];for(let Wt=re+3;Wt<ae;Wt+=3){const Ze=wt(Ne[Wt],Ne[Wt+1],Ge,lt,Lt,Ft);if(Ze>xe)We=Wt,xe=Ze;else if(Ze===xe){const Sr=Math.abs(Wt-Me);Sr<nt&&(We=Wt,nt=Sr)}}xe>ge&&(We-re>3&&Xe(Ne,re,We,ge),Ne[We+2]=xe,ae-We>3&&Xe(Ne,We,ae,ge))}function wt(Ne,re,ae,ge,xe,Me){let We=xe-ae,nt=Me-ge;if(We!==0||nt!==0){const Ge=((Ne-ae)*We+(re-ge)*nt)/(We*We+nt*nt);Ge>1?(ae=xe,ge=Me):Ge>0&&(ae+=We*Ge,ge+=nt*Ge)}return We=Ne-ae,nt=re-ge,We*We+nt*nt}function ht(Ne,re,ae,ge){const xe={id:Ne??null,type:re,geometry:ae,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(re==="Point"||re==="MultiPoint"||re==="LineString")he(xe,ae);else if(re==="Polygon")he(xe,ae[0]);else if(re==="MultiLineString")for(const Me of ae)he(xe,Me);else if(re==="MultiPolygon")for(const Me of ae)he(xe,Me[0]);return xe}function he(Ne,re){for(let ae=0;ae<re.length;ae+=3)Ne.minX=Math.min(Ne.minX,re[ae]),Ne.minY=Math.min(Ne.minY,re[ae+1]),Ne.maxX=Math.max(Ne.maxX,re[ae]),Ne.maxY=Math.max(Ne.maxY,re[ae+1])}function Be(Ne,re,ae,ge){if(!re.geometry)return;const xe=re.geometry.coordinates;if(xe&&xe.length===0)return;const Me=re.geometry.type,We=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2);let nt=[],Ge=re.id;if(ae.promoteId?Ge=re.properties[ae.promoteId]:ae.generateId&&(Ge=ge||0),Me==="Point")Le(xe,nt);else if(Me==="MultiPoint")for(const lt of xe)Le(lt,nt);else if(Me==="LineString")He(xe,nt,We,!1);else if(Me==="MultiLineString"){if(ae.lineMetrics){for(const lt of xe)nt=[],He(lt,nt,We,!1),Ne.push(ht(Ge,"LineString",nt,re.properties));return}rt(xe,nt,We,!1)}else if(Me==="Polygon")rt(xe,nt,We,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(const lt of re.geometry.geometries)Be(Ne,{id:Ge,geometry:lt,properties:re.properties},ae,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const lt of xe){const Lt=[];rt(lt,Lt,We,!0),nt.push(Lt)}}Ne.push(ht(Ge,Me,nt,re.properties))}function Le(Ne,re){re.push(it(Ne[0]),Pt(Ne[1]),0)}function He(Ne,re,ae,ge){let xe,Me,We=0;for(let Ge=0;Ge<Ne.length;Ge++){const lt=it(Ne[Ge][0]),Lt=Pt(Ne[Ge][1]);re.push(lt,Lt,0),Ge>0&&(We+=ge?(xe*Lt-lt*Me)/2:Math.sqrt(Math.pow(lt-xe,2)+Math.pow(Lt-Me,2))),xe=lt,Me=Lt}const nt=re.length-3;re[2]=1,Xe(re,0,nt,ae),re[nt+2]=1,re.size=Math.abs(We),re.start=0,re.end=re.size}function rt(Ne,re,ae,ge){for(let xe=0;xe<Ne.length;xe++){const Me=[];He(Ne[xe],Me,ae,ge),re.push(Me)}}function it(Ne){return Ne/360+.5}function Pt(Ne){const re=Math.sin(Ne*Math.PI/180),ae=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return ae<0?0:ae>1?1:ae}function Bt(Ne,re,ae,ge,xe,Me,We,nt){if(ge/=re,Me>=(ae/=re)&&We<ge)return Ne;if(We<ae||Me>=ge)return null;const Ge=[];for(const lt of Ne){const Lt=lt.geometry;let Ft=lt.type;const Wt=xe===0?lt.minX:lt.minY,Ze=xe===0?lt.maxX:lt.maxY;if(Wt>=ae&&Ze<ge){Ge.push(lt);continue}if(Ze<ae||Wt>=ge)continue;let Sr=[];if(Ft==="Point"||Ft==="MultiPoint")Dt(Lt,Sr,ae,ge,xe);else if(Ft==="LineString")Yt(Lt,Sr,ae,ge,xe,!1,nt.lineMetrics);else if(Ft==="MultiLineString")ur(Lt,Sr,ae,ge,xe,!1);else if(Ft==="Polygon")ur(Lt,Sr,ae,ge,xe,!0);else if(Ft==="MultiPolygon")for(const an of Lt){const yr=[];ur(an,yr,ae,ge,xe,!0),yr.length&&Sr.push(yr)}if(Sr.length){if(nt.lineMetrics&&Ft==="LineString"){for(const an of Sr)Ge.push(ht(lt.id,Ft,an,lt.tags));continue}Ft!=="LineString"&&Ft!=="MultiLineString"||(Sr.length===1?(Ft="LineString",Sr=Sr[0]):Ft="MultiLineString"),Ft!=="Point"&&Ft!=="MultiPoint"||(Ft=Sr.length===3?"Point":"MultiPoint"),Ge.push(ht(lt.id,Ft,Sr,lt.tags))}}return Ge.length?Ge:null}function Dt(Ne,re,ae,ge,xe){for(let Me=0;Me<Ne.length;Me+=3){const We=Ne[Me+xe];We>=ae&&We<=ge&&xt(re,Ne[Me],Ne[Me+1],Ne[Me+2])}}function Yt(Ne,re,ae,ge,xe,Me,We){let nt=nr(Ne);const Ge=xe===0?Re:Kr;let lt,Lt,Ft=Ne.start;for(let yr=0;yr<Ne.length-3;yr+=3){const sn=Ne[yr],fn=Ne[yr+1],Ir=Ne[yr+2],Gn=Ne[yr+3],ii=Ne[yr+4],On=xe===0?sn:fn,pn=xe===0?Gn:ii;let ln=!1;We&&(lt=Math.sqrt(Math.pow(sn-Gn,2)+Math.pow(fn-ii,2))),On<ae?pn>ae&&(Lt=Ge(nt,sn,fn,Gn,ii,ae),We&&(nt.start=Ft+lt*Lt)):On>ge?pn<ge&&(Lt=Ge(nt,sn,fn,Gn,ii,ge),We&&(nt.start=Ft+lt*Lt)):xt(nt,sn,fn,Ir),pn<ae&&On>=ae&&(Lt=Ge(nt,sn,fn,Gn,ii,ae),ln=!0),pn>ge&&On<=ge&&(Lt=Ge(nt,sn,fn,Gn,ii,ge),ln=!0),!Me&&ln&&(We&&(nt.end=Ft+lt*Lt),re.push(nt),nt=nr(Ne)),We&&(Ft+=lt)}let Wt=Ne.length-3;const Ze=Ne[Wt],Sr=Ne[Wt+1],an=xe===0?Ze:Sr;an>=ae&&an<=ge&&xt(nt,Ze,Sr,Ne[Wt+2]),Wt=nt.length-3,Me&&Wt>=3&&(nt[Wt]!==nt[0]||nt[Wt+1]!==nt[1])&&xt(nt,nt[0],nt[1],nt[2]),nt.length&&re.push(nt)}function nr(Ne){const re=[];return re.size=Ne.size,re.start=Ne.start,re.end=Ne.end,re}function ur(Ne,re,ae,ge,xe,Me){for(const We of Ne)Yt(We,re,ae,ge,xe,Me,!1)}function xt(Ne,re,ae,ge){Ne.push(re,ae,ge)}function Re(Ne,re,ae,ge,xe,Me){const We=(Me-re)/(ge-re);return xt(Ne,Me,ae+(xe-ae)*We,1),We}function Kr(Ne,re,ae,ge,xe,Me){const We=(Me-ae)/(xe-ae);return xt(Ne,re+(ge-re)*We,Me,1),We}function Ur(Ne,re){const ae=[];for(let ge=0;ge<Ne.length;ge++){const xe=Ne[ge],Me=xe.type;let We;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")We=Er(xe.geometry,re);else if(Me==="MultiLineString"||Me==="Polygon"){We=[];for(const nt of xe.geometry)We.push(Er(nt,re))}else if(Me==="MultiPolygon"){We=[];for(const nt of xe.geometry){const Ge=[];for(const lt of nt)Ge.push(Er(lt,re));We.push(Ge)}}ae.push(ht(xe.id,Me,We,xe.tags))}return ae}function Er(Ne,re){const ae=[];ae.size=Ne.size,Ne.start!==void 0&&(ae.start=Ne.start,ae.end=Ne.end);for(let ge=0;ge<Ne.length;ge+=3)ae.push(Ne[ge]+re,Ne[ge+1],Ne[ge+2]);return ae}function Kt(Ne,re){if(Ne.transformed)return Ne;const ae=1<<Ne.z,ge=Ne.x,xe=Ne.y;for(const Me of Ne.features){const We=Me.geometry,nt=Me.type;if(Me.geometry=[],nt===1)for(let Ge=0;Ge<We.length;Ge+=2)Me.geometry.push(Br(We[Ge],We[Ge+1],re,ae,ge,xe));else for(let Ge=0;Ge<We.length;Ge++){const lt=[];for(let Lt=0;Lt<We[Ge].length;Lt+=2)lt.push(Br(We[Ge][Lt],We[Ge][Lt+1],re,ae,ge,xe));Me.geometry.push(lt)}}return Ne.transformed=!0,Ne}function Br(Ne,re,ae,ge,xe,Me){return[Math.round(ae*(Ne*ge-xe)),Math.round(ae*(re*ge-Me))]}function ar(Ne,re,ae,ge,xe){const Me=re===xe.maxZoom?0:xe.tolerance/((1<<re)*xe.extent),We={features:[],numPoints:0,numSimplified:0,numFeatures:Ne.length,source:null,x:ae,y:ge,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const nt of Ne)Lr(We,nt,Me,xe);return We}function Lr(Ne,re,ae,ge){const xe=re.geometry,Me=re.type,We=[];if(Ne.minX=Math.min(Ne.minX,re.minX),Ne.minY=Math.min(Ne.minY,re.minY),Ne.maxX=Math.max(Ne.maxX,re.maxX),Ne.maxY=Math.max(Ne.maxY,re.maxY),Me==="Point"||Me==="MultiPoint")for(let nt=0;nt<xe.length;nt+=3)We.push(xe[nt],xe[nt+1]),Ne.numPoints++,Ne.numSimplified++;else if(Me==="LineString")vr(We,xe,Ne,ae,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(let nt=0;nt<xe.length;nt++)vr(We,xe[nt],Ne,ae,Me==="Polygon",nt===0);else if(Me==="MultiPolygon")for(let nt=0;nt<xe.length;nt++){const Ge=xe[nt];for(let lt=0;lt<Ge.length;lt++)vr(We,Ge[lt],Ne,ae,!0,lt===0)}if(We.length){let nt=re.tags||null;if(Me==="LineString"&&ge.lineMetrics){nt={};for(const lt in re.tags)nt[lt]=re.tags[lt];nt.mapbox_clip_start=xe.start/xe.size,nt.mapbox_clip_end=xe.end/xe.size}const Ge={geometry:We,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:nt};re.id!==null&&(Ge.id=re.id),Ne.features.push(Ge)}}function vr(Ne,re,ae,ge,xe,Me){const We=ge*ge;if(ge>0&&re.size<(xe?We:ge))return void(ae.numPoints+=re.length/3);const nt=[];for(let Ge=0;Ge<re.length;Ge+=3)(ge===0||re[Ge+2]>We)&&(ae.numSimplified++,nt.push(re[Ge],re[Ge+1])),ae.numPoints++;xe&&function(Ge,lt){let Lt=0;for(let Ft=0,Wt=Ge.length,Ze=Wt-2;Ft<Wt;Ze=Ft,Ft+=2)Lt+=(Ge[Ft]-Ge[Ze])*(Ge[Ft+1]+Ge[Ze+1]);if(Lt>0===lt)for(let Ft=0,Wt=Ge.length;Ft<Wt/2;Ft+=2){const Ze=Ge[Ft],Sr=Ge[Ft+1];Ge[Ft]=Ge[Wt-2-Ft],Ge[Ft+1]=Ge[Wt-1-Ft],Ge[Wt-2-Ft]=Ze,Ge[Wt-1-Ft]=Sr}}(nt,Me),Ne.push(nt)}const kt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ir{constructor(re,ae){const ge=(ae=this.options=function(Me,We){for(const nt in We)Me[nt]=We[nt];return Me}(Object.create(kt),ae)).debug;if(ge&&console.time("preprocess data"),ae.maxZoom<0||ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ae.promoteId&&ae.generateId)throw new Error("promoteId and generateId cannot be used together.");let xe=function(Me,We){const nt=[];if(Me.type==="FeatureCollection")for(let Ge=0;Ge<Me.features.length;Ge++)Be(nt,Me.features[Ge],We,Ge);else Be(nt,Me.type==="Feature"?Me:{geometry:Me},We);return nt}(re,ae);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ae.indexMaxZoom,ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),xe=function(Me,We){const nt=We.buffer/We.extent;let Ge=Me;const lt=Bt(Me,1,-1-nt,nt,0,-1,2,We),Lt=Bt(Me,1,1-nt,2+nt,0,-1,2,We);return(lt||Lt)&&(Ge=Bt(Me,1,-nt,1+nt,0,-1,2,We)||[],lt&&(Ge=Ur(lt,1).concat(Ge)),Lt&&(Ge=Ge.concat(Ur(Lt,-1)))),Ge}(xe,ae),xe.length&&this.splitTile(xe,0,0,0),ge&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(re,ae,ge,xe,Me,We,nt){const Ge=[re,ae,ge,xe],lt=this.options,Lt=lt.debug;for(;Ge.length;){xe=Ge.pop(),ge=Ge.pop(),ae=Ge.pop(),re=Ge.pop();const Ft=1<<ae,Wt=hr(ae,ge,xe);let Ze=this.tiles[Wt];if(!Ze&&(Lt>1&&console.time("creation"),Ze=this.tiles[Wt]=ar(re,ae,ge,xe,lt),this.tileCoords.push({z:ae,x:ge,y:xe}),Lt)){Lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ae,ge,xe,Ze.numFeatures,Ze.numPoints,Ze.numSimplified),console.timeEnd("creation"));const ln=`z${ae}`;this.stats[ln]=(this.stats[ln]||0)+1,this.total++}if(Ze.source=re,Me==null){if(ae===lt.indexMaxZoom||Ze.numPoints<=lt.indexMaxPoints)continue}else{if(ae===lt.maxZoom||ae===Me)continue;if(Me!=null){const ln=Me-ae;if(ge!==We>>ln||xe!==nt>>ln)continue}}if(Ze.source=null,re.length===0)continue;Lt>1&&console.time("clipping");const Sr=.5*lt.buffer/lt.extent,an=.5-Sr,yr=.5+Sr,sn=1+Sr;let fn=null,Ir=null,Gn=null,ii=null,On=Bt(re,Ft,ge-Sr,ge+yr,0,Ze.minX,Ze.maxX,lt),pn=Bt(re,Ft,ge+an,ge+sn,0,Ze.minX,Ze.maxX,lt);re=null,On&&(fn=Bt(On,Ft,xe-Sr,xe+yr,1,Ze.minY,Ze.maxY,lt),Ir=Bt(On,Ft,xe+an,xe+sn,1,Ze.minY,Ze.maxY,lt),On=null),pn&&(Gn=Bt(pn,Ft,xe-Sr,xe+yr,1,Ze.minY,Ze.maxY,lt),ii=Bt(pn,Ft,xe+an,xe+sn,1,Ze.minY,Ze.maxY,lt),pn=null),Lt>1&&console.timeEnd("clipping"),Ge.push(fn||[],ae+1,2*ge,2*xe),Ge.push(Ir||[],ae+1,2*ge,2*xe+1),Ge.push(Gn||[],ae+1,2*ge+1,2*xe),Ge.push(ii||[],ae+1,2*ge+1,2*xe+1)}}getTile(re,ae,ge){re=+re,ae=+ae,ge=+ge;const xe=this.options,{extent:Me,debug:We}=xe;if(re<0||re>24)return null;const nt=1<<re,Ge=hr(re,ae=ae+nt&nt-1,ge);if(this.tiles[Ge])return Kt(this.tiles[Ge],Me);We>1&&console.log("drilling down to z%d-%d-%d",re,ae,ge);let lt,Lt=re,Ft=ae,Wt=ge;for(;!lt&&Lt>0;)Lt--,Ft>>=1,Wt>>=1,lt=this.tiles[hr(Lt,Ft,Wt)];return lt&&lt.source?(We>1&&(console.log("found parent tile z%d-%d-%d",Lt,Ft,Wt),console.time("drilling down")),this.splitTile(lt.source,Lt,Ft,Wt,re,ae,ge),We>1&&console.timeEnd("drilling down"),this.tiles[Ge]?Kt(this.tiles[Ge],Me):null):null}}function hr(Ne,re,ae){return 32*((1<<Ne)*ae+re)+Ne}class Mr extends b{constructor(re,ae,ge,xe=Cr){super(re,ae,ge),this._dataUpdateable=new Map,this._createGeoJSONIndex=xe}loadVectorTile(re,ae){return a._(this,void 0,void 0,function*(){const ge=re.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const xe=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);if(!xe)return null;const Me=new j(xe.features,{version:2,extent:a.$});let We=function(nt){const Ge=new a.cM;return function(lt,Lt){for(const Ft in lt.layers)Lt.writeMessage(3,H,lt.layers[Ft])}(nt,Ge),Ge.finish()}(Me);return We.byteOffset===0&&We.byteLength===We.buffer.byteLength||(We=new Uint8Array(We)),{vectorTile:Me,rawData:We.buffer}})}loadData(re){return a._(this,void 0,void 0,function*(){var ae;(ae=this._pendingRequest)===null||ae===void 0||ae.abort();const ge=!!(re&&re.request&&re.request.collectResourceTiming)&&new a.cN(re.request);this._pendingRequest=new AbortController;try{(!this._pendingData||re.request||re.data||re.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(re,this._pendingRequest));const xe=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(xe,re),this.loaded={};const Me={data:xe};if(ge){const We=ge.finish();We&&(Me.resourceTiming={},Me.resourceTiming[re.source]=JSON.parse(JSON.stringify(We)))}return Me}catch(xe){if(delete this._pendingRequest,a.cy(xe))return{abandoned:!0};throw xe}})}getData(){return a._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(re){const ae=this.loaded;return ae&&ae[re.uid]?super.reloadTile(re):this.loadTile(re)}loadAndProcessGeoJSON(re,ae){return a._(this,void 0,void 0,function*(){let ge=yield this.loadGeoJSON(re,ae);if(delete this._pendingRequest,typeof ge!="object")throw new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`);if(k(ge,!0),re.filter){const xe=a.cT(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(xe.result==="error")throw new Error(xe.value.map(We=>`${We.key}: ${We.message}`).join(", "));ge={type:"FeatureCollection",features:ge.features.filter(We=>xe.value.evaluate({zoom:0},We))}}return ge})}loadGeoJSON(re,ae){return a._(this,void 0,void 0,function*(){const{promoteId:ge}=re;if(re.request){const xe=yield a.j(re.request,ae);return this._dataUpdateable=a.cV(xe.data,ge)?a.cU(xe.data,ge):void 0,xe.data}if(typeof re.data=="string")try{const xe=JSON.parse(re.data);return this._dataUpdateable=a.cV(xe,ge)?a.cU(xe,ge):void 0,xe}catch{throw new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`)}if(!re.dataDiff)throw new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${re.source}`);return a.cW(this._dataUpdateable,re.dataDiff,ge),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(re){return a._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(re){return this._geoJSONIndex.getClusterExpansionZoom(re.clusterId)}getClusterChildren(re){return this._geoJSONIndex.getChildren(re.clusterId)}getClusterLeaves(re){return this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset)}}function Cr(Ne,re){return re.cluster?new ve(function({superclusterOptions:ae,clusterProperties:ge}){if(!ge||!ae)return ae;const xe={},Me={},We={accumulated:null,zoom:0},nt={properties:null},Ge=Object.keys(ge);for(const lt of Ge){const[Lt,Ft]=ge[lt],Wt=a.cT(Ft),Ze=a.cT(typeof Lt=="string"?[Lt,["accumulated"],["get",lt]]:Lt);xe[lt]=Wt.value,Me[lt]=Ze.value}return ae.map=lt=>{nt.properties=lt;const Lt={};for(const Ft of Ge)Lt[Ft]=xe[Ft].evaluate(We,nt);return Lt},ae.reduce=(lt,Lt)=>{nt.properties=Lt;for(const Ft of Ge)We.accumulated=lt[Ft],lt[Ft]=Me[Ft].evaluate(We,nt)},ae}(re)).load(Ne.features):function(ae,ge){return new ir(ae,ge)}(Ne,re.geojsonVtOptions)}class wr{constructor(re){this.self=re,this.actor=new a.J(re),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(ae,ge)=>{if(this.externalWorkerSourceTypes[ae])throw new Error(`Worker source with name "${ae}" already registered.`);this.externalWorkerSourceTypes[ae]=ge},this.self.addProtocol=a.cA,this.self.removeProtocol=a.cB,this.self.registerRTLTextPlugin=ae=>{a.cX.setMethods(ae)},this.actor.registerMessageHandler("LDT",(ae,ge)=>this._getDEMWorkerSource(ae,ge.source).loadTile(ge)),this.actor.registerMessageHandler("RDT",(ae,ge)=>a._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ae,ge.source).removeTile(ge)})),this.actor.registerMessageHandler("GCEZ",(ae,ge)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(ae,ge.type,ge.source).getClusterExpansionZoom(ge)})),this.actor.registerMessageHandler("GCC",(ae,ge)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(ae,ge.type,ge.source).getClusterChildren(ge)})),this.actor.registerMessageHandler("GCL",(ae,ge)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(ae,ge.type,ge.source).getClusterLeaves(ge)})),this.actor.registerMessageHandler("LD",(ae,ge)=>this._getWorkerSource(ae,ge.type,ge.source).loadData(ge)),this.actor.registerMessageHandler("GD",(ae,ge)=>this._getWorkerSource(ae,ge.type,ge.source).getData()),this.actor.registerMessageHandler("LT",(ae,ge)=>this._getWorkerSource(ae,ge.type,ge.source).loadTile(ge)),this.actor.registerMessageHandler("RT",(ae,ge)=>this._getWorkerSource(ae,ge.type,ge.source).reloadTile(ge)),this.actor.registerMessageHandler("AT",(ae,ge)=>this._getWorkerSource(ae,ge.type,ge.source).abortTile(ge)),this.actor.registerMessageHandler("RMT",(ae,ge)=>this._getWorkerSource(ae,ge.type,ge.source).removeTile(ge)),this.actor.registerMessageHandler("RS",(ae,ge)=>a._(this,void 0,void 0,function*(){if(!this.workerSources[ae]||!this.workerSources[ae][ge.type]||!this.workerSources[ae][ge.type][ge.source])return;const xe=this.workerSources[ae][ge.type][ge.source];delete this.workerSources[ae][ge.type][ge.source],xe.removeSource!==void 0&&xe.removeSource(ge)})),this.actor.registerMessageHandler("RM",ae=>a._(this,void 0,void 0,function*(){delete this.layerIndexes[ae],delete this.availableImages[ae],delete this.workerSources[ae],delete this.demWorkerSources[ae],this.globalStates.delete(ae)})),this.actor.registerMessageHandler("SR",(ae,ge)=>a._(this,void 0,void 0,function*(){this.referrer=ge})),this.actor.registerMessageHandler("SRPS",(ae,ge)=>this._syncRTLPluginState(ae,ge)),this.actor.registerMessageHandler("IS",(ae,ge)=>a._(this,void 0,void 0,function*(){this.self.importScripts(ge)})),this.actor.registerMessageHandler("SI",(ae,ge)=>this._setImages(ae,ge)),this.actor.registerMessageHandler("UL",(ae,ge)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(ae).update(ge.layers,ge.removedIds,this._getGlobalState(ae))})),this.actor.registerMessageHandler("UGS",(ae,ge)=>a._(this,void 0,void 0,function*(){const xe=this._getGlobalState(ae);for(const Me in ge)xe[Me]=ge[Me]})),this.actor.registerMessageHandler("SL",(ae,ge)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(ae).replace(ge,this._getGlobalState(ae))}))}_getGlobalState(re){let ae=this.globalStates.get(re);return ae||(ae={},this.globalStates.set(re,ae)),ae}_setImages(re,ae){return a._(this,void 0,void 0,function*(){this.availableImages[re]=ae;for(const ge in this.workerSources[re]){const xe=this.workerSources[re][ge];for(const Me in xe)xe[Me].availableImages=ae}})}_syncRTLPluginState(re,ae){return a._(this,void 0,void 0,function*(){return yield a.cX.syncState(ae,this.self.importScripts)})}_getAvailableImages(re){let ae=this.availableImages[re];return ae||(ae=[]),ae}_getLayerIndex(re){let ae=this.layerIndexes[re];return ae||(ae=this.layerIndexes[re]=new o),ae}_getWorkerSource(re,ae,ge){if(this.workerSources[re]||(this.workerSources[re]={}),this.workerSources[re][ae]||(this.workerSources[re][ae]={}),!this.workerSources[re][ae][ge]){const xe={sendAsync:(Me,We)=>(Me.targetMapId=re,this.actor.sendAsync(Me,We))};switch(ae){case"vector":this.workerSources[re][ae][ge]=new b(xe,this._getLayerIndex(re),this._getAvailableImages(re));break;case"geojson":this.workerSources[re][ae][ge]=new Mr(xe,this._getLayerIndex(re),this._getAvailableImages(re));break;default:this.workerSources[re][ae][ge]=new this.externalWorkerSourceTypes[ae](xe,this._getLayerIndex(re),this._getAvailableImages(re))}}return this.workerSources[re][ae][ge]}_getDEMWorkerSource(re,ae){return this.demWorkerSources[re]||(this.demWorkerSources[re]={}),this.demWorkerSources[re][ae]||(this.demWorkerSources[re][ae]=new C),this.demWorkerSources[re][ae]}}return a.i(self)&&(self.worker=new wr(self)),wr}),i("index",["exports","./shared"],function(a,o){var u="5.10.0";function d(){var v=new o.A(4);return o.A!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v}let p,b;const C={frame(v,l,f){const m=requestAnimationFrame(B=>{y(),l(B)}),{unsubscribe:y}=o.s(v.signal,"abort",()=>{y(),cancelAnimationFrame(m),f(o.c())},!1)},frameAsync(v){return new Promise((l,f)=>{this.frame(v,l,f)})},getImageData(v,l=0){return this.getImageCanvasContext(v).getImageData(-l,-l,v.width+2*l,v.height+2*l)},getImageCanvasContext(v){const l=window.document.createElement("canvas"),f=l.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return l.width=v.width,l.height=v.height,f.drawImage(v,0,0,v.width,v.height),f},resolveURL:v=>(p||(p=document.createElement("a")),p.href=v,p.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(b==null&&(b=matchMedia("(prefers-reduced-motion: reduce)")),b.matches)}},w=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(v){this._frozenAt=v}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function M(){return w.getCurrentTime()}class P{static testProp(l){if(!P.docStyle)return l[0];for(let f=0;f<l.length;f++)if(l[f]in P.docStyle)return l[f];return l[0]}static create(l,f,m){const y=window.document.createElement(l);return f!==void 0&&(y.className=f),m&&m.appendChild(y),y}static createNS(l,f){return window.document.createElementNS(l,f)}static disableDrag(){P.docStyle&&P.selectProp&&(P.userSelect=P.docStyle[P.selectProp],P.docStyle[P.selectProp]="none")}static enableDrag(){P.docStyle&&P.selectProp&&(P.docStyle[P.selectProp]=P.userSelect)}static setTransform(l,f){l.style[P.transformProp]=f}static addEventListener(l,f,m,y={}){l.addEventListener(f,m,"passive"in y?y:y.capture)}static removeEventListener(l,f,m,y={}){l.removeEventListener(f,m,"passive"in y?y:y.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",P.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",P.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",P.suppressClickInternal,!0)},0)}static getScale(l){const f=l.getBoundingClientRect();return{x:f.width/l.offsetWidth||1,y:f.height/l.offsetHeight||1,boundingClientRect:f}}static getPoint(l,f,m){const y=f.boundingClientRect;return new o.P((m.clientX-y.left)/f.x-l.clientLeft,(m.clientY-y.top)/f.y-l.clientTop)}static mousePos(l,f){const m=P.getScale(l);return P.getPoint(l,m,f)}static touchPos(l,f){const m=[],y=P.getScale(l);for(let B=0;B<f.length;B++)m.push(P.getPoint(l,y,f[B]));return m}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}static sanitize(l){const f=new DOMParser().parseFromString(l,"text/html").body||document.createElement("body"),m=f.querySelectorAll("script");for(const y of m)y.remove();return P.clean(f),f.innerHTML}static isPossiblyDangerous(l,f){const m=f.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(l)||!m.includes("javascript:")&&!m.includes("data:"))||!!l.startsWith("on")||void 0}static clean(l){const f=l.children;for(const m of f)P.removeAttributes(m),P.clean(m)}static removeAttributes(l){for(const{name:f,value:m}of l.attributes)P.isPossiblyDangerous(f,m)&&l.removeAttribute(f)}}P.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,P.selectProp=P.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),P.transformProp=P.testProp(["transform","WebkitTransform"]);const k={supported:!1,testSupport:function(v){!H&&j&&(N?q(v):D=v)}};let D,j,H=!1,N=!1;function q(v){const l=v.createTexture();v.bindTexture(v.TEXTURE_2D,l);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,j),v.isContextLost())return;k.supported=!0}catch{}v.deleteTexture(l),H=!0}var W;typeof document<"u"&&(j=document.createElement("img"),j.onload=()=>{D&&q(D),D=null,N=!0},j.onerror=()=>{H=!0,D=null},j.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(v){let l,f,m,y;v.resetRequestQueue=()=>{l=[],f=0,m=0,y={}},v.addThrottleControl=O=>{const V=m++;return y[V]=O,V},v.removeThrottleControl=O=>{delete y[O],E()},v.getImage=(O,V,G=!0)=>new Promise((J,X)=>{k.supported&&(O.headers||(O.headers={}),O.headers.accept="image/webp,*/*"),o.e(O,{type:"image"}),l.push({abortController:V,requestParameters:O,supportImageRefresh:G,state:"queued",onError:ne=>{X(ne)},onSuccess:ne=>{J(ne)}}),E()});const B=O=>o._(this,void 0,void 0,function*(){O.state="running";const{requestParameters:V,supportImageRefresh:G,onError:J,onSuccess:X,abortController:ne}=O,de=G===!1&&!o.i(self)&&!o.g(V.url)&&(!V.headers||Object.keys(V.headers).reduce((Ie,Oe)=>Ie&&Oe==="accept",!0));f++;const Ee=de?R(V,ne):o.m(V,ne);try{const Ie=yield Ee;delete O.abortController,O.state="completed",Ie.data instanceof HTMLImageElement||o.b(Ie.data)?X(Ie):Ie.data&&X({data:yield(Se=Ie.data,typeof createImageBitmap=="function"?o.f(Se):o.h(Se)),cacheControl:Ie.cacheControl,expires:Ie.expires})}catch(Ie){delete O.abortController,J(Ie)}finally{f--,E()}var Se}),E=()=>{const O=(()=>{for(const V of Object.keys(y))if(y[V]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let V=f;V<O&&l.length>0;V++){const G=l.shift();G.abortController.signal.aborted?V--:B(G)}},R=(O,V)=>new Promise((G,J)=>{const X=new Image,ne=O.url,de=O.credentials;de&&de==="include"?X.crossOrigin="use-credentials":(de&&de==="same-origin"||!o.d(ne))&&(X.crossOrigin="anonymous"),V.signal.addEventListener("abort",()=>{X.src="",J(o.c())}),X.fetchPriority="high",X.onload=()=>{X.onerror=X.onload=null,G({data:X})},X.onerror=()=>{X.onerror=X.onload=null,V.signal.aborted||J(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},X.src=ne})}(W||(W={})),W.resetRequestQueue();class ie{constructor(l){this._transformRequestFn=l??null}transformRequest(l,f){return this._transformRequestFn&&this._transformRequestFn(l,f)||{url:l}}setTransformRequest(l){this._transformRequestFn=l}}function se(v){const l=[];if(typeof v=="string")l.push({id:"default",url:v});else if(v&&v.length>0){const f=[];for(const{id:m,url:y}of v){const B=`${m}${y}`;f.indexOf(B)===-1&&(f.push(B),l.push({id:m,url:y}))}}return l}function Z(v,l,f){try{const m=new URL(v);return m.pathname+=`${l}${f}`,m.toString()}catch{throw new Error(`Invalid sprite URL "${v}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function fe(v){const{userImage:l}=v;return!!(l&&l.render&&l.render())&&(v.data.replace(new Uint8Array(l.data.buffer)),!0)}class te extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:f,promiseResolve:m}of this.requestors)m(this._getImagesForIds(f));this.requestors=[]}}getImage(l){const f=this.images[l];if(f&&!f.data&&f.spriteData){const m=f.spriteData;f.data=new o.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),f.spriteData=null}return f}addImage(l,f){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,f)&&(this.images[l]=f)}_validate(l,f){let m=!0;const y=f.data||f.spriteData;return this._validateStretch(f.stretchX,y&&y.width)||(this.fire(new o.k(new Error(`Image "${l}" has invalid "stretchX" value`))),m=!1),this._validateStretch(f.stretchY,y&&y.height)||(this.fire(new o.k(new Error(`Image "${l}" has invalid "stretchY" value`))),m=!1),this._validateContent(f.content,f)||(this.fire(new o.k(new Error(`Image "${l}" has invalid "content" value`))),m=!1),m}_validateStretch(l,f){if(!l)return!0;let m=0;for(const y of l){if(y[0]<m||y[1]<y[0]||f<y[1])return!1;m=y[1]}return!0}_validateContent(l,f){if(!l)return!0;if(l.length!==4)return!1;const m=f.spriteData,y=m&&m.width||f.data.width,B=m&&m.height||f.data.height;return!(l[0]<0||y<l[0]||l[1]<0||B<l[1]||l[2]<0||y<l[2]||l[3]<0||B<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,f,m=!0){const y=this.getImage(l);if(m&&(y.data.width!==f.data.width||y.data.height!==f.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=y.version+1,this.images[l]=f,this.updatedImages[l]=!0}removeImage(l){const f=this.images[l];delete this.images[l],delete this.patterns[l],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((f,m)=>{let y=!0;if(!this.isLoaded())for(const B of l)this.images[B]||(y=!1);this.isLoaded()||y?f(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:f})})}_getImagesForIds(l){const f={};for(const m of l){let y=this.getImage(m);y||(this.fire(new o.l("styleimagemissing",{id:m})),y=this.getImage(m)),y?f[m]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:o.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:l,height:f}=this.atlasImage;return{width:l,height:f}}getPattern(l){const f=this.patterns[l],m=this.getImage(l);if(!m)return null;if(f&&f.position.version===m.version)return f.position;if(f)f.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},B=new o.I(y,m);this.patterns[l]={bin:y,position:B}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const f=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(l,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const B in this.patterns)l.push(this.patterns[B].bin);const{w:f,h:m}=o.p(l),y=this.atlasImage;y.resize({width:f||1,height:m||1});for(const B in this.patterns){const{bin:E}=this.patterns[B],R=E.x+1,O=E.y+1,V=this.getImage(B).data,G=V.width,J=V.height;o.R.copy(V,y,{x:0,y:0},{x:R,y:O},{width:G,height:J}),o.R.copy(V,y,{x:0,y:J-1},{x:R,y:O-1},{width:G,height:1}),o.R.copy(V,y,{x:0,y:0},{x:R,y:O+J},{width:G,height:1}),o.R.copy(V,y,{x:G-1,y:0},{x:R-1,y:O},{width:1,height:J}),o.R.copy(V,y,{x:0,y:0},{x:R+G,y:O},{width:1,height:J})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const f of l){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const m=this.getImage(f);m||o.w(`Image with ID: "${f}" was not found`),fe(m)&&this.updateImage(f,m)}}}const ce=1e20;function ve(v,l,f,m,y,B,E,R,O){for(let V=l;V<l+m;V++)me(v,f*B+V,B,y,E,R,O);for(let V=f;V<f+y;V++)me(v,V*B+l,1,m,E,R,O)}function me(v,l,f,m,y,B,E){B[0]=0,E[0]=-ce,E[1]=ce,y[0]=v[l];for(let R=1,O=0,V=0;R<m;R++){y[R]=v[l+R*f];const G=R*R;do{const J=B[O];V=(y[R]-y[J]+G-J*J)/(R-J)/2}while(V<=E[O]&&--O>-1);O++,B[O]=R,E[O]=V,E[O+1]=ce}for(let R=0,O=0;R<m;R++){for(;E[O+1]<R;)O++;const V=B[O],G=R-V;v[l+R*f]=y[V]+G*G}}class qe{constructor(l,f,m){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={},this.lang=m}setURL(l){this.url=l}getGlyphs(l){return o._(this,void 0,void 0,function*(){const f=[];for(const B in l)for(const E of l[B])f.push(this._getAndCacheGlyphsPromise(B,E));const m=yield Promise.all(f),y={};for(const{stack:B,id:E,glyph:R}of m)y[B]||(y[B]={}),y[B][E]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};return y})}_getAndCacheGlyphsPromise(l,f){return o._(this,void 0,void 0,function*(){let m=this.entries[l];m||(m=this.entries[l]={glyphs:{},requests:{},ranges:{}});let y=m.glyphs[f];if(y!==void 0)return{stack:l,id:f,glyph:y};if(y=this._tinySDF(m,l,f),y)return m.glyphs[f]=y,{stack:l,id:f,glyph:y};const B=Math.floor(f/256);if(256*B>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[B])return{stack:l,id:f,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[B]){const R=qe.loadGlyphRange(l,B,this.url,this.requestManager);m.requests[B]=R}const E=yield m.requests[B];for(const R in E)this._doesCharSupportLocalGlyph(+R)||(m.glyphs[+R]=E[+R]);return m.ranges[B]=!0,{stack:l,id:f,glyph:E[f]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(l))||o.u["CJK Unified Ideographs"](l)||o.u["Hangul Syllables"](l)||o.u.Hiragana(l)||o.u.Katakana(l)||o.u["CJK Symbols and Punctuation"](l)||o.u["Halfwidth and Fullwidth Forms"](l))}_tinySDF(l,f,m){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(m))return;let B=l.tinySDF;if(!B){let R="400";/bold/i.test(f)?R="900":/medium/i.test(f)?R="500":/light/i.test(f)&&(R="200"),B=l.tinySDF=new qe.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:y,fontWeight:R})}const E=B.draw(String.fromCharCode(m));return{id:m,bitmap:new o.q({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}qe.loadGlyphRange=function(v,l,f,m){return o._(this,void 0,void 0,function*(){const y=256*l,B=y+255,E=m.transformRequest(f.replace("{fontstack}",v).replace("{range}",`${y}-${B}`),"Glyphs"),R=yield o.n(E,new AbortController);if(!R||!R.data)throw new Error(`Could not load glyph range. range: ${l}, ${y}-${B}`);const O={};for(const V of o.o(R.data))O[V.id]=V;return O})},qe.TinySDF=class{constructor({fontSize:v=24,buffer:l=3,radius:f=8,cutoff:m=.25,fontFamily:y="sans-serif",fontWeight:B="normal",fontStyle:E="normal",lang:R=null}={}){this.buffer=l,this.cutoff=m,this.radius=f,this.lang=R;const O=this.size=v+4*l,V=this._createCanvas(O),G=this.ctx=V.getContext("2d",{willReadFrequently:!0});G.font=`${E} ${B} ${v}px ${y}`,G.textBaseline="alphabetic",G.textAlign="left",G.fillStyle="black",this.gridOuter=new Float64Array(O*O),this.gridInner=new Float64Array(O*O),this.f=new Float64Array(O),this.z=new Float64Array(O+1),this.v=new Uint16Array(O)}_createCanvas(v){const l=document.createElement("canvas");return l.width=l.height=v,l}draw(v){const{width:l,actualBoundingBoxAscent:f,actualBoundingBoxDescent:m,actualBoundingBoxLeft:y,actualBoundingBoxRight:B}=this.ctx.measureText(v),E=Math.ceil(f),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(B-y))),O=Math.min(this.size-this.buffer,E+Math.ceil(m)),V=R+2*this.buffer,G=O+2*this.buffer,J=Math.max(V*G,0),X=new Uint8ClampedArray(J),ne={data:X,width:V,height:G,glyphWidth:R,glyphHeight:O,glyphTop:E,glyphLeft:0,glyphAdvance:l};if(R===0||O===0)return ne;const{ctx:de,buffer:Ee,gridInner:Se,gridOuter:Ie}=this;this.lang&&(de.lang=this.lang),de.clearRect(Ee,Ee,R,O),de.fillText(v,Ee,Ee+E);const Oe=de.getImageData(Ee,Ee,R,O);Ie.fill(ce,0,J),Se.fill(0,0,J);for(let je=0;je<O;je++)for(let De=0;De<R;De++){const $e=Oe.data[4*(je*R+De)+3]/255;if($e===0)continue;const Je=(je+Ee)*V+De+Ee;if($e===1)Ie[Je]=0,Se[Je]=ce;else{const Qe=.5-$e;Ie[Je]=Qe>0?Qe*Qe:0,Se[Je]=Qe<0?Qe*Qe:0}}ve(Ie,0,0,V,G,V,this.f,this.v,this.z),ve(Se,Ee,Ee,R,O,V,this.f,this.v,this.z);for(let je=0;je<J;je++){const De=Math.sqrt(Ie[je])-Math.sqrt(Se[je]);X[je]=Math.round(255-255*(De/this.radius+this.cutoff))}return ne}};class ot{constructor(){this.specification=o.v.light.position}possiblyEvaluate(l,f){return o.B(l.expression.evaluate(f))}interpolate(l,f,m){return{x:o.C.number(l.x,f.x,m),y:o.C.number(l.y,f.y,m),z:o.C.number(l.z,f.z,m)}}}let st;class Ye extends o.E{constructor(l){super(),st=st||new o.r({anchor:new o.D(o.v.light.anchor),position:new ot,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.t(st,void 0),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,f={}){if(!this._validate(o.x,l,f))for(const m in l){const y=l[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,m){return(!m||m.validate!==!1)&&o.y(this,l.call(o.z,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const Xe=new o.r({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class wt extends o.E{constructor(l){super(),this._transitionable=new o.t(Xe,void 0),this.setSky(l),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0))}setSky(l,f={}){if(!this._validate(o.G,l,f)){l||(l={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const m in l){const y=l[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,m={}){return m?.validate!==!1&&o.y(this,l.call(o.z,o.e({value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(l){return l<60?0:l<70?(l-60)/10:1}}class ht{constructor(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,f){const m=l.join(",")+String(f);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(l,f)),this.dashEntry[m]}getDashRanges(l,f,m){const y=[];let B=l.length%2==1?-l[l.length-1]*m:0,E=l[0]*m,R=!0;y.push({left:B,right:E,isDash:R,zeroLength:l[0]===0});let O=l[0];for(let V=1;V<l.length;V++){R=!R;const G=l[V];B=O*m,O+=G,E=O*m,y.push({left:B,right:E,isDash:R,zeroLength:G===0})}return y}addRoundDash(l,f,m){const y=f/2;for(let B=-m;B<=m;B++){const E=this.width*(this.nextRow+m+B);let R=0,O=l[R];for(let V=0;V<this.width;V++){V/O.right>1&&(O=l[++R]);const G=Math.abs(V-O.left),J=Math.abs(V-O.right),X=Math.min(G,J);let ne;const de=B/m*(y+1);if(O.isDash){const Ee=y-Math.abs(de);ne=Math.sqrt(X*X+Ee*Ee)}else ne=y-Math.sqrt(X*X+de*de);this.data[E+V]=Math.max(0,Math.min(255,ne+128))}}}addRegularDash(l){for(let R=l.length-1;R>=0;--R){const O=l[R],V=l[R+1];O.zeroLength?l.splice(R,1):V&&V.isDash===O.isDash&&(V.left=O.left,l.splice(R,1))}const f=l[0],m=l[l.length-1];f.isDash===m.isDash&&(f.left=m.left-this.width,m.right=f.right+this.width);const y=this.width*this.nextRow;let B=0,E=l[B];for(let R=0;R<this.width;R++){R/E.right>1&&(E=l[++B]);const O=Math.abs(R-E.left),V=Math.abs(R-E.right),G=Math.min(O,V);this.data[y+R]=Math.max(0,Math.min(255,(E.isDash?G:-G)+128))}}addDash(l,f){const m=f?7:0,y=2*m+1;if(this.nextRow+y>this.height)return o.w("LineAtlas out of space"),null;let B=0;for(let R=0;R<l.length;R++)B+=l[R];if(B!==0){const R=this.width/B,O=this.getDashRanges(l,this.width,R);f?this.addRoundDash(O,R,m):this.addRegularDash(O)}const E={y:this.nextRow+m,height:2*m,width:B};return this.nextRow+=y,this.dirty=!0,E}bind(l){const f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const he="maplibre_preloaded_worker_pool";class Be{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<Be.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[he]}numActive(){return Object.keys(this.active).length}}const Le=Math.floor(C.hardwareConcurrency/2);let He,rt;function it(){return He||(He=new Be),He}Be.workerCount=o.H(globalThis)?Math.max(Math.min(Le,3),1):1;class Pt{constructor(l,f){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=f;const m=this.workerPool.acquire(f);for(let y=0;y<m.length;y++){const B=new o.J(m[y],f);B.name=`Worker ${y}`,this.actors.push(B)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,f){const m=[];for(const y of this.actors)m.push(y.sendAsync({type:l,data:f}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(l=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,f){for(const m of this.actors)m.registerMessageHandler(l,f)}}function Bt(){return rt||(rt=new Pt(it(),o.K),rt.registerMessageHandler("GR",(v,l,f)=>o.m(l,f))),rt}function Dt(v,l){const f=o.L();return o.M(f,f,[1,1,0]),o.N(f,f,[.5*v.width,.5*v.height,1]),v.calculatePosMatrix?o.O(f,f,v.calculatePosMatrix(l.toUnwrapped())):f}function Yt(v,l,f,m,y,B,E){var R;const O=function(X,ne,de){if(X)for(const Ee of X){const Se=ne[Ee];if(Se&&Se.source===de&&Se.type==="fill-extrusion")return!0}else for(const Ee in ne){const Se=ne[Ee];if(Se.source===de&&Se.type==="fill-extrusion")return!0}return!1}((R=y?.layers)!==null&&R!==void 0?R:null,l,v.id),V=B.maxPitchScaleFactor(),G=v.tilesIn(m,V,O);G.sort(nr);const J=[];for(const X of G)J.push({wrappedTileID:X.tileID.wrapped().key,queryResults:X.tile.queryRenderedFeatures(l,f,v._state,X.queryGeometry,X.cameraQueryGeometry,X.scale,y,B,V,Dt(v.transform,X.tileID),E?(ne,de)=>E(X.tileID,ne,de):void 0)});return function(X,ne){for(const de in X)for(const Ee of X[de])ur(Ee,ne);return X}(function(X){const ne={},de={};for(const Ee of X){const Se=Ee.queryResults,Ie=Ee.wrappedTileID,Oe=de[Ie]=de[Ie]||{};for(const je in Se){const De=Se[je],$e=Oe[je]=Oe[je]||{},Je=ne[je]=ne[je]||[];for(const Qe of De)$e[Qe.featureIndex]||($e[Qe.featureIndex]=!0,Je.push(Qe))}}return ne}(J),v)}function nr(v,l){const f=v.tileID,m=l.tileID;return f.overscaledZ-m.overscaledZ||f.canonical.y-m.canonical.y||f.wrap-m.wrap||f.canonical.x-m.canonical.x}function ur(v,l){const f=v.feature,m=l.getFeatureState(f.layer["source-layer"],f.id);f.source=f.layer.source,f.layer["source-layer"]&&(f.sourceLayer=f.layer["source-layer"]),f.state=m}function xt(v,l,f){return o._(this,void 0,void 0,function*(){let m=v;if(v.url?m=(yield o.j(l.transformRequest(v.url,"Source"),f)).data:yield C.frameAsync(f),!m)return null;const y=o.Q(o.e(m,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(y.vectorLayerIds=m.vector_layers.map(B=>B.id)),y})}class Re{constructor(l,f){l&&(f?this.setSouthWest(l).setNorthEast(f):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof o.S?new o.S(l.lng,l.lat):o.S.convert(l),this}setSouthWest(l){return this._sw=l instanceof o.S?new o.S(l.lng,l.lat):o.S.convert(l),this}extend(l){const f=this._sw,m=this._ne;let y,B;if(l instanceof o.S)y=l,B=l;else{if(!(l instanceof Re))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(Re.convert(l)):this.extend(o.S.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(o.S.convert(l)):this;if(y=l._sw,B=l._ne,!y||!B)return this}return f||m?(f.lng=Math.min(y.lng,f.lng),f.lat=Math.min(y.lat,f.lat),m.lng=Math.max(B.lng,m.lng),m.lat=Math.max(B.lat,m.lat)):(this._sw=new o.S(y.lng,y.lat),this._ne=new o.S(B.lng,B.lat)),this}getCenter(){return new o.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.S(this.getWest(),this.getNorth())}getSouthEast(){return new o.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:f,lat:m}=o.S.convert(l);let y=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&y}static convert(l){return l instanceof Re?l:l&&new Re(l)}static fromLngLat(l,f=0){const m=360*f/40075017,y=m/Math.cos(Math.PI/180*l.lat);return new Re(new o.S(l.lng-y,l.lat-m),new o.S(l.lng+y,l.lat+m))}adjustAntiMeridian(){const l=new o.S(this._sw.lng,this._sw.lat),f=new o.S(this._ne.lng,this._ne.lat);return new Re(l,l.lng>f.lng?new o.S(f.lng+360,f.lat):f)}}class Kr{constructor(l,f,m){this.bounds=Re.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=m||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const f=Math.pow(2,l.z),m=Math.floor(o.V(this.bounds.getWest())*f),y=Math.floor(o.U(this.bounds.getNorth())*f),B=Math.ceil(o.V(this.bounds.getEast())*f),E=Math.ceil(o.U(this.bounds.getSouth())*f);return l.x>=m&&l.x<B&&l.y>=y&&l.y<E}}class Ur extends o.E{constructor(l,f,m,y){if(super(),this.id=l,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.Q(f,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield xt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(o.e(this,l),l.bounds&&(this.tileBounds=new Kr(l.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this._loaded=!0,this.fire(new o.k(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(l){return o._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(f,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};m.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((B,E)=>{l.reloadPromise={resolve:B,reject:E}})}else l.actor=this.dispatcher.getActor(),y="LT";l.abortController=new AbortController;try{const B=yield l.actor.sendAsync({type:y,data:m},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,B)}catch(B){if(delete l.abortController,l.aborted)return;if(B&&B.status!==404)throw B;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,f){if(f&&f.resourceTiming&&(l.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&l.setExpiryData(f),l.loadVectorData(f,this.map.painter),l.reloadPromise){const m=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(m.resolve).catch(m.reject)}}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Er extends o.E{constructor(l,f,m,y){super(),this.id=l,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},f),o.e(this,o.Q(f,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,function*(l=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const f=yield xt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,f&&(o.e(this,f),f.bounds&&(this.tileBounds=new Kr(f.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:l})))}catch(f){this._tileJSONRequest=null,this._loaded=!0,this.fire(new o.k(f))}})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load(!0)}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return o.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return o._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const m=yield W.getImage(this.map._requestManager.transformRequest(f,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&(m.cacheControl||m.expires)&&l.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const y=this.map.painter.context,B=y.gl,E=m.data;l.texture=this.map.painter.getTileTexture(E.width),l.texture?l.texture.update(E,{useMipmap:!0}):(l.texture=new o.T(y,E,B.RGBA,{useMipmap:!0}),l.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE,B.LINEAR_MIPMAP_NEAREST)),l.state="loaded"}}catch(m){if(delete l.abortController,l.aborted)l.state="unloaded";else if(m)throw l.state="errored",m}})}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class Kt extends Er{constructor(l,f,m,y){super(l,f,m,y),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(l){return o._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(f,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const y=yield W.getImage(m,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(y&&y.data){const B=y.data;this.map._refreshExpiredTiles&&(y.cacheControl||y.expires)&&l.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const E=o.b(B)&&o.W()?B:yield this.readImageNow(B),R={type:this.type,uid:l.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const O=yield l.actor.sendAsync({type:"LDT",data:R});l.dem=O,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(y){if(delete l.abortController,l.aborted)l.state="unloaded";else if(y)throw l.state="errored",y}})}readImageNow(l){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.X()){const f=l.width+2,m=l.height+2;try{return new o.R({width:f,height:m},yield o.Y(l,-1,-1,f,m))}catch{}}return C.getImageData(l,1)})}_getNeighboringTiles(l){const f=l.canonical,m=Math.pow(2,f.z),y=(f.x-1+m)%m,B=f.x===0?l.wrap-1:l.wrap,E=(f.x+1+m)%m,R=f.x+1===m?l.wrap+1:l.wrap,O={};return O[new o.Z(l.overscaledZ,B,f.z,y,f.y).key]={backfilled:!1},O[new o.Z(l.overscaledZ,R,f.z,E,f.y).key]={backfilled:!1},f.y>0&&(O[new o.Z(l.overscaledZ,B,f.z,y,f.y-1).key]={backfilled:!1},O[new o.Z(l.overscaledZ,l.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},O[new o.Z(l.overscaledZ,R,f.z,E,f.y-1).key]={backfilled:!1}),f.y+1<m&&(O[new o.Z(l.overscaledZ,B,f.z,y,f.y+1).key]={backfilled:!1},O[new o.Z(l.overscaledZ,l.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},O[new o.Z(l.overscaledZ,R,f.z,E,f.y+1).key]={backfilled:!1}),O}unloadTile(l){return o._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class Br extends o.E{constructor(l,f,m,y){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:f.data},this.actor=m.getActor(),this.setEventedParent(y),this._data=f.data,this._options=o.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId,f.clusterMaxZoom!==void 0&&this.maxzoom<=f.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${f.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(f.buffer!==void 0?f.buffer:128),tolerance:this._pixelsToTileUnits(f.tolerance!==void 0?f.tolerance:.375),extent:o.$,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(f.clusterMaxZoom),minPoints:Math.max(2,f.clusterMinPoints||2),extent:o.$,radius:this._pixelsToTileUnits(f.clusterRadius||50),log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(l){return l*(o.$/this.tileSize)}_getClusterMaxZoom(l){const f=l?Math.round(l):this.maxzoom-1;return Number.isInteger(l)||l===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${l}" rounded to "${f}"`),f}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._pendingWorkerUpdate={data:l},this._updateWorkerData(),this}updateData(l){return this._pendingWorkerUpdate.diff=o.a0(this._pendingWorkerUpdate.diff,l),this._updateWorkerData(),this}getData(){return o._(this,void 0,void 0,function*(){const l=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:l})})}getCoordinatesFromGeometry(l){return l.type==="GeometryCollection"?l.geometries.map(f=>f.coordinates).flat(1/0):l.coordinates.flat(1/0)}getBounds(){return o._(this,void 0,void 0,function*(){const l=new Re,f=yield this.getData();let m;switch(f.type){case"FeatureCollection":m=f.features.map(y=>this.getCoordinatesFromGeometry(y.geometry)).flat(1/0);break;case"Feature":m=this.getCoordinatesFromGeometry(f.geometry);break;default:m=this.getCoordinatesFromGeometry(f)}if(m.length==0)return l;for(let y=0;y<m.length-1;y+=2)l.extend([m[y],m[y+1]]);return l})}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(l.clusterRadius)),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(l.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,f,m){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:f,offset:m}})}_updateWorkerData(){return o._(this,void 0,void 0,function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void o.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:l,diff:f}=this._pendingWorkerUpdate,m=o.e({type:this.type},this.workerOptions);l?(typeof l=="string"?(m.request=this.map._requestManager.transformRequest(C.resolveURL(l),"Source"),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(l),this._pendingWorkerUpdate.data=void 0):f&&(m.dataDiff=f,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new o.l("dataloading",{dataType:"source"}));try{const y=yield this.actor.sendAsync({type:"LD",data:m});if(this._isUpdatingWorker=!1,this._removed||y.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));this._data=y.data;let B=null;y.resourceTiming&&y.resourceTiming[this.id]&&(B=y.resourceTiming[this.id].slice(0));const E={dataType:"source"};this._collectResourceTiming&&B&&B.length>0&&o.e(E,{resourceTiming:B}),this.fire(new o.l("data",Object.assign(Object.assign({},E),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},E),{sourceDataType:"content"})))}catch(y){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(y))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}})}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(l){return o._(this,void 0,void 0,function*(){const f=l.actor?"RT":"LT";l.actor=this.actor;const m={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};l.abortController=new AbortController;const y=yield this.actor.sendAsync({type:f,data:m},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(y,this.map.painter,f==="RT")})}abortTile(l){return o._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return o._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class ar extends o.E{constructor(l,f,m,y){super(),this.flippedWindingOrder=!1,this.id=l,this.dispatcher=m,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=f}load(l){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield W.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,l&&(this.coordinates=l),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,this.fire(new o.k(f))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const f=l.map(o.a1.fromLngLat);var m;return this.tileID=function(y){const B=o.a2.fromPoints(y),E=B.width(),R=B.height(),O=Math.max(E,R),V=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),G=Math.pow(2,V);return new o.a4(V,Math.floor((B.minX+B.maxX)/2*G),Math.floor((B.minY+B.maxY)/2*G))}(f),this.terrainTileRanges=this._getOverlappingTileRanges(f),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=f.map(y=>this.tileID.getTilePoint(y)._round()),this.flippedWindingOrder=((m=this.tileCoords)[1].x-m[0].x)*(m[2].y-m[0].y)-(m[1].y-m[0].y)*(m[2].x-m[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,f=l.gl;this.texture||(this.texture=new o.T(l,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let m=!1;for(const y in this.tiles){const B=this.tiles[y];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture,m=!0)}m&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(l){const{minX:f,minY:m,maxX:y,maxY:B}=o.a2.fromPoints(l),E={};for(let R=0;R<=o.a3;R++){const O=Math.pow(2,R),V=Math.floor(f*O),G=Math.floor(m*O),J=Math.floor(y*O),X=Math.floor(B*O);E[R]={minTileX:V,minTileY:G,maxTileX:J,maxTileY:X}}return E}}class Lr extends ar{constructor(l,f,m,y){super(l,f,m,y),this.roundZoom=!0,this.type="video",this.options=f}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const f of l.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield o.a5(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new o.k(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const f=this.video.seekable;l<f.start(0)||l>f.end(0)?this.fire(new o.k(new o.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,f=l.gl;this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(l,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let m=!1;for(const y in this.tiles){const B=this.tiles[y];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture,m=!0)}m&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class vr extends ar{constructor(l,f,m,y){super(l,f,m,y),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(B=>!Array.isArray(B)||B.length!==2||B.some(E=>typeof E!="number"))||this.fire(new o.k(new o.a6(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.a6(`sources.${l}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new o.k(new o.a6(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.a6(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.a6(`sources.${l}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,m=f.gl;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(f,this.canvas,m.RGBA,{premultiply:!0});let y=!1;for(const B in this.tiles){const E=this.tiles[B];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,y=!0)}y&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const kt={},ir=v=>{switch(v){case"geojson":return Br;case"image":return ar;case"raster":return Er;case"raster-dem":return Kt;case"vector":return Ur;case"video":return Lr;case"canvas":return vr}return kt[v]},hr="RTLPluginLoaded";class Mr extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Bt()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return o._(this,arguments,void 0,function*(f,m=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=C.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!m)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(hr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Cr=null;function wr(){return Cr||(Cr=new Mr),Cr}var Ne,re;(function(v){v[v.Base=0]="Base",v[v.Parent=1]="Parent"})(Ne||(Ne={})),function(v){v[v.Departing=0]="Departing",v[v.Incoming=1]="Incoming"}(re||(re={}));class ae{constructor(l,f){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=l,this.uid=o.a7(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(l){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(l||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:l,fadingDirection:f,fadingParentID:m,fadeEndTime:y}){this.resetFadeLogic(),this.fadingRole=l,this.fadingDirection=f,this.fadingParentID=m,this.fadeEndTime=y}setSelfFadeLogic(l){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=l}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=M(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,f,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(y,B){const E={};if(!B)return E;for(const R of y){const O=R.layerIds.map(V=>B.getLayer(V)).filter(Boolean);if(O.length!==0){R.layers=O,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map(V=>O.filter(G=>G.id===V)[0]));for(const V of O)E[V.id]=R}}return E}(l.buckets,f?.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const B=this.buckets[y];if(B instanceof o.a9){if(this.hasSymbolBuckets=!0,!m)break;B.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const B=this.buckets[y];if(B instanceof o.a9&&B.hasRTLText){this.hasRTLText=!0,wr().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const B=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(y).queryRadius(B))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage),this.dashPositions=l.dashPositions}else this.collisionBoxArray=new o.a8}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const m in this.buckets){const y=this.buckets[m];y.uploadPending()&&y.upload(l)}const f=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(l,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(l,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,f,m,y,B,E,R,O,V,G,J){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:B,scale:E,tileSize:this.tileSize,pixelPosMatrix:G,transform:O,params:R,queryPadding:this.queryPadding*V,getElevation:J},l,f,m):{}}querySourceFeatures(l,f){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const y=m.loadVTLayers(),B=f&&f.sourceLayer?f.sourceLayer:"",E=y._geojsonTileLayer||y[B];if(!E)return;const R=o.aa(f?.filter,f?.globalState),{z:O,x:V,y:G}=this.tileID.canonical,J={z:O,x:V,y:G};for(let X=0;X<E.length;X++){const ne=E.feature(X);if(R.needGeometry){const Se=o.ab(ne,!0);if(!R.filter(new o.F(this.tileID.overscaledZ),Se,this.tileID.canonical))continue}else if(!R.filter(new o.F(this.tileID.overscaledZ),ne))continue;const de=m.getId(ne,B),Ee=new o.ac(ne,O,V,G,de);Ee.tile=J,l.push(Ee)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const f=this.expirationTime;if(l.cacheControl){const m=o.ad(l.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const m=Date.now();let y=!1;if(this.expirationTime>m)y=!1;else if(f)if(this.expirationTime<f)y=!0;else{const B=this.expirationTime-f;B?this.expirationTime=m+Math.max(B,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!f.style.hasLayer(y))continue;const B=this.buckets[y],E=B.layers[0].sourceLayer||"_geojsonTileLayer",R=m[E],O=l[E];if(!R||!O||Object.keys(O).length===0)continue;B.update(O,R,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const V=f&&f.style&&f.style.getLayer(y);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(B)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<M()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(l){this.symbolFadeHoldUntil=M()+l}setDependencies(l,f){const m={};for(const y of f)m[y]=!0;this.dependencies[l]=m}hasDependency(l,f){for(const m of l){const y=this.dependencies[m];if(y){for(const B of f)if(y[B])return!0}}return!1}}class ge{constructor(l,f){this.max=l,this.onRemove=f,this.reset()}reset(){for(const l in this.data)for(const f of this.data[l])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(l,f,m){const y=l.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const B={value:f,timeout:void 0};if(m!==void 0&&(B.timeout=setTimeout(()=>{this.remove(l,B)},m)),this.data[y].push(B),this.order.push(y),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value}getByKey(l){const f=this.data[l];return f?f[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,f){if(!this.has(l))return this;const m=l.wrapped().key,y=f===void 0?0:this.data[m].indexOf(f),B=this.data[m][y];return this.data[m].splice(y,1),B.timeout&&clearTimeout(B.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(B.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(l){const f=[];for(const m in this.data)for(const y of this.data[m])l(y.value)||f.push(y);for(const m of f)this.remove(m.value.tileID,m)}}class xe{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,f,m){const y=String(f);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][y]=this.stateChanges[l][y]||{},o.e(this.stateChanges[l][y],m),this.deletedStates[l]===null){this.deletedStates[l]={};for(const B in this.state[l])B!==y&&(this.deletedStates[l][B]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][y]===null){this.deletedStates[l][y]={};for(const B in this.state[l][y])m[B]||(this.deletedStates[l][y][B]=null)}else for(const B in m)this.deletedStates[l]&&this.deletedStates[l][y]&&this.deletedStates[l][y][B]===null&&delete this.deletedStates[l][y][B]}removeFeatureState(l,f,m){if(this.deletedStates[l]===null)return;const y=String(f);if(this.deletedStates[l]=this.deletedStates[l]||{},m&&f!==void 0)this.deletedStates[l][y]!==null&&(this.deletedStates[l][y]=this.deletedStates[l][y]||{},this.deletedStates[l][y][m]=null);else if(f!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][y])for(m in this.deletedStates[l][y]={},this.stateChanges[l][y])this.deletedStates[l][y][m]=null;else this.deletedStates[l][y]=null;else this.deletedStates[l]=null}getState(l,f){const m=String(f),y=o.e({},(this.state[l]||{})[m],(this.stateChanges[l]||{})[m]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const B=this.deletedStates[l][f];if(B===null)return{};for(const E in B)delete y[E]}return y}initializeTileState(l,f){l.setFeatureState(this.state,f)}coalesceChanges(l,f){const m={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const B={};for(const E in this.stateChanges[y])this.state[y][E]||(this.state[y][E]={}),o.e(this.state[y][E],this.stateChanges[y][E]),B[E]=this.state[y][E];m[y]=B}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const B={};if(this.deletedStates[y]===null)for(const E in this.state[y])B[E]={},this.state[y][E]={};else for(const E in this.deletedStates[y]){if(this.deletedStates[y][E]===null)this.state[y][E]={};else for(const R of Object.keys(this.deletedStates[y][E]))delete this.state[y][E][R];B[E]=this.state[y][E]}m[y]=m[y]||{},o.e(m[y],B)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const y in l)l[y].setFeatureState(m,f)}}const Me=89.25;function We(v,l){const f=o.ae(l.lat,-o.af,o.af);return new o.P(o.V(l.lng)*v,o.U(f)*v)}function nt(v,l){return new o.a1(l.x/v,l.y/v).toLngLat()}function Ge(v){return v.cameraToCenterDistance*Math.min(.85*Math.tan(o.ag(90-v.pitch)),Math.tan(o.ag(Me-v.pitch)))}function lt(v,l){const f=v.canonical,m=l/o.ah(f.z),y=f.x+Math.pow(2,f.z)*v.wrap,B=o.ai(new Float64Array(16));return o.M(B,B,[y*m,f.y*m,0]),o.N(B,B,[m/o.$,m/o.$,1]),B}function Lt(v,l,f,m,y){const B=o.a1.fromLngLat(v,l),E=y*o.aj(1,v.lat),R=E*Math.cos(o.ag(f)),O=Math.sqrt(E*E-R*R),V=O*Math.sin(o.ag(-m)),G=O*Math.cos(o.ag(-m));return new o.a1(B.x+V,B.y+G,B.z+R)}function Ft(v,l,f){const m=l.intersectsFrustum(v);if(!f||m===0)return m;const y=l.intersectsPlane(f);return y===0?0:m===2&&y===2?2:1}function Wt(v,l,f){let m=0;const y=(f-l)/10;for(let B=0;B<10;B++)m+=y*Math.pow(Math.cos(l+(B+.5)/10*(f-l)),v);return m}function Ze(v,l){return function(f,m,y,B,E){const R=2*((v-1)/o.ak(Math.cos(o.ag(Me-E))/Math.cos(o.ag(Me)))-1),O=Math.acos(y/B),V=2*Wt(R-1,0,o.ag(E/2)),G=Math.min(o.ag(Me),O+o.ag(E/2)),J=Wt(R-1,Math.min(G,O-o.ag(E/2)),G),X=Math.atan(m/y),ne=Math.hypot(m,y);let de=f;return de+=o.ak(B/ne/Math.max(.5,Math.cos(o.ag(E/2)))),de+=R*o.ak(Math.cos(X))/2,de-=o.ak(Math.max(1,J/V/l))/2,de}}const Sr=Ze(9.314,3);function an(v,l){const f=(l.roundZoom?Math.round:Math.floor)(v.zoom+o.ak(v.tileSize/l.tileSize));return Math.max(0,f)}function yr(v,l){const f=v.getCameraFrustum(),m=v.getClippingPlane(),y=v.screenPointToMercatorCoordinate(v.getCameraPoint()),B=o.a1.fromLngLat(v.center,v.elevation);y.z=B.z+Math.cos(v.pitchInRadians)*v.cameraToCenterDistance/v.worldSize;const E=v.getCoveringTilesDetailsProvider(),R=E.allowVariableZoom(v,l),O=an(v,l),V=l.minzoom||0,G=l.maxzoom!==void 0?l.maxzoom:v.maxZoom,J=Math.min(Math.max(0,O),G),X=Math.pow(2,J),ne=[X*y.x,X*y.y,0],de=[X*B.x,X*B.y,0],Ee=Math.hypot(B.x-y.x,B.y-y.y),Se=Math.abs(B.z-y.z),Ie=Math.hypot(Ee,Se),Oe=$e=>({zoom:0,x:0,y:0,wrap:$e,fullyVisible:!1}),je=[],De=[];if(v.renderWorldCopies&&E.allowWorldCopies())for(let $e=1;$e<=3;$e++)je.push(Oe(-$e)),je.push(Oe($e));for(je.push(Oe(0));je.length>0;){const $e=je.pop(),Je=$e.x,Qe=$e.y;let at=$e.fullyVisible;const Mt={x:Je,y:Qe,z:$e.zoom},yt=E.getTileBoundingVolume(Mt,$e.wrap,v.elevation,l);if(!at){const rr=Ft(f,yt,m);if(rr===0)continue;at=rr===2}const bt=E.distanceToTile2d(y.x,y.y,Mt,yt);let Ct=O;R&&(Ct=(l.calculateTileZoom||Sr)(v.zoom+o.ak(v.tileSize/l.tileSize),bt,Se,Ie,v.fov)),Ct=(l.roundZoom?Math.round:Math.floor)(Ct),Ct=Math.max(0,Ct);const Zt=Math.min(Ct,G);if($e.wrap=E.getWrap(B,Mt,$e.wrap),$e.zoom>=Zt){if($e.zoom<V)continue;const rr=J-$e.zoom,$t=ne[0]-.5-(Je<<rr),Tr=ne[1]-.5-(Qe<<rr),tn=l.reparseOverscaled?Math.max($e.zoom,Ct):$e.zoom;De.push({tileID:new o.Z($e.zoom===G?tn:$e.zoom,$e.wrap,$e.zoom,Je,Qe),distanceSq:o.al([de[0]-.5-Je,de[1]-.5-Qe]),tileDistanceToCamera:Math.sqrt($t*$t+Tr*Tr)})}else for(let rr=0;rr<4;rr++)je.push({zoom:$e.zoom+1,x:(Je<<1)+rr%2,y:(Qe<<1)+(rr>>1),wrap:$e.wrap,fullyVisible:at})}return De.sort(($e,Je)=>$e.distanceSq-Je.distanceSq).map($e=>$e.tileID)}const sn=o.a2.fromPoints([new o.P(0,0),new o.P(o.$,o.$)]);class fn extends o.E{constructor(l,f,m){super(),this.id=l,this.dispatcher=m,this.on("data",y=>this._dataHandler(y)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((y,B,E,R)=>{const O=new(ir(B.type))(y,B,E,R);if(O.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${O.id}`);return O})(l,f,m,this),this._tiles={},this._cache=new ge(0,y=>this._unloadTile(y)),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new xe,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const f=this._tiles[l];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,f,m){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,f,m)}catch(y){l.state="errored",y.status!==404?this._source.fire(new o.k(y,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new o.l("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const m=this._tiles[f];m.upload(l),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(Ir).map(l=>l.key)}getRenderableIds(l){const f=[];for(const m in this._tiles)this._isIdRenderable(m,l)&&f.push(this._tiles[m]);return l?f.sort((m,y)=>{const B=m.tileID,E=y.tileID,R=new o.P(B.canonical.x,B.canonical.y)._rotate(-this.transform.bearingInRadians),O=new o.P(E.canonical.x,E.canonical.y)._rotate(-this.transform.bearingInRadians);return B.overscaledZ-E.overscaledZ||O.y-R.y||O.x-R.x}).map(m=>m.tileID.key):f.map(m=>m.tileID).sort(Ir).map(m=>m.key)}hasRenderableParent(l){const f=l.overscaledZ-1;if(f>=this._source.minzoom){const m=this._getLoadedTile(l.scaledTo(f));if(m)return this._isIdRenderable(m.tileID.key)}return!1}_isIdRenderable(l,f=!1){var m;return(m=this._tiles[l])===null||m===void 0?void 0:m.isRenderable(f)}reload(l){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const f in this._tiles)l?this._reloadTile(f,"expired"):this._tiles[f].state!=="errored"&&this._reloadTile(f,"reloading")}}_reloadTile(l,f){return o._(this,void 0,void 0,function*(){const m=this._tiles[l];m&&(m.state!=="loading"&&(m.state=f),yield this._loadTile(m,l,f))})}_tileLoaded(l,f,m){l.timeAdded=M(),m==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(f,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const f=this.getRenderableIds();for(let y=0;y<f.length;y++){const B=f[y];if(l.neighboringTiles&&l.neighboringTiles[B]){const E=this.getTileByID(B);m(l,E),m(E,l)}}function m(y,B){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let E=B.tileID.canonical.x-y.tileID.canonical.x;const R=B.tileID.canonical.y-y.tileID.canonical.y,O=Math.pow(2,y.tileID.canonical.z),V=B.tileID.key;E===0&&R===0||Math.abs(R)>1||(Math.abs(E)>1&&(Math.abs(E+O)===1?E+=O:Math.abs(E-O)===1&&(E-=O)),B.dem&&y.dem&&(y.dem.backfillBorder(B.dem,E,R),y.neighboringTiles&&y.neighboringTiles[V]&&(y.neighboringTiles[V].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,f){const m=Object.values(l),y=this._getLoadedDescendents(m),B={};for(const E of m){const R=y[E.key];if(!R?.length){B[E.key]=E;continue}const O=E.overscaledZ+fn.maxUnderzooming,V=R.filter(X=>X.tileID.overscaledZ<=O);if(!V.length){B[E.key]=E;continue}const G=Math.min(...V.map(X=>X.tileID.overscaledZ)),J=V.filter(X=>X.tileID.overscaledZ===G).map(X=>X.tileID);for(const X of J)f[X.key]=X;this._areDescendentsComplete(J,G,E.overscaledZ)||(B[E.key]=E)}return B}_getLoadedDescendents(l){var f;const m={};for(const y in this._tiles){const B=this._tiles[y];if(B.hasData())for(const E of l)B.tileID.isChildOf(E)&&(m[f=E.key]||(m[f]=[])).push(B)}return m}_areDescendentsComplete(l,f,m){return l.length===1&&l[0].isOverscaled()?l[0].overscaledZ===f:Math.pow(4,f-m)===l.length}_getLoadedTile(l){const f=this._tiles[l.key];return f?.hasData()?f:null}updateCacheSize(l){const f=Math.ceil(l.width/this._source.tileSize)+1,m=Math.ceil(l.height/this._source.tileSize)+1,y=Math.floor(f*m*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),B=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(B)}handleWrapJump(l){const f=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,f){const m={};for(const y in this._tiles){const B=this._tiles[y];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+f),m[B.tileID.key]=B}this._tiles=m,this._resetTileReloadTimers()}}update(l,f){if(!this._sourceLoaded||this._paused)return;let m;this.transform=l,this.terrain=f,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?m=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new o.Z(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y)):(m=yr(l,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(m=m.filter(O=>this._source.hasTile(O)))):m=[],this.usedForTerrain&&(m=this._addTerrainIdealTiles(m));const y=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,y&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const B=an(l,this._source),E=this._updateRetainedTiles(m,B),R=Gn(this._source.type);R&&this._rasterFadeDuration>0&&!f&&this._updateFadingTiles(m,E),R?this._cleanUpRasterTiles(E):this._cleanUpVectorTiles(E)}_cleanUpRasterTiles(l){for(const f in this._tiles)l[f]||this._removeTile(f)}_cleanUpVectorTiles(l){for(const f in this._tiles){const m=this._tiles[f];l[f]?m.clearSymbolFadeHold():m.hasSymbolBuckets?m.holdingForSymbolFade()?m.symbolFadeFinished()&&this._removeTile(f):m.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(f)}}_addTerrainIdealTiles(l){const f=[];for(const m of l)if(m.canonical.z>this._source.minzoom){const y=m.scaledTo(m.canonical.z-1);f.push(y);const B=m.scaledTo(Math.max(this._source.minzoom,Math.min(m.canonical.z,5)));f.push(B)}return l.concat(f)}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForSymbolFade()&&this._removeTile(l)}_updateRetainedTiles(l,f){var m;const y={},B={},E=Math.max(f-fn.maxOverzooming,this._source.minzoom);let R={};for(const O of l){const V=this._addTile(O);y[O.key]=O,V.hasData()||(R[O.key]=O)}R=this._retainLoadedChildren(R,y);for(const O in R){const V=R[O];let G=this._tiles[O],J=G?.wasRequested();for(let X=V.overscaledZ-1;X>=E;--X){const ne=V.scaledTo(X);if(B[ne.key])break;if(B[ne.key]=!0,G=this.getTile(ne),!G&&J&&(G=this._addTile(ne)),G){const de=G.hasData();if((de||!(!((m=this.map)===null||m===void 0)&&m.cancelPendingTileRequestsWhileZooming)||J)&&(y[ne.key]=ne),J=G.wasRequested(),de)break}}}return y}_updateFadingTiles(l,f){const m=M(),y=o.am(l);for(const B of l){const E=this._tiles[B.key];E.fadingDirection!==re.Departing&&E.fadeOpacity!==0||E.resetFadeLogic(),this._updateFadingAncestor(E,f,m)||this._updateFadingDescendents(E,f,m)||this._updateFadingEdge(E,y,m)||E.resetFadeLogic()}}_updateFadingAncestor(l,f,m){if(!l.hasData())return!1;const{tileID:y,fadingRole:B,fadingDirection:E,fadingParentID:R}=l;if(B===Ne.Base&&E===re.Incoming&&R)return f[R.key]=R,!0;const O=Math.max(y.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let V=y.overscaledZ-1;V>=O;V--){const G=y.scaledTo(V),J=this._getLoadedTile(G);if(J)return l.setCrossFadeLogic({fadingRole:Ne.Base,fadingDirection:re.Incoming,fadingParentID:J.tileID,fadeEndTime:m+this._rasterFadeDuration}),J.setCrossFadeLogic({fadingRole:Ne.Parent,fadingDirection:re.Departing,fadeEndTime:m+this._rasterFadeDuration}),f[G.key]=G,!0}return!1}_updateFadingDescendents(l,f,m){if(!l.hasData())return!1;const y=l.tileID.children(this._source.maxzoom);let B=this._updateFadingChildren(l,y,f,m);if(B)return!0;for(const E of y){const R=E.children(this._source.maxzoom);this._updateFadingChildren(l,R,f,m)&&(B=!0)}return B}_updateFadingChildren(l,f,m,y){if(f[0].overscaledZ>=this._source.maxzoom)return!1;let B=!1;for(const E of f){const R=this._getLoadedTile(E);if(!R)continue;const{fadingRole:O,fadingDirection:V,fadingParentID:G}=R;O===Ne.Base&&V===re.Departing&&G||(R.setCrossFadeLogic({fadingRole:Ne.Base,fadingDirection:re.Departing,fadingParentID:l.tileID,fadeEndTime:y+this._rasterFadeDuration}),l.setCrossFadeLogic({fadingRole:Ne.Parent,fadingDirection:re.Incoming,fadeEndTime:y+this._rasterFadeDuration})),m[E.key]=E,B=!0}return B}_updateFadingEdge(l,f,m){const y=l.tileID;return!!l.selfFading||!l.hasData()&&!!f.has(y)&&(l.setSelfFadeLogic(m+this._rasterFadeDuration),!0)}_addTile(l){let f=this._tiles[l.key];if(f)return f;f=this._cache.getAndRemove(l),f&&(f.resetFadeLogic(),this._setTileReloadTimer(l.key,f),f.tileID=l,this._state.initializeTileState(f,this.map?this.map.painter:null));const m=f;return f||(f=new ae(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(f,l.key,f.state)),f.uses++,this._tiles[l.key]=f,m||this._source.fire(new o.l("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(l,f){this._clearTileReloadTimer(l);const m=f.getExpiryTimeout();m&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},m))}_clearTileReloadTimer(l){const f=this._timers[l];f&&(clearTimeout(f),delete this._timers[l])}_resetTileReloadTimers(){for(const l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(const l in this._tiles)this._setTileReloadTimer(l,this._tiles[l])}refreshTiles(l){for(const f in this._tiles)(this._isIdRenderable(f)||this._tiles[f].state=="errored")&&l.some(m=>m.equals(this._tiles[f].tileID.canonical))&&this._reloadTile(f,"expired")}_removeTile(l){const f=this._tiles[l];f&&(f.uses--,delete this._tiles[l],this._clearTileReloadTimer(l),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(l){l.dataType==="source"&&(l.sourceDataType!=="metadata"?l.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(l.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,f,m){const y=[],B=this.transform;if(!B)return y;const E=B.getCoveringTilesDetailsProvider().allowWorldCopies(),R=m?B.getCameraQueryGeometry(l):l,O=ne=>B.screenPointToMercatorCoordinate(ne,this.terrain),V=this.transformBbox(l,O,!E),G=this.transformBbox(R,O,!E),J=this.getIds(),X=o.a2.fromPoints(G);for(let ne=0;ne<J.length;ne++){const de=this._tiles[J[ne]];if(de.holdingForSymbolFade())continue;const Ee=E?[de.tileID]:[de.tileID.unwrapTo(-1),de.tileID.unwrapTo(0)],Se=Math.pow(2,B.zoom-de.tileID.overscaledZ),Ie=f*de.queryPadding*o.$/de.tileSize/Se;for(const Oe of Ee){const je=X.map(De=>Oe.getTilePoint(new o.a1(De.x,De.y)));if(je.expandBy(Ie),je.intersects(sn)){const De=V.map(Je=>Oe.getTilePoint(Je)),$e=G.map(Je=>Oe.getTilePoint(Je));y.push({tile:de,tileID:E?Oe:Oe.unwrapTo(0),queryGeometry:De,cameraQueryGeometry:$e,scale:Se})}}}return y}transformBbox(l,f,m){let y=l.map(f);if(m){const B=o.a2.fromPoints(l);B.shrinkBy(.001*Math.min(B.width(),B.height()));const E=B.map(f);o.a2.fromPoints(y).covers(E)||(y=y.map(R=>R.x>.5?new o.a1(R.x-1,R.y,R.z):R))}return y}getVisibleCoordinates(l){const f=this.getRenderableIds(l).map(m=>this._tiles[m].tileID);return this.transform&&this.transform.populateCache(f),f}hasTransition(){if(this._source.hasTransition())return!0;if(Gn(this._source.type)&&this._rasterFadeDuration>0){const l=M();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=l)return!0}return!1}setRasterFadeDuration(l){this._rasterFadeDuration=l}setFeatureState(l,f,m){this._state.updateState(l=l||"_geojsonTileLayer",f,m)}removeFeatureState(l,f,m){this._state.removeFeatureState(l=l||"_geojsonTileLayer",f,m)}getFeatureState(l,f){return this._state.getState(l=l||"_geojsonTileLayer",f)}setDependencies(l,f,m){const y=this._tiles[l];y&&y.setDependencies(f,m)}reloadTilesForDependencies(l,f){for(const m in this._tiles)this._tiles[m].hasDependency(l,f)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(l,f))}}function Ir(v,l){const f=Math.abs(2*v.wrap)-+(v.wrap<0),m=Math.abs(2*l.wrap)-+(l.wrap<0);return v.overscaledZ-l.overscaledZ||m-f||l.canonical.y-v.canonical.y||l.canonical.x-v.canonical.x}function Gn(v){return v==="raster"||v==="image"||v==="video"}fn.maxOverzooming=10,fn.maxUnderzooming=3;class ii{constructor(l,f){this.reset(l,f)}reset(l,f){this.points=l||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=o.ae(l,0,1);let f=1,m=this._distances[f];const y=l*this.paddedLength+this.padding;for(;m<y&&f<this._distances.length;)m=this._distances[++f];const B=f-1,E=this._distances[B],R=m-E,O=R>0?(y-E)/R:0;return this.points[B].mult(1-O).add(this.points[f].mult(O))}}function On(v,l){let f=!0;return v==="always"||v!=="never"&&l!=="never"||(f=!1),f}class pn{constructor(l,f,m){const y=this.boxCells=[],B=this.circleCells=[];this.xCellCount=Math.ceil(l/m),this.yCellCount=Math.ceil(f/m);for(let E=0;E<this.xCellCount*this.yCellCount;E++)y.push([]),B.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,f,m,y,B){this._forEachCell(f,m,y,B,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(B)}insertCircle(l,f,m,y){this._forEachCell(f-y,m-y,f+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(m),this.circles.push(y)}_insertBoxCell(l,f,m,y,B,E){this.boxCells[B].push(E)}_insertCircleCell(l,f,m,y,B,E){this.circleCells[B].push(E)}_query(l,f,m,y,B,E,R){if(m<0||l>this.width||y<0||f>this.height)return[];const O=[];if(l<=0&&f<=0&&this.width<=m&&this.height<=y){if(B)return[{key:null,x1:l,y1:f,x2:m,y2:y}];for(let V=0;V<this.boxKeys.length;V++)O.push({key:this.boxKeys[V],x1:this.bboxes[4*V],y1:this.bboxes[4*V+1],x2:this.bboxes[4*V+2],y2:this.bboxes[4*V+3]});for(let V=0;V<this.circleKeys.length;V++){const G=this.circles[3*V],J=this.circles[3*V+1],X=this.circles[3*V+2];O.push({key:this.circleKeys[V],x1:G-X,y1:J-X,x2:G+X,y2:J+X})}}else this._forEachCell(l,f,m,y,this._queryCell,O,{hitTest:B,overlapMode:E,seenUids:{box:{},circle:{}}},R);return O}query(l,f,m,y){return this._query(l,f,m,y,!1,null)}hitTest(l,f,m,y,B,E){return this._query(l,f,m,y,!0,B,E).length>0}hitTestCircle(l,f,m,y,B){const E=l-m,R=l+m,O=f-m,V=f+m;if(R<0||E>this.width||V<0||O>this.height)return!1;const G=[];return this._forEachCell(E,O,R,V,this._queryCellCircle,G,{hitTest:!0,overlapMode:y,circle:{x:l,y:f,radius:m},seenUids:{box:{},circle:{}}},B),G.length>0}_queryCell(l,f,m,y,B,E,R,O){const{seenUids:V,hitTest:G,overlapMode:J}=R,X=this.boxCells[B];if(X!==null){const de=this.bboxes;for(const Ee of X)if(!V.box[Ee]){V.box[Ee]=!0;const Se=4*Ee,Ie=this.boxKeys[Ee];if(l<=de[Se+2]&&f<=de[Se+3]&&m>=de[Se+0]&&y>=de[Se+1]&&(!O||O(Ie))&&(!G||!On(J,Ie.overlapMode))&&(E.push({key:Ie,x1:de[Se],y1:de[Se+1],x2:de[Se+2],y2:de[Se+3]}),G))return!0}}const ne=this.circleCells[B];if(ne!==null){const de=this.circles;for(const Ee of ne)if(!V.circle[Ee]){V.circle[Ee]=!0;const Se=3*Ee,Ie=this.circleKeys[Ee];if(this._circleAndRectCollide(de[Se],de[Se+1],de[Se+2],l,f,m,y)&&(!O||O(Ie))&&(!G||!On(J,Ie.overlapMode))){const Oe=de[Se],je=de[Se+1],De=de[Se+2];if(E.push({key:Ie,x1:Oe-De,y1:je-De,x2:Oe+De,y2:je+De}),G)return!0}}}return!1}_queryCellCircle(l,f,m,y,B,E,R,O){const{circle:V,seenUids:G,overlapMode:J}=R,X=this.boxCells[B];if(X!==null){const de=this.bboxes;for(const Ee of X)if(!G.box[Ee]){G.box[Ee]=!0;const Se=4*Ee,Ie=this.boxKeys[Ee];if(this._circleAndRectCollide(V.x,V.y,V.radius,de[Se+0],de[Se+1],de[Se+2],de[Se+3])&&(!O||O(Ie))&&!On(J,Ie.overlapMode))return E.push(!0),!0}}const ne=this.circleCells[B];if(ne!==null){const de=this.circles;for(const Ee of ne)if(!G.circle[Ee]){G.circle[Ee]=!0;const Se=3*Ee,Ie=this.circleKeys[Ee];if(this._circlesCollide(de[Se],de[Se+1],de[Se+2],V.x,V.y,V.radius)&&(!O||O(Ie))&&!On(J,Ie.overlapMode))return E.push(!0),!0}}}_forEachCell(l,f,m,y,B,E,R,O){const V=this._convertToXCellCoord(l),G=this._convertToYCellCoord(f),J=this._convertToXCellCoord(m),X=this._convertToYCellCoord(y);for(let ne=V;ne<=J;ne++)for(let de=G;de<=X;de++)if(B.call(this,l,f,m,y,this.xCellCount*de+ne,E,R,O))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,f,m,y,B,E){const R=y-l,O=B-f,V=m+E;return V*V>R*R+O*O}_circleAndRectCollide(l,f,m,y,B,E,R){const O=(E-y)/2,V=Math.abs(l-(y+O));if(V>O+m)return!1;const G=(R-B)/2,J=Math.abs(f-(B+G));if(J>G+m)return!1;if(V<=O||J<=G)return!0;const X=V-O,ne=J-G;return X*X+ne*ne<=m*m}}function ln(v,l,f){const m=o.L();if(!v){const{vecSouth:J,vecEast:X}=vn(l),ne=d();ne[0]=X[0],ne[1]=X[1],ne[2]=J[0],ne[3]=J[1],y=ne,(G=(E=(B=ne)[0])*(V=B[3])-(O=B[2])*(R=B[1]))&&(y[0]=V*(G=1/G),y[1]=-R*G,y[2]=-O*G,y[3]=E*G),m[0]=ne[0],m[1]=ne[1],m[4]=ne[2],m[5]=ne[3]}var y,B,E,R,O,V,G;return o.N(m,m,[1/f,1/f,1]),m}function Ot(v,l,f,m){if(v){const y=o.L();if(!l){const{vecSouth:B,vecEast:E}=vn(f);y[0]=E[0],y[1]=E[1],y[4]=B[0],y[5]=B[1]}return o.N(y,y,[m,m,1]),y}return f.pixelsToClipSpaceMatrix}function vn(v){const l=Math.cos(v.rollInRadians),f=Math.sin(v.rollInRadians),m=Math.cos(v.pitchInRadians),y=Math.cos(v.bearingInRadians),B=Math.sin(v.bearingInRadians),E=o.ar();E[0]=-y*m*f-B*l,E[1]=-B*m*f+y*l;const R=o.as(E);R<1e-9?o.at(E):o.au(E,E,1/R);const O=o.ar();O[0]=y*m*l-B*f,O[1]=B*m*l+y*f;const V=o.as(O);return V<1e-9?o.at(O):o.au(O,O,1/V),{vecEast:O,vecSouth:E}}function wi(v,l,f,m){let y;m?(y=[v,l,m(v,l),1],o.aw(y,y,f)):(y=[v,l,0,1],qn(y,y,f));const B=y[3];return{point:new o.P(y[0]/B,y[1]/B),signedDistanceFromCamera:B,isOccluded:!1}}function Qs(v,l){return .5+v/l*.5}function Un(v,l){return v.x>=-l[0]&&v.x<=l[0]&&v.y>=-l[1]&&v.y<=l[1]}function er(v,l,f,m,y,B,E,R,O,V,G,J,X){const ne=f?v.textSizeData:v.iconSizeData,de=o.an(ne,l.transform.zoom),Ee=[256/l.width*2+1,256/l.height*2+1],Se=f?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;Se.clear();const Ie=v.lineVertexArray,Oe=f?v.text.placedSymbolArray:v.icon.placedSymbolArray,je=l.transform.width/l.transform.height;let De=!1;for(let $e=0;$e<Oe.length;$e++){const Je=Oe.get($e);if(Je.hidden||Je.writingMode===o.ao.vertical&&!De){Di(Je.numGlyphs,Se);continue}De=!1;const Qe=new o.P(Je.anchorX,Je.anchorY),at={getElevation:X,pitchedLabelPlaneMatrix:m,lineVertexArray:Ie,pitchWithMap:B,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:l.transform,tileAnchorPoint:Qe,unwrappedTileID:O,width:V,height:G,translation:J},Mt=xn(Je.anchorX,Je.anchorY,at);if(!Un(Mt.point,Ee)){Di(Je.numGlyphs,Se);continue}const yt=Qs(l.transform.cameraToCenterDistance,Mt.signedDistanceFromCamera),bt=o.ap(ne,de,Je),Ct=B?bt*l.transform.getPitchedTextCorrection(Je.anchorX,Je.anchorY,O)/yt:bt*yt,Zt=yi({projectionContext:at,pitchedLabelPlaneMatrixInverse:y,symbol:Je,fontSize:Ct,flip:!1,keepUpright:E,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:Se,aspectRatio:je,rotateToLine:R});De=Zt.useVertical,(Zt.notEnoughRoom||De||Zt.needsFlipping&&yi({projectionContext:at,pitchedLabelPlaneMatrixInverse:y,symbol:Je,fontSize:Ct,flip:!0,keepUpright:E,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:Se,aspectRatio:je,rotateToLine:R}).notEnoughRoom)&&Di(Je.numGlyphs,Se)}f?v.text.dynamicLayoutVertexBuffer.updateData(Se):v.icon.dynamicLayoutVertexBuffer.updateData(Se)}function Xr(v,l,f,m,y,B,E,R){const O=B.glyphStartIndex+B.numGlyphs,V=B.lineStartIndex,G=B.lineStartIndex+B.lineLength,J=l.getoffsetX(B.glyphStartIndex),X=l.getoffsetX(O-1),ne=Xi(v*J,f,m,y,B.segment,V,G,R,E);if(!ne)return null;const de=Xi(v*X,f,m,y,B.segment,V,G,R,E);return de?R.projectionCache.anyProjectionOccluded?null:{first:ne,last:de}:null}function Zr(v,l,f,m){return v===o.ao.horizontal&&Math.abs(f.y-l.y)>Math.abs(f.x-l.x)*m?{useVertical:!0}:(v===o.ao.vertical?l.y<f.y:l.x>f.x)?{needsFlipping:!0}:null}function yi(v){const{projectionContext:l,pitchedLabelPlaneMatrixInverse:f,symbol:m,fontSize:y,flip:B,keepUpright:E,glyphOffsetArray:R,dynamicLayoutVertexArray:O,aspectRatio:V,rotateToLine:G}=v,J=y/24,X=m.lineOffsetX*J,ne=m.lineOffsetY*J;let de;if(m.numGlyphs>1){const Ee=m.glyphStartIndex+m.numGlyphs,Se=m.lineStartIndex,Ie=m.lineStartIndex+m.lineLength,Oe=Xr(J,R,X,ne,B,m,G,l);if(!Oe)return{notEnoughRoom:!0};const je=Ar(Oe.first.point.x,Oe.first.point.y,l,f),De=Ar(Oe.last.point.x,Oe.last.point.y,l,f);if(E&&!B){const $e=Zr(m.writingMode,je,De,V);if($e)return $e}de=[Oe.first];for(let $e=m.glyphStartIndex+1;$e<Ee-1;$e++){const Je=Xi(J*R.getoffsetX($e),X,ne,B,m.segment,Se,Ie,l,G);if(!Je)return{notEnoughRoom:!0};de.push(Je)}de.push(Oe.last)}else{if(E&&!B){const Se=Vt(l.tileAnchorPoint.x,l.tileAnchorPoint.y,l).point,Ie=m.lineStartIndex+m.segment+1,Oe=new o.P(l.lineVertexArray.getx(Ie),l.lineVertexArray.gety(Ie)),je=Vt(Oe.x,Oe.y,l),De=je.signedDistanceFromCamera>0?je.point:Xo(l.tileAnchorPoint,Oe,Se,1,l),$e=Ar(Se.x,Se.y,l,f),Je=Ar(De.x,De.y,l,f),Qe=Zr(m.writingMode,$e,Je,V);if(Qe)return Qe}const Ee=Xi(J*R.getoffsetX(m.glyphStartIndex),X,ne,B,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,l,G);if(!Ee||l.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};de=[Ee]}for(const Ee of de)o.av(O,Ee.point,Ee.angle);return{}}function Xo(v,l,f,m,y){const B=v.add(v.sub(l)._unit()),E=Vt(B.x,B.y,y).point,R=f.sub(E);return f.add(R._mult(m/R.mag()))}function Ke(v,l,f){const m=l.projectionCache;if(m.projections[v])return m.projections[v];const y=new o.P(l.lineVertexArray.getx(v),l.lineVertexArray.gety(v)),B=Vt(y.x,y.y,l);if(B.signedDistanceFromCamera>0)return m.projections[v]=B.point,m.anyProjectionOccluded=m.anyProjectionOccluded||B.isOccluded,B.point;const E=v-f.direction;return Xo(f.distanceFromAnchor===0?l.tileAnchorPoint:new o.P(l.lineVertexArray.getx(E),l.lineVertexArray.gety(E)),y,f.previousVertex,f.absOffsetX-f.distanceFromAnchor+1,l)}function Vt(v,l,f){const m=v+f.translation[0],y=l+f.translation[1];let B;return f.pitchWithMap?(B=wi(m,y,f.pitchedLabelPlaneMatrix,f.getElevation),B.isOccluded=!1):(B=f.transform.projectTileCoordinates(m,y,f.unwrappedTileID,f.getElevation),B.point.x=(.5*B.point.x+.5)*f.width,B.point.y=(.5*-B.point.y+.5)*f.height),B}function Ar(v,l,f,m){if(f.pitchWithMap){const y=[v,l,0,1];return o.aw(y,y,m),f.transform.projectTileCoordinates(y[0]/y[3],y[1]/y[3],f.unwrappedTileID,f.getElevation).point}return{x:v/f.width*2-1,y:1-l/f.height*2}}function xn(v,l,f){return f.transform.projectTileCoordinates(v,l,f.unwrappedTileID,f.getElevation)}function Jn(v,l,f){return v._unit()._perp()._mult(l*f)}function Wn(v,l,f,m,y,B,E,R,O){if(R.projectionCache.offsets[v])return R.projectionCache.offsets[v];const V=f.add(l);if(v+O.direction<m||v+O.direction>=y)return R.projectionCache.offsets[v]=V,V;const G=Ke(v+O.direction,R,O),J=Jn(G.sub(f),E,O.direction),X=f.add(J),ne=G.add(J);return R.projectionCache.offsets[v]=o.ax(B,V,X,ne)||V,R.projectionCache.offsets[v]}function Xi(v,l,f,m,y,B,E,R,O){const V=m?v-l:v+l;let G=V>0?1:-1,J=0;m&&(G*=-1,J=Math.PI),G<0&&(J+=Math.PI);let X,ne=G>0?B+y:B+y+1;R.projectionCache.cachedAnchorPoint?X=R.projectionCache.cachedAnchorPoint:(X=Vt(R.tileAnchorPoint.x,R.tileAnchorPoint.y,R).point,R.projectionCache.cachedAnchorPoint=X);let de,Ee,Se=X,Ie=X,Oe=0,je=0;const De=Math.abs(V),$e=[];let Je;for(;Oe+je<=De;){if(ne+=G,ne<B||ne>=E)return null;Oe+=je,Ie=Se,Ee=de;const Mt={absOffsetX:De,direction:G,distanceFromAnchor:Oe,previousVertex:Ie};if(Se=Ke(ne,R,Mt),f===0)$e.push(Ie),Je=Se.sub(Ie);else{let yt;const bt=Se.sub(Ie);yt=bt.mag()===0?Jn(Ke(ne+G,R,Mt).sub(Se),f,G):Jn(bt,f,G),Ee||(Ee=Ie.add(yt)),de=Wn(ne,yt,Se,B,E,Ee,f,R,Mt),$e.push(Ee),Je=de.sub(Ee)}je=Je.mag()}const Qe=Je._mult((De-Oe)/je)._add(Ee||Ie),at=J+Math.atan2(Se.y-Ie.y,Se.x-Ie.x);return $e.push(Qe),{point:Qe,angle:O?at:0,path:$e}}const os=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Di(v,l){for(let f=0;f<v;f++){const m=l.length;l.resize(m+4),l.float32.set(os,3*m)}}function qn(v,l,f){const m=l[0],y=l[1];return v[0]=f[0]*m+f[4]*y+f[12],v[1]=f[1]*m+f[5]*y+f[13],v[3]=f[3]*m+f[7]*y+f[15],v}const Nr=100;class cu{constructor(l,f=new pn(l.width+200,l.height+200,25),m=new pn(l.width+200,l.height+200,25)){this.transform=l,this.grid=f,this.ignoredGrid=m,this.pitchFactor=Math.cos(l.pitch*Math.PI/180)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Nr,this.screenBottomBoundary=l.height+Nr,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,f,m,y,B,E,R,O,V,G,J,X){const ne=this.projectAndGetPerspectiveRatio(l.anchorPointX+O[0],l.anchorPointY+O[1],B,G,X),de=m*ne.perspectiveRatio;let Ee;if(E||R)Ee=this._projectCollisionBox(l,de,y,B,E,R,O,ne,G,J,X);else{const Je=ne.x+(J?J.x*de:0),Qe=ne.y+(J?J.y*de:0);Ee={allPointsOccluded:!1,box:[Je+l.x1*de,Qe+l.y1*de,Je+l.x2*de,Qe+l.y2*de]}}const[Se,Ie,Oe,je]=Ee.box,De=E?Ee.allPointsOccluded:ne.isOccluded;let $e=De;return $e||($e=ne.perspectiveRatio<this.perspectiveRatioCutoff),$e||($e=!this.isInsideGrid(Se,Ie,Oe,je)),$e||f!=="always"&&this.grid.hitTest(Se,Ie,Oe,je,f,V)?{box:[Se,Ie,Oe,je],placeable:!1,offscreen:!1,occluded:De}:{box:[Se,Ie,Oe,je],placeable:!0,offscreen:this.isOffscreen(Se,Ie,Oe,je),occluded:De}}placeCollisionCircles(l,f,m,y,B,E,R,O,V,G,J,X,ne,de){const Ee=[],Se=new o.P(f.anchorX,f.anchorY),Ie=this.getPerspectiveRatio(Se.x,Se.y,E,de),Oe=(V?B*this.transform.getPitchedTextCorrection(f.anchorX,f.anchorY,E)/Ie:B*Ie)/o.aB,je={getElevation:de,pitchedLabelPlaneMatrix:R,lineVertexArray:m,pitchWithMap:V,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Se,unwrappedTileID:E,width:this.transform.width,height:this.transform.height,translation:ne},De=Xr(Oe,y,f.lineOffsetX*Oe,f.lineOffsetY*Oe,!1,f,!1,je);let $e=!1,Je=!1,Qe=!0;if(De){const at=.5*J*Ie+X,Mt=new o.P(-100,-100),yt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),bt=new ii,Ct=De.first,Zt=De.last;let rr=[];for(let tn=Ct.path.length-1;tn>=1;tn--)rr.push(Ct.path[tn]);for(let tn=1;tn<Zt.path.length;tn++)rr.push(Zt.path[tn]);const $t=2.5*at;if(V){const tn=this.projectPathToScreenSpace(rr,je);rr=tn.some(Dn=>Dn.signedDistanceFromCamera<=0)?[]:tn.map(Dn=>Dn.point)}let Tr=[];if(rr.length>0){const tn=rr[0].clone(),Dn=rr[0].clone();for(let li=1;li<rr.length;li++)tn.x=Math.min(tn.x,rr[li].x),tn.y=Math.min(tn.y,rr[li].y),Dn.x=Math.max(Dn.x,rr[li].x),Dn.y=Math.max(Dn.y,rr[li].y);Tr=tn.x>=Mt.x&&Dn.x<=yt.x&&tn.y>=Mt.y&&Dn.y<=yt.y?[rr]:Dn.x<Mt.x||tn.x>yt.x||Dn.y<Mt.y||tn.y>yt.y?[]:o.ay([rr],Mt.x,Mt.y,yt.x,yt.y)}for(const tn of Tr){bt.reset(tn,.25*at);let Dn=0;Dn=bt.length<=.5*at?1:Math.ceil(bt.paddedLength/$t)+1;for(let li=0;li<Dn;li++){const Ti=li/Math.max(Dn-1,1),Bn=bt.lerp(Ti),bi=Bn.x+Nr,Gs=Bn.y+Nr;Ee.push(bi,Gs,at,0);const Wi=bi-at,ao=Gs-at,us=bi+at,_s=Gs+at;if(Qe=Qe&&this.isOffscreen(Wi,ao,us,_s),Je=Je||this.isInsideGrid(Wi,ao,us,_s),l!=="always"&&this.grid.hitTestCircle(bi,Gs,at,l,G)&&($e=!0,!O))return{circles:[],offscreen:!1,collisionDetected:$e}}}}return{circles:!O&&$e||!Je||Ie<this.perspectiveRatioCutoff?[]:Ee,offscreen:Qe,collisionDetected:$e}}projectPathToScreenSpace(l,f){const m=function(y,B){const E=o.L();return o.aq(E,B.pitchedLabelPlaneMatrix),y.map(R=>{const O=wi(R.x,R.y,E,B.getElevation),V=B.transform.projectTileCoordinates(O.point.x,O.point.y,B.unwrappedTileID,B.getElevation);return V.point.x=(.5*V.point.x+.5)*B.width,V.point.y=(.5*-V.point.y+.5)*B.height,V})}(l,f);return function(y){let B=0,E=0,R=0,O=0;for(let V=0;V<y.length;V++)y[V].isOccluded?(R=V+1,O=0):(O++,O>E&&(E=O,B=R));return y.slice(B,B+E)}(m)}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[],m=new o.a2;for(const J of l){const X=new o.P(J.x+Nr,J.y+Nr);m.extend(X),f.push(X)}const{minX:y,minY:B,maxX:E,maxY:R}=m,O=this.grid.query(y,B,E,R).concat(this.ignoredGrid.query(y,B,E,R)),V={},G={};for(const J of O){const X=J.key;if(V[X.bucketInstanceId]===void 0&&(V[X.bucketInstanceId]={}),V[X.bucketInstanceId][X.featureIndex])continue;const ne=[new o.P(J.x1,J.y1),new o.P(J.x2,J.y1),new o.P(J.x2,J.y2),new o.P(J.x1,J.y2)];o.az(f,ne)&&(V[X.bucketInstanceId][X.featureIndex]=!0,G[X.bucketInstanceId]===void 0&&(G[X.bucketInstanceId]=[]),G[X.bucketInstanceId].push(X.featureIndex))}return G}insertCollisionBox(l,f,m,y,B,E){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:B,collisionGroupID:E,overlapMode:f},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,f,m,y,B,E){const R=m?this.ignoredGrid:this.grid,O={bucketInstanceId:y,featureIndex:B,collisionGroupID:E,overlapMode:f};for(let V=0;V<l.length;V+=4)R.insertCircle(O,l[V],l[V+1],l[V+2])}projectAndGetPerspectiveRatio(l,f,m,y,B){if(B){let E;y?(E=[l,f,y(l,f),1],o.aw(E,E,B)):(E=[l,f,0,1],qn(E,E,B));const R=E[3];return{x:(E[0]/R+1)/2*this.transform.width+Nr,y:(-E[1]/R+1)/2*this.transform.height+Nr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/R*.5,isOccluded:!1,signedDistanceFromCamera:R}}{const E=this.transform.projectTileCoordinates(l,f,m,y);return{x:(E.point.x+1)/2*this.transform.width+Nr,y:(1-E.point.y)/2*this.transform.height+Nr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/E.signedDistanceFromCamera*.5,isOccluded:E.isOccluded,signedDistanceFromCamera:E.signedDistanceFromCamera}}}getPerspectiveRatio(l,f,m,y){const B=this.transform.projectTileCoordinates(l,f,m,y);return .5+this.transform.cameraToCenterDistance/B.signedDistanceFromCamera*.5}isOffscreen(l,f,m,y){return m<Nr||l>=this.screenRightBoundary||y<Nr||f>this.screenBottomBoundary}isInsideGrid(l,f,m,y){return m>=0&&l<this.gridRightBoundary&&y>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const l=o.ai([]);return o.M(l,l,[-100,-100,0]),l}_projectCollisionBox(l,f,m,y,B,E,R,O,V,G,J){let X=1,ne=0,de=0,Ee=1;const Se=l.anchorPointX+R[0],Ie=l.anchorPointY+R[1];if(E&&!B){const rr=this.projectAndGetPerspectiveRatio(Se+1,Ie,y,V,J),$t=rr.x-O.x,Tr=Math.atan((rr.y-O.y)/$t)+($t<0?Math.PI:0),tn=Math.sin(Tr),Dn=Math.cos(Tr);X=Dn,ne=tn,de=-tn,Ee=Dn}else if(!E&&B){const rr=vn(this.transform);X=rr.vecEast[0],ne=rr.vecEast[1],de=rr.vecSouth[0],Ee=rr.vecSouth[1]}let Oe=O.x,je=O.y,De=f;B&&(Oe=Se,je=Ie,De=Math.pow(2,-(this.transform.zoom-m.overscaledZ)),De*=this.transform.getPitchedTextCorrection(Se,Ie,y),G||(De*=o.ae(.5+O.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),G&&(Oe+=X*G.x*De+de*G.y*De,je+=ne*G.x*De+Ee*G.y*De);const $e=l.x1*De,Je=l.x2*De,Qe=($e+Je)/2,at=l.y1*De,Mt=l.y2*De,yt=(at+Mt)/2,bt=[{offsetX:$e,offsetY:at},{offsetX:Qe,offsetY:at},{offsetX:Je,offsetY:at},{offsetX:Je,offsetY:yt},{offsetX:Je,offsetY:Mt},{offsetX:Qe,offsetY:Mt},{offsetX:$e,offsetY:Mt},{offsetX:$e,offsetY:yt}];let Ct=[];for(const{offsetX:rr,offsetY:$t}of bt)Ct.push(new o.P(Oe+X*rr+de*$t,je+ne*rr+Ee*$t));let Zt=!1;if(B){const rr=Ct.map($t=>this.projectAndGetPerspectiveRatio($t.x,$t.y,y,V,J));Zt=rr.some($t=>!$t.isOccluded),Ct=rr.map($t=>new o.P($t.x,$t.y))}else Zt=!0;return{box:o.aA(Ct),allPointsOccluded:!Zt}}}class ma{constructor(l,f,m,y){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):y&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class al{constructor(l,f,m,y,B){this.text=new ma(l?l.text:null,f,m,B),this.icon=new ma(l?l.icon:null,f,y,B)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Da{constructor(l,f,m){this.text=l,this.icon=f,this.skipFade=m}}class ka{constructor(l,f,m,y,B){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=B}}class uu{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:m=>m.collisionGroupID===f}}return this.collisionGroups[l]}}function eA(v,l,f,m,y){const{horizontalAlign:B,verticalAlign:E}=o.aH(v);return new o.P(-(B-.5)*l+m[0]*y,-(E-.5)*f+m[1]*y)}class Yi{constructor(l,f,m,y,B){this.transform=l.clone(),this.terrain=f,this.collisionIndex=new cu(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new uu(y),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=B,B&&(B.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(l){const f=this.terrain;return f?(m,y)=>f.getElevation(l,m,y):null}getBucketParts(l,f,m,y){const B=m.getBucket(f),E=m.latestFeatureIndex;if(!B||!E||f.id!==B.layerIds[0])return;const R=m.collisionBoxArray,O=B.layers[0].layout,V=B.layers[0].paint,G=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),J=m.tileSize/o.$,X=m.tileID.toUnwrapped(),ne=O.get("text-rotation-alignment")==="map",de=o.aC(m,1,this.transform.zoom),Ee=o.aD(this.collisionIndex.transform,m,V.get("text-translate"),V.get("text-translate-anchor")),Se=o.aD(this.collisionIndex.transform,m,V.get("icon-translate"),V.get("icon-translate-anchor")),Ie=ln(ne,this.transform,de);this.retainedQueryData[B.bucketInstanceId]=new ka(B.bucketInstanceId,E,B.sourceLayerIndex,B.index,m.tileID);const Oe={bucket:B,layout:O,translationText:Ee,translationIcon:Se,unwrappedTileID:X,pitchedLabelPlaneMatrix:Ie,scale:G,textPixelRatio:J,holdingForFade:m.holdingForSymbolFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:o.an(B.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(B.sourceID)};if(y)for(const je of B.sortKeyRanges){const{sortKey:De,symbolInstanceStart:$e,symbolInstanceEnd:Je}=je;l.push({sortKey:De,symbolInstanceStart:$e,symbolInstanceEnd:Je,parameters:Oe})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:B.symbolInstances.length,parameters:Oe})}attemptAnchorPlacement(l,f,m,y,B,E,R,O,V,G,J,X,ne,de,Ee,Se,Ie,Oe,je,De){const $e=o.aE[l.textAnchor],Je=[l.textOffset0,l.textOffset1],Qe=eA($e,m,y,Je,B),at=this.collisionIndex.placeCollisionBox(f,X,O,V,G,R,E,Se,J.predicate,je,Qe,De);if((!Oe||this.collisionIndex.placeCollisionBox(Oe,X,O,V,G,R,E,Ie,J.predicate,je,Qe,De).placeable)&&at.placeable){let Mt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ne.crossTileID]&&this.prevPlacement.placements[ne.crossTileID]&&this.prevPlacement.placements[ne.crossTileID].text&&(Mt=this.prevPlacement.variableOffsets[ne.crossTileID].anchor),ne.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ne.crossTileID]={textOffset:Je,width:m,height:y,anchor:$e,textBoxScale:B,prevAnchor:Mt},this.markUsedJustification(de,$e,ne,Ee),de.allowVerticalPlacement&&(this.markUsedOrientation(de,Ee,ne),this.placedOrientations[ne.crossTileID]=Ee),{shift:Qe,placedGlyphBoxes:at}}}placeLayerBucketPart(l,f,m){const{bucket:y,layout:B,translationText:E,translationIcon:R,unwrappedTileID:O,pitchedLabelPlaneMatrix:V,textPixelRatio:G,holdingForFade:J,collisionBoxArray:X,partiallyEvaluatedTextSize:ne,collisionGroup:de}=l.parameters,Ee=B.get("text-optional"),Se=B.get("icon-optional"),Ie=o.aF(B,"text-overlap","text-allow-overlap"),Oe=Ie==="always",je=o.aF(B,"icon-overlap","icon-allow-overlap"),De=je==="always",$e=B.get("text-rotation-alignment")==="map",Je=B.get("text-pitch-alignment")==="map",Qe=B.get("icon-text-fit")!=="none",at=B.get("symbol-z-order")==="viewport-y",Mt=Oe&&(De||!y.hasIconData()||Se),yt=De&&(Oe||!y.hasTextData()||Ee);!y.collisionArrays&&X&&y.deserializeCollisionBoxes(X);const bt=this.retainedQueryData[y.bucketInstanceId].tileID,Ct=this._getTerrainElevationFunc(bt),Zt=this.transform.getFastPathSimpleProjectionMatrix(bt),rr=($t,Tr,tn)=>{var Dn,li;if(f[$t.crossTileID])return;if(J)return void(this.placements[$t.crossTileID]=new Da(!1,!1,!1));let Ti=!1,Bn=!1,bi=!0,Gs=null,Wi={box:null,placeable:!1,offscreen:null,occluded:!1},ao={placeable:!1},us=null,_s=null,lo=null,wh=0,xh=0,bA=0;Tr.textFeatureIndex?wh=Tr.textFeatureIndex:$t.useRuntimeCollisionCircles&&(wh=$t.featureIndex),Tr.verticalTextFeatureIndex&&(xh=Tr.verticalTextFeatureIndex);const Bh=Tr.textBox;if(Bh){const ra=Fs=>{let co=o.ao.horizontal;if(y.allowVerticalPlacement&&!Fs&&this.prevPlacement){const Ta=this.prevPlacement.placedOrientations[$t.crossTileID];Ta&&(this.placedOrientations[$t.crossTileID]=Ta,co=Ta,this.markUsedOrientation(y,co,$t))}return co},Vo=(Fs,co)=>{if(y.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&Tr.verticalTextBox){for(const Ta of y.writingModes)if(Ta===o.ao.vertical?(Wi=co(),ao=Wi):Wi=Fs(),Wi&&Wi.placeable)break}else Wi=Fs()},Pc=$t.textAnchorOffsetStartIndex,xf=$t.textAnchorOffsetEndIndex;if(xf===Pc){const Fs=(co,Ta)=>{const hs=this.collisionIndex.placeCollisionBox(co,Ie,G,bt,O,Je,$e,E,de.predicate,Ct,void 0,Zt);return hs&&hs.placeable&&(this.markUsedOrientation(y,Ta,$t),this.placedOrientations[$t.crossTileID]=Ta),hs};Vo(()=>Fs(Bh,o.ao.horizontal),()=>{const co=Tr.verticalTextBox;return y.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&co?Fs(co,o.ao.vertical):{box:null,offscreen:null}}),ra(Wi&&Wi.placeable)}else{let Fs=o.aE[(li=(Dn=this.prevPlacement)===null||Dn===void 0?void 0:Dn.variableOffsets[$t.crossTileID])===null||li===void 0?void 0:li.anchor];const co=(hs,wA,Su)=>{const jl=hs.x2-hs.x1,Th=hs.y2-hs.y1,hv=$t.textBoxScale,Av=Qe&&je==="never"?wA:null;let Eh=null,Sh=Ie==="never"?1:2,fv="never";Fs&&Sh++;for(let ey=0;ey<Sh;ey++){for(let Kd=Pc;Kd<xf;Kd++){const ty=y.textAnchorOffsets.get(Kd);if(Fs&&ty.textAnchor!==Fs)continue;const Iu=this.attemptAnchorPlacement(ty,hs,jl,Th,hv,$e,Je,G,bt,O,de,fv,$t,y,Su,E,R,Av,Ct);if(Iu&&(Eh=Iu.placedGlyphBoxes,Eh&&Eh.placeable))return Ti=!0,Gs=Iu.shift,Eh}Fs?Fs=null:fv=Ie}return m&&!Eh&&(Eh={box:this.collisionIndex.placeCollisionBox(Bh,"always",G,bt,O,Je,$e,E,de.predicate,Ct,void 0,Zt).box,offscreen:!1,placeable:!1,occluded:!1}),Eh};Vo(()=>co(Bh,Tr.iconBox,o.ao.horizontal),()=>{const hs=Tr.verticalTextBox;return y.allowVerticalPlacement&&(!Wi||!Wi.placeable)&&$t.numVerticalGlyphVertices>0&&hs?co(hs,Tr.verticalIconBox,o.ao.vertical):{box:null,occluded:!0,offscreen:null}}),Wi&&(Ti=Wi.placeable,bi=Wi.offscreen);const Ta=ra(Wi&&Wi.placeable);if(!Ti&&this.prevPlacement){const hs=this.prevPlacement.variableOffsets[$t.crossTileID];hs&&(this.variableOffsets[$t.crossTileID]=hs,this.markUsedJustification(y,hs.anchor,$t,Ta))}}}if(us=Wi,Ti=us&&us.placeable,bi=us&&us.offscreen,$t.useRuntimeCollisionCircles&&$t.centerJustifiedTextSymbolIndex>=0){const ra=y.text.placedSymbolArray.get($t.centerJustifiedTextSymbolIndex),Vo=o.ap(y.textSizeData,ne,ra),Pc=B.get("text-padding");_s=this.collisionIndex.placeCollisionCircles(Ie,ra,y.lineVertexArray,y.glyphOffsetArray,Vo,O,V,m,Je,de.predicate,$t.collisionCircleDiameter,Pc,E,Ct),_s.circles.length&&_s.collisionDetected&&!m&&o.w("Collisions detected, but collision boxes are not shown"),Ti=Oe||_s.circles.length>0&&!_s.collisionDetected,bi=bi&&_s.offscreen}if(Tr.iconFeatureIndex&&(bA=Tr.iconFeatureIndex),Tr.iconBox){const ra=Vo=>this.collisionIndex.placeCollisionBox(Vo,je,G,bt,O,Je,$e,R,de.predicate,Ct,Qe&&Gs?Gs:void 0,Zt);ao&&ao.placeable&&Tr.verticalIconBox?(lo=ra(Tr.verticalIconBox),Bn=lo.placeable):(lo=ra(Tr.iconBox),Bn=lo.placeable),bi=bi&&lo.offscreen}const vA=Ee||$t.numHorizontalGlyphVertices===0&&$t.numVerticalGlyphVertices===0,qd=Se||$t.numIconVertices===0;vA||qd?qd?vA||(Bn=Bn&&Ti):Ti=Bn&&Ti:Bn=Ti=Bn&&Ti;const Ch=Bn&&lo.placeable;if(Ti&&us.placeable&&this.collisionIndex.insertCollisionBox(us.box,Ie,B.get("text-ignore-placement"),y.bucketInstanceId,ao&&ao.placeable&&xh?xh:wh,de.ID),Ch&&this.collisionIndex.insertCollisionBox(lo.box,je,B.get("icon-ignore-placement"),y.bucketInstanceId,bA,de.ID),_s&&Ti&&this.collisionIndex.insertCollisionCircles(_s.circles,Ie,B.get("text-ignore-placement"),y.bucketInstanceId,wh,de.ID),m&&this.storeCollisionData(y.bucketInstanceId,tn,Tr,us,lo,_s),$t.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[$t.crossTileID]=new Da((Ti||Mt)&&!us?.occluded,(Bn||yt)&&!lo?.occluded,bi||y.justReloaded),f[$t.crossTileID]=!0};if(at){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const $t=y.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Tr=$t.length-1;Tr>=0;--Tr){const tn=$t[Tr];rr(y.symbolInstances.get(tn),y.collisionArrays[tn],tn)}}else for(let $t=l.symbolInstanceStart;$t<l.symbolInstanceEnd;$t++)rr(y.symbolInstances.get($t),y.collisionArrays[$t],$t);y.justReloaded=!1}storeCollisionData(l,f,m,y,B,E){if(m.textBox||m.iconBox){let R,O;this.collisionBoxArrays.has(l)?R=this.collisionBoxArrays.get(l):(R=new Map,this.collisionBoxArrays.set(l,R)),R.has(f)?O=R.get(f):(O={text:null,icon:null},R.set(f,O)),m.textBox&&(O.text=y.box),m.iconBox&&(O.icon=B.box)}if(E){let R=this.collisionCircleArrays[l];R===void 0&&(R=this.collisionCircleArrays[l]=[]);for(let O=0;O<E.circles.length;O+=4)R.push(E.circles[O+0]-Nr),R.push(E.circles[O+1]-Nr),R.push(E.circles[O+2]),R.push(E.collisionDetected?1:0)}}markUsedJustification(l,f,m,y){let B;B=y===o.ao.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[o.aG(f)];const E=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const R of E)R>=0&&(l.text.placedSymbolArray.get(R).crossTileID=B>=0&&R!==B?0:m.crossTileID)}markUsedOrientation(l,f,m){const y=f===o.ao.horizontal||f===o.ao.horizontalOnly?f:0,B=f===o.ao.vertical?f:0,E=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const R of E)l.text.placedSymbolArray.get(R).placedOrientation=y;m.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=B)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let m=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const y=f?f.symbolFadeChange(l):1,B=f?f.opacities:{},E=f?f.variableOffsets:{},R=f?f.placedOrientations:{};for(const O in this.placements){const V=this.placements[O],G=B[O];G?(this.opacities[O]=new al(G,y,V.text,V.icon),m=m||V.text!==G.text.placed||V.icon!==G.icon.placed):(this.opacities[O]=new al(null,y,V.text,V.icon,V.skipFade),m=m||V.text||V.icon)}for(const O in B){const V=B[O];if(!this.opacities[O]){const G=new al(V,y,!1,!1);G.isHidden()||(this.opacities[O]=G,m=m||V.text.placed||V.icon.placed)}}for(const O in E)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=E[O]);for(const O in R)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=R[O]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)}updateLayerOpacities(l,f){const m={};for(const y of f){const B=y.getBucket(l);B&&y.latestFeatureIndex&&l.id===B.layerIds[0]&&this.updateBucketOpacities(B,y.tileID,m,y.collisionBoxArray)}}updateBucketOpacities(l,f,m,y){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const B=l.layers[0],E=B.layout,R=new al(null,0,!1,!1,!0),O=E.get("text-allow-overlap"),V=E.get("icon-allow-overlap"),G=B._unevaluatedLayout.hasValue("text-variable-anchor")||B._unevaluatedLayout.hasValue("text-variable-anchor-offset"),J=E.get("text-rotation-alignment")==="map",X=E.get("text-pitch-alignment")==="map",ne=E.get("icon-text-fit")!=="none",de=new al(null,0,O&&(V||!l.hasIconData()||E.get("icon-optional")),V&&(O||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&y&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(y);const Ee=(Ie,Oe,je)=>{for(let De=0;De<Oe/4;De++)Ie.opacityVertexArray.emplaceBack(je);Ie.hasVisibleVertices=Ie.hasVisibleVertices||je!==uc},Se=this.collisionBoxArrays.get(l.bucketInstanceId);for(let Ie=0;Ie<l.symbolInstances.length;Ie++){const Oe=l.symbolInstances.get(Ie),{numHorizontalGlyphVertices:je,numVerticalGlyphVertices:De,crossTileID:$e}=Oe;let Je=this.opacities[$e];m[$e]?Je=R:Je||(Je=de,this.opacities[$e]=Je),m[$e]=!0;const Qe=Oe.numIconVertices>0,at=this.placedOrientations[Oe.crossTileID],Mt=at===o.ao.vertical,yt=at===o.ao.horizontal||at===o.ao.horizontalOnly;if(je>0||De>0){const Ct=th(Je.text);Ee(l.text,je,Mt?uc:Ct),Ee(l.text,De,yt?uc:Ct);const Zt=Je.text.isHidden();[Oe.rightJustifiedTextSymbolIndex,Oe.centerJustifiedTextSymbolIndex,Oe.leftJustifiedTextSymbolIndex].forEach(Tr=>{Tr>=0&&(l.text.placedSymbolArray.get(Tr).hidden=Zt||Mt?1:0)}),Oe.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Oe.verticalPlacedTextSymbolIndex).hidden=Zt||yt?1:0);const rr=this.variableOffsets[Oe.crossTileID];rr&&this.markUsedJustification(l,rr.anchor,Oe,at);const $t=this.placedOrientations[Oe.crossTileID];$t&&(this.markUsedJustification(l,"left",Oe,$t),this.markUsedOrientation(l,$t,Oe))}if(Qe){const Ct=th(Je.icon),Zt=!(ne&&Oe.verticalPlacedIconSymbolIndex&&Mt);Oe.placedIconSymbolIndex>=0&&(Ee(l.icon,Oe.numIconVertices,Zt?Ct:uc),l.icon.placedSymbolArray.get(Oe.placedIconSymbolIndex).hidden=Je.icon.isHidden()),Oe.verticalPlacedIconSymbolIndex>=0&&(Ee(l.icon,Oe.numVerticalIconVertices,Zt?uc:Ct),l.icon.placedSymbolArray.get(Oe.verticalPlacedIconSymbolIndex).hidden=Je.icon.isHidden())}const bt=Se&&Se.has(Ie)?Se.get(Ie):{text:null,icon:null};if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const Ct=l.collisionArrays[Ie];if(Ct){let Zt=new o.P(0,0);if(Ct.textBox||Ct.verticalTextBox){let rr=!0;if(G){const $t=this.variableOffsets[$e];$t?(Zt=eA($t.anchor,$t.width,$t.height,$t.textOffset,$t.textBoxScale),J&&Zt._rotate(X?-this.transform.bearingInRadians:this.transform.bearingInRadians)):rr=!1}if(Ct.textBox||Ct.verticalTextBox){let $t;Ct.textBox&&($t=Mt),Ct.verticalTextBox&&($t=yt),ll(l.textCollisionBox.collisionVertexArray,Je.text.placed,!rr||$t,bt.text,Zt.x,Zt.y)}}if(Ct.iconBox||Ct.verticalIconBox){const rr=!!(!yt&&Ct.verticalIconBox);let $t;Ct.iconBox&&($t=rr),Ct.verticalIconBox&&($t=!rr),ll(l.iconCollisionBox.collisionVertexArray,Je.icon.placed,$t,bt.icon,ne?Zt.x:0,ne?Zt.y:0)}}}}if(l.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);l.bucketInstanceId in this.collisionCircleArrays&&(l.collisionCircleArray=this.collisionCircleArrays[l.bucketInstanceId],delete this.collisionCircleArrays[l.bucketInstanceId])}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,f){const m=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*m>l}setStale(){this.stale=!0}}function ll(v,l,f,m,y,B){m&&m.length!==0||(m=[0,0,0,0]);const E=m[0]-Nr,R=m[1]-Nr,O=m[2]-Nr,V=m[3]-Nr;v.emplaceBack(l?1:0,f?1:0,y||0,B||0,E,R),v.emplaceBack(l?1:0,f?1:0,y||0,B||0,O,R),v.emplaceBack(l?1:0,f?1:0,y||0,B||0,O,V),v.emplaceBack(l?1:0,f?1:0,y||0,B||0,E,V)}const tA=Math.pow(2,25),Pl=Math.pow(2,24),hu=Math.pow(2,17),Na=Math.pow(2,16),cc=Math.pow(2,9),Vi=Math.pow(2,8),Au=Math.pow(2,1);function th(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const l=v.placed?1:0,f=Math.floor(127*v.opacity);return f*tA+l*Pl+f*hu+l*Na+f*cc+l*Vi+f*Au+l}const uc=0;class rA{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,f,m,y,B){const E=this._bucketParts;for(;this._currentTileIndex<l.length;)if(f.getBucketParts(E,y,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,B())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((R,O)=>R.sortKey-O.sortKey));this._currentPartIndex<E.length;)if(f.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,B())return!0;return!1}}class _a{constructor(l,f,m,y,B,E,R,O){this.placement=new Yi(l,f,E,R,O),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=B,this._done=!1}isDone(){return this._done}continuePlacement(l,f,m){const y=M(),B=()=>!this._forceFullPlacement&&M()-y>2;for(;this._currentPlacementIndex>=0;){const E=f[l[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=R)&&(!E.maxzoom||E.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new rA(E)),this._inProgressLayer.continuePlacement(m[E.source],this.placement,this._showCollisionBoxes,E,B))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const hc=512/o.$/2;class Ac{constructor(l,f,m){this.tileID=l,this.bucketInstanceId=m,this._symbolsByKey={};const y=new Map;for(let B=0;B<f.length;B++){const E=f.get(B),R=E.key,O=y.get(R);O?O.push(E):y.set(R,[E])}for(const[B,E]of y){const R={positions:E.map(O=>({x:Math.floor(O.anchorX*hc),y:Math.floor(O.anchorY*hc)})),crossTileIDs:E.map(O=>O.crossTileID)};if(R.positions.length>128){const O=new o.aI(R.positions.length,16,Uint16Array);for(const{x:V,y:G}of R.positions)O.add(V,G);O.finish(),delete R.positions,R.index=O}this._symbolsByKey[B]=R}}getScaledCoordinates(l,f){const{x:m,y,z:B}=this.tileID.canonical,{x:E,y:R,z:O}=f.canonical,V=hc/Math.pow(2,O-B),G=(R*o.$+l.anchorY)*V,J=y*o.$*hc;return{x:Math.floor((E*o.$+l.anchorX)*V-m*o.$*hc),y:Math.floor(G-J)}}findMatches(l,f,m){const y=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let B=0;B<l.length;B++){const E=l.get(B);if(E.crossTileID)continue;const R=this._symbolsByKey[E.key];if(!R)continue;const O=this.getScaledCoordinates(E,f);if(R.index){const V=R.index.range(O.x-y,O.y-y,O.x+y,O.y+y).sort();for(const G of V){const J=R.crossTileIDs[G];if(!m[J]){m[J]=!0,E.crossTileID=J;break}}}else if(R.positions)for(let V=0;V<R.positions.length;V++){const G=R.positions[V],J=R.crossTileIDs[V];if(Math.abs(G.x-O.x)<=y&&Math.abs(G.y-O.y)<=y&&!m[J]){m[J]=!0,E.crossTileID=J;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:l})=>l)}}class za{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class rh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const f=Math.round((l-this.lng)/360);if(f!==0)for(const m in this.indexes){const y=this.indexes[m],B={};for(const E in y){const R=y[E];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+f),B[R.tileID.key]=R}this.indexes[m]=B}this.lng=l}addBucket(l,f,m){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let B=0;B<f.symbolInstances.length;B++)f.symbolInstances.get(B).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const y=this.usedCrossTileIDs[l.overscaledZ];for(const B in this.indexes){const E=this.indexes[B];if(Number(B)>l.overscaledZ)for(const R in E){const O=E[R];O.tileID.isChildOf(l)&&O.findMatches(f.symbolInstances,l,y)}else{const R=E[l.scaledTo(Number(B)).key];R&&R.findMatches(f.symbolInstances,l,y)}}for(let B=0;B<f.symbolInstances.length;B++){const E=f.symbolInstances.get(B);E.crossTileID||(E.crossTileID=m.generate(),y[E.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Ac(l,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(l,f){for(const m of f.getCrossTileIDsLists())for(const y of m)delete this.usedCrossTileIDs[l][y]}removeStaleBuckets(l){let f=!1;for(const m in this.indexes){const y=this.indexes[m];for(const B in y)l[y[B].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[B]),delete y[B],f=!0)}return f}}class Ml{constructor(){this.layerIndexes={},this.crossTileIDs=new za,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,f,m){let y=this.layerIndexes[l.id];y===void 0&&(y=this.layerIndexes[l.id]=new rh);let B=!1;const E={};y.handleWrapJump(m);for(const R of f){const O=R.getBucket(l);O&&l.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(R.tileID,O,this.crossTileIDs)&&(B=!0),E[O.bucketInstanceId]=!0)}return y.removeStaleBuckets(E)&&(B=!0),B}pruneUnusedLayers(l){const f={};l.forEach(m=>{f[m]=!0});for(const m in this.layerIndexes)f[m]||delete this.layerIndexes[m]}}var nA="void main() {fragColor=vec4(1.0);}";const ya={prelude:hn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:hn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:hn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:hn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:hn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:hn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:hn(nA,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:hn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:hn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:hn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:hn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:hn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:hn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:hn(nA,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:hn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:hn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:hn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:hn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:hn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:hn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:hn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:hn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:hn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:hn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:hn(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:hn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:hn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:hn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:hn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:hn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:hn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:hn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:hn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:hn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:hn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:hn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function hn(v,l){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=l.match(/in ([\w]+) ([\w]+)/g),y=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),B=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=B?B.concat(y):y,R={};return{fragmentSource:v=v.replace(f,(O,V,G,J,X)=>(R[X]=!0,V==="define"?`
#ifndef HAS_UNIFORM_u_${X}
in ${G} ${J} ${X};
#else
uniform ${G} ${J} u_${X};
#endif
`:`
#ifdef HAS_UNIFORM_u_${X}
    ${G} ${J} ${X} = u_${X};
#endif
`)),vertexSource:l=l.replace(f,(O,V,G,J,X)=>{const ne=J==="float"?"vec2":"vec4",de=X.match(/color/)?"color":ne;return R[X]?V==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
in ${G} ${ne} a_${X};
out ${G} ${J} ${X};
#else
uniform ${G} ${J} u_${X};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = a_${X};
#else
    ${G} ${J} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = unpack_mix_${de}(a_${X}, u_${X}_t);
#else
    ${G} ${J} ${X} = u_${X};
#endif
`:V==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
in ${G} ${ne} a_${X};
#else
uniform ${G} ${J} u_${X};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${G} ${J} ${X} = a_${X};
#else
    ${G} ${J} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${G} ${J} ${X} = unpack_mix_${de}(a_${X}, u_${X}_t);
#else
    ${G} ${J} ${X} = u_${X};
#endif
`}),staticAttributes:m,staticUniforms:E}}class Hs{constructor(l,f,m){this.vertexBuffer=l,this.indexBuffer=f,this.segments=m}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var en=o.aJ([{name:"a_pos",type:"Int16",components:2}]);const nh="#define PROJECTION_MERCATOR",fc="mercator";class Fl{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return fc}get shaderDefine(){return nh}get shaderPreludeCode(){return ya.projectionMercator}get vertexShaderPreludeCode(){return ya.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(l){}getMeshFromTileID(l,f,m,y,B){if(this._cachedMesh)return this._cachedMesh;const E=new o.aL;E.emplaceBack(0,0),E.emplaceBack(o.$,0),E.emplaceBack(0,o.$),E.emplaceBack(o.$,o.$);const R=l.createVertexBuffer(E,en.members),O=o.aM.simpleSegment(0,0,4,2),V=new o.aN;V.emplaceBack(1,0,2),V.emplaceBack(1,2,3);const G=l.createIndexBuffer(V);return this._cachedMesh=new Hs(R,G,O),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(l){}}class Qr{constructor(l=0,f=0,m=0,y=0){if(isNaN(l)||l<0||isNaN(f)||f<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=m,this.right=y}interpolate(l,f,m){return f.top!=null&&l.top!=null&&(this.top=o.C.number(l.top,f.top,m)),f.bottom!=null&&l.bottom!=null&&(this.bottom=o.C.number(l.bottom,f.bottom,m)),f.left!=null&&l.left!=null&&(this.left=o.C.number(l.left,f.left,m)),f.right!=null&&l.right!=null&&(this.right=o.C.number(l.right,f.right,m)),this}getCenter(l,f){const m=o.ae((this.left+l-this.right)/2,0,l),y=o.ae((this.top+f-this.bottom)/2,0,f);return new o.P(m,y)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Qr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function as(v,l){if(!v.renderWorldCopies||v.lngRange)return;const f=l.lng-v.center.lng;l.lng+=f>180?-360:f<-180?360:0}function Ss(v){return Math.max(0,Math.floor(v))}class Zi{constructor(l,f){var m;this._callbacks=l,this._tileSize=512,this._renderWorldCopies=f?.renderWorldCopies===void 0||!!f?.renderWorldCopies,this._minZoom=f?.minZoom||0,this._maxZoom=f?.maxZoom||22,this._minPitch=f?.minPitch==null?0:f?.minPitch,this._maxPitch=f?.maxPitch==null?60:f?.maxPitch,this._constrain=(m=f?.constrain)!==null&&m!==void 0?m:this._callbacks.constrain,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ss(this._zoom),this._scale=o.ah(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Qr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(l,f,m){this._latRange=l.latRange,this._lngRange=l.lngRange,this._width=l.width,this._height=l.height,this._center=l.center,this._elevation=l.elevation,this._minElevationForCurrentTile=l.minElevationForCurrentTile,this._zoom=l.zoom,this._tileZoom=Ss(this._zoom),this._scale=o.ah(this._zoom),this._bearingInRadians=l.bearingInRadians,this._fovInRadians=l.fovInRadians,this._pitchInRadians=l.pitchInRadians,this._rollInRadians=l.rollInRadians,this._unmodified=l.unmodified,this._edgeInsets=new Qr(l.padding.top,l.padding.bottom,l.padding.left,l.padding.right),this._minZoom=l.minZoom,this._maxZoom=l.maxZoom,this._minPitch=l.minPitch,this._maxPitch=l.maxPitch,this._renderWorldCopies=l.renderWorldCopies,this._cameraToCenterDistance=l.cameraToCenterDistance,this._nearZ=l.nearZ,this._farZ=l.farZ,this._autoCalculateNearFarZ=!m&&l.autoCalculateNearFarZ,f&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(l){this._minElevationForCurrentTile=l}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(l){this._minZoom!==l&&(this._minZoom=l,this.setZoom(this.constrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.setZoom(this.constrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(l){this._minPitch!==l&&(this._minPitch=l,this.setPitch(Math.max(this.pitch,l)))}get maxPitch(){return this._maxPitch}setMaxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.setPitch(Math.min(this.pitch,l)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get constrain(){return this._constrain}setConstrain(l){l||(l=this._callbacks.constrain),this._constrain=l,this.constrainInternal(),this._calcMatrices()}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(l){const f=o.aO(l,-180,180)*Math.PI/180;var m,y,B,E,R,O,V,G,J;this._bearingInRadians!==f&&(this._unmodified=!1,this._bearingInRadians=f,this._calcMatrices(),this._rotationMatrix=d(),m=this._rotationMatrix,B=-this._bearingInRadians,E=(y=this._rotationMatrix)[0],R=y[1],O=y[2],V=y[3],G=Math.sin(B),J=Math.cos(B),m[0]=E*J+O*G,m[1]=R*J+V*G,m[2]=E*-G+O*J,m[3]=R*-G+V*J)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(l){const f=o.ae(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==f&&(this._unmodified=!1,this._pitchInRadians=f,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(l){const f=l/180*Math.PI;this._rollInRadians!==f&&(this._unmodified=!1,this._rollInRadians=f,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aP(this._fovInRadians)}setFov(l){l=o.ae(l,.1,150),this.fov!==l&&(this._unmodified=!1,this._fovInRadians=o.ag(l),this._calcMatrices())}get zoom(){return this._zoom}setZoom(l){const f=this.constrain(this._center,l).zoom;this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this._tileZoom=Math.max(0,Math.floor(f)),this._scale=o.ah(f),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(l){l!==this._elevation&&(this._elevation=l,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(l,f){this._autoCalculateNearFarZ=!1,this._nearZ=l,this._farZ=f,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,f,m){this._unmodified=!1,this._edgeInsets.interpolate(l,f,m),this.constrainInternal(),this._calcMatrices()}resize(l,f,m=!0){this._width=l,this._height=f,m&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Re([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(l){l?(this._lngRange=[l.getWest(),l.getEast()],this._latRange=[l.getSouth(),l.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-o.af,o.af])}getCameraQueryGeometry(l,f){if(f.length===1)return[f[0],l];{const{minX:m,minY:y,maxX:B,maxY:E}=o.a2.fromPoints(f).extend(l);return[new o.P(m,y),new o.P(B,y),new o.P(B,E),new o.P(m,E),new o.P(m,y)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:f,zoom:m}=this.constrain(this.center,this.zoom);this.setCenter(f),this.setZoom(m),this._unmodified=l,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let l=o.ai(new Float64Array(16));o.N(l,l,[this._width/2,-this._height/2,1]),o.M(l,l,[1,-1,0]),this._clipSpaceToPixelsMatrix=l,l=o.ai(new Float64Array(16)),o.N(l,l,[1,-1,1]),o.M(l,l,[-1,-1,0]),o.N(l,l,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=l,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(l,f,m,y){const B=m!==void 0?m:this.bearing,E=y=y!==void 0?y:this.pitch,R=o.a1.fromLngLat(l,f),O=-Math.cos(o.ag(E)),V=Math.sin(o.ag(E)),G=V*Math.sin(o.ag(B)),J=-V*Math.cos(o.ag(B));let X=this.elevation;const ne=f-X;let de;O*ne>=0||Math.abs(O)<.1?(de=1e4,X=f+de*O):de=-ne/O;let Ee,Se,Ie=o.aQ(1,R.y),Oe=0;do{if(Oe+=1,Oe>10)break;Se=de/Ie,Ee=new o.a1(R.x+G*Se,R.y+J*Se),Ie=1/Ee.meterInMercatorCoordinateUnits()}while(Math.abs(de-Se*Ie)>1e-12);return{center:Ee.toLngLat(),elevation:X,zoom:o.ak(this.height/2/Math.tan(this.fovInRadians/2)/Se/this.tileSize)}}recalculateZoomAndCenter(l){if(this.elevation-l==0)return;const f=o.aj(1,this.center.lat)*this.worldSize,m=this.cameraToCenterDistance/f,y=o.a1.fromLngLat(this.center,this.elevation),B=Lt(this.center,this.elevation,this.pitch,this.bearing,m);this._elevation=l;const E=this.calculateCenterFromCameraLngLatAlt(B.toLngLat(),o.aQ(B.z,y.y),this.bearing,this.pitch);this._elevation=E.elevation,this._center=E.center,this.setZoom(E.zoom)}getCameraPoint(){const l=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(l*Math.sin(this.rollInRadians),l*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const l=o.aj(1,this.center.lat)*this.worldSize;return Lt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/l).toLngLat()}getMercatorTileCoordinates(l){if(!l)return[0,0,1,1];const f=l.canonical.z>=0?1<<l.canonical.z:Math.pow(2,l.canonical.z);return[l.canonical.x/f,l.canonical.y/f,1/f/o.$,1/f/o.$]}}class si{constructor(l,f){this.min=l,this.max=f,this.center=o.aR([],o.aS([],this.min,this.max),.5)}quadrant(l){const f=[l%2==0,l<2],m=o.aT(this.min),y=o.aT(this.max);for(let B=0;B<f.length;B++)m[B]=f[B]?this.min[B]:this.center[B],y[B]=f[B]?this.center[B]:this.max[B];return y[2]=this.max[2],new si(m,y)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersectsFrustum(l){let f=!0;for(let m=0;m<l.planes.length;m++){const y=this.intersectsPlane(l.planes[m]);if(y===0)return 0;y===1&&(f=!1)}return f?2:l.aabb.min[0]>this.max[0]||l.aabb.min[1]>this.max[1]||l.aabb.min[2]>this.max[2]||l.aabb.max[0]<this.min[0]||l.aabb.max[1]<this.min[1]||l.aabb.max[2]<this.min[2]?0:1}intersectsPlane(l){let f=l[3],m=l[3];for(let y=0;y<3;y++)l[y]>0?(f+=l[y]*this.min[y],m+=l[y]*this.max[y]):(m+=l[y]*this.min[y],f+=l[y]*this.max[y]);return f>=0?2:m<0?0:1}}class Rl{distanceToTile2d(l,f,m,y){const B=y.distanceX([l,f]),E=y.distanceY([l,f]);return Math.hypot(B,E)}getWrap(l,f,m){return m}getTileBoundingVolume(l,f,m,y){var B,E;let R=0,O=0;if(y?.terrain){const G=new o.Z(l.z,f,l.z,l.x,l.y),J=y.terrain.getMinMaxElevation(G);R=(B=J.minElevation)!==null&&B!==void 0?B:Math.min(0,m),O=(E=J.maxElevation)!==null&&E!==void 0?E:Math.max(0,m)}const V=1<<l.z;return new si([f+l.x/V,l.y/V,R],[f+(l.x+1)/V,(l.y+1)/V,O])}allowVariableZoom(l,f){const m=l.fov*(Math.abs(Math.cos(l.rollInRadians))*l.height+Math.abs(Math.sin(l.rollInRadians))*l.width)/l.height,y=o.ae(78.5-m/2,0,60);return!!f.terrain||l.pitch>y}allowWorldCopies(){return!0}prepareNextFrame(){}}class xi{constructor(l,f,m){this.points=l,this.planes=f,this.aabb=m}static fromInvProjectionMatrix(l,f=1,m=0,y,B){const E=B?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],R=Math.pow(2,m),O=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(X=>function(ne,de,Ee,Se){const Ie=o.aw([],ne,de),Oe=1/Ie[3]/Ee*Se;return o.aY(Ie,Ie,[Oe,Oe,1/Ie[3],Oe])}(X,l,f,R));y&&function(X,ne,de,Ee){const Se=Ee?4:0,Ie=Ee?0:4;let Oe=0;const je=[],De=[];for(let Qe=0;Qe<4;Qe++){const at=o.aU([],X[Qe+Ie],X[Qe+Se]),Mt=o.aZ(at);o.aR(at,at,1/Mt),je.push(Mt),De.push(at)}for(let Qe=0;Qe<4;Qe++){const at=o.a_(X[Qe+Se],De[Qe],de);Oe=at!==null&&at>=0?Math.max(Oe,at):Math.max(Oe,je[Qe])}const $e=function(Qe,at){const Mt=o.aU([],Qe[at[0]],Qe[at[1]]),yt=o.aU([],Qe[at[2]],Qe[at[1]]),bt=[0,0,0,0];return o.aV(bt,o.aW([],Mt,yt)),bt[3]=-o.aX(bt,Qe[at[0]]),bt}(X,ne),Je=function(Qe,at){const Mt=o.a$(Qe),yt=o.b0([],Qe,1/Mt),bt=o.aU([],at,o.aR([],yt,o.aX(at,yt))),Ct=o.a$(bt);if(Ct>0){const Zt=Math.sqrt(1-yt[3]*yt[3]),rr=o.aR([],yt,-yt[3]),$t=o.aS([],rr,o.aR([],bt,Zt/Ct));return o.b1(at,$t)}return null}(de,$e);if(Je!==null){const Qe=Je/o.aX(De[0],$e);Oe=Math.min(Oe,Qe)}for(let Qe=0;Qe<4;Qe++){const at=Math.min(Oe,je[Qe]);X[Qe+Ie]=[X[Qe+Se][0]+De[Qe][0]*at,X[Qe+Se][1]+De[Qe][1]*at,X[Qe+Se][2]+De[Qe][2]*at,1]}}(O,E[0],y,B);const V=E.map(X=>{const ne=o.aU([],O[X[0]],O[X[1]]),de=o.aU([],O[X[2]],O[X[1]]),Ee=o.aV([],o.aW([],ne,de)),Se=-o.aX(Ee,O[X[1]]);return Ee.concat(Se)}),G=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],J=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const X of O)for(let ne=0;ne<3;ne++)G[ne]=Math.min(G[ne],X[ne]),J[ne]=Math.max(J[ne],X[ne]);return new xi(O,V,new si(G,J))}}class As{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,f,m){return this._helper.interpolatePadding(l,f,m)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,f,m=!0){this._helper.resize(l,f,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}setConstrain(l){this._helper.setConstrain(l)}overrideNearFarZ(l,f){this._helper.overrideNearFarZ(l,f)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(l,f){}constructor(l){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(f,m)=>{m=o.ae(+m,this.minZoom,this.maxZoom);const y={center:new o.S(f.lng,f.lat),zoom:m};let B=this._helper._lngRange;if(!this._helper._renderWorldCopies&&B===null){const De=179.9999999999;B=[-De,De]}const E=this.tileSize*o.ah(y.zoom);let R=0,O=E,V=0,G=E,J=0,X=0;const{x:ne,y:de}=this.size;if(this._helper._latRange){const De=this._helper._latRange;R=o.U(De[1])*E,O=o.U(De[0])*E,O-R<de&&(J=de/(O-R))}B&&(V=o.aO(o.V(B[0])*E,0,E),G=o.aO(o.V(B[1])*E,0,E),G<V&&(G+=E),G-V<ne&&(X=ne/(G-V)));const{x:Ee,y:Se}=We(E,f);let Ie,Oe;const je=Math.max(X||0,J||0);if(je){const De=new o.P(X?(G+V)/2:Ee,J?(O+R)/2:Se);return y.center=nt(E,De).wrap(),y.zoom+=o.ak(je),y}if(this._helper._latRange){const De=de/2;Se-De<R&&(Oe=R+De),Se+De>O&&(Oe=O-De)}if(B){const De=(V+G)/2;let $e=Ee;this._helper._renderWorldCopies&&($e=o.aO(Ee,De-E/2,De+E/2));const Je=ne/2;$e-Je<V&&(Ie=V+Je),$e+Je>G&&(Ie=G-Je)}if(Ie!==void 0||Oe!==void 0){const De=new o.P(Ie??Ee,Oe??Se);y.center=nt(E,De).wrap()}return y},this._helper=new Zi({calcMatrices:()=>{this._calcMatrices()},constrain:(f,m)=>this.defaultConstrain(f,m)},l),this._coveringTilesDetailsProvider=new Rl}clone(){const l=new As;return l.apply(this),l}apply(l,f,m){this._helper.apply(l,f,m)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(l){const f=[new o.b2(0,l)];if(this._helper._renderWorldCopies){const m=this.screenPointToMercatorCoordinate(new o.P(0,0)),y=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),B=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),E=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),R=Math.floor(Math.min(m.x,y.x,B.x,E.x)),O=Math.floor(Math.max(m.x,y.x,B.x,E.x)),V=1;for(let G=R-V;G<=O+V;G++)G!==0&&f.push(new o.b2(G,l))}return f}getCameraFrustum(){return xi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(l){const f=this.screenPointToLocation(this.centerPoint,l),m=l?l.getElevationForLngLatZoom(f,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(m)}setLocationAtPoint(l,f){const m=o.aj(this.elevation,this.center.lat),y=this.screenPointToMercatorCoordinateAtZ(f,m),B=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,m),E=o.a1.fromLngLat(l),R=new o.a1(E.x-(y.x-B.x),E.y-(y.y-B.y));this.setCenter(R?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(l,f){return f?this.coordinatePoint(o.a1.fromLngLat(l),f.getElevationForLngLatZoom(l,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.a1.fromLngLat(l))}screenPointToLocation(l,f){var m;return(m=this.screenPointToMercatorCoordinate(l,f))===null||m===void 0?void 0:m.toLngLat()}screenPointToMercatorCoordinate(l,f){if(f){const m=f.pointCoordinate(l);if(m!=null)return m}return this.screenPointToMercatorCoordinateAtZ(l)}screenPointToMercatorCoordinateAtZ(l,f){const m=f||0,y=[l.x,l.y,0,1],B=[l.x,l.y,1,1];o.aw(y,y,this._pixelMatrixInverse),o.aw(B,B,this._pixelMatrixInverse);const E=y[3],R=B[3],O=y[1]/E,V=B[1]/R,G=y[2]/E,J=B[2]/R,X=G===J?0:(m-G)/(J-G);return new o.a1(o.C.number(y[0]/E,B[0]/R,X)/this.worldSize,o.C.number(O,V,X)/this.worldSize,m)}coordinatePoint(l,f=0,m=this._pixelMatrix){const y=[l.x*this.worldSize,l.y*this.worldSize,f,1];return o.aw(y,y,m),new o.P(y[0]/y[3],y[1]/y[3])}getBounds(){const l=Math.max(0,this._helper._height/2-Ge(this));return new Re().extend(this.screenPointToLocation(new o.P(0,l))).extend(this.screenPointToLocation(new o.P(this._helper._width,l))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(l,f){return f?f.pointCoordinate(l)!=null:l.y>this.height/2-Ge(this)}calculatePosMatrix(l,f=!1,m){var y;const B=(y=l.key)!==null&&y!==void 0?y:o.b3(l.wrap,l.canonical.z,l.canonical.z,l.canonical.x,l.canonical.y),E=f?this._alignedPosMatrixCache:this._posMatrixCache;if(E.has(B)){const V=E.get(B);return m?V.f32:V.f64}const R=lt(l,this.worldSize);o.O(R,f?this._alignedProjMatrix:this._viewProjMatrix,R);const O={f64:R,f32:new Float32Array(R)};return E.set(B,O),m?O.f32:O.f64}calculateFogMatrix(l){const f=l.key,m=this._fogMatrixCacheF32;if(m.has(f))return m.get(f);const y=lt(l,this.worldSize);return o.O(y,this._fogMatrix,y),m.set(f,new Float32Array(y)),m.get(f)}calculateCenterFromCameraLngLatAlt(l,f,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(l,f,m,y)}_calculateNearFarZIfNeeded(l,f,m){if(!this._helper.autoCalculateNearFarZ)return;const y=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),B=l-y*this._helper._pixelPerMeter/Math.cos(f),E=y<0?B:l,R=Math.PI/2+this.pitchInRadians,O=o.ag(this.fov)*(Math.abs(Math.cos(o.ag(this.roll)))*this.height+Math.abs(Math.sin(o.ag(this.roll)))*this.width)/this.height*(.5+m.y/this.height),V=Math.sin(O)*E/Math.sin(o.ae(Math.PI-R-O,.01,Math.PI-.01)),G=Ge(this),J=Math.atan(G/this._helper.cameraToCenterDistance),X=o.ag(.75),ne=J>X?2*J*(.5+m.y/(2*G)):X,de=Math.sin(ne)*E/Math.sin(o.ae(Math.PI-R-ne,.01,Math.PI-.01)),Ee=Math.min(V,de);this._helper._farZ=1.01*(Math.cos(Math.PI/2-f)*Ee+E),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const l=this.centerOffset,f=We(this.worldSize,this.center),m=f.x,y=f.y;this._helper._pixelPerMeter=o.aj(1,this.center.lat)*this.worldSize;const B=o.ag(Math.min(this.pitch,Me)),E=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(B));let R;this._calculateNearFarZIfNeeded(E,B,l),R=new Float64Array(16),o.b4(R,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.aq(this._invProjMatrix,R),R[8]=2*-l.x/this._helper._width,R[9]=2*l.y/this._helper._height,this._projectionMatrix=o.b5(R),o.N(R,R,[1,-1,1]),o.M(R,R,[0,0,-this._helper.cameraToCenterDistance]),o.b6(R,R,-this.rollInRadians),o.b7(R,R,this.pitchInRadians),o.b6(R,R,-this.bearingInRadians),o.M(R,R,[-m,-y,0]),this._mercatorMatrix=o.N([],R,[this.worldSize,this.worldSize,this.worldSize]),o.N(R,R,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,R),o.M(R,R,[0,0,-this.elevation]),this._viewProjMatrix=R,this._invViewProjMatrix=o.aq([],R);const O=[0,0,-1,1];o.aw(O,O,this._invViewProjMatrix),this._cameraPosition=[O[0]/O[3],O[1]/O[3],O[2]/O[3]],this._fogMatrix=new Float64Array(16),o.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,E,this._helper._farZ),this._fogMatrix[8]=2*-l.x/this.width,this._fogMatrix[9]=2*l.y/this.height,o.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.M(this._fogMatrix,this._fogMatrix,[-m,-y,0]),o.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,R);const V=this._helper._width%2/2,G=this._helper._height%2/2,J=Math.cos(this.bearingInRadians),X=Math.sin(-this.bearingInRadians),ne=m-Math.round(m)+J*V+X*G,de=y-Math.round(y)+J*G+X*V,Ee=new Float64Array(R);if(o.M(Ee,Ee,[ne>.5?ne-1:ne,de>.5?de-1:de,0]),this._alignedProjMatrix=Ee,R=o.aq(new Float64Array(16),this._pixelMatrix),!R)throw new Error("failed to invert matrix");this._pixelMatrixInverse=R,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const l=this.screenPointToMercatorCoordinate(new o.P(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return o.aw(f,f,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const l=o.aj(1,this.center.lat)*this.worldSize;return Lt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/l).toLngLat()}lngLatToCameraDepth(l,f){const m=o.a1.fromLngLat(l),y=[m.x*this.worldSize,m.y*this.worldSize,f,1];return o.aw(y,y,this._viewProjMatrix),y[2]/y[3]}getProjectionData(l){const{overscaledTileID:f,aligned:m,applyTerrainMatrix:y}=l,B=this._helper.getMercatorTileCoordinates(f),E=f?this.calculatePosMatrix(f,m,!0):null;let R;return R=f&&f.terrainRttPosMatrix32f&&y?f.terrainRttPosMatrix32f:E||o.b8(),{mainMatrix:R,tileMercatorCoords:B,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:R}}isLocationOccluded(l){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(l,f,m){return 1}transformLightDirection(l){return o.aT(l)}getRayDirectionFromPixel(l){throw new Error("Not implemented.")}projectTileCoordinates(l,f,m,y){const B=this.calculatePosMatrix(m);let E;y?(E=[l,f,y(l,f),1],o.aw(E,E,B)):(E=[l,f,0,1],qn(E,E,B));const R=E[3];return{point:new o.P(E[0]/R,E[1]/R),signedDistanceFromCamera:R,isOccluded:!1}}populateCache(l){for(const f of l)this.calculatePosMatrix(f)}getMatrixForModel(l,f){const m=o.a1.fromLngLat(l,f),y=m.meterInMercatorCoordinateUnits(),B=o.b9();return o.M(B,B,[m.x,m.y,m.z]),o.b6(B,B,Math.PI),o.b7(B,B,Math.PI/2),o.N(B,B,[-y,y,y]),B}getProjectionDataForCustomLayer(l=!0){const f=new o.Z(0,0,0,0,0),m=this.getProjectionData({overscaledTileID:f,applyGlobeMatrix:l}),y=lt(f,this.worldSize);o.O(y,this._viewProjMatrix,y),m.tileMercatorCoords=[0,0,1,1];const B=[o.$,o.$,this.worldSize/this._helper.pixelsPerMeter],E=o.ba();return o.N(E,y,B),m.fallbackMatrix=E,m.mainMatrix=E,m}getFastPathSimpleProjectionMatrix(l){return this.calculatePosMatrix(l)}}function no(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function dc(v){if(v.useSlerp)if(v.k<1){const l=o.bb(v.startEulerAngles.roll,v.startEulerAngles.pitch,v.startEulerAngles.bearing),f=o.bb(v.endEulerAngles.roll,v.endEulerAngles.pitch,v.endEulerAngles.bearing),m=new Float64Array(4);o.bc(m,l,f,v.k);const y=o.bd(m);v.tr.setRoll(y.roll),v.tr.setPitch(y.pitch),v.tr.setBearing(y.bearing)}else v.tr.setRoll(v.endEulerAngles.roll),v.tr.setPitch(v.endEulerAngles.pitch),v.tr.setBearing(v.endEulerAngles.bearing);else v.tr.setRoll(o.C.number(v.startEulerAngles.roll,v.endEulerAngles.roll,v.k)),v.tr.setPitch(o.C.number(v.startEulerAngles.pitch,v.endEulerAngles.pitch,v.k)),v.tr.setBearing(o.C.number(v.startEulerAngles.bearing,v.endEulerAngles.bearing,v.k))}function cl(v,l,f,m,y){const B=y.padding,E=We(y.worldSize,f.getNorthWest()),R=We(y.worldSize,f.getNorthEast()),O=We(y.worldSize,f.getSouthEast()),V=We(y.worldSize,f.getSouthWest()),G=o.ag(-m),J=E.rotate(G),X=R.rotate(G),ne=O.rotate(G),de=V.rotate(G),Ee=new o.P(Math.max(J.x,X.x,de.x,ne.x),Math.max(J.y,X.y,de.y,ne.y)),Se=new o.P(Math.min(J.x,X.x,de.x,ne.x),Math.min(J.y,X.y,de.y,ne.y)),Ie=Ee.sub(Se),Oe=(y.width-(B.left+B.right+l.left+l.right))/Ie.x,je=(y.height-(B.top+B.bottom+l.top+l.bottom))/Ie.y;if(je<0||Oe<0)return void no();const De=Math.min(o.ak(y.scale*Math.min(Oe,je)),v.maxZoom),$e=o.P.convert(v.offset),Je=new o.P((l.left-l.right)/2,(l.top-l.bottom)/2).rotate(o.ag(m)),Qe=$e.add(Je).mult(y.scale/o.ah(De));return{center:nt(y.worldSize,E.add(O).div(2).sub(Qe)),zoom:De,bearing:m}}class Kn{get useGlobeControls(){return!1}handlePanInertia(l,f){const m=l.mag(),y=Math.abs(Ge(f));return{easingOffset:l.mult(Math.min(.75*y/m,1)),easingCenter:f.center}}handleMapControlsRollPitchBearingZoom(l,f){l.bearingDelta&&f.setBearing(f.bearing+l.bearingDelta),l.pitchDelta&&f.setPitch(f.pitch+l.pitchDelta),l.rollDelta&&f.setRoll(f.roll+l.rollDelta),l.zoomDelta&&f.setZoom(f.zoom+l.zoomDelta)}handleMapControlsPan(l,f,m){l.around.distSqr(f.centerPoint)<.01||f.setLocationAtPoint(m,l.around)}cameraForBoxAndBearing(l,f,m,y,B){return cl(l,f,m,y,B)}handleJumpToCenterZoom(l,f){l.zoom!==(f.zoom!==void 0?+f.zoom:l.zoom)&&l.setZoom(+f.zoom),f.center!==void 0&&l.setCenter(o.S.convert(f.center))}handleEaseTo(l,f){const m=l.zoom,y=l.padding,B={roll:l.roll,pitch:l.pitch,bearing:l.bearing},E={roll:f.roll===void 0?l.roll:f.roll,pitch:f.pitch===void 0?l.pitch:f.pitch,bearing:f.bearing===void 0?l.bearing:f.bearing},R=f.zoom!==void 0,O=!l.isPaddingEqual(f.padding);let V=!1;const G=R?+f.zoom:l.zoom;let J=l.centerPoint.add(f.offsetAsPoint);const X=l.screenPointToLocation(J),{center:ne,zoom:de}=l.constrain(o.S.convert(f.center||X),G??m);as(l,ne);const Ee=We(l.worldSize,X),Se=We(l.worldSize,ne).sub(Ee),Ie=o.ah(de-m);return V=de!==m,{easeFunc:Oe=>{if(V&&l.setZoom(o.C.number(m,de,Oe)),o.be(B,E)||dc({startEulerAngles:B,endEulerAngles:E,tr:l,k:Oe,useSlerp:B.roll!=E.roll}),O&&(l.interpolatePadding(y,f.padding,Oe),J=l.centerPoint.add(f.offsetAsPoint)),f.around)l.setLocationAtPoint(f.around,f.aroundPoint);else{const je=o.ah(l.zoom-m),De=de>m?Math.min(2,Ie):Math.max(.5,Ie),$e=Math.pow(De,1-Oe),Je=nt(l.worldSize,Ee.add(Se.mult(Oe*$e)).mult(je));l.setLocationAtPoint(l.renderWorldCopies?Je.wrap():Je,J)}},isZooming:V,elevationCenter:ne}}handleFlyTo(l,f){const m=f.zoom!==void 0,y=l.zoom,B=l.constrain(o.S.convert(f.center||f.locationAtOffset),m?+f.zoom:y),E=B.center,R=B.zoom;as(l,E);const O=We(l.worldSize,f.locationAtOffset),V=We(l.worldSize,E).sub(O),G=V.mag(),J=o.ah(R-y);let X;if(f.minZoom!==void 0){const ne=Math.min(+f.minZoom,y,R),de=l.constrain(E,ne).zoom;X=o.ah(de-y)}return{easeFunc:(ne,de,Ee,Se)=>{l.setZoom(ne===1?R:y+o.ak(de));const Ie=ne===1?E:nt(l.worldSize,O.add(V.mult(Ee)).mult(de));l.setLocationAtPoint(l.renderWorldCopies?Ie.wrap():Ie,Se)},scaleOfZoom:J,targetCenter:E,scaleOfMinZoom:X,pixelPathLength:G}}}class kn{constructor(l,f,m){this.blendFunction=l,this.blendColor=f,this.mask=m}}kn.Replace=[1,0],kn.disabled=new kn(kn.Replace,o.bf.transparent,[!1,!1,!1,!1]),kn.unblended=new kn(kn.Replace,o.bf.transparent,[!0,!0,!0,!0]),kn.alphaBlended=new kn([1,771],o.bf.transparent,[!0,!0,!0,!0]);const ko=2305;class Tn{constructor(l,f,m){this.enable=l,this.mode=f,this.frontFace=m}}Tn.disabled=new Tn(!1,1029,ko),Tn.backCCW=new Tn(!0,1029,ko),Tn.frontCCW=new Tn(!0,1028,ko);class Yr{constructor(l,f,m){this.func=l,this.mask=f,this.range=m}}Yr.ReadOnly=!1,Yr.ReadWrite=!0,Yr.disabled=new Yr(519,Yr.ReadOnly,[0,1]);const pc=7680;class An{constructor(l,f,m,y,B,E){this.test=l,this.ref=f,this.mask=m,this.fail=y,this.depthFail=B,this.pass=E}}An.disabled=new An({func:519,mask:0},0,0,pc,pc,pc);const Ll=new WeakMap;function No(v){var l;if(Ll.has(v))return Ll.get(v);{const f=(l=v.getParameter(v.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return Ll.set(v,f),f}}class Qa{get awaitingQuery(){return!!this._readbackQueue}constructor(l){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=l;const f=l.context,m=f.gl;this._texFormat=m.RGBA,this._texType=m.UNSIGNED_BYTE;const y=new o.aL;y.emplaceBack(-1,-1),y.emplaceBack(2,-1),y.emplaceBack(-1,2);const B=new o.aN;B.emplaceBack(0,1,2),this._fullscreenTriangle=new Hs(f.createVertexBuffer(y,en.members),f.createIndexBuffer(B),o.aM.simpleSegment(0,0,y.length,B.length)),this._resultBuffer=new Uint8Array(4),f.activeTexture.set(m.TEXTURE1);const E=m.createTexture();m.bindTexture(m.TEXTURE_2D,E),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.NEAREST),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.NEAREST),m.texImage2D(m.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=f.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(E),No(m)&&(this._pbo=m.createBuffer(),m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.bufferData(m.PIXEL_PACK_BUFFER,4,m.STREAM_READ),m.bindBuffer(m.PIXEL_PACK_BUFFER,null))}destroy(){const l=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),l.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(l,f){const m=this._updateCount;return this._readbackQueue?m>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():m>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(l,f),this._updateCount++,this._measuredError}_bindFramebuffer(){const l=this._cachedRenderContext.context,f=l.gl;l.activeTexture.set(f.TEXTURE1),f.bindTexture(f.TEXTURE_2D,this._fbo.colorAttachment.get()),l.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(l,f){const m=this._cachedRenderContext.context,y=m.gl;if(this._bindFramebuffer(),m.viewport.set([0,0,this._texWidth,this._texHeight]),m.clear({color:o.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(m,y.TRIANGLES,Yr.disabled,An.disabled,kn.unblended,Tn.disabled,((B,E)=>({u_input:B,u_output_expected:E}))(l,f),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&No(y)){y.bindBuffer(y.PIXEL_PACK_BUFFER,this._pbo),y.readBuffer(y.COLOR_ATTACHMENT0),y.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),y.bindBuffer(y.PIXEL_PACK_BUFFER,null);const B=y.fenceSync(y.SYNC_GPU_COMMANDS_COMPLETE,0);y.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:B}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const l=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&No(l)){const f=l.clientWaitSync(this._readbackQueue.sync,0,0);if(f===l.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(f===l.TIMEOUT_EXPIRED)return;l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),l.bindBuffer(l.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),l.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Qa._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(l){let f=0;return f+=l[0]/256,f+=l[1]/65536,f+=l[2]/16777216,l[3]<127&&(f=-f),f/128}}const Ha=o.$/128;function Va(v,l){const f=v.granularity!==void 0?Math.max(v.granularity,1):1,m=f+(v.generateBorders?2:0),y=f+(v.extendToNorthPole||v.generateBorders?1:0)+(v.extendToSouthPole||v.generateBorders?1:0),B=m+1,E=y+1,R=v.generateBorders?-1:0,O=v.generateBorders||v.extendToNorthPole?-1:0,V=f+(v.generateBorders?1:0),G=f+(v.generateBorders||v.extendToSouthPole?1:0),J=B*E,X=m*y*6,ne=B*E>65536;if(ne&&l==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const de=ne||l==="32bit",Ee=new Int16Array(2*J);let Se=0;for(let je=O;je<=G;je++)for(let De=R;De<=V;De++){let $e=De/f*o.$;De===-1&&($e=-Ha),De===f+1&&($e=o.$+Ha);let Je=je/f*o.$;je===-1&&(Je=v.extendToNorthPole?o.bh:-Ha),je===f+1&&(Je=v.extendToSouthPole?o.bi:o.$+Ha),Ee[Se++]=$e,Ee[Se++]=Je}const Ie=de?new Uint32Array(X):new Uint16Array(X);let Oe=0;for(let je=0;je<y;je++)for(let De=0;De<m;De++){const $e=De+1+je*B,Je=De+(je+1)*B,Qe=De+1+(je+1)*B;Ie[Oe++]=De+je*B,Ie[Oe++]=Je,Ie[Oe++]=$e,Ie[Oe++]=$e,Ie[Oe++]=Je,Ie[Oe++]=Qe}return{vertices:Ee.buffer.slice(0),indices:Ie.buffer.slice(0),uses32bitIndices:de}}const Ol=new o.aK({fill:new o.bj(128,2),line:new o.bj(512,0),tile:new o.bj(128,32),stencil:new o.bj(128,1),circle:3});class gc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ya.projectionGlobe}get vertexShaderPreludeCode(){return ya.projectionMercator.vertexSource}get subdivisionGranularity(){return Ol}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(l){this._errorMeasurement||(this._errorMeasurement=new Qa(l));const f=o.U(this._errorQueryLatitudeDegrees),m=2*Math.atan(Math.exp(Math.PI-f*Math.PI*2))-.5*Math.PI,y=this._errorMeasurement.updateErrorLoop(f,m),B=M();y!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=y,this._errorMeasurementLastChangeTime=B);const E=Math.min(Math.max((B-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bl(E))}_getMeshKey(l){return`${l.granularity.toString(36)}_${l.generateBorders?"b":""}${l.extendToNorthPole?"n":""}${l.extendToSouthPole?"s":""}`}getMeshFromTileID(l,f,m,y,B){const E=(B==="stencil"?Ol.stencil:Ol.tile).getGranularityForZoomLevel(f.z);return this._getMesh(l,{granularity:E,generateBorders:m,extendToNorthPole:f.y===0&&y,extendToSouthPole:f.y===(1<<f.z)-1&&y})}_getMesh(l,f){const m=this._getMeshKey(f);if(m in this._tileMeshCache)return this._tileMeshCache[m];const y=function(B,E){const R=Va(E,"16bit"),O=o.aL.deserialize({arrayBuffer:R.vertices,length:R.vertices.byteLength/2/2}),V=o.aN.deserialize({arrayBuffer:R.indices,length:R.indices.byteLength/2/3});return new Hs(B.createVertexBuffer(O,en.members),B.createIndexBuffer(V),o.aM.simpleSegment(0,0,O.length,V.length))}(l,f);return this._tileMeshCache[m]=y,y}recalculate(l){}hasTransition(){const l=M();let f=!1;return f=f||(l-this._errorMeasurementLastChangeTime)/1e3<.7,f=f||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,f}setErrorQueryLatitudeDegrees(l){this._errorQueryLatitudeDegrees=l}}const io=new o.r({type:new o.D(o.v.projection.type)});class Yo extends o.E{constructor(l){super(),this._transitionable=new o.t(io,void 0),this.setProjection(l),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0)),this._mercatorProjection=new Fl,this._verticalPerspectiveProjection=new gc}get transitionState(){const l=this.properties.get("type");if(typeof l=="string"&&l==="mercator")return 0;if(typeof l=="string"&&l==="vertical-perspective")return 1;if(l instanceof o.bm){if(l.from==="vertical-perspective"&&l.to==="mercator")return 1-l.transition;if(l.from==="mercator"&&l.to==="vertical-perspective")return l.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(l){this._mercatorProjection.updateGPUdependent(l),this._verticalPerspectiveProjection.updateGPUdependent(l)}getMeshFromTileID(l,f,m,y,B){return this.currentProjection.getMeshFromTileID(l,f,m,y,B)}setProjection(l){this._transitionable.setValue("type",l?.type||"mercator")}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}setErrorQueryLatitudeDegrees(l){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(l),this._mercatorProjection.setErrorQueryLatitudeDegrees(l)}}function Q(v){const l=tt(v.worldSize,v.center.lat);return 2*Math.PI*l}function ue(v,l,f,m,y){const B=1/(1<<y),E=l/o.$*B+m*B,R=o.bo((v/o.$*B+f*B)*Math.PI*2+Math.PI,2*Math.PI),O=2*Math.atan(Math.exp(Math.PI-E*Math.PI*2))-.5*Math.PI,V=Math.cos(O),G=new Float64Array(3);return G[0]=Math.sin(R)*V,G[1]=Math.sin(O),G[2]=Math.cos(R)*V,G}function Fe(v){return function(l,f){const m=Math.cos(f),y=new Float64Array(3);return y[0]=Math.sin(l)*m,y[1]=Math.sin(f),y[2]=Math.cos(l)*m,y}(v.lng*Math.PI/180,v.lat*Math.PI/180)}function tt(v,l){return v/(2*Math.PI)/Math.cos(l*Math.PI/180)}function mt(v){const l=Math.asin(v[1])/Math.PI*180,f=Math.sqrt(v[0]*v[0]+v[2]*v[2]);if(f>1e-6){const m=v[0]/f,y=Math.acos(v[2]/f),B=(m>0?y:-y)/Math.PI*180;return new o.S(o.aO(B,-180,180),l)}return new o.S(0,l)}function Qt(v){return Math.cos(v*Math.PI/180)}function jt(v,l){const f=Qt(v),m=Qt(l);return o.ak(m/f)}function Dr(v,l){const f=v.rotate(l.bearingInRadians),m=l.zoom+jt(l.center.lat,0),y=o.bk(1/Qt(l.center.lat),1/Qt(Math.min(Math.abs(l.center.lat),60)),o.bn(m,7,3,0,1)),B=360/Q({worldSize:l.worldSize,center:{lat:l.center.lat}});return new o.S(l.center.lng-f.x*B*y,o.ae(l.center.lat+f.y*B,-o.af,o.af))}function Hr(v){const l=.5*v,f=Math.sin(l),m=Math.cos(l);return Math.log(f+m)-Math.log(m-f)}function Vr(v,l,f,m){const y=v.lat+f*m;if(Math.abs(f)>1){const B=(Math.sign(v.lat+f)!==Math.sign(v.lat)?-Math.abs(v.lat):Math.abs(v.lat))*Math.PI/180,E=Math.abs(v.lat+f)*Math.PI/180,R=Hr(B+m*(E-B)),O=Hr(B),V=Hr(E);return new o.S(v.lng+l*((R-O)/(V-O)),y)}return new o.S(v.lng+l*m,y)}class gn{constructor(l){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=l}swapBuffers(){if(!this._hadAnyChanges)return;const l=this._cachePrevious;this._cachePrevious=this._cache,this._cache=l,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(l,f,m,y){const B=`${l.z}_${l.x}_${l.y}_${y?.terrain?"t":""}`,E=this._cache.get(B);if(E)return E;const R=this._cachePrevious.get(B);if(R)return this._cache.set(B,R),R;const O=this._boundingVolumeFactory(l,f,m,y);return this._cache.set(B,O),this._hadAnyChanges=!0,O}}class dn{constructor(l,f,m,y){this.min=m,this.max=y,this.points=l,this.planes=f}static fromAabb(l,f){const m=[];for(let y=0;y<8;y++)m.push([1&~y?l[0]:f[0],(y>>1&1)==1?f[1]:l[1],(y>>2&1)==1?f[2]:l[2]]);return new dn(m,[[-1,0,0,f[0]],[1,0,0,-l[0]],[0,-1,0,f[1]],[0,1,0,-l[1]],[0,0,-1,f[2]],[0,0,1,-l[2]]],l,f)}static fromCenterSizeAngles(l,f,m){const y=o.br([],m[0],m[1],m[2]),B=o.bs([],[f[0],0,0],y),E=o.bs([],[0,f[1],0],y),R=o.bs([],[0,0,f[2]],y),O=[...l],V=[...l];for(let J=0;J<8;J++)for(let X=0;X<3;X++){const ne=l[X]+B[X]*(1&~J?-1:1)+E[X]*((J>>1&1)==1?1:-1)+R[X]*((J>>2&1)==1?1:-1);O[X]=Math.min(O[X],ne),V[X]=Math.max(V[X],ne)}const G=[];for(let J=0;J<8;J++){const X=[...l];o.aS(X,X,o.aR([],B,1&~J?-1:1)),o.aS(X,X,o.aR([],E,(J>>1&1)==1?1:-1)),o.aS(X,X,o.aR([],R,(J>>2&1)==1?1:-1)),G.push(X)}return new dn(G,[[...B,-o.aX(B,G[0])],[...E,-o.aX(E,G[0])],[...R,-o.aX(R,G[0])],[-B[0],-B[1],-B[2],-o.aX(B,G[7])],[-E[0],-E[1],-E[2],-o.aX(E,G[7])],[-R[0],-R[1],-R[2],-o.aX(R,G[7])]],O,V)}intersectsFrustum(l){let f=!0;const m=this.points.length,y=this.planes.length,B=l.planes.length,E=l.points.length;for(let R=0;R<B;R++){const O=l.planes[R];let V=0;for(let G=0;G<m;G++){const J=this.points[G];O[0]*J[0]+O[1]*J[1]+O[2]*J[2]+O[3]>=0&&V++}if(V===0)return 0;V<m&&(f=!1)}if(f)return 2;for(let R=0;R<y;R++){const O=this.planes[R];let V=0;for(let G=0;G<E;G++){const J=l.points[G];O[0]*J[0]+O[1]*J[1]+O[2]*J[2]+O[3]>=0&&V++}if(V===0)return 0}return 1}intersectsPlane(l){const f=this.points.length;let m=0;for(let y=0;y<f;y++){const B=this.points[y];l[0]*B[0]+l[1]*B[1]+l[2]*B[2]+l[3]>=0&&m++}return m===f?2:m===0?0:1}}function ei(v,l,f){const m=v-l;return m<0?-m:Math.max(0,m-f)}function ji(v,l,f,m,y){const B=v-f;let E;return E=B<0?Math.min(-B,1+B-y):B>1?Math.min(Math.max(B-y,0),1-B):0,Math.max(E,ei(l,m,y))}class ti{constructor(){this._boundingVolumeCache=new gn(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(l,f,m,y){const B=1<<m.z,E=1/B,R=m.x/B,O=m.y/B;let V=2;return V=Math.min(V,ji(l,f,R,O,E)),V=Math.min(V,ji(l,f,R+.5,-O-E,E)),V=Math.min(V,ji(l,f,R+.5,2-O-E,E)),V}getWrap(l,f,m){const y=1<<f.z,B=1/y,E=f.x/y,R=ei(l.x,E,B),O=ei(l.x,E-1,B),V=ei(l.x,E+1,B),G=Math.min(R,O,V);return G===V?1:G===O?-1:0}allowVariableZoom(l,f){return an(l,f)>4}allowWorldCopies(){return!1}getTileBoundingVolume(l,f,m,y){return this._boundingVolumeCache.getTileBoundingVolume(l,f,m,y)}_computeTileBoundingVolume(l,f,m,y){var B,E;let R=0,O=0;if(y?.terrain){const V=new o.Z(l.z,f,l.z,l.x,l.y),G=y.terrain.getMinMaxElevation(V);R=(B=G.minElevation)!==null&&B!==void 0?B:Math.min(0,m),O=(E=G.maxElevation)!==null&&E!==void 0?E:Math.max(0,m)}if(R/=o.bu,O/=o.bu,R+=1,O+=1,l.z<=0)return dn.fromAabb([-O,-O,-O],[O,O,O]);if(l.z===1)return dn.fromAabb([l.x===0?-O:0,l.y===0?0:-O,-O],[l.x===0?0:O,l.y===0?O:0,O]);{const V=[ue(0,0,l.x,l.y,l.z),ue(o.$,0,l.x,l.y,l.z),ue(o.$,o.$,l.x,l.y,l.z),ue(0,o.$,l.x,l.y,l.z)],G=[];for(const bt of V)G.push(o.aR([],bt,O));if(O!==R)for(const bt of V)G.push(o.aR([],bt,R));l.y===0&&G.push([0,1,0]),l.y===(1<<l.z)-1&&G.push([0,-1,0]);const J=[1,1,1],X=[-1,-1,-1];for(const bt of G)for(let Ct=0;Ct<3;Ct++)J[Ct]=Math.min(J[Ct],bt[Ct]),X[Ct]=Math.max(X[Ct],bt[Ct]);const ne=ue(o.$/2,o.$/2,l.x,l.y,l.z),de=o.aW([],[0,1,0],ne);o.aV(de,de);const Ee=o.aW([],ne,de);o.aV(Ee,Ee);const Se=o.aW([],V[2],V[1]);o.aV(Se,Se);const Ie=o.aW([],V[0],V[3]);o.aV(Ie,Ie),G.push(o.aR([],ne,O)),l.y>=(1<<l.z)/2&&G.push(o.aR([],ue(o.$/2,0,l.x,l.y,l.z),O)),l.y<(1<<l.z)/2&&G.push(o.aR([],ue(o.$/2,o.$,l.x,l.y,l.z),O));const Oe=Bi(ne,G),je=Bi(Ee,G),De=[-ne[0],-ne[1],-ne[2],Oe.max],$e=[ne[0],ne[1],ne[2],-Oe.min],Je=[-Ee[0],-Ee[1],-Ee[2],je.max],Qe=[Ee[0],Ee[1],Ee[2],-je.min],at=[...Se,0],Mt=[...Ie,0],yt=[];return l.y===0?yt.push(o.bt(Mt,at,De),o.bt(Mt,at,$e)):yt.push(o.bt(Je,at,De),o.bt(Je,at,$e),o.bt(Je,Mt,De),o.bt(Je,Mt,$e)),l.y===(1<<l.z)-1?yt.push(o.bt(Mt,at,De),o.bt(Mt,at,$e)):yt.push(o.bt(Qe,at,De),o.bt(Qe,at,$e),o.bt(Qe,Mt,De),o.bt(Qe,Mt,$e)),new dn(yt,[De,$e,Je,Qe,at,Mt],J,X)}}}function Bi(v,l){let f=1/0,m=-1/0;for(const y of l){const B=o.aX(v,y);f=Math.min(f,B),m=Math.max(m,B)}return{min:f,max:m}}class ki{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,f,m){return this._helper.interpolatePadding(l,f,m)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,f){this._helper.resize(l,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}setConstrain(l){this._helper.setConstrain(l)}overrideNearFarZ(l,f){this._helper.overrideNearFarZ(l,f)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(l){}constructor(l){this._cachedClippingPlane=o.bv(),this._projectionMatrix=o.b9(),this._globeViewProjMatrix32f=o.b8(),this._globeViewProjMatrixNoCorrection=o.b9(),this._globeViewProjMatrixNoCorrectionInverted=o.b9(),this._globeProjMatrixInverted=o.b9(),this._cameraPosition=o.bp(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(f,m)=>{const y=o.ae(f.lat,-o.af,o.af),B=o.ae(+m,this.minZoom+jt(0,y),this.maxZoom);return{center:new o.S(f.lng,y),zoom:B}},this._helper=new Zi({calcMatrices:()=>{this._calcMatrices()},constrain:(f,m)=>this.defaultConstrain(f,m)},l),this._coveringTilesDetailsProvider=new ti}clone(){const l=new ki;return l.apply(this),l}apply(l,f){this._globeLatitudeErrorCorrectionRadians=f||0,this._helper.apply(l)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const l=o.bp();return l[0]=this._cameraPosition[0],l[1]=this._cameraPosition[1],l[2]=this._cameraPosition[2],l}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(l){const{overscaledTileID:f,applyGlobeMatrix:m}=l,y=this._helper.getMercatorTileCoordinates(f);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:y,clippingPlane:this._cachedClippingPlane,projectionTransition:m?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(l){const f=this.pitchInRadians,m=this.cameraToCenterDistance/l,y=Math.sin(f)*m,B=Math.cos(f)*m+1,E=1/Math.sqrt(y*y+B*B)*1;let R=-y,O=B;const V=Math.sqrt(R*R+O*O);R/=V,O/=V;const G=[0,R,O];o.bw(G,G,[0,0,0],-this.bearingInRadians),o.bx(G,G,[0,0,0],-1*this.center.lat*Math.PI/180),o.by(G,G,[0,0,0],this.center.lng*Math.PI/180);const J=1/o.aZ(G);return o.aR(G,G,J),[...G,-E*J]}isLocationOccluded(l){return!this.isSurfacePointVisible(Fe(l))}transformLightDirection(l){const f=this._helper._center.lng*Math.PI/180,m=this._helper._center.lat*Math.PI/180,y=Math.cos(m),B=[Math.sin(f)*y,Math.sin(m),Math.cos(f)*y],E=[B[2],0,-B[0]],R=[0,0,0];o.aW(R,E,B),o.aV(E,E),o.aV(R,R);const O=[0,0,0];return o.aV(O,[E[0]*l[0]+R[0]*l[1]+B[0]*l[2],E[1]*l[0]+R[1]*l[1]+B[1]*l[2],E[2]*l[0]+R[2]*l[1]+B[2]*l[2]]),O}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(l,f,m){const y=function(R,O,V){const G=1/(1<<V.z);return new o.a1(R/o.$*G+V.x*G,O/o.$*G+V.y*G)}(l,f,m.canonical),B=(E=y.y,[o.bo(y.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-E*Math.PI*2))-.5*Math.PI]);var E;return this.getCircleRadiusCorrection()/Math.cos(B[1])}projectTileCoordinates(l,f,m,y){const B=m.canonical,E=ue(l,f,B.x,B.y,B.z),R=1+(y?y(l,f):0)/o.bu,O=[E[0]*R,E[1]*R,E[2]*R,1];o.aw(O,O,this._globeViewProjMatrixNoCorrection);const V=this._cachedClippingPlane,G=V[0]*E[0]+V[1]*E[1]+V[2]*E[2]+V[3]<0;return{point:new o.P(O[0]/O[3],O[1]/O[3]),signedDistanceFromCamera:O[3],isOccluded:G}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const l=tt(this.worldSize,this.center.lat),f=o.ba(),m=o.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*l),o.b4(f,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const y=this.centerOffset;f[8]=2*-y.x/this._helper._width,f[9]=2*y.y/this._helper._height,this._projectionMatrix=o.b5(f),this._globeProjMatrixInverted=o.ba(),o.aq(this._globeProjMatrixInverted,f),o.M(f,f,[0,0,-this.cameraToCenterDistance]),o.b6(f,f,this.rollInRadians),o.b7(f,f,-this.pitchInRadians),o.b6(f,f,this.bearingInRadians),o.M(f,f,[0,0,-l]);const B=o.bp();B[0]=l,B[1]=l,B[2]=l,o.b7(m,f,this.center.lat*Math.PI/180),o.bz(m,m,-this.center.lng*Math.PI/180),o.N(m,m,B),this._globeViewProjMatrixNoCorrection=m,o.b7(f,f,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bz(f,f,-this.center.lng*Math.PI/180),o.N(f,f,B),this._globeViewProjMatrix32f=new Float32Array(f),this._globeViewProjMatrixNoCorrectionInverted=o.ba(),o.aq(this._globeViewProjMatrixNoCorrectionInverted,m);const E=o.bp();this._cameraPosition=o.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/l,o.bw(this._cameraPosition,this._cameraPosition,E,-this.rollInRadians),o.bx(this._cameraPosition,this._cameraPosition,E,this.pitchInRadians),o.bw(this._cameraPosition,this._cameraPosition,E,-this.bearingInRadians),o.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bx(this._cameraPosition,this._cameraPosition,E,-this.center.lat*Math.PI/180),o.by(this._cameraPosition,this._cameraPosition,E,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(l);const R=o.b5(this._globeViewProjMatrixNoCorrectionInverted);o.N(R,R,[1,1,-1]),this._cachedFrustum=xi.fromInvProjectionMatrix(R,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(l){o.w("calculateFogMatrix is not supported on globe projection.");const f=o.ba();return o.ai(f),f}getVisibleUnwrappedCoordinates(l){return[new o.b2(0,l)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(l){l&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(l,f){if(!this._globeViewProjMatrixNoCorrection)return 1;const m=Fe(l);o.aR(m,m,1+f/o.bu);const y=o.bv();return o.aw(y,[m[0],m[1],m[2],1],this._globeViewProjMatrixNoCorrection),y[2]/y[3]}populateCache(l){}getBounds(){const l=.5*this.width,f=.5*this.height,m=[new o.P(0,0),new o.P(l,0),new o.P(this.width,0),new o.P(this.width,f),new o.P(this.width,this.height),new o.P(l,this.height),new o.P(0,this.height),new o.P(0,f)],y=[];for(const J of m)y.push(this.unprojectScreenPoint(J));let B=0,E=0,R=0,O=0;const V=this.center;for(const J of y){const X=o.bA(V.lng,J.lng),ne=o.bA(V.lat,J.lat);X<E&&(E=X),X>B&&(B=X),ne<O&&(O=ne),ne>R&&(R=ne)}const G=[V.lng+E,V.lat+O,V.lng+B,V.lat+R];return this.isSurfacePointOnScreen([0,1,0])&&(G[3]=90,G[0]=-180,G[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(G[1]=-90,G[0]=-180,G[2]=180),new Re(G)}calculateCenterFromCameraLngLatAlt(l,f,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(l,f,m,y)}setLocationAtPoint(l,f){const m=Fe(this.unprojectScreenPoint(f)),y=Fe(l),B=o.bp();o.bB(B);const E=o.bp();o.by(E,m,B,-this.center.lng*Math.PI/180),o.bx(E,E,B,this.center.lat*Math.PI/180);const R=y[0]*y[0]+y[2]*y[2],O=E[0]*E[0];if(R<O)return;const V=Math.sqrt(R-O),G=-V,J=o.bC(y[0],y[2],E[0],V),X=o.bC(y[0],y[2],E[0],G),ne=o.bp();o.by(ne,y,B,-J);const de=o.bC(ne[1],ne[2],E[1],E[2]),Ee=o.bp();o.by(Ee,y,B,-X);const Se=o.bC(Ee[1],Ee[2],E[1],E[2]),Ie=.5*Math.PI,Oe=de>=-Ie&&de<=Ie,je=Se>=-Ie&&Se<=Ie;let De,$e;if(Oe&&je){const Mt=this.center.lng*Math.PI/180,yt=this.center.lat*Math.PI/180;o.bD(J,Mt)+o.bD(de,yt)<o.bD(X,Mt)+o.bD(Se,yt)?(De=J,$e=de):(De=X,$e=Se)}else if(Oe)De=J,$e=de;else{if(!je)return;De=X,$e=Se}const Je=De/Math.PI*180,Qe=$e/Math.PI*180,at=this.center.lat;this.setCenter(new o.S(Je,o.ae(Qe,-90,90))),this.setZoom(this.zoom+jt(at,this.center.lat))}locationToScreenPoint(l,f){const m=Fe(l);if(f){const y=f.getElevationForLngLatZoom(l,this._helper._tileZoom);o.aR(m,m,1+y/o.bu)}return this._projectSurfacePointToScreen(m)}_projectSurfacePointToScreen(l){const f=o.bv();return o.aw(f,[...l,1],this._globeViewProjMatrixNoCorrection),f[0]/=f[3],f[1]/=f[3],new o.P((.5*f[0]+.5)*this.width,(.5*-f[1]+.5)*this.height)}screenPointToMercatorCoordinate(l,f){if(f){const m=f.pointCoordinate(l);if(m)return m}return o.a1.fromLngLat(this.unprojectScreenPoint(l))}screenPointToLocation(l,f){var m;return(m=this.screenPointToMercatorCoordinate(l,f))===null||m===void 0?void 0:m.toLngLat()}isPointOnMapSurface(l,f){const m=this._cameraPosition,y=this.getRayDirectionFromPixel(l);return!!this.rayPlanetIntersection(m,y)}getRayDirectionFromPixel(l){const f=o.bv();f[0]=l.x/this.width*2-1,f[1]=-1*(l.y/this.height*2-1),f[2]=1,f[3]=1,o.aw(f,f,this._globeViewProjMatrixNoCorrectionInverted),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3];const m=o.bp();m[0]=f[0]-this._cameraPosition[0],m[1]=f[1]-this._cameraPosition[1],m[2]=f[2]-this._cameraPosition[2];const y=o.bp();return o.aV(y,m),y}isSurfacePointVisible(l){const f=this._cachedClippingPlane;return f[0]*l[0]+f[1]*l[1]+f[2]*l[2]+f[3]>=0}isSurfacePointOnScreen(l){if(!this.isSurfacePointVisible(l))return!1;const f=o.bv();return o.aw(f,[...l,1],this._globeViewProjMatrixNoCorrection),f[0]/=f[3],f[1]/=f[3],f[2]/=f[3],f[0]>-1&&f[0]<1&&f[1]>-1&&f[1]<1&&f[2]>-1&&f[2]<1}rayPlanetIntersection(l,f){const m=o.aX(l,f),y=o.bp(),B=o.bp();o.aR(B,f,m),o.aU(y,l,B);const E=1-o.aX(y,y);if(E<0)return null;const R=o.aX(l,l)-1,O=-m+(m<0?1:-1)*Math.sqrt(E),V=R/O,G=O;return{tMin:Math.min(V,G),tMax:Math.max(V,G)}}unprojectScreenPoint(l){const f=this._cameraPosition,m=this.getRayDirectionFromPixel(l),y=this.rayPlanetIntersection(f,m);if(y){const G=o.bp();o.aS(G,f,[m[0]*y.tMin,m[1]*y.tMin,m[2]*y.tMin]);const J=o.bp();return o.aV(J,G),mt(J)}const B=this._cachedClippingPlane,E=B[0]*m[0]+B[1]*m[1]+B[2]*m[2],R=-o.b1(B,f)/E,O=o.bp();if(R>0)o.aS(O,f,[m[0]*R,m[1]*R,m[2]*R]);else{const G=o.bp();o.aS(G,f,[2*m[0],2*m[1],2*m[2]]);const J=o.b1(this._cachedClippingPlane,G);o.aU(O,G,[this._cachedClippingPlane[0]*J,this._cachedClippingPlane[1]*J,this._cachedClippingPlane[2]*J])}const V=function(G){const J=o.bp();return J[0]=G[0]*-G[3],J[1]=G[1]*-G[3],J[2]=G[2]*-G[3],{center:J,radius:Math.sqrt(1-G[3]*G[3])}}(B);return mt(function(G,J,X){const ne=o.bp();o.aU(ne,X,G);const de=o.bp();return o.bq(de,G,ne,J/o.a$(ne)),de}(V.center,V.radius,O))}getMatrixForModel(l,f){const m=o.S.convert(l),y=1/o.bu,B=o.b9();return o.bz(B,B,m.lng/180*Math.PI),o.b7(B,B,-m.lat/180*Math.PI),o.M(B,B,[0,0,1+f/o.bu]),o.b7(B,B,.5*Math.PI),o.N(B,B,[y,y,y]),B}getProjectionDataForCustomLayer(l=!0){const f=this.getProjectionData({overscaledTileID:new o.Z(0,0,0,0,0),applyGlobeMatrix:l});return f.tileMercatorCoords=[0,0,1,1],f}getFastPathSimpleProjectionMatrix(l){}}class ls{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(l){this._helper.setMinZoom(l)}setMaxZoom(l){this._helper.setMaxZoom(l)}setMinPitch(l){this._helper.setMinPitch(l)}setMaxPitch(l){this._helper.setMaxPitch(l)}setRenderWorldCopies(l){this._helper.setRenderWorldCopies(l)}setBearing(l){this._helper.setBearing(l)}setPitch(l){this._helper.setPitch(l)}setRoll(l){this._helper.setRoll(l)}setFov(l){this._helper.setFov(l)}setZoom(l){this._helper.setZoom(l)}setCenter(l){this._helper.setCenter(l)}setElevation(l){this._helper.setElevation(l)}setMinElevationForCurrentTile(l){this._helper.setMinElevationForCurrentTile(l)}setPadding(l){this._helper.setPadding(l)}interpolatePadding(l,f,m){return this._helper.interpolatePadding(l,f,m)}isPaddingEqual(l){return this._helper.isPaddingEqual(l)}resize(l,f,m=!0){this._helper.resize(l,f,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(l){this._helper.setMaxBounds(l)}setConstrain(l){this._helper.setConstrain(l)}overrideNearFarZ(l,f){this._helper.overrideNearFarZ(l,f)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(l){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),l)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(l,f){this._globeness=l,this._globeLatitudeErrorCorrectionRadians=f,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(l){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(f,m)=>this.currentTransform.defaultConstrain(f,m),this._helper=new Zi({calcMatrices:()=>{this._calcMatrices()},constrain:(f,m)=>this.defaultConstrain(f,m)},l),this._globeness=1,this._mercatorTransform=new As,this._verticalPerspectiveTransform=new ki}clone(){const l=new ls;return l._globeness=this._globeness,l._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,l.apply(this),l}apply(l){this._helper.apply(l),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(l){const f=this._mercatorTransform.getProjectionData(l),m=this._verticalPerspectiveTransform.getProjectionData(l);return{mainMatrix:this.isGlobeRendering?m.mainMatrix:f.mainMatrix,clippingPlane:m.clippingPlane,tileMercatorCoords:m.tileMercatorCoords,projectionTransition:l.applyGlobeMatrix?this._globeness:0,fallbackMatrix:f.fallbackMatrix}}isLocationOccluded(l){return this.currentTransform.isLocationOccluded(l)}transformLightDirection(l){return this.currentTransform.transformLightDirection(l)}getPixelScale(){return o.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(l,f,m){const y=this._mercatorTransform.getPitchedTextCorrection(l,f,m),B=this._verticalPerspectiveTransform.getPitchedTextCorrection(l,f,m);return o.bk(y,B,this._globeness)}projectTileCoordinates(l,f,m,y){return this.currentTransform.projectTileCoordinates(l,f,m,y)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(l){return this.currentTransform.calculateFogMatrix(l)}getVisibleUnwrappedCoordinates(l){return this.currentTransform.getVisibleUnwrappedCoordinates(l)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(l){this._mercatorTransform.recalculateZoomAndCenter(l),this._verticalPerspectiveTransform.recalculateZoomAndCenter(l)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(l,f){return this.currentTransform.lngLatToCameraDepth(l,f)}populateCache(l){this._mercatorTransform.populateCache(l),this._verticalPerspectiveTransform.populateCache(l)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(l,f,m,y){return this._helper.calculateCenterFromCameraLngLatAlt(l,f,m,y)}setLocationAtPoint(l,f){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(l,f),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(l,f),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(l,f){return this.currentTransform.locationToScreenPoint(l,f)}screenPointToMercatorCoordinate(l,f){return this.currentTransform.screenPointToMercatorCoordinate(l,f)}screenPointToLocation(l,f){return this.currentTransform.screenPointToLocation(l,f)}isPointOnMapSurface(l,f){return this.currentTransform.isPointOnMapSurface(l,f)}getRayDirectionFromPixel(l){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(l)}getMatrixForModel(l,f){return this.currentTransform.getMatrixForModel(l,f)}getProjectionDataForCustomLayer(l=!0){const f=this._mercatorTransform.getProjectionDataForCustomLayer(l);if(!this.isGlobeRendering)return f;const m=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(l);return m.fallbackMatrix=f.mainMatrix,m}getFastPathSimpleProjectionMatrix(l){return this.currentTransform.getFastPathSimpleProjectionMatrix(l)}}class fs{get useGlobeControls(){return!0}handlePanInertia(l,f){const m=Dr(l,f);return Math.abs(m.lng-f.center.lng)>180&&(m.lng=f.center.lng+179.5*Math.sign(m.lng-f.center.lng)),{easingCenter:m,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(l,f){const m=l.around,y=f.screenPointToLocation(m);l.bearingDelta&&f.setBearing(f.bearing+l.bearingDelta),l.pitchDelta&&f.setPitch(f.pitch+l.pitchDelta),l.rollDelta&&f.setRoll(f.roll+l.rollDelta);const B=f.zoom;l.zoomDelta&&f.setZoom(f.zoom+l.zoomDelta);const E=f.zoom-B;if(E===0)return;const R=o.bA(f.center.lng,y.lng),O=R/(Math.abs(R/180)+1),V=o.bA(f.center.lat,y.lat),G=f.getRayDirectionFromPixel(m),J=f.cameraPosition,X=-1*o.aX(J,G),ne=o.bp();o.aS(ne,J,[G[0]*X,G[1]*X,G[2]*X]);const de=o.aZ(ne)-1,Ee=Math.exp(.5*-Math.max(de-.3,0)),Se=tt(f.worldSize,f.center.lat)/Math.min(f.width,f.height),Ie=o.bn(Se,.9,.5,1,.25),Oe=(1-o.ah(-E))*Math.min(Ee,Ie),je=f.center.lat,De=f.zoom,$e=new o.S(f.center.lng+O*Oe,o.ae(f.center.lat+V*Oe,-o.af,o.af));f.setLocationAtPoint(y,m);const Je=f.center,Qe=o.bn(Math.abs(R),45,85,0,1),at=o.bn(Se,.75,.35,0,1),Mt=Math.pow(Math.max(Qe,at),.25),yt=o.bA(Je.lng,$e.lng),bt=o.bA(Je.lat,$e.lat);f.setCenter(new o.S(Je.lng+yt*Mt,Je.lat+bt*Mt).wrap()),f.setZoom(De+jt(je,f.center.lat))}handleMapControlsPan(l,f,m){if(!l.panDelta)return;const y=f.center.lat,B=f.zoom;f.setCenter(Dr(l.panDelta,f).wrap()),f.setZoom(B+jt(y,f.center.lat))}cameraForBoxAndBearing(l,f,m,y,B){const E=cl(l,f,m,y,B),R=f.left/B.width*2-1,O=(B.width-f.right)/B.width*2-1,V=f.top/B.height*-2+1,G=(B.height-f.bottom)/B.height*-2+1,J=o.bA(m.getWest(),m.getEast())<0,X=J?m.getEast():m.getWest(),ne=J?m.getWest():m.getEast(),de=Math.max(m.getNorth(),m.getSouth()),Ee=Math.min(m.getNorth(),m.getSouth()),Se=X+.5*o.bA(X,ne),Ie=de+.5*o.bA(de,Ee),Oe=B.clone();Oe.setCenter(E.center),Oe.setBearing(E.bearing),Oe.setPitch(0),Oe.setRoll(0),Oe.setZoom(E.zoom);const je=Oe.modelViewProjectionMatrix,De=[Fe(m.getNorthWest()),Fe(m.getNorthEast()),Fe(m.getSouthWest()),Fe(m.getSouthEast()),Fe(new o.S(ne,Ie)),Fe(new o.S(X,Ie)),Fe(new o.S(Se,de)),Fe(new o.S(Se,Ee))],$e=Fe(E.center);let Je=Number.POSITIVE_INFINITY;for(const Qe of De)R<0&&(Je=fs.getLesserNonNegativeNonNull(Je,fs.solveVectorScale(Qe,$e,je,"x",R))),O>0&&(Je=fs.getLesserNonNegativeNonNull(Je,fs.solveVectorScale(Qe,$e,je,"x",O))),V>0&&(Je=fs.getLesserNonNegativeNonNull(Je,fs.solveVectorScale(Qe,$e,je,"y",V))),G<0&&(Je=fs.getLesserNonNegativeNonNull(Je,fs.solveVectorScale(Qe,$e,je,"y",G)));if(Number.isFinite(Je)&&Je!==0)return E.zoom=Oe.zoom+o.ak(Je),E;no()}handleJumpToCenterZoom(l,f){const m=l.center.lat,y=l.constrain(f.center?o.S.convert(f.center):l.center,l.zoom).center;l.setCenter(y.wrap());const B=f.zoom!==void 0?+f.zoom:l.zoom+jt(m,y.lat);l.zoom!==B&&l.setZoom(B)}handleEaseTo(l,f){const m=l.zoom,y=l.center,B=l.padding,E={roll:l.roll,pitch:l.pitch,bearing:l.bearing},R={roll:f.roll===void 0?l.roll:f.roll,pitch:f.pitch===void 0?l.pitch:f.pitch,bearing:f.bearing===void 0?l.bearing:f.bearing},O=f.zoom!==void 0,V=!l.isPaddingEqual(f.padding);let G=!1;const J=f.center?o.S.convert(f.center):y,X=l.constrain(J,m).center;as(l,X);const ne=l.clone();ne.setCenter(X),ne.setZoom(O?+f.zoom:m+jt(y.lat,J.lat)),ne.setBearing(f.bearing);const de=new o.P(o.ae(l.centerPoint.x+f.offsetAsPoint.x,0,l.width),o.ae(l.centerPoint.y+f.offsetAsPoint.y,0,l.height));ne.setLocationAtPoint(X,de);const Ee=(f.offset&&f.offsetAsPoint.mag())>0?ne.center:X,Se=O?+f.zoom:m+jt(y.lat,Ee.lat),Ie=m+jt(y.lat,0),Oe=Se+jt(Ee.lat,0),je=o.bA(y.lng,Ee.lng),De=o.bA(y.lat,Ee.lat),$e=o.ah(Oe-Ie);return G=Se!==m,{easeFunc:Je=>{if(o.be(E,R)||dc({startEulerAngles:E,endEulerAngles:R,tr:l,k:Je,useSlerp:E.roll!=R.roll}),V&&l.interpolatePadding(B,f.padding,Je),f.around)o.w("Easing around a point is not supported under globe projection."),l.setLocationAtPoint(f.around,f.aroundPoint);else{const Qe=Oe>Ie?Math.min(2,$e):Math.max(.5,$e),at=Math.pow(Qe,1-Je),Mt=Vr(y,je,De,Je*at);l.setCenter(Mt.wrap())}if(G){const Qe=o.C.number(Ie,Oe,Je)+jt(0,l.center.lat);l.setZoom(Qe)}},isZooming:G,elevationCenter:Ee}}handleFlyTo(l,f){const m=f.zoom!==void 0,y=l.center,B=l.zoom,E=l.padding,R=!l.isPaddingEqual(f.padding),O=l.constrain(o.S.convert(f.center||f.locationAtOffset),B).center,V=m?+f.zoom:l.zoom+jt(l.center.lat,O.lat),G=l.clone();G.setCenter(O),G.setZoom(V),G.setBearing(f.bearing);const J=new o.P(o.ae(l.centerPoint.x+f.offsetAsPoint.x,0,l.width),o.ae(l.centerPoint.y+f.offsetAsPoint.y,0,l.height));G.setLocationAtPoint(O,J);const X=G.center;as(l,X);const ne=function(De,$e,Je){const Qe=Fe($e),at=Fe(Je),Mt=o.aX(Qe,at),yt=Math.acos(Mt),bt=Q(De);return yt/(2*Math.PI)*bt}(l,y,X),de=B+jt(y.lat,0),Ee=V+jt(X.lat,0),Se=o.ah(Ee-de);let Ie;if(typeof f.minZoom=="number"){const De=+f.minZoom+jt(X.lat,0),$e=Math.min(De,de,Ee)+jt(0,X.lat),Je=l.constrain(X,$e).zoom+jt(X.lat,0);Ie=o.ah(Je-de)}const Oe=o.bA(y.lng,X.lng),je=o.bA(y.lat,X.lat);return{easeFunc:(De,$e,Je,Qe)=>{const at=Vr(y,Oe,je,Je);R&&l.interpolatePadding(E,f.padding,De);const Mt=De===1?X:at;l.setCenter(Mt.wrap());const yt=de+o.ak($e);l.setZoom(De===1?V:yt+jt(0,Mt.lat))},scaleOfZoom:Se,targetCenter:X,scaleOfMinZoom:Ie,pixelPathLength:ne}}static solveVectorScale(l,f,m,y,B){const E=y==="x"?[m[0],m[4],m[8],m[12]]:[m[1],m[5],m[9],m[13]],R=[m[3],m[7],m[11],m[15]],O=l[0]*E[0]+l[1]*E[1]+l[2]*E[2],V=l[0]*R[0]+l[1]*R[1]+l[2]*R[2],G=f[0]*E[0]+f[1]*E[1]+f[2]*E[2],J=f[0]*R[0]+f[1]*R[1]+f[2]*R[2];return G+B*V===O+B*J||R[3]*(O-G)+E[3]*(J-V)+O*J==G*V?null:(G+E[3]-B*J-B*R[3])/(G-O-B*J+B*V)}static getLesserNonNegativeNonNull(l,f){return f!==null&&f>=0&&f<l?f:l}}class Ul{constructor(l){this._globe=l,this._mercatorCameraHelper=new Kn,this._verticalPerspectiveCameraHelper=new fs}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(l,f){return this.currentHelper.handlePanInertia(l,f)}handleMapControlsRollPitchBearingZoom(l,f){return this.currentHelper.handleMapControlsRollPitchBearingZoom(l,f)}handleMapControlsPan(l,f,m){this.currentHelper.handleMapControlsPan(l,f,m)}cameraForBoxAndBearing(l,f,m,y,B){return this.currentHelper.cameraForBoxAndBearing(l,f,m,y,B)}handleJumpToCenterZoom(l,f){this.currentHelper.handleJumpToCenterZoom(l,f)}handleEaseTo(l,f){return this.currentHelper.handleEaseTo(l,f)}handleFlyTo(l,f){return this.currentHelper.handleFlyTo(l,f)}}const ih=(v,l)=>o.y(v,l&&l.filter(f=>f.identifier!=="source.canvas")),uf=o.bE();class ba extends o.E{constructor(l,f={}){var m,y;super(),this._rtlPluginLoaded=()=>{for(const E in this.sourceCaches){const R=this.sourceCaches[E].getSource().type;R!=="vector"&&R!=="geojson"||this.sourceCaches[E].reload()}},this.map=l,this.dispatcher=new Pt(it(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",(E,R)=>this.getGlyphs(E,R)),this.dispatcher.registerMessageHandler("GI",(E,R)=>this.getImages(E,R)),this.dispatcher.registerMessageHandler("GDA",(E,R)=>this.getDashes(E,R)),this.imageManager=new te,this.imageManager.setEventedParent(this);const B=((m=l._container)===null||m===void 0?void 0:m.lang)||typeof document<"u"&&((y=document.documentElement)===null||y===void 0?void 0:y.lang)||void 0;this.glyphManager=new qe(l._requestManager,f.localIdeographFontFamily,B),this.lineAtlas=new ht(256,512),this.crossTileSymbolIndex=new Ml,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",o.bG()),wr().on(hr,this._rtlPluginLoaded),this.on("data",E=>{if(E.dataType!=="source"||E.sourceDataType!=="metadata")return;const R=this.sourceCaches[E.sourceId];if(!R)return;const O=R.getSource();if(O&&O.vectorLayerIds)for(const V in this._layers){const G=this._layers[V];G.source===O.id&&this._validateLayer(G)}})}setGlobalStateProperty(l,f){var m,y,B;this._checkLoaded();const E=f===null?(B=(y=(m=this.stylesheet.state)===null||m===void 0?void 0:m[l])===null||y===void 0?void 0:y.default)!==null&&B!==void 0?B:null:f;if(o.bH(E,this._globalState[l]))return this;this._globalState[l]=E,this._applyGlobalStateChanges([l])}getGlobalState(){return this._globalState}setGlobalState(l){this._checkLoaded();const f=[];for(const m in l)!o.bH(this._globalState[m],l[m].default)&&(f.push(m),this._globalState[m]=l[m].default);this._applyGlobalStateChanges(f)}_applyGlobalStateChanges(l){if(l.length===0)return;const f=new Set,m={};for(const y of l){m[y]=this._globalState[y];for(const B in this._layers){const E=this._layers[B],R=E.getLayoutAffectingGlobalStateRefs(),O=E.getPaintAffectingGlobalStateRefs();if(R.has(y)&&f.add(E.source),O.has(y))for(const{name:V,value:G}of O.get(y))this._updatePaintProperty(E,V,G)}}this.dispatcher.broadcast("UGS",m);for(const y in this.sourceCaches)f.has(y)&&(this._reloadSource(y),this._changed=!0)}loadURL(l,f={},m){this.fire(new o.l("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const y=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController;const B=this._loadStyleRequest;o.j(y,this._loadStyleRequest).then(E=>{this._loadStyleRequest=null,this._load(E.data,f,m)}).catch(E=>{this._loadStyleRequest=null,E&&!B.signal.aborted&&this.fire(new o.k(E))})}loadJSON(l,f={},m){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,C.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(l,f,m)}).catch(()=>{})}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(uf,{validate:!1})}_load(l,f,m){var y,B;let E=f.transformStyle?f.transformStyle(m,l):l;if(!f.validate||!ih(this,o.z(E))){E=Object.assign({},E),this._loaded=!0,this.stylesheet=E;for(const R in E.sources)this.addSource(R,E.sources[R],{validate:!1});E.sprite?this._loadSprite(E.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(E.glyphs),this._createLayers(),this.light=new Ye(this.stylesheet.light),this._setProjectionInternal(((y=this.stylesheet.projection)===null||y===void 0?void 0:y.type)||"mercator"),this.sky=new wt(this.stylesheet.sky),this.map.setTerrain((B=this.stylesheet.terrain)!==null&&B!==void 0?B:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){var l,f,m;const y=o.bI(this.stylesheet.layers);this.setGlobalState((l=this.stylesheet.state)!==null&&l!==void 0?l:null),this.dispatcher.broadcast("SL",y),this._order=y.map(B=>B.id),this._layers={},this._serializedLayers=null;for(const B of y){const E=o.bJ(B,this._globalState);if(E.setEventedParent(this,{layer:{id:B.id}}),this._layers[B.id]=E,o.bK(E)&&this.sourceCaches[E.source]){const R=(m=(f=B.paint)===null||f===void 0?void 0:f["raster-fade-duration"])!==null&&m!==void 0?m:E.paint.get("raster-fade-duration");this.sourceCaches[E.source].setRasterFadeDuration(R)}}}_loadSprite(l,f=!1,m=void 0){let y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(B,E,R,O){return o._(this,void 0,void 0,function*(){const V=se(B),G=R>1?"@2x":"",J={},X={};for(const{id:ne,url:de}of V){const Ee=E.transformRequest(Z(de,G,".json"),"SpriteJSON");J[ne]=o.j(Ee,O);const Se=E.transformRequest(Z(de,G,".png"),"SpriteImage");X[ne]=W.getImage(Se,O)}return yield Promise.all([...Object.values(J),...Object.values(X)]),function(ne,de){return o._(this,void 0,void 0,function*(){const Ee={};for(const Se in ne){Ee[Se]={};const Ie=C.getImageCanvasContext((yield de[Se]).data),Oe=(yield ne[Se]).data;for(const je in Oe){const{width:De,height:$e,x:Je,y:Qe,sdf:at,pixelRatio:Mt,stretchX:yt,stretchY:bt,content:Ct,textFitWidth:Zt,textFitHeight:rr}=Oe[je];Ee[Se][je]={data:null,pixelRatio:Mt,sdf:at,stretchX:yt,stretchY:bt,content:Ct,textFitWidth:Zt,textFitHeight:rr,spriteData:{width:De,height:$e,x:Je,y:Qe,context:Ie}}}}return Ee})}(J,X)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(B=>{if(this._spriteRequest=null,B)for(const E in B){this._spritesImagesIds[E]=[];const R=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(O=>!(O in B)):[];for(const O of R)this.imageManager.removeImage(O),this._changedImages[O]=!0;for(const O in B[E]){const V=E==="default"?O:`${E}:${O}`;this._spritesImagesIds[E].push(V),V in this.imageManager.images?this.imageManager.updateImage(V,B[E][O],!1):this.imageManager.addImage(V,B[E][O]),f&&(this._changedImages[V]=!0)}}}).catch(B=>{this._spriteRequest=null,y=B,this.fire(new o.k(y))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),m&&m(y)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(l){const f=this.sourceCaches[l.source];if(!f)return;const m=l.sourceLayer;if(!m)return;const y=f.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(m)===-1)&&this.fire(new o.k(new Error(`Source layer "${m}" does not exist on source "${y.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l,f=!1){const m=this._serializedAllLayers();if(!l||l.length===0)return Object.values(f?o.bL(m):m);const y=[];for(const B of l)if(m[B]){const E=f?o.bL(m[B]):m[B];y.push(E)}return y}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const f=Object.keys(this._layers);for(const m of f){const y=this._layers[m];y.type!=="custom"&&(l[m]=y.serialize())}return l}hasTransitions(){var l,f,m;if(!((l=this.light)===null||l===void 0)&&l.hasTransition()||!((f=this.sky)===null||f===void 0)&&f.hasTransition()||!((m=this.projection)===null||m===void 0)&&m.hasTransition())return!0;for(const y in this.sourceCaches)if(this.sourceCaches[y].hasTransition())return!0;for(const y in this._layers)if(this._layers[y].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const f=this._changed;if(f){const y=Object.keys(this._updatedLayers),B=Object.keys(this._removedLayers);(y.length||B.length)&&this._updateWorkerLayers(y,B);for(const E in this._updatedSources){const R=this._updatedSources[E];if(R==="reload")this._reloadSource(E);else{if(R!=="clear")throw new Error(`Invalid action ${R}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(l);this.light.updateTransitions(l),this.sky.updateTransitions(l),this._resetUpdates()}const m={};for(const y in this.sourceCaches){const B=this.sourceCaches[y];m[y]=B.used,B.used=!1}for(const y of this._order){const B=this._layers[y];B.recalculate(l,this._availableImages),!B.isHidden(l.zoom)&&B.source&&(this.sourceCaches[B.source].used=!0)}for(const y in m){const B=this.sourceCaches[y];!!m[y]!=!!B.used&&B.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(l),this.sky.recalculate(l),this.projection.recalculate(l),this.z=l.zoom,f&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l,!1),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l,f={}){var m;this._checkLoaded();const y=this.serialize();if(l=f.transformStyle?f.transformStyle(y,l):l,((m=f.validate)===null||m===void 0||m)&&ih(this,o.z(l)))return!1;(l=o.bL(l)).layers=o.bI(l.layers);const B=o.bM(y,l),E=this._getOperationsToPerform(B);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const R of E.operations)R();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const f=[],m=[];for(const y of l)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,y.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,y.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,y.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,y.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,y.args));break;case"addSource":f.push(()=>this.addSource.apply(this,y.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,y.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,y.args));break;case"setLight":f.push(()=>this.setLight.apply(this,y.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,y.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,y.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,y.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,y.args));break;case"setSky":f.push(()=>this.setSky.apply(this,y.args));break;case"setProjection":this.setProjection.apply(this,y.args);break;case"setGlobalState":f.push(()=>this.setGlobalState.apply(this,y.args));break;case"setTransition":f.push(()=>{});break;default:m.push(y.command)}return{operations:f,unimplemented:m}}addImage(l,f){if(this.getImage(l))return this.fire(new o.k(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,f),this._afterImageUpdated(l)}updateImage(l,f){this.imageManager.updateImage(l,f)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new o.k(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,f,m={}){if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(o.z.source,`sources.${l}`,f,null,m))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const y=this.sourceCaches[l]=new fn(l,f,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:l})),y.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===l)return this.fire(new o.k(new Error(`Source "${l}" cannot be removed while layer "${m}" is using it.`)));const f=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],f.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,f){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const m=this.sourceCaches[l].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(f),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,f,m={}){this._checkLoaded();const y=l.id;if(this.getLayer(y))return void this.fire(new o.k(new Error(`Layer "${y}" already exists on this map.`)));let B;if(l.type==="custom"){if(ih(this,o.bN(l)))return;B=o.bJ(l,this._globalState)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(y,l.source),l=o.bL(l),l=o.e(l,{source:y})),this._validate(o.z.layer,`layers.${y}`,l,{arrayIndex:-1},m))return;B=o.bJ(l,this._globalState),this._validateLayer(B),B.setEventedParent(this,{layer:{id:y}})}const E=f?this._order.indexOf(f):this._order.length;if(f&&E===-1)this.fire(new o.k(new Error(`Cannot add layer "${y}" before non-existing layer "${f}".`)));else{if(this._order.splice(E,0,y),this._layerOrderChanged=!0,this._layers[y]=B,this._removedLayers[y]&&B.source&&B.type!=="custom"){const R=this._removedLayers[y];delete this._removedLayers[y],R.type!==B.type?this._updatedSources[B.source]="clear":(this._updatedSources[B.source]="reload",this.sourceCaches[B.source].pause())}this._updateLayer(B),B.onAdd&&B.onAdd(this.map)}}moveLayer(l,f){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new o.k(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===f)return;const m=this._order.indexOf(l);this._order.splice(m,1);const y=f?this._order.indexOf(f):this._order.length;f&&y===-1?this.fire(new o.k(new Error(`Cannot move layer "${l}" before non-existing layer "${f}".`))):(this._order.splice(y,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const f=this._layers[l];if(!f)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${l}".`)));f.setEventedParent(null);const m=this._order.indexOf(l);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=f,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],f.onRemove&&f.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,f,m){this._checkLoaded();const y=this.getLayer(l);y?y.minzoom===f&&y.maxzoom===m||(f!=null&&(y.minzoom=f),m!=null&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,f,m={}){this._checkLoaded();const y=this.getLayer(l);if(y){if(!o.bH(y.filter,f))return f==null?(y.setFilter(void 0),void this._updateLayer(y)):void(this._validate(o.z.filter,`layers.${y.id}.filter`,f,null,m)||(y.setFilter(o.bL(f)),this._updateLayer(y)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return o.bL(this.getLayer(l).filter)}setLayoutProperty(l,f,m,y={}){this._checkLoaded();const B=this.getLayer(l);B?o.bH(B.getLayoutProperty(f),m)||(B.setLayoutProperty(f,m,y),this._updateLayer(B)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,f){const m=this.getLayer(l);if(m)return m.getLayoutProperty(f);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,f,m,y={}){this._checkLoaded();const B=this.getLayer(l);B?o.bH(B.getPaintProperty(f),m)||this._updatePaintProperty(B,f,m,y):this.fire(new o.k(new Error(`Cannot style non-existing layer "${l}".`)))}_updatePaintProperty(l,f,m,y={}){l.setPaintProperty(f,m,y)&&this._updateLayer(l),o.bK(l)&&f==="raster-fade-duration"&&this.sourceCaches[l.source].setRasterFadeDuration(m),this._changed=!0,this._updatedPaintProps[l.id]=!0,this._serializedLayers=null}getPaintProperty(l,f){return this.getLayer(l).getPaintProperty(f)}setFeatureState(l,f){this._checkLoaded();const m=l.source,y=l.sourceLayer,B=this.sourceCaches[m];if(B===void 0)return void this.fire(new o.k(new Error(`The source '${m}' does not exist in the map's style.`)));const E=B.getSource().type;E==="geojson"&&y?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||y?(l.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),B.setFeatureState(y,l.id,f)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,f){this._checkLoaded();const m=l.source,y=this.sourceCaches[m];if(y===void 0)return void this.fire(new o.k(new Error(`The source '${m}' does not exist in the map's style.`)));const B=y.getSource().type,E=B==="vector"?l.sourceLayer:void 0;B!=="vector"||E?f&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(E,l.id,f):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const f=l.source,m=l.sourceLayer,y=this.sourceCaches[f];if(y!==void 0)return y.getSource().type!=="vector"||m?(l.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),y.getFeatureState(m,l.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=o.bO(this.sourceCaches,B=>B.serialize()),f=this._serializeByIds(this._order,!0),m=this.map.getTerrain()||void 0,y=this.stylesheet;return o.bP({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,projection:y.projection,sources:l,layers:f,terrain:m},B=>B!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const f=E=>this._layers[E].type==="fill-extrusion",m={},y=[];for(let E=this._order.length-1;E>=0;E--){const R=this._order[E];if(f(R)){m[R]=E;for(const O of l){const V=O[R];if(V)for(const G of V)y.push(G)}}}y.sort((E,R)=>R.intersectionZ-E.intersectionZ);const B=[];for(let E=this._order.length-1;E>=0;E--){const R=this._order[E];if(f(R))for(let O=y.length-1;O>=0;O--){const V=y[O].feature;if(m[V.layer.id]<E)break;B.push(V),y.pop()}else for(const O of l){const V=O[R];if(V)for(const G of V)B.push(G.feature)}}return B}queryRenderedFeatures(l,f,m){f&&f.filter&&this._validate(o.z.filter,"queryRenderedFeatures.filter",f.filter,null,f);const y={};if(f&&f.layers){if(!(Array.isArray(f.layers)||f.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const V of f.layers){const G=this._layers[V];if(!G)return this.fire(new o.k(new Error(`The layer '${V}' does not exist in the map's style and cannot be queried for features.`))),[];y[G.source]=!0}}const B=[];f.availableImages=this._availableImages;const E=this._serializedAllLayers(),R=f.layers instanceof Set?f.layers:Array.isArray(f.layers)?new Set(f.layers):null,O=Object.assign(Object.assign({},f),{layers:R,globalState:this._globalState});for(const V in this.sourceCaches)f.layers&&!y[V]||B.push(Yt(this.sourceCaches[V],this._layers,E,l,O,m,this.map.terrain?(G,J,X)=>this.map.terrain.getElevation(G,J,X):void 0));return this.placement&&B.push(function(V,G,J,X,ne,de,Ee){const Se={},Ie=de.queryRenderedSymbols(X),Oe=[];for(const je of Object.keys(Ie).map(Number))Oe.push(Ee[je]);Oe.sort(nr);for(const je of Oe){const De=je.featureIndex.lookupSymbolFeatures(Ie[je.bucketInstanceId],G,je.bucketIndex,je.sourceLayerIndex,{filterSpec:ne.filter,globalState:ne.globalState},ne.layers,ne.availableImages,V);for(const $e in De){const Je=Se[$e]=Se[$e]||[],Qe=De[$e];Qe.sort((at,Mt)=>{const yt=je.featureSortOrder;if(yt){const bt=yt.indexOf(at.featureIndex);return yt.indexOf(Mt.featureIndex)-bt}return Mt.featureIndex-at.featureIndex});for(const at of Qe)Je.push(at)}}return function(je,De,$e){for(const Je in je)for(const Qe of je[Je])ur(Qe,$e[De[Je].source]);return je}(Se,V,J)}(this._layers,E,this.sourceCaches,l,O,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(B)}querySourceFeatures(l,f){f?.filter&&this._validate(o.z.filter,"querySourceFeatures.filter",f.filter,null,f);const m=this.sourceCaches[l];return m?function(y,B){const E=y.getRenderableIds().map(V=>y.getTileByID(V)),R=[],O={};for(let V=0;V<E.length;V++){const G=E[V],J=G.tileID.canonical.key;O[J]||(O[J]=!0,G.querySourceFeatures(R,B))}return R}(m,f?Object.assign(Object.assign({},f),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(l,f={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const E in l)if(!o.bH(l[E],m[E])){y=!0;break}if(!y)return;const B={now:M(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,f),this.light.updateTransitions(B)}getProjection(){var l;return(l=this.stylesheet)===null||l===void 0?void 0:l.projection}setProjection(l){if(this._checkLoaded(),this.projection){if(this.projection.name===l.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=l,this._setProjectionInternal(l.type)}getSky(){var l;return(l=this.stylesheet)===null||l===void 0?void 0:l.sky}setSky(l,f={}){this._checkLoaded();const m=this.getSky();let y=!1;if(!l&&!m)return;if(l&&!m)y=!0;else if(!l&&m)y=!0;else for(const E in l)if(!o.bH(l[E],m[E])){y=!0;break}if(!y)return;const B={now:M(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=l,this.sky.setSky(l,f),this.sky.updateTransitions(B)}_setProjectionInternal(l){const f=function(m,y){const B={constrain:y};if(Array.isArray(m)){const E=new Yo({type:m});return{projection:E,transform:new ls(B),cameraHelper:new Ul(E)}}switch(m){case"mercator":return{projection:new Fl,transform:new As(B),cameraHelper:new Kn};case"globe":{const E=new Yo({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:E,transform:new ls(B),cameraHelper:new Ul(E)}}case"vertical-perspective":return{projection:new gc,transform:new ki(B),cameraHelper:new fs};default:return o.w(`Unknown projection name: ${m}. Falling back to mercator projection.`),{projection:new Fl,transform:new As(B),cameraHelper:new Kn}}}(l,this.map.transformConstrain);this.projection=f.projection,this.map.migrateProjection(f.transform,f.cameraHelper);for(const m in this.sourceCaches)this.sourceCaches[m].reload()}_validate(l,f,m,y,B={}){return(!B||B.validate!==!1)&&ih(this,l.call(o.z,o.e({key:f,style:this.serialize(),value:m,styleSpec:o.v},y)))}_remove(l=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),wr().off(hr,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const m=this.sourceCaches[f];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const f in this.sourceCaches)this.sourceCaches[f].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,f,m,y,B=!1){let E=!1,R=!1;const O={};for(const V of this._order){const G=this._layers[V];if(G.type!=="symbol")continue;if(!O[G.source]){const X=this.sourceCaches[G.source];O[G.source]=X.getRenderableIds(!0).map(ne=>X.getTileByID(ne)).sort((ne,de)=>de.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(de.tileID)?-1:1))}const J=this.crossTileSymbolIndex.addLayer(G,O[G.source],l.center.lng);E=E||J}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((B=B||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(M(),l.zoom))&&(this.pauseablePlacement=new _a(l,this.map.terrain,this._order,B,f,m,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(M()),R=!0),E&&this.pauseablePlacement.placement.setStale()),R||E)for(const V of this._order){const G=this._layers[V];G.type==="symbol"&&this.placement.updateLayerOpacities(G,O[G.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(M())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,f){return o._(this,void 0,void 0,function*(){const m=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[f.source];return y&&y.setDependencies(f.tileID.key,f.type,f.icons),m})}getGlyphs(l,f){return o._(this,void 0,void 0,function*(){const m=yield this.glyphManager.getGlyphs(f.stacks),y=this.sourceCaches[f.source];return y&&y.setDependencies(f.tileID.key,f.type,[""]),m})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l,f={}){this._checkLoaded(),l&&this._validate(o.z.glyphs,"glyphs",l,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}getDashes(l,f){return o._(this,void 0,void 0,function*(){const m={};for(const[y,B]of Object.entries(f.dashes))m[y]=this.lineAtlas.getDash(B.dasharray,B.round);return m})}addSprite(l,f,m={},y){this._checkLoaded();const B=[{id:l,url:f}],E=[...se(this.stylesheet.sprite),...B];this._validate(o.z.sprite,"sprite",E,null,m)||(this.stylesheet.sprite=E,this._loadSprite(B,!0,y))}removeSprite(l){this._checkLoaded();const f=se(this.stylesheet.sprite);if(f.find(m=>m.id===l)){if(this._spritesImagesIds[l])for(const m of this._spritesImagesIds[l])this.imageManager.removeImage(m),this._changedImages[m]=!0;f.splice(f.findIndex(m=>m.id===l),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return se(this.stylesheet.sprite)}setSprite(l,f={},m){this._checkLoaded(),l&&this._validate(o.z.sprite,"sprite",l,null,f)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,m):(this._unloadSprite(),m&&m(null)))}}var Zo=o.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class mc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,f,m,y,B,E,R,O,V){this.context=l;let G=this.boundPaintVertexBuffers.length!==y.length;for(let J=0;!G&&J<y.length;J++)this.boundPaintVertexBuffers[J]!==y[J]&&(G=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==m||G||this.boundIndexBuffer!==B||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==O||this.boundDynamicVertexBuffer3!==V?this.freshBind(f,m,y,B,E,R,O,V):(l.bindVertexArray.set(this.vao),R&&R.bind(),B&&B.dynamicDraw&&B.bind(),O&&O.bind(),V&&V.bind())}freshBind(l,f,m,y,B,E,R,O){const V=l.numAttributes,G=this.context,J=G.gl;this.vao&&this.destroy(),this.vao=G.createVertexArray(),G.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=B,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=O,f.enableAttributes(J,l);for(const X of m)X.enableAttributes(J,l);E&&E.enableAttributes(J,l),R&&R.enableAttributes(J,l),O&&O.enableAttributes(J,l),f.bind(),f.setVertexAttribPointers(J,l,B);for(const X of m)X.bind(),X.setVertexAttribPointers(J,l,B);E&&(E.bind(),E.setVertexAttribPointers(J,l,B)),y&&y.bind(),R&&(R.bind(),R.setVertexAttribPointers(J,l,B)),O&&(O.bind(),O.setVertexAttribPointers(J,l,B)),G.currentNumAttributes=V}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const _c=(v,l,f,m,y)=>({u_texture:0,u_ele_delta:v,u_fog_matrix:l,u_fog_color:f?f.properties.get("fog-color"):o.bf.white,u_fog_ground_blend:f?f.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:y?0:f?f.calculateFogBlendOpacity(m):0,u_horizon_color:f?f.properties.get("horizon-color"):o.bf.white,u_horizon_fog_blend:f?f.properties.get("horizon-fog-blend"):1,u_is_globe_mode:y?1:0}),ul={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Xn(v){const l=[];for(let f=0;f<v.length;f++){if(v[f]===null)continue;const m=v[f].split(" ");l.push(m.pop())}return l}class Dl{constructor(l,f,m,y,B,E,R,O,V=[]){const G=l.gl;this.program=G.createProgram();const J=Xn(f.staticAttributes),X=m?m.getBinderAttributes():[],ne=J.concat(X),de=ya.prelude.staticUniforms?Xn(ya.prelude.staticUniforms):[],Ee=R.staticUniforms?Xn(R.staticUniforms):[],Se=f.staticUniforms?Xn(f.staticUniforms):[],Ie=m?m.getBinderUniforms():[],Oe=de.concat(Ee).concat(Se).concat(Ie),je=[];for(const yt of Oe)je.indexOf(yt)<0&&je.push(yt);const De=m?m.defines():[];No(G)&&De.unshift("#version 300 es"),B&&De.push("#define OVERDRAW_INSPECTOR;"),E&&De.push("#define TERRAIN3D;"),O&&De.push(O),V&&De.push(...V);let $e=De.concat(ya.prelude.fragmentSource,R.fragmentSource,f.fragmentSource).join(`
`),Je=De.concat(ya.prelude.vertexSource,R.vertexSource,f.vertexSource).join(`
`);No(G)||($e=function(yt){return yt.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}($e),Je=function(yt){return yt.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(Je));const Qe=G.createShader(G.FRAGMENT_SHADER);if(G.isContextLost())return void(this.failedToCreate=!0);if(G.shaderSource(Qe,$e),G.compileShader(Qe),!G.getShaderParameter(Qe,G.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${G.getShaderInfoLog(Qe)}`);G.attachShader(this.program,Qe);const at=G.createShader(G.VERTEX_SHADER);if(G.isContextLost())return void(this.failedToCreate=!0);if(G.shaderSource(at,Je),G.compileShader(at),!G.getShaderParameter(at,G.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${G.getShaderInfoLog(at)}`);G.attachShader(this.program,at),this.attributes={};const Mt={};this.numAttributes=ne.length;for(let yt=0;yt<this.numAttributes;yt++)ne[yt]&&(G.bindAttribLocation(this.program,yt,ne[yt]),this.attributes[ne[yt]]=yt);if(G.linkProgram(this.program),!G.getProgramParameter(this.program,G.LINK_STATUS))throw new Error(`Program failed to link: ${G.getProgramInfoLog(this.program)}`);G.deleteShader(at),G.deleteShader(Qe);for(let yt=0;yt<je.length;yt++){const bt=je[yt];if(bt&&!Mt[bt]){const Ct=G.getUniformLocation(this.program,bt);Ct&&(Mt[bt]=Ct)}}this.fixedUniforms=y(l,Mt),this.terrainUniforms=((yt,bt)=>({u_depth:new o.bQ(yt,bt.u_depth),u_terrain:new o.bQ(yt,bt.u_terrain),u_terrain_dim:new o.bg(yt,bt.u_terrain_dim),u_terrain_matrix:new o.bS(yt,bt.u_terrain_matrix),u_terrain_unpack:new o.bT(yt,bt.u_terrain_unpack),u_terrain_exaggeration:new o.bg(yt,bt.u_terrain_exaggeration)}))(l,Mt),this.projectionUniforms=((yt,bt)=>({u_projection_matrix:new o.bS(yt,bt.u_projection_matrix),u_projection_tile_mercator_coords:new o.bT(yt,bt.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bT(yt,bt.u_projection_clipping_plane),u_projection_transition:new o.bg(yt,bt.u_projection_transition),u_projection_fallback_matrix:new o.bS(yt,bt.u_projection_fallback_matrix)}))(l,Mt),this.binderUniforms=m?m.getUniforms(l,Mt):[]}draw(l,f,m,y,B,E,R,O,V,G,J,X,ne,de,Ee,Se,Ie,Oe,je){const De=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(m),l.setStencilMode(y),l.setColorMode(B),l.setCullFace(E),O){l.activeTexture.set(De.TEXTURE2),De.bindTexture(De.TEXTURE_2D,O.depthTexture),l.activeTexture.set(De.TEXTURE3),De.bindTexture(De.TEXTURE_2D,O.texture);for(const Je in this.terrainUniforms)this.terrainUniforms[Je].set(O[Je])}if(V)for(const Je in V)this.projectionUniforms[ul[Je]].set(V[Je]);if(R)for(const Je in this.fixedUniforms)this.fixedUniforms[Je].set(R[Je]);Se&&Se.setUniforms(l,this.binderUniforms,de,{zoom:Ee});let $e=0;switch(f){case De.LINES:$e=2;break;case De.TRIANGLES:$e=3;break;case De.LINE_STRIP:$e=1}for(const Je of ne.get()){const Qe=Je.vaos||(Je.vaos={});(Qe[G]||(Qe[G]=new mc)).bind(l,this,J,Se?Se.getPaintVertexBuffers():[],X,Je.vertexOffset,Ie,Oe,je),De.drawElements(f,Je.primitiveLength*$e,De.UNSIGNED_SHORT,Je.primitiveOffset*$e*2)}}}function va(v,l,f){const m=1/o.aC(f,1,l.transform.tileZoom),y=Math.pow(2,f.tileID.overscaledZ),B=f.tileSize*Math.pow(2,l.transform.tileZoom)/y,E=B*(f.tileID.canonical.x+f.tileID.wrap*y),R=B*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[m,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[E>>16,R>>16],u_pixel_coord_lower:[65535&E,65535&R]}}const ja=(v,l,f,m)=>{const y=v.style.light,B=y.properties.get("position"),E=[B.x,B.y,B.z],R=o.bW();y.properties.get("anchor")==="viewport"&&o.bX(R,v.transform.bearingInRadians),o.bY(E,E,R);const O=v.transform.transformLightDirection(E),V=y.properties.get("color");return{u_lightpos:E,u_lightpos_globe:O,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[V.r,V.g,V.b],u_vertical_gradient:+l,u_opacity:f,u_fill_translate:m}},kl=(v,l,f,m,y,B,E)=>o.e(ja(v,l,f,m),va(B,v,E),{u_height_factor:-Math.pow(2,y.overscaledZ)/E.tileSize/8}),so=(v,l,f,m)=>o.e(va(l,v,f),{u_fill_translate:m}),fu=(v,l)=>({u_world:v,u_fill_translate:l}),sh=(v,l,f,m,y)=>o.e(so(v,l,f,y),{u_world:m}),Nl=(v,l,f,m,y)=>{const B=v.transform;let E,R,O=0;if(f.paint.get("circle-pitch-alignment")==="map"){const V=o.aC(l,1,B.zoom);E=!0,R=[V,V],O=V/(o.$*Math.pow(2,l.tileID.overscaledZ))*2*Math.PI*y}else E=!1,R=B.pixelsToGLUnits;return{u_camera_to_center_distance:B.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+E,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:R,u_globe_extrude_scale:O,u_translate:m}},Is=v=>({u_pixel_extrude_scale:[1/v.width,1/v.height]}),Jo=v=>({u_viewport_size:[v.width,v.height]}),oh=(v,l=1)=>({u_color:v,u_overlay:0,u_overlay_scale:l}),du=(v,l,f,m)=>{const y=o.aC(v,1,l)/(o.$*Math.pow(2,v.tileID.overscaledZ))*2*Math.PI*m;return{u_extrude_scale:o.aC(v,1,l),u_intensity:f,u_globe_extrude_scale:y}},$a=(v,l,f,m)=>{const y=o.L();o.bZ(y,0,v.width,v.height,0,0,1);const B=v.context.gl;return{u_matrix:y,u_world:[B.drawingBufferWidth,B.drawingBufferHeight],u_image:f,u_color_ramp:m,u_opacity:l.paint.get("heatmap-opacity")}},pu=(v,l,f)=>{const m=f.paint.get("hillshade-accent-color");let y;switch(f.paint.get("hillshade-method")){case"basic":y=4;break;case"combined":y=1;break;case"igor":y=2;break;case"multidirectional":y=3;break;default:y=0}const B=f.getIlluminationProperties();for(let E=0;E<B.directionRadians.length;E++)f.paint.get("hillshade-illumination-anchor")==="viewport"&&(B.directionRadians[E]+=v.transform.bearingInRadians);return{u_image:0,u_latrange:xo(0,l.tileID),u_exaggeration:f.paint.get("hillshade-exaggeration"),u_altitudes:B.altitudeRadians,u_azimuths:B.directionRadians,u_accent:m,u_method:y,u_highlights:B.highlightColor,u_shadows:B.shadowColor}},wo=(v,l)=>{const f=l.stride,m=o.L();return o.bZ(m,0,o.$,-o.$,0,0,1),o.M(m,m,[0,-o.$,0]),{u_matrix:m,u_image:1,u_dimension:[f,f],u_zoom:v.overscaledZ,u_unpack:l.getUnpackVector()}};function xo(v,l){const f=Math.pow(2,l.canonical.z),m=l.canonical.y;return[new o.a1(0,m/f).toLngLat().lat,new o.a1(0,(m+1)/f).toLngLat().lat]}const yc=(v,l,f=0)=>({u_image:0,u_unpack:l.getUnpackVector(),u_dimension:[l.stride,l.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:f,u_opacity:v.paint.get("color-relief-opacity")}),ds=(v,l,f,m)=>{const y=v.transform;return{u_translation:Ga(v,l,f),u_ratio:m/o.aC(l,1,y.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},zl=(v,l,f,m,y)=>o.e(ds(v,l,f,m),{u_image:0,u_image_height:y}),ah=(v,l,f,m,y)=>{const B=v.transform,E=bc(l,B);return{u_translation:Ga(v,l,f),u_texsize:l.imageAtlasTexture.size,u_ratio:m/o.aC(l,1,B.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[E,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/B.pixelsToGLUnits[0],1/B.pixelsToGLUnits[1]]}},wa=(v,l,f,m,y)=>{const B=bc(l,v.transform);return o.e(ds(v,l,f,m),{u_tileratio:B,u_crossfade_from:y.fromScale,u_crossfade_to:y.toScale,u_image:0,u_mix:y.t,u_lineatlas_width:v.lineAtlas.width,u_lineatlas_height:v.lineAtlas.height})},Ji=(v,l,f,m,y,B)=>{const E=bc(l,v.transform);return o.e(ds(v,l,f,m),{u_image:0,u_image_height:B,u_tileratio:E,u_crossfade_from:y.fromScale,u_crossfade_to:y.toScale,u_image_dash:1,u_mix:y.t,u_lineatlas_width:v.lineAtlas.width,u_lineatlas_height:v.lineAtlas.height})};function bc(v,l){return 1/o.aC(v,1,l.tileZoom)}function Ga(v,l,f){return o.aD(v.transform,l,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const hl=(v,l,f,m,y)=>{return{u_tl_parent:v,u_scale_parent:l,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(E=m.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(B=m.paint.get("raster-contrast"),B>0?1/(1-B):1+B),u_spin_weights:gu(m.paint.get("raster-hue-rotate")),u_coords_top:[y[0].x,y[0].y,y[1].x,y[1].y],u_coords_bottom:[y[3].x,y[3].y,y[2].x,y[2].y]};var B,E};function gu(v){v*=Math.PI/180;const l=Math.sin(v),f=Math.cos(v);return[(2*f+1)/3,(-Math.sqrt(3)*l-f+1)/3,(Math.sqrt(3)*l-f+1)/3]}const mu=(v,l,f,m,y,B,E,R,O,V,G,J,X)=>{const ne=E.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:ne.cameraToCenterDistance,u_pitch:ne.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:ne.width/ne.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_label_plane_matrix:R,u_coord_matrix:O,u_is_text:+G,u_pitch_with_map:+m,u_is_along_line:y,u_is_variable_anchor:B,u_texsize:J,u_texture:0,u_translation:V,u_pitched_scale:X}},vc=(v,l,f,m,y,B,E,R,O,V,G,J,X,ne)=>{const de=E.transform;return o.e(mu(v,l,f,m,y,B,E,R,O,V,G,J,ne),{u_gamma_scale:m?Math.cos(de.pitch*Math.PI/180)*de.cameraToCenterDistance:1,u_device_pixel_ratio:E.pixelRatio,u_is_halo:1})},wc=(v,l,f,m,y,B,E,R,O,V,G,J,X)=>o.e(vc(v,l,f,m,y,B,E,R,O,V,!0,G,0,X),{u_texsize_icon:J,u_texture_icon:1}),xc=(v,l)=>({u_opacity:v,u_color:l}),Al=(v,l,f,m,y)=>o.e(function(B,E,R,O){const V=R.imageManager.getPattern(B.from.toString()),G=R.imageManager.getPattern(B.to.toString()),{width:J,height:X}=R.imageManager.getPixelSize(),ne=Math.pow(2,O.tileID.overscaledZ),de=O.tileSize*Math.pow(2,R.transform.tileZoom)/ne,Ee=de*(O.tileID.canonical.x+O.tileID.wrap*ne),Se=de*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:V.tl,u_pattern_br_a:V.br,u_pattern_tl_b:G.tl,u_pattern_br_b:G.br,u_texsize:[J,X],u_mix:E.t,u_pattern_size_a:V.displaySize,u_pattern_size_b:G.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/o.aC(O,1,R.transform.tileZoom),u_pixel_coord_upper:[Ee>>16,Se>>16],u_pixel_coord_lower:[65535&Ee,65535&Se]}}(f,y,l,m),{u_opacity:v}),Ps=(v,l)=>{},_u={fillExtrusion:(v,l)=>({u_lightpos:new o.bU(v,l.u_lightpos),u_lightpos_globe:new o.bU(v,l.u_lightpos_globe),u_lightintensity:new o.bg(v,l.u_lightintensity),u_lightcolor:new o.bU(v,l.u_lightcolor),u_vertical_gradient:new o.bg(v,l.u_vertical_gradient),u_opacity:new o.bg(v,l.u_opacity),u_fill_translate:new o.bV(v,l.u_fill_translate)}),fillExtrusionPattern:(v,l)=>({u_lightpos:new o.bU(v,l.u_lightpos),u_lightpos_globe:new o.bU(v,l.u_lightpos_globe),u_lightintensity:new o.bg(v,l.u_lightintensity),u_lightcolor:new o.bU(v,l.u_lightcolor),u_vertical_gradient:new o.bg(v,l.u_vertical_gradient),u_height_factor:new o.bg(v,l.u_height_factor),u_opacity:new o.bg(v,l.u_opacity),u_fill_translate:new o.bV(v,l.u_fill_translate),u_image:new o.bQ(v,l.u_image),u_texsize:new o.bV(v,l.u_texsize),u_pixel_coord_upper:new o.bV(v,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bV(v,l.u_pixel_coord_lower),u_scale:new o.bU(v,l.u_scale),u_fade:new o.bg(v,l.u_fade)}),fill:(v,l)=>({u_fill_translate:new o.bV(v,l.u_fill_translate)}),fillPattern:(v,l)=>({u_image:new o.bQ(v,l.u_image),u_texsize:new o.bV(v,l.u_texsize),u_pixel_coord_upper:new o.bV(v,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bV(v,l.u_pixel_coord_lower),u_scale:new o.bU(v,l.u_scale),u_fade:new o.bg(v,l.u_fade),u_fill_translate:new o.bV(v,l.u_fill_translate)}),fillOutline:(v,l)=>({u_world:new o.bV(v,l.u_world),u_fill_translate:new o.bV(v,l.u_fill_translate)}),fillOutlinePattern:(v,l)=>({u_world:new o.bV(v,l.u_world),u_image:new o.bQ(v,l.u_image),u_texsize:new o.bV(v,l.u_texsize),u_pixel_coord_upper:new o.bV(v,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bV(v,l.u_pixel_coord_lower),u_scale:new o.bU(v,l.u_scale),u_fade:new o.bg(v,l.u_fade),u_fill_translate:new o.bV(v,l.u_fill_translate)}),circle:(v,l)=>({u_camera_to_center_distance:new o.bg(v,l.u_camera_to_center_distance),u_scale_with_map:new o.bQ(v,l.u_scale_with_map),u_pitch_with_map:new o.bQ(v,l.u_pitch_with_map),u_extrude_scale:new o.bV(v,l.u_extrude_scale),u_device_pixel_ratio:new o.bg(v,l.u_device_pixel_ratio),u_globe_extrude_scale:new o.bg(v,l.u_globe_extrude_scale),u_translate:new o.bV(v,l.u_translate)}),collisionBox:(v,l)=>({u_pixel_extrude_scale:new o.bV(v,l.u_pixel_extrude_scale)}),collisionCircle:(v,l)=>({u_viewport_size:new o.bV(v,l.u_viewport_size)}),debug:(v,l)=>({u_color:new o.bR(v,l.u_color),u_overlay:new o.bQ(v,l.u_overlay),u_overlay_scale:new o.bg(v,l.u_overlay_scale)}),depth:Ps,clippingMask:Ps,heatmap:(v,l)=>({u_extrude_scale:new o.bg(v,l.u_extrude_scale),u_intensity:new o.bg(v,l.u_intensity),u_globe_extrude_scale:new o.bg(v,l.u_globe_extrude_scale)}),heatmapTexture:(v,l)=>({u_matrix:new o.bS(v,l.u_matrix),u_world:new o.bV(v,l.u_world),u_image:new o.bQ(v,l.u_image),u_color_ramp:new o.bQ(v,l.u_color_ramp),u_opacity:new o.bg(v,l.u_opacity)}),hillshade:(v,l)=>({u_image:new o.bQ(v,l.u_image),u_latrange:new o.bV(v,l.u_latrange),u_exaggeration:new o.bg(v,l.u_exaggeration),u_altitudes:new o.b$(v,l.u_altitudes),u_azimuths:new o.b$(v,l.u_azimuths),u_accent:new o.bR(v,l.u_accent),u_method:new o.bQ(v,l.u_method),u_shadows:new o.b_(v,l.u_shadows),u_highlights:new o.b_(v,l.u_highlights)}),hillshadePrepare:(v,l)=>({u_matrix:new o.bS(v,l.u_matrix),u_image:new o.bQ(v,l.u_image),u_dimension:new o.bV(v,l.u_dimension),u_zoom:new o.bg(v,l.u_zoom),u_unpack:new o.bT(v,l.u_unpack)}),colorRelief:(v,l)=>({u_image:new o.bQ(v,l.u_image),u_unpack:new o.bT(v,l.u_unpack),u_dimension:new o.bV(v,l.u_dimension),u_elevation_stops:new o.bQ(v,l.u_elevation_stops),u_color_stops:new o.bQ(v,l.u_color_stops),u_color_ramp_size:new o.bQ(v,l.u_color_ramp_size),u_opacity:new o.bg(v,l.u_opacity)}),line:(v,l)=>({u_translation:new o.bV(v,l.u_translation),u_ratio:new o.bg(v,l.u_ratio),u_device_pixel_ratio:new o.bg(v,l.u_device_pixel_ratio),u_units_to_pixels:new o.bV(v,l.u_units_to_pixels)}),lineGradient:(v,l)=>({u_translation:new o.bV(v,l.u_translation),u_ratio:new o.bg(v,l.u_ratio),u_device_pixel_ratio:new o.bg(v,l.u_device_pixel_ratio),u_units_to_pixels:new o.bV(v,l.u_units_to_pixels),u_image:new o.bQ(v,l.u_image),u_image_height:new o.bg(v,l.u_image_height)}),linePattern:(v,l)=>({u_translation:new o.bV(v,l.u_translation),u_texsize:new o.bV(v,l.u_texsize),u_ratio:new o.bg(v,l.u_ratio),u_device_pixel_ratio:new o.bg(v,l.u_device_pixel_ratio),u_image:new o.bQ(v,l.u_image),u_units_to_pixels:new o.bV(v,l.u_units_to_pixels),u_scale:new o.bU(v,l.u_scale),u_fade:new o.bg(v,l.u_fade)}),lineSDF:(v,l)=>({u_translation:new o.bV(v,l.u_translation),u_ratio:new o.bg(v,l.u_ratio),u_device_pixel_ratio:new o.bg(v,l.u_device_pixel_ratio),u_units_to_pixels:new o.bV(v,l.u_units_to_pixels),u_image:new o.bQ(v,l.u_image),u_mix:new o.bg(v,l.u_mix),u_tileratio:new o.bg(v,l.u_tileratio),u_crossfade_from:new o.bg(v,l.u_crossfade_from),u_crossfade_to:new o.bg(v,l.u_crossfade_to),u_lineatlas_width:new o.bg(v,l.u_lineatlas_width),u_lineatlas_height:new o.bg(v,l.u_lineatlas_height)}),lineGradientSDF:(v,l)=>({u_translation:new o.bV(v,l.u_translation),u_ratio:new o.bg(v,l.u_ratio),u_device_pixel_ratio:new o.bg(v,l.u_device_pixel_ratio),u_units_to_pixels:new o.bV(v,l.u_units_to_pixels),u_image:new o.bQ(v,l.u_image),u_image_height:new o.bg(v,l.u_image_height),u_tileratio:new o.bg(v,l.u_tileratio),u_crossfade_from:new o.bg(v,l.u_crossfade_from),u_crossfade_to:new o.bg(v,l.u_crossfade_to),u_image_dash:new o.bQ(v,l.u_image_dash),u_mix:new o.bg(v,l.u_mix),u_lineatlas_width:new o.bg(v,l.u_lineatlas_width),u_lineatlas_height:new o.bg(v,l.u_lineatlas_height)}),raster:(v,l)=>({u_tl_parent:new o.bV(v,l.u_tl_parent),u_scale_parent:new o.bg(v,l.u_scale_parent),u_buffer_scale:new o.bg(v,l.u_buffer_scale),u_fade_t:new o.bg(v,l.u_fade_t),u_opacity:new o.bg(v,l.u_opacity),u_image0:new o.bQ(v,l.u_image0),u_image1:new o.bQ(v,l.u_image1),u_brightness_low:new o.bg(v,l.u_brightness_low),u_brightness_high:new o.bg(v,l.u_brightness_high),u_saturation_factor:new o.bg(v,l.u_saturation_factor),u_contrast_factor:new o.bg(v,l.u_contrast_factor),u_spin_weights:new o.bU(v,l.u_spin_weights),u_coords_top:new o.bT(v,l.u_coords_top),u_coords_bottom:new o.bT(v,l.u_coords_bottom)}),symbolIcon:(v,l)=>({u_is_size_zoom_constant:new o.bQ(v,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bQ(v,l.u_is_size_feature_constant),u_size_t:new o.bg(v,l.u_size_t),u_size:new o.bg(v,l.u_size),u_camera_to_center_distance:new o.bg(v,l.u_camera_to_center_distance),u_pitch:new o.bg(v,l.u_pitch),u_rotate_symbol:new o.bQ(v,l.u_rotate_symbol),u_aspect_ratio:new o.bg(v,l.u_aspect_ratio),u_fade_change:new o.bg(v,l.u_fade_change),u_label_plane_matrix:new o.bS(v,l.u_label_plane_matrix),u_coord_matrix:new o.bS(v,l.u_coord_matrix),u_is_text:new o.bQ(v,l.u_is_text),u_pitch_with_map:new o.bQ(v,l.u_pitch_with_map),u_is_along_line:new o.bQ(v,l.u_is_along_line),u_is_variable_anchor:new o.bQ(v,l.u_is_variable_anchor),u_texsize:new o.bV(v,l.u_texsize),u_texture:new o.bQ(v,l.u_texture),u_translation:new o.bV(v,l.u_translation),u_pitched_scale:new o.bg(v,l.u_pitched_scale)}),symbolSDF:(v,l)=>({u_is_size_zoom_constant:new o.bQ(v,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bQ(v,l.u_is_size_feature_constant),u_size_t:new o.bg(v,l.u_size_t),u_size:new o.bg(v,l.u_size),u_camera_to_center_distance:new o.bg(v,l.u_camera_to_center_distance),u_pitch:new o.bg(v,l.u_pitch),u_rotate_symbol:new o.bQ(v,l.u_rotate_symbol),u_aspect_ratio:new o.bg(v,l.u_aspect_ratio),u_fade_change:new o.bg(v,l.u_fade_change),u_label_plane_matrix:new o.bS(v,l.u_label_plane_matrix),u_coord_matrix:new o.bS(v,l.u_coord_matrix),u_is_text:new o.bQ(v,l.u_is_text),u_pitch_with_map:new o.bQ(v,l.u_pitch_with_map),u_is_along_line:new o.bQ(v,l.u_is_along_line),u_is_variable_anchor:new o.bQ(v,l.u_is_variable_anchor),u_texsize:new o.bV(v,l.u_texsize),u_texture:new o.bQ(v,l.u_texture),u_gamma_scale:new o.bg(v,l.u_gamma_scale),u_device_pixel_ratio:new o.bg(v,l.u_device_pixel_ratio),u_is_halo:new o.bQ(v,l.u_is_halo),u_translation:new o.bV(v,l.u_translation),u_pitched_scale:new o.bg(v,l.u_pitched_scale)}),symbolTextAndIcon:(v,l)=>({u_is_size_zoom_constant:new o.bQ(v,l.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bQ(v,l.u_is_size_feature_constant),u_size_t:new o.bg(v,l.u_size_t),u_size:new o.bg(v,l.u_size),u_camera_to_center_distance:new o.bg(v,l.u_camera_to_center_distance),u_pitch:new o.bg(v,l.u_pitch),u_rotate_symbol:new o.bQ(v,l.u_rotate_symbol),u_aspect_ratio:new o.bg(v,l.u_aspect_ratio),u_fade_change:new o.bg(v,l.u_fade_change),u_label_plane_matrix:new o.bS(v,l.u_label_plane_matrix),u_coord_matrix:new o.bS(v,l.u_coord_matrix),u_is_text:new o.bQ(v,l.u_is_text),u_pitch_with_map:new o.bQ(v,l.u_pitch_with_map),u_is_along_line:new o.bQ(v,l.u_is_along_line),u_is_variable_anchor:new o.bQ(v,l.u_is_variable_anchor),u_texsize:new o.bV(v,l.u_texsize),u_texsize_icon:new o.bV(v,l.u_texsize_icon),u_texture:new o.bQ(v,l.u_texture),u_texture_icon:new o.bQ(v,l.u_texture_icon),u_gamma_scale:new o.bg(v,l.u_gamma_scale),u_device_pixel_ratio:new o.bg(v,l.u_device_pixel_ratio),u_is_halo:new o.bQ(v,l.u_is_halo),u_translation:new o.bV(v,l.u_translation),u_pitched_scale:new o.bg(v,l.u_pitched_scale)}),background:(v,l)=>({u_opacity:new o.bg(v,l.u_opacity),u_color:new o.bR(v,l.u_color)}),backgroundPattern:(v,l)=>({u_opacity:new o.bg(v,l.u_opacity),u_image:new o.bQ(v,l.u_image),u_pattern_tl_a:new o.bV(v,l.u_pattern_tl_a),u_pattern_br_a:new o.bV(v,l.u_pattern_br_a),u_pattern_tl_b:new o.bV(v,l.u_pattern_tl_b),u_pattern_br_b:new o.bV(v,l.u_pattern_br_b),u_texsize:new o.bV(v,l.u_texsize),u_mix:new o.bg(v,l.u_mix),u_pattern_size_a:new o.bV(v,l.u_pattern_size_a),u_pattern_size_b:new o.bV(v,l.u_pattern_size_b),u_scale_a:new o.bg(v,l.u_scale_a),u_scale_b:new o.bg(v,l.u_scale_b),u_pixel_coord_upper:new o.bV(v,l.u_pixel_coord_upper),u_pixel_coord_lower:new o.bV(v,l.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bg(v,l.u_tile_units_to_pixels)}),terrain:(v,l)=>({u_texture:new o.bQ(v,l.u_texture),u_ele_delta:new o.bg(v,l.u_ele_delta),u_fog_matrix:new o.bS(v,l.u_fog_matrix),u_fog_color:new o.bR(v,l.u_fog_color),u_fog_ground_blend:new o.bg(v,l.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bg(v,l.u_fog_ground_blend_opacity),u_horizon_color:new o.bR(v,l.u_horizon_color),u_horizon_fog_blend:new o.bg(v,l.u_horizon_fog_blend),u_is_globe_mode:new o.bg(v,l.u_is_globe_mode)}),terrainDepth:(v,l)=>({u_ele_delta:new o.bg(v,l.u_ele_delta)}),terrainCoords:(v,l)=>({u_texture:new o.bQ(v,l.u_texture),u_terrain_coords_id:new o.bg(v,l.u_terrain_coords_id),u_ele_delta:new o.bg(v,l.u_ele_delta)}),projectionErrorMeasurement:(v,l)=>({u_input:new o.bg(v,l.u_input),u_output_expected:new o.bg(v,l.u_output_expected)}),atmosphere:(v,l)=>({u_sun_pos:new o.bU(v,l.u_sun_pos),u_atmosphere_blend:new o.bg(v,l.u_atmosphere_blend),u_globe_position:new o.bU(v,l.u_globe_position),u_globe_radius:new o.bg(v,l.u_globe_radius),u_inv_proj_matrix:new o.bS(v,l.u_inv_proj_matrix)}),sky:(v,l)=>({u_sky_color:new o.bR(v,l.u_sky_color),u_horizon_color:new o.bR(v,l.u_horizon_color),u_horizon:new o.bV(v,l.u_horizon),u_horizon_normal:new o.bV(v,l.u_horizon_normal),u_sky_horizon_blend:new o.bg(v,l.u_sky_horizon_blend),u_sky_blend:new o.bg(v,l.u_sky_blend)})};class Bo{constructor(l,f,m){this.context=l;const y=l.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const xa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ai{constructor(l,f,m,y){this.length=f.length,this.attributes=m,this.itemSize=f.bytesPerElement,this.dynamicDraw=y,this.context=l;const B=l.gl;this.buffer=B.createBuffer(),l.bindVertexBuffer.set(this.buffer),B.bufferData(B.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?B.DYNAMIC_DRAW:B.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,f){for(let m=0;m<this.attributes.length;m++){const y=f.attributes[this.attributes[m].name];y!==void 0&&l.enableVertexAttribArray(y)}}setVertexAttribPointers(l,f,m){for(let y=0;y<this.attributes.length;y++){const B=this.attributes[y],E=f.attributes[B.name];E!==void 0&&l.vertexAttribPointer(E,B.components,l[xa[B.type]],!1,this.itemSize,B.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Gr{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fi extends Gr{getDefault(){return o.bf.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Ni extends Gr{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Ql extends Gr{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class lh extends Gr{getDefault(){return[!0,!0,!0,!0]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class fl extends Gr{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class iA extends Gr{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Rd extends Gr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const f=this.current;(l.func!==f.func||l.ref!==f.ref||l.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Eg extends Gr{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Ld extends Gr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=l,this.dirty=!1}}class sA extends Gr{getDefault(){return[0,1]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class oA extends Gr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=l,this.dirty=!1}}class aA extends Gr{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class hf extends Gr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.BLEND):f.disable(f.BLEND),this.current=l,this.dirty=!1}}class Bc extends Gr{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class ch extends Gr{getDefault(){return o.bf.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class yu extends Gr{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class ea extends Gr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=l,this.dirty=!1}}class Od extends Gr{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class uh extends Gr{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class Af extends Gr{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class Cc extends Gr{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class lA extends Gr{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class cA extends Gr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class hh extends Gr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class uA extends Gr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Ud extends Gr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class bu extends Gr{getDefault(){return null}set(l){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Tc extends Gr{getDefault(){return null}set(l){var f;if(l===this.current&&!this.dirty)return;const m=this.gl;No(m)?m.bindVertexArray(l):(f=m.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class hA extends Gr{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Co extends Gr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class on extends Gr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Hl extends Gr{constructor(l,f){super(l),this.context=l,this.parent=f}getDefault(){return null}}class ff extends Hl{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Dd extends Hl{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Ec extends Hl{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}const AA="Framebuffer is not complete";class kd{constructor(l,f,m,y,B){this.context=l,this.width=f,this.height=m;const E=l.gl,R=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new ff(l,R),y)this.depthAttachment=B?new Ec(l,R):new Dd(l,R);else if(B)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error(AA)}destroy(){const l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){const m=this.depthAttachment.get();m&&l.deleteRenderbuffer(m)}l.deleteFramebuffer(this.framebuffer)}}class Nd{constructor(l){var f,m;if(this.gl=l,this.clearColor=new fi(this),this.clearDepth=new Ni(this),this.clearStencil=new Ql(this),this.colorMask=new lh(this),this.depthMask=new fl(this),this.stencilMask=new iA(this),this.stencilFunc=new Rd(this),this.stencilOp=new Eg(this),this.stencilTest=new Ld(this),this.depthRange=new sA(this),this.depthTest=new oA(this),this.depthFunc=new aA(this),this.blend=new hf(this),this.blendFunc=new Bc(this),this.blendColor=new ch(this),this.blendEquation=new yu(this),this.cullFace=new ea(this),this.cullFaceSide=new Od(this),this.frontFace=new uh(this),this.program=new Af(this),this.activeTexture=new Cc(this),this.viewport=new lA(this),this.bindFramebuffer=new cA(this),this.bindRenderbuffer=new hh(this),this.bindTexture=new uA(this),this.bindVertexBuffer=new Ud(this),this.bindElementBuffer=new bu(this),this.bindVertexArray=new Tc(this),this.pixelStoreUnpack=new hA(this),this.pixelStoreUnpackPremultiplyAlpha=new Co(this),this.pixelStoreUnpackFlipY=new on(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),No(l)){this.HALF_FLOAT=l.HALF_FLOAT;const y=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=l.RGBA16F)!==null&&f!==void 0?f:y?.RGBA16F_EXT,this.RGB16F=(m=l.RGB16F)!==null&&m!==void 0?m:y?.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const y=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=y?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,f){return new Bo(this,l,f)}createVertexBuffer(l,f,m){return new Ai(this,l,f,m)}createRenderbuffer(l,f,m){const y=this.gl,B=y.createRenderbuffer();return this.bindRenderbuffer.set(B),y.renderbufferStorage(y.RENDERBUFFER,l,f,m),this.bindRenderbuffer.set(null),B}createFramebuffer(l,f,m,y){return new kd(this,l,f,m,y)}clear({color:l,depth:f,stencil:m}){const y=this.gl;let B=0;l&&(B|=y.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(B|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),m!==void 0&&(B|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(B)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){o.bH(l.blendFunction,kn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return No(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var f;return No(this.gl)?this.gl.deleteVertexArray(l):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}let Ah;function fh(v,l,f,m,y){const B=v.context,E=v.transform,R=B.gl,O=v.useProgram("collisionBox"),V=[];let G=0,J=0;for(let Ie=0;Ie<m.length;Ie++){const Oe=m[Ie],je=l.getTile(Oe).getBucket(f);if(!je)continue;const De=y?je.textCollisionBox:je.iconCollisionBox,$e=je.collisionCircleArray;$e.length>0&&(V.push({circleArray:$e,circleOffset:J,coord:Oe}),G+=$e.length/4,J=G),De&&O.draw(B,R.LINES,Yr.disabled,An.disabled,v.colorModeForRenderPass(),Tn.disabled,Is(v.transform),v.style.map.terrain&&v.style.map.terrain.getTerrainData(Oe),E.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),f.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,null,v.transform.zoom,null,null,De.collisionVertexBuffer)}if(!y||!V.length)return;const X=v.useProgram("collisionCircle"),ne=new o.c0;ne.resize(4*G),ne._trim();let de=0;for(const Ie of V)for(let Oe=0;Oe<Ie.circleArray.length/4;Oe++){const je=4*Oe,De=Ie.circleArray[je+0],$e=Ie.circleArray[je+1],Je=Ie.circleArray[je+2],Qe=Ie.circleArray[je+3];ne.emplace(de++,De,$e,Je,Qe,0),ne.emplace(de++,De,$e,Je,Qe,1),ne.emplace(de++,De,$e,Je,Qe,2),ne.emplace(de++,De,$e,Je,Qe,3)}(!Ah||Ah.length<2*G)&&(Ah=function(Ie){const Oe=2*Ie,je=new o.c2;je.resize(Oe),je._trim();for(let De=0;De<Oe;De++){const $e=6*De;je.uint16[$e+0]=4*De+0,je.uint16[$e+1]=4*De+1,je.uint16[$e+2]=4*De+2,je.uint16[$e+3]=4*De+2,je.uint16[$e+4]=4*De+3,je.uint16[$e+5]=4*De+0}return je}(G));const Ee=B.createIndexBuffer(Ah,!0),Se=B.createVertexBuffer(ne,o.c1.members,!0);for(const Ie of V){const Oe=Jo(v.transform);X.draw(B,R.TRIANGLES,Yr.disabled,An.disabled,v.colorModeForRenderPass(),Tn.disabled,Oe,v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ie.coord),null,f.id,Se,Ee,o.aM.simpleSegment(0,2*Ie.circleOffset,Ie.circleArray.length,Ie.circleArray.length/2),null,v.transform.zoom,null,null,null)}Se.destroy(),Ee.destroy()}const vu=o.ai(new Float32Array(16));function dh(v,l,f,m,y,B){const{horizontalAlign:E,verticalAlign:R}=o.aH(v);return new o.P((-(E-.5)*l/y+m[0])*B,(-(R-.5)*f/y+m[1])*B)}function df(v,l,f,m,y,B){const E=l.tileAnchorPoint.add(new o.P(l.translation[0],l.translation[1]));if(l.pitchWithMap){let R=m.mult(B);f||(R=R.rotate(-y));const O=E.add(R);return wi(O.x,O.y,l.pitchedLabelPlaneMatrix,l.getElevation).point}if(f){const R=Vt(l.tileAnchorPoint.x+1,l.tileAnchorPoint.y,l).point.sub(v),O=Math.atan(R.y/R.x)+(R.x<0?Math.PI:0);return v.add(m.rotate(O))}return v.add(m)}function zd(v,l,f,m,y,B,E,R,O,V,G,J){const X=v.text.placedSymbolArray,ne=v.text.dynamicLayoutVertexArray,de=v.icon.dynamicLayoutVertexArray,Ee={};ne.clear();for(let Se=0;Se<X.length;Se++){const Ie=X.get(Se),Oe=Ie.hidden||!Ie.crossTileID||v.allowVerticalPlacement&&!Ie.placedOrientation?null:m[Ie.crossTileID];if(Oe){const je=new o.P(Ie.anchorX,Ie.anchorY),De={getElevation:J,width:y.width,height:y.height,pitchedLabelPlaneMatrix:B,pitchWithMap:f,transform:y,tileAnchorPoint:je,translation:V,unwrappedTileID:G},$e=f?xn(je.x,je.y,De):Vt(je.x,je.y,De),Je=Qs(y.cameraToCenterDistance,$e.signedDistanceFromCamera);let Qe=o.ap(v.textSizeData,R,Ie)*Je/o.aB;f&&(Qe*=v.tilePixelRatio/E);const{width:at,height:Mt,anchor:yt,textOffset:bt,textBoxScale:Ct}=Oe,Zt=dh(yt,at,Mt,bt,Ct,Qe),rr=y.getPitchedTextCorrection(je.x+V[0],je.y+V[1],G),$t=df($e.point,De,l,Zt,-y.bearingInRadians,rr),Tr=v.allowVerticalPlacement&&Ie.placedOrientation===o.ao.vertical?Math.PI/2:0;for(let tn=0;tn<Ie.numGlyphs;tn++)o.av(ne,$t,Tr);O&&Ie.associatedIconIndex>=0&&(Ee[Ie.associatedIconIndex]={shiftedAnchor:$t,angle:Tr})}else Di(Ie.numGlyphs,ne)}if(O){de.clear();const Se=v.icon.placedSymbolArray;for(let Ie=0;Ie<Se.length;Ie++){const Oe=Se.get(Ie);if(Oe.hidden)Di(Oe.numGlyphs,de);else{const je=Ee[Ie];if(je)for(let De=0;De<Oe.numGlyphs;De++)o.av(de,je.shiftedAnchor,je.angle);else Di(Oe.numGlyphs,de)}}v.icon.dynamicLayoutVertexBuffer.updateData(de)}v.text.dynamicLayoutVertexBuffer.updateData(ne)}function Qd(v,l,f){return f.iconsInText&&l?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function fA(v,l,f,m,y,B,E,R,O,V,G,J,X){const ne=v.context,de=ne.gl,Ee=v.transform,Se=R==="map",Ie=O==="map",Oe=R!=="viewport"&&f.layout.get("symbol-placement")!=="point",je=Se&&!Ie&&!Oe,De=!f.layout.get("symbol-sort-key").isConstant();let $e=!1;const Je=v.getDepthModeForSublayer(0,Yr.ReadOnly),Qe=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),at=[],Mt=Ee.getCircleRadiusCorrection();for(const yt of m){const bt=l.getTile(yt),Ct=bt.getBucket(f);if(!Ct)continue;const Zt=y?Ct.text:Ct.icon;if(!Zt||!Zt.segments.get().length||!Zt.hasVisibleVertices)continue;const rr=Zt.programConfigurations.get(f.id),$t=y||Ct.sdfIcons,Tr=y?Ct.textSizeData:Ct.iconSizeData,tn=Ie||Ee.pitch!==0,Dn=v.useProgram(Qd($t,y,Ct),rr),li=o.an(Tr,Ee.zoom),Ti=v.style.map.terrain&&v.style.map.terrain.getTerrainData(yt);let Bn,bi,Gs,Wi,ao=[0,0],us=null;if(y)bi=bt.glyphAtlasTexture,Gs=de.LINEAR,Bn=bt.glyphAtlasTexture.size,Ct.iconsInText&&(ao=bt.imageAtlasTexture.size,us=bt.imageAtlasTexture,Wi=tn||v.options.rotating||v.options.zooming||Tr.kind==="composite"||Tr.kind==="camera"?de.LINEAR:de.NEAREST);else{const Fs=f.layout.get("icon-size").constantOr(0)!==1||Ct.iconsNeedLinear;bi=bt.imageAtlasTexture,Gs=$t||v.options.rotating||v.options.zooming||Fs||tn?de.LINEAR:de.NEAREST,Bn=bt.imageAtlasTexture.size}const _s=o.aC(bt,1,v.transform.zoom),lo=ln(Se,v.transform,_s),wh=o.L();o.aq(wh,lo);const xh=Ot(Ie,Se,v.transform,_s),bA=o.aD(Ee,bt,B,E),Bh=Ee.getProjectionData({overscaledTileID:yt,applyGlobeMatrix:!X,applyTerrainMatrix:!0}),vA=Qe&&Ct.hasTextData(),qd=f.layout.get("icon-text-fit")!=="none"&&vA&&Ct.hasIconData();if(Oe){const Fs=v.style.map.terrain?(Ta,hs)=>v.style.map.terrain.getElevation(yt,Ta,hs):null,co=f.layout.get("text-rotation-alignment")==="map";er(Ct,v,y,lo,wh,Ie,V,co,yt.toUnwrapped(),Ee.width,Ee.height,bA,Fs)}const Ch=y&&Qe||qd,ra=Oe||Ch?vu:Ie?lo:v.transform.clipSpaceToPixelsMatrix,Vo=$t&&f.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Pc;Pc=$t?Ct.iconsInText?wc(Tr.kind,li,je,Ie,Oe,Ch,v,ra,xh,bA,Bn,ao,Mt):vc(Tr.kind,li,je,Ie,Oe,Ch,v,ra,xh,bA,y,Bn,0,Mt):mu(Tr.kind,li,je,Ie,Oe,Ch,v,ra,xh,bA,y,Bn,Mt);const xf={program:Dn,buffers:Zt,uniformValues:Pc,projectionData:Bh,atlasTexture:bi,atlasTextureIcon:us,atlasInterpolation:Gs,atlasInterpolationIcon:Wi,isSDF:$t,hasHalo:Vo};if(De&&Ct.canOverlap){$e=!0;const Fs=Zt.segments.get();for(const co of Fs)at.push({segments:new o.aM([co]),sortKey:co.sortKey,state:xf,terrainData:Ti})}else at.push({segments:Zt.segments,sortKey:0,state:xf,terrainData:Ti})}$e&&at.sort((yt,bt)=>yt.sortKey-bt.sortKey);for(const yt of at){const bt=yt.state;if(ne.activeTexture.set(de.TEXTURE0),bt.atlasTexture.bind(bt.atlasInterpolation,de.CLAMP_TO_EDGE),bt.atlasTextureIcon&&(ne.activeTexture.set(de.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,de.CLAMP_TO_EDGE)),bt.isSDF){const Ct=bt.uniformValues;bt.hasHalo&&(Ct.u_is_halo=1,dA(bt.buffers,yt.segments,f,v,bt.program,Je,G,J,Ct,bt.projectionData,yt.terrainData)),Ct.u_is_halo=0}dA(bt.buffers,yt.segments,f,v,bt.program,Je,G,J,bt.uniformValues,bt.projectionData,yt.terrainData)}}function dA(v,l,f,m,y,B,E,R,O,V,G){const J=m.context;y.draw(J,J.gl.TRIANGLES,B,E,R,Tn.backCCW,O,G,V,f.id,v.layoutVertexBuffer,v.indexBuffer,l,f.paint,m.transform.zoom,v.programConfigurations.get(f.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function pf(v,l,f,m,y){const B=v.context,E=B.gl,R=An.disabled,O=new kn([E.ONE,E.ONE],o.bf.transparent,[!0,!0,!0,!0]),V=l.getBucket(f);if(!V)return;const G=m.key;let J=f.heatmapFbos.get(G);J||(J=gf(B,l.tileSize,l.tileSize),f.heatmapFbos.set(G,J)),B.bindFramebuffer.set(J.framebuffer),B.viewport.set([0,0,l.tileSize,l.tileSize]),B.clear({color:o.bf.transparent});const X=V.programConfigurations.get(f.id),ne=v.useProgram("heatmap",X,!y),de=v.transform.getProjectionData({overscaledTileID:l.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ee=v.style.map.terrain.getTerrainData(m);ne.draw(B,E.TRIANGLES,Yr.disabled,R,O,Tn.disabled,du(l,v.transform.zoom,f.paint.get("heatmap-intensity"),1),Ee,de,f.id,V.layoutVertexBuffer,V.indexBuffer,V.segments,f.paint,v.transform.zoom,X)}function ph(v,l,f,m,y){const B=v.context,E=B.gl,R=v.transform;B.setColorMode(v.colorModeForRenderPass());const O=mf(B,l),V=f.key,G=l.heatmapFbos.get(V);if(!G)return;B.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,G.colorAttachment.get()),B.activeTexture.set(E.TEXTURE1),O.bind(E.LINEAR,E.CLAMP_TO_EDGE);const J=R.getProjectionData({overscaledTileID:f,applyTerrainMatrix:y,applyGlobeMatrix:!m});v.useProgram("heatmapTexture").draw(B,E.TRIANGLES,Yr.disabled,An.disabled,v.colorModeForRenderPass(),Tn.disabled,$a(v,l,0,1),null,J,l.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,l.paint,R.zoom),G.destroy(),l.heatmapFbos.delete(V)}function gf(v,l,f){var m,y;const B=v.gl,E=B.createTexture();B.bindTexture(B.TEXTURE_2D,E),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR);const R=(m=v.HALF_FLOAT)!==null&&m!==void 0?m:B.UNSIGNED_BYTE,O=(y=v.RGBA16F)!==null&&y!==void 0?y:B.RGBA;B.texImage2D(B.TEXTURE_2D,0,O,l,f,0,B.RGBA,R,null);const V=v.createFramebuffer(l,f,!1,!1);return V.colorAttachment.set(E),V}function mf(v,l){return l.colorRampTexture||(l.colorRampTexture=new o.T(v,l.colorRamp,v.gl.RGBA)),l.colorRampTexture}function Sc(v,l,f,m,y,B,E,R){let O=256;if(y.stepInterpolant){const V=l.getSource().maxzoom,G=E.canonical.z===V?Math.ceil(1<<v.transform.maxZoom-E.canonical.z):1;O=o.ae(o.c4(B.maxLineLength/o.$*1024*G),256,f.maxTextureSize)}return R.gradient=o.c5({expression:y.gradientExpression(),evaluationKey:"lineProgress",resolution:O,image:R.gradient||void 0,clips:B.lineClipsArray}),R.texture?R.texture.update(R.gradient):R.texture=new o.T(f,R.gradient,m.RGBA),R.version=y.gradientVersion,R.texture}function pA(v,l,f,m,y){v.activeTexture.set(l.TEXTURE0),f.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),m.updatePaintBuffers(y)}function Sg(v,l,f,m,y,B){(y||v.lineAtlas.dirty)&&(l.activeTexture.set(f.TEXTURE0),v.lineAtlas.bind(l)),m.updatePaintBuffers(B)}function _f(v,l,f,m,y,B,E){const R=B.gradients[y.id];let O=R.texture;y.gradientVersion!==R.version&&(O=Sc(v,l,f,m,y,B,E,R)),f.activeTexture.set(m.TEXTURE0),O.bind(y.stepInterpolant?m.NEAREST:m.LINEAR,m.CLAMP_TO_EDGE)}function yf(v,l,f,m,y,B,E,R,O){const V=B.gradients[y.id];let G=V.texture;y.gradientVersion!==V.version&&(G=Sc(v,l,f,m,y,B,E,V)),f.activeTexture.set(m.TEXTURE0),G.bind(y.stepInterpolant?m.NEAREST:m.LINEAR,m.CLAMP_TO_EDGE),f.activeTexture.set(m.TEXTURE1),v.lineAtlas.bind(f),R.updatePaintBuffers(O)}function Hd(v,l,f,m,y){if(!f||!m||!m.imageAtlas)return;const B=m.imageAtlas.patternPositions;let E=B[f.to.toString()],R=B[f.from.toString()];if(!E&&R&&(E=R),!R&&E&&(R=E),!E||!R){const O=y.getPaintProperty(l);E=B[O],R=B[O]}E&&R&&v.setConstantPatternPositions(E,R)}function Vd(v,l,f,m,y,B,E,R){const O=v.context.gl,V="fill-pattern",G=f.paint.get(V),J=G&&G.constantOr(1),X=f.getCrossfadeParameters();let ne,de,Ee,Se,Ie;const Oe=v.transform,je=f.paint.get("fill-translate"),De=f.paint.get("fill-translate-anchor");E?(de=J&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ne=O.LINES):(de=J?"fillPattern":"fill",ne=O.TRIANGLES);const $e=G.constantOr(null);for(const Je of m){const Qe=l.getTile(Je);if(J&&!Qe.patternsLoaded())continue;const at=Qe.getBucket(f);if(!at)continue;const Mt=at.programConfigurations.get(f.id),yt=v.useProgram(de,Mt),bt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Je);J&&(v.context.activeTexture.set(O.TEXTURE0),Qe.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Mt.updatePaintBuffers(X)),Hd(Mt,V,$e,Qe,f);const Ct=Oe.getProjectionData({overscaledTileID:Je,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Zt=o.aD(Oe,Qe,je,De);if(E){Se=at.indexBuffer2,Ie=at.segments2;const $t=[O.drawingBufferWidth,O.drawingBufferHeight];Ee=de==="fillOutlinePattern"&&J?sh(v,X,Qe,$t,Zt):fu($t,Zt)}else Se=at.indexBuffer,Ie=at.segments,Ee=J?so(v,X,Qe,Zt):{u_fill_translate:Zt};const rr=v.stencilModeForClipping(Je);yt.draw(v.context,ne,y,rr,B,Tn.backCCW,Ee,bt,Ct,f.id,at.layoutVertexBuffer,Se,Ie,f.paint,v.transform.zoom,Mt)}}function gh(v,l,f,m,y,B,E,R){const O=v.context,V=O.gl,G="fill-extrusion-pattern",J=f.paint.get(G),X=J.constantOr(1),ne=f.getCrossfadeParameters(),de=f.paint.get("fill-extrusion-opacity"),Ee=J.constantOr(null),Se=v.transform;for(const Ie of m){const Oe=l.getTile(Ie),je=Oe.getBucket(f);if(!je)continue;const De=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ie),$e=je.programConfigurations.get(f.id),Je=v.useProgram(X?"fillExtrusionPattern":"fillExtrusion",$e);X&&(v.context.activeTexture.set(V.TEXTURE0),Oe.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),$e.updatePaintBuffers(ne));const Qe=Se.getProjectionData({overscaledTileID:Ie,applyGlobeMatrix:!R,applyTerrainMatrix:!0});Hd($e,G,Ee,Oe,f);const at=o.aD(Se,Oe,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Mt=f.paint.get("fill-extrusion-vertical-gradient"),yt=X?kl(v,Mt,de,at,Ie,ne,Oe):ja(v,Mt,de,at);Je.draw(O,O.gl.TRIANGLES,y,B,E,Tn.backCCW,yt,De,Qe,f.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,f.paint,v.transform.zoom,$e,v.style.map.terrain&&je.centroidVertexBuffer)}}function gA(v,l,f,m,y,B,E,R,O){var V;const G=v.style.projection,J=v.context,X=v.transform,ne=J.gl,de=[`#define NUM_ILLUMINATION_SOURCES ${f.paint.get("hillshade-highlight-color").values.length}`],Ee=v.useProgram("hillshade",null,!1,de),Se=!v.options.moving;for(const Ie of m){const Oe=l.getTile(Ie),je=Oe.fbo;if(!je)continue;const De=G.getMeshFromTileID(J,Ie.canonical,R,!0,"raster"),$e=(V=v.style.map.terrain)===null||V===void 0?void 0:V.getTerrainData(Ie);J.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_2D,je.colorAttachment.get());const Je=X.getProjectionData({overscaledTileID:Ie,aligned:Se,applyGlobeMatrix:!O,applyTerrainMatrix:!0});Ee.draw(J,ne.TRIANGLES,B,y[Ie.overscaledZ],E,Tn.backCCW,pu(v,Oe,f),$e,Je,f.id,De.vertexBuffer,De.indexBuffer,De.segments)}}function dl(v,l,f,m,y,B,E,R,O){var V;const G=v.style.projection,J=v.context,X=v.transform,ne=J.gl,de=v.useProgram("colorRelief"),Ee=!v.options.moving;let Se=!0,Ie=0;for(const Oe of m){const je=l.getTile(Oe),De=je.dem;if(Se){const yt=ne.getParameter(ne.MAX_TEXTURE_SIZE),{elevationTexture:bt,colorTexture:Ct}=f.getColorRampTextures(J,yt,De.getUnpackVector());J.activeTexture.set(ne.TEXTURE1),bt.bind(ne.NEAREST,ne.CLAMP_TO_EDGE),J.activeTexture.set(ne.TEXTURE4),Ct.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Se=!1,Ie=bt.size[0]}if(!De||!De.data)continue;const $e=De.stride,Je=De.getPixels();if(J.activeTexture.set(ne.TEXTURE0),J.pixelStoreUnpackPremultiplyAlpha.set(!1),je.demTexture=je.demTexture||v.getTileTexture($e),je.demTexture){const yt=je.demTexture;yt.update(Je,{premultiply:!1}),yt.bind(ne.LINEAR,ne.CLAMP_TO_EDGE)}else je.demTexture=new o.T(J,Je,ne.RGBA,{premultiply:!1}),je.demTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const Qe=G.getMeshFromTileID(J,Oe.canonical,R,!0,"raster"),at=(V=v.style.map.terrain)===null||V===void 0?void 0:V.getTerrainData(Oe),Mt=X.getProjectionData({overscaledTileID:Oe,aligned:Ee,applyGlobeMatrix:!O,applyTerrainMatrix:!0});de.draw(J,ne.TRIANGLES,B,y[Oe.overscaledZ],E,Tn.backCCW,yc(f,je.dem,Ie),at,Mt,f.id,Qe.vertexBuffer,Qe.indexBuffer,Qe.segments)}}const zo=[new o.P(0,0),new o.P(o.$,0),new o.P(o.$,o.$),new o.P(0,o.$)];function Vn(v,l,f,m,y,B,E,R,O=!1,V=!1){const G=m[m.length-1].overscaledZ,J=v.context,X=J.gl,ne=v.useProgram("raster"),de=v.transform,Ee=v.style.projection,Se=v.colorModeForRenderPass(),Ie=!v.options.moving,Oe=f.paint.get("raster-opacity"),je=f.paint.get("raster-resampling"),De=f.paint.get("raster-fade-duration"),$e=!!v.style.map.terrain;for(const Je of m){const Qe=v.getDepthModeForSublayer(Je.overscaledZ-G,Oe===1?Yr.ReadWrite:Yr.ReadOnly,X.LESS),at=l.getTile(Je),Mt=je==="nearest"?X.NEAREST:X.LINEAR;J.activeTexture.set(X.TEXTURE0),at.texture.bind(Mt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),J.activeTexture.set(X.TEXTURE1);const{parentTile:yt,parentScaleBy:bt,parentTopLeft:Ct,fadeValues:Zt}=wu(at,l,De,$e);at.fadeOpacity=Zt.tileOpacity,yt?(yt.fadeOpacity=Zt.parentTileOpacity,yt.texture.bind(Mt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST)):at.texture.bind(Mt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),at.texture.useMipmap&&J.extTextureFilterAnisotropic&&v.transform.pitch>20&&X.texParameterf(X.TEXTURE_2D,J.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,J.extTextureFilterAnisotropicMax);const rr=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Je),$t=de.getProjectionData({overscaledTileID:Je,aligned:Ie,applyGlobeMatrix:!V,applyTerrainMatrix:!0}),Tr=hl(Ct,bt,Zt.fadeMix,f,R),tn=Ee.getMeshFromTileID(J,Je.canonical,B,E,"raster");ne.draw(J,X.TRIANGLES,Qe,y?y[Je.overscaledZ]:An.disabled,Se,O?Tn.frontCCW:Tn.backCCW,Tr,rr,$t,f.id,tn.vertexBuffer,tn.indexBuffer,tn.segments)}}function wu(v,l,f,m){const y={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(f===0||m)return y;if(v.fadingParentID){const B=l._getLoadedTile(v.fadingParentID);if(!B)return y;const E=Math.pow(2,B.tileID.overscaledZ-v.tileID.overscaledZ),R=[v.tileID.canonical.x*E%1,v.tileID.canonical.y*E%1],O=function(V,G,J){const X=M(),ne=(X-G.timeAdded)/J,de=V.fadingDirection===re.Incoming,Ee=o.ae((X-V.timeAdded)/J,0,1),Se=o.ae(1-ne,0,1),Ie=de?Ee:Se;return{tileOpacity:Ie,parentTileOpacity:de?Se:Ee,fadeMix:{opacity:1,mix:1-Ie}}}(v,B,f);return{parentTile:B,parentScaleBy:E,parentTopLeft:R,fadeValues:O}}if(v.selfFading){const B=function(E,R){const O=(M()-E.timeAdded)/R,V=o.ae(O,0,1);return{tileOpacity:V,fadeMix:{opacity:V,mix:0}}}(v,f);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:B}}return y}const ta=new o.bf(1,0,0,1),pl=new o.bf(0,1,0,1),To=new o.bf(0,0,1,1),Ig=new o.bf(1,0,1,1),mh=new o.bf(0,1,1,1);function mA(v,l,f,m){Bu(v,0,l+f/2,v.transform.width,f,m)}function xu(v,l,f,m){Bu(v,l-f/2,0,f,v.transform.height,m)}function Bu(v,l,f,m,y,B){const E=v.context,R=E.gl;R.enable(R.SCISSOR_TEST),R.scissor(l*v.pixelRatio,f*v.pixelRatio,m*v.pixelRatio,y*v.pixelRatio),E.clear({color:B}),R.disable(R.SCISSOR_TEST)}function jd(v,l,f){const m=v.context,y=m.gl,B=v.useProgram("debug"),E=Yr.disabled,R=An.disabled,O=v.colorModeForRenderPass(),V="$debug",G=v.style.map.terrain&&v.style.map.terrain.getTerrainData(f);m.activeTexture.set(y.TEXTURE0);const J=l.getTileByID(f.key).latestRawTileData,X=Math.floor((J&&J.byteLength||0)/1024),ne=l.getTile(f).tileSize,de=512/Math.min(ne,512)*(f.overscaledZ/v.transform.zoom)*.5;let Ee=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Ee+=` => ${f.overscaledZ}`),function(Ie,Oe){Ie.initDebugOverlayCanvas();const je=Ie.debugOverlayCanvas,De=Ie.context.gl,$e=Ie.debugOverlayCanvas.getContext("2d");$e.clearRect(0,0,je.width,je.height),$e.shadowColor="white",$e.shadowBlur=2,$e.lineWidth=1.5,$e.strokeStyle="white",$e.textBaseline="top",$e.font="bold 36px Open Sans, sans-serif",$e.fillText(Oe,5,5),$e.strokeText(Oe,5,5),Ie.debugOverlayTexture.update(je),Ie.debugOverlayTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE)}(v,`${Ee} ${X}kB`);const Se=v.transform.getProjectionData({overscaledTileID:f,applyGlobeMatrix:!0,applyTerrainMatrix:!0});B.draw(m,y.TRIANGLES,E,R,kn.alphaBlended,Tn.disabled,oh(o.bf.transparent,de),null,Se,V,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),B.draw(m,y.LINE_STRIP,E,R,O,Tn.disabled,oh(o.bf.red),G,Se,V,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function $d(v,l,f,m){const{isRenderingGlobe:y}=m,B=v.context,E=B.gl,R=v.transform,O=v.colorModeForRenderPass(),V=v.getDepthModeFor3D(),G=v.useProgram("terrain");B.bindFramebuffer.set(null),B.viewport.set([0,0,v.width,v.height]);for(const J of f){const X=l.getTerrainMesh(J.tileID),ne=v.renderToTexture.getTexture(J),de=l.getTerrainData(J.tileID);B.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,ne.texture);const Ee=l.getMeshFrameDelta(R.zoom),Se=R.calculateFogMatrix(J.tileID.toUnwrapped()),Ie=_c(Ee,Se,v.style.sky,R.pitch,y),Oe=R.getProjectionData({overscaledTileID:J.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});G.draw(B,E.TRIANGLES,V,An.disabled,O,Tn.backCCW,Ie,de,Oe,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}}function _h(v,l){if(!l.mesh){const f=new o.aL;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(1,1),f.emplaceBack(-1,1);const m=new o.aN;m.emplaceBack(0,1,2),m.emplaceBack(0,2,3),l.mesh=new Hs(v.createVertexBuffer(f,en.members),v.createIndexBuffer(m),o.aM.simpleSegment(0,0,f.length,m.length))}return l.mesh}class _A{constructor(l,f){this.context=new Nd(l),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.ai(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=fn.maxUnderzooming+fn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ml}resize(l,f,m){if(this.width=Math.floor(l*m),this.height=Math.floor(f*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const l=this.context,f=new o.aL;f.emplaceBack(0,0),f.emplaceBack(o.$,0),f.emplaceBack(0,o.$),f.emplaceBack(o.$,o.$),this.tileExtentBuffer=l.createVertexBuffer(f,en.members),this.tileExtentSegments=o.aM.simpleSegment(0,0,4,2);const m=new o.aL;m.emplaceBack(0,0),m.emplaceBack(o.$,0),m.emplaceBack(0,o.$),m.emplaceBack(o.$,o.$),this.debugBuffer=l.createVertexBuffer(m,en.members),this.debugSegments=o.aM.simpleSegment(0,0,4,5);const y=new o.c7;y.emplaceBack(0,0,0,0),y.emplaceBack(o.$,0,o.$,0),y.emplaceBack(0,o.$,0,o.$),y.emplaceBack(o.$,o.$,o.$,o.$),this.rasterBoundsBuffer=l.createVertexBuffer(y,Zo.members),this.rasterBoundsSegments=o.aM.simpleSegment(0,0,4,2);const B=new o.aL;B.emplaceBack(0,0),B.emplaceBack(o.$,0),B.emplaceBack(0,o.$),B.emplaceBack(o.$,o.$),this.rasterBoundsBufferPosOnly=l.createVertexBuffer(B,en.members),this.rasterBoundsSegmentsPosOnly=o.aM.simpleSegment(0,0,4,5);const E=new o.aL;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,en.members),this.viewportSegments=o.aM.simpleSegment(0,0,4,2);const R=new o.c8;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(R);const O=new o.aN;O.emplaceBack(1,0,2),O.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(O);const V=this.context.gl;this.stencilClearMode=new An({func:V.ALWAYS,mask:0},0,255,V.ZERO,V.ZERO,V.ZERO),this.tileExtentMesh=new Hs(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=o.L();o.bZ(m,0,this.width,this.height,0,0,1),o.N(m,m,[f.drawingBufferWidth,f.drawingBufferHeight,0]);const y={mainMatrix:m,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:m};this.useProgram("clippingMask",null,!0).draw(l,f.TRIANGLES,Yr.disabled,this.stencilClearMode,kn.disabled,Tn.disabled,null,null,y,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,f,m){if(this.currentStencilSource===l.source||!l.isTileClipped()||!f||!f.length)return;this.currentStencilSource=l.source,this.nextStencilID+f.length>256&&this.clearStencil();const y=this.context;y.setColorMode(kn.disabled),y.setDepthMode(Yr.disabled);const B={};for(const E of f)B[E.key]=this.nextStencilID++;this._renderTileMasks(B,f,m,!0),this._renderTileMasks(B,f,m,!1),this._tileClippingMaskIDs=B}_renderTileMasks(l,f,m,y){const B=this.context,E=B.gl,R=this.style.projection,O=this.transform,V=this.useProgram("clippingMask");for(const G of f){const J=l[G.key],X=this.style.map.terrain&&this.style.map.terrain.getTerrainData(G),ne=R.getMeshFromTileID(this.context,G.canonical,y,!0,"stencil"),de=O.getProjectionData({overscaledTileID:G,applyGlobeMatrix:!m,applyTerrainMatrix:!0});V.draw(B,E.TRIANGLES,Yr.disabled,new An({func:E.ALWAYS,mask:0},J,255,E.KEEP,E.KEEP,E.REPLACE),kn.disabled,m?Tn.disabled:Tn.backCCW,null,X,de,"$clipping",ne.vertexBuffer,ne.indexBuffer,ne.segments)}}_renderTilesDepthBuffer(){const l=this.context,f=l.gl,m=this.style.projection,y=this.transform,B=this.useProgram("depth"),E=this.getDepthModeFor3D(),R=yr(y,{tileSize:y.tileSize});for(const O of R){const V=this.style.map.terrain&&this.style.map.terrain.getTerrainData(O),G=m.getMeshFromTileID(this.context,O.canonical,!0,!0,"raster"),J=y.getProjectionData({overscaledTileID:O,applyGlobeMatrix:!0,applyTerrainMatrix:!0});B.draw(l,f.TRIANGLES,E,An.disabled,kn.disabled,Tn.backCCW,null,V,J,"$clipping",G.vertexBuffer,G.indexBuffer,G.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,f=this.context.gl;return new An({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(l){const f=this.context.gl;return new An({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(l){const f=this.context.gl,m=l.sort((E,R)=>R.overscaledZ-E.overscaledZ),y=m[m.length-1].overscaledZ,B=m[0].overscaledZ-y+1;if(B>1){this.currentStencilSource=void 0,this.nextStencilID+B>256&&this.clearStencil();const E={};for(let R=0;R<B;R++)E[R+y]=new An({func:f.GEQUAL,mask:255},R+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=B,[E,m]}return[{[y]:An.disabled},m]}stencilConfigForOverlapTwoPass(l){const f=this.context.gl,m=l.sort((E,R)=>R.overscaledZ-E.overscaledZ),y=m[m.length-1].overscaledZ,B=m[0].overscaledZ-y+1;if(this.clearStencil(),B>1){const E={},R={};for(let O=0;O<B;O++)E[O+y]=new An({func:f.GREATER,mask:255},B+1+O,255,f.KEEP,f.KEEP,f.REPLACE),R[O+y]=new An({func:f.GREATER,mask:255},1+O,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID=2*B+1,[E,R,m]}return this.nextStencilID=3,[{[y]:new An({func:f.GREATER,mask:255},2,255,f.KEEP,f.KEEP,f.REPLACE)},{[y]:new An({func:f.GREATER,mask:255},1,255,f.KEEP,f.KEEP,f.REPLACE)},m]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new kn([l.CONSTANT_COLOR,l.ONE],new o.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?kn.unblended:kn.alphaBlended}getDepthModeForSublayer(l,f,m){if(!this.opaquePassEnabledForLayer())return Yr.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Yr(m||this.context.gl.LEQUAL,f,[y,y])}getDepthModeFor3D(){return new Yr(this.context.gl.LEQUAL,Yr.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,f){var m,y;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(M()),this.imageManager.beginFrame();const B=this.style._order,E=this.style.sourceCaches,R={},O={},V={},G={isRenderingToTexture:!1,isRenderingGlobe:((m=l.projection)===null||m===void 0?void 0:m.transitionState)>0};for(const X in E){const ne=E[X];ne.used&&ne.prepare(this.context),R[X]=ne.getVisibleCoordinates(!1),O[X]=R[X].slice().reverse(),V[X]=ne.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let X=0;X<B.length;X++)if(this.style._layers[B[X]].is3D()){this.opaquePassCutoff=X;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const X of B){const ne=this.style._layers[X];if(!ne.hasOffscreenPass()||ne.isHidden(this.transform.zoom))continue;const de=O[ne.source];(ne.type==="custom"||de.length)&&this.renderLayer(this,E[ne.source],ne,de,G)}if((y=this.style.projection)===null||y===void 0||y.updateGPUdependent({context:this.context,useProgram:X=>this.useProgram(X)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?o.bf.black:o.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(X,ne){const de=X.context,Ee=de.gl,Se=((Je,Qe,at)=>{const Mt=Math.cos(Qe.rollInRadians),yt=Math.sin(Qe.rollInRadians),bt=Ge(Qe),Ct=Qe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Je.properties.get("sky-color"),u_horizon_color:Je.properties.get("horizon-color"),u_horizon:[(Qe.width/2-bt*yt)*at,(Qe.height/2+bt*Mt)*at],u_horizon_normal:[-yt,Mt],u_sky_horizon_blend:Je.properties.get("sky-horizon-blend")*Qe.height/2*at,u_sky_blend:Ct}})(ne,X.style.map.transform,X.pixelRatio),Ie=new Yr(Ee.LEQUAL,Yr.ReadWrite,[0,1]),Oe=An.disabled,je=X.colorModeForRenderPass(),De=X.useProgram("sky"),$e=_h(de,ne);De.draw(de,Ee.TRIANGLES,Ie,Oe,je,Tn.disabled,Se,null,void 0,"sky",$e.vertexBuffer,$e.indexBuffer,$e.segments)}(this,this.style.sky),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=B.length-1;this.currentLayer>=0;this.currentLayer--){const X=this.style._layers[B[this.currentLayer]],ne=E[X.source],de=R[X.source];this._renderTileClippingMasks(X,de,!1),this.renderLayer(this,ne,X,de,G)}this.renderPass="translucent";let J=!1;for(this.currentLayer=0;this.currentLayer<B.length;this.currentLayer++){const X=this.style._layers[B[this.currentLayer]],ne=E[X.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(X,G))continue;this.opaquePassEnabledForLayer()||J||(J=!0,G.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const de=(X.type==="symbol"?V:O)[X.source];this._renderTileClippingMasks(X,R[X.source],!!this.renderToTexture),this.renderLayer(this,ne,X,de,G)}if(G.isRenderingGlobe&&function(X,ne,de){const Ee=X.context,Se=Ee.gl,Ie=X.useProgram("atmosphere"),Oe=new Yr(Se.LEQUAL,Yr.ReadOnly,[0,1]),je=X.transform,De=function(Ct,Zt){const rr=Ct.properties.get("position"),$t=[-rr.x,-rr.y,-rr.z],Tr=o.ai(new Float64Array(16));return Ct.properties.get("anchor")==="map"&&(o.b6(Tr,Tr,Zt.rollInRadians),o.b7(Tr,Tr,-Zt.pitchInRadians),o.b6(Tr,Tr,Zt.bearingInRadians),o.b7(Tr,Tr,Zt.center.lat*Math.PI/180),o.bz(Tr,Tr,-Zt.center.lng*Math.PI/180)),o.c6($t,$t,Tr),$t}(de,X.transform),$e=je.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Je=ne.properties.get("atmosphere-blend")*$e.projectionTransition;if(Je===0)return;const Qe=tt(je.worldSize,je.center.lat),at=je.inverseProjectionMatrix,Mt=new Float64Array(4);Mt[3]=1,o.aw(Mt,Mt,je.modelViewProjectionMatrix),Mt[0]/=Mt[3],Mt[1]/=Mt[3],Mt[2]/=Mt[3],Mt[3]=1,o.aw(Mt,Mt,at),Mt[0]/=Mt[3],Mt[1]/=Mt[3],Mt[2]/=Mt[3],Mt[3]=1;const yt=((Ct,Zt,rr,$t,Tr)=>({u_sun_pos:Ct,u_atmosphere_blend:Zt,u_globe_position:rr,u_globe_radius:$t,u_inv_proj_matrix:Tr}))(De,Je,[Mt[0],Mt[1],Mt[2]],Qe,at),bt=_h(Ee,ne);Ie.draw(Ee,Se.TRIANGLES,Oe,An.disabled,kn.alphaBlended,Tn.disabled,yt,null,null,"atmosphere",bt.vertexBuffer,bt.indexBuffer,bt.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const X=function(ne,de){let Ee=null;const Se=Object.values(ne._layers).flatMap(De=>De.source&&!De.isHidden(de)?[ne.sourceCaches[De.source]]:[]),Ie=Se.filter(De=>De.getSource().type==="vector"),Oe=Se.filter(De=>De.getSource().type!=="vector"),je=De=>{(!Ee||Ee.getSource().maxzoom<De.getSource().maxzoom)&&(Ee=De)};return Ie.forEach(De=>je(De)),Ee||Oe.forEach(De=>je(De)),Ee}(this.style,this.transform.zoom);X&&function(ne,de,Ee){for(let Se=0;Se<Ee.length;Se++)jd(ne,de,Ee[Se])}(this,X,X.getVisibleCoordinates())}this.options.showPadding&&function(X){const ne=X.transform.padding;mA(X,X.transform.height-(ne.top||0),3,ta),mA(X,ne.bottom||0,3,pl),xu(X,ne.left||0,3,To),xu(X,X.transform.width-(ne.right||0),3,Ig);const de=X.transform.centerPoint;(function(Ee,Se,Ie,Oe){Bu(Ee,Se-1,Ie-10,2,20,Oe),Bu(Ee,Se-10,Ie-1,20,2,Oe)})(X,de.x,X.transform.height-de.y,mh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,m=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=l?!o.c9(f,m):!o.ca(f,m)),y||(y=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),y&&(o.cb(f,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(B,E){const R=B.context,O=R.gl,V=B.transform,G=kn.unblended,J=new Yr(O.LEQUAL,Yr.ReadWrite,[0,1]),X=E.sourceCache.getRenderableTiles(),ne=B.useProgram("terrainDepth");R.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),R.clear({color:o.bf.transparent,depth:1});for(const de of X){const Ee=E.getTerrainMesh(de.tileID),Se=E.getTerrainData(de.tileID),Ie=V.getProjectionData({overscaledTileID:de.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Oe={u_ele_delta:E.getMeshFrameDelta(V.zoom)};ne.draw(R,O.TRIANGLES,J,An.disabled,G,Tn.backCCW,Oe,Se,Ie,"terrain",Ee.vertexBuffer,Ee.indexBuffer,Ee.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,B.width,B.height])}(this,this.style.map.terrain),function(B,E){const R=B.context,O=R.gl,V=B.transform,G=kn.unblended,J=new Yr(O.LEQUAL,Yr.ReadWrite,[0,1]),X=E.getCoordsTexture(),ne=E.sourceCache.getRenderableTiles(),de=B.useProgram("terrainCoords");R.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,B.width/devicePixelRatio,B.height/devicePixelRatio]),R.clear({color:o.bf.transparent,depth:1}),E.coordsIndex=[];for(const Ee of ne){const Se=E.getTerrainMesh(Ee.tileID),Ie=E.getTerrainData(Ee.tileID);R.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,X.texture);const Oe={u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(V.zoom)},je=V.getProjectionData({overscaledTileID:Ee.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});de.draw(R,O.TRIANGLES,J,An.disabled,G,Tn.backCCW,Oe,Ie,je,"terrain",Se.vertexBuffer,Se.indexBuffer,Se.segments),E.coordsIndex.push(Ee.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,B.width,B.height])}(this,this.style.map.terrain))}renderLayer(l,f,m,y,B){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="custom"||(y||[]).length)&&(this.id=m.id,o.cc(m)?function(E,R,O,V,G,J){if(E.renderPass!=="translucent")return;const{isRenderingToTexture:X}=J,ne=An.disabled,de=E.colorModeForRenderPass();(O._unevaluatedLayout.hasValue("text-variable-anchor")||O._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Ee,Se,Ie,Oe,je,De,$e,Je,Qe){const at=Se.transform,Mt=Se.style.map.terrain,yt=je==="map",bt=De==="map";for(const Ct of Ee){const Zt=Oe.getTile(Ct),rr=Zt.getBucket(Ie);if(!rr||!rr.text||!rr.text.segments.get().length)continue;const $t=o.an(rr.textSizeData,at.zoom),Tr=o.aC(Zt,1,Se.transform.zoom),tn=ln(yt,Se.transform,Tr),Dn=Ie.layout.get("icon-text-fit")!=="none"&&rr.hasIconData();if($t){const li=Math.pow(2,at.zoom-Zt.tileID.overscaledZ),Ti=Mt?(Bn,bi)=>Mt.getElevation(Ct,Bn,bi):null;zd(rr,yt,bt,Qe,at,tn,li,$t,Dn,o.aD(at,Zt,$e,Je),Ct.toUnwrapped(),Ti)}}}(V,E,O,R,O.layout.get("text-rotation-alignment"),O.layout.get("text-pitch-alignment"),O.paint.get("text-translate"),O.paint.get("text-translate-anchor"),G),O.paint.get("icon-opacity").constantOr(1)!==0&&fA(E,R,O,V,!1,O.paint.get("icon-translate"),O.paint.get("icon-translate-anchor"),O.layout.get("icon-rotation-alignment"),O.layout.get("icon-pitch-alignment"),O.layout.get("icon-keep-upright"),ne,de,X),O.paint.get("text-opacity").constantOr(1)!==0&&fA(E,R,O,V,!0,O.paint.get("text-translate"),O.paint.get("text-translate-anchor"),O.layout.get("text-rotation-alignment"),O.layout.get("text-pitch-alignment"),O.layout.get("text-keep-upright"),ne,de,X),R.map.showCollisionBoxes&&(fh(E,R,O,V,!0),fh(E,R,O,V,!1))}(l,f,m,y,this.style.placement.variableOffsets,B):o.cd(m)?function(E,R,O,V,G){if(E.renderPass!=="translucent")return;const{isRenderingToTexture:J}=G,X=O.paint.get("circle-opacity"),ne=O.paint.get("circle-stroke-width"),de=O.paint.get("circle-stroke-opacity"),Ee=!O.layout.get("circle-sort-key").isConstant();if(X.constantOr(1)===0&&(ne.constantOr(1)===0||de.constantOr(1)===0))return;const Se=E.context,Ie=Se.gl,Oe=E.transform,je=E.getDepthModeForSublayer(0,Yr.ReadOnly),De=An.disabled,$e=E.colorModeForRenderPass(),Je=[],Qe=Oe.getCircleRadiusCorrection();for(let at=0;at<V.length;at++){const Mt=V[at],yt=R.getTile(Mt),bt=yt.getBucket(O);if(!bt)continue;const Ct=O.paint.get("circle-translate"),Zt=O.paint.get("circle-translate-anchor"),rr=o.aD(Oe,yt,Ct,Zt),$t=bt.programConfigurations.get(O.id),Tr=E.useProgram("circle",$t),tn=bt.layoutVertexBuffer,Dn=bt.indexBuffer,li=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Mt),Ti={programConfiguration:$t,program:Tr,layoutVertexBuffer:tn,indexBuffer:Dn,uniformValues:Nl(E,yt,O,rr,Qe),terrainData:li,projectionData:Oe.getProjectionData({overscaledTileID:Mt,applyGlobeMatrix:!J,applyTerrainMatrix:!0})};if(Ee){const Bn=bt.segments.get();for(const bi of Bn)Je.push({segments:new o.aM([bi]),sortKey:bi.sortKey,state:Ti})}else Je.push({segments:bt.segments,sortKey:0,state:Ti})}Ee&&Je.sort((at,Mt)=>at.sortKey-Mt.sortKey);for(const at of Je){const{programConfiguration:Mt,program:yt,layoutVertexBuffer:bt,indexBuffer:Ct,uniformValues:Zt,terrainData:rr,projectionData:$t}=at.state;yt.draw(Se,Ie.TRIANGLES,je,De,$e,Tn.backCCW,Zt,rr,$t,O.id,bt,Ct,at.segments,O.paint,E.transform.zoom,Mt)}}(l,f,m,y,B):o.ce(m)?function(E,R,O,V,G){if(O.paint.get("heatmap-opacity")===0)return;const J=E.context,{isRenderingToTexture:X,isRenderingGlobe:ne}=G;if(E.style.map.terrain){for(const de of V){const Ee=R.getTile(de);R.hasRenderableParent(de)||(E.renderPass==="offscreen"?pf(E,Ee,O,de,ne):E.renderPass==="translucent"&&ph(E,O,de,X,ne))}J.viewport.set([0,0,E.width,E.height])}else E.renderPass==="offscreen"?function(de,Ee,Se,Ie){const Oe=de.context,je=Oe.gl,De=de.transform,$e=An.disabled,Je=new kn([je.ONE,je.ONE],o.bf.transparent,[!0,!0,!0,!0]);(function(Qe,at,Mt){const yt=Qe.gl;Qe.activeTexture.set(yt.TEXTURE1),Qe.viewport.set([0,0,at.width/4,at.height/4]);let bt=Mt.heatmapFbos.get(o.c3);bt?(yt.bindTexture(yt.TEXTURE_2D,bt.colorAttachment.get()),Qe.bindFramebuffer.set(bt.framebuffer)):(bt=gf(Qe,at.width/4,at.height/4),Mt.heatmapFbos.set(o.c3,bt))})(Oe,de,Se),Oe.clear({color:o.bf.transparent});for(let Qe=0;Qe<Ie.length;Qe++){const at=Ie[Qe];if(Ee.hasRenderableParent(at))continue;const Mt=Ee.getTile(at),yt=Mt.getBucket(Se);if(!yt)continue;const bt=yt.programConfigurations.get(Se.id),Ct=de.useProgram("heatmap",bt),Zt=De.getProjectionData({overscaledTileID:at,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),rr=De.getCircleRadiusCorrection();Ct.draw(Oe,je.TRIANGLES,Yr.disabled,$e,Je,Tn.backCCW,du(Mt,De.zoom,Se.paint.get("heatmap-intensity"),rr),null,Zt,Se.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,Se.paint,De.zoom,bt)}Oe.viewport.set([0,0,de.width,de.height])}(E,R,O,V):E.renderPass==="translucent"&&function(de,Ee){const Se=de.context,Ie=Se.gl;Se.setColorMode(de.colorModeForRenderPass());const Oe=Ee.heatmapFbos.get(o.c3);Oe&&(Se.activeTexture.set(Ie.TEXTURE0),Ie.bindTexture(Ie.TEXTURE_2D,Oe.colorAttachment.get()),Se.activeTexture.set(Ie.TEXTURE1),mf(Se,Ee).bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),de.useProgram("heatmapTexture").draw(Se,Ie.TRIANGLES,Yr.disabled,An.disabled,de.colorModeForRenderPass(),Tn.disabled,$a(de,Ee,0,1),null,null,Ee.id,de.viewportBuffer,de.quadTriangleIndexBuffer,de.viewportSegments,Ee.paint,de.transform.zoom))}(E,O)}(l,f,m,y,B):o.cf(m)?function(E,R,O,V,G){if(E.renderPass!=="translucent")return;const{isRenderingToTexture:J}=G,X=O.paint.get("line-opacity"),ne=O.paint.get("line-width");if(X.constantOr(1)===0||ne.constantOr(1)===0)return;const de=E.getDepthModeForSublayer(0,Yr.ReadOnly),Ee=E.colorModeForRenderPass(),Se=O.paint.get("line-dasharray"),Ie=Se.constantOr(1),Oe=O.paint.get("line-pattern"),je=Oe.constantOr(1),De=O.paint.get("line-gradient"),$e=O.getCrossfadeParameters();let Je;Je=je?"linePattern":Ie&&De?"lineGradientSDF":Ie?"lineSDF":De?"lineGradient":"line";const Qe=E.context,at=Qe.gl,Mt=E.transform;let yt=!0;for(const bt of V){const Ct=R.getTile(bt);if(je&&!Ct.patternsLoaded())continue;const Zt=Ct.getBucket(O);if(!Zt)continue;const rr=Zt.programConfigurations.get(O.id),$t=E.context.program.get(),Tr=E.useProgram(Je,rr),tn=yt||Tr.program!==$t,Dn=E.style.map.terrain&&E.style.map.terrain.getTerrainData(bt),li=Oe.constantOr(null),Ti=Se&&Se.constantOr(null);if(li&&Ct.imageAtlas){const ao=Ct.imageAtlas,us=ao.patternPositions[li.to.toString()],_s=ao.patternPositions[li.from.toString()];us&&_s&&rr.setConstantPatternPositions(us,_s)}else if(Ti){const ao=O.layout.get("line-cap")==="round",us=E.lineAtlas.getDash(Ti.to,ao),_s=E.lineAtlas.getDash(Ti.from,ao);rr.setConstantDashPositions(us,_s)}const Bn=Mt.getProjectionData({overscaledTileID:bt,applyGlobeMatrix:!J,applyTerrainMatrix:!0}),bi=Mt.getPixelScale();let Gs;je?(Gs=ah(E,Ct,O,bi,$e),pA(Qe,at,Ct,rr,$e)):Ie&&De?(Gs=Ji(E,Ct,O,bi,$e,Zt.lineClipsArray.length),yf(E,R,Qe,at,O,Zt,bt,rr,$e)):Ie?(Gs=wa(E,Ct,O,bi,$e),Sg(E,Qe,at,rr,tn,$e)):De?(Gs=zl(E,Ct,O,bi,Zt.lineClipsArray.length),_f(E,R,Qe,at,O,Zt,bt)):Gs=ds(E,Ct,O,bi);const Wi=E.stencilModeForClipping(bt);Tr.draw(Qe,at.TRIANGLES,de,Wi,Ee,Tn.disabled,Gs,Dn,Bn,O.id,Zt.layoutVertexBuffer,Zt.indexBuffer,Zt.segments,O.paint,E.transform.zoom,rr,Zt.layoutVertexBuffer2),yt=!1}}(l,f,m,y,B):o.cg(m)?function(E,R,O,V,G){const J=O.paint.get("fill-color"),X=O.paint.get("fill-opacity");if(X.constantOr(1)===0)return;const{isRenderingToTexture:ne}=G,de=E.colorModeForRenderPass(),Ee=O.paint.get("fill-pattern"),Se=E.opaquePassEnabledForLayer()&&!Ee.constantOr(1)&&J.constantOr(o.bf.transparent).a===1&&X.constantOr(0)===1?"opaque":"translucent";if(E.renderPass===Se){const Ie=E.getDepthModeForSublayer(1,E.renderPass==="opaque"?Yr.ReadWrite:Yr.ReadOnly);Vd(E,R,O,V,Ie,de,!1,ne)}if(E.renderPass==="translucent"&&O.paint.get("fill-antialias")){const Ie=E.getDepthModeForSublayer(O.getPaintProperty("fill-outline-color")?2:0,Yr.ReadOnly);Vd(E,R,O,V,Ie,de,!0,ne)}}(l,f,m,y,B):o.ch(m)?function(E,R,O,V,G){const J=O.paint.get("fill-extrusion-opacity");if(J===0)return;const{isRenderingToTexture:X}=G;if(E.renderPass==="translucent"){const ne=new Yr(E.context.gl.LEQUAL,Yr.ReadWrite,E.depthRangeFor3D);if(J!==1||O.paint.get("fill-extrusion-pattern").constantOr(1))gh(E,R,O,V,ne,An.disabled,kn.disabled,X),gh(E,R,O,V,ne,E.stencilModeFor3D(),E.colorModeForRenderPass(),X);else{const de=E.colorModeForRenderPass();gh(E,R,O,V,ne,An.disabled,de,X)}}}(l,f,m,y,B):o.ci(m)?function(E,R,O,V,G){if(E.renderPass!=="offscreen"&&E.renderPass!=="translucent")return;const{isRenderingToTexture:J}=G,X=E.context,ne=E.style.projection.useSubdivision,de=E.getDepthModeForSublayer(0,Yr.ReadOnly),Ee=E.colorModeForRenderPass();if(E.renderPass==="offscreen")(function(Se,Ie,Oe,je,De,$e,Je){const Qe=Se.context,at=Qe.gl;for(const Mt of Oe){const yt=Ie.getTile(Mt),bt=yt.dem;if(!bt||!bt.data||!yt.needsHillshadePrepare)continue;const Ct=bt.dim,Zt=bt.stride,rr=bt.getPixels();if(Qe.activeTexture.set(at.TEXTURE1),Qe.pixelStoreUnpackPremultiplyAlpha.set(!1),yt.demTexture=yt.demTexture||Se.getTileTexture(Zt),yt.demTexture){const Tr=yt.demTexture;Tr.update(rr,{premultiply:!1}),Tr.bind(at.NEAREST,at.CLAMP_TO_EDGE)}else yt.demTexture=new o.T(Qe,rr,at.RGBA,{premultiply:!1}),yt.demTexture.bind(at.NEAREST,at.CLAMP_TO_EDGE);Qe.activeTexture.set(at.TEXTURE0);let $t=yt.fbo;if(!$t){const Tr=new o.T(Qe,{width:Ct,height:Ct,data:null},at.RGBA);Tr.bind(at.LINEAR,at.CLAMP_TO_EDGE),$t=yt.fbo=Qe.createFramebuffer(Ct,Ct,!0,!1),$t.colorAttachment.set(Tr.texture)}Qe.bindFramebuffer.set($t.framebuffer),Qe.viewport.set([0,0,Ct,Ct]),Se.useProgram("hillshadePrepare").draw(Qe,at.TRIANGLES,De,$e,Je,Tn.disabled,wo(yt.tileID,bt),null,null,je.id,Se.rasterBoundsBuffer,Se.quadTriangleIndexBuffer,Se.rasterBoundsSegments),yt.needsHillshadePrepare=!1}})(E,R,V,O,de,An.disabled,Ee),X.viewport.set([0,0,E.width,E.height]);else if(E.renderPass==="translucent")if(ne){const[Se,Ie,Oe]=E.stencilConfigForOverlapTwoPass(V);gA(E,R,O,Oe,Se,de,Ee,!1,J),gA(E,R,O,Oe,Ie,de,Ee,!0,J)}else{const[Se,Ie]=E.getStencilConfigForOverlapAndUpdateStencilID(V);gA(E,R,O,Ie,Se,de,Ee,!1,J)}}(l,f,m,y,B):o.cj(m)?function(E,R,O,V,G){if(E.renderPass!=="translucent"||!V.length)return;const{isRenderingToTexture:J}=G,X=E.style.projection.useSubdivision,ne=E.getDepthModeForSublayer(0,Yr.ReadOnly),de=E.colorModeForRenderPass();if(X){const[Ee,Se,Ie]=E.stencilConfigForOverlapTwoPass(V);dl(E,R,O,Ie,Ee,ne,de,!1,J),dl(E,R,O,Ie,Se,ne,de,!0,J)}else{const[Ee,Se]=E.getStencilConfigForOverlapAndUpdateStencilID(V);dl(E,R,O,Se,Ee,ne,de,!1,J)}}(l,f,m,y,B):o.bK(m)?function(E,R,O,V,G){if(E.renderPass!=="translucent"||O.paint.get("raster-opacity")===0||!V.length)return;const{isRenderingToTexture:J}=G,X=R.getSource(),ne=E.style.projection.useSubdivision;if(X instanceof ar)Vn(E,R,O,V,null,!1,!1,X.tileCoords,X.flippedWindingOrder,J);else if(ne){const[de,Ee,Se]=E.stencilConfigForOverlapTwoPass(V);Vn(E,R,O,Se,de,!1,!0,zo,!1,J),Vn(E,R,O,Se,Ee,!0,!0,zo,!1,J)}else{const[de,Ee]=E.getStencilConfigForOverlapAndUpdateStencilID(V);Vn(E,R,O,Ee,de,!1,!0,zo,!1,J)}}(l,f,m,y,B):o.ck(m)?function(E,R,O,V,G){const J=O.paint.get("background-color"),X=O.paint.get("background-opacity");if(X===0)return;const{isRenderingToTexture:ne}=G,de=E.context,Ee=de.gl,Se=E.style.projection,Ie=E.transform,Oe=Ie.tileSize,je=O.paint.get("background-pattern");if(E.isPatternMissing(je))return;const De=!je&&J.a===1&&X===1&&E.opaquePassEnabledForLayer()?"opaque":"translucent";if(E.renderPass!==De)return;const $e=An.disabled,Je=E.getDepthModeForSublayer(0,De==="opaque"?Yr.ReadWrite:Yr.ReadOnly),Qe=E.colorModeForRenderPass(),at=E.useProgram(je?"backgroundPattern":"background"),Mt=V||yr(Ie,{tileSize:Oe,terrain:E.style.map.terrain});je&&(de.activeTexture.set(Ee.TEXTURE0),E.imageManager.bind(E.context));const yt=O.getCrossfadeParameters();for(const bt of Mt){const Ct=Ie.getProjectionData({overscaledTileID:bt,applyGlobeMatrix:!ne,applyTerrainMatrix:!0}),Zt=je?Al(X,E,je,{tileID:bt,tileSize:Oe},yt):xc(X,J),rr=E.style.map.terrain&&E.style.map.terrain.getTerrainData(bt),$t=Se.getMeshFromTileID(de,bt.canonical,!1,!0,"raster");at.draw(de,Ee.TRIANGLES,Je,$e,Qe,Tn.backCCW,Zt,rr,Ct,O.id,$t.vertexBuffer,$t.indexBuffer,$t.segments)}}(l,0,m,y,B):o.cl(m)&&function(E,R,O,V){const{isRenderingGlobe:G}=V,J=E.context,X=O.implementation,ne=E.style.projection,de=E.transform,Ee=de.getProjectionDataForCustomLayer(G),Se={farZ:de.farZ,nearZ:de.nearZ,fov:de.fov*Math.PI/180,modelViewProjectionMatrix:de.modelViewProjectionMatrix,projectionMatrix:de.projectionMatrix,shaderData:{variantName:ne.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${ne.shaderPreludeCode.vertexSource}`,define:ne.shaderDefine},defaultProjectionData:Ee},Ie=X.renderingMode?X.renderingMode:"2d";if(E.renderPass==="offscreen"){const Oe=X.prerender;Oe&&(E.setCustomLayerDefaults(),J.setColorMode(E.colorModeForRenderPass()),Oe.call(X,J.gl,Se),J.setDirty(),E.setBaseState())}else if(E.renderPass==="translucent"){E.setCustomLayerDefaults(),J.setColorMode(E.colorModeForRenderPass()),J.setStencilMode(An.disabled);const Oe=Ie==="3d"?E.getDepthModeFor3D():E.getDepthModeForSublayer(0,Yr.ReadOnly);J.setDepthMode(Oe),X.render(J.gl,Se),J.setDirty(),E.setBaseState(),J.bindFramebuffer.set(null)}}(l,0,m,B))}saveTileTexture(l){const f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const f=this._tileTextures[l];return f&&f.length>0?f.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const f=this.imageManager.getPattern(l.from.toString()),m=this.imageManager.getPattern(l.to.toString());return!f||!m}useProgram(l,f,m=!1,y=[]){this.cache=this.cache||{};const B=!!this.style.map.terrain,E=this.style.projection,R=m?ya.projectionMercator:E.shaderPreludeCode,O=m?nh:E.shaderDefine,V=l+(f?f.cacheKey:"")+`/${m?fc:E.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(B?"/terrain":"")+(y?`/${y.join("/")}`:"");return this.cache[V]||(this.cache[V]=new Dl(this.context,ya[l],f,_u[l],this._showOverdrawInspector,B,R,O,y)),this.cache[V]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:f}=this.context.gl;return this.width!==l||this.height!==f}}function Cu(v,l){let f,m=!1,y=null,B=null;const E=()=>{y=null,m&&(v.apply(B,f),y=setTimeout(E,l),m=!1)};return(...R)=>(m=!0,B=this,f=R,y||E(),y)}class gl{constructor(l){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let m;return f.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(m=y)}),(m&&m[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(!this._isValidHash(f))return!1;const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:m,pitch:+(f[4]||0)}),!0},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,f)},this._removeHash=()=>{const f=this._getCurrentHash();if(f.length===0)return;const m=f.join("/");let y=m;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${m}`);let B=window.location.hash.replace(y,"");B.startsWith("#&")?B=B.slice(0,1)+B.slice(2):B==="#"&&(B="");let E=window.location.href.replace(/(#.+)?$/,B);E=E.replace("&&","&"),window.history.replaceState(window.history.state,null,E)},this._updateHash=Cu(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(l){const f=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),B=Math.pow(10,y),E=Math.round(f.lng*B)/B,R=Math.round(f.lat*B)/B,O=this._map.getBearing(),V=this._map.getPitch();let G="";if(G+=l?`/${E}/${R}/${m}`:`${m}/${R}/${E}`,(O||V)&&(G+="/"+Math.round(10*O)/10),V&&(G+=`/${Math.round(V)}`),this._hashName){const J=this._hashName;let X=!1;const ne=window.location.hash.slice(1).split("&").map(de=>{const Ee=de.split("=")[0];return Ee===J?(X=!0,`${Ee}=${G}`):de}).filter(de=>de);return X||ne.push(`${J}=${G}`),`#${ne.join("&")}`}return`#${G}`}_isValidHash(l){if(l.length<3||l.some(isNaN))return!1;try{new o.S(+l[2],+l[1])}catch{return!1}const f=+l[0],m=+(l[3]||0),y=+(l[4]||0);return f>=this._map.getMinZoom()&&f<=this._map.getMaxZoom()&&m>=-180&&m<=180&&y>=this._map.getMinPitch()&&y<=this._map.getMaxPitch()}}const yh={linearity:.3,easing:o.cm(0,0,.3,1)},Gd=o.e({deceleration:2500,maxSpeed:1400},yh),Pg=o.e({deceleration:20,maxSpeed:1400},yh),Mg=o.e({deceleration:1e3,maxSpeed:360},yh),Fg=o.e({deceleration:1e3,maxSpeed:90},yh),Rg=o.e({deceleration:1e3,maxSpeed:360},yh);class Lg{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:M(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,f=M();for(;l.length>0&&f-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:B}of this._inertiaBuffer)f.zoom+=B.zoomDelta||0,f.bearing+=B.bearingDelta||0,f.pitch+=B.pitchDelta||0,f.roll+=B.rollDelta||0,B.panDelta&&f.pan._add(B.panDelta),B.around&&(f.around=B.around),B.pinchAround&&(f.pinchAround=B.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(f.pan.mag()){const B=Vl(f.pan.mag(),m,o.e({},Gd,l||{})),E=f.pan.mult(B.amount/f.pan.mag()),R=this._map.cameraHelper.handlePanInertia(E,this._map.transform);y.center=R.easingCenter,y.offset=R.easingOffset,bh(y,B)}if(f.zoom){const B=Vl(f.zoom,m,Pg);y.zoom=this._map.transform.zoom+B.amount,bh(y,B)}if(f.bearing){const B=Vl(f.bearing,m,Mg);y.bearing=this._map.transform.bearing+o.ae(B.amount,-179,179),bh(y,B)}if(f.pitch){const B=Vl(f.pitch,m,Fg);y.pitch=this._map.transform.pitch+B.amount,bh(y,B)}if(f.roll){const B=Vl(f.roll,m,Rg);y.roll=this._map.transform.roll+o.ae(B.amount,-179,179),bh(y,B)}if(y.zoom||y.bearing){const B=f.pinchAround===void 0?f.around:f.pinchAround;y.around=B?this._map.unproject(B):this._map.getCenter()}return this.clear(),o.e(y,{noMoveStart:!0})}}function bh(v,l){(!v.duration||v.duration<l.duration)&&(v.duration=l.duration,v.easing=l.easing)}function Vl(v,l,f){const{maxSpeed:m,linearity:y,deceleration:B}=f,E=o.ae(v*y/(l/1e3),-m,m),R=Math.abs(E)/(B*y);return{easing:f.easing,duration:1e3*R,amount:E*(R/2)}}class Vs extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,m,y={}){m=m instanceof MouseEvent?m:new MouseEvent(l,m);const B=P.mousePos(f.getCanvas(),m),E=f.unproject(B);super(l,o.e({point:B,lngLat:E,originalEvent:m},y)),this._defaultPrevented=!1,this.target=f}}class oo extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,m){const y=l==="touchend"?m.changedTouches:m.touches,B=P.touchPos(f.getCanvasContainer(),y),E=B.map(O=>f.unproject(O)),R=B.reduce((O,V,G,J)=>O.add(V.div(J.length)),new o.P(0,0));super(l,{points:B,point:R,lngLats:E,lngLat:f.unproject(R),originalEvent:m}),this._defaultPrevented=!1}}class Ba extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,m){super(l,{originalEvent:m}),this._defaultPrevented=!1}}class Wd{constructor(l,f){this._map=l,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new Ba(l.type,this._map,l))}mousedown(l,f){return this._mousedownPos=f,this._firePreventable(new Vs(l.type,this._map,l))}mouseup(l){this._map.fire(new Vs(l.type,this._map,l))}click(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new Vs(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Vs(l.type,this._map,l))}mouseover(l){this._map.fire(new Vs(l.type,this._map,l))}mouseout(l){this._map.fire(new Vs(l.type,this._map,l))}touchstart(l){return this._firePreventable(new oo(l.type,this._map,l))}touchmove(l){this._map.fire(new oo(l.type,this._map,l))}touchend(l){this._map.fire(new oo(l.type,this._map,l))}touchcancel(l){this._map.fire(new oo(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class I{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Vs(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Vs(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class L{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.screenPointToLocation(o.P.convert(l),this._map.terrain)}}class ${constructor(l,f){this._map=l,this._tr=new L(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(P.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(l,f){if(!this._active)return;const m=f;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=m,this._box||(this._box=P.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const B=Math.min(y.x,m.x),E=Math.max(y.x,m.x),R=Math.min(y.y,m.y),O=Math.max(y.y,m.y);P.setTransform(this._box,`translate(${B}px,${R}px)`),this._box.style.width=E-B+"px",this._box.style.height=O-R+"px"}mouseupWindow(l,f){if(!this._active||l.button!==0)return;const m=this._startPos,y=f;if(this.reset(),P.suppressClick(),m.x!==y.x||m.y!==y.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:l})),{cameraAnimation:B=>B.fitScreenCoordinates(m,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(P.remove(this._box),this._box=null),P.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,f){return this._map.fire(new o.l(l,{originalEvent:f}))}}function Y(v,l){if(v.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${l.length}`);const f={};for(let m=0;m<v.length;m++)f[v[m].identifier]=l[m];return f}class Ae{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,f,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){const B=new o.P(0,0);for(const E of y)B._add(E);return B.div(y.length)}(f),this.touches=Y(m,f)))}touchmove(l,f,m){if(this.aborted||!this.centroid)return;const y=Y(m,f);for(const B in this.touches){const E=y[B];(!E||E.dist(this.touches[B])>30)&&(this.aborted=!0)}}touchend(l,f,m){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class _e{constructor(l){this.singleTap=new Ae(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,f,m){this.singleTap.touchstart(l,f,m)}touchmove(l,f,m){this.singleTap.touchmove(l,f,m)}touchend(l,f,m){const y=this.singleTap.touchend(l,f,m);if(y){const B=l.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(y)<30;if(B&&E||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class ye{constructor(l){this._tr=new L(l),this._zoomIn=new _e({numTouches:1,numTaps:2}),this._zoomOut=new _e({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,f,m){this._zoomIn.touchstart(l,f,m),this._zoomOut.touchstart(l,f,m)}touchmove(l,f,m){this._zoomIn.touchmove(l,f,m),this._zoomOut.touchmove(l,f,m)}touchend(l,f,m){const y=this._zoomIn.touchend(l,f,m),B=this._zoomOut.touchend(l,f,m),E=this._tr;return y?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(y)},{originalEvent:l})}):B?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(B)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class we{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(...l){const f=this._moveFunction(...l);if(f.bearingDelta||f.pitchDelta||f.rollDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(l,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=Array.isArray(f)?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,f){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const y=Array.isArray(f)?f[0]:f;return!this._moved&&y.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(m,y))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&P.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Te=0,be=2,ct={[Te]:1,[be]:2};class Et{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const f=P.mouseButton(l);this._eventButton=f}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(f,m){const y=ct[m];return f.buttons===void 0||(f.buttons&y)!==y}(l,this._eventButton)}isValidEndEvent(l){return P.mouseButton(l)===this._eventButton}}class ke{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}class ft{constructor(l=new Et({checkCorrectEvent:()=>!0}),f=new ke){this.mouseMoveStateManager=l,this.oneFingerTouchMoveStateManager=f}_executeRelevantHandler(l,f,m){return l instanceof MouseEvent?f(l):typeof TouchEvent<"u"&&l instanceof TouchEvent?m(l):void 0}startMove(l){this._executeRelevantHandler(l,f=>this.mouseMoveStateManager.startMove(f),f=>this.oneFingerTouchMoveStateManager.startMove(f))}endMove(l){this._executeRelevantHandler(l,f=>this.mouseMoveStateManager.endMove(f),f=>this.oneFingerTouchMoveStateManager.endMove(f))}isValidStartEvent(l){return this._executeRelevantHandler(l,f=>this.mouseMoveStateManager.isValidStartEvent(f),f=>this.oneFingerTouchMoveStateManager.isValidStartEvent(f))}isValidMoveEvent(l){return this._executeRelevantHandler(l,f=>this.mouseMoveStateManager.isValidMoveEvent(f),f=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(f))}isValidEndEvent(l){return this._executeRelevantHandler(l,f=>this.mouseMoveStateManager.isValidEndEvent(f),f=>this.oneFingerTouchMoveStateManager.isValidEndEvent(f))}}const _t=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=l=>{l.preventDefault()}};class Nt{constructor(l,f){this._clickTolerance=l.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(l){return l<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(l,f,m){return this._calculateTransform(l,f,m)}touchmove(l,f,m){if(this._active){if(!this._shouldBePrevented(m.length))return l.preventDefault(),this._calculateTransform(l,f,m);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",l)}}touchend(l,f,m){this._calculateTransform(l,f,m),this._active&&this._shouldBePrevented(m.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,f,m){m.length>0&&(this._active=!0);const y=Y(m,f),B=new o.P(0,0),E=new o.P(0,0);let R=0;for(const V in y){const G=y[V],J=this._touches[V];J&&(B._add(G),E._add(G.sub(J)),R++,y[V]=G)}if(this._touches=y,this._shouldBePrevented(R)||!E.mag())return;const O=E.div(R);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:B.div(R),panDelta:O}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ut{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,f,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([f[0],f[1]]))}touchmove(l,f,m){if(!this._firstTwoTouches)return;l.preventDefault();const[y,B]=this._firstTwoTouches,E=zt(m,f,y),R=zt(m,f,B);if(!E||!R)return;const O=this._aroundCenter?null:E.add(R).div(2);return this._move([E,R],O,l)}touchend(l,f,m){if(!this._firstTwoTouches)return;const[y,B]=this._firstTwoTouches,E=zt(m,f,y),R=zt(m,f,B);E&&R||(this._active&&P.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function zt(v,l,f){for(let m=0;m<v.length;m++)if(v[m].identifier===f)return l[m]}function Gt(v,l){return Math.log(v/l)/Math.LN2}class sr extends ut{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,f){const m=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Gt(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gt(this._distance,m),pinchAround:f}}}function tr(v,l){return 180*v.angleWith(l)/Math.PI}class Wr extends ut{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,f,m){const y=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tr(this._vector,y),pinchAround:f}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const f=25/(Math.PI*this._minDiameter)*360,m=tr(l,this._startVector);return Math.abs(m)<f}}function Fr(v){return Math.abs(v.y)>Math.abs(v.x)}class mn extends ut{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,f,m){super.touchstart(l,f,m),this._currentTouchCount=m.length}_start(l){this._lastPoints=l,Fr(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,f,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=l[0].sub(this._lastPoints[0]),B=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,B,m.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(y.y+B.y)/2*-.5}):void 0}gestureBeginsVertically(l,f,m){if(this._valid!==void 0)return this._valid;const y=l.mag()>=2,B=f.mag()>=2;if(!y&&!B)return;if(!y||!B)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const E=l.y>0==f.y>0;return Fr(l)&&Fr(f)&&E}}const zr={panStep:100,bearingStep:15,pitchStep:10};class Fn{constructor(l){this._tr=new L(l);const f=zr;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let f=0,m=0,y=0,B=0,E=0;switch(l.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:l.shiftKey?m=-1:(l.preventDefault(),B=-1);break;case 39:l.shiftKey?m=1:(l.preventDefault(),B=1);break;case 38:l.shiftKey?y=1:(l.preventDefault(),E=-1);break;case 40:l.shiftKey?y=-1:(l.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:R=>{const O=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:cs,zoom:f?Math.round(O.zoom)+f*(l.shiftKey?2:1):O.zoom,bearing:O.bearing+m*this._bearingStep,pitch:O.pitch+y*this._pitchStep,offset:[-B*this._panStep,-E*this._panStep],center:O.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function cs(v){return v*(2-v)}const wn=4.000244140625,jr=1/450;class _r{constructor(l,f){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=l,this._tr=new L(l),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=jr}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(l){return!!this._map.cooperativeGestures.isEnabled()&&!(l.ctrlKey||this._map.cooperativeGestures.isBypassed(l))}wheel(l){if(!this.isEnabled())return;if(this._shouldBePrevented(l))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",l);let f=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const m=M(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,f!==0&&f%wn==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(y*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=P.mousePos(this._map.getCanvas(),l),m=this._tr;this._aroundPoint=this._aroundCenter?m.transform.locationToScreenPoint(o.S.convert(m.center)):f,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const R=l.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=R),typeof this._targetZoom=="number"&&(this._targetZoom+=R)}if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>wn?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&O!==0&&(O=1/O);const V=typeof this._targetZoom!="number"?l.scale:o.ah(this._targetZoom);this._targetZoom=l.constrain(l.getCameraLngLat(),o.ak(V*O)).zoom,this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom!="number"?l.zoom:this._targetZoom,m=this._startZoom,y=this._easing;let B,E=!1;if(this._type==="wheel"&&m&&y){const R=M()-this._lastWheelEventTime,O=Math.min((R+5)/200,1),V=y(O);B=o.C.number(m,f,V),O<1?this._frameId||(this._frameId=!0):E=!0}else B=f,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=B,{noInertia:!0,needsRenderFrame:!E,zoomDelta:B-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let f=o.co;if(this._prevEase){const m=this._prevEase,y=(M()-m.start)/m.duration,B=m.easing(y+.01)-m.easing(y),E=.27/Math.sqrt(B*B+1e-4)*.01,R=Math.sqrt(.0729-E*E);f=o.cm(E,R,.25,1)}return this._prevEase={start:M(),duration:l,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class cn{constructor(l,f){this._clickZoom=l,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bn{constructor(l){this._tr=new L(l),this.reset()}reset(){this._active=!1}dblclick(l,f){return l.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pn{constructor(){this._tap=new _e({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,f,m){if(!this._swipePoint)if(this._tapTime){const y=f[0],B=l.timeStamp-this._tapTime<500,E=this._tapPoint.dist(y)<30;B&&E?m.length>0&&(this._swipePoint=y,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(l,f,m)}touchmove(l,f,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=f[0],B=y.y-this._swipePoint.y;return this._swipePoint=y,l.preventDefault(),this._active=!0,{zoomDelta:B/128}}}else this._tap.touchmove(l,f,m)}touchend(l,f,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const y=this._tap.touchend(l,f,m);y&&(this._tapTime=l.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oi{constructor(l,f,m){this._el=l,this._mousePan=f,this._touchPan=m}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ps{constructor(l,f,m,y){this._pitchWithRotate=l.pitchWithRotate,this._rollEnabled=l.rollEnabled,this._mouseRotate=f,this._mousePitch=m,this._mouseRoll=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class js{constructor(l,f,m,y){this._el=l,this._touchZoom=f,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Pi{constructor(l,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=P.create("div","maplibregl-cooperative-gesture-screen",l);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=f,this._container.appendChild(y);const B=document.createElement("div");B.className="maplibregl-mobile-message",B.textContent=m,this._container.appendChild(B),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(P.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(l){return l[this._bypassKey]}notifyGestureBlocked(l,f){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:l,originalEvent:f})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const gs=v=>v.zoom||v.drag||v.roll||v.pitch||v.rotate;class Mi extends o.l{}function Fi(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta||v.rollDelta}class or{constructor(l,f){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,B)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=y.type==="renderFrame"?void 0:y,R={needsRenderFrame:!1},O={},V={};for(const{handlerName:X,handler:ne,allowed:de}of this._handlers){if(!ne.isEnabled())continue;let Ee;if(this._blockedByActive(V,de,X))ne.reset();else if(ne[B||y.type]){if(o.cp(y,B||y.type)){const Se=P.mousePos(this._map.getCanvas(),y);Ee=ne[B||y.type](y,Se)}else if(o.cq(y,B||y.type)){const Se=this._getMapTouches(y.touches),Ie=P.touchPos(this._map.getCanvas(),Se);Ee=ne[B||y.type](y,Ie,Se)}else o.cr(B||y.type)||(Ee=ne[B||y.type](y));this.mergeHandlerResult(R,O,Ee,X,E),Ee&&Ee.needsRenderFrame&&this._triggerRenderFrame()}(Ee||ne.isActive())&&(V[X]=ne)}const G={};for(const X in this._previousActiveHandlers)V[X]||(G[X]=E);this._previousActiveHandlers=V,(Object.keys(G).length||Fi(R))&&(this._changes.push([R,O,G]),this._triggerRenderFrame()),(Object.keys(V).length||Fi(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:J}=R;J&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],J(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Lg(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,B,E]of this._listeners)P.addEventListener(y,B,y===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[l,f,m]of this._listeners)P.removeEventListener(l,f,l===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(l){const f=this._map,m=f.getCanvasContainer();this._add("mapEvent",new Wd(f,l));const y=f.boxZoom=new $(f,l);this._add("boxZoom",y),l.interactive&&l.boxZoom&&y.enable();const B=f.cooperativeGestures=new Pi(f,l.cooperativeGestures);this._add("cooperativeGestures",B),l.cooperativeGestures&&B.enable();const E=new ye(f),R=new bn(f);f.doubleClickZoom=new cn(R,E),this._add("tapZoom",E),this._add("clickZoom",R),l.interactive&&l.doubleClickZoom&&f.doubleClickZoom.enable();const O=new Pn;this._add("tapDragZoom",O);const V=f.touchPitch=new mn(f);this._add("touchPitch",V),l.interactive&&l.touchPitch&&f.touchPitch.enable(l.touchPitch);const G=()=>f.project(f.getCenter()),J=function({enable:De,clickTolerance:$e,aroundCenter:Je=!0,minPixelCenterThreshold:Qe=100,rotateDegreesPerPixelMoved:at=.8},Mt){const yt=new Et({checkCorrectEvent:bt=>P.mouseButton(bt)===0&&bt.ctrlKey||P.mouseButton(bt)===2&&!bt.ctrlKey});return new we({clickTolerance:$e,move:(bt,Ct)=>{const Zt=Mt();if(Je&&Math.abs(Zt.y-bt.y)>Qe)return{bearingDelta:o.cn(new o.P(bt.x,Ct.y),Ct,Zt)};let rr=(Ct.x-bt.x)*at;return Je&&Ct.y<Zt.y&&(rr=-rr),{bearingDelta:rr}},moveStateManager:yt,enable:De,assignEvents:_t})}(l,G),X=function({enable:De,clickTolerance:$e,pitchDegreesPerPixelMoved:Je=-.5}){const Qe=new Et({checkCorrectEvent:at=>P.mouseButton(at)===0&&at.ctrlKey||P.mouseButton(at)===2});return new we({clickTolerance:$e,move:(at,Mt)=>({pitchDelta:(Mt.y-at.y)*Je}),moveStateManager:Qe,enable:De,assignEvents:_t})}(l),ne=function({enable:De,clickTolerance:$e,rollDegreesPerPixelMoved:Je=.3},Qe){const at=new Et({checkCorrectEvent:Mt=>P.mouseButton(Mt)===2&&Mt.ctrlKey});return new we({clickTolerance:$e,move:(Mt,yt)=>{const bt=Qe();let Ct=(yt.x-Mt.x)*Je;return yt.y<bt.y&&(Ct=-Ct),{rollDelta:Ct}},moveStateManager:at,enable:De,assignEvents:_t})}(l,G);f.dragRotate=new ps(l,J,X,ne),this._add("mouseRotate",J,["mousePitch"]),this._add("mousePitch",X,["mouseRotate","mouseRoll"]),this._add("mouseRoll",ne,["mousePitch"]),l.interactive&&l.dragRotate&&f.dragRotate.enable();const de=function({enable:De,clickTolerance:$e}){const Je=new Et({checkCorrectEvent:Qe=>P.mouseButton(Qe)===0&&!Qe.ctrlKey});return new we({clickTolerance:$e,move:(Qe,at)=>({around:at,panDelta:at.sub(Qe)}),activateOnStart:!0,moveStateManager:Je,enable:De,assignEvents:_t})}(l),Ee=new Nt(l,f);f.dragPan=new oi(m,de,Ee),this._add("mousePan",de),this._add("touchPan",Ee,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&f.dragPan.enable(l.dragPan);const Se=new Wr,Ie=new sr;f.touchZoomRotate=new js(m,Ie,Se,O),this._add("touchRotate",Se,["touchPan","touchZoom"]),this._add("touchZoom",Ie,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&f.touchZoomRotate.enable(l.touchZoomRotate),this._add("blockableMapEvent",new I(f));const Oe=f.scrollZoom=new _r(f,()=>this._triggerRenderFrame());this._add("scrollZoom",Oe,["mousePan"]),l.interactive&&l.scrollZoom&&f.scrollZoom.enable(l.scrollZoom);const je=f.keyboard=new Fn(f);this._add("keyboard",je),l.interactive&&l.keyboard&&f.keyboard.enable()}_add(l,f,m){this._handlers.push({handlerName:l,handler:f,allowed:m}),this._handlersById[l]=f}stop(l){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!gs(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,f,m){for(const y in l)if(y!==m&&(!f||f.indexOf(y)<0))return!0;return!1}_getMapTouches(l){const f=[];for(const m of l)this._el.contains(m.target)&&f.push(m);return f}mergeHandlerResult(l,f,m,y,B){if(!m)return;o.e(l,m);const E={handlerName:y,originalEvent:m.originalEvent||B};m.zoomDelta!==void 0&&(f.zoom=E),m.panDelta!==void 0&&(f.drag=E),m.rollDelta!==void 0&&(f.roll=E),m.pitchDelta!==void 0&&(f.pitch=E),m.bearingDelta!==void 0&&(f.rotate=E)}_applyChanges(){const l={},f={},m={};for(const[y,B,E]of this._changes)y.panDelta&&(l.panDelta=(l.panDelta||new o.P(0,0))._add(y.panDelta)),y.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+y.pitchDelta),y.rollDelta&&(l.rollDelta=(l.rollDelta||0)+y.rollDelta),y.around!==void 0&&(l.around=y.around),y.pinchAround!==void 0&&(l.pinchAround=y.pinchAround),y.noInertia&&(l.noInertia=y.noInertia),o.e(f,B),o.e(m,E);this._updateMapTransform(l,f,m),this._changes=[]}_updateMapTransform(l,f,m){const y=this._map,B=y._getTransformForUpdate(),E=y.terrain;if(!(Fi(l)||E&&this._terrainMovement))return this._fireEvents(f,m,!0);y._stop(!0);let{panDelta:R,zoomDelta:O,bearingDelta:V,pitchDelta:G,rollDelta:J,around:X,pinchAround:ne}=l;ne!==void 0&&(X=ne),X=X||y.transform.centerPoint,E&&!B.isPointOnMapSurface(X)&&(X=B.centerPoint);const de={panDelta:R,zoomDelta:O,rollDelta:J,pitchDelta:G,bearingDelta:V,around:X};this._map.cameraHelper.useGlobeControls&&!B.isPointOnMapSurface(X)&&(X=B.centerPoint);const Ee=X.distSqr(B.centerPoint)<.01?B.center:B.screenPointToLocation(R?X.sub(R):X);this._handleMapControls({terrain:E,tr:B,deltasForHelper:de,preZoomAroundLoc:Ee,combinedEventsInProgress:f,panDelta:R}),y._applyUpdatedTransform(B),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,m,!0)}_handleMapControls({terrain:l,tr:f,deltasForHelper:m,preZoomAroundLoc:y,combinedEventsInProgress:B,panDelta:E}){const R=this._map.cameraHelper;if(R.handleMapControlsRollPitchBearingZoom(m,f),l)return R.useGlobeControls?(this._terrainMovement||!B.drag&&!B.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void R.handleMapControlsPan(m,f,y)):this._terrainMovement||!B.drag&&!B.zoom?void(B.drag&&this._terrainMovement&&E?f.setCenter(f.screenPointToLocation(f.centerPoint.sub(E))):R.handleMapControlsPan(m,f,y)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void R.handleMapControlsPan(m,f,y));R.handleMapControlsPan(m,f,y)}_fireEvents(l,f,m){const y=gs(this._eventsInProgress),B=gs(l),E={};for(const J in l){const{originalEvent:X}=l[J];this._eventsInProgress[J]||(E[`${J}start`]=X),this._eventsInProgress[J]=l[J]}!y&&B&&this._fireEvent("movestart",B.originalEvent);for(const J in E)this._fireEvent(J,E[J]);B&&this._fireEvent("move",B.originalEvent);for(const J in l){const{originalEvent:X}=l[J];this._fireEvent(J,X)}const R={};let O;for(const J in this._eventsInProgress){const{handlerName:X,originalEvent:ne}=this._eventsInProgress[J];this._handlersById[X].isActive()||(delete this._eventsInProgress[J],O=f[X]||ne,R[`${J}end`]=O)}for(const J in R)this._fireEvent(J,R[J]);const V=gs(this._eventsInProgress),G=(y||B)&&!V;if(G&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const J=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&J.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(J)}if(m&&G){this._updatingCamera=!0;const J=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),X=ne=>ne!==0&&-this._bearingSnap<ne&&ne<this._bearingSnap;!J||!J.essential&&C.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:O})),X(this._map.getBearing())&&this._map.resetNorth()):(X(J.bearing||this._map.getBearing())&&(J.bearing=0),J.freezeElevation=!0,this._map.easeTo(J,{originalEvent:O})),this._updatingCamera=!1}}_fireEvent(l,f){this._map.fire(new o.l(l,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new Mi("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class br extends o.E{constructor(l,f,m){super(),this._renderFrameCallback=()=>{const y=Math.min((M()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=m.bearingSnap,this.cameraHelper=f,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(l,f){l.apply(this.transform),this.transform=l,this.cameraHelper=f}getCenter(){return new o.S(this.transform.center.lng,this.transform.center.lat)}setCenter(l,f){return this.jumpTo({center:l},f)}getCenterElevation(){return this.transform.elevation}setCenterElevation(l,f){return this.jumpTo({elevation:l},f),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(l){this._centerClampedToGround=l}panBy(l,f,m){return l=o.P.convert(l).mult(-1),this.panTo(this.transform.center,o.e({offset:l},f),m)}panTo(l,f,m){return this.easeTo(o.e({center:l},f),m)}getZoom(){return this.transform.zoom}setZoom(l,f){return this.jumpTo({zoom:l},f),this}zoomTo(l,f,m){return this.easeTo(o.e({zoom:l},f),m)}zoomIn(l,f){return this.zoomTo(this.getZoom()+1,l,f),this}zoomOut(l,f){return this.zoomTo(this.getZoom()-1,l,f),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(l,f){return l!=this.transform.fov&&(this.transform.setFov(l),this.fire(new o.l("movestart",f)).fire(new o.l("move",f)).fire(new o.l("moveend",f))),this}getBearing(){return this.transform.bearing}setBearing(l,f){return this.jumpTo({bearing:l},f),this}getPadding(){return this.transform.padding}setPadding(l,f){return this.jumpTo({padding:l},f),this}rotateTo(l,f,m){return this.easeTo(o.e({bearing:l},f),m)}resetNorth(l,f){return this.rotateTo(0,o.e({duration:1e3},l),f),this}resetNorthPitch(l,f){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},l),f),this}snapToNorth(l,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,f):this}getPitch(){return this.transform.pitch}setPitch(l,f){return this.jumpTo({pitch:l},f),this}getRoll(){return this.transform.roll}setRoll(l,f){return this.jumpTo({roll:l},f),this}cameraForBounds(l,f){l=Re.convert(l).adjustAntiMeridian();const m=f&&f.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),m,f)}_cameraForBoxAndBearing(l,f,m,y){const B={top:0,bottom:0,right:0,left:0};if(typeof(y=o.e({padding:B,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const V=y.padding;y.padding={top:V,bottom:V,right:V,left:V}}const E=o.e(B,y.padding);y.padding=E;const R=this.transform,O=new Re(l,f);return this.cameraHelper.cameraForBoxAndBearing(y,E,O,m,R)}fitBounds(l,f,m){return this._fitInternal(this.cameraForBounds(l,f),f,m)}fitScreenCoordinates(l,f,m,y,B){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(l)),this.transform.screenPointToLocation(o.P.convert(f)),m,y),y,B)}_fitInternal(l,f,m){return l?(delete(f=o.e(l,f)).padding,f.linear?this.easeTo(f,m):this.flyTo(f,m)):this}jumpTo(l,f){this.stop();const m=this._getTransformForUpdate();let y=!1,B=!1,E=!1;const R=m.zoom;this.cameraHelper.handleJumpToCenterZoom(m,l);const O=m.zoom!==R;return"elevation"in l&&m.elevation!==+l.elevation&&m.setElevation(+l.elevation),"bearing"in l&&m.bearing!==+l.bearing&&(y=!0,m.setBearing(+l.bearing)),"pitch"in l&&m.pitch!==+l.pitch&&(B=!0,m.setPitch(+l.pitch)),"roll"in l&&m.roll!==+l.roll&&(E=!0,m.setRoll(+l.roll)),l.padding==null||m.isPaddingEqual(l.padding)||m.setPadding(l.padding),this._applyUpdatedTransform(m),this.fire(new o.l("movestart",f)).fire(new o.l("move",f)),O&&this.fire(new o.l("zoomstart",f)).fire(new o.l("zoom",f)).fire(new o.l("zoomend",f)),y&&this.fire(new o.l("rotatestart",f)).fire(new o.l("rotate",f)).fire(new o.l("rotateend",f)),B&&this.fire(new o.l("pitchstart",f)).fire(new o.l("pitch",f)).fire(new o.l("pitchend",f)),E&&this.fire(new o.l("rollstart",f)).fire(new o.l("roll",f)).fire(new o.l("rollend",f)),this.fire(new o.l("moveend",f))}calculateCameraOptionsFromTo(l,f,m,y=0){const B=o.a1.fromLngLat(l,f),E=o.a1.fromLngLat(m,y),R=E.x-B.x,O=E.y-B.y,V=E.z-B.z,G=Math.hypot(R,O,V);if(G===0)throw new Error("Can't calculate camera options with same From and To");const J=Math.hypot(R,O),X=o.ak(this.transform.cameraToCenterDistance/G/this.transform.tileSize),ne=180*Math.atan2(R,-O)/Math.PI;let de=180*Math.acos(J/G)/Math.PI;return de=V<0?90-de:90+de,{center:E.toLngLat(),elevation:y,zoom:X,pitch:de,bearing:ne}}calculateCameraOptionsFromCameraLngLatAltRotation(l,f,m,y,B){const E=this.transform.calculateCenterFromCameraLngLatAlt(l,f,m,y);return{center:E.center,elevation:E.elevation,zoom:E.zoom,bearing:m,pitch:y,roll:B}}easeTo(l,f){this._stop(!1,l.easeId),((l=o.e({offset:[0,0],duration:500,easing:o.co},l)).animate===!1||!l.essential&&C.prefersReducedMotion)&&(l.duration=0);const m=this._getTransformForUpdate(),y=this.getBearing(),B=m.pitch,E=m.roll,R="bearing"in l?this._normalizeBearing(l.bearing,y):y,O="pitch"in l?+l.pitch:B,V="roll"in l?this._normalizeBearing(l.roll,E):E,G="padding"in l?l.padding:m.padding,J=o.P.convert(l.offset);let X,ne;l.around&&(X=o.S.convert(l.around),ne=m.locationToScreenPoint(X));const de={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Ee=this.cameraHelper.handleEaseTo(m,{bearing:R,pitch:O,roll:V,padding:G,around:X,aroundPoint:ne,offsetAsPoint:J,offset:l.offset,zoom:l.zoom,center:l.center});return this._rotating=this._rotating||y!==R,this._pitching=this._pitching||O!==B,this._rolling=this._rolling||V!==E,this._padding=!m.isPaddingEqual(G),this._zooming=this._zooming||Ee.isZooming,this._easeId=l.easeId,this._prepareEase(f,l.noMoveStart,de),this.terrain&&this._prepareElevation(Ee.elevationCenter),this._ease(Se=>{Ee.easeFunc(Se),this.terrain&&!l.freezeElevation&&this._updateElevation(Se),this._applyUpdatedTransform(m),this._fireMoveEvents(f)},Se=>{this.terrain&&l.freezeElevation&&this._finalizeElevation(),this._afterEase(f,Se)},l),this}_prepareEase(l,f,m={}){this._moving=!0,f||m.moving||this.fire(new o.l("movestart",l)),this._zooming&&!m.zooming&&this.fire(new o.l("zoomstart",l)),this._rotating&&!m.rotating&&this.fire(new o.l("rotatestart",l)),this._pitching&&!m.pitching&&this.fire(new o.l("pitchstart",l)),this._rolling&&!m.rolling&&this.fire(new o.l("rollstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&f!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(m-(f-(m*l+this._elevationStart))/(1-l)),this._elevationTarget=f}this.transform.setElevation(o.C.number(this._elevationStart,this._elevationTarget,l))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(l){if(!this.terrain&&l.elevation>=0&&l.pitch<=90)return{};const f=l.getCameraLngLat(),m=l.getCameraAltitude(),y=this.terrain?this.terrain.getElevationForLngLatZoom(f,l.zoom):0;if(m<y){const B=this.calculateCameraOptionsFromTo(f,y,l.center,l.elevation);return{pitch:B.pitch,zoom:B.zoom}}return{}}_applyUpdatedTransform(l){const f=[];if(f.push(y=>this._elevateCameraIfInsideTerrain(y)),this.transformCameraUpdate&&f.push(y=>this.transformCameraUpdate(y)),!f.length)return;const m=l.clone();for(const y of f){const B=m.clone(),{center:E,zoom:R,roll:O,pitch:V,bearing:G,elevation:J}=y(B);E&&B.setCenter(E),J!==void 0&&B.setElevation(J),R!==void 0&&B.setZoom(R),O!==void 0&&B.setRoll(O),V!==void 0&&B.setPitch(V),G!==void 0&&B.setBearing(G),m.apply(B)}this.transform.apply(m)}_fireMoveEvents(l){this.fire(new o.l("move",l)),this._zooming&&this.fire(new o.l("zoom",l)),this._rotating&&this.fire(new o.l("rotate",l)),this._pitching&&this.fire(new o.l("pitch",l)),this._rolling&&this.fire(new o.l("roll",l))}_afterEase(l,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const m=this._zooming,y=this._rotating,B=this._pitching,E=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,m&&this.fire(new o.l("zoomend",l)),y&&this.fire(new o.l("rotateend",l)),B&&this.fire(new o.l("pitchend",l)),E&&this.fire(new o.l("rollend",l)),this.fire(new o.l("moveend",l))}flyTo(l,f){if(!l.essential&&C.prefersReducedMotion){const Ct=o.Q(l,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ct,f)}this.stop(),l=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.co},l);const m=this._getTransformForUpdate(),y=m.bearing,B=m.pitch,E=m.roll,R=m.padding,O="bearing"in l?this._normalizeBearing(l.bearing,y):y,V="pitch"in l?+l.pitch:B,G="roll"in l?this._normalizeBearing(l.roll,E):E,J="padding"in l?l.padding:m.padding,X=o.P.convert(l.offset);let ne=m.centerPoint.add(X);const de=m.screenPointToLocation(ne),Ee=this.cameraHelper.handleFlyTo(m,{bearing:O,pitch:V,roll:G,padding:J,locationAtOffset:de,offsetAsPoint:X,center:l.center,minZoom:l.minZoom,zoom:l.zoom});let Se=l.curve;const Ie=Math.max(m.width,m.height),Oe=Ie/Ee.scaleOfZoom,je=Ee.pixelPathLength;typeof Ee.scaleOfMinZoom=="number"&&(Se=Math.sqrt(Ie/Ee.scaleOfMinZoom/je*2));const De=Se*Se;function $e(Ct){const Zt=(Oe*Oe-Ie*Ie+(Ct?-1:1)*De*De*je*je)/(2*(Ct?Oe:Ie)*De*je);return Math.log(Math.sqrt(Zt*Zt+1)-Zt)}function Je(Ct){return(Math.exp(Ct)-Math.exp(-Ct))/2}function Qe(Ct){return(Math.exp(Ct)+Math.exp(-Ct))/2}const at=$e(!1);let Mt=function(Ct){return Qe(at)/Qe(at+Se*Ct)},yt=function(Ct){return Ie*((Qe(at)*(Je(Zt=at+Se*Ct)/Qe(Zt))-Je(at))/De)/je;var Zt},bt=($e(!0)-at)/Se;if(Math.abs(je)<2e-6||!isFinite(bt)){if(Math.abs(Ie-Oe)<1e-6)return this.easeTo(l,f);const Ct=Oe<Ie?-1:1;bt=Math.abs(Math.log(Oe/Ie))/Se,yt=()=>0,Mt=Zt=>Math.exp(Ct*Se*Zt)}return l.duration="duration"in l?+l.duration:1e3*bt/("screenSpeed"in l?+l.screenSpeed/Se:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=y!==O,this._pitching=V!==B,this._rolling=G!==E,this._padding=!m.isPaddingEqual(J),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(Ee.targetCenter),this._ease(Ct=>{const Zt=Ct*bt,rr=1/Mt(Zt),$t=yt(Zt);this._rotating&&m.setBearing(o.C.number(y,O,Ct)),this._pitching&&m.setPitch(o.C.number(B,V,Ct)),this._rolling&&m.setRoll(o.C.number(E,G,Ct)),this._padding&&(m.interpolatePadding(R,J,Ct),ne=m.centerPoint.add(X)),Ee.easeFunc(Ct,rr,$t,ne),this.terrain&&!l.freezeElevation&&this._updateElevation(Ct),this._applyUpdatedTransform(m),this._fireMoveEvents(f)},()=>{this.terrain&&l.freezeElevation&&this._finalizeElevation(),this._afterEase(f)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,f){var m;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,f)}return l||(m=this.handlers)===null||m===void 0||m.stop(!1),this}_ease(l,f,m){m.animate===!1||m.duration===0?(l(1),f()):(this._easeStart=M(),this._easeOptions=m,this._onEaseFrame=l,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,f){l=o.aO(l,-180,180);const m=Math.abs(l-f);return Math.abs(l-360-f)<m&&(l-=360),Math.abs(l+360-f)<m&&(l+=360),l}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(o.S.convert(l),this.transform.tileZoom):null}}const di={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class jn{constructor(l=di){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=P.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=P.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=P.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,f){const m=this._map._getUIString(`AttributionControl.${f}`);l.title=m,l.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(y=>typeof y!="string"?"":y)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const f=this._map.style.sourceCaches;for(const y in f){const B=f[y];if(B.used||B.usedForTerrain){const E=B.getSource();E.attribution&&l.indexOf(E.attribution)<0&&l.push(E.attribution)}}l=l.filter(y=>String(y).trim()),l.sort((y,B)=>y.length-B.length),l=l.filter((y,B)=>{for(let E=B+1;E<l.length;E++)if(l[E].indexOf(y)>=0)return!1;return!0});const m=l.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,l.length?(this._innerContainer.innerHTML=P.sanitize(m),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class es{constructor(l={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const m=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=P.create("div","maplibregl-ctrl");const f=P.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){P.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ci{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f}remove(l){const f=this._currentlyRunning,m=f?this._queue.concat(f):this._queue;for(const y of m)if(y.id===l)return void(y.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const m of f)if(!m.cancelled&&(m.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var $i=o.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Ri extends o.E{constructor(l){super(),this._lastTilesetChange=M(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=l._source.tileSize*2**this.deltaZoom,l.usedForTerrain=!0,l.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,f){this.sourceCache.update(l,f),this._renderableTilesKeys=[];const m={};for(const y of yr(l,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))m[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.terrainRttPosMatrix32f=new Float64Array(16),o.bZ(y.terrainRttPosMatrix32f,0,o.$,o.$,0,0,1),this._tiles[y.key]=new ae(y,this.tileSize),this._lastTilesetChange=M());for(const y in this._tiles)m[y]||delete this._tiles[y]}freeRtt(l){for(const f in this._tiles){const m=this._tiles[f];(!l||m.tileID.equals(l)||m.tileID.isChildOf(l)||l.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l,f){return f?this._getTerrainCoordsForTileRanges(l,f):this._getTerrainCoordsForRegularTile(l)}_getTerrainCoordsForRegularTile(l){const f={};for(const m of this._renderableTilesKeys){const y=this._tiles[m].tileID,B=l.clone(),E=o.ba();if(y.canonical.equals(l.canonical))o.bZ(E,0,o.$,o.$,0,0,1);else if(y.canonical.isChildOf(l.canonical)){const R=y.canonical.z-l.canonical.z,O=y.canonical.x-(y.canonical.x>>R<<R),V=y.canonical.y-(y.canonical.y>>R<<R),G=o.$>>R;o.bZ(E,0,G,G,0,0,1),o.M(E,E,[-O*G,-V*G,0])}else{if(!l.canonical.isChildOf(y.canonical))continue;{const R=l.canonical.z-y.canonical.z,O=l.canonical.x-(l.canonical.x>>R<<R),V=l.canonical.y-(l.canonical.y>>R<<R),G=o.$>>R;o.bZ(E,0,o.$,o.$,0,0,1),o.M(E,E,[O*G,V*G,0]),o.N(E,E,[1/2**R,1/2**R,0])}}B.terrainRttPosMatrix32f=new Float32Array(E),f[m]=B}return f}_getTerrainCoordsForTileRanges(l,f){const m={};for(const y of this._renderableTilesKeys){const B=this._tiles[y].tileID;if(!this._isWithinTileRanges(B,f))continue;const E=l.clone(),R=o.ba();if(B.canonical.z===l.canonical.z){const O=l.canonical.x-B.canonical.x,V=l.canonical.y-B.canonical.y;o.bZ(R,0,o.$,o.$,0,0,1),o.M(R,R,[O*o.$,V*o.$,0])}else if(B.canonical.z>l.canonical.z){const O=B.canonical.z-l.canonical.z,V=B.canonical.x-(B.canonical.x>>O<<O),G=B.canonical.y-(B.canonical.y>>O<<O),J=l.canonical.x-(B.canonical.x>>O),X=l.canonical.y-(B.canonical.y>>O),ne=o.$>>O;o.bZ(R,0,ne,ne,0,0,1),o.M(R,R,[-V*ne+J*o.$,-G*ne+X*o.$,0])}else{const O=l.canonical.z-B.canonical.z,V=l.canonical.x-(l.canonical.x>>O<<O),G=l.canonical.y-(l.canonical.y>>O<<O),J=(l.canonical.x>>O)-B.canonical.x,X=(l.canonical.y>>O)-B.canonical.y,ne=o.$<<O;o.bZ(R,0,ne,ne,0,0,1),o.M(R,R,[V*o.$+J*ne,G*o.$+X*ne,0])}E.terrainRttPosMatrix32f=new Float32Array(R),m[y]=E}return m}getSourceTile(l,f){const m=this.sourceCache._source;let y=l.overscaledZ-this.deltaZoom;if(y>m.maxzoom&&(y=m.maxzoom),y<m.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(y).key);let B=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!B||!B.dem)&&f)for(;y>=m.minzoom&&(!B||!B.dem);)B=this.sourceCache.getTileByID(l.scaledTo(y--).key);return B}anyTilesAfterTime(l=Date.now()){return this._lastTilesetChange>=l}_isWithinTileRanges(l,f){return f[l.canonical.z]&&l.canonical.x>=f[l.canonical.z].minTileX&&l.canonical.x<=f[l.canonical.z].maxTileX&&l.canonical.y>=f[l.canonical.z].minTileY&&l.canonical.y<=f[l.canonical.z].maxTileY}}class ai{constructor(l,f,m){this._meshCache={},this.painter=l,this.sourceCache=new Ri(f),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,f,m,y=o.$){var B;if(!(f>=0&&f<y&&m>=0&&m<y))return 0;const E=this.getTerrainData(l),R=(B=E.tile)===null||B===void 0?void 0:B.dem;if(!R)return 0;const O=o.cs([],[f/y*o.$,m/y*o.$],E.u_terrain_matrix),V=[O[0]*R.dim,O[1]*R.dim],G=Math.floor(V[0]),J=Math.floor(V[1]),X=V[0]-G,ne=V[1]-J;return R.get(G,J)*(1-X)*(1-ne)+R.get(G+1,J)*X*(1-ne)+R.get(G,J+1)*(1-X)*ne+R.get(G+1,J+1)*X*ne}getElevationForLngLatZoom(l,f){if(!o.ct(f,l.wrap()))return 0;const{tileID:m,mercatorX:y,mercatorY:B}=this._getOverscaledTileIDFromLngLatZoom(l,f);return this.getElevation(m,y%o.$,B%o.$,o.$)}getElevation(l,f,m,y=o.$){return this.getDEMElevation(l,f,m,y)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const y=this.painter.context,B=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(y,B,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(y,new o.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ai([])}const f=this.sourceCache.getSourceTile(l,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const y=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new o.T(y,f.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),f.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const m=f&&f+f.tileID.key+l.key;if(m&&!this._demMatrixCache[m]){const y=this.sourceCache.sourceCache._source.maxzoom;let B=l.canonical.z-f.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=y?B=l.canonical.z-y:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=l.canonical.x-(l.canonical.x>>B<<B),R=l.canonical.y-(l.canonical.y>>B<<B),O=o.cu(new Float64Array(16),[1/(o.$<<B),1/(o.$<<B),0]);o.M(O,O,[E*o.$,R*o.$,0]),this._demMatrixCache[l.key]={matrix:O,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(l){const f=this.painter,m=f.width/devicePixelRatio,y=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(f.context,{width:m,height:y,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(f.context,{width:m,height:y,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(m,y,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,m,y))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let B=0,E=0;B<this._coordsTextureSize;B++)for(let R=0;R<this._coordsTextureSize;R++,E+=4)f[E+0]=255&R,f[E+1]=255&B,f[E+2]=R>>8<<4|B>>8,f[E+3]=0;const m=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),y=new o.T(l,m,l.gl.RGBA,{premultiply:!1});return y.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),m=this.painter.context,y=m.gl,B=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),R=Math.round(this.painter.height/devicePixelRatio);m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(B,R-E-1,1,1,y.RGBA,y.UNSIGNED_BYTE,f),m.bindFramebuffer.set(null);const O=f[0]+(f[2]>>4<<8),V=f[1]+((15&f[2])<<8),G=this.coordsIndex[255-f[3]],J=G&&this.sourceCache.getTileByID(G);if(!J)return null;const X=this._coordsTextureSize,ne=(1<<J.tileID.canonical.z)*X;return new o.a1((J.tileID.canonical.x*X+O)/ne+J.tileID.wrap,(J.tileID.canonical.y*X+V)/ne,this.getElevation(J.tileID,O,V,X))}depthAtPoint(l){const f=new Uint8Array(4),m=this.painter.context,y=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,f),m.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(l){var f;const m=((f=this.painter.style.projection)===null||f===void 0?void 0:f.transitionState)>0,y=m&&l.canonical.y===0,B=m&&l.canonical.y===(1<<l.canonical.z)-1,E=`m_${y?"n":""}_${B?"s":""}`;if(this._meshCache[E])return this._meshCache[E];const R=this.painter.context,O=new o.cv,V=new o.aN,G=this.meshSize,J=o.$/G,X=G*G;for(let Qe=0;Qe<=G;Qe++)for(let at=0;at<=G;at++)O.emplaceBack(at*J,Qe*J,0);for(let Qe=0;Qe<X;Qe+=G+1)for(let at=0;at<G;at++)V.emplaceBack(at+Qe,G+at+Qe+1,G+at+Qe+2),V.emplaceBack(at+Qe,G+at+Qe+2,at+Qe+1);const ne=O.length,de=ne+(G+1),Ee=(G+1)*G,Se=y?o.bh:0,Ie=y?0:1,Oe=B?o.bi:o.$,je=B?0:1;for(let Qe=0;Qe<=G;Qe++)O.emplaceBack(Qe*J,Se,Ie);for(let Qe=0;Qe<=G;Qe++)O.emplaceBack(Qe*J,Oe,je);for(let Qe=0;Qe<G;Qe++)V.emplaceBack(Ee+Qe,de+Qe,de+Qe+1),V.emplaceBack(Ee+Qe,de+Qe+1,Ee+Qe+1),V.emplaceBack(0+Qe,ne+Qe+1,ne+Qe),V.emplaceBack(0+Qe,0+Qe+1,ne+Qe+1);const De=O.length,$e=De+2*(G+1);for(const Qe of[0,1])for(let at=0;at<=G;at++)for(const Mt of[0,1])O.emplaceBack(Qe*o.$,at*J,Mt);for(let Qe=0;Qe<2*G;Qe+=2)V.emplaceBack(De+Qe,De+Qe+1,De+Qe+3),V.emplaceBack(De+Qe,De+Qe+3,De+Qe+2),V.emplaceBack($e+Qe,$e+Qe+3,$e+Qe+1),V.emplaceBack($e+Qe,$e+Qe+2,$e+Qe+3);const Je=new Hs(R.createVertexBuffer(O,$i.members),R.createIndexBuffer(V),o.aM.simpleSegment(0,0,O.length,V.length));return this._meshCache[E]=Je,Je}getMeshFrameDelta(l){return 2*Math.PI*o.bu/Math.pow(2,Math.max(l,0))/5}getMinTileElevationForLngLatZoom(l,f){var m;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(l,f);return(m=this.getMinMaxElevation(y).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(l){const f=this.getTerrainData(l).tile,m={minElevation:null,maxElevation:null};return f&&f.dem&&(m.minElevation=f.dem.min*this.exaggeration,m.maxElevation=f.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(l,f){const m=o.a1.fromLngLat(l.wrap()),y=(1<<f)*o.$,B=m.x*y,E=m.y*y,R=Math.floor(B/o.$),O=Math.floor(E/o.$);return{tileID:new o.Z(f,0,f,R,O),mercatorX:B,mercatorY:E}}}class ms{constructor(l,f,m){this._context=l,this._size=f,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(m.texture),{id:l,fbo:f,texture:m,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>l.id!==f),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const Ms={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Eo{constructor(l,f){this.painter=l,this.terrain=f,this.pool=new ms(l.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(m=>!l._layers[m].isHidden(f)),this._coordsAscending={};for(const m in l.sourceCaches){this._coordsAscending[m]={};const y=l.sourceCaches[m].getVisibleCoordinates(),B=l.sourceCaches[m].getSource(),E=B instanceof ar?B.terrainTileRanges:null;for(const R of y){const O=this.terrain.sourceCache.getTerrainCoords(R,E);for(const V in O)this._coordsAscending[m][V]||(this._coordsAscending[m][V]=[]),this._coordsAscending[m][V].push(O[V])}}this._coordsAscendingStr={};for(const m of l._order){const y=l._layers[m],B=y.source;if(Ms[y.type]&&!this._coordsAscendingStr[B]){this._coordsAscendingStr[B]={};for(const E in this._coordsAscending[B])this._coordsAscendingStr[B][E]=this._coordsAscending[B][E].map(R=>R.key).sort().join()}}for(const m of this._renderableTiles)for(const y in this._coordsAscendingStr){const B=this._coordsAscendingStr[y][m.tileID.key];B&&B!==m.rttCoords[y]&&(m.rtt=[])}}renderLayer(l,f){if(l.isHidden(this.painter.transform.zoom))return!1;const m=Object.assign(Object.assign({},f),{isRenderingToTexture:!0}),y=l.type,B=this.painter,E=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(Ms[y]&&(this._prevType&&Ms[this._prevType]||this._stacks.push([]),this._prevType=y,this._stacks[this._stacks.length-1].push(l.id),!E))return!0;if(Ms[this._prevType]||Ms[y]&&E){this._prevType=y;const R=this._stacks.length-1,O=this._stacks[R]||[];for(const V of this._renderableTiles){if(this.pool.isFull()&&($d(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(V),V.rtt[R]){const J=this.pool.getObjectForId(V.rtt[R].id);if(J.stamp===V.rtt[R].stamp){this.pool.useObject(J);continue}}const G=this.pool.getOrCreateFreeObject();this.pool.useObject(G),this.pool.stampObject(G),V.rtt[R]={id:G.id,stamp:G.stamp},B.context.bindFramebuffer.set(G.fbo.framebuffer),B.context.clear({color:o.bf.transparent,stencil:0}),B.currentStencilSource=void 0;for(let J=0;J<O.length;J++){const X=B.style._layers[O[J]],ne=X.source?this._coordsAscending[X.source][V.tileID.key]:[V.tileID];B.context.viewport.set([0,0,G.fbo.width,G.fbo.height]),B._renderTileClippingMasks(X,ne,!0),B.renderLayer(B,B.style.sourceCaches[X.source],X,ne,m),X.source&&(V.rttCoords[X.source]=this._coordsAscendingStr[X.source][V.tileID.key])}}return $d(this.painter,this.terrain,this._rttTiles,m),this._rttTiles=[],this.pool.freeAllObjects(),Ms[y]}return!1}}const $s={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Rn=u,Ln={hash:!1,interactive:!0,bearingSnap:7,attributionControl:di,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Qo={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Yn{constructor(l,f,m=!1){this.mousedown=B=>{this.startMove(B,P.mousePos(this.element,B)),P.addEventListener(window,"mousemove",this.mousemove),P.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=B=>{this.move(B,P.mousePos(this.element,B))},this.mouseup=B=>{this._rotatePitchHandler.dragEnd(B),this.offTemp()},this.touchstart=B=>{B.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=P.touchPos(this.element,B.targetTouches)[0],this.startMove(B,this._startPos),P.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.addEventListener(window,"touchend",this.touchend))},this.touchmove=B=>{B.targetTouches.length!==1?this.reset():(this._lastPos=P.touchPos(this.element,B.targetTouches)[0],this.move(B,this._lastPos))},this.touchend=B=>{B.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=f;const y=new ft;this._rotatePitchHandler=new we({clickTolerance:3,move:(B,E)=>{const R=f.getBoundingClientRect(),O=new o.P((R.bottom-R.top)/2,(R.right-R.left)/2);return{bearingDelta:o.cn(new o.P(B.x,E.y),E,O),pitchDelta:m?-.5*(E.y-B.y):void 0}},moveStateManager:y,enable:!0,assignEvents:()=>{}}),this.map=l,P.addEventListener(f,"mousedown",this.mousedown),P.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),P.addEventListener(f,"touchcancel",this.reset)}startMove(l,f){this._rotatePitchHandler.dragStart(l,f),P.disableDrag()}move(l,f){const m=this.map,{bearingDelta:y,pitchDelta:B}=this._rotatePitchHandler.dragMove(l,f)||{};y&&m.setBearing(m.getBearing()+y),B&&m.setPitch(m.getPitch()+B)}off(){const l=this.element;P.removeEventListener(l,"mousedown",this.mousedown),P.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend),P.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){P.enableDrag(),P.removeEventListener(window,"mousemove",this.mousemove),P.removeEventListener(window,"mouseup",this.mouseup),P.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),P.removeEventListener(window,"touchend",this.touchend)}}let Gi;function Ho(v,l,f,m=!1){if(m||!f.getCoveringTilesDetailsProvider().allowWorldCopies())return v?.wrap();const y=new o.S(v.lng,v.lat);if(v=new o.S(v.lng,v.lat),l){const B=new o.S(v.lng-360,v.lat),E=new o.S(v.lng+360,v.lat),R=f.locationToScreenPoint(v).distSqr(l);f.locationToScreenPoint(B).distSqr(l)<R?v=B:f.locationToScreenPoint(E).distSqr(l)<R&&(v=E)}for(;Math.abs(v.lng-f.center.lng)>180;){const B=f.locationToScreenPoint(v);if(B.x>=0&&B.y>=0&&B.x<=f.width&&B.y<=f.height)break;v.lng>f.center.lng?v.lng-=360:v.lng+=360}return v.lng!==y.lng&&f.isPointOnMapSurface(f.locationToScreenPoint(v))?v:y}const Wa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ca(v,l,f){const m=v.classList;for(const y in Wa)m.remove(`maplibregl-${f}-anchor-${y}`);m.add(`maplibregl-${f}-anchor-${l}`)}class zi extends o.E{constructor(l){if(super(),this._onKeyPress=f=>{const m=f.code,y=f.charCode||f.keyCode;m!=="Space"&&m!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=f=>{const m=f.originalEvent.target,y=this._element;this._popup&&(m===y||y.contains(m))&&this.togglePopup()},this._update=f=>{if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();(f?.type==="terrain"||f?.type==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=Ho(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let B="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?B="rotateX(0deg)":this._pitchAlignment==="map"&&(B=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||f&&f.type!=="moveend"||(this._pos=this._pos.round()),P.setTransform(this._element,`${Wa[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${B} ${y}`),C.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._subpixelPositioning=l&&l.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(l?.opacity,l?.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=o.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=P.create("div");const f=P.createNS("http://www.w3.org/2000/svg","svg"),m=41,y=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${m}px`),f.setAttributeNS(null,"width",`${y}px`),f.setAttributeNS(null,"viewBox",`0 0 ${y} ${m}`);const B=P.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"stroke","none"),B.setAttributeNS(null,"stroke-width","1"),B.setAttributeNS(null,"fill","none"),B.setAttributeNS(null,"fill-rule","evenodd");const E=P.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const R=P.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const O=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ie of O){const Oe=P.createNS("http://www.w3.org/2000/svg","ellipse");Oe.setAttributeNS(null,"opacity","0.04"),Oe.setAttributeNS(null,"cx","10.5"),Oe.setAttributeNS(null,"cy","5.80029008"),Oe.setAttributeNS(null,"rx",Ie.rx),Oe.setAttributeNS(null,"ry",Ie.ry),R.appendChild(Oe)}const V=P.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"fill",this._color);const G=P.createNS("http://www.w3.org/2000/svg","path");G.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),V.appendChild(G);const J=P.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"opacity","0.25"),J.setAttributeNS(null,"fill","#000000");const X=P.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),J.appendChild(X);const ne=P.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ne.setAttributeNS(null,"fill","#FFFFFF");const de=P.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Ee=P.createNS("http://www.w3.org/2000/svg","circle");Ee.setAttributeNS(null,"fill","#000000"),Ee.setAttributeNS(null,"opacity","0.25"),Ee.setAttributeNS(null,"cx","5.5"),Ee.setAttributeNS(null,"cy","5.5"),Ee.setAttributeNS(null,"r","5.4999962");const Se=P.createNS("http://www.w3.org/2000/svg","circle");Se.setAttributeNS(null,"fill","#FFFFFF"),Se.setAttributeNS(null,"cx","5.5"),Se.setAttributeNS(null,"cy","5.5"),Se.setAttributeNS(null,"r","5.4999962"),de.appendChild(Ee),de.appendChild(Se),E.appendChild(R),E.appendChild(V),E.appendChild(J),E.appendChild(ne),E.appendChild(de),f.appendChild(E),f.setAttributeNS(null,"height",m*this._scale+"px"),f.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(f),this._offset=o.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),Ca(this._element,this._anchor,"marker"),l&&l.className)for(const f of l.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(l){return this.remove(),this._map=l,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",l._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),l.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),P.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=o.S.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const y=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(l){return this._subpixelPositioning=l,this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(l=!1){var f,m;const y=(f=this._map)===null||f===void 0?void 0:f.terrain,B=this._map.transform.isLocationOccluded(this._lngLat);if(!y||B){const ne=B?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==ne&&(this._element.style.opacity=ne))}if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const E=this._map,R=E.terrain.depthAtPoint(this._pos),O=E.terrain.getElevationForLngLatZoom(this._lngLat,E.transform.tileZoom);if(E.transform.lngLatToCameraDepth(this._lngLat,O)-R<.006)return void(this._element.style.opacity=this._opacity);const V=-this._offset.y/E.transform.pixelsPerMeter,G=Math.sin(E.getPitch()*Math.PI/180)*V,J=E.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),X=E.transform.lngLatToCameraDepth(this._lngLat,O+G)-J>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&X&&this._popup.remove(),this._element.style.opacity=X?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=o.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,f){return(this._opacity===void 0||l===void 0&&f===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const vh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ic=0,ml=!1;const Tu={maxWidth:100,unit:"metric"};function bf(v,l,f){const m=f&&f.maxWidth||100,y=v._container.clientHeight/2,B=v._container.clientWidth/2,E=v.unproject([B-m/2,y]),R=v.unproject([B+m/2,y]),O=Math.round(v.project(R).x-v.project(E).x),V=Math.min(m,O,v._container.clientWidth),G=E.distanceTo(R);if(f&&f.unit==="imperial"){const J=3.2808*G;J>5280?Eu(l,V,J/5280,v._getUIString("ScaleControl.Miles")):Eu(l,V,J,v._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?Eu(l,V,G/1852,v._getUIString("ScaleControl.NauticalMiles")):G>=1e3?Eu(l,V,G/1e3,v._getUIString("ScaleControl.Kilometers")):Eu(l,V,G,v._getUIString("ScaleControl.Meters"))}function Eu(v,l,f,m){const y=function(B){const E=Math.pow(10,`${Math.floor(B)}`.length-1);let R=B/E;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(O){const V=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*V)/V}(R),E*R}(f);v.style.width=l*(y/f)+"px",v.innerHTML=`${y}&nbsp;${m}`}const yA={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},_l=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function vf(v){if(v){if(typeof v=="number"){const l=Math.round(Math.abs(v)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,v),"top-left":new o.P(l,l),"top-right":new o.P(-l,l),bottom:new o.P(0,-v),"bottom-left":new o.P(l,-l),"bottom-right":new o.P(-l,-l),left:new o.P(v,0),right:new o.P(-v,0)}}if(v instanceof o.P||Array.isArray(v)){const l=o.P.convert(v);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:o.P.convert(v.center||[0,0]),top:o.P.convert(v.top||[0,0]),"top-left":o.P.convert(v["top-left"]||[0,0]),"top-right":o.P.convert(v["top-right"]||[0,0]),bottom:o.P.convert(v.bottom||[0,0]),"bottom-left":o.P.convert(v["bottom-left"]||[0,0]),"bottom-right":o.P.convert(v["bottom-right"]||[0,0]),left:o.P.convert(v.left||[0,0]),right:o.P.convert(v.right||[0,0])}}return vf(new o.P(0,0))}const wf=u;a.AJAXError=o.cz,a.Event=o.l,a.Evented=o.E,a.LngLat=o.S,a.MercatorCoordinate=o.a1,a.Point=o.P,a.addProtocol=o.cA,a.config=o.a,a.removeProtocol=o.cB,a.AttributionControl=jn,a.BoxZoomHandler=$,a.CanvasSource=vr,a.CooperativeGesturesHandler=Pi,a.DoubleClickZoomHandler=cn,a.DragPanHandler=oi,a.DragRotateHandler=ps,a.EdgeInsets=Qr,a.FullscreenControl=class extends o.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var l;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=f?.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){P.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=P.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);P.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},a.GeoJSONSource=Br,a.GeolocateControl=class extends o.E{constructor(v){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",l)),this._finish()}},this._updateCamera=l=>{const f=new o.S(l.coords.longitude,l.coords.latitude),m=l.coords.accuracy,y=this._map.getBearing(),B=o.e({bearing:y},this.options.fitBoundsOptions),E=Re.fromLngLat(f,m);this._map.fitBounds(E,B,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const f=new o.S(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=l.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=l=>{if(this._map){if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&ml)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=P.create("button","maplibregl-ctrl-geolocate",this._container),P.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=l=>{if(this._map){if(l===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=P.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new zi({element:this._dotElement}),this._circleElement=P.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{const m=f?.[0]instanceof ResizeObserverEntry;f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||m||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))})}},this.options=o.e({},vh,v)}onAdd(v){return this._map=v,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return o._(this,arguments,void 0,function*(l=!1){if(Gi!==void 0&&!l)return Gi;if(window.navigator.permissions===void 0)return Gi=!!window.navigator.geolocation,Gi;try{Gi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Gi=!!window.navigator.geolocation}return Gi})}().then(l=>this._finishSetupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),P.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Ic=0,ml=!1}_isOutOfMapMaxBounds(v){const l=this._map.getMaxBounds(),f=v.coords;return l&&(f.longitude<l.getWest()||f.longitude>l.getEast()||f.latitude<l.getSouth()||f.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const v=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&v))return;const l=this._map.project(v),f=this._map.unproject([l.x+100,l.y]),m=v.distanceTo(f)/100,y=2*this._accuracy/m;this._circleElement.style.width=`${y.toFixed(2)}px`,this._circleElement.style.height=`${y.toFixed(2)}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ic--,ml=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ic++,Ic>1?(v={maximumAge:6e5,timeout:0},ml=!0):(v=this.options.positionOptions,ml=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},a.GlobeControl=class{constructor(){this._toggleProjection=()=>{var v;const l=(v=this._map.getProjection())===null||v===void 0?void 0:v.type;this._map.setProjection(l!=="mercator"&&l?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var v;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((v=this._map.getProjection())===null||v===void 0?void 0:v.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(v){return this._map=v,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=P.create("button","maplibregl-ctrl-globe",this._container),P.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){P.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},a.Hash=gl,a.ImageSource=ar,a.KeyboardHandler=Fn,a.LngLatBounds=Re,a.LogoControl=es,a.Map=class extends br{constructor(v){var l,f;o.cw.mark(o.cx.create);const m=Object.assign(Object.assign(Object.assign({},Ln),v),{canvasContextAttributes:Object.assign(Object.assign({},Ln.canvasContextAttributes),v.canvasContextAttributes)});if(m.minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const y=new As,B=new Kn;if(m.minZoom!==void 0&&y.setMinZoom(m.minZoom),m.maxZoom!==void 0&&y.setMaxZoom(m.maxZoom),m.minPitch!==void 0&&y.setMinPitch(m.minPitch),m.maxPitch!==void 0&&y.setMaxPitch(m.maxPitch),m.renderWorldCopies!==void 0&&y.setRenderWorldCopies(m.renderWorldCopies),m.transformConstrain!==null&&y.setConstrain(m.transformConstrain),super(y,B,{bearingSnap:m.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ci,this._controls=[],this._mapId=o.a7(),this._contextLost=R=>{R.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.l("webglcontextlost",{originalEvent:R}))},this._contextRestored=R=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:R}))},this._onMapScroll=R=>{if(R.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._maxTileCacheZoomLevels=m.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},m.canvasContextAttributes),this._trackResize=m.trackResize===!0,this._bearingSnap=m.bearingSnap,this._centerClampedToGround=m.centerClampedToGround,this._refreshExpiredTiles=m.refreshExpiredTiles===!0,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions===!0,this._collectResourceTiming=m.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},$s),m.locale),this._clickTolerance=m.clickTolerance,this._overridePixelRatio=m.pixelRatio,this._maxCanvasSize=m.maxCanvasSize,this.transformCameraUpdate=m.transformCameraUpdate,this.transformConstrain=m.transformConstrain,this.cancelPendingTileRequestsWhileZooming=m.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=W.addThrottleControl(()=>this.isMoving()),this._requestManager=new ie(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let R=!1;const O=Cu(V=>{this._trackResize&&!this._removed&&(this.resize(V),this.redraw())},50);this._resizeObserver=new ResizeObserver(V=>{R?O(V):R=!0}),this._resizeObserver.observe(this._container)}this.handlers=new or(this,m),this._hash=m.hash&&new gl(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,elevation:m.elevation,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,roll:m.roll}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,o.e({},m.fitBoundsOptions,{duration:0}))));const E=typeof m.style=="string"||((f=(l=m.style)===null||l===void 0?void 0:l.projection)===null||f===void 0?void 0:f.type)!=="globe";this.resize(null,E),this._localIdeographFontFamily=m.localIdeographFontFamily,this._validateStyle=m.validateStyle,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new jn(typeof m.attributionControl=="boolean"?void 0:m.attributionControl)),m.maplibreLogo&&this.addControl(new es,m.logoPosition),this.on("style.load",()=>{if(E||this._resizeTransform(),this.transform.unmodified){const R=o.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(R)}}),this.on("data",R=>{this._update(R.dataType==="style"),this.fire(new o.l(`${R.dataType}data`,R))}),this.on("dataloading",R=>{this.fire(new o.l(`${R.dataType}dataloading`,R))}),this.on("dataabort",R=>{this.fire(new o.l("sourcedataabort",R))})}_getMapId(){return this._mapId}setGlobalStateProperty(v,l){return this.style.setGlobalStateProperty(v,l),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(v,l){if(l===void 0&&(l=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=v.onAdd(this);this._controls.push(v);const m=this._controlPositions[l];return l.indexOf("bottom")!==-1?m.insertBefore(f,m.firstChild):m.appendChild(f),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(v);return l>-1&&this._controls.splice(l,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}coveringTiles(v){return yr(this.transform,v)}calculateCameraOptionsFromTo(v,l,f,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(v,l,f,m)}resize(v,l=!0){const[f,m]=this._containerDimensions(),y=this._getClampedPixelRatio(f,m);if(this._resizeCanvas(f,m,y),this.painter.resize(f,m,y),this.painter.overLimit()){const E=this.painter.context.gl;this._maxCanvasSize=[E.drawingBufferWidth,E.drawingBufferHeight];const R=this._getClampedPixelRatio(f,m);this._resizeCanvas(f,m,R),this.painter.resize(f,m,R)}this._resizeTransform(l);const B=!this._moving;return B&&(this.stop(),this.fire(new o.l("movestart",v)).fire(new o.l("move",v))),this.fire(new o.l("resize",v)),B&&this.fire(new o.l("moveend",v)),this}_resizeTransform(v=!0){var l;const[f,m]=this._containerDimensions();this.transform.resize(f,m,v),(l=this._requestedCameraState)===null||l===void 0||l.resize(f,m,v)}_getClampedPixelRatio(v,l){const{0:f,1:m}=this._maxCanvasSize,y=this.getPixelRatio(),B=v*y,E=l*y;return Math.min(B>f?f/B:1,E>m?m/E:1)*y}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(Re.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.setMinZoom(v),this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.setMaxZoom(v),this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.setMinPitch(v),this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(v>=this.transform.minPitch)return this.transform.setMaxPitch(v),this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.setRenderWorldCopies(v),this._update()}setTransformConstrain(v){return this.transform.setConstrain(v),this._update()}project(v){return this.transform.locationToScreenPoint(o.S.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.screenPointToLocation(o.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,l,f){if(v==="mouseenter"||v==="mouseover"){let m=!1;return{layers:l,listener:f,delegates:{mousemove:B=>{const E=l.filter(O=>this.getLayer(O)),R=E.length!==0?this.queryRenderedFeatures(B.point,{layers:E}):[];R.length?m||(m=!0,f.call(this,new Vs(v,this,B.originalEvent,{features:R}))):m=!1},mouseout:()=>{m=!1}}}}if(v==="mouseleave"||v==="mouseout"){let m=!1;return{layers:l,listener:f,delegates:{mousemove:E=>{const R=l.filter(O=>this.getLayer(O));(R.length!==0?this.queryRenderedFeatures(E.point,{layers:R}):[]).length?m=!0:m&&(m=!1,f.call(this,new Vs(v,this,E.originalEvent)))},mouseout:E=>{m&&(m=!1,f.call(this,new Vs(v,this,E.originalEvent)))}}}}{const m=y=>{const B=l.filter(R=>this.getLayer(R)),E=B.length!==0?this.queryRenderedFeatures(y.point,{layers:B}):[];E.length&&(y.features=E,f.call(this,y),delete y.features)};return{layers:l,listener:f,delegates:{[v]:m}}}}_saveDelegatedListener(v,l){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(l)}_removeDelegatedListener(v,l,f){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const m=this._delegatedListeners[v];for(let y=0;y<m.length;y++){const B=m[y];if(B.listener===f&&B.layers.length===l.length&&B.layers.every(E=>l.includes(E))){for(const E in B.delegates)this.off(E,B.delegates[E]);return void m.splice(y,1)}}}on(v,l,f){if(f===void 0)return super.on(v,l);const m=typeof l=="string"?[l]:l,y=this._createDelegatedListener(v,m,f);this._saveDelegatedListener(v,y);for(const B in y.delegates)this.on(B,y.delegates[B]);return{unsubscribe:()=>{this._removeDelegatedListener(v,m,f)}}}once(v,l,f){if(f===void 0)return super.once(v,l);const m=typeof l=="string"?[l]:l,y=this._createDelegatedListener(v,m,f);for(const B in y.delegates){const E=y.delegates[B];y.delegates[B]=(...R)=>{this._removeDelegatedListener(v,m,f),E(...R)}}this._saveDelegatedListener(v,y);for(const B in y.delegates)this.once(B,y.delegates[B]);return this}off(v,l,f){return f===void 0?super.off(v,l):(this._removeDelegatedListener(v,typeof l=="string"?[l]:l,f),this)}queryRenderedFeatures(v,l){if(!this.style)return[];let f;const m=v instanceof o.P||Array.isArray(v),y=m?v:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(m?{}:v)||{},y instanceof o.P||typeof y[0]=="number")f=[o.P.convert(y)];else{const B=o.P.convert(y[0]),E=o.P.convert(y[1]);f=[B,new o.P(E.x,B.y),E,new o.P(B.x,E.y),B]}return this.style.queryRenderedFeatures(f,l,this.transform)}querySourceFeatures(v,l){return this.style.querySourceFeatures(v,l)}setStyle(v,l){return(l=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(v,l))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const l=this._locale[v];if(l==null)throw new Error(`Missing UI string '${v}'`);return l}_updateStyle(v,l){var f,m;if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(v,l));const y=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new ba(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,l,y):this.style.loadJSON(v,l,y),this):((m=(f=this.style)===null||f===void 0?void 0:f.projection)===null||m===void 0||m.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ba(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,l){if(typeof v=="string"){const f=this._requestManager.transformRequest(v,"Style");o.j(f,new AbortController).then(m=>{this._updateDiff(m.data,l)}).catch(m=>{m&&this.fire(new o.k(m))})}else typeof v=="object"&&this._updateDiff(v,l)}_updateDiff(v,l){try{this.style.setState(v,l)&&this._update(!0)}catch(f){o.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(v,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(v,l){return this._lazyInitEmptyStyle(),this.style.addSource(v,l),this._update(!0)}isSourceLoaded(v){const l=this.style&&this.style.sourceCaches[v];if(l!==void 0)return l.loaded();this.fire(new o.k(new Error(`There is no source with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const l=this.style.sourceCaches[v.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&l.reload();for(const f in this.style._layers){const m=this.style._layers[f];m.type==="hillshade"&&m.source===v.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),m.type==="color-relief"&&m.source===v.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ai(this.painter,l,v),this.painter.renderToTexture=new Eo(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=f=>{var m;f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==v.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((m=f.source)===null||m===void 0?void 0:m.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:v})),this}getTerrain(){var v,l;return(l=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const v=this.style&&this.style.sourceCaches;for(const l in v){const f=v[l]._tiles;for(const m in f){const y=f[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}setSourceTileLodParams(v,l,f){if(f){const m=this.getSource(f);if(!m)throw new Error(`There is no source with ID "${f}", cannot set LOD parameters`);m.calculateTileZoom=Ze(Math.max(1,v),Math.max(1,l))}else for(const m in this.style.sourceCaches)this.style.sourceCaches[m].getSource().calculateTileZoom=Ze(Math.max(1,v),Math.max(1,l));return this._update(!0),this}refreshTiles(v,l){const f=this.style.sourceCaches[v];if(!f)throw new Error(`There is no source cache with ID "${v}", cannot refresh tile`);l===void 0?f.reload(!0):f.refreshTiles(l.map(m=>new o.a4(m.z,m.x,m.y)))}addImage(v,l,f={}){const{pixelRatio:m=1,sdf:y=!1,stretchX:B,stretchY:E,content:R,textFitWidth:O,textFitHeight:V}=f;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||o.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:G,height:J,data:X}=l,ne=l;return this.style.addImage(v,{data:new o.R({width:G,height:J},new Uint8Array(X)),pixelRatio:m,stretchX:B,stretchY:E,content:R,textFitWidth:O,textFitHeight:V,sdf:y,version:0,userImage:ne}),ne.onAdd&&ne.onAdd(this,v),this}}{const{width:G,height:J,data:X}=C.getImageData(l);this.style.addImage(v,{data:new o.R({width:G,height:J},X),pixelRatio:m,stretchX:B,stretchY:E,content:R,textFitWidth:O,textFitHeight:V,sdf:y,version:0})}}updateImage(v,l){const f=this.style.getImage(v);if(!f)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=l instanceof HTMLImageElement||o.b(l)?C.getImageData(l):l,{width:y,height:B,data:E}=m;if(y===void 0||B===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==f.data.width||B!==f.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(l instanceof HTMLImageElement||o.b(l));return f.data.replace(E,R),this.style.updateImage(v,f),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return W.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,l){return this._lazyInitEmptyStyle(),this.style.addLayer(v,l),this._update(!0)}moveLayer(v,l){return this.style.moveLayer(v,l),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,l,f){return this.style.setLayerZoomRange(v,l,f),this._update(!0)}setFilter(v,l,f={}){return this.style.setFilter(v,l,f),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,l,f,m={}){return this.style.setPaintProperty(v,l,f,m),this._update(!0)}getPaintProperty(v,l){return this.style.getPaintProperty(v,l)}setLayoutProperty(v,l,f,m={}){return this.style.setLayoutProperty(v,l,f,m),this._update(!0)}getLayoutProperty(v,l){return this.style.getLayoutProperty(v,l)}setGlyphs(v,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,l,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,l,f,m=>{m||this._update(!0)}),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,l,f=>{f||this._update(!0)}),this}setLight(v,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,l),this._update(!0)}getLight(){return this.style.getLight()}setSky(v,l={}){return this._lazyInitEmptyStyle(),this.style.setSky(v,l),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,l){return this.style.setFeatureState(v,l),this._update()}removeFeatureState(v,l){return this.style.removeFeatureState(v,l),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,l=0;return this._container&&(v=this._container.clientWidth||400,l=this._container.clientHeight||300),[v,l]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const l=this._canvasContainer=P.create("div","maplibregl-canvas-container",v);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=P.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),m=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],m);const y=this._controlContainer=P.create("div","maplibregl-control-container",v),B=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{B[E]=P.create("div",`maplibregl-ctrl-${E} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,l,f){this._canvas.width=Math.floor(f*v),this._canvas.height=Math.floor(f*l),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const v=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let l=null;this._canvas.addEventListener("webglcontextcreationerror",m=>{l={requestedAttributes:v},m&&(l.statusMessage=m.statusMessage,l.type=m.type)},{once:!0});let f=null;if(f=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,v):this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v),!f){const m="Failed to initialize WebGL";throw l?(l.message=m,new Error(JSON.stringify(l))):new Error(m)}this.painter=new _A(f,this.transform),k.testSupport(f)}migrateProjection(v,l){super.migrateProjection(v,l),this.painter.transform=v,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){var l,f,m,y,B;const E=this._idleTriggered?this._fadeDuration:0,R=((l=this.style.projection)===null||l===void 0?void 0:l.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let O=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const J=this.transform.zoom,X=M();this.style.zoomHistory.update(J,X);const ne=new o.F(J,{now:X,fadeDuration:E,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),de=ne.crossFadingFactor();de===1&&de===this._crossFadingFactor||(O=!0,this._crossFadingFactor=de),this.style.update(ne)}const V=((f=this.style.projection)===null||f===void 0?void 0:f.transitionState)>0!==R;(m=this.style.projection)===null||m===void 0||m.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((y=this.style.projection)===null||y===void 0?void 0:y.transitionState,(B=this.style.projection)===null||B===void 0?void 0:B.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||V)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,E,this._crossSourceCollisions,V),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cw.mark(o.cx.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||O)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const G=this._sourcesDirty||this._styleDirty||this._placementDirty;return G||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||G||(this._fullyLoaded=!0,o.cw.mark(o.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),W.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l?.loseContext&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),P.remove(this._canvasContainer),P.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cw.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,C.frame(this._frameRequest,v=>{o.cw.frame(v),this._frameRequest=null;try{this._render(v)}catch(l){if(!o.cy(l)&&!function(f){return f.message===AA}(l))throw l}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return Rn}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(v){return this._lazyInitEmptyStyle(),this.style.setProjection(v),this._update(!0)}},a.MapMouseEvent=Vs,a.MapTouchEvent=oo,a.MapWheelEvent=Ba,a.Marker=zi,a.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const l=this._map.getZoom(),f=l===this._map.getMaxZoom(),m=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(l,f)=>{const m=this._map._getUIString(`NavigationControl.${f}`);l.title=m,l.setAttribute("aria-label",m)},this.options=o.e({},Qo,v),this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),P.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),P.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=P.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){P.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,l){const f=P.create("button",v,this._container);return f.type="button",f.addEventListener("click",l),f}},a.Popup=class extends o.E{constructor(v){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&P.remove(this._content),this._container&&(P.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=P.create("div","maplibregl-popup",this._map.getContainer()),this._tip=P.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const E of this.options.className.split(" "))this._container.classList.add(E);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Ho(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!l)return;const f=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationToScreenPoint(this._lngLat));let m=this.options.anchor;const y=vf(this.options.offset);if(!m){const E=this._container.offsetWidth,R=this._container.offsetHeight;let O;O=f.y+y.bottom.y<R?["top"]:f.y>this._map.transform.height-R?["bottom"]:[],f.x<E/2?O.push("left"):f.x>this._map.transform.width-E/2&&O.push("right"),m=O.length===0?"bottom":O.join("-")}let B=f.add(y[m]);this.options.subpixelPositioning||(B=B.round()),P.setTransform(this._container,`${Wa[m]} translate(${B.x}px,${B.y}px)`),Ca(this._container,m,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(yA),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=o.S.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const l=document.createDocumentFragment(),f=document.createElement("body");let m;for(f.innerHTML=v;m=f.firstChild,m;)l.appendChild(m);return this.setDOMContent(l)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=P.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=P.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(_l);v&&v.focus()}},a.RasterDEMTileSource=Kt,a.RasterTileSource=Er,a.ScaleControl=class{constructor(v){this._onMove=()=>{bf(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,bf(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Tu),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){P.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},a.ScrollZoomHandler=_r,a.Style=ba,a.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=P.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=P.create("button","maplibregl-ctrl-terrain",this._container),P.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){P.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},a.TwoFingersTouchPitchHandler=mn,a.TwoFingersTouchRotateHandler=Wr,a.TwoFingersTouchZoomHandler=sr,a.TwoFingersTouchZoomRotateHandler=js,a.VectorTileSource=Ur,a.VideoSource=Lr,a.addSourceType=(v,l)=>o._(void 0,void 0,void 0,function*(){if(ir(v))throw new Error(`A source type called "${v}" already exists.`);((f,m)=>{kt[f]=m})(v,l)}),a.clearPrewarmedResources=function(){const v=He;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(he),He=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.createTileMesh=Va,a.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},a.getRTLTextPluginStatus=function(){return wr().getRTLTextPluginStatus()},a.getVersion=function(){return wf},a.getWorkerCount=function(){return Be.workerCount},a.getWorkerUrl=function(){return o.a.WORKER_URL},a.importScriptInWorkers=function(v){return Bt().broadcast("IS",v)},a.isTimeFrozen=function(){return w.isFrozen()},a.prewarm=function(){it().acquire(he)},a.restoreNow=function(){w.restoreNow()},a.setMaxParallelImageRequests=function(v){o.a.MAX_PARALLEL_IMAGE_REQUESTS=v},a.setNow=function(v){w.setNow(v)},a.setRTLTextPlugin=function(v,l){return wr().setRTLTextPlugin(v,l)},a.setWorkerCount=function(v){Be.workerCount=v},a.setWorkerUrl=function(v){o.a.WORKER_URL=v}});var s=t;return s})}(by)),by.exports}var UI=Q9();const go=Sf(UI),If=new Uint8Array([102,103,98,3,102,103,98,0]),Ph=4,Yg=4,Zg=4,Jg=4,TA=new Int32Array(2),DI=new Float32Array(TA.buffer),kI=new Float64Array(TA.buffer),vy=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Ov;(function(r){r[r.UTF8_BYTES=1]="UTF8_BYTES",r[r.UTF16_STRING=2]="UTF16_STRING"})(Ov||(Ov={}));class Mh{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new Mh(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return TA[0]=this.readInt32(e),DI[0]}readFloat64(e){return TA[vy?0:1]=this.readInt32(e),TA[vy?1:0]=this.readInt32(e+4),kI[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){DI[0]=t,this.writeInt32(e,TA[0])}writeFloat64(e,t){kI[0]=t,this.writeInt32(e,TA[vy?0:1]),this.writeInt32(e+4,TA[vy?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Yg+Zg)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<Zg;t++)e+=String.fromCharCode(this.readInt8(this.position_+Yg+t));return e}__offset(e,t){const n=e-this.readInt32(e);return t<this.readInt16(n)?this.readInt16(n+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const n=this.readInt32(e);e+=Yg;const i=this.bytes_.subarray(e,e+n);return t===Ov.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Yg}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Zg)throw new Error("FlatBuffers: file identifier must be length "+Zg);for(let t=0;t<Zg;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Yg+t))return!1;return!0}createScalarList(e,t){const n=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&n.push(s)}return n}createObjList(e,t){const n=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&n.push(s.unpack())}return n}}var ci,Go=((ci={})[ci.Byte=0]="Byte",ci[ci.UByte=1]="UByte",ci[ci.Bool=2]="Bool",ci[ci.Short=3]="Short",ci[ci.UShort=4]="UShort",ci[ci.Int=5]="Int",ci[ci.UInt=6]="UInt",ci[ci.Long=7]="Long",ci[ci.ULong=8]="ULong",ci[ci.Float=9]="Float",ci[ci.Double=10]="Double",ci[ci.String=11]="String",ci[ci.Json=12]="Json",ci[ci.DateTime=13]="DateTime",ci[ci.Binary=14]="Binary",ci);class Mo{bb=null;bb_pos=0;__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new Mo).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+Jg),(t||new Mo).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):Go.Byte}title(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){let e=this.bb.__offset(this.bb_pos,18);return!e||!!this.bb.readInt8(this.bb_pos+e)}unique(){let e=this.bb.__offset(this.bb_pos,20);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}primaryKey(){let e=this.bb.__offset(this.bb_pos,22);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}metadata(e){let t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,Go.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){let t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,n,i,s,a,o,u,d,p,b,C){return Mo.startColumn(e),Mo.addName(e,t),Mo.addType(e,n),Mo.addTitle(e,i),Mo.addDescription(e,s),Mo.addWidth(e,a),Mo.addPrecision(e,o),Mo.addScale(e,u),Mo.addNullable(e,d),Mo.addUnique(e,p),Mo.addPrimaryKey(e,b),Mo.addMetadata(e,C),Mo.endColumn(e)}}var Nn,ia=((Nn={})[Nn.Unknown=0]="Unknown",Nn[Nn.Point=1]="Point",Nn[Nn.LineString=2]="LineString",Nn[Nn.Polygon=3]="Polygon",Nn[Nn.MultiPoint=4]="MultiPoint",Nn[Nn.MultiLineString=5]="MultiLineString",Nn[Nn.MultiPolygon=6]="MultiPolygon",Nn[Nn.GeometryCollection=7]="GeometryCollection",Nn[Nn.CircularString=8]="CircularString",Nn[Nn.CompoundCurve=9]="CompoundCurve",Nn[Nn.CurvePolygon=10]="CurvePolygon",Nn[Nn.MultiCurve=11]="MultiCurve",Nn[Nn.MultiSurface=12]="MultiSurface",Nn[Nn.Curve=13]="Curve",Nn[Nn.Surface=14]="Surface",Nn[Nn.PolyhedralSurface=15]="PolyhedralSurface",Nn[Nn.TIN=16]="TIN",Nn[Nn.Triangle=17]="Triangle",Nn);let H9=class yl{bb=null;bb_pos=0;__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new yl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+Jg),(t||new yl).__init(e.readInt32(e.position())+e.position(),e)}ends(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+4*e):0}endsLength(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){let e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}xyLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}zLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){let e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}mLength(){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){let e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}tLength(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){let e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+8*e):BigInt(0)}tmLength(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):ia.Unknown}parts(e,t){let n=this.bb.__offset(this.bb_pos,18);return n?(t||new yl).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}partsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addInt32(t[n]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addInt64(t[n]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,ia.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,n,i,s,a,o,u,d){return yl.startGeometry(e),yl.addEnds(e,t),yl.addXy(e,n),yl.addZ(e,i),yl.addM(e,s),yl.addT(e,a),yl.addTm(e,o),yl.addType(e,u),yl.addParts(e,d),yl.endGeometry(e)}};class Fc{bb=null;bb_pos=0;__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new Fc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+Jg),(t||new Fc).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){let t=this.bb.__offset(this.bb_pos,4);return t?(e||new H9).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){let n=this.bb.__offset(this.bb_pos,8);return n?(t||new Mo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let n=t.length-1;n>=0;n--)e.addInt8(t[n]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,n,i){return Fc.startFeature(e),Fc.addGeometry(e,t),Fc.addProperties(e,n),Fc.addColumns(e,i),Fc.endFeature(e)}}function Uv(r,e){let t=[];for(let n=0;n<r.length;n+=2){let i=[r[n],r[n+1]];e&&i.push(e[n>>1]),t.push(i)}return t}new TextEncoder;let NI=new TextDecoder;function V9(r,e){let t={};if(!e||e.length===0)return t;let n=r.propertiesArray();if(!n)return t;let i=new DataView(n.buffer,n.byteOffset),s=r.propertiesLength(),a=0;for(;a<s;){let o=i.getUint16(a,!0);a+=2;let u=e[o],d=u.name;switch(u.type){case Go.Bool:t[d]=!!i.getUint8(a),a+=1;break;case Go.Byte:t[d]=i.getInt8(a),a+=1;break;case Go.UByte:t[d]=i.getUint8(a),a+=1;break;case Go.Short:t[d]=i.getInt16(a,!0),a+=2;break;case Go.UShort:t[d]=i.getUint16(a,!0),a+=2;break;case Go.Int:t[d]=i.getInt32(a,!0),a+=4;break;case Go.UInt:t[d]=i.getUint32(a,!0),a+=4;break;case Go.Long:t[d]=Number(i.getBigInt64(a,!0)),a+=8;break;case Go.ULong:t[d]=Number(i.getBigUint64(a,!0)),a+=8;break;case Go.Float:t[d]=i.getFloat32(a,!0),a+=4;break;case Go.Double:t[d]=i.getFloat64(a,!0),a+=8;break;case Go.DateTime:case Go.String:{let p=i.getUint32(a,!0);a+=4,t[d]=NI.decode(n.subarray(a,a+p)),a+=p;break}case Go.Json:{let p=i.getUint32(a,!0);a+=4;let b=NI.decode(n.subarray(a,a+p));t[d]=JSON.parse(b),a+=p;break}case Go.Binary:{let p=i.getUint32(a,!0);a+=4,t[d]=n.subarray(a,a+p),a+=p;break}default:throw Error(`Unknown type ${u.type}`)}}return t}const Dv=new Uint8Array(0);function j9(){return this._source.cancel()}function $9(r,e){if(!r.length)return e;if(!e.length)return r;var t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function G9(){var r=this,e=r._array.subarray(r._index);return r._source.read().then(function(t){return r._array=Dv,r._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:$9(e,t.value)}})}function W9(r){if((r|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+r<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=r));var n=new Uint8Array(r);return n.set(this._array.subarray(this._index)),function i(){return e._source.read().then(function(s){return s.done?(e._array=Dv,e._index=0,t>0?n.subarray(0,t):null):t+s.value.length>=r?(e._array=s.value,e._index=r-t,n.set(s.value.subarray(0,r-t),t),n):(n.set(s.value,t),t+=s.value.length,i())})}()}function q9(r){return typeof r.slice=="function"?r:new wy(typeof r.read=="function"?r:r.getReader())}function wy(r){this._source=r,this._array=Dv,this._index=0}wy.prototype.read=G9,wy.prototype.slice=W9,wy.prototype.cancel=j9;class Kl{bb=null;bb_pos=0;__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new Kl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+Jg),(t||new Kl).__init(e.readInt32(e.position())+e.position(),e)}org(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,n,i,s,a,o){return Kl.startCrs(e),Kl.addOrg(e,t),Kl.addCode(e,n),Kl.addName(e,i),Kl.addDescription(e,s),Kl.addWkt(e,a),Kl.addCodeString(e,o),Kl.endCrs(e)}}class xy{bb=null;bb_pos=0;__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new xy).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+Jg),(t||new xy).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}envelopeLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):ia.Unknown}hasZ(){let e=this.bb.__offset(this.bb_pos,10);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasM(){let e=this.bb.__offset(this.bb_pos,12);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasT(){let e=this.bb.__offset(this.bb_pos,14);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasTm(){let e=this.bb.__offset(this.bb_pos,16);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}columns(e,t){let n=this.bb.__offset(this.bb_pos,18);return n?(t||new Mo).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){let e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){let e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){let t=this.bb.__offset(this.bb_pos,24);return t?(e||new Kl).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){let t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){let t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,ia.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function kv(r){let e=xy.getRootAsHeader(r),t=e.featuresCount(),n=e.indexNodeSize(),i=[];for(let o=0;o<e.columnsLength();o++){let u=e.columns(o);if(!u)throw Error("Column unexpectedly missing");if(!u.name())throw Error("Column name unexpectedly missing");i.push({name:u.name(),type:u.type(),title:u.title(),description:u.description(),width:u.width(),precision:u.precision(),scale:u.scale(),nullable:u.nullable(),unique:u.unique(),primary_key:u.primaryKey()})}let s=e.crs(),a=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:e.geometryType(),columns:i,envelope:null,featuresCount:Number(t),indexNodeSize:n,crs:a,title:e.title(),description:e.description(),metadata:e.metadata()}}let zI=class M9{static global=new M9;_extraRequestThreshold=262144;extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}};const K9=40,X9=16;function Nv(r,e){e=Math.min(Math.max(+e,2),65535);let t=r,n=t;do n+=t=Math.ceil(t/e);while(t!==1);return 40*n}function Y9(r,e){if(e<2)throw Error("Node size must be at least 2");if(r===0)throw Error("Number of items must be greater than 0");let t=r,n=t,i=[t];do n+=t=Math.ceil(t/e),i.push(t);while(t!==1);let s=[];for(let o of(t=n,i))s.push(t-o),t-=o;let a=[];for(let o=0;o<i.length;o++)a.push([s[o],s[o]+i[o]]);return a}async function*Z9(r,e,t,n){class i{_level;nodes;constructor(w,M){this._level=M,this.nodes=w}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(w){this.nodes[1]=w}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:s,minY:a,maxX:o,maxY:u}=t,d=Y9(r,e),p=d[0][0],b=[new i([0,1],d.length-1)];for(;b.length!==0;){let C=b.shift(),w=C.startNodeIdx(),M=w>=p,P=(()=>{let[,j]=d[C.level()],H=Math.min(C.endNodeIdx()+e,j);return M&&H<j?H+1:H})(),k=P-w,D=new DataView(await n(40*w,40*k));for(let j=w;j<P;j++){let H=j-w,N=40*H;if(o<D.getFloat64(N+0,!0)||u<D.getFloat64(N+8,!0)||s>D.getFloat64(N+16,!0)||a>D.getFloat64(N+24,!0))continue;let q=D.getBigUint64(N+32,!0);if(M){let Z=(()=>{if(j<r-1){let te=(H+1)*40;return D.getBigUint64(te+32,!0)-q}return null})(),fe=j-p;yield[Number(q),fe,Number(Z)];continue}let W=zI.global.extraRequestThreshold()/40,ie=b[b.length-1];if(ie!==void 0&&ie.level()===C.level()-1&&q<ie.endNodeIdx()+W){ie.extendEndNodeIdx(Number(q));continue}let se=(()=>{let Z=C.level()-1;return new i([Number(q),Number(q)+1],Z)})();ie!==void 0&&(ie.level(),se.level()),b.push(se)}}}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var zv=function(r,e){return zv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},zv(r,e)};function J9(r,e){zv(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function np(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(p){try{d(n.next(p))}catch(b){a(b)}}function u(p){try{d(n.throw(p))}catch(b){a(b)}}function d(p){p.done?s(p.value):i(p.value).then(o,u)}d((n=n.apply(r,[])).next())})}function EA(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(d){return function(p){return u([d,p])}}function u(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=d[0]&2?i.return:d[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,d[1])).done)return s;switch(i=0,s&&(d=[d[0]&2,s.value]),d[0]){case 0:case 1:s=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!s||d[1]>s[0]&&d[1]<s[3])){t.label=d[1];break}if(d[0]===6&&t.label<s[1]){t.label=s[1],s=d;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(d);break}s[2]&&t.ops.pop(),t.trys.pop();continue}d=e.call(r,t)}catch(p){d=[6,p],i=0}finally{n=s=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function ip(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function em(r){return this instanceof em?(this.v=r,this):new em(r)}function ej(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(C){n[C]&&(i[C]=function(w){return new Promise(function(M,P){s.push([C,w,M,P])>1||o(C,w)})})}function o(C,w){try{u(n[C](w))}catch(M){b(s[0][3],M)}}function u(C){C.value instanceof em?Promise.resolve(C.value.v).then(d,p):b(s[0][2],C)}function d(C){o("next",C)}function p(C){o("throw",C)}function b(C,w){C(w),s.shift(),s.length&&o(s[0][0],s[0][1])}}var QI=function(r){J9(e,r);function e(t){var n=r.call(this,t)||this;return Object.defineProperty(n,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(n,n.constructor.prototype):n.__proto__=n.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(n,n.constructor),n}return e}(Error);(function(){function r(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),r.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})(),function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r}(),function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r}();function Qv(r){r!=null&&typeof r.then=="function"&&r.then(Ty,Ty)}var Hv=0,HI=1,Pf=2,By=3,Vv=4,Cy=1024,Ty=function(){};function sp(r){var e=r.err,t=Promise.resolve(r.execution).then(function(n){if(e!=null)throw e;return n});return r.err=void 0,r.execution=t.then(function(){},function(){}),r.pending===void 0?t:r.pending.then(function(){return t})}function Mf(r,e){var t=r.state>=By;return Promise.resolve(e).then(function(n){return!t&&r.state>=Vv?sp(r).then(function(i){return{value:i,done:!0}}):{value:n,done:t}})}function jv(r,e){var t,n;if(!(r.state>=Pf))if(r.state=Pf,r.onnext(),r.onstop(),r.err==null&&(r.err=e),r.pushes.length===0&&(typeof r.buffer>"u"||r.buffer.empty))tm(r);else try{for(var i=ip(r.pushes),s=i.next();!s.done;s=i.next()){var a=s.value;a.resolve()}}catch(o){t={error:o}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}function tm(r){var e,t;if(!(r.state>=By)){r.state<Pf&&jv(r),r.state=By,r.buffer=void 0;try{for(var n=ip(r.nexts),i=n.next();!i.done;i=n.next()){var s=i.value,a=r.pending===void 0?sp(r):r.pending.then(function(){return sp(r)});s.resolve(Mf(r,a))}}catch(o){e={error:o}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}r.pushes=[],r.nexts=[]}}function VI(r){r.state>=Vv||(r.state<By&&tm(r),r.state=Vv)}function tj(r,e){if(Qv(e),r.pushes.length>=Cy)throw new QI("No more than "+Cy+" pending calls to push are allowed on a single repeater.");if(r.state>=Pf)return Promise.resolve(void 0);var t=r.pending===void 0?Promise.resolve(e):r.pending.then(function(){return e});t=t.catch(function(u){r.state<Pf&&(r.err=u),VI(r)});var n;if(r.nexts.length){var i=r.nexts.shift();i.resolve(Mf(r,t)),r.nexts.length?n=Promise.resolve(r.nexts[0].value):typeof r.buffer<"u"&&!r.buffer.full?n=Promise.resolve(void 0):n=new Promise(function(u){return r.onnext=u})}else typeof r.buffer<"u"&&!r.buffer.full?(r.buffer.add(t),n=Promise.resolve(void 0)):n=new Promise(function(u){return r.pushes.push({resolve:u,value:t})});var s=!0,a={},o=n.catch(function(u){if(s)throw u});return a.then=function(u,d){return s=!1,Promise.prototype.then.call(n,u,d)},a.catch=function(u){return s=!1,Promise.prototype.catch.call(n,u)},a.finally=n.finally.bind(n),r.pending=t.then(function(){return o}).catch(function(u){r.err=u,VI(r)}),a}function rj(r){var e=jv.bind(null,r),t=new Promise(function(n){return r.onstop=n});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function nj(r){if(!(r.state>=HI)){r.state=HI;var e=tj.bind(null,r),t=rj(r);r.execution=new Promise(function(n){return n(r.executor(e,t))}),r.execution.catch(function(){return jv(r)})}}var Ey=new WeakMap,rm=function(){function r(e,t){Ey.set(this,{executor:e,buffer:t,err:void 0,state:Hv,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:Ty,onstop:Ty})}return r.prototype.next=function(e){Qv(e);var t=Ey.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=Cy)throw new QI("No more than "+Cy+" pending calls to next are allowed on a single repeater.");if(t.state<=Hv&&nj(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var n=Mf(t,t.buffer.remove());if(t.pushes.length){var i=t.pushes.shift();t.buffer.add(i.value),t.onnext=i.resolve}return n}else if(t.pushes.length){var s=t.pushes.shift();return t.onnext=s.resolve,Mf(t,s.value)}else if(t.state>=Pf)return tm(t),Mf(t,sp(t));return new Promise(function(a){return t.nexts.push({resolve:a,value:e})})},r.prototype.return=function(e){Qv(e);var t=Ey.get(this);if(t===void 0)throw new Error("WeakMap error");return tm(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),Mf(t,sp(t))},r.prototype.throw=function(e){var t=Ey.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=Hv||t.state>=Pf||typeof t.buffer<"u"&&!t.buffer.empty?(tm(t),t.err==null&&(t.err=e),Mf(t,sp(t))):this.next(Promise.reject(e))},r.prototype[Symbol.asyncIterator]=function(){return this},r.race=ij,r.merge=sj,r.zip=oj,r.latest=aj,r}();function Sy(r,e){var t,n,i=[],s=function(d){d!=null&&typeof d[Symbol.asyncIterator]=="function"?i.push(d[Symbol.asyncIterator]()):d!=null&&typeof d[Symbol.iterator]=="function"?i.push(d[Symbol.iterator]()):i.push(function(){return ej(this,arguments,function(){return EA(this,function(C){switch(C.label){case 0:return e.yieldValues?[4,em(d)]:[3,3];case 1:return[4,C.sent()];case 2:C.sent(),C.label=3;case 3:return e.returnValues?[4,em(d)]:[3,5];case 4:return[2,C.sent()];case 5:return[2]}})})}())};try{for(var a=ip(r),o=a.next();!o.done;o=a.next()){var u=o.value;s(u)}}catch(d){t={error:d}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i}function ij(r){var e=this,t=Sy(r,{returnValues:!0});return new rm(function(n,i){return np(e,void 0,void 0,function(){var s,a,o,u,d,p;return EA(this,function(b){switch(b.label){case 0:if(!t.length)return i(),[2];a=!1,i.then(function(){s(),a=!0}),b.label=1;case 1:b.trys.push([1,,5,7]),u=void 0,d=0,p=function(){var C,w,M,P,k,D;return EA(this,function(j){switch(j.label){case 0:C=d;try{for(w=(k=void 0,ip(t)),M=w.next();!M.done;M=w.next())P=M.value,Promise.resolve(P.next()).then(function(H){H.done?(i(),o===void 0&&(o=H)):d===C&&(d++,s(H))},function(H){return i(H)})}catch(H){k={error:H}}finally{try{M&&!M.done&&(D=w.return)&&D.call(w)}finally{if(k)throw k.error}}return[4,new Promise(function(H){return s=H})];case 1:return u=j.sent(),u===void 0?[3,3]:[4,n(u.value)];case 2:j.sent(),j.label=3;case 3:return[2]}})},b.label=2;case 2:return a?[3,4]:[5,p()];case 3:return b.sent(),[3,2];case 4:return[2,o&&o.value];case 5:return i(),[4,Promise.race(t.map(function(C){return C.return&&C.return()}))];case 6:return b.sent(),[7];case 7:return[2]}})})})}function sj(r){var e=this,t=Sy(r,{yieldValues:!0});return new rm(function(n,i){return np(e,void 0,void 0,function(){var s,a,o,u=this;return EA(this,function(d){switch(d.label){case 0:if(!t.length)return i(),[2];s=[],a=!1,i.then(function(){var p,b;a=!0;try{for(var C=ip(s),w=C.next();!w.done;w=C.next()){var M=w.value;M()}}catch(P){p={error:P}}finally{try{w&&!w.done&&(b=C.return)&&b.call(C)}finally{if(p)throw p.error}}}),d.label=1;case 1:return d.trys.push([1,,3,4]),[4,Promise.all(t.map(function(p,b){return np(u,void 0,void 0,function(){var C,w;return EA(this,function(M){switch(M.label){case 0:M.trys.push([0,,6,9]),M.label=1;case 1:return a?[3,5]:(Promise.resolve(p.next()).then(function(P){return s[b](P)},function(P){return i(P)}),[4,new Promise(function(P){s[b]=P})]);case 2:return C=M.sent(),C===void 0?[3,4]:C.done?(o=C,[2]):[4,n(C.value)];case 3:M.sent(),M.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return w=p.return,w?[4,p.return()]:[3,8];case 7:w=M.sent(),M.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return d.sent(),[2,o&&o.value];case 3:return i(),[7];case 4:return[2]}})})})}function oj(r){var e=this,t=Sy(r,{returnValues:!0});return new rm(function(n,i){return np(e,void 0,void 0,function(){var s,a,o,u;return EA(this,function(d){switch(d.label){case 0:if(!t.length)return i(),[2,[]];a=!1,i.then(function(){s(),a=!0}),d.label=1;case 1:d.trys.push([1,,6,8]),d.label=2;case 2:return a?[3,5]:(Promise.all(t.map(function(p){return p.next()})).then(function(p){return s(p)},function(p){return i(p)}),[4,new Promise(function(p){return s=p})]);case 3:return o=d.sent(),o===void 0?[2]:(u=o.map(function(p){return p.value}),o.some(function(p){return p.done})?[2,u]:[4,n(u)]);case 4:return d.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(t.map(function(p){return p.return&&p.return()}))];case 7:return d.sent(),[7];case 8:return[2]}})})})}function aj(r){var e=this,t=Sy(r,{yieldValues:!0,returnValues:!0});return new rm(function(n,i){return np(e,void 0,void 0,function(){var s,a,o,u,d,p=this;return EA(this,function(b){switch(b.label){case 0:if(!t.length)return i(),[2,[]];a=[],o=!1,i.then(function(){var C,w;s();try{for(var M=ip(a),P=M.next();!P.done;P=M.next()){var k=P.value;k()}}catch(D){C={error:D}}finally{try{P&&!P.done&&(w=M.return)&&w.call(M)}finally{if(C)throw C.error}}o=!0}),b.label=1;case 1:return b.trys.push([1,,5,7]),Promise.all(t.map(function(C){return C.next()})).then(function(C){return s(C)},function(C){return i(C)}),[4,new Promise(function(C){return s=C})];case 2:return u=b.sent(),u===void 0?[2]:(d=u.map(function(C){return C.value}),u.every(function(C){return C.done})?[2,d]:[4,n(d.slice())]);case 3:return b.sent(),[4,Promise.all(t.map(function(C,w){return np(p,void 0,void 0,function(){var M;return EA(this,function(P){switch(P.label){case 0:if(u[w].done)return[2,u[w].value];P.label=1;case 1:return o?[3,4]:(Promise.resolve(C.next()).then(function(k){return a[w](k)},function(k){return i(k)}),[4,new Promise(function(k){return a[w]=k})]);case 2:return M=P.sent(),M===void 0?[2,u[w].value]:M.done?[2,M.value]:(d[w]=M.value,[4,n(d.slice())]);case 3:return P.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,b.sent()];case 5:return i(),[4,Promise.all(t.map(function(C){return C.return&&C.return()}))];case 6:return b.sent(),[7];case 7:return[2]}})})})}class $v{headerClient;header;headerLength;indexLength;nocache;headers;constructor(e,t,n,i,s,a={}){this.headerClient=e,this.header=t,this.headerLength=n,this.indexLength=i,this.nocache=s,this.headers=a}static async open(e,t,n={}){let i,s=new jI(e,t,n),a=2024+(()=>{let p,b=0;for(p=0;p<3;p++)b+=X9**p*K9;return b})();if(!new Uint8Array(await s.getRange(0,8,a,"header")).subarray(0,3).every((p,b)=>If[b]===p))throw Error("Not a FlatGeobuf file");if((i=new DataView(await s.getRange(8,4,a,"header")).getUint32(0,!0))>10485760||i<8)throw Error("Invalid header size");let o=await s.getRange(12,i,a,"header"),u=kv(new Mh(new Uint8Array(o)));if(u.indexNodeSize===0)throw Error("No index found, cannot read features filtered by bbox");let d=Nv(u.featuresCount,u.indexNodeSize);return new $v(s,u,i,d,t,n)}async*selectBbox(e){let t=this.lengthBeforeTree(),n=this.headerClient,i=async(u,d)=>n.getRange(t+u,d,0,"index"),s=[],a=[];for await(let u of Z9(this.header.featuresCount,this.header.indexNodeSize,e,i)){let[d,p]=u,[,,b]=u;if(b||(b=4),a.length===0){a.push([d,b,p]);continue}let C=a[a.length-1];d-(C[0]+C[1])>zI.global.extraRequestThreshold()&&(s.push(a),a=[]),a.push([d,b,p])}this.headerClient.logUsage("header+index"),a.length>0&&s.push(a);let o=s.flatMap(u=>this.readFeatureBatch(u,this.nocache));yield*rm.merge(o)}lengthBeforeTree(){return If.length+Ph+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(e){return new jI(this.headerClient.httpClient,e,this.headers)}async*readFeatureBatch(e,t){let[n]=e[0],[i,s]=e[e.length-1],a=this.buildFeatureClient(t),o=i+s-n;for(let[u,,d]of e){let p=await this.readFeature(a,u,o);yield{id:d,feature:p},o=0}a.logUsage("feature")}async readFeature(e,t,n){let i,s=t+this.lengthBeforeFeatures();i=new DataView(await e.getRange(s,4,n,"feature length")).getUint32(0,!0);let a=new Uint8Array(await e.getRange(s+4,i,n,"feature data")),o=new Uint8Array(i+Ph);o.set(a,Ph);let u=new Mh(o);return u.setPosition(Ph),Fc.getRootAsFeature(u)}}let jI=class{httpClient;bytesEverUsed=0;bytesEverFetched=0;buffer=new ArrayBuffer(0);head=0;constructor(e,t,n={}){if(typeof e=="string")this.httpClient=new $I(e,t,n);else if(e instanceof $I)this.httpClient=e;else throw Error("Unknown source")}async getRange(e,t,n,i){this.bytesEverUsed+=t;let s=e-this.head,a=s+t;if(s>=0&&a<=this.buffer.byteLength)return this.buffer.slice(s,a);let o=Math.max(t,n);return this.bytesEverFetched+=o,this.buffer=await this.httpClient.getRange(e,o,i),this.head=e,this.buffer.slice(0,t)}logUsage(e){e.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}},$I=class{url;nocache;headers;requestsEverMade=0;bytesEverRequested=0;constructor(e,t,n={}){this.url=e,this.nocache=t,this.headers=n}async getRange(e,t,n){this.requestsEverMade+=1,this.bytesEverRequested+=t;let i=`bytes=${e}-${e+t-1}`,s=new Headers(this.headers);return s.set("Range",i),this.nocache&&s.set("Cache-Control","no-cache, no-store"),await(await fetch(this.url,{headers:s})).arrayBuffer()}};async function*lj(r,e,t,n){if(!r.subarray(0,3).every((b,C)=>If[C]===b))throw Error("Not a FlatGeobuf file");let i=new Mh(r),s=i.readUint32(If.length);i.setPosition(If.length+Ph);let a=kv(i),o=If.length+Ph+s,{indexNodeSize:u,featuresCount:d}=a;u>0&&(o+=Nv(d,u));let p=0;for(;o<i.capacity();){let b=i.readUint32(o);i.setPosition(o+Ph);let C=Fc.getRootAsFeature(i);yield e(p++,C,a),o+=Ph+b}}async function*cj(r,e,t){let n,i=q9(r),s=async w=>await i.slice(w),a=new Uint8Array(await s(8));if(!a.subarray(0,3).every((w,M)=>If[M]===w))throw Error("Not a FlatGeobuf file");a=new Uint8Array(await s(4));let o=new Mh(a),u=o.readUint32(0);a=new Uint8Array(await s(u));let d=kv(o=new Mh(a)),{indexNodeSize:p,featuresCount:b}=d;if(p>0){let w=Nv(b,p);await s(w)}let C=0;for(;n=await hj(s,d,e,C++);)yield n}async function*uj(r,e,t,n,i=!1,s={}){let a=await $v.open(r,i,s);for await(let o of a.selectBbox(e))yield t(o.id,o.feature,a.header)}async function hj(r,e,t,n){let i=new Uint8Array(await r(4,"feature length"));if(i.byteLength===0)return;let s=new Mh(i),a=s.readUint32(0);i=new Uint8Array(await r(a,"feature data"));let o=new Uint8Array(a+4);return o.set(i,4),(s=new Mh(o)).setPosition(Ph),t(n,Fc.getRootAsFeature(s),e)}function Gv(r,e){let t=e;if(t===ia.Unknown&&(t=r.type()),t===ia.GeometryCollection){let i=[];for(let s=0;s<r.partsLength();s++){let a=r.parts(s),o=a.type();i.push(Gv(a,o))}return{type:ia[t],geometries:i}}if(t===ia.MultiPolygon){let i=[];for(let s=0;s<r.partsLength();s++)i.push(Gv(r.parts(s),ia.Polygon));return{type:ia[t],coordinates:i.map(s=>s.coordinates)}}let n=function(i,s){let a=i.xyArray(),o=i.zArray();switch(s){case ia.Point:{let u=Array.from(a);return o&&u.push(o[0]),u}case ia.MultiPoint:case ia.LineString:return Uv(a,o);case ia.MultiLineString:case ia.Polygon:return function(u,d,p){let b;if(!p||p.length===0)return[Uv(u,d)];let C=0,w=Array.from(p).map(M=>u.slice(C,C=M<<1));return d&&(C=0,b=Array.from(p).map(M=>d.slice(C,C=M))),w.map((M,P)=>Uv(M,b?b[P]:void 0))}(a,o,i.endsArray())}}(r,t);return{type:ia[t],coordinates:n}}function Wv(r,e,t){let n=t.columns;return{type:"Feature",id:r,geometry:Gv(e.geometry(),t.geometryType),properties:V9(e,n)}}async function*Aj(r,e,t){yield*lj(r,Wv)}function fj(r,e){return cj(r,Wv)}function dj(r,e,t,n=!1,i={}){return uj(r,e,Wv,t,n,i)}function GI(r,e,t,n=!1,i={}){return r instanceof Uint8Array?Aj(r):r instanceof ReadableStream?fj(r):dj(r,e,t,n,i)}class pj{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(e){this._map=e;let t=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(t._btn.className.indexOf("3d")!=-1){let d={pitch:t._pitch,bearing:t._bearing};t._minpitchzoom&&e.getZoom()>t._minpitchzoom&&(d.zoom=t._minpitchzoom);var n=0,i=38.5,s=6,a=62.33,{longitude:o,latitude:u}=e.getCenter();e.getZoom()<10?e.setTerrain({source:"terrainICGC",exaggeration:1.5}):o>=n&&o<=s&&u>=i&&u<=a?e.setTerrain({source:"terrainICGC",exaggeration:1.2}):e.setTerrain({source:"terrainICGC",exaggeration:1.5}),e.easeTo(d),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else e.setTerrain(null),e.easeTo({pitch:0,bearing:0}),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function Iy(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const qv=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),WI=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);WI&&parseFloat(WI[1]);const qI=globalThis,KI=globalThis.process||{},gj=globalThis.navigator||{};function XI(r){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Ff(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||XI()}function mj(r){return Ff()?XI()?"Electron":(gj.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const YI="4.1.0";function _j(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class yj{constructor(e,t,n="sessionStorage"){this.storage=_j(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function bj(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function vj(r,e=8){const t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}var Py;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Py||(Py={}));const wj=10;function ZI(r){return typeof r!="string"?r:(r=r.toUpperCase(),Py[r]||Py.WHITE)}function xj(r,e,t){return!Ff&&typeof r=="string"&&(e&&(r=`\x1B[${ZI(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${ZI(t)+wj}m${r}\x1B[49m`)),r}function Bj(r,e=["constructor"]){const t=Object.getPrototypeOf(r),n=Object.getOwnPropertyNames(t),i=r;for(const s of n){const a=i[s];typeof a=="function"&&(e.find(o=>s===o)||(i[s]=a.bind(r)))}}function Kv(r,e){if(!r)throw new Error("Assertion failed")}function op(){let r;if(Ff()&&qI.performance)r=qI?.performance?.now?.();else if("hrtime"in KI){const e=KI?.hrtime?.();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}const ap={debug:Ff()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Cj={enabled:!0,level:0};function lp(){}const JI={},e5={once:!0};class cp{constructor({id:e}={id:""}){this.VERSION=YI,this._startTs=op(),this._deltaTs=op(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new yj(`__probe-${this.id}__`,Cj),this.timeStamp(`${this.id} started`),Bj(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((op()-this._startTs).toPrecision(10))}getDelta(){return Number((op()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,ap.warn,arguments,e5)}error(e){return this._getLogFunction(0,e,ap.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,ap.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,ap.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,ap.debug||ap.info,arguments,e5)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||lp,n&&[n],{tag:Ej(t)}):lp}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||lp)}group(e,t,n={collapsed:!1}){const i=r5({logLevel:e,message:t,opts:n}),{collapsed:s}=n;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||lp)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=t5(e)}_getLogFunction(e,t,n,i,s){if(this._shouldLog(e)){s=r5({logLevel:e,message:t,args:i,opts:s}),n=n||s.method,Kv(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=op();const a=s.tag||s.message;if(s.once&&a)if(!JI[a])JI[a]=op();else return lp;return t=Tj(this.id,s.message,s),n.bind(console,t,...s.args)}return lp}}cp.VERSION=YI;function t5(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return Kv(Number.isFinite(e)&&e>=0),e}function r5(r){const{logLevel:e,message:t}=r;r.logLevel=t5(e);const n=r.args?Array.from(r.args):[];for(;n.length&&n.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&n.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const i=typeof r.message;return Kv(i==="string"||i==="object"),Object.assign(r,{args:n},r.opts)}function Tj(r,e,t){if(typeof e=="string"){const n=t.time?vj(bj(t.total)):"";e=t.time?`${r}: ${n}  ${e}`:`${r}: ${e}`,e=xj(e,t.color,t.background)}return e}function Ej(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}globalThis.probe={};const n5=new cp({id:"@probe.gl/log"}),Xv="4.3.2",Sj=Xv[0]>="0"&&Xv[0]<="9"?`v${Xv}`:"";function Ij(){const r=new cp({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=r,globalThis.loaders.version=Sj,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=r,r}const Pj=Ij();function Mj(r,e){return i5(r||{},e)}function i5(r,e,t=0){if(t>3)return e;const n={...r};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?n[i]=i5(n[i]||{},e[i],t+1):n[i]=e[i];return n}const Fj="latest";function Rj(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const Lj=Rj();function SA(r,e){if(!r)throw new Error(e||"loaders.gl assertion failed.")}const Rf=typeof process!="object"||String(process)!=="[object process]"||process.browser,Oj=typeof window<"u"&&typeof window.orientation<"u",s5=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);s5&&parseFloat(s5[1]);class Uj{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((n,i)=>{this._resolve=n,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){SA(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){SA(this.isRunning),this.isRunning=!1,this._reject(e)}}class Yv{terminate(){}}const Zv=new Map;function Dj(r){SA(r.source&&!r.url||!r.source&&r.url);let e=Zv.get(r.source||r.url);return e||(r.url&&(e=kj(r.url),Zv.set(r.url,e)),r.source&&(e=o5(r.source),Zv.set(r.source,e))),SA(e),e}function kj(r){if(!r.startsWith("http"))return r;const e=Nj(r);return o5(e)}function o5(r){const e=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(e)}function Nj(r){return`try {
  importScripts('${r}');
} catch (error) {
  console.error(error);
  throw error;
}`}function a5(r,e=!0,t){const n=t||new Set;if(r){if(l5(r))n.add(r);else if(l5(r.buffer))n.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(e&&typeof r=="object")for(const i in r)a5(r[i],e,n)}}return t===void 0?Array.from(n):[]}function l5(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const Jv=()=>{};class ew{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Rf||typeof Yv<"u"&&!Rf}constructor(e){const{name:t,source:n,url:i}=e;SA(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=Jv,this.onError=s=>console.log(s),this.worker=Rf?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Jv,this.onError=Jv,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||a5(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=Dj({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Yv(n,{eval:!1})}else if(this.source)e=new Yv(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class zj{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return ew.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(i,s,a)=>i.done(a),n=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new Uj(t.name,e);e.onMessage=i=>t.onMessage(n,i.type,i.payload),e.onError=i=>t.onError(n,i),t.onStart(n);try{await n.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Rf||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new ew({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Oj?this.maxMobileConcurrency:this.maxConcurrency}}const Qj={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class IA{props;workerPools=new Map;static _workerFarm;static isSupported(){return ew.isSupported()}static getWorkerFarm(e={}){return IA._workerFarm=IA._workerFarm||new IA({}),IA._workerFarm.setProps(e),IA._workerFarm}constructor(e){this.props={...Qj},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let s=this.workerPools.get(t);return s||(s=new zj({name:t,source:n,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function Hj(r,e={}){const t=e[r.id]||{},n=Rf?`${r.id}-worker.js`:`${r.id}-worker-node.js`;let i=t.workerUrl;if(!i&&r.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Rf?i=`modules/${r.module}/dist/${n}`:i=`modules/${r.module}/src/workers/${r.id}-worker-node.ts`),!i){let s=r.version;s==="latest"&&(s=Fj);const a=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${r.module}${a}/dist/${n}`}return SA(i),i}function Vj(r,e=Lj){SA(r,"no worker provided");const t=r.version;return!(!e||!t)}function jj(r,e){return!IA.isSupported()||!Rf&&!e?._nodeWorkers?!1:r.worker&&e?.worker}async function $j(r,e,t,n,i){const s=r.id,a=Hj(r,t),u=IA.getWorkerFarm(t).getWorkerPool({name:s,url:a});t=JSON.parse(JSON.stringify(t)),n=JSON.parse(JSON.stringify(n||{}));const d=await u.startJob("process-on-worker",Gj.bind(null,i));return d.postMessage("process",{input:e,options:t,context:n}),await(await d.result).result}async function Gj(r,e,t,n){switch(t){case"done":e.done(n);break;case"error":e.error(new Error(n.error));break;case"process":const{id:i,input:s,options:a}=n;try{const o=await r(s,a);e.postMessage("done",{id:i,result:o})}catch(o){const u=o instanceof Error?o.message:"unknown error";e.postMessage("error",{id:i,error:u})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function Wj(r,e,t){if(t=t||r.byteLength,r.byteLength<t||e.byteLength<t)return!1;const n=new Uint8Array(r),i=new Uint8Array(e);for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}function qj(...r){return Kj(r)}function Kj(r){const e=r.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),t=e.reduce((s,a)=>s+a.byteLength,0),n=new Uint8Array(t);let i=0;for(const s of e)n.set(s,i),i+=s.byteLength;return n.buffer}async function Xj(r){const e=[];for await(const t of r)e.push(t);return qj(...e)}function c5(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}class u5{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=c5(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(c5()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class up{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(e instanceof u5?i=e:i=new u5(t,n),this.stats[t]=i),i}}let Yj="";const h5={};function Zj(r){for(const e in h5)if(r.startsWith(e)){const t=h5[e];r=r.replace(e,t)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r=`${Yj}${r}`),r}function $xe(r){return r}function Jj(r){return r&&typeof r=="object"&&r.isBuffer}function A5(r){if(Jj(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function f5(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(e+1):""}function e$(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}const t$=r=>typeof r=="boolean",nm=r=>typeof r=="function",im=r=>r!==null&&typeof r=="object",d5=r=>im(r)&&r.constructor==={}.constructor,r$=r=>!!r&&typeof r[Symbol.iterator]=="function",n$=r=>r&&typeof r[Symbol.asyncIterator]=="function",Lf=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,Of=r=>typeof Blob<"u"&&r instanceof Blob,i$=r=>r&&typeof r=="object"&&r.isBuffer,s$=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||im(r)&&nm(r.tee)&&nm(r.cancel)&&nm(r.getReader),o$=r=>im(r)&&nm(r.read)&&nm(r.pipe)&&t$(r.readable),p5=r=>s$(r)||o$(r);class a$ extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const l$=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,c$=/^([-\w.]+\/[-\w.+]+)/;function g5(r,e){return r.toLowerCase()===e.toLowerCase()}function u$(r){const e=c$.exec(r);return e?e[1]:r}function m5(r){const e=l$.exec(r);return e?e[1]:""}const _5=/\?.*/;function h$(r){const e=r.match(_5);return e&&e[0]}function tw(r){return r.replace(_5,"")}function A$(r){if(r.length<50)return r;const e=r.slice(r.length-15);return`${r.substr(0,32)}...${e}`}function My(r){return Lf(r)?r.url:Of(r)?r.name||"":typeof r=="string"?r:""}function rw(r){if(Lf(r)){const e=r,t=e.headers.get("content-type")||"",n=tw(e.url);return u$(t)||m5(n)}return Of(r)?r.type||"":typeof r=="string"?m5(r):""}function f$(r){return Lf(r)?r.headers["content-length"]||-1:Of(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function y5(r){if(Lf(r))return r;const e={},t=f$(r);t>=0&&(e["content-length"]=String(t));const n=My(r),i=rw(r);i&&(e["content-type"]=i);const s=await g$(r);s&&(e["x-first-bytes"]=s),typeof r=="string"&&(r=new TextEncoder().encode(r));const a=new Response(r,{headers:e});return Object.defineProperty(a,"url",{value:n}),a}async function d$(r){if(!r.ok)throw await p$(r)}async function p$(r){const e=A$(r.url);let t=`Failed to fetch resource (${r.status}) ${r.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const n={reason:r.statusText,url:r.url,response:r};try{const i=r.headers.get("Content-Type");n.reason=!r.bodyUsed&&i?.includes("application/json")?await r.json():await r.text()}catch{}return new a$(t,n)}async function g$(r){if(typeof r=="string")return`data:,${r.slice(0,5)}`;if(r instanceof Blob){const t=r.slice(0,5);return await new Promise(n=>{const i=new FileReader;i.onload=s=>n(s?.target?.result),i.readAsDataURL(t)})}if(r instanceof ArrayBuffer){const t=r.slice(0,5);return`data:base64,${m$(t)}`}return null}function m$(r){let e="";const t=new Uint8Array(r);for(let n=0;n<t.byteLength;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function _$(r){return!y$(r)&&!b$(r)}function y$(r){return r.startsWith("http:")||r.startsWith("https:")}function b$(r){return r.startsWith("data:")}async function b5(r,e){if(typeof r=="string"){const t=Zj(r);return _$(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await y5(r)}const v5=new cp({id:"loaders.gl"});class v${log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class w${console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const w5={fetch:null,mimeType:void 0,nothrow:!1,log:new w$,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:qv,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},x$={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function x5(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state||(r._state={}),r._state}function B5(){const r=x5();return r.globalOptions=r.globalOptions||{...w5},r.globalOptions}function B$(r,e,t,n){return t=t||[],t=Array.isArray(t)?t:[t],C$(r,t),E$(e,r,n)}function C$(r,e){C5(r,null,w5,x$,e);for(const t of e){const n=r&&r[t.id]||{},i=t.options&&t.options[t.id]||{},s=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};C5(n,t.id,i,s,e)}}function C5(r,e,t,n,i){const s=e||"Top level",a=e?`${e}.`:"";for(const o in r){const u=!e&&im(r[o]),d=o==="baseUri"&&!e,p=o==="workerUrl"&&e;if(!(o in t)&&!d&&!p){if(o in n)v5.warn(`${s} loader option '${a}${o}' no longer supported, use '${n[o]}'`)();else if(!u){const b=T$(o,i);v5.warn(`${s} loader option '${a}${o}' not recognized. ${b}`)()}}}}function T$(r,e){const t=r.toLowerCase();let n="";for(const i of e)for(const s in i.options){if(r===s)return`Did you mean '${i.id}.${s}'?`;const a=s.toLowerCase();(t.startsWith(a)||a.startsWith(t))&&(n=n||`Did you mean '${i.id}.${s}'?`)}return n}function E$(r,e,t){const i={...r.options||{}};return S$(i,t),i.log===null&&(i.log=new v$),T5(i,B5()),T5(i,e),i}function T5(r,e){for(const t in e)if(t in e){const n=e[t];d5(n)&&d5(r[t])?r[t]={...r[t],...e[t]}:r[t]=e[t]}}function S$(r,e){e&&!("baseUri"in r)&&(r.baseUri=e)}function nw(r){return r?(Array.isArray(r)&&(r=r[0]),Array.isArray(r?.extensions)):!1}function iw(r){Iy(r,"null loader"),Iy(nw(r),"invalid loader");let e;return Array.isArray(r)&&(e=r[1],r=r[0],r={...r,options:{...r.options,...e}}),(r?.parseTextSync||r?.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const E5=()=>{const r=x5();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function I$(r){const e=E5();r=Array.isArray(r)?r:[r];for(const t of r){const n=iw(t);e.find(i=>n===i)||e.unshift(n)}}function P$(){return E5()}const M$=/\.([^.]+)$/;async function F$(r,e=[],t,n){if(!I5(r))return null;let i=S5(r,e,{...t,nothrow:!0},n);if(i)return i;if(Of(r)&&(r=await r.slice(0,10).arrayBuffer(),i=S5(r,e,t,n)),!i&&!t?.nothrow)throw new Error(P5(r));return i}function S5(r,e=[],t,n){if(!I5(r))return null;if(e&&!Array.isArray(e))return iw(e);let i=[];e&&(i=i.concat(e)),t?.ignoreRegisteredLoaders||i.push(...P$()),L$(i);const s=R$(r,i,t,n);if(!s&&!t?.nothrow)throw new Error(P5(r));return s}function R$(r,e,t,n){const i=My(r),s=rw(r),a=tw(i)||n?.url;let o=null,u="";return t?.mimeType&&(o=sw(e,t?.mimeType),u=`match forced by supplied MIME type ${t?.mimeType}`),o=o||O$(e,a),u=u||(o?`matched url ${a}`:""),o=o||sw(e,s),u=u||(o?`matched MIME type ${s}`:""),o=o||D$(e,r),u=u||(o?`matched initial data ${F5(r)}`:""),t?.fallbackMimeType&&(o=o||sw(e,t?.fallbackMimeType),u=u||(o?`matched fallback MIME type ${s}`:"")),u&&Pj.log(1,`selectLoader selected ${o?.name}: ${u}.`),o}function I5(r){return!(r instanceof Response&&r.status===204)}function P5(r){const e=My(r),t=rw(r);let n="No valid loader found (";n+=e?`${f5(e)}, `:"no url provided, ",n+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const i=r?F5(r):"";return n+=i?` first bytes: "${i}"`:"first bytes: not available",n+=")",n}function L$(r){for(const e of r)iw(e)}function O$(r,e){const t=e&&M$.exec(e),n=t&&t[1];return n?U$(r,n):null}function U$(r,e){e=e.toLowerCase();for(const t of r)for(const n of t.extensions)if(n.toLowerCase()===e)return t;return null}function sw(r,e){for(const t of r)if(t.mimeTypes?.some(n=>g5(e,n))||g5(e,`application/x.${t.id}`))return t;return null}function D$(r,e){if(!e)return null;for(const t of r)if(typeof e=="string"){if(k$(e,t))return t}else if(ArrayBuffer.isView(e)){if(M5(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&M5(e,0,t))return t;return null}function k$(r,e){return e.testText?e.testText(r):(Array.isArray(e.tests)?e.tests:[e.tests]).some(n=>r.startsWith(n))}function M5(r,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>N$(r,e,t,i))}function N$(r,e,t,n){if(n instanceof ArrayBuffer)return Wj(n,r,n.byteLength);switch(typeof n){case"function":return n(r);case"string":const i=ow(r,e,n.length);return n===i;default:return!1}}function F5(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?ow(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?ow(r,0,e):""}function ow(r,e,t){if(r.byteLength<e+t)return"";const n=new DataView(r);let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(n.getUint8(e+s));return i}const z$=256*1024;function*Q$(r,e){const t=e?.chunkSize||z$;let n=0;const i=new TextEncoder;for(;n<r.length;){const s=Math.min(r.length-n,t),a=r.slice(n,n+s);n+=s,yield i.encode(a)}}const H$=256*1024;function*V$(r,e={}){const{chunkSize:t=H$}=e;let n=0;for(;n<r.byteLength;){const i=Math.min(r.byteLength-n,t),s=new ArrayBuffer(i),a=new Uint8Array(r,n,i);new Uint8Array(s).set(a),n+=i,yield s}}const j$=1024*1024;async function*$$(r,e){const t=e?.chunkSize||j$;let n=0;for(;n<r.size;){const i=n+t,s=await r.slice(n,i).arrayBuffer();n=i,yield s}}function R5(r,e){return qv?G$(r,e):W$(r)}async function*G$(r,e){const t=r.getReader();let n;try{for(;;){const i=n||t.read();e?._streamReadAhead&&(n=t.read());const{done:s,value:a}=await i;if(s)return;yield A5(a)}}catch{t.releaseLock()}}async function*W$(r,e){for await(const t of r)yield A5(t)}function q$(r,e){if(typeof r=="string")return Q$(r,e);if(r instanceof ArrayBuffer)return V$(r,e);if(Of(r))return $$(r,e);if(p5(r))return R5(r,e);if(Lf(r))return R5(r.body,e);throw new Error("makeIterator")}const L5="Cannot convert supplied data type";function K$(r,e,t){if(e.text&&typeof r=="string")return r;if(i$(r)&&(r=r.buffer),r instanceof ArrayBuffer){const n=r;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(r)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(r);let n=r.buffer;const i=r.byteLength||r.length;return(r.byteOffset!==0||i!==n.byteLength)&&(n=n.slice(r.byteOffset,r.byteOffset+i)),n}throw new Error(L5)}async function X$(r,e,t){const n=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||n)return K$(r,e);if(Of(r)&&(r=await y5(r)),Lf(r)){const i=r;return await d$(i),e.binary?await i.arrayBuffer():await i.text()}if(p5(r)&&(r=q$(r,t)),r$(r)||n$(r))return Xj(r);throw new Error(L5)}function O5(r,e){const t=B5(),n=r||t;return typeof n.fetch=="function"?n.fetch:im(n.fetch)?i=>b5(i,n.fetch):e?.fetch?e?.fetch:b5}function Y$(r,e,t){if(t)return t;const n={fetch:O5(e,r),...r};if(n.url){const i=tw(n.url);n.baseUrl=i,n.queryString=h$(n.url),n.filename=f5(i),n.baseUrl=e$(i)}return Array.isArray(n.loaders)||(n.loaders=null),n}function Z$(r,e){if(r&&!Array.isArray(r))return r;let t;if(r&&(t=Array.isArray(r)?r:[r]),e&&e.loaders){const n=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...n]:n}return t&&t.length?t:void 0}async function Fy(r,e,t,n){e&&!Array.isArray(e)&&!nw(e)&&(n=void 0,t=e,e=void 0),r=await r,t=t||{};const i=My(r),a=Z$(e,n),o=await F$(r,a,t);return o?(t=B$(t,o,a,i),n=Y$({url:i,_parse:Fy,loaders:a},t,n||null),await J$(o,r,t,n)):null}async function J$(r,e,t,n){if(Vj(r),t=Mj(r.options,t),Lf(e)){const s=e,{ok:a,redirected:o,status:u,statusText:d,type:p,url:b}=s,C=Object.fromEntries(s.headers.entries());n.response={headers:C,ok:a,redirected:o,status:u,statusText:d,type:p,url:b}}e=await X$(e,r,t);const i=r;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,t,n);if(jj(r,t))return await $j(r,e,t,n,Fy);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,n);if(i.parse)return await i.parse(e,t,n);throw SA(!i.parseSync),new Error(`${r.id} loader - no parser found and worker is disabled`)}function eG(r){let e=1/0,t=1/0,n=1/0,i=-1/0,s=-1/0,a=-1/0;const o=r.POSITION?r.POSITION.value:[],u=o&&o.length;for(let d=0;d<u;d+=3){const p=o[d],b=o[d+1],C=o[d+2];e=p<e?p:e,t=b<t?b:t,n=C<n?C:n,i=p>i?p:i,s=b>s?b:s,a=C>a?C:a}return[[e,t,n],[i,s,a]]}async function PA(r,e,t,n){let i,s;!Array.isArray(e)&&!nw(e)?(i=[],s=e):(i=e,s=t);const a=O5(s);let o=r;return typeof r=="string"&&(o=await a(r)),Of(r)&&(o=await a(r)),Array.isArray(i)?await Fy(o,i,s):await Fy(o,i,s)}const tG="4.3.2",rG=globalThis.loaders?.parseImageNode,aw=typeof Image<"u",lw=typeof ImageBitmap<"u",cw=qv?!0:!!rG;function nG(r){switch(r){case"auto":return lw||aw||cw;case"imagebitmap":return lw;case"image":return aw;case"data":return cw;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function iG(){if(lw)return"imagebitmap";if(aw)return"image";if(cw)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function sG(r){const e=aG(r);if(!e)throw new Error("Not an image");return e}function oG(r){switch(sG(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function aG(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const lG=/^data:image\/svg\+xml/,cG=/\.svg((\?|#).*)?$/;function uw(r){return r&&(lG.test(r)||cG.test(r))}function uG(r,e){if(uw(e)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return U5(r,e)}function U5(r,e){if(uw(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function D5(r,e,t){const n=uG(r,t),i=self.URL||self.webkitURL,s=typeof n!="string"&&i.createObjectURL(n);try{return await hG(s||n,e)}finally{s&&i.revokeObjectURL(s)}}async function hG(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,i)=>{try{t.onload=()=>n(t),t.onerror=s=>{const a=s instanceof Error?s.message:"error";i(new Error(a))}}catch(s){i(s)}})}const AG={};let k5=!0;async function fG(r,e,t){let n;uw(t)?n=await D5(r,e,t):n=U5(r,t);const i=e&&e.imagebitmap;return await dG(n,i)}async function dG(r,e=null){if((pG(e)||!k5)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),k5=!1}return await createImageBitmap(r)}function pG(r){for(const e in r||AG)return!1;return!0}function gG(r){return!bG(r,"ftyp",4)||(r[8]&96)===0?null:mG(r)}function mG(r){switch(_G(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function _G(r,e,t){return String.fromCharCode(...r.slice(e,t))}function yG(r){return[...r].map(e=>e.charCodeAt(0))}function bG(r,e,t=0){const n=yG(e);for(let i=0;i<n.length;++i)if(n[i]!==r[i+t])return!1;return!0}const Lu=!1,sm=!0;function N5(r){const e=om(r);return wG(e)||CG(e)||xG(e)||BG(e)||vG(e)}function vG(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=gG(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function wG(r){const e=om(r);return e.byteLength>=24&&e.getUint32(0,Lu)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Lu),height:e.getUint32(20,Lu)}:null}function xG(r){const e=om(r);return e.byteLength>=10&&e.getUint32(0,Lu)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,sm),height:e.getUint16(8,sm)}:null}function BG(r){const e=om(r);return e.byteLength>=14&&e.getUint16(0,Lu)===16973&&e.getUint32(2,sm)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,sm),height:e.getUint32(22,sm)}:null}function CG(r){const e=om(r);if(!(e.byteLength>=3&&e.getUint16(0,Lu)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=TG();let s=2;for(;s+9<e.byteLength;){const a=e.getUint16(s,Lu);if(i.has(a))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Lu),width:e.getUint16(s+7,Lu)};if(!n.has(a))return null;s+=2,s+=e.getUint16(s,Lu)}return null}function TG(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function om(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function EG(r,e){const{mimeType:t}=N5(r)||{},n=globalThis.loaders?.parseImageNode;return Iy(n),await n(r,t)}async function SG(r,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=t||{},a=IG(i);let o;switch(a){case"imagebitmap":o=await fG(r,e,s);break;case"image":o=await D5(r,e,s);break;case"data":o=await EG(r);break;default:Iy(!1)}return i==="data"&&(o=oG(o)),o}function IG(r){switch(r){case"auto":case"data":return iG();default:return nG(r),r}}const PG={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:tG,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:SG,tests:[r=>!!N5(new DataView(r))],options:{image:{type:"auto",decode:!0}}},$n=new cp({id:"deck"}),MA={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},hw=1,am=2,Aw=3,fw=4,MG=2,FG=r=>({"layer.changeFlag":(e,t,n)=>{r.log(Aw,`${e.id} ${t}: `,n[t])()},"layer.initialize":e=>{r.log(hw,`Initializing ${e}`)()},"layer.update":(e,t)=>{if(t){const n=e.getChangeFlags();r.log(am,`Updating ${e} because: ${Object.keys(n).filter(i=>n[i]).join(", ")}`)()}else r.log(fw,`${e} does not need update`)()},"layer.matched":(e,t)=>{t&&r.log(fw,`Matched ${e}, state transfered`)()},"layer.finalize":e=>{r.log(hw,`Finalizing ${e}`)()},"compositeLayer.renderLayers":(e,t,n)=>{t?r.log(am,`Composite layer rendered new subLayers ${e}`,n)():r.log(fw,`Composite layer reused subLayers ${e}`,n)()},"layerManager.setLayers":(e,t,n)=>{t&&r.log(am,`Updating ${n.length} deck layers`)()},"layerManager.activateViewport":(e,t)=>{r.log(Aw,"Viewport changed",t)()},"attributeManager.invalidate":(e,t,n)=>{r.log(hw,n?`invalidated attributes ${n} (${t}) for ${e.id}`:`invalidated all attributes for ${e.id}`)()},"attributeManager.updateStart":e=>{MA.attributeUpdateMessages.length=0,MA.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(e,t)=>{const n=Math.round(Date.now()-MA.attributeManagerUpdateStart);r.groupCollapsed(am,`Updated attributes for ${t} instances in ${e.id} in ${n}ms`)();for(const i of MA.attributeUpdateMessages)r.log(Aw,i)();r.groupEnd(am)()},"attribute.updateStart":e=>{MA.attributeUpdateStart=Date.now()},"attribute.allocate":(e,t)=>{const n=`${e.id} allocated ${t}`;MA.attributeUpdateMessages.push(n)},"attribute.updateEnd":(e,t)=>{const n=Math.round(Date.now()-MA.attributeUpdateStart),i=`${e.id} updated ${t} in ${n}ms`;MA.attributeUpdateMessages.push(i)},"deckRenderer.renderLayers":(e,t,n)=>{const{pass:i,redrawReason:s,stats:a}=n;for(const o of t){const{totalCount:u,visibleCount:d,compositeCount:p,pickableCount:b}=o,w=u-p-d;r.log(MG,`RENDER #${e.renderCount}   ${d} (of ${u} layers) to ${i} because ${s}   (${w} hidden, ${p} composite ${b} pickable)`)(),a&&a.get("Redraw Layers").add(d)}}});var RG={};let Ry={};RG.NODE_ENV!=="production"&&(Ry=FG($n));function LG(r){Ry=r}function sa(r,e,t,n){$n.level>0&&Ry[r]&&Ry[r].call(null,e,t,n)}function OG(r){const e=r[0],t=r[r.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const UG={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:OG,parseTextSync:JSON.parse};function DG(){const r="9.2.2",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==r)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${r}`);return e||($n.log(1,`deck.gl ${r}`)(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:$n,_registerLoggers:LG},I$([UG,[PG,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}const kG=DG();function dw(r,e){if(!r)throw new Error(e||"shadertools: assertion failed.")}const pw={number:{type:"number",validate(r,e){return Number.isFinite(r)&&typeof e=="object"&&(e.max===void 0||r<=e.max)&&(e.min===void 0||r>=e.min)}},array:{type:"array",validate(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function NG(r){const e={};for(const[t,n]of Object.entries(r))e[t]=zG(n);return e}function zG(r){let e=z5(r);if(e!=="object")return{value:r,...pw[e],type:e};if(typeof r=="object")return r?r.type!==void 0?{...r,...pw[r.type],type:r.type}:r.value===void 0?{type:"object",value:r}:(e=z5(r.value),{...r,...pw[e],type:e}):{type:"object",value:null};throw new Error("props")}function z5(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const QG={vertex:`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,fragment:`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`},Q5=/void\s+main\s*\([^)]*\)\s*\{\n?/,H5=/}\n?[^{}]*$/,gw=[],Ly="__LUMA_INJECT_DECLARATIONS__";function HG(r){const e={vertex:{},fragment:{}};for(const t in r){let n=r[t];const i=VG(t);typeof n=="string"&&(n={order:0,injection:n}),e[i][t]=n}return e}function VG(r){const e=r.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Oy(r,e,t,n=!1){const i=e==="vertex";for(const s in t){const a=t[s];a.sort((u,d)=>u.order-d.order),gw.length=a.length;for(let u=0,d=a.length;u<d;++u)gw[u]=a[u].injection;const o=`${gw.join(`
`)}
`;switch(s){case"vs:#decl":i&&(r=r.replace(Ly,o));break;case"vs:#main-start":i&&(r=r.replace(Q5,u=>u+o));break;case"vs:#main-end":i&&(r=r.replace(H5,u=>o+u));break;case"fs:#decl":i||(r=r.replace(Ly,o));break;case"fs:#main-start":i||(r=r.replace(Q5,u=>u+o));break;case"fs:#main-end":i||(r=r.replace(H5,u=>o+u));break;default:r=r.replace(s,u=>u+o)}}return r=r.replace(Ly,""),n&&(r=r.replace(/\}\s*$/,s=>s+QG[e])),r}function Uy(r){r.map(e=>jG(e))}function jG(r){if(r.instance)return;Uy(r.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:n={}}=r,i={normalizedInjections:HG(n),parsedDeprecations:$G(t)};e&&(i.propValidators=NG(e)),r.instance=i;let s={};e&&(s=Object.entries(e).reduce((a,[o,u])=>{const d=u?.value;return d&&(a[o]=d),a},{})),r.defaultUniforms={...r.defaultUniforms,...s}}function V5(r,e,t){r.deprecations?.forEach(n=>{n.regex?.test(e)&&(n.deprecated?t.deprecated(n.old,n.new)():t.removed(n.old,n.new)())})}function $G(r){return r.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),r}function mw(r){Uy(r);const e={},t={};j5({modules:r,level:0,moduleMap:e,moduleDepth:t});const n=Object.keys(t).sort((i,s)=>t[s]-t[i]).map(i=>e[i]);return Uy(n),n}function j5(r){const{modules:e,level:t,moduleMap:n,moduleDepth:i}=r;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)n[s.name]=s,(i[s.name]===void 0||i[s.name]<t)&&(i[s.name]=t);for(const s of e)s.dependencies&&j5({modules:s.dependencies,level:t+1,moduleMap:n,moduleDepth:i})}function GG(r){switch(r?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function WG(r,e){if(Number(r.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return r=G5(r,qG),r;case"fragment":return r=G5(r,KG),r;default:throw new Error(e)}}const $5=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],qG=[...$5,[_w("attribute"),"in $1"],[_w("varying"),"out $1"]],KG=[...$5,[_w("varying"),"in $1"]];function G5(r,e){for(const[t,n]of e)r=r.replace(t,n);return r}function _w(r){return new RegExp(`\\b${r}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function W5(r,e){let t="";for(const n in r){const i=r[n];if(t+=`void ${i.signature} {
`,i.header&&(t+=`  ${i.header}`),e[n]){const s=e[n];s.sort((a,o)=>a.order-o.order);for(const a of s)t+=`  ${a.injection}
`}i.footer&&(t+=`  ${i.footer}`),t+=`}
`}return t}function q5(r){const e={vertex:{},fragment:{}};for(const t of r){let n,i;typeof t!="string"?(n=t,i=n.hook):(n={},i=t),i=i.trim();const[s,a]=i.split(":"),o=i.replace(/\(.+/,""),u=Object.assign(n,{signature:a});switch(s){case"vs":e.vertex[o]=u;break;case"fs":e.fragment[o]=u;break;default:throw new Error(s)}}return e}function XG(r,e){return{name:YG(r,e),language:"glsl",version:ZG(r)}}function YG(r,e="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(r);return n?n[1]:e}function ZG(r){let e=100;const t=r.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const n=parseInt(t[1],10);Number.isFinite(n)&&(e=n)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const K5=`

${Ly}
`,JG=`precision highp float;
`;function eW(r){const e=mw(r.modules||[]);return{source:rW(r.platformInfo,{...r,source:r.source,stage:"vertex",modules:e}),getUniforms:Y5(e)}}function tW(r){const{vs:e,fs:t}=r,n=mw(r.modules||[]);return{vs:X5(r.platformInfo,{...r,source:e,stage:"vertex",modules:n}),fs:X5(r.platformInfo,{...r,source:t,stage:"fragment",modules:n}),getUniforms:Y5(n)}}function rW(r,e){const{source:t,stage:n,modules:i,hookFunctions:s=[],inject:a={},log:o}=e;dw(typeof t=="string","shader source must be a string");const u=t;let d="";const p=q5(s),b={},C={},w={};for(const P in a){const k=typeof a[P]=="string"?{injection:a[P],order:0}:a[P],D=/^(v|f)s:(#)?([\w-]+)$/.exec(P);if(D){const j=D[2],H=D[3];j?H==="decl"?C[P]=[k]:w[P]=[k]:b[P]=[k]}else w[P]=[k]}const M=i;for(const P of M){o&&V5(P,u,o);const k=Z5(P,"wgsl");d+=k;const D=P.injections?.[n]||{};for(const j in D){const H=/^(v|f)s:#([\w-]+)$/.exec(j);if(H){const q=H[2]==="decl"?C:w;q[j]=q[j]||[],q[j].push(D[j])}else b[j]=b[j]||[],b[j].push(D[j])}}return d+=K5,d=Oy(d,n,C),d+=W5(p[n],b),d+=u,d=Oy(d,n,w),d}function X5(r,e){const{source:t,stage:n,language:i="glsl",modules:s,defines:a={},hookFunctions:o=[],inject:u={},prologue:d=!0,log:p}=e;dw(typeof t=="string","shader source must be a string");const b=i==="glsl"?XG(t).version:-1,C=r.shaderLanguageVersion,w=b===100?"#version 100":"#version 300 es",P=t.split(`
`).slice(1).join(`
`),k={};s.forEach(W=>{Object.assign(k,W.defines)}),Object.assign(k,a);let D="";switch(i){case"wgsl":break;case"glsl":D=d?`${w}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${n.toUpperCase()}`}

${GG(r)}
${n==="fragment"?JG:""}

// ----- APPLICATION DEFINES -------------------------

${nW(k)}

`:`${w}
`;break}const j=q5(o),H={},N={},q={};for(const W in u){const ie=typeof u[W]=="string"?{injection:u[W],order:0}:u[W],se=/^(v|f)s:(#)?([\w-]+)$/.exec(W);if(se){const Z=se[2],fe=se[3];Z?fe==="decl"?N[W]=[ie]:q[W]=[ie]:H[W]=[ie]}else q[W]=[ie]}for(const W of s){p&&V5(W,P,p);const ie=Z5(W,n);D+=ie;const se=W.instance?.normalizedInjections[n]||{};for(const Z in se){const fe=/^(v|f)s:#([\w-]+)$/.exec(Z);if(fe){const ce=fe[2]==="decl"?N:q;ce[Z]=ce[Z]||[],ce[Z].push(se[Z])}else H[Z]=H[Z]||[],H[Z].push(se[Z])}}return D+="// ----- MAIN SHADER SOURCE -------------------------",D+=K5,D=Oy(D,n,N),D+=W5(j[n],H),D+=P,D=Oy(D,n,q),i==="glsl"&&b!==C&&(D=WG(D,n)),D.trim()}function Y5(r){return function(t){const n={};for(const i of r){const s=i.getUniforms?.(t,n);Object.assign(n,s)}return n}}function nW(r={}){let e="";for(const t in r){const n=r[t];(n||Number.isFinite(n))&&(e+=`#define ${t.toUpperCase()} ${r[t]}
`)}return e}function Z5(r,e){let t;switch(e){case"vertex":t=r.vs||"";break;case"fragment":t=r.fs||"";break;case"wgsl":t=r.source||"";break;default:dw(!1)}if(!r.name)throw new Error("Shader module must have a name");const n=r.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${r.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${n}
`),i+=`${t}
`,i}const iW=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,sW=/^\s*\#\s*endif\s*$/;function oW(r,e){const t=r.split(`
`),n=[];let i=!0,s=null;for(const a of t){const o=a.match(iW),u=a.match(sW);o?(s=o[1],i=!!e?.defines?.[s]):u?i=!0:i&&n.push(a)}return n.join(`
`)}class Uf{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Uf.defaultShaderAssembler=Uf.defaultShaderAssembler||new Uf,Uf.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,{source:i,getUniforms:s}=eW({...e,source:e.source,modules:t,hookFunctions:n});return{source:e.platformInfo.shaderLanguage==="wgsl"?oW(i):i,getUniforms:s,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),n=this._hookFunctions;return{...tW({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:n}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let s=0,a=this._defaultModules.length;s<a;++s){const o=this._defaultModules[s],u=o.name;t[i++]=o,n[u]=!0}for(let s=0,a=e.length;s<a;++s){const o=e[s],u=o.name;n[u]||(t[i++]=o,n[u]=!0)}return t.length=i,Uy(t),t}}const aW=`#version 300 es
out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`;function lW(r){const{input:e,inputChannels:t,output:n}={};if(!e)return aW;if(!t)throw new Error("inputChannels");const i=cW(t),s=uW(e,t);return`#version 300 es
in ${i} ${e};
out vec4 ${n};
void main() {
  ${n} = ${s};
}`}function cW(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${r}`)}}function uW(r,e){switch(e){case 1:return`vec4(${r}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${r}, 0.0, 1.0)`;case 3:return`vec4(${r}, 1.0)`;case 4:return r;default:throw new Error(`invalid channels: ${e}`)}}class hW{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new up({id:e})),this.stats.get(e)}}const J5=new hW,Xt=new cp({id:"luma.gl"}),yw={};function Dy(r="id"){yw[r]=yw[r]||1;const e=yw[r]++;return`${r}-${e}`}let Ei=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,n){if(!e)throw new Error("no device");this._device=e,this.props=AW(t,n);const i=this.props.id!=="undefined"?this.props.id:Dy(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function AW(r,e){const t={...e};for(const n in r)r[n]!==void 0&&(t[n]=r[n]);return t}let bs=class Fv extends Ei{static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const n={...t};(t.usage||0)&Fv.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?n.indexType="uint32":t.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(e,n,Fv.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,n){const i=ArrayBuffer.isView(e)?e.buffer:e,s=Math.min(e?e.byteLength:n,Fv.DEBUG_DATA_MAX_LENGTH);i===null?this.debugData=new ArrayBuffer(s):t===0&&n===i.byteLength?this.debugData=i.slice(0,s):this.debugData=i.slice(t,t+s)}static defaultProps={...Ei.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}};function eP(r){const[e,t,n]=ww[r],i=r.includes("norm"),s=!i&&!r.startsWith("float"),a=r.startsWith("s");return{signedType:e,primitiveType:t,byteLength:n,normalized:i,integer:s,signed:a}}function fW(r){const e=r;switch(e){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return e}}function dW(r,e){switch(e){case 1:return r;case 2:return r+r%2;default:return r+(4-r%4)%4}}function bw(r){const e=ArrayBuffer.isView(r)?r.constructor:r;if(e===Uint8ClampedArray)return"uint8";const t=Object.values(ww).find(n=>e===n[4]);if(!t)throw new Error(e.name);return t[0]}function vw(r){const[,,,,e]=ww[r];return e}const ww={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function xw(r){let e;r.endsWith("-webgl")&&(r.replace("-webgl",""),e=!0);const[t,n]=r.split("x"),i=t,s=n?parseInt(n):1,a=eP(i),o={type:i,components:s,byteLength:a.byteLength*s,integer:a.integer,signed:a.signed,normalized:a.normalized};return e&&(o.webglOnly=!0),o}function pW(r,e,t){const n=t?fW(r):r;switch(n){case"unorm8":return e===1?"unorm8":e===3?"unorm8x3-webgl":`${n}x${e}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(e===1||e===3)throw new Error(`size: ${e}`);return`${n}x${e}`;default:return e===1?n:`${n}x${e}`}}function gW(r,e,t){if(!e||e>4)throw new Error(`size ${e}`);const n=e,i=bw(r);return pW(i,n,t)}function mW(r){let e;switch(r.primitiveType){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return r.components<=2?"float16x2":"float16x4"}return r.components===1?e:`${e}x${r.components}`}const oa="texture-compression-bc",Si="texture-compression-astc",Ou="texture-compression-etc2",_W="texture-compression-etc1-webgl",ky="texture-compression-pvrtc-webgl",Bw="texture-compression-atc-webgl",Ny="float32-renderable-webgl",Cw="float16-renderable-webgl",yW="rgb9e5ufloat-renderable-webgl",Tw="snorm8-renderable-webgl",lm="norm16-renderable-webgl",Ew="snorm16-renderable-webgl",zy="float32-filterable",tP="float16-filterable-webgl";function rP(r){const e=bW[r];if(!e)throw new Error(`Unsupported texture format ${r}`);return e}const bW={...{r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:Tw},rg8snorm:{render:Tw},"rgb8snorm-webgl":{},rgba8snorm:{render:Tw},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:lm},rg16unorm:{render:lm},"rgb16unorm-webgl":{f:lm},rgba16unorm:{render:lm},r16snorm:{f:Ew},rg16snorm:{render:Ew},"rgb16snorm-webgl":{f:lm},rgba16snorm:{render:Ew},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:Cw,filter:"float16-filterable-webgl"},rg16float:{render:Cw,filter:tP},rgba16float:{render:Cw,filter:tP},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:Ny,filter:zy},rg32float:{render:!1,filter:zy},"rgb32float-webgl":{render:Ny,filter:zy},rgba32float:{render:Ny,filter:zy},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:yW},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Ny},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},...{"bc1-rgb-unorm-webgl":{f:oa},"bc1-rgb-unorm-srgb-webgl":{f:oa},"bc1-rgba-unorm":{f:oa},"bc1-rgba-unorm-srgb":{f:oa},"bc2-rgba-unorm":{f:oa},"bc2-rgba-unorm-srgb":{f:oa},"bc3-rgba-unorm":{f:oa},"bc3-rgba-unorm-srgb":{f:oa},"bc4-r-unorm":{f:oa},"bc4-r-snorm":{f:oa},"bc5-rg-unorm":{f:oa},"bc5-rg-snorm":{f:oa},"bc6h-rgb-ufloat":{f:oa},"bc6h-rgb-float":{f:oa},"bc7-rgba-unorm":{f:oa},"bc7-rgba-unorm-srgb":{f:oa},"etc2-rgb8unorm":{f:Ou},"etc2-rgb8unorm-srgb":{f:Ou},"etc2-rgb8a1unorm":{f:Ou},"etc2-rgb8a1unorm-srgb":{f:Ou},"etc2-rgba8unorm":{f:Ou},"etc2-rgba8unorm-srgb":{f:Ou},"eac-r11unorm":{f:Ou},"eac-r11snorm":{f:Ou},"eac-rg11unorm":{f:Ou},"eac-rg11snorm":{f:Ou},"astc-4x4-unorm":{f:Si},"astc-4x4-unorm-srgb":{f:Si},"astc-5x4-unorm":{f:Si},"astc-5x4-unorm-srgb":{f:Si},"astc-5x5-unorm":{f:Si},"astc-5x5-unorm-srgb":{f:Si},"astc-6x5-unorm":{f:Si},"astc-6x5-unorm-srgb":{f:Si},"astc-6x6-unorm":{f:Si},"astc-6x6-unorm-srgb":{f:Si},"astc-8x5-unorm":{f:Si},"astc-8x5-unorm-srgb":{f:Si},"astc-8x6-unorm":{f:Si},"astc-8x6-unorm-srgb":{f:Si},"astc-8x8-unorm":{f:Si},"astc-8x8-unorm-srgb":{f:Si},"astc-10x5-unorm":{f:Si},"astc-10x5-unorm-srgb":{f:Si},"astc-10x6-unorm":{f:Si},"astc-10x6-unorm-srgb":{f:Si},"astc-10x8-unorm":{f:Si},"astc-10x8-unorm-srgb":{f:Si},"astc-10x10-unorm":{f:Si},"astc-10x10-unorm-srgb":{f:Si},"astc-12x10-unorm":{f:Si},"astc-12x10-unorm-srgb":{f:Si},"astc-12x12-unorm":{f:Si},"astc-12x12-unorm-srgb":{f:Si},"pvrtc-rgb4unorm-webgl":{f:ky},"pvrtc-rgba4unorm-webgl":{f:ky},"pvrtc-rbg2unorm-webgl":{f:ky},"pvrtc-rgba2unorm-webgl":{f:ky},"etc1-rbg-unorm-webgl":{f:_W},"atc-rgb-unorm-webgl":{f:Bw},"atc-rgba-unorm-webgl":{f:Bw},"atc-rgbai-unorm-webgl":{f:Bw}}},vW=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],wW=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class xW{getInfo(e){return nP(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return vW.some(t=>e.startsWith(t))}getCapabilities(e){const t=rP(e),n={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},i=nP(e),s=e.startsWith("depth")||e.startsWith("stencil"),a=i?.signed,o=i?.integer,u=i?.webgl;return n.render&&=!a,n.filter&&=!s&&!a&&!o&&!u,n}}const hp=new xW;function nP(r){let e=BW(r);if(hp.isCompressed(r)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const n=CW(r);n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight)}const t=wW.exec(r);if(t){const[,n,i,s,a,o]=t,u=`${s}${i}`,d=eP(u),p=d.byteLength*8,b=n.length,C=[p,b>=2?p:0,b>=3?p:0,b>=4?p:0];e={format:r,attachment:e.attachment,dataType:d.signedType,components:b,channels:n,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:C,bytesPerPixel:d.byteLength*n.length,packed:e.packed,srgb:e.srgb},o==="-webgl"&&(e.webgl=!0),a==="-srgb"&&(e.srgb=!0)}return r.endsWith("-webgl")&&(e.webgl=!0),r.endsWith("-srgb")&&(e.srgb=!0),e}function BW(r){const e=rP(r),t=e.bytesPerPixel||1,n=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:r,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:n,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function CW(r){const t=/.*-(\d+)x(\d+)-.*/.exec(r);if(t){const[,n,i]=t;return{blockWidth:Number(n),blockHeight:Number(i)}}return null}function TW(r){return typeof ImageData<"u"&&r instanceof ImageData||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement||typeof VideoFrame<"u"&&r instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas}function EW(r){if(typeof ImageData<"u"&&r instanceof ImageData||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas)return{width:r.width,height:r.height};if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)return{width:r.naturalWidth,height:r.naturalHeight};if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)return{width:r.videoWidth,height:r.videoHeight};if(typeof VideoFrame<"u"&&r instanceof VideoFrame)return{width:r.displayWidth,height:r.displayHeight};throw new Error("Unknown image type")}class SW{}class IW{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class Df{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{const[n,i]=e.getDevicePixelSize();Xt.log(1,`${e} resized => ${n}x${i}px`)()},onPositionChange:(e,t)=>{const[n,i]=e.getPosition();Xt.log(1,`${e} repositioned => ${n},${i}`)()},onVisibilityChange:e=>Xt.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>Xt.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:Xt.get("debug")||void 0,debugShaders:Xt.get("debug-shaders")||void 0,debugFramebuffers:!!Xt.get("debug-framebuffers"),debugFactories:!!Xt.get("debug-factories"),debugWebGL:!!Xt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=J5;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(e){this.props={...Df.defaultProps,...e},this.id=this.props.id||Dy(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(e){return xw(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return hp.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const n=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(n),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,n=1){const i=Math.max(e,t,n);return 1+Math.floor(Math.log2(i))}isExternalImage(e){return TW(e)}getExternalImageSize(e){return EW(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return hp.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(e){this.commandEncoder?.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...n){return this.props.onError(e,t)?()=>{}:Xt.error(e.message,t,...n)}debug(){if(this.props.debug)debugger;else Xt.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=hp.getCapabilities(e),n=s=>(typeof s=="string"?this.features.has(s):s)??!0,i=n(t.create);return{format:e,create:i,render:i&&n(t.render),filter:i&&n(t.filter),blend:i&&n(t.blend),store:i&&n(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&bs.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array&&(t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}}const PW="set luma.log.level=1 (or higher) to trace rendering",iP="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class Qy{static defaultProps={...Df.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=J5;log=Xt;VERSION="9.2.3";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Xt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Xt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Xt.error("This version of luma.gl has already been initialized")()}Xt.log(1,`${this.VERSION} - ${PW}`)(),globalThis.luma=this}async createDevice(e={}){const t={...Qy.defaultProps,...e},n=this.selectAdapter(t.type,t.adapters);if(!n)throw new Error(iP);return t.waitForPageLoad&&await n.pageLoaded,await n.create(t)}async attachDevice(e,t){const n=this._getTypeFromHandle(e,t.adapters),i=n&&this.selectAdapter(n,t.adapters);if(!i)throw new Error(iP);return await i?.attach?.(e,t)}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this._getAdapterMap(e);return Array.from(t).map(([,n])=>n).filter(n=>n.isSupported?.()).map(n=>n.type)}getBestAvailableAdapterType(e=[]){const t=["webgpu","webgl","null"],n=this._getAdapterMap(e);for(const i of t)if(n.get(i)?.isSupported?.())return i;return null}selectAdapter(e,t=[]){let n=e;e==="best-available"&&(n=this.getBestAvailableAdapterType(t));const i=this._getAdapterMap(t);return n&&i.get(n)||null}enforceWebGL2(e=!0,t=[]){const i=this._getAdapterMap(t).get("webgl");i||Xt.warn("enforceWebGL2: webgl adapter not found")(),i?.enforceWebGL2?.(e)}setDefaultDeviceProps(e){Object.assign(Qy.defaultProps,e)}_getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const n of e)t.set(n.type,n);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&e instanceof GPUDevice||e?.queue?"webgpu":e===null?"null":(e instanceof WebGLRenderingContext?Xt.warn("WebGL1 is not supported",e)():Xt.warn("Unknown handle type",e)(),null)}}const Sw=new Qy;class MW{get pageLoaded(){return LW()}}const FW=Ff()&&typeof document<"u",RW=()=>FW&&document.readyState==="complete";let Hy=null;function LW(){return Hy||(RW()||typeof window>"u"?Hy=Promise.resolve():Hy=new Promise(r=>window.addEventListener("load",()=>r()))),Hy}function OW(){let r,e;return{promise:new Promise((n,i)=>{r=n,e=i}),resolve:r,reject:e}}class kf{static isHTMLCanvas(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1};id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=OW();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...kf.defaultProps,...e},e=this.props,this.initialized=this._initializedResolvers.promise,Ff()?e.canvas?typeof e.canvas=="string"?this.canvas=DW(e.canvas):this.canvas=e.canvas:this.canvas=kW(e):this.canvas={width:e.width||1,height:e.height||1},kf.isHTMLCanvas(this.canvas)?(this.id=e.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):kf.isOffscreenCanvas(this.canvas)?(this.id=e.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=e.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],kf.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(t=>this._handleIntersection(t)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(t=>this._handleResize(t));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,t){this.canvas.width=e,this.canvas.height=t,this.drawingBufferWidth=e,this.drawingBufferHeight=t}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(e,t=!0){const n=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return NW(e,n,i,s,t)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,t]=this.getDevicePixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[t]=this.getCSSSize();return t?e/t:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}_handleIntersection(e){const t=e.find(i=>i.target===this.canvas);if(!t)return;const n=t.isIntersecting;this.isVisible!==n&&(this.isVisible=n,this.device.props.onVisibilityChange(this))}_handleResize(e){const t=e.find(u=>u.target===this.canvas);if(!t)return;this.cssWidth=t.contentBoxSize[0].inlineSize,this.cssHeight=t.contentBoxSize[0].blockSize;const n=this.getDevicePixelSize(),i=t.devicePixelContentBoxSize?.[0].inlineSize||t.contentBoxSize[0].inlineSize*devicePixelRatio,s=t.devicePixelContentBoxSize?.[0].blockSize||t.contentBoxSize[0].blockSize*devicePixelRatio,[a,o]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(i,a)),this.devicePixelHeight=Math.max(1,Math.min(s,o)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:n})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const t=setInterval(()=>{this.destroyed?clearInterval(t):this.updatePosition()},e)}updatePosition(){const e=this.htmlCanvas?.getBoundingClientRect();if(e){const t=[e.left,e.top];if(this._position??=t,t[0]!==this._position[0]||t[1]!==this._position[1]){const i=this._position;this._position=t,this.device.props.onPositionChange?.(this,{oldPosition:i})}}}}function UW(r){if(typeof r=="string"){const e=document.getElementById(r);if(!e)throw new Error(`${r} is not an HTML element`);return e}return r||document.body}function DW(r){const e=document.getElementById(r);if(!kf.isHTMLCanvas(e))throw new Error("Object is not a canvas element");return e}function kW(r){const{width:e,height:t}=r,n=document.createElement("canvas");n.id=Dy("lumagl-auto-created-canvas"),n.width=e||1,n.height=t||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(t)?`${t}px`:"100%",r?.visible||(n.style.visibility="hidden");const i=UW(r?.container||null);return i.insertBefore(n,i.firstChild),n}function NW(r,e,t,n,i){const s=r,a=sP(s[0],e,t);let o=oP(s[1],e,n,i),u=sP(s[0]+1,e,t);const d=u===t-1?u:u-1;u=oP(s[1]+1,e,n,i);let p;return i?(u=u===0?u:u+1,p=o,o=u):p=u===n-1?u:u-1,{x:a,y:o,width:Math.max(d-a+1,1),height:Math.max(p-o+1,1)}}function sP(r,e,t){return Math.min(Math.round(r*e),t-1)}function oP(r,e,t,n){return n?Math.max(0,t-1-Math.round(r*e)):Math.min(Math.round(r*e),t-1)}class Nf extends Ei{static defaultProps={...Ei.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=Nf.normalizeProps(e,t),super(e,t,Nf.defaultProps)}static normalizeProps(e,t){return t}}const zW={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class Ks extends Ei{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(e,t){if(t=Ks.normalizeProps(e,t),super(e,t,Ks.defaultProps),this.dimension=this.props.dimension,this.baseDimension=zW[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(e.isExternalImage(t.data)){const n=e.getExternalImageSize(t.data);this.width=n?.width||1,this.height=n?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&Xt.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=e.incrementTimestamp()}setSampler(e){this.sampler=e instanceof Nf?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){const n={...t},{width:i,height:s}=n;return typeof i=="number"&&(n.width=Math.max(1,Math.ceil(i))),typeof s=="number"&&(n.height=Math.max(1,Math.ceil(s))),n}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(e){const{width:t,height:n,depth:i}=this,s={...Ks.defaultCopyDataOptions,width:t,height:n,depth:i,...e},a=this.device.getTextureFormatInfo(this.format);if(!e.bytesPerRow&&!a.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return s.bytesPerRow=e.bytesPerRow||t*(a.bytesPerPixel||4),s.rowsPerImage=e.rowsPerImage||n,s}_normalizeCopyExternalImageOptions(e){const t=this.device.getExternalImageSize(e.image),n={...Ks.defaultCopyExternalImageOptions,...t,...e};return n.width=Math.min(n.width,this.width-n.x),n.height=Math.min(n.height,this.height-n.y),n}static defaultProps={...Ei.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:Ks.TEXTURE|Ks.RENDER_ATTACHMENT|Ks.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}class Vy extends Ei{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Vy.defaultProps)}static defaultProps={...Ei.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}function QW(r,e,t){let n="";const i=e.split(/\r?\n/),s=r.slice().sort((a,o)=>a.lineNum-o.lineNum);switch(t?.showSourceCode||"no"){case"all":let a=0;for(let o=1;o<=i.length;o++)for(n+=aP(i[o-1],o,t);s.length>a&&s[a].lineNum===o;){const u=s[a++];n+=Iw(u,i,u.lineNum,{...t,inlineSource:!1})}for(;s.length>a;){const o=s[a++];n+=Iw(o,[],0,{...t,inlineSource:!1})}return n;case"issues":case"no":for(const o of r)n+=Iw(o,i,o.lineNum,{inlineSource:t?.showSourceCode!=="no"});return n}}function Iw(r,e,t,n){if(n?.inlineSource){const s=HW(e,t),a=r.linePos>0?`${" ".repeat(r.linePos+5)}^^^
`:"";return`
${s}${a}${r.type.toUpperCase()}: ${r.message}

`}const i=r.type==="error"?"red":"#8B4000";return n?.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${r.type.toUpperCase()}: ${r.message}</b></div>`:`${r.type.toUpperCase()}: ${r.message}`}function HW(r,e,t){let n="";for(let i=e-2;i<=e;i++){const s=r[i-1];s!==void 0&&(n+=aP(s,e,t))}return n}function aP(r,e,t){const n=t?.html?jW(r):r;return`${VW(String(e),4)}: ${n}${t?.html?"<br/>":`
`}`}function VW(r,e){let t="";for(let n=r.length;n<e;++n)t+=" ";return t+r}function jW(r){return r.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class jy extends Ei{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:$W(t),...t},jy.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){if(typeof document>"u"||!document?.createElement)return;const n=t,i=`${this.stage} shader "${n}"`;let s=QW(e,this.source,{showSourceCode:"all",html:!0});const a=this.getTranslatedSource();a&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${a}</pre></code>`);const o=document.createElement("Button");o.innerHTML=`
<h1>Compilation error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),o.onclick=()=>{const d=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(d)}}static defaultProps={...Ei.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}function $W(r){return GW(r.source)||r.id||Dy(`unnamed ${r.stage}-shader`)}function GW(r,e="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(r);return n?n[1]:e}class $y extends Ei{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,$y.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(i=>i.texture.clone(e)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:n})}resize(e){let t=!e;if(e){const[n,i]=Array.isArray(e)?e:[e.width,e.height];t=t||i!==this.height||n!==this.width,this.width=n,this.height=i}t&&(Xt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,n)=>{if(typeof t=="string"){const i=this.createColorTexture(t,n);return this.attachResource(i),i.view}return t instanceof Ks?t.view:t});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof Ks?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:Ks.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Ks.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const i=this.colorAttachments[n].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}static defaultProps={...Ei.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}}class zf extends Ei{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,zf.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...Ei.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}class Qf extends Ei{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Qf.normalizeProps(e,t),super(e,t,Qf.defaultProps)}static normalizeProps(e,t){return t}static defaultProps={...Ei.defaultProps,framebuffer:null,parameters:void 0,clearColor:Qf.defaultClearColor,clearColors:void 0,clearDepth:Qf.defaultClearDepth,clearStencil:Qf.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}}class Gy extends Ei{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,Gy.defaultProps),this.shaderLayout=t.shaderLayout}static defaultProps={...Ei.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class Pw extends Ei{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,Pw.defaultProps)}static defaultProps={...Ei.defaultProps,measureExecutionTime:void 0}}class Mw extends Ei{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Mw.defaultProps)}static defaultProps={...Ei.defaultProps}}function lP(r){return XW[r]}function WW(r){const[e,t]=KW[r],n=e==="i32"||e==="u32",i=e!=="u32",s=qW[e]*t;return{primitiveType:e,components:t,byteLength:s,integer:n,signed:i}}const qW={f32:4,f16:2,i32:4,u32:4},KW={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},XW={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function cP(r,e){const t={};for(const n of r.attributes){const i=ZW(r,e,n.name);i&&(t[n.name]=i)}return t}function YW(r,e,t=16){const n=cP(r,e),i=new Array(t).fill(null);for(const s of Object.values(n))i[s.location]=s;return i}function ZW(r,e,t){const n=JW(r,t),i=eq(e,t);if(!n)return null;const s=WW(n.type),a=mW(s),o=i?.vertexFormat||a,u=xw(o);return{attributeName:i?.attributeName||n.name,bufferName:i?.bufferName||n.name,location:n.location,shaderType:n.type,primitiveType:s.primitiveType,shaderComponents:s.components,vertexFormat:o,bufferDataType:u.type,bufferComponents:u.components,normalized:u.normalized,integer:s.integer,stepMode:i?.stepMode||n.stepMode||"vertex",byteOffset:i?.byteOffset||0,byteStride:i?.byteStride||0}}function JW(r,e){const t=r.attributes.find(n=>n.name===e);return t||Xt.warn(`shader layout attribute "${e}" not present in shader`),t||null}function eq(r,e){tq(r);let t=rq(r,e);return t||(t=nq(r,e),t)?t:(Xt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function tq(r){for(const e of r)(e.attributes&&e.format||!e.attributes&&!e.format)&&Xt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function rq(r,e){for(const t of r)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function nq(r,e){for(const t of r){let n=t.byteStride;if(typeof t.byteStride!="number")for(const s of t.attributes||[]){const a=xw(s.format);n+=a.byteLength}const i=t.attributes?.find(s=>s.attribute===e);if(i)return{attributeName:i.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:n}}return null}class Fw extends Ei{static defaultProps={...Ei.defaultProps,shaderLayout:void 0,bufferLayout:[]};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,Fw.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=YW(t.shaderLayout,t.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"),this)()}}class Rw extends Ei{static defaultProps={...Ei.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Rw.defaultProps)}}class Lw extends Ei{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Lw.defaultProps)}static defaultProps={...Ei.defaultProps,type:void 0,count:void 0}}let Wy;function uP(r){return(!Wy||Wy.byteLength<r)&&(Wy=new ArrayBuffer(r)),Wy}function iq(r,e){const t=uP(r.BYTES_PER_ELEMENT*e);return new r(t,0,e)}function sq(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function qy(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":sq(r)}const oq=1024;class aq{layout={};byteLength;constructor(e,t={}){let n=0;for(const[s,a]of Object.entries(e)){const o=lP(a),{type:u,components:d}=o,p=d*(t?.[s]??1);n=dW(n,p);const b=n;n+=p,this.layout[s]={type:u,size:p,offset:b}}n+=(4-n%4)%4;const i=n*4;this.byteLength=Math.max(i,oq)}getData(e){const t=uP(this.byteLength),n={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[i,s]of Object.entries(e)){const a=this.layout[i];if(!a){Xt.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}const{type:o,size:u,offset:d}=a,p=n[o];if(u===1){if(typeof s!="number"&&typeof s!="boolean"){Xt.warn(`Supplied value for single component uniform ${i} is not a number: ${s}`)();continue}p[d]=Number(s)}else{if(!qy(s)){Xt.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${s}`)();continue}p.set(s,d)}}return new Uint8Array(t,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function lq(r,e,t=16){if(r!==e)return!1;const n=r,i=e;if(!qy(n))return!1;if(qy(i)&&n.length===i.length){for(let s=0;s<n.length;++s)if(i[s]!==n[s])return!1}return!0}function cq(r){return qy(r)?r.slice():r}class uq{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(i=>i.type==="uniform"&&i.name===e?.name);if(!t)throw new Error(e?.name);const n=t;for(const i of n.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){lq(this.uniforms[e],t)||(this.uniforms[e]=cq(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class hq{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,n]of Object.entries(e)){const i=t,s=new aq(n.uniformTypes??{},n.uniformSizes??{});this.uniformBufferLayouts.set(i,s);const a=new uq({name:t});a.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(i,a)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,n]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:bs.UNIFORM|bs.COPY_DST,byteLength:i}),a=this.getUniformBufferData(t);return s.write(a),s}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:bs.UNIFORM|bs.COPY_DST,byteLength:n});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||=n}return e&&Xt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let n=this.uniformBuffers.get(e),i=!1;if(n&&t?.needsRedraw){i||=t.needsRedraw;const s=this.getUniformBufferData(e);n=this.uniformBuffers.get(e),n?.write(s);const a=this.uniformBlocks.get(e)?.getAllUniforms();Xt.log(4,`Writing to uniform buffer ${String(e)}`,s,a)()}return i}}class Xl{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class hP{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class FA extends Xl{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class RA extends Xl{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class Ow extends Xl{constructor(e,t,n){super(e,n),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}let Hf=class extends Xl{constructor(e,t,n,i){super(e,n),this.format=t,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}};var LA;(r=>{r[r.Uniform=0]="Uniform",r[r.Storage=1]="Storage",r[r.Texture=2]="Texture",r[r.Sampler=3]="Sampler",r[r.StorageTexture=4]="StorageTexture"})(LA||(LA={}));class Ky{constructor(e,t,n,i,s,a,o){this.name=e,this.type=t,this.group=n,this.binding=i,this.attributes=s,this.resourceType=a,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Aq{constructor(e,t){this.name=e,this.type=t}}class fq{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i,this.interpolation=null}}let AP=class{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i}};class dq{constructor(e,t,n,i){this.name=e,this.type=t,this.attributes=n,this.id=i}}class pq{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class gq{constructor(e,t=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class mq{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function _q(r){var e=(32768&r)>>15,t=(31744&r)>>10,n=1023&r;return t==0?(e?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):t==31?n?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+n/Math.pow(2,10))}const fP=new Float32Array(1),yq=new Int32Array(fP.buffer),aa=new Uint16Array(1);function bq(r){fP[0]=r;const e=yq[0],t=e>>31&1;let n=e>>23&255,i=8388607&e;if(n===255)return aa[0]=t<<15|31744|(i!==0?512:0),aa[0];if(n===0){if(i===0)return aa[0]=t<<15,aa[0];i|=8388608;let s=113;for(;!(8388608&i);)i<<=1,s--;return n=127-s,i&=8388607,n>0?(i=(i>>126-n)+(i>>127-n&1),aa[0]=t<<15|n<<10|i>>13,aa[0]):(aa[0]=t<<15,aa[0])}return n=n-127+15,n>=31?(aa[0]=t<<15|31744,aa[0]):n<=0?n<-10?(aa[0]=t<<15,aa[0]):(i=(8388608|i)>>1-n,aa[0]=t<<15|i>>13,aa[0]):(i>>=13,aa[0]=t<<15|n<<10|i,aa[0])}const Uw=new Uint32Array(1),dP=new Float32Array(Uw.buffer,0,1);function pP(r){const e=112+(r>>6&31)<<23|(63&r)<<17;return Uw[0]=e,dP[0]}function vq(r,e,t,n,i,s,a,o,u){const d=n*(a>>=i)*(s>>=i)+t*a+e*o;switch(u){case"r8unorm":return[ui(r,d,"8unorm",1)[0]];case"r8snorm":return[ui(r,d,"8snorm",1)[0]];case"r8uint":return[ui(r,d,"8uint",1)[0]];case"r8sint":return[ui(r,d,"8sint",1)[0]];case"rg8unorm":{const p=ui(r,d,"8unorm",2);return[p[0],p[1]]}case"rg8snorm":{const p=ui(r,d,"8snorm",2);return[p[0],p[1]]}case"rg8uint":{const p=ui(r,d,"8uint",2);return[p[0],p[1]]}case"rg8sint":{const p=ui(r,d,"8sint",2);return[p[0],p[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const p=ui(r,d,"8unorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8snorm":{const p=ui(r,d,"8snorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8uint":{const p=ui(r,d,"8uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba8sint":{const p=ui(r,d,"8sint",4);return[p[0],p[1],p[2],p[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const p=ui(r,d,"8unorm",4);return[p[2],p[1],p[0],p[3]]}case"r16uint":return[ui(r,d,"16uint",1)[0]];case"r16sint":return[ui(r,d,"16sint",1)[0]];case"r16float":return[ui(r,d,"16float",1)[0]];case"rg16uint":{const p=ui(r,d,"16uint",2);return[p[0],p[1]]}case"rg16sint":{const p=ui(r,d,"16sint",2);return[p[0],p[1]]}case"rg16float":{const p=ui(r,d,"16float",2);return[p[0],p[1]]}case"rgba16uint":{const p=ui(r,d,"16uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16sint":{const p=ui(r,d,"16sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16float":{const p=ui(r,d,"16float",4);return[p[0],p[1],p[2],p[3]]}case"r32uint":return[ui(r,d,"32uint",1)[0]];case"r32sint":return[ui(r,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[ui(r,d,"32float",1)[0]];case"rg32uint":{const p=ui(r,d,"32uint",2);return[p[0],p[1]]}case"rg32sint":{const p=ui(r,d,"32sint",2);return[p[0],p[1]]}case"rg32float":{const p=ui(r,d,"32float",2);return[p[0],p[1]]}case"rgba32uint":{const p=ui(r,d,"32uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32sint":{const p=ui(r,d,"32sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32float":{const p=ui(r,d,"32float",4);return[p[0],p[1],p[2],p[3]]}case"rg11b10ufloat":{const p=new Uint32Array(r.buffer,d,1)[0],b=(4192256&p)>>11,C=(4290772992&p)>>22;return[pP(2047&p),pP(b),function(w){const M=112+(w>>5&31)<<23|(31&w)<<18;return Uw[0]=M,dP[0]}(C),1]}}return null}function ui(r,e,t,n){const i=[0,0,0,0];for(let s=0;s<n;++s)switch(t){case"8unorm":i[s]=r[e]/255,e++;break;case"8snorm":i[s]=r[e]/255*2-1,e++;break;case"8uint":i[s]=r[e],e++;break;case"8sint":i[s]=r[e]-127,e++;break;case"16uint":i[s]=r[e]|r[e+1]<<8,e+=2;break;case"16sint":i[s]=(r[e]|r[e+1]<<8)-32768,e+=2;break;case"16float":i[s]=_q(r[e]|r[e+1]<<8),e+=2;break;case"32uint":case"32sint":i[s]=r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24,e+=4;break;case"32float":i[s]=new Float32Array(r.buffer,e,1)[0],e+=4}return i}function pi(r,e,t,n,i){for(let s=0;s<n;++s)switch(t){case"8unorm":r[e]=255*i[s],e++;break;case"8snorm":r[e]=.5*(i[s]+1)*255,e++;break;case"8uint":r[e]=i[s],e++;break;case"8sint":r[e]=i[s]+127,e++;break;case"16uint":new Uint16Array(r.buffer,e,1)[0]=i[s],e+=2;break;case"16sint":new Int16Array(r.buffer,e,1)[0]=i[s],e+=2;break;case"16float":{const a=bq(i[s]);new Uint16Array(r.buffer,e,1)[0]=a,e+=2;break}case"32uint":new Uint32Array(r.buffer,e,1)[0]=i[s],e+=4;break;case"32sint":new Int32Array(r.buffer,e,1)[0]=i[s],e+=4;break;case"32float":new Float32Array(r.buffer,e,1)[0]=i[s],e+=4}return i}const Dw={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};let Uu=class F9{constructor(){this.id=F9._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Xy.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t(Yy.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}};Uu._id=0;class Xy extends Uu{}Xy.instance=new Xy;let Yy=class extends Uu{};Yy.instance=new Yy;const gP=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);let rs=class extends Uu{constructor(){super()}},cm=class extends rs{constructor(e,t,n,i,s,a){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=i,this.startLine=s,this.endLine=a}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}},wq=class extends rs{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}};class mP extends rs{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class kw extends rs{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class _P extends rs{constructor(e,t,n,i){super(),this.init=e,this.condition=t,this.increment=n,this.body=i}get astNodeType(){return"for"}search(e){var t,n,i;(t=this.init)===null||t===void 0||t.search(e),(n=this.condition)===null||n===void 0||n.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}let Fh=class extends rs{constructor(e,t,n,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}},Nw=class extends rs{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}},um=class extends rs{constructor(e,t,n,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}},Zy=class extends rs{constructor(e,t,n,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=i,this.value=s}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}};var Ap,hm,St,dt;(r=>{r.increment="++",r.decrement="--"})(Ap||(Ap={})),(r=>{r.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return r[t]}})(Ap||(Ap={}));let yP=class extends rs{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}};(r=>{r.assign="=",r.addAssign="+=",r.subtractAssin="-=",r.multiplyAssign="*=",r.divideAssign="/=",r.moduloAssign="%=",r.andAssign="&=",r.orAssign="|=",r.xorAssign="^=",r.shiftLeftAssign="<<=",r.shiftRightAssign=">>="})(hm||(hm={})),(r=>{r.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(hm||(hm={}));let bP=class extends rs{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}},zw=class extends rs{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return gP.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}},vP=class extends rs{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}},wP=class extends rs{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}},xP=class extends rs{constructor(e,t,n,i){super(),this.condition=e,this.body=t,this.elseif=n,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}},BP=class extends rs{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}},xq=class extends rs{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}},Bq=class extends rs{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}},CP=class extends rs{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}},Qw=class extends rs{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}},Cq=class extends rs{constructor(){super()}get astNodeType(){return"discard"}},TP=class extends rs{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}},EP=class extends rs{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}},Jt=class Rv extends rs{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const i=Rv._priority.get(t.name);Rv._priority.get(e[n].name)<i&&(t=e[n])}return t.name==="x32"?Rv.i32:t}getTypeName(){return this.name}};Jt.x32=new Jt("x32"),Jt.f32=new Jt("f32"),Jt.i32=new Jt("i32"),Jt.u32=new Jt("u32"),Jt.f16=new Jt("f16"),Jt.bool=new Jt("bool"),Jt.void=new Jt("void"),Jt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);let SP=class extends Jt{constructor(e){super(e)}},Rh=class extends Jt{constructor(e,t,n,i){super(e),this.members=t,this.startLine=n,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}},vt=class extends Jt{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}};vt.vec2f=new vt("vec2",Jt.f32,null),vt.vec3f=new vt("vec3",Jt.f32,null),vt.vec4f=new vt("vec4",Jt.f32,null),vt.vec2i=new vt("vec2",Jt.i32,null),vt.vec3i=new vt("vec3",Jt.i32,null),vt.vec4i=new vt("vec4",Jt.i32,null),vt.vec2u=new vt("vec2",Jt.u32,null),vt.vec3u=new vt("vec3",Jt.u32,null),vt.vec4u=new vt("vec4",Jt.u32,null),vt.vec2h=new vt("vec2",Jt.f16,null),vt.vec3h=new vt("vec3",Jt.f16,null),vt.vec4h=new vt("vec4",Jt.f16,null),vt.vec2b=new vt("vec2",Jt.bool,null),vt.vec3b=new vt("vec3",Jt.bool,null),vt.vec4b=new vt("vec4",Jt.bool,null),vt.mat2x2f=new vt("mat2x2",Jt.f32,null),vt.mat2x3f=new vt("mat2x3",Jt.f32,null),vt.mat2x4f=new vt("mat2x4",Jt.f32,null),vt.mat3x2f=new vt("mat3x2",Jt.f32,null),vt.mat3x3f=new vt("mat3x3",Jt.f32,null),vt.mat3x4f=new vt("mat3x4",Jt.f32,null),vt.mat4x2f=new vt("mat4x2",Jt.f32,null),vt.mat4x3f=new vt("mat4x3",Jt.f32,null),vt.mat4x4f=new vt("mat4x4",Jt.f32,null),vt.mat2x2h=new vt("mat2x2",Jt.f16,null),vt.mat2x3h=new vt("mat2x3",Jt.f16,null),vt.mat2x4h=new vt("mat2x4",Jt.f16,null),vt.mat3x2h=new vt("mat3x2",Jt.f16,null),vt.mat3x3h=new vt("mat3x3",Jt.f16,null),vt.mat3x4h=new vt("mat3x4",Jt.f16,null),vt.mat4x2h=new vt("mat4x2",Jt.f16,null),vt.mat4x3h=new vt("mat4x3",Jt.f16,null),vt.mat4x4h=new vt("mat4x4",Jt.f16,null),vt.mat2x2i=new vt("mat2x2",Jt.i32,null),vt.mat2x3i=new vt("mat2x3",Jt.i32,null),vt.mat2x4i=new vt("mat2x4",Jt.i32,null),vt.mat3x2i=new vt("mat3x2",Jt.i32,null),vt.mat3x3i=new vt("mat3x3",Jt.i32,null),vt.mat3x4i=new vt("mat3x4",Jt.i32,null),vt.mat4x2i=new vt("mat4x2",Jt.i32,null),vt.mat4x3i=new vt("mat4x3",Jt.i32,null),vt.mat4x4i=new vt("mat4x4",Jt.i32,null),vt.mat2x2u=new vt("mat2x2",Jt.u32,null),vt.mat2x3u=new vt("mat2x3",Jt.u32,null),vt.mat2x4u=new vt("mat2x4",Jt.u32,null),vt.mat3x2u=new vt("mat3x2",Jt.u32,null),vt.mat3x3u=new vt("mat3x3",Jt.u32,null),vt.mat3x4u=new vt("mat3x4",Jt.u32,null),vt.mat4x2u=new vt("mat4x2",Jt.u32,null),vt.mat4x3u=new vt("mat4x3",Jt.u32,null),vt.mat4x4u=new vt("mat4x4",Jt.u32,null);let Jy=class extends Jt{constructor(e,t,n,i){super(e),this.storage=t,this.type=n,this.access=i}get astNodeType(){return"pointer"}},Am=class extends Jt{constructor(e,t,n,i){super(e),this.attributes=t,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}},fm=class extends Jt{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}},Rc=class extends Uu{constructor(){super(),this.postfix=null}},Vf=class extends Rc{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}},Du=class extends Rc{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}},Hw=class extends Rc{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return gP.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}},bl=class extends Rc{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}},IP=class extends Rc{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const n=e.evalExpression(this.initializer,e.context);return n!==null&&this.postfix?n.getSubData(e,this.postfix,e.context):n}return null}search(e){this.initializer.search(e)}},mo=class extends Rc{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof gt}get isVector(){return this.value instanceof ze||this.value instanceof _n}get scalarValue(){return this.value instanceof gt?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof ze||this.value instanceof _n?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}},PP=class extends Rc{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}},fp=class extends Rc{constructor(e){super(),this.index=e}search(e){this.index.search(e)}},MP=class extends Rc{constructor(){super()}},Xs=class extends MP{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}},Lc=class extends MP{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?Jt.f32:e.name==="u32"||t.name==="u32"?Jt.u32:Jt.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}},FP=class extends Uu{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}},e0=class extends Rc{constructor(){super()}get astNodeType(){return"default"}},RP=class extends FP{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}},LP=class extends FP{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}},OP=class extends Uu{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}},Tq=class extends Uu{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},UP=class extends Uu{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}},DP=class extends Uu{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}},ku=class R9{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=R9._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,n,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}};ku._id=0;let Vw=class extends ku{constructor(){super(new Xl("void",null),null)}toString(){return"void"}};Vw.void=new Vw;let dp=class extends ku{constructor(e){super(new Ow("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,i){this.reference.setDataValue(e,t,n,i)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}toString(){return`&${this.reference.toString()}`}},gt=class my extends ku{constructor(e,t,n=null){super(t,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new my(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new my(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new my(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,n,i){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(t instanceof my))return void console.error("SetDataValue: Invalid value",t);let s=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,t,n){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}};function Eq(r,e,t){const n=e.length;return n===2?t==="f32"?new ze(new Float32Array(e),r.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new ze(new Int32Array(e),r.getTypeInfo("vec2i")):t==="u32"?new ze(new Uint32Array(e),r.getTypeInfo("vec2u")):t==="f16"?new ze(new Float32Array(e),r.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):n===3?t==="f32"?new ze(new Float32Array(e),r.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new ze(new Int32Array(e),r.getTypeInfo("vec3i")):t==="u32"?new ze(new Uint32Array(e),r.getTypeInfo("vec3u")):t==="f16"?new ze(new Float32Array(e),r.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):n===4?t==="f32"?new ze(new Float32Array(e),r.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new ze(new Int32Array(e),r.getTypeInfo("vec4i")):t==="u32"?new ze(new Uint32Array(e),r.getTypeInfo("vec4u")):t==="f16"?new ze(new Float32Array(e),r.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}let ze=class _y extends ku{constructor(e,t,n=null){if(super(t,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new _y(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new _y(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new _y(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,n,i){n instanceof Vf?console.error("TODO: Set vector postfix"):t instanceof _y?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(t===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Hf)i=this.typeInfo.format||i;else{const a=this.typeInfo.name;a==="vec2f"||a==="vec3f"||a==="vec4f"?i=e.getTypeInfo("f32"):a==="vec2i"||a==="vec3i"||a==="vec4i"?i=e.getTypeInfo("i32"):a==="vec2b"||a==="vec3b"||a==="vec4b"?i=e.getTypeInfo("bool"):a==="vec2u"||a==="vec3u"||a==="vec4u"?i=e.getTypeInfo("u32"):a==="vec2h"||a==="vec3h"||a==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${a}`)}let s=this;for(;t!==null&&s!==null;){if(t instanceof fp){const a=t.index;let o=-1;if(a instanceof mo){if(!(a.value instanceof gt))return console.error(`GetSubData: Invalid array index ${a.value}`),null;o=a.value.value}else{const u=e.evalExpression(a,n);if(!(u instanceof gt))return console.error("GetSubData: Unknown index type",a),null;o=u.value}if(o<0||o>=s.data.length)return console.error("GetSubData: Index out of range",o),null;if(s.data instanceof Float32Array){const u=new Float32Array(s.data.buffer,s.data.byteOffset+4*o,1);return new gt(u,i)}if(s.data instanceof Int32Array){const u=new Int32Array(s.data.buffer,s.data.byteOffset+4*o,1);return new gt(u,i)}if(s.data instanceof Uint32Array){const u=new Uint32Array(s.data.buffer,s.data.byteOffset+4*o,1);return new gt(u,i)}throw"GetSubData: Invalid data type"}if(!(t instanceof Vf))return console.error("GetSubData: Unknown postfix",t),null;{const a=t.value.toLowerCase();if(a.length===1){let u=0;if(a==="x"||a==="r")u=0;else if(a==="y"||a==="g")u=1;else if(a==="z"||a==="b")u=2;else{if(a!=="w"&&a!=="a")return console.error(`GetSubData: Unknown member ${a}`),null;u=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new gt(d,i,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new gt(d,i,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new gt(d,i,this)}}const o=[];for(const u of a)u==="x"||u==="r"?o.push(this.data[0]):u==="y"||u==="g"?o.push(this.data[1]):u==="z"||u==="b"?o.push(this.data[2]):u==="w"||u==="a"?o.push(this.data[3]):console.error(`GetDataValue: Unknown member ${u}`);s=Eq(e,o,i.name)}t=t.postfix}return s}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}},_n=class LI extends ku{constructor(e,t,n=null){super(t,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new LI(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,n,i){n instanceof Vf?console.error("TODO: Set matrix postfix"):t instanceof LI?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(t===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Hf)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(t instanceof fp){const s=t.index;let a=-1;if(s instanceof mo){if(!(s.value instanceof gt))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;a=s.value.value}else{const d=e.evalExpression(s,n);if(!(d instanceof gt))return console.error("GetDataValue: Unknown index type",s),null;a=d.value}if(a<0||a>=this.data.length)return console.error("GetDataValue: Index out of range",a),null;const o=i.endsWith("h")?"h":"f";let u;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")u=new ze(new Float32Array(this.data.buffer,this.data.byteOffset+2*a*4,2),e.getTypeInfo(`vec2${o}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")u=new ze(new Float32Array(this.data.buffer,this.data.byteOffset+3*a*4,3),e.getTypeInfo(`vec3${o}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;u=new ze(new Float32Array(this.data.buffer,this.data.byteOffset+4*a*4,4),e.getTypeInfo(`vec4${o}`))}return t.postfix?u.getSubData(e,t.postfix,n):u}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}},Fo=class Lv extends ku{constructor(e,t,n=0,i=null){super(t,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Lv(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,i){if(t===null)return void console.log("setDataValue: NULL data.");let s=this.offset,a=this.typeInfo;for(;n;){if(n instanceof fp)if(a instanceof RA){const o=n.index;if(o instanceof mo){if(!(o.value instanceof gt))return void console.error(`SetDataValue: Invalid index type ${o.value}`);s+=o.value.value*a.stride}else{const u=e.evalExpression(o,i);if(!(u instanceof gt))return void console.error("SetDataValue: Unknown index type",o);s+=u.value*a.stride}a=a.format}else console.error(`SetDataValue: Type ${a.getTypeName()} is not an array`);else{if(!(n instanceof Vf))return void console.error("SetDataValue: Unknown postfix type",n);{const o=n.value;if(a instanceof FA){let u=!1;for(const d of a.members)if(d.name===o){s+=d.offset,a=d.type,u=!0;break}if(!u)return void console.error(`SetDataValue: Member ${o} not found`)}else if(a instanceof Xl){const u=a.getTypeName();let d=0;if(o==="x"||o==="r")d=0;else if(o==="y"||o==="g")d=1;else if(o==="z"||o==="b")d=2;else{if(o!=="w"&&o!=="a")return void console.error(`SetDataValue: Unknown member ${o}`);d=3}if(!(t instanceof gt))return void console.error("SetDataValue: Invalid value",t);const p=t.value;return u==="vec2f"?void(new Float32Array(this.buffer,s,2)[d]=p):u==="vec3f"?void(new Float32Array(this.buffer,s,3)[d]=p):u==="vec4f"?void(new Float32Array(this.buffer,s,4)[d]=p):u==="vec2i"?void(new Int32Array(this.buffer,s,2)[d]=p):u==="vec3i"?void(new Int32Array(this.buffer,s,3)[d]=p):u==="vec4i"?void(new Int32Array(this.buffer,s,4)[d]=p):u==="vec2u"?void(new Uint32Array(this.buffer,s,2)[d]=p):u==="vec3u"?void(new Uint32Array(this.buffer,s,3)[d]=p):u==="vec4u"?void(new Uint32Array(this.buffer,s,4)[d]=p):void console.error(`SetDataValue: Type ${u} is not a struct`)}}}n=n.postfix}this.setData(e,t,a,s,i)}setData(e,t,n,i,s){const a=n.getTypeName();if(a!=="f32"&&a!=="f16")if(a!=="i32"&&a!=="atomic<i32>"&&a!=="x32")if(a!=="u32"&&a!=="atomic<u32>")if(a!=="bool"){if(a==="vec2f"||a==="vec2h"){const o=new Float32Array(this.buffer,i,2);return void(t instanceof ze?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1]))}if(a==="vec3f"||a==="vec3h"){const o=new Float32Array(this.buffer,i,3);return void(t instanceof ze?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2]))}if(a==="vec4f"||a==="vec4h"){const o=new Float32Array(this.buffer,i,4);return void(t instanceof ze?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(a==="vec2i"){const o=new Int32Array(this.buffer,i,2);return void(t instanceof ze?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1]))}if(a==="vec3i"){const o=new Int32Array(this.buffer,i,3);return void(t instanceof ze?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2]))}if(a==="vec4i"){const o=new Int32Array(this.buffer,i,4);return void(t instanceof ze?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(a==="vec2u"){const o=new Uint32Array(this.buffer,i,2);return void(t instanceof ze?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1]))}if(a==="vec3u"){const o=new Uint32Array(this.buffer,i,3);return void(t instanceof ze?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2]))}if(a==="vec4u"){const o=new Uint32Array(this.buffer,i,4);return void(t instanceof ze?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(a==="vec2b"){const o=new Uint32Array(this.buffer,i,2);return void(t instanceof ze?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1]))}if(a==="vec3b"){const o=new Uint32Array(this.buffer,i,3);return void(t instanceof ze?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2]))}if(a==="vec4b"){const o=new Uint32Array(this.buffer,i,4);return void(t instanceof ze?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(a==="mat2x2f"||a==="mat2x2h"){const o=new Float32Array(this.buffer,i,4);return void(t instanceof _n?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(a==="mat2x3f"||a==="mat2x3h"){const o=new Float32Array(this.buffer,i,6);return void(t instanceof _n?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5]))}if(a==="mat2x4f"||a==="mat2x4h"){const o=new Float32Array(this.buffer,i,8);return void(t instanceof _n?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7]))}if(a==="mat3x2f"||a==="mat3x2h"){const o=new Float32Array(this.buffer,i,6);return void(t instanceof _n?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5]))}if(a==="mat3x3f"||a==="mat3x3h"){const o=new Float32Array(this.buffer,i,9);return void(t instanceof _n?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8]))}if(a==="mat3x4f"||a==="mat3x4h"){const o=new Float32Array(this.buffer,i,12);return void(t instanceof _n?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8],o[9]=t.data[9],o[10]=t.data[10],o[11]=t.data[11]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11]))}if(a==="mat4x2f"||a==="mat4x2h"){const o=new Float32Array(this.buffer,i,8);return void(t instanceof _n?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7]))}if(a==="mat4x3f"||a==="mat4x3h"){const o=new Float32Array(this.buffer,i,12);return void(t instanceof _n?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8],o[9]=t.data[9],o[10]=t.data[10],o[11]=t.data[11]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11]))}if(a==="mat4x4f"||a==="mat4x4h"){const o=new Float32Array(this.buffer,i,16);return void(t instanceof _n?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8],o[9]=t.data[9],o[10]=t.data[10],o[11]=t.data[11],o[12]=t.data[12],o[13]=t.data[13],o[14]=t.data[14],o[15]=t.data[15]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]))}if(t instanceof Lv){if(n===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",a,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${a}`)}else t instanceof gt&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof gt&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof gt&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof gt&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getSubData(e,t,n){var i,s,a;if(t===null)return this;let o=this.offset,u=this.typeInfo;for(;t;){if(t instanceof fp){const p=t.index,b=p instanceof Rc?e.evalExpression(p,n):p;let C=0;if(b instanceof gt?C=b.value:typeof b=="number"?C=b:console.error("GetDataValue: Invalid index type",p),u instanceof RA)o+=C*u.stride,u=u.format;else{const w=u.getTypeName();w==="mat4x4"||w==="mat4x4f"||w==="mat4x4h"?(o+=16*C,u=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${u.getTypeName()} is not an array`)}}else{if(!(t instanceof Vf))return console.error("GetDataValue: Unknown postfix type",t),null;{const p=t.value;if(u instanceof FA){let b=!1;for(const C of u.members)if(C.name===p){o+=C.offset,u=C.type,b=!0;break}if(!b)return console.error(`GetDataValue: Member ${p} not found`),null}else if(u instanceof Xl){const b=u.getTypeName();if(b==="vec2f"||b==="vec3f"||b==="vec4f"||b==="vec2i"||b==="vec3i"||b==="vec4i"||b==="vec2u"||b==="vec3u"||b==="vec4u"||b==="vec2b"||b==="vec3b"||b==="vec4b"||b==="vec2h"||b==="vec3h"||b==="vec4h"||b==="vec2"||b==="vec3"||b==="vec4"){if(p.length>0&&p.length<5){let C="f";const w=[];for(let M=0;M<p.length;++M){const P=p[M].toLowerCase();let k=0;if(P==="x"||P==="r")k=0;else if(P==="y"||P==="g")k=1;else if(P==="z"||P==="b")k=2;else{if(P!=="w"&&P!=="a")return console.error(`Unknown member ${p}`),null;k=3}if(p.length===1){if(b.endsWith("f"))return this.buffer.byteLength<o+4*k+4?(console.log("Insufficient buffer data"),null):new gt(new Float32Array(this.buffer,o+4*k,1),e.getTypeInfo("f32"),this);if(b.endsWith("h"))return new gt(new Float32Array(this.buffer,o+4*k,1),e.getTypeInfo("f16"),this);if(b.endsWith("i"))return new gt(new Int32Array(this.buffer,o+4*k,1),e.getTypeInfo("i32"),this);if(b.endsWith("b"))return new gt(new Int32Array(this.buffer,o+4*k,1),e.getTypeInfo("bool"),this);if(b.endsWith("u"))return new gt(new Uint32Array(this.buffer,o+4*k,1),e.getTypeInfo("i32"),this)}if(b==="vec2f")w.push(new Float32Array(this.buffer,o,2)[k]);else if(b==="vec3f"){if(o+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const D=new Float32Array(this.buffer,o,3);w.push(D[k])}else if(b==="vec4f")w.push(new Float32Array(this.buffer,o,4)[k]);else if(b==="vec2i")C="i",w.push(new Int32Array(this.buffer,o,2)[k]);else if(b==="vec3i")C="i",w.push(new Int32Array(this.buffer,o,3)[k]);else if(b==="vec4i")C="i",w.push(new Int32Array(this.buffer,o,4)[k]);else if(b==="vec2u"){C="u";const D=new Uint32Array(this.buffer,o,2);w.push(D[k])}else b==="vec3u"?(C="u",w.push(new Uint32Array(this.buffer,o,3)[k])):b==="vec4u"&&(C="u",w.push(new Uint32Array(this.buffer,o,4)[k]))}return w.length===2?u=e.getTypeInfo(`vec2${C}`):w.length===3?u=e.getTypeInfo(`vec3${C}`):w.length===4?u=e.getTypeInfo(`vec4${C}`):console.error(`GetDataValue: Invalid vector length ${w.length}`),new ze(w,u,null)}return console.error(`GetDataValue: Unknown member ${p}`),null}return console.error(`GetDataValue: Type ${b} is not a struct`),null}}}t=t.postfix}const d=u.getTypeName();return d==="f32"?new gt(new Float32Array(this.buffer,o,1),u,this):d==="i32"?new gt(new Int32Array(this.buffer,o,1),u,this):d==="u32"?new gt(new Uint32Array(this.buffer,o,1),u,this):d==="vec2f"?new ze(new Float32Array(this.buffer,o,2),u,this):d==="vec3f"?new ze(new Float32Array(this.buffer,o,3),u,this):d==="vec4f"?new ze(new Float32Array(this.buffer,o,4),u,this):d==="vec2i"?new ze(new Int32Array(this.buffer,o,2),u,this):d==="vec3i"?new ze(new Int32Array(this.buffer,o,3),u,this):d==="vec4i"?new ze(new Int32Array(this.buffer,o,4),u,this):d==="vec2u"?new ze(new Uint32Array(this.buffer,o,2),u,this):d==="vec3u"?new ze(new Uint32Array(this.buffer,o,3),u,this):d==="vec4u"?new ze(new Uint32Array(this.buffer,o,4),u,this):u instanceof Hf&&u.name==="atomic"?((i=u.format)===null||i===void 0?void 0:i.name)==="u32"?new gt(new Uint32Array(this.buffer,o,1)[0],u.format,this):((s=u.format)===null||s===void 0?void 0:s.name)==="i32"?new gt(new Int32Array(this.buffer,o,1)[0],u.format,this):(console.error(`GetDataValue: Invalid atomic format ${(a=u.format)===null||a===void 0?void 0:a.name}`),null):new Lv(this.buffer,u,o,this)}toString(){let e="";if(this.typeInfo instanceof RA)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof FA?e+="{...}":e="[...]";return e}},jf=class L9 extends ku{constructor(e,t,n,i){super(t,null),this.data=e,this.descriptor=n,this.view=i}clone(){return new L9(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(e=n[0])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.width)!==null&&t!==void 0?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(e=n[1])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(e=n[2])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=Dw[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Dw[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Dw[e],n=this.width;if(!e||n<=0||!t)return-1;const i=this.height,s=this.depthOrArrayLayers,a=this.dimension;return n/t.blockWidth*(a==="1d"?1:i/t.blockHeight)*t.bytesPerBlock*s}getPixel(e,t,n=0,i=0){const s=this.texelByteSize,a=this.bytesPerRow,o=this.height,u=this.data[i];return vq(new Uint8Array(u),e,t,n,i,o,a,s,this.format)}setPixel(e,t,n,i,s){const a=this.texelByteSize,o=this.bytesPerRow,u=this.height,d=this.data[i];(function(p,b,C,w,M,P,k,D,j,H){const N=w*(k>>=M)*(P>>=M)+C*k+b*D;switch(j){case"r8unorm":return void pi(p,N,"8unorm",1,H);case"r8snorm":return void pi(p,N,"8snorm",1,H);case"r8uint":return void pi(p,N,"8uint",1,H);case"r8sint":return void pi(p,N,"8sint",1,H);case"rg8unorm":return void pi(p,N,"8unorm",2,H);case"rg8snorm":return void pi(p,N,"8snorm",2,H);case"rg8uint":return void pi(p,N,"8uint",2,H);case"rg8sint":return void pi(p,N,"8sint",2,H);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void pi(p,N,"8unorm",4,H);case"rgba8snorm":return void pi(p,N,"8snorm",4,H);case"rgba8uint":return void pi(p,N,"8uint",4,H);case"rgba8sint":return void pi(p,N,"8sint",4,H);case"r16uint":return void pi(p,N,"16uint",1,H);case"r16sint":return void pi(p,N,"16sint",1,H);case"r16float":return void pi(p,N,"16float",1,H);case"rg16uint":return void pi(p,N,"16uint",2,H);case"rg16sint":return void pi(p,N,"16sint",2,H);case"rg16float":return void pi(p,N,"16float",2,H);case"rgba16uint":return void pi(p,N,"16uint",4,H);case"rgba16sint":return void pi(p,N,"16sint",4,H);case"rgba16float":return void pi(p,N,"16float",4,H);case"r32uint":return void pi(p,N,"32uint",1,H);case"r32sint":return void pi(p,N,"32sint",1,H);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void pi(p,N,"32float",1,H);case"rg32uint":return void pi(p,N,"32uint",2,H);case"rg32sint":return void pi(p,N,"32sint",2,H);case"rg32float":return void pi(p,N,"32float",2,H);case"rgba32uint":return void pi(p,N,"32uint",4,H);case"rgba32sint":return void pi(p,N,"32sint",4,H);case"rgba32float":return void pi(p,N,"32float",4,H);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),e,t,n,i,u,o,a,this.format,s)}};(r=>{r[r.token=0]="token",r[r.keyword=1]="keyword",r[r.reserved=2]="reserved"})(dt||(dt={}));let pt=class{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}},Pe=class{};St=Pe,Pe.none=new pt("",dt.reserved,""),Pe.eof=new pt("EOF",dt.token,""),Pe.reserved={asm:new pt("asm",dt.reserved,"asm"),bf16:new pt("bf16",dt.reserved,"bf16"),do:new pt("do",dt.reserved,"do"),enum:new pt("enum",dt.reserved,"enum"),f16:new pt("f16",dt.reserved,"f16"),f64:new pt("f64",dt.reserved,"f64"),handle:new pt("handle",dt.reserved,"handle"),i8:new pt("i8",dt.reserved,"i8"),i16:new pt("i16",dt.reserved,"i16"),i64:new pt("i64",dt.reserved,"i64"),mat:new pt("mat",dt.reserved,"mat"),premerge:new pt("premerge",dt.reserved,"premerge"),regardless:new pt("regardless",dt.reserved,"regardless"),typedef:new pt("typedef",dt.reserved,"typedef"),u8:new pt("u8",dt.reserved,"u8"),u16:new pt("u16",dt.reserved,"u16"),u64:new pt("u64",dt.reserved,"u64"),unless:new pt("unless",dt.reserved,"unless"),using:new pt("using",dt.reserved,"using"),vec:new pt("vec",dt.reserved,"vec"),void:new pt("void",dt.reserved,"void")},Pe.keywords={array:new pt("array",dt.keyword,"array"),atomic:new pt("atomic",dt.keyword,"atomic"),bool:new pt("bool",dt.keyword,"bool"),f32:new pt("f32",dt.keyword,"f32"),i32:new pt("i32",dt.keyword,"i32"),mat2x2:new pt("mat2x2",dt.keyword,"mat2x2"),mat2x3:new pt("mat2x3",dt.keyword,"mat2x3"),mat2x4:new pt("mat2x4",dt.keyword,"mat2x4"),mat3x2:new pt("mat3x2",dt.keyword,"mat3x2"),mat3x3:new pt("mat3x3",dt.keyword,"mat3x3"),mat3x4:new pt("mat3x4",dt.keyword,"mat3x4"),mat4x2:new pt("mat4x2",dt.keyword,"mat4x2"),mat4x3:new pt("mat4x3",dt.keyword,"mat4x3"),mat4x4:new pt("mat4x4",dt.keyword,"mat4x4"),ptr:new pt("ptr",dt.keyword,"ptr"),sampler:new pt("sampler",dt.keyword,"sampler"),sampler_comparison:new pt("sampler_comparison",dt.keyword,"sampler_comparison"),struct:new pt("struct",dt.keyword,"struct"),texture_1d:new pt("texture_1d",dt.keyword,"texture_1d"),texture_2d:new pt("texture_2d",dt.keyword,"texture_2d"),texture_2d_array:new pt("texture_2d_array",dt.keyword,"texture_2d_array"),texture_3d:new pt("texture_3d",dt.keyword,"texture_3d"),texture_cube:new pt("texture_cube",dt.keyword,"texture_cube"),texture_cube_array:new pt("texture_cube_array",dt.keyword,"texture_cube_array"),texture_multisampled_2d:new pt("texture_multisampled_2d",dt.keyword,"texture_multisampled_2d"),texture_storage_1d:new pt("texture_storage_1d",dt.keyword,"texture_storage_1d"),texture_storage_2d:new pt("texture_storage_2d",dt.keyword,"texture_storage_2d"),texture_storage_2d_array:new pt("texture_storage_2d_array",dt.keyword,"texture_storage_2d_array"),texture_storage_3d:new pt("texture_storage_3d",dt.keyword,"texture_storage_3d"),texture_depth_2d:new pt("texture_depth_2d",dt.keyword,"texture_depth_2d"),texture_depth_2d_array:new pt("texture_depth_2d_array",dt.keyword,"texture_depth_2d_array"),texture_depth_cube:new pt("texture_depth_cube",dt.keyword,"texture_depth_cube"),texture_depth_cube_array:new pt("texture_depth_cube_array",dt.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new pt("texture_depth_multisampled_2d",dt.keyword,"texture_depth_multisampled_2d"),texture_external:new pt("texture_external",dt.keyword,"texture_external"),u32:new pt("u32",dt.keyword,"u32"),vec2:new pt("vec2",dt.keyword,"vec2"),vec3:new pt("vec3",dt.keyword,"vec3"),vec4:new pt("vec4",dt.keyword,"vec4"),bitcast:new pt("bitcast",dt.keyword,"bitcast"),block:new pt("block",dt.keyword,"block"),break:new pt("break",dt.keyword,"break"),case:new pt("case",dt.keyword,"case"),continue:new pt("continue",dt.keyword,"continue"),continuing:new pt("continuing",dt.keyword,"continuing"),default:new pt("default",dt.keyword,"default"),diagnostic:new pt("diagnostic",dt.keyword,"diagnostic"),discard:new pt("discard",dt.keyword,"discard"),else:new pt("else",dt.keyword,"else"),enable:new pt("enable",dt.keyword,"enable"),fallthrough:new pt("fallthrough",dt.keyword,"fallthrough"),false:new pt("false",dt.keyword,"false"),fn:new pt("fn",dt.keyword,"fn"),for:new pt("for",dt.keyword,"for"),function:new pt("function",dt.keyword,"function"),if:new pt("if",dt.keyword,"if"),let:new pt("let",dt.keyword,"let"),const:new pt("const",dt.keyword,"const"),loop:new pt("loop",dt.keyword,"loop"),while:new pt("while",dt.keyword,"while"),private:new pt("private",dt.keyword,"private"),read:new pt("read",dt.keyword,"read"),read_write:new pt("read_write",dt.keyword,"read_write"),return:new pt("return",dt.keyword,"return"),requires:new pt("requires",dt.keyword,"requires"),storage:new pt("storage",dt.keyword,"storage"),switch:new pt("switch",dt.keyword,"switch"),true:new pt("true",dt.keyword,"true"),alias:new pt("alias",dt.keyword,"alias"),type:new pt("type",dt.keyword,"type"),uniform:new pt("uniform",dt.keyword,"uniform"),var:new pt("var",dt.keyword,"var"),override:new pt("override",dt.keyword,"override"),workgroup:new pt("workgroup",dt.keyword,"workgroup"),write:new pt("write",dt.keyword,"write"),r8unorm:new pt("r8unorm",dt.keyword,"r8unorm"),r8snorm:new pt("r8snorm",dt.keyword,"r8snorm"),r8uint:new pt("r8uint",dt.keyword,"r8uint"),r8sint:new pt("r8sint",dt.keyword,"r8sint"),r16uint:new pt("r16uint",dt.keyword,"r16uint"),r16sint:new pt("r16sint",dt.keyword,"r16sint"),r16float:new pt("r16float",dt.keyword,"r16float"),rg8unorm:new pt("rg8unorm",dt.keyword,"rg8unorm"),rg8snorm:new pt("rg8snorm",dt.keyword,"rg8snorm"),rg8uint:new pt("rg8uint",dt.keyword,"rg8uint"),rg8sint:new pt("rg8sint",dt.keyword,"rg8sint"),r32uint:new pt("r32uint",dt.keyword,"r32uint"),r32sint:new pt("r32sint",dt.keyword,"r32sint"),r32float:new pt("r32float",dt.keyword,"r32float"),rg16uint:new pt("rg16uint",dt.keyword,"rg16uint"),rg16sint:new pt("rg16sint",dt.keyword,"rg16sint"),rg16float:new pt("rg16float",dt.keyword,"rg16float"),rgba8unorm:new pt("rgba8unorm",dt.keyword,"rgba8unorm"),rgba8unorm_srgb:new pt("rgba8unorm_srgb",dt.keyword,"rgba8unorm_srgb"),rgba8snorm:new pt("rgba8snorm",dt.keyword,"rgba8snorm"),rgba8uint:new pt("rgba8uint",dt.keyword,"rgba8uint"),rgba8sint:new pt("rgba8sint",dt.keyword,"rgba8sint"),bgra8unorm:new pt("bgra8unorm",dt.keyword,"bgra8unorm"),bgra8unorm_srgb:new pt("bgra8unorm_srgb",dt.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new pt("rgb10a2unorm",dt.keyword,"rgb10a2unorm"),rg11b10float:new pt("rg11b10float",dt.keyword,"rg11b10float"),rg32uint:new pt("rg32uint",dt.keyword,"rg32uint"),rg32sint:new pt("rg32sint",dt.keyword,"rg32sint"),rg32float:new pt("rg32float",dt.keyword,"rg32float"),rgba16uint:new pt("rgba16uint",dt.keyword,"rgba16uint"),rgba16sint:new pt("rgba16sint",dt.keyword,"rgba16sint"),rgba16float:new pt("rgba16float",dt.keyword,"rgba16float"),rgba32uint:new pt("rgba32uint",dt.keyword,"rgba32uint"),rgba32sint:new pt("rgba32sint",dt.keyword,"rgba32sint"),rgba32float:new pt("rgba32float",dt.keyword,"rgba32float"),static_assert:new pt("static_assert",dt.keyword,"static_assert")},Pe.tokens={decimal_float_literal:new pt("decimal_float_literal",dt.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new pt("hex_float_literal",dt.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new pt("int_literal",dt.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new pt("uint_literal",dt.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new pt("name",dt.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new pt("ident",dt.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new pt("and",dt.token,"&"),and_and:new pt("and_and",dt.token,"&&"),arrow:new pt("arrow ",dt.token,"->"),attr:new pt("attr",dt.token,"@"),forward_slash:new pt("forward_slash",dt.token,"/"),bang:new pt("bang",dt.token,"!"),bracket_left:new pt("bracket_left",dt.token,"["),bracket_right:new pt("bracket_right",dt.token,"]"),brace_left:new pt("brace_left",dt.token,"{"),brace_right:new pt("brace_right",dt.token,"}"),colon:new pt("colon",dt.token,":"),comma:new pt("comma",dt.token,","),equal:new pt("equal",dt.token,"="),equal_equal:new pt("equal_equal",dt.token,"=="),not_equal:new pt("not_equal",dt.token,"!="),greater_than:new pt("greater_than",dt.token,">"),greater_than_equal:new pt("greater_than_equal",dt.token,">="),shift_right:new pt("shift_right",dt.token,">>"),less_than:new pt("less_than",dt.token,"<"),less_than_equal:new pt("less_than_equal",dt.token,"<="),shift_left:new pt("shift_left",dt.token,"<<"),modulo:new pt("modulo",dt.token,"%"),minus:new pt("minus",dt.token,"-"),minus_minus:new pt("minus_minus",dt.token,"--"),period:new pt("period",dt.token,"."),plus:new pt("plus",dt.token,"+"),plus_plus:new pt("plus_plus",dt.token,"++"),or:new pt("or",dt.token,"|"),or_or:new pt("or_or",dt.token,"||"),paren_left:new pt("paren_left",dt.token,"("),paren_right:new pt("paren_right",dt.token,")"),semicolon:new pt("semicolon",dt.token,";"),star:new pt("star",dt.token,"*"),tilde:new pt("tilde",dt.token,"~"),underscore:new pt("underscore",dt.token,"_"),xor:new pt("xor",dt.token,"^"),plus_equal:new pt("plus_equal",dt.token,"+="),minus_equal:new pt("minus_equal",dt.token,"-="),times_equal:new pt("times_equal",dt.token,"*="),division_equal:new pt("division_equal",dt.token,"/="),modulo_equal:new pt("modulo_equal",dt.token,"%="),and_equal:new pt("and_equal",dt.token,"&="),or_equal:new pt("or_equal",dt.token,"|="),xor_equal:new pt("xor_equal",dt.token,"^="),shift_right_equal:new pt("shift_right_equal",dt.token,">>="),shift_left_equal:new pt("shift_left_equal",dt.token,"<<=")},Pe.simpleTokens={"@":St.tokens.attr,"{":St.tokens.brace_left,"}":St.tokens.brace_right,":":St.tokens.colon,",":St.tokens.comma,"(":St.tokens.paren_left,")":St.tokens.paren_right,";":St.tokens.semicolon},Pe.literalTokens={"&":St.tokens.and,"&&":St.tokens.and_and,"->":St.tokens.arrow,"/":St.tokens.forward_slash,"!":St.tokens.bang,"[":St.tokens.bracket_left,"]":St.tokens.bracket_right,"=":St.tokens.equal,"==":St.tokens.equal_equal,"!=":St.tokens.not_equal,">":St.tokens.greater_than,">=":St.tokens.greater_than_equal,">>":St.tokens.shift_right,"<":St.tokens.less_than,"<=":St.tokens.less_than_equal,"<<":St.tokens.shift_left,"%":St.tokens.modulo,"-":St.tokens.minus,"--":St.tokens.minus_minus,".":St.tokens.period,"+":St.tokens.plus,"++":St.tokens.plus_plus,"|":St.tokens.or,"||":St.tokens.or_or,"*":St.tokens.star,"~":St.tokens.tilde,_:St.tokens.underscore,"^":St.tokens.xor,"+=":St.tokens.plus_equal,"-=":St.tokens.minus_equal,"*=":St.tokens.times_equal,"/=":St.tokens.division_equal,"%=":St.tokens.modulo_equal,"&=":St.tokens.and_equal,"|=":St.tokens.or_equal,"^=":St.tokens.xor_equal,">>=":St.tokens.shift_right_equal,"<<=":St.tokens.shift_left_equal},Pe.regexTokens={decimal_float_literal:St.tokens.decimal_float_literal,hex_float_literal:St.tokens.hex_float_literal,int_literal:St.tokens.int_literal,uint_literal:St.tokens.uint_literal,ident:St.tokens.ident},Pe.storage_class=[St.keywords.function,St.keywords.private,St.keywords.workgroup,St.keywords.uniform,St.keywords.storage],Pe.access_mode=[St.keywords.read,St.keywords.write,St.keywords.read_write],Pe.sampler_type=[St.keywords.sampler,St.keywords.sampler_comparison],Pe.sampled_texture_type=[St.keywords.texture_1d,St.keywords.texture_2d,St.keywords.texture_2d_array,St.keywords.texture_3d,St.keywords.texture_cube,St.keywords.texture_cube_array],Pe.multisampled_texture_type=[St.keywords.texture_multisampled_2d],Pe.storage_texture_type=[St.keywords.texture_storage_1d,St.keywords.texture_storage_2d,St.keywords.texture_storage_2d_array,St.keywords.texture_storage_3d],Pe.depth_texture_type=[St.keywords.texture_depth_2d,St.keywords.texture_depth_2d_array,St.keywords.texture_depth_cube,St.keywords.texture_depth_cube_array,St.keywords.texture_depth_multisampled_2d],Pe.texture_external_type=[St.keywords.texture_external],Pe.any_texture_type=[...St.sampled_texture_type,...St.multisampled_texture_type,...St.storage_texture_type,...St.depth_texture_type,...St.texture_external_type],Pe.texel_format=[St.keywords.r8unorm,St.keywords.r8snorm,St.keywords.r8uint,St.keywords.r8sint,St.keywords.r16uint,St.keywords.r16sint,St.keywords.r16float,St.keywords.rg8unorm,St.keywords.rg8snorm,St.keywords.rg8uint,St.keywords.rg8sint,St.keywords.r32uint,St.keywords.r32sint,St.keywords.r32float,St.keywords.rg16uint,St.keywords.rg16sint,St.keywords.rg16float,St.keywords.rgba8unorm,St.keywords.rgba8unorm_srgb,St.keywords.rgba8snorm,St.keywords.rgba8uint,St.keywords.rgba8sint,St.keywords.bgra8unorm,St.keywords.bgra8unorm_srgb,St.keywords.rgb10a2unorm,St.keywords.rg11b10float,St.keywords.rg32uint,St.keywords.rg32sint,St.keywords.rg32float,St.keywords.rgba16uint,St.keywords.rgba16sint,St.keywords.rgba16float,St.keywords.rgba32uint,St.keywords.rgba32sint,St.keywords.rgba32float],Pe.const_literal=[St.tokens.int_literal,St.tokens.uint_literal,St.tokens.decimal_float_literal,St.tokens.hex_float_literal,St.keywords.true,St.keywords.false],Pe.literal_or_ident=[St.tokens.ident,St.tokens.int_literal,St.tokens.uint_literal,St.tokens.decimal_float_literal,St.tokens.hex_float_literal,St.tokens.name],Pe.element_count_expression=[St.tokens.int_literal,St.tokens.uint_literal,St.tokens.ident],Pe.template_types=[St.keywords.vec2,St.keywords.vec3,St.keywords.vec4,St.keywords.mat2x2,St.keywords.mat2x3,St.keywords.mat2x4,St.keywords.mat3x2,St.keywords.mat3x3,St.keywords.mat3x4,St.keywords.mat4x2,St.keywords.mat4x3,St.keywords.mat4x4,St.keywords.atomic,St.keywords.bitcast,...St.any_texture_type],Pe.attribute_name=[St.tokens.ident,St.keywords.block,St.keywords.diagnostic],Pe.assignment_operators=[St.tokens.equal,St.tokens.plus_equal,St.tokens.minus_equal,St.tokens.times_equal,St.tokens.division_equal,St.tokens.modulo_equal,St.tokens.and_equal,St.tokens.or_equal,St.tokens.xor_equal,St.tokens.shift_right_equal,St.tokens.shift_left_equal],Pe.increment_operators=[St.tokens.plus_plus,St.tokens.minus_minus];let kP=class{constructor(e,t,n,i,s){this.type=e,this.lexeme=t,this.line=n,this.start=i,this.end=s}toString(){return this.lexeme}isTemplateType(){return Pe.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==Pe.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}},Sq=class{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new kP(Pe.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let a=1;for(;a>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),a--,a==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),a++)}return!0}}const t=Pe.simpleTokens[e];if(t)return this._addToken(t),!0;let n=Pe.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let a=this._peekAhead();for(;this._isAlphaNumeric(a);)e+=this._advance(),a=this._peekAhead()}if(i){const a=Pe.keywords[e];if(a)return this._addToken(a),!0}if(i||s)return this._addToken(Pe.tokens.ident),!0;for(;;){let a=this._findType(e);const o=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(o=="=")return this._current++,e+=o,this._addToken(Pe.tokens.minus_equal),!0;if(o=="-")return this._current++,e+=o,this._addToken(Pe.tokens.minus_minus),!0;const u=this._tokens.length-1;if((Pe.literal_or_ident.indexOf(this._tokens[u].type)!=-1||this._tokens[u].type==Pe.tokens.paren_right)&&o!=">")return this._addToken(a),!0}if(e==">"&&(o==">"||o=="=")){let u=!1,d=this._tokens.length-1;for(let p=0;p<5&&d>=0&&Pe.assignment_operators.indexOf(this._tokens[d].type)===-1;++p,--d)if(this._tokens[d].type===Pe.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(u=!0);break}if(u)return this._addToken(a),!0}if(a===Pe.none){let u=e,d=0;const p=2;for(let b=0;b<p;++b)if(u+=this._peekAhead(b),a=this._findType(u),a!==Pe.none){d=b;break}if(a===Pe.none)return n!==Pe.none&&(this._current--,this._addToken(n),!0);e=u,this._current+=d+1}if(n=a,this._isAtEnd())break;e+=this._advance()}return n!==Pe.none&&(this._addToken(n),!0)}_findType(e){for(const n in Pe.regexTokens){const i=Pe.regexTokens[n];if(this._match(e,i.rule))return i}return Pe.literalTokens[e]||Pe.none}_match(e,t){const n=t.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new kP(e,t,this._line,this._start,this._current))}};function xr(r){return Array.isArray(r)||r?.buffer instanceof ArrayBuffer}const t0=new Float32Array(1),Iq=new Uint32Array(t0.buffer),Pq=new Uint32Array(t0.buffer),r0=new Int32Array(1),Mq=new Float32Array(r0.buffer),Fq=new Uint32Array(r0.buffer),n0=new Uint32Array(1),Rq=new Float32Array(n0.buffer),Lq=new Int32Array(n0.buffer);function NP(r,e,t){if(e===t)return r;if(e==="f32"){if(t==="i32"||t==="x32")return t0[0]=r,Iq[0];if(t==="u32")return t0[0]=r,Pq[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return r0[0]=r,Mq[0];if(t==="u32")return r0[0]=r,Fq[0]}else if(e==="u32"){if(t==="f32")return n0[0]=r,Rq[0];if(t==="i32"||t==="x32")return n0[0]=r,Lq[0]}return console.error(`Unsupported cast from ${e} to ${t}`),r}let Oq=class{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}},i0=class{constructor(e,t){this.align=e,this.size=t}},dm=class yy{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new mq,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof cm&&this._functions.set(t.name,new Oq(t));for(const t of e)if(t instanceof Rh){const n=this.getTypeInfo(t,null);n instanceof FA&&this.structs.push(n)}for(const t of e)if(t instanceof Qw)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof Nw){const n=t,i=this._getAttributeNum(n.attributes,"id",0),s=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new dq(n.name,s,n.attributes,i));continue}if(this._isUniformVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=new Ky(n.name,a,i,s,n.attributes,LA.Uniform,n.access);o.access||(o.access="read"),this.uniforms.push(o);continue}if(this._isStorageVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=this._isStorageTexture(a),u=new Ky(n.name,a,i,s,n.attributes,o?LA.StorageTexture:LA.Storage,n.access);u.access||(u.access="read"),this.storage.push(u);continue}if(this._isTextureVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=this._isStorageTexture(a),u=new Ky(n.name,a,i,s,n.attributes,o?LA.StorageTexture:LA.Texture,n.access);u.access||(u.access="read"),o?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(t)){const n=t,i=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=new Ky(n.name,a,i,s,n.attributes,LA.Sampler,n.access);this.samplers.push(o);continue}}for(const t of e)if(t instanceof cm){const n=this._getAttribute(t,"vertex"),i=this._getAttribute(t,"fragment"),s=this._getAttribute(t,"compute"),a=n||i||s,o=new gq(t.name,a?.name,t.attributes);o.attributes=t.attributes,o.startLine=t.startLine,o.endLine=t.endLine,this.functions.push(o),this._functions.get(t.name).info=o,a&&(this._functions.get(t.name).inUse=!0,o.inUse=!0,o.resources=this._findResources(t,!!a),o.inputs=this._getInputs(t.args),o.outputs=this._getOutputs(t.returnType),this.entry[a.name].push(o)),o.arguments=t.args.map(u=>new pq(u.name,this.getTypeInfo(u.type,u.attributes),u.attributes)),o.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(n=>{var i,s,a;if(n instanceof DP){if(n.value)if(xr(n.value))for(const o of n.value)for(const u of this.overrides)o===u.name&&((i=t.info)===null||i===void 0||i.overrides.push(u));else for(const o of this.overrides)n.value===o.name&&((s=t.info)===null||s===void 0||s.overrides.push(o))}else if(n instanceof bl)for(const o of this.overrides)n.name===o.name&&((a=t.info)===null||a===void 0||a.overrides.push(o))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const i of e.calls){const s=(n=this._functions.get(i.name))===null||n===void 0?void 0:n.info;s&&t.add(s)}}findResource(e,t,n){if(n){for(const i of this.entry.compute)if(i.name===n){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}for(const i of this.entry.vertex)if(i.name===n){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}for(const i of this.entry.fragment)if(i.name===n){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}}for(const i of this.uniforms)if(i.group==e&&i.binding==t)return i;for(const i of this.storage)if(i.group==e&&i.binding==t)return i;for(const i of this.textures)if(i.group==e&&i.binding==t)return i;for(const i of this.samplers)if(i.group==e&&i.binding==t)return i;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],i=this,s=[];return e.search(a=>{if(a instanceof Xy)s.push({});else if(a instanceof Yy)s.pop();else if(a instanceof Fh){const o=a;t&&o.type!==null&&this._markStructsFromAST(o.type),s.length>0&&(s[s.length-1][o.name]=o)}else if(a instanceof Du){const o=a;t&&o.type!==null&&this._markStructsFromAST(o.type)}else if(a instanceof um){const o=a;t&&o.type!==null&&this._markStructsFromAST(o.type),s.length>0&&(s[s.length-1][o.name]=o)}else if(a instanceof bl){const o=a;if(s.length>0&&s[s.length-1][o.name])return;const u=i._findResource(o.name);u&&n.push(u)}else if(a instanceof Hw){const o=a,u=i._functions.get(o.name);u&&(t&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,t)),n.push(...u.resources))}else if(a instanceof zw){const o=a,u=i._functions.get(o.name);u&&(t&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,t)),n.push(...u.resources))}}),[...new Map(n.map(a=>[a.name,a])).values()]}getBindGroups(){const e=[];function t(n,i){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),i>=e[n].length&&(e[n].length=i+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Rh)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);n!==null&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof Rh)this._getStructOutputs(n.type,t);else{const i=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(i!==null){const s=this.getTypeInfo(n.type,n.type.attributes),a=this._parseInt(i.value),o=new AP(n.name,s,i.name,a);t.push(o)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new AP("",n,t.name,i)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const n of e)if(n.type instanceof Rh)this._getStructInputs(n.type,t);else{const i=this._getInputInfo(n);i!==null&&t.push(i)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof Rh)this._getStructInputs(n.type,t);else{const i=this._getInputInfo(n);i!==null&&t.push(i)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(t.value),a=new fq(e.name,i,t.name,s);return n!==null&&(a.interpolation=this._parseString(n.value)),a}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new Aq(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Jy){const i=e.type?this.getTypeInfo(e.type,e.attributes):null,s=new Ow(e.name,i,t);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Am){const i=e,s=i.format?this.getTypeInfo(i.format,i.attributes):null,a=new RA(i.name,t);return a.format=s,a.count=i.count,this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Rh){const i=e,s=new FA(i.name,t);s.startLine=i.startLine,s.endLine=i.endLine;for(const a of i.members){const o=this.getTypeInfo(a.type,a.attributes);s.members.push(new hP(a.name,o,a.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof fm){const i=e,s=i.format instanceof Jt,a=i.format?s?this.getTypeInfo(i.format,null):new Xl(i.format,null):null,o=new Hf(i.name,a,t,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof vt){const i=e,s=i.format?this.getTypeInfo(i.format,null):null,a=new Hf(i.name,s,t,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}const n=new Xl(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,i;const s=this._getTypeSize(e);if(e.size=(t=s?.size)!==null&&t!==void 0?t:0,e instanceof RA&&e.format){const a=this._getTypeSize(e.format);e.stride=Math.max((n=a?.size)!==null&&n!==void 0?n:0,(i=a?.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof Ow&&this._updateTypeInfo(e.format),e instanceof FA&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,i=0,s=0,a=0;for(let o=0,u=e.members.length;o<u;++o){const d=e.members[o],p=this._getTypeSize(d);if(!p)continue;(t=this._getAlias(d.type.name))!==null&&t!==void 0||d.type;const b=p.align,C=p.size;n=this._roundUp(b,n+i),i=C,s=n,a=Math.max(a,b),d.offset=n,d.size=C,this._updateTypeInfo(d.type)}e.size=this._roundUp(a,s+i),e.align=a}_getTypeSize(e){var t,n;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof hP&&(e=e.type),e instanceof Xl){const a=this._getAlias(e.name);a!==null&&(e=a)}{const a=yy._typeInfo[e.name];if(a!==void 0){const o=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new i0(Math.max(s,a.align/o),Math.max(i,a.size/o))}}{const a=yy._typeInfo[e.name.substring(0,e.name.length-1)];if(a){const o=e.name[e.name.length-1]==="h"?2:1;return new i0(Math.max(s,a.align/o),Math.max(i,a.size/o))}}if(e instanceof RA){let a=e,o=8,u=8;const d=this._getTypeSize(a.format);return d!==null&&(u=d.size,o=d.align),u=a.count*this._getAttributeNum((n=e?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(o,u)),i&&(u=i),new i0(Math.max(s,o),Math.max(i,u))}if(e instanceof FA){let a=0,o=0,u=0,d=0,p=0;for(const b of e.members){const C=this._getTypeSize(b.type);C!==null&&(a=Math.max(C.align,a),u=this._roundUp(C.align,u+d),d=C.size,p=u)}return o=this._roundUp(a,p+d),new i0(Math.max(s,a),Math.max(i,o))}return null}_isUniformVar(e){return e instanceof Fh&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Fh&&e.storage=="storage"}_isTextureVar(e){return e instanceof Fh&&e.type!==null&&yy._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Fh&&e.type!==null&&yy._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let s of i)if(s.name==t)return s;return null}_getAttributeNum(e,t,n){if(e===null)return n;for(let i of e)if(i.name==t){let s=i!==null&&i.value!==null?i.value:n;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}};dm._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},dm._textureTypes=Pe.any_texture_type.map(r=>r.name),dm._samplerTypes=Pe.sampler_type.map(r=>r.name);let jw=0,Uq=class O9{constructor(e,t,n){this.id=jw++,this.name=e,this.value=t,this.node=n}clone(){return new O9(this.name,this.value,this.node)}},Dq=class U9{constructor(e){this.id=jw++,this.name=e.name,this.node=e}clone(){return new U9(this.node)}},kq=class D9{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=jw++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new Uq(e,t,n??null))}setVariable(e,t,n){const i=this.getVariable(e);i!==null?i.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return(t=n?.value)!==null&&t!==void 0?t:null}clone(){return new D9(this)}},Nq=class{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}},zq=class{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let i=!0;if(n instanceof ze)return n.data.forEach(s=>{s||(i=!1)}),new gt(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze){const i=n.data.some(s=>s);return new gt(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof gt))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof Xs&&(n=n.right);const i=this.exec.evalExpression(n,t);if(i instanceof Fo&&i.typeInfo.size===0){const s=i.typeInfo,a=i.buffer.byteLength/s.stride;return new gt(a,this.getTypeInfo("u32"))}return new gt(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.abs(s)),n.typeInfo);const i=n;return new gt(Math.abs(i.value),i.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.acos(s)),n.typeInfo);const i=n;return new gt(Math.acos(i.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.acosh(s)),n.typeInfo);const i=n;return new gt(Math.acosh(i.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.asin(s)),n.typeInfo);const i=n;return new gt(Math.asin(i.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.asinh(s)),n.typeInfo);const i=n;return new gt(Math.asinh(i.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.atan(s)),n.typeInfo);const i=n;return new gt(Math.atan(i.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.atanh(s)),n.typeInfo);const i=n;return new gt(Math.atanh(i.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof ze&&i instanceof ze)return new ze(n.data.map((o,u)=>Math.atan2(o,i.data[u])),n.typeInfo);const s=n,a=i;return new gt(Math.atan2(s.value,a.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.ceil(s)),n.typeInfo);const i=n;return new gt(Math.ceil(i.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof ze&&i instanceof ze&&s instanceof ze)return new ze(n.data.map((d,p)=>this._clamp(d,i.data[p],s.data[p])),n.typeInfo);const a=n,o=i,u=s;return new gt(this._clamp(a.value,o.value,u.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.cos(s)),n.typeInfo);const i=n;return new gt(Math.cos(i.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.cosh(s)),n.typeInfo);const i=n;return new gt(Math.cos(i.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.clz32(s)),n.typeInfo);const i=n;return new gt(Math.clz32(i.value),n.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>this._countOneBits(s)),n.typeInfo);const i=n;return new gt(this._countOneBits(i.value),n.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>this._countTrailingZeros(s)),n.typeInfo);const i=n;return new gt(this._countTrailingZeros(i.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof ze&&i instanceof ze){if(n.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=n.data,a=i.data;return new ze([s[1]*a[2]-a[1]*s[2],s[2]*a[0]-a[2]*s[0],s[0]*a[1]-a[0]*s[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return n instanceof ze?new ze(n.data.map(s=>s*i),n.typeInfo):new gt(n.value*i,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof _n){const i=n.data,s=n.typeInfo.getTypeName(),a=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new gt(i[0]*i[3]-i[1]*i[2],a);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new gt(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),a);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new gt(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),a);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof ze&&i instanceof ze){let o=0;for(let u=0;u<n.data.length;++u)o+=(n.data[u]-i.data[u])*(n.data[u]-i.data[u]);return new gt(Math.sqrt(o),this.getTypeInfo("f32"))}const s=n,a=i;return new gt(Math.abs(s.value-a.value),n.typeInfo)}_dot(e,t){let n=0;for(let i=0;i<e.length;++i)n+=t[i]*e[i];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return n instanceof ze&&i instanceof ze?new gt(this._dot(n.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.exp(s)),n.typeInfo);const i=n;return new gt(Math.exp(i.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.pow(2,s)),n.typeInfo);const i=n;return new gt(Math.pow(2,i.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const a=i.value,o=s.value;if(n instanceof ze)return new ze(n.data.map(d=>d>>a&(1<<o)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const u=n.value;return new gt(u>>a&(1<<o)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof ze&&i instanceof ze&&s instanceof ze){const a=this._dot(i.data,s.data);return new ze(a<0?Array.from(n.data):n.data.map(o=>-o),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>this._firstLeadingBit(s)),n.typeInfo);const i=n;return new gt(this._firstLeadingBit(i.value),n.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>this._firstTrailingBit(s)),n.typeInfo);const i=n;return new gt(this._firstTrailingBit(i.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.floor(s)),n.typeInfo);const i=n;return new gt(Math.floor(i.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof ze&&i instanceof ze&&s instanceof ze)return n.data.length!==i.data.length||n.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new ze(n.data.map((d,p)=>d*i.data[p]+s.data[p]),n.typeInfo);const a=n,o=i,u=s;return new gt(a.value*o.value+u.value,a.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>s-Math.floor(s)),n.typeInfo);const i=n;return new gt(i.value-Math.floor(i.value),n.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t),a=this.exec.evalExpression(e.args[3],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const o=s.value,u=(1<<a.value)-1<<o,d=~u;if(n instanceof ze&&i instanceof ze)return new ze(n.data.map((C,w)=>C&d|i.data[w]<<o&u),n.typeInfo);const p=n.value,b=i.value;return new gt(p&d|b<<o&u,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>1/Math.sqrt(s)),n.typeInfo);const i=n;return new gt(1/Math.sqrt(i.value),n.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze){let s=0;return n.data.forEach(a=>{s+=a*a}),new gt(Math.sqrt(s),this.getTypeInfo("f32"))}const i=n;return new gt(Math.abs(i.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.log(s)),n.typeInfo);const i=n;return new gt(Math.log(i.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.log2(s)),n.typeInfo);const i=n;return new gt(Math.log2(i.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof ze&&i instanceof ze)return new ze(n.data.map((o,u)=>Math.max(o,i.data[u])),n.typeInfo);const s=n,a=i;return new gt(Math.max(s.value,a.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof ze&&i instanceof ze)return new ze(n.data.map((o,u)=>Math.min(o,i.data[u])),n.typeInfo);const s=n,a=i;return new gt(Math.min(s.value,a.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof ze&&i instanceof ze&&s instanceof ze)return new ze(n.data.map((u,d)=>n.data[d]*(1-s.data[d])+i.data[d]*s.data[d]),n.typeInfo);const a=i,o=s;return new gt(n.value*(1-o.value)+a.value*o.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof ze&&i instanceof ze)return new ze(n.data.map((a,o)=>a%i.data[o]),n.typeInfo);const s=i;return new gt(n.value%s.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze){const i=this.Length(e,t).value;return new ze(n.data.map(s=>s/i),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof ze&&i instanceof ze)return new ze(n.data.map((o,u)=>Math.pow(o,i.data[u])),n.typeInfo);const s=n,a=i;return new gt(Math.pow(s.value,a.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof ze?new ze(n.data.map(i=>i),n.typeInfo):new gt(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof ze?new ze(n.data.map(i=>i*Math.PI/180),n.typeInfo):new gt(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(n instanceof ze&&i instanceof ze){const s=this._dot(n.data,i.data);return new ze(n.data.map((a,o)=>a-2*s*i.data[o]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(n instanceof ze&&i instanceof ze&&s instanceof gt){const a=this._dot(i.data,n.data);return new ze(n.data.map((o,u)=>{const d=1-s.value*s.value*(1-a*a);if(d<0)return 0;const p=Math.sqrt(d);return s.value*o-(s.value*a+p)*i.data[u]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.round(s)),n.typeInfo);const i=n;return new gt(Math.round(i.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.min(Math.max(s,0),1)),n.typeInfo);const i=n;return new gt(Math.min(Math.max(i.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.sign(s)),n.typeInfo);const i=n;return new gt(Math.sign(i.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.sin(s)),n.typeInfo);const i=n;return new gt(Math.sin(i.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.sinh(s)),n.typeInfo);const i=n;return new gt(Math.sinh(i.value),n.typeInfo)}_smoothstep(e,t,n){const i=Math.min(Math.max((n-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(s instanceof ze&&n instanceof ze&&i instanceof ze)return new ze(s.data.map((d,p)=>this._smoothstep(n.data[p],i.data[p],d)),s.typeInfo);const a=n,o=i,u=s;return new gt(this._smoothstep(a.value,o.value,u.value),s.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.sqrt(s)),n.typeInfo);const i=n;return new gt(Math.sqrt(i.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(i instanceof ze&&n instanceof ze)return new ze(i.data.map((a,o)=>a<n.data[o]?0:1),i.typeInfo);const s=n;return new gt(i.value<s.value?0:1,s.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.tan(s)),n.typeInfo);const i=n;return new gt(Math.tan(i.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.tanh(s)),n.typeInfo);const i=n;return new gt(Math.tanh(i.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof _n))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const s=n.data;return new _n([s[0],s[2],s[1],s[3]],i)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const s=n.data;return new _n([s[0],s[3],s[6],s[1],s[4],s[7]],i)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const s=n.data;return new _n([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],i)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const s=n.data;return new _n([s[0],s[3],s[1],s[4],s[2],s[5]],i)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const s=n.data;return new _n([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],i)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const s=n.data;return new _n([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],i)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const s=n.data;return new _n([s[0],s[4],s[1],s[5],s[2],s[6]],i)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const s=n.data;return new _n([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],i)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const s=n.data;return new _n([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],i)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof ze)return new ze(n.data.map(s=>Math.trunc(s)),n.typeInfo);const i=n;return new gt(Math.trunc(i.value),n.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const n=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof bl){const s=n.name,a=t.getVariableValue(s);if(a instanceof jf){if(i<0||i>=a.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const o=a.getMipLevelSize(i),u=a.dimension;return u==="1d"?new gt(o[0],this.getTypeInfo("u32")):u==="3d"?new ze(o,this.getTypeInfo("vec3u")):u==="2d"?new ze(o.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${u} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),s=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(i instanceof ze)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof bl){const a=n.name,o=t.getVariableValue(a);if(o instanceof jf){const u=Math.floor(i.data[0]),d=Math.floor(i.data[1]);if(u<0||u>=o.width||d<0||d>=o.height)return console.error(`Texture ${a} out of bounds. Line ${e.line}`),null;const p=o.getPixel(u,d,0,s);return p===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new ze(p,this.getTypeInfo("vec4f"))}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof bl){const i=n.name,s=t.getVariableValue(i);return s instanceof jf?new gt(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof bl){const i=n.name,s=t.getVariableValue(i);return s instanceof jf?new gt(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof bl){const i=n.name,s=t.getVariableValue(i);return s instanceof jf?new gt(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const n=e.args[0],i=this.exec.evalExpression(e.args[1],t),s=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,a=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(a.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof ze)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof bl){const o=n.name,u=t.getVariableValue(o);if(u instanceof jf){const d=u.getMipLevelSize(0),p=Math.floor(i.data[0]),b=Math.floor(i.data[1]);return p<0||p>=d[0]||b<0||b>=d[1]?(console.error(`Texture ${o} out of bounds. Line ${e.line}`),null):(u.setPixel(p,b,0,s,Array.from(a)),null)}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let n=e.args[0];n instanceof Xs&&(n=n.right);const i=this.exec.getVariableName(n,t);return t.getVariable(i).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof Xs&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getSubData(this.exec,n.postfix,t);return u instanceof gt&&o instanceof gt&&(u.value=o.value),s.value instanceof Fo&&s.value.setDataValue(this.exec,u,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof Xs&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getSubData(this.exec,n.postfix,t),d=new gt(u.value,u.typeInfo);return u instanceof gt&&o instanceof gt&&(u.value+=o.value),s.value instanceof Fo&&s.value.setDataValue(this.exec,u,n.postfix,t),d}AtomicSub(e,t){let n=e.args[0];n instanceof Xs&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getSubData(this.exec,n.postfix,t),d=new gt(u.value,u.typeInfo);return u instanceof gt&&o instanceof gt&&(u.value-=o.value),s.value instanceof Fo&&s.value.setDataValue(this.exec,u,n.postfix,t),d}AtomicMax(e,t){let n=e.args[0];n instanceof Xs&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getSubData(this.exec,n.postfix,t),d=new gt(u.value,u.typeInfo);return u instanceof gt&&o instanceof gt&&(u.value=Math.max(u.value,o.value)),s.value instanceof Fo&&s.value.setDataValue(this.exec,u,n.postfix,t),d}AtomicMin(e,t){let n=e.args[0];n instanceof Xs&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getSubData(this.exec,n.postfix,t),d=new gt(u.value,u.typeInfo);return u instanceof gt&&o instanceof gt&&(u.value=Math.min(u.value,o.value)),s.value instanceof Fo&&s.value.setDataValue(this.exec,u,n.postfix,t),d}AtomicAnd(e,t){let n=e.args[0];n instanceof Xs&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getSubData(this.exec,n.postfix,t),d=new gt(u.value,u.typeInfo);return u instanceof gt&&o instanceof gt&&(u.value=u.value&o.value),s.value instanceof Fo&&s.value.setDataValue(this.exec,u,n.postfix,t),d}AtomicOr(e,t){let n=e.args[0];n instanceof Xs&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getSubData(this.exec,n.postfix,t),d=new gt(u.value,u.typeInfo);return u instanceof gt&&o instanceof gt&&(u.value=u.value|o.value),s.value instanceof Fo&&s.value.setDataValue(this.exec,u,n.postfix,t),d}AtomicXor(e,t){let n=e.args[0];n instanceof Xs&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getSubData(this.exec,n.postfix,t),d=new gt(u.value,u.typeInfo);return u instanceof gt&&o instanceof gt&&(u.value=u.value^o.value),s.value instanceof Fo&&s.value.setDataValue(this.exec,u,n.postfix,t),d}AtomicExchange(e,t){let n=e.args[0];n instanceof Xs&&(n=n.right);const i=this.exec.getVariableName(n,t),s=t.getVariable(i);let a=e.args[1];const o=this.exec.evalExpression(a,t),u=s.value.getSubData(this.exec,n.postfix,t),d=new gt(u.value,u.typeInfo);return u instanceof gt&&o instanceof gt&&(u.value=o.value),s.value instanceof Fo&&s.value.setDataValue(this.exec,u,n.postfix,t),d}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}};const $w={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Sa={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};let s0=class Mc extends Nq{constructor(e,t){var n;super(),this.ast=e??[],this.reflection=new dm,this.reflection.updateAST(this.ast),this.context=(n=t?.clone())!==null&&n!==void 0?n:new kq,this.builtins=new zq(this),this.typeInfo={bool:this.getTypeInfo(Jt.bool),i32:this.getTypeInfo(Jt.i32),u32:this.getTypeInfo(Jt.u32),f32:this.getTypeInfo(Jt.f32),f16:this.getTypeInfo(Jt.f16),vec2f:this.getTypeInfo(vt.vec2f),vec2u:this.getTypeInfo(vt.vec2u),vec2i:this.getTypeInfo(vt.vec2i),vec2h:this.getTypeInfo(vt.vec2h),vec3f:this.getTypeInfo(vt.vec3f),vec3u:this.getTypeInfo(vt.vec3u),vec3i:this.getTypeInfo(vt.vec3i),vec3h:this.getTypeInfo(vt.vec3h),vec4f:this.getTypeInfo(vt.vec4f),vec4u:this.getTypeInfo(vt.vec4u),vec4i:this.getTypeInfo(vt.vec4i),vec4h:this.getTypeInfo(vt.vec4h),mat2x2f:this.getTypeInfo(vt.mat2x2f),mat2x3f:this.getTypeInfo(vt.mat2x3f),mat2x4f:this.getTypeInfo(vt.mat2x4f),mat3x2f:this.getTypeInfo(vt.mat3x2f),mat3x3f:this.getTypeInfo(vt.mat3x3f),mat3x4f:this.getTypeInfo(vt.mat3x4f),mat4x2f:this.getTypeInfo(vt.mat4x2f),mat4x3f:this.getTypeInfo(vt.mat4x3f),mat4x4f:this.getTypeInfo(vt.mat4x4f)}}getVariableValue(e){var t,n;const i=(n=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&n!==void 0?n:null;if(i===null)return null;if(i instanceof gt)return i.value;if(i instanceof ze||i instanceof _n)return Array.from(i.data);if(i instanceof Fo&&i.typeInfo instanceof RA){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,i){const s=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,s),this._execStatements(this.ast,s);const a=s.getFunction(e);if(!a)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const o=t[0],u=t[1],d=t[2],p=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new ze(t,p));const b=this.reflection.getFunctionInfo(e);b===null&&console.error(`Function ${e} not found in reflection data`);for(const C in n)for(const w in n[C]){const M=n[C][w];s.variables.forEach(P=>{var k;const D=P.node;if(D?.attributes){let j=null,H=null;for(const N of D.attributes)N.name==="binding"?j=N.value:N.name==="group"&&(H=N.value);if(w==j&&C==H){let N=!1;for(const q of b.resources)if(q.name===P.name&&q.group===parseInt(C)&&q.binding===parseInt(w)){N=!0;break}if(N)if(M.texture!==void 0&&M.descriptor!==void 0){const q=new jf(M.texture,this.getTypeInfo(D.type),M.descriptor,(k=M.texture.view)!==null&&k!==void 0?k:null);P.value=q}else M.uniform!==void 0?P.value=new Fo(M.uniform,this.getTypeInfo(D.type)):P.value=new Fo(M,this.getTypeInfo(D.type))}}})}for(let C=0;C<d;++C)for(let w=0;w<u;++w)for(let M=0;M<o;++M)s.setVariable("@workgroup_id",new ze([M,w,C],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(a,[M,w,C],s)}execStatement(e,t){if(e instanceof BP)return this.evalExpression(e.value,t);if(e instanceof TP){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof gt))throw new Error("Invalid break-if condition");if(!n.value)return null}return Mc._breakObj}if(e instanceof EP)return Mc._continueObj;if(e instanceof um)this._let(e,t);else if(e instanceof Fh)this._var(e,t);else if(e instanceof Zy)this._const(e,t);else if(e instanceof cm)this._function(e,t);else{if(e instanceof xP)return this._if(e,t);if(e instanceof wP)return this._switch(e,t);if(e instanceof _P)return this._for(e,t);if(e instanceof mP)return this._while(e,t);if(e instanceof vP)return this._loop(e,t);if(e instanceof kw){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof bP)this._assign(e,t);else if(e instanceof yP)this._increment(e,t);else{if(e instanceof Rh)return null;if(e instanceof Nw){const n=e.name;t.getVariable(n)===null&&t.setVariable(n,new gt(0,this.getTypeInfo("u32")))}else if(e instanceof zw)this._call(e,t);else{if(e instanceof CP||e instanceof Qw)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Lc?this._evalBinaryOp(e,t):e instanceof mo?this._evalLiteral(e,t):e instanceof bl?this._evalVariable(e,t):e instanceof Hw?this._evalCall(e,t):e instanceof Du?this._evalCreate(e,t):e instanceof IP?this._evalConst(e,t):e instanceof PP?this._evalBitcast(e,t):e instanceof Xs?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Jt){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let n=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return n!==null||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const i=e[n],s=this.reflection.getOverrideInfo(n);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?t.setVariable(n,new gt(i,s.type)):s.type.name==="bool"?t.setVariable(n,new gt(i?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?t.setVariable(n,new ze(i,s.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,n){const i=[1,1,1];for(const p of e.node.attributes)if(p.name==="workgroup_size"){if(p.value.length>0){const b=n.getVariableValue(p.value[0]);i[0]=b instanceof gt?b.value:parseInt(p.value[0])}if(p.value.length>1){const b=n.getVariableValue(p.value[1]);i[1]=b instanceof gt?b.value:parseInt(p.value[1])}if(p.value.length>2){const b=n.getVariableValue(p.value[2]);i[2]=b instanceof gt?b.value:parseInt(p.value[2])}}const s=this.getTypeInfo("vec3u"),a=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new ze(i,s));const o=i[0],u=i[1],d=i[2];for(let p=0,b=0;p<d;++p)for(let C=0;C<u;++C)for(let w=0;w<o;++w,++b){const M=[w,C,p],P=[w+t[0]*i[0],C+t[1]*i[1],p+t[2]*i[2]];n.setVariable("@local_invocation_id",new ze(M,s)),n.setVariable("@global_invocation_id",new ze(P,s)),n.setVariable("@local_invocation_index",new gt(b,a)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const i of n.attributes)if(i.name==="builtin"){const s=`@${i.value}`,a=t.getVariable(s);a!==void 0&&t.variables.set(n.name,a)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Xs;)e=e.right;return e instanceof bl?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const n of e){if(n instanceof Array){const s=t.clone(),a=this._execStatements(n,s);if(a)return a;continue}const i=this.execStatement(n,t);if(i)return i}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(i){for(let s=0;s<i.node.args.length;++s){const a=i.node.args[s],o=this.evalExpression(e.args[s],n);n.setVariable(a.name,o,a)}this._execStatements(i.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),i=t.getVariable(n);i?e.operator==="++"?i.value instanceof gt?i.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof gt?i.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof bl){const n=this.getVariableName(e,t),i=t.getVariable(n);return i===null?(console.error(`Variable ${n} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,t)}if(e instanceof Xs){if(e.operator==="*"){const n=this._getVariableData(e.right,t);return n instanceof dp?n.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const n=this._getVariableData(e.right,t);return new dp(n)}}return null}_assign(e,t){let n=null,i="<var>",s=null;if(e.variable instanceof Xs){const u=this._getVariableData(e.variable,t),d=this.evalExpression(e.value,t),p=e.operator;if(p==="="){if(u instanceof gt||u instanceof ze||u instanceof _n){if(d instanceof gt||d instanceof ze||d instanceof _n&&u.data.length===d.data.length)return void u.data.set(d.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(u instanceof Fo&&d instanceof Fo&&u.buffer.byteLength-u.offset>=d.buffer.byteLength-d.offset)return void(u.buffer.byteLength%4==0?new Uint32Array(u.buffer,u.offset,u.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(u.buffer,u.offset,u.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(p==="+=")return u instanceof gt||u instanceof ze||u instanceof _n?d instanceof gt||d instanceof ze||d instanceof _n?void u.data.set(d.data.map((b,C)=>u.data[C]+b)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(p==="-=")return(u instanceof gt||u instanceof ze||u instanceof _n)&&(d instanceof gt||d instanceof ze||d instanceof _n)?void u.data.set(d.data.map((b,C)=>u.data[C]-b)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Xs){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,t);const u=t.getVariable(i);if(!(u&&u.value instanceof dp))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);n=u.value.reference;let d=e.variable.postfix;if(!d){let p=e.variable.right;for(;p instanceof Xs;){if(p.postfix){d=p.postfix;break}p=p.right}}d&&(n=n.getSubData(this,d,t))}}else{s=e.variable.postfix,i=this.getVariableName(e.variable,t);const u=t.getVariable(i);if(u===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);n=u.value}if(n instanceof dp&&(n=n.reference),n===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const a=this.evalExpression(e.value,t),o=e.operator;if(o!=="="){const u=n.getSubData(this,s,t);if(u instanceof ze&&a instanceof gt){const d=u.data,p=a.value;if(o==="+=")for(let b=0;b<d.length;++b)d[b]+=p;else if(o==="-=")for(let b=0;b<d.length;++b)d[b]-=p;else if(o==="*=")for(let b=0;b<d.length;++b)d[b]*=p;else if(o==="/=")for(let b=0;b<d.length;++b)d[b]/=p;else if(o==="%=")for(let b=0;b<d.length;++b)d[b]%=p;else if(o==="&=")for(let b=0;b<d.length;++b)d[b]&=p;else if(o==="|=")for(let b=0;b<d.length;++b)d[b]|=p;else if(o==="^=")for(let b=0;b<d.length;++b)d[b]^=p;else if(o==="<<=")for(let b=0;b<d.length;++b)d[b]<<=p;else if(o===">>=")for(let b=0;b<d.length;++b)d[b]>>=p;else console.error(`Invalid operator ${o}. Line ${e.line}`)}else if(u instanceof ze&&a instanceof ze){const d=u.data,p=a.data;if(d.length!==p.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(o==="+=")for(let b=0;b<d.length;++b)d[b]+=p[b];else if(o==="-=")for(let b=0;b<d.length;++b)d[b]-=p[b];else if(o==="*=")for(let b=0;b<d.length;++b)d[b]*=p[b];else if(o==="/=")for(let b=0;b<d.length;++b)d[b]/=p[b];else if(o==="%=")for(let b=0;b<d.length;++b)d[b]%=p[b];else if(o==="&=")for(let b=0;b<d.length;++b)d[b]&=p[b];else if(o==="|=")for(let b=0;b<d.length;++b)d[b]|=p[b];else if(o==="^=")for(let b=0;b<d.length;++b)d[b]^=p[b];else if(o==="<<=")for(let b=0;b<d.length;++b)d[b]<<=p[b];else if(o===">>=")for(let b=0;b<d.length;++b)d[b]>>=p[b];else console.error(`Invalid operator ${o}. Line ${e.line}`)}else{if(!(u instanceof gt&&a instanceof gt))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);o==="+="?u.value+=a.value:o==="-="?u.value-=a.value:o==="*="?u.value*=a.value:o==="/="?u.value/=a.value:o==="%="?u.value%=a.value:o==="&="?u.value&=a.value:o==="|="?u.value|=a.value:o==="^="?u.value^=a.value:o==="<<="?u.value<<=a.value:o===">>="?u.value>>=a.value:console.error(`Invalid operator ${o}. Line ${e.line}`)}return void(n instanceof Fo&&n.setDataValue(this,u,s,t))}if(n instanceof Fo)n.setDataValue(this,a,s,t);else if(s){if(!(n instanceof ze||n instanceof _n))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(s instanceof fp){const u=this.evalExpression(s.index,t).value;if(n instanceof ze){if(!(a instanceof gt))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[u]=a.value}else{if(!(n instanceof _n))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const d=this.evalExpression(s.index,t).value;if(d<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(a instanceof ze))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const p=n.typeInfo.getTypeName();if(p==="mat2x2"||p==="mat2x2f"||p==="mat2x2h"){if(!(d<2&&a.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*d]=a.data[0],n.data[2*d+1]=a.data[1]}else if(p==="mat2x3"||p==="mat2x3f"||p==="mat2x3h"){if(!(d<2&&a.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*d]=a.data[0],n.data[3*d+1]=a.data[1],n.data[3*d+2]=a.data[2]}else if(p==="mat2x4"||p==="mat2x4f"||p==="mat2x4h"){if(!(d<2&&a.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*d]=a.data[0],n.data[4*d+1]=a.data[1],n.data[4*d+2]=a.data[2],n.data[4*d+3]=a.data[3]}else if(p==="mat3x2"||p==="mat3x2f"||p==="mat3x2h"){if(!(d<3&&a.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*d]=a.data[0],n.data[2*d+1]=a.data[1]}else if(p==="mat3x3"||p==="mat3x3f"||p==="mat3x3h"){if(!(d<3&&a.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*d]=a.data[0],n.data[3*d+1]=a.data[1],n.data[3*d+2]=a.data[2]}else if(p==="mat3x4"||p==="mat3x4f"||p==="mat3x4h"){if(!(d<3&&a.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*d]=a.data[0],n.data[4*d+1]=a.data[1],n.data[4*d+2]=a.data[2],n.data[4*d+3]=a.data[3]}else if(p==="mat4x2"||p==="mat4x2f"||p==="mat4x2h"){if(!(d<4&&a.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[2*d]=a.data[0],n.data[2*d+1]=a.data[1]}else if(p==="mat4x3"||p==="mat4x3f"||p==="mat4x3h"){if(!(d<4&&a.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[3*d]=a.data[0],n.data[3*d+1]=a.data[1],n.data[3*d+2]=a.data[2]}else{if(p!=="mat4x4"&&p!=="mat4x4f"&&p!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(d<4&&a.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);n.data[4*d]=a.data[0],n.data[4*d+1]=a.data[1],n.data[4*d+2]=a.data[2],n.data[4*d+3]=a.data[3]}}}}}else if(s instanceof Vf){const u=s.value;if(!(n instanceof ze))return void console.error(`Invalid assignment to ${u}. Variable ${i} is not a vector. Line ${e.line}`);if(a instanceof gt){if(u.length>1)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);if(u==="x")n.data[0]=a.value;else if(u==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);n.data[1]=a.value}else if(u==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);n.data[2]=a.value}else if(u==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);n.data[3]=a.value}}else{if(!(a instanceof ze))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(u.length!==a.data.length)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);for(let d=0;d<u.length;++d){const p=u[d];if(p==="x"||p==="r")n.data[0]=a.data[d];else if(p==="y"||p==="g"){if(a.data.length<2)return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);n.data[1]=a.data[d]}else if(p==="z"||p==="b"){if(a.data.length<3)return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);n.data[2]=a.data[d]}else{if(p!=="w"&&p!=="a")return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);if(a.data.length<4)return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);n.data[3]=a.data[d]}}}}}else n instanceof gt&&a instanceof gt?n.value=a.value:n instanceof ze&&a instanceof ze||n instanceof _n&&a instanceof _n?n.data.set(a.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`)}_function(e,t){const n=new Dq(e);t.functions.set(e.name,n)}_const(e,t){let n=null;e.value!==null&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,t),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Xs||(n=n.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const s=new Du(e.type,[]);n=this._evalCreate(s,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,t),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Xs||(n=n.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof Am||e.type instanceof Rh||e.type instanceof vt){const s=new Du(e.type,[]);n=this._evalCreate(s,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof gt))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const s of e.cases)if(s instanceof RP)for(const a of s.selectors){if(a instanceof e0){i=s;continue}const o=this.evalExpression(a,t);if(!(o instanceof gt))return console.error(`Invalid case selector. Line ${e.line}`),null;if(o.value===n.value)return this._execStatements(s.body,t)}else s instanceof LP&&(i=s);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof gt))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,t);for(const i of e.elseif){const s=this.evalExpression(i.condition,t);if(!(s instanceof gt))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(i.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof gt?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===Mc._breakObj)break;if(n!==null&&n!==Mc._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===Mc._breakObj)break;if(n===Mc._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Mc._breakObj)break}else if(n!==null)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===Mc._breakObj)break;if(n!==Mc._continueObj&&n!==null)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),i=e.type;if(n instanceof gt){const s=NP(n.value,n.typeInfo.name,i.name);return new gt(s,this.getTypeInfo(i))}if(n instanceof ze){const s=n.typeInfo.getTypeName();let a="";if(s.endsWith("f"))a="f32";else if(s.endsWith("i"))a="i32";else if(s.endsWith("u"))a="u32";else if(s.endsWith("b"))a="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;a="f16"}const o=i.getTypeName();let u="";if(o.endsWith("f"))u="f32";else if(o.endsWith("i"))u="i32";else if(o.endsWith("u"))u="u32";else if(o.endsWith("b"))u="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${u}. Line ${e.line}`),null;u="f16"}const d=function(p,b,C){if(b===C)return p;const w=new Array(p.length);for(let M=0;M<p.length;M++)w[M]=NP(p[M],b,C);return w}(Array.from(n.data),a,u);return new ze(d,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof Du){if(e.type===null)return Vw.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const i=e instanceof Du?e.type.name:e.name,s=e instanceof Du?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(s.size===0)return null;const a=new Fo(new ArrayBuffer(s.size),s,0);if(s instanceof FA){if(e.args)for(let o=0;o<e.args.length;++o){const u=s.members[o],d=e.args[o],p=this.evalExpression(d,t);a.setData(this,p,u.type,u.offset,t)}}else if(s instanceof RA){let o=0;if(e.args)for(let u=0;u<e.args.length;++u){const d=e.args[u],p=this.evalExpression(d,t);s.format===null&&(((n=p.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=p.typeInfo),a.setData(this,p,s.format,o,t),o+=s.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof Du?a.getSubData(this,e.postfix,t):a}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),i=n.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new gt(e.scalarValue,n):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,t):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return n===null?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const i=Mc._priority.get(t.name);Mc._priority.get(e[n].name)<i&&(t=e[n])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if(e.operator==="&")return new dp(n);if(e.operator==="*")return n instanceof dp?n.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=n instanceof gt?n.value:n instanceof ze?Array.from(n.data):null;switch(e.operator){case"+":{if(xr(i)){const o=i.map((u,d)=>+u);return new ze(o,n.typeInfo)}const s=i,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new gt(+s,a)}case"-":{if(xr(i)){const o=i.map((u,d)=>-u);return new ze(o,n.typeInfo)}const s=i,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new gt(-s,a)}case"!":{if(xr(i)){const o=i.map((u,d)=>u?0:1);return new ze(o,n.typeInfo)}const s=i,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new gt(s?0:1,a)}case"~":{if(xr(i)){const o=i.map((u,d)=>~u);return new ze(o,n.typeInfo)}const s=i,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new gt(~s,a)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),s=n instanceof gt?n.value:n instanceof ze||n instanceof _n?Array.from(n.data):null,a=i instanceof gt?i.value:i instanceof ze||i instanceof _n?Array.from(i.data):null;switch(e.operator){case"+":{if(xr(s)&&xr(a)){const p=s,b=a;if(p.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const C=p.map((w,M)=>w+b[M]);return new ze(C,n.typeInfo)}if(xr(s)){const p=a,b=s.map((C,w)=>C+p);return new ze(b,n.typeInfo)}if(xr(a)){const p=s,b=a.map((C,w)=>p+C);return new ze(b,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new gt(o+u,d)}case"-":{if(xr(s)&&xr(a)){const p=s,b=a;if(p.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const C=p.map((w,M)=>w-b[M]);return new ze(C,n.typeInfo)}if(xr(s)){const p=a,b=s.map((C,w)=>C-p);return new ze(b,n.typeInfo)}if(xr(a)){const p=s,b=a.map((C,w)=>p-C);return new ze(b,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new gt(o-u,d)}case"*":{if(xr(s)&&xr(a)){const p=s,b=a;if(n instanceof _n&&i instanceof _n){const C=function(k,D,j,H){if(Sa[D.name]===void 0||Sa[H.name]===void 0)return null;const N=Sa[D.name][0],q=Sa[D.name][1],W=Sa[H.name][0];if(N!==Sa[H.name][1])return null;const ie=new Array(W*q);for(let se=0;se<q;se++)for(let Z=0;Z<W;Z++){let fe=0;for(let te=0;te<N;te++)fe+=k[te*q+se]*j[Z*N+te];ie[se*W+Z]=fe}return ie}(p,n.typeInfo,b,i.typeInfo);if(C===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const w=Sa[i.typeInfo.name][0],M=Sa[n.typeInfo.name][1],P=this.getTypeInfo(`mat${w}x${M}f`);return new _n(C,P)}if(n instanceof _n&&i instanceof ze){const C=function(w,M,P,k){if(Sa[M.name]===void 0||$w[k.name]===void 0)return null;const D=Sa[M.name][0],j=Sa[M.name][1];if(D!==P.length)return null;const H=new Array(j);for(let N=0;N<j;N++){let q=0;for(let W=0;W<D;W++)q+=w[W*j+N]*P[W];H[N]=q}return H}(p,n.typeInfo,b,i.typeInfo);return C===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new ze(C,i.typeInfo)}if(n instanceof ze&&i instanceof _n){const C=function(w,M,P,k){if($w[M.name]===void 0||Sa[k.name]===void 0)return null;const D=Sa[k.name][0],j=Sa[k.name][1];if(j!==w.length)return null;const H=[];for(let N=0;N<D;N++){let q=0;for(let W=0;W<j;W++)q+=w[W]*P[W*D+N];H[N]=q}return H}(p,n.typeInfo,b,i.typeInfo);return C===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new ze(C,n.typeInfo)}{if(p.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const C=p.map((w,M)=>w*b[M]);return new ze(C,n.typeInfo)}}if(xr(s)){const p=a,b=s.map((C,w)=>C*p);return n instanceof _n?new _n(b,n.typeInfo):new ze(b,n.typeInfo)}if(xr(a)){const p=s,b=a.map((C,w)=>p*C);return i instanceof _n?new _n(b,i.typeInfo):new ze(b,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new gt(o*u,d)}case"%":{if(xr(s)&&xr(a)){const p=s,b=a;if(p.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const C=p.map((w,M)=>w%b[M]);return new ze(C,n.typeInfo)}if(xr(s)){const p=a,b=s.map((C,w)=>C%p);return new ze(b,n.typeInfo)}if(xr(a)){const p=s,b=a.map((C,w)=>p%C);return new ze(b,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new gt(o%u,d)}case"/":{if(xr(s)&&xr(a)){const p=s,b=a;if(p.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const C=p.map((w,M)=>w/b[M]);return new ze(C,n.typeInfo)}if(xr(s)){const p=a,b=s.map((C,w)=>C/p);return new ze(b,n.typeInfo)}if(xr(a)){const p=s,b=a.map((C,w)=>p/C);return new ze(b,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new gt(o/u,d)}case"&":{if(xr(s)&&xr(a)){const p=s,b=a;if(p.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const C=p.map((w,M)=>w&b[M]);return new ze(C,n.typeInfo)}if(xr(s)){const p=a,b=s.map((C,w)=>C&p);return new ze(b,n.typeInfo)}if(xr(a)){const p=s,b=a.map((C,w)=>p&C);return new ze(b,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new gt(o&u,d)}case"|":{if(xr(s)&&xr(a)){const p=s,b=a;if(p.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const C=p.map((w,M)=>w|b[M]);return new ze(C,n.typeInfo)}if(xr(s)){const p=a,b=s.map((C,w)=>C|p);return new ze(b,n.typeInfo)}if(xr(a)){const p=s,b=a.map((C,w)=>p|C);return new ze(b,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new gt(o|u,d)}case"^":{if(xr(s)&&xr(a)){const p=s,b=a;if(p.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const C=p.map((w,M)=>w^b[M]);return new ze(C,n.typeInfo)}if(xr(s)){const p=a,b=s.map((C,w)=>C^p);return new ze(b,n.typeInfo)}if(xr(a)){const p=s,b=a.map((C,w)=>p^C);return new ze(b,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new gt(o^u,d)}case"<<":{if(xr(s)&&xr(a)){const p=s,b=a;if(p.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const C=p.map((w,M)=>w<<b[M]);return new ze(C,n.typeInfo)}if(xr(s)){const p=a,b=s.map((C,w)=>C<<p);return new ze(b,n.typeInfo)}if(xr(a)){const p=s,b=a.map((C,w)=>p<<C);return new ze(b,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new gt(o<<u,d)}case">>":{if(xr(s)&&xr(a)){const p=s,b=a;if(p.length!==b.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const C=p.map((w,M)=>w>>b[M]);return new ze(C,n.typeInfo)}if(xr(s)){const p=a,b=s.map((C,w)=>C>>p);return new ze(b,n.typeInfo)}if(xr(a)){const p=s,b=a.map((C,w)=>p>>C);return new ze(b,i.typeInfo)}const o=s,u=a,d=this._maxFormatTypeInfo([n.typeInfo,i.typeInfo]);return new gt(o>>u,d)}case">":if(xr(s)&&xr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,b)=>p>u[b]?1:0);return new ze(d,n.typeInfo)}if(xr(s)){const o=a,u=s.map((d,p)=>d>o?1:0);return new ze(u,n.typeInfo)}if(xr(a)){const o=s,u=a.map((d,p)=>o>d?1:0);return new ze(u,i.typeInfo)}return new gt(s>a?1:0,this.getTypeInfo("bool"));case"<":if(xr(s)&&xr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,b)=>p<u[b]?1:0);return new ze(d,n.typeInfo)}if(xr(s)){const o=a,u=s.map((d,p)=>d<o?1:0);return new ze(u,n.typeInfo)}if(xr(a)){const o=s,u=a.map((d,p)=>o<d?1:0);return new ze(u,i.typeInfo)}return new gt(s<a?1:0,this.getTypeInfo("bool"));case"==":if(xr(s)&&xr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,b)=>p===u[b]?1:0);return new ze(d,n.typeInfo)}if(xr(s)){const o=a,u=s.map((d,p)=>d==o?1:0);return new ze(u,n.typeInfo)}if(xr(a)){const o=s,u=a.map((d,p)=>o==d?1:0);return new ze(u,i.typeInfo)}return new gt(s===a?1:0,this.getTypeInfo("bool"));case"!=":if(xr(s)&&xr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,b)=>p!==u[b]?1:0);return new ze(d,n.typeInfo)}if(xr(s)){const o=a,u=s.map((d,p)=>d!==o?1:0);return new ze(u,n.typeInfo)}if(xr(a)){const o=s,u=a.map((d,p)=>o!==d?1:0);return new ze(u,i.typeInfo)}return new gt(s!==a?1:0,this.getTypeInfo("bool"));case">=":if(xr(s)&&xr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,b)=>p>=u[b]?1:0);return new ze(d,n.typeInfo)}if(xr(s)){const o=a,u=s.map((d,p)=>d>=o?1:0);return new ze(u,n.typeInfo)}if(xr(a)){const o=s,u=a.map((d,p)=>o>=d?1:0);return new ze(u,i.typeInfo)}return new gt(s>=a?1:0,this.getTypeInfo("bool"));case"<=":if(xr(s)&&xr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,b)=>p<=u[b]?1:0);return new ze(d,n.typeInfo)}if(xr(s)){const o=a,u=s.map((d,p)=>d<=o?1:0);return new ze(u,n.typeInfo)}if(xr(a)){const o=s,u=a.map((d,p)=>o<=d?1:0);return new ze(u,i.typeInfo)}return new gt(s<=a?1:0,this.getTypeInfo("bool"));case"&&":if(xr(s)&&xr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,b)=>p&&u[b]?1:0);return new ze(d,n.typeInfo)}if(xr(s)){const o=a,u=s.map((d,p)=>d&&o?1:0);return new ze(u,n.typeInfo)}if(xr(a)){const o=s,u=a.map((d,p)=>o&&d?1:0);return new ze(u,i.typeInfo)}return new gt(s&&a?1:0,this.getTypeInfo("bool"));case"||":if(xr(s)&&xr(a)){const o=s,u=a;if(o.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=o.map((p,b)=>p||u[b]?1:0);return new ze(d,n.typeInfo)}if(xr(s)){const o=a,u=s.map((d,p)=>d||o?1:0);return new ze(u,n.typeInfo)}if(xr(a)){const o=s,u=a.map((d,p)=>o||d?1:0);return new ze(u,i.typeInfo)}return new gt(s||a?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const i=t.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<i.node.args.length;++s){const a=i.node.args[s],o=this.evalExpression(e.args[s],n);n.createVariable(a.name,o,a)}return this._execStatements(i.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const i=t.clone();for(let s=0;s<n.node.args.length;++s){const a=n.node.args[s],o=this.evalExpression(e.args[s],i);i.setVariable(a.name,o,a)}return this._execStatements(n.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new gt(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=$w[i];if(s===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const a=[];if(e instanceof mo)if(e.isVector){const o=e.vectorValue;for(const u of o)a.push(u)}else a.push(e.scalarValue);else if(e.args)for(const o of e.args){const u=this.evalExpression(o,t);if(u instanceof ze){const d=u.data;for(let p=0;p<d.length;++p){let b=d[p];a.push(b)}}else if(u instanceof gt){let d=u.value;a.push(d)}}if(e.type instanceof vt&&e.type.format===null&&(e.type.format=vt.f32),a.length===0){const o=new Array(s).fill(0);return new ze(o,n).getSubData(this,e.postfix,t)}if(a.length===1)for(;a.length<s;)a.push(a[0]);return a.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new ze(a.length>s?a.slice(0,s):a,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=Sa[i];if(s===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const a=[];if(e instanceof mo)if(e.isVector){const o=e.vectorValue;for(const u of o)a.push(u)}else a.push(e.scalarValue);else if(e.args)for(const o of e.args){const u=this.evalExpression(o,t);u instanceof ze?a.push(...u.data):u instanceof gt?a.push(u.value):u instanceof _n&&a.push(...u.data)}if(n instanceof Hf&&n.format===null&&(n.format=this.getTypeInfo("f32")),a.length===0){const o=new Array(s[2]).fill(0);return new _n(o,n).getSubData(this,e.postfix,t)}return a.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new _n(a,n).getSubData(this,e.postfix,t)}};s0._breakObj=new ku(new Xl("BREAK",null),null),s0._continueObj=new ku(new Xl("CONTINUE",null),null),s0._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);let Qq=class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}},Hq=class{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new Qq,this._exec=new s0,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;t.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const i=n.arrayType,s=n.countNode;if(s instanceof bl){const a=s.name,o=this._context.constants.get(a);if(o)try{const u=o.constEvaluate(this._exec);i.count=u}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of t)n.search(i=>{i instanceof UP||i instanceof Jy?i.type=this._forwardType(i.type):i instanceof Am?i.format=this._forwardType(i.format):i instanceof Fh||i instanceof um||i instanceof Zy?i.type=this._forwardType(i.type):i instanceof cm?i.returnType=this._forwardType(i.returnType):i instanceof OP&&(i.type=this._forwardType(i.type))});return t}_forwardType(e){if(e instanceof SP){const t=this._getType(e.name);if(t)return t}else e instanceof Jy?e.type=this._forwardType(e.type):e instanceof Am&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new Sq(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Pe.eof}_match(e){if(e instanceof pt)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const i=e[t];if(this._check(i))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let i=!1;for(const s of e){if(n===s)return!0;s===Pe.tokens.name&&(i=!0)}if(i){const s=Pe.tokens.name.rule.exec(t.lexeme);if(s&&s.index==0&&s[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===Pe.tokens.name){const n=Pe.tokens.name.rule.exec(t.lexeme);return n&&n.index==0&&n[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Pe.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Pe.keywords.alias)){const t=this._type_alias();return this._consume(Pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Pe.keywords.diagnostic)){const t=this._diagnostic();return this._consume(Pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Pe.keywords.requires)){const t=this._requires_directive();return this._consume(Pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Pe.keywords.enable)){const t=this._enable_directive();return this._consume(Pe.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(Pe.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(Pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(Pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(Pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(Pe.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(Pe.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(Pe.keywords.fn))return null;const e=this._currentLine,t=this._consume(Pe.tokens.ident,"Expected function name.").toString();this._consume(Pe.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(Pe.tokens.paren_right))do{if(this._check(Pe.tokens.paren_right))break;const o=this._attribute(),u=this._consume(Pe.tokens.name,"Expected argument name.").toString();this._consume(Pe.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=d,n.push(this._updateNode(new OP(u,p,o))))}while(this._match(Pe.tokens.comma));this._consume(Pe.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(Pe.tokens.arrow)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}const s=this._compound_statement(),a=this._currentLine;return this._updateNode(new cm(t,n,i,s,e,a),e)}_compound_statement(){const e=[];for(this._consume(Pe.tokens.brace_left,"Expected '{' for block.");!this._check(Pe.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(Pe.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Pe.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Pe.tokens.attr)&&this._attribute(),this._check(Pe.keywords.if))return this._if_statement();if(this._check(Pe.keywords.switch))return this._switch_statement();if(this._check(Pe.keywords.loop))return this._loop_statement();if(this._check(Pe.keywords.for))return this._for_statement();if(this._check(Pe.keywords.while))return this._while_statement();if(this._check(Pe.keywords.continuing))return this._continuing_statement();if(this._check(Pe.keywords.static_assert))return this._static_assert_statement();if(this._check(Pe.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(Pe.keywords.return))e=this._return_statement();else if(this._check([Pe.keywords.var,Pe.keywords.let,Pe.keywords.const]))e=this._variable_statement();else if(this._match(Pe.keywords.discard))e=this._updateNode(new Cq);else if(this._match(Pe.keywords.break)){const t=this._updateNode(new TP);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t,this._check(Pe.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(Pe.keywords.continue)){const t=this._updateNode(new EP);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(Pe.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Pe.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new wq(t),e)}_while_statement(){if(!this._match(Pe.keywords.while))return null;const e=this._updateNode(new mP(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Pe.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Pe.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new kw(n,e),t)}_for_statement(){if(!this._match(Pe.keywords.for))return null;this._consume(Pe.tokens.paren_left,"Expected '('.");const e=this._updateNode(new _P(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(Pe.tokens.semicolon)?null:this._for_init(),this._consume(Pe.tokens.semicolon,"Expected ';'."),e.condition=this._check(Pe.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Pe.tokens.semicolon,"Expected ';'."),e.increment=this._check(Pe.tokens.paren_right)?null:this._for_increment(),this._consume(Pe.tokens.paren_right,"Expected ')'."),this._check(Pe.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Pe.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(Pe.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Fh(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(Pe.keywords.let)){const e=this._currentLine,t=this._consume(Pe.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(Pe.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}this._consume(Pe.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new um(t,n,null,null,i),e)}if(this._match(Pe.keywords.const)){const e=this._currentLine,t=this._consume(Pe.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(Pe.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}this._consume(Pe.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return n===null&&i instanceof mo&&(n=i.type),this._updateNode(new Zy(t,n,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(Pe.increment_operators))return this._current=e,null;const n=this._consume(Pe.increment_operators,"Expected increment operator");return this._updateNode(new yP(n.type===Pe.tokens.plus_plus?Ap.increment:Ap.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(Pe.tokens.brace_right))return null;let n=this._match(Pe.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const i=this._consume(Pe.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new bP(hm.parse(i.lexeme),e,s),t)}_func_call_statement(){if(!this._check(Pe.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(Pe.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=t,null):this._updateNode(new zw(n.lexeme,i),e)}_loop_statement(){if(!this._match(Pe.keywords.loop))return null;this._check(Pe.tokens.attr)&&this._attribute(),this._consume(Pe.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new vP([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof kw){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(Pe.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(Pe.keywords.switch))return null;const e=this._updateNode(new wP(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Pe.tokens.attr)&&this._attribute(),this._consume(Pe.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Pe.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([Pe.keywords.default,Pe.keywords.case]);){if(this._match(Pe.keywords.case)){const n=this._case_selectors();for(const s of n)if(s instanceof e0){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(Pe.tokens.colon),this._check(Pe.tokens.attr)&&this._attribute(),this._consume(Pe.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(Pe.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new RP(n,i)))}if(this._match(Pe.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Pe.tokens.colon),this._check(Pe.tokens.attr)&&this._attribute(),this._consume(Pe.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(Pe.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new LP(n)))}}return e}_case_selectors(){const e=[];for(this._match(Pe.keywords.default)?e.push(this._updateNode(new e0)):e.push(this._shift_expression());this._match(Pe.tokens.comma);)this._match(Pe.keywords.default)?e.push(this._updateNode(new e0)):e.push(this._shift_expression());return e}_case_body(){if(this._match(Pe.keywords.fallthrough))return this._consume(Pe.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(Pe.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(Pe.tokens.attr)&&this._attribute();const n=this._compound_statement();let i=[];this._match_elseif()&&(this._check(Pe.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(Pe.keywords.else)&&(this._check(Pe.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new xP(t,n,i,s),e)}_match_elseif(){return this._tokens[this._current].type===Pe.keywords.else&&this._tokens[this._current+1].type===Pe.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new Tq(t,n))),this._match_elseif()&&(this._check(Pe.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Pe.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new BP(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Pe.tokens.or_or);)e=this._updateNode(new Lc(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Pe.tokens.and_and);)e=this._updateNode(new Lc(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Pe.tokens.or);)e=this._updateNode(new Lc(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Pe.tokens.xor);)e=this._updateNode(new Lc(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(Pe.tokens.and);)e=this._updateNode(new Lc(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([Pe.tokens.equal_equal,Pe.tokens.not_equal])?this._updateNode(new Lc(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Pe.tokens.less_than,Pe.tokens.greater_than,Pe.tokens.less_than_equal,Pe.tokens.greater_than_equal]);)e=this._updateNode(new Lc(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Pe.tokens.shift_left,Pe.tokens.shift_right]);)e=this._updateNode(new Lc(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Pe.tokens.plus,Pe.tokens.minus]);)e=this._updateNode(new Lc(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Pe.tokens.star,Pe.tokens.forward_slash,Pe.tokens.modulo]);)e=this._updateNode(new Lc(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([Pe.tokens.minus,Pe.tokens.bang,Pe.tokens.tilde,Pe.tokens.star,Pe.tokens.and])?this._updateNode(new Xs(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(Pe.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Pe.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new fp(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(Pe.tokens.period)){const e=this._consume(Pe.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new Vf(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return Jt.void;case"bool":return Jt.bool;case"i32":return Jt.i32;case"u32":return Jt.u32;case"f32":return Jt.f32;case"f16":return Jt.f16;case"vec2f":return vt.vec2f;case"vec3f":return vt.vec3f;case"vec4f":return vt.vec4f;case"vec2i":return vt.vec2i;case"vec3i":return vt.vec3i;case"vec4i":return vt.vec4i;case"vec2u":return vt.vec2u;case"vec3u":return vt.vec3u;case"vec4u":return vt.vec4u;case"vec2h":return vt.vec2h;case"vec3h":return vt.vec3h;case"vec4h":return vt.vec4h;case"mat2x2f":return vt.mat2x2f;case"mat2x3f":return vt.mat2x3f;case"mat2x4f":return vt.mat2x4f;case"mat3x2f":return vt.mat3x2f;case"mat3x3f":return vt.mat3x3f;case"mat3x4f":return vt.mat3x4f;case"mat4x2f":return vt.mat4x2f;case"mat4x3f":return vt.mat4x3f;case"mat4x4f":return vt.mat4x4f;case"mat2x2h":return vt.mat2x2h;case"mat2x3h":return vt.mat2x3h;case"mat2x4h":return vt.mat2x4h;case"mat3x2h":return vt.mat3x2h;case"mat3x3h":return vt.mat3x3h;case"mat3x4h":return vt.mat3x4h;case"mat4x2h":return vt.mat4x2h;case"mat4x3h":return vt.mat4x3h;case"mat4x4h":return vt.mat4x4h;case"mat2x2i":return vt.mat2x2i;case"mat2x3i":return vt.mat2x3i;case"mat2x4i":return vt.mat2x4i;case"mat3x2i":return vt.mat3x2i;case"mat3x3i":return vt.mat3x3i;case"mat3x4i":return vt.mat3x4i;case"mat4x2i":return vt.mat4x2i;case"mat4x3i":return vt.mat4x3i;case"mat4x4i":return vt.mat4x4i;case"mat2x2u":return vt.mat2x2u;case"mat2x3u":return vt.mat2x3u;case"mat2x4u":return vt.mat2x4u;case"mat3x2u":return vt.mat3x2u;case"mat3x3u":return vt.mat3x3u;case"mat3x4u":return vt.mat3x4u;case"mat4x2u":return vt.mat4x2u;case"mat4x3u":return vt.mat4x3u;case"mat4x4u":return vt.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Pe.tokens.ident)){const n=this._previous().toString();if(this._check(Pe.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getType(n);return s!==null?this._updateNode(new Du(s,i)):this._updateNode(new Hw(n,i))}if(this._context.constants.has(n)){const i=this._context.constants.get(n);return this._updateNode(new IP(n,i.value))}return this._updateNode(new bl(n))}if(this._match(Pe.tokens.int_literal)){const n=this._previous().toString();let i=n.endsWith("i")||n.endsWith("i")?Jt.i32:n.endsWith("u")||n.endsWith("U")?Jt.u32:Jt.x32;const s=parseInt(n);return this._validateTypeRange(s,i),this._updateNode(new mo(new gt(s,this._exec.getTypeInfo(i)),i))}if(this._match(Pe.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,Jt.u32),this._updateNode(new mo(new gt(n,this._exec.getTypeInfo(Jt.u32)),Jt.u32))}if(this._match([Pe.tokens.decimal_float_literal,Pe.tokens.hex_float_literal])){let n=this._previous().toString(),i=n.endsWith("h");i&&(n=n.substring(0,n.length-1));const s=parseFloat(n);this._validateTypeRange(s,i?Jt.f16:Jt.f32);const a=i?Jt.f16:Jt.f32;return this._updateNode(new mo(new gt(s,this._exec.getTypeInfo(a)),a))}if(this._match([Pe.keywords.true,Pe.keywords.false])){let n=this._previous().toString()===Pe.keywords.true.rule;return this._updateNode(new mo(new gt(n?1:0,this._exec.getTypeInfo(Jt.bool)),Jt.bool))}if(this._check(Pe.tokens.paren_left))return this._paren_expression();if(this._match(Pe.keywords.bitcast)){this._consume(Pe.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(Pe.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new PP(n,i))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Du(e,t))}_argument_expression_list(){if(!this._match(Pe.tokens.paren_left))return null;const e=[];do{if(this._check(Pe.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(Pe.tokens.comma));return this._consume(Pe.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Pe.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Pe.tokens.paren_right),e}_paren_expression(){this._consume(Pe.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Pe.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(Pe.keywords.struct))return null;const e=this._currentLine,t=this._consume(Pe.tokens.ident,"Expected name for struct.").toString();this._consume(Pe.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(Pe.tokens.brace_right);){const a=this._attribute(),o=this._consume(Pe.tokens.name,"Expected variable name.").toString();this._consume(Pe.tokens.colon,"Expected ':' for struct member type.");const u=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=u),this._check(Pe.tokens.brace_right)?this._match(Pe.tokens.comma):this._consume(Pe.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new UP(o,d,a)))}this._consume(Pe.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=this._updateNode(new Rh(t,n,e,i),e);return this._context.structs.set(t,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(Pe.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof mo){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof mo&&(e.type=e.value.type.name==="x32"?Jt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Pe.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(Pe.keywords.const))return null;const t=this._consume(Pe.tokens.name,"Expected variable name"),n=this._currentLine;let i=null;if(this._match(Pe.tokens.colon)){const u=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=u)}let s=null;this._consume(Pe.tokens.equal,"const declarations require an assignment");const a=this._short_circuit_or_expression();try{let u=[Jt.f32],d=a.constEvaluate(this._exec,u);d instanceof gt&&this._validateTypeRange(d.value,u[0]),u[0]instanceof vt&&u[0].format===null&&d.typeInfo instanceof Hf&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?u[0].format=Jt.f16:d.typeInfo.format.name==="f32"?u[0].format=Jt.f32:d.typeInfo.format.name==="i32"?u[0].format=Jt.i32:d.typeInfo.format.name==="u32"?u[0].format=Jt.u32:d.typeInfo.format.name==="bool"?u[0].format=Jt.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),s=this._updateNode(new mo(d,u[0])),this._exec.context.setVariable(t.toString(),d)}catch{s=a}if(i!==null&&s instanceof mo){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else i===null&&s instanceof mo&&(i=(e=s?.type)!==null&&e!==void 0?e:Jt.f32,i===Jt.x32&&(i=Jt.i32));const o=this._updateNode(new Zy(t.toString(),i,"","",s),n);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(Pe.keywords.let))return null;const e=this._currentLine,t=this._consume(Pe.tokens.name,"Expected variable name");let n=null;if(this._match(Pe.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}let i=null;if(this._match(Pe.tokens.equal)&&(i=this._const_expression()),n!==null&&i instanceof mo){if(i.type.name!=="x32"&&n.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${n.name}. Line:${this._currentLine}`);i.type=n}else n===null&&i instanceof mo&&(n=i.type.name==="x32"?Jt.i32:i.type);return i instanceof mo&&i.isScalar&&this._validateTypeRange(i.scalarValue,n),this._updateNode(new um(t.toString(),n,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Pe.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(Pe.tokens.less_than)&&(t=this._consume(Pe.storage_class,"Expected storage_class.").toString(),this._match(Pe.tokens.comma)&&(n=this._consume(Pe.access_mode,"Expected access_mode.").toString()),this._consume(Pe.tokens.greater_than,"Expected '>'."));const i=this._consume(Pe.tokens.name,"Expected variable name");let s=null;if(this._match(Pe.tokens.colon)){const a=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=a)}return this._updateNode(new Fh(i.toString(),s,t,n,null),e)}_override_decl(){if(!this._match(Pe.keywords.override))return null;const e=this._consume(Pe.tokens.name,"Expected variable name");let t=null;if(this._match(Pe.tokens.colon)){const n=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=n)}return this._updateNode(new Nw(e.toString(),t,null))}_diagnostic(){this._consume(Pe.tokens.paren_left,"Expected '('");const e=this._consume(Pe.tokens.ident,"Expected severity control name.");this._consume(Pe.tokens.comma,"Expected ','");let t=this._consume(Pe.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Pe.tokens.period)&&(t+=`.${this._consume(Pe.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Pe.tokens.paren_right,"Expected ')'"),this._updateNode(new CP(e.toString(),t))}_enable_directive(){const e=this._consume(Pe.tokens.ident,"identity expected.");return this._updateNode(new xq(e.toString()))}_requires_directive(){const e=[this._consume(Pe.tokens.ident,"identity expected.").toString()];for(;this._match(Pe.tokens.comma);){const t=this._consume(Pe.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new Bq(e))}_type_alias(){const e=this._consume(Pe.tokens.ident,"identity expected.");this._consume(Pe.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new Qw(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Pe.tokens.ident,...Pe.texel_format,Pe.keywords.bool,Pe.keywords.f32,Pe.keywords.i32,Pe.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const i=this._updateNode(new SP(n));return this._forwardTypeCount++,i}return this._updateNode(new Jt(n))}let e=this._texture_sampler_types();if(e)return e;if(this._check(Pe.template_types)){let n=this._advance().toString(),i=null,s=null;return this._match(Pe.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(Pe.tokens.comma)&&(s=this._consume(Pe.access_mode,"Expected access_mode for pointer").toString()),this._consume(Pe.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new vt(n,i,s))}if(this._match(Pe.keywords.ptr)){let n=this._previous().toString();this._consume(Pe.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(Pe.storage_class,"Expected storage_class for pointer");this._consume(Pe.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let a=null;return this._match(Pe.tokens.comma)&&(a=this._consume(Pe.access_mode,"Expected access_mode for pointer").toString()),this._consume(Pe.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Jy(n,i.toString(),s,a))}const t=this._attribute();if(this._match(Pe.keywords.array)){let n=null,i=-1;const s=this._previous();let a=null;if(this._match(Pe.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let u="";if(this._match(Pe.tokens.comma)){a=this._shift_expression();try{u=a.constEvaluate(this._exec).toString(),a=null}catch{u="1"}}this._consume(Pe.tokens.greater_than,"Expected '>' for array."),i=u?parseInt(u):0}const o=this._updateNode(new Am(s.toString(),t,n,i));return a&&this._deferArrayCountEval.push({arrayType:o,countNode:a}),o}return null}_texture_sampler_types(){if(this._match(Pe.sampler_type))return this._updateNode(new fm(this._previous().toString(),null,null));if(this._match(Pe.depth_texture_type))return this._updateNode(new fm(this._previous().toString(),null,null));if(this._match(Pe.sampled_texture_type)||this._match(Pe.multisampled_texture_type)){const e=this._previous();this._consume(Pe.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(Pe.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new fm(e.toString(),t,null))}if(this._match(Pe.storage_texture_type)){const e=this._previous();this._consume(Pe.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(Pe.texel_format,"Invalid texel format.").toString();this._consume(Pe.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Pe.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Pe.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new fm(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(Pe.tokens.attr);){const t=this._consume(Pe.attribute_name,"Expected attribute name"),n=this._updateNode(new DP(t.toString(),null));if(this._match(Pe.tokens.paren_left)){if(n.value=this._consume(Pe.literal_or_ident,"Expected attribute value").toString(),this._check(Pe.tokens.comma)){this._advance();do{const i=this._consume(Pe.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(i)}while(this._match(Pe.tokens.comma))}this._consume(Pe.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}},Vq=class extends dm{constructor(e){super(),e&&this.update(e)}update(e){const t=new Hq().parse(e);this.updateAST(t)}};function jq(r){const e={attributes:[],bindings:[]};let t;try{t=$q(r)}catch(s){return Xt.error(s.message)(),e}for(const s of t.uniforms){const a=[];for(const o of s.type?.members||[])a.push({name:o.name,type:zP(o.type)});e.bindings.push({type:"uniform",name:s.name,group:s.group,location:s.binding,members:a})}for(const s of t.textures)e.bindings.push({type:"texture",name:s.name,group:s.group,location:s.binding});for(const s of t.samplers)e.bindings.push({type:"sampler",name:s.name,group:s.group,location:s.binding});const n=t.entry.vertex[0],i=n?.inputs.length||0;for(let s=0;s<i;s++){const a=n.inputs[s];if(a.locationType==="location"){const o=zP(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:o})}}return e}function zP(r){return r?.format?`${r.name}<${r.format.name}>`:r.name}function $q(r){try{return new Vq(r)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const Gq=1/Math.PI*180,Wq=1/180*Math.PI,qq={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...qq}};const _o=globalThis.mathgl.config;function Kq(r,{precision:e=_o.precision}={}){return r=Jq(r),`${parseFloat(r.toPrecision(e))}`}function OA(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Xq(r){return Zq(r)}function Yq(r){return Oc(r)}function Zq(r,e){return Gw(r,t=>t*Wq,e)}function Oc(r,e){return Gw(r,t=>t*Gq,e)}function Uc(r,e,t){return Gw(r,n=>Math.max(e,Math.min(t,n)))}function o0(r,e,t){return OA(r)?r.map((n,i)=>o0(n,e[i],t)):t*e+(1-t)*r}function Dc(r,e,t){const n=_o.EPSILON;t&&(_o.EPSILON=t);try{if(r===e)return!0;if(OA(r)&&OA(e)){if(r.length!==e.length)return!1;for(let i=0;i<r.length;++i)if(!Dc(r[i],e[i]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=_o.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{_o.EPSILON=n}}function Jq(r){return Math.round(r/_o.EPSILON)*_o.EPSILON}function eK(r){return r.clone?r.clone():new Array(r.length)}function Gw(r,e,t){if(OA(r)){const n=r;t=t||eK(n);for(let i=0;i<t.length&&i<n.length;++i){const s=typeof r=="number"?r:r[i];t[i]=e(s,i,t)}return t}return e(r)}class Ww extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:OA(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(_o)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+Kq(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Dc(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(n===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],a=typeof t=="number"?t:t[i];this[i]=s+n*(a-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]+=t[n];return this.check()}subtract(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]-=t[n];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(_o.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function tK(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function hi(r){if(!Number.isFinite(r))throw new Error(`Invalid number ${JSON.stringify(r)}`);return r}function pm(r,e,t=""){if(_o.debug&&!tK(r,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return r}function kc(r,e){if(!r)throw new Error(`math.gl assertion ${e}`)}class qw extends Ww{get x(){return this[0]}set x(e){this[0]=hi(e)}get y(){return this[1]}set y(e){this[1]=hi(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return hi(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return hi(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]*=t[n];return this.check()}divide(...e){for(const t of e)for(let n=0;n<this.ELEMENTS;++n)this[n]/=t[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return kc(e>=0&&e<this.ELEMENTS,"index is out of range"),hi(this[e])}setComponent(e,t){return kc(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const gm=1e-6;let Nc=typeof Float32Array<"u"?Float32Array:Array;function rK(){const r=new Nc(2);return Nc!=Float32Array&&(r[0]=0,r[1]=0),r}function QP(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function nK(r,e){return r[0]=-e[0],r[1]=-e[1],r}function HP(r,e,t,n){const i=e[0],s=e[1];return r[0]=i+n*(t[0]-i),r[1]=s+n*(t[1]-s),r}function iK(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r}function sK(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i+t[4],r[1]=t[1]*n+t[3]*i+t[5],r}function VP(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[3]*i+t[6],r[1]=t[1]*n+t[4]*i+t[7],r}function jP(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[4]*i+t[12],r[1]=t[1]*n+t[5]*i+t[13],r}(function(){const r=rK();return function(e,t,n,i,s,a){let o,u;for(t||(t=2),n||(n=0),i?u=Math.min(i*t+n,e.length):u=e.length,o=n;o<u;o+=t)r[0]=e[o],r[1]=e[o+1],s(r,r,a),e[o]=r[0],e[o+1]=r[1];return e}})();function $P(r,e,t){const n=e[0],i=e[1],s=t[3]*n+t[7]*i||1;return r[0]=(t[0]*n+t[4]*i)/s,r[1]=(t[1]*n+t[5]*i)/s,r}function GP(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[3]*n+t[7]*i+t[11]*s||1;return r[0]=(t[0]*n+t[4]*i+t[8]*s)/a,r[1]=(t[1]*n+t[5]*i+t[9]*s)/a,r[2]=(t[2]*n+t[6]*i+t[10]*s)/a,r}function oK(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r}function aK(r,e,t){const n=e[0],i=e[1];return r[0]=t[0]*n+t[2]*i,r[1]=t[1]*n+t[3]*i,r[2]=e[2],r[3]=e[3],r}function WP(r,e,t){const n=e[0],i=e[1],s=e[2];return r[0]=t[0]*n+t[3]*i+t[6]*s,r[1]=t[1]*n+t[4]*i+t[7]*s,r[2]=t[2]*n+t[5]*i+t[8]*s,r[3]=e[3],r}class Kw extends qw{constructor(e=0,t=0){super(2),OA(e)&&arguments.length===1?this.copy(e):(_o.debug&&(hi(e),hi(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return _o.debug&&(hi(e.x),hi(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return jP(this,this,e),this.check()}transformAsVector(e){return $P(this,this,e),this.check()}transformByMatrix3(e){return VP(this,this,e),this.check()}transformByMatrix2x3(e){return sK(this,this,e),this.check()}transformByMatrix2(e){return iK(this,this,e),this.check()}}function qP(){const r=new Nc(3);return Nc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function KP(r){const e=r[0],t=r[1],n=r[2];return Math.sqrt(e*e+t*t+n*n)}function XP(r,e,t){const n=new Nc(3);return n[0]=r,n[1]=e,n[2]=t,n}function lK(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function cK(r){const e=r[0],t=r[1],n=r[2];return e*e+t*t+n*n}function uK(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function hK(r,e){const t=e[0],n=e[1],i=e[2];let s=t*t+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r}function Xw(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function a0(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[0],o=t[1],u=t[2];return r[0]=i*u-s*o,r[1]=s*a-n*u,r[2]=n*o-i*a,r}function AK(r,e,t,n){const i=e[0],s=e[1],a=e[2];return r[0]=i+n*(t[0]-i),r[1]=s+n*(t[1]-s),r[2]=a+n*(t[2]-a),r}function Yw(r,e,t){const n=e[0],i=e[1],s=e[2];let a=t[3]*n+t[7]*i+t[11]*s+t[15];return a=a||1,r[0]=(t[0]*n+t[4]*i+t[8]*s+t[12])/a,r[1]=(t[1]*n+t[5]*i+t[9]*s+t[13])/a,r[2]=(t[2]*n+t[6]*i+t[10]*s+t[14])/a,r}function YP(r,e,t){const n=e[0],i=e[1],s=e[2];return r[0]=n*t[0]+i*t[3]+s*t[6],r[1]=n*t[1]+i*t[4]+s*t[7],r[2]=n*t[2]+i*t[5]+s*t[8],r}function ZP(r,e,t){const n=t[0],i=t[1],s=t[2],a=t[3],o=e[0],u=e[1],d=e[2];let p=i*d-s*u,b=s*o-n*d,C=n*u-i*o,w=i*C-s*b,M=s*p-n*C,P=n*b-i*p;const k=a*2;return p*=k,b*=k,C*=k,w*=2,M*=2,P*=2,r[0]=o+p+w,r[1]=u+b+M,r[2]=d+C+P,r}function fK(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function dK(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function pK(r,e,t,n){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r}function gK(r,e){const t=r[0],n=r[1],i=r[2],s=e[0],a=e[1],o=e[2],u=Math.sqrt((t*t+n*n+i*i)*(s*s+a*a+o*o)),d=u&&Xw(r,e)/u;return Math.acos(Math.min(Math.max(d,-1),1))}const JP=lK,eM=KP,Zw=cK;(function(){const r=qP();return function(e,t,n,i,s,a){let o,u;for(t||(t=3),n||(n=0),i?u=Math.min(i*t+n,e.length):u=e.length,o=n;o<u;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2];return e}})();const Jw=[0,0,0];let l0;class It extends qw{static get ZERO(){return l0||(l0=new It(0,0,0),Object.freeze(l0)),l0}constructor(e=0,t=0,n=0){super(-0,-0,-0),arguments.length===1&&OA(e)?this.copy(e):(_o.debug&&(hi(e),hi(t),hi(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return _o.debug&&(hi(e.x),hi(e.y),hi(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=hi(e)}angle(e){return gK(this,e)}cross(e){return a0(this,this,e),this.check()}rotateX({radians:e,origin:t=Jw}){return fK(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Jw}){return dK(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Jw}){return pK(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Yw(this,this,e),this.check()}transformAsVector(e){return GP(this,this,e),this.check()}transformByMatrix3(e){return YP(this,this,e),this.check()}transformByMatrix2(e){return oK(this,this,e),this.check()}transformByQuaternion(e){return ZP(this,this,e),this.check()}}let c0;class e2 extends qw{static get ZERO(){return c0||(c0=new e2(0,0,0,0),Object.freeze(c0)),c0}constructor(e=0,t=0,n=0,i=0){super(-0,-0,-0,-0),OA(e)&&arguments.length===1?this.copy(e):(_o.debug&&(hi(e),hi(t),hi(n),hi(i)),this[0]=e,this[1]=t,this[2]=n,this[3]=i)}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return _o.debug&&(hi(e.x),hi(e.y),hi(e.z),hi(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=hi(e)}get w(){return this[3]}set w(e){this[3]=hi(e)}transform(e){return Yw(this,this,e),this.check()}transformByMatrix3(e){return WP(this,this,e),this.check()}transformByMatrix2(e){return aK(this,this,e),this.check()}transformByQuaternion(e){return ZP(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class tM extends Ww{toString(){let e="[";if(_o.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=hi(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[n+i];return t}setColumn(e,t){const n=e*this.RANK;for(let i=0;i<this.RANK;++i)this[n+i]=t[i];return this}}function mK(){const r=new Nc(9);return Nc!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function _K(r,e){if(r===e){const t=e[1],n=e[2],i=e[5];r[1]=e[3],r[2]=e[6],r[3]=t,r[5]=e[7],r[6]=n,r[7]=i}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r}function yK(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],u=e[6],d=e[7],p=e[8],b=p*a-o*d,C=-p*s+o*u,w=d*s-a*u;let M=t*b+n*C+i*w;return M?(M=1/M,r[0]=b*M,r[1]=(-p*n+i*d)*M,r[2]=(o*n-i*a)*M,r[3]=C*M,r[4]=(p*t-i*u)*M,r[5]=(-o*t+i*s)*M,r[6]=w*M,r[7]=(-d*t+n*u)*M,r[8]=(a*t-n*s)*M,r):null}function bK(r){const e=r[0],t=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],u=r[7],d=r[8];return e*(d*s-a*u)+t*(-d*i+a*o)+n*(u*i-s*o)}function rM(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],u=e[5],d=e[6],p=e[7],b=e[8],C=t[0],w=t[1],M=t[2],P=t[3],k=t[4],D=t[5],j=t[6],H=t[7],N=t[8];return r[0]=C*n+w*a+M*d,r[1]=C*i+w*o+M*p,r[2]=C*s+w*u+M*b,r[3]=P*n+k*a+D*d,r[4]=P*i+k*o+D*p,r[5]=P*s+k*u+D*b,r[6]=j*n+H*a+N*d,r[7]=j*i+H*o+N*p,r[8]=j*s+H*u+N*b,r}function vK(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],u=e[5],d=e[6],p=e[7],b=e[8],C=t[0],w=t[1];return r[0]=n,r[1]=i,r[2]=s,r[3]=a,r[4]=o,r[5]=u,r[6]=C*n+w*a+d,r[7]=C*i+w*o+p,r[8]=C*s+w*u+b,r}function wK(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],u=e[5],d=e[6],p=e[7],b=e[8],C=Math.sin(t),w=Math.cos(t);return r[0]=w*n+C*a,r[1]=w*i+C*o,r[2]=w*s+C*u,r[3]=w*a-C*n,r[4]=w*o-C*i,r[5]=w*u-C*s,r[6]=d,r[7]=p,r[8]=b,r}function nM(r,e,t){const n=t[0],i=t[1];return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=i*e[3],r[4]=i*e[4],r[5]=i*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function xK(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=t+t,o=n+n,u=i+i,d=t*a,p=n*a,b=n*o,C=i*a,w=i*o,M=i*u,P=s*a,k=s*o,D=s*u;return r[0]=1-b-M,r[3]=p-D,r[6]=C+k,r[1]=p+D,r[4]=1-d-M,r[7]=w-P,r[2]=C-k,r[5]=w+P,r[8]=1-d-b,r}var t2;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(t2||(t2={}));const BK=Object.freeze([1,0,0,0,1,0,0,0,1]);class vs extends tM{static get IDENTITY(){return TK()}static get ZERO(){return CK()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return t2}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(BK)}fromObject(e){return this.check()}fromQuaternion(e){return xK(this,e),this.check()}set(e,t,n,i,s,a,o,u,d){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=u,this[8]=d,this.check()}setRowMajor(e,t,n,i,s,a,o,u,d){return this[0]=e,this[1]=i,this[2]=o,this[3]=t,this[4]=s,this[5]=u,this[6]=n,this[7]=a,this[8]=d,this.check()}determinant(){return bK(this)}transpose(){return _K(this,this),this.check()}invert(){return yK(this,this),this.check()}multiplyLeft(e){return rM(this,e,this),this.check()}multiplyRight(e){return rM(this,this,e),this.check()}rotate(e){return wK(this,this,e),this.check()}scale(e){return Array.isArray(e)?nM(this,this,e):nM(this,this,[e,e]),this.check()}translate(e){return vK(this,this,e),this.check()}transform(e,t){let n;switch(e.length){case 2:n=VP(t||[-0,-0],e,this);break;case 3:n=YP(t||[-0,-0,-0],e,this);break;case 4:n=WP(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return pm(n,e.length),n}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let u0,h0=null;function CK(){return u0||(u0=new vs([0,0,0,0,0,0,0,0,0]),Object.freeze(u0)),u0}function TK(){return h0||(h0=new vs,Object.freeze(h0)),h0}function EK(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function SK(r,e){if(r===e){const t=e[1],n=e[2],i=e[3],s=e[6],a=e[7],o=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=s,r[11]=e[14],r[12]=i,r[13]=a,r[14]=o}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function r2(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],u=e[6],d=e[7],p=e[8],b=e[9],C=e[10],w=e[11],M=e[12],P=e[13],k=e[14],D=e[15],j=t*o-n*a,H=t*u-i*a,N=t*d-s*a,q=n*u-i*o,W=n*d-s*o,ie=i*d-s*u,se=p*P-b*M,Z=p*k-C*M,fe=p*D-w*M,te=b*k-C*P,ce=b*D-w*P,ve=C*D-w*k;let me=j*ve-H*ce+N*te+q*fe-W*Z+ie*se;return me?(me=1/me,r[0]=(o*ve-u*ce+d*te)*me,r[1]=(i*ce-n*ve-s*te)*me,r[2]=(P*ie-k*W+D*q)*me,r[3]=(C*W-b*ie-w*q)*me,r[4]=(u*fe-a*ve-d*Z)*me,r[5]=(t*ve-i*fe+s*Z)*me,r[6]=(k*N-M*ie-D*H)*me,r[7]=(p*ie-C*N+w*H)*me,r[8]=(a*ce-o*fe+d*se)*me,r[9]=(n*fe-t*ce-s*se)*me,r[10]=(M*W-P*N+D*j)*me,r[11]=(b*N-p*W-w*j)*me,r[12]=(o*Z-a*te-u*se)*me,r[13]=(t*te-n*Z+i*se)*me,r[14]=(P*H-M*q-k*j)*me,r[15]=(p*q-b*H+C*j)*me,r):null}function IK(r){const e=r[0],t=r[1],n=r[2],i=r[3],s=r[4],a=r[5],o=r[6],u=r[7],d=r[8],p=r[9],b=r[10],C=r[11],w=r[12],M=r[13],P=r[14],k=r[15],D=e*a-t*s,j=e*o-n*s,H=t*o-n*a,N=d*M-p*w,q=d*P-b*w,W=p*P-b*M,ie=e*W-t*q+n*N,se=s*W-a*q+o*N,Z=d*H-p*j+b*D,fe=w*H-M*j+P*D;return u*ie-i*se+k*Z-C*fe}function $f(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],u=e[5],d=e[6],p=e[7],b=e[8],C=e[9],w=e[10],M=e[11],P=e[12],k=e[13],D=e[14],j=e[15];let H=t[0],N=t[1],q=t[2],W=t[3];return r[0]=H*n+N*o+q*b+W*P,r[1]=H*i+N*u+q*C+W*k,r[2]=H*s+N*d+q*w+W*D,r[3]=H*a+N*p+q*M+W*j,H=t[4],N=t[5],q=t[6],W=t[7],r[4]=H*n+N*o+q*b+W*P,r[5]=H*i+N*u+q*C+W*k,r[6]=H*s+N*d+q*w+W*D,r[7]=H*a+N*p+q*M+W*j,H=t[8],N=t[9],q=t[10],W=t[11],r[8]=H*n+N*o+q*b+W*P,r[9]=H*i+N*u+q*C+W*k,r[10]=H*s+N*d+q*w+W*D,r[11]=H*a+N*p+q*M+W*j,H=t[12],N=t[13],q=t[14],W=t[15],r[12]=H*n+N*o+q*b+W*P,r[13]=H*i+N*u+q*C+W*k,r[14]=H*s+N*d+q*w+W*D,r[15]=H*a+N*p+q*M+W*j,r}function A0(r,e,t){const n=t[0],i=t[1],s=t[2];let a,o,u,d,p,b,C,w,M,P,k,D;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*s+e[12],r[13]=e[1]*n+e[5]*i+e[9]*s+e[13],r[14]=e[2]*n+e[6]*i+e[10]*s+e[14],r[15]=e[3]*n+e[7]*i+e[11]*s+e[15]):(a=e[0],o=e[1],u=e[2],d=e[3],p=e[4],b=e[5],C=e[6],w=e[7],M=e[8],P=e[9],k=e[10],D=e[11],r[0]=a,r[1]=o,r[2]=u,r[3]=d,r[4]=p,r[5]=b,r[6]=C,r[7]=w,r[8]=M,r[9]=P,r[10]=k,r[11]=D,r[12]=a*n+p*i+M*s+e[12],r[13]=o*n+b*i+P*s+e[13],r[14]=u*n+C*i+k*s+e[14],r[15]=d*n+w*i+D*s+e[15]),r}function n2(r,e,t){const n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function PK(r,e,t,n){let i=n[0],s=n[1],a=n[2],o=Math.sqrt(i*i+s*s+a*a),u,d,p,b,C,w,M,P,k,D,j,H,N,q,W,ie,se,Z,fe,te,ce,ve,me,qe;return o<gm?null:(o=1/o,i*=o,s*=o,a*=o,d=Math.sin(t),u=Math.cos(t),p=1-u,b=e[0],C=e[1],w=e[2],M=e[3],P=e[4],k=e[5],D=e[6],j=e[7],H=e[8],N=e[9],q=e[10],W=e[11],ie=i*i*p+u,se=s*i*p+a*d,Z=a*i*p-s*d,fe=i*s*p-a*d,te=s*s*p+u,ce=a*s*p+i*d,ve=i*a*p+s*d,me=s*a*p-i*d,qe=a*a*p+u,r[0]=b*ie+P*se+H*Z,r[1]=C*ie+k*se+N*Z,r[2]=w*ie+D*se+q*Z,r[3]=M*ie+j*se+W*Z,r[4]=b*fe+P*te+H*ce,r[5]=C*fe+k*te+N*ce,r[6]=w*fe+D*te+q*ce,r[7]=M*fe+j*te+W*ce,r[8]=b*ve+P*me+H*qe,r[9]=C*ve+k*me+N*qe,r[10]=w*ve+D*me+q*qe,r[11]=M*ve+j*me+W*qe,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function iM(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[4],a=e[5],o=e[6],u=e[7],d=e[8],p=e[9],b=e[10],C=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=s*i+d*n,r[5]=a*i+p*n,r[6]=o*i+b*n,r[7]=u*i+C*n,r[8]=d*i-s*n,r[9]=p*i-a*n,r[10]=b*i-o*n,r[11]=C*i-u*n,r}function MK(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[0],a=e[1],o=e[2],u=e[3],d=e[8],p=e[9],b=e[10],C=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i-d*n,r[1]=a*i-p*n,r[2]=o*i-b*n,r[3]=u*i-C*n,r[8]=s*n+d*i,r[9]=a*n+p*i,r[10]=o*n+b*i,r[11]=u*n+C*i,r}function sM(r,e,t){const n=Math.sin(t),i=Math.cos(t),s=e[0],a=e[1],o=e[2],u=e[3],d=e[4],p=e[5],b=e[6],C=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=s*i+d*n,r[1]=a*i+p*n,r[2]=o*i+b*n,r[3]=u*i+C*n,r[4]=d*i-s*n,r[5]=p*i-a*n,r[6]=b*i-o*n,r[7]=C*i-u*n,r}function FK(r,e){const t=e[0],n=e[1],i=e[2],s=e[4],a=e[5],o=e[6],u=e[8],d=e[9],p=e[10];return r[0]=Math.sqrt(t*t+n*n+i*i),r[1]=Math.sqrt(s*s+a*a+o*o),r[2]=Math.sqrt(u*u+d*d+p*p),r}function RK(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=t+t,o=n+n,u=i+i,d=t*a,p=n*a,b=n*o,C=i*a,w=i*o,M=i*u,P=s*a,k=s*o,D=s*u;return r[0]=1-b-M,r[1]=p+D,r[2]=C-k,r[3]=0,r[4]=p-D,r[5]=1-d-M,r[6]=w+P,r[7]=0,r[8]=C+k,r[9]=w-P,r[10]=1-d-b,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function LK(r,e,t,n,i,s,a){const o=1/(t-e),u=1/(i-n),d=1/(s-a);return r[0]=s*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s*2*u,r[6]=0,r[7]=0,r[8]=(t+e)*o,r[9]=(i+n)*u,r[10]=(a+s)*d,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*s*2*d,r[15]=0,r}function OK(r,e,t,n,i){const s=1/Math.tan(e/2);if(r[0]=s/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0){const a=1/(n-i);r[10]=(i+n)*a,r[14]=2*i*n*a}else r[10]=-1,r[14]=-2*n;return r}const UK=OK;function DK(r,e,t,n,i,s,a){const o=1/(e-t),u=1/(n-i),d=1/(s-a);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*u,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*d,r[11]=0,r[12]=(e+t)*o,r[13]=(i+n)*u,r[14]=(a+s)*d,r[15]=1,r}const kK=DK;function NK(r,e,t,n){let i,s,a,o,u,d,p,b,C,w;const M=e[0],P=e[1],k=e[2],D=n[0],j=n[1],H=n[2],N=t[0],q=t[1],W=t[2];return Math.abs(M-N)<gm&&Math.abs(P-q)<gm&&Math.abs(k-W)<gm?EK(r):(b=M-N,C=P-q,w=k-W,i=1/Math.sqrt(b*b+C*C+w*w),b*=i,C*=i,w*=i,s=j*w-H*C,a=H*b-D*w,o=D*C-j*b,i=Math.sqrt(s*s+a*a+o*o),i?(i=1/i,s*=i,a*=i,o*=i):(s=0,a=0,o=0),u=C*o-w*a,d=w*s-b*o,p=b*a-C*s,i=Math.sqrt(u*u+d*d+p*p),i?(i=1/i,u*=i,d*=i,p*=i):(u=0,d=0,p=0),r[0]=s,r[1]=u,r[2]=b,r[3]=0,r[4]=a,r[5]=d,r[6]=C,r[7]=0,r[8]=o,r[9]=p,r[10]=w,r[11]=0,r[12]=-(s*M+a*P+o*k),r[13]=-(u*M+d*P+p*k),r[14]=-(b*M+C*P+w*k),r[15]=1,r)}function zK(){const r=new Nc(4);return Nc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function QK(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}function i2(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function HK(r){const e=r[0],t=r[1],n=r[2],i=r[3];return Math.sqrt(e*e+t*t+n*n+i*i)}function VK(r){const e=r[0],t=r[1],n=r[2],i=r[3];return e*e+t*t+n*n+i*i}function jK(r,e){const t=e[0],n=e[1],i=e[2],s=e[3];let a=t*t+n*n+i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=t*a,r[1]=n*a,r[2]=i*a,r[3]=s*a,r}function $K(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function GK(r,e,t,n){const i=e[0],s=e[1],a=e[2],o=e[3];return r[0]=i+n*(t[0]-i),r[1]=s+n*(t[1]-s),r[2]=a+n*(t[2]-a),r[3]=o+n*(t[3]-o),r}function pp(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*s+t[12]*a,r[1]=t[1]*n+t[5]*i+t[9]*s+t[13]*a,r[2]=t[2]*n+t[6]*i+t[10]*s+t[14]*a,r[3]=t[3]*n+t[7]*i+t[11]*s+t[15]*a,r}function WK(r,e,t){const n=e[0],i=e[1],s=e[2],a=t[0],o=t[1],u=t[2],d=t[3],p=d*n+o*s-u*i,b=d*i+u*n-a*s,C=d*s+a*i-o*n,w=-a*n-o*i-u*s;return r[0]=p*d+w*-a+b*-u-C*-o,r[1]=b*d+w*-o+C*-a-p*-u,r[2]=C*d+w*-u+p*-o-b*-a,r[3]=e[3],r}(function(){const r=zK();return function(e,t,n,i,s,a){let o,u;for(t||(t=4),n||(n=0),i?u=Math.min(i*t+n,e.length):u=e.length,o=n;o<u;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],r[3]=e[o+3],s(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2],e[o+3]=r[3];return e}})();var s2;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(s2||(s2={}));const qK=45*Math.PI/180,KK=1,o2=.1,a2=500,XK=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class zn extends tM{static get IDENTITY(){return ZK()}static get ZERO(){return YK()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return s2}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,s,a,o,u,d,p,b,C,w,M,P,k){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=s,this[5]=a,this[6]=o,this[7]=u,this[8]=d,this[9]=p,this[10]=b,this[11]=C,this[12]=w,this[13]=M,this[14]=P,this[15]=k,this.check()}setRowMajor(e,t,n,i,s,a,o,u,d,p,b,C,w,M,P,k){return this[0]=e,this[1]=s,this[2]=d,this[3]=w,this[4]=t,this[5]=a,this[6]=p,this[7]=M,this[8]=n,this[9]=o,this[10]=b,this[11]=P,this[12]=i,this[13]=u,this[14]=C,this[15]=k,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(XK)}fromObject(e){return this.check()}fromQuaternion(e){return RK(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:s,near:a=o2,far:o=a2}=e;return o===1/0?JK(this,t,n,i,s,a):LK(this,t,n,i,s,a,o),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return NK(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:s,near:a=o2,far:o=a2}=e;return kK(this,t,n,i,s,a,o),this.check()}orthographic(e){const{fovy:t=qK,aspect:n=KK,focalDistance:i=1,near:s=o2,far:a=a2}=e;oM(t);const o=t/2,u=i*Math.tan(o),d=u*n;return this.ortho({left:-d,right:d,bottom:-u,top:u,near:s,far:a})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:s=500}=e;return oM(t),UK(this,t,n,i,s),this.check()}determinant(){return IK(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],s=1/n[1],a=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],s=1/n[1],a=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*a,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*a,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*a,e}transpose(){return SK(this,this),this.check()}invert(){return r2(this,this),this.check()}multiplyLeft(e){return $f(this,e,this),this.check()}multiplyRight(e){return $f(this,this,e),this.check()}rotateX(e){return iM(this,this,e),this.check()}rotateY(e){return MK(this,this,e),this.check()}rotateZ(e){return sM(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return PK(this,this,e,t),this.check()}scale(e){return n2(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return A0(this,this,e),this.check()}transform(e,t){return e.length===4?(t=pp(t||[-0,-0,-0,-0],e,this),pm(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=jP(t||[-0,-0],e,this);break;case 3:i=Yw(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return pm(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=$P(t||[-0,-0],e,this);break;case 3:n=GP(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return pm(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let f0,d0;function YK(){return f0||(f0=new zn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(f0)),f0}function ZK(){return d0||(d0=new zn,Object.freeze(d0)),d0}function oM(r){if(r>Math.PI*2)throw Error("expected radians")}function JK(r,e,t,n,i,s){const a=2*s/(t-e),o=2*s/(i-n),u=(t+e)/(t-e),d=(i+n)/(i-n),p=-1,b=-1,C=-2*s;return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=u,r[9]=d,r[10]=p,r[11]=b,r[12]=0,r[13]=0,r[14]=C,r[15]=0,r}function aM(){const r=new Nc(4);return Nc!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function eX(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function lM(r,e,t){t=t*.5;const n=Math.sin(t);return r[0]=n*e[0],r[1]=n*e[1],r[2]=n*e[2],r[3]=Math.cos(t),r}function cM(r,e,t){const n=e[0],i=e[1],s=e[2],a=e[3],o=t[0],u=t[1],d=t[2],p=t[3];return r[0]=n*p+a*o+i*d-s*u,r[1]=i*p+a*u+s*o-n*d,r[2]=s*p+a*d+n*u-i*o,r[3]=a*p-n*o-i*u-s*d,r}function tX(r,e,t){t*=.5;const n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),u=Math.cos(t);return r[0]=n*u+a*o,r[1]=i*u+s*o,r[2]=s*u-i*o,r[3]=a*u-n*o,r}function rX(r,e,t){t*=.5;const n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),u=Math.cos(t);return r[0]=n*u-s*o,r[1]=i*u+a*o,r[2]=s*u+n*o,r[3]=a*u-i*o,r}function nX(r,e,t){t*=.5;const n=e[0],i=e[1],s=e[2],a=e[3],o=Math.sin(t),u=Math.cos(t);return r[0]=n*u+i*o,r[1]=i*u-n*o,r[2]=s*u+a*o,r[3]=a*u-s*o,r}function iX(r,e){const t=e[0],n=e[1],i=e[2];return r[0]=t,r[1]=n,r[2]=i,r[3]=Math.sqrt(Math.abs(1-t*t-n*n-i*i)),r}function p0(r,e,t,n){const i=e[0],s=e[1],a=e[2],o=e[3];let u=t[0],d=t[1],p=t[2],b=t[3],C,w,M,P,k;return C=i*u+s*d+a*p+o*b,C<0&&(C=-C,u=-u,d=-d,p=-p,b=-b),1-C>gm?(w=Math.acos(C),k=Math.sin(w),M=Math.sin((1-n)*w)/k,P=Math.sin(n*w)/k):(M=1-n,P=n),r[0]=M*i+P*u,r[1]=M*s+P*d,r[2]=M*a+P*p,r[3]=M*o+P*b,r}function sX(r,e){const t=e[0],n=e[1],i=e[2],s=e[3],a=t*t+n*n+i*i+s*s,o=a?1/a:0;return r[0]=-t*o,r[1]=-n*o,r[2]=-i*o,r[3]=s*o,r}function oX(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r}function uM(r,e){const t=e[0]+e[4]+e[8];let n;if(t>0)n=Math.sqrt(t+1),r[3]=.5*n,n=.5/n,r[0]=(e[5]-e[7])*n,r[1]=(e[6]-e[2])*n,r[2]=(e[1]-e[3])*n;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);const s=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[i*3+i]-e[s*3+s]-e[a*3+a]+1),r[i]=.5*n,n=.5/n,r[3]=(e[s*3+a]-e[a*3+s])*n,r[s]=(e[s*3+i]+e[i*3+s])*n,r[a]=(e[a*3+i]+e[i*3+a])*n}return r}const aX=QK,lX=i2,cX=$K,uX=GK,hX=HK,AX=VK,hM=jK,fX=function(){const r=qP(),e=XP(1,0,0),t=XP(0,1,0);return function(n,i,s){const a=Xw(i,s);return a<-.999999?(a0(r,e,i),eM(r)<1e-6&&a0(r,t,i),hK(r,r),lM(n,r,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(a0(r,i,s),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=1+a,hM(n,n))}}();(function(){const r=aM(),e=aM();return function(t,n,i,s,a,o){return p0(r,n,a,o),p0(e,i,s,o),p0(t,r,e,2*o*(1-o)),t}})(),function(){const r=mK();return function(e,t,n,i){return r[0]=n[0],r[3]=n[1],r[6]=n[2],r[1]=i[0],r[4]=i[1],r[7]=i[2],r[2]=-t[0],r[5]=-t[1],r[8]=-t[2],hM(e,uM(e,r))}}();const dX=[0,0,0,1];class mm extends Ww{constructor(e=0,t=0,n=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,n,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,n,i){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return uM(this,e),this.check()}fromAxisRotation(e,t){return lM(this,e,t),this.check()}identity(){return eX(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=hi(e)}get y(){return this[1]}set y(e){this[1]=hi(e)}get z(){return this[2]}set z(e){this[2]=hi(e)}get w(){return this[3]}set w(e){this[3]=hi(e)}len(){return hX(this)}lengthSquared(){return AX(this)}dot(e){return cX(this,e)}rotationTo(e,t){return fX(this,e,t),this.check()}add(e){return aX(this,this,e),this.check()}calculateW(){return iX(this,this),this.check()}conjugate(){return oX(this,this),this.check()}invert(){return sX(this,this),this.check()}lerp(e,t,n){return n===void 0?this.lerp(this,e,t):(uX(this,e,t,n),this.check())}multiplyRight(e){return cM(this,this,e),this.check()}multiplyLeft(e){return cM(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return tX(this,this,e),this.check()}rotateY(e){return rX(this,this,e),this.check()}rotateZ(e){return nX(this,this,e),this.check()}scale(e){return lX(this,this,e),this.check()}slerp(e,t,n){let i,s,a;switch(arguments.length){case 1:({start:i=dX,target:s,ratio:a}=e);break;case 2:i=this,s=e,a=t;break;default:i=e,s=t,a=n}return p0(this,i,s,a),this.check()}transformVector4(e,t=new e2){return WK(t,e,this),pm(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const pX=.1,gX=1e-12,AM=1e-15,mX=1e-20;function fM(r,e=[],t=0){const n=Math.fround(r),i=r-n;return e[t]=n,e[t+1]=i,e}function _X(r){return r-Math.fround(r)}function yX(r){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let n=0;n<4;++n){const i=t*4+n;fM(r[n*4+t],e,i*2)}return e}const bX={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`},vX={name:"fp64arithmetic",vs:`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:fM,fp64LowPart:_X,fp64ifyMatrix4:yX},dM={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,getUniforms:wX};function wX(r={},e){const t={};if(r.highlightedObjectColor!==void 0)if(r.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const n=r.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=n}if(r.highlightColor){const n=Array.from(r.highlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),t.highlightColor=n}return r.isActive!==void 0&&(t.isActive=!!r.isActive,t.isAttribute=!!r.isAttribute),r.useFloatColors!==void 0&&(t.useFloatColors=!!r.useFloatColors),t}const pM=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,xX=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,BX=5,CX=255;var _m;(function(r){r[r.POINT=0]="POINT",r[r.DIRECTIONAL=1]="DIRECTIONAL"})(_m||(_m={}));const gp={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:_m.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:xX,vs:pM,fs:pM,getUniforms:TX};function TX(r,e={}){if(r=r&&{...r},!r)return{...gp.defaultUniforms};r.lights&&(r={...r,...SX(r.lights),lights:void 0});const{ambientLight:t,pointLights:n,directionalLights:i}=r||{};if(!(t||n&&n.length>0||i&&i.length>0))return{...gp.defaultUniforms,enabled:0};const a={...gp.defaultUniforms,...e,...EX({ambientLight:t,pointLights:n,directionalLights:i})};return r.enabled!==void 0&&(a.enabled=r.enabled?1:0),a}function EX({ambientLight:r,pointLights:e=[],directionalLights:t=[]}){const n={};n.ambientColor=l2(r);let i=0;for(const s of e){n.lightType=_m.POINT;const a=i;n[`lightColor${a}`]=l2(s),n[`lightPosition${a}`]=s.position,n[`lightAttenuation${a}`]=s.attenuation||[1,0,0],i++}for(const s of t){n.lightType=_m.DIRECTIONAL;const a=i;n[`lightColor${a}`]=l2(s),n[`lightDirection${a}`]=s.direction,i++}return i>BX&&Xt.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=t.length,n.pointLightCount=e.length,n}function SX(r){const e={pointLights:[],directionalLights:[]};for(const t of r||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights?.push(t);break;case"point":e.pointLights?.push(t);break}return e}function l2(r={}){const{color:e=[0,0,0],intensity:t=1}=r;return e.map(n=>n*t/CX)}const gM=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,mM=`#define MAX_LIGHTS 3

uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,_M=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,yM={props:{},name:"gouraudMaterial",vs:mM.replace("phongMaterial","gouraudMaterial"),fs:gM.replace("phongMaterial","gouraudMaterial"),source:_M.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[gp],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(r){const e={...r};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...yM.defaultUniforms,...e}}},bM={name:"phongMaterial",dependencies:[gp],source:_M,vs:gM,fs:mM,defines:{LIGHTING_FRAGMENT:!0},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(r){const e={...r};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...bM.defaultUniforms,...e}}},IX=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,PX=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,MX=`struct PBRFragmentInputs {
  pbr_vPosition: vec3f,
  pbr_vUV: vec2f,
  pbr_vTBN: mat3f,
  pbr_vNormal: vec3f
};

var fragmentInputs: PBRFragmentInputs;

fn pbr_setPositionNormalTangentUV(position: vec4f, normal: vec4f, tangent: vec4f, uv: vec2f)
{
  var pos: vec4f = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  let normalW: vec3f = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  let tangentW: vec3f = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  let bitangentW: vec3f = cross(normalW, tangentW) * tangent.w;
  fragmentInputs,pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  fragmentInputs.pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}

struct pbrMaterialUniforms {
  // Material is unlit
  unlit: uint32,

  // Base color map
  baseColorMapEnabled: uint32,
  baseColorFactor: vec4f,

  normalMapEnabled : uint32,
  normalScale: f32,  // #ifdef HAS_NORMALMAP

  emissiveMapEnabled: uint32,
  emissiveFactor: vec3f, // #ifdef HAS_EMISSIVEMAP

  metallicRoughnessValues: vec2f,
  metallicRoughnessMapEnabled: uint32,

  occlusionMapEnabled: i32,
  occlusionStrength: f32, // #ifdef HAS_OCCLUSIONMAP
  
  alphaCutoffEnabled: i32,
  alphaCutoff: f32, // #ifdef ALPHA_CUTOFF
  
  // IBL
  IBLenabled: i32,
  scaleIBLAmbient: vec2f, // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  scaleDiffBaseMR: vec4f,
  scaleFGDSpec: vec4f
  // #endif
} 
  
@binding(2) @group(0) var<uniform> material : pbrMaterialUniforms;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  NdotL: f32,                  // cos angle between normal and light direction
  NdotV: f32,                  // cos angle between normal and view direction
  NdotH: f32,                  // cos angle between normal and half vector
  LdotH: f32,                  // cos angle between light direction and half vector
  VdotH: f32,                  // cos angle between view direction and half vector
  perceptualRoughness: f32,    // roughness value, as authored by the model creator (input to shader)
  metalness: f32,              // metallic value at the surface
  reflectance0: vec3f,            // full reflectance color (normal incidence angle)
  reflectance90: vec3f,           // reflectance color at grazing angle
  alphaRoughness: f32,         // roughness mapped to a more linear change in the roughness (proposed by [2])
  diffuseColor: vec3f,            // color contribution from diffuse lighting
  specularColor: vec3f,           // color contribution from specular lighting
  n: vec3f,                       // normal at surface point
  v: vec3f,                       // vector from surface point to camera
};

const M_PI = 3.141592653589793;
const c_MinRoughness = 0.04;

fn SRGBtoLINEAR(srgbIn: vec4f ) -> vec4f
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  var linOut: vec3f = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  var bLess: vec3f = step(vec3(0.04045),srgbIn.xyz);
  var linOut: vec3f = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4f(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
fn getNormal() -> vec3f
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  var pos_dx: vec3f = dFdx(pbr_vPosition);
  var pos_dy: vec3f = dFdy(pbr_vPosition);
  var tex_dx: vec3f = dFdx(vec3(pbr_vUV, 0.0));
  var tex_dy: vec3f = dFdy(vec3(pbr_vUV, 0.0));
  var t: vec3f = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  var ng: vec3f = normalize(pbr_vNormal);
#else
  var ng: vec3f = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  var b: vec3f = normalize(cross(ng, t));
  var tbn: mat3f = mat3f(t, b, ng);
#else // HAS_TANGENTS
  var tbn: mat3f = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
fn getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection) -> vec3f
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
fn diffuse(pbrInfo: PBRInfo) -> vec3<f32> {
  return pbrInfo.diffuseColor / PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
fn specularReflection(pbrInfo: PBRInfo) -> vec3<f32> {
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
fn geometricOcclusion(pbrInfo: PBRInfo) -> f32 {
  let NdotL: f32 = pbrInfo.NdotL;
  let NdotV: f32 = pbrInfo.NdotV;
  let r: f32 = pbrInfo.alphaRoughness;

  let attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  let attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
fn microfacetDistribution(pbrInfo: PBRInfo) -> f32 {
  let roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  let f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (PI * f * f);
}

fn PBRInfo_setAmbientLight(pbrInfo: ptr<function, PBRInfo>) {
  (*pbrInfo).NdotL = 1.0;
  (*pbrInfo).NdotH = 0.0;
  (*pbrInfo).LdotH = 0.0;
  (*pbrInfo).VdotH = 1.0;
}

fn PBRInfo_setDirectionalLight(pbrInfo: ptr<function, PBRInfo>, lightDirection: vec3<f32>) {
  let n = (*pbrInfo).n;
  let v = (*pbrInfo).v;
  let l = normalize(lightDirection);             // Vector from surface point to light
  let h = normalize(l + v);                      // Half vector between both l and v

  (*pbrInfo).NdotL = clamp(dot(n, l), 0.001, 1.0);
  (*pbrInfo).NdotH = clamp(dot(n, h), 0.0, 1.0);
  (*pbrInfo).LdotH = clamp(dot(l, h), 0.0, 1.0);
  (*pbrInfo).VdotH = clamp(dot(v, h), 0.0, 1.0);
}

fn PBRInfo_setPointLight(pbrInfo: ptr<function, PBRInfo>, pointLight: PointLight) {
  let light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

fn calculateFinalColor(pbrInfo: PBRInfo, lightColor: vec3<f32>) -> vec3<f32> {
  // Calculate the shading terms for the microfacet specular shading model
  let F = specularReflection(pbrInfo);
  let G = geometricOcclusion(pbrInfo);
  let D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  let diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  let specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

fn pbr_filterColor(colorUnused: vec4<f32>) -> vec4<f32> {
  // The albedo may be defined from a base texture or a flat color
  var baseColor: vec4<f32>;
  #ifdef HAS_BASECOLORMAP
  baseColor = SRGBtoLINEAR(textureSample(pbr_baseColorSampler, pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
  #else
  baseColor = pbrMaterial.baseColorFactor;
  #endif

  #ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
  #endif

  var color = vec3<f32>(0.0, 0.0, 0.0);

  if (pbrMaterial.unlit) {
    color = baseColor.rgb;
  } else {
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    var perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    var metallic = pbrMaterial.metallicRoughnessValues.x;
    #ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    let mrSample = textureSample(pbr_metallicRoughnessSampler, pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
    #endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    let alphaRoughness = perceptualRoughness * perceptualRoughness;

    let f0 = vec3<f32>(0.04);
    var diffuseColor = baseColor.rgb * (vec3<f32>(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    let specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    let reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflectance to 0%.
    let reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    let specularEnvironmentR0 = specularColor;
    let specularEnvironmentR90 = vec3<f32>(1.0, 1.0, 1.0) * reflectance90;

    let n = getNormal();                          // normal at surface point
    let v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    let NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    let reflection = -normalize(reflect(v, n));

    var pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

    #ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(&pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for (var i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(&pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for (var i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(&pbrInfo, lighting_getPointLight(i));
        let attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
    #endif

    // Calculate lighting contribution from image based lighting source (IBL)
    #ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
    #endif

    // Apply optional PBR terms for additional (optional) shading
    #ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      let ao = textureSample(pbr_occlusionSampler, pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
    #endif

    #ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      let emissive = SRGBtoLINEAR(textureSample(pbr_emissiveSampler, pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
    #endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
    #ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3<f32>(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3<f32>(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
    #endif
  }

  return vec4<f32>(pow(color, vec3<f32>(1.0 / 2.2)), baseColor.a);
}
`,vM=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,c2={props:{},uniforms:{},name:"pbrMaterial",dependencies:[gp,{name:"pbrProjection",vs:vM,fs:vM,getUniforms:r=>r,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}}],source:MX,vs:IX,fs:PX,defines:{LIGHTING_FRAGMENT:!0,HAS_NORMALMAP:!1,HAS_EMISSIVEMAP:!1,HAS_OCCLUSIONMAP:!1,HAS_BASECOLORMAP:!1,HAS_METALROUGHNESSMAP:!1,ALPHA_CUTOFF:!1,USE_IBL:!1,PBR_DEBUG:!1},getUniforms:r=>r,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}},wM=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,FX={name:"layer",vs:wM,fs:wM,getUniforms:r=>({opacity:Math.pow(r.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},RX={name:"color",dependencies:[],source:`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,getUniforms:r=>({}),uniformTypes:{opacity:"f32"}},LX=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,xM="#define SMOOTH_EDGE_RADIUS 0.5",OX=`${xM}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,UX=`${xM}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,BM={name:"geometry",source:LX,vs:OX,fs:UX},DX=25;var Ys;(function(r){r[r.Start=1]="Start",r[r.Move=2]="Move",r[r.End=4]="End",r[r.Cancel=8]="Cancel"})(Ys||(Ys={}));var yo;(function(r){r[r.None=0]="None",r[r.Left=1]="Left",r[r.Right=2]="Right",r[r.Up=4]="Up",r[r.Down=8]="Down",r[r.Horizontal=3]="Horizontal",r[r.Vertical=12]="Vertical",r[r.All=15]="All"})(yo||(yo={}));var En;(function(r){r[r.Possible=1]="Possible",r[r.Began=2]="Began",r[r.Changed=4]="Changed",r[r.Ended=8]="Ended",r[r.Recognized=8]="Recognized",r[r.Cancelled=16]="Cancelled",r[r.Failed=32]="Failed"})(En||(En={}));const kX="compute",NX="auto",u2="manipulation",g0="none",h2="pan-x",A2="pan-y";function zX(r){if(r.includes(g0))return g0;const e=r.includes(h2),t=r.includes(A2);return e&&t?g0:e||t?e?h2:A2:r.includes(u2)?u2:NX}class QX{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===kX&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return zX(e.join(" "))}}function m0(r){return r.trim().split(/\s+/g)}function f2(r,e,t){if(r)for(const n of m0(e))r.addEventListener(n,t,!1)}function d2(r,e,t){if(r)for(const n of m0(e))r.removeEventListener(n,t,!1)}function CM(r){return(r.ownerDocument||r).defaultView}function HX(r,e){let t=r;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function TM(r){const e=r.length;if(e===1)return{x:Math.round(r[0].clientX),y:Math.round(r[0].clientY)};let t=0,n=0,i=0;for(;i<e;)t+=r[i].clientX,n+=r[i].clientY,i++;return{x:Math.round(t/e),y:Math.round(n/e)}}function EM(r){const e=[];let t=0;for(;t<r.pointers.length;)e[t]={clientX:Math.round(r.pointers[t].clientX),clientY:Math.round(r.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:TM(e),deltaX:r.deltaX,deltaY:r.deltaY}}function SM(r,e){const t=e.x-r.x,n=e.y-r.y;return Math.sqrt(t*t+n*n)}function IM(r,e){const t=e.clientX-r.clientX,n=e.clientY-r.clientY;return Math.sqrt(t*t+n*n)}function VX(r,e){const t=e.x-r.x,n=e.y-r.y;return Math.atan2(n,t)*180/Math.PI}function PM(r,e){const t=e.clientX-r.clientX,n=e.clientY-r.clientY;return Math.atan2(n,t)*180/Math.PI}function MM(r,e){return r===e?yo.None:Math.abs(r)>=Math.abs(e)?r<0?yo.Left:yo.Right:e<0?yo.Up:yo.Down}function jX(r,e){const t=e.center;let n=r.offsetDelta,i=r.prevDelta;const s=r.prevInput;return(e.eventType===Ys.Start||s?.eventType===Ys.End)&&(i=r.prevDelta={x:s?.deltaX||0,y:s?.deltaY||0},n=r.offsetDelta={x:t.x,y:t.y}),{deltaX:i.x+(t.x-n.x),deltaY:i.y+(t.y-n.y)}}function FM(r,e,t){return{x:e/r||0,y:t/r||0}}function $X(r,e){return IM(e[0],e[1])/IM(r[0],r[1])}function GX(r,e){return PM(e[1],e[0])-PM(r[1],r[0])}function WX(r,e){const t=r.lastInterval||e,n=e.timeStamp-t.timeStamp;let i,s,a,o;if(e.eventType!==Ys.Cancel&&(n>DX||t.velocity===void 0)){const u=e.deltaX-t.deltaX,d=e.deltaY-t.deltaY,p=FM(n,u,d);s=p.x,a=p.y,i=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,o=MM(u,d),r.lastInterval=e}else i=t.velocity,s=t.velocityX,a=t.velocityY,o=t.direction;e.velocity=i,e.velocityX=s,e.velocityY=a,e.direction=o}function qX(r,e){const{session:t}=r,{pointers:n}=e,{length:i}=n;t.firstInput||(t.firstInput=EM(e)),i>1&&!t.firstMultiple?t.firstMultiple=EM(e):i===1&&(t.firstMultiple=!1);const{firstInput:s,firstMultiple:a}=t,o=a?a.center:s.center,u=e.center=TM(n);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=VX(o,u),e.distance=SM(o,u);const{deltaX:d,deltaY:p}=jX(t,e);e.deltaX=d,e.deltaY=p,e.offsetDirection=MM(e.deltaX,e.deltaY);const b=FM(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=b.x,e.overallVelocityY=b.y,e.overallVelocity=Math.abs(b.x)>Math.abs(b.y)?b.x:b.y,e.scale=a?$X(a.pointers,n):1,e.rotation=a?GX(a.pointers,n):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let C=r.element;return HX(e.srcEvent.target,C)&&(C=e.srcEvent.target),e.target=C,WX(t,e),e}function KX(r,e,t){const n=t.pointers.length,i=t.changedPointers.length,s=e&Ys.Start&&n-i===0,a=e&(Ys.End|Ys.Cancel)&&n-i===0;t.isFirst=!!s,t.isFinal=!!a,s&&(r.session={}),t.eventType=e;const o=qX(r,t);r.emit("hammer.input",o),r.recognize(o),r.session.prevInput=o}let XX=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){KX(this.manager,e,t)}init(){f2(this.element,this.evEl,this.domHandler),f2(this.target,this.evTarget,this.domHandler),f2(CM(this.element),this.evWin,this.domHandler)}destroy(){d2(this.element,this.evEl,this.domHandler),d2(this.target,this.evTarget,this.domHandler),d2(CM(this.element),this.evWin,this.domHandler)}};const YX={pointerdown:Ys.Start,pointermove:Ys.Move,pointerup:Ys.End,pointercancel:Ys.Cancel,pointerout:Ys.Cancel},ZX="pointerdown",JX="pointermove pointerup pointercancel";class eY extends XX{constructor(e){super(e),this.evEl=ZX,this.evWin=JX,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let n=!1;const i=YX[e.type],s=e.pointerType,a=s==="touch";let o=t.findIndex(u=>u.pointerId===e.pointerId);i&Ys.Start&&(e.buttons||a)?o<0&&(t.push(e),o=t.length-1):i&(Ys.End|Ys.Cancel)&&(n=!0),!(o<0)&&(t[o]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:s,srcEvent:e}),n&&t.splice(o,1))}}const tY=["","webkit","Moz","MS","ms","o"];function rY(r,e){const t=e[0].toUpperCase()+e.slice(1);for(const n of tY){const i=n?n+t:e;if(i in r)return i}}const nY=1,RM=2,LM={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class iY{constructor(e,t){this.options={...LM,...t,cssProps:{...LM.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new eY(this),this.touchAction=new QX(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?RM:nY}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let n;const{recognizers:i}=this;let{curRecognizer:s}=t;(!s||s&&s.state&En.Recognized)&&(s=t.curRecognizer=null);let a=0;for(;a<i.length;)n=i[a],t.stopped!==RM&&(!s||n===s||n.canRecognizeWith(s))?n.recognize(e):n.reset(),!s&&n.state&(En.Began|En.Changed|En.Ended)&&(s=t.curRecognizer=n),a++}get(e){const{recognizers:t}=this;for(let n=0;n<t.length;n++)if(t[n].options.event===e)return t[n];return null}add(e){if(Array.isArray(e)){for(const n of e)this.add(n);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const n of e)this.remove(n);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:n}=this,i=n.indexOf(t);i!==-1&&(n.splice(i,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:n}=this;for(const i of m0(e))n[i]=n[i]||[],n[i].push(t)}off(e,t){if(!e)return;const{handlers:n}=this;for(const i of m0(e))t?n[i]&&n[i].splice(n[i].indexOf(t),1):delete n[i]}emit(e,t){const n=this.handlers[e]&&this.handlers[e].slice();if(!n||!n.length)return;const i=t;i.type=e,i.preventDefault=function(){t.srcEvent.preventDefault()};let s=0;for(;s<n.length;)n[s](i),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[n,i]of Object.entries(this.options.cssProps)){const s=rY(t.style,n);e?(this.oldCssProps[s]=t.style[s],t.style[s]=i):t.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let sY=1;function oY(){return sY++}function OM(r){return r&En.Cancelled?"cancel":r&En.Ended?"end":r&En.Changed?"move":r&En.Began?"start":""}class UM{constructor(e){this.options=e,this.id=oY(),this.state=En.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:n}=this;return n[t.id]||(n[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const n of e)this.dropRecognizeWith(n);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:n}=this;return n.indexOf(t)===-1&&(n.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const n of e)this.dropRequireFailure(n);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const n=this.requireFail.indexOf(t);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<En.Ended&&this.manager.emit(this.options.event+OM(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=En.Ended&&this.manager.emit(this.options.event+OM(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=En.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(En.Failed|En.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=En.Failed;return}this.state&(En.Recognized|En.Cancelled|En.Failed)&&(this.state=En.Possible),this.state=this.process(t),this.state&(En.Began|En.Changed|En.Ended|En.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class DM extends UM{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:n}=e,i=t&(En.Began|En.Changed),s=this.attrTest(e);return i&&(n&Ys.Cancel||!s)?t|En.Cancelled:i||s?n&Ys.End?t|En.Ended:t&En.Began?t|En.Changed:En.Began:En.Failed}}class kM extends UM{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[u2]}process(e){const{options:t}=this,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,s=e.deltaTime<t.time;if(this.reset(),e.eventType&Ys.Start&&this.count===0)return this.failTimeout();if(i&&s&&n){if(e.eventType!==Ys.End)return this.failTimeout();const a=this.pTime?e.timeStamp-this.pTime<t.interval:!0,o=!this.pCenter||SM(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!o||!a?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=En.Recognized,this.tryEmit(this._input)},t.interval),En.Began):En.Recognized}return En.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=En.Failed},this.options.interval),En.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===En.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const aY=["","start","move","end","cancel","up","down","left","right"];class NM extends DM{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:yo.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&yo.Horizontal&&t.push(A2),e&yo.Vertical&&t.push(h2),t}getEventNames(){return aY.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let n=!0,{distance:i}=e,{direction:s}=e;const a=e.deltaX,o=e.deltaY;return s&t.direction||(t.direction&yo.Horizontal?(s=a===0?yo.None:a<0?yo.Left:yo.Right,n=a!==this.pX,i=Math.abs(e.deltaX)):(s=o===0?yo.None:o<0?yo.Up:yo.Down,n=o!==this.pY,i=Math.abs(e.deltaY))),e.direction=s,n&&i>t.threshold&&!!(s&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&En.Began)||!(this.state&En.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=yo[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const lY=["","start","move","end","cancel","in","out"];class cY extends DM{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[g0]}getEventNames(){return lY.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&En.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class _0{constructor(e,t,n){this.element=e,this.callback=t,this.options=n}}const uY=(typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"").indexOf("firefox")!==-1,zM=4.000244140625,hY=40,AY=.25;class fY extends _0{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;globalThis.WheelEvent&&(uY&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=hY)),s!==0&&s%zM===0&&(s=Math.floor(s/zM)),i.shiftKey&&s&&(s=s*AY),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const QM=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class dY extends _0{constructor(e,t,n){super(e,t,{enable:!0,...n}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,QM.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){QM.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const HM=["keydown","keyup"];class pY extends _0{constructor(e,t,n){super(e,t,{enable:!0,tabIndex:0,...n}),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",HM.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){HM.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class gY extends _0{constructor(e,t,n){super(e,t,n),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const VM=1,p2=2,jM=4,mY={pointerdown:VM,pointermove:p2,pointerup:jM,mousedown:VM,mousemove:p2,mouseup:jM},_Y=0,yY=1,bY=2,vY=1,wY=2,xY=4;function BY(r){const e=mY[r.srcEvent.type];if(!e)return null;const{buttons:t,button:n}=r.srcEvent;let i=!1,s=!1,a=!1;return e===p2?(i=!!(t&vY),s=!!(t&xY),a=!!(t&wY)):(i=n===_Y,s=n===yY,a=n===bY),{leftButton:i,middleButton:s,rightButton:a}}function CY(r,e){const t=r.center;if(!t)return null;const n=e.getBoundingClientRect(),i=n.width/e.offsetWidth||1,s=n.height/e.offsetHeight||1,a={x:(t.x-n.left-e.clientLeft)/i,y:(t.y-n.top-e.clientTop)/s};return{center:t,offsetCenter:a}}const TY={srcElement:"root",priority:0};class EY{constructor(e,t){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let s=n.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,i=!1,s=!1){const{handlers:a,handlersByElement:o}=this,u={...TY,...n};let d=o.get(u.srcElement);d||(d=[],o.set(u.srcElement,d));const p={type:e,handler:t,srcElement:u.srcElement,priority:u.priority};i&&(p.once=!0),s&&(p.passive=!0),a.push(p),this._active=this._active||!p.passive;let b=d.length-1;for(;b>=0&&!(d[b].priority>=p.priority);)b--;d.splice(b+1,0,p)}remove(e,t){const{handlers:n,handlersByElement:i}=this;for(let s=n.length-1;s>=0;s--){const a=n[s];if(a.type===e&&a.handler===t){n.splice(s,1);const o=i.get(a.srcElement);o.splice(o.indexOf(a),1),o.length===0&&i.delete(a.srcElement)}}this._active=n.some(s=>!s.passive)}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let i=!1;const s=()=>{e.handled=!0},a=()=>{e.handled=!0,i=!0},o=[];for(let u=0;u<n.length;u++){const{type:d,handler:p,once:b}=n[u];if(p({...e,type:d,stopPropagation:s,stopImmediatePropagation:a}),b&&o.push(n[u]),i)break}for(let u=0;u<o.length;u++){const{type:d,handler:p}=o[u];this.remove(d,p)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...BY(e),...CY(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function SY(r){if("recognizer"in r)return r;let e;const t=Array.isArray(r)?[...r]:[r];if(typeof t[0]=="function"){const n=t.shift(),i=t.shift()||{};e=new n(i)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class IY{constructor(e=null,t={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new iY(e,this.options);for(const n of this.options.recognizers){const{recognizer:i,recognizeWith:s,requireFailure:a}=SY(n);this.manager.add(i),s&&i.recognizeWith(s),a&&i.requireFailure(a)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new fY(e,this._onOtherEvent,{enable:!1}),this.moveInput=new dY(e,this._onOtherEvent,{enable:!1}),this.keyInput=new pY(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new gY(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:n}=this;if(!n)return;const i=n.get(e);i&&(i.set({enable:t}),n.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,n,i,s){if(typeof e!="string"){n=t;for(const[d,p]of Object.entries(e))this._addEventHandler(d,p,n,i,s);return}const{manager:a,events:o}=this;if(!a)return;let u=o.get(e);if(!u){const d=this._getRecognizerName(e)||e;u=new EY(this,d),o.set(e,u),a&&a.on(e,u.handleEvent)}u.add(e,t,n,i,s),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[s,a]of Object.entries(e))this._removeEventHandler(s,a);return}const{events:n}=this,i=n.get(e);if(i&&(i.remove(e,t),i.isEmpty())){const{recognizerName:s}=i;let a=!1;for(const o of n.values())if(o.recognizerName===s&&!o.isEmpty()){a=!0;break}a||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const Qn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Qn,"IDENTITY",{get:()=>($n.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const vl={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ym={common:0,meters:1,pixels:2},g2={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},$M={multipan:[NM,{threshold:10,direction:yo.Vertical,pointers:2}],pinch:[cY,{},null,["multipan"]],pan:[NM,{threshold:1},["pinch"],["multipan"]],dblclick:[kM,{event:"dblclick",taps:2}],click:[kM,{event:"click"},null,["dblclick"]]};function PY(r,e){if(r===e)return!0;if(Array.isArray(r)){const t=r.length;if(!e||e.length!==t)return!1;for(let n=0;n<t;n++)if(r[n]!==e[n])return!1;return!0}return!1}function bm(r){let e={},t;return n=>{for(const i in n)if(!PY(n[i],e[i])){t=r(n),e=n;break}return t}}const GM=[0,0,0,0],MY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],WM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],FY=[0,0,0],qM=[0,0,0],RY=bm(UY);function KM(r,e,t=qM){t.length<3&&(t=[t[0],t[1],0]);let n=t,i,s=!0;switch(e===Qn.LNGLAT_OFFSETS||e===Qn.METER_OFFSETS?i=t:i=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case vl.WEB_MERCATOR:(e===Qn.LNGLAT||e===Qn.CARTESIAN)&&(i=[0,0,0],s=!1);break;case vl.WEB_MERCATOR_AUTO_OFFSET:e===Qn.LNGLAT?n=i:e===Qn.CARTESIAN&&(n=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],i=r.unprojectPosition(n),n[0]-=t[0],n[1]-=t[1],n[2]-=t[2]);break;case vl.IDENTITY:n=r.position.map(Math.fround),n[2]=n[2]||0;break;case vl.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:n,offsetMode:s}}function LY(r,e,t){const{viewMatrixUncentered:n,projectionMatrix:i}=r;let{viewMatrix:s,viewProjectionMatrix:a}=r,o=GM,u=GM,d=r.cameraPosition;const{geospatialOrigin:p,shaderCoordinateOrigin:b,offsetMode:C}=KM(r,e,t);return C&&(u=r.projectPosition(p||b),d=[d[0]-u[0],d[1]-u[1],d[2]-u[2]],u[3]=1,o=pp([],u,a),s=n||s,a=$f([],i,s),a=$f([],a,MY)),{viewMatrix:s,viewProjectionMatrix:a,projectionCenter:o,originCommon:u,cameraPosCommon:d,shaderCoordinateOrigin:b,geospatialOrigin:p}}function OY({viewport:r,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:n=Qn.DEFAULT,coordinateOrigin:i=qM,autoWrapLongitude:s=!1}){n===Qn.DEFAULT&&(n=r.isGeospatial?Qn.LNGLAT:Qn.CARTESIAN);const a=RY({viewport:r,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i});return a.wrapLongitude=s,a.modelMatrix=t||WM,a}function UY({viewport:r,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:n}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:a,cameraPosCommon:o,shaderCoordinateOrigin:u,geospatialOrigin:d}=LY(r,t,n),p=r.getDistanceScales(),b=[r.width*e,r.height*e],C=pp([],[0,0,-r.focalDistance,1],r.projectionMatrix)[3]||1,w={coordinateSystem:t,projectionMode:r.projectionMode,coordinateOrigin:u,commonOrigin:a.slice(0,3),center:i,pseudoMeters:!!r._pseudoMeters,viewportSize:b,devicePixelRatio:e,focalDistance:C,commonUnitsPerMeter:p.unitsPerMeter,commonUnitsPerWorldUnit:p.unitsPerMeter,commonUnitsPerWorldUnit2:FY,scale:r.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:WM,cameraPosition:o};if(d){const M=r.getDistanceScales(d);switch(t){case Qn.METER_OFFSETS:w.commonUnitsPerWorldUnit=M.unitsPerMeter,w.commonUnitsPerWorldUnit2=M.unitsPerMeter2;break;case Qn.LNGLAT:case Qn.LNGLAT_OFFSETS:r._pseudoMeters||(w.commonUnitsPerMeter=M.unitsPerMeter),w.commonUnitsPerWorldUnit=M.unitsPerDegree,w.commonUnitsPerWorldUnit2=M.unitsPerDegree2;break;case Qn.CARTESIAN:w.commonUnitsPerWorldUnit=[1,1,M.unitsPerMeter[2]],w.commonUnitsPerWorldUnit2=[0,0,M.unitsPerMeter2[2]];break}}return w}const DY=Object.keys(Qn).map(r=>`const COORDINATE_SYSTEM_${r}: i32 = ${Qn[r]};`).join(""),kY=Object.keys(vl).map(r=>`const PROJECTION_MODE_${r}: i32 = ${vl[r]};`).join(""),NY=Object.keys(ym).map(r=>`const UNIT_${r.toUpperCase()}: i32 = ${ym[r]};`).join(""),zY=`${`${DY}
${kY}
${NY}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z‑axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,QY=Object.keys(Qn).map(r=>`const int COORDINATE_SYSTEM_${r} = ${Qn[r]};`).join(""),HY=Object.keys(vl).map(r=>`const int PROJECTION_MODE_${r} = ${vl[r]};`).join(""),VY=Object.keys(ym).map(r=>`const int UNIT_${r.toUpperCase()} = ${ym[r]};`).join(""),jY=`${QY}
${HY}
${VY}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,$Y={};function GY(r=$Y){return"viewport"in r?OY(r):{}}const m2={name:"project",dependencies:[bX,BM],source:zY,vs:jY,getUniforms:GY,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},_2={name:"project32",dependencies:[m2],source:`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,vs:`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`};function WY(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function mp(r,e){const t=pp([],e,r);return i2(t,t,1/t[3]),t}function XM(r,e){const t=r%e;return t<0?e+t:t}function y2(r,e,t){return r<e?e:r>t?t:r}function qY(r){return Math.log(r)*Math.LOG2E}const b2=Math.log2||qY;function Lh(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const zc=Math.PI,YM=zc/4,Yl=zc/180,v2=180/zc,_p=512,y0=4003e4,UA=85.051129,KY=1.5;function XY(r){return b2(r)}function vm(r){const[e,t]=r;Lh(Number.isFinite(e)),Lh(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const n=e*Yl,i=t*Yl,s=_p*(n+zc)/(2*zc),a=_p*(zc+Math.log(Math.tan(YM+i*.5)))/(2*zc);return[s,a]}function yp(r){const[e,t]=r,n=e/_p*(2*zc)-zc,i=2*(Math.atan(Math.exp(t/_p*(2*zc)-zc))-YM);return[n*v2,i*v2]}function YY(r){const{latitude:e}=r;Lh(Number.isFinite(e));const t=Math.cos(e*Yl);return XY(y0*t)-9}function b0(r){const e=Math.cos(r*Yl);return _p/y0/e}function w2(r){const{latitude:e,longitude:t,highPrecision:n=!1}=r;Lh(Number.isFinite(e)&&Number.isFinite(t));const i=_p,s=Math.cos(e*Yl),a=i/360,o=a/s,u=i/y0/s,d={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[a,o,u],degreesPerUnit:[1/a,1/o,1/u]};if(n){const p=Yl*Math.tan(e*Yl)/s,b=a*p/2,C=i/y0*p,w=C/o*u;d.unitsPerDegree2=[0,b,C],d.unitsPerMeter2=[w,0,w]}return d}function ZM(r,e){const[t,n,i]=r,[s,a,o]=e,{unitsPerMeter:u,unitsPerMeter2:d}=w2({longitude:t,latitude:n,highPrecision:!0}),p=vm(r);p[0]+=s*(u[0]+d[0]*a),p[1]+=a*(u[1]+d[1]*a);const b=yp(p),C=(i||0)+(o||0);return Number.isFinite(i)||Number.isFinite(o)?[b[0],b[1],C]:b}function ZY(r){const{height:e,pitch:t,bearing:n,altitude:i,scale:s,center:a}=r,o=WY();A0(o,o,[0,0,-i]),iM(o,o,-t*Yl),sM(o,o,n*Yl);const u=s/e;return n2(o,o,[u,u,u]),a&&A0(o,o,uK([],a)),o}function JY(r){const{width:e,height:t,altitude:n,pitch:i=0,offset:s,center:a,scale:o,nearZMultiplier:u=1,farZMultiplier:d=1}=r;let{fovy:p=wm(KY)}=r;n!==void 0&&(p=wm(n));const b=p*Yl,C=i*Yl,w=x2(p);let M=w;a&&(M+=a[2]*o/Math.cos(C)/t);const P=b*(.5+(s?s[1]:0)/t),k=Math.sin(P)*M/Math.sin(y2(Math.PI/2-C-P,.01,Math.PI-.01)),D=Math.sin(C)*k+M,j=M*10,H=Math.min(D*d,j);return{fov:b,aspect:e/t,focalDistance:w,near:u,far:H}}function wm(r){return 2*Math.atan(.5/r)*v2}function x2(r){return .5/Math.tan(.5*r*Yl)}function JM(r,e){const[t,n,i=0]=r;return Lh(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i)),mp(e,[t,n,i,1])}function B2(r,e,t=0){const[n,i,s]=r;if(Lh(Number.isFinite(n)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return mp(e,[n,i,s,1]);const a=mp(e,[n,i,0,1]),o=mp(e,[n,i,1,1]),u=a[2],d=o[2],p=u===d?0:((t||0)-u)/(d-u);return HP([],a,o,p)}function eZ(r){const{width:e,height:t,bounds:n,minExtent:i=0,maxZoom:s=24,offset:a=[0,0]}=r,[[o,u],[d,p]]=n,b=tZ(r.padding),C=vm([o,y2(p,-UA,UA)]),w=vm([d,y2(u,-UA,UA)]),M=[Math.max(Math.abs(w[0]-C[0]),i),Math.max(Math.abs(w[1]-C[1]),i)],P=[e-b.left-b.right-Math.abs(a[0])*2,t-b.top-b.bottom-Math.abs(a[1])*2];Lh(P[0]>0&&P[1]>0);const k=P[0]/M[0],D=P[1]/M[1],j=(b.right-b.left)/2/k,H=(b.top-b.bottom)/2/D,N=[(w[0]+C[0])/2+j,(w[1]+C[1])/2+H],q=yp(N),W=Math.min(s,b2(Math.abs(Math.min(k,D))));return Lh(Number.isFinite(W)),{longitude:q[0],latitude:q[1],zoom:W}}function tZ(r=0){return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(Lh(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const e4=Math.PI/180;function rZ(r,e=0){const{width:t,height:n,unproject:i}=r,s={targetZ:e},a=i([0,n],s),o=i([t,n],s);let u,d;const p=r.fovy?.5*r.fovy*e4:Math.atan(.5/r.altitude),b=(90-r.pitch)*e4;return p>b-.01?(u=t4(r,0,e),d=t4(r,t,e)):(u=i([0,0],s),d=i([t,0],s)),[a,o,d,u]}function t4(r,e,t){const{pixelUnprojectionMatrix:n}=r,i=mp(n,[e,0,1,1]),s=mp(n,[e,r.height,1,1]),o=(t*r.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),u=HP([],i,s,o),d=yp(u);return d.push(t),d}const r4=512;function nZ(r){const{width:e,height:t,pitch:n=0}=r;let{longitude:i,latitude:s,zoom:a,bearing:o=0}=r;(i<-180||i>180)&&(i=XM(i+180,360)-180),(o<-180||o>180)&&(o=XM(o+180,360)-180);const u=b2(t/r4);if(a<=u)a=u,s=0;else{const d=t/2/Math.pow(2,a),p=yp([0,d])[1];if(s<p)s=p;else{const b=yp([0,r4-d])[1];s>b&&(s=b)}}return{width:e,height:t,longitude:i,latitude:s,zoom:a,pitch:n,bearing:o}}const n4=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,iZ=`
${n4}

const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}

`,sZ=`
${n4}

const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}

`,oZ=bm(hZ),aZ=bm(AZ),lZ=[0,0,0,1],cZ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function uZ(r,e){const[t,n,i]=r,s=B2([t,n,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function hZ({viewport:r,center:e}){return new zn(r.viewProjectionMatrix).invert().transform(e)}function AZ({viewport:r,shadowMatrices:e}){const t=[],n=r.pixelUnprojectionMatrix,i=r.isGeospatial?void 0:1,s=[[0,0,i],[r.width,0,i],[0,r.height,i],[r.width,r.height,i],[0,0,-1],[r.width,0,-1],[0,r.height,-1],[r.width,r.height,-1]].map(a=>uZ(a,n));for(const a of e){const o=a.clone().translate(new It(r.center).negate()),u=s.map(p=>o.transform(p)),d=new zn().ortho({left:Math.min(...u.map(p=>p[0])),right:Math.max(...u.map(p=>p[0])),bottom:Math.min(...u.map(p=>p[1])),top:Math.max(...u.map(p=>p[1])),near:Math.min(...u.map(p=>-p[2])),far:Math.max(...u.map(p=>-p[2]))});t.push(d.multiplyRight(a))}return t}function fZ(r){const{shadowEnabled:e=!0,project:t}=r;if(!e||!t||!r.shadowMatrices||!r.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};const n=m2.getUniforms(t),i=oZ({viewport:t.viewport,center:n.center}),s=[],a=aZ({shadowMatrices:r.shadowMatrices,viewport:t.viewport}).slice();for(let u=0;u<r.shadowMatrices.length;u++){const d=a[u],p=d.clone().translate(new It(t.viewport.center).negate());n.coordinateSystem===Qn.LNGLAT&&n.projectionMode===vl.WEB_MERCATOR?(a[u]=p,s[u]=i):(a[u]=d.clone().multiplyRight(cZ),s[u]=p.transform(i))}const o={drawShadowMap:!!r.drawToShadowMap,useShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,color:r.shadowColor||lZ,lightId:r.shadowLightId||0,lightCount:r.shadowMatrices.length,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};for(let u=0;u<a.length;u++)o[`viewProjectionMatrix${u}`]=a[u],o[`projectCenter${u}`]=s[u];for(let u=0;u<2;u++)o[`shadow_uShadowMap${u}`]=r.shadowMaps&&r.shadowMaps[u]||r.dummyShadowMap;return o}const i4={name:"shadow",dependencies:[m2],vs:iZ,fs:sZ,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:fZ,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},C2={...dM,defaultUniforms:{...dM.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},dZ=[BM],pZ=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],gZ=[];function mZ(r){const e=Uf.getDefaultShaderAssembler();for(const n of dZ)e.addDefaultModule(n);e._hookFunctions.length=0;const t=r==="glsl"?pZ:gZ;for(const n of t)e.addShaderHook(n);return e}const _Z=[255,255,255],yZ=1;let bZ=0;class s4{constructor(e={}){this.type="ambient";const{color:t=_Z}=e,{intensity:n=yZ}=e;this.id=e.id||`ambient-${bZ++}`,this.color=t,this.intensity=n}}const vZ=[255,255,255],wZ=1,xZ=[0,0,-1];let BZ=0;class o4{constructor(e={}){this.type="directional";const{color:t=vZ}=e,{intensity:n=wZ}=e,{direction:i=xZ}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${BZ++}`,this.color=t,this.intensity=n,this.type="directional",this.direction=new It(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class CZ{constructor(e,t={id:"pass"}){const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class T2 extends CZ{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),a=i?1:!1,o=i?0:!1,u=e.colorMask??15,d={viewport:[0,0,t,n]};e.colorMask&&(d.colorMask=u),e.scissorRect&&(d.scissorRect=e.scissorRect);const p=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:s,clearDepth:a,clearStencil:o});try{return this._drawLayers(p,e)}finally{p.end(),this.device.submit()}}_drawLayers(e,t){const{target:n,shaderModuleProps:i,viewports:s,views:a,onViewportActive:o,clearStack:u=!0}=t;t.pass=t.pass||"unknown",u&&(this._lastRenderIndex=-1);const d=[];for(const p of s){const b=a&&a[p.id];o?.(p);const C=this._getDrawLayerParams(p,t),w=p.subViewports||[p];for(const M of w){const P=this._drawLayersInViewport(e,{target:n,shaderModuleProps:i,viewport:M,view:b,pass:t.pass,layers:t.layers},C);d.push(P)}}return d}_getDrawLayerParams(e,{layers:t,pass:n,isPicking:i=!1,layerFilter:s,cullRect:a,effects:o,shaderModuleProps:u},d=!1){const p=[],b=a4(this._lastRenderIndex+1),C={layer:t[0],viewport:e,isPicking:i,renderPass:n,cullRect:a},w={};for(let M=0;M<t.length;M++){const P=t[M],k=this._shouldDrawLayer(P,C,s,w),D={shouldDrawLayer:k};k&&!d&&(D.shouldDrawLayer=!0,D.layerRenderIndex=b(P,k),D.shaderModuleProps=this._getShaderModuleProps(P,o,n,u),D.layerParameters={...P.context.deck?.props.parameters,...this.getLayerParameters(P,M,e)}),p[M]=D}return p}_drawLayersInViewport(e,{layers:t,shaderModuleProps:n,pass:i,target:s,viewport:a,view:o},u){const d=TZ(this.device,{shaderModuleProps:n,target:s,viewport:a});if(o){const{clear:b,clearColor:C,clearDepth:w,clearStencil:M}=o.props;if(b){let P=[0,0,0,0],k=1,D=0;Array.isArray(C)?P=[...C.slice(0,3),C[3]||255].map(H=>H/255):C===!1&&(P=!1),w!==void 0&&(k=w),M!==void 0&&(D=M),this.device.beginRenderPass({framebuffer:s,parameters:{viewport:d,scissorRect:d},clearColor:P,clearDepth:k,clearStencil:D}).end()}}const p={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let b=0;b<t.length;b++){const C=t[b],w=u[b],{shouldDrawLayer:M}=w;if(M&&C.props.pickable&&p.pickableCount++,C.isComposite&&p.compositeCount++,C.isDrawable&&w.shouldDrawLayer){const{layerRenderIndex:P,shaderModuleProps:k,layerParameters:D}=w;p.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,P),k.project&&(k.project.viewport=a),C.context.renderPass=e;try{C._drawLayer({renderPass:e,shaderModuleProps:k,uniforms:{layerIndex:P},parameters:D})}catch(j){C.raiseError(j,`drawing ${C} to ${i}`)}}}return p}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,n){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let a=e.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(t))return!1;t.layer=a,a=a.parent}if(n){const o=t.layer.id;if(o in i||(i[o]=n(t)),!i[o])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,n,i){const s=this.device.canvasContext.cssToDeviceRatio(),a=e.internalState?.propsInTransition||e.props,o={layer:a,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:a.modelMatrix,coordinateSystem:a.coordinateSystem,coordinateOrigin:a.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const u of t)l4(o,u.getShaderModuleProps?.(e,o));return l4(o,this.getShaderModuleProps(e,t,o),i)}}function a4(r=0,e={}){const t={},n=(i,s)=>{const a=i.props._offset,o=i.id,u=i.parent&&i.parent.id;let d;if(u&&!(u in e)&&n(i.parent,!1),u in t){const p=t[u]=t[u]||a4(e[u],e);d=p(i,s),t[o]=p}else Number.isFinite(a)?(d=a+(e[u]||0),t[o]=null):d=r;return s&&d>=r&&(r=d+1),e[o]=d,d};return n}function TZ(r,{shaderModuleProps:e,target:t,viewport:n}){const i=e?.project?.devicePixelRatio??r.canvasContext.cssToDeviceRatio(),[,s]=r.canvasContext.getDrawingBufferSize(),a=t?t.height:s,o=n;return[o.x*i,a-(o.y+o.height)*i,o.width*i,o.height*i]}function l4(r,...e){for(const t of e)if(t)for(const n in t)r[n]?Object.assign(r[n],t[n]):r[n]=t[n];return r}class EZ extends T2{constructor(e,t){super(e,t);const n=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),i=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*n,a=i.height*n,o=[1,1,1,1];(s!==t.width||a!==t.height)&&t.resize({width:s,height:a}),super.render({...e,clearColor:o,target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const SZ={color:[255,255,255],intensity:1},c4=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],IZ=[0,0,0,200/255];class E2{constructor(e={}){this.id="lighting-effect",this.shadowColor=IZ,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(i4),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:s,shaderModuleProps:{shadow:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const n=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(a=>a.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(a=>a.getProjectedLight({layer:e})),pointLights:this.pointLights.map(a=>a.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:n,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(i4))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=new zn().lookAt({eye:new It(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new EZ(e);this.shadowPasses[t]=n}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;!e&&t.length===0&&n.length===0&&(this.ambientLight=new s4(SZ),this.directionalLights.push(new o4(c4[0]),new o4(c4[1])))}}class PZ{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:n=1,type:i,padding:s=0,copy:a=!1,initialize:o=!1,maxCount:u}){const d=i||e&&e.constructor||Float32Array,p=t*n+s;if(ArrayBuffer.isView(e)){if(p<=e.length)return e;if(p*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,p)}let b=1/0;u&&(b=u*n+s);const C=this._allocate(d,p,o,b);return e&&a?C.set(e):o||C.fill(0,0,4),this._release(e),C}release(e){this._release(e)}_allocate(e,t,n,i){let s=Math.max(Math.ceil(t*this.opts.overAlloc),1);s>i&&(s=i);const a=this._pool,o=e.BYTES_PER_ELEMENT*s,u=a.findIndex(d=>d.byteLength>=o);if(u>=0){const d=new e(a.splice(u,1)[0],0,s);return n&&d.fill(0),d}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:i}=n,s=t.findIndex(a=>a.byteLength>=i);s<0?t.push(n):(s>0||t.length<this.opts.poolSize)&&t.splice(s,0,n),t.length>this.opts.poolSize&&t.shift()}}const xm=new PZ;function Bm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function MZ(r,e){const t=r%e;return t<0?e+t:t}function FZ(r){return[r[12],r[13],r[14]]}function RZ(r){return{left:bp(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:bp(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:bp(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:bp(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:bp(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:bp(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const u4=new It;function bp(r,e,t,n){u4.set(r,e,t);const i=u4.len();return{distance:n/i,normal:new It(-r/i,-e/i,-t/i)}}function LZ(r){return r-Math.fround(r)}let Cm;function S2(r,e){const{size:t=1,startIndex:n=0}=e,i=e.endIndex!==void 0?e.endIndex:r.length,s=(i-n)/t;Cm=xm.allocate(Cm,s,{type:Float32Array,size:t*2});let a=n,o=0;for(;a<i;){for(let u=0;u<t;u++){const d=r[a++];Cm[o+u]=d,Cm[o+u+t]=LZ(d)}o+=t*2}return Cm.subarray(0,s*t*2)}function OZ(r){let e=null,t=!1;for(const n of r)n&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],n[0][0]),e[0][1]=Math.min(e[0][1],n[0][1]),e[1][0]=Math.max(e[1][0],n[1][0]),e[1][1]=Math.max(e[1][1],n[1][1])):e=n);return e}const UZ=Math.PI/180,DZ=Bm(),h4=[0,0,0],kZ={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function NZ({width:r,height:e,orthographic:t,fovyRadians:n,focalDistance:i,padding:s,near:a,far:o}){const u=r/e,d=t?new zn().orthographic({fovy:n,aspect:u,focalDistance:i,near:a,far:o}):new zn().perspective({fovy:n,aspect:u,near:a,far:o});if(s){const{left:p=0,right:b=0,top:C=0,bottom:w=0}=s,M=Uc((p+r-b)/2,0,r)-r/2,P=Uc((C+e-w)/2,0,e)-e/2;d[8]-=M*2/r,d[9]+=P*2/e}return d}class vp{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||kZ,this.focalDistance=e.focalDistance||1,this.position=e.position||h4,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?vl.WEB_MERCATOR:vl.WEB_MERCATOR_AUTO_OFFSET:vl.IDENTITY}equals(e){return e instanceof vp?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Dc(e.projectionMatrix,this.projectionMatrix)&&Dc(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const n=this.projectPosition(e),i=JM(n,this.pixelProjectionMatrix),[s,a]=i,o=t?a:this.height-a;return e.length===2?[s,o]:[s,o,i[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,s,a]=e,o=t?s:this.height-s,u=n&&n*this.distanceScales.unitsPerMeter[2],d=B2([i,o,a],this.pixelUnprojectionMatrix,u),[p,b,C]=this.unprojectPosition(d);return Number.isFinite(a)?[p,b,C]:Number.isFinite(n)?[p,b,n]:[p,b]}projectPosition(e){const[t,n]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,n,i]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,n,i]}projectFlat(e){if(this.isGeospatial){const t=vm(e);return t[1]=Uc(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?yp(e):e}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,0],t),i=this.unproject([this.width,0],t),s=this.unproject([0,this.height],t),a=this.unproject([this.width,this.height],t);return[Math.min(n[0],i[0],s[0],a[0]),Math.min(n[1],i[1],s[1],a[1]),Math.max(n[0],i[0],s[0],a[0]),Math.max(n[1],i[1],s[1],a[1])]}getDistanceScales(e){return e&&this.isGeospatial?w2({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,RZ(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=YY({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||w2({latitude:n,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:a}=e;let o=h4;if(s&&(o=a?new zn(a).transformAsVector(s,[]):s),this.isGeospatial){const u=this.projectPosition([t,n,0]);this.center=new It(o).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(o)}_initMatrices(e){const{viewMatrix:t=DZ,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:s,fovy:a=75,near:o=.1,far:u=1e3,padding:d=null,focalDistance:p=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new zn().multiplyRight(t).translate(new It(this.center).negate()),this.projectionMatrix=n||NZ({width:this.width,height:this.height,orthographic:i,fovyRadians:s||a*UZ,focalDistance:p,padding:d,near:o,far:u});const b=Bm();$f(b,b,this.projectionMatrix),$f(b,b,this.viewMatrix),this.viewProjectionMatrix=b,this.viewMatrixInverse=r2([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=FZ(this.viewMatrixInverse);const C=Bm(),w=Bm();n2(C,C,[this.width/2,-this.height/2,1]),A0(C,C,[1,-1,0]),$f(w,C,this.viewProjectionMatrix),this.pixelProjectionMatrix=w,this.pixelUnprojectionMatrix=r2(Bm(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||$n.warn("Pixel project matrix not invertible")()}}vp.displayName="Viewport";class Gf extends vp{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:i=0,pitch:s=0,bearing:a=0,nearZMultiplier:o=.1,farZMultiplier:u=1.01,nearZ:d,farZ:p,orthographic:b=!1,projectionMatrix:C,repeat:w=!1,worldOffset:M=0,position:P,padding:k,legacyMeterSizes:D=!1}=e;let{width:j,height:H,altitude:N=1.5}=e;const q=Math.pow(2,i);j=j||1,H=H||1;let W,ie=null;if(C)N=C[5]/2,W=wm(N);else{e.fovy?(W=e.fovy,N=x2(W)):W=wm(N);let Z;if(k){const{top:fe=0,bottom:te=0}=k;Z=[0,Uc((fe+H-te)/2,0,H)-H/2]}ie=JY({width:j,height:H,scale:q,center:P&&[0,0,P[2]*b0(t)],offset:Z,pitch:s,fovy:W,nearZMultiplier:o,farZMultiplier:u}),Number.isFinite(d)&&(ie.near=d),Number.isFinite(p)&&(ie.far=p)}let se=ZY({height:H,pitch:s,bearing:a,scale:q,altitude:N});M&&(se=new zn().translate([512*M,0,0]).multiplyLeft(se)),super({...e,width:j,height:H,viewMatrix:se,longitude:n,latitude:t,zoom:i,...ie,fovy:W,focalDistance:N}),this.latitude=t,this.longitude=n,this.zoom=i,this.pitch=s,this.bearing=a,this.altitude=N,this.fovy=W,this.orthographic=b,this._subViewports=w?[]:null,this._pseudoMeters=D,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let i=t;i<=n;i++){const s=i?new Gf({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e),i=(e[2]||0)*b0(e[1]);return[t,n,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e),i=(e[2]||0)/b0(n);return[t,n,i]}addMetersToLngLat(e,t){return ZM(e,t)}panByPosition(e,t){const n=B2(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=QP([],i,nK([],n)),a=QP([],this.center,s),[o,u]=this.unprojectFlat(a);return{longitude:o,latitude:u}}getBounds(e={}){const t=rZ(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:n,height:i}=this,{longitude:s,latitude:a,zoom:o}=eZ({width:n,height:i,bounds:e,...t});return new Gf({width:n,height:i,longitude:s,latitude:a,zoom:o})}}Gf.displayName="WebMercatorViewport";const A4=[0,0,0];function I2(r,e,t=!1){const n=e.projectPosition(r);if(t&&e instanceof Gf){const[i,s,a=0]=r,o=e.getDistanceScales([i,s]);n[2]=a*o.unitsPerMeter[2]}return n}function zZ(r){const{viewport:e,modelMatrix:t,coordinateOrigin:n}=r;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:a}=r;return i===Qn.DEFAULT&&(i=e.isGeospatial?Qn.LNGLAT:Qn.CARTESIAN),s===void 0&&(s=i),a===void 0&&(a=n),{viewport:e,coordinateSystem:i,coordinateOrigin:n,modelMatrix:t,fromCoordinateSystem:s,fromCoordinateOrigin:a}}function f4(r,{viewport:e,modelMatrix:t,coordinateSystem:n,coordinateOrigin:i,offsetMode:s}){let[a,o,u=0]=r;switch(t&&([a,o,u]=pp([],[a,o,u,1],t)),n){case Qn.LNGLAT:return I2([a,o,u],e,s);case Qn.LNGLAT_OFFSETS:return I2([a+i[0],o+i[1],u+(i[2]||0)],e,s);case Qn.METER_OFFSETS:return I2(ZM(i,[a,o,u]),e,s);case Qn.CARTESIAN:default:return e.isGeospatial?[a+i[0],o+i[1],u+i[2]]:e.projectPosition([a,o,u])}}function QZ(r,e){const{viewport:t,coordinateSystem:n,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:a,fromCoordinateOrigin:o}=zZ(e),{autoOffset:u=!0}=e,{geospatialOrigin:d=A4,shaderCoordinateOrigin:p=A4,offsetMode:b=!1}=u?KM(t,n,i):{},C=f4(r,{viewport:t,modelMatrix:s,coordinateSystem:a,coordinateOrigin:o,offsetMode:b});if(b){const w=t.projectPosition(d||p);JP(C,C,w)}return C}let HZ=1,VZ=1;class d4{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,a=HZ++,o={time:0,delay:t,duration:n,rate:i,repeat:s};return this._setChannelTime(o,this.time),this.channels.set(a,o),a}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:s,channel:a}=i;s.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=VZ++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay,i=e.duration*e.repeat;n>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function jZ(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function $Z(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}let GZ=0;class P2{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:Sw.stats.get(`animation-loop-${GZ++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...P2.defaultAnimationLoopProps,...e},e=this.props,!e.device)throw new Error("No device provided");this.stats=e.stats||new up({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=jZ(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&($Z(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.getDefaultCanvasContext();if(!this.device||!e)throw new Error("loop");const t=e?.canvas,n=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:t,useDevicePixels:n,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1];let n=1;const i=this.device?.getDefaultCanvasContext().canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const M2={};function wp(r="id"){M2[r]=M2[r]||1;const e=M2[r]++;return`${r}-${e}`}class p4{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||wp("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&bs.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function WZ(r,e){if(e instanceof p4)return e;const t=qZ(r,e),{attributes:n,bufferLayout:i}=KZ(r,e);return new p4({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:t,attributes:n})}function qZ(r,e){if(!e.indices)return;const t=e.indices.value;return r.createBuffer({usage:bs.INDEX,data:t})}function KZ(r,e){const t=[],n={};for(const[s,a]of Object.entries(e.attributes)){let o=s;switch(s){case"POSITION":o="positions";break;case"NORMAL":o="normals";break;case"TEXCOORD_0":o="texCoords";break;case"COLOR_0":o="colors";break}if(a){n[o]=r.createBuffer({data:a.value,id:`${s}-buffer`});const{value:u,size:d,normalized:p}=a;t.push({name:o,format:gW(u,d,p)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:n,bufferLayout:t,vertexCount:i}}class F2{static defaultProps={...zf.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new F2(e),e._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}createRenderPipeline(e){if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const t={...zf.defaultProps,...e},n=this._renderPipelineCache,i=this._hashRenderPipeline(t);let s=n[i]?.pipeline;return s?(n[i].useCount++,this.debug&&Xt.warn(`${this}: ${n[i].pipeline} reused, count=${n[i].useCount}, (id=${e.id})`)()):(s=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:wp("unnamed-cached")}),s.hash=i,n[i]={pipeline:s,useCount:1},this.debug&&Xt.warn(`${this}: ${s} created, count=${n[i].useCount}`)()),s}createComputePipeline(e){if(!this.cachingEnabled)return this.device.createComputePipeline(e);const t={...Gy.defaultProps,...e},n=this._computePipelineCache,i=this._hashComputePipeline(t);let s=n[i]?.pipeline;return s?(n[i].useCount++,this.debug&&Xt.warn(`${this}: ${n[i].pipeline} reused, count=${n[i].useCount}, (id=${e.id})`)()):(s=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0}),s.hash=i,n[i]={pipeline:s,useCount:1},this.debug&&Xt.warn(`${this}: ${s} created, count=${n[i].useCount}`)()),s}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._getCache(e),n=e.hash;t[n].useCount--,t[n].useCount===0?(this._destroyPipeline(e),this.debug&&Xt.warn(`${this}: ${e} released and destroyed`)()):t[n].useCount<0?(Xt.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[n].useCount=0):this.debug&&Xt.warn(`${this}: ${e} released, count=${t[n].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof Gy&&(t=this._computePipelineCache),e instanceof zf&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device,n=this._getHash(e.shader.source);return`${t}/C/${n}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,n=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout)),{type:a}=this.device;switch(a){case"webgl":return`${a}/R/${t}/${n}V${i}BL${s}`;case"webgpu":default:const o=this._getHash(JSON.stringify(e.parameters));return`${a}/R/${t}/${n}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class R2{static defaultProps={...jy.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new R2(e),e._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let n=this._cache[t];if(n)n.useCount++,this.debug&&Xt.warn(`${this}: Reusing shader ${n.shader.id} count=${n.useCount}`)();else{const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:i,useCount:1},this.debug&&Xt.warn(`${this}: Created new shader ${i.id}`)()}return n.shader}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._hashShader(e),n=this._cache[t];if(n)if(n.useCount--,n.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[t],n.shader.destroy(),this.debug&&Xt.warn(`${this}: Releasing shader ${e.id}, destroyed`)());else{if(n.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&Xt.warn(`${this}: Releasing shader ${e.id} count=${n.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}}function XZ(r,e){const t={},n="Values";if(r.attributes.length===0&&!r.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(const i of r.attributes)if(i){const s=`${i.location} ${i.name}: ${i.type}`;t[`in ${s}`]={[n]:i.stepMode||"vertex"}}for(const i of r.varyings||[]){const s=`${i.location} ${i.name}`;t[`out ${s}`]={[n]:JSON.stringify(i)}}return t}let Ro=null,L2=null;function YZ(r,{id:e,minimap:t,opaque:n,top:i="0",left:s="0",rgbaScale:a=1}){Ro||(Ro=document.createElement("canvas"),Ro.id=e,Ro.title=e,Ro.style.zIndex="100",Ro.style.position="absolute",Ro.style.top=i,Ro.style.left=s,Ro.style.border="blue 5px solid",Ro.style.transform="scaleY(-1)",document.body.appendChild(Ro),L2=Ro.getContext("2d")),(Ro.width!==r.width||Ro.height!==r.height)&&(Ro.width=r.width/2,Ro.height=r.height/2,Ro.style.width="400px",Ro.style.height="400px");const o=r.device.readPixelsToArrayWebGL(r),u=L2?.createImageData(r.width,r.height);if(u){for(let p=0;p<o.length;p+=4)u.data[0+p+0]=o[p+0]*a,u.data[0+p+1]=o[p+1]*a,u.data[0+p+2]=o[p+2]*a,u.data[0+p+3]=n?255:o[p+3]*a;L2?.putImageData(u,0,0)}}function O2(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!O2(r[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const n=Object.keys(r),i=Object.keys(e);if(n.length!==i.length)return!1;for(const s of n)if(!e.hasOwnProperty(s)||!O2(r[s],e[s],t-1))return!1;return!0}return!1}class U2{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){const n=[...e];for(const i of t){const s=n.findIndex(a=>a.name===i.name);s<0?n.push(i):n[s]=i}return n}getBufferIndex(e){const t=this.bufferLayouts.findIndex(n=>n.name===e);return t===-1&&Xt.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function ZZ(r,e){const t=Object.fromEntries(r.attributes.map(i=>[i.name,i.location])),n=e.slice();return n.sort((i,s)=>{const a=i.attributes?i.attributes.map(p=>p.attribute):[i.name],o=s.attributes?s.attributes.map(p=>p.attribute):[s.name],u=Math.min(...a.map(p=>t[p])),d=Math.min(...o.map(p=>t[p]));return u-d}),n}function JZ(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function eJ(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":!1}function tJ(r){return JZ(r)||eJ(r)}function rJ(r){return tJ(r)||typeof r=="number"||typeof r=="boolean"}function nJ(r){const e={bindings:{},uniforms:{}};return Object.keys(r).forEach(t=>{const n=r[t];rJ(n)?e.uniforms[t]=n:e.bindings[t]=n}),e}class iJ{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const n=mw(Object.values(e).filter(i=>i.dependencies));for(const i of n)e[i.name]=i;Xt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e))this._addModule(s),s.name&&i!==s.name&&!this.options.disableWarnings&&Xt.warn(`Module name: ${i} vs ${s.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const n=t,i=e[n]||{},s=this.modules[n];if(!s){this.options.disableWarnings||Xt.warn(`Module ${t} not found`)();continue}const a=this.moduleUniforms[n],o=this.moduleBindings[n],u=s.getUniforms?.(i,a)||i,{uniforms:d,bindings:p}=nJ(u);this.moduleUniforms[n]={...a,...d},this.moduleBindings[n]={...o,...p}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,n]of Object.entries(this.moduleUniforms))for(const[i,s]of Object.entries(n))e[`${t}.${i}`]={type:this.modules[t].uniformTypes?.[i],value:String(s)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let sJ="";async function oJ(r,e){const t=new Image;return t.crossOrigin="anonymous",t.src=r.startsWith("http")?r:sJ+r,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}const aJ=["+X","-X","+Y","-Y","+Z","-Z"],lJ=["+X","-X","+Y","-Y","+Z","-Z"];class Tm{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e;const n=wp("async-texture");this.props={...Tm.defaultProps,id:n,...t},this.id=this.props.id,t={...t},typeof t?.data=="string"&&t.dimension==="2d"&&(t.data=oJ(t.data)),t.mipmaps&&(t.mipLevels="auto"),this.ready=new Promise((i,s)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=s}),this.initAsync(t)}async initAsync(e){const t=e.data,n=await g4(t).then(void 0,this.rejectReady);if(this.destroyed)return;const i=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(n);if(!i)throw new Error("Texture size could not be determined");const s={...i,...e,data:void 0,mipLevels:1},a=this.device.getMipLevelCount(s.width,s.height);if(s.mipLevels=this.props.mipLevels==="auto"?a:Math.min(a,this.props.mipLevels),this.texture=this.device.createTexture(s),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,n);break;case"2d":this._setTexture2DData(n);break;case"3d":this._setTexture3DData(this.texture,n);break;case"2d-array":this._setTextureArrayData(this.texture,n);break;case"cube":this._setTextureCubeData(this.texture,n);break;case"cube-array":this._setTextureCubeArrayData(this.texture,n);break}this.props.mipmaps&&this.generateMipmaps(),Xt.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof Nf?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const n=Object.values(e)[0];return{width:n.width,height:n.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const n=this._normalizeTextureData(e);n.length>1&&this.props.mipmaps!==!1&&Xt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let i=0;i<n.length;i++){const s=n[i];this.device.isExternalImage(s)?this.texture.copyExternalImage({image:s,depth:t,mipLevel:i,flipY:!0}):this.texture.copyImageData({data:s.data,mipLevel:i})}}_setTexture3DData(e,t){if(this.texture?.props.dimension!=="3d")throw new Error(this.id);for(let n=0;n<t.length;n++)this._setTexture2DData(t[n],n)}_setTextureCubeData(e,t){if(this.texture?.props.dimension!=="cube")throw new Error(this.id);for(const[n,i]of Object.entries(t)){const s=lJ.indexOf(n);this._setTexture2DData(i,s)}}_setTextureArrayData(e,t){if(this.texture?.props.dimension!=="2d-array")throw new Error(this.id);for(let n=0;n<t.length;n++)this._setTexture2DData(t[n],n)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,n,i=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&Xt.warn(`${this.id} has mipmap and multiple LODs.`)();const s=aJ.indexOf(n);this._setTexture2DData(t,s)}_normalizeTextureData(e){const t=this.texture;let n;return ArrayBuffer.isView(e)?n=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?n=e:n=[e],n}static defaultProps={...Ks.defaultProps,data:null,mipmaps:!1}}async function g4(r){if(r=await r,Array.isArray(r))return await Promise.all(r.map(g4));if(r&&typeof r=="object"&&r.constructor===Object){const e=r,t=await Promise.all(Object.values(e)),n=Object.keys(e),i={};for(let s=0;s<n.length;s++)i[n[s]]=t[s];return i}return r}const Wf=2,cJ=1e4;class DA{static defaultProps={...zf.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Uf.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...DA.defaultProps,...t},t=this.props,this.id=t.id||wp("model"),this.device=e,Object.assign(this.userData,t.userData);const n=Object.fromEntries(this.props.modules?.map(u=>[u.name,u])||[]),i=t.shaderInputs||new iJ(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const s=hJ(e),a=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:u,getUniforms:d}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:a});this.source=u,this._getModuleUniforms=d,this.props.shaderLayout||=jq(this.source)}else{const{vs:u,fs:d,getUniforms:p}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:a});this.vs=u,this.fs=d,this._getModuleUniforms=p}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||F2.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||R2.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return Xt.info(Wf,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let n;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings});const{indexBuffer:s}=this.vertexArray,a=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:a,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&WZ(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const n=new U2(this.bufferLayout);this.bufferLayout=n.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new U2(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){O2(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new hq(this.shaderInputs.modules);for(const[t,n]of Object.entries(this.shaderInputs.modules))if(uJ(n)){const i=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const n=t?.disableWarnings??this.props.disableWarnings;e.indices&&Xt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=ZZ(this.pipeline.shaderLayout,this.bufferLayout);const i=new U2(this.bufferLayout);for(const[s,a]of Object.entries(e)){const o=i.getBufferLayout(s);if(!o){n||Xt.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const u=i.getAttributeNamesForBuffer(o);let d=!1;for(const p of u){const b=this._attributeInfos[p];if(b){const C=this.device.type==="webgpu"?i.getBufferIndex(b.bufferName):b.location;this.vertexArray.setBuffer(C,a),d=!0}}!d&&!n&&Xt.warn(`Model(${this.id}): Ignoring buffer "${a.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,i]of Object.entries(e)){const s=this._attributeInfos[n];s?this.vertexArray.setConstantWebGL(s.location,i):(t?.disableWarnings??this.props.disableWarnings)||Xt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Tm&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,n]of Object.entries(this.bindings))n instanceof Tm?n.isReady&&(e[t]=n.texture):e[t]=n;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Vy?e=Math.max(e,t.texture.updateTimestamp):t instanceof bs||t instanceof Ks?e=Math.max(e,t.updateTimestamp):t instanceof Tm?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Nf||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(i=>i.name===n)&&n!=="positions"&&delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(Xt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:i}),this._attributeInfos=cP(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=Xt.level>3?0:cJ;Xt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Xt.group(Wf,`>>> DRAWING MODEL ${this.id}`,{collapsed:Xt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=XZ(this.pipeline.shaderLayout,this.id);Xt.table(Wf,e)();const t=this.shaderInputs.getDebugTable();Xt.table(Wf,t)();const n=this._getAttributeDebugTable();Xt.table(Wf,this._attributeInfos)(),Xt.table(Wf,n)(),Xt.groupEnd(Wf)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const n=e.props.framebuffer;n&&YZ(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[n.location];e[n.location]={name:t,type:n.shaderType,values:i?this._getBufferOrConstantValues(i,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=vw(t);return(e instanceof bs?new n(e.debugData):e).toString()}}function uJ(r){return!!(r.uniformTypes&&!AJ(r.uniformTypes))}function hJ(r){return{type:r.type,shaderLanguage:r.info.shadingLanguage,shaderLanguageVersion:r.info.shadingLanguageVersion,gpu:r.info.gpu,features:r.features}}function AJ(r){for(const e in r)return!1;return!0}class xp{device;model;transformFeedback;static defaultProps={...DA.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=xp.defaultProps){if(!xp.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new DA(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||lW(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof bs)return t.readAsync();const{buffer:n,byteOffset:i=0,byteLength:s=n.byteLength}=t;return n.readAsync(i,s)}}class Bp{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||wp("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[s,a]of Object.entries(t)){const o=ArrayBuffer.isView(a)?{value:a}:a;if(!ArrayBuffer.isView(o.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!o.size&&(o.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=o}else this.attributes[s]=o}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const i of Object.values(e)){const{value:s,size:a,constant:o}=i;!o&&s&&a!==void 0&&a>=1&&(n=Math.min(n,s.length/a))}return n}}class v0{id;matrix=new zn;display=!0;position=new It;rotation=new It;scale=new It(1,1,1);userData={};props={};constructor(e={}){const{id:t}=e;this.id=t||wp(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e,t=!0){t?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){const{position:t,rotation:n,scale:i,update:s=!0}=e;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),s&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(n),this}update(e={}){const{position:t,rotation:n,scale:i}=e;return t&&this.setPosition(t),n&&this.setRotation(n),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,t){t=t||this.matrix;const n=new zn(e).multiplyRight(t),i=n.invert(),s=i.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class Cp extends v0{children;constructor(e={}){e=Array.isArray(e)?{children:e}:e;const{children:t=[]}=e;Xt.assert(t.every(n=>n instanceof v0),"every child must an instance of ScenegraphNode"),super(e),this.children=t}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((t,{worldMatrix:n})=>{const i=t.getBounds();if(!i)return;const[s,a]=i,o=new It(s).add(a).divide([2,2,2]);n.transformAsPoint(o,o);const u=new It(a).subtract(s).divide([2,2,2]);n.transformAsVector(u,u);for(let d=0;d<8;d++){const p=new It(d&1?-1:1,d&2?-1:1,d&4?-1:1).multiply(u).add(o);for(let b=0;b<3;b++)e[0][b]=Math.min(e[0][b],p[b]),e[1][b]=Math.max(e[1][b],p[b])}}),Number.isFinite(e[0][0])?e:null}destroy(){this.children.forEach(e=>e.destroy()),this.removeAll(),super.destroy()}add(...e){for(const t of e)Array.isArray(t)?this.add(...t):this.children.push(t);return this}remove(e){const t=this.children,n=t.indexOf(e);return n>-1&&t.splice(n,1),this}removeAll(){return this.children=[],this}traverse(e,{worldMatrix:t=new zn}={}){const n=new zn(t).multiplyRight(this.matrix);for(const i of this.children)i instanceof Cp?i.traverse(e,{worldMatrix:n}):e(i,{worldMatrix:n})}}class D2 extends v0{model;bounds=null;managedResources;constructor(e){super(e),this.model=e.model,this.managedResources=e.managedResources||[],this.bounds=e.bounds||null,this.setProps(e)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(e=>e.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(e){return this.model.draw(e)}}const fJ={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class m4 extends T2{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:s,pickingFBO:a,deviceRect:{x:o,y:u,width:d,height:p},cullRect:b,effects:C,pass:w="picking",pickZ:M,shaderModuleProps:P}){this.pickZ=M;const k=this._resetColorEncoder(M),D=[o,u,d,p],j=super.render({target:a,layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:s,cullRect:b,effects:C?.filter(N=>N.useInPicking),pass:w,isPicking:!0,shaderModuleProps:P,clearColor:[0,0,0,0],colorMask:15,scissorRect:D});return this._colorEncoderState=null,{decodePickingColor:k&&pJ.bind(null,k),stats:j}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(e,t,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,n){const i={...e.props.parameters},{pickable:s,operation:a}=e.props;return!this._colorEncoderState||a.includes("terrain")?i.blend=!1:s&&a.includes("draw")&&(Object.assign(i,fJ),i.blend=!0,i.blendColor=dJ(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function dJ(r,e,t){const{byLayer:n,byAlpha:i}=r;let s,a=n.get(e);return a?(a.viewports.push(t),s=a.a):(s=n.size+1,s<=255?(a={a:s,layer:e,viewports:[t]},n.set(e,a),i[s]=a):($n.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function pJ(r,e){const t=r.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const Tp={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},w0=Symbol.for("component"),kA=Symbol.for("propTypes"),k2=Symbol.for("deprecatedProps"),Ep=Symbol.for("asyncPropDefaults"),qf=Symbol.for("asyncPropOriginal"),NA=Symbol.for("asyncPropResolved");function Kf(r,e=()=>!0){return Array.isArray(r)?_4(r,e,[]):e(r)?[r]:[]}function _4(r,e,t){let n=-1;for(;++n<r.length;){const i=r[n];Array.isArray(i)?_4(i,e,t):e(i)&&t.push(i)}return t}function gJ({target:r,source:e,start:t=0,count:n=1}){const i=e.length,s=n*i;let a=0;for(let o=t;a<i;a++)r[o++]=e[a];for(;a<s;)a<s-a?(r.copyWithin(t+a,t,t+a),a*=2):(r.copyWithin(t+a,t,t+s-a),a=s);return r}class mJ{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let i=e;typeof e=="string"&&(i=PA(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class _J{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:n=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(t,n):(s=new mJ(e,t,this._context),this._resources[e]=s),s.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const n in t){const i=t[n],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:n,requestId:i="default"}){const{_resources:s,protocol:a}=this;e.startsWith(a)&&(e=e.replace(a,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const o=s[e];if(this._track(n,i,o,t),o)return o.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,i){const s=this._consumers,a=s[e]=s[e]||{};let o=a[t];const u=o&&o.resourceId&&this._resources[o.resourceId];u&&(u.unsubscribe(o),this.prune()),n&&(o?(o.onChange=i,o.resourceId=n.id):o={onChange:i,resourceId:n.id},a[t]=o,n.subscribe(o))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const yJ="layerManager.setLayers",bJ="layerManager.activateViewport";class vJ{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=o=>{sa(bJ,this,o),o&&(this.context.viewport=o)};const{deck:n,stats:i,viewport:s,timeline:a}=t||{};this.layers=[],this.resourceManager=new _J({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:n,shaderAssembler:mZ(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[FX],renderPass:void 0,stats:i||new up({id:"deck.gl"}),viewport:s||new vp({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:a||new d4,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(n=>t.id.indexOf(n)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){sa(yJ,this,t,e),this._lastRenderedLayers=e;const n=Kf(e,Boolean);for(const i of n)i.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(n=>n.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex(i=>i.name===e.name);n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const a of e)n[a.id]?$n.warn(`Multiple old layers with same id ${a.id}`)():n[a.id]=a;if(this._defaultShaderModulesChanged){for(const a of e)a.setNeedsUpdate(),a.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,n,i),this._finalizeOldLayers(n);let s=!1;for(const a of i)if(a.hasUniformTransition()){s=`Uniform transition in ${a}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,t,n){for(const i of e){i.context=this.context;const s=t[i.id];s===null&&$n.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let a=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),a=i.isComposite?i.getSubLayers():null}catch(o){this._handleError("matching",o,i)}a&&this._updateSublayersRecursively(a,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Tp.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Tp.MATCHED,t!==e&&(e.lifecycle=Tp.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Tp.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Tp.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Zl(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!Zl(r[n],e[n],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const n=Object.keys(r),i=Object.keys(e);if(n.length!==i.length)return!1;for(const s of n)if(!e.hasOwnProperty(s)||!Zl(r[s],e[s],t-1))return!1;return!0}return!1}class wJ{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let s=n.length-1;s>=0;--s){const a=n[s];if(a.containsPixel(i)){const o=e.slice();return o[0]-=a.x,o[1]-=a.y,a.unproject(o,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Kf(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Zl(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):$n.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const n=t.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>this.getView(e.id)?.makeViewport({viewState:s,width:this.width,height:this.height})})}_updateController(e,t,n,i){const s=e.controller;if(s&&n){const a={...t,...s,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,a)),i&&i.setProps(a),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const s=e[i],a=this.getViewState(s),o=s.makeViewport({viewState:a,width:this.width,height:this.height});let u=t[s.id];const d=!!s.controller;d&&!u&&(n=!0),(n||!d)&&u&&(u.finalize(),u=null),this.controllers[s.id]=this._updateController(s,a,o,u),o&&this._viewports.unshift(o)}for(const i in t){const s=t[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((n,i)=>!e[i].equals(t[i]))}}const xJ=/([0-9]+\.?[0-9]*)(%|px)/;function zA(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const e=xJ.exec(r);if(e&&e.length>=3){const t=e[2]==="%",n=parseFloat(e[1]);return{position:t?n/100:n,relative:t}}default:throw new Error(`Could not parse position string ${r}`)}}function QA(r,e){return r.relative?Math.round(r.position*e):r.position}class y4{constructor(e){const{id:t,x:n=0,y:i=0,width:s="100%",height:a="100%",padding:o=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=zA(n),this._y=zA(i),this._width=zA(s),this._height=zA(a),this._padding=o&&{left:zA(o.left||0),right:zA(o.right||0),top:zA(o.top||0),bottom:zA(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Zl(this.props,e.props,2)}clone(e){const t=this.constructor;return new t({...this.props,...e})}makeViewport({width:e,height:t,viewState:n}){n=this.filterViewState(n);const i=this.getDimensions({width:e,height:t});if(!i.height||!i.width)return null;const s=this.getViewportType(n);return new s({...n,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const n in this.props.viewState)n!=="id"&&(t[n]=this.props.viewState[n]);return t}return e}getDimensions({width:e,height:t}){const n={x:QA(this._x,e),y:QA(this._y,t),width:QA(this._width,e),height:QA(this._height,t)};return this._padding&&(n.padding={left:QA(this._padding.left,e),top:QA(this._padding.top,t),right:QA(this._padding.right,e),bottom:QA(this._padding.bottom,t)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class x0{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const b4=()=>{},N2={BREAK:1,SNAP_TO_END:2,IGNORE:3},BJ=r=>r,CJ=N2.BREAK;class TJ{constructor(e){this._onTransitionUpdate=t=>{const{time:n,settings:{interpolator:i,startProps:s,endProps:a,duration:o,easing:u}}=t,d=u(n/o),p=i.interpolateProps(s,a,d);this.propsInTransition=this.getControllerState({...this.props,...p}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new x0(e.timeline),this.onViewStateChange=e.onViewStateChange||b4,this.onStateChange=e.onStateChange||b4}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:s,endProps:a}=this.transition.settings;i={...n,...s===N2.SNAP_TO_END?a:this.propsInTransition||n}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||t==="auto")&&!!n}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===N2.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const n=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(n),s=t.transitionInterpolator,a=s.getDuration?s.getDuration(e,t):t.transitionDuration;if(a===0)return;const o=s.initializeProps(e,i);this.propsInTransition={};const u={duration:a,easing:t.transitionEasing||BJ,interpolator:s,interruption:t.transitionInterruption||CJ,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function bo(r,e){if(!r)throw new Error(e||"deck.gl: assertion failed.")}class EJ{constructor(e){const{compare:t,extract:n,required:i}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=i}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!Dc(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},i={};for(const s of this._propsToExtract)(s in e||s in t)&&(n[s]=e[s],i[s]=t[s]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const n=e[t];bo(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)})}}const SJ=["longitude","latitude","zoom","bearing","pitch"],IJ=["longitude","latitude","zoom"];class z2 extends EJ{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:SJ,required:IJ},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:i,around:s}=this.opts;if(i&&s){const a=i(e),o=i(t),u=a.unproject(s);n.start.around=s,Object.assign(n.end,{around:o.project(u),aroundPosition:u,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const i={};for(const s of this._propsToExtract)i[s]=o0(e[s]||0,t[s]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...t,...i});Object.assign(i,s.panByPosition(t.aroundPosition,o0(e.around,t.around,n)))}return i}}const Oh={transitionDuration:0},PJ=300,B0=r=>1-(1-r)*(1-r),Sp={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Xf={};class v4{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new TJ({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-n]}isPointInBounds(e,t){const{width:n,height:i}=this.props;if(t&&t.handled)return!1;const s=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return s&&t&&t.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?PJ:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:a=!0,touchZoom:o=!0,touchRotate:u=!1,keyboard:d=!0}=e,p=!!this.onViewStateChange;this.toggleEvents(Sp.WHEEL,p&&n),this.toggleEvents(Sp.PAN,p),this.toggleEvents(Sp.PINCH,p&&(o||u)),this.toggleEvents(Sp.MULTI_PAN,p&&u),this.toggleEvents(Sp.DOUBLE_CLICK,p&&a),this.toggleEvents(Sp.KEYBOARD,p&&d),this.scrollZoom=n,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=a,this.touchZoom=o,this.touchRotate=u,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(n=>{this._events[n]!==t&&(this._events[n]=t,t?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(e,t=null,n={}){const i={...e.getViewportProps(),...t},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),s){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:a,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(i,Oh,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,Oh,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:B0},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Oh,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:B0},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let a=2/(1+Math.exp(-Math.abs(s*n)));s<0&&a!==0&&(a=1/a);const o=i?{...this._getTransitionProps({around:t}),transitionDuration:250}:Oh,u=this.controllerState.zoom({pos:t,scale:a});return this.updateViewport(u,o,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,Oh,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Oh,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*t/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:B0},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Xf._startPinchRotation=e.rotation,Xf._lastPinchEvent=e,this.updateViewport(n,Oh,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:Xf._startPinchRotation-n})}return this.updateViewport(t,Oh,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Xf._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=Xf;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const a=Math.log2(e.scale),o=(a-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),u=Math.pow(2,a+o*t/2);s=s.zoom({pos:i,scale:u}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:B0},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Xf._startPinchRotation=null,Xf._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:o}=this;let u;const d={};switch(e.srcEvent.code){case"Minus":u=t?o.zoomOut(n).zoomOut(n):o.zoomOut(n),d.isZooming=!0;break;case"Equal":u=t?o.zoomIn(n).zoomIn(n):o.zoomIn(n),d.isZooming=!0;break;case"ArrowLeft":t?(u=o.rotateLeft(s),d.isRotating=!0):(u=o.moveLeft(i),d.isPanning=!0);break;case"ArrowRight":t?(u=o.rotateRight(s),d.isRotating=!0):(u=o.moveRight(i),d.isPanning=!0);break;case"ArrowUp":t?(u=o.rotateUp(a),d.isRotating=!0):(u=o.moveUp(i),d.isPanning=!0);break;case"ArrowDown":t?(u=o.rotateDown(a),d.isRotating=!0):(u=o.moveDown(i),d.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Oh:e?{...t,transitionInterpolator:new z2({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class MJ{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const w4=5,FJ=1.2;class x4 extends MJ{constructor(e){const{width:t,height:n,latitude:i,longitude:s,zoom:a,bearing:o=0,pitch:u=0,altitude:d=1.5,position:p=[0,0,0],maxZoom:b=20,minZoom:C=0,maxPitch:w=60,minPitch:M=0,startPanLngLat:P,startZoomLngLat:k,startRotatePos:D,startBearing:j,startPitch:H,startZoom:N,normalize:q=!0}=e;bo(Number.isFinite(s)),bo(Number.isFinite(i)),bo(Number.isFinite(a)),super({width:t,height:n,latitude:i,longitude:s,zoom:a,bearing:o,pitch:u,altitude:d,maxZoom:b,minZoom:C,maxPitch:w,minPitch:M,normalize:q,position:p},{startPanLngLat:P,startZoomLngLat:k,startRotatePos:D,startBearing:j,startPitch:H,startZoom:N}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this.getState().startPanLngLat||this._unproject(t);if(!n)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:s,startPitch:a}=this.getState();if(!i||s===void 0||a===void 0)return this;let o;return e?o=this._getNewRotation(e,i,a,s):o={bearing:s+t,pitch:a+n},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(t)||this._unproject(e)),!s)return this;const{maxZoom:a,minZoom:o}=this.getViewportProps();let u=i+Math.log2(n);u=Uc(u,o,a);const d=this.makeViewport({...this.getViewportProps(),zoom:u});return this._getUpdatedState({zoom:u,...d.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:s}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(s-t.longitude)>180&&(n.longitude=s<0?s+360:s-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=Uc(i,n,t);const{maxPitch:s,minPitch:a,pitch:o}=e;e.pitch=Uc(o,a,s);const{normalize:u=!0}=e;return u&&Object.assign(e,nZ(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,i){const s=e[0]-t[0],a=e[1]-t[1],o=e[1],u=t[1],{width:d,height:p}=this.getViewportProps(),b=s/d;let C=0;a>0?Math.abs(p-u)>w4&&(C=a/(u-p)*FJ):a<0&&u>w4&&(C=1-o/u),C=Uc(C,-1,1);const{minPitch:w,maxPitch:M}=this.getViewportProps(),P=i+180*b;let k=n;return C>0?k=n+C*(M-n):C<0&&(k=n-C*(w-n)),{pitch:k,bearing:P}}}class RJ extends v4{constructor(){super(...arguments),this.ControllerState=x4,this.transition={transitionDuration:300,transitionInterpolator:new z2({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Q2 extends y4{constructor(e={}){super(e)}getViewportType(){return Gf}get ControllerType(){return RJ}}Q2.displayName="MapView";const LJ=new E2;function OJ(r,e){const t=r.order??1/0,n=e.order??1/0;return t-n}class UJ{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(n=>n.id===e.id)){const n=t.findIndex(i=>OJ(i,e)>0);n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Zl(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const n=[];for(const i of e){const s=t[i.id];let a=i;s&&s!==i?s.setProps?(s.setProps(i.props),a=s):s.cleanup(this._context):s||i.setup(this._context),n.push(a),delete t[i.id]}for(const i in t)t[i].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some(i=>i instanceof E2)||this._resolvedEffects.push(LJ),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class DJ extends T2{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const kJ="deckRenderer.renderLayers";class NJ{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new DJ(e),this.pickLayersPass=new m4(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const s=t.render({...n,target:i});n.effects&&(this.lastPostProcessEffect&&(n.clearCanvas=e.clearCanvas===void 0?!0:e.clearCanvas),this._postRender(n.effects,n)),this.renderCount++,sa(kJ,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[n,i]=t;e.length===0&&[0,1].map(s=>{const a=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:n,height:i});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${s}`,colorAttachments:[a]}))});for(const s of e)s.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,i={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?t.target:void 0;const a=s.postRender(i);i.inputBuffer=a,i.swapBuffer=a===n[0]?n[1]:n[0]}}}const zJ={pickedColor:null,pickedObjectIndex:-1};function B4({pickedColors:r,decodePickingColor:e,deviceX:t,deviceY:n,deviceRadius:i,deviceRect:s}){const{x:a,y:o,width:u,height:d}=s;let p=i*i,b=-1,C=0;for(let w=0;w<d;w++){const M=w+o-n,P=M*M;if(P>p)C+=4*u;else for(let k=0;k<u;k++){if(r[C+3]-1>=0){const j=k+a-t,H=j*j+P;H<=p&&(p=H,b=C)}C+=4}}if(b>=0){const w=r.slice(b,b+4),M=e(w);if(M){const P=Math.floor(b/4/u),k=b/4-P*u;return{...M,pickedColor:w,pickedX:a+k,pickedY:o+P}}$n.error("Picked non-existent layer. Is picking buffer corrupt?")()}return zJ}function C4({pickedColors:r,decodePickingColor:e}){const t=new Map;if(r){for(let n=0;n<r.length;n+=4)if(r[n+3]-1>=0){const s=r.slice(n,n+4),a=s.join(",");if(!t.has(a)){const o=e(s);o?t.set(a,{...o,color:s}):$n.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function H2({pickInfo:r,viewports:e,pixelRatio:t,x:n,y:i,z:s}){let a=e[0];e.length>1&&(a=QJ(r?.pickedViewports||e,{x:n,y:i}));let o;if(a){const u=[n-a.x,i-a.y];s!==void 0&&(u[2]=s),o=a.unproject(u)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:n,y:i,pixel:[n,i],coordinate:o,devicePixel:r&&"pickedX"in r?[r.pickedX,r.pickedY]:void 0,pixelRatio:t}}function T4(r){const{pickInfo:e,lastPickedInfo:t,mode:n,layers:i}=r,{pickedColor:s,pickedLayer:a,pickedObjectIndex:o}=e,u=a?[a]:[];if(n==="hover"){const b=t.index,C=t.layerId,w=a?a.props.id:null;if(w!==C||o!==b){if(w!==C){const M=i.find(P=>P.props.id===C);M&&u.unshift(M)}t.layerId=w,t.index=o,t.info=null}}const d=H2(r),p=new Map;return p.set(null,d),u.forEach(b=>{let C={...d};b===a&&(C.color=s,C.index=o,C.picked=!0),C=V2({layer:b,info:C,mode:n});const w=C.layer;b===a&&n==="hover"&&(t.info=C),p.set(w.id,C),n==="hover"&&w.updateAutoHighlight(C)}),p}function V2({layer:r,info:e,mode:t}){for(;r&&e;){const n=e.layer||null;e.sourceLayer=n,e.layer=r,e=r.getPickingInfo({info:e,mode:t,sourceLayer:n}),r=r.parent}return e}function QJ(r,e){for(let t=r.length-1;t>=0;t--){const n=r[t];if(n.containsPixel(e))return n}return r[0]}class HJ{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new m4(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:n,viewports:i},s=this.lastPickedInfo.info){const a=s&&s.layer&&s.layer.id,o=s&&s.viewport&&s.viewport.id,u=a?n.find(C=>C.id===a):null,d=o&&i.find(C=>C.id===o)||i[0],p=d&&d.unproject([e-d.x,t-d.y]);return{...s,...{x:e,y:t,viewport:d,coordinate:p,layer:u}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:n,x:i,y:s,radius:a=0,depth:o=1,mode:u="query",unproject3D:d,onViewportActive:p,effects:b}){const C=this.device.canvasContext.cssToDeviceRatio(),w=this._getPickable(e);if(!w||n.length===0)return{result:[],emptyInfo:H2({viewports:n,x:i,y:s,pixelRatio:C})};this._resizeBuffer();const M=this.device.canvasContext.cssToDevicePixels([i,s],!0),P=[M.x+Math.floor(M.width/2),M.y+Math.floor(M.height/2)],k=Math.round(a*C),{width:D,height:j}=this.pickingFBO,H=this._getPickingRect({deviceX:P[0],deviceY:P[1],deviceRadius:k,deviceWidth:D,deviceHeight:j}),N={x:i-a,y:s-a,width:a*2+1,height:a*2+1};let q;const W=[],ie=new Set;for(let se=0;se<o;se++){let Z;if(H){const te=this._drawAndSample({layers:w,views:t,viewports:n,onViewportActive:p,deviceRect:H,cullRect:N,effects:b,pass:`picking:${u}`});Z=B4({...te,deviceX:P[0],deviceY:P[1],deviceRadius:k,deviceRect:H})}else Z={pickedColor:null,pickedObjectIndex:-1};let fe;if(Z.pickedLayer&&d&&this.depthFBO){const{pickedColors:te}=this._drawAndSample({layers:[Z.pickedLayer],views:t,viewports:n,onViewportActive:p,deviceRect:{x:Z.pickedX,y:Z.pickedY,width:1,height:1},cullRect:N,effects:b,pass:`picking:${u}:z`},!0);te[3]&&(fe=te[0])}Z.pickedLayer&&se+1<o&&(ie.add(Z.pickedLayer),Z.pickedLayer.disablePickingIndex(Z.pickedObjectIndex)),q=T4({pickInfo:Z,lastPickedInfo:this.lastPickedInfo,mode:u,layers:w,viewports:n,x:i,y:s,z:fe,pixelRatio:C});for(const te of q.values())te.layer&&W.push(te);if(!Z.pickedColor)break}for(const se of ie)se.restorePickingColors();return{result:W,emptyInfo:q.get(null)}}_pickClosestObject({layers:e,views:t,viewports:n,x:i,y:s,radius:a=0,depth:o=1,mode:u="query",unproject3D:d,onViewportActive:p,effects:b}){const C=this.device.canvasContext.cssToDeviceRatio(),w=this._getPickable(e);if(!w||n.length===0)return{result:[],emptyInfo:H2({viewports:n,x:i,y:s,pixelRatio:C})};this._resizeBuffer();const M=this.device.canvasContext.cssToDevicePixels([i,s],!0),P=[M.x+Math.floor(M.width/2),M.y+Math.floor(M.height/2)],k=Math.round(a*C),{width:D,height:j}=this.pickingFBO,H=this._getPickingRect({deviceX:P[0],deviceY:P[1],deviceRadius:k,deviceWidth:D,deviceHeight:j}),N={x:i-a,y:s-a,width:a*2+1,height:a*2+1};let q;const W=[],ie=new Set;for(let se=0;se<o;se++){let Z;if(H){const te=this._drawAndSample({layers:w,views:t,viewports:n,onViewportActive:p,deviceRect:H,cullRect:N,effects:b,pass:`picking:${u}`});Z=B4({...te,deviceX:P[0],deviceY:P[1],deviceRadius:k,deviceRect:H})}else Z={pickedColor:null,pickedObjectIndex:-1};let fe;if(Z.pickedLayer&&d&&this.depthFBO){const{pickedColors:te}=this._drawAndSample({layers:[Z.pickedLayer],views:t,viewports:n,onViewportActive:p,deviceRect:{x:Z.pickedX,y:Z.pickedY,width:1,height:1},cullRect:N,effects:b,pass:`picking:${u}:z`},!0);te[3]&&(fe=te[0])}Z.pickedLayer&&se+1<o&&(ie.add(Z.pickedLayer),Z.pickedLayer.disablePickingIndex(Z.pickedObjectIndex)),q=T4({pickInfo:Z,lastPickedInfo:this.lastPickedInfo,mode:u,layers:w,viewports:n,x:i,y:s,z:fe,pixelRatio:C});for(const te of q.values())te.layer&&W.push(te);if(!Z.pickedColor)break}for(const se of ie)se.restorePickingColors();return{result:W,emptyInfo:q.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:n,x:i,y:s,width:a=1,height:o=1,mode:u="query",maxObjects:d=null,onViewportActive:p,effects:b}){const C=this._getPickable(e);if(!C||n.length===0)return[];this._resizeBuffer();const w=this.device.canvasContext.cssToDeviceRatio(),M=this.device.canvasContext.cssToDevicePixels([i,s],!0),P=M.x,k=M.y+M.height,D=this.device.canvasContext.cssToDevicePixels([i+a,s+o],!0),j=D.x+D.width,H=D.y,N={x:P,y:H,width:j-P,height:k-H},q=this._drawAndSample({layers:C,views:t,viewports:n,onViewportActive:p,deviceRect:N,cullRect:{x:i,y:s,width:a,height:o},effects:b,pass:`picking:${u}`}),W=C4(q),ie=new Map,se=[],Z=Number.isFinite(d);for(let fe=0;fe<W.length&&!(Z&&se.length>=d);fe++){const te=W[fe];let ce={color:te.pickedColor,layer:null,index:te.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:w};ce=V2({layer:te.pickedLayer,info:ce,mode:u});const ve=ce.layer.id;ie.has(ve)||ie.set(ve,new Set);const me=ie.get(ve),qe=ce.object??ce.index;me.has(qe)||(me.add(qe),se.push(ce))}return se}_pickVisibleObjects({layers:e,views:t,viewports:n,x:i,y:s,width:a=1,height:o=1,mode:u="query",maxObjects:d=null,onViewportActive:p,effects:b}){const C=this._getPickable(e);if(!C||n.length===0)return[];this._resizeBuffer();const w=this.device.canvasContext.cssToDeviceRatio(),M=this.device.canvasContext.cssToDevicePixels([i,s],!0),P=M.x,k=M.y+M.height,D=this.device.canvasContext.cssToDevicePixels([i+a,s+o],!0),j=D.x+D.width,H=D.y,N={x:P,y:H,width:j-P,height:k-H},q=this._drawAndSample({layers:C,views:t,viewports:n,onViewportActive:p,deviceRect:N,cullRect:{x:i,y:s,width:a,height:o},effects:b,pass:`picking:${u}`}),W=C4(q),ie=new Map,se=[],Z=Number.isFinite(d);for(let fe=0;fe<W.length&&!(Z&&se.length>=d);fe++){const te=W[fe];let ce={color:te.pickedColor,layer:null,index:te.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:w};ce=V2({layer:te.pickedLayer,info:ce,mode:u});const ve=ce.layer.id;ie.has(ve)||ie.set(ve,new Set);const me=ie.get(ve),qe=ce.object??ce.index;me.has(qe)||(me.add(qe),se.push(ce))}return se}async _drawAndSampleAsync({layers:e,views:t,viewports:n,onViewportActive:i,deviceRect:s,cullRect:a,effects:o,pass:u},d=!1){const p=d?this.depthFBO:this.pickingFBO,b={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:i,pickingFBO:p,deviceRect:s,cullRect:a,effects:o,pass:u,pickZ:d,preRenderStats:{},isPicking:!0};for(const j of o)j.useInPicking&&(b.preRenderStats[j.id]=j.preRender(b));const{decodePickingColor:C}=this.pickLayersPass.render(b),{x:w,y:M,width:P,height:k}=s,D=new(d?Float32Array:Uint8Array)(P*k*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:w,sourceY:M,sourceWidth:P,sourceHeight:k,target:D}),{pickedColors:D,decodePickingColor:C}}_drawAndSample({layers:e,views:t,viewports:n,onViewportActive:i,deviceRect:s,cullRect:a,effects:o,pass:u},d=!1){const p=d?this.depthFBO:this.pickingFBO,b={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:i,pickingFBO:p,deviceRect:s,cullRect:a,effects:o,pass:u,pickZ:d,preRenderStats:{},isPicking:!0};for(const j of o)j.useInPicking&&(b.preRenderStats[j.id]=j.preRender(b));const{decodePickingColor:C}=this.pickLayersPass.render(b),{x:w,y:M,width:P,height:k}=s,D=new(d?Float32Array:Uint8Array)(P*k*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:w,sourceY:M,sourceWidth:P,sourceHeight:k,target:D}),{pickedColors:D,decodePickingColor:C}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:i,deviceHeight:s}){const a=Math.max(0,e-n),o=Math.max(0,t-n),u=Math.min(i,e+n+1)-a,d=Math.min(s,t+n+1)-o;return u<=0||d<=0?null:{x:a,y:o,width:u,height:d}}}const VJ={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},jJ="top-left",E4="__root";class $J{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,t?.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!Zl(e.widgets,this.widgets,1)){const t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){const n=e.reduce((i,s)=>(i[s.id]=s,i),{});for(const i of this.getWidgets()){const{viewId:s}=i;if(s){const a=n[s];a&&(i.onViewportChange&&i.onViewportChange(a),i.onRedraw?.({viewports:[a],layers:t}))}else{if(i.onViewportChange)for(const a of e)i.onViewportChange(a);i.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=n,this._updateContainers()}onHover(e,t){for(const n of this.getWidgets()){const{viewId:i}=n;(!i||i===e.viewport?.id)&&n.onHover?.(e,t)}}onEvent(e,t){const n=g2[t.type];if(n)for(const i of this.getWidgets()){const{viewId:s}=i;(!s||s===e.viewport?.id)&&i[n]?.(e,t)}}_setWidgets(e){const t={};for(const n of this.resolvedWidgets)t[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)t[n.id]=null,this.resolvedWidgets.push(n);for(let n of e){const i=t[n.id];i?i.viewId!==n.viewId||i.placement!==n.placement?(this._removeWidget(i),this._addWidget(n)):n!==i&&(i.setProps(n.props),n=i):this._addWidget(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const n in t){const i=t[n];i&&this._removeWidget(i)}this.widgets=e}_addWidget(e){const{viewId:t=null,placement:n=jJ}=e;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(t,n).append(e.rootElement),e.updateHTML()}_removeWidget(e){e.onRemove?.(),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){const n=e||E4;let i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[n]=i);let s=i.querySelector(`.${t}`);return s||(s=globalThis.document.createElement("div"),s.className=t,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,VJ[t]),i.append(s)),s}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,s=n===E4||i,a=this.containers[n];s?(a.style.display="block",a.style.left=`${i?i.x:0}px`,a.style.top=`${i?i.y:0}px`,a.style.width=`${i?i.width:e}px`,a.style.height=`${i?i.height:t}px`):a.style.display="none"}}}function S4(r,e){e&&Object.entries(e).map(([t,n])=>{t.startsWith("--")?r.style.setProperty(t,n):r.style[t]=n})}function GJ(r,e){e&&Object.keys(e).map(t=>{t.startsWith("--")?r.style.removeProperty(t):r.style[t]=""})}class j2{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const t=this.props,n=this.rootElement;n&&t.className!==e.className&&(t.className&&n.classList.remove(t.className),e.className&&n.classList.add(e.className)),n&&!Zl(t.style,e.style,1)&&(GJ(n,t.style),S4(n,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(n=>typeof n=="string"&&n.length>0).forEach(n=>t.classList.add(n)),S4(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}j2.defaultProps={id:"widget",style:{},className:""};const WJ={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class I4 extends j2{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,WJ),e}onRenderHTML(e){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const i=n(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,n){const i=this.rootElement;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${n}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}I4.defaultProps={...j2.defaultProps};var Ip;(function(r){r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",r[r.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.CULL_FACE=2884]="CULL_FACE",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.BLEND=3042]="BLEND",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.DITHER=3024]="DITHER",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DOUBLE=5130]="DOUBLE",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",r[r.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",r[r.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.READ_BUFFER=3074]="READ_BUFFER",r[r.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",r[r.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",r[r.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",r[r.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",r[r.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",r[r.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",r[r.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",r[r.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",r[r.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",r[r.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",r[r.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",r[r.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",r[r.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",r[r.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",r[r.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",r[r.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",r[r.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",r[r.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",r[r.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",r[r.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",r[r.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",r[r.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",r[r.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",r[r.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",r[r.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",r[r.RED=6403]="RED",r[r.RGB8=32849]="RGB8",r[r.RGBA8=32856]="RGBA8",r[r.RGB10_A2=32857]="RGB10_A2",r[r.TEXTURE_3D=32879]="TEXTURE_3D",r[r.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",r[r.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",r[r.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",r[r.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",r[r.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",r[r.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",r[r.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",r[r.SRGB=35904]="SRGB",r[r.SRGB8=35905]="SRGB8",r[r.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",r[r.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",r[r.RGBA32F=34836]="RGBA32F",r[r.RGB32F=34837]="RGB32F",r[r.RGBA16F=34842]="RGBA16F",r[r.RGB16F=34843]="RGB16F",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",r[r.R11F_G11F_B10F=35898]="R11F_G11F_B10F",r[r.RGB9_E5=35901]="RGB9_E5",r[r.RGBA32UI=36208]="RGBA32UI",r[r.RGB32UI=36209]="RGB32UI",r[r.RGBA16UI=36214]="RGBA16UI",r[r.RGB16UI=36215]="RGB16UI",r[r.RGBA8UI=36220]="RGBA8UI",r[r.RGB8UI=36221]="RGB8UI",r[r.RGBA32I=36226]="RGBA32I",r[r.RGB32I=36227]="RGB32I",r[r.RGBA16I=36232]="RGBA16I",r[r.RGB16I=36233]="RGB16I",r[r.RGBA8I=36238]="RGBA8I",r[r.RGB8I=36239]="RGB8I",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.R8=33321]="R8",r[r.RG8=33323]="RG8",r[r.R16F=33325]="R16F",r[r.R32F=33326]="R32F",r[r.RG16F=33327]="RG16F",r[r.RG32F=33328]="RG32F",r[r.R8I=33329]="R8I",r[r.R8UI=33330]="R8UI",r[r.R16I=33331]="R16I",r[r.R16UI=33332]="R16UI",r[r.R32I=33333]="R32I",r[r.R32UI=33334]="R32UI",r[r.RG8I=33335]="RG8I",r[r.RG8UI=33336]="RG8UI",r[r.RG16I=33337]="RG16I",r[r.RG16UI=33338]="RG16UI",r[r.RG32I=33339]="RG32I",r[r.RG32UI=33340]="RG32UI",r[r.R8_SNORM=36756]="R8_SNORM",r[r.RG8_SNORM=36757]="RG8_SNORM",r[r.RGB8_SNORM=36758]="RGB8_SNORM",r[r.RGBA8_SNORM=36759]="RGBA8_SNORM",r[r.RGB10_A2UI=36975]="RGB10_A2UI",r[r.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",r[r.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.HALF_FLOAT=5131]="HALF_FLOAT",r[r.RG=33319]="RG",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",r[r.CURRENT_QUERY=34917]="CURRENT_QUERY",r[r.QUERY_RESULT=34918]="QUERY_RESULT",r[r.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",r[r.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",r[r.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",r[r.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",r[r.DRAW_BUFFER0=34853]="DRAW_BUFFER0",r[r.DRAW_BUFFER1=34854]="DRAW_BUFFER1",r[r.DRAW_BUFFER2=34855]="DRAW_BUFFER2",r[r.DRAW_BUFFER3=34856]="DRAW_BUFFER3",r[r.DRAW_BUFFER4=34857]="DRAW_BUFFER4",r[r.DRAW_BUFFER5=34858]="DRAW_BUFFER5",r[r.DRAW_BUFFER6=34859]="DRAW_BUFFER6",r[r.DRAW_BUFFER7=34860]="DRAW_BUFFER7",r[r.DRAW_BUFFER8=34861]="DRAW_BUFFER8",r[r.DRAW_BUFFER9=34862]="DRAW_BUFFER9",r[r.DRAW_BUFFER10=34863]="DRAW_BUFFER10",r[r.DRAW_BUFFER11=34864]="DRAW_BUFFER11",r[r.DRAW_BUFFER12=34865]="DRAW_BUFFER12",r[r.DRAW_BUFFER13=34866]="DRAW_BUFFER13",r[r.DRAW_BUFFER14=34867]="DRAW_BUFFER14",r[r.DRAW_BUFFER15=34868]="DRAW_BUFFER15",r[r.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",r[r.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",r[r.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",r[r.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",r[r.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",r[r.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",r[r.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",r[r.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",r[r.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",r[r.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",r[r.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",r[r.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",r[r.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",r[r.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",r[r.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",r[r.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",r[r.SAMPLER_3D=35679]="SAMPLER_3D",r[r.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",r[r.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",r[r.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",r[r.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",r[r.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",r[r.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",r[r.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",r[r.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",r[r.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",r[r.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",r[r.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",r[r.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",r[r.MAX_SAMPLES=36183]="MAX_SAMPLES",r[r.SAMPLER_BINDING=35097]="SAMPLER_BINDING",r[r.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",r[r.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",r[r.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",r[r.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",r[r.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",r[r.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",r[r.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",r[r.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",r[r.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",r[r.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",r[r.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",r[r.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",r[r.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",r[r.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",r[r.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",r[r.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",r[r.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",r[r.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",r[r.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",r[r.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",r[r.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",r[r.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",r[r.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",r[r.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",r[r.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",r[r.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",r[r.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",r[r.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",r[r.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",r[r.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",r[r.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",r[r.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",r[r.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",r[r.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",r[r.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",r[r.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",r[r.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",r[r.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",r[r.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",r[r.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",r[r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r[r.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",r[r.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",r[r.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",r[r.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",r[r.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",r[r.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",r[r.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",r[r.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",r[r.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",r[r.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",r[r.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",r[r.UNIFORM_TYPE=35383]="UNIFORM_TYPE",r[r.UNIFORM_SIZE=35384]="UNIFORM_SIZE",r[r.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",r[r.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",r[r.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",r[r.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",r[r.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",r[r.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",r[r.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",r[r.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",r[r.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",r[r.OBJECT_TYPE=37138]="OBJECT_TYPE",r[r.SYNC_CONDITION=37139]="SYNC_CONDITION",r[r.SYNC_STATUS=37140]="SYNC_STATUS",r[r.SYNC_FLAGS=37141]="SYNC_FLAGS",r[r.SYNC_FENCE=37142]="SYNC_FENCE",r[r.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",r[r.UNSIGNALED=37144]="UNSIGNALED",r[r.SIGNALED=37145]="SIGNALED",r[r.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",r[r.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",r[r.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",r[r.WAIT_FAILED=37149]="WAIT_FAILED",r[r.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",r[r.COLOR=6144]="COLOR",r[r.DEPTH=6145]="DEPTH",r[r.STENCIL=6146]="STENCIL",r[r.MIN=32775]="MIN",r[r.MAX=32776]="MAX",r[r.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",r[r.STREAM_READ=35041]="STREAM_READ",r[r.STREAM_COPY=35042]="STREAM_COPY",r[r.STATIC_READ=35045]="STATIC_READ",r[r.STATIC_COPY=35046]="STATIC_COPY",r[r.DYNAMIC_READ=35049]="DYNAMIC_READ",r[r.DYNAMIC_COPY=35050]="DYNAMIC_COPY",r[r.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",r[r.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",r[r.INVALID_INDEX=4294967295]="INVALID_INDEX",r[r.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",r[r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",r[r.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",r[r.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",r[r.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",r[r.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",r[r.R16_EXT=33322]="R16_EXT",r[r.RG16_EXT=33324]="RG16_EXT",r[r.RGB16_EXT=32852]="RGB16_EXT",r[r.RGBA16_EXT=32859]="RGBA16_EXT",r[r.R16_SNORM_EXT=36760]="R16_SNORM_EXT",r[r.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",r[r.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",r[r.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",r[r.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",r[r.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",r[r.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",r[r.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",r[r.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",r[r.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",r[r.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",r[r.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",r[r.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",r[r.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",r[r.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",r[r.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",r[r.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",r[r.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",r[r.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",r[r.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",r[r.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",r[r.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",r[r.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",r[r.LINE_WEBGL=6913]="LINE_WEBGL",r[r.FILL_WEBGL=6914]="FILL_WEBGL",r[r.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",r[r.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",r[r.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",r[r.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",r[r.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",r[r.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",r[r.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",r[r.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",r[r.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",r[r.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",r[r.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",r[r.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",r[r.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",r[r.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",r[r.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",r[r.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",r[r.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",r[r.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",r[r.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",r[r.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",r[r.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",r[r.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",r[r.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",r[r.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Ip||(Ip={}));const qJ={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},KJ=r=>({drawBuffersWEBGL(e){return r.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),XJ=r=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return r.createVertexArray()},deleteVertexArrayOES(e){return r.deleteVertexArray(e)},isVertexArrayOES(e){return r.isVertexArray(e)},bindVertexArrayOES(e){return r.bindVertexArray(e)}}),YJ=r=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return r.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return r.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return r.vertexAttribDivisor(...e)}});function ZJ(r=!0){const e=HTMLCanvasElement.prototype;if(!r&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,n){if(t==="webgl"||t==="experimental-webgl"){const i=this.originalGetContext("webgl2",n);return i instanceof HTMLElement&&JJ(i),i}return this.originalGetContext(t,n)}}function JJ(r){r.getExtension("EXT_color_buffer_float");const e={...qJ,WEBGL_disjoint_timer_query:r.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:KJ(r),OES_vertex_array_object:XJ(r),ANGLE_instanced_arrays:YJ(r)},t=r.getExtension;r.getExtension=function(i){const s=t.call(r,i);return s||(i in e?e[i]:null)};const n=r.getSupportedExtensions;r.getSupportedExtensions=function(){return(n.apply(r)||[])?.concat(Object.keys(e))}}async function P4(r,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",r),new Promise((i,s)=>{n.onload=i,n.onerror=a=>s(new Error(`Unable to load script '${r}': ${a}`)),t.appendChild(n)})}const eee=1;let wl=null,M4=!1;const $2={debugSpectorJS:Xt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function tee(r){if(!globalThis.SPECTOR)try{await P4(r.debugSpectorJSUrl||$2.debugSpectorJSUrl)}catch(e){Xt.warn(String(e))}}function ree(r){if(r={...$2,...r},!r.debugSpectorJS)return null;if(!wl&&globalThis.SPECTOR&&!globalThis.luma?.spector){Xt.probe(eee,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;wl=new e,globalThis.luma&&(globalThis.luma.spector=wl)}if(!wl)return null;if(M4||(M4=!0,wl.spyCanvases(),wl?.onCaptureStarted.add(e=>Xt.info("Spector capture started:",e)()),wl?.onCapture.add(e=>{Xt.info("Spector capture complete:",e)(),wl?.getResultUI(),wl?.resultView.display(),wl?.resultView.addCapture(e)})),r.gl){const e=r.gl,t=e.device;wl?.startCapture(r.gl,500),e.device=t,new Promise(n=>setTimeout(n,2e3)).then(n=>{Xt.info("Spector capture stopped after 2 seconds")(),wl?.stopCapture()})}return wl}const nee="https://unpkg.com/webgl-debug@2.0.1/index.js";function F4(r){return r.luma=r.luma||{},r.luma}async function iee(){Ff()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await P4(nee))}function see(r,e={}){return e.debugWebGL||e.traceWebGL?aee(r,e):oee(r)}function oee(r){const e=F4(r);return e.realContext?e.realContext:r}function aee(r,e){if(!globalThis.WebGLDebugUtils)return Xt.warn("webgl-debug not loaded")(),r;const t=F4(r);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...Ip,...r});const n=globalThis.WebGLDebugUtils.makeDebugContext(r,lee.bind(null,e),cee.bind(null,e));for(const a in Ip)!(a in n)&&typeof Ip[a]=="number"&&(n[a]=Ip[a]);class i{}Object.setPrototypeOf(n,Object.getPrototypeOf(r)),Object.setPrototypeOf(i,n);const s=Object.create(i);return t.realContext=r,t.debugContext=s,s.debug=!0,s}function R4(r,e){e=Array.from(e).map(n=>n===void 0?"undefined":n);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${r}(${t})`}function lee(r,e,t,n){n=Array.from(n).map(o=>o===void 0?"undefined":o);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,n),a=`${i} in gl.${t}(${s})`;Xt.error(a)();debugger}function cee(r,e,t){let n="";Xt.level>=1&&(n=R4(e,t),r.traceWebGL&&Xt.log(1,n)());for(const i of t)if(i===void 0){n=n||R4(e,t);debugger}}const C0=1;class uee extends MW{type="webgl";constructor(){super(),Df.defaultProps={...Df.defaultProps,...$2}}enforceWebGL2(e){ZJ(e)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&e instanceof WebGLRenderingContext&&Xt.warn("WebGL1 is not supported",e)(),!1)}async attach(e,t={}){const{WebGLDevice:n}=await Promise.resolve().then(()=>iF);if(e instanceof n)return e;if(e?.device instanceof n)return e.device;if(!hee(e))throw new Error("Invalid WebGL2RenderingContext");const i=t.createCanvasContext===!0?{}:t.createCanvasContext;return new n({...t,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...i}})}async create(e={}){const{WebGLDevice:t}=await Promise.resolve().then(()=>iF);Xt.groupCollapsed(C0,"WebGLDevice created")();try{const n=[];(e.debugWebGL||e.debug)&&n.push(iee()),e.debugSpectorJS&&n.push(tee(e));const i=await Promise.allSettled(n);for(const o of i)o.status==="rejected"&&Xt.error(`Failed to initialize debug libraries ${o.reason}`)();const s=new t(e),a=`${s._reused?"Reusing":"Created"} device with WebGL2 ${s.props.debug?"debug ":""}context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return Xt.probe(C0,a)(),Xt.table(C0,s.info)(),s}finally{Xt.groupEnd(C0)()}}}function hee(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}const G2=new uee,W2={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Zs=(r,e,t)=>e?r.enable(t):r.disable(t),L4=(r,e,t)=>r.hint(t,e),xl=(r,e,t)=>r.pixelStorei(t,e),O4=(r,e,t)=>{const n=t===36006?36009:36008;return r.bindFramebuffer(n,e)},Em=(r,e,t)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];r.bindBuffer(i,e)};function q2(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}const Aee={3042:Zs,32773:(r,e)=>r.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,e)=>r.clearColor(...e),3107:(r,e)=>r.colorMask(...e),2884:Zs,2885:(r,e)=>r.cullFace(e),2929:Zs,2931:(r,e)=>r.clearDepth(e),2932:(r,e)=>r.depthFunc(e),2928:(r,e)=>r.depthRange(...e),2930:(r,e)=>r.depthMask(e),3024:Zs,35723:L4,35725:(r,e)=>r.useProgram(e),36007:(r,e)=>r.bindRenderbuffer(36161,e),36389:(r,e)=>r.bindTransformFeedback?.(36386,e),34229:(r,e)=>r.bindVertexArray(e),36006:O4,36010:O4,34964:Em,36662:Em,36663:Em,35053:Em,35055:Em,2886:(r,e)=>r.frontFace(e),33170:L4,2849:(r,e)=>r.lineWidth(e),32823:Zs,32824:"polygonOffset",10752:"polygonOffset",35977:Zs,32926:Zs,32928:Zs,32938:"sampleCoverage",32939:"sampleCoverage",3089:Zs,3088:(r,e)=>r.scissor(...e),2960:Zs,2961:(r,e)=>r.clearStencil(e),2968:(r,e)=>r.stencilMaskSeparate(1028,e),36005:(r,e)=>r.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,e)=>r.viewport(...e),34383:Zs,10754:Zs,12288:Zs,12289:Zs,12290:Zs,12291:Zs,12292:Zs,12293:Zs,12294:Zs,12295:Zs,3333:xl,3317:xl,37440:xl,37441:xl,37443:xl,3330:xl,3332:xl,3331:xl,3314:xl,32878:xl,3316:xl,3315:xl,32877:xl,framebuffer:(r,e)=>{const t=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,t)},blend:(r,e)=>e?r.enable(3042):r.disable(3042),blendColor:(r,e)=>r.blendColor(...e),blendEquation:(r,e)=>{const t=typeof e=="number"?[e,e]:e;r.blendEquationSeparate(...t)},blendFunc:(r,e)=>{const t=e?.length===2?[...e,...e]:e;r.blendFuncSeparate(...t)},clearColor:(r,e)=>r.clearColor(...e),clearDepth:(r,e)=>r.clearDepth(e),clearStencil:(r,e)=>r.clearStencil(e),colorMask:(r,e)=>r.colorMask(...e),cull:(r,e)=>e?r.enable(2884):r.disable(2884),cullFace:(r,e)=>r.cullFace(e),depthTest:(r,e)=>e?r.enable(2929):r.disable(2929),depthFunc:(r,e)=>r.depthFunc(e),depthMask:(r,e)=>r.depthMask(e),depthRange:(r,e)=>r.depthRange(...e),dither:(r,e)=>e?r.enable(3024):r.disable(3024),derivativeHint:(r,e)=>{r.hint(35723,e)},frontFace:(r,e)=>r.frontFace(e),mipmapHint:(r,e)=>r.hint(33170,e),lineWidth:(r,e)=>r.lineWidth(e),polygonOffsetFill:(r,e)=>e?r.enable(32823):r.disable(32823),polygonOffset:(r,e)=>r.polygonOffset(...e),sampleCoverage:(r,e)=>r.sampleCoverage(e[0],e[1]||!1),scissorTest:(r,e)=>e?r.enable(3089):r.disable(3089),scissor:(r,e)=>r.scissor(...e),stencilTest:(r,e)=>e?r.enable(2960):r.disable(2960),stencilMask:(r,e)=>{e=q2(e)?e:[e,e];const[t,n]=e;r.stencilMaskSeparate(1028,t),r.stencilMaskSeparate(1029,n)},stencilFunc:(r,e)=>{e=q2(e)&&e.length===3?[...e,...e]:e;const[t,n,i,s,a,o]=e;r.stencilFuncSeparate(1028,t,n,i),r.stencilFuncSeparate(1029,s,a,o)},stencilOp:(r,e)=>{e=q2(e)&&e.length===3?[...e,...e]:e;const[t,n,i,s,a,o]=e;r.stencilOpSeparate(1028,t,n,i),r.stencilOpSeparate(1029,s,a,o)},viewport:(r,e)=>r.viewport(...e)};function ws(r,e,t){return e[r]!==void 0?e[r]:t[r]}const fee={blendEquation:(r,e,t)=>r.blendEquationSeparate(ws(32777,e,t),ws(34877,e,t)),blendFunc:(r,e,t)=>r.blendFuncSeparate(ws(32969,e,t),ws(32968,e,t),ws(32971,e,t),ws(32970,e,t)),polygonOffset:(r,e,t)=>r.polygonOffset(ws(32824,e,t),ws(10752,e,t)),sampleCoverage:(r,e,t)=>r.sampleCoverage(ws(32938,e,t),ws(32939,e,t)),stencilFuncFront:(r,e,t)=>r.stencilFuncSeparate(1028,ws(2962,e,t),ws(2967,e,t),ws(2963,e,t)),stencilFuncBack:(r,e,t)=>r.stencilFuncSeparate(1029,ws(34816,e,t),ws(36003,e,t),ws(36004,e,t)),stencilOpFront:(r,e,t)=>r.stencilOpSeparate(1028,ws(2964,e,t),ws(2965,e,t),ws(2966,e,t)),stencilOpBack:(r,e,t)=>r.stencilOpSeparate(1029,ws(34817,e,t),ws(34818,e,t),ws(34819,e,t))},U4={enable:(r,e)=>r({[e]:!0}),disable:(r,e)=>r({[e]:!1}),pixelStorei:(r,e,t)=>r({[e]:t}),hint:(r,e,t)=>r({[e]:t}),useProgram:(r,e)=>r({35725:e}),bindRenderbuffer:(r,e,t)=>r({36007:t}),bindTransformFeedback:(r,e,t)=>r({36389:t}),bindVertexArray:(r,e)=>r({34229:e}),bindFramebuffer:(r,e,t)=>{switch(e){case 36160:return r({36006:t,36010:t});case 36009:return r({36006:t});case 36008:return r({36010:t});default:return null}},bindBuffer:(r,e,t)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return n?r({[n]:t}):{valueChanged:!0}},blendColor:(r,e,t,n,i)=>r({32773:new Float32Array([e,t,n,i])}),blendEquation:(r,e)=>r({32777:e,34877:e}),blendEquationSeparate:(r,e,t)=>r({32777:e,34877:t}),blendFunc:(r,e,t)=>r({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(r,e,t,n,i)=>r({32969:e,32968:t,32971:n,32970:i}),clearColor:(r,e,t,n,i)=>r({3106:new Float32Array([e,t,n,i])}),clearDepth:(r,e)=>r({2931:e}),clearStencil:(r,e)=>r({2961:e}),colorMask:(r,e,t,n,i)=>r({3107:[e,t,n,i]}),cullFace:(r,e)=>r({2885:e}),depthFunc:(r,e)=>r({2932:e}),depthRange:(r,e,t)=>r({2928:new Float32Array([e,t])}),depthMask:(r,e)=>r({2930:e}),frontFace:(r,e)=>r({2886:e}),lineWidth:(r,e)=>r({2849:e}),polygonOffset:(r,e,t)=>r({32824:e,10752:t}),sampleCoverage:(r,e,t)=>r({32938:e,32939:t}),scissor:(r,e,t,n,i)=>r({3088:new Int32Array([e,t,n,i])}),stencilMask:(r,e)=>r({2968:e,36005:e}),stencilMaskSeparate:(r,e,t)=>r({[e===1028?2968:36005]:t}),stencilFunc:(r,e,t,n)=>r({2962:e,2967:t,2963:n,34816:e,36003:t,36004:n}),stencilFuncSeparate:(r,e,t,n,i)=>r({[e===1028?2962:34816]:t,[e===1028?2967:36003]:n,[e===1028?2963:36004]:i}),stencilOp:(r,e,t,n)=>r({2964:e,2965:t,2966:n,34817:e,34818:t,34819:n}),stencilOpSeparate:(r,e,t,n,i)=>r({[e===1028?2964:34817]:t,[e===1028?2965:34818]:n,[e===1028?2966:34819]:i}),viewport:(r,e,t,n,i)=>r({2978:[e,t,n,i]})},Nu=(r,e)=>r.isEnabled(e),D4={3042:Nu,2884:Nu,2929:Nu,3024:Nu,32823:Nu,32926:Nu,32928:Nu,3089:Nu,2960:Nu,35977:Nu},dee=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Pp(r,e){if(gee(e))return;const t={};for(const i in e){const s=Number(i),a=Aee[i];a&&(typeof a=="string"?t[a]=!0:a(r,e[i],s))}const n=r.state&&r.state.cache;if(n)for(const i in t){const s=fee[i];s(r,e,n)}}function k4(r,e=W2){if(typeof e=="number"){const i=e,s=D4[i];return s?s(r,i):r.getParameter(i)}const t=Array.isArray(e)?e:Object.keys(e),n={};for(const i of t){const s=D4[i];n[i]=s?s(r,Number(i)):r.getParameter(Number(i))}return n}function pee(r){Pp(r,W2)}function gee(r){for(const e in r)return!1;return!0}function mee(r,e){if(r===e)return!0;if(N4(r)&&N4(e)&&r.length===e.length){for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}return!1}function N4(r){return Array.isArray(r)||ArrayBuffer.isView(r)}class Yf{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Pp(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t?.copyState?k4(e):Object.assign({},W2),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,yee(e);for(const n in U4){const i=U4[n];_ee(e,n,i)}z4(e,"getParameter"),z4(e,"isEnabled")}_updateCache(e){let t=!1,n;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const a=e[s],o=this.cache[s];mee(a,o)||(t=!0,n=o,i&&!(s in i)&&(i[s]=o),this.cache[s]=a)}return{valueChanged:t,oldValue:n}}}function z4(r,e){const t=r[e].bind(r);r[e]=function(i){if(i===void 0||dee.has(i))return t(i);const s=Yf.get(r);return i in s.cache||(s.cache[i]=t(i)),s.enable?s.cache[i]:t(i)},Object.defineProperty(r[e],"name",{value:`${e}-from-cache`,configurable:!1})}function _ee(r,e,t){if(!r[e])return;const n=r[e].bind(r);r[e]=function(...s){const a=Yf.get(r),{valueChanged:o,oldValue:u}=t(a._updateCache,...s);return o&&n(...s),u},Object.defineProperty(r[e],"name",{value:`${e}-to-cache`,configurable:!1})}function yee(r){const e=r.useProgram.bind(r);r.useProgram=function(n){const i=Yf.get(r);i.program!==n&&(e(n),i.program=n)}}function bee(r,e,t){let n="";const i={preserveDrawingBuffer:!0,...t};let s=null;if(s||=r.getContext("webgl2",i),i.failIfMajorPerformanceCaveat&&(n||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!s&&!t.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=r.getContext("webgl2",i),s.luma||={},s.luma.softwareRenderer=!0),s||(s=r.getContext("webgl",{}),s&&(s=null,n||="Your browser only supports WebGL1")),!s)throw n||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:a,onContextRestored:o}=e;return r.addEventListener("webglcontextlost",u=>a(u),!1),r.addEventListener("webglcontextrestored",u=>o(u),!1),s.luma||={},s}function Mp(r,e,t){return t[e]===void 0&&(t[e]=r.getExtension(e)||null),t[e]}function vee(r,e){const t=r.getParameter(7936),n=r.getParameter(7937);Mp(r,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=r.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),a=r.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),o=s||t,u=a||n,d=r.getParameter(7938),p=Q4(o,u),b=wee(o,u),C=xee(o,u);return{type:"webgl",gpu:p,gpuType:C,gpuBackend:b,vendor:o,renderer:u,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function Q4(r,e){return/NVIDIA/i.exec(r)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(r)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(r)||/Apple/i.exec(e)?"apple":/AMD/i.exec(r)||/AMD/i.exec(e)||/ATI/i.exec(r)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e)?"software":"unknown"}function wee(r,e){return/Metal/i.exec(r)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(r)||/ANGLE/i.exec(e)?"opengl":"unknown"}function xee(r,e){if(/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e))return"cpu";switch(Q4(r,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function H4(r){switch(r){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(r))}const Sm="WEBGL_compressed_texture_s3tc",Im="WEBGL_compressed_texture_s3tc_srgb",Fp="EXT_texture_compression_rgtc",Rp="EXT_texture_compression_bptc",Bee="WEBGL_compressed_texture_etc",Cee="WEBGL_compressed_texture_astc",Tee="WEBGL_compressed_texture_etc1",Eee="WEBGL_compressed_texture_pvrtc",See="WEBGL_compressed_texture_atc",V4="EXT_texture_norm16",j4="EXT_render_snorm",Iee="EXT_color_buffer_float",K2={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[j4],"norm16-renderable-webgl":[V4],"snorm16-renderable-webgl":[V4,j4],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Sm,Im,Fp,Rp],"texture-compression-bc5-webgl":[Fp],"texture-compression-bc7-webgl":[Rp],"texture-compression-etc2":[Bee],"texture-compression-astc":[Cee],"texture-compression-etc1-webgl":[Tee],"texture-compression-pvrtc-webgl":[Eee],"texture-compression-atc-webgl":[See]};function Pee(r){return r in K2}function Mee(r,e,t){return(K2[e]||[]).every(i=>Mp(r,i,t))}const X2={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:Iee,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Sm},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Im},"bc1-rgba-unorm":{gl:33777,x:Sm},"bc1-rgba-unorm-srgb":{gl:35916,x:Im},"bc2-rgba-unorm":{gl:33778,x:Sm},"bc2-rgba-unorm-srgb":{gl:35918,x:Im},"bc3-rgba-unorm":{gl:33779,x:Sm},"bc3-rgba-unorm-srgb":{gl:35919,x:Im},"bc4-r-unorm":{gl:36283,x:Fp},"bc4-r-snorm":{gl:36284,x:Fp},"bc5-rg-unorm":{gl:36285,x:Fp},"bc5-rg-snorm":{gl:36286,x:Fp},"bc6h-rgb-ufloat":{gl:36495,x:Rp},"bc6h-rgb-float":{gl:36494,x:Rp},"bc7-rgba-unorm":{gl:36492,x:Rp},"bc7-rgba-unorm-srgb":{gl:36493,x:Rp},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function Fee(r,e,t){let n=e.create;const i=X2[e.format];return i?.gl===void 0&&(n=!1),i?.x&&(n=n&&!!Mp(r,i.x,t)),{format:e.format,create:n&&e.create,render:n&&e.render,filter:n&&e.filter,blend:n&&e.blend,store:n&&e.store}}function $4(r){const e=X2[r],t=Oee(r),n=hp.getInfo(r);return n.compressed&&(e.dataFormat=t),{internalFormat:t,format:e?.dataFormat||Lee(n.channels,n.integer,n.normalized,t),type:n.dataType?H4(n.dataType):e?.types?.[0]||5121,compressed:n.compressed||!1}}function Ree(r){switch(hp.getInfo(r).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${r}`)}}function Lee(r,e,t,n){if(n===6408||n===6407)return n;switch(r){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function Oee(r){const t=X2[r]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${r}`);return t}const G4={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class Uee extends IW{gl;extensions;testedFeatures=new Set;constructor(e,t,n){super([],n),this.gl=e,this.extensions=t,Mp(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),Pee(e)&&Mee(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(t=>t!=="polygon-mode-webgl");for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(G4),...Object.keys(K2)]}getWebGLFeature(e){const t=G4[e];return typeof t=="string"?!!Mp(this.gl,t,this.extensions):!!t}}class Dee extends SW{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Pm extends $y{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const n=t.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const n=this.colorAttachments[t];if(n){const i=36064+t;this._attachTextureView(i,n)}}if(this.depthStencilAttachment){const t=Ree(this.depthStencilAttachment.props.format);this._attachTextureView(t,this.depthStencilAttachment)}if(this.device.props.debug){const t=this.gl.checkFramebufferStatus(36160);if(t!==36053)throw new Error(`Framebuffer ${Nee(t)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:n}=this.device,{texture:i}=t,s=t.props.baseMipLevel,a=t.props.baseArrayLayer;switch(n.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,e,i.handle,s,a);break;case 34067:const o=kee(a);n.framebufferTexture2D(36160,e,o,i.handle,s);break;case 3553:n.framebufferTexture2D(36160,e,3553,i.handle,s);break;default:throw new Error("Illegal texture type")}n.bindTexture(i.glTarget,null)}}function kee(r){return r<34069?r+34069:r}function Nee(r){switch(r){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${r}`}}class zee extends kf{device;handle=null;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new Pm(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const Y2={};function Qee(r="id"){Y2[r]=Y2[r]||1;const e=Y2[r]++;return`${r}-${e}`}class Mm extends bs{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength=0;bytesUsed=0;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const n=typeof t=="object"?t.handle:void 0;this.handle=n||this.gl.createBuffer(),e._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=Hee(this.props.usage),this.glUsage=Vee(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(e,t=0,n=e.byteLength+t){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,t,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){let t=e;e===0&&(t=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}write(e,t=0){const n=ArrayBuffer.isView(e)?e:new Uint8Array(e),i=36663;this.gl.bindBuffer(i,this.handle),this.gl.bufferSubData(i,t,n),this.gl.bindBuffer(i,null),this._setDebugData(e,t,e.byteLength)}async mapAndWriteAsync(e,t=0,n=this.byteLength-t){const i=new ArrayBuffer(n);await e(i,"copied"),this.write(i,t)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}async mapAndReadAsync(e,t=0,n){const i=await this.readAsync(t,n);return await e(i.buffer,"copied")}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const n=new Uint8Array(t),i=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,i,t),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,t),n}}function Hee(r){return r&bs.INDEX?34963:r&bs.VERTEX?34962:r&bs.UNIFORM?35345:34962}function Vee(r){return r&bs.INDEX||r&bs.VERTEX?35044:r&bs.UNIFORM?35048:35044}function jee(r){const e=r.split(/\r?\n/),t=[];for(const n of e){if(n.length<=1)continue;const i=n.split(":");if(i.length===2){const[b,C]=i;t.push({message:C.trim(),type:W4(b),lineNum:0,linePos:0});continue}const[s,a,o,...u]=i;let d=parseInt(o,10);isNaN(d)&&(d=0);let p=parseInt(a,10);isNaN(p)&&(p=0),t.push({message:u.join(":").trim(),type:W4(s),lineNum:d,linePos:p})}return t}function W4(r){const e=["warning","error","info"],t=r.toLowerCase();return e.includes(t)?t:"info"}class $ee extends jy{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?jee(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Xt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Xt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async i=>await new Promise(s=>setTimeout(s,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function Gee(r,e,t,n){if(Xee(e))return n(r);const i=r;i.pushState();try{return Wee(r,e),Pp(i.gl,t),n(r)}finally{i.popState()}}function Wee(r,e){const t=r,{gl:n}=t;if(e.cullMode)switch(e.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(e.frontFace&&n.frontFace(Zf("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&r.features.has("depth-clip-control")&&n.enable(34383),e.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&r.features.has("provoking-vertex-webgl")){const s=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,a=Zf("provokingVertex",e.provokingVertex,{first:36429,last:36430});s?.provokingVertexWEBGL(a)}if((e.polygonMode||e.polygonOffsetLine)&&r.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,a=Zf("polygonMode",e.polygonMode,{fill:6914,line:6913});s?.polygonModeWEBGL(1028,a),s?.polygonModeWEBGL(1029,a)}e.polygonOffsetLine&&n.enable(10754)}if(r.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&n.enable(12288),e.clipDistance1&&n.enable(12289),e.clipDistance2&&n.enable(12290),e.clipDistance3&&n.enable(12291),e.clipDistance4&&n.enable(12292),e.clipDistance5&&n.enable(12293),e.clipDistance6&&n.enable(12294),e.clipDistance7&&n.enable(12295)),e.depthWriteEnabled!==void 0&&n.depthMask(Kee("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(Z2("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;n.stencilMaskSeparate(1028,i),n.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&Xt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=Z2("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,s,0,i),n.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=J2("stencilPassOperation",e.stencilPassOperation),s=J2("stencilFailOperation",e.stencilFailOperation),a=J2("stencilDepthFailOperation",e.stencilDepthFailOperation);n.stencilOpSeparate(1028,s,a,i),n.stencilOpSeparate(1029,s,a,i)}switch(e.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=q4("blendColorOperation",e.blendColorOperation||"add"),s=q4("blendAlphaOperation",e.blendAlphaOperation||"add");n.blendEquationSeparate(i,s);const a=T0("blendColorSrcFactor",e.blendColorSrcFactor||"one"),o=T0("blendColorDstFactor",e.blendColorDstFactor||"zero"),u=T0("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=T0("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");n.blendFuncSeparate(a,o,u,d)}}function Z2(r,e){return Zf(r,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function J2(r,e){return Zf(r,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function q4(r,e){return Zf(r,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function T0(r,e,t="color"){return Zf(r,e,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:t==="color"?32769:32771,"one-minus-constant":t==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function qee(r,e){return`Illegal parameter ${e} for ${r}`}function Zf(r,e,t){if(!(e in t))throw new Error(qee(r,e));return t[e]}function Kee(r,e){return e}function Xee(r){let e=!0;for(const t in r){e=!1;break}return e}function K4(r){const e={};return r.addressModeU&&(e[10242]=ex(r.addressModeU)),r.addressModeV&&(e[10243]=ex(r.addressModeV)),r.addressModeW&&(e[32882]=ex(r.addressModeW)),r.magFilter&&(e[10240]=tx(r.magFilter)),(r.minFilter||r.mipmapFilter)&&(e[10241]=Yee(r.minFilter||"linear",r.mipmapFilter)),r.lodMinClamp!==void 0&&(e[33082]=r.lodMinClamp),r.lodMaxClamp!==void 0&&(e[33083]=r.lodMaxClamp),r.type==="comparison-sampler"&&(e[34892]=34894),r.compare&&(e[34893]=Z2("compare",r.compare)),r.maxAnisotropy&&(e[34046]=r.maxAnisotropy),e}function ex(r){switch(r){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function tx(r){switch(r){case"nearest":return 9728;case"linear":return 9729}}function Yee(r,e="none"){if(!e)return tx(r);switch(e){case"none":return tx(r);case"nearest":switch(r){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(r){case"nearest":return 9986;case"linear":return 9987}}}class Zee extends Nf{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=K4(t),this.handle=t.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,n]of Object.entries(e)){const i=Number(t);switch(i){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,i,n);break;default:this.device.gl.samplerParameteri(this.handle,i,n);break}}}}function Fm(r,e,t){if(Jee(e))return t(r);const{nocatch:n=!0}=e,i=Yf.get(r);i.push(),Pp(r,e);let s;if(n)s=t(r),i.pop();else try{s=t(r)}finally{i.pop()}return s}function Jee(r){for(const e in r)return!1;return!0}class Lp extends Vy{device;gl;handle;texture;constructor(e,t){super(e,{...Ks.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}class Rm extends Ks{device;gl;handle;sampler=void 0;view;glTarget;glFormat;glType;glInternalFormat;compressed;_textureUnit=0;constructor(e,t){super(e,t),this.device=e,this.gl=this.device.gl;const n=$4(this.props.format);this.glTarget=ete(this.props.dimension),this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:i,width:s,height:a,depth:o,mipLevels:u,glTarget:d,glInternalFormat:p}=this;switch(i){case"2d":case"cube":this.gl.texStorage2D(d,u,p,s,a);break;case"2d-array":case"3d":this.gl.texStorage3D(d,u,p,s,a,o);break;default:throw new Error(i)}this.gl.bindTexture(this.glTarget,null),this._initializeData(t.data),this.setSampler(this.props.sampler),this.view=new Lp(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new Lp(this.device,{...e,texture:this})}setSampler(e={}){super.setSampler(e);const t=K4(this.sampler.props);this._setSamplerParameters(t)}copyImageData(e){const t=this._normalizeCopyImageDataOptions(e),n=t.data,{width:i,height:s,depth:a}=this,{mipLevel:o=0,byteOffset:u=0,x:d=0,y:p=0,z:b=0}=t,{glFormat:C,glType:w,compressed:M}=this,P=X4(this.glTarget,this.dimension,a),k=this.compressed?{}:{3314:t.bytesPerRow,32878:t.rowsPerImage};this.gl.bindTexture(P,this.handle),Fm(this.gl,k,()=>{switch(this.dimension){case"2d":case"cube":M?this.gl.compressedTexSubImage2D(P,o,d,p,i,s,C,n,u):this.gl.texSubImage2D(P,o,d,p,i,s,C,w,n,u);break;case"2d-array":case"3d":M?this.gl.compressedTexSubImage3D(P,o,d,p,b,i,s,a,C,n,u):this.gl.texSubImage3D(P,o,d,p,b,i,s,a,C,w,n,u);break;default:}}),this.gl.bindTexture(P,null)}copyExternalImage(e){const t=this._normalizeCopyExternalImageOptions(e);if(t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:n,glType:i}=this,{image:s,depth:a,mipLevel:o,x:u,y:d,z:p,width:b,height:C}=t,w=X4(this.glTarget,this.dimension,a),M=t.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),Fm(this.gl,M,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(w,o,u,d,b,C,n,i,s);break;case"2d-array":case"3d":this.gl.texSubImage3D(w,o,u,d,p,b,C,a,n,i,s);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:t.width,height:t.height}}generateMipmapsWebGL(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Xt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(n){Xt.warn(`Error generating mipmap for ${this}: ${n.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(e){Xt.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,n]of Object.entries(e)){const i=Number(t),s=n;switch(i){case 33082:case 33083:this.gl.texParameterf(this.glTarget,i,s);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,i,s);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,i,s);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,i,s);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,i,s);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(e){const{gl:t}=this;return e!==void 0&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}_unbind(e){const{gl:t}=this;return e!==void 0&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}function ete(r){switch(r){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(r)}function X4(r,e,t){return e==="cube"?34069+t:r}function tte(r){return ste[r]}function rx(r){return ite[r]}function rte(r){return!!Y4[r]}function nte(r){return Y4[r]}const ite={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},Y4={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},ste={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function ote(r,e){const t={attributes:[],bindings:[]};t.attributes=ate(r,e);const n=ute(r,e);for(const o of n){const u=o.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));t.bindings.push({type:"uniform",name:o.name,group:0,location:o.location,visibility:(o.vertex?1:0)&(o.fragment?2:0),minBindingSize:o.byteLength,uniforms:u})}const i=cte(r,e);let s=0;for(const o of i)if(rte(o.type)){const{viewDimension:u,sampleType:d}=nte(o.type);t.bindings.push({type:"texture",name:o.name,group:0,location:s,viewDimension:u,sampleType:d}),o.textureUnit=s,s+=1}i.length&&(t.uniforms=i);const a=lte(r,e);return a?.length&&(t.varyings=a),t}function ate(r,e){const t=[],n=r.getProgramParameter(e,35721);for(let i=0;i<n;i++){const s=r.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:a,type:o}=s,u=r.getAttribLocation(e,a);if(u>=0){const d=rx(o),p=/instance/i.test(a)?"instance":"vertex";t.push({name:a,location:u,stepMode:p,type:d})}}return t.sort((i,s)=>i.location-s.location),t}function lte(r,e){const t=[],n=r.getProgramParameter(e,35971);for(let i=0;i<n;i++){const s=r.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:a,type:o,size:u}=s,d=rx(o),{type:p,components:b}=lP(d);t.push({location:i,name:a,type:p,size:u*b})}return t.sort((i,s)=>i.location-s.location),t}function cte(r,e){const t=[],n=r.getProgramParameter(e,35718);for(let i=0;i<n;i++){const s=r.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:a,size:o,type:u}=s,{name:d,isArray:p}=hte(a);let b=r.getUniformLocation(e,d);const C={location:b,name:d,size:o,type:u,isArray:p};if(t.push(C),C.size>1)for(let w=0;w<C.size;w++){const M=`${d}[${w}]`;b=r.getUniformLocation(e,M);const P={...C,name:M,location:b};t.push(P)}}return t}function ute(r,e){const t=(s,a)=>r.getActiveUniformBlockParameter(e,s,a),n=[],i=r.getProgramParameter(e,35382);for(let s=0;s<i;s++){const a={name:r.getActiveUniformBlockName(e,s)||"",location:t(s,35391),byteLength:t(s,35392),vertex:t(s,35396),fragment:t(s,35398),uniformCount:t(s,35394),uniforms:[]},o=t(s,35395)||[],u=r.getActiveUniforms(e,o,35383),d=r.getActiveUniforms(e,o,35384),p=r.getActiveUniforms(e,o,35387),b=r.getActiveUniforms(e,o,35388);for(let C=0;C<a.uniformCount;++C){const w=r.getActiveUniform(e,o[C]);if(!w)throw new Error("activeInfo");const M=rx(u[C]);a.uniforms.push({name:w.name,format:M,type:u[C],arrayLength:d[C],byteOffset:p[C],byteStride:b[C]})}n.push(a)}return n.sort((s,a)=>s.location-a.location),n}function hte(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(r);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${r}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function Ate(r,e,t,n){const i=r;let s=n;s===!0&&(s=1),s===!1&&(s=0);const a=typeof s=="number"?[s]:s;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return r.uniform1i(e,n);case 5126:return r.uniform1fv(e,a);case 35664:return r.uniform2fv(e,a);case 35665:return r.uniform3fv(e,a);case 35666:return r.uniform4fv(e,a);case 5124:return r.uniform1iv(e,a);case 35667:return r.uniform2iv(e,a);case 35668:return r.uniform3iv(e,a);case 35669:return r.uniform4iv(e,a);case 35670:return r.uniform1iv(e,a);case 35671:return r.uniform2iv(e,a);case 35672:return r.uniform3iv(e,a);case 35673:return r.uniform4iv(e,a);case 5125:return i.uniform1uiv(e,a,1);case 36294:return i.uniform2uiv(e,a,2);case 36295:return i.uniform3uiv(e,a,3);case 36296:return i.uniform4uiv(e,a,4);case 35674:return r.uniformMatrix2fv(e,!1,a);case 35675:return r.uniformMatrix3fv(e,!1,a);case 35676:return r.uniformMatrix4fv(e,!1,a);case 35685:return i.uniformMatrix2x3fv(e,!1,a);case 35686:return i.uniformMatrix2x4fv(e,!1,a);case 35687:return i.uniformMatrix3x2fv(e,!1,a);case 35688:return i.uniformMatrix3x4fv(e,!1,a);case 35689:return i.uniformMatrix4x2fv(e,!1,a);case 35690:return i.uniformMatrix4x3fv(e,!1,a)}throw new Error("Illegal uniform")}function fte(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(r)}}function dte(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(r)}}const Z4=4;class pte extends zf{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=t.vs,this.fs=t.fs;const{varyings:n,bufferMode:i=35981}=t;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,i)),this._linkShaders(),Xt.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=ote(this.device.gl,this.handle),Xt.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=t.shaderLayout?gte(this.introspectedLayout,t.shaderLayout):this.introspectedLayout}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(e,t){for(const[n,i]of Object.entries(e)){const s=this.shaderLayout.bindings.find(a=>a.name===n)||this.shaderLayout.bindings.find(a=>a.name===`${n}Uniforms`);if(!s){const a=this.shaderLayout.bindings.map(o=>`"${o.name}"`).join(", ");t?.disableWarnings||Xt.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${a}`,i)();continue}switch(i||Xt.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),s.type){case"uniform":if(!(i instanceof Mm)&&!(i.buffer instanceof Mm))throw new Error("buffer value");break;case"texture":if(!(i instanceof Lp||i instanceof Rm||i instanceof Pm))throw new Error(`${this} Bad texture binding for ${n}`);break;case"sampler":Xt.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(s.type)}this.bindings[n]=i}}draw(e){const{renderPass:t,parameters:n=this.props.parameters,topology:i=this.props.topology,vertexArray:s,vertexCount:a,instanceCount:o,isInstanced:u=!1,firstVertex:d=0,transformFeedback:p}=e,b=fte(i),C=!!s.indexBuffer,w=s.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Xt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Xt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),s.bindBeforeRender(t),p&&p.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const M=t;return Gee(this.device,n,M.glParameters,()=>{C&&u?this.device.gl.drawElementsInstanced(b,a||0,w,d,o||0):C?this.device.gl.drawElements(b,a||0,w,d):u?this.device.gl.drawArraysInstanced(b,d,a||0,o||0):this.device.gl.drawArrays(b,d,a||0),p&&p.end()}),s.unbindAfterRender(t),!0}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Xt.time(Z4,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Xt.timeEnd(Z4,`linkProgram for ${this.id}`)(),Xt.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}Xt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Xt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){switch(e){case"success":return;default:const t=e==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${t} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${t} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const n=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${t} during ${e}: ${n}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const e=async i=>await new Promise(s=>setTimeout(s,i));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)!this.bindings[t.name]&&!this.bindings[t.name.replace(/Uniforms$/,"")]&&(Xt.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,n=0;for(const i of this.shaderLayout.bindings){const s=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!s)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:a}=i,o=e.getUniformBlockIndex(this.handle,a);if(o===4294967295)throw new Error(`Invalid uniform block name ${a}`);e.uniformBlockBinding(this.handle,n,o),s instanceof Mm?e.bindBufferBase(35345,n,s.handle):e.bindBufferRange(35345,n,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),n+=1;break;case"texture":if(!(s instanceof Lp||s instanceof Rm||s instanceof Pm))throw new Error("texture");let u;if(s instanceof Lp)u=s.texture;else if(s instanceof Rm)u=s;else if(s instanceof Pm&&s.colorAttachments[0]instanceof Lp)Xt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),u=s.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+t),e.bindTexture(u.glTarget,u.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:n,type:i,textureUnit:s}=e,a=this.uniforms[t]??s;a!==void 0&&Ate(this.device.gl,n,i,a)}}}function gte(r,e){const t={...r,attributes:r.attributes.map(n=>({...n}))};for(const n of e?.attributes||[]){const i=t.attributes.find(s=>s.name===n.name);i?(i.type=n.type||i.type,i.stepMode=n.stepMode||i.stepMode):Xt.warn(`shader layout attribute ${n.name} not present in shader`)}return t}class mte extends Mw{device;handle=null;commands=[];constructor(e){super(e,{}),this.device=e}_executeCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":_te(this.device,t.options);break;case"copy-buffer-to-texture":yte(this.device,t.options);break;case"copy-texture-to-buffer":bte(this.device,t.options);break;case"copy-texture-to-texture":vte(this.device,t.options);break;default:throw new Error(t.name)}}}function _te(r,e){const t=e.sourceBuffer,n=e.destinationBuffer;r.gl.bindBuffer(36662,t.handle),r.gl.bindBuffer(36663,n.handle),r.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),r.gl.bindBuffer(36662,null),r.gl.bindBuffer(36663,null)}function yte(r,e){throw new Error("Not implemented")}function bte(r,e){const{sourceTexture:t,mipLevel:n=0,aspect:i="all",width:s=e.sourceTexture.width,height:a=e.sourceTexture.height,depthOrArrayLayers:o=0,origin:u=[0,0],destinationBuffer:d,byteOffset:p=0,bytesPerRow:b,rowsPerImage:C}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||o!==0||b||C)throw new Error("not implemented");const{framebuffer:w,destroyFramebuffer:M}=J4(t);let P;try{const k=d,D=s||w.width,j=a||w.height,H=$4(w.colorAttachments[0].texture.props.format),N=H.format,q=H.type;r.gl.bindBuffer(35051,k.handle),P=r.gl.bindFramebuffer(36160,w.handle),r.gl.readPixels(u[0],u[1],D,j,N,q,p)}finally{r.gl.bindBuffer(35051,null),P!==void 0&&r.gl.bindFramebuffer(36160,P),M&&w.destroy()}}function vte(r,e){const{sourceTexture:t,destinationMipLevel:n=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:a}=e;let{width:o=e.destinationTexture.width,height:u=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:p}=J4(t),[b,C]=i,[w,M,P]=s,k=r.gl.bindFramebuffer(36160,d.handle);let D,j;if(a instanceof Rm)D=a,o=Number.isFinite(o)?o:D.width,u=Number.isFinite(u)?u:D.height,D._bind(0),j=D.glTarget;else throw new Error("invalid destination");switch(j){case 3553:case 34067:r.gl.copyTexSubImage2D(j,n,w,M,b,C,o,u);break;case 35866:case 32879:r.gl.copyTexSubImage3D(j,n,w,M,P,b,C,o,u);break}D&&D._unbind(),r.gl.bindFramebuffer(36160,k),p&&d.destroy()}function J4(r){if(r instanceof Ks){const{width:e,height:t,id:n}=r;return{framebuffer:r.device.createFramebuffer({id:`framebuffer-for-${n}`,width:e,height:t,colorAttachments:[r]}),destroyFramebuffer:!0}}return{framebuffer:r,destroyFramebuffer:!1}}const wte=[1,2,4,8];class xte extends Qf{device;handle=null;glParameters={};constructor(e,t){super(e,t),this.device=e;let n;if(!t?.parameters?.viewport)if(t?.framebuffer){const{width:s,height:a}=t.framebuffer;n=[0,0,s,a]}else{const[s,a]=e.getDefaultCanvasContext().getDrawingBufferSize();n=[0,0,s,a]}this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters});const i=this.props.framebuffer;if(this.props.framebuffer&&i?.handle){const s=this.props.framebuffer.colorAttachments.map((a,o)=>36064+o);this.device.gl.drawBuffers(s)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=e.stencilReference),"colorMask"in e&&(t.colorMask=wte.map(n=>!!(n&e.colorMask))),this.glParameters=t,Pp(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((n,i)=>{n&&this.clearColorBuffer(i,n)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(t|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(t|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(t|=1024,e.clearStencil=this.props.clearStencil),t!==0&&Fm(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){Fm(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class eF extends Pw{device;handle=null;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new mte(e)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(e){return new xte(this.device,e)}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,n){}}function Bte(r){const{target:e,source:t,start:n=0,count:i=1}=r,s=t.length,a=i*s;let o=0;for(let u=n;o<s;o++)e[u++]=t[o];for(;o<a;)o<a-o?(e.copyWithin(n+o,n,n+o),o*=2):(e.copyWithin(n+o,n,n+a-o),o=a);return r.target}class nx extends Fw{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return mj()==="Chrome"}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const n=t;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:i,type:s,stride:a,offset:o,normalized:u,integer:d,divisor:p}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),d?this.device.gl.vertexAttribIPointer(e,i,s,a,o):this.device.gl.vertexAttribPointer(e,i,s,u,a,o),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,p||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const n=H4(t.bufferDataType);return{size:t.bufferComponents,type:n,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:t.stepMode==="instance"?1:0}}_enable(e,t=!0){const i=nx.isConstantAttributeZeroSupported(this.device)||e!==0;(t||i)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const n=Cte(t),i=n.byteLength*e,s=n.length*e;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),a||=!Tte(n,this.bufferValue),a){const o=iq(t.constructor,s);Bte({target:o,source:n,start:0,count:s}),this.buffer.write(o),this.bufferValue=t}return this.buffer}}function Cte(r){return Array.isArray(r)?new Float32Array(r):r}function Tte(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}class Ete extends Rw{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(dte(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:i,byteLength:s,byteOffset:a}=this._getBufferRange(t);if(n<0){this.unusedBuffers[e]=i,Xt.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[n]={buffer:i,byteLength:s,byteOffset:a},this.bindOnUse||this._bindBuffer(n,i,a,s)}getBuffer(e){if(tF(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Mm)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:n=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:t,byteOffset:n,byteLength:i}}_getVaryingIndex(e){if(tF(e))return Number(e);for(const t of this.layout.varyings||[])if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,i,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,n=0,i){const s=t&&t.handle;!s||i===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,n,i)}}function tF(r){return typeof r=="number"?Number.isInteger(r):/^\d+$/.test(r)}class Ste extends Lw{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");const n=this.device.gl.createQuery();if(!n)throw new Error("WebGL query not supported");this.handle=n,Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((n,i)=>{const s=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):t++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}}function rF(r){switch(r){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function Ite(r){switch(r){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Pte(r){return Mte[r]}const Mte={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function Fte(r,e){const{sourceX:t=0,sourceY:n=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:a,sourceHeight:o,sourceDepth:u,sourceFormat:d,sourceType:p}=e||{};const{framebuffer:b,deleteFramebuffer:C}=nF(r),{gl:w,handle:M}=b;a||=b.width,o||=b.height;const P=b.colorAttachments[i]?.texture;if(!P)throw new Error(`Invalid framebuffer attachment ${i}`);u=P?.depth||1,d||=P?.glFormat||6408,p||=P?.glType||5121,s=Ote(s,p,d,a,o);const k=bw(s);p=p||tte(k);const D=w.bindFramebuffer(36160,M);return w.readBuffer(36064+i),w.readPixels(t,n,a,o,d,p,s),w.readBuffer(36064),w.bindFramebuffer(36160,D||null),C&&b.destroy(),s}function Rte(r,e){const{target:t,sourceX:n=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:a=0}=e||{};let{sourceWidth:o,sourceHeight:u,sourceType:d}=e||{};const{framebuffer:p,deleteFramebuffer:b}=nF(r);o=o||p.width,u=u||p.height;const C=p;d=d||5121;let w=t;if(!w){const P=rF(s),k=Ite(d),D=a+o*u*P*k;w=C.device.createBuffer({byteLength:D})}const M=r.device.createCommandEncoder();return M.copyTextureToBuffer({sourceTexture:r,width:o,height:u,origin:[n,i],destinationBuffer:w,byteOffset:a}),M.destroy(),b&&p.destroy(),w}function nF(r){return r instanceof $y?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:Lte(r),deleteFramebuffer:!0}}function Lte(r,e){const{device:t,width:n,height:i,id:s}=r;return t.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:n,height:i,colorAttachments:[r]})}function Ote(r,e,t,n,i,s){if(r)return r;e||=5121;const a=Pte(e),o=vw(a),u=rF(t);return new o(n*i*u)}class ix extends Df{type="webgl";handle;features;limits;info;canvasContext;preferredColorFormat="rgba8unorm";preferredDepthFormat="depth24plus";commandEncoder;lost;_resolveContextLost;gl;_constants;_extensions={};_polyfilled=!1;spectorJS;get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(e){switch(e){case"unorm8x4-bgra":return!1;default:return!0}}constructor(e){super({...e,id:e.id||Qee("webgl-device")});const t=Df._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let n=t.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new zee(this,t),this.lost=new Promise(p=>{this._resolveContextLost=p});const i={...e.webgl};t.alphaMode==="premultiplied"&&(i.premultipliedAlpha=!0),e.powerPreference!==void 0&&(i.powerPreference=e.powerPreference);const a=this.props._handle||bee(this.canvasContext.canvas,{onContextLost:p=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:p=>console.log("WebGL context restored")},i);if(!a)throw new Error("WebGL context creation failed");if(n=a.device,n){if(e._reuseDevices)return Xt.log(1,`Not creating a new Device, instead returning a reference to Device ${n.id} already attached to WebGL context`,n)(),n._reused=!0,n;throw new Error(`WebGL context already attached to device ${n.id}`)}this.handle=a,this.gl=a,this.spectorJS=ree({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=vee(this.gl,this._extensions),this.limits=new Dee(this.gl),this.features=new Uee(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new Yf(this.gl,{log:(...p)=>Xt.log(1,...p)()}).trackState(this.gl,{copyState:!1});const u=e.debugWebGL||e.debug,d=e.debugWebGL;u&&(this.gl=see(this.gl,{debugWebGL:u,traceWebGL:d}),Xt.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(Xt.level=Math.max(Xt.level,1))),this.commandEncoder=new eF(this,{id:`${this}-command-encoder`})}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new Mm(this,t)}createTexture(e){return new Rm(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new Zee(this,e)}createShader(e){return new $ee(this,e)}createFramebuffer(e){return new Pm(this,e)}createVertexArray(e){return new nx(this,e)}createTransformFeedback(e){return new Ete(this,e)}createQuerySet(e){return new Ste(this,e)}createRenderPipeline(e){return new pte(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(e={}){return new eF(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),e._executeCommands()}readPixelsToArrayWebGL(e,t){return Fte(e,t)}readPixelsToBufferWebGL(e,t){return Rte(e,t)}setParametersWebGL(e){Pp(this.gl,e)}getParametersWebGL(e){return k4(this.gl,e)}withParametersWebGL(e,t){return Fm(this.gl,e,t)}resetWebGL(){Xt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),pee(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return Fee(this.gl,e,this._extensions)}loseDevice(){let e=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(e=!0,n.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){Yf.get(this.gl).push()}popState(){Yf.get(this.gl).pop()}getGLKey(e,t){const n=Number(e);for(const i in this.gl)if(this.gl[i]===n)return`GL.${i}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((n,[i,s])=>(n[`${i}:${this.getGLKey(i,t)}`]=`${s}:${this.getGLKey(s,t)}`,n),{})}setConstantAttributeWebGL(e,t){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const i=this._constants[e];switch(i&&Nte(i,t)&&Xt.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:Ute(this,e,t);break;case Int32Array:Dte(this,e,t);break;case Uint32Array:kte(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return Mp(this.gl,e,this._extensions),this._extensions}_setWebGLDebugMetadata(e,t,n){e.luma=t;const i={props:n.spector,id:n.spector.id};e.__SPECTOR_Metadata=i}}function Ute(r,e,t){switch(t.length){case 1:r.gl.vertexAttrib1fv(e,t);break;case 2:r.gl.vertexAttrib2fv(e,t);break;case 3:r.gl.vertexAttrib3fv(e,t);break;case 4:r.gl.vertexAttrib4fv(e,t);break}}function Dte(r,e,t){r.gl.vertexAttribI4iv(e,t)}function kte(r,e,t){r.gl.vertexAttribI4uiv(e,t)}function Nte(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}const iF=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:ix},Symbol.toStringTag,{value:"Module"}));function HA(){}const sF={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:HA,onWebGLInitialized:HA,onResize:HA,onViewStateChange:HA,onInteractionStateChange:HA,onBeforeRender:HA,onAfterRender:HA,onLoad:HA,onError:r=>$n.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:r})=>r?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class Lm{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new up({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const s=n.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n},this._onEvent=n=>{const i=g2[n.type],s=n.offsetCenter;if(!i||!s||!this.layerManager)return;const a=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:a,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:u}=o,d=u&&(u[i]||u.props[i]),p=this.props[i];let b=!1;d&&(b=d.call(u,o,n)),b||(p?.(o,n),this.widgetManager.onEvent(o,n))},this._onPointerDown=n=>{if(this.device?.type==="webgpu")return;const i=n.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...sF,...e},e=this.props,e.viewState&&e.initialViewState&&$n.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&$n.error("WebGL1 context not supported.")(),t=G2.attach(e.gl,this.props.deviceProps)),t||(t=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&xm.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&$n.removed("onLayerHover","onHover")(),"onLayerClick"in e&&$n.removed("onLayerClick","onClick")(),e.initialViewState&&!Zl(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);if(Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==e.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),$n.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),this.animationLoop?.setProps(t),e.useDevicePixels!==void 0&&this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){this.device.canvasContext.props.useDevicePixels=e.useDevicePixels;const n=this.device.canvasContext.canvas,i={target:n,contentBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}],devicePixelContentBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}],borderBoxSize:[{inlineSize:n.clientWidth,blockSize:n.clientHeight}]};this.device.canvasContext._handleResize([i])}this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return t=t||n||i||s||a,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return bo(this.viewManager),this.viewManager.views}getViewports(e){return bo(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,n){bo(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(t).timeEnd(),s}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),bo(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",e.width&&typeof e.width=="number"&&(t.width=e.width),e.height&&typeof e.height=="number"&&(t.height=e.height),(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:n}=e;if(t||t===0){const i=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=i}if(n||n===0){const i=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,n=e.clientHeight??e.height;(t!==this.width||n!==this.height)&&(this.width=t,this.height=n,this.viewManager?.setProps({width:t,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:n}))}_createAnimationLoop(e,t){const{gl:n,onError:i}=t;return new P2({device:e,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:s=>this._setDevice(s.device),onRender:this._onRenderFrame.bind(this),onError:i})}_createDevice(e){const t=this.props.deviceProps?.createCanvasContext,n=typeof t=="object"?t:void 0,i={adapters:[],...e.deviceProps};i.adapters.includes(G2)||i.adapters.push(G2);const s={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0};return Sw.createDevice({_reuseDevices:!0,type:"webgl",...i,createCanvasContext:{...s,...n,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new Q2({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let i=n,s=!1;for(const a of t)i=a,s=a.layer?.onHover(a,e.event)||s;s||(this.props.onHover?.(i,e.event),this.widgetManager.onHover(i,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new d4;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new IY(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys($M).map(i=>{const[s,a,o,u]=$M[i],d=this.props.eventRecognizerOptions?.[i],p={...a,...d,event:i};return{recognizer:new s(p),recognizeWith:o,requestFailure:u}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in g2)this.eventManager.on(i,this._onEvent);this.viewManager=new wJ({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new vJ(this.device,{deck:this,stats:this.stats,viewport:n,timeline:t}),this.effectManager=new UJ({deck:this,device:this.device}),this.deckRenderer=new NJ(this.device),this.deckPicker=new HJ(this.device),this.widgetManager=new $J({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new I4),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),$n.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=Sw.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}Lm.defaultProps=sF,Lm.VERSION=kG;function zte(r){switch(r){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return vw(r)}}const Qte=bw;function E0(r,e,t){const n=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:r,format:e.size>1?`${n}x${e.size}`:e.type,byteOffset:e.offset||0}}function Jf(r){return r.stride||r.size*r.bytesPerElement}function Hte(r,e){return r.type===e.type&&r.size===e.size&&Jf(r)===Jf(e)&&(r.offset||0)===(e.offset||0)}function sx(r,e){e.offset&&$n.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Jf(r),n=e.vertexOffset!==void 0?e.vertexOffset:r.vertexOffset||0,i=e.elementOffset||0,s=n*t+i*r.bytesPerElement+(r.offset||0);return{...e,offset:s,stride:t}}function Vte(r,e){const t=sx(r,e);return{high:t,low:{...t,offset:t.offset+r.size*4}}}class jte{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,s=i==="float64";let{defaultValue:a}=t;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let o;s?o="float32":!i&&t.isIndexed?o="uint32":o=i||"float32";let u=zte(i||o);this.doublePrecision=s,s&&t.fp64===!1&&(u=Float32Array),this.value=null,this.settings={...t,defaultType:u,defaultValue:a,logicalType:i,type:o,normalized:o.includes("norm"),size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Jf(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),xm.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const n={};if(this.state.constant){const i=this.value;if(t){const s=sx(this.getAccessor(),t),a=s.offset/i.BYTES_PER_ELEMENT,o=s.size||this.size;n[e]=i.subarray(a,a+o)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,t=null){const n=this.getAccessor(),i=[],s={name:this.id,byteStride:Jf(n),attributes:i};if(this.doublePrecision){const a=Vte(n,t||{});i.push(E0(e,{...n,...a.high},this.device.type),E0(`${e}64Low`,{...n,...a.low},this.device.type))}else if(t){const a=sx(n,t);i.push(E0(e,{...n,...a},this.device.type))}else i.push(E0(e,n,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:i}=this,s=n*i;if(t&&s&&t.length>=s){const a=new Array(i).fill(1/0),o=new Array(i).fill(-1/0);for(let u=0;u<s;)for(let d=0;d<i;d++){const p=t[u++];p<a[d]&&(a[d]=p),p>o[d]&&(o[d]=p)}e=[a,o]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;ArrayBuffer.isView(e)?n={value:e}:e instanceof bs?n={buffer:e}:n=e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const a=Qte(n.value);i.type=i.normalized?a.replace("int","norm"):a}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=Jf(i)}if(t.bounds=null,n.constant){let s=n.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!t.constant||!this._areValuesEqual(s,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(n.buffer){const s=n.buffer;t.externalBuffer=s,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let s=n.value;t.externalBuffer=null,t.constant=!1,this.value=s;let{buffer:a}=this;const o=Jf(i),u=(i.vertexOffset||0)*o;if(this.doublePrecision&&s instanceof Float64Array&&(s=S2(s,i)),this.settings.isIndexed){const p=this.settings.defaultType;s.constructor!==p&&(s=new p(s))}const d=s.byteLength+u+o*2;(!a||a.byteLength<d)&&(a=this._createBuffer(d)),a.write(s,u)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?S2(t,{size:this.size,startIndex:n,endIndex:i}):t.subarray(n,i),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:n}=this,i=n.allocatedValue,s=xm.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=s;const{byteOffset:a}=this;let{buffer:o}=this;return(!o||o.byteLength<s.byteLength+a)&&(o=this._createBuffer(s.byteLength+a),t&&i&&o.write(i instanceof Float64Array?S2(i,this):i,a)),n.allocatedValue=s,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof n)&&this.settings.normalized&&!("normalized"in e)&&$n.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,n){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let a=s;for(;--a>=0;)t[n+a]=i[a];return t}switch(s){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let a=s;for(;--a>=0;)t[n+a]=Number.isFinite(e[a])?e[a]:i[a]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?bs.INDEX:bs.VERTEX)|bs.COPY_DST,indexType:t?n:void 0,byteLength:e}),this._buffer}}const oF=[],aF=[];function lF(r,e=0,t=1/0){let n=oF;const i={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?n=r:r.length>0&&(aF.length=r.length,n=aF):n=oF,(e>0||Number.isFinite(t))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(e,t),i.index=e-1),{iterable:n,objectInfo:i}}function cF(r){return r&&r[Symbol.asyncIterator]}function $te(r,e){const{size:t,stride:n,offset:i,startIndices:s,nested:a}=e,o=r.BYTES_PER_ELEMENT,u=n?n/o:t,d=i?i/o:0,p=Math.floor((r.length-d)/u);return(b,{index:C,target:w})=>{if(!s){const D=C*u+d;for(let j=0;j<t;j++)w[j]=r[D+j];return w}const M=s[C],P=s[C+1]||p;let k;if(a){k=new Array(P-M);for(let D=M;D<P;D++){const j=D*u+d;w=new Array(t);for(let H=0;H<t;H++)w[H]=r[j+H];k[D-M]=w}}else if(u===t)k=r.subarray(M*t+d,P*t+d);else{k=new r.constructor((P-M)*t);let D=0;for(let j=M;j<P;j++){const H=j*u+d;for(let N=0;N<t;N++)k[D++]=r[H+N]}}return k}}const Gte=[],S0=[[0,1/0]];function Wte(r,e){if(r===S0||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return r;const t=[],n=r.length;let i=0;for(let s=0;s<n;s++){const a=r[s];a[1]<e[0]?(t.push(a),i=s+1):a[0]>e[1]?t.push(a):e=[Math.min(a[0],e[0]),Math.max(a[1],e[1])]}return t.splice(i,0,e),t}const qte={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function uF(r,e){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const t=r.type||"interpolation";return{...qte[t],...e,...r,type:t}}class hF extends jte{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:S0}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!Hte(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition,i=Array.isArray(t)?e[t.find(s=>e[s])]:e[t];return uF(i,n)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:n=0,endRow:i=1/0}=t;this.state.updateRanges=Wte(this.state.updateRanges,[n,i])}else this.state.updateRanges=S0}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Gte}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(e,t.updateRanges!==S0),!0):!1}updateBuffer({numInstances:e,data:t,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:a,noAlloc:o}}=this;let u=!0;if(a){for(const[d,p]of s)a.call(i,this,{data:t,startRow:d,endRow:p,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,p]of s){const b=Number.isFinite(d)?this.getVertexOffset(d):0,C=Number.isFinite(p)?this.getVertexOffset(p):o||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:b,endOffset:C})}this._checkAttributeArray()}else u=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),u}setConstantValue(e,t){const n=this.device.type==="webgpu";if(n||t===void 0||typeof t=="function"){if(n&&typeof t!="function"){const a=this._normalizeValue(t,[],0);this._areValuesEqual(a,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const i=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:i})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const a=e;bo(ArrayBuffer.isView(a.value),`invalid ${i.accessor}`);const o=!!a.size&&a.size!==this.size;return n.binaryAccessor=$te(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:t,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?n.stepMode=e?e.isInstanced?"instance":"vertex":"instance":n.stepMode=i??"vertex",!t)return n;for(const s in t){const a=super._getBufferLayout(s,t[s]);n.attributes.push(...a.attributes)}return n}_autoUpdater(e,{data:t,startRow:n,endRow:i,props:s,numInstances:a}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:o,state:u,value:d,size:p,startIndices:b}=e,{accessor:C,transform:w}=o;let M=u.binaryAccessor||(typeof C=="function"?C:s[C]);typeof M!="function"&&typeof C=="string"&&(M=()=>s[C]),bo(typeof M=="function",`accessor "${C}" is not a function`);let P=e.getVertexOffset(n);const{iterable:k,objectInfo:D}=lF(t,n,i);for(const j of k){D.index++;let H=M(j,D);if(w&&(H=w.call(this,H)),b){const N=(D.index<b.length-1?b[D.index+1]:a)-b[D.index];if(H&&Array.isArray(H[0])){let q=P;for(const W of H)e._normalizeValue(W,d,q),q+=p}else H&&H.length>p?d.set(H,P):(e._normalizeValue(H,D.target,0),gJ({target:d,source:D.target,start:P,count:N}));P+=N*p}else e._normalizeValue(H,d,P),P+=p}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function ox(r){const{source:e,target:t,start:n=0,size:i,getData:s}=r,a=r.end||t.length,o=e.length,u=a-n;if(o>u){t.set(e.subarray(0,u),n);return}if(t.set(e,n),!s)return;let d=o;for(;d<u;){const p=s(d,e);for(let b=0;b<i;b++)t[n+d]=p[b]||0,d++}}function Kte({source:r,target:e,size:t,getData:n,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return ox({source:r,target:e,size:t,getData:n}),e;let a=0,o=0;const u=n&&((p,b)=>n(p+o,b)),d=Math.min(i.length,s.length);for(let p=1;p<d;p++){const b=i[p]*t,C=s[p]*t;ox({source:r.subarray(a,b),target:e,start:o,end:C,size:t,getData:u}),a=b,o=C}return o<e.length&&ox({source:[],target:e,start:o,size:t,getData:u}),e}function Xte(r){const{device:e,settings:t,value:n}=r,i=new hF(e,t);return i.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),i}function AF(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${r}"`)}}function fF(r){switch(r){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function dF(r){r.push(r.shift())}function Yte(r,e){const{doublePrecision:t,settings:n,value:i,size:s}=r,a=t&&i instanceof Float64Array?2:1;let o=0;const{shaderAttributes:u}=r.settings;if(u)for(const d of Object.values(u))o=Math.max(o,d.vertexOffset??0);return(n.noAlloc?i.length:(e+o)*s)*a}function pF({device:r,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=r.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function gF({device:r,buffer:e,attribute:t,fromLength:n,toLength:i,fromStartIndices:s,getData:a=o=>o}){const o=t.doublePrecision&&t.value instanceof Float64Array?2:1,u=t.size*o,d=t.byteOffset,p=t.settings.bytesPerElement<4?d/t.settings.bytesPerElement*4:d,b=t.startIndices,C=s&&b,w=t.isConstant;if(!C&&e&&n>=i)return e;const M=t.value instanceof Float64Array?Float32Array:t.value.constructor,P=w?t.value:new M(t.getBuffer().readSyncWebGL(d,i*M.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!w){const H=a;a=(N,q)=>t.normalizeConstant(H(N,q))}const k=w?(H,N)=>a(P,N):(H,N)=>a(P.subarray(H+d,H+d+u),N),D=e?new Float32Array(e.readSyncWebGL(p,n*4).buffer):new Float32Array(0),j=new Float32Array(i);return Kte({source:D,target:j,sourceStartIndices:s,targetStartIndices:b,size:u,getData:k}),(!e||e.byteLength<j.byteLength+p)&&(e?.destroy(),e=r.createBuffer({byteLength:j.byteLength+p,usage:35050})),e.write(j,p),e}class mF{constructor({device:e,attribute:t,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new x0(n),this.attribute=t,this.attributeInTransition=Xte(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Yte(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class Zte extends mF{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="interpolation",this.transform=tre(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:a}=this;dF(s),s[0]=gF({device:this.device,buffer:s[0],attribute:a,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=pF({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:o}=this,u=o.model;let d=Math.floor(this.currentLength/a.size);yF(a)&&(d/=2),u.setVertexCount(d),a.isConstant?(u.setAttributes({aFrom:s[0]}),u.setConstantAttributes({aTo:a.value})):u.setAttributes({aFrom:s[0],aTo:a.getBuffer()}),o.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let i=n/e;t&&(i=t(i));const{model:s}=this.transform,a={time:i};s.shaderInputs.setProps({interpolation:a}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const _F={name:"interpolation",vs:`uniform interpolationUniforms {
  float time;
} interpolation;
`,uniformTypes:{time:"f32"}},Jte=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,ere=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function yF(r){return r.doublePrecision&&r.value instanceof Float64Array}function tre(r,e){const t=e.size,n=AF(t),i=fF(t),s=e.getBufferLayout();return yF(e)?new xp(r,{vs:ere,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*t}]}],modules:[vX,_F],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new xp(r,{vs:Jte,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[_F],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class rre extends mF{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="spring",this.texture=are(e),this.framebuffer=lre(e,this.texture),this.transform=ore(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:s,attribute:a}=this;for(let u=0;u<2;u++)s[u]=gF({device:this.device,buffer:s[u],attribute:a,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=pF({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:o}=this.transform;o.setVertexCount(Math.floor(this.currentLength/a.size)),a.isConstant?o.setConstantAttributes({aTo:a.value}):o.setAttributes({aTo:a.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:i}=this,s=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const a={stiffness:s.stiffness,damping:s.damping};t.model.shaderInputs.setProps({spring:a}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),dF(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const nre={name:"spring",vs:`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,uniformTypes:{damping:"f32",stiffness:"f32"}},ire=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,sre=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function ore(r,e){const t=AF(e.size),n=fF(e.size);return new xp(r,{vs:ire,fs:sre,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[nre],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function are(r){return r.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function lre(r,e){return r.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const cre={interpolation:Zte,spring:rre};class ure{constructor(e,{id:t,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:n}){this.numInstances=n||1;for(const i in e){const s=e[i],a=s.getTransitionSetting(t);a&&this._updateAttribute(i,s,a)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(t))&&this._removeTransition(i)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const i=this.transitions[e];let s=!i||i.type!==n.type;if(s){i&&this._removeTransition(e);const a=cre[n.type];a?this.transitions[e]=new a({attribute:t,timeline:this.timeline,device:this.device}):($n.error(`unsupported transition type '${n.type}'`)(),s=!1)}(s||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const bF="attributeManager.invalidate",hre="attributeManager.updateStart",Are="attributeManager.updateEnd",fre="attribute.updateStart",dre="attribute.allocate",pre="attribute.updateEnd";class gre{constructor(e,{id:t="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=bm(OZ),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new ure(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);sa(bF,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);sa(bF,this,"all")}update({data:e,numInstances:t,startIndices:n=null,transitions:i,props:s={},buffers:a={},context:o={}}){let u=!1;sa(hre,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const p=this.attributes[d],b=p.settings.accessor;p.startIndices=n,p.numInstances=t,s[d]&&$n.removed(`props.${d}`,`data.attributes.${d}`)(),p.setExternalBuffer(a[d])||p.setBinaryValue(typeof b=="string"?a[b]:void 0,e.startIndices)||typeof b=="string"&&!a[b]&&p.setConstantValue(o,s[b])||p.needsUpdate()&&(u=!0,this._updateAttribute({attribute:p,numInstances:t,data:e,props:s,context:o})),this.needsRedraw=this.needsRedraw||p.needsRedraw()}u&&sa(Are,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const s in t){const a=t[s];a.needsRedraw(e)&&!n.hasAttribute(s)&&(i[s]=a)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const n in e){const i=e[n],s={...i,id:n,size:i.isIndexed&&1||i.size||1,...t};this.attributes[n]=new hF(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:i}=this,s=i[e];return s&&s.forEach(a=>{const o=n[a];o&&o.setNeedsUpdate(o.id,t)}),s}_updateAttribute(e){const{attribute:t,numInstances:n}=e;if(sa(fre,t),t.constant){t.setConstantValue(e.context,t.value);return}t.allocate(n)&&sa(dre,t,n),t.updateBuffer(e)&&(this.needsRedraw=!0,sa(pre,t,n))}}class mre extends x0{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:i,easing:s}}=this,a=s(e/i);this._value=o0(t,n,a)}}const vF=1e-5;function wF(r,e,t,n,i){const s=e-r,o=(t-e)*i,u=-s*n;return o+u+s+e}function _re(r,e,t,n,i){if(Array.isArray(t)){const s=[];for(let a=0;a<t.length;a++)s[a]=wF(r[a],e[a],t[a],n,i);return s}return wF(r,e,t,n,i)}function xF(r,e){if(Array.isArray(r)){let t=0;for(let n=0;n<r.length;n++){const i=r[n]-e[n];t+=i*i}return Math.sqrt(t)}return Math.abs(r-e)}class yre extends x0{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:a=e}=this;let o=_re(s,a,t,n,i);const u=xF(o,t),d=xF(o,a);u<vF&&d<vF&&(o=t,this.end()),this._prevValue=a,this._currValue=o}}const bre={interpolation:mre,spring:yre};class vre{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,i){const{transitions:s}=this;if(s.has(e)){const u=s.get(e),{value:d=u.settings.fromValue}=u;t=d,this.remove(e)}if(i=uF(i),!i)return;const a=bre[i.type];if(!a){$n.error(`unsupported transition type '${i.type}'`)();return}const o=new a(this.timeline);o.start({...i,fromValue:t,toValue:n}),s.set(e,o)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function wre(r){const e=r[kA];for(const t in e){const n=e[t],{validate:i}=n;if(i&&!i(r[t],n))throw new Error(`Invalid prop ${t}: ${r[t]}`)}}function xre(r,e){const t=BF({newProps:r,oldProps:e,propTypes:r[kA],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=Cre(r,e);let i=!1;return n||(i=Tre(r,e)),{dataChanged:n,propsChanged:t,updateTriggersChanged:i,extensionsChanged:Ere(r,e),transitionsChanged:Bre(r,e)}}function Bre(r,e){if(!r.transitions)return!1;const t={},n=r[kA];let i=!1;for(const s in r.transitions){const a=n[s],o=a&&a.type;(o==="number"||o==="color"||o==="array")&&ax(r[s],e[s],a)&&(t[s]=!0,i=!0)}return i?t:!1}function BF({newProps:r,oldProps:e,ignoreProps:t={},propTypes:n={},triggerName:i="props"}){if(e===r)return!1;if(typeof r!="object"||r===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(r))if(!(s in t)){if(!(s in e))return`${i}.${s} added`;const a=ax(r[s],e[s],n[s]);if(a)return`${i}.${s} ${a}`}for(const s of Object.keys(e))if(!(s in t)){if(!(s in r))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(r,s)){const a=ax(r[s],e[s],n[s]);if(a)return`${i}.${s} ${a}`}}return!1}function ax(r,e,t){let n=t&&t.equal;return n&&!n(r,e,t)||!n&&(n=r&&e&&r.equals,n&&!n.call(r,e))?"changed deeply":!n&&e!==r?"changed shallowly":null}function Cre(r,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:n,_dataDiff:i}=r;return n?n(r.data,e.data)||(t="Data comparator detected a change"):r.data!==e.data&&(t="A new data container was supplied"),t&&i&&(t=i(r.data,e.data)||t),t}function Tre(r,e){if(e===null)return{all:!0};if("all"in r.updateTriggers&&CF(r,e,"all"))return{all:!0};const t={};let n=!1;for(const i in r.updateTriggers)i!=="all"&&CF(r,e,i)&&(t[i]=!0,n=!0);return n?t:!1}function Ere(r,e){if(e===null)return!0;const t=e.extensions,{extensions:n}=r;if(n===t)return!1;if(!t||!n||n.length!==t.length)return!0;for(let i=0;i<n.length;i++)if(!n[i].equals(t[i]))return!0;return!1}function CF(r,e,t){let n=r.updateTriggers[t];n=n??{};let i=e.updateTriggers[t];return i=i??{},BF({oldProps:i,newProps:n,triggerName:t})}const Sre="count(): argument not an object",Ire="count(): argument not a container";function Pre(r){if(!Fre(r))throw new Error(Sre);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(Mre(r))return Object.keys(r).length;throw new Error(Ire)}function Mre(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function Fre(r){return r!==null&&typeof r=="object"}function TF(r,e){if(!e)return r;const t={...r,...e};if("defines"in e&&(t.defines={...r.defines,...e.defines}),"modules"in e&&(t.modules=(r.modules||[]).concat(e.modules),e.modules.some(n=>n.name==="project64"))){const n=t.modules.findIndex(i=>i.name==="project32");n>=0&&t.modules.splice(n,1)}if("inject"in e)if(!r.inject)t.inject=e.inject;else{const n={...r.inject};for(const i in e.inject)n[i]=(n[i]||"")+e.inject[i];t.inject=n}return t}const Rre={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},lx={};function Lre(r,e,t,n){if(t instanceof Ks)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let i=null;t.compressed&&(i={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const{width:s,height:a}=t.data,o=e.createTexture({...t,sampler:{...Rre,...i,...n},mipLevels:e.getMipLevelCount(s,a)});return o.generateMipmapsWebGL(),lx[o.id]=r,o}function Ore(r,e){!e||!(e instanceof Ks)||lx[e.id]===r&&(e.delete(),delete lx[e.id])}const Ure={boolean:{validate(r,e){return!0},equal(r,e,t){return!!r==!!e}},number:{validate(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate(r,e){return e.optional&&!r||cx(r)&&(r.length===3||r.length===4)},equal(r,e,t){return Zl(r,e,1)}},accessor:{validate(r,e){const t=I0(r);return t==="function"||t===I0(e.value)},equal(r,e,t){return typeof e=="function"?!0:Zl(r,e,1)}},array:{validate(r,e){return e.optional&&!r||cx(r)},equal(r,e,t){const{compare:n}=t,i=Number.isInteger(n)?n:n?1:0;return n?Zl(r,e,i):r===e}},object:{equal(r,e,t){if(t.ignore)return!0;const{compare:n}=t,i=Number.isInteger(n)?n:n?1:0;return n?Zl(r,e,i):r===e}},function:{validate(r,e){return e.optional&&!r||typeof r=="function"},equal(r,e,t){return!t.compare&&t.ignore!==!1||r===e}},data:{transform:(r,e,t)=>{if(!r)return r;const{dataTransform:n}=t.props;return n?n(r):typeof r.shape=="string"&&r.shape.endsWith("-table")&&Array.isArray(r.data)?r.data:r}},image:{transform:(r,e,t)=>{const n=t.context;return!n||!n.device?null:Lre(t.id,n.device,r,{...e.parameters,...t.props.textureParameters})},release:(r,e,t)=>{Ore(t.id,r)}}};function Dre(r){const e={},t={},n={};for(const[i,s]of Object.entries(r)){const a=s?.deprecatedFor;if(a)n[i]=Array.isArray(a)?a:[a];else{const o=kre(i,s);e[i]=o,t[i]=o.value}}return{propTypes:e,defaultProps:t,deprecatedProps:n}}function kre(r,e){switch(I0(e)){case"object":return Om(r,e);case"array":return Om(r,{type:"array",value:e,compare:!1});case"boolean":return Om(r,{type:"boolean",value:e});case"number":return Om(r,{type:"number",value:e});case"function":return Om(r,{type:"function",value:e,compare:!0});default:return{name:r,type:"unknown",value:e}}}function Om(r,e){return"type"in e?{name:r,...Ure[e.type],...e}:"value"in e?{name:r,type:I0(e.value),...e}:{name:r,type:"object",value:e}}function cx(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function I0(r){return cx(r)?"array":r===null?"null":typeof r}function Nre(r,e){let t;for(let s=e.length-1;s>=0;s--){const a=e[s];"extensions"in a&&(t=a.extensions)}const n=ux(r.constructor,t),i=Object.create(n);i[w0]=r,i[qf]={},i[NA]={};for(let s=0;s<e.length;++s){const a=e[s];for(const o in a)i[o]=a[o]}return Object.freeze(i),i}const zre="_mergedDefaultProps";function ux(r,e){if(!(r instanceof P0.constructor))return{};let t=zre;if(e)for(const i of e){const s=i.constructor;s&&(t+=`:${s.extensionName||s.name}`)}const n=EF(r,t);return n||(r[t]=Qre(r,e||[]))}function Qre(r,e){if(!r.prototype)return null;const n=Object.getPrototypeOf(r),i=ux(n),s=EF(r,"defaultProps")||{},a=Dre(s),o=Object.assign(Object.create(null),i,a.defaultProps),u=Object.assign(Object.create(null),i?.[kA],a.propTypes),d=Object.assign(Object.create(null),i?.[k2],a.deprecatedProps);for(const p of e){const b=ux(p.constructor);b&&(Object.assign(o,b),Object.assign(u,b[kA]),Object.assign(d,b[k2]))}return Hre(o,r),jre(o,u),Vre(o,d),o[kA]=u,o[k2]=d,e.length===0&&!hx(r,"_propTypes")&&(r._propTypes=u),o}function Hre(r,e){const t=Gre(e);Object.defineProperties(r,{id:{writable:!0,value:t}})}function Vre(r,e){for(const t in e)Object.defineProperty(r,t,{enumerable:!1,set(n){const i=`${this.id}: ${t}`;for(const s of e[t])hx(this,s)||(this[s]=n);$n.deprecated(i,e[t].join("/"))()}})}function jre(r,e){const t={},n={};for(const i in e){const s=e[i],{name:a,value:o}=s;s.async&&(t[a]=o,n[a]=$re(a))}r[Ep]=t,r[qf]={},Object.defineProperties(r,n)}function $re(r){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||cF(e)?this[qf][r]=e:this[NA][r]=e},get(){if(this[NA]){if(r in this[NA])return this[NA][r]||this[Ep][r];if(r in this[qf]){const e=this[w0]&&this[w0].internalState;if(e&&e.hasAsyncProp(r))return e.getAsyncProp(r)||this[Ep][r]}}return this[Ep][r]}}}function hx(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function EF(r,e){return hx(r,e)&&r[e]}function Gre(r){const e=r.componentName;return e||$n.warn(`${r.name}.componentName not specified`)(),e||r.name}let Wre=0;class P0{constructor(...e){this.props=Nre(this,e),this.id=this.props.id,this.count=Wre++}clone(e){const{props:t}=this,n={};for(const i in t[Ep])i in t[NA]?n[i]=t[NA][i]:i in t[qf]&&(n[i]=t[qf][i]);return new this.constructor({...t,...n,...e})}}P0.componentName="Component",P0.defaultProps={};const qre=Object.freeze({});class Kre{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||qre}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[w0]||this.component;const t=e[NA]||{},n=e[qf]||e,i=e[Ep]||{};for(const s in t){const a=t[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,a),t[s]=this.getAsyncProp(s)}for(const s in n){const a=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,a)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(cF(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t===n.resolvedValue||t===n.lastValue?!1:(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;t.then(s=>{this.component&&(s=this._postProcessValue(n,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let s=[],a=0;for await(const o of t){if(!this.component)return;const{dataTransform:u}=this.component.props;u?s=u(o,s):s=s.concat(o),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:a,endRow:s.length}]}),a=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const i=this.component&&this.component.props[kA];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class Xre extends Kre{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,i=n?.props.fetch;return i?i(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const i=n.props.onDataLoad;e==="data"&&i&&i(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const Yre="layer.changeFlag",Zre="layer.initialize",Jre="layer.update",ene="layer.finalize",tne="layer.matched",SF=2**24-1,rne=Object.freeze([]),nne=bm(({oldViewport:r,viewport:e})=>r.equals(e));let Qc=new Uint8ClampedArray(0);const ine={data:{type:"data",value:rne,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,{propName:e,layer:t,loaders:n,loadOptions:i,signal:s})=>{const{resourceManager:a}=t.context;i=i||t.getLoadOptions(),n=n||t.props.loaders,s&&(i={...i,fetch:{...i?.fetch,signal:s}});let o=a.contains(r);return!o&&!i&&(a.add({resourceId:r,data:PA(r,n),persistent:!1}),o=!0),o?a.subscribe({resourceId:r,onChange:u=>t.internalState?.reloadAsyncProp(e,u),consumerId:t.id,requestId:e}):PA(r,n,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Qn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:r})=>[0,-r*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Op extends P0{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Tp.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){bo(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=f4(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,a]=JM(n,t.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,a]}unproject(e){return bo(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){bo(this.internalState);const n=this.internalState.viewport||this.context.viewport;return QZ(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Qn.DEFAULT||e===Qn.LNGLAT||e===Qn.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){bo(e instanceof Uint8Array);const[t,n,i]=e;return t+n*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Pre(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=TF(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=TF(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const i of n)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:i}=e,s=this.internalState.hasPickingBuffer,a=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(o=>o.getNeedsPickingBuffer.call(this,o));if(s!==a){this.internalState.hasPickingBuffer=a;const{pickingColors:o,instancePickingColors:u}=t.attributes,d=o||u;d&&(a&&d.constant&&(d.constant=!1,t.invalidate(d.id)),!d.value&&!a&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const n of this.getModels())n.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:n}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!nne({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const i in t)Object.defineProperty(n,i,{value:t[i]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const n=Math.floor(Qc.length/4);if(this.internalState.usesPickingColorCache=!0,n<t){t>SF&&$n.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Qc=xm.allocate(Qc,t,{size:4,copy:!0,maxCount:Math.max(t,SF)});const i=Math.floor(Qc.length/4),s=[0,0,0];for(let a=n;a<i;a++)this.encodePickingColor(a,s),Qc[a*4+0]=s[0],Qc[a*4+1]=s[1],Qc[a*4+2]=s[2],Qc[a*4+3]=0}e.value=Qc.subarray(0,t*4)}_setModelAttributes(e,t,n=!1){if(!Object.keys(t).length)return;if(n){const o=this.getAttributeManager();e.setBufferLayout(o.getBufferLayouts(e)),t=o.getAttributes()}const i=e.userData?.excludeAttributes||{},s={},a={};for(const o in t){if(i[o])continue;const u=t[o].getValue();for(const d in u){const p=u[d];p instanceof bs?t[o].settings.isIndexed?e.setIndexBuffer(p):s[d]=p:p&&(a[d]=p)}}e.setAttributes(s),e.setConstantAttributes(a)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,s=n||i,a=s&&t.attributes&&t.attributes[s.id];if(a&&a.value){const o=a.value,u=this.encodePickingColor(e);for(let d=0;d<t.length;d++){const p=s.getVertexOffset(d);o[p]===u[0]&&o[p+1]===u[1]&&o[p+2]===u[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,i=t||n;if(!i)return;const s=i.getVertexOffset(e),a=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(a-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Qc.buffer&&(n.value=Qc.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){bo(!this.internalState),bo(Number.isFinite(this.props.coordinateSystem)),sa(Zre,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Xre({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>($n.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new vre(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){sa(tne,this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(sa(Jre,this,e),!e)return;const t=this.props,n=this.context,i=this.internalState,s=n.viewport,a=this._updateUniformTransition();i.propsInTransition=a,n.viewport=i.viewport||s,this.props=a;try{const o=this._getUpdateParams(),u=this.getModels();if(n.device)this.updateState(o);else try{this.updateState(o)}catch{}for(const p of this.props.extensions)p.updateState.call(this,o,p);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==u[0];this._postUpdate(o,d)}finally{n.viewport=s,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){sa(ene,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,a=this.context;this.props=this.internalState.propsInTransition||s;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:o}=this.props,u=o&&o(n)||[0,0];a.device instanceof ix&&a.device.setParametersWebGL({polygonOffset:u});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...i}):d.setParameters(i);if(a.device instanceof ix)a.device.withParametersWebGL(i,()=>{const d={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:i,context:a};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:t,uniforms:n,parameters:i,context:a};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)}}finally{this.props=s}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const a=e[i],o=t[i];a&&Array.isArray(o)&&(t.dataChanged=Array.isArray(a)?o.concat(a):a,s=!0);default:t[i]||(t[i]=e[i],s=!0)}s&&sa(Yre,this,i,e)}const n=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const n=xre(e,t);if(n.updateTriggersChanged)for(const i in n.updateTriggersChanged)n.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(n.transitionsChanged)for(const i in n.transitionsChanged)this.internalState.uniformTransitions.add(i,t[i],e[i],e.transitions?.[i]);return this.setChangeFlags(n)}validateProps(){wre(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&typeof n=="function"&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new gre(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:i}=e,s=this.state.model;s?.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:o,highlightColor:u}=n;if(t||i.autoHighlight!==a||i.highlightedObjectIndex!==o||i.highlightColor!==u){const d={};Array.isArray(u)&&(d.highlightColor=u),(t||i.autoHighlight!==a||o!==i.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=n?n.getNeedsRedraw(e):!1;if(t=t||i,t)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Op.defaultProps=ine,Op.layerName="Layer";const sne="compositeLayer.renderLayers";class IF extends Op{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||t}getSubLayerRow(e,t,n){return e.__source={parent:this,object:t,index:n},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,i)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:n,visible:i,parameters:s,getPolygonOffset:a,highlightedObjectIndex:o,autoHighlight:u,highlightColor:d,coordinateSystem:p,coordinateOrigin:b,wrapLongitude:C,positionFormat:w,modelMatrix:M,extensions:P,fetch:k,operation:D,_subLayerProps:j}=this.props,H={id:"",updateTriggers:{},opacity:t,pickable:n,visible:i,parameters:s,getPolygonOffset:a,highlightedObjectIndex:o,autoHighlight:u,highlightColor:d,coordinateSystem:p,coordinateOrigin:b,wrapLongitude:C,positionFormat:w,modelMatrix:M,extensions:P,fetch:k,operation:D},N=j&&e.id&&j[e.id],q=N&&N.updateTriggers,W=e.id||"sublayer";if(N){const ie=this.props[kA],se=e.type?e.type._propTypes:{};for(const Z in N){const fe=se[Z]||ie[Z];fe&&fe.type==="accessor"&&(N[Z]=this.getSubLayerAccessor(N[Z]))}}Object.assign(H,e,N),H.id=`${this.props.id}-${W}`,H.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...q};for(const ie of P){const se=ie.getSubLayerProps.call(this,ie);se&&Object.assign(H,se,{updateTriggers:Object.assign(H.updateTriggers,se.updateTriggers)})}return H}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();if(i){const s=this.renderLayers();n=Kf(s,Boolean),this.internalState.subLayers=n}sa(sne,this,i,n);for(const s of n)s.parent=this}}IF.layerName="CompositeLayer";const M0=Math.PI/180,PF=180/Math.PI,F0=6370972,Up=256;function one(){const r=Up/F0,e=Math.PI/180*Up;return{unitsPerMeter:[r,r,r],unitsPerMeter2:[0,0,0],metersPerUnit:[1/r,1/r,1/r],unitsPerDegree:[e,e,r],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/r]}}class ane extends vp{constructor(e={}){const{longitude:t=0,zoom:n=0,nearZMultiplier:i=.5,farZMultiplier:s=1,resolution:a=10}=e;let{latitude:o=0,height:u,altitude:d=1.5,fovy:p}=e;o=Math.max(Math.min(o,UA),-UA),u=u||1,p?d=x2(p):p=wm(d);const b=1/Math.PI/Math.cos(o*Math.PI/180),C=Math.pow(2,n)*b,w=e.nearZ??i,M=e.farZ??(d+Up*2*C/u)*s,P=new zn().lookAt({eye:[0,-d,0],up:[0,0,1]});P.rotateX(o*M0),P.rotateZ(-t*M0),P.scale(C/u),super({...e,height:u,viewMatrix:P,longitude:t,latitude:o,zoom:n,distanceScales:one(),fovy:p,focalDistance:d,near:w,far:M}),this.scale=C,this.latitude=o,this.longitude=t,this.resolution=a}get projectionMode(){return vl.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),s=this.unproject([this.width,this.height/2],t),a=this.unproject([this.width/2,this.height],t);return s[0]<this.longitude&&(s[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],s[0],i[0],a[0]),Math.min(n[1],s[1],i[1],a[1]),Math.max(n[0],s[0],i[0],a[0]),Math.max(n[1],s[1],i[1],a[1])]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,s,a]=e,o=t?s:this.height-s,{pixelUnprojectionMatrix:u}=this;let d;if(Number.isFinite(a))d=Ax(u,[i,o,a,1]);else{const w=Ax(u,[i,o,-1,1]),M=Ax(u,[i,o,1,1]),P=((n||0)/F0+1)*Up,k=Zw(JP([],w,M)),D=Zw(w),j=Zw(M),N=4*((4*D*j-(k-D-j)**2)/16)/k,q=Math.sqrt(D-N),W=Math.sqrt(Math.max(0,P*P-N)),ie=(q-W)/Math.sqrt(k);d=AK([],w,M,ie)}const[p,b,C]=this.unprojectPosition(d);return Number.isFinite(a)?[p,b,C]:Number.isFinite(n)?[p,b,n]:[p,b]}projectPosition(e){const[t,n,i=0]=e,s=t*M0,a=n*M0,o=Math.cos(a),u=(i/F0+1)*Up;return[Math.sin(s)*o*u,-Math.cos(s)*o*u,Math.sin(a)*u]}unprojectPosition(e){const[t,n,i]=e,s=eM(e),a=Math.asin(i/s),u=Math.atan2(t,-n)*PF,d=a*PF,p=(s/Up-1)*F0;return[u,d,p]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function Ax(r,e){const t=pp([],e,r);return i2(t,t,1/t[3]),t}class lne extends x4{applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=Uc(i,n,t);const{longitude:s,latitude:a}=e;return(s<-180||s>180)&&(e.longitude=MZ(s+180,360)-180),e.latitude=Uc(a,-UA,UA),e}}class cne extends v4{constructor(){super(...arguments),this.ControllerState=lne,this.transition={transitionDuration:300,transitionInterpolator:new z2(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class MF extends y4{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?Gf:ane}get ControllerType(){return cne}}MF.displayName="GlobeView";const Um="mapbox",fx=512,une=Math.PI/180;function FF({map:r,gl:e,deck:t}){if(r.__deck)return r.__deck;const n=t?.props._customRender,i=t?.props.onLoad,s={...t?.props,_customRender:()=>{r.triggerRepaint(),n?.("")}};s.parameters={...R0(r,!0),...s.parameters},s.views||(s.views=Dm(r));let a;return(!t||t.props.gl===e)&&(Object.assign(s,{gl:e,width:null,height:null,touchAction:"unset",viewState:km(r)}),t?.isInitialized?RF(t,r):s.onLoad=()=>{i?.(),RF(a,r)}),t?(a=t,t.setProps(s),t.userData.isExternal=!0):(a=new Lm(s),r.on("remove",()=>{LF(r)})),a.userData.mapboxLayers=new Set,r.__deck=a,r.on("render",()=>{a.isInitialized&&gne(a,r)}),a}function RF(r,e){const t=()=>{r.isInitialized?mne(r,e):e.off("move",t)};e.on("move",t)}function LF(r){r.__deck?.finalize(),r.__deck=null}function R0(r,e){const t=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return dx(r)==="globe"&&(t.cullMode="back"),t}function hne(r,e){r.userData.mapboxLayers.add(e),px(r)}function Ane(r,e){r.userData.mapboxLayers.delete(e),px(r)}function fne(r,e){px(r)}function dne(r,e,t,n){let{currentViewport:i}=r.userData,s=!1;i||(i=OF(r,e,n),r.userData.currentViewport=i,s=!0),r.isInitialized&&r._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:a=>(!r.props.layerFilter||r.props.layerFilter(a))&&(t.id===a.layer.id||a.layer.props.operation.includes("terrain")),clearStack:s,clearCanvas:!1})}function dx(r){const e=r.getProjection?.(),t=e?.type||e?.name;if(t==="globe")return"globe";if(t&&t!=="mercator")throw new Error("Unsupported projection");return"mercator"}function Dm(r){return dx(r)==="globe"?new MF({id:Um}):new Q2({id:Um})}function km(r){const{lng:e,lat:t}=r.getCenter(),n={longitude:(e+540)%360-180,latitude:t,zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch(),padding:r.getPadding(),repeat:r.getRenderWorldCopies()};return r.getTerrain?.()&&pne(r,n),n}function pne(r,e){if(r.getFreeCameraOptions){const{position:t}=r.getFreeCameraOptions();if(!t||t.z===void 0)return;const n=r.transform.height,{longitude:i,latitude:s,pitch:a}=e,o=t.x*fx,u=(1-t.y)*fx,d=t.z*fx,p=vm([i,s]),b=o-p[0],C=u-p[1],w=Math.sqrt(b*b+C*C),M=a*une,P=1.5*n,k=M<.001?P*Math.cos(M)/d:P*Math.sin(M)/w;e.zoom=Math.log2(k);const D=P*Math.cos(M)/k,j=d-D;e.position=[0,0,j/b0(s)]}else typeof r.transform.elevation=="number"&&(e.position=[0,0,r.transform.elevation])}function OF(r,e,t){const n=km(e),{views:i}=r.props,s=i&&Kf(i).find(u=>u.id===Um)||Dm(e);t&&(s.props.nearZMultiplier=.2);const a=t?.nearZ??e.transform._nearZ,o=t?.farZ??e.transform._farZ;return Number.isFinite(a)&&(n.nearZ=a/e.transform.height,n.farZ=o/e.transform.height),s.makeViewport({width:r.width,height:r.height,viewState:n})}function gne(r,e){const{mapboxLayers:t,isExternal:n}=r.userData;if(n){const i=Array.from(t,p=>p.id),a=Kf(r.props.layers,Boolean).some(p=>p&&!i.includes(p.id));let o=r.getViewports();const u=o.findIndex(p=>p.id===Um),d=o.length>1||u<0;(a||d)&&(u>=0&&(o=o.slice(),o[u]=OF(r,e)),r._drawLayers("mapbox-repaint",{viewports:o,layerFilter:p=>(!r.props.layerFilter||r.props.layerFilter(p))&&(p.viewport.id!==Um||!i.includes(p.layer.id)),clearCanvas:!1}))}r.userData.currentViewport=null}function mne(r,e){r.setProps({viewState:km(e)}),r.needsRedraw({clearRedrawFlags:!0})}function px(r){if(r.userData.isExternal)return;const e=[];r.userData.mapboxLayers.forEach(t=>{const n=t.props.type,i=new n(t.props);e.push(i)}),r.setProps({layers:e})}class _ne{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=FF({map:e,gl:t,deck:this.props.deck}),hne(this.deck,this)}onRemove(){this.deck&&Ane(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&fne(this.deck)}render(e,t){dne(this.deck,this.map,this,t)}}const gx="__UNDEFINED__";function L0(r,e,t,n){if(!r||!e||!r.style||!r.style._loaded)return;const i=Kf(n,Boolean);if(t!==n){const o=Kf(t,Boolean),u=new Set(o.map(d=>d.id));for(const d of i)u.delete(d.id);for(const d of u)r.getLayer(d)&&r.removeLayer(d)}for(const o of i){const u=r.getLayer(o.id);u?(u.implementation||u).setProps(o.props):r.addLayer(new _ne({id:o.id,deck:e,slot:o.props.slot}),o.props.beforeId)}const s=r.style._order,a={};for(const o of i){let{beforeId:u}=o.props;(!u||!s.includes(u))&&(u=gx),a[u]=a[u]||[],a[u].push(o.id)}for(const o in a){const u=a[o];let d=o===gx?s.length:s.indexOf(o),p=o===gx?void 0:o;for(let b=u.length-1;b>=0;b--){const C=u[b],w=s.indexOf(C);w!==d-1&&(r.moveLayer(C,p),w>d&&d++),d--,p=C}}}class yne{constructor(e){this._handleStyleChange=()=>{if(L0(this._map,this._deck,this._props.layers,this._props.layers),!this._map)return;dx(this._map)&&!this._props.views&&this._deck?.setProps({views:Dm(this._map)})},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:n,clientHeight:i}=this._map.getContainer();Object.assign(this._container.style,{width:`${n}px`,height:`${i}px`})}},this._updateViewState=()=>{const n=this._deck,i=this._map;n&&i&&(n.setProps({views:this._props.views||Dm(i),viewState:km(i)}),n.isInitialized&&n.redraw())},this._handleMouseEvent=n=>{const i=this._deck;if(!i||!i.isInitialized)return;const s={type:n.type,offsetCenter:n.point,srcEvent:n},a=this._lastMouseDownPoint;switch(!n.point&&a&&(s.deltaX=n.originalEvent.clientX-a.clientX,s.deltaY=n.originalEvent.clientY-a.clientY,s.offsetCenter={x:a.x+s.deltaX,y:a.y+s.deltaY}),s.type){case"mousedown":i._onPointerDown(s),this._lastMouseDownPoint={...n.point,clientX:n.originalEvent.clientX,clientY:n.originalEvent.clientY};break;case"dragstart":s.type="panstart",i._onEvent(s);break;case"drag":s.type="panmove",i._onEvent(s);break;case"dragend":s.type="panend",i._onEvent(s);break;case"click":s.tapCount=1,i._onEvent(s);break;case"dblclick":s.type="click",s.tapCount=2,i._onEvent(s);break;case"mousemove":s.type="pointermove",i._onPointerMove(s);break;case"mouseout":s.type="pointerleave",i._onPointerMove(s);break;default:return}};const{interleaved:t=!1}=e;this._interleaved=t,this._props=this.filterProps(e)}filterProps(e){const{interleaved:t=!1,useDevicePixels:n,...i}=e;return!t&&n!==void 0&&(i.useDevicePixels=n),i}setProps(e){this._interleaved&&e.layers&&L0(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,this.filterProps(e)),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...R0(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new Lm({...this._props,parent:t,parameters:{...R0(e,!1),...this._props.parameters},views:this._props.views||Dm(e),viewState:km(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){const t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&$n.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=FF({map:e,gl:t,deck:new Lm({...this._props,gl:t,parameters:{...R0(e,!1),...this._props.parameters},deviceProps:{createCanvasContext:{autoResize:!0}}})}),e.on("styledata",this._handleStyleChange),L0(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),L0(e,this._deck,this._props.layers,[]),LF(e)}getDefaultPosition(){return"top-left"}pickObject(e){return bo(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return bo(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return bo(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const bne=`struct PointCloudUniforms {
  radiusPixels: f32,
  sizeUnits: i32,
};

@group(0) @binding(3)
var<uniform> pointCloud: PointCloudUniforms;
`,UF=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,vne={name:"pointCloud",source:bne,vs:UF,fs:UF,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},wne=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,xne=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Bne=`struct ConstantAttributes {
  instanceNormals: vec3<f32>,
  instanceColors: vec4<f32>,
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(1.0, 0.0, 0.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceNormals: vec3<f32>,
  @location(4) instanceColors: vec4<f32>,
  @location(5) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) unitPosition: vec2<f32>,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;
  
  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;
  // geometry.normal = project_normal(instanceNormals);

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  // Find the center of the point and add the current vertex
  let offset = vec3<f32>(attributes.positions.xy * project_unit_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
  // DECKGL_FILTER_SIZE(offset, geometry);

  varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
  // DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  let clipPixels = project_pixel_size_to_clipspace(offset.xy);
  varyings.position.x += clipPixels.x;
  varyings.position.y += clipPixels.y;

  // Apply lighting
  let lightColor = lighting_getLightColor2(attributes.instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);

  // Apply opacity to instance color, or return instance picking color
  varyings.vColor = vec4(lightColor, attributes.instanceColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(vColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition.xy;

  let distToCenter = length(varyings.unitPosition);
  if (distToCenter > 1.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  fragColor = varyings.vColor;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
}
`,DF=[0,0,0,255],kF=[0,0,1],Cne={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:r=>r.position},getNormal:{type:"accessor",value:kF},getColor:{type:"accessor",value:DF},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Tne(r){const{header:e,attributes:t}=r;if(!(!e||!t)&&(r.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0)){const{size:n,value:i}=t.COLOR_0;t.instanceColors={size:n,type:"unorm8",value:i}}}class mx extends Op{getShaders(){return super.getShaders({vs:wne,fs:xne,source:Bne,modules:[_2,RX,yM,C2,vne]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:kF},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:DF}})}updateState(e){const{changeFlags:t,props:n}=e;super.updateState(e),t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),t.dataChanged&&Tne(n.data)}draw({uniforms:e}){const{pointSize:t,sizeUnits:n}=this.props,i=this.state.model,s={sizeUnits:ym[n],radiusPixels:t};i.shaderInputs.setProps({pointCloud:s}),this.context.device.type==="webgpu"&&(i.instanceCount=this.props.data.length),i.draw(this.context.renderPass)}_getModel(){const e=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,t=[];for(let n=0;n<3;n++){const i=n/3*Math.PI*2;t.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new DA(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Bp({topology:"triangle-list",attributes:{positions:new Float32Array(t)}}),parameters:e,isInstanced:!0})}}mx.layerName="PointCloudLayer",mx.defaultProps=Cne;const Bl={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new It,new It;const Nm=new It,NF=new It;class zm{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new It,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=Nm.from(t),this.center=new It().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new zm(this.center,this.radius)}union(e){const t=this.center,n=this.radius,i=e.center,s=e.radius,a=Nm.copy(i).subtract(t),o=a.magnitude();if(n>=o+s)return this.clone();if(s>=o+n)return e.clone();const u=(n+o+s)*.5;return NF.copy(a).scale((-n+u)/o).add(t),this.center.copy(NF),this.radius=u,this}expand(e){const n=Nm.from(e).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(e){this.center.transform(e);const t=FK(Nm,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const n=Nm.from(e).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(e){const t=this.center,n=this.radius,s=e.normal.dot(t)+e.distance;return s<-n?Bl.OUTSIDE:s<n?Bl.INTERSECTING:Bl.INSIDE}}const Ene=new It,Sne=new It,O0=new It,U0=new It,D0=new It,Ine=new It,Pne=new It,Uh={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Qm{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new It().from(e),this.halfAxes=new vs(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new It(e).len(),new It(t).len(),new It(n).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),i=new It(e).normalize(),s=new It(t).normalize(),a=new It(n).normalize();return new mm().fromMatrix3(new vs([...i,...s,...a]))}fromCenterHalfSizeQuaternion(e,t,n){const i=new mm(n),s=new vs().fromQuaternion(i);return s[0]=s[0]*t[0],s[1]=s[1]*t[0],s[2]=s[2]*t[0],s[3]=s[3]*t[1],s[4]=s[4]*t[1],s[5]=s[5]*t[1],s[6]=s[6]*t[2],s[7]=s[7]*t[2],s[8]=s[8]*t[2],this.center=new It().from(e),this.halfAxes=s,this}clone(){return new Qm(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new zm){const t=this.halfAxes,n=t.getColumn(0,O0),i=t.getColumn(1,U0),s=t.getColumn(2,D0),a=Ene.copy(n).add(i).add(s);return e.center.copy(this.center),e.radius=a.magnitude(),e}intersectPlane(e){const t=this.center,n=e.normal,i=this.halfAxes,s=n.x,a=n.y,o=n.z,u=Math.abs(s*i[Uh.COLUMN0ROW0]+a*i[Uh.COLUMN0ROW1]+o*i[Uh.COLUMN0ROW2])+Math.abs(s*i[Uh.COLUMN1ROW0]+a*i[Uh.COLUMN1ROW1]+o*i[Uh.COLUMN1ROW2])+Math.abs(s*i[Uh.COLUMN2ROW0]+a*i[Uh.COLUMN2ROW1]+o*i[Uh.COLUMN2ROW2]),d=n.dot(t)+e.distance;return d<=-u?Bl.OUTSIDE:d>=u?Bl.INSIDE:Bl.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=Sne.from(e).subtract(this.center),n=this.halfAxes,i=n.getColumn(0,O0),s=n.getColumn(1,U0),a=n.getColumn(2,D0),o=i.magnitude(),u=s.magnitude(),d=a.magnitude();i.normalize(),s.normalize(),a.normalize();let p=0,b;return b=Math.abs(t.dot(i))-o,b>0&&(p+=b*b),b=Math.abs(t.dot(s))-u,b>0&&(p+=b*b),b=Math.abs(t.dot(a))-d,b>0&&(p+=b*b),p}computePlaneDistances(e,t,n=[-0,-0]){let i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const a=this.center,o=this.halfAxes,u=o.getColumn(0,O0),d=o.getColumn(1,U0),p=o.getColumn(2,D0),b=Ine.copy(u).add(d).add(p).add(a),C=Pne.copy(b).subtract(e);let w=t.dot(C);return i=Math.min(w,i),s=Math.max(w,s),b.copy(a).add(u).add(d).subtract(p),C.copy(b).subtract(e),w=t.dot(C),i=Math.min(w,i),s=Math.max(w,s),b.copy(a).add(u).subtract(d).add(p),C.copy(b).subtract(e),w=t.dot(C),i=Math.min(w,i),s=Math.max(w,s),b.copy(a).add(u).subtract(d).subtract(p),C.copy(b).subtract(e),w=t.dot(C),i=Math.min(w,i),s=Math.max(w,s),a.copy(b).subtract(u).add(d).add(p),C.copy(b).subtract(e),w=t.dot(C),i=Math.min(w,i),s=Math.max(w,s),a.copy(b).subtract(u).add(d).subtract(p),C.copy(b).subtract(e),w=t.dot(C),i=Math.min(w,i),s=Math.max(w,s),a.copy(b).subtract(u).subtract(d).add(p),C.copy(b).subtract(e),w=t.dot(C),i=Math.min(w,i),s=Math.max(w,s),a.copy(b).subtract(u).subtract(d).subtract(p),C.copy(b).subtract(e),w=t.dot(C),i=Math.min(w,i),s=Math.max(w,s),n[0]=i,n[1]=s,n}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,O0);t.transformAsPoint(e);const n=this.halfAxes.getColumn(1,U0);n.transformAsPoint(e);const i=this.halfAxes.getColumn(2,D0);return i.transformAsPoint(e),this.halfAxes=new vs([...t,...n,...i]),this}getTransform(){throw new Error("not implemented")}}const zF=new It,QF=new It;class zu{constructor(e=[0,0,1],t=0){this.normal=new It,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return kc(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=zF.from(e),this.normal.from(t).normalize();const n=-this.normal.dot(e);return this.distance=n,this}fromCoefficients(e,t,n,i){return this.normal.set(e,t,n),kc(Dc(this.normal.len(),1)),this.distance=i,this}clone(){return new zu(this.normal,this.distance)}equals(e){return Dc(this.distance,e.distance)&&Dc(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=QF.copy(this.normal).transformAsVector(e).normalize(),n=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(n,t)}projectPointOntoPlane(e,t=[0,0,0]){const n=zF.from(e),i=this.getPointDistance(n),s=QF.copy(this.normal).scale(i);return n.subtract(s).to(t)}}const HF=[new It([1,0,0]),new It([0,1,0]),new It([0,0,1])],VF=new It,Mne=new It;class Jl{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*HF.length;const t=e.center,n=e.radius;let i=0;for(const s of HF){let a=this.planes[i],o=this.planes[i+1];a||(a=this.planes[i]=new zu),o||(o=this.planes[i+1]=new zu);const u=VF.copy(s).scale(-n).add(t);a.fromPointNormal(u,s);const d=VF.copy(s).scale(n).add(t),p=Mne.copy(s).negate();o.fromPointNormal(d,p),i+=2}return this}computeVisibility(e){let t=Bl.INSIDE;for(const n of this.planes)switch(e.intersectPlane(n)){case Bl.OUTSIDE:return Bl.OUTSIDE;case Bl.INTERSECTING:t=Bl.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(kc(Number.isFinite(t),"parentPlaneMask is required."),t===Jl.MASK_OUTSIDE||t===Jl.MASK_INSIDE)return t;let n=Jl.MASK_INSIDE;const i=this.planes;for(let s=0;s<this.planes.length;++s){const a=s<31?1<<s:0;if(s<31&&(t&a)===0)continue;const o=i[s],u=e.intersectPlane(o);if(u===Bl.OUTSIDE)return Jl.MASK_OUTSIDE;u===Bl.INTERSECTING&&(n|=a)}return n}}Jl.MASK_OUTSIDE=4294967295,Jl.MASK_INSIDE=0,Jl.MASK_INDETERMINATE=2147483647,new It,new It,new It,new It,new It,new It,new It,new It,new It,new It,new It,new It,new It,new It,new It,new It,new It;const Qu=new vs,Fne=new vs,Rne=new vs,k0=new vs,jF=new vs;function Lne(r,e={}){const t=mX,n=10;let i=0,s=0;const a=Fne,o=Rne;a.identity(),o.copy(r);const u=t*One(o);for(;s<n&&Une(o)>u;)Dne(o,k0),jF.copy(k0).transpose(),o.multiplyRight(k0),o.multiplyLeft(jF),a.multiplyRight(k0),++i>2&&(++s,i=0);return e.unitary=a.toTarget(e.unitary),e.diagonal=o.toTarget(e.diagonal),e}function One(r){let e=0;for(let t=0;t<9;++t){const n=r[t];e+=n*n}return Math.sqrt(e)}const _x=[1,0,0],yx=[2,2,1];function Une(r){let e=0;for(let t=0;t<3;++t){const n=r[Qu.getElementIndex(yx[t],_x[t])];e+=2*n*n}return Math.sqrt(e)}function Dne(r,e){const t=AM;let n=0,i=1;for(let d=0;d<3;++d){const p=Math.abs(r[Qu.getElementIndex(yx[d],_x[d])]);p>n&&(i=d,n=p)}const s=_x[i],a=yx[i];let o=1,u=0;if(Math.abs(r[Qu.getElementIndex(a,s)])>t){const d=r[Qu.getElementIndex(a,a)],p=r[Qu.getElementIndex(s,s)],b=r[Qu.getElementIndex(a,s)],C=(d-p)/2/b;let w;C<0?w=-1/(-C+Math.sqrt(1+C*C)):w=1/(C+Math.sqrt(1+C*C)),o=1/Math.sqrt(1+w*w),u=w*o}return vs.IDENTITY.to(e),e[Qu.getElementIndex(s,s)]=e[Qu.getElementIndex(a,a)]=o,e[Qu.getElementIndex(a,s)]=u,e[Qu.getElementIndex(s,a)]=-u,e}const VA=new It,kne=new It,Nne=new It,zne=new It,Qne=new It,Hne=new vs,Vne={diagonal:new vs,unitary:new vs};function jne(r,e=new Qm){if(!r||r.length===0)return e.halfAxes=new vs([0,0,0,0,0,0,0,0,0]),e.center=new It,e;const t=r.length,n=new It(0,0,0);for(const Z of r)n.add(Z);const i=1/t;n.multiplyByScalar(i);let s=0,a=0,o=0,u=0,d=0,p=0;for(const Z of r){const fe=VA.copy(Z).subtract(n);s+=fe.x*fe.x,a+=fe.x*fe.y,o+=fe.x*fe.z,u+=fe.y*fe.y,d+=fe.y*fe.z,p+=fe.z*fe.z}s*=i,a*=i,o*=i,u*=i,d*=i,p*=i;const b=Hne;b[0]=s,b[1]=a,b[2]=o,b[3]=a,b[4]=u,b[5]=d,b[6]=o,b[7]=d,b[8]=p;const{unitary:C}=Lne(b,Vne),w=e.halfAxes.copy(C);let M=w.getColumn(0,Nne),P=w.getColumn(1,zne),k=w.getColumn(2,Qne),D=-Number.MAX_VALUE,j=-Number.MAX_VALUE,H=-Number.MAX_VALUE,N=Number.MAX_VALUE,q=Number.MAX_VALUE,W=Number.MAX_VALUE;for(const Z of r)VA.copy(Z),D=Math.max(VA.dot(M),D),j=Math.max(VA.dot(P),j),H=Math.max(VA.dot(k),H),N=Math.min(VA.dot(M),N),q=Math.min(VA.dot(P),q),W=Math.min(VA.dot(k),W);M=M.multiplyByScalar(.5*(N+D)),P=P.multiplyByScalar(.5*(q+j)),k=k.multiplyByScalar(.5*(W+H)),e.center.copy(M).add(P).add(k);const ie=kne.set(D-N,j-q,H-W).multiplyByScalar(.5),se=new vs([ie[0],0,0,0,ie[1],0,0,0,ie[2]]);return e.halfAxes.multiplyRight(se),e}const bx=Math.PI/180,N0=new Float32Array(16),$F=new Float32Array(12);function GF(r,e,t){const n=e[0]*bx,i=e[1]*bx,s=e[2]*bx,a=Math.sin(s),o=Math.sin(n),u=Math.sin(i),d=Math.cos(s),p=Math.cos(n),b=Math.cos(i),C=t[0],w=t[1],M=t[2];r[0]=C*b*p,r[1]=C*u*p,r[2]=C*-o,r[3]=w*(-u*d+b*o*a),r[4]=w*(b*d+u*o*a),r[5]=w*p*a,r[6]=M*(u*a+b*o*d),r[7]=M*(-b*a+u*o*d),r[8]=M*p*d}function WF(r){return r[0]=r[0],r[1]=r[1],r[2]=r[2],r[3]=r[4],r[4]=r[5],r[5]=r[6],r[6]=r[8],r[7]=r[9],r[8]=r[10],r[9]=r[12],r[10]=r[13],r[11]=r[14],r.subarray(0,12)}const qF={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(r,{startRow:e,endRow:t}){const{data:n,getOrientation:i,getScale:s,getTranslation:a,getTransformMatrix:o}=this.props,u=Array.isArray(o),d=u&&o.length===16,p=Array.isArray(s),b=Array.isArray(i),C=Array.isArray(a),w=d||!u&&!!o(n[0]);w?r.constant=d:r.constant=b&&p&&C;const M=r.value;if(r.constant){let P;w?(N0.set(o),P=WF(N0)):(P=$F,GF(P,i,s),P.set(a,9)),r.value=new Float32Array(P)}else{let P=e*r.size;const{iterable:k,objectInfo:D}=lF(n,e,t);for(const j of k){D.index++;let H;if(w)N0.set(d?o:o(j,D)),H=WF(N0);else{H=$F;const N=b?i:i(j,D),q=p?s:s(j,D);GF(H,N,q),H.set(C?a:a(j,D),9)}M[P++]=H[0],M[P++]=H[1],M[P++]=H[2],M[P++]=H[3],M[P++]=H[4],M[P++]=H[5],M[P++]=H[6],M[P++]=H[7],M[P++]=H[8],M[P++]=H[9],M[P++]=H[10],M[P++]=H[11]}}}};function KF(r,e){return e===Qn.CARTESIAN||e===Qn.METER_OFFSETS||e===Qn.DEFAULT&&!r.isGeospatial}const XF=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,$ne={name:"simpleMesh",vs:XF,fs:XF,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},Gne=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Wne=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function vx(r){const e=r.positions||r.POSITION;$n.assert(e,'no "postions" or "POSITION" attribute in mesh');const t=e.value.length/e.size;let n=r.COLOR_0||r.colors;n||(n={size:3,value:new Float32Array(t*3).fill(1)});let i=r.NORMAL||r.normals;i||(i={size:3,value:new Float32Array(t*3).fill(0)});let s=r.TEXCOORD_0||r.texCoords;return s||(s={size:2,value:new Float32Array(t*2).fill(0)}),{positions:e,colors:n,normals:i,texCoords:s}}function YF(r){return r instanceof Bp?(r.attributes=vx(r.attributes),r):r.attributes?new Bp({...r,topology:"triangle-list",attributes:vx(r.attributes)}):new Bp({topology:"triangle-list",attributes:vx(r)})}const qne={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class wx extends Op{getShaders(){return super.getShaders({vs:Gne,fs:Wne,modules:[_2,bM,C2,$ne]})}getBounds(){if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:t}=this.props;if(!t)return null;if(e=t.header?.boundingBox,!e){const{attributes:n}=YF(t);n.POSITION=n.POSITION||n.positions,e=eG(n)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:qF}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e;if(t.mesh!==n.mesh||i.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),t.mesh){this.state.model=this.getModel(t.mesh);const s=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(s.NORMAL||s.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==n.texture&&t.texture instanceof Ks&&this.setTexture(t.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:t}=this.state;if(!t)return;const{viewport:n,renderPass:i}=this.context,{sizeScale:s,coordinateSystem:a,_instanced:o}=this.props,u={sizeScale:s,composeModelMatrix:!o||KF(n,a),flatShading:!this.state.hasNormals};t.shaderInputs.setProps({simpleMesh:u}),t.draw(i)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(e){const t=new DA(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:YF(e),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:i}=this.state,s={sampler:n||i,hasTexture:!!n};return t.shaderInputs.setProps({simpleMesh:s}),t}setTexture(e){const{emptyTexture:t,model:n}=this.state;if(n){const i={sampler:e||t,hasTexture:!!e};n.shaderInputs.setProps({simpleMesh:i})}}}wx.defaultProps=qne,wx.layerName="SimpleMeshLayer";const Kne="4.3.3";function Xne(r){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,r)}function Yne(r){return globalThis.loaders?.modules?.[r]||null}function Zne(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const Jne=Zne();function eie(r,e){if(!r)throw new Error("loaders.gl assertion failed.")}const Hm=typeof process!="object"||String(process)!=="[object process]"||process.browser,xx=typeof importScripts=="function",ZF=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ZF&&parseFloat(ZF[1]);const Bx={};async function z0(r,e=null,t={},n=null){return e&&(r=tie(r,e,t,n)),Bx[r]=Bx[r]||rie(r),await Bx[r]}function tie(r,e,t={},n=null){if(!t.useLocalLibraries&&r.startsWith("http"))return r;n=n||r;const i=t.modules||{};return i[n]?i[n]:Hm?t.CDN?(eie(t.CDN.startsWith("http")),`${t.CDN}/${e}@${Jne}/dist/libs/${n}`):xx?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function rie(r){if(r.endsWith("wasm"))return await iie(r);if(!Hm)try{const{requireFromFile:t}=globalThis.loaders||{};return await t?.(r)}catch(t){return console.error(t),null}if(xx)return importScripts(r);const e=await sie(r);return nie(e,r)}function nie(r,e){if(!Hm){const{requireFromString:n}=globalThis.loaders||{};return n?.(r,e)}if(xx)return eval.call(globalThis,r),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(r))}catch{t.text=r}return document.body.appendChild(t),null}async function iie(r){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Hm||!e||r.startsWith("http")?await(await fetch(r)).arrayBuffer():await e(r)}async function sie(r){const{readFileAsText:e}=globalThis.loaders||{};return Hm||!e||r.startsWith("http")?await(await fetch(r)).text():await e(r)}const Q0={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let JF;async function eR(r){Xne(r.modules);const e=Yne("basis");return e||(JF||=oie(r),await JF)}async function oie(r){let e=null,t=null;return[e,t]=await Promise.all([await z0(Q0.TRANSCODER,"textures",r),await z0(Q0.TRANSCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await aie(e,t)}function aie(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:s,initializeBasis:a}=i;a(),n({BasisFile:s})})})}let Cx;async function tR(r){const e=r.modules||{};return e.basisEncoder?e.basisEncoder:(Cx=Cx||lie(r),await Cx)}async function lie(r){let e=null,t=null;return[e,t]=await Promise.all([await z0(Q0.ENCODER,"textures",r),await z0(Q0.ENCODER_WASM,"textures",r)]),e=e||globalThis.BASIS,await cie(e,t)}function cie(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r(t).then(i=>{const{BasisFile:s,KTX2File:a,initializeBasis:o,BasisEncoder:u}=i;o(),n({BasisFile:s,KTX2File:a,BasisEncoder:u})})})}const Dp={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},uie=["","WEBKIT_","MOZ_"],rR={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let H0=null;function hie(r){if(!H0){r=r||Aie()||void 0,H0=new Set;for(const e of uie)for(const t in rR)if(r&&r.getExtension(`${e}${t}`)){const n=rR[t];H0.add(n)}}return H0}function Aie(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Cl=[171,75,84,88,32,50,48,187,13,10,26,10];function fie(r){const e=new Uint8Array(r);return!(e.byteLength<Cl.length||e[0]!==Cl[0]||e[1]!==Cl[1]||e[2]!==Cl[2]||e[3]!==Cl[3]||e[4]!==Cl[4]||e[5]!==Cl[5]||e[6]!==Cl[6]||e[7]!==Cl[7]||e[8]!==Cl[8]||e[9]!==Cl[9]||e[10]!==Cl[10]||e[11]!==Cl[11])}const die={etc1:{basisFormat:0,compressed:!0,format:Dp.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Dp.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Dp.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Dp.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Dp.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Dp.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function pie(r,e){if(e.basis.containerFormat==="auto"){if(fie(r)){const n=await tR(e);return nR(n.KTX2File,r,e)}const{BasisFile:t}=await eR(e);return Tx(t,r,e)}switch(e.basis.module){case"encoder":const t=await tR(e);switch(e.basis.containerFormat){case"ktx2":return nR(t.KTX2File,r,e);case"basis":default:return Tx(t.BasisFile,r,e)}case"transcoder":default:const{BasisFile:n}=await eR(e);return Tx(n,r,e)}}function Tx(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const i=n.getNumImages(),s=[];for(let a=0;a<i;a++){const o=n.getNumLevels(a),u=[];for(let d=0;d<o;d++)u.push(gie(n,a,d,t));s.push(u)}return s}finally{n.close(),n.delete()}}function gie(r,e,t,n){const i=r.getImageWidth(e,t),s=r.getImageHeight(e,t),a=r.getHasAlpha(),{compressed:o,format:u,basisFormat:d}=iR(n,a),p=r.getImageTranscodedSizeInBytes(e,t,d),b=new Uint8Array(p);if(!r.transcodeImage(b,e,t,d,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:s,data:b,compressed:o,format:u,hasAlpha:a}}function nR(r,e,t){const n=new r(new Uint8Array(e));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const i=n.getLevels(),s=[];for(let a=0;a<i;a++)s.push(mie(n,a,t));return[s]}finally{n.close(),n.delete()}}function mie(r,e,t){const{alphaFlag:n,height:i,width:s}=r.getImageLevelInfo(e,0,0),{compressed:a,format:o,basisFormat:u}=iR(t,n),d=r.getImageTranscodedSizeInBytes(e,0,0,u),p=new Uint8Array(d);if(!r.transcodeImage(p,e,0,0,u,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:i,data:p,compressed:a,levelSize:d,hasAlpha:n,format:o}}function iR(r,e){let t=r&&r.basis&&r.basis.format;return t==="auto"&&(t=sR()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),die[t]}function sR(){const r=hie();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}const _ie={...{dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:Kne,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:pie};function yie(r){return{addressModeU:oR(r.wrapS),addressModeV:oR(r.wrapT),magFilter:bie(r.magFilter),...vie(r.minFilter)}}function oR(r){switch(r){case 33071:return"clamp-to-edge";case 10497:return"repeat";case 33648:return"mirror-repeat";default:return}}function bie(r){switch(r){case 9728:return"nearest";case 9729:return"linear";default:return}}function vie(r){switch(r){case 9728:return{minFilter:"nearest"};case 9729:return{minFilter:"linear"};case 9984:return{minFilter:"nearest",mipmapFilter:"nearest"};case 9985:return{minFilter:"linear",mipmapFilter:"nearest"};case 9986:return{minFilter:"nearest",mipmapFilter:"linear"};case 9987:return{minFilter:"linear",mipmapFilter:"linear"};default:return{}}}function aR(r,e,t,n){const i={defines:{MANUAL_SRGB:!0,SRGB_FAST_APPROXIMATION:!0},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};i.defines.USE_TEX_LOD=!0;const{imageBasedLightingEnvironment:s}=n;return s&&(i.bindings.pbr_diffuseEnvSampler=s.diffuseEnvSampler.texture,i.bindings.pbr_specularEnvSampler=s.specularEnvSampler.texture,i.bindings.pbr_BrdfLUT=s.brdfLutTexture.texture,i.uniforms.scaleIBLAmbient=[1,1]),n?.pbrDebug&&(i.defines.PBR_DEBUG=!0,i.uniforms.scaleDiffBaseMR=[0,0,0,0],i.uniforms.scaleFGDSpec=[0,0,0,0]),t.NORMAL&&(i.defines.HAS_NORMALS=!0),t.TANGENT&&n?.useTangents&&(i.defines.HAS_TANGENTS=!0),t.TEXCOORD_0&&(i.defines.HAS_UV=!0),n?.imageBasedLightingEnvironment&&(i.defines.USE_IBL=!0),n?.lights&&(i.defines.USE_LIGHTS=!0),e&&wie(r,e,i),i}function wie(r,e,t){if(t.uniforms.unlit=!!e.unlit,e.pbrMetallicRoughness&&xie(r,e.pbrMetallicRoughness,t),e.normalTexture){Vm(r,e.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",t);const{scale:n=1}=e.normalTexture;t.uniforms.normalScale=n}if(e.occlusionTexture){Vm(r,e.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",t);const{strength:n=1}=e.occlusionTexture;t.uniforms.occlusionStrength=n}switch(e.emissiveTexture&&(Vm(r,e.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",t),t.uniforms.emissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode||"MASK"){case"MASK":const{alphaCutoff:n=.5}=e;t.defines.ALPHA_CUTOFF=!0,t.uniforms.alphaCutoff=n;break;case"BLEND":Xt.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),t.parameters.blend=!0,t.parameters.blendColorOperation="add",t.parameters.blendColorSrcFactor="src-alpha",t.parameters.blendColorDstFactor="one-minus-src-alpha",t.parameters.blendAlphaOperation="add",t.parameters.blendAlphaSrcFactor="one",t.parameters.blendAlphaDstFactor="one-minus-src-alpha",t.glParameters.blend=!0,t.glParameters.blendEquation=32774,t.glParameters.blendFunc=[770,771,1,771];break}}function xie(r,e,t){e.baseColorTexture&&Vm(r,e.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",t),t.uniforms.baseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&Vm(r,e.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",t);const{metallicFactor:n=1,roughnessFactor:i=1}=e;t.uniforms.metallicRoughnessValues=[n,i]}function Vm(r,e,t,n,i){const s=e.texture.source.image;let a;s.compressed?a=s:a={data:s};const o={wrapS:10497,wrapT:10497,...e?.texture?.sampler},u=r.createTexture({id:e.uniformName||e.id,sampler:yie(o),...a});i.bindings[t]=u,n&&(i.defines[n]=!0),i.generatedTextures.push(u)}var ed;(function(r){r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(ed||(ed={}));function Bie(r){switch(r){case ed.POINTS:return"point-list";case ed.LINES:return"line-list";case ed.LINE_STRIP:return"line-strip";case ed.TRIANGLES:return"triangle-list";case ed.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(r))}}const Cie=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,Tie=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,Eie=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function Sie(r,e){const{id:t,geometry:n,parsedPPBRMaterial:i,vertexCount:s,modelOptions:a={}}=e;Xt.info(4,"createGLTFModel defines: ",i.defines)();const o=[],u={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},d={id:t,source:Cie,vs:Tie,fs:Eie,geometry:n,topology:n.topology,vertexCount:s,modules:[c2],...a,defines:{...i.defines,...a.defines},parameters:{...u,...i.parameters,...a.parameters}},p=new DA(r,d),{camera:b,...C}={...i.uniforms,...a.uniforms,...i.bindings,...a.bindings};return p.shaderInputs.setProps({pbrMaterial:C,pbrProjection:{camera:b}}),new D2({managedResources:o,model:p})}const Iie={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:void 0,lights:!0,useTangents:!1};function Pie(r,e,t={}){const n={...Iie,...t};return e.scenes.map(s=>Mie(r,s,e.nodes,n))}function Mie(r,e,t,n){const s=(e.nodes||[]).map(o=>lR(r,o,t,n));return new Cp({id:e.name||e.id,children:s})}function lR(r,e,t,n){if(!e._node){const a=(e.children||[]).map(u=>lR(r,u,t,n));e.mesh&&a.push(Fie(r,e.mesh,n));const o=new Cp({id:e.name||e.id,children:a});if(e.matrix)o.setMatrix(e.matrix);else{if(o.matrix.identity(),e.translation&&o.matrix.translate(e.translation),e.rotation){const u=new zn().fromQuaternion(e.rotation);o.matrix.multiplyRight(u)}e.scale&&o.matrix.scale(e.scale)}e._node=o}const i=t.find(s=>s.id===e.id);return i._node=e._node,e._node}function Fie(r,e,t){if(!e._mesh){const i=(e.primitives||[]).map((a,o)=>Rie(r,a,o,e,t)),s=new Cp({id:e.name||e.id,children:i});e._mesh=s}return e._mesh}function Rie(r,e,t,n,i){const s=e.name||`${n.name||n.id}-primitive-${t}`,a=Bie(e.mode||4),o=e.indices?e.indices.count:Lie(e.attributes),u=cR(s,e,a),d=aR(r,e.material,u.attributes,i),p=Sie(r,{id:s,geometry:cR(s,e,a),parsedPPBRMaterial:d,modelOptions:i.modelOptions,vertexCount:o});return p.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],p}function Lie(r){throw new Error("getVertexCount not implemented")}function cR(r,e,t){const n={};for(const[i,s]of Object.entries(e.attributes)){const{components:a,size:o,value:u}=s;n[i]={size:o??a,value:u}}return new Bp({id:r,topology:t,indices:e.indices.value,attributes:n})}const Ex=new mm;function Oie(r,{input:e,interpolation:t,output:n},i,s){const a=e[e.length-1],o=r%a,u=e.findIndex(C=>C>=o),d=Math.max(0,u-1);if(!Array.isArray(i[s]))switch(s){case"translation":i[s]=[0,0,0];break;case"rotation":i[s]=[0,0,0,1];break;case"scale":i[s]=[1,1,1];break;default:Xt.warn(`Bad animation path ${s}`)()}const p=e[d],b=e[u];switch(t){case"STEP":kie(i,s,n[d]);break;case"LINEAR":if(b>p){const C=(o-p)/(b-p);Uie(i,s,n[d],n[u],C)}break;case"CUBICSPLINE":if(b>p){const C=(o-p)/(b-p),w=b-p,M=n[3*d+1],P=n[3*d+2],k=n[3*u+0],D=n[3*u+1];Die(i,s,{p0:M,outTangent0:P,inTangent1:k,p1:D,tDiff:w,ratio:C})}break;default:Xt.warn(`Interpolation ${t} not supported`)();break}}function Uie(r,e,t,n,i){if(!r[e])throw new Error;if(e==="rotation"){Ex.slerp({start:t,target:n,ratio:i});for(let s=0;s<Ex.length;s++)r[e][s]=Ex[s]}else for(let s=0;s<t.length;s++)r[e][s]=i*n[s]+(1-i)*t[s]}function Die(r,e,{p0:t,outTangent0:n,inTangent1:i,p1:s,tDiff:a,ratio:o}){if(!r[e])throw new Error;for(let u=0;u<r[e].length;u++){const d=n[u]*a,p=i[u]*a;r[e][u]=(2*Math.pow(o,3)-3*Math.pow(o,2)+1)*t[u]+(Math.pow(o,3)-2*Math.pow(o,2)+o)*d+(-2*Math.pow(o,3)+3*Math.pow(o,2))*s[u]+(Math.pow(o,3)-Math.pow(o,2))*p}}function kie(r,e,t){if(!r[e])throw new Error;for(let n=0;n<t.length;n++)r[e][n]=t[n]}class Nie{animation;startTime=0;playing=!0;speed=1;constructor(e){this.animation=e.animation,this.animation.name||="unnamed",Object.assign(this,e)}setTime(e){if(!this.playing)return;const n=(e/1e3-this.startTime)*this.speed;this.animation.channels.forEach(({sampler:i,target:s,path:a})=>{Oie(n,i,s,a),Hie(s,s._node)})}}class zie{animations;constructor(e){this.animations=e.animations.map((t,n)=>{const i=t.name||`Animation-${n}`;return new Nie({animation:{name:i,channels:t.channels}})})}animate(e){Xt.warn("GLTFAnimator#animate is deprecated. Use GLTFAnimator#setTime instead")(),this.setTime(e)}setTime(e){this.animations.forEach(t=>t.setTime(e))}getAnimations(){return this.animations}}const Qie=new zn;function Hie(r,e){if(e.matrix.identity(),r.translation&&e.matrix.translate(r.translation),r.rotation){const t=Qie.fromQuaternion(r.rotation);e.matrix.multiplyRight(t)}r.scale&&e.matrix.scale(r.scale)}const Vie={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},jie={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function $ie(r){const e=jie[r.componentType],t=Vie[r.type],n=t*r.count,{buffer:i,byteOffset:s=0}=r.bufferView?.data??{};return{typedArray:new e(i,s+(r.byteOffset||0),n),components:t}}function Gie(r){return(r.animations||[]).map((t,n)=>{const i=t.name||`Animation-${n}`,s=t.samplers.map(({input:o,interpolation:u="LINEAR",output:d})=>({input:uR(r.accessors[o]),interpolation:u,output:uR(r.accessors[d])})),a=t.channels.map(({sampler:o,target:u})=>({sampler:s[o],target:r.nodes[u.node??0],path:u.path}));return{name:i,channels:a}})}function uR(r){if(!r._animation){const{typedArray:e,components:t}=$ie(r);if(t===1)r._animation=Array.from(e);else{const n=[];for(let i=0;i<e.length;i+=t)n.push(Array.from(e.slice(i,i+t)));r._animation=n}}return r._animation}function Sx(r){if(ArrayBuffer.isView(r)||r instanceof ArrayBuffer||r instanceof ImageBitmap)return r;if(Array.isArray(r))return r.map(Sx);if(r&&typeof r=="object"){const e={};for(const t in r)e[t]=Sx(r[t]);return e}return r}function Wie(r,e,t){e=Sx(e);const n=Pie(r,e,t),i=Gie(e),s=new zie({animations:i});return{scenes:n,animator:s}}const qie="4.3.3";async function hR(r,e,t,n){return n._parse(r,e,t,n)}function td(r,e){if(!r)throw new Error("loader assertion failed.")}const AR=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),fR=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);fR&&parseFloat(fR[1]);function Kie(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?dR(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?dR(r,0,e):""}function dR(r,e,t){if(r.byteLength<=e+t)return"";const n=new DataView(r);let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(n.getUint8(e+s));return i}function Xie(r){try{return JSON.parse(r)}catch{throw new Error(`Failed to parse JSON from data starting with "${Kie(r)}"`)}}function pR(r,e,t){const n=t!==void 0?new Uint8Array(r).subarray(e,e+t):new Uint8Array(r).subarray(e);return new Uint8Array(n).buffer}function jm(r,e){return td(r>=0),td(e>0),r+(e-1)&-4}function Yie(r,e,t){let n;if(r instanceof ArrayBuffer)n=new Uint8Array(r);else{const i=r.byteOffset,s=r.byteLength;n=new Uint8Array(r.buffer||r.arrayBuffer,i,s)}return e.set(n,t),t+jm(n.byteLength,4)}const Zie=globalThis.loaders?.parseImageNode,Ix=typeof Image<"u",Px=typeof ImageBitmap<"u",Mx=AR?!0:!!Zie;function Jie(r){switch(r){case"auto":return Px||Ix||Mx;case"imagebitmap":return Px;case"image":return Ix;case"data":return Mx;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function ese(){if(Px)return"imagebitmap";if(Ix)return"image";if(Mx)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function tse(r){const e=rse(r);if(!e)throw new Error("Not an image");return e}function gR(r){switch(tse(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function rse(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const nse=/^data:image\/svg\+xml/,ise=/\.svg((\?|#).*)?$/;function Fx(r){return r&&(nse.test(r)||ise.test(r))}function sse(r,e){if(Fx(e)){let n=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return mR(r,e)}function mR(r,e){if(Fx(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function _R(r,e,t){const n=sse(r,t),i=self.URL||self.webkitURL,s=typeof n!="string"&&i.createObjectURL(n);try{return await ose(s||n,e)}finally{s&&i.revokeObjectURL(s)}}async function ose(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((n,i)=>{try{t.onload=()=>n(t),t.onerror=s=>{const a=s instanceof Error?s.message:"error";i(new Error(a))}}catch(s){i(s)}})}const ase={};let yR=!0;async function lse(r,e,t){let n;Fx(t)?n=await _R(r,e,t):n=mR(r,t);const i=e&&e.imagebitmap;return await cse(n,i)}async function cse(r,e=null){if((use(e)||!yR)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),yR=!1}return await createImageBitmap(r)}function use(r){for(const e in r||ase)return!1;return!0}function hse(r){return!pse(r,"ftyp",4)||(r[8]&96)===0?null:Ase(r)}function Ase(r){switch(fse(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function fse(r,e,t){return String.fromCharCode(...r.slice(e,t))}function dse(r){return[...r].map(e=>e.charCodeAt(0))}function pse(r,e,t=0){const n=dse(e);for(let i=0;i<n.length;++i)if(n[i]!==r[i+t])return!1;return!0}const Hu=!1,$m=!0;function Rx(r){const e=Gm(r);return mse(e)||bse(e)||_se(e)||yse(e)||gse(e)}function gse(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=hse(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function mse(r){const e=Gm(r);return e.byteLength>=24&&e.getUint32(0,Hu)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Hu),height:e.getUint32(20,Hu)}:null}function _se(r){const e=Gm(r);return e.byteLength>=10&&e.getUint32(0,Hu)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,$m),height:e.getUint16(8,$m)}:null}function yse(r){const e=Gm(r);return e.byteLength>=14&&e.getUint16(0,Hu)===16973&&e.getUint32(2,$m)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,$m),height:e.getUint32(22,$m)}:null}function bse(r){const e=Gm(r);if(!(e.byteLength>=3&&e.getUint16(0,Hu)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:n,sofMarkers:i}=vse();let s=2;for(;s+9<e.byteLength;){const a=e.getUint16(s,Hu);if(i.has(a))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Hu),width:e.getUint16(s+7,Hu)};if(!n.has(a))return null;s+=2,s+=e.getUint16(s,Hu)}return null}function vse(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Gm(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function wse(r,e){const{mimeType:t}=Rx(r)||{},n=globalThis.loaders?.parseImageNode;return td(n),await n(r,t)}async function xse(r,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=t||{},a=Bse(i);let o;switch(a){case"imagebitmap":o=await lse(r,e,s);break;case"image":o=await _R(r,e,s);break;case"data":o=await wse(r);break;default:td(!1)}return i==="data"&&(o=gR(o)),o}function Bse(r){switch(r){case"auto":case"data":return ese();default:return Jie(r),r}}const Cse={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:qie,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:xse,tests:[r=>!!Rx(new DataView(r))],options:{image:{type:"auto",decode:!0}}},Lx={};function Tse(r){if(Lx[r]===void 0){const e=AR?Sse(r):Ese(r);Lx[r]=e}return Lx[r]}function Ese(r){const e=["image/png","image/jpeg","image/gif"],t=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&t.includes(r)}function Sse(r){switch(r){case"image/avif":case"image/webp":return Ise(r);default:return!0}}function Ise(r){try{return document.createElement("canvas").toDataURL(r).indexOf(`data:${r}`)===0}catch{return!1}}function Tl(r,e){if(!r)throw new Error(e||"assert failed: gltf")}const bR={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vR={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Pse=1.33,wR=["SCALAR","VEC2","VEC3","VEC4"],Mse=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Fse=new Map(Mse),Rse={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Lse={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Ose={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function xR(r){return wR[r-1]||wR[0]}function V0(r){const e=Fse.get(r.constructor);if(!e)throw new Error("Illegal typed array");return e}function Ox(r,e){const t=Ose[r.componentType],n=Rse[r.type],i=Lse[r.componentType],s=r.count*n,a=r.count*n*i;Tl(a>=0&&a<=e.byteLength);const o=vR[r.componentType],u=bR[r.type];return{ArrayType:t,length:s,byteLength:a,componentByteSize:o,numberOfComponentsInElement:u}}function BR(r){let{images:e,bufferViews:t}=r;e=e||[],t=t||[];const n=e.map(a=>a.bufferView);t=t.filter(a=>!n.includes(a));const i=t.reduce((a,o)=>a+o.byteLength,0),s=e.reduce((a,o)=>{const{width:u,height:d}=o.image;return a+u*d},0);return i+Math.ceil(4*s*Pse)}function Use(r,e,t){const n=r.bufferViews[t];Tl(n);const i=n.buffer,s=e[i];Tl(s);const a=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,a,n.byteLength)}function Dse(r,e,t){const n=typeof t=="number"?r.accessors?.[t]:t;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(t)}`);const i=r.bufferViews?.[n.bufferView||0];if(!i)throw new Error(`No gltf buffer view for accessor ${i}`);const{arrayBuffer:s,byteOffset:a}=e[i.buffer],o=(a||0)+(n.byteOffset||0)+(i.byteOffset||0),{ArrayType:u,length:d,componentByteSize:p,numberOfComponentsInElement:b}=Ox(n,i),C=p*b,w=i.byteStride||C;if(typeof i.byteStride>"u"||i.byteStride===C)return new u(s,o,d);const M=new u(d);for(let P=0;P<n.count;P++){const k=new u(s,o+P*w,b);M.set(k,P*b)}return M}function kse(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class Lo{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||kse(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.getRequiredExtensions().find(i=>i===e);return typeof t=="string"||typeof n=="string"}getExtension(e){const t=this.getUsedExtensions().find(i=>i===e),n=this.json.extensions||{};return t?n[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(n=>n===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const n=this.json[e]&&this.json[e][t];if(!n)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return n}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,n=this.gltf.buffers[t];Tl(n);const i=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return Dse(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,s=t.byteOffset||0;return new Uint8Array(i,s,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}setObjectExtension(e,t,n){const i=e.extensions||{};i[t]=n}removeObjectExtension(e,t){const n=e?.extensions||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(t)||i.push(t)}delete n[t]}addExtension(e,t={}){return Tl(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return Tl(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:n}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return n&&(i.matrix=n),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:n,material:i,mode:s=4}=e,o={primitives:[{attributes:this._addAttributes(t),mode:s}]};if(n){const u=this._addIndices(n);o.primitives[0].indices=u}return Number.isFinite(i)&&(o.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(e){const n={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(e,t){const n=Rx(e),i=t||n?.mimeType,a={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(a),this.json.images.length-1}addBufferView(e,t=0,n=this.byteLength){const i=e.byteLength;Tl(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const s={buffer:t,byteOffset:n,byteLength:i};return this.byteLength+=jm(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(e,t){const n={bufferView:e,type:xR(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const n=this.addBufferView(e);let i={min:t.min,max:t.max};(!i.min||!i.max)&&(i=this._getAccessorMinMax(e,t.size));const s={size:t.size,componentType:V0(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(n,Object.assign(s,t))}addTexture(e){const{imageIndex:t}=e,n={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){const e=this.byteLength,t=new ArrayBuffer(e),n=new Uint8Array(t);let i=0;for(const s of this.sourceBuffers||[])i=Yie(s,n,i);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let n=!0;for(;n;){const i=e.indexOf(t);i>-1?e.splice(i,1):n=!1}}_addAttributes(e={}){const t={};for(const n in e){const i=e[n],s=this._getGltfAttributeName(n),a=this.addBinaryBuffer(i.value,i);t[s]=a}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];const i=e.subarray(0,t);for(const s of i)n.min.push(s),n.max.push(s);for(let s=t;s<e.length;s+=t)for(let a=0;a<t;a++)n.min[0+a]=Math.min(n.min[0+a],e[s+a]),n.max[0+a]=Math.max(n.max[0+a],e[s+a]);return n}}function CR(r){return(r%1+1)%1}const TR={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Nse={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},ER={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Ux(r,e){return ER[e]*TR[r]}function j0(r,e,t,n){if(t!=="UINT8"&&t!=="UINT16"&&t!=="UINT32"&&t!=="UINT64")return null;const i=r.getTypedArrayForBufferView(e),s=$0(i,"SCALAR",t,n+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function $0(r,e,t,n=1){const i=TR[e],s=Nse[t],a=ER[t],o=n*i,u=o*a;let d=r.buffer,p=r.byteOffset;return p%a!==0&&(d=new Uint8Array(d).slice(p,p+u).buffer,p=0),new s(d,p,o)}function Dx(r,e,t){const n=`TEXCOORD_${e.texCoord||0}`,i=t.attributes[n],s=r.getTypedArrayForAccessor(i),a=r.gltf.json,o=e.index,u=a.textures?.[o]?.source;if(typeof u<"u"){const d=a.images?.[u]?.mimeType,p=r.gltf.images?.[u];if(p&&typeof p.width<"u"){const b=[];for(let C=0;C<s.length;C+=2){const w=zse(p,d,s,C,e.channels);b.push(w)}return b}}return[]}function SR(r,e,t,n,i){if(!t?.length)return;const s=[];for(const p of t){let b=n.findIndex(C=>C===p);b===-1&&(b=n.push(p)-1),s.push(b)}const a=new Uint32Array(s),o=r.gltf.buffers.push({arrayBuffer:a.buffer,byteOffset:a.byteOffset,byteLength:a.byteLength})-1,u=r.addBufferView(a,o,0),d=r.addAccessor(u,{size:1,componentType:V0(a),count:a.length});i.attributes[e]=d}function zse(r,e,t,n,i=[0]){const s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},a=t[n],o=t[n+1];let u=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(u=4);const d=Qse(a,o,r,u);let p=0;for(const b of i){const C=typeof b=="number"?Object.values(s)[b]:s[b],w=d+C.offset,M=gR(r);if(M.data.length<=w)throw new Error(`${M.data.length} <= ${w}`);const P=M.data[w];p|=P<<C.shift}return p}function Qse(r,e,t,n=1){const i=t.width,s=CR(r)*(i-1),a=Math.round(s),o=t.height,u=CR(e)*(o-1),d=Math.round(u),p=t.components?t.components:n;return(d*i+a)*p}function IR(r,e,t,n,i){const s=[];for(let a=0;a<e;a++){const o=t[a],u=t[a+1]-t[a];if(u+o>n)break;const d=o/i,p=u/i;s.push(r.slice(d,d+p))}return s}function PR(r,e,t){const n=[];for(let i=0;i<e;i++){const s=i*t;n.push(r.slice(s,s+t))}return n}function MR(r,e,t,n){if(t)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const i=[],s=new TextDecoder("utf8");let a=0;for(let o=0;o<r;o++){const u=n[o+1]-n[o];if(u+a<=e.length){const d=e.subarray(a,u+a),p=s.decode(d);i.push(p),a+=u}}return i}return[]}const kp="EXT_mesh_features",Hse=kp;async function Vse(r,e){const t=new Lo(r);$se(t,e)}function jse(r,e){const t=new Lo(r);return Wse(t),t.createBinaryChunk(),t.gltf}function $se(r,e){const t=r.gltf.json;if(t.meshes)for(const n of t.meshes)for(const i of n.primitives)Gse(r,i,e)}function Gse(r,e,t){if(!t?.gltf?.loadBuffers)return;const i=e.extensions?.[kp]?.featureIds;if(i)for(const s of i){let a;if(typeof s.attribute<"u"){const o=`_FEATURE_ID_${s.attribute}`,u=e.attributes[o];a=r.getTypedArrayForAccessor(u)}else typeof s.texture<"u"&&t?.gltf?.loadImages?a=Dx(r,s.texture,e):a=[];s.data=a}}function Wse(r,e){const t=r.gltf.json.meshes;if(t)for(const n of t)for(const i of n.primitives)Kse(r,i)}function qse(r,e,t,n){e.extensions||(e.extensions={});let i=e.extensions[kp];i||(i={featureIds:[]},e.extensions[kp]=i);const{featureIds:s}=i,a={featureCount:t.length,propertyTable:n,data:t};s.push(a),r.addObjectExtension(e,kp,i)}function Kse(r,e){const t=e.extensions?.[kp];if(!t)return;const n=t.featureIds;n.forEach((i,s)=>{if(i.data){const{accessorKey:a,index:o}=Xse(e.attributes),u=new Uint32Array(i.data);n[s]={featureCount:u.length,propertyTable:i.propertyTable,attribute:o},r.gltf.buffers.push({arrayBuffer:u.buffer,byteOffset:u.byteOffset,byteLength:u.byteLength});const d=r.addBufferView(u),p=r.addAccessor(d,{size:1,componentType:V0(u),count:u.length});e.attributes[a]=p}})}function Xse(r){const e="_FEATURE_ID_",t=Object.keys(r).filter(s=>s.indexOf(e)===0);let n=-1;for(const s of t){const a=Number(s.substring(e.length));a>n&&(n=a)}return n++,{accessorKey:`${e}${n}`,index:n}}const Yse=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:qse,decode:Vse,encode:jse,name:Hse},Symbol.toStringTag,{value:"Module"})),Np="EXT_structural_metadata",Zse=Np;async function Jse(r,e){const t=new Lo(r);toe(t,e)}function eoe(r,e){const t=new Lo(r);return moe(t),t.createBinaryChunk(),t.gltf}function toe(r,e){if(!e.gltf?.loadBuffers)return;const t=r.getExtension(Np);t&&(e.gltf?.loadImages&&roe(r,t),noe(r,t))}function roe(r,e){const t=e.propertyTextures,n=r.gltf.json;if(t&&n.meshes)for(const i of n.meshes)for(const s of i.primitives)soe(r,t,s,e)}function noe(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.propertyTables;if(n&&i)for(const s in n){const a=ioe(i,s);a&&aoe(r,t,a)}}function ioe(r,e){for(const t of r)if(t.class===e)return t;return null}function soe(r,e,t,n){if(!e)return;const s=t.extensions?.[Np]?.propertyTextures;if(s)for(const a of s){const o=e[a];ooe(r,o,t,n)}}function ooe(r,e,t,n){if(!e.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const i=e.class;for(const s in e.properties){const a=`${i}_${s}`,o=e.properties?.[s];if(!o)continue;o.data||(o.data=[]);const u=o.data,d=Dx(r,o,t);d!==null&&(SR(r,a,d,u,t),o.data=u,n.dataAttributeNames.push(a))}}function aoe(r,e,t){const n=e.classes?.[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const s in n.properties){const a=n.properties[s],o=t.properties?.[s];if(o){const u=loe(r,e,a,i,o);o.data=u}}}function loe(r,e,t,n,i){let s=[];const a=i.values,o=r.getTypedArrayForBufferView(a),u=coe(r,t,i,n),d=uoe(r,i,n);switch(t.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{s=hoe(t,n,o,u);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${t.type}`);case"STRING":{s=MR(n,o,u,d);break}case"ENUM":{s=Aoe(e,t,n,o,u);break}default:throw new Error(`Unknown classProperty type ${t.type}`)}return s}function coe(r,e,t,n){return e.array&&typeof e.count>"u"&&typeof t.arrayOffsets<"u"?j0(r,t.arrayOffsets,t.arrayOffsetType||"UINT32",n):null}function uoe(r,e,t){return typeof e.stringOffsets<"u"?j0(r,e.stringOffsets,e.stringOffsetType||"UINT32",t):null}function hoe(r,e,t,n){const i=r.array,s=r.count,a=Ux(r.type,r.componentType),o=t.byteLength/a;let u;return r.componentType?u=$0(t,r.type,r.componentType,o):u=t,i?n?IR(u,e,n,t.length,a):s?PR(u,e,s):[]:u}function Aoe(r,e,t,n,i){const s=e.enumType;if(!s)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const a=r.enums?.[s];if(!a)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${s}`);const o=a.valueType||"UINT16",u=Ux(e.type,o),d=n.byteLength/u;let p=$0(n,e.type,o,d);if(p||(p=n),e.array){if(i)return foe({valuesData:p,numberOfElements:t,arrayOffsets:i,valuesDataBytesLength:n.length,elementSize:u,enumEntry:a});const b=e.count;return b?doe(p,t,b,a):[]}return kx(p,0,t,a)}function foe(r){const{valuesData:e,numberOfElements:t,arrayOffsets:n,valuesDataBytesLength:i,elementSize:s,enumEntry:a}=r,o=[];for(let u=0;u<t;u++){const d=n[u],p=n[u+1]-n[u];if(p+d>i)break;const b=d/s,C=p/s,w=kx(e,b,C,a);o.push(w)}return o}function doe(r,e,t,n){const i=[];for(let s=0;s<e;s++){const a=t*s,o=kx(r,a,t,n);i.push(o)}return i}function kx(r,e,t,n){const i=[];for(let s=0;s<t;s++)if(r instanceof BigInt64Array||r instanceof BigUint64Array)i.push("");else{const a=r[e+s],o=poe(n,a);o?i.push(o.name):i.push("")}return i}function poe(r,e){for(const t of r.values)if(t.value===e)return t;return null}const goe="schemaClassId";function moe(r,e){const t=r.getExtension(Np);if(t&&t.propertyTables)for(const n of t.propertyTables){const i=n.class,s=t.schema?.classes?.[i];n.properties&&s&&_oe(n,s,r)}}function _oe(r,e,t){for(const n in r.properties){const i=r.properties[n].data;if(i){const s=e.properties[n];if(s){const a=woe(i,s,t);r.properties[n]=a}}}}function yoe(r,e,t=goe){let n=r.getExtension(Np);n||(n=r.addExtension(Np)),n.schema=boe(e,t,n.schema);const i=voe(e,t,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(i)-1}function boe(r,e,t){const n=t??{id:"schema_id"},i={properties:{}};for(const s of r){const a={type:s.elementType,componentType:s.componentType};i.properties[s.name]=a}return n.classes={},n.classes[e]=i,n}function voe(r,e,t){const n={class:e,count:0};let i=0;const s=t.classes?.[e];for(const a of r){if(i===0&&(i=a.values.length),i!==a.values.length&&a.values.length)throw new Error("Illegal values in attributes");s?.properties[a.name]&&(n.properties||(n.properties={}),n.properties[a.name]={values:0,data:a.values})}return n.count=i,n}function woe(r,e,t){const n={values:0};if(e.type==="STRING"){const{stringData:i,stringOffsets:s}=Coe(r);n.stringOffsets=Nx(s,t),n.values=Nx(i,t)}else if(e.type==="SCALAR"&&e.componentType){const i=Boe(r,e.componentType);n.values=Nx(i,t)}return n}const xoe={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function Boe(r,e){const t=[];for(const i of r)t.push(Number(i));const n=xoe[e];if(!n)throw new Error("Illegal component type");return new n(t)}function Coe(r){const e=new TextEncoder,t=[];let n=0;for(const u of r){const d=e.encode(u);n+=d.length,t.push(d)}const i=new Uint8Array(n),s=[];let a=0;for(const u of t)i.set(u,a),s.push(a),a+=u.length;s.push(a);const o=new Uint32Array(s);return{stringData:i,stringOffsets:o}}function Nx(r,e){return e.gltf.buffers.push({arrayBuffer:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}),e.addBufferView(r)}const Toe=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:yoe,decode:Jse,encode:eoe,name:Zse},Symbol.toStringTag,{value:"Module"})),FR="EXT_feature_metadata",Eoe=FR;async function Soe(r,e){const t=new Lo(r);Ioe(t,e)}function Ioe(r,e){if(!e.gltf?.loadBuffers)return;const t=r.getExtension(FR);t&&(e.gltf?.loadImages&&Poe(r,t),Moe(r,t))}function Poe(r,e){const t=e.schema;if(!t)return;const n=t.classes,{featureTextures:i}=e;if(n&&i)for(const s in n){const a=n[s],o=Roe(i,s);o&&Ooe(r,o,a)}}function Moe(r,e){const t=e.schema;if(!t)return;const n=t.classes,i=e.featureTables;if(n&&i)for(const s in n){const a=Foe(i,s);a&&Loe(r,t,a)}}function Foe(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function Roe(r,e){for(const t in r){const n=r[t];if(n.class===e)return n}return null}function Loe(r,e,t){if(!t.class)return;const n=e.classes?.[t.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${t.class}`);const i=t.count;for(const s in n.properties){const a=n.properties[s],o=t.properties?.[s];if(o){const u=Uoe(r,e,a,i,o);o.data=u}}}function Ooe(r,e,t){const n=e.class;for(const i in t.properties){const s=e?.properties?.[i];if(s){const a=Qoe(r,s,n);s.data=a}}}function Uoe(r,e,t,n,i){let s=[];const a=i.bufferView,o=r.getTypedArrayForBufferView(a),u=Doe(r,t,i,n),d=koe(r,t,i,n);return t.type==="STRING"||t.componentType==="STRING"?s=MR(n,o,u,d):Noe(t)&&(s=zoe(t,n,o,u)),s}function Doe(r,e,t,n){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof t.arrayOffsetBufferView<"u"?j0(r,t.arrayOffsetBufferView,t.offsetType||"UINT32",n):null}function koe(r,e,t,n){return typeof t.stringOffsetBufferView<"u"?j0(r,t.stringOffsetBufferView,t.offsetType||"UINT32",n):null}function Noe(r){const e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(r.type)||typeof r.componentType<"u"&&e.includes(r.componentType)}function zoe(r,e,t,n){const i=r.type==="ARRAY",s=r.componentCount,a="SCALAR",o=r.componentType||r.type,u=Ux(a,o),d=t.byteLength/u,p=$0(t,a,o,d);return i?n?IR(p,e,n,t.length,u):s?PR(p,e,s):[]:p}function Qoe(r,e,t){const n=r.gltf.json;if(!n.meshes)return[];const i=[];for(const s of n.meshes)for(const a of s.primitives)Hoe(r,t,e,i,a);return i}function Hoe(r,e,t,n,i){const s={channels:t.channels,...t.texture},a=Dx(r,s,i);a&&SR(r,e,a,n,i)}const Voe=Object.freeze(Object.defineProperty({__proto__:null,decode:Soe,name:Eoe},Symbol.toStringTag,{value:"Module"})),joe="4.3.3",zp=!0,RR=1735152710,zx=12,G0=8,$oe=1313821514,Goe=5130562,Woe=0,qoe=0,Koe=1;function Xoe(r,e=0){return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}function Yoe(r,e=0,t={}){const n=new DataView(r),{magic:i=RR}=t,s=n.getUint32(e,!1);return s===i||s===RR}function Zoe(r,e,t=0,n={}){const i=new DataView(e),s=Xoe(i,t+0),a=i.getUint32(t+4,zp),o=i.getUint32(t+8,zp);switch(Object.assign(r,{header:{byteOffset:t,byteLength:o,hasBinChunk:!1},type:s,version:a,json:{},binChunks:[]}),t+=zx,r.version){case 1:return Joe(r,i,t);case 2:return eae(r,i,t,n={});default:throw new Error(`Invalid GLB version ${r.version}. Only supports version 1 and 2.`)}}function Joe(r,e,t){td(r.header.byteLength>zx+G0);const n=e.getUint32(t+0,zp),i=e.getUint32(t+4,zp);return t+=G0,td(i===Woe),Qx(r,e,t,n),t+=n,t+=Hx(r,e,t,r.header.byteLength),t}function eae(r,e,t,n){return td(r.header.byteLength>zx+G0),tae(r,e,t,n),t+r.header.byteLength}function tae(r,e,t,n){for(;t+8<=r.header.byteLength;){const i=e.getUint32(t+0,zp),s=e.getUint32(t+4,zp);switch(t+=G0,s){case $oe:Qx(r,e,t,i);break;case Goe:Hx(r,e,t,i);break;case qoe:n.strict||Qx(r,e,t,i);break;case Koe:n.strict||Hx(r,e,t,i);break}t+=jm(i,4)}return t}function Qx(r,e,t,n){const i=new Uint8Array(e.buffer,t,n),a=new TextDecoder("utf8").decode(i);return r.json=JSON.parse(a),jm(n,4)}function Hx(r,e,t,n){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:t,byteLength:n,arrayBuffer:e.buffer}),jm(n,4)}function LR(r,e){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const n=e.baseUri||e.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${r}`);return n.substr(0,n.lastIndexOf("/")+1)+r}const rae="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",nae="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",iae=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),sae=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),oae={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},aae={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function lae(r,e,t,n,i,s="NONE"){const a=await cae();Aae(a,a.exports[aae[i]],r,e,t,n,a.exports[oae[s||"NONE"]])}let Vx;async function cae(){return Vx||(Vx=uae()),Vx}async function uae(){let r=rae;WebAssembly.validate(iae)&&(r=nae,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(hae(r),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function hae(r){const e=new Uint8Array(r.length);for(let n=0;n<r.length;++n){const i=r.charCodeAt(n);e[n]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let t=0;for(let n=0;n<r.length;++n)e[t++]=e[n]<60?sae[e[n]]:(e[n]-60)*64+e[++n];return e.buffer.slice(0,t)}function Aae(r,e,t,n,i,s,a){const o=r.exports.sbrk,u=n+3&-4,d=o(u*i),p=o(s.length),b=new Uint8Array(r.exports.memory.buffer);b.set(s,p);const C=e(d,n,i,p,s.length);if(C===0&&a&&a(d,u,i),t.set(b.subarray(d,d+n*i)),o(d-o(0)),C!==0)throw new Error(`Malformed buffer data: ${C}`)}const W0="EXT_meshopt_compression",fae=W0;async function dae(r,e){const t=new Lo(r);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;const n=[];for(const i of r.json.bufferViews||[])n.push(pae(t,i));await Promise.all(n),t.removeExtension(W0)}async function pae(r,e){const t=r.getObjectExtension(e,W0);if(t){const{byteOffset:n=0,byteLength:i=0,byteStride:s,count:a,mode:o,filter:u="NONE",buffer:d}=t,p=r.gltf.buffers[d],b=new Uint8Array(p.arrayBuffer,p.byteOffset+n,i),C=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await lae(C,a,s,b,o,u),r.removeObjectExtension(e,W0)}}const gae=Object.freeze(Object.defineProperty({__proto__:null,decode:dae,name:fae},Symbol.toStringTag,{value:"Module"})),Qp="EXT_texture_webp",mae=Qp;function _ae(r,e){const t=new Lo(r);if(!Tse("image/webp")){if(t.getRequiredExtensions().includes(Qp))throw new Error(`gltf: Required extension ${Qp} not supported by browser`);return}const{json:n}=t;for(const i of n.textures||[]){const s=t.getObjectExtension(i,Qp);s&&(i.source=s.source),t.removeObjectExtension(i,Qp)}t.removeExtension(Qp)}const yae=Object.freeze(Object.defineProperty({__proto__:null,name:mae,preprocess:_ae},Symbol.toStringTag,{value:"Module"})),q0="KHR_texture_basisu",bae=q0;function vae(r,e){const t=new Lo(r),{json:n}=t;for(const i of n.textures||[]){const s=t.getObjectExtension(i,q0);s&&(i.source=s.source,t.removeObjectExtension(i,q0))}t.removeExtension(q0)}const wae=Object.freeze(Object.defineProperty({__proto__:null,name:bae,preprocess:vae},Symbol.toStringTag,{value:"Module"})),xae={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:"4.3.3",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Bae(r){switch(r.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Cae(r){let e=1/0,t=1/0,n=1/0,i=-1/0,s=-1/0,a=-1/0;const o=r.POSITION?r.POSITION.value:[],u=o&&o.length;for(let d=0;d<u;d+=3){const p=o[d],b=o[d+1],C=o[d+2];e=p<e?p:e,t=b<t?b:t,n=C<n?C:n,i=p>i?p:i,s=b>s?b:s,a=C>a?C:a}return[[e,t,n],[i,s,a]]}function Tae(r,e,t){const n=Bae(e.value),i=t||Eae(e);return{name:r,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:n}]},nullable:!1,metadata:i}}function Eae(r){const e={};return"byteOffset"in r&&(e.byteOffset=r.byteOffset.toString(10)),"byteStride"in r&&(e.byteStride=r.byteStride.toString(10)),"normalized"in r&&(e.normalized=r.normalized.toString()),e}function Sae(r,e,t){const n=UR(e.metadata),i=[],s=Iae(e.attributes);for(const a in r){const o=r[a],u=OR(a,o,s[a]);i.push(u)}if(t){const a=OR("indices",t);i.push(a)}return{fields:i,metadata:n}}function Iae(r){const e={};for(const t in r){const n=r[t];e[n.name||"undefined"]=n}return e}function OR(r,e,t){const n=t?UR(t.metadata):void 0;return Tae(r,e,n)}function UR(r){Object.entries(r);const e={};for(const t in r)e[`${t}.string`]=JSON.stringify(r[t]);return e}const DR={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Pae={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Mae=4;class Fae{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(n),s=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(i){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(n,s);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(n,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!s.ptr){const C=`DRACO decompression failed: ${a.error_msg()}`;throw new Error(C)}const o=this._getDracoLoaderData(s,i,t),u=this._getMeshData(s,o,t),d=Cae(u.attributes),p=Sae(u.attributes,o,u.indices);return{loader:"draco",loaderData:o,header:{vertexCount:s.num_points(),boundingBox:d},...u,schema:p}}finally{this.draco.destroy(n),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,t,n){const i=this._getTopLevelMetadata(e),s=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:s}}_getDracoAttributes(e,t){const n={};for(let i=0;i<e.num_attributes();i++){const s=this.decoder.GetAttribute(e,i),a=this._getAttributeMetadata(e,i);n[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:i,metadata:a};const o=this._getQuantizationTransform(s,t);o&&(n[s.unique_id()].quantization_transform=o);const u=this._getOctahedronTransform(s,t);u&&(n[s.unique_id()].octahedron_transform=u)}return n}_getMeshData(e,t,n){const i=this._getMeshAttributes(t,e,n);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,n){const i={};for(const s of Object.values(e.attributes)){const a=this._deduceAttributeName(s,n);s.name=a;const o=this._getAttributeValues(t,s);if(o){const{value:u,size:d}=o;i[a]={value:u,size:d,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}}return i}_getTriangleListIndices(e){const n=e.num_faces()*3,i=n*Mae,s=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,s),new Uint32Array(this.draco.HEAPF32.buffer,s,n).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),Oae(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const n=Pae[t.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const i=t.num_components,a=e.num_points()*i,o=a*n.BYTES_PER_ELEMENT,u=Rae(this.draco,n);let d;const p=this.draco._malloc(o);try{const b=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,b,u,o,p),d=new n(this.draco.HEAPF32.buffer,p,a).slice()}finally{this.draco._free(p)}return{value:d,size:i}}_deduceAttributeName(e,t){const n=e.unique_id;for(const[a,o]of Object.entries(t.extraAttributes||{}))if(o===n)return a;const i=e.attribute_type;for(const a in DR)if(this.draco[a]===i)return DR[a];const s=t.attributeNameEntry||"name";return e.metadata[s]?e.metadata[s].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},n=this.metadataQuerier.NumEntries(e);for(let i=0;i<n;i++){const s=this.metadataQuerier.GetEntryName(e,i);t[s]=this._getDracoMetadataField(e,s)}return t}_getDracoMetadataField(e,t){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);const i=Lae(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:n=[]}=e,i=[...t,...n];for(const s of i)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(e,t){const{quantizedAttributes:n=[]}=t,i=e.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map(o=>a.min_value(o))}}finally{this.draco.destroy(a)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:n=[]}=t,i=e.attribute_type();if(n.map(a=>this.decoder[a]).includes(i)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}}function Rae(r,e){switch(e){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function Lae(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}function Oae(r){const e=r.size(),t=new Int32Array(e);for(let n=0;n<e;n++)t[n]=r.GetValue(n);return t}function Uae(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const Dae=Uae();function kae(r,e){if(!r)throw new Error("loaders.gl assertion failed.")}const Wm=typeof process!="object"||String(process)!=="[object process]"||process.browser,jx=typeof importScripts=="function",kR=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);kR&&parseFloat(kR[1]);const $x={};async function Gx(r,e=null,t={},n=null){return e&&(r=Nae(r,e,t,n)),$x[r]=$x[r]||zae(r),await $x[r]}function Nae(r,e,t={},n=null){if(!t.useLocalLibraries&&r.startsWith("http"))return r;n=n||r;const i=t.modules||{};return i[n]?i[n]:Wm?t.CDN?(kae(t.CDN.startsWith("http")),`${t.CDN}/${e}@${Dae}/dist/libs/${n}`):jx?`../src/libs/${n}`:`modules/${e}/src/libs/${n}`:`modules/${e}/dist/libs/${n}`}async function zae(r){if(r.endsWith("wasm"))return await Hae(r);if(!Wm)try{const{requireFromFile:t}=globalThis.loaders||{};return await t?.(r)}catch(t){return console.error(t),null}if(jx)return importScripts(r);const e=await Vae(r);return Qae(e,r)}function Qae(r,e){if(!Wm){const{requireFromString:n}=globalThis.loaders||{};return n?.(r,e)}if(jx)return eval.call(globalThis,r),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(r))}catch{t.text=r}return document.body.appendChild(t),null}async function Hae(r){const{readFileAsArrayBuffer:e}=globalThis.loaders||{};return Wm||!e||r.startsWith("http")?await(await fetch(r)).arrayBuffer():await e(r)}async function Vae(r){const{readFileAsText:e}=globalThis.loaders||{};return Wm||!e||r.startsWith("http")?await(await fetch(r)).text():await e(r)}const jae="1.5.6",$ae="1.4.1",Wx=`https://www.gstatic.com/draco/versioned/decoders/${jae}`,Ya={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},qx={[Ya.DECODER]:`${Wx}/${Ya.DECODER}`,[Ya.DECODER_WASM]:`${Wx}/${Ya.DECODER_WASM}`,[Ya.FALLBACK_DECODER]:`${Wx}/${Ya.FALLBACK_DECODER}`,[Ya.ENCODER]:`https://raw.githubusercontent.com/google/draco/${$ae}/javascript/${Ya.ENCODER}`};let Kx;async function Gae(r){const e=r.modules||{};return e.draco3d?Kx||=e.draco3d.createDecoderModule({}).then(t=>({draco:t})):Kx||=Wae(r),await Kx}async function Wae(r){let e,t;switch(r.draco&&r.draco.decoderType){case"js":e=await Gx(qx[Ya.FALLBACK_DECODER],"draco",r,Ya.FALLBACK_DECODER);break;case"wasm":default:[e,t]=await Promise.all([await Gx(qx[Ya.DECODER],"draco",r,Ya.DECODER),await Gx(qx[Ya.DECODER_WASM],"draco",r,Ya.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await qae(e,t)}function qae(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(n=>{r({...t,onModuleLoaded:i=>n({draco:i})})})}const NR={...xae,parse:Kae};async function Kae(r,e){const{draco:t}=await Gae(e),n=new Fae(t);try{return n.parseSync(r,e?.draco)}finally{n.destroy()}}function Xae(r){const e={};for(const t in r){const n=r[t];if(t!=="indices"){const i=zR(n);e[t]=i}}return e}function zR(r){const{buffer:e,size:t,count:n}=Yae(r);return{value:e,size:t,byteOffset:0,count:n,type:xR(t),componentType:V0(e)}}function Yae(r){let e=r,t=1,n=0;return r&&r.value&&(e=r.value,t=r.size||1),e&&(ArrayBuffer.isView(e)||(e=Zae(e,Float32Array)),n=e.length/t),{buffer:e,size:t,count:n}}function Zae(r,e,t=!1){return r?Array.isArray(r)?new e(r):t&&!(r instanceof e)?new e(r):r:null}const jA="KHR_draco_mesh_compression",Jae=jA;function ele(r,e,t){const n=new Lo(r);for(const i of QR(n))n.getObjectExtension(i,jA)}async function tle(r,e,t){if(!e?.gltf?.decompressMeshes)return;const n=new Lo(r),i=[];for(const s of QR(n))n.getObjectExtension(s,jA)&&i.push(nle(n,s,e,t));await Promise.all(i),n.removeExtension(jA)}function rle(r,e={}){const t=new Lo(r);for(const n of t.json.meshes||[])ile(n),t.addRequiredExtension(jA)}async function nle(r,e,t,n){const i=r.getObjectExtension(e,jA);if(!i)return;const s=r.getTypedArrayForBufferView(i.bufferView),a=pR(s.buffer,s.byteOffset),o={...t};delete o["3d-tiles"];const u=await hR(a,NR,o,n),d=Xae(u.attributes);for(const[p,b]of Object.entries(d))if(p in e.attributes){const C=e.attributes[p],w=r.getAccessor(C);w?.min&&w?.max&&(b.min=w.min,b.max=w.max)}e.attributes=d,u.indices&&(e.indices=zR(u.indices)),r.removeObjectExtension(e,jA),sle(e)}function ile(r,e,t=4,n,i){if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const s=n.DracoWriter.encodeSync({attributes:r}),a=i?.parseSync?.({attributes:r}),o=n._addFauxAttributes(a.attributes),u=n.addBufferView(s);return{primitives:[{attributes:o,mode:t,extensions:{[jA]:{bufferView:u,attributes:o}}}]}}function sle(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*QR(r){for(const e of r.json.meshes||[])for(const t of e.primitives)yield t}const ole=Object.freeze(Object.defineProperty({__proto__:null,decode:tle,encode:rle,name:Jae,preprocess:ele},Symbol.toStringTag,{value:"Module"})),K0="KHR_texture_transform",ale=K0,X0=new It,lle=new vs,cle=new vs;async function ule(r,e){if(!new Lo(r).hasExtension(K0)||!e.gltf?.loadBuffers)return;const i=r.json.materials||[];for(let s=0;s<i.length;s++)hle(s,r)}function hle(r,e){const t=e.json.materials?.[r],n=[t?.pbrMetallicRoughness?.baseColorTexture,t?.emissiveTexture,t?.normalTexture,t?.occlusionTexture,t?.pbrMetallicRoughness?.metallicRoughnessTexture],i=[];for(const s of n)s&&s?.extensions?.[K0]&&Ale(e,r,s,i)}function Ale(r,e,t,n){const i=fle(t,n);if(!i)return;const s=r.json.meshes||[];for(const a of s)for(const o of a.primitives){const u=o.material;Number.isFinite(u)&&e===u&&dle(r,o,i)}}function fle(r,e){const t=r.extensions?.[K0],{texCoord:n=0}=r,{texCoord:i=n}=t;if(!(e.findIndex(([a,o])=>a===n&&o===i)!==-1)){const a=mle(t);return n!==i&&(r.texCoord=i),e.push([n,i]),{originalTexCoord:n,texCoord:i,matrix:a}}return null}function dle(r,e,t){const{originalTexCoord:n,texCoord:i,matrix:s}=t,a=e.attributes[`TEXCOORD_${n}`];if(Number.isFinite(a)){const o=r.json.accessors?.[a];if(o&&o.bufferView){const u=r.json.bufferViews?.[o.bufferView];if(u){const{arrayBuffer:d,byteOffset:p}=r.buffers[u.buffer],b=(p||0)+(o.byteOffset||0)+(u.byteOffset||0),{ArrayType:C,length:w}=Ox(o,u),M=vR[o.componentType],P=bR[o.type],k=u.byteStride||M*P,D=new Float32Array(w);for(let j=0;j<o.count;j++){const H=new C(d,b+j*k,2);X0.set(H[0],H[1],1),X0.transformByMatrix3(s),D.set([X0[0],X0[1]],j*P)}n===i?ple(o,u,r.buffers,D):gle(i,o,e,r,D)}}}}function ple(r,e,t,n){r.componentType=5126,t.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=n.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function gle(r,e,t,n,i){n.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});const a=n.json.accessors;a&&(a.push({bufferView:s?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes[`TEXCOORD_${r}`]=a.length-1)}function mle(r){const{offset:e=[0,0],rotation:t=0,scale:n=[1,1]}=r,i=new vs().set(1,0,0,0,1,0,e[0],e[1],1),s=lle.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),a=cle.set(n[0],0,0,0,n[1],0,0,0,1);return i.multiplyRight(s).multiplyRight(a)}const _le=Object.freeze(Object.defineProperty({__proto__:null,decode:ule,name:ale},Symbol.toStringTag,{value:"Module"})),rd="KHR_lights_punctual",yle=rd;async function ble(r){const e=new Lo(r),{json:t}=e,n=e.getExtension(rd);n&&(e.json.lights=n.lights,e.removeExtension(rd));for(const i of t.nodes||[]){const s=e.getObjectExtension(i,rd);s&&(i.light=s.light),e.removeObjectExtension(i,rd)}}async function vle(r){const e=new Lo(r),{json:t}=e;if(t.lights){const n=e.addExtension(rd);Tl(!n.lights),n.lights=t.lights,delete t.lights}if(e.json.lights){for(const n of e.json.lights){const i=n.node;e.addObjectExtension(i,rd,n)}delete e.json.lights}}const wle=Object.freeze(Object.defineProperty({__proto__:null,decode:ble,encode:vle,name:yle},Symbol.toStringTag,{value:"Module"})),qm="KHR_materials_unlit",xle=qm;async function Ble(r){const e=new Lo(r),{json:t}=e;for(const n of t.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),e.removeObjectExtension(n,qm);e.removeExtension(qm)}function Cle(r){const e=new Lo(r),{json:t}=e;if(e.materials)for(const n of t.materials||[])n.unlit&&(delete n.unlit,e.addObjectExtension(n,qm,{}),e.addExtension(qm))}const Tle=Object.freeze(Object.defineProperty({__proto__:null,decode:Ble,encode:Cle,name:xle},Symbol.toStringTag,{value:"Module"})),Km="KHR_techniques_webgl",Ele=Km;async function Sle(r){const e=new Lo(r),{json:t}=e,n=e.getExtension(Km);if(n){const i=Ple(n,e);for(const s of t.materials||[]){const a=e.getObjectExtension(s,Km);a&&(s.technique=Object.assign({},a,i[a.technique]),s.technique.values=Mle(s.technique,e)),e.removeObjectExtension(s,Km)}e.removeExtension(Km)}}async function Ile(r,e){}function Ple(r,e){const{programs:t=[],shaders:n=[],techniques:i=[]}=r,s=new TextDecoder;return n.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=s.decode(e.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(a=>{a.fragmentShader=n[a.fragmentShader],a.vertexShader=n[a.vertexShader]}),i.forEach(a=>{a.program=t[a.program]}),i}function Mle(r,e){const t=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(n=>{r.uniforms[n].value&&!(n in t)&&(t[n]=r.uniforms[n].value)}),Object.keys(t).forEach(n=>{typeof t[n]=="object"&&t[n].index!==void 0&&(t[n].texture=e.getTexture(t[n].index))}),t}const HR=[Toe,Yse,gae,yae,wae,ole,wle,Tle,Object.freeze(Object.defineProperty({__proto__:null,decode:Sle,encode:Ile,name:Ele},Symbol.toStringTag,{value:"Module"})),_le,Voe];function Fle(r,e={},t){const n=HR.filter(i=>VR(i.name,e));for(const i of n)i.preprocess?.(r,e,t)}async function Rle(r,e={},t){const n=HR.filter(i=>VR(i.name,e));for(const i of n)await i.decode?.(r,e,t)}function VR(r,e){const t=e?.gltf?.excludeExtensions||{};return!(r in t&&!t[r])}const Xx="KHR_binary_glTF";function Lle(r){const e=new Lo(r),{json:t}=e;for(const n of t.images||[]){const i=e.getObjectExtension(n,Xx);i&&Object.assign(n,i),e.removeObjectExtension(n,Xx)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(Xx)}const jR={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Ole={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class Ule{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,t){this.json=e.json;const n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),Lle(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in jR)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const n=e[t];if(!(!n||Array.isArray(n))){e[t]=[];for(const i in n){const s=n[i];s.id=s.id||i;const a=e[t].length;e[t].push(s),this.idToIndexMap[t][i]=a}}}_convertObjectIdsToArrayIndices(e){for(const t in jR)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:n,indices:i,material:s}=t;for(const a in n)n[a]=this._convertIdToIndex(n[a],"accessor");i&&(t.indices=this._convertIdToIndex(i,"accessor")),s&&(t.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const n of e[t])for(const i in n){const s=n[i],a=this._convertIdToIndex(s,i);n[i]=a}}_convertIdToIndex(e,t){const n=Ole[t];if(n in this.idToIndexMap){const i=this.idToIndexMap[n][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const t of e.materials){t.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const n=t.values?.tex||t.values?.texture2d_0||t.values?.diffuseTex,i=e.textures.findIndex(s=>s.id===n);i!==-1&&(t.pbrMetallicRoughness.baseColorTexture={index:i})}}}function Dle(r,e={}){return new Ule().normalize(r,e)}async function kle(r,e,t=0,n,i){return Nle(r,e,t,n),Dle(r,{normalize:n?.gltf?.normalize}),Fle(r,n,i),n?.gltf?.loadBuffers&&r.json.buffers&&await zle(r,n,i),n?.gltf?.loadImages&&await Qle(r,n,i),await Rle(r,n,i),r}function Nle(r,e,t,n){if(n.uri&&(r.baseUri=n.uri),e instanceof ArrayBuffer&&!Yoe(e,t,n)&&(e=new TextDecoder().decode(e)),typeof e=="string")r.json=Xie(e);else if(e instanceof ArrayBuffer){const a={};t=Zoe(a,e,t,n.glb),Tl(a.type==="glTF",`Invalid GLB magic string ${a.type}`),r._glb=a,r.json=a.json}else Tl(!1,"GLTF: must be ArrayBuffer or string");const i=r.json.buffers||[];if(r.buffers=new Array(i.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:a}=r._glb;r.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}const s=r.json.images||[];r.images=new Array(s.length).fill({})}async function zle(r,e,t){const n=r.json.buffers||[];for(let i=0;i<n.length;++i){const s=n[i];if(s.uri){const{fetch:a}=t;Tl(a);const o=LR(s.uri,e),d=await(await t?.fetch?.(o))?.arrayBuffer?.();r.buffers[i]={arrayBuffer:d,byteOffset:0,byteLength:d.byteLength},delete s.uri}else r.buffers[i]===null&&(r.buffers[i]={arrayBuffer:new ArrayBuffer(s.byteLength),byteOffset:0,byteLength:s.byteLength})}}async function Qle(r,e,t){const n=Hle(r),i=r.json.images||[],s=[];for(const a of n)s.push(Vle(r,i[a],a,e,t));return await Promise.all(s)}function Hle(r){const e=new Set,t=r.json.textures||[];for(const n of t)n.source!==void 0&&e.add(n.source);return Array.from(e).sort()}async function Vle(r,e,t,n,i){let s;if(e.uri&&!e.hasOwnProperty("bufferView")){const o=LR(e.uri,n),{fetch:u}=i;s=await(await u(o)).arrayBuffer(),e.bufferView={data:s}}if(Number.isFinite(e.bufferView)){const o=Use(r.json,r.buffers,e.bufferView);s=pR(o.buffer,o.byteOffset,o.byteLength)}Tl(s,"glTF image has no data");let a=await hR(s,[Cse,_ie],{...n,mimeType:e.mimeType,basis:n.basis||{format:sR()}},i);a&&a[0]&&(a={compressed:!0,mipmaps:!1,width:a[0].width,height:a[0].height,data:a[0]}),r.images=r.images||[],r.images[t]=a}const Xm={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:joe,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:jle,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function jle(r,e={},t){e={...Xm.options,...e},e.gltf={...Xm.options.gltf,...e.gltf};const{byteOffset:n=0}=e;return await kle({},r,n,e,t)}const $le={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Gle={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ec={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Wle={magFilter:ec.TEXTURE_MAG_FILTER,minFilter:ec.TEXTURE_MIN_FILTER,wrapS:ec.TEXTURE_WRAP_S,wrapT:ec.TEXTURE_WRAP_T},qle={[ec.TEXTURE_MAG_FILTER]:ec.LINEAR,[ec.TEXTURE_MIN_FILTER]:ec.NEAREST_MIPMAP_LINEAR,[ec.TEXTURE_WRAP_S]:ec.REPEAT,[ec.TEXTURE_WRAP_T]:ec.REPEAT};function Kle(){return{id:"default-sampler",parameters:qle}}function Xle(r){return Gle[r]}function Yle(r){return $le[r]}class Zle{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(e,t={}){const{json:n,buffers:i=[],images:s=[]}=e,{baseUri:a=""}=e;return Tl(n),this.baseUri=a,this.buffers=i,this.images=s,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){const n={...e};return this.json=n,e.bufferViews&&(n.bufferViews=e.bufferViews.map((i,s)=>this._resolveBufferView(i,s))),e.images&&(n.images=e.images.map((i,s)=>this._resolveImage(i,s))),e.samplers&&(n.samplers=e.samplers.map((i,s)=>this._resolveSampler(i,s))),e.textures&&(n.textures=e.textures.map((i,s)=>this._resolveTexture(i,s))),e.accessors&&(n.accessors=e.accessors.map((i,s)=>this._resolveAccessor(i,s))),e.materials&&(n.materials=e.materials.map((i,s)=>this._resolveMaterial(i,s))),e.meshes&&(n.meshes=e.meshes.map((i,s)=>this._resolveMesh(i,s))),e.nodes&&(n.nodes=e.nodes.map((i,s)=>this._resolveNode(i,s)),n.nodes=n.nodes.map((i,s)=>this._resolveNodeChildren(i))),e.skins&&(n.skins=e.skins.map((i,s)=>this._resolveSkin(i,s))),e.scenes&&(n.scenes=e.scenes.map((i,s)=>this._resolveScene(i,s))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const n=e&&e[t];return n||console.warn(`glTF file error: Could not find ${e}[${t}]`),n}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(e,t){const n={...e,id:e?.id||`node-${t}`};return e.mesh!==void 0&&(n.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(n.camera=this.getCamera(e.camera)),e.skin!==void 0&&(n.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(n.mesh=e.meshes.reduce((i,s)=>{const a=this.getMesh(s);return i.id=a.id,i.primitives=i.primitives.concat(a.primitives),i},{primitives:[]})),n}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const n=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:n}}_resolveMesh(e,t){const n={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(n.primitives=e.primitives.map(i=>{const s={...i,attributes:{},indices:void 0,material:void 0},a=i.attributes;for(const o in a)s.attributes[o]=this.getAccessor(a[o]);return i.indices!==void 0&&(s.indices=this.getAccessor(i.indices)),i.material!==void 0&&(s.material=this.getMaterial(i.material)),s})),n}_resolveMaterial(e,t){const n={...e,id:e.id||`material-${t}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const i=n.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return n}_resolveAccessor(e,t){const n=Xle(e.componentType),i=Yle(e.type),s=n*i,a={...e,id:e.id||`accessor-${t}`,bytesPerComponent:n,components:i,bytesPerElement:s,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(a.bufferView=this.getBufferView(e.bufferView)),a.bufferView){const o=a.bufferView.buffer,{ArrayType:u,byteLength:d}=Ox(a,a.bufferView),p=(a.bufferView.byteOffset||0)+(a.byteOffset||0)+o.byteOffset;let b=o.arrayBuffer.slice(p,p+d);a.bufferView.byteStride&&(b=this._getValueFromInterleavedBuffer(o,p,a.bufferView.byteStride,a.bytesPerElement,a.count)),a.value=new u(b)}return a}_getValueFromInterleavedBuffer(e,t,n,i,s){const a=new Uint8Array(s*i);for(let o=0;o<s;o++){const u=t+o*n;a.set(new Uint8Array(e.arrayBuffer.slice(u,u+i)),o*i)}return a.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):Kle(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const n={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const i in n){const s=this._enumSamplerParameter(i);s!==void 0&&(n.parameters[s]=n[i])}return n}_enumSamplerParameter(e){return Wle[e]}_resolveImage(e,t){const n={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},i=this.images[t];return i&&(n.image=i),n}_resolveBufferView(e,t){const n=e.buffer,i=this.buffers[n].arrayBuffer;let s=this.buffers[n].byteOffset||0;return e.byteOffset&&(s+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[n],data:new Uint8Array(i,s,e.byteLength)}}_resolveCamera(e,t){const n={...e,id:e.id||`camera-${t}`};return n.perspective,n.orthographic,n}}function Yx(r,e){return new Zle().postProcess(r,e)}async function Jle(r){const e=[];return r.scenes.forEach(t=>{t.traverse(n=>{})}),await ece(()=>e.some(t=>!t.loaded))}async function ece(r){for(;r();)await new Promise(e=>requestAnimationFrame(e))}const $R=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,tce={name:"scenegraph",vs:$R,fs:$R,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},rce=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,nce=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,GR=[255,255,255,255],ice={scenegraph:{type:"object",value:null,async:!0},getScene:r=>r&&r.scenes?typeof r.scene=="object"?r.scene:r.scenes[r.scene||0]:r,getAnimator:r=>r&&r.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:GR},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[Xm]};class Zx extends Op{getShaders(){const e={};let t;this.props._lighting==="pbr"?(t=c2,e.LIGHTING_PBR=1):t={name:"pbrMaterial"};const n=[_2,C2,tce,t];return super.getShaders({defines:e,vs:rce,fs:nce,modules:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:GR,transition:!0},instanceModelMatrix:qF})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.scenegraph!==n.scenegraph?this._updateScenegraph():t._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,t._animations)}finalizeState(e){super.finalizeState(e),this.state.scenegraph?.destroy()}get isLoaded(){return!!(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){const e=this.props,{device:t}=this.context;let n=null;if(e.scenegraph instanceof v0)n={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){const o=e.scenegraph,u=o.json?Yx(o):o,d=Wie(t,u,this._getModelOptions());n={gltf:u,...d},Jle(d).then(()=>{this.setNeedsRedraw()}).catch(p=>{this.raiseError(p,"loading glTF")})}const i={layer:this,device:this.context.device},s=e.getScene(n,i),a=e.getAnimator(n,i);if(s instanceof Cp){this.state.scenegraph?.destroy(),this._applyAnimationsProp(a,e._animations);const o=[];s.traverse(u=>{u instanceof D2&&o.push(u.model)}),this.setState({scenegraph:s,animator:a,models:o}),this.getAttributeManager().invalidateAll()}else s!==null&&$n.warn("invalid scenegraph:",s)()}_applyAnimationsProp(e,t){if(!e||!t)return;const n=e.getAnimations();Object.keys(t).sort().forEach(i=>{const s=t[i];if(i==="*")n.forEach(a=>{Object.assign(a,s)});else if(Number.isFinite(Number(i))){const a=Number(i);a>=0&&a<n.length?Object.assign(n[a],s):$n.warn(`animation ${i} not found`)()}else{const a=n.find(({animation:o})=>o.name===i);a?Object.assign(a,s):$n.warn(`animation ${i} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{imageBasedLightingEnvironment:t,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());const{viewport:t,renderPass:n}=this.context,{sizeScale:i,sizeMinPixels:s,sizeMaxPixels:a,coordinateSystem:o}=this.props,u={camera:t.cameraPosition},d=this.getNumInstances();this.state.scenegraph.traverse((p,{worldMatrix:b})=>{if(p instanceof D2){const{model:C}=p;C.setInstanceCount(d);const w={sizeScale:i,sizeMinPixels:s,sizeMaxPixels:a,composeModelMatrix:KF(t,o),sceneModelMatrix:b};C.shaderInputs.setProps({pbrProjection:u,scenegraph:w}),C.draw(n)}})}}Zx.defaultProps=ice,Zx.layerName="ScenegraphLayer";const WR=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,sce={name:"mesh",vs:WR,fs:WR,uniformTypes:{pickFeatureIds:"f32"}},oce=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ace=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function lce(r){const e=r.positions||r.POSITION,t=e.value.length/e.size;r.COLOR_0||r.colors||(r.colors={size:4,value:new Uint8Array(t*4).fill(255),normalized:!0})}const cce={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class Jx extends wx{getShaders(){const e=super.getShaders();return e.modules.push(c2,sce),{...e,vs:oce,fs:ace}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;t.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props,{model:n}=this.state;if(!n)return;const i={pickFeatureIds:!!t},s={camera:this.context.viewport.cameraPosition};n.shaderInputs.setProps({pbrProjection:s,mesh:i}),super.draw(e)}getModel(e){const{id:t}=this.props,n=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:n});const i=this.getShaders();return lce(e.attributes),new DA(this.context.device,{...this.getShaders(),id:t,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...i.defines,...n?.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:n?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:n}=this.props,i=this.parseMaterial(e,n);this.setState({parsedPBRMaterial:i});const{pbr_baseColorSampler:s}=i.bindings,{emptyTexture:a}=this.state,o={sampler:s||a,hasTexture:!!s},{camera:u,...d}={...i.bindings,...i.uniforms};t.shaderInputs.setProps({simpleMesh:o,pbrMaterial:d})}}parseMaterial(e,t){const n=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return aR(this.context.device,{unlit:n,...e},{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,n=new Uint8ClampedArray(t.length*e.size),i=[];for(let s=0;s<t.length;s++)this.encodePickingColor(t[s],i),n[s*3]=i[0],n[s*3+1]=i[1],n[s*3+2]=i[2];e.value=n}finalizeState(e){super.finalizeState(e),this.state.parsedPBRMaterial?.generatedTextures.forEach(t=>t.destroy()),this.setState({parsedPBRMaterial:null})}}Jx.layerName="MeshLayer",Jx.defaultProps=cce;const uce=6378137,hce=6378137,Ace=6356752314245179e-9;function Y0(r){return r}new It;function fce(r,e=[],t=Y0){return"longitude"in r?(e[0]=t(r.longitude),e[1]=t(r.latitude),e[2]=r.height):"x"in r?(e[0]=t(r.x),e[1]=t(r.y),e[2]=r.z):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function dce(r,e=[]){return fce(r,e,_o._cartographicRadians?Y0:Xq)}function pce(r,e,t=Y0){return"longitude"in e?(e.longitude=t(r[0]),e.latitude=t(r[1]),e.height=r[2]):"x"in e?(e.x=t(r[0]),e.y=t(r[1]),e.z=r[2]):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function gce(r,e){return pce(r,e,_o._cartographicRadians?Y0:Yq)}const qR=1e-14,mce=new It,KR={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},eB={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ym={east:new It,north:new It,up:new It,west:new It,south:new It,down:new It},_ce=new It,yce=new It,bce=new It;function XR(r,e,t,n,i,s){const a=KR[e]&&KR[e][t];kc(a&&(!n||n===a));let o,u,d;const p=mce.copy(i);if(Dc(p.x,0,qR)&&Dc(p.y,0,qR)){const C=Math.sign(p.z);o=_ce.fromArray(eB[e]),e!=="east"&&e!=="west"&&o.scale(C),u=yce.fromArray(eB[t]),t!=="east"&&t!=="west"&&u.scale(C),d=bce.fromArray(eB[n]),n!=="east"&&n!=="west"&&d.scale(C)}else{const{up:C,east:w,north:M}=Ym;w.set(-p.y,p.x,0).normalize(),r.geodeticSurfaceNormal(p,C),M.copy(C).cross(w);const{down:P,west:k,south:D}=Ym;P.copy(C).scale(-1),k.copy(w).scale(-1),D.copy(M).scale(-1),o=Ym[e],u=Ym[t],d=Ym[n]}return s[0]=o.x,s[1]=o.y,s[2]=o.z,s[3]=0,s[4]=u.x,s[5]=u.y,s[6]=u.z,s[7]=0,s[8]=d.x,s[9]=d.y,s[10]=d.z,s[11]=0,s[12]=p.x,s[13]=p.y,s[14]=p.z,s[15]=1,s}const Hp=new It,vce=new It,wce=new It;function xce(r,e,t=[]){const{oneOverRadii:n,oneOverRadiiSquared:i,centerToleranceSquared:s}=e;Hp.from(r);const a=Hp.x,o=Hp.y,u=Hp.z,d=n.x,p=n.y,b=n.z,C=a*a*d*d,w=o*o*p*p,M=u*u*b*b,P=C+w+M,k=Math.sqrt(1/P);if(!Number.isFinite(k))return;const D=vce;if(D.copy(r).scale(k),P<s)return D.to(t);const j=i.x,H=i.y,N=i.z,q=wce;q.set(D.x*j*2,D.y*H*2,D.z*N*2);let W=(1-k)*Hp.len()/(.5*q.len()),ie=0,se,Z,fe,te;do{W-=ie,se=1/(1+W*j),Z=1/(1+W*H),fe=1/(1+W*N);const ce=se*se,ve=Z*Z,me=fe*fe,qe=ce*se,ot=ve*Z,st=me*fe;te=C*ce+w*ve+M*me-1;const Xe=-2*(C*qe*j+w*ot*H+M*st*N);ie=te/Xe}while(Math.abs(te)>gX);return Hp.scale([se,Z,fe]).to(t)}const Z0=new It,YR=new It,Bce=new It,Hc=new It,Cce=new It,J0=new It;class Oi{constructor(e=0,t=0,n=0){this.centerToleranceSquared=pX,kc(e>=0),kc(t>=0),kc(n>=0),this.radii=new It(e,t,n),this.radiiSquared=new It(e*e,t*t,n*n),this.radiiToTheFourth=new It(e*e*e*e,t*t*t*t,n*n*n*n),this.oneOverRadii=new It(e===0?0:1/e,t===0?0:1/t,n===0?0:1/n),this.oneOverRadiiSquared=new It(e===0?0:1/(e*e),t===0?0:1/(t*t),n===0?0:1/(n*n)),this.minimumRadius=Math.min(e,t,n),this.maximumRadius=Math.max(e,t,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0]){const n=YR,i=Bce,[,,s]=e;this.geodeticSurfaceNormalCartographic(e,n),i.copy(this.radiiSquared).scale(n);const a=Math.sqrt(n.dot(i));return i.scale(1/a),n.scale(s),i.add(n),i.to(t)}cartesianToCartographic(e,t=[0,0,0]){J0.from(e);const n=this.scaleToGeodeticSurface(J0,Hc);if(!n)return;const i=this.geodeticSurfaceNormal(n,YR),s=Cce;s.copy(J0).subtract(n);const a=Math.atan2(i.y,i.x),o=Math.asin(i.z),u=Math.sign(Xw(s,J0))*KP(s);return gce([a,o,u],t)}eastNorthUpToFixedFrame(e,t=new zn){return XR(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,n,i,s=new zn){return XR(this,e,t,n,i,s)}geocentricSurfaceNormal(e,t=[0,0,0]){return Z0.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0]){const n=dce(e),i=n[0],s=n[1],a=Math.cos(s);return Z0.set(a*Math.cos(i),a*Math.sin(i),Math.sin(s)).normalize(),Z0.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return Z0.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return xce(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){Hc.from(e);const n=Hc.x,i=Hc.y,s=Hc.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(n*n*a.x+i*i*a.y+s*s*a.z);return Hc.multiplyScalar(o).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return Hc.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return Hc.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,n=[0,0,0]){kc(Dc(this.radii.x,this.radii.y,AM)),kc(this.radii.z>0),Hc.from(e);const i=Hc.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-t))return Hc.set(0,0,i).to(n)}}Oi.WGS84=new Oi(uce,hce,Ace);function nd(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const Tce="Queued Requests",Ece="Active Requests",Sce="Cancelled Requests",Ice="Queued Requests Ever",Pce="Active Requests Ever",Mce={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class Fce{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...Mce,...e},this.stats=new up({id:this.props.id}),this.stats.get(Tce),this.stats.get(Ece),this.stats.get(Sce),this.stats.get(Ice),this.stats.get(Pce)}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const n={handle:e,priority:0,getPriority:t},i=new Promise(s=>(n.resolve=s,n));return this.requestQueue.push(n),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:t,resolve:n}=e;let i=!1;const s=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const n=e[t];this._updateRequest(n)||(e.splice(t,1),this.requestMap.delete(n.handle),t--)}e.sort((t,n)=>t.priority-n.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}function Rce(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}class Lce{item;previous;next;constructor(e,t,n){this.item=e,this.previous=t,this.next=n}}class Oce{head=null;tail=null;_length=0;get length(){return this._length}add(e){const t=new Lce(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const n=e.next;e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e,++this._length}}class Uce{_list;_sentinel;_trimTiles;constructor(){this._list=new Oce,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,n){t._cacheNode||(t._cacheNode=this._list.add(t),n&&n(e,t))}unloadTile(e,t,n){const i=t._cacheNode;i&&(this._list.remove(i),t._cacheNode=null,n&&n(e,t))}unloadTiles(e,t){const n=this._trimTiles;this._trimTiles=!1;const i=this._list,s=e.maximumMemoryUsage*1024*1024,a=this._sentinel;let o=i.head;for(;o!==a&&(e.gpuMemoryUsageInBytes>s||n);){const u=o.item;o=o.next,this.unloadTile(e,u,t)}}trim(){this._trimTiles=!0}}function Dce(r,e){nd(r),nd(e);const{rtcCenter:t,gltfUpAxis:n}=e,{computedTransform:i,boundingVolume:{center:s}}=r;let a=new zn(i);switch(t&&a.translate(t),n){case"Z":break;case"Y":const b=new zn().rotateX(Math.PI/2);a=a.multiplyRight(b);break;case"X":const C=new zn().rotateY(-Math.PI/2);a=a.multiplyRight(C);break}e.isQuantized&&a.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const o=new It(s);e.cartesianModelMatrix=a,e.cartesianOrigin=o;const u=Oi.WGS84.cartesianToCartographic(o,new It),p=Oi.WGS84.eastNorthUpToFixedFrame(o).invert();e.cartographicModelMatrix=p.multiplyRight(a),e.cartographicOrigin=u,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const ZR=new It,tB=new It,rB=new Jl([new zu,new zu,new zu,new zu,new zu,new zu]);function kce(r,e){const{cameraDirection:t,cameraUp:n,height:i}=r,{metersPerUnit:s}=r.distanceScales,a=eb(r,r.center),o=Oi.WGS84.eastNorthUpToFixedFrame(a),u=r.unprojectPosition(r.cameraPosition),d=Oi.WGS84.cartographicToCartesian(u,new It),p=new It(o.transformAsVector(new It(t).scale(s))).normalize(),b=new It(o.transformAsVector(new It(n).scale(s))).normalize();zce(r);const C=r.constructor,{longitude:w,latitude:M,width:P,bearing:k,zoom:D}=r,j=new C({longitude:w,latitude:M,height:i,width:P,bearing:k,zoom:D,pitch:0});return{camera:{position:d,direction:p,up:b},viewport:r,topDownViewport:j,height:i,cullingVolume:rB,frameNumber:e,sseDenominator:1.15}}function Nce(r,e,t){if(t===0||r.length<=t)return[r,[]];const n=[],{longitude:i,latitude:s}=e.viewport;for(const[d,p]of r.entries()){const[b,C]=p.header.mbs,w=Math.abs(i-b),M=Math.abs(s-C),P=Math.sqrt(M*M+w*w);n.push([d,P])}const a=n.sort((d,p)=>d[1]-p[1]),o=[];for(let d=0;d<t;d++)o.push(r[a[d][0]]);const u=[];for(let d=t;d<a.length;d++)u.push(r[a[d][0]]);return[o,u]}function zce(r){const e=r.getFrustumPlanes(),t=JR(e.near,r.cameraPosition),n=eb(r,t),i=eb(r,r.cameraPosition,tB);let s=0;rB.planes[s++].fromPointNormal(n,ZR.copy(n).subtract(i));for(const a in e){if(a==="near")continue;const o=e[a],u=JR(o,t,tB),d=eb(r,u,tB);rB.planes[s++].fromPointNormal(d,ZR.copy(n).subtract(d))}}function JR(r,e,t=new It){const n=r.normal.dot(e);return t.copy(r.normal).scale(r.distance-n).add(e),t}function eb(r,e,t=new It){const n=r.unprojectPosition(e);return Oi.WGS84.cartographicToCartesian(n,t)}const Qce=6378137,Hce=6378137,nB=6356752314245179e-9,Vp=new It;function Vce(r,e){if(r instanceof Qm){const{halfAxes:t}=r,n=$ce(t);return Math.log2(nB/(n+e[2]))}else if(r instanceof zm){const{radius:t}=r;return Math.log2(nB/(t+e[2]))}else if(r.width&&r.height){const{width:t,height:n}=r,i=Math.log2(Qce/t),s=Math.log2(Hce/n);return(i+s)/2}return 1}function eL(r,e,t){Oi.WGS84.cartographicToCartesian([r.xmax,r.ymax,r.zmax],Vp);const n=Math.sqrt(Math.pow(Vp[0]-t[0],2)+Math.pow(Vp[1]-t[1],2)+Math.pow(Vp[2]-t[2],2));return Math.log2(nB/(n+e[2]))}function jce(r,e,t){const[n,i,s,a]=r;return eL({xmax:s,ymax:a,zmax:0},e,t)}function $ce(r){r.getColumn(0,Vp);const e=r.getColumn(1),t=r.getColumn(2);return Vp.add(e).add(t).len()}const El={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var Vc;(function(r){r[r.ADD=1]="ADD",r[r.REPLACE=2]="REPLACE"})(Vc||(Vc={}));var Dh;(function(r){r.EMPTY="empty",r.SCENEGRAPH="scenegraph",r.POINTCLOUD="pointcloud",r.MESH="mesh"})(Dh||(Dh={}));var Za;(function(r){r.I3S="I3S",r.TILES3D="TILES3D"})(Za||(Za={}));var jp;(function(r){r.GEOMETRIC_ERROR="geometricError",r.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(jp||(jp={}));const Gce={USE_OPTIMIZATION:1};function tL(r){return r!=null}const la=new It,tb=new It,Wce=new It,qce=new It,id=new It,rL=new It,nL=new It,iL=new It;function iB(r,e,t){if(nd(r,"3D Tile: boundingVolume must be defined"),r.box)return sL(r.box,e,t);if(r.region)return Yce(r.region);if(r.sphere)return Xce(r.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function Kce(r,e){if(r.box)return Zce(e);if(r.region){const[t,n,i,s,a,o]=r.region;return[[Oc(t),Oc(n),a],[Oc(i),Oc(s),o]]}if(r.sphere)return Jce(e);throw new Error("Unkown boundingVolume type")}function sL(r,e,t){const n=new It(r[0],r[1],r[2]);e.transform(n,n);let i=[];if(r.length===10){const d=r.slice(3,6),p=new mm;p.fromArray(r,6);const b=new It([1,0,0]),C=new It([0,1,0]),w=new It([0,0,1]);b.transformByQuaternion(p),b.scale(d[0]),C.transformByQuaternion(p),C.scale(d[1]),w.transformByQuaternion(p),w.scale(d[2]),i=[...b.toArray(),...C.toArray(),...w.toArray()]}else i=[...r.slice(3,6),...r.slice(6,9),...r.slice(9,12)];const s=e.transformAsVector(i.slice(0,3)),a=e.transformAsVector(i.slice(3,6)),o=e.transformAsVector(i.slice(6,9)),u=new vs([s[0],s[1],s[2],a[0],a[1],a[2],o[0],o[1],o[2]]);return tL(t)?(t.center=n,t.halfAxes=u,t):new Qm(n,u)}function Xce(r,e,t){const n=new It(r[0],r[1],r[2]);e.transform(n,n);const i=e.getScale(tb),s=Math.max(Math.max(i[0],i[1]),i[2]),a=r[3]*s;return tL(t)?(t.center=n,t.radius=a,t):new zm(n,a)}function Yce(r){const[e,t,n,i,s,a]=r,o=Oi.WGS84.cartographicToCartesian([Oc(e),Oc(i),s],Wce),u=Oi.WGS84.cartographicToCartesian([Oc(n),Oc(t),a],qce),d=new It().addVectors(o,u).multiplyByScalar(.5);return Oi.WGS84.cartesianToCartographic(d,id),Oi.WGS84.cartographicToCartesian([Oc(n),id[1],id[2]],rL),Oi.WGS84.cartographicToCartesian([id[0],Oc(i),id[2]],nL),Oi.WGS84.cartographicToCartesian([id[0],id[1],a],iL),sL([...d,...rL.subtract(d),...nL.subtract(d),...iL.subtract(d)],new zn)}function Zce(r){const e=oL(),{halfAxes:t}=r,n=new It(t.getColumn(0)),i=new It(t.getColumn(1)),s=new It(t.getColumn(2));for(let a=0;a<2;a++){for(let o=0;o<2;o++){for(let u=0;u<2;u++)la.copy(r.center),la.add(n),la.add(i),la.add(s),aL(e,la),s.negate();i.negate()}n.negate()}return e}function Jce(r){const e=oL(),{center:t,radius:n}=r,i=Oi.WGS84.scaleToGeodeticSurface(t,la);let s;i?s=Oi.WGS84.geodeticSurfaceNormal(i):s=new It(0,0,1);let a=new It(s[2],-s[1],0);a.len()>0?a.normalize():a=new It(0,1,0);const o=a.clone().cross(s);for(const u of[a,o,s]){tb.copy(u).scale(n);for(let d=0;d<2;d++)la.copy(t),la.add(tb),aL(e,la),tb.negate()}return e}function oL(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function aL(r,e){Oi.WGS84.cartesianToCartographic(e,la),r[0][0]=Math.min(r[0][0],la[0]),r[0][1]=Math.min(r[0][1],la[1]),r[0][2]=Math.min(r[0][2],la[2]),r[1][0]=Math.max(r[1][0],la[0]),r[1][1]=Math.max(r[1][1],la[1]),r[1][2]=Math.max(r[1][2],la[2])}new It,new It,new zn,new It,new It,new It;function eue(r,e){const t=r*e;return 1-Math.exp(-(t*t))}function tue(r,e){if(r.dynamicScreenSpaceError&&r.dynamicScreenSpaceErrorComputedDensity){const t=r.dynamicScreenSpaceErrorComputedDensity,n=r.dynamicScreenSpaceErrorFactor;return eue(e,t)*n}return 0}function rue(r,e,t){const n=r.tileset,i=r.parent&&r.parent.lodMetricValue||r.lodMetricValue,s=t?i:r.lodMetricValue;if(s===0)return 0;const a=Math.max(r._distanceToCamera,1e-7),{height:o,sseDenominator:u}=e,{viewDistanceScale:d}=n.options;let p=s*o*(d||1)/(a*u);return p-=tue(n,a),p}const sB=new It,lL=new It,$A=new It,cL=new It,nue=new It,oB=new zn,uL=new zn;function iue(r,e){if(r.lodMetricValue===0||isNaN(r.lodMetricValue))return"DIG";const t=2*hL(r,e);return t<2?"OUT":!r.header.children||t<=r.lodMetricValue?"DRAW":r.header.children?"DIG":"OUT"}function hL(r,e){const{topDownViewport:t}=e,n=r.header.mbs[1],i=r.header.mbs[0],s=r.header.mbs[2],a=r.header.mbs[3],o=[...r.boundingVolume.center],u=t.unprojectPosition(t.cameraPosition);Oi.WGS84.cartographicToCartesian(u,sB),lL.copy(sB).subtract(o).normalize(),Oi.WGS84.eastNorthUpToFixedFrame(o,oB),uL.copy(oB).invert(),$A.copy(sB).transform(uL);const d=Math.sqrt($A[0]*$A[0]+$A[1]*$A[1]),p=d*d/$A[2];cL.copy([$A[0],$A[1],p]);const C=cL.transform(oB).subtract(o).normalize(),M=lL.cross(C).normalize().scale(a).add(o),P=Oi.WGS84.cartesianToCartographic(M),k=t.project([i,n,s]),D=t.project(P);return nue.copy(k).subtract(D).magnitude()}function sue(r){return{assetGltfUpAxis:r.asset&&r.asset.gltfUpAxis||"Y"}}class AL{_map=new Map;_array;_length;constructor(e=0){this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return nd(e<this._array.length),this._array[e]}set(e,t){nd(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){nd(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){nd(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const oue={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class rb{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=new Date().getTime();updateDebounceTime=1e3;_traversalStack=new AL;_emptyTraversalStack=new AL;_frameNumber=null;traversalFinished(e){return!0}constructor(e){this.options={...oue,...e}}traverse(e,t,n){this.root=e,this.options={...this.options,...n},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const n=this._traversalStack;for(e._selectionDepth=1,n.push(e);n.length>0;){const s=n.pop();let a=!1;this.canTraverse(s,t)&&(this.updateChildTiles(s,t),a=this.updateAndPushChildren(s,t,n,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const o=s.parent,u=!!(!o||o._shouldRefine),d=!a;s.hasRenderContent?s.refine===Vc.ADD?(this.loadTile(s,t),this.selectTile(s,t)):s.refine===Vc.REPLACE&&(this.loadTile(s,t),d&&this.selectTile(s,t)):(this.emptyTiles[s.id]=s,this.loadTile(s,t),d&&this.selectTile(s,t)),this.touchTile(s,t),s._shouldRefine=a&&u}const i=new Date().getTime();(this.traversalFinished(t)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const n=e.children;for(const i of n)this.updateTile(i,t)}updateAndPushChildren(e,t,n,i){const{loadSiblings:s,skipLevelOfDetail:a}=this.options,o=e.children;o.sort(this.compareDistanceToCamera.bind(this));const u=e.refine===Vc.REPLACE&&e.hasRenderContent&&!a;let d=!1,p=!0;for(const b of o)if(b._selectionDepth=i,b.isVisibleAndInRequestVolume?(n.find(b)&&n.delete(b),n.push(b),d=!0):(u||s)&&(this.loadTile(b,t),this.touchTile(b,t)),u){let C;if(b._inRequestVolume?b.hasRenderContent?C=b.contentAvailable:C=this.executeEmptyTraversal(b,t):C=!1,p=p&&C,!p)return!1}return d||(p=!1),p}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,n=!1){let i=e._screenSpaceError;return n&&(i=e.getScreenSpaceError(t,!0)),i>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){const n=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap)this.options.viewportTraversersMap[i]===t.viewport.id&&n.push(i);else n.push(t.viewport.id);e.updateVisibility(t,n)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let n=!1;for(const i of e.children)i.updateVisibility(t),n=n||i.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(e,t){let n=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0;){const s=i.pop(),a=!s.hasRenderContent&&this.canTraverse(s,t),o=!s.hasRenderContent&&s.children.length===0;if(!a&&!s.contentAvailable&&!o&&(n=!1),this.updateTile(s,t),s.isVisibleAndInRequestVolume||(this.loadTile(s,t),this.touchTile(s,t)),a){const u=s.children;for(const d of u)i.push(d)}}return n}}const fL=new It;function aue(r){return r!=null}class aB{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=El.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new zn;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new rb({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new zn;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(e,t,n,i=""){this.header=t,this.tileset=e,this.id=i||t.id,this.url=t.url,this.parent=n,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===El.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===El.UNLOADED}get contentExpired(){return this.contentState===El.EXPIRED}get contentFailed(){return this.contentState===El.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=Kce(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case Za.I3S:return hL(this,e);case Za.TILES3D:return rue(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,n=this.refine===Vc.ADD||t;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===El.UNLOADED)return-1;const i=this.parent,a=i&&(!n||this._screenSpaceError===0||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,o=e.root?e.root._screenSpaceError:0;return Math.max(o-a,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=El.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=El.UNLOADED,!1;try{const n=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.loader,s={...this.tileset.loadOptions,[i.id]:{...this.tileset.loadOptions[i.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(i.id)}};return this.content=await PA(n,i,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=El.READY,this._onContentLoaded(),!0}catch(n){throw this.contentState=El.FAILED,n}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=El.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const n=this.parent,i=n?n._visibilityPlaneMask:Jl.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==Jl.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:n}=e,{boundingVolume:i}=this;return n.computeVisibilityWithPlaneMask(i,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const t=this.boundingVolume;return fL.subVectors(t.center,e.position),e.direction.dot(fL)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(aue(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=El.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new zn(e.transform):new zn;const t=this.parent,n=this.tileset,i=t&&t.computedTransform?t.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new zn(i).multiplyRight(this.transform);const s=t&&t._initialTransform?t._initialTransform.clone():new zn;this._initialTransform=new zn(s).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=El.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Jl.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||Vc.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=iB(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=iB(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=iB(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new zn){const t=e.clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return sue(this.tileset.tileset)}}}class lue extends rb{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const n=e.children.length>0;if(e.hasTilesetContent&&n){const a=e.children[0];this.updateTileVisibility(a,t),e._visible=a._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}const i=e.refine===Vc.REPLACE,s=e._optimChildrenWithinParent===Gce.USE_OPTIMIZATION;if(i&&s&&n&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){const{parent:n}=e;return!n||n.hasTilesetContent||n.refine!==Vc.ADD?!1:!this.shouldRefine(e,t,!0)}}class cue{frameNumberMap=new Map;register(e,t){const n=this.frameNumberMap.get(e)||new Map,i=n.get(t)||0;n.set(t,i+1),this.frameNumberMap.set(e,n)}deregister(e,t){const n=this.frameNumberMap.get(e);if(!n)return;const i=n.get(t)||1;n.set(t,i-1)}isZero(e,t){return(this.frameNumberMap.get(e)?.get(t)||0)===0}}const lB={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class uue{_statusMap;pendingTilesRegister=new cue;constructor(){this._statusMap={}}add(e,t,n,i){if(!this._statusMap[t]){const{frameNumber:s,viewport:{id:a}}=i;this._statusMap[t]={request:e,callback:n,key:t,frameState:i,status:lB.REQUESTED},this.pendingTilesRegister.register(a,s),e().then(o=>{this._statusMap[t].status=lB.COMPLETED;const{frameNumber:u,viewport:{id:d}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(d,u),this._statusMap[t].callback(o,i)}).catch(o=>{this._statusMap[t].status=lB.ERROR;const{frameNumber:u,viewport:{id:d}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(d,u),n(o)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:n,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,n);const{frameNumber:s,viewport:{id:a}}=t;this.pendingTilesRegister.register(a,s),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class hue extends rb{_tileManager;constructor(e){super(e),this._tileManager=new uue}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=iue(e,t),e._lodJudge==="DIG"}updateChildTiles(e,t){const n=e.header.children||[],i=e.children,s=e.tileset;for(const a of n){const o=`${a.id}-${t.viewport.id}`,u=i&&i.find(d=>d.id===o);if(u)u&&this.updateTile(u,t);else{let d=()=>this._loadTile(a.id,s);this._tileManager.find(o)?this._tileManager.update(o,t):(s.tileset.nodePages&&(d=()=>s.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(d,o,b=>this._onTileLoad(b,e,o),t))}}return!1}async _loadTile(e,t){const{loader:n}=t,i=t.getTileUrl(`${t.url}/nodes/${e}`),s={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await PA(i,n,s)}_onTileLoad(e,t,n){const i=new aB(t.tileset,e,t,n);t.children.push(i);const s=this._tileManager.find(i.id).frameState;this.updateTile(i,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,s)}}const Aue={description:"",ellipsoid:Oi.WGS84,modelMatrix:new zn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:r=>r,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},nb="Tiles In Tileset(s)",cB="Tiles In Memory",dL="Tiles In View",pL="Tiles To Render",gL="Tiles Loaded",uB="Tiles Loading",mL="Tiles Unloaded",_L="Failed Tile Loads",yL="Points/Vertices",hB="Tile Memory Use",bL="Maximum Screen Space Error";class fue{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new Uce;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(e,t){this.options={...Aue,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||Rce(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Fce({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new up({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let n=e;return this.queryParams.length&&(n=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),n}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const n=[];for(const i of t){const s=i.id;this._needTraverse(s)?n.push(s):this.traverseCounter--}for(const i of t){const s=i.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!n.includes(s))continue;const a=kce(i,this._frameNumber);this._traverser.traverse(this.roots[s],a,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[t],i=Object.values(this._traverser.selectedTiles),[s,a]=Nce(i,e,this.options.maximumTilesSelected);n.selectedTiles=s;for(const o of a)o.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const n=new Set(e.map(a=>a.id)),i=new Set(t.map(a=>a.id));let s=e.filter(a=>!i.has(a.id)).length>0;return s=s||t.filter(a=>!n.has(a.id)).length>0,s}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(e++,n.content.pointCount?t+=n.content.pointCount:t+=n.content.vertexCount);this.stats.get(dL).count=this.selectedTiles.length,this.stats.get(pL).count=e,this.stats.get(yL).count=t,this.stats.get(bL).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===Za.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Za.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Za.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){const e=this.tileset.fullExtent;if(e){const{xmin:n,xmax:i,ymin:s,ymax:a,zmin:o,zmax:u}=e;this.cartographicCenter=new It(n+(i-n)/2,s+(a-s)/2,o+(u-o)/2),this.cartesianCenter=new It,Oi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=eL(e,this.cartographicCenter,this.cartesianCenter);return}const t=this.tileset.store?.extent;if(t){const[n,i,s,a]=t;this.cartographicCenter=new It(n+(s-n)/2,i+(a-i)/2,0),this.cartesianCenter=new It,Oi.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=jce(t,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new It,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new It,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?(this.cartographicCenter=new It,Oi.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new It(0,0,-Oi.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=Vce(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(nb),this.stats.get(uB),this.stats.get(cB),this.stats.get(dL),this.stats.get(pL),this.stats.get(gL),this.stats.get(mL),this.stats.get(_L),this.stats.get(yL),this.stats.get(hB,"memory"),this.stats.get(bL)}_initializeTileHeaders(e,t){const n=new aB(this,e.root,t);if(t&&(t.children.push(n),n.depth=t.depth+1),this.type===Za.TILES3D){const i=[];for(i.push(n);i.length>0;){const s=i.pop();this.stats.get(nb).incrementCount();const a=s.header.children||[];for(const o of a){const u=new aB(this,o,s);if(u.contentUrl?.includes("?session=")){const p=new URL(u.contentUrl).searchParams.get("session");p&&(this._queryParams.session=p)}s.children.push(u),u.depth=s.depth+1,i.push(u)}}}return n}_initializeTraverser(){let e;switch(this.type){case Za.TILES3D:e=lue;break;case Za.I3S:e=hue;break;default:e=rb}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(n){this._onTileLoadError(e,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(_L).incrementCount();const n=t.message||t.toString(),i=e.url;console.error(`A 3D tile failed to load: ${e.url} ${n}`),this.options.onTileError(e,n,i)}_onTileLoad(e,t){if(t){if(this.type===Za.I3S){const n=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(nb).reset(),this.stats.get(nb).addCount(n)}e&&e.content&&Dce(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===Za.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Za.TILES3D){const{extensionsRemoved:t=[]}=e.content?.gltf||{};t.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),t.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),t.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(uB).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(uB).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(gL).incrementCount(),this.stats.get(cB).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(hB).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(cB).decrementCount(),this.stats.get(mL).incrementCount(),this.stats.get(hB).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const n of t.children)e.push(n);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,n=[];for(n.push(t);n.length>0;){e=n.pop();for(const i of e.children)n.push(i);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),n=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}async function AB(r,e,t,n){return n._parse(r,e,t,n)}function jc(r,e){if(!r)throw new Error(e||"loader assertion failed.")}function due(r,e,t){const n=t!==void 0?new Uint8Array(r).subarray(e,e+t):new Uint8Array(r).subarray(e);return new Uint8Array(n).buffer}function pue(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const r=window.location?.pathname;return r?.slice(0,r.lastIndexOf("/")+1)||""}function gue(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}function mue(...r){const e=[];for(let s=0;s<r.length;s++)e[s]=r[s];let t="",n=!1,i;for(let s=e.length-1;s>=-1&&!n;s--){let a;s>=0?a=e[s]:(i===void 0&&(i=pue()),a=i),a.length!==0&&(t=`${a}/${t}`,n=a.charCodeAt(0)===Zm)}return t=_ue(t,!n),n?`/${t}`:t.length>0?t:"."}const Zm=47,fB=46;function _ue(r,e){let t="",n=-1,i=0,s,a=!1;for(let o=0;o<=r.length;++o){if(o<r.length)s=r.charCodeAt(o);else{if(s===Zm)break;s=Zm}if(s===Zm){if(!(n===o-1||i===1))if(n!==o-1&&i===2){if(t.length<2||!a||t.charCodeAt(t.length-1)!==fB||t.charCodeAt(t.length-2)!==fB){if(t.length>2){const u=t.length-1;let d=u;for(;d>=0&&t.charCodeAt(d)!==Zm;--d);if(d!==u){t=d===-1?"":t.slice(0,d),n=o,i=0,a=!1;continue}}else if(t.length===2||t.length===1){t="",n=o,i=0,a=!1;continue}}e&&(t.length>0?t+="/..":t="..",a=!0)}else{const u=r.slice(n+1,o);t.length>0?t+=`/${u}`:t=u,a=!1}n=o,i=0}else s===fB&&i!==-1?++i:i=-1}return t}const vL="4.3.3",Jm={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function wL(r,e,t){jc(r instanceof ArrayBuffer);const n=new TextDecoder("utf8"),i=new Uint8Array(r,e,t);return n.decode(i)}function yue(r,e=0){const t=new DataView(r);return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}const bue={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Js={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Zn={...bue,...Js},dB={[Js.DOUBLE]:Float64Array,[Js.FLOAT]:Float32Array,[Js.UNSIGNED_SHORT]:Uint16Array,[Js.UNSIGNED_INT]:Uint32Array,[Js.UNSIGNED_BYTE]:Uint8Array,[Js.BYTE]:Int8Array,[Js.SHORT]:Int16Array,[Js.INT]:Int32Array},vue={DOUBLE:Js.DOUBLE,FLOAT:Js.FLOAT,UNSIGNED_SHORT:Js.UNSIGNED_SHORT,UNSIGNED_INT:Js.UNSIGNED_INT,UNSIGNED_BYTE:Js.UNSIGNED_BYTE,BYTE:Js.BYTE,SHORT:Js.SHORT,INT:Js.INT},pB="Failed to convert GL type";class Vu{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in dB)if(dB[t]===e)return t;throw new Error(pB)}static fromName(e){const t=vue[e];if(!t)throw new Error(pB);return t}static getArrayType(e){switch(e){case Js.UNSIGNED_SHORT_5_6_5:case Js.UNSIGNED_SHORT_4_4_4_4:case Js.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=dB[e];if(!t)throw new Error(pB);return t}}static getByteSize(e){return Vu.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Vu.getArrayType(e)}static createTypedArray(e,t,n=0,i){i===void 0&&(i=(t.byteLength-n)/Vu.getByteSize(e));const s=Vu.getArrayType(e);return new s(t,n,i)}}function wue(r,e){if(!r)throw new Error(`math.gl assertion failed. ${e}`)}function xue(r,e=[0,0,0]){const t=r>>11&31,n=r>>5&63,i=r&31;return e[0]=t<<3,e[1]=n<<2,e[2]=i<<3,e}new Kw,new It,new Kw,new Kw;function xL(r,e=255){return Uc(r,0,e)/e*2-1}function BL(r){return r<0?-1:1}function Bue(r,e,t,n){if(wue(n),r<0||r>t||e<0||e>t)throw new Error(`x and y must be unsigned normalized integers between 0 and ${t}`);if(n.x=xL(r,t),n.y=xL(e,t),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const i=n.x;n.x=(1-Math.abs(n.y))*BL(i),n.y=(1-Math.abs(i))*BL(n.y)}return n.normalize()}function Cue(r,e,t){return Bue(r,e,255,t)}class gB{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(e,t){this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,t=Zn.UNSIGNED_INT,n=1){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,t,n,1,i.byteOffset):i}getPropertyArray(e,t,n){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(t=Vu.fromName(i.componentType)),this._getTypedArrayFromBinary(e,t,n,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,t,i)}getProperty(e,t,n,i,s){const a=this.json[e];if(!a)return a;const o=this.getPropertyArray(e,t,n);if(n===1)return o[i];for(let u=0;u<n;++u)s[u]=o[n*i+u];return s}_getTypedArrayFromBinary(e,t,n,i,s){const a=this._cachedTypedArrays;let o=a[e];return o||(o=Vu.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+s,i*n),a[e]=o),o}_getTypedArrayFromArray(e,t,n){const i=this._cachedTypedArrays;let s=i[e];return s||(s=Vu.createTypedArray(t,n),i[e]=s),s}}const Tue={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Eue={SCALAR:(r,e)=>r[e],VEC2:(r,e)=>[r[2*e+0],r[2*e+1]],VEC3:(r,e)=>[r[3*e+0],r[3*e+1],r[3*e+2]],VEC4:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT2:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT3:(r,e)=>[r[9*e+0],r[9*e+1],r[9*e+2],r[9*e+3],r[9*e+4],r[9*e+5],r[9*e+6],r[9*e+7],r[9*e+8]],MAT4:(r,e)=>[r[16*e+0],r[16*e+1],r[16*e+2],r[16*e+3],r[16*e+4],r[16*e+5],r[16*e+6],r[16*e+7],r[16*e+8],r[16*e+9],r[16*e+10],r[16*e+11],r[16*e+12],r[16*e+13],r[16*e+14],r[16*e+15]]},Sue={SCALAR:(r,e,t)=>{e[t]=r},VEC2:(r,e,t)=>{e[2*t+0]=r[0],e[2*t+1]=r[1]},VEC3:(r,e,t)=>{e[3*t+0]=r[0],e[3*t+1]=r[1],e[3*t+2]=r[2]},VEC4:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT2:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT3:(r,e,t)=>{e[9*t+0]=r[0],e[9*t+1]=r[1],e[9*t+2]=r[2],e[9*t+3]=r[3],e[9*t+4]=r[4],e[9*t+5]=r[5],e[9*t+6]=r[6],e[9*t+7]=r[7],e[9*t+8]=r[8],e[9*t+9]=r[9]},MAT4:(r,e,t)=>{e[16*t+0]=r[0],e[16*t+1]=r[1],e[16*t+2]=r[2],e[16*t+3]=r[3],e[16*t+4]=r[4],e[16*t+5]=r[5],e[16*t+6]=r[6],e[16*t+7]=r[7],e[16*t+8]=r[8],e[16*t+9]=r[9],e[16*t+10]=r[10],e[16*t+11]=r[11],e[16*t+12]=r[12],e[16*t+13]=r[13],e[16*t+14]=r[14],e[16*t+15]=r[15]}};function Iue(r,e,t,n){const{componentType:i}=r;jc(r.componentType);const s=typeof i=="string"?Vu.fromName(i):i,a=Tue[r.type],o=Eue[r.type],u=Sue[r.type];return t+=r.byteOffset,{values:Vu.createTypedArray(s,e,t,a*n),type:s,size:a,unpacker:o,packer:u}}const ju=r=>r!==void 0;function Pue(r,e,t){if(!e)return null;let n=r.getExtension("3DTILES_batch_table_hierarchy");const i=e.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?Mue(n,t):null}function Mue(r,e){let t,n,i;const s=r.instancesLength,a=r.classes;let o=r.classIds,u=r.parentCounts,d=r.parentIds,p=s;ju(o.byteOffset)&&(o.componentType=defaultValue(o.componentType,GL.UNSIGNED_SHORT),o.type=AttributeType.SCALAR,i=getBinaryAccessor(o),o=i.createArrayBufferView(e.buffer,e.byteOffset+o.byteOffset,s));let b;if(ju(u))for(ju(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),u=i.createArrayBufferView(e.buffer,e.byteOffset+u.byteOffset,s)),b=new Uint16Array(s),p=0,t=0;t<s;++t)b[t]=p,p+=u[t];ju(d)&&ju(d.byteOffset)&&(d.componentType=defaultValue(d.componentType,GL.UNSIGNED_SHORT),d.type=AttributeType.SCALAR,i=getBinaryAccessor(d),d=i.createArrayBufferView(e.buffer,e.byteOffset+d.byteOffset,p));const C=a.length;for(t=0;t<C;++t){const k=a[t].length,D=a[t].instances,j=getBinaryProperties(k,D,e);a[t].instances=combine(j,D)}const w=new Array(C).fill(0),M=new Uint16Array(s);for(t=0;t<s;++t)n=o[t],M[t]=w[n],++w[n];const P={classes:a,classIds:o,classIndexes:M,parentCounts:u,parentIndexes:b,parentIds:d};return Lue(P),P}function e_(r,e,t){if(!r)return;const n=r.parentCounts;return r.parentIds?t(r,e):n>0?Fue(r,e,t):Rue(r,e,t)}function Fue(r,e,t){const n=r.classIds,i=r.parentCounts,s=r.parentIds,a=r.parentIndexes,o=n.length,u=scratchVisited;u.length=Math.max(u.length,o);const d=++marker,p=scratchStack;for(p.length=0,p.push(e);p.length>0;){if(e=p.pop(),u[e]===d)continue;u[e]=d;const b=t(r,e);if(ju(b))return b;const C=i[e],w=a[e];for(let M=0;M<C;++M){const P=s[w+M];P!==e&&p.push(P)}}return null}function Rue(r,e,t){let n=!0;for(;n;){const i=t(r,e);if(ju(i))return i;const s=r.parentIds[e];n=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}function Lue(r){const t=r.classIds.length;for(let n=0;n<t;++n)CL(r,n,stack)}function CL(r,e,t){const n=r.parentCounts,i=r.parentIds,s=r.parentIndexes,o=r.classIds.length;if(!ju(i))return;assert(e<o,`Parent index ${e} exceeds the total number of instances: ${o}`),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const u=ju(n)?n[e]:1,d=ju(n)?s[e]:e;for(let p=0;p<u;++p){const b=i[d+p];b!==e&&CL(r,b,t)}t.pop(e)}function Ja(r){return r!=null}const ib=(r,e)=>r,Oue={HIERARCHY:!0,extensions:!0,extras:!0};class TL{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(e,t,n,i={}){jc(n>=0),this.json=e||{},this.binary=t,this.featureCount=n,this._extensions=this.json?.extensions||{},this._properties={};for(const s in this.json)Oue[s]||(this._properties[s]=this.json[s]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Pue(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),jc(typeof t=="string",t),this._hierarchy){const n=e_(this._hierarchy,e,(i,s)=>{const a=i.classIds[s];return i.classes[a].name===t});return Ja(n)}return!1}isExactClass(e,t){return jc(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),jc(typeof t=="string",t),Ja(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=Ja(t)?t:[],t.length=0;const n=Object.keys(this._properties);return t.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),jc(typeof t=="string",t),this._binaryProperties){const i=this._binaryProperties[t];if(Ja(i))return this._getBinaryProperty(i,e)}const n=this._properties[t];if(Ja(n))return ib(n[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,t);if(Ja(i))return i}}setProperty(e,t,n){const i=this.featureCount;if(this._checkBatchId(e),jc(typeof t=="string",t),this._binaryProperties){const a=this._binaryProperties[t];if(a){this._setBinaryProperty(a,e,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,n))return;let s=this._properties[t];Ja(s)||(this._properties[t]=new Array(i),s=this._properties[t]),s[e]=ib(n)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,n){e.pack(n,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const n=this._properties[t],i=this._initializeBinaryProperty(t,n);i&&(e=e||{},e[t]=i)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const n=t;jc(this.binary,`Property ${e} requires a batch table binary.`),jc(n.type,`Property ${e} requires a type.`);const i=Iue(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const n=e_(this._hierarchy,e,(i,s)=>{const a=i.classIds[s],o=i.classes[a].instances;return Ja(o[t])});return Ja(n)}_getPropertyNamesInHierarchy(e,t){e_(this._hierarchy,e,(n,i)=>{const s=n.classIds[i],a=n.classes[s].instances;for(const o in a)a.hasOwnProperty(o)&&t.indexOf(o)===-1&&t.push(o)})}_getHierarchyProperty(e,t){return e_(this._hierarchy,e,(n,i)=>{const s=n.classIds[i],a=n.classes[s],o=n.classIndexes[i],u=a.instances[t];return Ja(u)?Ja(u.typedArray)?this._getBinaryProperty(u,o):ib(u[o]):null})}_setHierarchyProperty(e,t,n,i){const s=e_(this._hierarchy,t,(a,o)=>{const u=a.classIds[o],d=a.classes[u],p=a.classIndexes[o],b=d.instances[n];return Ja(b)?(jc(o===t,`Inherited property "${n}" is read-only.`),Ja(b.typedArray)?this._setBinaryProperty(b,p,i):b[p]=ib(i),!0):!1});return Ja(s)}}const mB=4;function sb(r,e,t=0){const n=new DataView(e);if(r.magic=n.getUint32(t,!0),t+=mB,r.version=n.getUint32(t,!0),t+=mB,r.byteLength=n.getUint32(t,!0),t+=mB,r.version!==1)throw new Error(`3D Tile Version ${r.version} not supported`);return t}const $p=4,EL="b3dm tile in legacy format.";function _B(r,e,t){const n=new DataView(e);let i;r.header=r.header||{};let s=n.getUint32(t,!0);t+=$p;let a=n.getUint32(t,!0);t+=$p;let o=n.getUint32(t,!0);t+=$p;let u=n.getUint32(t,!0);return t+=$p,o>=570425344?(t-=$p*2,i=s,o=a,u=0,s=0,a=0,console.warn(EL)):u>=570425344&&(t-=$p,i=o,o=s,u=a,s=0,a=0,console.warn(EL)),r.header.featureTableJsonByteLength=s,r.header.featureTableBinaryByteLength=a,r.header.batchTableJsonByteLength=o,r.header.batchTableBinaryByteLength=u,r.header.batchLength=i,t}function yB(r,e,t,n){return t=Uue(r,e,t),t=Due(r,e,t),t}function Uue(r,e,t,n){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:s,batchLength:a}=r.header||{};if(r.featureTableJson={BATCH_LENGTH:a||0},i&&i>0){const o=wL(e,t,i);r.featureTableJson=JSON.parse(o)}return t+=i||0,r.featureTableBinary=new Uint8Array(e,t,s),t+=s||0,t}function Due(r,e,t,n){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:s}=r.header||{};if(i&&i>0){const a=wL(e,t,i);r.batchTableJson=JSON.parse(a),t+=i,s&&s>0&&(r.batchTableBinary=new Uint8Array(e,t,s),r.batchTableBinary=new Uint8Array(r.batchTableBinary),t+=s)}return t}function SL(r,e,t){if(!e&&(!r||!r.batchIds||!t))return null;const{batchIds:n,isRGB565:i,pointCount:s=0}=r;if(n&&t){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const u=n[o],p=t.getProperty(u,"dimensions").map(b=>b*255);a[o*3]=p[0],a[o*3+1]=p[1],a[o*3+2]=p[2]}return{type:Zn.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}if(e&&i){const a=new Uint8ClampedArray(s*3);for(let o=0;o<s;o++){const u=xue(e[o]);a[o*3]=u[0],a[o*3+1]=u[1],a[o*3+2]=u[2]}return{type:Zn.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}return e&&e.length===s*3?{type:Zn.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Zn.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}const IL=new It;function kue(r,e){if(!e)return null;if(r.isOctEncoded16P){const t=new Float32Array((r.pointsLength||0)*3);for(let n=0;n<(r.pointsLength||0);n++)Cue(e[n*2],e[n*2+1],IL),IL.toArray(t,n*3);return{type:Zn.FLOAT,size:2,value:t}}return{type:Zn.FLOAT,size:2,value:e}}function Nue(r,e,t){return r.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(r.isQuantized=!1,zue(r,e)):{type:Zn.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function zue(r,e){const t=new It,n=new Float32Array(r.pointCount*3);for(let i=0;i<r.pointCount;i++)t.set(e[i*3],e[i*3+1],e[i*3+2]).scale(1/r.quantizedRange).multiply(r.quantizedVolumeScale).add(r.quantizedVolumeOffset).toArray(n,i*3);return n}async function Que(r,e,t,n,i){t=sb(r,e,t),t=_B(r,e,t),t=yB(r,e,t),Hue(r);const{featureTable:s,batchTable:a}=Vue(r);return await que(r,s,a,n,i),jue(r,s,n),$ue(r,s,a),Gue(r,s),t}function Hue(r){r.attributes={positions:null,colors:null,normals:null,batchIds:null},r.isQuantized=!1,r.isTranslucent=!1,r.isRGB565=!1,r.isOctEncoded16P=!1}function Vue(r){const e=new gB(r.featureTableJson,r.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,r.featuresLength=t,r.pointsLength=t,r.pointCount=t,r.rtcCenter=e.getGlobalProperty("RTC_CENTER",Zn.FLOAT,3);const n=Wue(r,e);return{featureTable:e,batchTable:n}}function jue(r,e,t){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.positions){if(e.hasProperty("POSITION"))r.attributes.positions=e.getPropertyArray("POSITION",Zn.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const n=e.getPropertyArray("POSITION_QUANTIZED",Zn.UNSIGNED_SHORT,3);if(r.isQuantized=!0,r.quantizedRange=65535,r.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Zn.FLOAT,3),!r.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(r.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Zn.FLOAT,3),!r.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");r.attributes.positions=Nue(r,n,t)}}if(!r.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function $ue(r,e,t){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.colors){let n=null;e.hasProperty("RGBA")?(n=e.getPropertyArray("RGBA",Zn.UNSIGNED_BYTE,4),r.isTranslucent=!0):e.hasProperty("RGB")?n=e.getPropertyArray("RGB",Zn.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(n=e.getPropertyArray("RGB565",Zn.UNSIGNED_SHORT,1),r.isRGB565=!0),r.attributes.colors=SL(r,n,t)}e.hasProperty("CONSTANT_RGBA")&&(r.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Zn.UNSIGNED_BYTE,4))}function Gue(r,e){if(r.attributes=r.attributes||{positions:null,colors:null,normals:null,batchIds:null},!r.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",Zn.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",Zn.UNSIGNED_BYTE,2),r.isOctEncoded16P=!0),r.attributes.normals=kue(r,t)}}function Wue(r,e){let t=null;if(!r.batchIds&&e.hasProperty("BATCH_ID")&&(r.batchIds=e.getPropertyArray("BATCH_ID",Zn.UNSIGNED_SHORT,1),r.batchIds)){const n=e.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:i,batchTableBinary:s}=r;t=new TL(i,s,n)}return t}async function que(r,e,t,n,i){let s,a,o;const u=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"];u&&(o=u.properties);const d=e.getExtension("3DTILES_draco_point_compression");if(d){a=d.properties;const b=d.byteOffset,C=d.byteLength;if(!a||!Number.isFinite(b)||!C)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=(r.featureTableBinary||[]).slice(b,b+C),r.hasPositions=Number.isFinite(a.POSITION),r.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),r.hasNormals=Number.isFinite(a.NORMAL),r.hasBatchIds=Number.isFinite(a.BATCH_ID),r.isTranslucent=Number.isFinite(a.RGBA)}if(!s)return!0;const p={buffer:s,properties:{...a,...o},batchTableProperties:o};return await Kue(r,p,n,i)}async function Kue(r,e,t,n){if(!n)return;const i={...t,draco:{...t?.draco,extraAttributes:e.batchTableProperties||{}}};delete i["3d-tiles"];const s=await AB(e.buffer,NR,i,n),a=s.attributes.POSITION&&s.attributes.POSITION.value,o=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,u=s.attributes.NORMAL&&s.attributes.NORMAL.value,d=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,p=a&&s.attributes.POSITION.value.quantization,b=u&&s.attributes.NORMAL.value.quantization;if(p){const w=s.POSITION.data.quantization,M=w.range;r.quantizedVolumeScale=new It(M,M,M),r.quantizedVolumeOffset=new It(w.minValues),r.quantizedRange=(1<<w.quantizationBits)-1,r.isQuantizedDraco=!0}b&&(r.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0);const C={};if(e.batchTableProperties)for(const w of Object.keys(e.batchTableProperties))s.attributes[w]&&s.attributes[w].value&&(C[w.toLowerCase()]=s.attributes[w].value);r.attributes={positions:a,colors:SL(r,o,void 0),normals:u,batchIds:d,...C}}const bB={URI:0,EMBEDDED:1};function PL(r,e,t,n){r.rotateYtoZ=!0;const i=(r.byteOffset||0)+(r.byteLength||0)-t;if(i===0)throw new Error("glTF byte length must be greater than 0.");return r.gltfUpAxis=n?.["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",r.gltfArrayBuffer=due(e,t,i),r.gltfByteOffset=0,r.gltfByteLength=i,t%4===0||console.warn(`${r.type}: embedded glb is not aligned to a 4-byte boundary.`),(r.byteOffset||0)+(r.byteLength||0)}async function ML(r,e,t,n){const i=t?.["3d-tiles"]||{};if(Xue(r,e),i.loadGLTF){if(!n)return;if(r.gltfUrl){const{fetch:s}=n,a=await s(r.gltfUrl,t);r.gltfArrayBuffer=await a.arrayBuffer(),r.gltfByteOffset=0}if(r.gltfArrayBuffer){const s=await AB(r.gltfArrayBuffer,Xm,t,n);r.gltf=Yx(s),r.gpuMemoryUsageInBytes=BR(r.gltf),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength}}}function Xue(r,e,t){switch(e){case bB.URI:if(r.gltfArrayBuffer){const n=new Uint8Array(r.gltfArrayBuffer,r.gltfByteOffset),s=new TextDecoder().decode(n);r.gltfUrl=s.replace(/[\s\0]+$/,"")}delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;break;case bB.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function Yue(r,e,t,n,i){t=Zue(r,e,t,n),await ML(r,bB.EMBEDDED,n,i);const s=r?.gltf?.extensions;return s&&s.CESIUM_RTC&&(r.rtcCenter=s.CESIUM_RTC.center),t}function Zue(r,e,t,n,i){t=sb(r,e,t),t=_B(r,e,t),t=yB(r,e,t),t=PL(r,e,t,n);const s=new gB(r.featureTableJson,r.featureTableBinary);return r.rtcCenter=s.getGlobalProperty("RTC_CENTER",Zn.FLOAT,3),t}async function Jue(r,e,t,n,i){return t=ehe(r,e,t,n),await ML(r,r.gltfFormat||0,n,i),t}function ehe(r,e,t,n,i){if(t=sb(r,e,t),r.version!==1)throw new Error(`Instanced 3D Model version ${r.version} is not supported`);t=_B(r,e,t);const s=new DataView(e);if(r.gltfFormat=s.getUint32(t,!0),t+=4,t=yB(r,e,t),t=PL(r,e,t,n),!r?.header?.featureTableJsonByteLength||r.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new gB(r.featureTableJson,r.featureTableBinary),o=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=o,!Number.isFinite(o))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");r.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),r.rtcCenter=a.getGlobalProperty("RTC_CENTER",Zn.FLOAT,3);const u=new TL(r.batchTableJson,r.batchTableBinary,o);return the(r,a,u,o),t}function the(r,e,t,n){const i=new Array(n),s=new It;new It,new It,new It;const a=new vs,o=new mm,u=new It,d={},p=new zn,b=[],C=[],w=[],M=[];for(let P=0;P<n;P++){let k;if(e.hasProperty("POSITION"))k=e.getProperty("POSITION",Zn.FLOAT,3,P,s);else if(e.hasProperty("POSITION_QUANTIZED")){k=e.getProperty("POSITION_QUANTIZED",Zn.UNSIGNED_SHORT,3,P,s);const W=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Zn.FLOAT,3);if(!W)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const ie=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Zn.FLOAT,3);if(!ie)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const se=65535;for(let Z=0;Z<3;Z++)k[Z]=k[Z]/se*ie[Z]+W[Z]}if(!k)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(s.copy(k),d.translation=s,r.normalUp=e.getProperty("NORMAL_UP",Zn.FLOAT,3,P,b),r.normalRight=e.getProperty("NORMAL_RIGHT",Zn.FLOAT,3,P,C),r.normalUp){if(!r.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");r.hasCustomOrientation=!0}else{if(r.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Zn.UNSIGNED_SHORT,2,P,b),r.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Zn.UNSIGNED_SHORT,2,P,C),r.octNormalUp)throw r.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");r.eastNorthUp?(Oi.WGS84.eastNorthUpToFixedFrame(s,p),p.getRotationMatrix3(a)):a.identity()}o.fromMatrix3(a),d.rotation=o,u.set(1,1,1);const D=e.getProperty("SCALE",Zn.FLOAT,1,P,w);Number.isFinite(D)&&u.multiplyByScalar(D);const j=e.getProperty("SCALE_NON_UNIFORM",Zn.FLOAT,3,P,b);j&&u.scale(j),d.scale=u;let H=e.getProperty("BATCH_ID",Zn.UNSIGNED_SHORT,1,P,M);H===void 0&&(H=P);const N=new zn().fromQuaternion(d.rotation);p.identity(),p.translate(d.translation),p.multiplyRight(N),p.scale(d.scale);const q=p.clone();i[P]={modelMatrix:q,batchId:H}}r.instances=i}async function rhe(r,e,t,n,i,s){t=sb(r,e,t);const a=new DataView(e);for(r.tilesLength=a.getUint32(t,!0),t+=4,r.tiles=[];r.tiles.length<r.tilesLength&&(r.byteLength||0)-t>12;){const o={shape:"tile3d"};r.tiles.push(o),t=await s(e,t,n,i,o)}return t}async function nhe(r,e,t,n){if(r.rotateYtoZ=!0,r.gltfUpAxis=t?.["3d-tiles"]?.assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y",t?.["3d-tiles"]?.loadGLTF){if(!n)return e.byteLength;const i=await AB(e,Xm,t,n);r.gltf=Yx(i),r.gpuMemoryUsageInBytes=BR(r.gltf)}else r.gltfArrayBuffer=e;return e.byteLength}async function FL(r,e=0,t,n,i={shape:"tile3d"}){switch(i.byteOffset=e,i.type=yue(r,e),i.type){case Jm.COMPOSITE:return await rhe(i,r,e,t,n,FL);case Jm.BATCHED_3D_MODEL:return await Yue(i,r,e,t,n);case Jm.GLTF:return await nhe(i,r,t,n);case Jm.INSTANCED_3D_MODEL:return await Jue(i,r,e,t,n);case Jm.POINT_CLOUD:return await Que(i,r,e,t,n);default:throw new Error(`3DTileLoader: unknown type ${i.type}`)}}const ihe=1952609651,she=1;async function ohe(r,e,t){if(new Uint32Array(r.slice(0,4))[0]!==ihe)throw new Error("Wrong subtree file magic number");if(new Uint32Array(r.slice(4,8))[0]!==she)throw new Error("Wrong subtree file verson, must be 1");const s=RL(r.slice(8,16)),a=new Uint8Array(r,24,s),u=new TextDecoder("utf8").decode(a),d=JSON.parse(u),p=RL(r.slice(16,24));let b=new ArrayBuffer(0);if(p&&(b=r.slice(24+s)),await ob(d,d.tileAvailability,b,t),Array.isArray(d.contentAvailability))for(const C of d.contentAvailability)await ob(d,C,b,t);else await ob(d,d.contentAvailability,b,t);return await ob(d,d.childSubtreeAvailability,b,t),d}async function ob(r,e,t,n){const i=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof i!="number")return;const s=r.bufferViews[i],a=r.buffers[s.buffer];if(!n?.baseUrl)throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(a.uri){const u=`${n?.baseUrl||""}/${a.uri}`,p=await(await n.fetch(u)).arrayBuffer();e.explicitBitstream=new Uint8Array(p,s.byteOffset,s.byteLength);return}const o=r.buffers.slice(0,s.buffer).reduce((u,d)=>u+d.byteLength,0);e.explicitBitstream=new Uint8Array(t.slice(o,o+a.byteLength),s.byteOffset,s.byteLength)}function RL(r){const e=new DataView(r),t=e.getUint32(0,!0),n=e.getUint32(4,!0);return t+2**32*n}const LL={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:vL,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:ohe,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var tc=null;try{tc=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function vi(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}vi.prototype.__isLong__,Object.defineProperty(vi.prototype,"__isLong__",{value:!0});function ca(r){return(r&&r.__isLong__)===!0}function OL(r){var e=Math.clz32(r&-r);return r?31-e:e}vi.isLong=ca;var UL={},DL={};function sd(r,e){var t,n,i;return e?(r>>>=0,(i=0<=r&&r<256)&&(n=DL[r],n)?n:(t=ri(r,0,!0),i&&(DL[r]=t),t)):(r|=0,(i=-128<=r&&r<128)&&(n=UL[r],n)?n:(t=ri(r,r<0?-1:0,!1),i&&(UL[r]=t),t))}vi.fromInt=sd;function rc(r,e){if(isNaN(r))return e?kh:Gc;if(e){if(r<0)return kh;if(r>=NL)return jL}else{if(r<=-zL)return el;if(r+1>=zL)return VL}return r<0?rc(-r,e).neg():ri(r%Gp|0,r/Gp|0,e)}vi.fromNumber=rc;function ri(r,e,t){return new vi(r,e,t)}vi.fromBits=ri;var ab=Math.pow;function vB(r,e,t){if(r.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return e?kh:Gc;if(t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return vB(r.substring(1),e,t).neg();for(var i=rc(ab(t,8)),s=Gc,a=0;a<r.length;a+=8){var o=Math.min(8,r.length-a),u=parseInt(r.substring(a,a+o),t);if(o<8){var d=rc(ab(t,o));s=s.mul(d).add(rc(u))}else s=s.mul(i),s=s.add(rc(u))}return s.unsigned=e,s}vi.fromString=vB;function $c(r,e){return typeof r=="number"?rc(r,e):typeof r=="string"?vB(r,e):ri(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}vi.fromValue=$c;var kL=65536,ahe=1<<24,Gp=kL*kL,NL=Gp*Gp,zL=NL/2,QL=sd(ahe),Gc=sd(0);vi.ZERO=Gc;var kh=sd(0,!0);vi.UZERO=kh;var Wp=sd(1);vi.ONE=Wp;var HL=sd(1,!0);vi.UONE=HL;var wB=sd(-1);vi.NEG_ONE=wB;var VL=ri(-1,2147483647,!1);vi.MAX_VALUE=VL;var jL=ri(-1,-1,!0);vi.MAX_UNSIGNED_VALUE=jL;var el=ri(0,-2147483648,!1);vi.MIN_VALUE=el;var gr=vi.prototype;gr.toInt=function(){return this.unsigned?this.low>>>0:this.low},gr.toNumber=function(){return this.unsigned?(this.high>>>0)*Gp+(this.low>>>0):this.high*Gp+(this.low>>>0)},gr.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(el)){var t=rc(e),n=this.div(t),i=n.mul(t).sub(this);return n.toString(e)+i.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=rc(ab(e,6),this.unsigned),a=this,o="";;){var u=a.div(s),d=a.sub(u.mul(s)).toInt()>>>0,p=d.toString(e);if(a=u,a.isZero())return p+o;for(;p.length<6;)p="0"+p;o=""+p+o}},gr.getHighBits=function(){return this.high},gr.getHighBitsUnsigned=function(){return this.high>>>0},gr.getLowBits=function(){return this.low},gr.getLowBitsUnsigned=function(){return this.low>>>0},gr.getNumBitsAbs=function(){if(this.isNegative())return this.eq(el)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1},gr.isZero=function(){return this.high===0&&this.low===0},gr.eqz=gr.isZero,gr.isNegative=function(){return!this.unsigned&&this.high<0},gr.isPositive=function(){return this.unsigned||this.high>=0},gr.isOdd=function(){return(this.low&1)===1},gr.isEven=function(){return(this.low&1)===0},gr.equals=function(e){return ca(e)||(e=$c(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},gr.eq=gr.equals,gr.notEquals=function(e){return!this.eq(e)},gr.neq=gr.notEquals,gr.ne=gr.notEquals,gr.lessThan=function(e){return this.comp(e)<0},gr.lt=gr.lessThan,gr.lessThanOrEqual=function(e){return this.comp(e)<=0},gr.lte=gr.lessThanOrEqual,gr.le=gr.lessThanOrEqual,gr.greaterThan=function(e){return this.comp(e)>0},gr.gt=gr.greaterThan,gr.greaterThanOrEqual=function(e){return this.comp(e)>=0},gr.gte=gr.greaterThanOrEqual,gr.ge=gr.greaterThanOrEqual,gr.compare=function(e){if(ca(e)||(e=$c(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},gr.comp=gr.compare,gr.negate=function(){return!this.unsigned&&this.eq(el)?el:this.not().add(Wp)},gr.neg=gr.negate,gr.add=function(e){ca(e)||(e=$c(e));var t=this.high>>>16,n=this.high&65535,i=this.low>>>16,s=this.low&65535,a=e.high>>>16,o=e.high&65535,u=e.low>>>16,d=e.low&65535,p=0,b=0,C=0,w=0;return w+=s+d,C+=w>>>16,w&=65535,C+=i+u,b+=C>>>16,C&=65535,b+=n+o,p+=b>>>16,b&=65535,p+=t+a,p&=65535,ri(C<<16|w,p<<16|b,this.unsigned)},gr.subtract=function(e){return ca(e)||(e=$c(e)),this.add(e.neg())},gr.sub=gr.subtract,gr.multiply=function(e){if(this.isZero())return this;if(ca(e)||(e=$c(e)),tc){var t=tc.mul(this.low,this.high,e.low,e.high);return ri(t,tc.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?kh:Gc;if(this.eq(el))return e.isOdd()?el:Gc;if(e.eq(el))return this.isOdd()?el:Gc;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(QL)&&e.lt(QL))return rc(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,i=this.high&65535,s=this.low>>>16,a=this.low&65535,o=e.high>>>16,u=e.high&65535,d=e.low>>>16,p=e.low&65535,b=0,C=0,w=0,M=0;return M+=a*p,w+=M>>>16,M&=65535,w+=s*p,C+=w>>>16,w&=65535,w+=a*d,C+=w>>>16,w&=65535,C+=i*p,b+=C>>>16,C&=65535,C+=s*d,b+=C>>>16,C&=65535,C+=a*u,b+=C>>>16,C&=65535,b+=n*p+i*d+s*u+a*o,b&=65535,ri(w<<16|M,b<<16|C,this.unsigned)},gr.mul=gr.multiply,gr.divide=function(e){if(ca(e)||(e=$c(e)),e.isZero())throw Error("division by zero");if(tc){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?tc.div_u:tc.div_s)(this.low,this.high,e.low,e.high);return ri(t,tc.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?kh:Gc;var n,i,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return kh;if(e.gt(this.shru(1)))return HL;s=kh}else{if(this.eq(el)){if(e.eq(Wp)||e.eq(wB))return el;if(e.eq(el))return Wp;var a=this.shr(1);return n=a.div(e).shl(1),n.eq(Gc)?e.isNegative()?Wp:wB:(i=this.sub(e.mul(n)),s=n.add(i.div(e)),s)}else if(e.eq(el))return this.unsigned?kh:Gc;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=Gc}for(i=this;i.gte(e);){n=Math.max(1,Math.floor(i.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),u=o<=48?1:ab(2,o-48),d=rc(n),p=d.mul(e);p.isNegative()||p.gt(i);)n-=u,d=rc(n,this.unsigned),p=d.mul(e);d.isZero()&&(d=Wp),s=s.add(d),i=i.sub(p)}return s},gr.div=gr.divide,gr.modulo=function(e){if(ca(e)||(e=$c(e)),tc){var t=(this.unsigned?tc.rem_u:tc.rem_s)(this.low,this.high,e.low,e.high);return ri(t,tc.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},gr.mod=gr.modulo,gr.rem=gr.modulo,gr.not=function(){return ri(~this.low,~this.high,this.unsigned)},gr.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},gr.clz=gr.countLeadingZeros,gr.countTrailingZeros=function(){return this.low?OL(this.low):OL(this.high)+32},gr.ctz=gr.countTrailingZeros,gr.and=function(e){return ca(e)||(e=$c(e)),ri(this.low&e.low,this.high&e.high,this.unsigned)},gr.or=function(e){return ca(e)||(e=$c(e)),ri(this.low|e.low,this.high|e.high,this.unsigned)},gr.xor=function(e){return ca(e)||(e=$c(e)),ri(this.low^e.low,this.high^e.high,this.unsigned)},gr.shiftLeft=function(e){return ca(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ri(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ri(0,this.low<<e-32,this.unsigned)},gr.shl=gr.shiftLeft,gr.shiftRight=function(e){return ca(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ri(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ri(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},gr.shr=gr.shiftRight,gr.shiftRightUnsigned=function(e){return ca(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ri(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?ri(this.high,0,this.unsigned):ri(this.high>>>e-32,0,this.unsigned)},gr.shru=gr.shiftRightUnsigned,gr.shr_u=gr.shiftRightUnsigned,gr.rotateLeft=function(e){var t;return ca(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?ri(this.high,this.low,this.unsigned):e<32?(t=32-e,ri(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,ri(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},gr.rotl=gr.rotateLeft,gr.rotateRight=function(e){var t;return ca(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?ri(this.high,this.low,this.unsigned):e<32?(t=32-e,ri(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,ri(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},gr.rotr=gr.rotateRight,gr.toSigned=function(){return this.unsigned?ri(this.low,this.high,!1):this},gr.toUnsigned=function(){return this.unsigned?this:ri(this.low,this.high,!0)},gr.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},gr.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},gr.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},vi.fromBytes=function(e,t,n){return n?vi.fromBytesLE(e,t):vi.fromBytesBE(e,t)},vi.fromBytesLE=function(e,t){return new vi(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},vi.fromBytesBE=function(e,t){return new vi(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const lhe=16;function $L(r){r==="X"&&(r="");const e=r.padEnd(lhe,"0");return vi.fromString(e,!0,16)}function che(r){if(r.isZero())return"X";let e=r.countTrailingZeros();const t=e%4;e=(e-t)/4;const n=e;e*=4;const s=r.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-n-s.length).join("0")+s}function uhe(r,e){const t=hhe(r).shiftRightUnsigned(2);return r.add(vi.fromNumber(2*e+1-4).multiply(t))}function hhe(r){return r.and(r.not().add(1))}const Ahe=3,fhe=2*30+1,WL=180/Math.PI;function dhe(r){if(r.length===0)throw new Error(`Invalid Hilbert quad key ${r}`);const e=r.split("/"),t=parseInt(e[0],10),n=e[1],i=n.length;let s=0;const a=[0,0];for(let o=i-1;o>=0;o--){s=i-o;const u=n[o];let d=0,p=0;u==="1"?p=1:u==="2"?(d=1,p=1):u==="3"&&(d=1);const b=Math.pow(2,s-1);ghe(b,a,d,p),a[0]+=b*d,a[1]+=b*p}if(t%2===1){const o=a[0];a[0]=a[1],a[1]=o}return{face:t,ij:a,level:s}}function phe(r){if(r.isZero())return"";let e=r.toString(2);for(;e.length<Ahe+fhe;)e="0"+e;const t=e.lastIndexOf("1"),n=e.substring(0,3),i=e.substring(3,t),s=i.length/2,a=vi.fromString(n,!0,2).toString(10);let o="";if(s!==0)for(o=vi.fromString(i,!0,2).toString(4);o.length<s;)o="0"+o;return`${a}/${o}`}function qL(r,e,t){const n=1<<e;return[(r[0]+t[0])/n,(r[1]+t[1])/n]}function KL(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function XL(r){return[KL(r[0]),KL(r[1])]}function YL(r,[e,t]){switch(r){case 0:return[1,e,t];case 1:return[-e,1,t];case 2:return[-e,-t,1];case 3:return[-1,-t,-e];case 4:return[t,-1,-e];case 5:return[t,e,-1];default:throw new Error("Invalid face")}}function ZL([r,e,t]){const n=Math.atan2(t,Math.sqrt(r*r+e*e));return[Math.atan2(e,r)*WL,n*WL]}function ghe(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}function mhe(r){const e=qL(r.ij,r.level,[.5,.5]),t=XL(e),n=YL(r.face,t);return ZL(n)}const _he=100;function JL(r){const{face:e,ij:t,level:n}=r,i=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(_he*Math.pow(2,-n))),a=new Float64Array(4*s*2+2);let o=0,u=0;for(let d=0;d<4;d++){const p=i[d].slice(0),b=i[d+1],C=(b[0]-p[0])/s,w=(b[1]-p[1])/s;for(let M=0;M<s;M++){p[0]+=C,p[1]+=w;const P=qL(t,n,p),k=XL(P),D=YL(e,k),j=ZL(D);Math.abs(j[1])>89.999&&(j[0]=u);const H=j[0]-u;j[0]+=H>180?-360:H<-180?360:0,a[o++]=j[0],a[o++]=j[1],u=j[0]}}return a[o++]=a[0],a[o++]=a[1],a}function xB(r){const e=yhe(r);return dhe(e)}function yhe(r){if(r.indexOf("/")>0)return r;const e=$L(r);return phe(e)}function bhe(r){const e=xB(r);return mhe(e)}function vhe(r){let e;if(r.face===2||r.face===5){let t=null,n=0;for(let i=0;i<4;i++){const s=`${r.face}/${i}`,a=xB(s),o=JL(a);(typeof t>"u"||t===null)&&(t=new Float64Array(4*o.length)),t.set(o,n),n+=o.length}e=eO(t)}else{const t=JL(r);e=eO(t)}return e}function eO(r){if(r.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let n=0;n<r.length;n+=2)e.push(r[n]),t.push(r[n+1]);return e.sort((n,i)=>n-i),t.sort((n,i)=>n-i),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function whe(r,e){const t=e?.minimumHeight||0,n=e?.maximumHeight||0,i=xB(r),s=vhe(i),a=s.west,o=s.south,u=s.east,d=s.north,p=[];return p.push(new It(a,d,t)),p.push(new It(u,d,t)),p.push(new It(u,o,t)),p.push(new It(a,o,t)),p.push(new It(a,d,n)),p.push(new It(u,d,n)),p.push(new It(u,o,n)),p.push(new It(a,o,n)),p}function tO(r){const e=r.token,t={minimumHeight:r.minimumHeight,maximumHeight:r.maximumHeight},n=whe(e,t),i=bhe(e),s=i[0],a=i[1],o=Oi.WGS84.cartographicToCartesian([s,a,t.maximumHeight]),u=new It(o[0],o[1],o[2]);n.push(u);const d=jne(n);return[...d.center,...d.halfAxes]}const xhe={QUADTREE:4,OCTREE:8};function Bhe(r,e,t){if(r?.box){const n=$L(r.s2VolumeInfo.token),i=uhe(n,e),s=che(i),a={...r.s2VolumeInfo};switch(a.token=s,t){case"OCTREE":const d=r.s2VolumeInfo,p=d.maximumHeight-d.minimumHeight,b=p/2,C=d.minimumHeight+p/2;d.minimumHeight=C-b,d.maximumHeight=C+b;break}return{box:tO(a),s2VolumeInfo:a}}}async function rO(r){const{subtree:e,subtreeData:t={level:0,x:0,y:0,z:0},parentData:n={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:i=0,implicitOptions:s,loaderOptions:a,s2VolumeBox:o}=r,{subdivisionScheme:u,subtreeLevels:d,maximumLevel:p,contentUrlTemplate:b,subtreesUriTemplate:C,basePath:w}=s,M={children:[],lodMetricValue:0,contentUrl:""};if(!p)return n5.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${b} won't be loaded...`),M;const P=n.localLevel+1,k=t.level+P;if(k>p)return M;const D=xhe[u],j=Math.log2(D),H=i&1,N=i>>1&1,q=i>>2&1,W=od(n.localX,H,1),ie=od(n.localY,N,1),se=od(n.localZ,q,1),Z=od(t.x,W,P),fe=od(t.y,ie,P),te=od(t.z,se,P),ce=od(n.mortonIndex,i,j),ve=P===d&&BB(e.childSubtreeAvailability,ce);let me,qe,ot,st;if(ve){const wt=`${w}/${C}`,ht=CB(wt,k,Z,fe,te);me=await PA(ht,LL,a),st=0,qe={level:k,x:Z,y:fe,z:te},ot={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else me=e,st=(D**P-1)/(D-1)+ce,qe=t,ot={mortonIndex:ce,localLevel:P,localX:W,localY:ie,localZ:se};if(!BB(me.tileAvailability,st))return M;BB(me.contentAvailability,st)&&(M.contentUrl=CB(b,k,Z,fe,te));for(let wt=0;wt<D;wt++){const ht=Bhe(o,wt,u),he=await rO({subtree:me,subtreeData:qe,parentData:ot,childIndex:wt,implicitOptions:s,loaderOptions:a,s2VolumeBox:ht});(he.contentUrl||he.children.length)&&M.children.push(he)}return M.contentUrl||M.children.length?Che(M,{level:k,x:Z,y:fe,z:te},s,o):M}function BB(r,e){let t;return Array.isArray(r)?(t=r[0],r.length>1&&n5.once('Not supported extension "3DTILES_multiple_contents" has been detected')):t=r,"constant"in t?!!t.constant:t.explicitBitstream?She(e,t.explicitBitstream):!1}function Che(r,e,t,n){const{basePath:i,refine:s,getRefine:a,lodMetricType:o,getTileType:u,rootLodMetricValue:d,rootBoundingVolume:p}=t,b=r.contentUrl&&r.contentUrl.replace(`${i}/`,""),C=d/2**e.level,w=n?.box?{box:n.box}:p,M=The(w,e,t.subdivisionScheme);return{children:r.children,contentUrl:r.contentUrl,content:{uri:b},id:r.contentUrl,refine:a(s),type:u(r),lodMetricType:o,lodMetricValue:C,geometricError:C,transform:r.transform,boundingVolume:M}}function The(r,e,t){if(r.region){const{level:n,x:i,y:s,z:a}=e,[o,u,d,p,b,C]=r.region,w=2**n,M=(d-o)/w,[P,k]=[o+M*i,o+M*(i+1)],D=(p-u)/w,[j,H]=[u+D*s,u+D*(s+1)];let N,q;if(t==="OCTREE"){const W=(C-b)/w;[N,q]=[b+W*a,b+W*(a+1)]}else[N,q]=[b,C];return{region:[P,j,k,H,N,q]}}if(r.box)return r;throw new Error(`Unsupported bounding volume type ${JSON.stringify(r)}`)}function od(r,e,t){return(r<<t)+e}function CB(r,e,t,n,i){const s=Ehe({level:e,x:t,y:n,z:i});return r.replace(/{level}|{x}|{y}|{z}/gi,a=>s[a])}function Ehe(r){const e={};for(const t in r)e[`{${t}}`]=r[t];return e}function She(r,e){const t=Math.floor(r/8),n=r%8;return(e[t]>>n&1)===1}function TB(r,e=""){if(!e)return Dh.EMPTY;const n=e.split("?")[0].split(".").pop();switch(n){case"pnts":return Dh.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Dh.SCENEGRAPH;default:return n||Dh.EMPTY}}function EB(r){switch(r){case"REPLACE":case"replace":return Vc.REPLACE;case"ADD":case"add":return Vc.ADD;default:return r}}function SB(r,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const n=new URL(r,`${e}/`);return decodeURI(n.toString())}else if(r.startsWith("/"))return r;return mue(e,r)}function nO(r,e){if(!r)return null;let t;if(r.content){const i=r.content.uri||r.content?.url;typeof i<"u"&&(t=SB(i,e))}return{...r,id:t,contentUrl:t,lodMetricType:jp.GEOMETRIC_ERROR,lodMetricValue:r.geometricError,transformMatrix:r.transform,type:TB(r,t),refine:EB(r.refine)}}async function Ihe(r,e,t){let n=null;const i=sO(r.root);i&&r.root?n=await iO(r.root,r,e,i,t):n=nO(r.root,e);const s=[];for(s.push(n);s.length>0;){const a=s.pop()||{},o=a.children||[],u=[];for(const d of o){const p=sO(d);let b;p?b=await iO(d,r,e,p,t):b=nO(d,e),b&&(u.push(b),s.push(b))}a.children=u}return n}async function iO(r,e,t,n,i){const{subdivisionScheme:s,maximumLevel:a,availableLevels:o,subtreeLevels:u,subtrees:{uri:d}}=n,p=CB(d,0,0,0,0),b=SB(p,t),C=await PA(b,LL,i),w=r.content?.uri,M=w?SB(w,t):"",P=e?.root?.refine,k=r.geometricError,D=r.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(D){const q={box:tO(D),s2VolumeInfo:D};r.boundingVolume=q}const j=r.boundingVolume,H={contentUrlTemplate:M,subtreesUriTemplate:d,subdivisionScheme:s,subtreeLevels:u,maximumLevel:Number.isFinite(o)?o-1:a,refine:P,basePath:t,lodMetricType:jp.GEOMETRIC_ERROR,rootLodMetricValue:k,rootBoundingVolume:j,getTileType:TB,getRefine:EB};return await Phe(r,t,C,H,i)}async function Phe(r,e,t,n,i){if(!r)return null;const{children:s,contentUrl:a}=await rO({subtree:t,implicitOptions:n,loaderOptions:i});let o,u=null;return a&&(o=a,u={uri:a.replace(`${e}/`,"")}),{...r,id:o,contentUrl:o,lodMetricType:jp.GEOMETRIC_ERROR,lodMetricValue:r.geometricError,transformMatrix:r.transform,type:TB(r,o),refine:EB(r.refine),content:u||r.content,children:s}}function sO(r){return r?.extensions?.["3DTILES_implicit_tiling"]||r?.implicitTiling}const IB={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:vL,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Mhe,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function Mhe(r,e={},t){const n=e["3d-tiles"]||{};let i;return n.isTileset==="auto"?i=t?.url&&t.url.indexOf(".json")!==-1:i=n.isTileset,i?Fhe(r,e,t):Rhe(r,e,t)}async function Fhe(r,e,t){const n=JSON.parse(new TextDecoder().decode(r)),i=t?.url||"",s=Lhe(i),a=await Ihe(n,s,e||{});return{...n,shape:"tileset3d",loader:IB,url:i,queryString:t?.queryString||"",basePath:s,root:a||n.root,type:Za.TILES3D,lodMetricType:jp.GEOMETRIC_ERROR,lodMetricValue:n.root?.geometricError||0}}async function Rhe(r,e,t){const n={content:{shape:"tile3d",featureIds:null}};return await FL(r,0,e,t,n.content),n.content}function Lhe(r){return gue(r)}const oO=[0],Ohe={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:IB,onTilesetLoad:{type:"function",value:r=>{}},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:(r,e,t)=>{}},_getMeshColor:{type:"function",value:r=>[255,255,255]}};class PB extends IF{initializeState(){"onTileLoadFail"in this.props&&$n.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return!!(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:n}){if(e.data&&e.data!==t.data&&this._loadTileset(e.data),n.viewportChanged){const{activeViewports:i}=this.state;Object.keys(i).length&&(this._updateTileset(i),this.state.lastUpdatedViewports=i,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:i}=this.state;for(const s in i)i[s].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:n}=this.state;this.internalState.viewport=e,t[e.id]=e;const i=n?.[e.id];(!i||!e.equals(i))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:t}){const n=t&&t.props.tile;return e.picked&&(e.object=n),e.sourceTile=n,e}filterSubLayer({layer:e,viewport:t}){const{tile:n}=e.props,{id:i}=t;return n.selected&&n.viewportIds.includes(i)}_updateAutoHighlight(e){const t=e.sourceTile,n=this.state.layerMap[t?.id];n&&n.layer&&n.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props,n=this.props.loader||this.props.loaders,i=Array.isArray(n)?n[0]:n,s={loadOptions:{...t}};let a=e;if(i.preload){const d=await i.preload(e,t);d.url&&(a=d.url),d.headers&&(s.loadOptions.fetch={...s.loadOptions.fetch,headers:d.headers}),Object.assign(s,d)}const o=await PA(a,i,s.loadOptions),u=new fue(o,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...s});this.setState({tileset3d:u,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(u)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:n}=this.context,i=Object.keys(e).length;!n||!i||!t||t.selectTiles(Object.values(e)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case Dh.POINTCLOUD:return this._makePointCloudLayer(e,t);case Dh.SCENEGRAPH:return this._make3DModelLayer(e);case Dh.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,t){const{attributes:n,pointCount:i,constantRGBA:s,cartographicOrigin:a,modelMatrix:o}=e.content,{positions:u,normals:d,colors:p}=n;if(!u)return null;const b=t&&t.props.data||{header:{vertexCount:i},attributes:{POSITION:u,NORMAL:d,COLOR_0:p}},{pointSize:C,getPointColor:w}=this.props,M=this.getSubLayerClass("pointcloud",mx);return new M({pointSize:C},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:b,coordinateSystem:Qn.METER_OFFSETS,coordinateOrigin:a,modelMatrix:o,getColor:s||w,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:n,cartographicOrigin:i,modelMatrix:s}=e.content,a=this.getSubLayerClass("scenegraph",Zx);return new a({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:n||oO,scenegraph:t,coordinateSystem:Qn.METER_OFFSETS,coordinateOrigin:i,modelMatrix:s,getTransformMatrix:o=>o.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const n=e.content,{attributes:i,indices:s,modelMatrix:a,cartographicOrigin:o,coordinateSystem:u=Qn.METER_OFFSETS,material:d,featureIds:p}=n,{_getMeshColor:b}=this.props,C=t&&t.props.mesh||new Bp({topology:"triangle-list",attributes:Uhe(i),indices:s}),w=this.getSubLayerClass("mesh",Jx);return new w(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:C,data:oO,getColor:b(e),pbrMaterial:d,modelMatrix:a,coordinateOrigin:o,coordinateSystem:u,featureIds:p,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(n=>{const i=t[n.id]=t[n.id]||{tile:n};let{layer:s}=i;return n.selected&&(s?i.needsUpdate&&(s=this._getSubLayer(n,s),i.needsUpdate=!1):s=this._getSubLayer(n)),i.layer=s,s}).filter(Boolean):null}}PB.defaultProps=Ohe,PB.layerName="Tile3DLayer";function Uhe(r){const e={};return e.positions={...r.positions,value:new Float32Array(r.positions.value)},r.normals&&(e.normals=r.normals),r.texCoords&&(e.texCoords=r.texCoords),r.colors&&(e.colors=r.colors),r.uvRegions&&(e.uvRegions=r.uvRegions),e}let Dhe=class{map;width;height;svgCanvas;xLine;yLine;color="#535353";constructor(e){this.map=e,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){this.width=this.map?.getCanvas().clientWidth,this.height=this.map?.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const e=this.width/2,t=this.height/2;this.yLine.setAttribute("x1",`${e}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${e}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${t}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${t}px`)}else console.error("element value is null")}createCanvas(e){if(this.width!==void 0&&this.height!==void 0){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.style.position="relative",t.setAttribute("width",`${this.width}px`),t.setAttribute("height",`${this.height}px`);const n=this.width/2,i=this.height/2;this.yLine=t.appendChild(this.createLine(n,0,n,this.height,this.color,"2px")),this.xLine=t.appendChild(this.createLine(0,i,this.width,i,this.color,"2px")),e?.appendChild(t),this.svgCanvas=t}}createLine(e,t,n,i,s,a){const o=document.createElementNS("http://www.w3.org/2000/svg","line");return o.setAttribute("x1",e),o.setAttribute("y1",t),o.setAttribute("x2",n),o.setAttribute("y2",i),o.setAttribute("stroke-dasharray","5,5"),o.setAttribute("stroke",s),o.setAttribute("stroke-width",a),o}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}};const MB={72:72,96:96,200:200,300:300,400:400},Nh={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},t_={Landscape:"landscape",Portrait:"portrait"},ad={LETTER:[279,216],A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},qp={mm:"mm"};let khe=class{map;width;height;unit;svgCanvas;svgPath;constructor(e){if(this.map=e,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const t=this.map?.getCanvas().clientWidth,n=this.map?.getCanvas().clientHeight,i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.setAttribute("width",`${t}px`),i.setAttribute("height",`${n}px`);const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("style","fill:#888888;stroke-width:0"),s.setAttribute("fill-opacity","0.5"),i.append(s),this.map?.getCanvasContainer().appendChild(i),this.svgCanvas=i,this.svgPath=s}mapResize(){this.generateCutOut()}updateArea(e,t){this.width=e,this.height=t,this.unit=qp.mm,this.generateCutOut()}generateCutOut(){if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const e=this.toPixels(this.width),t=this.toPixels(this.height),n=this.map?.getCanvas().clientWidth,i=this.map?.getCanvas().clientHeight,s=n/2-e/2,a=s+e,o=i/2-t/2,u=o+t;this.svgCanvas.setAttribute("width",`${n}px`),this.svgCanvas.setAttribute("height",`${i}px`),this.svgPath.setAttribute("d",`M 0 0 L ${n} 0 L ${n} ${i} L 0 ${i} M ${s} ${o} L ${s} ${u} L ${a} ${u} L ${a} ${o}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(e,t=96){return this.unit===qp.mm&&(t/=25.4),t*e}};const aO={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate",LanguageName:"English",LanguageCode:"en"},Nhe={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Générer",LanguageName:"Français",LanguageCode:"fr"},zhe={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi",LanguageName:"Suomalainen",LanguageCode:"fi"},Qhe={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflösung",Generate:"Erstellen",LanguageName:"Deutsch",LanguageCode:"de"},Hhe={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera",LanguageName:"Svenska",LanguageCode:"sv"},Vhe={PageSize:"Tamaño de página",PageOrientation:"Orientación de página",Format:"Formato",DPI:"DPI",Generate:"Generar",LanguageName:"Española",LanguageCode:"es"},jhe={PageSize:"Mida",PageOrientation:"Orientació",Format:"Format",DPI:"DPI",Generate:"Genera",LanguageName:"Catalan",LanguageCode:"ca"},$he={PageSize:"Kích thước trang",PageOrientation:"Loại trang",Format:"Định dạng",DPI:"Mật độ điểm ảnh (DPI)",Generate:"Tạo",LanguageName:"Tiếng Việt",LanguageCode:"vi"},Ghe={PageSize:"Розмір сторінки",PageOrientation:"Орієнтація сторінки",Format:"Формат",DPI:"DPI",Generate:"Згенерувати",LanguageName:"українська",LanguageCode:"uk"},Whe={PageSize:"页面大小",PageOrientation:"页面方向",Format:"格式",DPI:"像素",Generate:"导出",LanguageName:"简体字",LanguageCode:"zhHans"},qhe={PageSize:"頁面大小",PageOrientation:"頁面方向",Format:"格式",DPI:"像素",Generate:"導出",LanguageName:"繁体字",LanguageCode:"zhHant"},Khe={PageSize:"ページサイズ",PageOrientation:"ページ方向",Format:"フォーマット",DPI:"DPI（解像度）",Generate:"出力",LanguageName:"日本語",LanguageCode:"ja"},Xhe={PageSize:"Tamanho da página",PageOrientation:"Orientação da página",Format:"Formato",DPI:"DPI",Generate:"Gerar",LanguageName:"Português",LanguageCode:"pt"},Yhe={PageSize:"Размер страницы",PageOrientation:"Ориентация страницы",Format:"Формат",DPI:"Разрешение (DPI)",Generate:"Сгенерировать",LanguageName:"русский",LanguageCode:"ru"},Zhe=[aO,Nhe,zhe,Qhe,Hhe,Vhe,jhe,$he,Ghe,Whe,qhe,Khe,Xhe,Yhe],Jhe=r=>Zhe.find(e=>e.LanguageCode===r)??aO;function ni(r){"@babel/helpers - typeof";return ni=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ni(r)}var Wc=Uint8Array,nc=Uint16Array,FB=Int32Array,RB=new Wc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),LB=new Wc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),lO=new Wc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),cO=function(r,e){for(var t=new nc(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new FB(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return{b:t,r:i}},uO=cO(RB,2),eAe=uO.b,OB=uO.r;eAe[28]=258,OB[258]=28;for(var tAe=cO(LB,0),hO=tAe.r,AO=new nc(32768),Ki=0;Ki<32768;++Ki){var GA=(Ki&43690)>>1|(Ki&21845)<<1;GA=(GA&52428)>>2|(GA&13107)<<2,GA=(GA&61680)>>4|(GA&3855)<<4,AO[Ki]=((GA&65280)>>8|(GA&255)<<8)>>1}for(var r_=function(r,e,t){for(var n=r.length,i=0,s=new nc(e);i<n;++i)r[i]&&++s[r[i]-1];var a=new nc(e);for(i=1;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;var o;for(o=new nc(n),i=0;i<n;++i)r[i]&&(o[i]=AO[a[r[i]-1]++]>>15-r[i]);return o},ld=new Wc(288),Ki=0;Ki<144;++Ki)ld[Ki]=8;for(var Ki=144;Ki<256;++Ki)ld[Ki]=9;for(var Ki=256;Ki<280;++Ki)ld[Ki]=7;for(var Ki=280;Ki<288;++Ki)ld[Ki]=8;for(var lb=new Wc(32),Ki=0;Ki<32;++Ki)lb[Ki]=5;var rAe=r_(ld,9),nAe=r_(lb,5),fO=function(r){return(r+7)/8|0},iAe=function(r,e,t){return(t==null||t>r.length)&&(t=r.length),new Wc(r.subarray(e,t))},zh=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>8},n_=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>8,r[n+2]|=t>>16},UB=function(r,e){for(var t=[],n=0;n<r.length;++n)r[n]&&t.push({s:n,f:r[n]});var i=t.length,s=t.slice();if(!i)return{t:mO,l:0};if(i==1){var a=new Wc(t[0].s+1);return a[t[0].s]=1,{t:a,l:1}}t.sort(function(q,W){return q.f-W.f}),t.push({s:-1,f:25001});var o=t[0],u=t[1],d=0,p=1,b=2;for(t[0]={s:-1,f:o.f+u.f,l:o,r:u};p!=i-1;)o=t[t[d].f<t[b].f?d++:b++],u=t[d!=p&&t[d].f<t[b].f?d++:b++],t[p++]={s:-1,f:o.f+u.f,l:o,r:u};for(var C=s[0].s,n=1;n<i;++n)s[n].s>C&&(C=s[n].s);var w=new nc(C+1),M=DB(t[p-1],w,0);if(M>e){var n=0,P=0,k=M-e,D=1<<k;for(s.sort(function(W,ie){return w[ie.s]-w[W.s]||W.f-ie.f});n<i;++n){var j=s[n].s;if(w[j]>e)P+=D-(1<<M-w[j]),w[j]=e;else break}for(P>>=k;P>0;){var H=s[n].s;w[H]<e?P-=1<<e-w[H]++-1:++n}for(;n>=0&&P;--n){var N=s[n].s;w[N]==e&&(--w[N],++P)}M=e}return{t:new Wc(w),l:M}},DB=function(r,e,t){return r.s==-1?Math.max(DB(r.l,e,t+1),DB(r.r,e,t+1)):e[r.s]=t},dO=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new nc(++e),n=0,i=r[0],s=1,a=function(u){t[n++]=u},o=1;o<=e;++o)if(r[o]==i&&o!=e)++s;else{if(!i&&s>2){for(;s>138;s-=138)a(32754);s>2&&(a(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(a(i),--s;s>6;s-=6)a(8304);s>2&&(a(s-3<<5|8208),s=0)}for(;s--;)a(i);s=1,i=r[o]}return{c:t.subarray(0,n),n:e}},i_=function(r,e){for(var t=0,n=0;n<e.length;++n)t+=r[n]*e[n];return t},pO=function(r,e,t){var n=t.length,i=fO(e+2);r[i]=n&255,r[i+1]=n>>8,r[i+2]=r[i]^255,r[i+3]=r[i+1]^255;for(var s=0;s<n;++s)r[i+s+4]=t[s];return(i+4+n)*8},gO=function(r,e,t,n,i,s,a,o,u,d,p){zh(e,p++,t),++i[256];for(var b=UB(i,15),C=b.t,w=b.l,M=UB(s,15),P=M.t,k=M.l,D=dO(C),j=D.c,H=D.n,N=dO(P),q=N.c,W=N.n,ie=new nc(19),se=0;se<j.length;++se)++ie[j[se]&31];for(var se=0;se<q.length;++se)++ie[q[se]&31];for(var Z=UB(ie,7),fe=Z.t,te=Z.l,ce=19;ce>4&&!fe[lO[ce-1]];--ce);var ve=d+5<<3,me=i_(i,ld)+i_(s,lb)+a,qe=i_(i,C)+i_(s,P)+a+14+3*ce+i_(ie,fe)+2*ie[16]+3*ie[17]+7*ie[18];if(u>=0&&ve<=me&&ve<=qe)return pO(e,p,r.subarray(u,u+d));var ot,st,Ye,Xe;if(zh(e,p,1+(qe<me)),p+=2,qe<me){ot=r_(C,w),st=C,Ye=r_(P,k),Xe=P;var wt=r_(fe,te);zh(e,p,H-257),zh(e,p+5,W-1),zh(e,p+10,ce-4),p+=14;for(var se=0;se<ce;++se)zh(e,p+3*se,fe[lO[se]]);p+=3*ce;for(var ht=[j,q],he=0;he<2;++he)for(var Be=ht[he],se=0;se<Be.length;++se){var Le=Be[se]&31;zh(e,p,wt[Le]),p+=fe[Le],Le>15&&(zh(e,p,Be[se]>>5&127),p+=Be[se]>>12)}}else ot=rAe,st=ld,Ye=nAe,Xe=lb;for(var se=0;se<o;++se){var He=n[se];if(He>255){var Le=He>>18&31;n_(e,p,ot[Le+257]),p+=st[Le+257],Le>7&&(zh(e,p,He>>23&31),p+=RB[Le]);var rt=He&31;n_(e,p,Ye[rt]),p+=Xe[rt],rt>3&&(n_(e,p,He>>5&8191),p+=LB[rt])}else n_(e,p,ot[He]),p+=st[He]}return n_(e,p,ot[256]),p+st[256]},sAe=new FB([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),mO=new Wc(0),oAe=function(r,e,t,n,i,s){var a=s.z||r.length,o=new Wc(n+a+5*(1+Math.ceil(a/7e3))+i),u=o.subarray(n,o.length-i),d=s.l,p=(s.r||0)&7;if(e){p&&(u[0]=s.r>>3);for(var b=sAe[e-1],C=b>>13,w=b&8191,M=(1<<t)-1,P=s.p||new nc(32768),k=s.h||new nc(M+1),D=Math.ceil(t/3),j=2*D,H=function(xt){return(r[xt]^r[xt+1]<<D^r[xt+2]<<j)&M},N=new FB(25e3),q=new nc(288),W=new nc(32),ie=0,se=0,Z=s.i||0,fe=0,te=s.w||0,ce=0;Z+2<a;++Z){var ve=H(Z),me=Z&32767,qe=k[ve];if(P[me]=qe,k[ve]=me,te<=Z){var ot=a-Z;if((ie>7e3||fe>24576)&&(ot>423||!d)){p=gO(r,u,0,N,q,W,se,fe,ce,Z-ce,p),fe=ie=se=0,ce=Z;for(var st=0;st<286;++st)q[st]=0;for(var st=0;st<30;++st)W[st]=0}var Ye=2,Xe=0,wt=w,ht=me-qe&32767;if(ot>2&&ve==H(Z-ht))for(var he=Math.min(C,ot)-1,Be=Math.min(32767,Z),Le=Math.min(258,ot);ht<=Be&&--wt&&me!=qe;){if(r[Z+Ye]==r[Z+Ye-ht]){for(var He=0;He<Le&&r[Z+He]==r[Z+He-ht];++He);if(He>Ye){if(Ye=He,Xe=ht,He>he)break;for(var rt=Math.min(ht,He-2),it=0,st=0;st<rt;++st){var Pt=Z-ht+st&32767,Bt=P[Pt],Dt=Pt-Bt&32767;Dt>it&&(it=Dt,qe=Pt)}}}me=qe,qe=P[me],ht+=me-qe&32767}if(Xe){N[fe++]=268435456|OB[Ye]<<18|hO[Xe];var Yt=OB[Ye]&31,nr=hO[Xe]&31;se+=RB[Yt]+LB[nr],++q[257+Yt],++W[nr],te=Z+Ye,++ie}else N[fe++]=r[Z],++q[r[Z]]}}for(Z=Math.max(Z,te);Z<a;++Z)N[fe++]=r[Z],++q[r[Z]];p=gO(r,u,d,N,q,W,se,fe,ce,Z-ce,p),d||(s.r=p&7|u[p/8|0]<<3,p-=7,s.h=k,s.p=P,s.i=Z,s.w=te)}else{for(var Z=s.w||0;Z<a+d;Z+=65535){var ur=Z+65535;ur>=a&&(u[p/8|0]=d,ur=a),p=pO(u,p+1,r.subarray(Z,ur))}s.i=a}return iAe(o,0,n+fO(p)+i)},_O=function(){var r=1,e=0;return{p:function(t){for(var n=r,i=e,s=t.length|0,a=0;a!=s;){for(var o=Math.min(a+2655,s);a<o;++a)i+=n+=t[a];n=(n&65535)+15*(n>>16),i=(i&65535)+15*(i>>16)}r=n,e=i},d:function(){return r%=65521,e%=65521,(r&255)<<24|(r&65280)<<8|(e&255)<<8|e>>8}}},aAe=function(r,e,t,n,i){if(!i&&(i={l:1},e.dictionary)){var s=e.dictionary.subarray(-32768),a=new Wc(s.length+r.length);a.set(s),a.set(r,s.length),r=a,i.w=s.length}return oAe(r,e.level==null?6:e.level,e.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):20:12+e.mem,t,n,i)},yO=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8},lAe=function(r,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;if(r[0]=120,r[1]=n<<6|(e.dictionary&&32),r[1]|=31-(r[0]<<8|r[1])%31,e.dictionary){var i=_O();i.p(e.dictionary),yO(r,2,i.d())}};function kB(r,e){e||(e={});var t=_O();t.p(r);var n=aAe(r,e,e.dictionary?6:2,4);return lAe(n,e),yO(n,n.length-4,t.d()),n}var cAe=typeof TextDecoder<"u"&&new TextDecoder,uAe=0;try{cAe.decode(mO,{stream:!0}),uAe=1}catch{}function hAe(r){if(Array.isArray(r))return r}function AAe(r,e){var t=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(t!=null){var n,i,s,a,o=[],u=!0,d=!1;try{if(s=(t=t.call(r)).next,e!==0)for(;!(u=(n=s.call(t)).done)&&(o.push(n.value),o.length!==e);u=!0);}catch(p){d=!0,i=p}finally{try{if(!u&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(d)throw i}}return o}}function bO(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=Array(e);t<e;t++)n[t]=r[t];return n}function fAe(r,e){if(r){if(typeof r=="string")return bO(r,e);var t={}.toString.call(r).slice(8,-1);return t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set"?Array.from(r):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?bO(r,e):void 0}}function dAe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vO(r,e){return hAe(r)||AAe(r,e)||fAe(r,e)||dAe()}function wO(r,e="utf8"){return new TextDecoder(e).decode(r)}const pAe=new TextEncoder;function gAe(r){return pAe.encode(r)}const mAe=1024*8,_Ae=(()=>{const r=new Uint8Array(4),e=new Uint32Array(r.buffer);return!((e[0]=1)&r[0])})(),NB={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};let yAe=class k9{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(e=mAe,t={}){let n=!1;typeof e=="number"?e=new ArrayBuffer(e):(n=!0,this.lastWrittenByte=e.byteLength);const i=t.offset?t.offset>>>0:0,s=e.byteLength-i;let a=i;(ArrayBuffer.isView(e)||e instanceof k9)&&(e.byteLength!==e.buffer.byteLength&&(a=e.byteOffset+i),e=e.buffer),n?this.lastWrittenByte=s:this.lastWrittenByte=0,this.buffer=e,this.length=s,this.byteLength=s,this.byteOffset=a,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,a,s),this._mark=0,this._marks=[]}available(e=1){return this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e=1){return this.offset+=e,this}back(e=1){return this.offset-=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e=1){if(!this.available(e)){const t=(this.offset+e)*2,n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=t,this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e=1){return this.readArray(e,"uint8")}readArray(e,t){const n=NB[t].BYTES_PER_ELEMENT*e,i=this.byteOffset+this.offset,s=this.buffer.slice(i,i+n);if(this.littleEndian===_Ae&&t!=="uint8"&&t!=="int8"){const o=new Uint8Array(this.buffer.slice(i,i+n));o.reverse();const u=new NB[t](o.buffer);return this.offset+=n,u.reverse(),u}const a=new NB[t](s);return this.offset+=n,a}readInt16(){const e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){const e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){const e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){const e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){const e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){const e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readBigInt64(){const e=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,e}readBigUint64(){const e=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){let t="";for(let n=0;n<e;n++)t+=this.readChar();return t}readUtf8(e=1){return wO(this.readBytes(e))}decodeText(e=1,t="utf8"){return wO(this.readBytes(e),t)}writeBoolean(e){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(let t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(e){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(e){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(let t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}writeUtf8(e){return this.writeBytes(gAe(e))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}};function Kp(r){let e=r.length;for(;--e>=0;)r[e]=0}const bAe=3,vAe=258,xO=29,wAe=256,xAe=wAe+1+xO,BO=30,BAe=512,CAe=new Array((xAe+2)*2);Kp(CAe);const TAe=new Array(BO*2);Kp(TAe);const EAe=new Array(BAe);Kp(EAe);const SAe=new Array(vAe-bAe+1);Kp(SAe);const IAe=new Array(xO);Kp(IAe);const PAe=new Array(BO);Kp(PAe);var zB=(r,e,t,n)=>{let i=r&65535|0,s=r>>>16&65535|0,a=0;for(;t!==0;){a=t>2e3?2e3:t,t-=a;do i=i+e[n++]|0,s=s+i|0;while(--a);i%=65521,s%=65521}return i|s<<16|0};const MAe=()=>{let r,e=[];for(var t=0;t<256;t++){r=t;for(var n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;e[t]=r}return e},FAe=new Uint32Array(MAe());var $u=(r,e,t,n)=>{const i=FAe,s=n+t;r^=-1;for(let a=n;a<s;a++)r=r>>>8^i[(r^e[a])&255];return r^-1},QB={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},CO={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const RAe=(r,e)=>Object.prototype.hasOwnProperty.call(r,e);var LAe=function(r){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(const n in t)RAe(t,n)&&(r[n]=t[n])}}return r},OAe=r=>{let e=0;for(let n=0,i=r.length;n<i;n++)e+=r[n].length;const t=new Uint8Array(e);for(let n=0,i=0,s=r.length;n<s;n++){let a=r[n];t.set(a,i),i+=a.length}return t},TO={assign:LAe,flattenChunks:OAe};let EO=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{EO=!1}const s_=new Uint8Array(256);for(let r=0;r<256;r++)s_[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;s_[254]=s_[254]=1;var UAe=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let e,t,n,i,s,a=r.length,o=0;for(i=0;i<a;i++)t=r.charCodeAt(i),(t&64512)===55296&&i+1<a&&(n=r.charCodeAt(i+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),o+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(o),s=0,i=0;s<o;i++)t=r.charCodeAt(i),(t&64512)===55296&&i+1<a&&(n=r.charCodeAt(i+1),(n&64512)===56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),t<128?e[s++]=t:t<2048?(e[s++]=192|t>>>6,e[s++]=128|t&63):t<65536?(e[s++]=224|t>>>12,e[s++]=128|t>>>6&63,e[s++]=128|t&63):(e[s++]=240|t>>>18,e[s++]=128|t>>>12&63,e[s++]=128|t>>>6&63,e[s++]=128|t&63);return e};const DAe=(r,e)=>{if(e<65534&&r.subarray&&EO)return String.fromCharCode.apply(null,r.length===e?r:r.subarray(0,e));let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(r[n]);return t};var kAe=(r,e)=>{const t=e||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,e));let n,i;const s=new Array(t*2);for(i=0,n=0;n<t;){let a=r[n++];if(a<128){s[i++]=a;continue}let o=s_[a];if(o>4){s[i++]=65533,n+=o-1;continue}for(a&=o===2?31:o===3?15:7;o>1&&n<t;)a=a<<6|r[n++]&63,o--;if(o>1){s[i++]=65533;continue}a<65536?s[i++]=a:(a-=65536,s[i++]=55296|a>>10&1023,s[i++]=56320|a&1023)}return DAe(s,i)},NAe=(r,e)=>{e=e||r.length,e>r.length&&(e=r.length);let t=e-1;for(;t>=0&&(r[t]&192)===128;)t--;return t<0||t===0?e:t+s_[r[t]]>e?t:e},HB={string2buf:UAe,buf2string:kAe,utf8border:NAe};function zAe(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var QAe=zAe;const cb=16209,HAe=16191;var VAe=function(r,e){let t,n,i,s,a,o,u,d,p,b,C,w,M,P,k,D,j,H,N,q,W,ie,se,Z;const fe=r.state;t=r.next_in,se=r.input,n=t+(r.avail_in-5),i=r.next_out,Z=r.output,s=i-(e-r.avail_out),a=i+(r.avail_out-257),o=fe.dmax,u=fe.wsize,d=fe.whave,p=fe.wnext,b=fe.window,C=fe.hold,w=fe.bits,M=fe.lencode,P=fe.distcode,k=(1<<fe.lenbits)-1,D=(1<<fe.distbits)-1;e:do{w<15&&(C+=se[t++]<<w,w+=8,C+=se[t++]<<w,w+=8),j=M[C&k];t:for(;;){if(H=j>>>24,C>>>=H,w-=H,H=j>>>16&255,H===0)Z[i++]=j&65535;else if(H&16){N=j&65535,H&=15,H&&(w<H&&(C+=se[t++]<<w,w+=8),N+=C&(1<<H)-1,C>>>=H,w-=H),w<15&&(C+=se[t++]<<w,w+=8,C+=se[t++]<<w,w+=8),j=P[C&D];r:for(;;){if(H=j>>>24,C>>>=H,w-=H,H=j>>>16&255,H&16){if(q=j&65535,H&=15,w<H&&(C+=se[t++]<<w,w+=8,w<H&&(C+=se[t++]<<w,w+=8)),q+=C&(1<<H)-1,q>o){r.msg="invalid distance too far back",fe.mode=cb;break e}if(C>>>=H,w-=H,H=i-s,q>H){if(H=q-H,H>d&&fe.sane){r.msg="invalid distance too far back",fe.mode=cb;break e}if(W=0,ie=b,p===0){if(W+=u-H,H<N){N-=H;do Z[i++]=b[W++];while(--H);W=i-q,ie=Z}}else if(p<H){if(W+=u+p-H,H-=p,H<N){N-=H;do Z[i++]=b[W++];while(--H);if(W=0,p<N){H=p,N-=H;do Z[i++]=b[W++];while(--H);W=i-q,ie=Z}}}else if(W+=p-H,H<N){N-=H;do Z[i++]=b[W++];while(--H);W=i-q,ie=Z}for(;N>2;)Z[i++]=ie[W++],Z[i++]=ie[W++],Z[i++]=ie[W++],N-=3;N&&(Z[i++]=ie[W++],N>1&&(Z[i++]=ie[W++]))}else{W=i-q;do Z[i++]=Z[W++],Z[i++]=Z[W++],Z[i++]=Z[W++],N-=3;while(N>2);N&&(Z[i++]=Z[W++],N>1&&(Z[i++]=Z[W++]))}}else if((H&64)===0){j=P[(j&65535)+(C&(1<<H)-1)];continue r}else{r.msg="invalid distance code",fe.mode=cb;break e}break}}else if((H&64)===0){j=M[(j&65535)+(C&(1<<H)-1)];continue t}else if(H&32){fe.mode=HAe;break e}else{r.msg="invalid literal/length code",fe.mode=cb;break e}break}}while(t<n&&i<a);N=w>>3,t-=N,w-=N<<3,C&=(1<<w)-1,r.next_in=t,r.next_out=i,r.avail_in=t<n?5+(n-t):5-(t-n),r.avail_out=i<a?257+(a-i):257-(i-a),fe.hold=C,fe.bits=w};const Xp=15,SO=852,IO=592,PO=0,VB=1,MO=2,jAe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),$Ae=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),GAe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),WAe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var o_=(r,e,t,n,i,s,a,o)=>{const u=o.bits;let d=0,p=0,b=0,C=0,w=0,M=0,P=0,k=0,D=0,j=0,H,N,q,W,ie,se=null,Z;const fe=new Uint16Array(Xp+1),te=new Uint16Array(Xp+1);let ce=null,ve,me,qe;for(d=0;d<=Xp;d++)fe[d]=0;for(p=0;p<n;p++)fe[e[t+p]]++;for(w=u,C=Xp;C>=1&&fe[C]===0;C--);if(w>C&&(w=C),C===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,o.bits=1,0;for(b=1;b<C&&fe[b]===0;b++);for(w<b&&(w=b),k=1,d=1;d<=Xp;d++)if(k<<=1,k-=fe[d],k<0)return-1;if(k>0&&(r===PO||C!==1))return-1;for(te[1]=0,d=1;d<Xp;d++)te[d+1]=te[d]+fe[d];for(p=0;p<n;p++)e[t+p]!==0&&(a[te[e[t+p]]++]=p);if(r===PO?(se=ce=a,Z=20):r===VB?(se=jAe,ce=$Ae,Z=257):(se=GAe,ce=WAe,Z=0),j=0,p=0,d=b,ie=s,M=w,P=0,q=-1,D=1<<w,W=D-1,r===VB&&D>SO||r===MO&&D>IO)return 1;for(;;){ve=d-P,a[p]+1<Z?(me=0,qe=a[p]):a[p]>=Z?(me=ce[a[p]-Z],qe=se[a[p]-Z]):(me=96,qe=0),H=1<<d-P,N=1<<M,b=N;do N-=H,i[ie+(j>>P)+N]=ve<<24|me<<16|qe|0;while(N!==0);for(H=1<<d-1;j&H;)H>>=1;if(H!==0?(j&=H-1,j+=H):j=0,p++,--fe[d]===0){if(d===C)break;d=e[t+a[p]]}if(d>w&&(j&W)!==q){for(P===0&&(P=w),ie+=b,M=d-P,k=1<<M;M+P<C&&(k-=fe[M+P],!(k<=0));)M++,k<<=1;if(D+=1<<M,r===VB&&D>SO||r===MO&&D>IO)return 1;q=j&W,i[q]=w<<24|M<<16|ie-s|0}}return j!==0&&(i[ie+j]=d-P<<24|64<<16|0),o.bits=w,0};const qAe=0,FO=1,RO=2,{Z_FINISH:LO,Z_BLOCK:KAe,Z_TREES:ub,Z_OK:cd,Z_STREAM_END:XAe,Z_NEED_DICT:YAe,Z_STREAM_ERROR:qc,Z_DATA_ERROR:OO,Z_MEM_ERROR:UO,Z_BUF_ERROR:ZAe,Z_DEFLATED:DO}=CO,hb=16180,kO=16181,NO=16182,zO=16183,QO=16184,HO=16185,VO=16186,jO=16187,$O=16188,GO=16189,Ab=16190,Qh=16191,jB=16192,WO=16193,$B=16194,qO=16195,KO=16196,XO=16197,YO=16198,fb=16199,db=16200,ZO=16201,JO=16202,eU=16203,tU=16204,rU=16205,GB=16206,nU=16207,iU=16208,ns=16209,sU=16210,oU=16211,JAe=852,efe=592,tfe=15,rfe=tfe,aU=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function nfe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ud=r=>{if(!r)return 1;const e=r.state;return!e||e.strm!==r||e.mode<hb||e.mode>oU?1:0},lU=r=>{if(ud(r))return qc;const e=r.state;return r.total_in=r.total_out=e.total=0,r.msg="",e.wrap&&(r.adler=e.wrap&1),e.mode=hb,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(JAe),e.distcode=e.distdyn=new Int32Array(efe),e.sane=1,e.back=-1,cd},cU=r=>{if(ud(r))return qc;const e=r.state;return e.wsize=0,e.whave=0,e.wnext=0,lU(r)},uU=(r,e)=>{let t;if(ud(r))return qc;const n=r.state;return e<0?(t=0,e=-e):(t=(e>>4)+5,e<48&&(e&=15)),e&&(e<8||e>15)?qc:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,cU(r))},hU=(r,e)=>{if(!r)return qc;const t=new nfe;r.state=t,t.strm=r,t.window=null,t.mode=hb;const n=uU(r,e);return n!==cd&&(r.state=null),n},ife=r=>hU(r,rfe);let AU=!0,WB,qB;const sfe=r=>{if(AU){WB=new Int32Array(512),qB=new Int32Array(32);let e=0;for(;e<144;)r.lens[e++]=8;for(;e<256;)r.lens[e++]=9;for(;e<280;)r.lens[e++]=7;for(;e<288;)r.lens[e++]=8;for(o_(FO,r.lens,0,288,WB,0,r.work,{bits:9}),e=0;e<32;)r.lens[e++]=5;o_(RO,r.lens,0,32,qB,0,r.work,{bits:5}),AU=!1}r.lencode=WB,r.lenbits=9,r.distcode=qB,r.distbits=5},fU=(r,e,t,n)=>{let i;const s=r.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(e.subarray(t-s.wsize,t),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>n&&(i=n),s.window.set(e.subarray(t-n,t-n+i),s.wnext),n-=i,n?(s.window.set(e.subarray(t-n,t),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},ofe=(r,e)=>{let t,n,i,s,a,o,u,d,p,b,C,w,M,P,k=0,D,j,H,N,q,W,ie,se;const Z=new Uint8Array(4);let fe,te;const ce=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ud(r)||!r.output||!r.input&&r.avail_in!==0)return qc;t=r.state,t.mode===Qh&&(t.mode=jB),a=r.next_out,i=r.output,u=r.avail_out,s=r.next_in,n=r.input,o=r.avail_in,d=t.hold,p=t.bits,b=o,C=u,se=cd;e:for(;;)switch(t.mode){case hb:if(t.wrap===0){t.mode=jB;break}for(;p<16;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}if(t.wrap&2&&d===35615){t.wbits===0&&(t.wbits=15),t.check=0,Z[0]=d&255,Z[1]=d>>>8&255,t.check=$u(t.check,Z,2,0),d=0,p=0,t.mode=kO;break}if(t.head&&(t.head.done=!1),!(t.wrap&1)||(((d&255)<<8)+(d>>8))%31){r.msg="incorrect header check",t.mode=ns;break}if((d&15)!==DO){r.msg="unknown compression method",t.mode=ns;break}if(d>>>=4,p-=4,ie=(d&15)+8,t.wbits===0&&(t.wbits=ie),ie>15||ie>t.wbits){r.msg="invalid window size",t.mode=ns;break}t.dmax=1<<t.wbits,t.flags=0,r.adler=t.check=1,t.mode=d&512?GO:Qh,d=0,p=0;break;case kO:for(;p<16;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}if(t.flags=d,(t.flags&255)!==DO){r.msg="unknown compression method",t.mode=ns;break}if(t.flags&57344){r.msg="unknown header flags set",t.mode=ns;break}t.head&&(t.head.text=d>>8&1),t.flags&512&&t.wrap&4&&(Z[0]=d&255,Z[1]=d>>>8&255,t.check=$u(t.check,Z,2,0)),d=0,p=0,t.mode=NO;case NO:for(;p<32;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}t.head&&(t.head.time=d),t.flags&512&&t.wrap&4&&(Z[0]=d&255,Z[1]=d>>>8&255,Z[2]=d>>>16&255,Z[3]=d>>>24&255,t.check=$u(t.check,Z,4,0)),d=0,p=0,t.mode=zO;case zO:for(;p<16;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}t.head&&(t.head.xflags=d&255,t.head.os=d>>8),t.flags&512&&t.wrap&4&&(Z[0]=d&255,Z[1]=d>>>8&255,t.check=$u(t.check,Z,2,0)),d=0,p=0,t.mode=QO;case QO:if(t.flags&1024){for(;p<16;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}t.length=d,t.head&&(t.head.extra_len=d),t.flags&512&&t.wrap&4&&(Z[0]=d&255,Z[1]=d>>>8&255,t.check=$u(t.check,Z,2,0)),d=0,p=0}else t.head&&(t.head.extra=null);t.mode=HO;case HO:if(t.flags&1024&&(w=t.length,w>o&&(w=o),w&&(t.head&&(ie=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(s,s+w),ie)),t.flags&512&&t.wrap&4&&(t.check=$u(t.check,n,w,s)),o-=w,s+=w,t.length-=w),t.length))break e;t.length=0,t.mode=VO;case VO:if(t.flags&2048){if(o===0)break e;w=0;do ie=n[s+w++],t.head&&ie&&t.length<65536&&(t.head.name+=String.fromCharCode(ie));while(ie&&w<o);if(t.flags&512&&t.wrap&4&&(t.check=$u(t.check,n,w,s)),o-=w,s+=w,ie)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=jO;case jO:if(t.flags&4096){if(o===0)break e;w=0;do ie=n[s+w++],t.head&&ie&&t.length<65536&&(t.head.comment+=String.fromCharCode(ie));while(ie&&w<o);if(t.flags&512&&t.wrap&4&&(t.check=$u(t.check,n,w,s)),o-=w,s+=w,ie)break e}else t.head&&(t.head.comment=null);t.mode=$O;case $O:if(t.flags&512){for(;p<16;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}if(t.wrap&4&&d!==(t.check&65535)){r.msg="header crc mismatch",t.mode=ns;break}d=0,p=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=Qh;break;case GO:for(;p<32;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}r.adler=t.check=aU(d),d=0,p=0,t.mode=Ab;case Ab:if(t.havedict===0)return r.next_out=a,r.avail_out=u,r.next_in=s,r.avail_in=o,t.hold=d,t.bits=p,YAe;r.adler=t.check=1,t.mode=Qh;case Qh:if(e===KAe||e===ub)break e;case jB:if(t.last){d>>>=p&7,p-=p&7,t.mode=GB;break}for(;p<3;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}switch(t.last=d&1,d>>>=1,p-=1,d&3){case 0:t.mode=WO;break;case 1:if(sfe(t),t.mode=fb,e===ub){d>>>=2,p-=2;break e}break;case 2:t.mode=KO;break;case 3:r.msg="invalid block type",t.mode=ns}d>>>=2,p-=2;break;case WO:for(d>>>=p&7,p-=p&7;p<32;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}if((d&65535)!==(d>>>16^65535)){r.msg="invalid stored block lengths",t.mode=ns;break}if(t.length=d&65535,d=0,p=0,t.mode=$B,e===ub)break e;case $B:t.mode=qO;case qO:if(w=t.length,w){if(w>o&&(w=o),w>u&&(w=u),w===0)break e;i.set(n.subarray(s,s+w),a),o-=w,s+=w,u-=w,a+=w,t.length-=w;break}t.mode=Qh;break;case KO:for(;p<14;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}if(t.nlen=(d&31)+257,d>>>=5,p-=5,t.ndist=(d&31)+1,d>>>=5,p-=5,t.ncode=(d&15)+4,d>>>=4,p-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=ns;break}t.have=0,t.mode=XO;case XO:for(;t.have<t.ncode;){for(;p<3;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}t.lens[ce[t.have++]]=d&7,d>>>=3,p-=3}for(;t.have<19;)t.lens[ce[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,fe={bits:t.lenbits},se=o_(qAe,t.lens,0,19,t.lencode,0,t.work,fe),t.lenbits=fe.bits,se){r.msg="invalid code lengths set",t.mode=ns;break}t.have=0,t.mode=YO;case YO:for(;t.have<t.nlen+t.ndist;){for(;k=t.lencode[d&(1<<t.lenbits)-1],D=k>>>24,j=k>>>16&255,H=k&65535,!(D<=p);){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}if(H<16)d>>>=D,p-=D,t.lens[t.have++]=H;else{if(H===16){for(te=D+2;p<te;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}if(d>>>=D,p-=D,t.have===0){r.msg="invalid bit length repeat",t.mode=ns;break}ie=t.lens[t.have-1],w=3+(d&3),d>>>=2,p-=2}else if(H===17){for(te=D+3;p<te;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}d>>>=D,p-=D,ie=0,w=3+(d&7),d>>>=3,p-=3}else{for(te=D+7;p<te;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}d>>>=D,p-=D,ie=0,w=11+(d&127),d>>>=7,p-=7}if(t.have+w>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=ns;break}for(;w--;)t.lens[t.have++]=ie}}if(t.mode===ns)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=ns;break}if(t.lenbits=9,fe={bits:t.lenbits},se=o_(FO,t.lens,0,t.nlen,t.lencode,0,t.work,fe),t.lenbits=fe.bits,se){r.msg="invalid literal/lengths set",t.mode=ns;break}if(t.distbits=6,t.distcode=t.distdyn,fe={bits:t.distbits},se=o_(RO,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,fe),t.distbits=fe.bits,se){r.msg="invalid distances set",t.mode=ns;break}if(t.mode=fb,e===ub)break e;case fb:t.mode=db;case db:if(o>=6&&u>=258){r.next_out=a,r.avail_out=u,r.next_in=s,r.avail_in=o,t.hold=d,t.bits=p,VAe(r,C),a=r.next_out,i=r.output,u=r.avail_out,s=r.next_in,n=r.input,o=r.avail_in,d=t.hold,p=t.bits,t.mode===Qh&&(t.back=-1);break}for(t.back=0;k=t.lencode[d&(1<<t.lenbits)-1],D=k>>>24,j=k>>>16&255,H=k&65535,!(D<=p);){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}if(j&&(j&240)===0){for(N=D,q=j,W=H;k=t.lencode[W+((d&(1<<N+q)-1)>>N)],D=k>>>24,j=k>>>16&255,H=k&65535,!(N+D<=p);){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}d>>>=N,p-=N,t.back+=N}if(d>>>=D,p-=D,t.back+=D,t.length=H,j===0){t.mode=rU;break}if(j&32){t.back=-1,t.mode=Qh;break}if(j&64){r.msg="invalid literal/length code",t.mode=ns;break}t.extra=j&15,t.mode=ZO;case ZO:if(t.extra){for(te=t.extra;p<te;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}t.length+=d&(1<<t.extra)-1,d>>>=t.extra,p-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=JO;case JO:for(;k=t.distcode[d&(1<<t.distbits)-1],D=k>>>24,j=k>>>16&255,H=k&65535,!(D<=p);){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}if((j&240)===0){for(N=D,q=j,W=H;k=t.distcode[W+((d&(1<<N+q)-1)>>N)],D=k>>>24,j=k>>>16&255,H=k&65535,!(N+D<=p);){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}d>>>=N,p-=N,t.back+=N}if(d>>>=D,p-=D,t.back+=D,j&64){r.msg="invalid distance code",t.mode=ns;break}t.offset=H,t.extra=j&15,t.mode=eU;case eU:if(t.extra){for(te=t.extra;p<te;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}t.offset+=d&(1<<t.extra)-1,d>>>=t.extra,p-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=ns;break}t.mode=tU;case tU:if(u===0)break e;if(w=C-u,t.offset>w){if(w=t.offset-w,w>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=ns;break}w>t.wnext?(w-=t.wnext,M=t.wsize-w):M=t.wnext-w,w>t.length&&(w=t.length),P=t.window}else P=i,M=a-t.offset,w=t.length;w>u&&(w=u),u-=w,t.length-=w;do i[a++]=P[M++];while(--w);t.length===0&&(t.mode=db);break;case rU:if(u===0)break e;i[a++]=t.length,u--,t.mode=db;break;case GB:if(t.wrap){for(;p<32;){if(o===0)break e;o--,d|=n[s++]<<p,p+=8}if(C-=u,r.total_out+=C,t.total+=C,t.wrap&4&&C&&(r.adler=t.check=t.flags?$u(t.check,i,C,a-C):zB(t.check,i,C,a-C)),C=u,t.wrap&4&&(t.flags?d:aU(d))!==t.check){r.msg="incorrect data check",t.mode=ns;break}d=0,p=0}t.mode=nU;case nU:if(t.wrap&&t.flags){for(;p<32;){if(o===0)break e;o--,d+=n[s++]<<p,p+=8}if(t.wrap&4&&d!==(t.total&4294967295)){r.msg="incorrect length check",t.mode=ns;break}d=0,p=0}t.mode=iU;case iU:se=XAe;break e;case ns:se=OO;break e;case sU:return UO;case oU:default:return qc}return r.next_out=a,r.avail_out=u,r.next_in=s,r.avail_in=o,t.hold=d,t.bits=p,(t.wsize||C!==r.avail_out&&t.mode<ns&&(t.mode<GB||e!==LO))&&fU(r,r.output,r.next_out,C-r.avail_out),b-=r.avail_in,C-=r.avail_out,r.total_in+=b,r.total_out+=C,t.total+=C,t.wrap&4&&C&&(r.adler=t.check=t.flags?$u(t.check,i,C,r.next_out-C):zB(t.check,i,C,r.next_out-C)),r.data_type=t.bits+(t.last?64:0)+(t.mode===Qh?128:0)+(t.mode===fb||t.mode===$B?256:0),(b===0&&C===0||e===LO)&&se===cd&&(se=ZAe),se},afe=r=>{if(ud(r))return qc;let e=r.state;return e.window&&(e.window=null),r.state=null,cd},lfe=(r,e)=>{if(ud(r))return qc;const t=r.state;return(t.wrap&2)===0?qc:(t.head=e,e.done=!1,cd)},cfe=(r,e)=>{const t=e.length;let n,i,s;return ud(r)||(n=r.state,n.wrap!==0&&n.mode!==Ab)?qc:n.mode===Ab&&(i=1,i=zB(i,e,t,0),i!==n.check)?OO:(s=fU(r,e,t,t),s?(n.mode=sU,UO):(n.havedict=1,cd))};var ufe=cU,hfe=uU,Afe=lU,ffe=ife,dfe=hU,pfe=ofe,gfe=afe,mfe=lfe,_fe=cfe,yfe="pako inflate (from Nodeca project)",Hh={inflateReset:ufe,inflateReset2:hfe,inflateResetKeep:Afe,inflateInit:ffe,inflateInit2:dfe,inflate:pfe,inflateEnd:gfe,inflateGetHeader:mfe,inflateSetDictionary:_fe,inflateInfo:yfe};function bfe(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var vfe=bfe;const dU=Object.prototype.toString,{Z_NO_FLUSH:wfe,Z_FINISH:xfe,Z_OK:a_,Z_STREAM_END:KB,Z_NEED_DICT:XB,Z_STREAM_ERROR:Bfe,Z_DATA_ERROR:pU,Z_MEM_ERROR:Cfe}=CO;function l_(r){this.options=TO.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(r&&r.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)===0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new QAe,this.strm.avail_out=0;let t=Hh.inflateInit2(this.strm,e.windowBits);if(t!==a_)throw new Error(QB[t]);if(this.header=new vfe,Hh.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=HB.string2buf(e.dictionary):dU.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=Hh.inflateSetDictionary(this.strm,e.dictionary),t!==a_)))throw new Error(QB[t])}l_.prototype.push=function(r,e){const t=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let s,a,o;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?xfe:wfe,dU.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),s=Hh.inflate(t,a),s===XB&&i&&(s=Hh.inflateSetDictionary(t,i),s===a_?s=Hh.inflate(t,a):s===pU&&(s=XB));t.avail_in>0&&s===KB&&t.state.wrap>0&&r[t.next_in]!==0;)Hh.inflateReset(t),s=Hh.inflate(t,a);switch(s){case Bfe:case pU:case XB:case Cfe:return this.onEnd(s),this.ended=!0,!1}if(o=t.avail_out,t.next_out&&(t.avail_out===0||s===KB))if(this.options.to==="string"){let u=HB.utf8border(t.output,t.next_out),d=t.next_out-u,p=HB.buf2string(t.output,u);t.next_out=d,t.avail_out=n-d,d&&t.output.set(t.output.subarray(u,u+d),0),this.onData(p)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(s===a_&&o===0)){if(s===KB)return s=Hh.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(t.avail_in===0)break}}return!0},l_.prototype.onData=function(r){this.chunks.push(r)},l_.prototype.onEnd=function(r){r===a_&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=TO.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function Tfe(r,e){const t=new l_(e);if(t.push(r),t.err)throw t.msg||QB[t.err];return t.result}var Efe=l_,Sfe=Tfe,Ife={Inflate:Efe,inflate:Sfe};const{Inflate:Pfe,inflate:Mfe}=Ife;var gU=Pfe,Ffe=Mfe;const mU=[];for(let r=0;r<256;r++){let e=r;for(let t=0;t<8;t++)e&1?e=3988292384^e>>>1:e=e>>>1;mU[r]=e}const _U=4294967295;function Rfe(r,e,t){let n=r;for(let i=0;i<t;i++)n=mU[(n^e[i])&255]^n>>>8;return n}function Lfe(r,e){return(Rfe(_U,r,e)^_U)>>>0}function yU(r,e,t){const n=r.readUint32(),i=Lfe(new Uint8Array(r.buffer,r.byteOffset+r.offset-e-4,e),e);if(i!==n)throw new Error(`CRC mismatch for chunk ${t}. Expected ${n}, found ${i}`)}function bU(r,e,t){for(let n=0;n<t;n++)e[n]=r[n]}function vU(r,e,t,n){let i=0;for(;i<n;i++)e[i]=r[i];for(;i<t;i++)e[i]=r[i]+e[i-n]&255}function wU(r,e,t,n){let i=0;if(t.length===0)for(;i<n;i++)e[i]=r[i];else for(;i<n;i++)e[i]=r[i]+t[i]&255}function xU(r,e,t,n,i){let s=0;if(t.length===0){for(;s<i;s++)e[s]=r[s];for(;s<n;s++)e[s]=r[s]+(e[s-i]>>1)&255}else{for(;s<i;s++)e[s]=r[s]+(t[s]>>1)&255;for(;s<n;s++)e[s]=r[s]+(e[s-i]+t[s]>>1)&255}}function BU(r,e,t,n,i){let s=0;if(t.length===0){for(;s<i;s++)e[s]=r[s];for(;s<n;s++)e[s]=r[s]+e[s-i]&255}else{for(;s<i;s++)e[s]=r[s]+t[s]&255;for(;s<n;s++)e[s]=r[s]+Ofe(e[s-i],t[s],t[s-i])&255}}function Ofe(r,e,t){const n=r+e-t,i=Math.abs(n-r),s=Math.abs(n-e),a=Math.abs(n-t);return i<=s&&i<=a?r:s<=a?e:t}function Ufe(r,e,t,n,i,s){switch(r){case 0:bU(e,t,i);break;case 1:vU(e,t,i,s);break;case 2:wU(e,t,n,i);break;case 3:xU(e,t,n,i,s);break;case 4:BU(e,t,n,i,s);break;default:throw new Error(`Unsupported filter: ${r}`)}}const Dfe=new Uint16Array([255]),kfe=new Uint8Array(Dfe.buffer),Nfe=kfe[0]===255;function zfe(r){const{data:e,width:t,height:n,channels:i,depth:s}=r,a=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],o=Math.ceil(s/8)*i,u=new Uint8Array(n*t*o);let d=0;for(let p=0;p<7;p++){const b=a[p],C=Math.ceil((t-b.x)/b.xStep),w=Math.ceil((n-b.y)/b.yStep);if(C<=0||w<=0)continue;const M=C*o,P=new Uint8Array(M);for(let k=0;k<w;k++){const D=e[d++],j=e.subarray(d,d+M);d+=M;const H=new Uint8Array(M);Ufe(D,j,H,P,M,o),P.set(H);for(let N=0;N<C;N++){const q=b.x+N*b.xStep,W=b.y+k*b.yStep;if(!(q>=t||W>=n))for(let ie=0;ie<o;ie++)u[(W*t+q)*o+ie]=H[N*o+ie]}}}if(s===16){const p=new Uint16Array(u.buffer);if(Nfe)for(let b=0;b<p.length;b++)p[b]=Qfe(p[b]);return p}else return u}function Qfe(r){return(r&255)<<8|r>>8&255}const Hfe=new Uint16Array([255]),Vfe=new Uint8Array(Hfe.buffer),jfe=Vfe[0]===255,$fe=new Uint8Array(0);function CU(r){const{data:e,width:t,height:n,channels:i,depth:s}=r,a=Math.ceil(s/8)*i,o=Math.ceil(s/8*i*t),u=new Uint8Array(n*o);let d=$fe,p=0,b,C;for(let w=0;w<n;w++){switch(b=e.subarray(p+1,p+1+o),C=u.subarray(w*o,(w+1)*o),e[p]){case 0:bU(b,C,o);break;case 1:vU(b,C,o,a);break;case 2:wU(b,C,d,o);break;case 3:xU(b,C,d,o,a);break;case 4:BU(b,C,d,o,a);break;default:throw new Error(`Unsupported filter: ${e[p]}`)}d=C,p+=o+1}if(s===16){const w=new Uint16Array(u.buffer);if(jfe)for(let M=0;M<w.length;M++)w[M]=Gfe(w[M]);return w}else return u}function Gfe(r){return(r&255)<<8|r>>8&255}const pb=Uint8Array.of(137,80,78,71,13,10,26,10);function TU(r){if(!Wfe(r.readBytes(pb.length)))throw new Error("wrong PNG signature")}function Wfe(r){if(r.length<pb.length)return!1;for(let e=0;e<pb.length;e++)if(r[e]!==pb[e])return!1;return!0}const qfe="tEXt",Kfe=0,EU=new TextDecoder("latin1");function Xfe(r){if(Zfe(r),r.length===0||r.length>79)throw new Error("keyword length must be between 1 and 79")}const Yfe=/^[\u0000-\u00FF]*$/;function Zfe(r){if(!Yfe.test(r))throw new Error("invalid latin1 text")}function Jfe(r,e,t){const n=SU(e);r[n]=ede(e,t-n.length-1)}function SU(r){for(r.mark();r.readByte()!==Kfe;);const e=r.offset;r.reset();const t=EU.decode(r.readBytes(e-r.offset-1));return r.skip(1),Xfe(t),t}function ede(r,e){return EU.decode(r.readBytes(e))}const Sl={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},YB={UNKNOWN:-1,DEFLATE:0},IU={UNKNOWN:-1,ADAPTIVE:0},ZB={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},gb={NONE:0,BACKGROUND:1,PREVIOUS:2},JB={SOURCE:0,OVER:1};class tde extends yAe{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(e,t={}){super(e);const{checkCrc:n=!1}=t;this._checkCrc=n,this._inflator=new gU,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=YB.UNKNOWN,this._filterMethod=IU.UNKNOWN,this._interlaceMethod=ZB.UNKNOWN,this._colorType=Sl.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(TU(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeChunk(e,t)}return this.decodeImage(),this._png}decodeApng(){for(TU(this);!this._end;){const e=this.readUint32(),t=this.readChars(4);this.decodeApngChunk(e,t)}return this.decodeApngImage(),this._apng}decodeChunk(e,t){const n=this.offset;switch(t){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case qfe:Jfe(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-n!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?yU(this,e+4,t):this.skip(4)}decodeApngChunk(e,t){const n=this.offset;switch(t!=="fdAT"&&t!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),t){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,t),this.offset=n+e;break}if(this.offset-n!==e)throw new Error(`Length mismatch while decoding chunk ${t}`);this._checkCrc?yU(this,e+4,t):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=rde(this.readUint8());const t=this.readUint8();this._colorType=t;let n;switch(t){case Sl.GREYSCALE:n=1;break;case Sl.TRUECOLOUR:n=3;break;case Sl.INDEXED_COLOUR:n=1;break;case Sl.GREYSCALE_ALPHA:n=2;break;case Sl.TRUECOLOUR_ALPHA:n=4;break;case Sl.UNKNOWN:default:throw new Error(`Unknown color type: ${t}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==YB.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const t=e/3;this._hasPalette=!0;const n=[];this._palette=n;for(let i=0;i<t;i++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const t=e,n=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,n,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let t=e,n=this.offset+this.byteOffset;if(n+=4,t-=4,this._inflator.push(new Uint8Array(this.buffer,n,t)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodetRNS(e){switch(this._colorType){case Sl.GREYSCALE:case Sl.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let t=0;t<e/2;t++)this._transparency[t]=this.readUint16();break}case Sl.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let t=0;for(;t<e;t++){const n=this.readByte();this._palette[t].push(n)}for(;t<this._palette.length;t++)this._palette[t].push(255);break}case Sl.UNKNOWN:case Sl.GREYSCALE_ALPHA:case Sl.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){const t=SU(this),n=this.readUint8();if(n!==YB.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${n}`);const i=this.readBytes(e-t.length-2);this._png.iccEmbeddedProfile={name:t,profile:Ffe(i)}}decodepHYs(){const e=this.readUint32(),t=this.readUint32(),n=this.readByte();this._png.resolution={x:e,y:t,unit:n}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const t={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},n=this._frames.at(e);if(n){if(n.data=CU({data:n.data,width:n.width,height:n.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),e===0||n.xOffset===0&&n.yOffset===0&&n.width===this._png.width&&n.height===this._png.height)t.data=n.data;else{const i=this._apng.frames.at(e-1);this.disposeFrame(n,i,t),this.addFrameDataToCanvas(t,n)}this._apng.frames.push(t)}}return this._apng}disposeFrame(e,t,n){switch(e.disposeOp){case gb.NONE:break;case gb.BACKGROUND:for(let i=0;i<this._png.height;i++)for(let s=0;s<this._png.width;s++){const a=(i*e.width+s)*this._png.channels;for(let o=0;o<this._png.channels;o++)n.data[a+o]=0}break;case gb.PREVIOUS:n.data.set(t.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,t){const n=1<<this._png.depth,i=(s,a)=>{const o=((s+t.yOffset)*this._png.width+t.xOffset+a)*this._png.channels,u=(s*t.width+a)*this._png.channels;return{index:o,frameIndex:u}};switch(t.blendOp){case JB.SOURCE:for(let s=0;s<t.height;s++)for(let a=0;a<t.width;a++){const{index:o,frameIndex:u}=i(s,a);for(let d=0;d<this._png.channels;d++)e.data[o+d]=t.data[u+d]}break;case JB.OVER:for(let s=0;s<t.height;s++)for(let a=0;a<t.width;a++){const{index:o,frameIndex:u}=i(s,a);for(let d=0;d<this._png.channels;d++){const p=t.data[u+this._png.channels-1]/n,b=d%(this._png.channels-1)===0?1:t.data[u+d],C=Math.floor(p*b+(1-p)*e.data[o+d]);e.data[o+d]+=C}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==IU.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===ZB.NO_INTERLACE)this._png.data=CU({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===ZB.ADAM7)this._png.data=zfe({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,t=this._frames.at(-1);t?t.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:gb.NONE,blendOp:JB.SOURCE,data:e}),this._inflator=new gU,this._writingDataChunks=!1}}function rde(r){if(r!==1&&r!==2&&r!==4&&r!==8&&r!==16)throw new Error(`invalid bit depth: ${r}`);return r}var PU;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.METRE=1]="METRE"})(PU||(PU={}));function nde(r,e){return new tde(r,e).decode()}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 3.0.2 Built on 2025-08-26T11:48:30.930Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Holländer <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var yn=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function eC(){yn.console&&typeof yn.console.log=="function"&&yn.console.log.apply(yn.console,arguments)}var Ui={log:eC,warn:function(r){yn.console&&(typeof yn.console.warn=="function"?yn.console.warn.apply(yn.console,arguments):eC.call(null,arguments))},error:function(r){yn.console&&(typeof yn.console.error=="function"?yn.console.error.apply(yn.console,arguments):eC(r))}};function tC(r,e,t){var n=new XMLHttpRequest;n.open("GET",r),n.responseType="blob",n.onload=function(){hd(n.response,e,t)},n.onerror=function(){Ui.error("could not download file")},n.send()}function MU(r){var e=new XMLHttpRequest;e.open("HEAD",r,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function mb(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(e)}}var hd=yn.saveAs||((typeof window>"u"?"undefined":ni(window))!=="object"||window!==yn?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(r,e,t){var n=yn.URL||yn.webkitURL,i=document.createElement("a");e=e||r.name||"download",i.download=e,i.rel="noopener",typeof r=="string"?(i.href=r,i.origin!==location.origin?MU(i.href)?tC(r,e,t):mb(i,i.target="_blank"):mb(i)):(i.href=n.createObjectURL(r),setTimeout(function(){n.revokeObjectURL(i.href)},4e4),setTimeout(function(){mb(i)},0))}:"msSaveOrOpenBlob"in navigator?function(r,e,t){if(e=e||r.name||"download",typeof r=="string")if(MU(r))tC(r,e,t);else{var n=document.createElement("a");n.href=r,n.target="_blank",setTimeout(function(){mb(n)})}else navigator.msSaveOrOpenBlob(function(i,s){return s===void 0?s={autoBom:!1}:ni(s)!=="object"&&(Ui.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}(r,t),e)}:function(r,e,t,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof r=="string")return tC(r,e,t);var i=r.type==="application/octet-stream",s=/constructor/i.test(yn.HTMLElement)||yn.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||i&&s)&&(typeof FileReader>"u"?"undefined":ni(FileReader))==="object"){var o=new FileReader;o.onloadend=function(){var p=o.result;p=a?p:p.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=p:location=p,n=null},o.readAsDataURL(r)}else{var u=yn.URL||yn.webkitURL,d=u.createObjectURL(r);n?n.location=d:location.href=d,n=null,setTimeout(function(){u.revokeObjectURL(d)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function FU(r){var e;r=r||"",this.ok=!1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[r=(r=r.replace(/ /g,"")).toLowerCase()]||r;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],n=0;n<t.length;n++){var i=t[n].re,s=t[n].process,a=i.exec(r);a&&(e=s(a),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),u=this.g.toString(16),d=this.b.toString(16);return o.length==1&&(o="0"+o),u.length==1&&(u="0"+u),d.length==1&&(d="0"+d),"#"+o+u+d}}var _b=yn.atob.bind(yn),RU=yn.btoa.bind(yn);/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function rC(r,e){var t=r[0],n=r[1],i=r[2],s=r[3];t=ua(t,n,i,s,e[0],7,-680876936),s=ua(s,t,n,i,e[1],12,-389564586),i=ua(i,s,t,n,e[2],17,606105819),n=ua(n,i,s,t,e[3],22,-1044525330),t=ua(t,n,i,s,e[4],7,-176418897),s=ua(s,t,n,i,e[5],12,1200080426),i=ua(i,s,t,n,e[6],17,-1473231341),n=ua(n,i,s,t,e[7],22,-45705983),t=ua(t,n,i,s,e[8],7,1770035416),s=ua(s,t,n,i,e[9],12,-1958414417),i=ua(i,s,t,n,e[10],17,-42063),n=ua(n,i,s,t,e[11],22,-1990404162),t=ua(t,n,i,s,e[12],7,1804603682),s=ua(s,t,n,i,e[13],12,-40341101),i=ua(i,s,t,n,e[14],17,-1502002290),t=ha(t,n=ua(n,i,s,t,e[15],22,1236535329),i,s,e[1],5,-165796510),s=ha(s,t,n,i,e[6],9,-1069501632),i=ha(i,s,t,n,e[11],14,643717713),n=ha(n,i,s,t,e[0],20,-373897302),t=ha(t,n,i,s,e[5],5,-701558691),s=ha(s,t,n,i,e[10],9,38016083),i=ha(i,s,t,n,e[15],14,-660478335),n=ha(n,i,s,t,e[4],20,-405537848),t=ha(t,n,i,s,e[9],5,568446438),s=ha(s,t,n,i,e[14],9,-1019803690),i=ha(i,s,t,n,e[3],14,-187363961),n=ha(n,i,s,t,e[8],20,1163531501),t=ha(t,n,i,s,e[13],5,-1444681467),s=ha(s,t,n,i,e[2],9,-51403784),i=ha(i,s,t,n,e[7],14,1735328473),t=Aa(t,n=ha(n,i,s,t,e[12],20,-1926607734),i,s,e[5],4,-378558),s=Aa(s,t,n,i,e[8],11,-2022574463),i=Aa(i,s,t,n,e[11],16,1839030562),n=Aa(n,i,s,t,e[14],23,-35309556),t=Aa(t,n,i,s,e[1],4,-1530992060),s=Aa(s,t,n,i,e[4],11,1272893353),i=Aa(i,s,t,n,e[7],16,-155497632),n=Aa(n,i,s,t,e[10],23,-1094730640),t=Aa(t,n,i,s,e[13],4,681279174),s=Aa(s,t,n,i,e[0],11,-358537222),i=Aa(i,s,t,n,e[3],16,-722521979),n=Aa(n,i,s,t,e[6],23,76029189),t=Aa(t,n,i,s,e[9],4,-640364487),s=Aa(s,t,n,i,e[12],11,-421815835),i=Aa(i,s,t,n,e[15],16,530742520),t=fa(t,n=Aa(n,i,s,t,e[2],23,-995338651),i,s,e[0],6,-198630844),s=fa(s,t,n,i,e[7],10,1126891415),i=fa(i,s,t,n,e[14],15,-1416354905),n=fa(n,i,s,t,e[5],21,-57434055),t=fa(t,n,i,s,e[12],6,1700485571),s=fa(s,t,n,i,e[3],10,-1894986606),i=fa(i,s,t,n,e[10],15,-1051523),n=fa(n,i,s,t,e[1],21,-2054922799),t=fa(t,n,i,s,e[8],6,1873313359),s=fa(s,t,n,i,e[15],10,-30611744),i=fa(i,s,t,n,e[6],15,-1560198380),n=fa(n,i,s,t,e[13],21,1309151649),t=fa(t,n,i,s,e[4],6,-145523070),s=fa(s,t,n,i,e[11],10,-1120210379),i=fa(i,s,t,n,e[2],15,718787259),n=fa(n,i,s,t,e[9],21,-343485551),r[0]=WA(t,r[0]),r[1]=WA(n,r[1]),r[2]=WA(i,r[2]),r[3]=WA(s,r[3])}function yb(r,e,t,n,i,s){return e=WA(WA(e,r),WA(n,s)),WA(e<<i|e>>>32-i,t)}function ua(r,e,t,n,i,s,a){return yb(e&t|~e&n,r,e,i,s,a)}function ha(r,e,t,n,i,s,a){return yb(e&n|t&~n,r,e,i,s,a)}function Aa(r,e,t,n,i,s,a){return yb(e^t^n,r,e,i,s,a)}function fa(r,e,t,n,i,s,a){return yb(t^(e|~n),r,e,i,s,a)}function LU(r){var e,t=r.length,n=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=r.length;e+=64)rC(n,ide(r.substring(e-64,e)));r=r.substring(e-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<r.length;e++)i[e>>2]|=r.charCodeAt(e)<<(e%4<<3);if(i[e>>2]|=128<<(e%4<<3),e>55)for(rC(n,i),e=0;e<16;e++)i[e]=0;return i[14]=8*t,rC(n,i),n}function ide(r){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=r.charCodeAt(e)+(r.charCodeAt(e+1)<<8)+(r.charCodeAt(e+2)<<16)+(r.charCodeAt(e+3)<<24);return t}var OU="0123456789abcdef".split("");function sde(r){for(var e="",t=0;t<4;t++)e+=OU[r>>8*t+4&15]+OU[r>>8*t&15];return e}function ode(r){return String.fromCharCode(255&r,(65280&r)>>8,(16711680&r)>>16,(4278190080&r)>>24)}function nC(r){return LU(r).map(ode).join("")}var ade=function(r){for(var e=0;e<r.length;e++)r[e]=sde(r[e]);return r.join("")}(LU("hello"))!="5d41402abc4b2a76b9719d911017c592";function WA(r,e){if(ade){var t=(65535&r)+(65535&e);return(r>>16)+(e>>16)+(t>>16)<<16|65535&t}return r+e&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function iC(r,e){var t,n,i,s;if(r!==t){for(var a=(i=r,s=1+(256/r.length|0),new Array(s+1).join(i)),o=[],u=0;u<256;u++)o[u]=u;var d=0;for(u=0;u<256;u++){var p=o[u];d=(d+p+a.charCodeAt(u))%256,o[u]=o[d],o[d]=p}t=r,n=o}else o=n;var b=e.length,C=0,w=0,M="";for(u=0;u<b;u++)w=(w+(p=o[C=(C+1)%256]))%256,o[C]=o[w],o[w]=p,a=o[(o[C]+o[w])%256],M+=String.fromCharCode(e.charCodeAt(u)^a);return M}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var UU={print:4,modify:8,copy:16,"annot-forms":32};function Yp(r,e,t,n){this.v=1,this.r=2;var i=192;r.forEach(function(o){if(UU.perm!==void 0)throw new Error("Invalid permission: "+o);i+=UU[o]}),this.padding="(¿N^NuAd\0NVÿú\b..\0¶Ðh>/\f©þdSiz";var s=(e+this.padding).substr(0,32),a=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,a),this.P=-(1+(255^i)),this.encryptionKey=nC(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=iC(this.encryptionKey,this.padding)}function Zp(r){if(/[^\u0000-\u00ff]/.test(r))throw new Error("Invalid PDF Name Object: "+r+", Only accept ASCII characters.");for(var e="",t=r.length,n=0;n<t;n++){var i=r.charCodeAt(n);e+=i<33||i===35||i===37||i===40||i===41||i===47||i===60||i===62||i===91||i===93||i===123||i===125||i>126?"#"+("0"+i.toString(16)).slice(-2):r[n]}return e}function DU(r){if(ni(r)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,n,i){if(i=i||!1,typeof t!="string"||typeof n!="function"||typeof i!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var s=Math.random().toString(35);return e[t][s]=[n,!!i],s},this.unsubscribe=function(t){for(var n in e)if(e[n][t])return delete e[n][t],Object.keys(e[n]).length===0&&delete e[n],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var n=Array.prototype.slice.call(arguments,1),i=[];for(var s in e[t]){var a=e[t][s];try{a[0].apply(r,n)}catch(o){yn.console&&Ui.error("jsPDF PubSub Error",o.message,o)}a[1]&&i.push(s)}i.length&&i.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function bb(r){if(!(this instanceof bb))return new bb(r);var e="opacity,stroke-opacity".split(",");for(var t in r)r.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=r[t]);this.id="",this.objectNumber=-1}function kU(r,e){this.gState=r,this.matrix=e,this.id="",this.objectNumber=-1}function Ad(r,e,t,n,i){if(!(this instanceof Ad))return new Ad(r,e,t,n,i);this.type=r==="axial"?2:3,this.coords=e,this.colors=t,kU.call(this,n,i)}function Jp(r,e,t,n,i){if(!(this instanceof Jp))return new Jp(r,e,t,n,i);this.boundingBox=r,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,kU.call(this,n,i)}function Jr(r){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],i=arguments[2],s=arguments[3],a=[],o=1,u=16,d="S",p=null;ni(r=r||{})==="object"&&(t=r.orientation,n=r.unit||n,i=r.format||i,s=r.compress||r.compressPdf||s,(p=r.encryption||null)!==null&&(p.userPassword=p.userPassword||"",p.ownerPassword=p.ownerPassword||"",p.userPermissions=p.userPermissions||[]),o=typeof r.userUnit=="number"?Math.abs(r.userUnit):1,r.precision!==void 0&&(e=r.precision),r.floatPrecision!==void 0&&(u=r.floatPrecision),d=r.defaultPathOperation||"S"),a=r.filters||(s===!0?["FlateEncode"]:a),n=n||"mm",t=(""+(t||"P")).toLowerCase();var b=r.putOnlyUsedFonts||!1,C={},w={internal:{},__private__:{}};w.__private__.PubSub=DU;var M="1.3",P=w.__private__.getPdfVersion=function(){return M};w.__private__.setPdfVersion=function(Q){M=Q};var k={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};w.__private__.getPageFormats=function(){return k};var D=w.__private__.getPageFormat=function(Q){return k[Q]};i=i||"a4";var j="compat",H="advanced",N=j;function q(){this.saveGraphicsState(),Re(new Ir(Ne,0,0,-Ne,0,io()*Ne).toString()+" cm"),this.setFontSize(this.getFontSize()/Ne),d="n",N=H}function W(){this.restoreGraphicsState(),d="S",N=j}var ie=w.__private__.combineFontStyleAndFontWeight=function(Q,ue){if(Q=="bold"&&ue=="normal"||Q=="bold"&&ue==400||Q=="normal"&&ue=="italic"||Q=="bold"&&ue=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return ue&&(Q=ue==400||ue==="normal"?Q==="italic"?"italic":"normal":ue!=700&&ue!=="bold"||Q!=="normal"?(ue==700?"bold":ue)+""+Q:"bold"),Q};w.advancedAPI=function(Q){var ue=N===j;return ue&&q.call(this),typeof Q!="function"||(Q(this),ue&&W.call(this)),this},w.compatAPI=function(Q){var ue=N===H;return ue&&W.call(this),typeof Q!="function"||(Q(this),ue&&q.call(this)),this},w.isAdvancedAPI=function(){return N===H};var se,Z=function(Q){if(N!==H)throw new Error(Q+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},fe=w.roundToPrecision=w.__private__.roundToPrecision=function(Q,ue){var Fe=e||ue;if(isNaN(Q)||isNaN(Fe))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return Q.toFixed(Fe).replace(/0+$/,"")};se=w.hpf=w.__private__.hpf=typeof u=="number"?function(Q){if(isNaN(Q))throw new Error("Invalid argument passed to jsPDF.hpf");return fe(Q,u)}:u==="smart"?function(Q){if(isNaN(Q))throw new Error("Invalid argument passed to jsPDF.hpf");return fe(Q,Q>-1&&Q<1?16:5)}:function(Q){if(isNaN(Q))throw new Error("Invalid argument passed to jsPDF.hpf");return fe(Q,16)};var te=w.f2=w.__private__.f2=function(Q){if(isNaN(Q))throw new Error("Invalid argument passed to jsPDF.f2");return fe(Q,2)},ce=w.__private__.f3=function(Q){if(isNaN(Q))throw new Error("Invalid argument passed to jsPDF.f3");return fe(Q,3)},ve=w.scale=w.__private__.scale=function(Q){if(isNaN(Q))throw new Error("Invalid argument passed to jsPDF.scale");return N===j?Q*Ne:N===H?Q:void 0},me=function(Q){return ve(function(ue){return N===j?io()-ue:N===H?ue:void 0}(Q))};w.__private__.setPrecision=w.setPrecision=function(Q){typeof parseInt(Q,10)=="number"&&(e=parseInt(Q,10))};var qe,ot="00000000000000000000000000000000",st=w.__private__.getFileId=function(){return ot},Ye=w.__private__.setFileId=function(Q){return ot=Q!==void 0&&/^[a-fA-F0-9]{32}$/.test(Q)?Q.toUpperCase():ot.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),p!==null&&(Vi=new Yp(p.userPermissions,p.userPassword,p.ownerPassword,ot)),ot};w.setFileId=function(Q){return Ye(Q),this},w.getFileId=function(){return st()};var Xe=w.__private__.convertDateToPDFDate=function(Q){var ue=Q.getTimezoneOffset(),Fe=ue<0?"+":"-",tt=Math.floor(Math.abs(ue/60)),mt=Math.abs(ue%60),Qt=[Fe,Le(tt),"'",Le(mt),"'"].join("");return["D:",Q.getFullYear(),Le(Q.getMonth()+1),Le(Q.getDate()),Le(Q.getHours()),Le(Q.getMinutes()),Le(Q.getSeconds()),Qt].join("")},wt=w.__private__.convertPDFDateToDate=function(Q){var ue=parseInt(Q.substr(2,4),10),Fe=parseInt(Q.substr(6,2),10)-1,tt=parseInt(Q.substr(8,2),10),mt=parseInt(Q.substr(10,2),10),Qt=parseInt(Q.substr(12,2),10),jt=parseInt(Q.substr(14,2),10);return new Date(ue,Fe,tt,mt,Qt,jt,0)},ht=w.__private__.setCreationDate=function(Q){var ue;if(Q===void 0&&(Q=new Date),Q instanceof Date)ue=Xe(Q);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(Q))throw new Error("Invalid argument passed to jsPDF.setCreationDate");ue=Q}return qe=ue},he=w.__private__.getCreationDate=function(Q){var ue=qe;return Q==="jsDate"&&(ue=wt(qe)),ue};w.setCreationDate=function(Q){return ht(Q),this},w.getCreationDate=function(Q){return he(Q)};var Be,Le=w.__private__.padd2=function(Q){return("0"+parseInt(Q)).slice(-2)},He=w.__private__.padd2Hex=function(Q){return("00"+(Q=Q.toString())).substr(Q.length)},rt=0,it=[],Pt=[],Bt=0,Dt=[],Yt=[],nr=!1,ur=Pt;w.__private__.setCustomOutputDestination=function(Q){nr=!0,ur=Q};var xt=function(Q){nr||(ur=Q)};w.__private__.resetCustomOutputDestination=function(){nr=!1,ur=Pt};var Re=w.__private__.out=function(Q){return Q=Q.toString(),Bt+=Q.length+1,ur.push(Q),ur},Kr=w.__private__.write=function(Q){return Re(arguments.length===1?Q.toString():Array.prototype.join.call(arguments," "))},Ur=w.__private__.getArrayBuffer=function(Q){for(var ue=Q.length,Fe=new ArrayBuffer(ue),tt=new Uint8Array(Fe);ue--;)tt[ue]=Q.charCodeAt(ue);return Fe},Er=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];w.__private__.getStandardFonts=function(){return Er};var Kt=r.fontSize||16;w.__private__.setFontSize=w.setFontSize=function(Q){return Kt=N===H?Q/Ne:Q,this};var Br,ar=w.__private__.getFontSize=w.getFontSize=function(){return N===j?Kt:Kt*Ne},Lr=r.R2L||!1;w.__private__.setR2L=w.setR2L=function(Q){return Lr=Q,this},w.__private__.getR2L=w.getR2L=function(){return Lr};var vr,kt=w.__private__.setZoomMode=function(Q){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(Q))Br=Q;else if(isNaN(Q)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(Q)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+Q+'" is not recognized.');Br=Q}else Br=parseInt(Q,10)};w.__private__.getZoomMode=function(){return Br};var ir,hr=w.__private__.setPageMode=function(Q){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(Q)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+Q+'" is not recognized.');vr=Q};w.__private__.getPageMode=function(){return vr};var Mr=w.__private__.setLayoutMode=function(Q){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(Q)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+Q+'" is not recognized.');ir=Q};w.__private__.getLayoutMode=function(){return ir},w.__private__.setDisplayMode=w.setDisplayMode=function(Q,ue,Fe){return kt(Q),Mr(ue),hr(Fe),this};var Cr={title:"",subject:"",author:"",keywords:"",creator:""};w.__private__.getDocumentProperty=function(Q){if(Object.keys(Cr).indexOf(Q)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return Cr[Q]},w.__private__.getDocumentProperties=function(){return Cr},w.__private__.setDocumentProperties=w.setProperties=w.setDocumentProperties=function(Q){for(var ue in Cr)Cr.hasOwnProperty(ue)&&Q[ue]&&(Cr[ue]=Q[ue]);return this},w.__private__.setDocumentProperty=function(Q,ue){if(Object.keys(Cr).indexOf(Q)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return Cr[Q]=ue};var wr,Ne,re,ae,ge,xe={},Me={},We=[],nt={},Ge={},lt={},Lt={},Ft=null,Wt=0,Ze=[],Sr=new DU(w),an=r.hotfixes||[],yr={},sn={},fn=[],Ir=function Q(ue,Fe,tt,mt,Qt,jt){if(!(this instanceof Q))return new Q(ue,Fe,tt,mt,Qt,jt);isNaN(ue)&&(ue=1),isNaN(Fe)&&(Fe=0),isNaN(tt)&&(tt=0),isNaN(mt)&&(mt=1),isNaN(Qt)&&(Qt=0),isNaN(jt)&&(jt=0),this._matrix=[ue,Fe,tt,mt,Qt,jt]};Object.defineProperty(Ir.prototype,"sx",{get:function(){return this._matrix[0]},set:function(Q){this._matrix[0]=Q}}),Object.defineProperty(Ir.prototype,"shy",{get:function(){return this._matrix[1]},set:function(Q){this._matrix[1]=Q}}),Object.defineProperty(Ir.prototype,"shx",{get:function(){return this._matrix[2]},set:function(Q){this._matrix[2]=Q}}),Object.defineProperty(Ir.prototype,"sy",{get:function(){return this._matrix[3]},set:function(Q){this._matrix[3]=Q}}),Object.defineProperty(Ir.prototype,"tx",{get:function(){return this._matrix[4]},set:function(Q){this._matrix[4]=Q}}),Object.defineProperty(Ir.prototype,"ty",{get:function(){return this._matrix[5]},set:function(Q){this._matrix[5]=Q}}),Object.defineProperty(Ir.prototype,"a",{get:function(){return this._matrix[0]},set:function(Q){this._matrix[0]=Q}}),Object.defineProperty(Ir.prototype,"b",{get:function(){return this._matrix[1]},set:function(Q){this._matrix[1]=Q}}),Object.defineProperty(Ir.prototype,"c",{get:function(){return this._matrix[2]},set:function(Q){this._matrix[2]=Q}}),Object.defineProperty(Ir.prototype,"d",{get:function(){return this._matrix[3]},set:function(Q){this._matrix[3]=Q}}),Object.defineProperty(Ir.prototype,"e",{get:function(){return this._matrix[4]},set:function(Q){this._matrix[4]=Q}}),Object.defineProperty(Ir.prototype,"f",{get:function(){return this._matrix[5]},set:function(Q){this._matrix[5]=Q}}),Object.defineProperty(Ir.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Ir.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Ir.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Ir.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Ir.prototype.join=function(Q){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(se).join(Q)},Ir.prototype.multiply=function(Q){var ue=Q.sx*this.sx+Q.shy*this.shx,Fe=Q.sx*this.shy+Q.shy*this.sy,tt=Q.shx*this.sx+Q.sy*this.shx,mt=Q.shx*this.shy+Q.sy*this.sy,Qt=Q.tx*this.sx+Q.ty*this.shx+this.tx,jt=Q.tx*this.shy+Q.ty*this.sy+this.ty;return new Ir(ue,Fe,tt,mt,Qt,jt)},Ir.prototype.decompose=function(){var Q=this.sx,ue=this.shy,Fe=this.shx,tt=this.sy,mt=this.tx,Qt=this.ty,jt=Math.sqrt(Q*Q+ue*ue),Dr=(Q/=jt)*Fe+(ue/=jt)*tt;Fe-=Q*Dr,tt-=ue*Dr;var Hr=Math.sqrt(Fe*Fe+tt*tt);return Dr/=Hr,Q*(tt/=Hr)<ue*(Fe/=Hr)&&(Q=-Q,ue=-ue,Dr=-Dr,jt=-jt),{scale:new Ir(jt,0,0,Hr,0,0),translate:new Ir(1,0,0,1,mt,Qt),rotate:new Ir(Q,ue,-ue,Q,0,0),skew:new Ir(1,0,Dr,1,0,0)}},Ir.prototype.toString=function(Q){return this.join(" ")},Ir.prototype.inversed=function(){var Q=this.sx,ue=this.shy,Fe=this.shx,tt=this.sy,mt=this.tx,Qt=this.ty,jt=1/(Q*tt-ue*Fe),Dr=tt*jt,Hr=-ue*jt,Vr=-Fe*jt,gn=Q*jt;return new Ir(Dr,Hr,Vr,gn,-Dr*mt-Vr*Qt,-Hr*mt-gn*Qt)},Ir.prototype.applyToPoint=function(Q){var ue=Q.x*this.sx+Q.y*this.shx+this.tx,Fe=Q.x*this.shy+Q.y*this.sy+this.ty;return new Ll(ue,Fe)},Ir.prototype.applyToRectangle=function(Q){var ue=this.applyToPoint(Q),Fe=this.applyToPoint(new Ll(Q.x+Q.w,Q.y+Q.h));return new No(ue.x,ue.y,Fe.x-ue.x,Fe.y-ue.y)},Ir.prototype.clone=function(){var Q=this.sx,ue=this.shy,Fe=this.shx,tt=this.sy,mt=this.tx,Qt=this.ty;return new Ir(Q,ue,Fe,tt,mt,Qt)},w.Matrix=Ir;var Gn=w.matrixMult=function(Q,ue){return ue.multiply(Q)},ii=new Ir(1,0,0,1,0,0);w.unitMatrix=w.identityMatrix=ii;var On=function(Q,ue){if(!Ge[Q]){var Fe=(ue instanceof Ad?"Sh":"P")+(Object.keys(nt).length+1).toString(10);ue.id=Fe,Ge[Q]=Fe,nt[Fe]=ue,Sr.publish("addPattern",ue)}};w.ShadingPattern=Ad,w.TilingPattern=Jp,w.addShadingPattern=function(Q,ue){return Z("addShadingPattern()"),On(Q,ue),this},w.beginTilingPattern=function(Q){Z("beginTilingPattern()"),Ha(Q.boundingBox[0],Q.boundingBox[1],Q.boundingBox[2]-Q.boundingBox[0],Q.boundingBox[3]-Q.boundingBox[1],Q.matrix)},w.endTilingPattern=function(Q,ue){Z("endTilingPattern()"),ue.stream=Yt[Be].join(`
`),On(Q,ue),Sr.publish("endTilingPattern",ue),fn.pop().restore()};var pn,ln=w.__private__.newObject=function(){var Q=Ot();return vn(Q,!0),Q},Ot=w.__private__.newObjectDeferred=function(){return rt++,it[rt]=function(){return Bt},rt},vn=function(Q,ue){return ue=typeof ue=="boolean"&&ue,it[Q]=Bt,ue&&Re(Q+" 0 obj"),Q},wi=w.__private__.newAdditionalObject=function(){var Q={objId:Ot(),content:""};return Dt.push(Q),Q},Qs=Ot(),Un=Ot(),er=w.__private__.decodeColorString=function(Q){var ue=Q.split(" ");if(ue.length!==2||ue[1]!=="g"&&ue[1]!=="G")ue.length!==5||ue[4]!=="k"&&ue[4]!=="K"||(ue=[(1-ue[0])*(1-ue[3]),(1-ue[1])*(1-ue[3]),(1-ue[2])*(1-ue[3]),"r"]);else{var Fe=parseFloat(ue[0]);ue=[Fe,Fe,Fe,"r"]}for(var tt="#",mt=0;mt<3;mt++)tt+=("0"+Math.floor(255*parseFloat(ue[mt])).toString(16)).slice(-2);return tt},Xr=w.__private__.encodeColorString=function(Q){var ue;typeof Q=="string"&&(Q={ch1:Q});var Fe=Q.ch1,tt=Q.ch2,mt=Q.ch3,Qt=Q.ch4,jt=Q.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof Fe=="string"&&Fe.charAt(0)!=="#"){var Dr=new FU(Fe);if(Dr.ok)Fe=Dr.toHex();else if(!/^\d*\.?\d*$/.test(Fe))throw new Error('Invalid color "'+Fe+'" passed to jsPDF.encodeColorString.')}if(typeof Fe=="string"&&/^#[0-9A-Fa-f]{3}$/.test(Fe)&&(Fe="#"+Fe[1]+Fe[1]+Fe[2]+Fe[2]+Fe[3]+Fe[3]),typeof Fe=="string"&&/^#[0-9A-Fa-f]{6}$/.test(Fe)){var Hr=parseInt(Fe.substr(1),16);Fe=Hr>>16&255,tt=Hr>>8&255,mt=255&Hr}if(tt===void 0||Qt===void 0&&Fe===tt&&tt===mt)ue=typeof Fe=="string"?Fe+" "+jt[0]:Q.precision===2?te(Fe/255)+" "+jt[0]:ce(Fe/255)+" "+jt[0];else if(Qt===void 0||ni(Qt)==="object"){if(Qt&&!isNaN(Qt.a)&&Qt.a===0)return["1.","1.","1.",jt[1]].join(" ");ue=typeof Fe=="string"?[Fe,tt,mt,jt[1]].join(" "):Q.precision===2?[te(Fe/255),te(tt/255),te(mt/255),jt[1]].join(" "):[ce(Fe/255),ce(tt/255),ce(mt/255),jt[1]].join(" ")}else ue=typeof Fe=="string"?[Fe,tt,mt,Qt,jt[2]].join(" "):Q.precision===2?[te(Fe),te(tt),te(mt),te(Qt),jt[2]].join(" "):[ce(Fe),ce(tt),ce(mt),ce(Qt),jt[2]].join(" ");return ue},Zr=w.__private__.getFilters=function(){return a},yi=w.__private__.putStream=function(Q){var ue=(Q=Q||{}).data||"",Fe=Q.filters||Zr(),tt=Q.alreadyAppliedFilters||[],mt=Q.addLength1||!1,Qt=ue.length,jt=Q.objectId,Dr=function(Bi){return Bi};if(p!==null&&jt===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");p!==null&&(Dr=Vi.encryptor(jt,0));var Hr={};Fe===!0&&(Fe=["FlateEncode"]);var Vr=Q.additionalKeyValues||[],gn=(Hr=Jr.API.processDataByFilters!==void 0?Jr.API.processDataByFilters(ue,Fe):{data:ue,reverseChain:[]}).reverseChain+(Array.isArray(tt)?tt.join(" "):tt.toString());if(Hr.data.length!==0&&(Vr.push({key:"Length",value:Hr.data.length}),mt===!0&&Vr.push({key:"Length1",value:Qt})),gn.length!=0)if(gn.split("/").length-1==1)Vr.push({key:"Filter",value:gn});else{Vr.push({key:"Filter",value:"["+gn+"]"});for(var dn=0;dn<Vr.length;dn+=1)if(Vr[dn].key==="DecodeParms"){for(var ei=[],ji=0;ji<Hr.reverseChain.split("/").length-1;ji+=1)ei.push("null");ei.push(Vr[dn].value),Vr[dn].value="["+ei.join(" ")+"]"}}Re("<<");for(var ti=0;ti<Vr.length;ti++)Re("/"+Vr[ti].key+" "+Vr[ti].value);Re(">>"),Hr.data.length!==0&&(Re("stream"),Re(Dr(Hr.data)),Re("endstream"))},Xo=w.__private__.putPage=function(Q){var ue=Q.number,Fe=Q.data,tt=Q.objId,mt=Q.contentsObjId;vn(tt,!0),Re("<</Type /Page"),Re("/Parent "+Q.rootDictionaryObjId+" 0 R"),Re("/Resources "+Q.resourceDictionaryObjId+" 0 R"),Re("/MediaBox ["+parseFloat(se(Q.mediaBox.bottomLeftX))+" "+parseFloat(se(Q.mediaBox.bottomLeftY))+" "+se(Q.mediaBox.topRightX)+" "+se(Q.mediaBox.topRightY)+"]"),Q.cropBox!==null&&Re("/CropBox ["+se(Q.cropBox.bottomLeftX)+" "+se(Q.cropBox.bottomLeftY)+" "+se(Q.cropBox.topRightX)+" "+se(Q.cropBox.topRightY)+"]"),Q.bleedBox!==null&&Re("/BleedBox ["+se(Q.bleedBox.bottomLeftX)+" "+se(Q.bleedBox.bottomLeftY)+" "+se(Q.bleedBox.topRightX)+" "+se(Q.bleedBox.topRightY)+"]"),Q.trimBox!==null&&Re("/TrimBox ["+se(Q.trimBox.bottomLeftX)+" "+se(Q.trimBox.bottomLeftY)+" "+se(Q.trimBox.topRightX)+" "+se(Q.trimBox.topRightY)+"]"),Q.artBox!==null&&Re("/ArtBox ["+se(Q.artBox.bottomLeftX)+" "+se(Q.artBox.bottomLeftY)+" "+se(Q.artBox.topRightX)+" "+se(Q.artBox.topRightY)+"]"),typeof Q.userUnit=="number"&&Q.userUnit!==1&&Re("/UserUnit "+Q.userUnit),Sr.publish("putPage",{objId:tt,pageContext:Ze[ue],pageNumber:ue,page:Fe}),Re("/Contents "+mt+" 0 R"),Re(">>"),Re("endobj");var Qt=Fe.join(`
`);return N===H&&(Qt+=`
Q`),vn(mt,!0),yi({data:Qt,filters:Zr(),objectId:mt}),Re("endobj"),tt},Ke=w.__private__.putPages=function(){var Q,ue,Fe=[];for(Q=1;Q<=Wt;Q++)Ze[Q].objId=Ot(),Ze[Q].contentsObjId=Ot();for(Q=1;Q<=Wt;Q++)Fe.push(Xo({number:Q,data:Yt[Q],objId:Ze[Q].objId,contentsObjId:Ze[Q].contentsObjId,mediaBox:Ze[Q].mediaBox,cropBox:Ze[Q].cropBox,bleedBox:Ze[Q].bleedBox,trimBox:Ze[Q].trimBox,artBox:Ze[Q].artBox,userUnit:Ze[Q].userUnit,rootDictionaryObjId:Qs,resourceDictionaryObjId:Un}));vn(Qs,!0),Re("<</Type /Pages");var tt="/Kids [";for(ue=0;ue<Wt;ue++)tt+=Fe[ue]+" 0 R ";Re(tt+"]"),Re("/Count "+Wt),Re(">>"),Re("endobj"),Sr.publish("postPutPages")},Vt=function(Q){Sr.publish("putFont",{font:Q,out:Re,newObject:ln,putStream:yi}),Q.isAlreadyPutted!==!0&&(Q.objectNumber=ln(),Re("<<"),Re("/Type /Font"),Re("/BaseFont /"+Zp(Q.postScriptName)),Re("/Subtype /Type1"),typeof Q.encoding=="string"&&Re("/Encoding /"+Q.encoding),Re("/FirstChar 32"),Re("/LastChar 255"),Re(">>"),Re("endobj"))},Ar=function(Q){Q.objectNumber=ln();var ue=[];ue.push({key:"Type",value:"/XObject"}),ue.push({key:"Subtype",value:"/Form"}),ue.push({key:"BBox",value:"["+[se(Q.x),se(Q.y),se(Q.x+Q.width),se(Q.y+Q.height)].join(" ")+"]"}),ue.push({key:"Matrix",value:"["+Q.matrix.toString()+"]"});var Fe=Q.pages[1].join(`
`);yi({data:Fe,additionalKeyValues:ue,objectId:Q.objectNumber}),Re("endobj")},xn=function(Q,ue){ue||(ue=21);var Fe=ln(),tt=function(jt,Dr){var Hr,Vr=[],gn=1/(Dr-1);for(Hr=0;Hr<1;Hr+=gn)Vr.push(Hr);if(Vr.push(1),jt[0].offset!=0){var dn={offset:0,color:jt[0].color};jt.unshift(dn)}if(jt[jt.length-1].offset!=1){var ei={offset:1,color:jt[jt.length-1].color};jt.push(ei)}for(var ji="",ti=0,Bi=0;Bi<Vr.length;Bi++){for(Hr=Vr[Bi];Hr>jt[ti+1].offset;)ti++;var ki=jt[ti].offset,ls=(Hr-ki)/(jt[ti+1].offset-ki),fs=jt[ti].color,Ul=jt[ti+1].color;ji+=He(Math.round((1-ls)*fs[0]+ls*Ul[0]).toString(16))+He(Math.round((1-ls)*fs[1]+ls*Ul[1]).toString(16))+He(Math.round((1-ls)*fs[2]+ls*Ul[2]).toString(16))}return ji.trim()}(Q.colors,ue),mt=[];mt.push({key:"FunctionType",value:"0"}),mt.push({key:"Domain",value:"[0.0 1.0]"}),mt.push({key:"Size",value:"["+ue+"]"}),mt.push({key:"BitsPerSample",value:"8"}),mt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),mt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),yi({data:tt,additionalKeyValues:mt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:Fe}),Re("endobj"),Q.objectNumber=ln(),Re("<< /ShadingType "+Q.type),Re("/ColorSpace /DeviceRGB");var Qt="/Coords ["+se(parseFloat(Q.coords[0]))+" "+se(parseFloat(Q.coords[1]))+" ";Q.type===2?Qt+=se(parseFloat(Q.coords[2]))+" "+se(parseFloat(Q.coords[3])):Qt+=se(parseFloat(Q.coords[2]))+" "+se(parseFloat(Q.coords[3]))+" "+se(parseFloat(Q.coords[4]))+" "+se(parseFloat(Q.coords[5])),Re(Qt+="]"),Q.matrix&&Re("/Matrix ["+Q.matrix.toString()+"]"),Re("/Function "+Fe+" 0 R"),Re("/Extend [true true]"),Re(">>"),Re("endobj")},Jn=function(Q,ue){var Fe=Ot(),tt=ln();ue.push({resourcesOid:Fe,objectOid:tt}),Q.objectNumber=tt;var mt=[];mt.push({key:"Type",value:"/Pattern"}),mt.push({key:"PatternType",value:"1"}),mt.push({key:"PaintType",value:"1"}),mt.push({key:"TilingType",value:"1"}),mt.push({key:"BBox",value:"["+Q.boundingBox.map(se).join(" ")+"]"}),mt.push({key:"XStep",value:se(Q.xStep)}),mt.push({key:"YStep",value:se(Q.yStep)}),mt.push({key:"Resources",value:Fe+" 0 R"}),Q.matrix&&mt.push({key:"Matrix",value:"["+Q.matrix.toString()+"]"}),yi({data:Q.stream,additionalKeyValues:mt,objectId:Q.objectNumber}),Re("endobj")},Wn=function(Q){for(var ue in Q.objectNumber=ln(),Re("<<"),Q)switch(ue){case"opacity":Re("/ca "+te(Q[ue]));break;case"stroke-opacity":Re("/CA "+te(Q[ue]))}Re(">>"),Re("endobj")},Xi=function(Q){vn(Q.resourcesOid,!0),Re("<<"),Re("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var ue in Re("/Font <<"),xe)xe.hasOwnProperty(ue)&&(b===!1||b===!0&&C.hasOwnProperty(ue))&&Re("/"+ue+" "+xe[ue].objectNumber+" 0 R");Re(">>")}(),function(){if(Object.keys(nt).length>0){for(var ue in Re("/Shading <<"),nt)nt.hasOwnProperty(ue)&&nt[ue]instanceof Ad&&nt[ue].objectNumber>=0&&Re("/"+ue+" "+nt[ue].objectNumber+" 0 R");Sr.publish("putShadingPatternDict"),Re(">>")}}(),function(ue){if(Object.keys(nt).length>0){for(var Fe in Re("/Pattern <<"),nt)nt.hasOwnProperty(Fe)&&nt[Fe]instanceof w.TilingPattern&&nt[Fe].objectNumber>=0&&nt[Fe].objectNumber<ue&&Re("/"+Fe+" "+nt[Fe].objectNumber+" 0 R");Sr.publish("putTilingPatternDict"),Re(">>")}}(Q.objectOid),function(){if(Object.keys(lt).length>0){var ue;for(ue in Re("/ExtGState <<"),lt)lt.hasOwnProperty(ue)&&lt[ue].objectNumber>=0&&Re("/"+ue+" "+lt[ue].objectNumber+" 0 R");Sr.publish("putGStateDict"),Re(">>")}}(),function(){for(var ue in Re("/XObject <<"),yr)yr.hasOwnProperty(ue)&&yr[ue].objectNumber>=0&&Re("/"+ue+" "+yr[ue].objectNumber+" 0 R");Sr.publish("putXobjectDict"),Re(">>")}(),Re(">>"),Re("endobj")},os=function(Q){Me[Q.fontName]=Me[Q.fontName]||{},Me[Q.fontName][Q.fontStyle]=Q.id},Di=function(Q,ue,Fe,tt,mt){var Qt={id:"F"+(Object.keys(xe).length+1).toString(10),postScriptName:Q,fontName:ue,fontStyle:Fe,encoding:tt,isStandardFont:mt||!1,metadata:{}};return Sr.publish("addFont",{font:Qt,instance:this}),xe[Qt.id]=Qt,os(Qt),Qt.id},qn=w.__private__.pdfEscape=w.pdfEscape=function(Q,ue){return function(Fe,tt){var mt,Qt,jt,Dr,Hr,Vr,gn,dn,ei;if(jt=(tt=tt||{}).sourceEncoding||"Unicode",Hr=tt.outputEncoding,(tt.autoencode||Hr)&&xe[wr].metadata&&xe[wr].metadata[jt]&&xe[wr].metadata[jt].encoding&&(Dr=xe[wr].metadata[jt].encoding,!Hr&&xe[wr].encoding&&(Hr=xe[wr].encoding),!Hr&&Dr.codePages&&(Hr=Dr.codePages[0]),typeof Hr=="string"&&(Hr=Dr[Hr]),Hr)){for(gn=!1,Vr=[],mt=0,Qt=Fe.length;mt<Qt;mt++)(dn=Hr[Fe.charCodeAt(mt)])?Vr.push(String.fromCharCode(dn)):Vr.push(Fe[mt]),Vr[mt].charCodeAt(0)>>8&&(gn=!0);Fe=Vr.join("")}for(mt=Fe.length;gn===void 0&&mt!==0;)Fe.charCodeAt(mt-1)>>8&&(gn=!0),mt--;if(!gn)return Fe;for(Vr=tt.noBOM?[]:[254,255],mt=0,Qt=Fe.length;mt<Qt;mt++){if((ei=(dn=Fe.charCodeAt(mt))>>8)>>8)throw new Error("Character at position "+mt+" of string '"+Fe+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Vr.push(ei),Vr.push(dn-(ei<<8))}return String.fromCharCode.apply(void 0,Vr)}(Q,ue).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Nr=w.__private__.beginPage=function(Q){Yt[++Wt]=[],Ze[Wt]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(Q[0]),topRightY:Number(Q[1])}},al(Wt),xt(Yt[Be])},cu=function(Q,ue){var Fe,tt,mt;switch(t=ue||t,typeof Q=="string"&&(Fe=D(Q.toLowerCase()),Array.isArray(Fe)&&(tt=Fe[0],mt=Fe[1])),Array.isArray(Q)&&(tt=Q[0]*Ne,mt=Q[1]*Ne),isNaN(tt)&&(tt=i[0],mt=i[1]),(tt>14400||mt>14400)&&(Ui.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),tt=Math.min(14400,tt),mt=Math.min(14400,mt)),i=[tt,mt],t.substr(0,1)){case"l":mt>tt&&(i=[mt,tt]);break;case"p":tt>mt&&(i=[mt,tt])}Nr(i),as(Fl),Re(dc),Yr!==0&&Re(Yr+" J"),pc!==0&&Re(pc+" j"),Sr.publish("addPage",{pageNumber:Wt})},ma=function(Q){Q>0&&Q<=Wt&&(Yt.splice(Q,1),Ze.splice(Q,1),Wt--,Be>Wt&&(Be=Wt),this.setPage(Be))},al=function(Q){Q>0&&Q<=Wt&&(Be=Q)},Da=w.__private__.getNumberOfPages=w.getNumberOfPages=function(){return Yt.length-1},ka=function(Q,ue,Fe){var tt,mt=void 0;return Fe=Fe||{},Q=Q!==void 0?Q:xe[wr].fontName,ue=ue!==void 0?ue:xe[wr].fontStyle,tt=Q.toLowerCase(),Me[tt]!==void 0&&Me[tt][ue]!==void 0?mt=Me[tt][ue]:Me[Q]!==void 0&&Me[Q][ue]!==void 0?mt=Me[Q][ue]:Fe.disableWarning===!1&&Ui.warn("Unable to look up font label for font '"+Q+"', '"+ue+"'. Refer to getFontList() for available fonts."),mt||Fe.noFallback||(mt=Me.times[ue])==null&&(mt=Me.times.normal),mt},uu=w.__private__.putInfo=function(){var Q=ln(),ue=function(tt){return tt};for(var Fe in p!==null&&(ue=Vi.encryptor(Q,0)),Re("<<"),Re("/Producer ("+qn(ue("jsPDF "+Jr.version))+")"),Cr)Cr.hasOwnProperty(Fe)&&Cr[Fe]&&Re("/"+Fe.substr(0,1).toUpperCase()+Fe.substr(1)+" ("+qn(ue(Cr[Fe]))+")");Re("/CreationDate ("+qn(ue(qe))+")"),Re(">>"),Re("endobj")},eA=w.__private__.putCatalog=function(Q){var ue=(Q=Q||{}).rootDictionaryObjId||Qs;switch(ln(),Re("<<"),Re("/Type /Catalog"),Re("/Pages "+ue+" 0 R"),Br||(Br="fullwidth"),Br){case"fullwidth":Re("/OpenAction [3 0 R /FitH null]");break;case"fullheight":Re("/OpenAction [3 0 R /FitV null]");break;case"fullpage":Re("/OpenAction [3 0 R /Fit]");break;case"original":Re("/OpenAction [3 0 R /XYZ null null 1]");break;default:var Fe=""+Br;Fe.substr(Fe.length-1)==="%"&&(Br=parseInt(Br)/100),typeof Br=="number"&&Re("/OpenAction [3 0 R /XYZ null null "+te(Br)+"]")}switch(ir||(ir="continuous"),ir){case"continuous":Re("/PageLayout /OneColumn");break;case"single":Re("/PageLayout /SinglePage");break;case"two":case"twoleft":Re("/PageLayout /TwoColumnLeft");break;case"tworight":Re("/PageLayout /TwoColumnRight")}vr&&Re("/PageMode /"+vr),Sr.publish("putCatalog"),Re(">>"),Re("endobj")},Yi=w.__private__.putTrailer=function(){Re("trailer"),Re("<<"),Re("/Size "+(rt+1)),Re("/Root "+rt+" 0 R"),Re("/Info "+(rt-1)+" 0 R"),p!==null&&Re("/Encrypt "+Vi.oid+" 0 R"),Re("/ID [ <"+ot+"> <"+ot+"> ]"),Re(">>")},ll=w.__private__.putHeader=function(){Re("%PDF-"+M),Re("%ºß¬à")},tA=w.__private__.putXRef=function(){var Q="0000000000";Re("xref"),Re("0 "+(rt+1)),Re("0000000000 65535 f ");for(var ue=1;ue<=rt;ue++)typeof it[ue]=="function"?Re((Q+it[ue]()).slice(-10)+" 00000 n "):it[ue]!==void 0?Re((Q+it[ue]).slice(-10)+" 00000 n "):Re("0000000000 00000 n ")},Pl=w.__private__.buildDocument=function(){var Q;rt=0,Bt=0,Pt=[],it=[],Dt=[],Qs=Ot(),Un=Ot(),xt(Pt),Sr.publish("buildDocument"),ll(),Ke(),function(){Sr.publish("putAdditionalObjects");for(var Fe=0;Fe<Dt.length;Fe++){var tt=Dt[Fe];vn(tt.objId,!0),Re(tt.content),Re("endobj")}Sr.publish("postPutAdditionalObjects")}(),Q=[],function(){for(var Fe in xe)xe.hasOwnProperty(Fe)&&(b===!1||b===!0&&C.hasOwnProperty(Fe))&&Vt(xe[Fe])}(),function(){var Fe;for(Fe in lt)lt.hasOwnProperty(Fe)&&Wn(lt[Fe])}(),function(){for(var Fe in yr)yr.hasOwnProperty(Fe)&&Ar(yr[Fe])}(),function(Fe){var tt;for(tt in nt)nt.hasOwnProperty(tt)&&(nt[tt]instanceof Ad?xn(nt[tt]):nt[tt]instanceof Jp&&Jn(nt[tt],Fe))}(Q),Sr.publish("putResources"),Q.forEach(Xi),Xi({resourcesOid:Un,objectOid:Number.MAX_SAFE_INTEGER}),Sr.publish("postPutResources"),p!==null&&(Vi.oid=ln(),Re("<<"),Re("/Filter /Standard"),Re("/V "+Vi.v),Re("/R "+Vi.r),Re("/U <"+Vi.toHexString(Vi.U)+">"),Re("/O <"+Vi.toHexString(Vi.O)+">"),Re("/P "+Vi.P),Re(">>"),Re("endobj")),uu(),eA();var ue=Bt;return tA(),Yi(),Re("startxref"),Re(""+ue),Re("%%EOF"),xt(Yt[Be]),Pt.join(`
`)},hu=w.__private__.getBlob=function(Q){return new Blob([Ur(Q)],{type:"application/pdf"})},Na=w.output=w.__private__.output=(pn=function(Q,ue){switch(typeof(ue=ue||{})=="string"?ue={filename:ue}:ue.filename=ue.filename||"generated.pdf",Q){case void 0:return Pl();case"save":w.save(ue.filename);break;case"arraybuffer":return Ur(Pl());case"blob":return hu(Pl());case"bloburi":case"bloburl":if(yn.URL!==void 0&&typeof yn.URL.createObjectURL=="function")return yn.URL&&yn.URL.createObjectURL(hu(Pl()))||void 0;Ui.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var Fe="",tt=Pl();try{Fe=RU(tt)}catch{Fe=RU(unescape(encodeURIComponent(tt)))}return"data:application/pdf;filename="+ue.filename+";base64,"+Fe;case"pdfobjectnewwindow":if(Object.prototype.toString.call(yn)==="[object Window]"){var mt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Qt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';ue.pdfObjectUrl&&(mt=ue.pdfObjectUrl,Qt="");var jt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+mt+'"'+Qt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(ue)+");<\/script></body></html>",Dr=yn.open();return Dr!==null&&Dr.document.write(jt),Dr}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(yn)==="[object Window]"){var Hr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(ue.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+ue.filename+'" width="500px" height="400px" /></body></html>',Vr=yn.open();if(Vr!==null){Vr.document.write(Hr);var gn=this;Vr.document.documentElement.querySelector("#pdfViewer").onload=function(){Vr.document.title=ue.filename,Vr.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(gn.output("bloburl"))}}return Vr}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(yn)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var dn='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",ue)+'"></iframe></body></html>',ei=yn.open();if(ei!==null&&(ei.document.write(dn),ei.document.title=ue.filename),ei||typeof safari>"u")return ei;break;case"datauri":case"dataurl":return yn.document.location.href=this.output("datauristring",ue);default:return null}},pn.foo=function(){try{return pn.apply(this,arguments)}catch(Fe){var Q=Fe.stack||"";~Q.indexOf(" at ")&&(Q=Q.split(" at ")[1]);var ue="Error in function "+Q.split(`
`)[0].split("<")[0]+": "+Fe.message;if(!yn.console)throw new Error(ue);yn.console.error(ue,Fe),yn.alert&&alert(ue)}},pn.foo.bar=pn,pn.foo),cc=function(Q){return Array.isArray(an)===!0&&an.indexOf(Q)>-1};switch(n){case"pt":Ne=1;break;case"mm":Ne=72/25.4;break;case"cm":Ne=72/2.54;break;case"in":Ne=72;break;case"px":Ne=cc("px_scaling")==1?.75:96/72;break;case"pc":case"em":Ne=12;break;case"ex":Ne=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);Ne=n}var Vi=null;ht(),Ye();var Au=w.__private__.getPageInfo=w.getPageInfo=function(Q){if(isNaN(Q)||Q%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:Ze[Q].objId,pageNumber:Q,pageContext:Ze[Q]}},th=w.__private__.getPageInfoByObjId=function(Q){if(isNaN(Q)||Q%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var ue in Ze)if(Ze[ue].objId===Q)break;return Au(ue)},uc=w.__private__.getCurrentPageInfo=w.getCurrentPageInfo=function(){return{objId:Ze[Be].objId,pageNumber:Be,pageContext:Ze[Be]}};w.addPage=function(){return cu.apply(this,arguments),this},w.setPage=function(){return al.apply(this,arguments),xt.call(this,Yt[Be]),this},w.insertPage=function(Q){return this.addPage(),this.movePage(Be,Q),this},w.movePage=function(Q,ue){var Fe,tt;if(Q>ue){Fe=Yt[Q],tt=Ze[Q];for(var mt=Q;mt>ue;mt--)Yt[mt]=Yt[mt-1],Ze[mt]=Ze[mt-1];Yt[ue]=Fe,Ze[ue]=tt,this.setPage(ue)}else if(Q<ue){Fe=Yt[Q],tt=Ze[Q];for(var Qt=Q;Qt<ue;Qt++)Yt[Qt]=Yt[Qt+1],Ze[Qt]=Ze[Qt+1];Yt[ue]=Fe,Ze[ue]=tt,this.setPage(ue)}return this},w.deletePage=function(){return ma.apply(this,arguments),this},w.__private__.text=w.text=function(Q,ue,Fe,tt,mt){var Qt,jt,Dr,Hr,Vr,gn,dn,ei,ji,ti=(tt=tt||{}).scope||this;if(typeof Q=="number"&&typeof ue=="number"&&(typeof Fe=="string"||Array.isArray(Fe))){var Bi=Fe;Fe=ue,ue=Q,Q=Bi}if(arguments[3]instanceof Ir==0?(Dr=arguments[4],Hr=arguments[5],ni(dn=arguments[3])==="object"&&dn!==null||(typeof Dr=="string"&&(Hr=Dr,Dr=null),typeof dn=="string"&&(Hr=dn,dn=null),typeof dn=="number"&&(Dr=dn,dn=null),tt={flags:dn,angle:Dr,align:Hr})):(Z("The transform parameter of text() with a Matrix value"),ji=mt),isNaN(ue)||isNaN(Fe)||Q==null)throw new Error("Invalid arguments passed to jsPDF.text");if(Q.length===0)return ti;var ki,ls="",fs=typeof tt.lineHeightFactor=="number"?tt.lineHeightFactor:fc,Ul=ti.internal.scaleFactor;function ih(Ai){return Ai=Ai.split("	").join(Array(tt.TabLen||9).join(" ")),qn(Ai,dn)}function uf(Ai){for(var Gr,fi=Ai.concat(),Ni=[],Ql=fi.length;Ql--;)typeof(Gr=fi.shift())=="string"?Ni.push(Gr):Array.isArray(Ai)&&(Gr.length===1||Gr[1]===void 0&&Gr[2]===void 0)?Ni.push(Gr[0]):Ni.push([Gr[0],Gr[1],Gr[2]]);return Ni}function ba(Ai,Gr){var fi;if(typeof Ai=="string")fi=Gr(Ai)[0];else if(Array.isArray(Ai)){for(var Ni,Ql,lh=Ai.concat(),fl=[],iA=lh.length;iA--;)typeof(Ni=lh.shift())=="string"?fl.push(Gr(Ni)[0]):Array.isArray(Ni)&&typeof Ni[0]=="string"&&(Ql=Gr(Ni[0],Ni[1],Ni[2]),fl.push([Ql[0],Ql[1],Ql[2]]));fi=fl}return fi}var Zo=!1,mc=!0;if(typeof Q=="string")Zo=!0;else if(Array.isArray(Q)){var _c=Q.concat();jt=[];for(var ul,Xn=_c.length;Xn--;)(typeof(ul=_c.shift())!="string"||Array.isArray(ul)&&typeof ul[0]!="string")&&(mc=!1);Zo=mc}if(Zo===!1)throw new Error('Type of text must be string or Array. "'+Q+'" is not recognized.');typeof Q=="string"&&(Q=Q.match(/[\r?\n]/)?Q.split(/\r\n|\r|\n/g):[Q]);var Dl=Kt/ti.internal.scaleFactor,va=Dl*(fs-1);switch(tt.baseline){case"bottom":Fe-=va;break;case"top":Fe+=Dl-va;break;case"hanging":Fe+=Dl-2*va;break;case"middle":Fe+=Dl/2-va}if((gn=tt.maxWidth||0)>0&&(typeof Q=="string"?Q=ti.splitTextToSize(Q,gn):Object.prototype.toString.call(Q)==="[object Array]"&&(Q=Q.reduce(function(Ai,Gr){return Ai.concat(ti.splitTextToSize(Gr,gn))},[]))),Qt={text:Q,x:ue,y:Fe,options:tt,mutex:{pdfEscape:qn,activeFontKey:wr,fonts:xe,activeFontSize:Kt}},Sr.publish("preProcessText",Qt),Q=Qt.text,Dr=(tt=Qt.options).angle,ji instanceof Ir==0&&Dr&&typeof Dr=="number"){Dr*=Math.PI/180,tt.rotationDirection===0&&(Dr=-Dr),N===H&&(Dr=-Dr);var ja=Math.cos(Dr),kl=Math.sin(Dr);ji=new Ir(ja,kl,-kl,ja,0,0)}else Dr&&Dr instanceof Ir&&(ji=Dr);N!==H||ji||(ji=ii),(Vr=tt.charSpace||ko)!==void 0&&(ls+=se(ve(Vr))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(ei=tt.horizontalScale)!==void 0&&(ls+=se(100*ei)+` Tz
`),tt.lang;var so=-1,fu=tt.renderingMode!==void 0?tt.renderingMode:tt.stroke,sh=ti.internal.getCurrentPageInfo().pageContext;switch(fu){case 0:case!1:case"fill":so=0;break;case 1:case!0:case"stroke":so=1;break;case 2:case"fillThenStroke":so=2;break;case 3:case"invisible":so=3;break;case 4:case"fillAndAddForClipping":so=4;break;case 5:case"strokeAndAddPathForClipping":so=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":so=6;break;case 7:case"addToPathForClipping":so=7}var Nl=sh.usedRenderingMode!==void 0?sh.usedRenderingMode:-1;so!==-1?ls+=so+` Tr
`:Nl!==-1&&(ls+=`0 Tr
`),so!==-1&&(sh.usedRenderingMode=so),Hr=tt.align||"left";var Is,Jo=Kt*fs,oh=ti.internal.pageSize.getWidth(),du=xe[wr];Vr=tt.charSpace||ko,gn=tt.maxWidth||0,dn=Object.assign({autoencode:!0,noBOM:!0},tt.flags);var $a=[],pu=function(Ai){return ti.getStringUnitWidth(Ai,{font:du,charSpace:Vr,fontSize:Kt,doKerning:!1})*Kt/Ul};if(Object.prototype.toString.call(Q)==="[object Array]"){var wo;jt=uf(Q),Hr!=="left"&&(Is=jt.map(pu));var xo,yc=0;if(Hr==="right"){ue-=Is[0],Q=[],Xn=jt.length;for(var ds=0;ds<Xn;ds++)ds===0?(xo=Rl(ue),wo=xi(Fe)):(xo=ve(yc-Is[ds]),wo=-Jo),Q.push([jt[ds],xo,wo]),yc=Is[ds]}else if(Hr==="center"){ue-=Is[0]/2,Q=[],Xn=jt.length;for(var zl=0;zl<Xn;zl++)zl===0?(xo=Rl(ue),wo=xi(Fe)):(xo=ve((yc-Is[zl])/2),wo=-Jo),Q.push([jt[zl],xo,wo]),yc=Is[zl]}else if(Hr==="left"){Q=[],Xn=jt.length;for(var ah=0;ah<Xn;ah++)Q.push(jt[ah])}else if(Hr==="justify"&&du.encoding==="Identity-H"){Q=[],Xn=jt.length,gn=gn!==0?gn:oh;for(var wa=0,Ji=0;Ji<Xn;Ji++)if(wo=Ji===0?xi(Fe):-Jo,xo=Ji===0?Rl(ue):wa,Ji<Xn-1){var bc=ve((gn-Is[Ji])/(jt[Ji].split(" ").length-1)),Ga=jt[Ji].split(" ");Q.push([Ga[0]+" ",xo,wo]),wa=0;for(var hl=1;hl<Ga.length;hl++){var gu=(pu(Ga[hl-1]+" "+Ga[hl])-pu(Ga[hl]))*Ul+bc;hl==Ga.length-1?Q.push([Ga[hl],gu,0]):Q.push([Ga[hl]+" ",gu,0]),wa-=gu}}else Q.push([jt[Ji],xo,wo]);Q.push(["",wa,0])}else{if(Hr!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(Q=[],Xn=jt.length,gn=gn!==0?gn:oh,Ji=0;Ji<Xn;Ji++)wo=Ji===0?xi(Fe):-Jo,xo=Ji===0?Rl(ue):0,Ji<Xn-1?$a.push(se(ve((gn-Is[Ji])/(jt[Ji].split(" ").length-1)))):$a.push(0),Q.push([jt[Ji],xo,wo])}}(typeof tt.R2L=="boolean"?tt.R2L:Lr)===!0&&(Q=ba(Q,function(Ai,Gr,fi){return[Ai.split("").reverse().join(""),Gr,fi]})),Qt={text:Q,x:ue,y:Fe,options:tt,mutex:{pdfEscape:qn,activeFontKey:wr,fonts:xe,activeFontSize:Kt}},Sr.publish("postProcessText",Qt),Q=Qt.text,ki=Qt.mutex.isHex||!1;var mu=xe[wr].encoding;mu!=="WinAnsiEncoding"&&mu!=="StandardEncoding"||(Q=ba(Q,function(Ai,Gr,fi){return[ih(Ai),Gr,fi]})),jt=uf(Q),Q=[];for(var vc,wc,xc,Al=Array.isArray(jt[0])?1:0,Ps="",_u=function(Ai,Gr,fi){var Ni="";return fi instanceof Ir?(fi=typeof tt.angle=="number"?Gn(fi,new Ir(1,0,0,1,Ai,Gr)):Gn(new Ir(1,0,0,1,Ai,Gr),fi),N===H&&(fi=Gn(new Ir(1,0,0,-1,0,0),fi)),Ni=fi.join(" ")+` Tm
`):Ni=se(Ai)+" "+se(Gr)+` Td
`,Ni},Bo=0;Bo<jt.length;Bo++){switch(Ps="",Al){case 1:xc=(ki?"<":"(")+jt[Bo][0]+(ki?">":")"),vc=parseFloat(jt[Bo][1]),wc=parseFloat(jt[Bo][2]);break;case 0:xc=(ki?"<":"(")+jt[Bo]+(ki?">":")"),vc=Rl(ue),wc=xi(Fe)}$a!==void 0&&$a[Bo]!==void 0&&(Ps=$a[Bo]+` Tw
`),Bo===0?Q.push(Ps+_u(vc,wc,ji)+xc):Al===0?Q.push(Ps+xc):Al===1&&Q.push(Ps+_u(vc,wc,ji)+xc)}Q=Al===0?Q.join(` Tj
T* `):Q.join(` Tj
`),Q+=` Tj
`;var xa=`BT
/`;return xa+=wr+" "+Kt+` Tf
`,xa+=se(Kt*fs)+` TL
`,xa+=Kn+`
`,xa+=ls,xa+=Q,Re(xa+="ET"),C[wr]=!0,ti};var rA=w.__private__.clip=w.clip=function(Q){return Re(Q==="evenodd"?"W*":"W"),this};w.clipEvenOdd=function(){return rA("evenodd")},w.__private__.discardPath=w.discardPath=function(){return Re("n"),this};var _a=w.__private__.isValidStyle=function(Q){var ue=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(Q)!==-1&&(ue=!0),ue};w.__private__.setDefaultPathOperation=w.setDefaultPathOperation=function(Q){return _a(Q)&&(d=Q),this};var hc=w.__private__.getStyle=w.getStyle=function(Q){var ue=d;switch(Q){case"D":case"S":ue="S";break;case"F":ue="f";break;case"FD":case"DF":ue="B";break;case"f":case"f*":case"B":case"B*":ue=Q}return ue},Ac=w.close=function(){return Re("h"),this};w.stroke=function(){return Re("S"),this},w.fill=function(Q){return za("f",Q),this},w.fillEvenOdd=function(Q){return za("f*",Q),this},w.fillStroke=function(Q){return za("B",Q),this},w.fillStrokeEvenOdd=function(Q){return za("B*",Q),this};var za=function(Q,ue){ni(ue)==="object"?nA(ue,Q):Re(Q)},rh=function(Q){Q===null||N===H&&Q===void 0||(Q=hc(Q),Re(Q))};function Ml(Q,ue,Fe,tt,mt){var Qt=new Jp(ue||this.boundingBox,Fe||this.xStep,tt||this.yStep,this.gState,mt||this.matrix);Qt.stream=this.stream;var jt=Q+"$$"+this.cloneIndex+++"$$";return On(jt,Qt),Qt}var nA=function(Q,ue){var Fe=Ge[Q.key],tt=nt[Fe];if(tt instanceof Ad)Re("q"),Re(ya(ue)),tt.gState&&w.setGState(tt.gState),Re(Q.matrix.toString()+" cm"),Re("/"+Fe+" sh"),Re("Q");else if(tt instanceof Jp){var mt=new Ir(1,0,0,-1,0,io());Q.matrix&&(mt=mt.multiply(Q.matrix||ii),Fe=Ml.call(tt,Q.key,Q.boundingBox,Q.xStep,Q.yStep,mt).id),Re("q"),Re("/Pattern cs"),Re("/"+Fe+" scn"),tt.gState&&w.setGState(tt.gState),Re(ue),Re("Q")}},ya=function(Q){switch(Q){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},hn=w.moveTo=function(Q,ue){return Re(se(ve(Q))+" "+se(me(ue))+" m"),this},Hs=w.lineTo=function(Q,ue){return Re(se(ve(Q))+" "+se(me(ue))+" l"),this},en=w.curveTo=function(Q,ue,Fe,tt,mt,Qt){return Re([se(ve(Q)),se(me(ue)),se(ve(Fe)),se(me(tt)),se(ve(mt)),se(me(Qt)),"c"].join(" ")),this};w.__private__.line=w.line=function(Q,ue,Fe,tt,mt){if(isNaN(Q)||isNaN(ue)||isNaN(Fe)||isNaN(tt)||!_a(mt))throw new Error("Invalid arguments passed to jsPDF.line");return N===j?this.lines([[Fe-Q,tt-ue]],Q,ue,[1,1],mt||"S"):this.lines([[Fe-Q,tt-ue]],Q,ue,[1,1]).stroke()},w.__private__.lines=w.lines=function(Q,ue,Fe,tt,mt,Qt){var jt,Dr,Hr,Vr,gn,dn,ei,ji,ti,Bi,ki,ls;if(typeof Q=="number"&&(ls=Fe,Fe=ue,ue=Q,Q=ls),tt=tt||[1,1],Qt=Qt||!1,isNaN(ue)||isNaN(Fe)||!Array.isArray(Q)||!Array.isArray(tt)||!_a(mt)||typeof Qt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(hn(ue,Fe),jt=tt[0],Dr=tt[1],Vr=Q.length,Bi=ue,ki=Fe,Hr=0;Hr<Vr;Hr++)(gn=Q[Hr]).length===2?(Bi=gn[0]*jt+Bi,ki=gn[1]*Dr+ki,Hs(Bi,ki)):(dn=gn[0]*jt+Bi,ei=gn[1]*Dr+ki,ji=gn[2]*jt+Bi,ti=gn[3]*Dr+ki,Bi=gn[4]*jt+Bi,ki=gn[5]*Dr+ki,en(dn,ei,ji,ti,Bi,ki));return Qt&&Ac(),rh(mt),this},w.path=function(Q){for(var ue=0;ue<Q.length;ue++){var Fe=Q[ue],tt=Fe.c;switch(Fe.op){case"m":hn(tt[0],tt[1]);break;case"l":Hs(tt[0],tt[1]);break;case"c":en.apply(this,tt);break;case"h":Ac()}}return this},w.__private__.rect=w.rect=function(Q,ue,Fe,tt,mt){if(isNaN(Q)||isNaN(ue)||isNaN(Fe)||isNaN(tt)||!_a(mt))throw new Error("Invalid arguments passed to jsPDF.rect");return N===j&&(tt=-tt),Re([se(ve(Q)),se(me(ue)),se(ve(Fe)),se(ve(tt)),"re"].join(" ")),rh(mt),this},w.__private__.triangle=w.triangle=function(Q,ue,Fe,tt,mt,Qt,jt){if(isNaN(Q)||isNaN(ue)||isNaN(Fe)||isNaN(tt)||isNaN(mt)||isNaN(Qt)||!_a(jt))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[Fe-Q,tt-ue],[mt-Fe,Qt-tt],[Q-mt,ue-Qt]],Q,ue,[1,1],jt,!0),this},w.__private__.roundedRect=w.roundedRect=function(Q,ue,Fe,tt,mt,Qt,jt){if(isNaN(Q)||isNaN(ue)||isNaN(Fe)||isNaN(tt)||isNaN(mt)||isNaN(Qt)||!_a(jt))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Dr=4/3*(Math.SQRT2-1);return mt=Math.min(mt,.5*Fe),Qt=Math.min(Qt,.5*tt),this.lines([[Fe-2*mt,0],[mt*Dr,0,mt,Qt-Qt*Dr,mt,Qt],[0,tt-2*Qt],[0,Qt*Dr,-mt*Dr,Qt,-mt,Qt],[2*mt-Fe,0],[-mt*Dr,0,-mt,-Qt*Dr,-mt,-Qt],[0,2*Qt-tt],[0,-Qt*Dr,mt*Dr,-Qt,mt,-Qt]],Q+mt,ue,[1,1],jt,!0),this},w.__private__.ellipse=w.ellipse=function(Q,ue,Fe,tt,mt){if(isNaN(Q)||isNaN(ue)||isNaN(Fe)||isNaN(tt)||!_a(mt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Qt=4/3*(Math.SQRT2-1)*Fe,jt=4/3*(Math.SQRT2-1)*tt;return hn(Q+Fe,ue),en(Q+Fe,ue-jt,Q+Qt,ue-tt,Q,ue-tt),en(Q-Qt,ue-tt,Q-Fe,ue-jt,Q-Fe,ue),en(Q-Fe,ue+jt,Q-Qt,ue+tt,Q,ue+tt),en(Q+Qt,ue+tt,Q+Fe,ue+jt,Q+Fe,ue),rh(mt),this},w.__private__.circle=w.circle=function(Q,ue,Fe,tt){if(isNaN(Q)||isNaN(ue)||isNaN(Fe)||!_a(tt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(Q,ue,Fe,Fe,tt)},w.setFont=function(Q,ue,Fe){return Fe&&(ue=ie(ue,Fe)),wr=ka(Q,ue,{disableWarning:!1}),this};var nh=w.__private__.getFont=w.getFont=function(){return xe[ka.apply(w,arguments)]};w.__private__.getFontList=w.getFontList=function(){var Q,ue,Fe={};for(Q in Me)if(Me.hasOwnProperty(Q))for(ue in Fe[Q]=[],Me[Q])Me[Q].hasOwnProperty(ue)&&Fe[Q].push(ue);return Fe},w.addFont=function(Q,ue,Fe,tt,mt){var Qt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Qt.indexOf(arguments[3])!==-1?mt=arguments[3]:arguments[3]&&Qt.indexOf(arguments[3])==-1&&(Fe=ie(Fe,tt)),Di.call(this,Q,ue,Fe,mt=mt||"Identity-H")};var fc,Fl=r.lineWidth||.200025,Qr=w.__private__.getLineWidth=w.getLineWidth=function(){return Fl},as=w.__private__.setLineWidth=w.setLineWidth=function(Q){return Fl=Q,Re(se(ve(Q))+" w"),this};w.__private__.setLineDash=Jr.API.setLineDash=Jr.API.setLineDashPattern=function(Q,ue){if(Q=Q||[],ue=ue||0,isNaN(ue)||!Array.isArray(Q))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return Q=Q.map(function(Fe){return se(ve(Fe))}).join(" "),ue=se(ve(ue)),Re("["+Q+"] "+ue+" d"),this};var Ss=w.__private__.getLineHeight=w.getLineHeight=function(){return Kt*fc};w.__private__.getLineHeight=w.getLineHeight=function(){return Kt*fc};var Zi=w.__private__.setLineHeightFactor=w.setLineHeightFactor=function(Q){return typeof(Q=Q||1.15)=="number"&&(fc=Q),this},si=w.__private__.getLineHeightFactor=w.getLineHeightFactor=function(){return fc};Zi(r.lineHeight);var Rl=w.__private__.getHorizontalCoordinate=function(Q){return ve(Q)},xi=w.__private__.getVerticalCoordinate=function(Q){return N===H?Q:Ze[Be].mediaBox.topRightY-Ze[Be].mediaBox.bottomLeftY-ve(Q)},As=w.__private__.getHorizontalCoordinateString=w.getHorizontalCoordinateString=function(Q){return se(Rl(Q))},no=w.__private__.getVerticalCoordinateString=w.getVerticalCoordinateString=function(Q){return se(xi(Q))},dc=r.strokeColor||"0 G";w.__private__.getStrokeColor=w.getDrawColor=function(){return er(dc)},w.__private__.setStrokeColor=w.setDrawColor=function(Q,ue,Fe,tt){return dc=Xr({ch1:Q,ch2:ue,ch3:Fe,ch4:tt,pdfColorType:"draw",precision:2}),Re(dc),this};var cl=r.fillColor||"0 g";w.__private__.getFillColor=w.getFillColor=function(){return er(cl)},w.__private__.setFillColor=w.setFillColor=function(Q,ue,Fe,tt){return cl=Xr({ch1:Q,ch2:ue,ch3:Fe,ch4:tt,pdfColorType:"fill",precision:2}),Re(cl),this};var Kn=r.textColor||"0 g",kn=w.__private__.getTextColor=w.getTextColor=function(){return er(Kn)};w.__private__.setTextColor=w.setTextColor=function(Q,ue,Fe,tt){return Kn=Xr({ch1:Q,ch2:ue,ch3:Fe,ch4:tt,pdfColorType:"text",precision:3}),this};var ko=r.charSpace,Tn=w.__private__.getCharSpace=w.getCharSpace=function(){return parseFloat(ko||0)};w.__private__.setCharSpace=w.setCharSpace=function(Q){if(isNaN(Q))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return ko=Q,this};var Yr=0;w.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},w.__private__.setLineCap=w.setLineCap=function(Q){var ue=w.CapJoinStyles[Q];if(ue===void 0)throw new Error("Line cap style of '"+Q+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Yr=ue,Re(ue+" J"),this};var pc=0;w.__private__.setLineJoin=w.setLineJoin=function(Q){var ue=w.CapJoinStyles[Q];if(ue===void 0)throw new Error("Line join style of '"+Q+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return pc=ue,Re(ue+" j"),this},w.__private__.setLineMiterLimit=w.__private__.setMiterLimit=w.setLineMiterLimit=w.setMiterLimit=function(Q){if(Q=Q||0,isNaN(Q))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return Re(se(ve(Q))+" M"),this},w.GState=bb,w.setGState=function(Q){(Q=typeof Q=="string"?lt[Lt[Q]]:An(null,Q)).equals(Ft)||(Re("/"+Q.id+" gs"),Ft=Q)};var An=function(Q,ue){if(!Q||!Lt[Q]){var Fe=!1;for(var tt in lt)if(lt.hasOwnProperty(tt)&&lt[tt].equals(ue)){Fe=!0;break}if(Fe)ue=lt[tt];else{var mt="GS"+(Object.keys(lt).length+1).toString(10);lt[mt]=ue,ue.id=mt}return Q&&(Lt[Q]=ue.id),Sr.publish("addGState",ue),ue}};w.addGState=function(Q,ue){return An(Q,ue),this},w.saveGraphicsState=function(){return Re("q"),We.push({key:wr,size:Kt,color:Kn}),this},w.restoreGraphicsState=function(){Re("Q");var Q=We.pop();return wr=Q.key,Kt=Q.size,Kn=Q.color,Ft=null,this},w.setCurrentTransformationMatrix=function(Q){return Re(Q.toString()+" cm"),this},w.comment=function(Q){return Re("#"+Q),this};var Ll=function(Q,ue){var Fe=Q||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return Fe},set:function(Qt){isNaN(Qt)||(Fe=parseFloat(Qt))}});var tt=ue||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return tt},set:function(Qt){isNaN(Qt)||(tt=parseFloat(Qt))}});var mt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return mt},set:function(Qt){mt=Qt.toString()}}),this},No=function(Q,ue,Fe,tt){Ll.call(this,Q,ue),this.type="rect";var mt=Fe||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return mt},set:function(jt){isNaN(jt)||(mt=parseFloat(jt))}});var Qt=tt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Qt},set:function(jt){isNaN(jt)||(Qt=parseFloat(jt))}}),this},Qa=function(){this.page=Wt,this.currentPage=Be,this.pages=Yt.slice(0),this.pagesContext=Ze.slice(0),this.x=re,this.y=ae,this.matrix=ge,this.width=Ol(Be),this.height=io(Be),this.outputDestination=ur,this.id="",this.objectNumber=-1};Qa.prototype.restore=function(){Wt=this.page,Be=this.currentPage,Ze=this.pagesContext,Yt=this.pages,re=this.x,ae=this.y,ge=this.matrix,gc(Be,this.width),Yo(Be,this.height),ur=this.outputDestination};var Ha=function(Q,ue,Fe,tt,mt){fn.push(new Qa),Wt=Be=0,Yt=[],re=Q,ae=ue,ge=mt,Nr([Fe,tt])};for(var Va in w.beginFormObject=function(Q,ue,Fe,tt,mt){return Ha(Q,ue,Fe,tt,mt),this},w.endFormObject=function(Q){return function(ue){if(sn[ue])fn.pop().restore();else{var Fe=new Qa,tt="Xo"+(Object.keys(yr).length+1).toString(10);Fe.id=tt,sn[ue]=tt,yr[tt]=Fe,Sr.publish("addFormObject",Fe),fn.pop().restore()}}(Q),this},w.doFormObject=function(Q,ue){var Fe=yr[sn[Q]];return Re("q"),Re(ue.toString()+" cm"),Re("/"+Fe.id+" Do"),Re("Q"),this},w.getFormObject=function(Q){var ue=yr[sn[Q]];return{x:ue.x,y:ue.y,width:ue.width,height:ue.height,matrix:ue.matrix}},w.save=function(Q,ue){return Q=Q||"generated.pdf",(ue=ue||{}).returnPromise=ue.returnPromise||!1,ue.returnPromise===!1?(hd(hu(Pl()),Q),typeof hd.unload=="function"&&yn.setTimeout&&setTimeout(hd.unload,911),this):new Promise(function(Fe,tt){try{var mt=hd(hu(Pl()),Q);typeof hd.unload=="function"&&yn.setTimeout&&setTimeout(hd.unload,911),Fe(mt)}catch(Qt){tt(Qt.message)}})},Jr.API)Jr.API.hasOwnProperty(Va)&&(Va==="events"&&Jr.API.events.length?function(Q,ue){var Fe,tt,mt;for(mt=ue.length-1;mt!==-1;mt--)Fe=ue[mt][0],tt=ue[mt][1],Q.subscribe.apply(Q,[Fe].concat(typeof tt=="function"?[tt]:tt))}(Sr,Jr.API.events):w[Va]=Jr.API[Va]);var Ol=w.getPageWidth=function(Q){return(Ze[Q=Q||Be].mediaBox.topRightX-Ze[Q].mediaBox.bottomLeftX)/Ne},gc=w.setPageWidth=function(Q,ue){Ze[Q].mediaBox.topRightX=ue*Ne+Ze[Q].mediaBox.bottomLeftX},io=w.getPageHeight=function(Q){return(Ze[Q=Q||Be].mediaBox.topRightY-Ze[Q].mediaBox.bottomLeftY)/Ne},Yo=w.setPageHeight=function(Q,ue){Ze[Q].mediaBox.topRightY=ue*Ne+Ze[Q].mediaBox.bottomLeftY};return w.internal={pdfEscape:qn,getStyle:hc,getFont:nh,getFontSize:ar,getCharSpace:Tn,getTextColor:kn,getLineHeight:Ss,getLineHeightFactor:si,getLineWidth:Qr,write:Kr,getHorizontalCoordinate:Rl,getVerticalCoordinate:xi,getCoordinateString:As,getVerticalCoordinateString:no,collections:{},newObject:ln,newAdditionalObject:wi,newObjectDeferred:Ot,newObjectDeferredBegin:vn,getFilters:Zr,putStream:yi,events:Sr,scaleFactor:Ne,pageSize:{getWidth:function(){return Ol(Be)},setWidth:function(Q){gc(Be,Q)},getHeight:function(){return io(Be)},setHeight:function(Q){Yo(Be,Q)}},encryptionOptions:p,encryption:Vi,getEncryptor:function(Q){return p!==null?Vi.encryptor(Q,0):function(ue){return ue}},output:Na,getNumberOfPages:Da,pages:Yt,out:Re,f2:te,f3:ce,getPageInfo:Au,getPageInfoByObjId:th,getCurrentPageInfo:uc,getPDFVersion:P,Point:Ll,Rectangle:No,Matrix:Ir,hasHotfix:cc},Object.defineProperty(w.internal.pageSize,"width",{get:function(){return Ol(Be)},set:function(Q){gc(Be,Q)},enumerable:!0,configurable:!0}),Object.defineProperty(w.internal.pageSize,"height",{get:function(){return io(Be)},set:function(Q){Yo(Be,Q)},enumerable:!0,configurable:!0}),(function(Q){for(var ue=0,Fe=Er.length;ue<Fe;ue++){var tt=Di.call(this,Q[ue][0],Q[ue][1],Q[ue][2],Er[ue][3],!0);b===!1&&(C[tt]=!0);var mt=Q[ue][0].split("-");os({id:tt,fontName:mt[0],fontStyle:mt[1]||""})}Sr.publish("addFonts",{fonts:xe,dictionary:Me})}).call(w,Er),wr="F1",cu(i,t),Sr.publish("initialized"),w}Yp.prototype.lsbFirstWord=function(r){return String.fromCharCode(255&r,r>>8&255,r>>16&255,r>>24&255)},Yp.prototype.toHexString=function(r){return r.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Yp.prototype.hexToBytes=function(r){for(var e=[],t=0;t<r.length;t+=2)e.push(String.fromCharCode(parseInt(r.substr(t,2),16)));return e.join("")},Yp.prototype.processOwnerPassword=function(r,e){return iC(nC(e).substr(0,5),r)},Yp.prototype.encryptor=function(r,e){var t=nC(this.encryptionKey+String.fromCharCode(255&r,r>>8&255,r>>16&255,255&e,e>>8&255)).substr(0,10);return function(n){return iC(t,n)}},bb.prototype.equals=function(r){var e,t="id,objectNumber,equals";if(!r||ni(r)!==ni(this))return!1;var n=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!r.hasOwnProperty(e)||this[e]!==r[e])return!1;n++}for(e in r)r.hasOwnProperty(e)&&t.indexOf(e)<0&&n--;return n===0},Jr.API={events:[]},Jr.version="3.0.2";var xs=Jr.API,sC=1,fd=function(r){return r.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},eg=function(r){return r.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Cn=function(r){return r.toFixed(2)},qA=function(r){return r.toFixed(5)};xs.__acroform__={};var tl=function(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r},NU=function(r){return r*sC},Gu=function(r){var e=new QU,t=$r.internal.getHeight(r)||0,n=$r.internal.getWidth(r)||0;return e.BBox=[0,0,Number(Cn(n)),Number(Cn(t))],e},lde=xs.__acroform__.setBit=function(r,e){if(r=r||0,e=e||0,isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return r|1<<e},cde=xs.__acroform__.clearBit=function(r,e){if(r=r||0,e=e||0,isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return r&~(1<<e)},ude=xs.__acroform__.getBit=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return r&1<<e?1:0},Ls=xs.__acroform__.getBitForPdf=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return ude(r,e-1)},Os=xs.__acroform__.setBitForPdf=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return lde(r,e-1)},Us=xs.__acroform__.clearBitForPdf=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return cde(r,e-1)},hde=xs.__acroform__.calculateCoordinates=function(r,e){var t=e.internal.getHorizontalCoordinate,n=e.internal.getVerticalCoordinate,i=r[0],s=r[1],a=r[2],o=r[3],u={};return u.lowerLeft_X=t(i)||0,u.lowerLeft_Y=n(s+o)||0,u.upperRight_X=t(i+a)||0,u.upperRight_Y=n(s)||0,[Number(Cn(u.lowerLeft_X)),Number(Cn(u.lowerLeft_Y)),Number(Cn(u.upperRight_X)),Number(Cn(u.upperRight_Y))]},Ade=function(r){if(r.appearanceStreamContent)return r.appearanceStreamContent;if(r.V||r.DV){var e=[],t=r._V||r.DV,n=oC(r,t),i=r.scope.internal.getFont(r.fontName,r.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(r.scope.__private__.encodeColorString(r.color)),e.push("/"+i+" "+Cn(n.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(n.text),e.push("ET"),e.push("Q"),e.push("EMC");var s=Gu(r);return s.scope=r.scope,s.stream=e.join(`
`),s}},oC=function(r,e){var t=r.fontSize===0?r.maxFontSize:r.fontSize,n={text:"",fontSize:""},i=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");i=r.multiline?i.map(function(te){return te.split(`
`)}):i.map(function(te){return[te]});var s=t,a=$r.internal.getHeight(r)||0;a=a<0?-a:a;var o=$r.internal.getWidth(r)||0;o=o<0?-o:o;var u=function(te,ce,ve){if(te+1<i.length){var me=ce+" "+i[te+1][0];return vb(me,r,ve).width<=o-4}return!1};s++;e:for(;s>0;){e="",s--;var d,p,b=vb("3",r,s).height,C=r.multiline?a-s:(a-b)/2,w=C+=2,M=0,P=0,k=0;if(s<=0){e=`(...) Tj
`,e+="% Width of Text: "+vb(e,r,s=12).width+", FieldWidth:"+o+`
`;break}for(var D="",j=0,H=0;H<i.length;H++)if(i.hasOwnProperty(H)){var N=!1;if(i[H].length!==1&&k!==i[H].length-1){if((b+2)*(j+2)+2>a)continue e;D+=i[H][k],N=!0,P=H,H--}else{D=(D+=i[H][k]+" ").substr(D.length-1)==" "?D.substr(0,D.length-1):D;var q=parseInt(H),W=u(q,D,s),ie=H>=i.length-1;if(W&&!ie){D+=" ",k=0;continue}if(W||ie){if(ie)P=q;else if(r.multiline&&(b+2)*(j+2)+2>a)continue e}else{if(!r.multiline||(b+2)*(j+2)+2>a)continue e;P=q}}for(var se="",Z=M;Z<=P;Z++){var fe=i[Z];if(r.multiline){if(Z===P){se+=fe[k]+" ",k=(k+1)%fe.length;continue}if(Z===M){se+=fe[fe.length-1]+" ";continue}}se+=fe[0]+" "}switch(se=se.substr(se.length-1)==" "?se.substr(0,se.length-1):se,p=vb(se,r,s).width,r.textAlign){case"right":d=o-p-2;break;case"center":d=(o-p)/2;break;default:d=2}e+=Cn(d)+" "+Cn(w)+` Td
`,e+="("+fd(se)+`) Tj
`,e+=-Cn(d)+` 0 Td
`,w=-(s+2),p=0,M=N?P:P+1,j++,D=""}break}return n.text=e,n.fontSize=s,n},vb=function(r,e,t){var n=e.scope.internal.getFont(e.fontName,e.fontStyle),i=e.scope.getStringUnitWidth(r,{font:n,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:i}},fde={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},dde=function(r,e){var t={type:"reference",object:r};e.internal.getPageInfo(r.page).pageContext.annotations.find(function(n){return n.type===t.type&&n.object===t.object})===void 0&&e.internal.getPageInfo(r.page).pageContext.annotations.push(t)},pde=function(r,e){if(e.scope=r,r.internal!==void 0&&(r.internal.acroformPlugin===void 0||r.internal.acroformPlugin.isInitialized===!1)){if(Kc.FieldNum=0,r.internal.acroformPlugin=JSON.parse(JSON.stringify(fde)),r.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");sC=r.internal.scaleFactor,r.internal.acroformPlugin.acroFormDictionaryRoot=new HU,r.internal.acroformPlugin.acroFormDictionaryRoot.scope=r,r.internal.acroformPlugin.acroFormDictionaryRoot._eventID=r.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(r)}),r.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var i in n)if(n.hasOwnProperty(i)){var s=n[i];s.objId=void 0,s.hasAnnotation&&dde(s,t)}})(r)}),r.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(r)}),r.internal.events.subscribe("postPutPages",function(t){(function(n,i){var s=!n;for(var a in n||(i.internal.newObjectDeferredBegin(i.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),i.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||i.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(a)){var o=n[a],u=[],d=o.Rect;if(o.Rect&&(o.Rect=hde(o.Rect,i)),i.internal.newObjectDeferredBegin(o.objId,!0),o.DA=$r.createDefaultAppearanceStream(o),ni(o)==="object"&&typeof o.getKeyValueListForStream=="function"&&(u=o.getKeyValueListForStream()),o.Rect=d,o.hasAppearanceStream&&!o.appearanceStreamContent){var p=Ade(o);u.push({key:"AP",value:"<</N "+p+">>"}),i.internal.acroformPlugin.xForms.push(p)}if(o.appearanceStreamContent){var b="";for(var C in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(C)){var w=o.appearanceStreamContent[C];if(b+="/"+C+" ",b+="<<",Object.keys(w).length>=1||Array.isArray(w)){for(var a in w)if(w.hasOwnProperty(a)){var M=w[a];typeof M=="function"&&(M=M.call(i,o)),b+="/"+a+" "+M+" ",i.internal.acroformPlugin.xForms.indexOf(M)>=0||i.internal.acroformPlugin.xForms.push(M)}}else typeof(M=w)=="function"&&(M=M.call(i,o)),b+="/"+a+" "+M,i.internal.acroformPlugin.xForms.indexOf(M)>=0||i.internal.acroformPlugin.xForms.push(M);b+=">>"}u.push({key:"AP",value:`<<
`+b+">>"})}i.internal.putStream({additionalKeyValues:u,objectId:o.objId}),i.internal.out("endobj")}s&&function(P,k){for(var D in P)if(P.hasOwnProperty(D)){var j=D,H=P[D];k.internal.newObjectDeferredBegin(H.objId,!0),ni(H)==="object"&&typeof H.putStream=="function"&&H.putStream(),delete P[j]}}(i.internal.acroformPlugin.xForms,i)})(t,r)}),r.internal.acroformPlugin.isInitialized=!0}},zU=xs.__acroform__.arrayToPdfArray=function(r,e,t){var n=function(a){return a};if(Array.isArray(r)){for(var i="[",s=0;s<r.length;s++)switch(s!==0&&(i+=" "),ni(r[s])){case"boolean":case"number":case"object":i+=r[s].toString();break;case"string":r[s].substr(0,1)!=="/"?(e!==void 0&&t&&(n=t.internal.getEncryptor(e)),i+="("+fd(n(r[s].toString()))+")"):i+=r[s].toString()}return i+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},aC=function(r,e,t){var n=function(i){return i};return e!==void 0&&t&&(n=t.internal.getEncryptor(e)),(r=r||"").toString(),"("+fd(n(r))+")"},Wu=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(r){this._objId=r}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Wu.prototype.toString=function(){return this.objId+" 0 R"},Wu.prototype.putStream=function(){var r=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:r,objectId:this.objId}),this.scope.internal.out("endobj")},Wu.prototype.getKeyValueListForStream=function(){var r=[],e=Object.getOwnPropertyNames(this).filter(function(s){return s!="content"&&s!="appearanceStreamContent"&&s!="scope"&&s!="objId"&&s.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var n=e[t],i=this[n];i&&(Array.isArray(i)?r.push({key:n,value:zU(i,this.objId,this.scope)}):i instanceof Wu?(i.scope=this.scope,r.push({key:n,value:i.objId+" 0 R"})):typeof i!="function"&&r.push({key:n,value:i}))}return r};var QU=function(){Wu.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var r,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){r=t.trim()},get:function(){return r||null}})};tl(QU,Wu);var HU=function(){Wu.call(this);var r,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(r){var t=function(n){return n};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+fd(t(r))+")"}},set:function(t){r=t}})};tl(HU,Wu);var Kc=function r(){Wu.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(D){if(isNaN(D))throw new Error('Invalid value "'+D+'" for attribute F supplied.');e=D}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Ls(e,3)},set:function(D){D?this.F=Os(e,3):this.F=Us(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(D){if(isNaN(D))throw new Error('Invalid value "'+D+'" for attribute Ff supplied.');t=D}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(D){n=D!==void 0?D:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(D){n[0]=D}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(D){n[1]=D}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(D){n[2]=D}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(D){n[3]=D}});var i="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return i},set:function(D){switch(D){case"/Btn":case"/Tx":case"/Ch":case"/Sig":i=D;break;default:throw new Error('Invalid value "'+D+'" for attribute FT supplied.')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof Bb)return;s="FieldObject"+r.FieldNum++}var D=function(j){return j};return this.scope&&(D=this.scope.internal.getEncryptor(this.objId)),"("+fd(D(s))+")"},set:function(D){s=D.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(D){s=D}});var a="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return a},set:function(D){a=D}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(D){o=D}});var u=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return u},set:function(D){u=D}});var d=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return d===void 0?50/sC:d},set:function(D){d=D}});var p="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return p},set:function(D){p=D}});var b="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!b||this instanceof Bb||this instanceof dd))return aC(b,this.objId,this.scope)},set:function(D){D=D.toString(),b=D}});var C=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(C)return this instanceof Oo==0?aC(C,this.objId,this.scope):C},set:function(D){D=D.toString(),C=this instanceof Oo==0?D.substr(0,1)==="("?eg(D.substr(1,D.length-2)):eg(D):D}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Oo==1?eg(C.substr(1,C.length-1)):C},set:function(D){D=D.toString(),C=this instanceof Oo==1?"/"+D:D}});var w=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(w)return w},set:function(D){this.V=D}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(w)return this instanceof Oo==0?aC(w,this.objId,this.scope):w},set:function(D){D=D.toString(),w=this instanceof Oo==0?D.substr(0,1)==="("?eg(D.substr(1,D.length-2)):eg(D):D}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Oo==1?eg(w.substr(1,w.length-1)):w},set:function(D){D=D.toString(),w=this instanceof Oo==1?"/"+D:D}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var M,P=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return P},set:function(D){D=!!D,P=D}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(M)return M},set:function(D){M=D}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,1)},set:function(D){D?this.Ff=Os(this.Ff,1):this.Ff=Us(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,2)},set:function(D){D?this.Ff=Os(this.Ff,2):this.Ff=Us(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,3)},set:function(D){D?this.Ff=Os(this.Ff,3):this.Ff=Us(this.Ff,3)}});var k=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(k!==null)return k},set:function(D){if([0,1,2].indexOf(D)===-1)throw new Error('Invalid value "'+D+'" for attribute Q supplied.');k=D}}),Object.defineProperty(this,"textAlign",{get:function(){var D;switch(k){case 0:default:D="left";break;case 1:D="center";break;case 2:D="right"}return D},configurable:!0,enumerable:!0,set:function(D){switch(D){case"right":case 2:k=2;break;case"center":case 1:k=1;break;default:k=0}}})};tl(Kc,Wu);var tg=function(){Kc.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var r=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return r},set:function(t){r=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return zU(e,this.objId,this.scope)},set:function(t){var n,i;i=[],typeof(n=t)=="string"&&(i=function(s,a,o){o||(o=1);for(var u,d=[];u=a.exec(s);)d.push(u[o]);return d}(n,/\((.*?)\)/g)),e=i}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,n){for(n=n||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,18)},set:function(t){t?this.Ff=Os(this.Ff,18):this.Ff=Us(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=Os(this.Ff,19):this.Ff=Us(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,20)},set:function(t){t?(this.Ff=Os(this.Ff,20),e.sort()):this.Ff=Us(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,22)},set:function(t){t?this.Ff=Os(this.Ff,22):this.Ff=Us(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,23)},set:function(t){t?this.Ff=Os(this.Ff,23):this.Ff=Us(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,27)},set:function(t){t?this.Ff=Os(this.Ff,27):this.Ff=Us(this.Ff,27)}}),this.hasAppearanceStream=!1};tl(tg,Kc);var rg=function(){tg.call(this),this.fontName="helvetica",this.combo=!1};tl(rg,tg);var ng=function(){rg.call(this),this.combo=!0};tl(ng,rg);var wb=function(){ng.call(this),this.edit=!0};tl(wb,ng);var Oo=function(){Kc.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,15)},set:function(t){t?this.Ff=Os(this.Ff,15):this.Ff=Us(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,16)},set:function(t){t?this.Ff=Os(this.Ff,16):this.Ff=Us(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,17)},set:function(t){t?this.Ff=Os(this.Ff,17):this.Ff=Us(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,26)},set:function(t){t?this.Ff=Os(this.Ff,26):this.Ff=Us(this.Ff,26)}});var r,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(s){return s};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var n,i=[];for(n in i.push("<<"),e)i.push("/"+n+" ("+fd(t(e[n]))+")");return i.push(">>"),i.join(`
`)}},set:function(t){ni(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(t){r="/"+t}})};tl(Oo,Kc);var xb=function(){Oo.call(this),this.pushButton=!0};tl(xb,Oo);var ig=function(){Oo.call(this),this.radio=!0,this.pushButton=!1;var r=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){r=e!==void 0?e:[]}})};tl(ig,Oo);var Bb=function(){var r,e;Kc.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return r},set:function(i){r=i}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(i){e=i}});var t,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var i=function(o){return o};this.scope&&(i=this.scope.internal.getEncryptor(this.objId));var s,a=[];for(s in a.push("<<"),n)a.push("/"+s+" ("+fd(i(n[s]))+")");return a.push(">>"),a.join(`
`)},set:function(i){ni(i)==="object"&&(n=i)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(i){typeof i=="string"&&(n.CA=i)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(i){t=i}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(i){t="/"+i}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=$r.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};tl(Bb,Kc),ig.prototype.setAppearance=function(r){if(!("createAppearanceStream"in r)||!("getCA"in r))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=r.createAppearanceStream(t.optionName),t.caption=r.getCA()}},ig.prototype.createOption=function(r){var e=new Bb;return e.Parent=this,e.optionName=r,this.Kids.push(e),gde.call(this.scope,e),e};var Cb=function(){Oo.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=$r.CheckBox.createAppearanceStream()};tl(Cb,Oo);var dd=function(){Kc.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,13)},set:function(e){e?this.Ff=Os(this.Ff,13):this.Ff=Us(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,21)},set:function(e){e?this.Ff=Os(this.Ff,21):this.Ff=Us(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,23)},set:function(e){e?this.Ff=Os(this.Ff,23):this.Ff=Us(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,24)},set:function(e){e?this.Ff=Os(this.Ff,24):this.Ff=Us(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,25)},set:function(e){e?this.Ff=Os(this.Ff,25):this.Ff=Us(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,26)},set:function(e){e?this.Ff=Os(this.Ff,26):this.Ff=Us(this.Ff,26)}});var r=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return r},set:function(e){Number.isInteger(e)&&(r=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};tl(dd,Kc);var Tb=function(){dd.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Ls(this.Ff,14)},set:function(r){r?this.Ff=Os(this.Ff,14):this.Ff=Us(this.Ff,14)}}),this.password=!0};tl(Tb,dd);var $r={CheckBox:{createAppearanceStream:function(){return{N:{On:$r.CheckBox.YesNormal},D:{On:$r.CheckBox.YesPushDown,Off:$r.CheckBox.OffPushDown}}},YesPushDown:function(r){var e=Gu(r);e.scope=r.scope;var t=[],n=r.scope.internal.getFont(r.fontName,r.fontStyle).id,i=r.scope.__private__.encodeColorString(r.color),s=oC(r,r.caption);return t.push("0.749023 g"),t.push("0 0 "+Cn($r.internal.getWidth(r))+" "+Cn($r.internal.getHeight(r))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+n+" "+Cn(s.fontSize)+" Tf "+i),t.push("BT"),t.push(s.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(r){var e=Gu(r);e.scope=r.scope;var t=r.scope.internal.getFont(r.fontName,r.fontStyle).id,n=r.scope.__private__.encodeColorString(r.color),i=[],s=$r.internal.getHeight(r),a=$r.internal.getWidth(r),o=oC(r,r.caption);return i.push("1 g"),i.push("0 0 "+Cn(a)+" "+Cn(s)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+Cn(a-1)+" "+Cn(s-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+t+" "+Cn(o.fontSize)+" Tf "+n),i.push(o.text),i.push("ET"),i.push("Q"),e.stream=i.join(`
`),e},OffPushDown:function(r){var e=Gu(r);e.scope=r.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Cn($r.internal.getWidth(r))+" "+Cn($r.internal.getHeight(r))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(r){var e={D:{Off:$r.RadioButton.Circle.OffPushDown},N:{}};return e.N[r]=$r.RadioButton.Circle.YesNormal,e.D[r]=$r.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(r){var e=Gu(r);e.scope=r.scope;var t=[],n=$r.internal.getWidth(r)<=$r.internal.getHeight(r)?$r.internal.getWidth(r)/4:$r.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=$r.internal.Bezier_C,s=Number((n*i).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+qA($r.internal.getWidth(r)/2)+" "+qA($r.internal.getHeight(r)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),t.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),t.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),t.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(r){var e=Gu(r);e.scope=r.scope;var t=[],n=$r.internal.getWidth(r)<=$r.internal.getHeight(r)?$r.internal.getWidth(r)/4:$r.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),s=Number((i*$r.internal.Bezier_C).toFixed(5)),a=Number((n*$r.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+qA($r.internal.getWidth(r)/2)+" "+qA($r.internal.getHeight(r)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),t.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),t.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),t.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+qA($r.internal.getWidth(r)/2)+" "+qA($r.internal.getHeight(r)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+a+" "+a+" "+n+" 0 "+n+" c"),t.push("-"+a+" "+n+" -"+n+" "+a+" -"+n+" 0 c"),t.push("-"+n+" -"+a+" -"+a+" -"+n+" 0 -"+n+" c"),t.push(a+" -"+n+" "+n+" -"+a+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(r){var e=Gu(r);e.scope=r.scope;var t=[],n=$r.internal.getWidth(r)<=$r.internal.getHeight(r)?$r.internal.getWidth(r)/4:$r.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var i=Number((2*n).toFixed(5)),s=Number((i*$r.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+qA($r.internal.getWidth(r)/2)+" "+qA($r.internal.getHeight(r)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+s+" "+s+" "+i+" 0 "+i+" c"),t.push("-"+s+" "+i+" -"+i+" "+s+" -"+i+" 0 c"),t.push("-"+i+" -"+s+" -"+s+" -"+i+" 0 -"+i+" c"),t.push(s+" -"+i+" "+i+" -"+s+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(r){var e={D:{Off:$r.RadioButton.Cross.OffPushDown},N:{}};return e.N[r]=$r.RadioButton.Cross.YesNormal,e.D[r]=$r.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(r){var e=Gu(r);e.scope=r.scope;var t=[],n=$r.internal.calculateCross(r);return t.push("q"),t.push("1 1 "+Cn($r.internal.getWidth(r)-2)+" "+Cn($r.internal.getHeight(r)-2)+" re"),t.push("W"),t.push("n"),t.push(Cn(n.x1.x)+" "+Cn(n.x1.y)+" m"),t.push(Cn(n.x2.x)+" "+Cn(n.x2.y)+" l"),t.push(Cn(n.x4.x)+" "+Cn(n.x4.y)+" m"),t.push(Cn(n.x3.x)+" "+Cn(n.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(r){var e=Gu(r);e.scope=r.scope;var t=$r.internal.calculateCross(r),n=[];return n.push("0.749023 g"),n.push("0 0 "+Cn($r.internal.getWidth(r))+" "+Cn($r.internal.getHeight(r))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+Cn($r.internal.getWidth(r)-2)+" "+Cn($r.internal.getHeight(r)-2)+" re"),n.push("W"),n.push("n"),n.push(Cn(t.x1.x)+" "+Cn(t.x1.y)+" m"),n.push(Cn(t.x2.x)+" "+Cn(t.x2.y)+" l"),n.push(Cn(t.x4.x)+" "+Cn(t.x4.y)+" m"),n.push(Cn(t.x3.x)+" "+Cn(t.x3.y)+" l"),n.push("s"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(r){var e=Gu(r);e.scope=r.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Cn($r.internal.getWidth(r))+" "+Cn($r.internal.getHeight(r))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(r){var e=r.scope.internal.getFont(r.fontName,r.fontStyle).id,t=r.scope.__private__.encodeColorString(r.color);return"/"+e+" "+r.fontSize+" Tf "+t}};$r.internal={Bezier_C:.551915024494,calculateCross:function(r){var e=$r.internal.getWidth(r),t=$r.internal.getHeight(r),n=Math.min(e,t);return{x1:{x:(e-n)/2,y:(t-n)/2+n},x2:{x:(e-n)/2+n,y:(t-n)/2},x3:{x:(e-n)/2,y:(t-n)/2},x4:{x:(e-n)/2+n,y:(t-n)/2+n}}}},$r.internal.getWidth=function(r){var e=0;return ni(r)==="object"&&(e=NU(r.Rect[2])),e},$r.internal.getHeight=function(r){var e=0;return ni(r)==="object"&&(e=NU(r.Rect[3])),e};var gde=xs.addField=function(r){if(pde(this,r),!(r instanceof Kc))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=r).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),r.page=r.scope.internal.getCurrentPageInfo().pageNumber,this};xs.AcroFormChoiceField=tg,xs.AcroFormListBox=rg,xs.AcroFormComboBox=ng,xs.AcroFormEditBox=wb,xs.AcroFormButton=Oo,xs.AcroFormPushButton=xb,xs.AcroFormRadioButton=ig,xs.AcroFormCheckBox=Cb,xs.AcroFormTextField=dd,xs.AcroFormPasswordField=Tb,xs.AcroFormAppearance=$r,xs.AcroForm={ChoiceField:tg,ListBox:rg,ComboBox:ng,EditBox:wb,Button:Oo,PushButton:xb,RadioButton:ig,CheckBox:Cb,TextField:dd,PasswordField:Tb,Appearance:$r},Jr.AcroForm={ChoiceField:tg,ListBox:rg,ComboBox:ng,EditBox:wb,Button:Oo,PushButton:xb,RadioButton:ig,CheckBox:Cb,TextField:dd,PasswordField:Tb,Appearance:$r},Jr.AcroForm;function VU(r){return r.reduce(function(e,t,n){return e[t]=n,e},{})}(function(r){var e="addImage_";r.__addimage__={};var t="UNKNOWN",n={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},i=r.__addimage__.getImageFileTypeByImageData=function(te,ce){var ve,me,qe,ot,st,Ye=t;if((ce=ce||t)==="RGBA"||te.data!==void 0&&te.data instanceof Uint8ClampedArray&&"height"in te&&"width"in te)return"RGBA";if(W(te))for(st in n)for(qe=n[st],ve=0;ve<qe.length;ve+=1){for(ot=!0,me=0;me<qe[ve].length;me+=1)if(qe[ve][me]!==void 0&&qe[ve][me]!==te[me]){ot=!1;break}if(ot===!0){Ye=st;break}}else for(st in n)for(qe=n[st],ve=0;ve<qe.length;ve+=1){for(ot=!0,me=0;me<qe[ve].length;me+=1)if(qe[ve][me]!==void 0&&qe[ve][me]!==te.charCodeAt(me)){ot=!1;break}if(ot===!0){Ye=st;break}}return Ye===t&&ce!==t&&(Ye=ce),Ye},s=function te(ce){for(var ve=this.internal.write,me=this.internal.putStream,qe=(0,this.internal.getFilters)();qe.indexOf("FlateEncode")!==-1;)qe.splice(qe.indexOf("FlateEncode"),1);ce.objectId=this.internal.newObject();var ot=[];if(ot.push({key:"Type",value:"/XObject"}),ot.push({key:"Subtype",value:"/Image"}),ot.push({key:"Width",value:ce.width}),ot.push({key:"Height",value:ce.height}),ce.colorSpace===D.INDEXED?ot.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(ce.palette.length/3-1)+" "+("sMask"in ce&&ce.sMask!==void 0?ce.objectId+2:ce.objectId+1)+" 0 R]"}):(ot.push({key:"ColorSpace",value:"/"+ce.colorSpace}),ce.colorSpace===D.DEVICE_CMYK&&ot.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),ot.push({key:"BitsPerComponent",value:ce.bitsPerComponent}),"decodeParameters"in ce&&ce.decodeParameters!==void 0&&ot.push({key:"DecodeParms",value:"<<"+ce.decodeParameters+">>"}),"transparency"in ce&&Array.isArray(ce.transparency)){for(var st="",Ye=0,Xe=ce.transparency.length;Ye<Xe;Ye++)st+=ce.transparency[Ye]+" "+ce.transparency[Ye]+" ";ot.push({key:"Mask",value:"["+st+"]"})}ce.sMask!==void 0&&ot.push({key:"SMask",value:ce.objectId+1+" 0 R"});var wt=ce.filter!==void 0?["/"+ce.filter]:void 0;if(me({data:ce.data,additionalKeyValues:ot,alreadyAppliedFilters:wt,objectId:ce.objectId}),ve("endobj"),"sMask"in ce&&ce.sMask!==void 0){var ht=(ce.predictor!=null?"/Predictor "+ce.predictor:"")+" /Colors 1 /BitsPerComponent 8 /Columns "+ce.width,he={width:ce.width,height:ce.height,colorSpace:"DeviceGray",bitsPerComponent:ce.bitsPerComponent,decodeParameters:ht,data:ce.sMask};"filter"in ce&&(he.filter=ce.filter),te.call(this,he)}if(ce.colorSpace===D.INDEXED){var Be=this.internal.newObject();me({data:se(new Uint8Array(ce.palette)),objectId:Be}),ve("endobj")}},a=function(){var te=this.internal.collections[e+"images"];for(var ce in te)s.call(this,te[ce])},o=function(){var te,ce=this.internal.collections[e+"images"],ve=this.internal.write;for(var me in ce)ve("/I"+(te=ce[me]).index,te.objectId,"0","R")},u=function(){this.internal.collections[e+"images"]||(this.internal.collections[e+"images"]={},this.internal.events.subscribe("putResources",a),this.internal.events.subscribe("putXobjectDict",o))},d=function(){var te=this.internal.collections[e+"images"];return u.call(this),te},p=function(){return Object.keys(this.internal.collections[e+"images"]).length},b=function(te){return typeof r["process"+te.toUpperCase()]=="function"},C=function(te){return ni(te)==="object"&&te.nodeType===1},w=function(te,ce){if(te.nodeName==="IMG"&&te.hasAttribute("src")){var ve=""+te.getAttribute("src");if(ve.indexOf("data:image/")===0)return _b(unescape(ve).split("base64,").pop());var me=r.loadFile(ve,!0);if(me!==void 0)return me}if(te.nodeName==="CANVAS"){if(te.width===0||te.height===0)throw new Error("Given canvas must have data. Canvas width: "+te.width+", height: "+te.height);var qe;switch(ce){case"PNG":qe="image/png";break;case"WEBP":qe="image/webp";break;default:qe="image/jpeg"}return _b(te.toDataURL(qe,1).split("base64,").pop())}},M=function(te){var ce=this.internal.collections[e+"images"];if(ce){for(var ve in ce)if(te===ce[ve].alias)return ce[ve]}},P=function(te,ce,ve){return te||ce||(te=-96,ce=-96),te<0&&(te=-1*ve.width*72/te/this.internal.scaleFactor),ce<0&&(ce=-1*ve.height*72/ce/this.internal.scaleFactor),te===0&&(te=ce*ve.width/ve.height),ce===0&&(ce=te*ve.height/ve.width),[te,ce]},k=function(te,ce,ve,me,qe,ot){var st=P.call(this,ve,me,qe),Ye=this.internal.getCoordinateString,Xe=this.internal.getVerticalCoordinateString,wt=d.call(this);if(ve=st[0],me=st[1],wt[qe.index]=qe,ot){ot*=Math.PI/180;var ht=Math.cos(ot),he=Math.sin(ot),Be=function(He){return He.toFixed(4)},Le=[Be(ht),Be(he),Be(-1*he),Be(ht),0,0,"cm"]}this.internal.write("q"),ot?(this.internal.write([1,"0","0",1,Ye(te),Xe(ce+me),"cm"].join(" ")),this.internal.write(Le.join(" ")),this.internal.write([Ye(ve),"0","0",Ye(me),"0","0","cm"].join(" "))):this.internal.write([Ye(ve),"0","0",Ye(me),Ye(te),Xe(ce+me),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+qe.index+" Do"),this.internal.write("Q")},D=r.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};r.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var j=r.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},H=r.__addimage__.sHashCode=function(te){var ce,ve,me=0;if(typeof te=="string")for(ve=te.length,ce=0;ce<ve;ce++)me=(me<<5)-me+te.charCodeAt(ce),me|=0;else if(W(te))for(ve=te.byteLength/2,ce=0;ce<ve;ce++)me=(me<<5)-me+te[ce],me|=0;return me},N=r.__addimage__.validateStringAsBase64=function(te){(te=te||"").toString().trim();var ce=!0;return te.length===0&&(ce=!1),te.length%4!=0&&(ce=!1),/^[A-Za-z0-9+/]+$/.test(te.substr(0,te.length-2))===!1&&(ce=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(te.substr(-2))===!1&&(ce=!1),ce},q=r.__addimage__.extractImageFromDataUrl=function(te){if(te==null||!(te=te.trim()).startsWith("data:"))return null;var ce=te.indexOf(",");return ce<0?null:te.substring(0,ce).trim().endsWith("base64")?te.substring(ce+1):null};r.__addimage__.isArrayBuffer=function(te){return te instanceof ArrayBuffer};var W=r.__addimage__.isArrayBufferView=function(te){return te instanceof Int8Array||te instanceof Uint8Array||te instanceof Uint8ClampedArray||te instanceof Int16Array||te instanceof Uint16Array||te instanceof Int32Array||te instanceof Uint32Array||te instanceof Float32Array||te instanceof Float64Array},ie=r.__addimage__.binaryStringToUint8Array=function(te){for(var ce=te.length,ve=new Uint8Array(ce),me=0;me<ce;me++)ve[me]=te.charCodeAt(me);return ve},se=r.__addimage__.arrayBufferToBinaryString=function(te){for(var ce="",ve=W(te)?te:new Uint8Array(te),me=0;me<ve.length;me+=8192)ce+=String.fromCharCode.apply(null,ve.subarray(me,me+8192));return ce};r.addImage=function(){var te,ce,ve,me,qe,ot,st,Ye,Xe;if(typeof arguments[1]=="number"?(ce=t,ve=arguments[1],me=arguments[2],qe=arguments[3],ot=arguments[4],st=arguments[5],Ye=arguments[6],Xe=arguments[7]):(ce=arguments[1],ve=arguments[2],me=arguments[3],qe=arguments[4],ot=arguments[5],st=arguments[6],Ye=arguments[7],Xe=arguments[8]),ni(te=arguments[0])==="object"&&!C(te)&&"imageData"in te){var wt=te;te=wt.imageData,ce=wt.format||ce||t,ve=wt.x||ve||0,me=wt.y||me||0,qe=wt.w||wt.width||qe,ot=wt.h||wt.height||ot,st=wt.alias||st,Ye=wt.compression||Ye,Xe=wt.rotation||wt.angle||Xe}var ht=this.internal.getFilters();if(Ye===void 0&&ht.indexOf("FlateEncode")!==-1&&(Ye="SLOW"),isNaN(ve)||isNaN(me))throw new Error("Invalid coordinates passed to jsPDF.addImage");u.call(this);var he=Z.call(this,te,ce,st,Ye);return k.call(this,ve,me,qe,ot,he,Xe),this};var Z=function(te,ce,ve,me){var qe,ot,st;if(typeof te=="string"&&i(te)===t){te=unescape(te);var Ye=fe(te,!1);(Ye!==""||(Ye=r.loadFile(te,!0))!==void 0)&&(te=Ye)}if(C(te)&&(te=w(te,ce)),ce=i(te,ce),!b(ce))throw new Error("addImage does not support files of type '"+ce+"', please ensure that a plugin for '"+ce+"' support is added.");if(((st=ve)==null||st.length===0)&&(ve=function(Xe){return typeof Xe=="string"||W(Xe)?H(Xe):W(Xe.data)?H(Xe.data):null}(te)),(qe=M.call(this,ve))||(te instanceof Uint8Array||ce==="RGBA"||(ot=te,te=ie(te)),qe=this["process"+ce.toUpperCase()](te,p.call(this),ve,function(Xe){return Xe&&typeof Xe=="string"&&(Xe=Xe.toUpperCase()),Xe in r.image_compression?Xe:j.NONE}(me),ot)),!qe)throw new Error("An unknown error occurred whilst processing the image.");return qe},fe=r.__addimage__.convertBase64ToBinaryString=function(te,ce){ce=typeof ce!="boolean"||ce;var ve,me="";if(typeof te=="string"){var qe;ve=(qe=q(te))!==null&&qe!==void 0?qe:te;try{me=_b(ve)}catch(ot){if(ce)throw N(ve)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+ot.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return me};r.getImageProperties=function(te){var ce,ve,me="";if(C(te)&&(te=w(te)),typeof te=="string"&&i(te)===t&&((me=fe(te,!1))===""&&(me=r.loadFile(te)||""),te=me),ve=i(te),!b(ve))throw new Error("addImage does not support files of type '"+ve+"', please ensure that a plugin for '"+ve+"' support is added.");if(te instanceof Uint8Array||(te=ie(te)),!(ce=this["process"+ve.toUpperCase()](te)))throw new Error("An unknown error occurred whilst processing the image");return ce.fileType=ve,ce}})(Jr.API),function(r){var e=function(t){if(t!==void 0&&t!="")return!0};Jr.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),r.events.push(["putPage",function(t){for(var n,i,s,a=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,u=this.internal.getPageInfoByObjId(t.objId),d=t.pageContext.annotations,p=!1,b=0;b<d.length&&!p;b++)switch((n=d[b]).type){case"link":(e(n.options.url)||e(n.options.pageNumber))&&(p=!0);break;case"reference":case"text":case"freetext":p=!0}if(p!=0){this.internal.write("/Annots [");for(var C=0;C<d.length;C++){n=d[C];var w=this.internal.pdfEscape,M=this.internal.getEncryptor(t.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var P=this.internal.newAdditionalObject(),k=this.internal.newAdditionalObject(),D=this.internal.getEncryptor(P.objId),j=n.title||"Note";s="<</Type /Annot /Subtype /Text "+(i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y)+"] ")+"/Contents ("+w(D(n.contents))+")",s+=" /Popup "+k.objId+" 0 R",s+=" /P "+u.objId+" 0 R",s+=" /T ("+w(D(j))+") >>",P.content=s;var H=P.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(i="/Rect ["+a(n.bounds.x+30)+" "+o(n.bounds.y+n.bounds.h)+" "+a(n.bounds.x+n.bounds.w+30)+" "+o(n.bounds.y)+"] ")+" /Parent "+H,n.open&&(s+=" /Open true"),s+=" >>",k.content=s,this.internal.write(P.objId,"0 R",k.objId,"0 R");break;case"freetext":i="/Rect ["+a(n.bounds.x)+" "+o(n.bounds.y)+" "+a(n.bounds.x+n.bounds.w)+" "+o(n.bounds.y+n.bounds.h)+"] ";var N=n.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+i+"/Contents ("+w(M(n.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+N+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(n.options.name){var q=this.annotations._nameMap[n.options.name];n.options.pageNumber=q.page,n.options.top=q.y}else n.options.top||(n.options.top=0);if(i="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",s="",n.options.url)s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /A <</S /URI /URI ("+w(M(n.options.url))+") >>";else if(n.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,s+=" /FitV "+n.options.left+"]";break;default:var W=o(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),s+=" /XYZ "+n.options.left+" "+W+" "+n.options.zoom+"]"}s!=""&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),r.createAnnotation=function(t){var n=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":n.pageContext.annotations.push(t)}},r.link=function(t,n,i,s,a){var o=this.internal.getCurrentPageInfo(),u=this.internal.getCoordinateString,d=this.internal.getVerticalCoordinateString;o.pageContext.annotations.push({finalBounds:{x:u(t),y:d(n),w:u(t+i),h:d(n+s)},options:a,type:"link"})},r.textWithLink=function(t,n,i,s){var a,o,u=this.getTextWidth(t),d=this.internal.getLineHeight()/this.internal.scaleFactor;if(s.maxWidth!==void 0){o=s.maxWidth;var p=this.splitTextToSize(t,o).length;a=Math.ceil(d*p)}else o=u,a=d;return this.text(t,n,i,s),i+=.2*d,s.align==="center"&&(n-=u/2),s.align==="right"&&(n-=u),this.link(n,i-d,o,a,s),u},r.getTextWidth=function(t){var n=this.internal.getFontSize();return this.getStringUnitWidth(t)*n/this.internal.scaleFactor}}(Jr.API),function(r){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];r.__arabicParser__={};var s=r.__arabicParser__.isInArabicSubstitutionA=function(P){return e[P.charCodeAt(0)]!==void 0},a=r.__arabicParser__.isArabicLetter=function(P){return typeof P=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(P)},o=r.__arabicParser__.isArabicEndLetter=function(P){return a(P)&&s(P)&&e[P.charCodeAt(0)].length<=2},u=r.__arabicParser__.isArabicAlfLetter=function(P){return a(P)&&i.indexOf(P.charCodeAt(0))>=0};r.__arabicParser__.arabicLetterHasIsolatedForm=function(P){return a(P)&&s(P)&&e[P.charCodeAt(0)].length>=1};var d=r.__arabicParser__.arabicLetterHasFinalForm=function(P){return a(P)&&s(P)&&e[P.charCodeAt(0)].length>=2};r.__arabicParser__.arabicLetterHasInitialForm=function(P){return a(P)&&s(P)&&e[P.charCodeAt(0)].length>=3};var p=r.__arabicParser__.arabicLetterHasMedialForm=function(P){return a(P)&&s(P)&&e[P.charCodeAt(0)].length==4},b=r.__arabicParser__.resolveLigatures=function(P){var k=0,D=t,j="",H=0;for(k=0;k<P.length;k+=1)D[P.charCodeAt(k)]!==void 0?(H++,typeof(D=D[P.charCodeAt(k)])=="number"&&(j+=String.fromCharCode(D),D=t,H=0),k===P.length-1&&(D=t,j+=P.charAt(k-(H-1)),k-=H-1,H=0)):(D=t,j+=P.charAt(k-H),k-=H,H=0);return j};r.__arabicParser__.isArabicDiacritic=function(P){return P!==void 0&&n[P.charCodeAt(0)]!==void 0};var C=r.__arabicParser__.getCorrectForm=function(P,k,D){return a(P)?s(P)===!1?-1:!d(P)||!a(k)&&!a(D)||!a(D)&&o(k)||o(P)&&!a(k)||o(P)&&u(k)||o(P)&&o(k)?0:p(P)&&a(k)&&!o(k)&&a(D)&&d(D)?3:o(P)||!a(D)?1:2:-1},w=function(P){var k=0,D=0,j=0,H="",N="",q="",W=(P=P||"").split("\\s+"),ie=[];for(k=0;k<W.length;k+=1){for(ie.push(""),D=0;D<W[k].length;D+=1)H=W[k][D],N=W[k][D-1],q=W[k][D+1],a(H)?(j=C(H,N,q),ie[k]+=j!==-1?String.fromCharCode(e[H.charCodeAt(0)][j]):H):ie[k]+=H;ie[k]=b(ie[k])}return ie.join(" ")},M=r.__arabicParser__.processArabic=r.processArabic=function(){var P,k=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,D=[];if(Array.isArray(k)){var j=0;for(D=[],j=0;j<k.length;j+=1)Array.isArray(k[j])?D.push([w(k[j][0]),k[j][1],k[j][2]]):D.push([w(k[j])]);P=D}else P=w(k);return typeof arguments[0]=="string"?P:(arguments[0].text=P,arguments[0])};r.events.push(["preProcessText",M])}(Jr.API),Jr.API.autoPrint=function(r){var e;return(r=r||{}).variant=r.variant||"non-conform",r.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})),this},function(r){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(o){t=o}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(o){n=isNaN(o)||Number.isInteger(o)===!1||o<0?150:o,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var i=300;Object.defineProperty(this,"height",{get:function(){return i},set:function(o){i=isNaN(o)||Number.isInteger(o)===!1||o<0?300:o,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=i+1)}});var s=[];Object.defineProperty(this,"childNodes",{get:function(){return s},set:function(o){s=o}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(o){a=o}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,n){var i;if((t=t||"2d")!=="2d")return null;for(i in n)this.pdf.context2d.hasOwnProperty(i)&&(this.pdf.context2d[i]=n[i]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},r.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(Jr.API),function(r){var e={left:0,top:0,bottom:0,right:0},t=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var u=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return u},set:function(P){u=P}});var d=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return d},set:function(P){d=P}});var p=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return p},set:function(P){p=P}});var b=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return b},set:function(P){b=P}});var C=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return C},set:function(P){C=P}});var w=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return w},set:function(P){w=P}});var M=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return M},set:function(P){M=P}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},r.setHeaderFunction=function(u){return n.call(this),this.internal.__cell__.headerFunction=typeof u=="function"?u:void 0,this},r.getTextDimensions=function(u,d){n.call(this);var p=(d=d||{}).fontSize||this.getFontSize(),b=d.font||this.getFont(),C=d.scaleFactor||this.internal.scaleFactor,w=0,M=0,P=0,k=this;if(!Array.isArray(u)&&typeof u!="string"){if(typeof u!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");u=String(u)}var D=d.maxWidth;D>0?typeof u=="string"?u=this.splitTextToSize(u,D):Object.prototype.toString.call(u)==="[object Array]"&&(u=u.reduce(function(H,N){return H.concat(k.splitTextToSize(N,D))},[])):u=Array.isArray(u)?u:[u];for(var j=0;j<u.length;j++)w<(P=this.getStringUnitWidth(u[j],{font:b})*p)&&(w=P);return w!==0&&(M=u.length),{w:w/=C,h:Math.max((M*p*this.getLineHeightFactor()-p*(this.getLineHeightFactor()-1))/C,0)}},r.cellAddPage=function(){n.call(this),this.addPage();var u=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new s(u.left,u.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var a=r.cell=function(){var u;u=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),n.call(this);var d=this.internal.__cell__.lastCell,p=this.internal.__cell__.padding,b=this.internal.__cell__.margins||e,C=this.internal.__cell__.tableHeaderRow,w=this.internal.__cell__.printHeaders;return d.lineNumber!==void 0&&(d.lineNumber===u.lineNumber?(u.x=(d.x||0)+(d.width||0),u.y=d.y||0):d.y+d.height+u.height+b.bottom>this.getPageHeight()?(this.cellAddPage(),u.y=b.top,w&&C&&(this.printHeaderRow(u.lineNumber,!0),u.y+=C[0].height)):u.y=d.y+d.height||u.y),u.text[0]!==void 0&&(this.rect(u.x,u.y,u.width,u.height,t===!0?"FD":void 0),u.align==="right"?this.text(u.text,u.x+u.width-p,u.y+p,{align:"right",baseline:"top"}):u.align==="center"?this.text(u.text,u.x+u.width/2,u.y+p,{align:"center",baseline:"top",maxWidth:u.width-p-p}):this.text(u.text,u.x+p,u.y+p,{align:"left",baseline:"top",maxWidth:u.width-p-p})),this.internal.__cell__.lastCell=u,this};r.table=function(u,d,p,b,C){if(n.call(this),!p)throw new Error("No data for PDF table.");var w,M,P,k,D=[],j=[],H=[],N={},q={},W=[],ie=[],se=(C=C||{}).autoSize||!1,Z=C.printHeaders!==!1,fe=C.css&&C.css["font-size"]!==void 0?16*C.css["font-size"]:C.fontSize||12,te=C.margins||Object.assign({width:this.getPageWidth()},e),ce=typeof C.padding=="number"?C.padding:3,ve=C.headerBackgroundColor||"#c8c8c8",me=C.headerTextColor||"#000";if(i.call(this),this.internal.__cell__.printHeaders=Z,this.internal.__cell__.margins=te,this.internal.__cell__.table_font_size=fe,this.internal.__cell__.padding=ce,this.internal.__cell__.headerBackgroundColor=ve,this.internal.__cell__.headerTextColor=me,this.setFontSize(fe),b==null)j=D=Object.keys(p[0]),H=D.map(function(){return"left"});else if(Array.isArray(b)&&ni(b[0])==="object")for(D=b.map(function(wt){return wt.name}),j=b.map(function(wt){return wt.prompt||wt.name||""}),H=b.map(function(wt){return wt.align||"left"}),w=0;w<b.length;w+=1)q[b[w].name]=.7499990551181103*b[w].width;else Array.isArray(b)&&typeof b[0]=="string"&&(j=D=b,H=D.map(function(){return"left"}));if(se||Array.isArray(b)&&typeof b[0]=="string")for(w=0;w<D.length;w+=1){for(N[k=D[w]]=p.map(function(wt){return wt[k]}),this.setFont(void 0,"bold"),W.push(this.getTextDimensions(j[w],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),M=N[k],this.setFont(void 0,"normal"),P=0;P<M.length;P+=1)W.push(this.getTextDimensions(M[P],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);q[k]=Math.max.apply(null,W)+ce+ce,W=[]}if(Z){var qe={};for(w=0;w<D.length;w+=1)qe[D[w]]={},qe[D[w]].text=j[w],qe[D[w]].align=H[w];var ot=o.call(this,qe,q);ie=D.map(function(wt){return new s(u,d,q[wt],ot,qe[wt].text,void 0,qe[wt].align)}),this.setTableHeaderRow(ie),this.printHeaderRow(1,!1)}var st=b.reduce(function(wt,ht){return wt[ht.name]=ht.align,wt},{});for(w=0;w<p.length;w+=1){"rowStart"in C&&C.rowStart instanceof Function&&C.rowStart({row:w,data:p[w]},this);var Ye=o.call(this,p[w],q);for(P=0;P<D.length;P+=1){var Xe=p[w][D[P]];"cellStart"in C&&C.cellStart instanceof Function&&C.cellStart({row:w,col:P,data:Xe},this),a.call(this,new s(u,d,q[D[P]],Ye,Xe,w+2,st[D[P]]))}}return this.internal.__cell__.table_x=u,this.internal.__cell__.table_y=d,this};var o=function(u,d){var p=this.internal.__cell__.padding,b=this.internal.__cell__.table_font_size,C=this.internal.scaleFactor;return Object.keys(u).map(function(w){var M=u[w];return this.splitTextToSize(M.hasOwnProperty("text")?M.text:M,d[w]-p-p)},this).map(function(w){return this.getLineHeightFactor()*w.length*b/C+p+p},this).reduce(function(w,M){return Math.max(w,M)},0)};r.setTableHeaderRow=function(u){n.call(this),this.internal.__cell__.tableHeaderRow=u},r.printHeaderRow=function(u,d){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var p;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var b=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(b[0],b[1],b[2],b[3],void 0,-1)}this.setFont(void 0,"bold");for(var C=[],w=0;w<this.internal.__cell__.tableHeaderRow.length;w+=1){p=this.internal.__cell__.tableHeaderRow[w].clone(),d&&(p.y=this.internal.__cell__.margins.top||0,C.push(p)),p.lineNumber=u;var M=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),a.call(this,p),this.setTextColor(M)}C.length>0&&this.setTableHeaderRow(C),this.setFont(void 0,"normal"),t=!1}}(Jr.API);var jU={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},$U=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],lC=VU($U),GU=[100,200,300,400,500,600,700,800,900],mde=VU(GU);function cC(r){var e=r.family.replace(/"|'/g,"").toLowerCase(),t=function(s){return jU[s=s||"normal"]?s:"normal"}(r.style),n=function(s){return s?typeof s=="number"?s>=100&&s<=900&&s%100==0?s:400:/^\d00$/.test(s)?parseInt(s):s==="bold"?700:400:400}(r.weight),i=function(s){return typeof lC[s=s||"normal"]=="number"?s:"normal"}(r.stretch);return{family:e,style:t,weight:n,stretch:i,src:r.src||[],ref:r.ref||{name:e,style:[i,t,n].join(" ")}}}function WU(r,e,t,n){var i;for(i=t;i>=0&&i<e.length;i+=n)if(r[e[i]])return r[e[i]];for(i=t;i>=0&&i<e.length;i-=n)if(r[e[i]])return r[e[i]]}var _de={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},qU={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function KU(r){return[r.stretch,r.style,r.weight,r.family].join(" ")}function XU(r){return r.trimLeft()}function yde(r,e){for(var t=0;t<r.length;){if(r.charAt(t)===e)return[r.substring(0,t),r.substring(t+1)];t+=1}return null}function bde(r){var e=r.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],r.substring(e[0].length)]}var Eb,YU,ZU,sg,Sb,JU,eD,tD,rD=["times"];function nD(r,e,t,n){var i=4,s=sD;switch(n){case Jr.API.image_compression.FAST:i=1,s=iD;break;case Jr.API.image_compression.MEDIUM:i=6,s=oD;break;case Jr.API.image_compression.SLOW:i=9,s=aD}r=function(o,u,d,p){for(var b,C=o.length/u,w=new Uint8Array(o.length+C),M=[vde,iD,sD,oD,aD],P=0;P<C;P+=1){var k=P*u,D=o.subarray(k,k+u);if(p)w.set(p(D,d,b),k+P);else{for(var j=M.length,H=[],N=0;N<j;N+=1)H[N]=M[N](D,d,b);var q=xde(H.concat());w.set(H[q],k+P)}b=D}return w}(r,e,t,s);var a=kB(r,{level:i});return Jr.API.__addimage__.arrayBufferToBinaryString(a)}function vde(r){var e=Array.apply([],r);return e.unshift(0),e}function iD(r,e){var t=r.length,n=[];n[0]=1;for(var i=0;i<t;i+=1){var s=r[i-e]||0;n[i+1]=r[i]-s+256&255}return n}function sD(r,e,t){var n=r.length,i=[];i[0]=2;for(var s=0;s<n;s+=1){var a=t&&t[s]||0;i[s+1]=r[s]-a+256&255}return i}function oD(r,e,t){var n=r.length,i=[];i[0]=3;for(var s=0;s<n;s+=1){var a=r[s-e]||0,o=t&&t[s]||0;i[s+1]=r[s]+256-(a+o>>>1)&255}return i}function aD(r,e,t){var n=r.length,i=[];i[0]=4;for(var s=0;s<n;s+=1){var a=wde(r[s-e]||0,t&&t[s]||0,t&&t[s-e]||0);i[s+1]=r[s]-a+256&255}return i}function wde(r,e,t){if(r===e&&e===t)return r;var n=Math.abs(e-t),i=Math.abs(r-t),s=Math.abs(r+e-t-t);return n<=i&&n<=s?r:i<=s?e:t}function xde(r){var e=r.map(function(t){return t.reduce(function(n,i){return n+Math.abs(i)},0)});return e.indexOf(Math.min.apply(null,e))}function uC(r,e,t){var n=e*t,i=Math.floor(n/8),s=16-(n-8*i+t),a=(1<<t)-1;return cD(r,i)>>s&a}function lD(r,e,t,n){var i=t*n,s=Math.floor(i/8),a=16-(i-8*s+n),o=(1<<n)-1,u=(e&o)<<a;(function(d,p,b){if(p+1<d.byteLength)d.setUint16(p,b,!1);else{var C=b>>8&255;d.setUint8(p,C)}})(r,s,cD(r,s)&~(o<<a)&65535|u)}function cD(r,e){return e+1<r.byteLength?r.getUint16(e,!1):r.getUint8(e)<<8}function Bde(r){var e=0;if(r[e++]!==71||r[e++]!==73||r[e++]!==70||r[e++]!==56||(r[e++]+1&253)!=56||r[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=r[e++]|r[e++]<<8,n=r[e++]|r[e++]<<8,i=r[e++],s=i>>7,a=1<<1+(7&i);r[e++],r[e++];var o=null,u=null;s&&(o=e,u=a,e+=3*a);var d=!0,p=[],b=0,C=null,w=0,M=null;for(this.width=t,this.height=n;d&&e<r.length;)switch(r[e++]){case 33:switch(r[e++]){case 255:if(r[e]!==11||r[e+1]==78&&r[e+2]==69&&r[e+3]==84&&r[e+4]==83&&r[e+5]==67&&r[e+6]==65&&r[e+7]==80&&r[e+8]==69&&r[e+9]==50&&r[e+10]==46&&r[e+11]==48&&r[e+12]==3&&r[e+13]==1&&r[e+16]==0)e+=14,M=r[e++]|r[e++]<<8,e++;else for(e+=12;;){if(!((te=r[e++])>=0))throw Error("Invalid block size");if(te===0)break;e+=te}break;case 249:if(r[e++]!==4||r[e+4]!==0)throw new Error("Invalid graphics extension block.");var P=r[e++];b=r[e++]|r[e++]<<8,C=r[e++],1&P||(C=null),w=P>>2&7,e++;break;case 254:for(;;){if(!((te=r[e++])>=0))throw Error("Invalid block size");if(te===0)break;e+=te}break;default:throw new Error("Unknown graphic control label: 0x"+r[e-1].toString(16))}break;case 44:var k=r[e++]|r[e++]<<8,D=r[e++]|r[e++]<<8,j=r[e++]|r[e++]<<8,H=r[e++]|r[e++]<<8,N=r[e++],q=N>>6&1,W=1<<1+(7&N),ie=o,se=u,Z=!1;N>>7&&(Z=!0,ie=e,se=W,e+=3*W);var fe=e;for(e++;;){var te;if(!((te=r[e++])>=0))throw Error("Invalid block size");if(te===0)break;e+=te}p.push({x:k,y:D,width:j,height:H,has_local_palette:Z,palette_offset:ie,palette_size:se,data_offset:fe,data_length:e-fe,transparent_index:C,interlaced:!!q,delay:b,disposal:w});break;case 59:d=!1;break;default:throw new Error("Unknown gif block: 0x"+r[e-1].toString(16))}this.numFrames=function(){return p.length},this.loopCount=function(){return M},this.frameInfo=function(ce){if(ce<0||ce>=p.length)throw new Error("Frame index out of range.");return p[ce]},this.decodeAndBlitFrameBGRA=function(ce,ve){var me=this.frameInfo(ce),qe=me.width*me.height,ot=new Uint8Array(qe);uD(r,me.data_offset,ot,qe);var st=me.palette_offset,Ye=me.transparent_index;Ye===null&&(Ye=256);var Xe=me.width,wt=t-Xe,ht=Xe,he=4*(me.y*t+me.x),Be=4*((me.y+me.height)*t+me.x),Le=he,He=4*wt;me.interlaced===!0&&(He+=4*t*7);for(var rt=8,it=0,Pt=ot.length;it<Pt;++it){var Bt=ot[it];if(ht===0&&(ht=Xe,(Le+=He)>=Be&&(He=4*wt+4*t*(rt-1),Le=he+(Xe+wt)*(rt<<1),rt>>=1)),Bt===Ye)Le+=4;else{var Dt=r[st+3*Bt],Yt=r[st+3*Bt+1],nr=r[st+3*Bt+2];ve[Le++]=nr,ve[Le++]=Yt,ve[Le++]=Dt,ve[Le++]=255}--ht}},this.decodeAndBlitFrameRGBA=function(ce,ve){var me=this.frameInfo(ce),qe=me.width*me.height,ot=new Uint8Array(qe);uD(r,me.data_offset,ot,qe);var st=me.palette_offset,Ye=me.transparent_index;Ye===null&&(Ye=256);var Xe=me.width,wt=t-Xe,ht=Xe,he=4*(me.y*t+me.x),Be=4*((me.y+me.height)*t+me.x),Le=he,He=4*wt;me.interlaced===!0&&(He+=4*t*7);for(var rt=8,it=0,Pt=ot.length;it<Pt;++it){var Bt=ot[it];if(ht===0&&(ht=Xe,(Le+=He)>=Be&&(He=4*wt+4*t*(rt-1),Le=he+(Xe+wt)*(rt<<1),rt>>=1)),Bt===Ye)Le+=4;else{var Dt=r[st+3*Bt],Yt=r[st+3*Bt+1],nr=r[st+3*Bt+2];ve[Le++]=Dt,ve[Le++]=Yt,ve[Le++]=nr,ve[Le++]=255}--ht}}}function uD(r,e,t,n){for(var i=r[e++],s=1<<i,a=s+1,o=a+1,u=i+1,d=(1<<u)-1,p=0,b=0,C=0,w=r[e++],M=new Int32Array(4096),P=null;;){for(;p<16&&w!==0;)b|=r[e++]<<p,p+=8,w===1?w=r[e++]:--w;if(p<u)break;var k=b&d;if(b>>=u,p-=u,k!==s){if(k===a)break;for(var D=k<o?k:P,j=0,H=D;H>s;)H=M[H]>>8,++j;var N=H;if(C+j+(D!==k?1:0)>n)return void Ui.log("Warning, gif stream longer than expected.");t[C++]=N;var q=C+=j;for(D!==k&&(t[C++]=N),H=D;j--;)H=M[H],t[--q]=255&H,H>>=8;P!==null&&o<4096&&(M[o++]=P<<8|N,o>=d+1&&u<12&&(++u,d=d<<1|1)),P=k}else o=a+1,d=(1<<(u=i+1))-1,P=null}return C!==n&&Ui.log("Warning, gif stream shorter than expected."),t}/**
	 * @license
	  Copyright (c) 2008, Adobe Systems Incorporated
	  All rights reserved.

	  Redistribution and use in source and binary forms, with or without 
	  modification, are permitted provided that the following conditions are
	  met:

	  * Redistributions of source code must retain the above copyright notice, 
	    this list of conditions and the following disclaimer.
	  
	  * Redistributions in binary form must reproduce the above copyright
	    notice, this list of conditions and the following disclaimer in the 
	    documentation and/or other materials provided with the distribution.
	  
	  * Neither the name of Adobe Systems Incorporated nor the names of its 
	    contributors may be used to endorse or promote products derived from 
	    this software without specific prior written permission.

	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
	  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
	  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
	  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
	  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
	  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
	  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
	  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
	  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/function hC(r){var e,t,n,i,s,a=Math.floor,o=new Array(64),u=new Array(64),d=new Array(64),p=new Array(64),b=new Array(65535),C=new Array(65535),w=new Array(64),M=new Array(64),P=[],k=0,D=7,j=new Array(64),H=new Array(64),N=new Array(64),q=new Array(256),W=new Array(2048),ie=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],se=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],Z=[0,1,2,3,4,5,6,7,8,9,10,11],fe=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],te=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],ce=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],ve=[0,1,2,3,4,5,6,7,8,9,10,11],me=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],qe=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ot(he,Be){for(var Le=0,He=0,rt=new Array,it=1;it<=16;it++){for(var Pt=1;Pt<=he[it];Pt++)rt[Be[He]]=[],rt[Be[He]][0]=Le,rt[Be[He]][1]=it,He++,Le++;Le*=2}return rt}function st(he){for(var Be=he[0],Le=he[1]-1;Le>=0;)Be&1<<Le&&(k|=1<<D),Le--,--D<0&&(k==255?(Ye(255),Ye(0)):Ye(k),D=7,k=0)}function Ye(he){P.push(he)}function Xe(he){Ye(he>>8&255),Ye(255&he)}function wt(he,Be,Le,He,rt){for(var it,Pt=rt[0],Bt=rt[240],Dt=function(Kt,Br){var ar,Lr,vr,kt,ir,hr,Mr,Cr,wr,Ne,re=0;for(wr=0;wr<8;++wr){ar=Kt[re],Lr=Kt[re+1],vr=Kt[re+2],kt=Kt[re+3],ir=Kt[re+4],hr=Kt[re+5],Mr=Kt[re+6];var ae=ar+(Cr=Kt[re+7]),ge=ar-Cr,xe=Lr+Mr,Me=Lr-Mr,We=vr+hr,nt=vr-hr,Ge=kt+ir,lt=kt-ir,Lt=ae+Ge,Ft=ae-Ge,Wt=xe+We,Ze=xe-We;Kt[re]=Lt+Wt,Kt[re+4]=Lt-Wt;var Sr=.707106781*(Ze+Ft);Kt[re+2]=Ft+Sr,Kt[re+6]=Ft-Sr;var an=.382683433*((Lt=lt+nt)-(Ze=Me+ge)),yr=.5411961*Lt+an,sn=1.306562965*Ze+an,fn=.707106781*(Wt=nt+Me),Ir=ge+fn,Gn=ge-fn;Kt[re+5]=Gn+yr,Kt[re+3]=Gn-yr,Kt[re+1]=Ir+sn,Kt[re+7]=Ir-sn,re+=8}for(re=0,wr=0;wr<8;++wr){ar=Kt[re],Lr=Kt[re+8],vr=Kt[re+16],kt=Kt[re+24],ir=Kt[re+32],hr=Kt[re+40],Mr=Kt[re+48];var ii=ar+(Cr=Kt[re+56]),On=ar-Cr,pn=Lr+Mr,ln=Lr-Mr,Ot=vr+hr,vn=vr-hr,wi=kt+ir,Qs=kt-ir,Un=ii+wi,er=ii-wi,Xr=pn+Ot,Zr=pn-Ot;Kt[re]=Un+Xr,Kt[re+32]=Un-Xr;var yi=.707106781*(Zr+er);Kt[re+16]=er+yi,Kt[re+48]=er-yi;var Xo=.382683433*((Un=Qs+vn)-(Zr=ln+On)),Ke=.5411961*Un+Xo,Vt=1.306562965*Zr+Xo,Ar=.707106781*(Xr=vn+ln),xn=On+Ar,Jn=On-Ar;Kt[re+40]=Jn+Ke,Kt[re+24]=Jn-Ke,Kt[re+8]=xn+Vt,Kt[re+56]=xn-Vt,re++}for(wr=0;wr<64;++wr)Ne=Kt[wr]*Br[wr],w[wr]=Ne>0?Ne+.5|0:Ne-.5|0;return w}(he,Be),Yt=0;Yt<64;++Yt)M[ie[Yt]]=Dt[Yt];var nr=M[0]-Le;Le=M[0],nr==0?st(He[0]):(st(He[C[it=32767+nr]]),st(b[it]));for(var ur=63;ur>0&&M[ur]==0;)ur--;if(ur==0)return st(Pt),Le;for(var xt,Re=1;Re<=ur;){for(var Kr=Re;M[Re]==0&&Re<=ur;)++Re;var Ur=Re-Kr;if(Ur>=16){xt=Ur>>4;for(var Er=1;Er<=xt;++Er)st(Bt);Ur&=15}it=32767+M[Re],st(rt[(Ur<<4)+C[it]]),st(b[it]),Re++}return ur!=63&&st(Pt),Le}function ht(he){he=Math.min(Math.max(he,1),100),s!=he&&(function(Be){for(var Le=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],He=0;He<64;He++){var rt=a((Le[He]*Be+50)/100);rt=Math.min(Math.max(rt,1),255),o[ie[He]]=rt}for(var it=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Pt=0;Pt<64;Pt++){var Bt=a((it[Pt]*Be+50)/100);Bt=Math.min(Math.max(Bt,1),255),u[ie[Pt]]=Bt}for(var Dt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Yt=0,nr=0;nr<8;nr++)for(var ur=0;ur<8;ur++)d[Yt]=1/(o[ie[Yt]]*Dt[nr]*Dt[ur]*8),p[Yt]=1/(u[ie[Yt]]*Dt[nr]*Dt[ur]*8),Yt++}(he<50?Math.floor(5e3/he):Math.floor(200-2*he)),s=he)}this.encode=function(he,Be){Be&&ht(Be),P=new Array,k=0,D=7,Xe(65496),Xe(65504),Xe(16),Ye(74),Ye(70),Ye(73),Ye(70),Ye(0),Ye(1),Ye(1),Ye(0),Xe(1),Xe(1),Ye(0),Ye(0),function(){Xe(65499),Xe(132),Ye(0);for(var Lr=0;Lr<64;Lr++)Ye(o[Lr]);Ye(1);for(var vr=0;vr<64;vr++)Ye(u[vr])}(),function(Lr,vr){Xe(65472),Xe(17),Ye(8),Xe(vr),Xe(Lr),Ye(3),Ye(1),Ye(17),Ye(0),Ye(2),Ye(17),Ye(1),Ye(3),Ye(17),Ye(1)}(he.width,he.height),function(){Xe(65476),Xe(418),Ye(0);for(var Lr=0;Lr<16;Lr++)Ye(se[Lr+1]);for(var vr=0;vr<=11;vr++)Ye(Z[vr]);Ye(16);for(var kt=0;kt<16;kt++)Ye(fe[kt+1]);for(var ir=0;ir<=161;ir++)Ye(te[ir]);Ye(1);for(var hr=0;hr<16;hr++)Ye(ce[hr+1]);for(var Mr=0;Mr<=11;Mr++)Ye(ve[Mr]);Ye(17);for(var Cr=0;Cr<16;Cr++)Ye(me[Cr+1]);for(var wr=0;wr<=161;wr++)Ye(qe[wr])}(),Xe(65498),Xe(12),Ye(3),Ye(1),Ye(0),Ye(2),Ye(17),Ye(3),Ye(17),Ye(0),Ye(63),Ye(0);var Le=0,He=0,rt=0;k=0,D=7,this.encode.displayName="_encode_";for(var it,Pt,Bt,Dt,Yt,nr,ur,xt,Re,Kr=he.data,Ur=he.width,Er=he.height,Kt=4*Ur,Br=0;Br<Er;){for(it=0;it<Kt;){for(Yt=Kt*Br+it,ur=-1,xt=0,Re=0;Re<64;Re++)nr=Yt+(xt=Re>>3)*Kt+(ur=4*(7&Re)),Br+xt>=Er&&(nr-=Kt*(Br+1+xt-Er)),it+ur>=Kt&&(nr-=it+ur-Kt+4),Pt=Kr[nr++],Bt=Kr[nr++],Dt=Kr[nr++],j[Re]=(W[Pt]+W[Bt+256|0]+W[Dt+512|0]>>16)-128,H[Re]=(W[Pt+768|0]+W[Bt+1024|0]+W[Dt+1280|0]>>16)-128,N[Re]=(W[Pt+1280|0]+W[Bt+1536|0]+W[Dt+1792|0]>>16)-128;Le=wt(j,d,Le,e,n),He=wt(H,p,He,t,i),rt=wt(N,p,rt,t,i),it+=32}Br+=8}if(D>=0){var ar=[];ar[1]=D+1,ar[0]=(1<<D+1)-1,st(ar)}return Xe(65497),new Uint8Array(P)},r=r||50,function(){for(var he=String.fromCharCode,Be=0;Be<256;Be++)q[Be]=he(Be)}(),e=ot(se,Z),t=ot(ce,ve),n=ot(fe,te),i=ot(me,qe),function(){for(var he=1,Be=2,Le=1;Le<=15;Le++){for(var He=he;He<Be;He++)C[32767+He]=Le,b[32767+He]=[],b[32767+He][1]=Le,b[32767+He][0]=He;for(var rt=-(Be-1);rt<=-he;rt++)C[32767+rt]=Le,b[32767+rt]=[],b[32767+rt][1]=Le,b[32767+rt][0]=Be-1+rt;he<<=1,Be<<=1}}(),function(){for(var he=0;he<256;he++)W[he]=19595*he,W[he+256|0]=38470*he,W[he+512|0]=7471*he+32768,W[he+768|0]=-11059*he,W[he+1024|0]=-21709*he,W[he+1280|0]=32768*he+8421375,W[he+1536|0]=-27439*he,W[he+1792|0]=-5329*he}(),ht(r)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function Xc(r,e){if(this.pos=0,this.buffer=r,this.datav=new DataView(r.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function hD(r){function e(Z){if(!Z)throw Error("assert :P")}function t(Z,fe,te){for(var ce=0;4>ce;ce++)if(Z[fe+ce]!=te.charCodeAt(ce))return!0;return!1}function n(Z,fe,te,ce,ve){for(var me=0;me<ve;me++)Z[fe+me]=te[ce+me]}function i(Z,fe,te,ce){for(var ve=0;ve<ce;ve++)Z[fe+ve]=te}function s(Z){return new Int32Array(Z)}function a(Z,fe){for(var te=[],ce=0;ce<Z;ce++)te.push(new fe);return te}function o(Z,fe){var te=[];return function ce(ve,me,qe){for(var ot=qe[me],st=0;st<ot&&(ve.push(qe.length>me+1?[]:new fe),!(qe.length<me+1));st++)ce(ve[st],me+1,qe)}(te,0,Z),te}var u=function(){var Z=this;function fe(I,L){for(var $=1<<L-1>>>0;I&$;)$>>>=1;return $?(I&$-1)+$:I}function te(I,L,$,Y,Ae){e(!(Y%$));do I[L+(Y-=$)]=Ae;while(0<Y)}function ce(I,L,$,Y,Ae){if(e(2328>=Ae),512>=Ae)var _e=s(512);else if((_e=s(Ae))==null)return 0;return function(ye,we,Te,be,ct,Et){var ke,ft,_t=we,Nt=1<<Te,ut=s(16),zt=s(16);for(e(ct!=0),e(be!=null),e(ye!=null),e(0<Te),ft=0;ft<ct;++ft){if(15<be[ft])return 0;++ut[be[ft]]}if(ut[0]==ct)return 0;for(zt[1]=0,ke=1;15>ke;++ke){if(ut[ke]>1<<ke)return 0;zt[ke+1]=zt[ke]+ut[ke]}for(ft=0;ft<ct;++ft)ke=be[ft],0<be[ft]&&(Et[zt[ke]++]=ft);if(zt[15]==1)return(be=new ve).g=0,be.value=Et[0],te(ye,_t,1,Nt,be),Nt;var Gt,sr=-1,tr=Nt-1,Wr=0,Fr=1,mn=1,zr=1<<Te;for(ft=0,ke=1,ct=2;ke<=Te;++ke,ct<<=1){if(Fr+=mn<<=1,0>(mn-=ut[ke]))return 0;for(;0<ut[ke];--ut[ke])(be=new ve).g=ke,be.value=Et[ft++],te(ye,_t+Wr,ct,zr,be),Wr=fe(Wr,ke)}for(ke=Te+1,ct=2;15>=ke;++ke,ct<<=1){if(Fr+=mn<<=1,0>(mn-=ut[ke]))return 0;for(;0<ut[ke];--ut[ke]){if(be=new ve,(Wr&tr)!=sr){for(_t+=zr,Gt=1<<(sr=ke)-Te;15>sr&&!(0>=(Gt-=ut[sr]));)++sr,Gt<<=1;Nt+=zr=1<<(Gt=sr-Te),ye[we+(sr=Wr&tr)].g=Gt+Te,ye[we+sr].value=_t-we-sr}be.g=ke-Te,be.value=Et[ft++],te(ye,_t+(Wr>>Te),ct,zr,be),Wr=fe(Wr,ke)}}return Fr!=2*zt[15]-1?0:Nt}(I,L,$,Y,Ae,_e)}function ve(){this.value=this.g=0}function me(){this.value=this.g=0}function qe(){this.G=a(5,ve),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=a(ds,me)}function ot(I,L,$,Y){e(I!=null),e(L!=null),e(2147483648>Y),I.Ca=254,I.I=0,I.b=-8,I.Ka=0,I.oa=L,I.pa=$,I.Jd=L,I.Yc=$+Y,I.Zc=4<=Y?$+Y-4+1:$,Pt(I)}function st(I,L){for(var $=0;0<L--;)$|=Dt(I,128)<<L;return $}function Ye(I,L){var $=st(I,L);return Bt(I)?-$:$}function Xe(I,L,$,Y){var Ae,_e=0;for(e(I!=null),e(L!=null),e(4294967288>Y),I.Sb=Y,I.Ra=0,I.u=0,I.h=0,4<Y&&(Y=4),Ae=0;Ae<Y;++Ae)_e+=L[$+Ae]<<8*Ae;I.Ra=_e,I.bb=Y,I.oa=L,I.pa=$}function wt(I){for(;8<=I.u&&I.bb<I.Sb;)I.Ra>>>=8,I.Ra+=I.oa[I.pa+I.bb]<<wa-8>>>0,++I.bb,I.u-=8;He(I)&&(I.h=1,I.u=0)}function ht(I,L){if(e(0<=L),!I.h&&L<=ah){var $=Le(I)&zl[L];return I.u+=L,wt(I),$}return I.h=1,I.u=0}function he(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Be(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Le(I){return I.Ra>>>(I.u&wa-1)>>>0}function He(I){return e(I.bb<=I.Sb),I.h||I.bb==I.Sb&&I.u>wa}function rt(I,L){I.u=L,I.h=He(I)}function it(I){I.u>=Ji&&(e(I.u>=Ji),wt(I))}function Pt(I){e(I!=null&&I.oa!=null),I.pa<I.Zc?(I.I=(I.oa[I.pa++]|I.I<<8)>>>0,I.b+=8):(e(I!=null&&I.oa!=null),I.pa<I.Yc?(I.b+=8,I.I=I.oa[I.pa++]|I.I<<8):I.Ka?I.b=0:(I.I<<=8,I.b+=8,I.Ka=1))}function Bt(I){return st(I,1)}function Dt(I,L){var $=I.Ca;0>I.b&&Pt(I);var Y=I.b,Ae=$*L>>>8,_e=(I.I>>>Y>Ae)+0;for(_e?($-=Ae,I.I-=Ae+1<<Y>>>0):$=Ae+1,Y=$,Ae=0;256<=Y;)Ae+=8,Y>>=8;return Y=7^Ae+bc[Y],I.b-=Y,I.Ca=($<<Y)-1,_e}function Yt(I,L,$){I[L+0]=$>>24&255,I[L+1]=$>>16&255,I[L+2]=$>>8&255,I[L+3]=255&$}function nr(I,L){return I[L+0]|I[L+1]<<8}function ur(I,L){return nr(I,L)|I[L+2]<<16}function xt(I,L){return nr(I,L)|nr(I,L+2)<<16}function Re(I,L){var $=1<<L;return e(I!=null),e(0<L),I.X=s($),I.X==null?0:(I.Mb=32-L,I.Xa=L,1)}function Kr(I,L){e(I!=null),e(L!=null),e(I.Xa==L.Xa),n(L.X,0,I.X,0,1<<L.Xa)}function Ur(){this.X=[],this.Xa=this.Mb=0}function Er(I,L,$,Y){e($!=null),e(Y!=null);var Ae=$[0],_e=Y[0];return Ae==0&&(Ae=(I*_e+L/2)/L),_e==0&&(_e=(L*Ae+I/2)/I),0>=Ae||0>=_e?0:($[0]=Ae,Y[0]=_e,1)}function Kt(I,L){return I+(1<<L)-1>>>L}function Br(I,L){return((4278255360&I)+(4278255360&L)>>>0&4278255360)+((16711935&I)+(16711935&L)>>>0&16711935)>>>0}function ar(I,L){Z[L]=function($,Y,Ae,_e,ye,we,Te){var be;for(be=0;be<ye;++be){var ct=Z[I](we[Te+be-1],Ae,_e+be);we[Te+be]=Br($[Y+be],ct)}}}function Lr(){this.ud=this.hd=this.jd=0}function vr(I,L){return((4278124286&(I^L))>>>1)+(I&L)>>>0}function kt(I){return 0<=I&&256>I?I:0>I?0:255<I?255:void 0}function ir(I,L){return kt(I+(I-L+.5>>1))}function hr(I,L,$){return Math.abs(L-$)-Math.abs(I-$)}function Mr(I,L,$,Y,Ae,_e,ye){for(Y=_e[ye-1],$=0;$<Ae;++$)_e[ye+$]=Y=Br(I[L+$],Y)}function Cr(I,L,$,Y,Ae){var _e;for(_e=0;_e<$;++_e){var ye=I[L+_e],we=ye>>8&255,Te=16711935&(Te=(Te=16711935&ye)+((we<<16)+we));Y[Ae+_e]=(4278255360&ye)+Te>>>0}}function wr(I,L){L.jd=255&I,L.hd=I>>8&255,L.ud=I>>16&255}function Ne(I,L,$,Y,Ae,_e){var ye;for(ye=0;ye<Y;++ye){var we=L[$+ye],Te=we>>>8,be=we,ct=255&(ct=(ct=we>>>16)+((I.jd<<24>>24)*(Te<<24>>24)>>>5));be=255&(be=(be+=(I.hd<<24>>24)*(Te<<24>>24)>>>5)+((I.ud<<24>>24)*(ct<<24>>24)>>>5)),Ae[_e+ye]=(4278255360&we)+(ct<<16)+be}}function re(I,L,$,Y,Ae){Z[L]=function(_e,ye,we,Te,be,ct,Et,ke,ft){for(Te=Et;Te<ke;++Te)for(Et=0;Et<ft;++Et)be[ct++]=Ae(we[Y(_e[ye++])])},Z[I]=function(_e,ye,we,Te,be,ct,Et){var ke=8>>_e.b,ft=_e.Ea,_t=_e.K[0],Nt=_e.w;if(8>ke)for(_e=(1<<_e.b)-1,Nt=(1<<ke)-1;ye<we;++ye){var ut,zt=0;for(ut=0;ut<ft;++ut)ut&_e||(zt=Y(Te[be++])),ct[Et++]=Ae(_t[zt&Nt]),zt>>=ke}else Z["VP8LMapColor"+$](Te,be,_t,Nt,ct,Et,ye,we,ft)}}function ae(I,L,$,Y,Ae){for($=L+$;L<$;){var _e=I[L++];Y[Ae++]=_e>>16&255,Y[Ae++]=_e>>8&255,Y[Ae++]=255&_e}}function ge(I,L,$,Y,Ae){for($=L+$;L<$;){var _e=I[L++];Y[Ae++]=_e>>16&255,Y[Ae++]=_e>>8&255,Y[Ae++]=255&_e,Y[Ae++]=_e>>24&255}}function xe(I,L,$,Y,Ae){for($=L+$;L<$;){var _e=(ye=I[L++])>>16&240|ye>>12&15,ye=240&ye|ye>>28&15;Y[Ae++]=_e,Y[Ae++]=ye}}function Me(I,L,$,Y,Ae){for($=L+$;L<$;){var _e=(ye=I[L++])>>16&248|ye>>13&7,ye=ye>>5&224|ye>>3&31;Y[Ae++]=_e,Y[Ae++]=ye}}function We(I,L,$,Y,Ae){for($=L+$;L<$;){var _e=I[L++];Y[Ae++]=255&_e,Y[Ae++]=_e>>8&255,Y[Ae++]=_e>>16&255}}function nt(I,L,$,Y,Ae,_e){if(_e==0)for($=L+$;L<$;)Yt(Y,((_e=I[L++])[0]>>24|_e[1]>>8&65280|_e[2]<<8&16711680|_e[3]<<24)>>>0),Ae+=32;else n(Y,Ae,I,L,$)}function Ge(I,L){Z[L][0]=Z[I+"0"],Z[L][1]=Z[I+"1"],Z[L][2]=Z[I+"2"],Z[L][3]=Z[I+"3"],Z[L][4]=Z[I+"4"],Z[L][5]=Z[I+"5"],Z[L][6]=Z[I+"6"],Z[L][7]=Z[I+"7"],Z[L][8]=Z[I+"8"],Z[L][9]=Z[I+"9"],Z[L][10]=Z[I+"10"],Z[L][11]=Z[I+"11"],Z[L][12]=Z[I+"12"],Z[L][13]=Z[I+"13"],Z[L][14]=Z[I+"0"],Z[L][15]=Z[I+"0"]}function lt(I){return I==Ah||I==fh||I==vu||I==dh}function Lt(){this.eb=[],this.size=this.A=this.fb=0}function Ft(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Wt(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Lt,this.f.kb=new Ft,this.sd=null}function Ze(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Sr(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function an(I){return alert("todo:WebPSamplerProcessPlane"),I.T}function yr(I,L){var $=I.T,Y=L.ba.f.RGBA,Ae=Y.eb,_e=Y.fb+I.ka*Y.A,ye=To[L.ba.S],we=I.y,Te=I.O,be=I.f,ct=I.N,Et=I.ea,ke=I.W,ft=L.cc,_t=L.dc,Nt=L.Mc,ut=L.Nc,zt=I.ka,Gt=I.ka+I.T,sr=I.U,tr=sr+1>>1;for(zt==0?ye(we,Te,null,null,be,ct,Et,ke,be,ct,Et,ke,Ae,_e,null,null,sr):(ye(L.ec,L.fc,we,Te,ft,_t,Nt,ut,be,ct,Et,ke,Ae,_e-Y.A,Ae,_e,sr),++$);zt+2<Gt;zt+=2)ft=be,_t=ct,Nt=Et,ut=ke,ct+=I.Rc,ke+=I.Rc,_e+=2*Y.A,ye(we,(Te+=2*I.fa)-I.fa,we,Te,ft,_t,Nt,ut,be,ct,Et,ke,Ae,_e-Y.A,Ae,_e,sr);return Te+=I.fa,I.j+Gt<I.o?(n(L.ec,L.fc,we,Te,sr),n(L.cc,L.dc,be,ct,tr),n(L.Mc,L.Nc,Et,ke,tr),$--):1&Gt||ye(we,Te,null,null,be,ct,Et,ke,be,ct,Et,ke,Ae,_e+Y.A,null,null,sr),$}function sn(I,L,$){var Y=I.F,Ae=[I.J];if(Y!=null){var _e=I.U,ye=L.ba.S,we=ye==AA||ye==vu;L=L.ba.f.RGBA;var Te=[0],be=I.ka;Te[0]=I.T,I.Kb&&(be==0?--Te[0]:(--be,Ae[0]-=I.width),I.j+I.ka+I.T==I.o&&(Te[0]=I.o-I.j-be));var ct=L.eb;be=L.fb+be*L.A,I=Cc(Y,Ae[0],I.width,_e,Te,ct,be+(we?0:3),L.A),e($==Te),I&&lt(ye)&&uh(ct,be,we,_e,Te,L.A)}return 0}function fn(I){var L=I.ma,$=L.ba.S,Y=11>$,Ae=$==ff||$==Ec||$==AA||$==kd||$==12||lt($);if(L.memory=null,L.Ib=null,L.Jb=null,L.Nd=null,!wo(L.Oa,I,Ae?11:12))return 0;if(Ae&&lt($)&&mc(),I.da)alert("todo:use_scaling");else{if(Y){if(L.Ib=an,I.Kb){if($=I.U+1>>1,L.memory=s(I.U+2*$),L.memory==null)return 0;L.ec=L.memory,L.fc=0,L.cc=L.ec,L.dc=L.fc+I.U,L.Mc=L.cc,L.Nc=L.dc+$,L.Ib=yr,mc()}}else alert("todo:EmitYUV");Ae&&(L.Jb=sn,Y&&ba())}if(Y&&!Gd){for(I=0;256>I;++I)Pg[I]=89858*(I-128)+_A>>_h,Rg[I]=-22014*(I-128)+_A,Fg[I]=-45773*(I-128),Mg[I]=113618*(I-128)+_A>>_h;for(I=Cu;I<gl;++I)L=76283*(I-16)+_A>>_h,Lg[I-Cu]=Is(L,255),bh[I-Cu]=Is(L+8>>4,15);Gd=1}return 1}function Ir(I){var L=I.ma,$=I.U,Y=I.T;return e(!(1&I.ka)),0>=$||0>=Y?0:($=L.Ib(I,L),L.Jb!=null&&L.Jb(I,L,$),L.Dc+=$,1)}function Gn(I){I.ma.memory=null}function ii(I,L,$,Y){return ht(I,8)!=47?0:(L[0]=ht(I,14)+1,$[0]=ht(I,14)+1,Y[0]=ht(I,1),ht(I,3)!=0?0:!I.h)}function On(I,L){if(4>I)return I+1;var $=I-2>>1;return(2+(1&I)<<$)+ht(L,$)+1}function pn(I,L){return 120<L?L-120:1<=($=(($=pf[L-1])>>4)*I+(8-(15&$)))?$:1;var $}function ln(I,L,$){var Y=Le($),Ae=I[L+=255&Y].g-8;return 0<Ae&&(rt($,$.u+8),Y=Le($),L+=I[L].value,L+=Y&(1<<Ae)-1),rt($,$.u+I[L].g),I[L].value}function Ot(I,L,$){return $.g+=I.g,$.value+=I.value<<L>>>0,e(8>=$.g),I.g}function vn(I,L,$){var Y=I.xc;return e((L=Y==0?0:I.vc[I.md*($>>Y)+(L>>Y)])<I.Wb),I.Ya[L]}function wi(I,L,$,Y){var Ae=I.ab,_e=I.c*L,ye=I.C;L=ye+L;var we=$,Te=Y;for(Y=I.Ta,$=I.Ua;0<Ae--;){var be=I.gc[Ae],ct=ye,Et=L,ke=we,ft=Te,_t=(Te=Y,we=$,be.Ea);switch(e(ct<Et),e(Et<=be.nc),be.hc){case 2:gu(ke,ft,(Et-ct)*_t,Te,we);break;case 0:var Nt=ct,ut=Et,zt=Te,Gt=we,sr=(zr=be).Ea;Nt==0&&(Ga(ke,ft,null,null,1,zt,Gt),Mr(ke,ft+1,0,0,sr-1,zt,Gt+1),ft+=sr,Gt+=sr,++Nt);for(var tr=1<<zr.b,Wr=tr-1,Fr=Kt(sr,zr.b),mn=zr.K,zr=zr.w+(Nt>>zr.b)*Fr;Nt<ut;){var Fn=mn,cs=zr,wn=1;for(hl(ke,ft,zt,Gt-sr,1,zt,Gt);wn<sr;){var jr=(wn&~Wr)+tr;jr>sr&&(jr=sr),(0,Al[Fn[cs++]>>8&15])(ke,ft+ +wn,zt,Gt+wn-sr,jr-wn,zt,Gt+wn),wn=jr}ft+=sr,Gt+=sr,++Nt&Wr||(zr+=Fr)}Et!=be.nc&&n(Te,we-_t,Te,we+(Et-ct-1)*_t,_t);break;case 1:for(_t=ke,ut=ft,sr=(ke=be.Ea)-(Gt=ke&~(zt=(ft=1<<be.b)-1)),Nt=Kt(ke,be.b),tr=be.K,be=be.w+(ct>>be.b)*Nt;ct<Et;){for(Wr=tr,Fr=be,mn=new Lr,zr=ut+Gt,Fn=ut+ke;ut<zr;)wr(Wr[Fr++],mn),Ps(mn,_t,ut,ft,Te,we),ut+=ft,we+=ft;ut<Fn&&(wr(Wr[Fr++],mn),Ps(mn,_t,ut,sr,Te,we),ut+=sr,we+=sr),++ct&zt||(be+=Nt)}break;case 3:if(ke==Te&&ft==we&&0<be.b){for(ut=Te,ke=_t=we+(Et-ct)*_t-(Gt=(Et-ct)*Kt(be.Ea,be.b)),ft=Te,zt=we,Nt=[],Gt=(sr=Gt)-1;0<=Gt;--Gt)Nt[Gt]=ft[zt+Gt];for(Gt=sr-1;0<=Gt;--Gt)ut[ke+Gt]=Nt[Gt];mu(be,ct,Et,Te,_t,Te,we)}else mu(be,ct,Et,ke,ft,Te,we)}we=Y,Te=$}Te!=$&&n(Y,$,we,Te,_e)}function Qs(I,L){var $=I.V,Y=I.Ba+I.c*I.C,Ae=L-I.C;if(e(L<=I.l.o),e(16>=Ae),0<Ae){var _e=I.l,ye=I.Ta,we=I.Ua,Te=_e.width;if(wi(I,Ae,$,Y),Ae=we=[we],e(($=I.C)<(Y=L)),e(_e.v<_e.va),Y>_e.o&&(Y=_e.o),$<_e.j){var be=_e.j-$;$=_e.j,Ae[0]+=be*Te}if($>=Y?$=0:(Ae[0]+=4*_e.v,_e.ka=$-_e.j,_e.U=_e.va-_e.v,_e.T=Y-$,$=1),$){if(we=we[0],11>($=I.ca).S){var ct=$.f.RGBA,Et=(Y=$.S,Ae=_e.U,_e=_e.T,be=ct.eb,ct.A),ke=_e;for(ct=ct.fb+I.Ma*ct.A;0<ke--;){var ft=ye,_t=we,Nt=Ae,ut=be,zt=ct;switch(Y){case Hl:_u(ft,_t,Nt,ut,zt);break;case ff:Bo(ft,_t,Nt,ut,zt);break;case Ah:Bo(ft,_t,Nt,ut,zt),uh(ut,zt,0,Nt,1,0);break;case Dd:Gr(ft,_t,Nt,ut,zt);break;case Ec:nt(ft,_t,Nt,ut,zt,1);break;case fh:nt(ft,_t,Nt,ut,zt,1),uh(ut,zt,0,Nt,1,0);break;case AA:nt(ft,_t,Nt,ut,zt,0);break;case vu:nt(ft,_t,Nt,ut,zt,0),uh(ut,zt,1,Nt,1,0);break;case kd:xa(ft,_t,Nt,ut,zt);break;case dh:xa(ft,_t,Nt,ut,zt),Af(ut,zt,Nt,1,0);break;case Nd:Ai(ft,_t,Nt,ut,zt);break;default:e(0)}we+=Te,ct+=Et}I.Ma+=_e}else alert("todo:EmitRescaledRowsYUVA");e(I.Ma<=$.height)}}I.C=L,e(I.C<=I.i)}function Un(I){var L;if(0<I.ua)return 0;for(L=0;L<I.Wb;++L){var $=I.Ya[L].G,Y=I.Ya[L].H;if(0<$[1][Y[1]+0].g||0<$[2][Y[2]+0].g||0<$[3][Y[3]+0].g)return 0}return 1}function er(I,L,$,Y,Ae,_e){if(I.Z!=0){var ye=I.qd,we=I.rd;for(e(pl[I.Z]!=null);L<$;++L)pl[I.Z](ye,we,Y,Ae,Y,Ae,_e),ye=Y,we=Ae,Ae+=_e;I.qd=ye,I.rd=we}}function Xr(I,L){var $=I.l.ma,Y=$.Z==0||$.Z==1?I.l.j:I.C;if(Y=I.C<Y?Y:I.C,e(L<=I.l.o),L>Y){var Ae=I.l.width,_e=$.ca,ye=$.tb+Ae*Y,we=I.V,Te=I.Ba+I.c*Y,be=I.gc;e(I.ab==1),e(be[0].hc==3),wc(be[0],Y,L,we,Te,_e,ye),er($,Y,L,_e,ye,Ae)}I.C=I.Ma=L}function Zr(I,L,$,Y,Ae,_e,ye){var we=I.$/Y,Te=I.$%Y,be=I.m,ct=I.s,Et=$+I.$,ke=Et;Ae=$+Y*Ae;var ft=$+Y*_e,_t=280+ct.ua,Nt=I.Pb?we:16777216,ut=0<ct.ua?ct.Wa:null,zt=ct.wc,Gt=Et<ft?vn(ct,Te,we):null;e(I.C<_e),e(ft<=Ae);var sr=!1;e:for(;;){for(;sr||Et<ft;){var tr=0;if(we>=Nt){var Wr=Et-$;e((Nt=I).Pb),Nt.wd=Nt.m,Nt.xd=Wr,0<Nt.s.ua&&Kr(Nt.s.Wa,Nt.s.vb),Nt=we+gf}if(Te&zt||(Gt=vn(ct,Te,we)),e(Gt!=null),Gt.Qb&&(L[Et]=Gt.qb,sr=!0),!sr)if(it(be),Gt.jc){tr=be,Wr=L;var Fr=Et,mn=Gt.pd[Le(tr)&ds-1];e(Gt.jc),256>mn.g?(rt(tr,tr.u+mn.g),Wr[Fr]=mn.value,tr=0):(rt(tr,tr.u+mn.g-256),e(256<=mn.value),tr=mn.value),tr==0&&(sr=!0)}else tr=ln(Gt.G[0],Gt.H[0],be);if(be.h)break;if(sr||256>tr){if(!sr)if(Gt.nd)L[Et]=(Gt.qb|tr<<8)>>>0;else{if(it(be),sr=ln(Gt.G[1],Gt.H[1],be),it(be),Wr=ln(Gt.G[2],Gt.H[2],be),Fr=ln(Gt.G[3],Gt.H[3],be),be.h)break;L[Et]=(Fr<<24|sr<<16|tr<<8|Wr)>>>0}if(sr=!1,++Et,++Te>=Y&&(Te=0,++we,ye!=null&&we<=_e&&!(we%16)&&ye(I,we),ut!=null))for(;ke<Et;)tr=L[ke++],ut.X[(506832829*tr&4294967295)>>>ut.Mb]=tr}else if(280>tr){if(tr=On(tr-256,be),Wr=ln(Gt.G[4],Gt.H[4],be),it(be),Wr=pn(Y,Wr=On(Wr,be)),be.h)break;if(Et-$<Wr||Ae-Et<tr)break e;for(Fr=0;Fr<tr;++Fr)L[Et+Fr]=L[Et+Fr-Wr];for(Et+=tr,Te+=tr;Te>=Y;)Te-=Y,++we,ye!=null&&we<=_e&&!(we%16)&&ye(I,we);if(e(Et<=Ae),Te&zt&&(Gt=vn(ct,Te,we)),ut!=null)for(;ke<Et;)tr=L[ke++],ut.X[(506832829*tr&4294967295)>>>ut.Mb]=tr}else{if(!(tr<_t))break e;for(sr=tr-280,e(ut!=null);ke<Et;)tr=L[ke++],ut.X[(506832829*tr&4294967295)>>>ut.Mb]=tr;tr=Et,e(!(sr>>>(Wr=ut).Xa)),L[tr]=Wr.X[sr],sr=!0}sr||e(be.h==He(be))}if(I.Pb&&be.h&&Et<Ae)e(I.m.h),I.a=5,I.m=I.wd,I.$=I.xd,0<I.s.ua&&Kr(I.s.vb,I.s.Wa);else{if(be.h)break e;ye?.(I,we>_e?_e:we),I.a=0,I.$=Et-$}return 1}return I.a=3,0}function yi(I){e(I!=null),I.vc=null,I.yc=null,I.Ya=null;var L=I.Wa;L!=null&&(L.X=null),I.vb=null,e(I!=null)}function Xo(){var I=new ei;return I==null?null:(I.a=0,I.xb=ta,Ge("Predictor","VP8LPredictors"),Ge("Predictor","VP8LPredictors_C"),Ge("PredictorAdd","VP8LPredictorsAdd"),Ge("PredictorAdd","VP8LPredictorsAdd_C"),gu=Cr,Ps=Ne,_u=ae,Bo=ge,xa=xe,Ai=Me,Gr=We,Z.VP8LMapColor32b=vc,Z.VP8LMapColor8b=xc,I)}function Ke(I,L,$,Y,Ae){var _e=1,ye=[I],we=[L],Te=Y.m,be=Y.s,ct=null,Et=0;e:for(;;){if($)for(;_e&&ht(Te,1);){var ke=ye,ft=we,_t=Y,Nt=1,ut=_t.m,zt=_t.gc[_t.ab],Gt=ht(ut,2);if(_t.Oc&1<<Gt)_e=0;else{switch(_t.Oc|=1<<Gt,zt.hc=Gt,zt.Ea=ke[0],zt.nc=ft[0],zt.K=[null],++_t.ab,e(4>=_t.ab),Gt){case 0:case 1:zt.b=ht(ut,3)+2,Nt=Ke(Kt(zt.Ea,zt.b),Kt(zt.nc,zt.b),0,_t,zt.K),zt.K=zt.K[0];break;case 3:var sr,tr=ht(ut,8)+1,Wr=16<tr?0:4<tr?1:2<tr?2:3;if(ke[0]=Kt(zt.Ea,Wr),zt.b=Wr,sr=Nt=Ke(tr,1,0,_t,zt.K)){var Fr,mn=tr,zr=zt,Fn=1<<(8>>zr.b),cs=s(Fn);if(cs==null)sr=0;else{var wn=zr.K[0],jr=zr.w;for(cs[0]=zr.K[0][0],Fr=1;Fr<1*mn;++Fr)cs[Fr]=Br(wn[jr+Fr],cs[Fr-1]);for(;Fr<4*Fn;++Fr)cs[Fr]=0;zr.K[0]=null,zr.K[0]=cs,sr=1}}Nt=sr;break;case 2:break;default:e(0)}_e=Nt}}if(ye=ye[0],we=we[0],_e&&ht(Te,1)&&!(_e=1<=(Et=ht(Te,4))&&11>=Et)){Y.a=3;break e}var _r;if(_r=_e)t:{var cn,bn,Pn,oi=Y,ps=ye,js=we,Pi=Et,gs=$,Mi=oi.m,Fi=oi.s,or=[null],br=1,di=0,jn=ph[Pi];r:for(;;){if(gs&&ht(Mi,1)){var es=ht(Mi,3)+2,Ci=Kt(ps,es),$i=Kt(js,es),Ri=Ci*$i;if(!Ke(Ci,$i,0,oi,or))break r;for(or=or[0],Fi.xc=es,cn=0;cn<Ri;++cn){var ai=or[cn]>>8&65535;or[cn]=ai,ai>=br&&(br=ai+1)}}if(Mi.h)break r;for(bn=0;5>bn;++bn){var ms=Qd[bn];!bn&&0<Pi&&(ms+=1<<Pi),di<ms&&(di=ms)}var Ms=a(br*jn,ve),Eo=br,$s=a(Eo,qe);if($s==null)var Rn=null;else e(65536>=Eo),Rn=$s;var Ln=s(di);if(Rn==null||Ln==null||Ms==null){oi.a=1;break r}var Qo=Ms;for(cn=Pn=0;cn<br;++cn){var Yn=Rn[cn],Gi=Yn.G,Ho=Yn.H,Wa=0,Ca=1,zi=0;for(bn=0;5>bn;++bn){ms=Qd[bn],Gi[bn]=Qo,Ho[bn]=Pn,!bn&&0<Pi&&(ms+=1<<Pi);i:{var vh,Ic=ms,ml=oi,Tu=Ln,bf=Qo,Eu=Pn,yA=0,_l=ml.m,vf=ht(_l,1);if(i(Tu,0,0,Ic),vf){var wf=ht(_l,1)+1,v=ht(_l,1),l=ht(_l,v==0?1:8);Tu[l]=1,wf==2&&(Tu[l=ht(_l,8)]=1);var f=1}else{var m=s(19),y=ht(_l,4)+4;if(19<y){ml.a=3;var B=0;break i}for(vh=0;vh<y;++vh)m[dA[vh]]=ht(_l,3);var E=void 0,R=void 0,O=ml,V=m,G=Ic,J=Tu,X=0,ne=O.m,de=8,Ee=a(128,ve);n:for(;ce(Ee,0,7,V,19);){if(ht(ne,1)){var Se=2+2*ht(ne,3);if((E=2+ht(ne,Se))>G)break n}else E=G;for(R=0;R<G&&E--;){it(ne);var Ie=Ee[0+(127&Le(ne))];rt(ne,ne.u+Ie.g);var Oe=Ie.value;if(16>Oe)J[R++]=Oe,Oe!=0&&(de=Oe);else{var je=Oe==16,De=Oe-16,$e=zd[De],Je=ht(ne,df[De])+$e;if(R+Je>G)break n;for(var Qe=je?de:0;0<Je--;)J[R++]=Qe}}X=1;break n}X||(O.a=3),f=X}(f=f&&!_l.h)&&(yA=ce(bf,Eu,8,Tu,Ic)),f&&yA!=0?B=yA:(ml.a=3,B=0)}if(B==0)break r;if(Ca&&fA[bn]==1&&(Ca=Qo[Pn].g==0),Wa+=Qo[Pn].g,Pn+=B,3>=bn){var at,Mt=Ln[0];for(at=1;at<ms;++at)Ln[at]>Mt&&(Mt=Ln[at]);zi+=Mt}}if(Yn.nd=Ca,Yn.Qb=0,Ca&&(Yn.qb=(Gi[3][Ho[3]+0].value<<24|Gi[1][Ho[1]+0].value<<16|Gi[2][Ho[2]+0].value)>>>0,Wa==0&&256>Gi[0][Ho[0]+0].value&&(Yn.Qb=1,Yn.qb+=Gi[0][Ho[0]+0].value<<8)),Yn.jc=!Yn.Qb&&6>zi,Yn.jc){var yt,bt=Yn;for(yt=0;yt<ds;++yt){var Ct=yt,Zt=bt.pd[Ct],rr=bt.G[0][bt.H[0]+Ct];256<=rr.value?(Zt.g=rr.g+256,Zt.value=rr.value):(Zt.g=0,Zt.value=0,Ct>>=Ot(rr,8,Zt),Ct>>=Ot(bt.G[1][bt.H[1]+Ct],16,Zt),Ct>>=Ot(bt.G[2][bt.H[2]+Ct],0,Zt),Ot(bt.G[3][bt.H[3]+Ct],24,Zt))}}}Fi.vc=or,Fi.Wb=br,Fi.Ya=Rn,Fi.yc=Ms,_r=1;break t}_r=0}if(!(_e=_r)){Y.a=3;break e}if(0<Et){if(be.ua=1<<Et,!Re(be.Wa,Et)){Y.a=1,_e=0;break e}}else be.ua=0;var $t=Y,Tr=ye,tn=we,Dn=$t.s,li=Dn.xc;if($t.c=Tr,$t.i=tn,Dn.md=Kt(Tr,li),Dn.wc=li==0?-1:(1<<li)-1,$){Y.xb=wu;break e}if((ct=s(ye*we))==null){Y.a=1,_e=0;break e}_e=(_e=Zr(Y,ct,0,ye,we,we,null))&&!Te.h;break e}return _e?(Ae!=null?Ae[0]=ct:(e(ct==null),e($)),Y.$=0,$||yi(be)):yi(be),_e}function Vt(I,L){var $=I.c*I.i,Y=$+L+16*L;return e(I.c<=L),I.V=s(Y),I.V==null?(I.Ta=null,I.Ua=0,I.a=1,0):(I.Ta=I.V,I.Ua=I.Ba+$+L,1)}function Ar(I,L){var $=I.C,Y=L-$,Ae=I.V,_e=I.Ba+I.c*$;for(e(L<=I.l.o);0<Y;){var ye=16<Y?16:Y,we=I.l.ma,Te=I.l.width,be=Te*ye,ct=we.ca,Et=we.tb+Te*$,ke=I.Ta,ft=I.Ua;wi(I,ye,Ae,_e),lA(ke,ft,ct,Et,be),er(we,$,$+ye,ct,Et,Te),Y-=ye,Ae+=ye*I.c,$+=ye}e($==L),I.C=I.Ma=L}function xn(){this.ub=this.yd=this.td=this.Rb=0}function Jn(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Wn(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function Xi(){this.Yb=function(){var I=[];return function L($,Y,Ae){for(var _e=Ae[Y],ye=0;ye<_e&&($.push(Ae.length>Y+1?[]:0),!(Ae.length<Y+1));ye++)L($[ye],Y+1,Ae)}(I,0,[3,11]),I}()}function os(){this.jb=s(3),this.Wc=o([4,8],Xi),this.Xc=o([4,17],Xi)}function Di(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function qn(){this.ld=this.La=this.dd=this.tc=0}function Nr(){this.Na=this.la=0}function cu(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function ma(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function al(){this.uc=this.M=this.Nb=0,this.wa=Array(new qn),this.Y=0,this.ya=Array(new ma),this.aa=0,this.l=new uu}function Da(){this.y=s(16),this.f=s(8),this.ea=s(8)}function ka(){this.cb=this.a=0,this.sc="",this.m=new he,this.Od=new xn,this.Kc=new Jn,this.ed=new Di,this.Qa=new Wn,this.Ic=this.$c=this.Aa=0,this.D=new al,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=a(8,he),this.ia=0,this.pb=a(4,cu),this.Pa=new os,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Da),this.Hd=0,this.rb=Array(new Nr),this.sb=0,this.wa=Array(new qn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new ma),this.L=this.aa=0,this.gd=o([4,2],qn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function uu(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function eA(){var I=new ka;return I!=null&&(I.a=0,I.sc="OK",I.cb=0,I.Xb=0,pA||(pA=Pl)),I}function Yi(I,L,$){return I.a==0&&(I.a=L,I.sc=$,I.cb=0),0}function ll(I,L,$){return 3<=$&&I[L+0]==157&&I[L+1]==1&&I[L+2]==42}function tA(I,L){if(I==null)return 0;if(I.a=0,I.sc="OK",L==null)return Yi(I,2,"null VP8Io passed to VP8GetHeaders()");var $=L.data,Y=L.w,Ae=L.ha;if(4>Ae)return Yi(I,7,"Truncated header.");var _e=$[Y+0]|$[Y+1]<<8|$[Y+2]<<16,ye=I.Od;if(ye.Rb=!(1&_e),ye.td=_e>>1&7,ye.yd=_e>>4&1,ye.ub=_e>>5,3<ye.td)return Yi(I,3,"Incorrect keyframe parameters.");if(!ye.yd)return Yi(I,4,"Frame not displayable.");Y+=3,Ae-=3;var we=I.Kc;if(ye.Rb){if(7>Ae)return Yi(I,7,"cannot parse picture header");if(!ll($,Y,Ae))return Yi(I,3,"Bad code word");we.c=16383&($[Y+4]<<8|$[Y+3]),we.Td=$[Y+4]>>6,we.i=16383&($[Y+6]<<8|$[Y+5]),we.Ud=$[Y+6]>>6,Y+=7,Ae-=7,I.za=we.c+15>>4,I.Ub=we.i+15>>4,L.width=we.c,L.height=we.i,L.Da=0,L.j=0,L.v=0,L.va=L.width,L.o=L.height,L.da=0,L.ib=L.width,L.hb=L.height,L.U=L.width,L.T=L.height,i((_e=I.Pa).jb,0,255,_e.jb.length),e((_e=I.Qa)!=null),_e.Cb=0,_e.Bb=0,_e.Fb=1,i(_e.Zb,0,0,_e.Zb.length),i(_e.Lb,0,0,_e.Lb)}if(ye.ub>Ae)return Yi(I,7,"bad partition length");ot(_e=I.m,$,Y,ye.ub),Y+=ye.ub,Ae-=ye.ub,ye.Rb&&(we.Ld=Bt(_e),we.Kd=Bt(_e)),we=I.Qa;var Te,be=I.Pa;if(e(_e!=null),e(we!=null),we.Cb=Bt(_e),we.Cb){if(we.Bb=Bt(_e),Bt(_e)){for(we.Fb=Bt(_e),Te=0;4>Te;++Te)we.Zb[Te]=Bt(_e)?Ye(_e,7):0;for(Te=0;4>Te;++Te)we.Lb[Te]=Bt(_e)?Ye(_e,6):0}if(we.Bb)for(Te=0;3>Te;++Te)be.jb[Te]=Bt(_e)?st(_e,8):255}else we.Bb=0;if(_e.Ka)return Yi(I,3,"cannot parse segment header");if((we=I.ed).zd=Bt(_e),we.Tb=st(_e,6),we.wb=st(_e,3),we.Pc=Bt(_e),we.Pc&&Bt(_e)){for(be=0;4>be;++be)Bt(_e)&&(we.vd[be]=Ye(_e,6));for(be=0;4>be;++be)Bt(_e)&&(we.od[be]=Ye(_e,6))}if(I.L=we.Tb==0?0:we.zd?1:2,_e.Ka)return Yi(I,3,"cannot parse filter header");var ct=Ae;if(Ae=Te=Y,Y=Te+ct,we=ct,I.Xb=(1<<st(I.m,2))-1,ct<3*(be=I.Xb))$=7;else{for(Te+=3*be,we-=3*be,ct=0;ct<be;++ct){var Et=$[Ae+0]|$[Ae+1]<<8|$[Ae+2]<<16;Et>we&&(Et=we),ot(I.Jc[+ct],$,Te,Et),Te+=Et,we-=Et,Ae+=3}ot(I.Jc[+be],$,Te,we),$=Te<Y?0:5}if($!=0)return Yi(I,$,"cannot parse partitions");for($=st(Te=I.m,7),Ae=Bt(Te)?Ye(Te,4):0,Y=Bt(Te)?Ye(Te,4):0,we=Bt(Te)?Ye(Te,4):0,be=Bt(Te)?Ye(Te,4):0,Te=Bt(Te)?Ye(Te,4):0,ct=I.Qa,Et=0;4>Et;++Et){if(ct.Cb){var ke=ct.Zb[Et];ct.Fb||(ke+=$)}else{if(0<Et){I.pb[Et]=I.pb[0];continue}ke=$}var ft=I.pb[Et];ft.Sc[0]=mf[Is(ke+Ae,127)],ft.Sc[1]=Sc[Is(ke+0,127)],ft.Eb[0]=2*mf[Is(ke+Y,127)],ft.Eb[1]=101581*Sc[Is(ke+we,127)]>>16,8>ft.Eb[1]&&(ft.Eb[1]=8),ft.Qc[0]=mf[Is(ke+be,117)],ft.Qc[1]=Sc[Is(ke+Te,127)],ft.lc=ke+Te}if(!ye.Rb)return Yi(I,4,"Not a key frame.");for(Bt(_e),ye=I.Pa,$=0;4>$;++$){for(Ae=0;8>Ae;++Ae)for(Y=0;3>Y;++Y)for(we=0;11>we;++we)be=Dt(_e,gh[$][Ae][Y][we])?st(_e,8):Hd[$][Ae][Y][we],ye.Wc[$][Ae].Yb[Y][we]=be;for(Ae=0;17>Ae;++Ae)ye.Xc[$][Ae]=ye.Wc[$][gA[Ae]]}return I.kc=Bt(_e),I.kc&&(I.Bd=st(_e,8)),I.cb=1}function Pl(I,L,$,Y,Ae,_e,ye){var we=L[Ae].Yb[$];for($=0;16>Ae;++Ae){if(!Dt(I,we[$+0]))return Ae;for(;!Dt(I,we[$+1]);)if(we=L[++Ae].Yb[0],$=0,Ae==16)return 16;var Te=L[Ae+1].Yb;if(Dt(I,we[$+2])){var be=I,ct=0;if(Dt(be,(ke=we)[(Et=$)+3]))if(Dt(be,ke[Et+6])){for(we=0,Et=2*(ct=Dt(be,ke[Et+8]))+(ke=Dt(be,ke[Et+9+ct])),ct=0,ke=Sg[Et];ke[we];++we)ct+=ct+Dt(be,ke[we]);ct+=3+(8<<Et)}else Dt(be,ke[Et+7])?(ct=7+2*Dt(be,165),ct+=Dt(be,145)):ct=5+Dt(be,159);else ct=Dt(be,ke[Et+4])?3+Dt(be,ke[Et+5]):2;we=Te[2]}else ct=1,we=Te[1];Te=ye+_f[Ae],0>(be=I).b&&Pt(be);var Et,ke=be.b,ft=(Et=be.Ca>>1)-(be.I>>ke)>>31;--be.b,be.Ca+=ft,be.Ca|=1,be.I-=(Et+1&ft)<<ke,_e[Te]=((ct^ft)-ft)*Y[(0<Ae)+0]}return 16}function hu(I){var L=I.rb[I.sb-1];L.la=0,L.Na=0,i(I.zc,0,0,I.zc.length),I.ja=0}function Na(I,L,$,Y,Ae){Ae=I[L+$+32*Y]+(Ae>>3),I[L+$+32*Y]=-256&Ae?0>Ae?0:255:Ae}function cc(I,L,$,Y,Ae,_e){Na(I,L,0,$,Y+Ae),Na(I,L,1,$,Y+_e),Na(I,L,2,$,Y-_e),Na(I,L,3,$,Y-Ae)}function Vi(I){return(20091*I>>16)+I}function Au(I,L,$,Y){var Ae,_e=0,ye=s(16);for(Ae=0;4>Ae;++Ae){var we=I[L+0]+I[L+8],Te=I[L+0]-I[L+8],be=(35468*I[L+4]>>16)-Vi(I[L+12]),ct=Vi(I[L+4])+(35468*I[L+12]>>16);ye[_e+0]=we+ct,ye[_e+1]=Te+be,ye[_e+2]=Te-be,ye[_e+3]=we-ct,_e+=4,L++}for(Ae=_e=0;4>Ae;++Ae)we=(I=ye[_e+0]+4)+ye[_e+8],Te=I-ye[_e+8],be=(35468*ye[_e+4]>>16)-Vi(ye[_e+12]),Na($,Y,0,0,we+(ct=Vi(ye[_e+4])+(35468*ye[_e+12]>>16))),Na($,Y,1,0,Te+be),Na($,Y,2,0,Te-be),Na($,Y,3,0,we-ct),_e++,Y+=32}function th(I,L,$,Y){var Ae=I[L+0]+4,_e=35468*I[L+4]>>16,ye=Vi(I[L+4]),we=35468*I[L+1]>>16;cc($,Y,0,Ae+ye,I=Vi(I[L+1]),we),cc($,Y,1,Ae+_e,I,we),cc($,Y,2,Ae-_e,I,we),cc($,Y,3,Ae-ye,I,we)}function uc(I,L,$,Y,Ae){Au(I,L,$,Y),Ae&&Au(I,L+16,$,Y+4)}function rA(I,L,$,Y){Ni(I,L+0,$,Y,1),Ni(I,L+32,$,Y+128,1)}function _a(I,L,$,Y){var Ae;for(I=I[L+0]+4,Ae=0;4>Ae;++Ae)for(L=0;4>L;++L)Na($,Y,L,Ae,I)}function hc(I,L,$,Y){I[L+0]&&fl(I,L+0,$,Y),I[L+16]&&fl(I,L+16,$,Y+4),I[L+32]&&fl(I,L+32,$,Y+128),I[L+48]&&fl(I,L+48,$,Y+128+4)}function Ac(I,L,$,Y){var Ae,_e=s(16);for(Ae=0;4>Ae;++Ae){var ye=I[L+0+Ae]+I[L+12+Ae],we=I[L+4+Ae]+I[L+8+Ae],Te=I[L+4+Ae]-I[L+8+Ae],be=I[L+0+Ae]-I[L+12+Ae];_e[0+Ae]=ye+we,_e[8+Ae]=ye-we,_e[4+Ae]=be+Te,_e[12+Ae]=be-Te}for(Ae=0;4>Ae;++Ae)ye=(I=_e[0+4*Ae]+3)+_e[3+4*Ae],we=_e[1+4*Ae]+_e[2+4*Ae],Te=_e[1+4*Ae]-_e[2+4*Ae],be=I-_e[3+4*Ae],$[Y+0]=ye+we>>3,$[Y+16]=be+Te>>3,$[Y+32]=ye-we>>3,$[Y+48]=be-Te>>3,Y+=64}function za(I,L,$){var Y,Ae=L-32,_e=Co,ye=255-I[Ae-1];for(Y=0;Y<$;++Y){var we,Te=_e,be=ye+I[L-1];for(we=0;we<$;++we)I[L+we]=Te[be+I[Ae+we]];L+=32}}function rh(I,L){za(I,L,4)}function Ml(I,L){za(I,L,8)}function nA(I,L){za(I,L,16)}function ya(I,L){var $;for($=0;16>$;++$)n(I,L+32*$,I,L-32,16)}function hn(I,L){var $;for($=16;0<$;--$)i(I,L,I[L-1],16),L+=32}function Hs(I,L,$){var Y;for(Y=0;16>Y;++Y)i(L,$+32*Y,I,16)}function en(I,L){var $,Y=16;for($=0;16>$;++$)Y+=I[L-1+32*$]+I[L+$-32];Hs(Y>>5,I,L)}function nh(I,L){var $,Y=8;for($=0;16>$;++$)Y+=I[L-1+32*$];Hs(Y>>4,I,L)}function fc(I,L){var $,Y=8;for($=0;16>$;++$)Y+=I[L+$-32];Hs(Y>>4,I,L)}function Fl(I,L){Hs(128,I,L)}function Qr(I,L,$){return I+2*L+$+2>>2}function as(I,L){var $,Y=L-32;for(Y=new Uint8Array([Qr(I[Y-1],I[Y+0],I[Y+1]),Qr(I[Y+0],I[Y+1],I[Y+2]),Qr(I[Y+1],I[Y+2],I[Y+3]),Qr(I[Y+2],I[Y+3],I[Y+4])]),$=0;4>$;++$)n(I,L+32*$,Y,0,Y.length)}function Ss(I,L){var $=I[L-1],Y=I[L-1+32],Ae=I[L-1+64],_e=I[L-1+96];Yt(I,L+0,16843009*Qr(I[L-1-32],$,Y)),Yt(I,L+32,16843009*Qr($,Y,Ae)),Yt(I,L+64,16843009*Qr(Y,Ae,_e)),Yt(I,L+96,16843009*Qr(Ae,_e,_e))}function Zi(I,L){var $,Y=4;for($=0;4>$;++$)Y+=I[L+$-32]+I[L-1+32*$];for(Y>>=3,$=0;4>$;++$)i(I,L+32*$,Y,4)}function si(I,L){var $=I[L-1+0],Y=I[L-1+32],Ae=I[L-1+64],_e=I[L-1-32],ye=I[L+0-32],we=I[L+1-32],Te=I[L+2-32],be=I[L+3-32];I[L+0+96]=Qr(Y,Ae,I[L-1+96]),I[L+1+96]=I[L+0+64]=Qr($,Y,Ae),I[L+2+96]=I[L+1+64]=I[L+0+32]=Qr(_e,$,Y),I[L+3+96]=I[L+2+64]=I[L+1+32]=I[L+0+0]=Qr(ye,_e,$),I[L+3+64]=I[L+2+32]=I[L+1+0]=Qr(we,ye,_e),I[L+3+32]=I[L+2+0]=Qr(Te,we,ye),I[L+3+0]=Qr(be,Te,we)}function Rl(I,L){var $=I[L+1-32],Y=I[L+2-32],Ae=I[L+3-32],_e=I[L+4-32],ye=I[L+5-32],we=I[L+6-32],Te=I[L+7-32];I[L+0+0]=Qr(I[L+0-32],$,Y),I[L+1+0]=I[L+0+32]=Qr($,Y,Ae),I[L+2+0]=I[L+1+32]=I[L+0+64]=Qr(Y,Ae,_e),I[L+3+0]=I[L+2+32]=I[L+1+64]=I[L+0+96]=Qr(Ae,_e,ye),I[L+3+32]=I[L+2+64]=I[L+1+96]=Qr(_e,ye,we),I[L+3+64]=I[L+2+96]=Qr(ye,we,Te),I[L+3+96]=Qr(we,Te,Te)}function xi(I,L){var $=I[L-1+0],Y=I[L-1+32],Ae=I[L-1+64],_e=I[L-1-32],ye=I[L+0-32],we=I[L+1-32],Te=I[L+2-32],be=I[L+3-32];I[L+0+0]=I[L+1+64]=_e+ye+1>>1,I[L+1+0]=I[L+2+64]=ye+we+1>>1,I[L+2+0]=I[L+3+64]=we+Te+1>>1,I[L+3+0]=Te+be+1>>1,I[L+0+96]=Qr(Ae,Y,$),I[L+0+64]=Qr(Y,$,_e),I[L+0+32]=I[L+1+96]=Qr($,_e,ye),I[L+1+32]=I[L+2+96]=Qr(_e,ye,we),I[L+2+32]=I[L+3+96]=Qr(ye,we,Te),I[L+3+32]=Qr(we,Te,be)}function As(I,L){var $=I[L+0-32],Y=I[L+1-32],Ae=I[L+2-32],_e=I[L+3-32],ye=I[L+4-32],we=I[L+5-32],Te=I[L+6-32],be=I[L+7-32];I[L+0+0]=$+Y+1>>1,I[L+1+0]=I[L+0+64]=Y+Ae+1>>1,I[L+2+0]=I[L+1+64]=Ae+_e+1>>1,I[L+3+0]=I[L+2+64]=_e+ye+1>>1,I[L+0+32]=Qr($,Y,Ae),I[L+1+32]=I[L+0+96]=Qr(Y,Ae,_e),I[L+2+32]=I[L+1+96]=Qr(Ae,_e,ye),I[L+3+32]=I[L+2+96]=Qr(_e,ye,we),I[L+3+64]=Qr(ye,we,Te),I[L+3+96]=Qr(we,Te,be)}function no(I,L){var $=I[L-1+0],Y=I[L-1+32],Ae=I[L-1+64],_e=I[L-1+96];I[L+0+0]=$+Y+1>>1,I[L+2+0]=I[L+0+32]=Y+Ae+1>>1,I[L+2+32]=I[L+0+64]=Ae+_e+1>>1,I[L+1+0]=Qr($,Y,Ae),I[L+3+0]=I[L+1+32]=Qr(Y,Ae,_e),I[L+3+32]=I[L+1+64]=Qr(Ae,_e,_e),I[L+3+64]=I[L+2+64]=I[L+0+96]=I[L+1+96]=I[L+2+96]=I[L+3+96]=_e}function dc(I,L){var $=I[L-1+0],Y=I[L-1+32],Ae=I[L-1+64],_e=I[L-1+96],ye=I[L-1-32],we=I[L+0-32],Te=I[L+1-32],be=I[L+2-32];I[L+0+0]=I[L+2+32]=$+ye+1>>1,I[L+0+32]=I[L+2+64]=Y+$+1>>1,I[L+0+64]=I[L+2+96]=Ae+Y+1>>1,I[L+0+96]=_e+Ae+1>>1,I[L+3+0]=Qr(we,Te,be),I[L+2+0]=Qr(ye,we,Te),I[L+1+0]=I[L+3+32]=Qr($,ye,we),I[L+1+32]=I[L+3+64]=Qr(Y,$,ye),I[L+1+64]=I[L+3+96]=Qr(Ae,Y,$),I[L+1+96]=Qr(_e,Ae,Y)}function cl(I,L){var $;for($=0;8>$;++$)n(I,L+32*$,I,L-32,8)}function Kn(I,L){var $;for($=0;8>$;++$)i(I,L,I[L-1],8),L+=32}function kn(I,L,$){var Y;for(Y=0;8>Y;++Y)i(L,$+32*Y,I,8)}function ko(I,L){var $,Y=8;for($=0;8>$;++$)Y+=I[L+$-32]+I[L-1+32*$];kn(Y>>4,I,L)}function Tn(I,L){var $,Y=4;for($=0;8>$;++$)Y+=I[L+$-32];kn(Y>>3,I,L)}function Yr(I,L){var $,Y=4;for($=0;8>$;++$)Y+=I[L-1+32*$];kn(Y>>3,I,L)}function pc(I,L){kn(128,I,L)}function An(I,L,$){var Y=I[L-$],Ae=I[L+0],_e=3*(Ae-Y)+Tc[1020+I[L-2*$]-I[L+$]],ye=hA[112+(_e+4>>3)];I[L-$]=Co[255+Y+hA[112+(_e+3>>3)]],I[L+0]=Co[255+Ae-ye]}function Ll(I,L,$,Y){var Ae=I[L+0],_e=I[L+$];return on[255+I[L-2*$]-I[L-$]]>Y||on[255+_e-Ae]>Y}function No(I,L,$,Y){return 4*on[255+I[L-$]-I[L+0]]+on[255+I[L-2*$]-I[L+$]]<=Y}function Qa(I,L,$,Y,Ae){var _e=I[L-3*$],ye=I[L-2*$],we=I[L-$],Te=I[L+0],be=I[L+$],ct=I[L+2*$],Et=I[L+3*$];return 4*on[255+we-Te]+on[255+ye-be]>Y?0:on[255+I[L-4*$]-_e]<=Ae&&on[255+_e-ye]<=Ae&&on[255+ye-we]<=Ae&&on[255+Et-ct]<=Ae&&on[255+ct-be]<=Ae&&on[255+be-Te]<=Ae}function Ha(I,L,$,Y){var Ae=2*Y+1;for(Y=0;16>Y;++Y)No(I,L+Y,$,Ae)&&An(I,L+Y,$)}function Va(I,L,$,Y){var Ae=2*Y+1;for(Y=0;16>Y;++Y)No(I,L+Y*$,1,Ae)&&An(I,L+Y*$,1)}function Ol(I,L,$,Y){var Ae;for(Ae=3;0<Ae;--Ae)Ha(I,L+=4*$,$,Y)}function gc(I,L,$,Y){var Ae;for(Ae=3;0<Ae;--Ae)Va(I,L+=4,$,Y)}function io(I,L,$,Y,Ae,_e,ye,we){for(_e=2*_e+1;0<Ae--;){if(Qa(I,L,$,_e,ye))if(Ll(I,L,$,we))An(I,L,$);else{var Te=I,be=L,ct=$,Et=Te[be-2*ct],ke=Te[be-ct],ft=Te[be+0],_t=Te[be+ct],Nt=Te[be+2*ct],ut=27*(Gt=Tc[1020+3*(ft-ke)+Tc[1020+Et-_t]])+63>>7,zt=18*Gt+63>>7,Gt=9*Gt+63>>7;Te[be-3*ct]=Co[255+Te[be-3*ct]+Gt],Te[be-2*ct]=Co[255+Et+zt],Te[be-ct]=Co[255+ke+ut],Te[be+0]=Co[255+ft-ut],Te[be+ct]=Co[255+_t-zt],Te[be+2*ct]=Co[255+Nt-Gt]}L+=Y}}function Yo(I,L,$,Y,Ae,_e,ye,we){for(_e=2*_e+1;0<Ae--;){if(Qa(I,L,$,_e,ye))if(Ll(I,L,$,we))An(I,L,$);else{var Te=I,be=L,ct=$,Et=Te[be-ct],ke=Te[be+0],ft=Te[be+ct],_t=hA[112+(4+(Nt=3*(ke-Et))>>3)],Nt=hA[112+(Nt+3>>3)],ut=_t+1>>1;Te[be-2*ct]=Co[255+Te[be-2*ct]+ut],Te[be-ct]=Co[255+Et+Nt],Te[be+0]=Co[255+ke-_t],Te[be+ct]=Co[255+ft-ut]}L+=Y}}function Q(I,L,$,Y,Ae,_e){io(I,L,$,1,16,Y,Ae,_e)}function ue(I,L,$,Y,Ae,_e){io(I,L,1,$,16,Y,Ae,_e)}function Fe(I,L,$,Y,Ae,_e){var ye;for(ye=3;0<ye;--ye)Yo(I,L+=4*$,$,1,16,Y,Ae,_e)}function tt(I,L,$,Y,Ae,_e){var ye;for(ye=3;0<ye;--ye)Yo(I,L+=4,1,$,16,Y,Ae,_e)}function mt(I,L,$,Y,Ae,_e,ye,we){io(I,L,Ae,1,8,_e,ye,we),io($,Y,Ae,1,8,_e,ye,we)}function Qt(I,L,$,Y,Ae,_e,ye,we){io(I,L,1,Ae,8,_e,ye,we),io($,Y,1,Ae,8,_e,ye,we)}function jt(I,L,$,Y,Ae,_e,ye,we){Yo(I,L+4*Ae,Ae,1,8,_e,ye,we),Yo($,Y+4*Ae,Ae,1,8,_e,ye,we)}function Dr(I,L,$,Y,Ae,_e,ye,we){Yo(I,L+4,1,Ae,8,_e,ye,we),Yo($,Y+4,1,Ae,8,_e,ye,we)}function Hr(){this.ba=new Wt,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Sr,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Vr(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function gn(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function dn(){this.ua=0,this.Wa=new Ur,this.vb=new Ur,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new qe,this.yc=new ve}function ei(){this.xb=this.a=0,this.l=new uu,this.ca=new Wt,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Be,this.Pb=0,this.wd=new Be,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new dn,this.ab=0,this.gc=a(4,gn),this.Oc=0}function ji(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new uu,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function ti(I,L,$,Y,Ae,_e,ye){for(I=I==null?0:I[L+0],L=0;L<ye;++L)Ae[_e+L]=I+$[Y+L]&255,I=Ae[_e+L]}function Bi(I,L,$,Y,Ae,_e,ye){var we;if(I==null)ti(null,null,$,Y,Ae,_e,ye);else for(we=0;we<ye;++we)Ae[_e+we]=I[L+we]+$[Y+we]&255}function ki(I,L,$,Y,Ae,_e,ye){if(I==null)ti(null,null,$,Y,Ae,_e,ye);else{var we,Te=I[L+0],be=Te,ct=Te;for(we=0;we<ye;++we)be=ct+(Te=I[L+we])-be,ct=$[Y+we]+(-256&be?0>be?0:255:be)&255,be=Te,Ae[_e+we]=ct}}function ls(I,L,$,Y){var Ae=L.width,_e=L.o;if(e(I!=null&&L!=null),0>$||0>=Y||$+Y>_e)return null;if(!I.Cc){if(I.ga==null){var ye;if(I.ga=new ji,(ye=I.ga==null)||(ye=L.width*L.o,e(I.Gb.length==0),I.Gb=s(ye),I.Uc=0,I.Gb==null?ye=0:(I.mb=I.Gb,I.nb=I.Uc,I.rc=null,ye=1),ye=!ye),!ye){ye=I.ga;var we=I.Fa,Te=I.P,be=I.qc,ct=I.mb,Et=I.nb,ke=Te+1,ft=be-1,_t=ye.l;if(e(we!=null&&ct!=null&&L!=null),pl[0]=null,pl[1]=ti,pl[2]=Bi,pl[3]=ki,ye.ca=ct,ye.tb=Et,ye.c=L.width,ye.i=L.height,e(0<ye.c&&0<ye.i),1>=be)L=0;else if(ye.$a=3&we[Te+0],ye.Z=we[Te+0]>>2&3,ye.Lc=we[Te+0]>>4&3,Te=we[Te+0]>>6&3,0>ye.$a||1<ye.$a||4<=ye.Z||1<ye.Lc||Te)L=0;else if(_t.put=Ir,_t.ac=fn,_t.bc=Gn,_t.ma=ye,_t.width=L.width,_t.height=L.height,_t.Da=L.Da,_t.v=L.v,_t.va=L.va,_t.j=L.j,_t.o=L.o,ye.$a)e:{e(ye.$a==1),L=Xo();t:for(;;){if(L==null){L=0;break e}if(e(ye!=null),ye.mc=L,L.c=ye.c,L.i=ye.i,L.l=ye.l,L.l.ma=ye,L.l.width=ye.c,L.l.height=ye.i,L.a=0,Xe(L.m,we,ke,ft),!Ke(ye.c,ye.i,1,L,null)||(L.ab==1&&L.gc[0].hc==3&&Un(L.s)?(ye.ic=1,we=L.c*L.i,L.Ta=null,L.Ua=0,L.V=s(we),L.Ba=0,L.V==null?(L.a=1,L=0):L=1):(ye.ic=0,L=Vt(L,ye.c)),!L))break t;L=1;break e}ye.mc=null,L=0}else L=ft>=ye.c*ye.i;ye=!L}if(ye)return null;I.ga.Lc!=1?I.Ga=0:Y=_e-$}e(I.ga!=null),e($+Y<=_e);e:{if(L=(we=I.ga).c,_e=we.l.o,we.$a==0){if(ke=I.rc,ft=I.Vc,_t=I.Fa,Te=I.P+1+$*L,be=I.mb,ct=I.nb+$*L,e(Te<=I.P+I.qc),we.Z!=0)for(e(pl[we.Z]!=null),ye=0;ye<Y;++ye)pl[we.Z](ke,ft,_t,Te,be,ct,L),ke=be,ft=ct,ct+=L,Te+=L;else for(ye=0;ye<Y;++ye)n(be,ct,_t,Te,L),ke=be,ft=ct,ct+=L,Te+=L;I.rc=ke,I.Vc=ft}else{if(e(we.mc!=null),L=$+Y,e((ye=we.mc)!=null),e(L<=ye.i),ye.C>=L)L=1;else if(we.ic||ba(),we.ic){we=ye.V,ke=ye.Ba,ft=ye.c;var Nt=ye.i,ut=(_t=1,Te=ye.$/ft,be=ye.$%ft,ct=ye.m,Et=ye.s,ye.$),zt=ft*Nt,Gt=ft*L,sr=Et.wc,tr=ut<Gt?vn(Et,be,Te):null;e(ut<=zt),e(L<=Nt),e(Un(Et));t:for(;;){for(;!ct.h&&ut<Gt;){if(be&sr||(tr=vn(Et,be,Te)),e(tr!=null),it(ct),256>(Nt=ln(tr.G[0],tr.H[0],ct)))we[ke+ut]=Nt,++ut,++be>=ft&&(be=0,++Te<=L&&!(Te%16)&&Xr(ye,Te));else{if(!(280>Nt)){_t=0;break t}Nt=On(Nt-256,ct);var Wr,Fr=ln(tr.G[4],tr.H[4],ct);if(it(ct),!(ut>=(Fr=pn(ft,Fr=On(Fr,ct)))&&zt-ut>=Nt)){_t=0;break t}for(Wr=0;Wr<Nt;++Wr)we[ke+ut+Wr]=we[ke+ut+Wr-Fr];for(ut+=Nt,be+=Nt;be>=ft;)be-=ft,++Te<=L&&!(Te%16)&&Xr(ye,Te);ut<Gt&&be&sr&&(tr=vn(Et,be,Te))}e(ct.h==He(ct))}Xr(ye,Te>L?L:Te);break t}!_t||ct.h&&ut<zt?(_t=0,ye.a=ct.h?5:3):ye.$=ut,L=_t}else L=Zr(ye,ye.V,ye.Ba,ye.c,ye.i,L,Ar);if(!L){Y=0;break e}}$+Y>=_e&&(I.Cc=1),Y=1}if(!Y)return null;if(I.Cc&&((Y=I.ga)!=null&&(Y.mc=null),I.ga=null,0<I.Ga))return alert("todo:WebPDequantizeLevels"),null}return I.nb+$*Ae}function fs(I,L,$,Y,Ae,_e){for(;0<Ae--;){var ye,we=I,Te=L+($?1:0),be=I,ct=L+($?0:3);for(ye=0;ye<Y;++ye){var Et=be[ct+4*ye];Et!=255&&(Et*=32897,we[Te+4*ye+0]=we[Te+4*ye+0]*Et>>23,we[Te+4*ye+1]=we[Te+4*ye+1]*Et>>23,we[Te+4*ye+2]=we[Te+4*ye+2]*Et>>23)}L+=_e}}function Ul(I,L,$,Y,Ae){for(;0<Y--;){var _e;for(_e=0;_e<$;++_e){var ye=I[L+2*_e+0],we=15&(be=I[L+2*_e+1]),Te=4369*we,be=(240&be|be>>4)*Te>>16;I[L+2*_e+0]=(240&ye|ye>>4)*Te>>16&240|(15&ye|ye<<4)*Te>>16>>4&15,I[L+2*_e+1]=240&be|we}L+=Ae}}function ih(I,L,$,Y,Ae,_e,ye,we){var Te,be,ct=255;for(be=0;be<Ae;++be){for(Te=0;Te<Y;++Te){var Et=I[L+Te];_e[ye+4*Te]=Et,ct&=Et}L+=$,ye+=we}return ct!=255}function uf(I,L,$,Y,Ae){var _e;for(_e=0;_e<Ae;++_e)$[Y+_e]=I[L+_e]>>8}function ba(){uh=fs,Af=Ul,Cc=ih,lA=uf}function Zo(I,L,$){Z[I]=function(Y,Ae,_e,ye,we,Te,be,ct,Et,ke,ft,_t,Nt,ut,zt,Gt,sr){var tr,Wr=sr-1>>1,Fr=we[Te+0]|be[ct+0]<<16,mn=Et[ke+0]|ft[_t+0]<<16;e(Y!=null);var zr=3*Fr+mn+131074>>2;for(L(Y[Ae+0],255&zr,zr>>16,Nt,ut),_e!=null&&(zr=3*mn+Fr+131074>>2,L(_e[ye+0],255&zr,zr>>16,zt,Gt)),tr=1;tr<=Wr;++tr){var Fn=we[Te+tr]|be[ct+tr]<<16,cs=Et[ke+tr]|ft[_t+tr]<<16,wn=Fr+Fn+mn+cs+524296,jr=wn+2*(Fn+mn)>>3;zr=jr+Fr>>1,Fr=(wn=wn+2*(Fr+cs)>>3)+Fn>>1,L(Y[Ae+2*tr-1],255&zr,zr>>16,Nt,ut+(2*tr-1)*$),L(Y[Ae+2*tr-0],255&Fr,Fr>>16,Nt,ut+(2*tr-0)*$),_e!=null&&(zr=wn+mn>>1,Fr=jr+cs>>1,L(_e[ye+2*tr-1],255&zr,zr>>16,zt,Gt+(2*tr-1)*$),L(_e[ye+2*tr+0],255&Fr,Fr>>16,zt,Gt+(2*tr+0)*$)),Fr=Fn,mn=cs}1&sr||(zr=3*Fr+mn+131074>>2,L(Y[Ae+sr-1],255&zr,zr>>16,Nt,ut+(sr-1)*$),_e!=null&&(zr=3*mn+Fr+131074>>2,L(_e[ye+sr-1],255&zr,zr>>16,zt,Gt+(sr-1)*$)))}}function mc(){To[Hl]=Ig,To[ff]=mA,To[Dd]=mh,To[Ec]=xu,To[AA]=Bu,To[kd]=jd,To[Nd]=$d,To[Ah]=mA,To[fh]=xu,To[vu]=Bu,To[dh]=jd}function _c(I){return I&-16384?0>I?0:255:I>>yh}function ul(I,L){return _c((19077*I>>8)+(26149*L>>8)-14234)}function Xn(I,L,$){return _c((19077*I>>8)-(6419*L>>8)-(13320*$>>8)+8708)}function Dl(I,L){return _c((19077*I>>8)+(33050*L>>8)-17685)}function va(I,L,$,Y,Ae){Y[Ae+0]=ul(I,$),Y[Ae+1]=Xn(I,L,$),Y[Ae+2]=Dl(I,L)}function ja(I,L,$,Y,Ae){Y[Ae+0]=Dl(I,L),Y[Ae+1]=Xn(I,L,$),Y[Ae+2]=ul(I,$)}function kl(I,L,$,Y,Ae){var _e=Xn(I,L,$);L=_e<<3&224|Dl(I,L)>>3,Y[Ae+0]=248&ul(I,$)|_e>>5,Y[Ae+1]=L}function so(I,L,$,Y,Ae){var _e=240&Dl(I,L)|15;Y[Ae+0]=240&ul(I,$)|Xn(I,L,$)>>4,Y[Ae+1]=_e}function fu(I,L,$,Y,Ae){Y[Ae+0]=255,va(I,L,$,Y,Ae+1)}function sh(I,L,$,Y,Ae){ja(I,L,$,Y,Ae),Y[Ae+3]=255}function Nl(I,L,$,Y,Ae){va(I,L,$,Y,Ae),Y[Ae+3]=255}function Is(I,L){return 0>I?0:I>L?L:I}function Jo(I,L,$){Z[I]=function(Y,Ae,_e,ye,we,Te,be,ct,Et){for(var ke=ct+(-2&Et)*$;ct!=ke;)L(Y[Ae+0],_e[ye+0],we[Te+0],be,ct),L(Y[Ae+1],_e[ye+0],we[Te+0],be,ct+$),Ae+=2,++ye,++Te,ct+=2*$;1&Et&&L(Y[Ae+0],_e[ye+0],we[Te+0],be,ct)}}function oh(I,L,$){return $==0?I==0?L==0?6:5:L==0?4:0:$}function du(I,L,$,Y,Ae){switch(I>>>30){case 3:Ni(L,$,Y,Ae,0);break;case 2:Ql(L,$,Y,Ae);break;case 1:fl(L,$,Y,Ae)}}function $a(I,L){var $,Y,Ae=L.M,_e=L.Nb,ye=I.oc,we=I.pc+40,Te=I.oc,be=I.pc+584,ct=I.oc,Et=I.pc+600;for($=0;16>$;++$)ye[we+32*$-1]=129;for($=0;8>$;++$)Te[be+32*$-1]=129,ct[Et+32*$-1]=129;for(0<Ae?ye[we-1-32]=Te[be-1-32]=ct[Et-1-32]=129:(i(ye,we-32-1,127,21),i(Te,be-32-1,127,9),i(ct,Et-32-1,127,9)),Y=0;Y<I.za;++Y){var ke=L.ya[L.aa+Y];if(0<Y){for($=-1;16>$;++$)n(ye,we+32*$-4,ye,we+32*$+12,4);for($=-1;8>$;++$)n(Te,be+32*$-4,Te,be+32*$+4,4),n(ct,Et+32*$-4,ct,Et+32*$+4,4)}var ft=I.Gd,_t=I.Hd+Y,Nt=ke.ad,ut=ke.Hc;if(0<Ae&&(n(ye,we-32,ft[_t].y,0,16),n(Te,be-32,ft[_t].f,0,8),n(ct,Et-32,ft[_t].ea,0,8)),ke.Za){var zt=ye,Gt=we-32+16;for(0<Ae&&(Y>=I.za-1?i(zt,Gt,ft[_t].y[15],4):n(zt,Gt,ft[_t+1].y,0,4)),$=0;4>$;$++)zt[Gt+128+$]=zt[Gt+256+$]=zt[Gt+384+$]=zt[Gt+0+$];for($=0;16>$;++$,ut<<=2)zt=ye,Gt=we+Vl[$],zo[ke.Ob[$]](zt,Gt),du(ut,Nt,16*+$,zt,Gt)}else if(zt=oh(Y,Ae,ke.Ob[0]),dl[zt](ye,we),ut!=0)for($=0;16>$;++$,ut<<=2)du(ut,Nt,16*+$,ye,we+Vl[$]);for($=ke.Gc,zt=oh(Y,Ae,ke.Dd),Vn[zt](Te,be),Vn[zt](ct,Et),ut=Nt,zt=Te,Gt=be,255&(ke=0|$)&&(170&ke?lh(ut,256,zt,Gt):iA(ut,256,zt,Gt)),ke=ct,ut=Et,255&($>>=8)&&(170&$?lh(Nt,320,ke,ut):iA(Nt,320,ke,ut)),Ae<I.Ub-1&&(n(ft[_t].y,0,ye,we+480,16),n(ft[_t].f,0,Te,be+224,8),n(ft[_t].ea,0,ct,Et+224,8)),$=8*_e*I.B,ft=I.sa,_t=I.ta+16*Y+16*_e*I.R,Nt=I.qa,ke=I.ra+8*Y+$,ut=I.Ha,zt=I.Ia+8*Y+$,$=0;16>$;++$)n(ft,_t+$*I.R,ye,we+32*$,16);for($=0;8>$;++$)n(Nt,ke+$*I.B,Te,be+32*$,8),n(ut,zt+$*I.B,ct,Et+32*$,8)}}function pu(I,L,$,Y,Ae,_e,ye,we,Te){var be=[0],ct=[0],Et=0,ke=Te!=null?Te.kd:0,ft=Te??new Vr;if(I==null||12>$)return 7;ft.data=I,ft.w=L,ft.ha=$,L=[L],$=[$],ft.gb=[ft.gb];e:{var _t=L,Nt=$,ut=ft.gb;if(e(I!=null),e(Nt!=null),e(ut!=null),ut[0]=0,12<=Nt[0]&&!t(I,_t[0],"RIFF")){if(t(I,_t[0]+8,"WEBP")){ut=3;break e}var zt=xt(I,_t[0]+4);if(12>zt||4294967286<zt){ut=3;break e}if(ke&&zt>Nt[0]-8){ut=7;break e}ut[0]=zt,_t[0]+=12,Nt[0]-=12}ut=0}if(ut!=0)return ut;for(zt=0<ft.gb[0],$=$[0];;){e:{var Gt=I;Nt=L,ut=$;var sr=be,tr=ct,Wr=_t=[0];if((zr=Et=[Et])[0]=0,8>ut[0])ut=7;else{if(!t(Gt,Nt[0],"VP8X")){if(xt(Gt,Nt[0]+4)!=10){ut=3;break e}if(18>ut[0]){ut=7;break e}var Fr=xt(Gt,Nt[0]+8),mn=1+ur(Gt,Nt[0]+12);if(2147483648<=mn*(Gt=1+ur(Gt,Nt[0]+15))){ut=3;break e}Wr!=null&&(Wr[0]=Fr),sr!=null&&(sr[0]=mn),tr!=null&&(tr[0]=Gt),Nt[0]+=18,ut[0]-=18,zr[0]=1}ut=0}}if(Et=Et[0],_t=_t[0],ut!=0)return ut;if(Nt=!!(2&_t),!zt&&Et)return 3;if(_e!=null&&(_e[0]=!!(16&_t)),ye!=null&&(ye[0]=Nt),we!=null&&(we[0]=0),ye=be[0],_t=ct[0],Et&&Nt&&Te==null){ut=0;break}if(4>$){ut=7;break}if(zt&&Et||!zt&&!Et&&!t(I,L[0],"ALPH")){$=[$],ft.na=[ft.na],ft.P=[ft.P],ft.Sa=[ft.Sa];e:{Fr=I,ut=L,zt=$;var zr=ft.gb;sr=ft.na,tr=ft.P,Wr=ft.Sa,mn=22,e(Fr!=null),e(zt!=null),Gt=ut[0];var Fn=zt[0];for(e(sr!=null),e(Wr!=null),sr[0]=null,tr[0]=null,Wr[0]=0;;){if(ut[0]=Gt,zt[0]=Fn,8>Fn){ut=7;break e}var cs=xt(Fr,Gt+4);if(4294967286<cs){ut=3;break e}var wn=8+cs+1&-2;if(mn+=wn,0<zr&&mn>zr){ut=3;break e}if(!t(Fr,Gt,"VP8 ")||!t(Fr,Gt,"VP8L")){ut=0;break e}if(Fn[0]<wn){ut=7;break e}t(Fr,Gt,"ALPH")||(sr[0]=Fr,tr[0]=Gt+8,Wr[0]=cs),Gt+=wn,Fn-=wn}}if($=$[0],ft.na=ft.na[0],ft.P=ft.P[0],ft.Sa=ft.Sa[0],ut!=0)break}$=[$],ft.Ja=[ft.Ja],ft.xa=[ft.xa];e:if(zr=I,ut=L,zt=$,sr=ft.gb[0],tr=ft.Ja,Wr=ft.xa,Fr=ut[0],Gt=!t(zr,Fr,"VP8 "),mn=!t(zr,Fr,"VP8L"),e(zr!=null),e(zt!=null),e(tr!=null),e(Wr!=null),8>zt[0])ut=7;else{if(Gt||mn){if(zr=xt(zr,Fr+4),12<=sr&&zr>sr-12){ut=3;break e}if(ke&&zr>zt[0]-8){ut=7;break e}tr[0]=zr,ut[0]+=8,zt[0]-=8,Wr[0]=mn}else Wr[0]=5<=zt[0]&&zr[Fr+0]==47&&!(zr[Fr+4]>>5),tr[0]=zt[0];ut=0}if($=$[0],ft.Ja=ft.Ja[0],ft.xa=ft.xa[0],L=L[0],ut!=0)break;if(4294967286<ft.Ja)return 3;if(we==null||Nt||(we[0]=ft.xa?2:1),ye=[ye],_t=[_t],ft.xa){if(5>$){ut=7;break}we=ye,ke=_t,Nt=_e,I==null||5>$?I=0:5<=$&&I[L+0]==47&&!(I[L+4]>>5)?(zt=[0],zr=[0],sr=[0],Xe(tr=new Be,I,L,$),ii(tr,zt,zr,sr)?(we!=null&&(we[0]=zt[0]),ke!=null&&(ke[0]=zr[0]),Nt!=null&&(Nt[0]=sr[0]),I=1):I=0):I=0}else{if(10>$){ut=7;break}we=_t,I==null||10>$||!ll(I,L+3,$-3)?I=0:(ke=I[L+0]|I[L+1]<<8|I[L+2]<<16,Nt=16383&(I[L+7]<<8|I[L+6]),I=16383&(I[L+9]<<8|I[L+8]),1&ke||3<(ke>>1&7)||!(ke>>4&1)||ke>>5>=ft.Ja||!Nt||!I?I=0:(ye&&(ye[0]=Nt),we&&(we[0]=I),I=1))}if(!I||(ye=ye[0],_t=_t[0],Et&&(be[0]!=ye||ct[0]!=_t)))return 3;Te!=null&&(Te[0]=ft,Te.offset=L-Te.w,e(4294967286>L-Te.w),e(Te.offset==Te.ha-$));break}return ut==0||ut==7&&Et&&Te==null?(_e!=null&&(_e[0]|=ft.na!=null&&0<ft.na.length),Y!=null&&(Y[0]=ye),Ae!=null&&(Ae[0]=_t),0):ut}function wo(I,L,$){var Y=L.width,Ae=L.height,_e=0,ye=0,we=Y,Te=Ae;if(L.Da=I!=null&&0<I.Da,L.Da&&(we=I.cd,Te=I.bd,_e=I.v,ye=I.j,11>$||(_e&=-2,ye&=-2),0>_e||0>ye||0>=we||0>=Te||_e+we>Y||ye+Te>Ae))return 0;if(L.v=_e,L.j=ye,L.va=_e+we,L.o=ye+Te,L.U=we,L.T=Te,L.da=I!=null&&0<I.da,L.da){if(!Er(we,Te,$=[I.ib],_e=[I.hb]))return 0;L.ib=$[0],L.hb=_e[0]}return L.ob=I!=null&&I.ob,L.Kb=I==null||!I.Sd,L.da&&(L.ob=L.ib<3*Y/4&&L.hb<3*Ae/4,L.Kb=0),1}function xo(I){if(I==null)return 2;if(11>I.S){var L=I.f.RGBA;L.fb+=(I.height-1)*L.A,L.A=-L.A}else L=I.f.kb,I=I.height,L.O+=(I-1)*L.fa,L.fa=-L.fa,L.N+=(I-1>>1)*L.Ab,L.Ab=-L.Ab,L.W+=(I-1>>1)*L.Db,L.Db=-L.Db,L.F!=null&&(L.J+=(I-1)*L.lb,L.lb=-L.lb);return 0}function yc(I,L,$,Y){if(Y==null||0>=I||0>=L)return 2;if($!=null){if($.Da){var Ae=$.cd,_e=$.bd,ye=-2&$.v,we=-2&$.j;if(0>ye||0>we||0>=Ae||0>=_e||ye+Ae>I||we+_e>L)return 2;I=Ae,L=_e}if($.da){if(!Er(I,L,Ae=[$.ib],_e=[$.hb]))return 2;I=Ae[0],L=_e[0]}}Y.width=I,Y.height=L;e:{var Te=Y.width,be=Y.height;if(I=Y.S,0>=Te||0>=be||!(I>=Hl&&13>I))I=2;else{if(0>=Y.Rd&&Y.sd==null){ye=_e=Ae=L=0;var ct=(we=Te*Wd[I])*be;if(11>I||(_e=(be+1)/2*(L=(Te+1)/2),I==12&&(ye=(Ae=Te)*be)),(be=s(ct+2*_e+ye))==null){I=1;break e}Y.sd=be,11>I?((Te=Y.f.RGBA).eb=be,Te.fb=0,Te.A=we,Te.size=ct):((Te=Y.f.kb).y=be,Te.O=0,Te.fa=we,Te.Fd=ct,Te.f=be,Te.N=0+ct,Te.Ab=L,Te.Cd=_e,Te.ea=be,Te.W=0+ct+_e,Te.Db=L,Te.Ed=_e,I==12&&(Te.F=be,Te.J=0+ct+2*_e),Te.Tc=ye,Te.lb=Ae)}if(L=1,Ae=Y.S,_e=Y.width,ye=Y.height,Ae>=Hl&&13>Ae)if(11>Ae)I=Y.f.RGBA,L&=(we=Math.abs(I.A))*(ye-1)+_e<=I.size,L&=we>=_e*Wd[Ae],L&=I.eb!=null;else{I=Y.f.kb,we=(_e+1)/2,ct=(ye+1)/2,Te=Math.abs(I.fa),be=Math.abs(I.Ab);var Et=Math.abs(I.Db),ke=Math.abs(I.lb),ft=ke*(ye-1)+_e;L&=Te*(ye-1)+_e<=I.Fd,L&=be*(ct-1)+we<=I.Cd,L=(L&=Et*(ct-1)+we<=I.Ed)&Te>=_e&be>=we&Et>=we,L&=I.y!=null,L&=I.f!=null,L&=I.ea!=null,Ae==12&&(L&=ke>=_e,L&=ft<=I.Tc,L&=I.F!=null)}else L=0;I=L?0:2}}return I!=0||$!=null&&$.fd&&(I=xo(Y)),I}var ds=64,zl=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],ah=24,wa=32,Ji=8,bc=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];ar("Predictor0","PredictorAdd0"),Z.Predictor0=function(){return 4278190080},Z.Predictor1=function(I){return I},Z.Predictor2=function(I,L,$){return L[$+0]},Z.Predictor3=function(I,L,$){return L[$+1]},Z.Predictor4=function(I,L,$){return L[$-1]},Z.Predictor5=function(I,L,$){return vr(vr(I,L[$+1]),L[$+0])},Z.Predictor6=function(I,L,$){return vr(I,L[$-1])},Z.Predictor7=function(I,L,$){return vr(I,L[$+0])},Z.Predictor8=function(I,L,$){return vr(L[$-1],L[$+0])},Z.Predictor9=function(I,L,$){return vr(L[$+0],L[$+1])},Z.Predictor10=function(I,L,$){return vr(vr(I,L[$-1]),vr(L[$+0],L[$+1]))},Z.Predictor11=function(I,L,$){var Y=L[$+0];return 0>=hr(Y>>24&255,I>>24&255,(L=L[$-1])>>24&255)+hr(Y>>16&255,I>>16&255,L>>16&255)+hr(Y>>8&255,I>>8&255,L>>8&255)+hr(255&Y,255&I,255&L)?Y:I},Z.Predictor12=function(I,L,$){var Y=L[$+0];return(kt((I>>24&255)+(Y>>24&255)-((L=L[$-1])>>24&255))<<24|kt((I>>16&255)+(Y>>16&255)-(L>>16&255))<<16|kt((I>>8&255)+(Y>>8&255)-(L>>8&255))<<8|kt((255&I)+(255&Y)-(255&L)))>>>0},Z.Predictor13=function(I,L,$){var Y=L[$-1];return(ir((I=vr(I,L[$+0]))>>24&255,Y>>24&255)<<24|ir(I>>16&255,Y>>16&255)<<16|ir(I>>8&255,Y>>8&255)<<8|ir(255&I,255&Y))>>>0};var Ga=Z.PredictorAdd0;Z.PredictorAdd1=Mr,ar("Predictor2","PredictorAdd2"),ar("Predictor3","PredictorAdd3"),ar("Predictor4","PredictorAdd4"),ar("Predictor5","PredictorAdd5"),ar("Predictor6","PredictorAdd6"),ar("Predictor7","PredictorAdd7"),ar("Predictor8","PredictorAdd8"),ar("Predictor9","PredictorAdd9"),ar("Predictor10","PredictorAdd10"),ar("Predictor11","PredictorAdd11"),ar("Predictor12","PredictorAdd12"),ar("Predictor13","PredictorAdd13");var hl=Z.PredictorAdd2;re("ColorIndexInverseTransform","MapARGB","32b",function(I){return I>>8&255},function(I){return I}),re("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(I){return I},function(I){return I>>8&255});var gu,mu=Z.ColorIndexInverseTransform,vc=Z.MapARGB,wc=Z.VP8LColorIndexInverseTransformAlpha,xc=Z.MapAlpha,Al=Z.VP8LPredictorsAdd=[];Al.length=16,(Z.VP8LPredictors=[]).length=16,(Z.VP8LPredictorsAdd_C=[]).length=16,(Z.VP8LPredictors_C=[]).length=16;var Ps,_u,Bo,xa,Ai,Gr,fi,Ni,Ql,lh,fl,iA,Rd,Eg,Ld,sA,oA,aA,hf,Bc,ch,yu,ea,Od,uh,Af,Cc,lA,cA=s(511),hh=s(2041),uA=s(225),Ud=s(767),bu=0,Tc=hh,hA=uA,Co=Ud,on=cA,Hl=0,ff=1,Dd=2,Ec=3,AA=4,kd=5,Nd=6,Ah=7,fh=8,vu=9,dh=10,df=[2,3,7],zd=[3,3,11],Qd=[280,256,256,256,40],fA=[0,1,1,1,0],dA=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],pf=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],ph=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],gf=8,mf=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Sc=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],pA=null,Sg=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],_f=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],yf=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Hd=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Vd=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],gh=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],gA=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],dl=[],zo=[],Vn=[],wu=1,ta=2,pl=[],To=[];Zo("UpsampleRgbLinePair",va,3),Zo("UpsampleBgrLinePair",ja,3),Zo("UpsampleRgbaLinePair",Nl,4),Zo("UpsampleBgraLinePair",sh,4),Zo("UpsampleArgbLinePair",fu,4),Zo("UpsampleRgba4444LinePair",so,2),Zo("UpsampleRgb565LinePair",kl,2);var Ig=Z.UpsampleRgbLinePair,mh=Z.UpsampleBgrLinePair,mA=Z.UpsampleRgbaLinePair,xu=Z.UpsampleBgraLinePair,Bu=Z.UpsampleArgbLinePair,jd=Z.UpsampleRgba4444LinePair,$d=Z.UpsampleRgb565LinePair,_h=16,_A=1<<_h-1,Cu=-227,gl=482,yh=6,Gd=0,Pg=s(256),Mg=s(256),Fg=s(256),Rg=s(256),Lg=s(gl-Cu),bh=s(gl-Cu);Jo("YuvToRgbRow",va,3),Jo("YuvToBgrRow",ja,3),Jo("YuvToRgbaRow",Nl,4),Jo("YuvToBgraRow",sh,4),Jo("YuvToArgbRow",fu,4),Jo("YuvToRgba4444Row",so,2),Jo("YuvToRgb565Row",kl,2);var Vl=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Vs=[0,2,8],oo=[8,7,6,4,4,2,2,2,1,1,1,1],Ba=1;this.WebPDecodeRGBA=function(I,L,$,Y,Ae){var _e=ff,ye=new Hr,we=new Wt;ye.ba=we,we.S=_e,we.width=[we.width],we.height=[we.height];var Te=we.width,be=we.height,ct=new Ze;if(ct==null||I==null)var Et=2;else e(ct!=null),Et=pu(I,L,$,ct.width,ct.height,ct.Pd,ct.Qd,ct.format,null);if(Et!=0?Te=0:(Te!=null&&(Te[0]=ct.width[0]),be!=null&&(be[0]=ct.height[0]),Te=1),Te){we.width=we.width[0],we.height=we.height[0],Y!=null&&(Y[0]=we.width),Ae!=null&&(Ae[0]=we.height);e:{if(Y=new uu,(Ae=new Vr).data=I,Ae.w=L,Ae.ha=$,Ae.kd=1,L=[0],e(Ae!=null),((I=pu(Ae.data,Ae.w,Ae.ha,null,null,null,L,null,Ae))==0||I==7)&&L[0]&&(I=4),(L=I)==0){if(e(ye!=null),Y.data=Ae.data,Y.w=Ae.w+Ae.offset,Y.ha=Ae.ha-Ae.offset,Y.put=Ir,Y.ac=fn,Y.bc=Gn,Y.ma=ye,Ae.xa){if((I=Xo())==null){ye=1;break e}if(function(ke,ft){var _t=[0],Nt=[0],ut=[0];t:for(;;){if(ke==null)return 0;if(ft==null)return ke.a=2,0;if(ke.l=ft,ke.a=0,Xe(ke.m,ft.data,ft.w,ft.ha),!ii(ke.m,_t,Nt,ut)){ke.a=3;break t}if(ke.xb=ta,ft.width=_t[0],ft.height=Nt[0],!Ke(_t[0],Nt[0],1,ke,null))break t;return 1}return e(ke.a!=0),0}(I,Y)){if(Y=(L=yc(Y.width,Y.height,ye.Oa,ye.ba))==0){t:{Y=I;r:for(;;){if(Y==null){Y=0;break t}if(e(Y.s.yc!=null),e(Y.s.Ya!=null),e(0<Y.s.Wb),e(($=Y.l)!=null),e((Ae=$.ma)!=null),Y.xb!=0){if(Y.ca=Ae.ba,Y.tb=Ae.tb,e(Y.ca!=null),!wo(Ae.Oa,$,Ec)){Y.a=2;break r}if(!Vt(Y,$.width)||$.da)break r;if(($.da||lt(Y.ca.S))&&ba(),11>Y.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),Y.ca.f.kb.F!=null&&ba()),Y.Pb&&0<Y.s.ua&&Y.s.vb.X==null&&!Re(Y.s.vb,Y.s.Wa.Xa)){Y.a=1;break r}Y.xb=0}if(!Zr(Y,Y.V,Y.Ba,Y.c,Y.i,$.o,Qs))break r;Ae.Dc=Y.Ma,Y=1;break t}e(Y.a!=0),Y=0}Y=!Y}Y&&(L=I.a)}else L=I.a}else{if((I=new eA)==null){ye=1;break e}if(I.Fa=Ae.na,I.P=Ae.P,I.qc=Ae.Sa,tA(I,Y)){if((L=yc(Y.width,Y.height,ye.Oa,ye.ba))==0){if(I.Aa=0,$=ye.Oa,e((Ae=I)!=null),$!=null){if(0<(Te=0>(Te=$.Md)?0:100<Te?255:255*Te/100)){for(be=ct=0;4>be;++be)12>(Et=Ae.pb[be]).lc&&(Et.ia=Te*oo[0>Et.lc?0:Et.lc]>>3),ct|=Et.ia;ct&&(alert("todo:VP8InitRandom"),Ae.ia=1)}Ae.Ga=$.Id,100<Ae.Ga?Ae.Ga=100:0>Ae.Ga&&(Ae.Ga=0)}(function(ke,ft){if(ke==null)return 0;if(ft==null)return Yi(ke,2,"NULL VP8Io parameter in VP8Decode().");if(!ke.cb&&!tA(ke,ft))return 0;if(e(ke.cb),ft.ac==null||ft.ac(ft)){ft.ob&&(ke.L=0);var _t=Vs[ke.L];if(ke.L==2?(ke.yb=0,ke.zb=0):(ke.yb=ft.v-_t>>4,ke.zb=ft.j-_t>>4,0>ke.yb&&(ke.yb=0),0>ke.zb&&(ke.zb=0)),ke.Va=ft.o+15+_t>>4,ke.Hb=ft.va+15+_t>>4,ke.Hb>ke.za&&(ke.Hb=ke.za),ke.Va>ke.Ub&&(ke.Va=ke.Ub),0<ke.L){var Nt=ke.ed;for(_t=0;4>_t;++_t){var ut;if(ke.Qa.Cb){var zt=ke.Qa.Lb[_t];ke.Qa.Fb||(zt+=Nt.Tb)}else zt=Nt.Tb;for(ut=0;1>=ut;++ut){var Gt=ke.gd[_t][ut],sr=zt;if(Nt.Pc&&(sr+=Nt.vd[0],ut&&(sr+=Nt.od[0])),0<(sr=0>sr?0:63<sr?63:sr)){var tr=sr;0<Nt.wb&&(tr=4<Nt.wb?tr>>2:tr>>1)>9-Nt.wb&&(tr=9-Nt.wb),1>tr&&(tr=1),Gt.dd=tr,Gt.tc=2*sr+tr,Gt.ld=40<=sr?2:15<=sr?1:0}else Gt.tc=0;Gt.La=ut}}}_t=0}else Yi(ke,6,"Frame setup failed"),_t=ke.a;if(_t=_t==0){if(_t){ke.$c=0,0<ke.Aa||(ke.Ic=Ba);t:{_t=ke.Ic,Nt=4*(tr=ke.za);var Wr=32*tr,Fr=tr+1,mn=0<ke.L?tr*(0<ke.Aa?2:1):0,zr=(ke.Aa==2?2:1)*tr;if((Gt=Nt+832+(ut=3*(16*_t+Vs[ke.L])/2*Wr)+(zt=ke.Fa!=null&&0<ke.Fa.length?ke.Kc.c*ke.Kc.i:0))!=Gt)_t=0;else{if(Gt>ke.Vb){if(ke.Vb=0,ke.Ec=s(Gt),ke.Fc=0,ke.Ec==null){_t=Yi(ke,1,"no memory during frame initialization.");break t}ke.Vb=Gt}Gt=ke.Ec,sr=ke.Fc,ke.Ac=Gt,ke.Bc=sr,sr+=Nt,ke.Gd=a(Wr,Da),ke.Hd=0,ke.rb=a(Fr+1,Nr),ke.sb=1,ke.wa=mn?a(mn,qn):null,ke.Y=0,ke.D.Nb=0,ke.D.wa=ke.wa,ke.D.Y=ke.Y,0<ke.Aa&&(ke.D.Y+=tr),e(!0),ke.oc=Gt,ke.pc=sr,sr+=832,ke.ya=a(zr,ma),ke.aa=0,ke.D.ya=ke.ya,ke.D.aa=ke.aa,ke.Aa==2&&(ke.D.aa+=tr),ke.R=16*tr,ke.B=8*tr,tr=(Wr=Vs[ke.L])*ke.R,Wr=Wr/2*ke.B,ke.sa=Gt,ke.ta=sr+tr,ke.qa=ke.sa,ke.ra=ke.ta+16*_t*ke.R+Wr,ke.Ha=ke.qa,ke.Ia=ke.ra+8*_t*ke.B+Wr,ke.$c=0,sr+=ut,ke.mb=zt?Gt:null,ke.nb=zt?sr:null,e(sr+zt<=ke.Fc+ke.Vb),hu(ke),i(ke.Ac,ke.Bc,0,Nt),_t=1}}if(_t){if(ft.ka=0,ft.y=ke.sa,ft.O=ke.ta,ft.f=ke.qa,ft.N=ke.ra,ft.ea=ke.Ha,ft.Vd=ke.Ia,ft.fa=ke.R,ft.Rc=ke.B,ft.F=null,ft.J=0,!bu){for(_t=-255;255>=_t;++_t)cA[255+_t]=0>_t?-_t:_t;for(_t=-1020;1020>=_t;++_t)hh[1020+_t]=-128>_t?-128:127<_t?127:_t;for(_t=-112;112>=_t;++_t)uA[112+_t]=-16>_t?-16:15<_t?15:_t;for(_t=-255;510>=_t;++_t)Ud[255+_t]=0>_t?0:255<_t?255:_t;bu=1}fi=Ac,Ni=uc,lh=rA,fl=_a,iA=hc,Ql=th,Rd=Q,Eg=ue,Ld=mt,sA=Qt,oA=Fe,aA=tt,hf=jt,Bc=Dr,ch=Ha,yu=Va,ea=Ol,Od=gc,zo[0]=Zi,zo[1]=rh,zo[2]=as,zo[3]=Ss,zo[4]=si,zo[5]=xi,zo[6]=Rl,zo[7]=As,zo[8]=dc,zo[9]=no,dl[0]=en,dl[1]=nA,dl[2]=ya,dl[3]=hn,dl[4]=nh,dl[5]=fc,dl[6]=Fl,Vn[0]=ko,Vn[1]=Ml,Vn[2]=cl,Vn[3]=Kn,Vn[4]=Yr,Vn[5]=Tn,Vn[6]=pc,_t=1}else _t=0}_t&&(_t=function(Fn,cs){for(Fn.M=0;Fn.M<Fn.Va;++Fn.M){var wn,jr=Fn.Jc[Fn.M&Fn.Xb],_r=Fn.m,cn=Fn;for(wn=0;wn<cn.za;++wn){var bn=_r,Pn=cn,oi=Pn.Ac,ps=Pn.Bc+4*wn,js=Pn.zc,Pi=Pn.ya[Pn.aa+wn];if(Pn.Qa.Bb?Pi.$b=Dt(bn,Pn.Pa.jb[0])?2+Dt(bn,Pn.Pa.jb[2]):Dt(bn,Pn.Pa.jb[1]):Pi.$b=0,Pn.kc&&(Pi.Ad=Dt(bn,Pn.Bd)),Pi.Za=!Dt(bn,145)+0,Pi.Za){var gs=Pi.Ob,Mi=0;for(Pn=0;4>Pn;++Pn){var Fi,or=js[0+Pn];for(Fi=0;4>Fi;++Fi){or=Vd[oi[ps+Fi]][or];for(var br=yf[Dt(bn,or[0])];0<br;)br=yf[2*br+Dt(bn,or[br])];or=-br,oi[ps+Fi]=or}n(gs,Mi,oi,ps,4),Mi+=4,js[0+Pn]=or}}else or=Dt(bn,156)?Dt(bn,128)?1:3:Dt(bn,163)?2:0,Pi.Ob[0]=or,i(oi,ps,or,4),i(js,0,or,4);Pi.Dd=Dt(bn,142)?Dt(bn,114)?Dt(bn,183)?1:3:2:0}if(cn.m.Ka)return Yi(Fn,7,"Premature end-of-partition0 encountered.");for(;Fn.ja<Fn.za;++Fn.ja){if(cn=jr,bn=(_r=Fn).rb[_r.sb-1],oi=_r.rb[_r.sb+_r.ja],wn=_r.ya[_r.aa+_r.ja],ps=_r.kc?wn.Ad:0)bn.la=oi.la=0,wn.Za||(bn.Na=oi.Na=0),wn.Hc=0,wn.Gc=0,wn.ia=0;else{var di,jn;if(bn=oi,oi=cn,ps=_r.Pa.Xc,js=_r.ya[_r.aa+_r.ja],Pi=_r.pb[js.$b],Pn=js.ad,gs=0,Mi=_r.rb[_r.sb-1],or=Fi=0,i(Pn,gs,0,384),js.Za)var es=0,Ci=ps[3];else{br=s(16);var $i=bn.Na+Mi.Na;if($i=pA(oi,ps[1],$i,Pi.Eb,0,br,0),bn.Na=Mi.Na=(0<$i)+0,1<$i)fi(br,0,Pn,gs);else{var Ri=br[0]+3>>3;for(br=0;256>br;br+=16)Pn[gs+br]=Ri}es=1,Ci=ps[0]}var ai=15&bn.la,ms=15&Mi.la;for(br=0;4>br;++br){var Ms=1&ms;for(Ri=jn=0;4>Ri;++Ri)ai=ai>>1|(Ms=($i=pA(oi,Ci,$i=Ms+(1&ai),Pi.Sc,es,Pn,gs))>es)<<7,jn=jn<<2|(3<$i?3:1<$i?2:Pn[gs+0]!=0),gs+=16;ai>>=4,ms=ms>>1|Ms<<7,Fi=(Fi<<8|jn)>>>0}for(Ci=ai,es=ms>>4,di=0;4>di;di+=2){for(jn=0,ai=bn.la>>4+di,ms=Mi.la>>4+di,br=0;2>br;++br){for(Ms=1&ms,Ri=0;2>Ri;++Ri)$i=Ms+(1&ai),ai=ai>>1|(Ms=0<($i=pA(oi,ps[2],$i,Pi.Qc,0,Pn,gs)))<<3,jn=jn<<2|(3<$i?3:1<$i?2:Pn[gs+0]!=0),gs+=16;ai>>=2,ms=ms>>1|Ms<<5}or|=jn<<4*di,Ci|=ai<<4<<di,es|=(240&ms)<<di}bn.la=Ci,Mi.la=es,js.Hc=Fi,js.Gc=or,js.ia=43690&or?0:Pi.ia,ps=!(Fi|or)}if(0<_r.L&&(_r.wa[_r.Y+_r.ja]=_r.gd[wn.$b][wn.Za],_r.wa[_r.Y+_r.ja].La|=!ps),cn.Ka)return Yi(Fn,7,"Premature end-of-file encountered.")}if(hu(Fn),_r=cs,cn=1,wn=(jr=Fn).D,bn=0<jr.L&&jr.M>=jr.zb&&jr.M<=jr.Va,jr.Aa==0)t:{if(wn.M=jr.M,wn.uc=bn,$a(jr,wn),cn=1,wn=(jn=jr.D).Nb,bn=(or=Vs[jr.L])*jr.R,oi=or/2*jr.B,br=16*wn*jr.R,Ri=8*wn*jr.B,ps=jr.sa,js=jr.ta-bn+br,Pi=jr.qa,Pn=jr.ra-oi+Ri,gs=jr.Ha,Mi=jr.Ia-oi+Ri,ms=(ai=jn.M)==0,Fi=ai>=jr.Va-1,jr.Aa==2&&$a(jr,jn),jn.uc)for(Ms=($i=jr).D.M,e($i.D.uc),jn=$i.yb;jn<$i.Hb;++jn){es=jn,Ci=Ms;var Eo=($s=(zi=$i).D).Nb;di=zi.R;var $s=$s.wa[$s.Y+es],Rn=zi.sa,Ln=zi.ta+16*Eo*di+16*es,Qo=$s.dd,Yn=$s.tc;if(Yn!=0)if(e(3<=Yn),zi.L==1)0<es&&yu(Rn,Ln,di,Yn+4),$s.La&&Od(Rn,Ln,di,Yn),0<Ci&&ch(Rn,Ln,di,Yn+4),$s.La&&ea(Rn,Ln,di,Yn);else{var Gi=zi.B,Ho=zi.qa,Wa=zi.ra+8*Eo*Gi+8*es,Ca=zi.Ha,zi=zi.Ia+8*Eo*Gi+8*es;Eo=$s.ld,0<es&&(Eg(Rn,Ln,di,Yn+4,Qo,Eo),sA(Ho,Wa,Ca,zi,Gi,Yn+4,Qo,Eo)),$s.La&&(aA(Rn,Ln,di,Yn,Qo,Eo),Bc(Ho,Wa,Ca,zi,Gi,Yn,Qo,Eo)),0<Ci&&(Rd(Rn,Ln,di,Yn+4,Qo,Eo),Ld(Ho,Wa,Ca,zi,Gi,Yn+4,Qo,Eo)),$s.La&&(oA(Rn,Ln,di,Yn,Qo,Eo),hf(Ho,Wa,Ca,zi,Gi,Yn,Qo,Eo))}}if(jr.ia&&alert("todo:DitherRow"),_r.put!=null){if(jn=16*ai,ai=16*(ai+1),ms?(_r.y=jr.sa,_r.O=jr.ta+br,_r.f=jr.qa,_r.N=jr.ra+Ri,_r.ea=jr.Ha,_r.W=jr.Ia+Ri):(jn-=or,_r.y=ps,_r.O=js,_r.f=Pi,_r.N=Pn,_r.ea=gs,_r.W=Mi),Fi||(ai-=or),ai>_r.o&&(ai=_r.o),_r.F=null,_r.J=null,jr.Fa!=null&&0<jr.Fa.length&&jn<ai&&(_r.J=ls(jr,_r,jn,ai-jn),_r.F=jr.mb,_r.F==null&&_r.F.length==0)){cn=Yi(jr,3,"Could not decode alpha data.");break t}jn<_r.j&&(or=_r.j-jn,jn=_r.j,e(!(1&or)),_r.O+=jr.R*or,_r.N+=jr.B*(or>>1),_r.W+=jr.B*(or>>1),_r.F!=null&&(_r.J+=_r.width*or)),jn<ai&&(_r.O+=_r.v,_r.N+=_r.v>>1,_r.W+=_r.v>>1,_r.F!=null&&(_r.J+=_r.v),_r.ka=jn-_r.j,_r.U=_r.va-_r.v,_r.T=ai-jn,cn=_r.put(_r))}wn+1!=jr.Ic||Fi||(n(jr.sa,jr.ta-bn,ps,js+16*jr.R,bn),n(jr.qa,jr.ra-oi,Pi,Pn+8*jr.B,oi),n(jr.Ha,jr.Ia-oi,gs,Mi+8*jr.B,oi))}if(!cn)return Yi(Fn,6,"Output aborted.")}return 1}(ke,ft)),ft.bc!=null&&ft.bc(ft),_t&=1}return _t?(ke.cb=0,_t):0})(I,Y)||(L=I.a)}}else L=I.a}L==0&&ye.Oa!=null&&ye.Oa.fd&&(L=xo(ye.ba))}ye=L}_e=ye!=0?null:11>_e?we.f.RGBA.eb:we.f.kb.y}else _e=null;return _e};var Wd=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function d(Z,fe){for(var te="",ce=0;ce<4;ce++)te+=String.fromCharCode(Z[fe++]);return te}function p(Z,fe){return Z[fe+0]|Z[fe+1]<<8}function b(Z,fe){return(Z[fe+0]|Z[fe+1]<<8|Z[fe+2]<<16)>>>0}function C(Z,fe){return(Z[fe+0]|Z[fe+1]<<8|Z[fe+2]<<16|Z[fe+3]<<24)>>>0}new u;var w=[0],M=[0],P=[],k=new u,D=r,j=function(Z,fe){var te={},ce=0,ve=!1,me=0,qe=0;if(te.frames=[],!function(he,Be){for(var Le=0;Le<4;Le++)if(he[Be+Le]!="RIFF".charCodeAt(Le))return!0;return!1}(Z,fe)){for(C(Z,fe+=4),fe+=8;fe<Z.length;){var ot=d(Z,fe),st=C(Z,fe+=4);fe+=4;var Ye=st+(1&st);switch(ot){case"VP8 ":case"VP8L":te.frames[ce]===void 0&&(te.frames[ce]={}),(ht=te.frames[ce]).src_off=ve?qe:fe-8,ht.src_size=me+st+8,ce++,ve&&(ve=!1,me=0,qe=0);break;case"VP8X":(ht=te.header={}).feature_flags=Z[fe];var Xe=fe+4;ht.canvas_width=1+b(Z,Xe),Xe+=3,ht.canvas_height=1+b(Z,Xe),Xe+=3;break;case"ALPH":ve=!0,me=Ye+8,qe=fe-8;break;case"ANIM":(ht=te.header).bgcolor=C(Z,fe),Xe=fe+4,ht.loop_count=p(Z,Xe),Xe+=2;break;case"ANMF":var wt,ht;(ht=te.frames[ce]={}).offset_x=2*b(Z,fe),fe+=3,ht.offset_y=2*b(Z,fe),fe+=3,ht.width=1+b(Z,fe),fe+=3,ht.height=1+b(Z,fe),fe+=3,ht.duration=b(Z,fe),fe+=3,wt=Z[fe++],ht.dispose=1&wt,ht.blend=wt>>1&1}ot!="ANMF"&&(fe+=Ye)}return te}}(D,0);j.response=D,j.rgbaoutput=!0,j.dataurl=!1;var H=j.header?j.header:null,N=j.frames?j.frames:null;if(H){H.loop_counter=H.loop_count,w=[H.canvas_height],M=[H.canvas_width];for(var q=0;q<N.length&&N[q].blend!=0;q++);}var W=N[0],ie=k.WebPDecodeRGBA(D,W.src_off,W.src_size,M,w);W.rgba=ie,W.imgwidth=M[0],W.imgheight=w[0];for(var se=0;se<M[0]*w[0]*4;se++)P[se]=ie[se];return this.width=M,this.height=w,this.data=P,this}(function(r){var e,t,n,i,s,a,o,u,d,p=function(he){return he=he||{},this.isStrokeTransparent=he.isStrokeTransparent||!1,this.strokeOpacity=he.strokeOpacity||1,this.strokeStyle=he.strokeStyle||"#000000",this.fillStyle=he.fillStyle||"#000000",this.isFillTransparent=he.isFillTransparent||!1,this.fillOpacity=he.fillOpacity||1,this.font=he.font||"10px sans-serif",this.textBaseline=he.textBaseline||"alphabetic",this.textAlign=he.textAlign||"left",this.lineWidth=he.lineWidth||1,this.lineJoin=he.lineJoin||"miter",this.lineCap=he.lineCap||"butt",this.path=he.path||[],this.transform=he.transform!==void 0?he.transform.clone():new u,this.globalCompositeOperation=he.globalCompositeOperation||"normal",this.globalAlpha=he.globalAlpha||1,this.clip_path=he.clip_path||[],this.currentPoint=he.currentPoint||new a,this.miterLimit=he.miterLimit||10,this.lastPoint=he.lastPoint||new a,this.lineDashOffset=he.lineDashOffset||0,this.lineDash=he.lineDash||[],this.margin=he.margin||[0,0,0,0],this.prevPageLastElemOffset=he.prevPageLastElemOffset||0,this.ignoreClearRect=typeof he.ignoreClearRect!="boolean"||he.ignoreClearRect,this};r.events.push(["initialized",function(){this.context2d=new b(this),e=this.internal.f2,t=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,i=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,a=this.internal.Point,o=this.internal.Rectangle,u=this.internal.Matrix,d=new p}]);var b=function(he){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Be=he;Object.defineProperty(this,"pdf",{get:function(){return Be}});var Le=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Le},set:function(xt){Le=!!xt}});var He=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return He},set:function(xt){He=!!xt}});var rt=0;Object.defineProperty(this,"posX",{get:function(){return rt},set:function(xt){isNaN(xt)||(rt=xt)}});var it=0;Object.defineProperty(this,"posY",{get:function(){return it},set:function(xt){isNaN(xt)||(it=xt)}}),Object.defineProperty(this,"margin",{get:function(){return d.margin},set:function(xt){var Re;typeof xt=="number"?Re=[xt,xt,xt,xt]:((Re=new Array(4))[0]=xt[0],Re[1]=xt.length>=2?xt[1]:Re[0],Re[2]=xt.length>=3?xt[2]:Re[0],Re[3]=xt.length>=4?xt[3]:Re[1]),d.margin=Re}});var Pt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Pt},set:function(xt){Pt=xt}});var Bt=0;Object.defineProperty(this,"lastBreak",{get:function(){return Bt},set:function(xt){Bt=xt}});var Dt=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Dt},set:function(xt){Dt=xt}}),Object.defineProperty(this,"ctx",{get:function(){return d},set:function(xt){xt instanceof p&&(d=xt)}}),Object.defineProperty(this,"path",{get:function(){return d.path},set:function(xt){d.path=xt}});var Yt=[];Object.defineProperty(this,"ctxStack",{get:function(){return Yt},set:function(xt){Yt=xt}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(xt){var Re;Re=C(xt),this.ctx.fillStyle=Re.style,this.ctx.isFillTransparent=Re.a===0,this.ctx.fillOpacity=Re.a,this.pdf.setFillColor(Re.r,Re.g,Re.b,{a:Re.a}),this.pdf.setTextColor(Re.r,Re.g,Re.b,{a:Re.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(xt){var Re=C(xt);this.ctx.strokeStyle=Re.style,this.ctx.isStrokeTransparent=Re.a===0,this.ctx.strokeOpacity=Re.a,Re.a===0?this.pdf.setDrawColor(255,255,255):(Re.a,this.pdf.setDrawColor(Re.r,Re.g,Re.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(xt){["butt","round","square"].indexOf(xt)!==-1&&(this.ctx.lineCap=xt,this.pdf.setLineCap(xt))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(xt){isNaN(xt)||(this.ctx.lineWidth=xt,this.pdf.setLineWidth(xt))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(xt){["bevel","round","miter"].indexOf(xt)!==-1&&(this.ctx.lineJoin=xt,this.pdf.setLineJoin(xt))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(xt){isNaN(xt)||(this.ctx.miterLimit=xt,this.pdf.setMiterLimit(xt))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(xt){this.ctx.textBaseline=xt}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(xt){["right","end","center","left","start"].indexOf(xt)!==-1&&(this.ctx.textAlign=xt)}});var nr=null,ur=null;Object.defineProperty(this,"fontFaces",{get:function(){return ur},set:function(xt){nr=null,ur=xt}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(xt){var Re;if(this.ctx.font=xt,(Re=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(xt))!==null){var Kr=Re[1];Re[2];var Ur=Re[3],Er=Re[4];Re[5];var Kt=Re[6],Br=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(Er)[2];Er=Math.floor(Br==="px"?parseFloat(Er)*this.pdf.internal.scaleFactor:Br==="em"?parseFloat(Er)*this.pdf.getFontSize():parseFloat(Er)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(Er);var ar=function(Ne){var re,ae,ge=[],xe=Ne.trim();if(xe==="")return rD;if(xe in qU)return[qU[xe]];for(;xe!=="";){switch(ae=null,re=(xe=XU(xe)).charAt(0)){case'"':case"'":ae=yde(xe.substring(1),re);break;default:ae=bde(xe)}if(ae===null||(ge.push(ae[0]),(xe=XU(ae[1]))!==""&&xe.charAt(0)!==","))return rD;xe=xe.replace(/^,/,"")}return ge}(Kt);if(this.fontFaces){var Lr=function(Ne,re){if(nr===null){var ae=function(ge){var xe=[];return Object.keys(ge).forEach(function(Me){ge[Me].forEach(function(We){var nt=null;switch(We){case"bold":nt={family:Me,weight:"bold"};break;case"italic":nt={family:Me,style:"italic"};break;case"bolditalic":nt={family:Me,weight:"bold",style:"italic"};break;case"":case"normal":nt={family:Me}}nt!==null&&(nt.ref={name:Me,style:We},xe.push(nt))})}),xe}(Ne.getFontList());nr=function(ge){for(var xe={},Me=0;Me<ge.length;++Me){var We=cC(ge[Me]),nt=We.family,Ge=We.stretch,lt=We.style,Lt=We.weight;xe[nt]=xe[nt]||{},xe[nt][Ge]=xe[nt][Ge]||{},xe[nt][Ge][lt]=xe[nt][Ge][lt]||{},xe[nt][Ge][lt][Lt]=We}return xe}(ae.concat(re))}return nr}(this.pdf,this.fontFaces),vr=ar.map(function(Ne){return{family:Ne,stretch:"normal",weight:Ur,style:Kr}}),kt=function(Ne,re,ae){for(var ge=(ae=ae||{}).defaultFontFamily||"times",xe=Object.assign({},_de,ae.genericFontFamilies||{}),Me=null,We=null,nt=0;nt<re.length;++nt)if(xe[(Me=cC(re[nt])).family]&&(Me.family=xe[Me.family]),Ne.hasOwnProperty(Me.family)){We=Ne[Me.family];break}if(!(We=We||Ne[ge]))throw new Error("Could not find a font-family for the rule '"+KU(Me)+"' and default family '"+ge+"'.");if(We=function(Ge,lt){if(lt[Ge])return lt[Ge];var Lt=lC[Ge],Ft=Lt<=lC.normal?-1:1,Wt=WU(lt,$U,Lt,Ft);if(!Wt)throw new Error("Could not find a matching font-stretch value for "+Ge);return Wt}(Me.stretch,We),We=function(Ge,lt){if(lt[Ge])return lt[Ge];for(var Lt=jU[Ge],Ft=0;Ft<Lt.length;++Ft)if(lt[Lt[Ft]])return lt[Lt[Ft]];throw new Error("Could not find a matching font-style for "+Ge)}(Me.style,We),!(We=function(Ge,lt){if(lt[Ge])return lt[Ge];if(Ge===400&&lt[500])return lt[500];if(Ge===500&&lt[400])return lt[400];var Lt=mde[Ge],Ft=WU(lt,GU,Lt,Ge<400?-1:1);if(!Ft)throw new Error("Could not find a matching font-weight for value "+Ge);return Ft}(Me.weight,We)))throw new Error("Failed to resolve a font for the rule '"+KU(Me)+"'.");return We}(Lr,vr);this.pdf.setFont(kt.ref.name,kt.ref.style)}else{var ir="";(Ur==="bold"||parseInt(Ur,10)>=700||Kr==="bold")&&(ir="bold"),Kr==="italic"&&(ir+="italic"),ir.length===0&&(ir="normal");for(var hr="",Mr={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Cr=0;Cr<ar.length;Cr++){if(this.pdf.internal.getFont(ar[Cr],ir,{noFallback:!0,disableWarning:!0})!==void 0){hr=ar[Cr];break}if(ir==="bolditalic"&&this.pdf.internal.getFont(ar[Cr],"bold",{noFallback:!0,disableWarning:!0})!==void 0)hr=ar[Cr],ir="bold";else if(this.pdf.internal.getFont(ar[Cr],"normal",{noFallback:!0,disableWarning:!0})!==void 0){hr=ar[Cr],ir="normal";break}}if(hr===""){for(var wr=0;wr<ar.length;wr++)if(Mr[ar[wr]]){hr=Mr[ar[wr]];break}}hr=hr===""?"Times":hr,this.pdf.setFont(hr,ir)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(xt){this.ctx.globalCompositeOperation=xt}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(xt){this.ctx.globalAlpha=xt}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(xt){this.ctx.lineDashOffset=xt,ht.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(xt){this.ctx.lineDash=xt,ht.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(xt){this.ctx.ignoreClearRect=!!xt}})};b.prototype.setLineDash=function(he){this.lineDash=he},b.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},b.prototype.fill=function(){N.call(this,"fill",!1)},b.prototype.stroke=function(){N.call(this,"stroke",!1)},b.prototype.beginPath=function(){this.path=[{type:"begin"}]},b.prototype.moveTo=function(he,Be){if(isNaN(he)||isNaN(Be))throw Ui.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Le=this.ctx.transform.applyToPoint(new a(he,Be));this.path.push({type:"mt",x:Le.x,y:Le.y}),this.ctx.lastPoint=new a(he,Be)},b.prototype.closePath=function(){var he=new a(0,0),Be=0;for(Be=this.path.length-1;Be!==-1;Be--)if(this.path[Be].type==="begin"&&ni(this.path[Be+1])==="object"&&typeof this.path[Be+1].x=="number"){he=new a(this.path[Be+1].x,this.path[Be+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new a(he.x,he.y)},b.prototype.lineTo=function(he,Be){if(isNaN(he)||isNaN(Be))throw Ui.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Le=this.ctx.transform.applyToPoint(new a(he,Be));this.path.push({type:"lt",x:Le.x,y:Le.y}),this.ctx.lastPoint=new a(Le.x,Le.y)},b.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),N.call(this,null,!0)},b.prototype.quadraticCurveTo=function(he,Be,Le,He){if(isNaN(Le)||isNaN(He)||isNaN(he)||isNaN(Be))throw Ui.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var rt=this.ctx.transform.applyToPoint(new a(Le,He)),it=this.ctx.transform.applyToPoint(new a(he,Be));this.path.push({type:"qct",x1:it.x,y1:it.y,x:rt.x,y:rt.y}),this.ctx.lastPoint=new a(rt.x,rt.y)},b.prototype.bezierCurveTo=function(he,Be,Le,He,rt,it){if(isNaN(rt)||isNaN(it)||isNaN(he)||isNaN(Be)||isNaN(Le)||isNaN(He))throw Ui.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Pt=this.ctx.transform.applyToPoint(new a(rt,it)),Bt=this.ctx.transform.applyToPoint(new a(he,Be)),Dt=this.ctx.transform.applyToPoint(new a(Le,He));this.path.push({type:"bct",x1:Bt.x,y1:Bt.y,x2:Dt.x,y2:Dt.y,x:Pt.x,y:Pt.y}),this.ctx.lastPoint=new a(Pt.x,Pt.y)},b.prototype.arc=function(he,Be,Le,He,rt,it){if(isNaN(he)||isNaN(Be)||isNaN(Le)||isNaN(He)||isNaN(rt))throw Ui.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(it=!!it,!this.ctx.transform.isIdentity){var Pt=this.ctx.transform.applyToPoint(new a(he,Be));he=Pt.x,Be=Pt.y;var Bt=this.ctx.transform.applyToPoint(new a(0,Le)),Dt=this.ctx.transform.applyToPoint(new a(0,0));Le=Math.sqrt(Math.pow(Bt.x-Dt.x,2)+Math.pow(Bt.y-Dt.y,2))}Math.abs(rt-He)>=2*Math.PI&&(He=0,rt=2*Math.PI),this.path.push({type:"arc",x:he,y:Be,radius:Le,startAngle:He,endAngle:rt,counterclockwise:it})},b.prototype.arcTo=function(he,Be,Le,He,rt){throw new Error("arcTo not implemented.")},b.prototype.rect=function(he,Be,Le,He){if(isNaN(he)||isNaN(Be)||isNaN(Le)||isNaN(He))throw Ui.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(he,Be),this.lineTo(he+Le,Be),this.lineTo(he+Le,Be+He),this.lineTo(he,Be+He),this.lineTo(he,Be),this.lineTo(he+Le,Be),this.lineTo(he,Be)},b.prototype.fillRect=function(he,Be,Le,He){if(isNaN(he)||isNaN(Be)||isNaN(Le)||isNaN(He))throw Ui.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!w.call(this)){var rt={};this.lineCap!=="butt"&&(rt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(rt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(he,Be,Le,He),this.fill(),rt.hasOwnProperty("lineCap")&&(this.lineCap=rt.lineCap),rt.hasOwnProperty("lineJoin")&&(this.lineJoin=rt.lineJoin)}},b.prototype.strokeRect=function(he,Be,Le,He){if(isNaN(he)||isNaN(Be)||isNaN(Le)||isNaN(He))throw Ui.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");M.call(this)||(this.beginPath(),this.rect(he,Be,Le,He),this.stroke())},b.prototype.clearRect=function(he,Be,Le,He){if(isNaN(he)||isNaN(Be)||isNaN(Le)||isNaN(He))throw Ui.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(he,Be,Le,He))},b.prototype.save=function(he){he=typeof he!="boolean"||he;for(var Be=this.pdf.internal.getCurrentPageInfo().pageNumber,Le=0;Le<this.pdf.internal.getNumberOfPages();Le++)this.pdf.setPage(Le+1),this.pdf.internal.out("q");if(this.pdf.setPage(Be),he){this.ctx.fontSize=this.pdf.internal.getFontSize();var He=new p(this.ctx);this.ctxStack.push(this.ctx),this.ctx=He}},b.prototype.restore=function(he){he=typeof he!="boolean"||he;for(var Be=this.pdf.internal.getCurrentPageInfo().pageNumber,Le=0;Le<this.pdf.internal.getNumberOfPages();Le++)this.pdf.setPage(Le+1),this.pdf.internal.out("Q");this.pdf.setPage(Be),he&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},b.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var C=function(he){var Be,Le,He,rt;if(he.isCanvasGradient===!0&&(he=he.getColor()),!he)return{r:0,g:0,b:0,a:0,style:he};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(he))Be=0,Le=0,He=0,rt=0;else{var it=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(he);if(it!==null)Be=parseInt(it[1]),Le=parseInt(it[2]),He=parseInt(it[3]),rt=1;else if((it=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(he))!==null)Be=parseInt(it[1]),Le=parseInt(it[2]),He=parseInt(it[3]),rt=parseFloat(it[4]);else{if(rt=1,typeof he=="string"&&he.charAt(0)!=="#"){var Pt=new FU(he);he=Pt.ok?Pt.toHex():"#000000"}he.length===4?(Be=he.substring(1,2),Be+=Be,Le=he.substring(2,3),Le+=Le,He=he.substring(3,4),He+=He):(Be=he.substring(1,3),Le=he.substring(3,5),He=he.substring(5,7)),Be=parseInt(Be,16),Le=parseInt(Le,16),He=parseInt(He,16)}}return{r:Be,g:Le,b:He,a:rt,style:he}},w=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},M=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};b.prototype.fillText=function(he,Be,Le,He){if(isNaN(Be)||isNaN(Le)||typeof he!="string")throw Ui.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(He=isNaN(He)?void 0:He,!w.call(this)){var rt=Ye(this.ctx.transform.rotation),it=this.ctx.transform.scaleX;ce.call(this,{text:he,x:Be,y:Le,scale:it,angle:rt,align:this.textAlign,maxWidth:He})}},b.prototype.strokeText=function(he,Be,Le,He){if(isNaN(Be)||isNaN(Le)||typeof he!="string")throw Ui.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!M.call(this)){He=isNaN(He)?void 0:He;var rt=Ye(this.ctx.transform.rotation),it=this.ctx.transform.scaleX;ce.call(this,{text:he,x:Be,y:Le,scale:it,renderingMode:"stroke",angle:rt,align:this.textAlign,maxWidth:He})}},b.prototype.measureText=function(he){if(typeof he!="string")throw Ui.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Be=this.pdf,Le=this.pdf.internal.scaleFactor,He=Be.internal.getFontSize(),rt=Be.getStringUnitWidth(he)*He/Be.internal.scaleFactor;return new function(it){var Pt=(it=it||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return Pt}}),this}({width:rt*=Math.round(96*Le/72*1e4)/1e4})},b.prototype.scale=function(he,Be){if(isNaN(he)||isNaN(Be))throw Ui.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Le=new u(he,0,0,Be,0,0);this.ctx.transform=this.ctx.transform.multiply(Le)},b.prototype.rotate=function(he){if(isNaN(he))throw Ui.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Be=new u(Math.cos(he),Math.sin(he),-Math.sin(he),Math.cos(he),0,0);this.ctx.transform=this.ctx.transform.multiply(Be)},b.prototype.translate=function(he,Be){if(isNaN(he)||isNaN(Be))throw Ui.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Le=new u(1,0,0,1,he,Be);this.ctx.transform=this.ctx.transform.multiply(Le)},b.prototype.transform=function(he,Be,Le,He,rt,it){if(isNaN(he)||isNaN(Be)||isNaN(Le)||isNaN(He)||isNaN(rt)||isNaN(it))throw Ui.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Pt=new u(he,Be,Le,He,rt,it);this.ctx.transform=this.ctx.transform.multiply(Pt)},b.prototype.setTransform=function(he,Be,Le,He,rt,it){he=isNaN(he)?1:he,Be=isNaN(Be)?0:Be,Le=isNaN(Le)?0:Le,He=isNaN(He)?1:He,rt=isNaN(rt)?0:rt,it=isNaN(it)?0:it,this.ctx.transform=new u(he,Be,Le,He,rt,it)};var P=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};b.prototype.drawImage=function(he,Be,Le,He,rt,it,Pt,Bt,Dt){var Yt=this.pdf.getImageProperties(he),nr=1,ur=1,xt=1,Re=1;He!==void 0&&Bt!==void 0&&(xt=Bt/He,Re=Dt/rt,nr=Yt.width/He*Bt/He,ur=Yt.height/rt*Dt/rt),it===void 0&&(it=Be,Pt=Le,Be=0,Le=0),He!==void 0&&Bt===void 0&&(Bt=He,Dt=rt),He===void 0&&Bt===void 0&&(Bt=Yt.width,Dt=Yt.height);for(var Kr,Ur=this.ctx.transform.decompose(),Er=Ye(Ur.rotate.shx),Kt=new u,Br=(Kt=(Kt=(Kt=Kt.multiply(Ur.translate)).multiply(Ur.skew)).multiply(Ur.scale)).applyToRectangle(new o(it-Be*xt,Pt-Le*Re,He*nr,rt*ur)),ar=k.call(this,Br),Lr=[],vr=0;vr<ar.length;vr+=1)Lr.indexOf(ar[vr])===-1&&Lr.push(ar[vr]);if(H(Lr),this.autoPaging)for(var kt=Lr[0],ir=Lr[Lr.length-1],hr=kt;hr<ir+1;hr++){this.pdf.setPage(hr);var Mr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Cr=hr===1?this.posY+this.margin[0]:this.margin[0],wr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Ne=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],re=hr===1?0:wr+(hr-2)*Ne;if(this.ctx.clip_path.length!==0){var ae=this.path;Kr=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=j(Kr,this.posX+this.margin[3],-re+Cr+this.ctx.prevPageLastElemOffset),q.call(this,"fill",!0),this.path=ae}var ge=JSON.parse(JSON.stringify(Br));ge=j([ge],this.posX+this.margin[3],-re+Cr+this.ctx.prevPageLastElemOffset)[0];var xe=(hr>kt||hr<ir)&&P.call(this);xe&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Mr,Ne,null).clip().discardPath()),this.pdf.addImage(he,"JPEG",ge.x,ge.y,ge.w,ge.h,null,null,Er),xe&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(he,"JPEG",Br.x,Br.y,Br.w,Br.h,null,null,Er)};var k=function(he,Be,Le){var He=[];Be=Be||this.pdf.internal.pageSize.width,Le=Le||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var rt=this.posY+this.ctx.prevPageLastElemOffset;switch(he.type){default:case"mt":case"lt":He.push(Math.floor((he.y+rt)/Le)+1);break;case"arc":He.push(Math.floor((he.y+rt-he.radius)/Le)+1),He.push(Math.floor((he.y+rt+he.radius)/Le)+1);break;case"qct":var it=Xe(this.ctx.lastPoint.x,this.ctx.lastPoint.y,he.x1,he.y1,he.x,he.y);He.push(Math.floor((it.y+rt)/Le)+1),He.push(Math.floor((it.y+it.h+rt)/Le)+1);break;case"bct":var Pt=wt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,he.x1,he.y1,he.x2,he.y2,he.x,he.y);He.push(Math.floor((Pt.y+rt)/Le)+1),He.push(Math.floor((Pt.y+Pt.h+rt)/Le)+1);break;case"rect":He.push(Math.floor((he.y+rt)/Le)+1),He.push(Math.floor((he.y+he.h+rt)/Le)+1)}for(var Bt=0;Bt<He.length;Bt+=1)for(;this.pdf.internal.getNumberOfPages()<He[Bt];)D.call(this);return He},D=function(){var he=this.fillStyle,Be=this.strokeStyle,Le=this.font,He=this.lineCap,rt=this.lineWidth,it=this.lineJoin;this.pdf.addPage(),this.fillStyle=he,this.strokeStyle=Be,this.font=Le,this.lineCap=He,this.lineWidth=rt,this.lineJoin=it},j=function(he,Be,Le){for(var He=0;He<he.length;He++)switch(he[He].type){case"bct":he[He].x2+=Be,he[He].y2+=Le;case"qct":he[He].x1+=Be,he[He].y1+=Le;default:he[He].x+=Be,he[He].y+=Le}return he},H=function(he){return he.sort(function(Be,Le){return Be-Le})},N=function(he,Be){for(var Le,He,rt=this.fillStyle,it=this.strokeStyle,Pt=this.lineCap,Bt=this.lineWidth,Dt=Math.abs(Bt*this.ctx.transform.scaleX),Yt=this.lineJoin,nr=JSON.parse(JSON.stringify(this.path)),ur=JSON.parse(JSON.stringify(this.path)),xt=[],Re=0;Re<ur.length;Re++)if(ur[Re].x!==void 0)for(var Kr=k.call(this,ur[Re]),Ur=0;Ur<Kr.length;Ur+=1)xt.indexOf(Kr[Ur])===-1&&xt.push(Kr[Ur]);for(var Er=0;Er<xt.length;Er++)for(;this.pdf.internal.getNumberOfPages()<xt[Er];)D.call(this);if(H(xt),this.autoPaging)for(var Kt=xt[0],Br=xt[xt.length-1],ar=Kt;ar<Br+1;ar++){this.pdf.setPage(ar),this.fillStyle=rt,this.strokeStyle=it,this.lineCap=Pt,this.lineWidth=Dt,this.lineJoin=Yt;var Lr=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],vr=ar===1?this.posY+this.margin[0]:this.margin[0],kt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],ir=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],hr=ar===1?0:kt+(ar-2)*ir;if(this.ctx.clip_path.length!==0){var Mr=this.path;Le=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=j(Le,this.posX+this.margin[3],-hr+vr+this.ctx.prevPageLastElemOffset),q.call(this,he,!0),this.path=Mr}if(He=JSON.parse(JSON.stringify(nr)),this.path=j(He,this.posX+this.margin[3],-hr+vr+this.ctx.prevPageLastElemOffset),Be===!1||ar===0){var Cr=(ar>Kt||ar<Br)&&P.call(this);Cr&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Lr,ir,null).clip().discardPath()),q.call(this,he,Be),Cr&&this.pdf.restoreGraphicsState()}this.lineWidth=Bt}else this.lineWidth=Dt,q.call(this,he,Be),this.lineWidth=Bt;this.path=nr},q=function(he,Be){if((he!=="stroke"||Be||!M.call(this))&&(he==="stroke"||Be||!w.call(this))){for(var Le,He,rt=[],it=this.path,Pt=0;Pt<it.length;Pt++){var Bt=it[Pt];switch(Bt.type){case"begin":rt.push({begin:!0});break;case"close":rt.push({close:!0});break;case"mt":rt.push({start:Bt,deltas:[],abs:[]});break;case"lt":var Dt=rt.length;if(it[Pt-1]&&!isNaN(it[Pt-1].x)&&(Le=[Bt.x-it[Pt-1].x,Bt.y-it[Pt-1].y],Dt>0)){for(;Dt>=0;Dt--)if(rt[Dt-1].close!==!0&&rt[Dt-1].begin!==!0){rt[Dt-1].deltas.push(Le),rt[Dt-1].abs.push(Bt);break}}break;case"bct":Le=[Bt.x1-it[Pt-1].x,Bt.y1-it[Pt-1].y,Bt.x2-it[Pt-1].x,Bt.y2-it[Pt-1].y,Bt.x-it[Pt-1].x,Bt.y-it[Pt-1].y],rt[rt.length-1].deltas.push(Le);break;case"qct":var Yt=it[Pt-1].x+2/3*(Bt.x1-it[Pt-1].x),nr=it[Pt-1].y+2/3*(Bt.y1-it[Pt-1].y),ur=Bt.x+2/3*(Bt.x1-Bt.x),xt=Bt.y+2/3*(Bt.y1-Bt.y),Re=Bt.x,Kr=Bt.y;Le=[Yt-it[Pt-1].x,nr-it[Pt-1].y,ur-it[Pt-1].x,xt-it[Pt-1].y,Re-it[Pt-1].x,Kr-it[Pt-1].y],rt[rt.length-1].deltas.push(Le);break;case"arc":rt.push({deltas:[],abs:[],arc:!0}),Array.isArray(rt[rt.length-1].abs)&&rt[rt.length-1].abs.push(Bt)}}He=Be?null:he==="stroke"?"stroke":"fill";for(var Ur=!1,Er=0;Er<rt.length;Er++)if(rt[Er].arc)for(var Kt=rt[Er].abs,Br=0;Br<Kt.length;Br++){var ar=Kt[Br];ar.type==="arc"?se.call(this,ar.x,ar.y,ar.radius,ar.startAngle,ar.endAngle,ar.counterclockwise,void 0,Be,!Ur):ve.call(this,ar.x,ar.y),Ur=!0}else if(rt[Er].close===!0)this.pdf.internal.out("h"),Ur=!1;else if(rt[Er].begin!==!0){var Lr=rt[Er].start.x,vr=rt[Er].start.y;me.call(this,rt[Er].deltas,Lr,vr),Ur=!0}He&&Z.call(this,He),Be&&fe.call(this)}},W=function(he){var Be=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Le=Be*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return he-Le;case"top":return he+Be-Le;case"hanging":return he+Be-2*Le;case"middle":return he+Be/2-Le;default:return he}},ie=function(he){return he+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};b.prototype.createLinearGradient=function(){var he=function(){};return he.colorStops=[],he.addColorStop=function(Be,Le){this.colorStops.push([Be,Le])},he.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},he.isCanvasGradient=!0,he},b.prototype.createPattern=function(){return this.createLinearGradient()},b.prototype.createRadialGradient=function(){return this.createLinearGradient()};var se=function(he,Be,Le,He,rt,it,Pt,Bt,Dt){for(var Yt=ot.call(this,Le,He,rt,it),nr=0;nr<Yt.length;nr++){var ur=Yt[nr];nr===0&&(Dt?te.call(this,ur.x1+he,ur.y1+Be):ve.call(this,ur.x1+he,ur.y1+Be)),qe.call(this,he,Be,ur.x2,ur.y2,ur.x3,ur.y3,ur.x4,ur.y4)}Bt?fe.call(this):Z.call(this,Pt)},Z=function(he){switch(he){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},fe=function(){this.pdf.clip(),this.pdf.discardPath()},te=function(he,Be){this.pdf.internal.out(t(he)+" "+n(Be)+" m")},ce=function(he){var Be;switch(he.align){case"right":case"end":Be="right";break;case"center":Be="center";break;default:Be="left"}var Le=this.pdf.getTextDimensions(he.text),He=W.call(this,he.y),rt=ie.call(this,He)-Le.h,it=this.ctx.transform.applyToPoint(new a(he.x,He)),Pt=this.ctx.transform.decompose(),Bt=new u;Bt=(Bt=(Bt=Bt.multiply(Pt.translate)).multiply(Pt.skew)).multiply(Pt.scale);for(var Dt,Yt,nr,ur=this.ctx.transform.applyToRectangle(new o(he.x,He,Le.w,Le.h)),xt=Bt.applyToRectangle(new o(he.x,rt,Le.w,Le.h)),Re=k.call(this,xt),Kr=[],Ur=0;Ur<Re.length;Ur+=1)Kr.indexOf(Re[Ur])===-1&&Kr.push(Re[Ur]);if(H(Kr),this.autoPaging)for(var Er=Kr[0],Kt=Kr[Kr.length-1],Br=Er;Br<Kt+1;Br++){this.pdf.setPage(Br);var ar=Br===1?this.posY+this.margin[0]:this.margin[0],Lr=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],vr=this.pdf.internal.pageSize.height-this.margin[2],kt=vr-this.margin[0],ir=this.pdf.internal.pageSize.width-this.margin[1],hr=ir-this.margin[3],Mr=Br===1?0:Lr+(Br-2)*kt;if(this.ctx.clip_path.length!==0){var Cr=this.path;Dt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=j(Dt,this.posX+this.margin[3],-1*Mr+ar),q.call(this,"fill",!0),this.path=Cr}var wr=j([JSON.parse(JSON.stringify(xt))],this.posX+this.margin[3],-Mr+ar+this.ctx.prevPageLastElemOffset)[0];he.scale>=.01&&(Yt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Yt*he.scale),nr=this.lineWidth,this.lineWidth=nr*he.scale);var Ne=this.autoPaging!=="text";if(Ne||wr.y+wr.h<=vr){if(Ne||wr.y>=ar&&wr.x<=ir){var re=Ne?he.text:this.pdf.splitTextToSize(he.text,he.maxWidth||ir-wr.x)[0],ae=j([JSON.parse(JSON.stringify(ur))],this.posX+this.margin[3],-Mr+ar+this.ctx.prevPageLastElemOffset)[0],ge=Ne&&(Br>Er||Br<Kt)&&P.call(this);ge&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],hr,kt,null).clip().discardPath()),this.pdf.text(re,ae.x,ae.y,{angle:he.angle,align:Be,renderingMode:he.renderingMode}),ge&&this.pdf.restoreGraphicsState()}}else wr.y<vr&&(this.ctx.prevPageLastElemOffset+=vr-wr.y);he.scale>=.01&&(this.pdf.setFontSize(Yt),this.lineWidth=nr)}else he.scale>=.01&&(Yt=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Yt*he.scale),nr=this.lineWidth,this.lineWidth=nr*he.scale),this.pdf.text(he.text,it.x+this.posX,it.y+this.posY,{angle:he.angle,align:Be,renderingMode:he.renderingMode,maxWidth:he.maxWidth}),he.scale>=.01&&(this.pdf.setFontSize(Yt),this.lineWidth=nr)},ve=function(he,Be,Le,He){Le=Le||0,He=He||0,this.pdf.internal.out(t(he+Le)+" "+n(Be+He)+" l")},me=function(he,Be,Le){return this.pdf.lines(he,Be,Le,null,null)},qe=function(he,Be,Le,He,rt,it,Pt,Bt){this.pdf.internal.out([e(i(Le+he)),e(s(He+Be)),e(i(rt+he)),e(s(it+Be)),e(i(Pt+he)),e(s(Bt+Be)),"c"].join(" "))},ot=function(he,Be,Le,He){for(var rt=2*Math.PI,it=Math.PI/2;Be>Le;)Be-=rt;var Pt=Math.abs(Le-Be);Pt<rt&&He&&(Pt=rt-Pt);for(var Bt=[],Dt=He?-1:1,Yt=Be;Pt>1e-5;){var nr=Yt+Dt*Math.min(Pt,it);Bt.push(st.call(this,he,Yt,nr)),Pt-=Math.abs(nr-Yt),Yt=nr}return Bt},st=function(he,Be,Le){var He=(Le-Be)/2,rt=he*Math.cos(He),it=he*Math.sin(He),Pt=rt,Bt=-it,Dt=Pt*Pt+Bt*Bt,Yt=Dt+Pt*rt+Bt*it,nr=4/3*(Math.sqrt(2*Dt*Yt)-Yt)/(Pt*it-Bt*rt),ur=Pt-nr*Bt,xt=Bt+nr*Pt,Re=ur,Kr=-xt,Ur=He+Be,Er=Math.cos(Ur),Kt=Math.sin(Ur);return{x1:he*Math.cos(Be),y1:he*Math.sin(Be),x2:ur*Er-xt*Kt,y2:ur*Kt+xt*Er,x3:Re*Er-Kr*Kt,y3:Re*Kt+Kr*Er,x4:he*Math.cos(Le),y4:he*Math.sin(Le)}},Ye=function(he){return 180*he/Math.PI},Xe=function(he,Be,Le,He,rt,it){var Pt=he+.5*(Le-he),Bt=Be+.5*(He-Be),Dt=rt+.5*(Le-rt),Yt=it+.5*(He-it),nr=Math.min(he,rt,Pt,Dt),ur=Math.max(he,rt,Pt,Dt),xt=Math.min(Be,it,Bt,Yt),Re=Math.max(Be,it,Bt,Yt);return new o(nr,xt,ur-nr,Re-xt)},wt=function(he,Be,Le,He,rt,it,Pt,Bt){var Dt,Yt,nr,ur,xt,Re,Kr,Ur,Er,Kt,Br,ar,Lr,vr,kt=Le-he,ir=He-Be,hr=rt-Le,Mr=it-He,Cr=Pt-rt,wr=Bt-it;for(Yt=0;Yt<41;Yt++)Er=(Kr=(nr=he+(Dt=Yt/40)*kt)+Dt*((xt=Le+Dt*hr)-nr))+Dt*(xt+Dt*(rt+Dt*Cr-xt)-Kr),Kt=(Ur=(ur=Be+Dt*ir)+Dt*((Re=He+Dt*Mr)-ur))+Dt*(Re+Dt*(it+Dt*wr-Re)-Ur),Yt==0?(Br=Er,ar=Kt,Lr=Er,vr=Kt):(Br=Math.min(Br,Er),ar=Math.min(ar,Kt),Lr=Math.max(Lr,Er),vr=Math.max(vr,Kt));return new o(Math.round(Br),Math.round(ar),Math.round(Lr-Br),Math.round(vr-ar))},ht=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var he,Be,Le=(he=this.ctx.lineDash,Be=this.ctx.lineDashOffset,JSON.stringify({lineDash:he,lineDashOffset:Be}));this.prevLineDash!==Le&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Le)}}})(Jr.API),function(r){var e=function(a){var o,u,d,p,b,C,w,M,P,k;for(u=[],d=0,p=(a+=o="\0\0\0\0".slice(a.length%4||4)).length;p>d;d+=4)(b=(a.charCodeAt(d)<<24)+(a.charCodeAt(d+1)<<16)+(a.charCodeAt(d+2)<<8)+a.charCodeAt(d+3))!==0?(C=(b=((b=((b=((b=(b-(k=b%85))/85)-(P=b%85))/85)-(M=b%85))/85)-(w=b%85))/85)%85,u.push(C+33,w+33,M+33,P+33,k+33)):u.push(122);return function(D,j){for(var H=j;H>0;H--)D.pop()}(u,o.length),String.fromCharCode.apply(String,u)+"~>"},t=function(a){var o,u,d,p,b,C=String,w="length",M=255,P="charCodeAt",k="slice",D="replace";for(a[k](-2),a=a[k](0,-2)[D](/\s/g,"")[D]("z","!!!!!"),d=[],p=0,b=(a+=o="uuuuu"[k](a[w]%5||5))[w];b>p;p+=5)u=52200625*(a[P](p)-33)+614125*(a[P](p+1)-33)+7225*(a[P](p+2)-33)+85*(a[P](p+3)-33)+(a[P](p+4)-33),d.push(M&u>>24,M&u>>16,M&u>>8,M&u);return function(j,H){for(var N=H;N>0;N--)j.pop()}(d,o[w]),C.fromCharCode.apply(C,d)},n=function(a){return a.split("").map(function(o){return("0"+o.charCodeAt().toString(16)).slice(-2)}).join("")+">"},i=function(a){var o=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((a=a.replace(/\s/g,"")).indexOf(">")!==-1&&(a=a.substr(0,a.indexOf(">"))),a.length%2&&(a+="0"),o.test(a)===!1)return"";for(var u="",d=0;d<a.length;d+=2)u+=String.fromCharCode("0x"+(a[d]+a[d+1]));return u},s=function(a){for(var o=new Uint8Array(a.length),u=a.length;u--;)o[u]=a.charCodeAt(u);return(o=kB(o)).reduce(function(d,p){return d+String.fromCharCode(p)},"")};r.processDataByFilters=function(a,o){var u=0,d=a||"",p=[];for(typeof(o=o||[])=="string"&&(o=[o]),u=0;u<o.length;u+=1)switch(o[u]){case"ASCII85Decode":case"/ASCII85Decode":d=t(d),p.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":d=e(d),p.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":d=i(d),p.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":d=n(d),p.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":d=s(d),p.push("/FlateDecode");break;default:throw new Error('The filter: "'+o[u]+'" is not implemented')}return{data:d,reverseChain:p.reverse().join(" ")}}}(Jr.API),function(r){r.loadFile=function(e,t,n){return function(i,s,a){s=s!==!1,a=typeof a=="function"?a:function(){};var o=void 0;try{o=function(u,d,p){var b=new XMLHttpRequest,C=0,w=function(M){var P=M.length,k=[],D=String.fromCharCode;for(C=0;C<P;C+=1)k.push(D(255&M.charCodeAt(C)));return k.join("")};if(b.open("GET",u,!d),b.overrideMimeType("text/plain; charset=x-user-defined"),d===!1&&(b.onload=function(){b.status===200?p(w(this.responseText)):p(void 0)}),b.send(null),d&&b.status===200)return w(b.responseText)}(i,s,a)}catch{}return o}(e,t,n)},r.loadImageFile=r.loadFile}(Jr.API),function(r){function e(){return(yn.html2canvas?Promise.resolve(yn.html2canvas):Promise.resolve().then(()=>_1e)).catch(function(o){return Promise.reject(new Error("Could not load html2canvas: "+o))}).then(function(o){return o.default?o.default:o})}function t(){return(yn.DOMPurify?Promise.resolve(yn.DOMPurify):Promise.resolve().then(()=>Q1e)).catch(function(o){return Promise.reject(new Error("Could not load dompurify: "+o))}).then(function(o){return o.default?o.default:o})}var n=function(o){var u=ni(o);return u==="undefined"?"undefined":u==="string"||o instanceof String?"string":u==="number"||o instanceof Number?"number":u==="function"||o instanceof Function?"function":o&&o.constructor===Array?"array":o&&o.nodeType===1?"element":u==="object"?"object":"unknown"},i=function(o,u){var d=document.createElement(o);for(var p in u.className&&(d.className=u.className),u.innerHTML&&u.dompurify&&(d.innerHTML=u.dompurify.sanitize(u.innerHTML)),u.style)d.style[p]=u.style[p];return d},s=function o(u,d){for(var p=u.nodeType===3?document.createTextNode(u.nodeValue):u.cloneNode(!1),b=u.firstChild;b;b=b.nextSibling)d!==!0&&b.nodeType===1&&b.nodeName==="SCRIPT"||p.appendChild(o(b,d));return u.nodeType===1&&(u.nodeName==="CANVAS"?(p.width=u.width,p.height=u.height,p.getContext("2d").drawImage(u,0,0)):u.nodeName!=="TEXTAREA"&&u.nodeName!=="SELECT"||(p.value=u.value),p.addEventListener("load",function(){p.scrollTop=u.scrollTop,p.scrollLeft=u.scrollLeft},!0)),p},a=function o(u){var d=Object.assign(o.convert(Promise.resolve()),JSON.parse(JSON.stringify(o.template))),p=o.convert(Promise.resolve(),d);return(p=p.setProgress(1,o,1,[o])).set(u)};(a.prototype=Object.create(Promise.prototype)).constructor=a,a.convert=function(o,u){return o.__proto__=u||a.prototype,o},a.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},a.prototype.from=function(o,u){return this.then(function(){switch(u=u||function(d){switch(n(d)){case"string":return"string";case"element":return d.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(o),u){case"string":return this.then(t).then(function(d){return this.set({src:i("div",{innerHTML:o,dompurify:d})})});case"element":return this.set({src:o});case"canvas":return this.set({canvas:o});case"img":return this.set({img:o});default:return this.error("Unknown source type.")}})},a.prototype.to=function(o){switch(o){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},a.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var o={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},u=s(this.prop.src,this.opt.html2canvas.javascriptEnabled);u.tagName==="BODY"&&(o.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=i("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=i("div",{className:"html2pdf__container",style:o}),this.prop.container.appendChild(u),this.prop.container.firstChild.appendChild(i("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},a.prototype.toCanvas=function(){var o=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(o).then(e).then(function(u){var d=Object.assign({},this.opt.html2canvas);return delete d.onrendered,u(this.prop.container,d)}).then(function(u){(this.opt.html2canvas.onrendered||function(){})(u),this.prop.canvas=u,document.body.removeChild(this.prop.overlay)})},a.prototype.toContext2d=function(){var o=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(o).then(e).then(function(u){var d=this.opt.jsPDF,p=this.opt.fontFaces,b=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,C=Object.assign({async:!0,allowTaint:!0,scale:b,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete C.onrendered,d.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,d.context2d.posX=this.opt.x,d.context2d.posY=this.opt.y,d.context2d.margin=this.opt.margin,d.context2d.fontFaces=p,p)for(var w=0;w<p.length;++w){var M=p[w],P=M.src.find(function(k){return k.format==="truetype"});P&&d.addFont(P.url,M.ref.name,M.ref.style)}return C.windowHeight=C.windowHeight||0,C.windowHeight=C.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):C.windowHeight,d.context2d.save(!0),u(this.prop.container,C)}).then(function(u){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(u),this.prop.canvas=u,document.body.removeChild(this.prop.overlay)})},a.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var o=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=o})},a.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},a.prototype.output=function(o,u,d){return(d=d||"pdf").toLowerCase()==="img"||d.toLowerCase()==="image"?this.outputImg(o,u):this.outputPdf(o,u)},a.prototype.outputPdf=function(o,u){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(o,u)})},a.prototype.outputImg=function(o){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(o){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+o+'" is not supported.'}})},a.prototype.save=function(o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(o?{filename:o}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},a.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},a.prototype.set=function(o){if(n(o)!=="object")return this;var u=Object.keys(o||{}).map(function(d){if(d in a.template.prop)return function(){this.prop[d]=o[d]};switch(d){case"margin":return this.setMargin.bind(this,o.margin);case"jsPDF":return function(){return this.opt.jsPDF=o.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,o.pageSize);default:return function(){this.opt[d]=o[d]}}},this);return this.then(function(){return this.thenList(u)})},a.prototype.get=function(o,u){return this.then(function(){var d=o in a.template.prop?this.prop[o]:this.opt[o];return u?u(d):d})},a.prototype.setMargin=function(o){return this.then(function(){switch(n(o)){case"number":o=[o,o,o,o];case"array":if(o.length===2&&(o=[o[0],o[1],o[0],o[1]]),o.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=o}).then(this.setPageSize)},a.prototype.setPageSize=function(o){function u(d,p){return Math.floor(d*p/72*96)}return this.then(function(){(o=o||Jr.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(o.inner={width:o.width-this.opt.margin[1]-this.opt.margin[3],height:o.height-this.opt.margin[0]-this.opt.margin[2]},o.inner.px={width:u(o.inner.width,o.k),height:u(o.inner.height,o.k)},o.inner.ratio=o.inner.height/o.inner.width),this.prop.pageSize=o})},a.prototype.setProgress=function(o,u,d,p){return o!=null&&(this.progress.val=o),u!=null&&(this.progress.state=u),d!=null&&(this.progress.n=d),p!=null&&(this.progress.stack=p),this.progress.ratio=this.progress.val/this.progress.state,this},a.prototype.updateProgress=function(o,u,d,p){return this.setProgress(o?this.progress.val+o:null,u||null,d?this.progress.n+d:null,p?this.progress.stack.concat(p):null)},a.prototype.then=function(o,u){var d=this;return this.thenCore(o,u,function(p,b){return d.updateProgress(null,null,1,[p]),Promise.prototype.then.call(this,function(C){return d.updateProgress(null,p),C}).then(p,b).then(function(C){return d.updateProgress(1),C})})},a.prototype.thenCore=function(o,u,d){d=d||Promise.prototype.then;var p=this;o&&(o=o.bind(p)),u&&(u=u.bind(p));var b=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?p:a.convert(Object.assign({},p),Promise.prototype),C=d.call(b,o,u);return a.convert(C,p.__proto__)},a.prototype.thenExternal=function(o,u){return Promise.prototype.then.call(this,o,u)},a.prototype.thenList=function(o){var u=this;return o.forEach(function(d){u=u.thenCore(d)}),u},a.prototype.catch=function(o){o&&(o=o.bind(this));var u=Promise.prototype.catch.call(this,o);return a.convert(u,this)},a.prototype.catchExternal=function(o){return Promise.prototype.catch.call(this,o)},a.prototype.error=function(o){return this.then(function(){throw new Error(o)})},a.prototype.using=a.prototype.set,a.prototype.saveAs=a.prototype.save,a.prototype.export=a.prototype.output,a.prototype.run=a.prototype.then,Jr.getPageSize=function(o,u,d){if(ni(o)==="object"){var p=o;o=p.orientation,u=p.unit||u,d=p.format||d}u=u||"mm",d=d||"a4",o=(""+(o||"P")).toLowerCase();var b,C=(""+d).toLowerCase(),w={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(u){case"pt":b=1;break;case"mm":b=72/25.4;break;case"cm":b=72/2.54;break;case"in":b=72;break;case"px":b=.75;break;case"pc":case"em":b=12;break;case"ex":b=6;break;default:throw"Invalid unit: "+u}var M,P=0,k=0;if(w.hasOwnProperty(C))P=w[C][1]/b,k=w[C][0]/b;else try{P=d[1],k=d[0]}catch{throw new Error("Invalid format: "+d)}if(o==="p"||o==="portrait")o="p",k>P&&(M=k,k=P,P=M);else{if(o!=="l"&&o!=="landscape")throw"Invalid orientation: "+o;o="l",P>k&&(M=k,k=P,P=M)}return{width:k,height:P,unit:u,k:b,orientation:o}},r.html=function(o,u){(u=u||{}).callback=u.callback||function(){},u.html2canvas=u.html2canvas||{},u.html2canvas.canvas=u.html2canvas.canvas||this.canvas,u.jsPDF=u.jsPDF||this,u.fontFaces=u.fontFaces?u.fontFaces.map(cC):null;var d=new a(u);return u.worker?d:d.from(o).doCallback()}}(Jr.API),Jr.API.addJS=function(r){return ZU=r,this.internal.events.subscribe("postPutResources",function(){Eb=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Eb+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),YU=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+ZU+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Eb!==void 0&&YU!==void 0&&this.internal.out("/Names <</JavaScript "+Eb+" 0 R>>")}),this},function(r){var e;r.events.push(["postPutResources",function(){var t=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var i=t.outline.render().split(/\r\n/),s=0;s<i.length;s++){var a=i[s],o=n.exec(a);if(o!=null){var u=o[1];t.internal.newObjectDeferredBegin(u,!1)}t.internal.write(a)}if(this.outline.createNamedDestinations){var d=this.internal.pages.length,p=[];for(s=0;s<d;s++){var b=t.internal.newObject();p.push(b);var C=t.internal.getPageInfo(s+1);t.internal.write("<< /D["+C.objId+" 0 R /XYZ null null null]>> endobj")}var w=t.internal.newObject();for(t.internal.write("<< /Names [ "),s=0;s<p.length;s++)t.internal.write("(page_"+(s+1)+")"+p[s]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+w+" 0 R"),t.internal.write(">>","endobj")}}]),r.events.push(["putCatalog",function(){var t=this;t.outline.root.children.length>0&&(t.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&t.internal.write("/Names "+e+" 0 R"))}]),r.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(n,i,s){var a={title:i,options:s,children:[]};return n==null&&(n=this.root),n.children.push(a),a},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(n){n.id=t.internal.newObjectDeferred();for(var i=0;i<n.children.length;i++)this.genIds_r(n.children[i])},t.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},t.outline.renderItems=function(n){for(var i=this.ctx.pdf.internal.getVerticalCoordinateString,s=0;s<n.children.length;s++){var a=n.children[s];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(n)),s>0&&this.line("/Prev "+this.makeRef(n.children[s-1])),s<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[s+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var o=this.count=this.count_r({count:0},a);if(o>0&&this.line("/Count "+o),a.options&&a.options.pageNumber){var u=t.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+u.objId+" 0 R /XYZ 0 "+i(0)+" 0]")}this.objEnd()}for(var d=0;d<n.children.length;d++)this.renderItems(n.children[d])},t.outline.line=function(n){this.ctx.val+=n+`\r
`},t.outline.makeRef=function(n){return n.id+" 0 R"},t.outline.makeString=function(n){return"("+t.internal.pdfEscape(n)+")"},t.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(n,i){for(var s=0;s<i.children.length;s++)n.count++,this.count_r(n,i.children[s]);return n.count}}])}(Jr.API),function(r){var e=[192,193,194,195,196,197,198,199];r.processJPEG=function(t,n,i,s,a,o){var u,d=this.decode.DCT_DECODE,p=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=a||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,u=function(b){for(var C,w=256*b.charCodeAt(4)+b.charCodeAt(5),M=b.length,P={width:0,height:0,numcomponents:1},k=4;k<M;k+=2){if(k+=w,e.indexOf(b.charCodeAt(k+1))!==-1){C=256*b.charCodeAt(k+5)+b.charCodeAt(k+6),P={width:256*b.charCodeAt(k+7)+b.charCodeAt(k+8),height:C,numcomponents:b.charCodeAt(k+9)};break}w=256*b.charCodeAt(k+2)+b.charCodeAt(k+3)}return P}(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t),u.numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}p={data:t,width:u.width,height:u.height,colorSpace:o,bitsPerComponent:8,filter:d,index:n,alias:i}}return p}}(Jr.API),Jr.API.processPNG=function(r,e,t,n){if(this.__addimage__.isArrayBuffer(r)&&(r=new Uint8Array(r)),this.__addimage__.isArrayBufferView(r)){var i,s=nde(r,{checkCrc:!0}),a=s.width,o=s.height,u=s.channels,d=s.palette,p=s.depth;i=d&&u===1?function(ie){for(var se=ie.width,Z=ie.height,fe=ie.data,te=ie.palette,ce=ie.depth,ve=!1,me=[],qe=[],ot=void 0,st=!1,Ye=0,Xe=0;Xe<te.length;Xe++){var wt=vO(te[Xe],4),ht=wt[0],he=wt[1],Be=wt[2],Le=wt[3];me.push(ht,he,Be),Le!=null&&(Le===0?(Ye++,qe.length<1&&qe.push(Xe)):Le<255&&(st=!0))}if(st||Ye>1){ve=!0,qe=void 0;var He=se*Z;ot=new Uint8Array(He);for(var rt=new DataView(fe.buffer),it=0;it<He;it++){var Pt=uC(rt,it,ce),Bt=vO(te[Pt],4)[3];ot[it]=Bt}}return{colorSpace:"Indexed",colorsPerPixel:1,colorBytes:fe,alphaBytes:ot,needSMask:ve,palette:me,mask:qe}}(s):u===2||u===4?function(ie){for(var se=ie.data,Z=ie.width,fe=ie.height,te=ie.channels,ce=ie.depth,ve=te===2?"DeviceGray":"DeviceRGB",me=te-1,qe=Z*fe,ot=me,st=qe*ot,Ye=1*qe,Xe=Math.ceil(st*ce/8),wt=Math.ceil(Ye*ce/8),ht=new Uint8Array(Xe),he=new Uint8Array(wt),Be=new DataView(se.buffer),Le=new DataView(ht.buffer),He=new DataView(he.buffer),rt=!1,it=0;it<qe;it++){for(var Pt=it*te,Bt=0;Bt<ot;Bt++)lD(Le,uC(Be,Pt+Bt,ce),it*ot+Bt,ce);var Dt=uC(Be,Pt+ot,ce);Dt<(1<<ce)-1&&(rt=!0),lD(He,Dt,1*it,ce)}return{colorSpace:ve,colorsPerPixel:me,colorBytes:ht,alphaBytes:he,needSMask:rt}}(s):function(ie){var se=ie.data,Z=ie.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:Z,colorsPerPixel:Z==="DeviceGray"?1:3,colorBytes:se instanceof Uint8Array?se:new Uint8Array(se.buffer),needSMask:!1}}(s);var b,C,w,M=i,P=M.colorSpace,k=M.colorsPerPixel,D=M.colorBytes,j=M.alphaBytes,H=M.needSMask,N=M.palette,q=M.mask,W=null;return n!==Jr.API.image_compression.NONE&&typeof kB=="function"?(W=function(ie){var se;switch(ie){case Jr.API.image_compression.FAST:se=11;break;case Jr.API.image_compression.MEDIUM:se=13;break;case Jr.API.image_compression.SLOW:se=14;break;default:se=12}return se}(n),b=this.decode.FLATE_DECODE,C="/Predictor ".concat(W," "),r=nD(D,a*k,k,n),H&&(w=nD(j,a,1,n))):(b=void 0,C="",r=D,H&&(w=j)),C+="/Colors ".concat(k," /BitsPerComponent ").concat(p," /Columns ").concat(a),(this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r))&&(r=this.__addimage__.arrayBufferToBinaryString(r)),(w&&this.__addimage__.isArrayBuffer(w)||this.__addimage__.isArrayBufferView(w))&&(w=this.__addimage__.arrayBufferToBinaryString(w)),{alias:t,data:r,index:e,filter:b,decodeParameters:C,transparency:q,palette:N,sMask:w,predictor:W,width:a,height:o,bitsPerComponent:p,colorSpace:P}}},function(r){r.processGIF89A=function(e,t,n,i){var s=new Bde(e),a=s.width,o=s.height,u=[];s.decodeAndBlitFrameRGBA(0,u);var d={data:u,width:a,height:o},p=new hC(100).encode(d,100);return r.processJPEG.call(this,p,t,n,i)},r.processGIF87A=r.processGIF89A}(Jr.API),Xc.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var r=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(r);for(var e=0;e<r;e++){var t=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:i,green:n,blue:t,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Xc.prototype.parseBGR=function(){this.pos=this.offset;try{var r="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[r]()}catch(t){Ui.log("bit decode error:"+t)}},Xc.prototype.bit1=function(){var r,e=Math.ceil(this.width/8),t=e%4;for(r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,i=0;i<e;i++)for(var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+8*i*4,o=0;o<8&&8*i+o<this.width;o++){var u=this.palette[s>>7-o&1];this.data[a+4*o]=u.blue,this.data[a+4*o+1]=u.green,this.data[a+4*o+2]=u.red,this.data[a+4*o+3]=255}t!==0&&(this.pos+=4-t)}},Xc.prototype.bit4=function(){for(var r=Math.ceil(this.width/2),e=r%4,t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,i=0;i<r;i++){var s=this.datav.getUint8(this.pos++,!0),a=n*this.width*4+2*i*4,o=s>>4,u=15&s,d=this.palette[o];if(this.data[a]=d.blue,this.data[a+1]=d.green,this.data[a+2]=d.red,this.data[a+3]=255,2*i+1>=this.width)break;d=this.palette[u],this.data[a+4]=d.blue,this.data[a+4+1]=d.green,this.data[a+4+2]=d.red,this.data[a+4+3]=255}e!==0&&(this.pos+=4-e)}},Xc.prototype.bit8=function(){for(var r=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,n=0;n<this.width;n++){var i=this.datav.getUint8(this.pos++,!0),s=t*this.width*4+4*n;if(i<this.palette.length){var a=this.palette[i];this.data[s]=a.red,this.data[s+1]=a.green,this.data[s+2]=a.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}r!==0&&(this.pos+=4-r)}},Xc.prototype.bit15=function(){for(var r=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var n=this.bottom_up?t:this.height-1-t,i=0;i<this.width;i++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(s&e)/e*255|0,o=(s>>5&e)/e*255|0,u=(s>>10&e)/e*255|0,d=s>>15?255:0,p=n*this.width*4+4*i;this.data[p]=u,this.data[p+1]=o,this.data[p+2]=a,this.data[p+3]=d}this.pos+=r}},Xc.prototype.bit16=function(){for(var r=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var i=this.bottom_up?n:this.height-1-n,s=0;s<this.width;s++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(a&e)/e*255|0,u=(a>>5&t)/t*255|0,d=(a>>11)/e*255|0,p=i*this.width*4+4*s;this.data[p]=d,this.data[p+1]=u,this.data[p+2]=o,this.data[p+3]=255}this.pos+=r}},Xc.prototype.bit24=function(){for(var r=this.height-1;r>=0;r--){for(var e=this.bottom_up?r:this.height-1-r,t=0;t<this.width;t++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=e*this.width*4+4*t;this.data[a]=s,this.data[a+1]=i,this.data[a+2]=n,this.data[a+3]=255}this.pos+=this.width%4}},Xc.prototype.bit32=function(){for(var r=this.height-1;r>=0;r--)for(var e=this.bottom_up?r:this.height-1-r,t=0;t<this.width;t++){var n=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),o=e*this.width*4+4*t;this.data[o]=s,this.data[o+1]=i,this.data[o+2]=n,this.data[o+3]=a}},Xc.prototype.getData=function(){return this.data},function(r){r.processBMP=function(e,t,n,i){var s=new Xc(e,!1),a=s.width,o=s.height,u={data:s.getData(),width:a,height:o},d=new hC(100).encode(u,100);return r.processJPEG.call(this,d,t,n,i)}}(Jr.API),hD.prototype.getData=function(){return this.data},function(r){r.processWEBP=function(e,t,n,i){var s=new hD(e),a=s.width,o=s.height,u={data:s.getData(),width:a,height:o},d=new hC(100).encode(u,100);return r.processJPEG.call(this,d,t,n,i)}}(Jr.API),Jr.API.processRGBA=function(r,e,t){for(var n=r.data,i=n.length,s=new Uint8Array(i/4*3),a=new Uint8Array(i/4),o=0,u=0,d=0;d<i;d+=4){var p=n[d],b=n[d+1],C=n[d+2],w=n[d+3];s[o++]=p,s[o++]=b,s[o++]=C,a[u++]=w}var M=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(a),data:M,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:r.width,height:r.height}},Jr.API.setLanguage=function(r){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[r]!==void 0&&(this.internal.languageSettings.languageCode=r,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},sg=Jr.API,Sb=sg.getCharWidthsArray=function(r,e){var t,n,i=(e=e||{}).font||this.internal.getFont(),s=e.fontSize||this.internal.getFontSize(),a=e.charSpace||this.internal.getCharSpace(),o=e.widths?e.widths:i.metadata.Unicode.widths,u=o.fof?o.fof:1,d=e.kerning?e.kerning:i.metadata.Unicode.kerning,p=d.fof?d.fof:1,b=e.doKerning!==!1,C=0,w=r.length,M=0,P=o[0]||u,k=[];for(t=0;t<w;t++)n=r.charCodeAt(t),typeof i.metadata.widthOfString=="function"?k.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(n))+a*(1e3/s)||0)/1e3):(C=b&&ni(d[n])==="object"&&!isNaN(parseInt(d[n][M],10))?d[n][M]/p:0,k.push((o[n]||P)/u+C)),M=n;return k},JU=sg.getStringUnitWidth=function(r,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),n=e.font||this.internal.getFont(),i=e.charSpace||this.internal.getCharSpace();return sg.processArabic&&(r=sg.processArabic(r)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(r,t,i)/t:Sb.apply(this,arguments).reduce(function(s,a){return s+a},0)},eD=function(r,e,t,n){for(var i=[],s=0,a=r.length,o=0;s!==a&&o+e[s]<t;)o+=e[s],s++;i.push(r.slice(0,s));var u=s;for(o=0;s!==a;)o+e[s]>n&&(i.push(r.slice(u,s)),o=0,u=s),o+=e[s],s++;return u!==s&&i.push(r.slice(u,s)),i},tD=function(r,e,t){t||(t={});var n,i,s,a,o,u,d,p=[],b=[p],C=t.textIndent||0,w=0,M=0,P=r.split(" "),k=Sb.apply(this,[" ",t])[0];if(u=t.lineIndent===-1?P[0].length+2:t.lineIndent||0){var D=Array(u).join(" "),j=[];P.map(function(N){(N=N.split(/\s*\n/)).length>1?j=j.concat(N.map(function(q,W){return(W&&q.length?`
`:"")+q})):j.push(N[0])}),P=j,u=JU.apply(this,[D,t])}for(s=0,a=P.length;s<a;s++){var H=0;if(n=P[s],u&&n[0]==`
`&&(n=n.substr(1),H=1),C+w+(M=(i=Sb.apply(this,[n,t])).reduce(function(N,q){return N+q},0))>e||H){if(M>e){for(o=eD.apply(this,[n,i,e-(C+w),e]),p.push(o.shift()),p=[o.pop()];o.length;)b.push([o.shift()]);M=i.slice(n.length-(p[0]?p[0].length:0)).reduce(function(N,q){return N+q},0)}else p=[n];b.push(p),C=M+u,w=k}else p.push(n),C+=w+M,w=k}return d=u?function(N,q){return(q?D:"")+N.join(" ")}:function(N){return N.join(" ")},b.map(d)},sg.splitTextToSize=function(r,e,t){var n,i=(t=t||{}).fontSize||this.internal.getFontSize(),s=(function(p){if(p.widths&&p.kerning)return{widths:p.widths,kerning:p.kerning};var b=this.internal.getFont(p.fontName,p.fontStyle),C="Unicode";return b.metadata[C]?{widths:b.metadata[C].widths||{0:1},kerning:b.metadata[C].kerning||{}}:{font:b.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);n=Array.isArray(r)?r:String(r).split(/\r?\n/);var a=1*this.internal.scaleFactor*e/i;s.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/i:0,s.lineIndent=t.lineIndent;var o,u,d=[];for(o=0,u=n.length;o<u;o++)d=d.concat(tD.apply(this,[n[o],a,s]));return d},function(r){r.__fontmetrics__=r.__fontmetrics__||{};for(var e="0123456789abcdef",t="klmnopqrstuvwxyz",n={},i={},s=0;s<16;s++)n[t[s]]=e[s],i[e[s]]=t[s];var a=function(C){return"0x"+parseInt(C,10).toString(16)},o=r.__fontmetrics__.compress=function(C){var w,M,P,k,D=["{"];for(var j in C){if(w=C[j],isNaN(parseInt(j,10))?M="'"+j+"'":(j=parseInt(j,10),M=(M=a(j).slice(2)).slice(0,-1)+i[M.slice(-1)]),typeof w=="number")w<0?(P=a(w).slice(3),k="-"):(P=a(w).slice(2),k=""),P=k+P.slice(0,-1)+i[P.slice(-1)];else{if(ni(w)!=="object")throw new Error("Don't know what to do with value type "+ni(w)+".");P=o(w)}D.push(M+P)}return D.push("}"),D.join("")},u=r.__fontmetrics__.uncompress=function(C){if(typeof C!="string")throw new Error("Invalid argument passed to uncompress.");for(var w,M,P,k,D={},j=1,H=D,N=[],q="",W="",ie=C.length-1,se=1;se<ie;se+=1)(k=C[se])=="'"?w?(P=w.join(""),w=void 0):w=[]:w?w.push(k):k=="{"?(N.push([H,P]),H={},P=void 0):k=="}"?((M=N.pop())[0][M[1]]=H,P=void 0,H=M[0]):k=="-"?j=-1:P===void 0?n.hasOwnProperty(k)?(q+=n[k],P=parseInt(q,16)*j,j=1,q=""):q+=k:n.hasOwnProperty(k)?(W+=n[k],H[P]=parseInt(W,16)*j,j=1,P=void 0,W=""):W+=k;return D},d={codePages:["WinAnsiEncoding"],WinAnsiEncoding:u("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},p={Unicode:{Courier:d,"Courier-Bold":d,"Courier-BoldOblique":d,"Courier-Oblique":d,Helvetica:d,"Helvetica-Bold":d,"Helvetica-BoldOblique":d,"Helvetica-Oblique":d,"Times-Roman":d,"Times-Bold":d,"Times-BoldItalic":d,"Times-Italic":d}},b={Unicode:{"Courier-Oblique":u("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":u("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":u("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:u("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":u("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":u("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:u("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:u("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":u("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:u("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":u("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":u("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":u("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":u("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};r.events.push(["addFont",function(C){var w=C.font,M=b.Unicode[w.postScriptName];M&&(w.metadata.Unicode={},w.metadata.Unicode.widths=M.widths,w.metadata.Unicode.kerning=M.kerning);var P=p.Unicode[w.postScriptName];P&&(w.metadata.Unicode.encoding=P,w.encoding=P.codePages[0])}])}(Jr.API),function(r){var e=function(t){for(var n=t.length,i=new Uint8Array(n),s=0;s<n;s++)i[s]=t.charCodeAt(s);return i};r.API.events.push(["addFont",function(t){var n=void 0,i=t.font,s=t.instance;if(!i.isStandardFont){if(s===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if(typeof(n=s.existsFileInVFS(i.postScriptName)===!1?s.loadFile(i.postScriptName):s.getFileFromVFS(i.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");(function(a,o){o=/^\x00\x01\x00\x00/.test(o)?e(o):e(_b(o)),a.metadata=r.API.TTFFont.open(o),a.metadata.Unicode=a.metadata.Unicode||{encoding:{},kerning:{},widths:[]},a.metadata.glyIdsUsed=[0]})(i,n)}}])}(Jr),Jr.API.addSvgAsImage=function(r,e,t,n,i,s,a,o){if(isNaN(e)||isNaN(t))throw Ui.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(n)||isNaN(i))throw Ui.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var u=document.createElement("canvas");u.width=n,u.height=i;var d=u.getContext("2d");d.fillStyle="#fff",d.fillRect(0,0,u.width,u.height);var p={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},b=this;return(yn.canvg?Promise.resolve(yn.canvg):Promise.resolve().then(()=>Kwe)).catch(function(C){return Promise.reject(new Error("Could not load canvg: "+C))}).then(function(C){return C.default?C.default:C}).then(function(C){return C.fromString(d,r,p)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(C){return C.render(p)}).then(function(){b.addImage(u.toDataURL("image/jpeg",1),e,t,n,i,a,o)})},Jr.API.putTotalPages=function(r){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(r,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(r,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var i=0;i<this.internal.pages[n].length;i++)this.internal.pages[n][i]=this.internal.pages[n][i].replace(e,t);return this},Jr.API.viewerPreferences=function(r,e){var t;r=r||{},e=e||!1;var n,i,s,a={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(a),u=[],d=0,p=0,b=0;function C(M,P){var k,D=!1;for(k=0;k<M.length;k+=1)M[k]===P&&(D=!0);return D}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(a)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,r==="reset"||e===!0){var w=o.length;for(b=0;b<w;b+=1)t[o[b]].value=t[o[b]].defaultValue,t[o[b]].explicitSet=!1}if(ni(r)==="object"){for(i in r)if(s=r[i],C(o,i)&&s!==void 0){if(t[i].type==="boolean"&&typeof s=="boolean")t[i].value=s;else if(t[i].type==="name"&&C(t[i].valueSet,s))t[i].value=s;else if(t[i].type==="integer"&&Number.isInteger(s))t[i].value=s;else if(t[i].type==="array"){for(d=0;d<s.length;d+=1)if(n=!0,s[d].length===1&&typeof s[d][0]=="number")u.push(String(s[d]-1));else if(s[d].length>1){for(p=0;p<s[d].length;p+=1)typeof s[d][p]!="number"&&(n=!1);n===!0&&u.push([s[d][0]-1,s[d][1]-1].join(" "))}t[i].value="["+u.join(" ")+"]"}else t[i].value=t[i].defaultValue;t[i].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var M,P=[];for(M in t)t[M].explicitSet===!0&&(t[M].type==="name"?P.push("/"+M+" /"+t[M].value):P.push("/"+M+" "+t[M].value));P.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+P.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},function(r){var e=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',i=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),s=unescape(encodeURIComponent(n)),a=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),o=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),u=unescape(encodeURIComponent("</x:xmpmeta>")),d=s.length+a.length+o.length+i.length+u.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+d+" >>"),this.internal.write("stream"),this.internal.write(i+s+a+o+u),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};r.addMetadata=function(n,i){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:i||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}}(Jr.API),function(r){var e=r.API,t=e.pdfEscape16=function(s,a){for(var o,u=a.metadata.Unicode.widths,d=["","0","00","000","0000"],p=[""],b=0,C=s.length;b<C;++b){if(o=a.metadata.characterToGlyph(s.charCodeAt(b)),a.metadata.glyIdsUsed.push(o),a.metadata.toUnicode[o]=s.charCodeAt(b),u.indexOf(o)==-1&&(u.push(o),u.push([parseInt(a.metadata.widthOfGlyph(o),10)])),o=="0")return p.join("");o=o.toString(16),p.push(d[4-o.length],o)}return p.join("")},n=function(s){var a,o,u,d,p,b,C;for(p=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,u=[],b=0,C=(o=Object.keys(s).sort(function(w,M){return w-M})).length;b<C;b++)a=o[b],u.length>=100&&(p+=`
`+u.length+` beginbfchar
`+u.join(`
`)+`
endbfchar`,u=[]),s[a]!==void 0&&s[a]!==null&&typeof s[a].toString=="function"&&(d=("0000"+s[a].toString(16)).slice(-4),a=("0000"+(+a).toString(16)).slice(-4),u.push("<"+a+"><"+d+">"));return u.length&&(p+=`
`+u.length+` beginbfchar
`+u.join(`
`)+`
endbfchar
`),p+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(s){(function(a){var o=a.font,u=a.out,d=a.newObject,p=a.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="Identity-H"){for(var b=o.metadata.Unicode.widths,C=o.metadata.subset.encode(o.metadata.glyIdsUsed,1),w="",M=0;M<C.length;M++)w+=String.fromCharCode(C[M]);var P=d();p({data:w,addLength1:!0,objectId:P}),u("endobj");var k=d();p({data:n(o.metadata.toUnicode),addLength1:!0,objectId:k}),u("endobj");var D=d();u("<<"),u("/Type /FontDescriptor"),u("/FontName /"+Zp(o.fontName)),u("/FontFile2 "+P+" 0 R"),u("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),u("/Flags "+o.metadata.flags),u("/StemV "+o.metadata.stemV),u("/ItalicAngle "+o.metadata.italicAngle),u("/Ascent "+o.metadata.ascender),u("/Descent "+o.metadata.decender),u("/CapHeight "+o.metadata.capHeight),u(">>"),u("endobj");var j=d();u("<<"),u("/Type /Font"),u("/BaseFont /"+Zp(o.fontName)),u("/FontDescriptor "+D+" 0 R"),u("/W "+r.API.PDFObject.convert(b)),u("/CIDToGIDMap /Identity"),u("/DW 1000"),u("/Subtype /CIDFontType2"),u("/CIDSystemInfo"),u("<<"),u("/Supplement 0"),u("/Registry (Adobe)"),u("/Ordering ("+o.encoding+")"),u(">>"),u(">>"),u("endobj"),o.objectNumber=d(),u("<<"),u("/Type /Font"),u("/Subtype /Type0"),u("/ToUnicode "+k+" 0 R"),u("/BaseFont /"+Zp(o.fontName)),u("/Encoding /"+o.encoding),u("/DescendantFonts ["+j+" 0 R]"),u(">>"),u("endobj"),o.isAlreadyPutted=!0}})(s)}]),e.events.push(["putFont",function(s){(function(a){var o=a.font,u=a.out,d=a.newObject,p=a.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="WinAnsiEncoding"){for(var b=o.metadata.rawData,C="",w=0;w<b.length;w++)C+=String.fromCharCode(b[w]);var M=d();p({data:C,addLength1:!0,objectId:M}),u("endobj");var P=d();p({data:n(o.metadata.toUnicode),addLength1:!0,objectId:P}),u("endobj");var k=d();u("<<"),u("/Descent "+o.metadata.decender),u("/CapHeight "+o.metadata.capHeight),u("/StemV "+o.metadata.stemV),u("/Type /FontDescriptor"),u("/FontFile2 "+M+" 0 R"),u("/Flags 96"),u("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),u("/FontName /"+Zp(o.fontName)),u("/ItalicAngle "+o.metadata.italicAngle),u("/Ascent "+o.metadata.ascender),u(">>"),u("endobj"),o.objectNumber=d();for(var D=0;D<o.metadata.hmtx.widths.length;D++)o.metadata.hmtx.widths[D]=parseInt(o.metadata.hmtx.widths[D]*(1e3/o.metadata.head.unitsPerEm));u("<</Subtype/TrueType/Type/Font/ToUnicode "+P+" 0 R/BaseFont/"+Zp(o.fontName)+"/FontDescriptor "+k+" 0 R/Encoding/"+o.encoding+" /FirstChar 29 /LastChar 255 /Widths "+r.API.PDFObject.convert(o.metadata.hmtx.widths)+">>"),u("endobj"),o.isAlreadyPutted=!0}})(s)}]);var i=function(s){var a,o=s.text||"",u=s.x,d=s.y,p=s.options||{},b=s.mutex||{},C=b.pdfEscape,w=b.activeFontKey,M=b.fonts,P=w,k="",D=0,j="",H=M[P].encoding;if(M[P].encoding!=="Identity-H")return{text:o,x:u,y:d,options:p,mutex:b};for(j=o,P=w,Array.isArray(o)&&(j=o[0]),D=0;D<j.length;D+=1)M[P].metadata.hasOwnProperty("cmap")&&(a=M[P].metadata.cmap.unicode.codeMap[j[D].charCodeAt(0)]),a||j[D].charCodeAt(0)<256&&M[P].metadata.hasOwnProperty("Unicode")?k+=j[D]:k+="";var N="";return parseInt(P.slice(1))<14||H==="WinAnsiEncoding"?N=C(k,P).split("").map(function(q){return q.charCodeAt(0).toString(16)}).join(""):H==="Identity-H"&&(N=t(k,M[P])),b.isHex=!0,{text:N,x:u,y:d,options:p,mutex:b}};e.events.push(["postProcessText",function(s){var a=s.text||"",o=[],u={text:a,x:s.x,y:s.y,options:s.options,mutex:s.mutex};if(Array.isArray(a)){var d=0;for(d=0;d<a.length;d+=1)Array.isArray(a[d])&&a[d].length===3?o.push([i(Object.assign({},u,{text:a[d][0]})).text,a[d][1],a[d][2]]):o.push(i(Object.assign({},u,{text:a[d]})).text);s.text=o}else s.text=i(Object.assign({},u,{text:a})).text}])}(Jr),function(r){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};r.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},r.addFileToVFS=function(t,n){return e.call(this),this.internal.vFS[t]=n,this},r.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}}(Jr.API),function(r){r.__bidiEngine__=r.prototype.__bidiEngine__=function(n){var i,s,a,o,u,d,p,b=e,C=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],w=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],M={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},P={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},k=["(",")","(","<",">","<","[","]","[","{","}","{","«","»","«","‹","›","‹","⁅","⁆","⁅","⁽","⁾","⁽","₍","₎","₍","≤","≥","≤","〈","〉","〈","﹙","﹚","﹙","﹛","﹜","﹛","﹝","﹞","﹝","﹤","﹥","﹤"],D=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),j=!1,H=0;this.__bidiEngine__={};var N=function(te){var ce=te.charCodeAt(),ve=ce>>8,me=P[ve];return me!==void 0?b[256*me+(255&ce)]:ve===252||ve===253?"AL":D.test(ve)?"L":ve===8?"R":"N"},q=function(te){for(var ce,ve=0;ve<te.length;ve++){if((ce=N(te.charAt(ve)))==="L")return!1;if(ce==="R")return!0}return!1},W=function(te,ce,ve,me){var qe,ot,st,Ye,Xe=ce[me];switch(Xe){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":j=!1;break;case"N":case"AN":break;case"EN":j&&(Xe="AN");break;case"AL":j=!0,Xe="R";break;case"WS":case"BN":Xe="N";break;case"CS":me<1||me+1>=ce.length||(qe=ve[me-1])!=="EN"&&qe!=="AN"||(ot=ce[me+1])!=="EN"&&ot!=="AN"?Xe="N":j&&(ot="AN"),Xe=ot===qe?ot:"N";break;case"ES":Xe=(qe=me>0?ve[me-1]:"B")==="EN"&&me+1<ce.length&&ce[me+1]==="EN"?"EN":"N";break;case"ET":if(me>0&&ve[me-1]==="EN"){Xe="EN";break}if(j){Xe="N";break}for(st=me+1,Ye=ce.length;st<Ye&&ce[st]==="ET";)st++;Xe=st<Ye&&ce[st]==="EN"?"EN":"N";break;case"NSM":if(a&&!o){for(Ye=ce.length,st=me+1;st<Ye&&ce[st]==="NSM";)st++;if(st<Ye){var wt=te[me],ht=wt>=1425&&wt<=2303||wt===64286;if(qe=ce[st],ht&&(qe==="R"||qe==="AL")){Xe="R";break}}}Xe=me<1||(qe=ce[me-1])==="B"?"N":ve[me-1];break;case"B":j=!1,i=!0,Xe=H;break;case"S":s=!0,Xe="N"}return Xe},ie=function(te,ce,ve){var me=te.split("");return ve&&se(me,ve,{hiLevel:H}),me.reverse(),ce&&ce.reverse(),me.join("")},se=function(te,ce,ve){var me,qe,ot,st,Ye,Xe=-1,wt=te.length,ht=0,he=[],Be=H?w:C,Le=[];for(j=!1,i=!1,s=!1,qe=0;qe<wt;qe++)Le[qe]=N(te[qe]);for(ot=0;ot<wt;ot++){if(Ye=ht,he[ot]=W(te,Le,he,ot),me=240&(ht=Be[Ye][M[he[ot]]]),ht&=15,ce[ot]=st=Be[ht][5],me>0)if(me===16){for(qe=Xe;qe<ot;qe++)ce[qe]=1;Xe=-1}else Xe=-1;if(Be[ht][6])Xe===-1&&(Xe=ot);else if(Xe>-1){for(qe=Xe;qe<ot;qe++)ce[qe]=st;Xe=-1}Le[ot]==="B"&&(ce[ot]=0),ve.hiLevel|=st}s&&function(He,rt,it){for(var Pt=0;Pt<it;Pt++)if(He[Pt]==="S"){rt[Pt]=H;for(var Bt=Pt-1;Bt>=0&&He[Bt]==="WS";Bt--)rt[Bt]=H}}(Le,ce,wt)},Z=function(te,ce,ve,me,qe){if(!(qe.hiLevel<te)){if(te===1&&H===1&&!i)return ce.reverse(),void(ve&&ve.reverse());for(var ot,st,Ye,Xe,wt=ce.length,ht=0;ht<wt;){if(me[ht]>=te){for(Ye=ht+1;Ye<wt&&me[Ye]>=te;)Ye++;for(Xe=ht,st=Ye-1;Xe<st;Xe++,st--)ot=ce[Xe],ce[Xe]=ce[st],ce[st]=ot,ve&&(ot=ve[Xe],ve[Xe]=ve[st],ve[st]=ot);ht=Ye}ht++}}},fe=function(te,ce,ve){var me=te.split(""),qe={hiLevel:H};return ve||(ve=[]),se(me,ve,qe),function(ot,st,Ye){if(Ye.hiLevel!==0&&p)for(var Xe,wt=0;wt<ot.length;wt++)st[wt]===1&&(Xe=k.indexOf(ot[wt]))>=0&&(ot[wt]=k[Xe+1])}(me,ve,qe),Z(2,me,ce,ve,qe),Z(1,me,ce,ve,qe),me.join("")};return this.__bidiEngine__.doBidiReorder=function(te,ce,ve){if(function(qe,ot){if(ot)for(var st=0;st<qe.length;st++)ot[st]=st;o===void 0&&(o=q(qe)),d===void 0&&(d=q(qe))}(te,ce),a||!u||d)if(a&&u&&o^d)H=o?1:0,te=ie(te,ce,ve);else if(!a&&u&&d)H=o?1:0,te=fe(te,ce,ve),te=ie(te,ce);else if(!a||o||u||d){if(a&&!u&&o^d)te=ie(te,ce),o?(H=0,te=fe(te,ce,ve)):(H=1,te=fe(te,ce,ve),te=ie(te,ce));else if(a&&o&&!u&&d)H=1,te=fe(te,ce,ve),te=ie(te,ce);else if(!a&&!u&&o^d){var me=p;o?(H=1,te=fe(te,ce,ve),H=0,p=!1,te=fe(te,ce,ve),p=me):(H=0,te=fe(te,ce,ve),te=ie(te,ce),H=1,p=!1,te=fe(te,ce,ve),p=me,te=ie(te,ce))}}else H=0,te=fe(te,ce,ve);else H=o?1:0,te=fe(te,ce,ve);return te},this.__bidiEngine__.setOptions=function(te){te&&(a=te.isInputVisual,u=te.isOutputVisual,o=te.isInputRtl,d=te.isOutputRtl,p=te.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new r.__bidiEngine__({isInputVisual:!0});r.API.events.push(["postProcessText",function(n){var i=n.text;n.x,n.y;var s=n.options||{};n.mutex,s.lang;var a=[];if(s.isInputVisual=typeof s.isInputVisual!="boolean"||s.isInputVisual,t.setOptions(s),Object.prototype.toString.call(i)==="[object Array]"){var o=0;for(a=[],o=0;o<i.length;o+=1)Object.prototype.toString.call(i[o])==="[object Array]"?a.push([t.doBidiReorder(i[o][0]),i[o][1],i[o][2]]):a.push([t.doBidiReorder(i[o])]);n.text=a}else n.text=t.doBidiReorder(i);t.setOptions({isInputVisual:!0})}])}(Jr),Jr.API.TTFFont=function(){function r(e){var t;if(this.rawData=e,t=this.contents=new KA(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new Nde(this),this.registerTTF()}return r.open=function(e){return new r(e)},r.prototype.parse=function(){return this.directory=new Cde(this.contents),this.head=new Ede(this),this.name=new Fde(this),this.cmap=new fD(this),this.toUnicode={},this.hhea=new Sde(this),this.maxp=new Rde(this),this.hmtx=new Lde(this),this.post=new Pde(this),this.os2=new Ide(this),this.loca=new kde(this),this.glyf=new Ode(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},r.prototype.registerTTF=function(){var e,t,n,i,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var a,o,u,d;for(d=[],a=0,o=(u=this.bbox).length;a<o;a++)e=u[a],d.push(Math.round(e*this.scaleFactor));return d}).call(this),this.stemV=0,this.post.exists?(n=255&(i=this.post.italic_angle),32768&(t=i>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(s=this.familyClass)===1||s===2||s===3||s===4||s===5||s===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},r.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},r.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},r.prototype.widthOfString=function(e,t,n){var i,s,a,o;for(a=0,s=0,o=(e=""+e).length;0<=o?s<o:s>o;s=0<=o?++s:--s)i=e.charCodeAt(s),a+=this.widthOfGlyph(this.characterToGlyph(i))+n*(1e3/t)||0;return a*(t/1e3)},r.prototype.lineHeight=function(e,t){var n;return t==null&&(t=!1),n=t?this.lineGap:0,(this.ascender+n-this.decender)/1e3*e},r}();var Yc,KA=function(){function r(e){this.data=e??[],this.pos=0,this.length=this.data.length}return r.prototype.readByte=function(){return this.data[this.pos++]},r.prototype.writeByte=function(e){return this.data[this.pos++]=e},r.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},r.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},r.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},r.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},r.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},r.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},r.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},r.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},r.prototype.readString=function(e){var t,n;for(n=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)n[t]=String.fromCharCode(this.readByte());return n.join("")},r.prototype.writeString=function(e){var t,n,i;for(i=[],t=0,n=e.length;0<=n?t<n:t>n;t=0<=n?++t:--t)i.push(this.writeByte(e.charCodeAt(t)));return i},r.prototype.readShort=function(){return this.readInt16()},r.prototype.writeShort=function(e){return this.writeInt16(e)},r.prototype.readLongLong=function(){var e,t,n,i,s,a,o,u;return e=this.readByte(),t=this.readByte(),n=this.readByte(),i=this.readByte(),s=this.readByte(),a=this.readByte(),o=this.readByte(),u=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^n)+4294967296*(255^i)+16777216*(255^s)+65536*(255^a)+256*(255^o)+(255^u)+1):72057594037927940*e+281474976710656*t+1099511627776*n+4294967296*i+16777216*s+65536*a+256*o+u},r.prototype.writeLongLong=function(e){var t,n;return t=Math.floor(e/4294967296),n=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},r.prototype.readInt=function(){return this.readInt32()},r.prototype.writeInt=function(e){return this.writeInt32(e)},r.prototype.read=function(e){var t,n;for(t=[],n=0;0<=e?n<e:n>e;n=0<=e?++n:--n)t.push(this.readByte());return t},r.prototype.write=function(e){var t,n,i,s;for(s=[],n=0,i=e.length;n<i;n++)t=e[n],s.push(this.writeByte(t));return s},r}(),Cde=function(){var r;function e(t){var n,i,s;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},i=0,s=this.tableCount;0<=s?i<s:i>s;i=0<=s?++i:--i)n={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[n.tag]=n}return e.prototype.encode=function(t){var n,i,s,a,o,u,d,p,b,C,w,M,P;for(P in w=Object.keys(t).length,u=Math.log(2),b=16*Math.floor(Math.log(w)/u),a=Math.floor(b/u),p=16*w-b,(i=new KA).writeInt(this.scalarType),i.writeShort(w),i.writeShort(b),i.writeShort(a),i.writeShort(p),s=16*w,d=i.pos+s,o=null,M=[],t)for(C=t[P],i.writeString(P),i.writeInt(r(C)),i.writeInt(d),i.writeInt(C.length),M=M.concat(C),P==="head"&&(o=d),d+=C.length;d%4;)M.push(0),d++;return i.write(M),n=2981146554-r(i.data),i.pos=o+8,i.writeUInt32(n),i.data},r=function(t){var n,i,s,a;for(t=dD.call(t);t.length%4;)t.push(0);for(s=new KA(t),i=0,n=0,a=t.length;n<a;n=n+=4)i+=s.readUInt32();return 4294967295&i},e}(),Tde={}.hasOwnProperty,qu=function(r,e){for(var t in e)Tde.call(e,t)&&(r[t]=e[t]);function n(){this.constructor=r}return n.prototype=e.prototype,r.prototype=new n,r.__super__=e.prototype,r};Yc=function(){function r(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return r.prototype.parse=function(){},r.prototype.encode=function(){},r.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},r}();var Ede=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return qu(r,Yc),r.prototype.tag="head",r.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.revision=e.readInt(),this.checkSumAdjustment=e.readInt(),this.magicNumber=e.readInt(),this.flags=e.readShort(),this.unitsPerEm=e.readShort(),this.created=e.readLongLong(),this.modified=e.readLongLong(),this.xMin=e.readShort(),this.yMin=e.readShort(),this.xMax=e.readShort(),this.yMax=e.readShort(),this.macStyle=e.readShort(),this.lowestRecPPEM=e.readShort(),this.fontDirectionHint=e.readShort(),this.indexToLocFormat=e.readShort(),this.glyphDataFormat=e.readShort()},r.prototype.encode=function(e){var t;return(t=new KA).writeInt(this.version),t.writeInt(this.revision),t.writeInt(this.checkSumAdjustment),t.writeInt(this.magicNumber),t.writeShort(this.flags),t.writeShort(this.unitsPerEm),t.writeLongLong(this.created),t.writeLongLong(this.modified),t.writeShort(this.xMin),t.writeShort(this.yMin),t.writeShort(this.xMax),t.writeShort(this.yMax),t.writeShort(this.macStyle),t.writeShort(this.lowestRecPPEM),t.writeShort(this.fontDirectionHint),t.writeShort(e),t.writeShort(this.glyphDataFormat),t.data},r}(),AD=function(){function r(e,t){var n,i,s,a,o,u,d,p,b,C,w,M,P,k,D,j,H;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),b=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(u=0;u<256;++u)this.codeMap[u]=e.readByte();break;case 4:for(w=e.readUInt16(),C=w/2,e.pos+=6,s=function(){var N,q;for(q=[],u=N=0;0<=C?N<C:N>C;u=0<=C?++N:--N)q.push(e.readUInt16());return q}(),e.pos+=2,P=function(){var N,q;for(q=[],u=N=0;0<=C?N<C:N>C;u=0<=C?++N:--N)q.push(e.readUInt16());return q}(),d=function(){var N,q;for(q=[],u=N=0;0<=C?N<C:N>C;u=0<=C?++N:--N)q.push(e.readUInt16());return q}(),p=function(){var N,q;for(q=[],u=N=0;0<=C?N<C:N>C;u=0<=C?++N:--N)q.push(e.readUInt16());return q}(),i=(this.length-e.pos+this.offset)/2,o=function(){var N,q;for(q=[],u=N=0;0<=i?N<i:N>i;u=0<=i?++N:--N)q.push(e.readUInt16());return q}(),u=D=0,H=s.length;D<H;u=++D)for(k=s[u],n=j=M=P[u];M<=k?j<=k:j>=k;n=M<=k?++j:--j)p[u]===0?a=n+d[u]:(a=o[p[u]/2+(n-M)-(C-u)]||0)!==0&&(a+=d[u]),this.codeMap[n]=65535&a}e.pos=b}return r.encode=function(e,t){var n,i,s,a,o,u,d,p,b,C,w,M,P,k,D,j,H,N,q,W,ie,se,Z,fe,te,ce,ve,me,qe,ot,st,Ye,Xe,wt,ht,he,Be,Le,He,rt,it,Pt,Bt,Dt,Yt,nr;switch(me=new KA,a=Object.keys(e).sort(function(ur,xt){return ur-xt}),t){case"macroman":for(P=0,k=function(){var ur=[];for(M=0;M<256;++M)ur.push(0);return ur}(),j={0:0},s={},qe=0,Xe=a.length;qe<Xe;qe++)j[Bt=e[i=a[qe]]]==null&&(j[Bt]=++P),s[i]={old:e[i],new:j[e[i]]},k[i]=j[e[i]];return me.writeUInt16(1),me.writeUInt16(0),me.writeUInt32(12),me.writeUInt16(0),me.writeUInt16(262),me.writeUInt16(0),me.write(k),{charMap:s,subtable:me.data,maxGlyphID:P+1};case"unicode":for(ce=[],b=[],H=0,j={},n={},D=d=null,ot=0,wt=a.length;ot<wt;ot++)j[q=e[i=a[ot]]]==null&&(j[q]=++H),n[i]={old:q,new:j[q]},o=j[q]-i,D!=null&&o===d||(D&&b.push(D),ce.push(i),d=o),D=i;for(D&&b.push(D),b.push(65535),ce.push(65535),fe=2*(Z=ce.length),se=2*Math.pow(Math.log(Z)/Math.LN2,2),C=Math.log(se/2)/Math.LN2,ie=2*Z-se,u=[],W=[],w=[],M=st=0,ht=ce.length;st<ht;M=++st){if(te=ce[M],p=b[M],te===65535){u.push(0),W.push(0);break}if(te-(ve=n[te].new)>=32768)for(u.push(0),W.push(2*(w.length+Z-M)),i=Ye=te;te<=p?Ye<=p:Ye>=p;i=te<=p?++Ye:--Ye)w.push(n[i].new);else u.push(ve-te),W.push(0)}for(me.writeUInt16(3),me.writeUInt16(1),me.writeUInt32(12),me.writeUInt16(4),me.writeUInt16(16+8*Z+2*w.length),me.writeUInt16(0),me.writeUInt16(fe),me.writeUInt16(se),me.writeUInt16(C),me.writeUInt16(ie),it=0,he=b.length;it<he;it++)i=b[it],me.writeUInt16(i);for(me.writeUInt16(0),Pt=0,Be=ce.length;Pt<Be;Pt++)i=ce[Pt],me.writeUInt16(i);for(Dt=0,Le=u.length;Dt<Le;Dt++)o=u[Dt],me.writeUInt16(o);for(Yt=0,He=W.length;Yt<He;Yt++)N=W[Yt],me.writeUInt16(N);for(nr=0,rt=w.length;nr<rt;nr++)P=w[nr],me.writeUInt16(P);return{charMap:n,subtable:me.data,maxGlyphID:H+1}}},r}(),fD=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return qu(r,Yc),r.prototype.tag="cmap",r.prototype.parse=function(e){var t,n,i;for(e.pos=this.offset,this.version=e.readUInt16(),i=e.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=i?n<i:n>i;n=0<=i?++n:--n)t=new AD(e,this.offset),this.tables.push(t),t.isUnicode&&this.unicode==null&&(this.unicode=t);return!0},r.encode=function(e,t){var n,i;return t==null&&(t="macroman"),n=AD.encode(e,t),(i=new KA).writeUInt16(0),i.writeUInt16(1),n.table=i.data.concat(n.subtable),n},r}(),Sde=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return qu(r,Yc),r.prototype.tag="hhea",r.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.ascender=e.readShort(),this.decender=e.readShort(),this.lineGap=e.readShort(),this.advanceWidthMax=e.readShort(),this.minLeftSideBearing=e.readShort(),this.minRightSideBearing=e.readShort(),this.xMaxExtent=e.readShort(),this.caretSlopeRise=e.readShort(),this.caretSlopeRun=e.readShort(),this.caretOffset=e.readShort(),e.pos+=8,this.metricDataFormat=e.readShort(),this.numberOfMetrics=e.readUInt16()},r}(),Ide=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return qu(r,Yc),r.prototype.tag="OS/2",r.prototype.parse=function(e){if(e.pos=this.offset,this.version=e.readUInt16(),this.averageCharWidth=e.readShort(),this.weightClass=e.readUInt16(),this.widthClass=e.readUInt16(),this.type=e.readShort(),this.ySubscriptXSize=e.readShort(),this.ySubscriptYSize=e.readShort(),this.ySubscriptXOffset=e.readShort(),this.ySubscriptYOffset=e.readShort(),this.ySuperscriptXSize=e.readShort(),this.ySuperscriptYSize=e.readShort(),this.ySuperscriptXOffset=e.readShort(),this.ySuperscriptYOffset=e.readShort(),this.yStrikeoutSize=e.readShort(),this.yStrikeoutPosition=e.readShort(),this.familyClass=e.readShort(),this.panose=function(){var t,n;for(n=[],t=0;t<10;++t)n.push(e.readByte());return n}(),this.charRange=function(){var t,n;for(n=[],t=0;t<4;++t)n.push(e.readInt());return n}(),this.vendorID=e.readString(4),this.selection=e.readShort(),this.firstCharIndex=e.readShort(),this.lastCharIndex=e.readShort(),this.version>0&&(this.ascent=e.readShort(),this.descent=e.readShort(),this.lineGap=e.readShort(),this.winAscent=e.readShort(),this.winDescent=e.readShort(),this.codePageRange=function(){var t,n;for(n=[],t=0;t<2;t=++t)n.push(e.readInt());return n}(),this.version>1))return this.xHeight=e.readShort(),this.capHeight=e.readShort(),this.defaultChar=e.readShort(),this.breakChar=e.readShort(),this.maxContext=e.readShort()},r}(),Pde=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return qu(r,Yc),r.prototype.tag="post",r.prototype.parse=function(e){var t,n,i;switch(e.pos=this.offset,this.format=e.readInt(),this.italicAngle=e.readInt(),this.underlinePosition=e.readShort(),this.underlineThickness=e.readShort(),this.isFixedPitch=e.readInt(),this.minMemType42=e.readInt(),this.maxMemType42=e.readInt(),this.minMemType1=e.readInt(),this.maxMemType1=e.readInt(),this.format){case 65536:case 196608:break;case 131072:var s;for(n=e.readUInt16(),this.glyphNameIndex=[],s=0;0<=n?s<n:s>n;s=0<=n?++s:--s)this.glyphNameIndex.push(e.readUInt16());for(this.names=[],i=[];e.pos<this.offset+this.length;)t=e.readByte(),i.push(this.names.push(e.readString(t)));return i;case 151552:return n=e.readUInt16(),this.offsets=e.read(n);case 262144:return this.map=(function(){var a,o,u;for(u=[],s=a=0,o=this.file.maxp.numGlyphs;0<=o?a<o:a>o;s=0<=o?++a:--a)u.push(e.readUInt32());return u}).call(this)}},r}(),Mde=function(r,e){this.raw=r,this.length=r.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},Fde=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return qu(r,Yc),r.prototype.tag="name",r.prototype.parse=function(e){var t,n,i,s,a,o,u,d,p,b,C;for(e.pos=this.offset,e.readShort(),t=e.readShort(),o=e.readShort(),n=[],s=0;0<=t?s<t:s>t;s=0<=t?++s:--s)n.push({platformID:e.readShort(),encodingID:e.readShort(),languageID:e.readShort(),nameID:e.readShort(),length:e.readShort(),offset:this.offset+o+e.readShort()});for(u={},s=p=0,b=n.length;p<b;s=++p)i=n[s],e.pos=i.offset,d=e.readString(i.length),a=new Mde(d,i),u[C=i.nameID]==null&&(u[C]=[]),u[i.nameID].push(a);this.strings=u,this.copyright=u[0],this.fontFamily=u[1],this.fontSubfamily=u[2],this.uniqueSubfamily=u[3],this.fontName=u[4],this.version=u[5];try{this.postscriptName=u[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=u[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=u[7],this.manufacturer=u[8],this.designer=u[9],this.description=u[10],this.vendorUrl=u[11],this.designerUrl=u[12],this.license=u[13],this.licenseUrl=u[14],this.preferredFamily=u[15],this.preferredSubfamily=u[17],this.compatibleFull=u[18],this.sampleText=u[19]},r}(),Rde=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return qu(r,Yc),r.prototype.tag="maxp",r.prototype.parse=function(e){return e.pos=this.offset,this.version=e.readInt(),this.numGlyphs=e.readUInt16(),this.maxPoints=e.readUInt16(),this.maxContours=e.readUInt16(),this.maxCompositePoints=e.readUInt16(),this.maxComponentContours=e.readUInt16(),this.maxZones=e.readUInt16(),this.maxTwilightPoints=e.readUInt16(),this.maxStorage=e.readUInt16(),this.maxFunctionDefs=e.readUInt16(),this.maxInstructionDefs=e.readUInt16(),this.maxStackElements=e.readUInt16(),this.maxSizeOfInstructions=e.readUInt16(),this.maxComponentElements=e.readUInt16(),this.maxComponentDepth=e.readUInt16()},r}(),Lde=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return qu(r,Yc),r.prototype.tag="hmtx",r.prototype.parse=function(e){var t,n,i,s,a,o,u;for(e.pos=this.offset,this.metrics=[],t=0,o=this.file.hhea.numberOfMetrics;0<=o?t<o:t>o;t=0<=o?++t:--t)this.metrics.push({advance:e.readUInt16(),lsb:e.readInt16()});for(i=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var d,p;for(p=[],t=d=0;0<=i?d<i:d>i;t=0<=i?++d:--d)p.push(e.readInt16());return p}(),this.widths=(function(){var d,p,b,C;for(C=[],d=0,p=(b=this.metrics).length;d<p;d++)s=b[d],C.push(s.advance);return C}).call(this),n=this.widths[this.widths.length-1],u=[],t=a=0;0<=i?a<i:a>i;t=0<=i?++a:--a)u.push(this.widths.push(n));return u},r.prototype.forGlyph=function(e){return e in this.metrics?this.metrics[e]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[e-this.metrics.length]}},r}(),dD=[].slice,Ode=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return qu(r,Yc),r.prototype.tag="glyf",r.prototype.parse=function(){return this.cache={}},r.prototype.glyphFor=function(e){var t,n,i,s,a,o,u,d,p,b;return e in this.cache?this.cache[e]:(s=this.file.loca,t=this.file.contents,n=s.indexOf(e),(i=s.lengthOf(e))===0?this.cache[e]=null:(t.pos=this.offset+n,a=(o=new KA(t.read(i))).readShort(),d=o.readShort(),b=o.readShort(),u=o.readShort(),p=o.readShort(),this.cache[e]=a===-1?new Dde(o,d,b,u,p):new Ude(o,a,d,b,u,p),this.cache[e]))},r.prototype.encode=function(e,t,n){var i,s,a,o,u;for(a=[],s=[],o=0,u=t.length;o<u;o++)i=e[t[o]],s.push(a.length),i&&(a=a.concat(i.encode(n)));return s.push(a.length),{table:a,offsets:s}},r}(),Ude=function(){function r(e,t,n,i,s,a){this.raw=e,this.numberOfContours=t,this.xMin=n,this.yMin=i,this.xMax=s,this.yMax=a,this.compound=!1}return r.prototype.encode=function(){return this.raw.data},r}(),Dde=function(){function r(e,t,n,i,s){var a,o;for(this.raw=e,this.xMin=t,this.yMin=n,this.xMax=i,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;o=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&o;)a.pos+=1&o?4:2,128&o?a.pos+=8:64&o?a.pos+=4:8&o&&(a.pos+=2)}return r.prototype.encode=function(){var e,t,n;for(t=new KA(dD.call(this.raw.data)),e=0,n=this.glyphIDs.length;e<n;++e)t.pos=this.glyphOffsets[e];return t.data},r}(),kde=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return qu(r,Yc),r.prototype.tag="loca",r.prototype.parse=function(e){var t,n;return e.pos=this.offset,t=this.file.head.indexToLocFormat,this.offsets=t===0?(function(){var i,s;for(s=[],n=0,i=this.length;n<i;n+=2)s.push(2*e.readUInt16());return s}).call(this):(function(){var i,s;for(s=[],n=0,i=this.length;n<i;n+=4)s.push(e.readUInt32());return s}).call(this)},r.prototype.indexOf=function(e){return this.offsets[e]},r.prototype.lengthOf=function(e){return this.offsets[e+1]-this.offsets[e]},r.prototype.encode=function(e,t){for(var n=new Uint32Array(this.offsets.length),i=0,s=0,a=0;a<n.length;++a)if(n[a]=i,s<t.length&&t[s]==a){++s,n[a]=i;var o=this.offsets[a],u=this.offsets[a+1]-o;u>0&&(i+=u)}for(var d=new Array(4*n.length),p=0;p<n.length;++p)d[4*p+3]=255&n[p],d[4*p+2]=(65280&n[p])>>8,d[4*p+1]=(16711680&n[p])>>16,d[4*p]=(4278190080&n[p])>>24;return d},r}(),Nde=function(){function r(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return r.prototype.generateCmap=function(){var e,t,n,i,s;for(t in i=this.font.cmap.tables[0].codeMap,e={},s=this.subset)n=s[t],e[t]=i[n];return e},r.prototype.glyphsFor=function(e){var t,n,i,s,a,o,u;for(i={},a=0,o=e.length;a<o;a++)i[s=e[a]]=this.font.glyf.glyphFor(s);for(s in t=[],i)(n=i[s])!=null&&n.compound&&t.push.apply(t,n.glyphIDs);if(t.length>0)for(s in u=this.glyphsFor(t))n=u[s],i[s]=n;return i},r.prototype.encode=function(e,t){var n,i,s,a,o,u,d,p,b,C,w,M,P,k,D;for(i in n=fD.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(e),w={0:0},D=n.charMap)w[(u=D[i]).old]=u.new;for(M in C=n.maxGlyphID,a)M in w||(w[M]=C++);return p=function(j){var H,N;for(H in N={},j)N[j[H]]=H;return N}(w),b=Object.keys(p).sort(function(j,H){return j-H}),P=function(){var j,H,N;for(N=[],j=0,H=b.length;j<H;j++)o=b[j],N.push(p[o]);return N}(),s=this.font.glyf.encode(a,P,w),d=this.font.loca.encode(s.offsets,P),k={cmap:this.font.cmap.raw(),glyf:s.table,loca:d,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(k["OS/2"]=this.font.os2.raw()),this.font.directory.encode(k)},r}();Jr.API.PDFObject=function(){var r;function e(){}return r=function(t,n){return(Array(n+1).join("0")+t).slice(-n)},e.convert=function(t){var n,i,s,a;if(Array.isArray(t))return"["+function(){var o,u,d;for(d=[],o=0,u=t.length;o<u;o++)n=t[o],d.push(e.convert(n));return d}().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t?.isString)return"("+t+")";if(t instanceof Date)return"(D:"+r(t.getUTCFullYear(),4)+r(t.getUTCMonth(),2)+r(t.getUTCDate(),2)+r(t.getUTCHours(),2)+r(t.getUTCMinutes(),2)+r(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(i in s=["<<"],t)a=t[i],s.push("/"+i+" "+e.convert(a));return s.push(">>"),s.join(`
`)}return""+t},e}();const AC={"circle-radius":8,"circle-color":"red","circle-stroke-width":1,"circle-stroke-color":"black"},Ib={style:{textSize:16,textHaloColor:"#FFFFFF",textHaloWidth:.8,textColor:"#000000",fallbackTextFont:["Open Sans Regular"]},visibility:"visible",position:"bottom-right"},Pb={image:'<svg width="800px" height="800px" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--gis" preserveAspectRatio="xMidYMid meet"><path d="M47.655 1.634l-35 95c-.828 2.24 1.659 4.255 3.68 2.98l33.667-21.228l33.666 21.228c2.02 1.271 4.503-.74 3.678-2.98l-35-95C51.907.514 51.163.006 50 .008c-1.163.001-1.99.65-2.345 1.626zm-.155 14.88v57.54L19.89 91.461z" fill="none" stroke="white" stroke-width="1.5"/><path d="M47.655 1.634l-35 95c-.828 2.24 1.659 4.255 3.68 2.98l33.667-21.228l33.666 21.228c2.02 1.271 4.503-.74 3.678-2.98l-35-95C51.907.514 51.163.006 50 .008c-1.163.001-1.99.65-2.345 1.626zm-.155 14.88v57.54L19.89 91.461z" fill="#000000" fill-rule="evenodd"></path></svg>',imageName:"gl-export-north-icon",imageSizeFraction:.05,visibility:"visible",position:"top-right"};class zde{map;width;height;dpi;format;unit;fileName;markerClassName;markerCirclePaint;attributionClassName;attributionOptions;northIconOptions;constructor(e,t=ad.A4,n=300,i=Nh.PNG,s=qp.mm,a="map",o="maplibregl-marker",u=AC,d="maplibregl-ctrl-attrib-inner",p=Ib,b=Pb){this.map=e,this.width=t[0],this.height=t[1],this.dpi=n,this.format=i,this.unit=s,this.fileName=a,this.markerClassName=o,this.markerCirclePaint=u,this.attributionClassName=d,this.attributionOptions=p,this.northIconOptions=b}renderMapPost(e){return e}getMarkers(){return this.map.getCanvasContainer().getElementsByClassName(this.markerClassName)}renderMarkers(e){const t=this.getMarkers();for(let n=0;n<t.length;n++){const i=t.item(n);if(!i)continue;const s=i.getAttribute("style");if(!s)continue;const a=/translate\(([^,]+)px,\s*([^,]+)px\)/,o=s.match(a);if(!o)continue;const u=parseInt(o[1]),d=parseInt(o[2]),p=this.map.unproject([u,d]),b=`point${n}`;e.addSource(b,{type:"geojson",data:{type:"Point",coordinates:[p.lng,p.lat]}}),e.addLayer({id:b,source:b,type:"circle",paint:this.markerCirclePaint})}return e}generate(){const e=this;this.addLoader(),this.showLoader();const t=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return e.dpi/96}});const n=document.createElement("div");n.className="hidden-map",document.body.appendChild(n);const i=document.createElement("div");i.style.width=this.toPixels(this.width),i.style.height=this.toPixels(this.height),n.appendChild(i);const s=this.map.getStyle();if(s&&s.sources){const o=s.sources;Object.keys(o).forEach(u=>{const d=o[u];Object.keys(d).forEach(p=>{d[p]||delete d[p]})})}let a=this.getRenderedMap(i,s);a.on("load",()=>{this.addNorthIconToMap(a).then(()=>{a.once("idle",()=>{this.addAttributions(a)?a.once("idle",()=>{a=this.renderMapPost(a),this.getMarkers().length===0?this.exportImage(a,n,t):(a=this.renderMarkers(a),a.once("idle",()=>{this.exportImage(a,n,t)}))}):(a=this.renderMapPost(a),this.getMarkers().length===0?this.exportImage(a,n,t):(a=this.renderMarkers(a),a.once("idle",()=>{this.exportImage(a,n,t)})))})})})}stripHtml(e){const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}getIconWidth(e,t){const n=e.getContainer(),i=parseInt(n.style.width.replace("px",""));return parseInt(`${i*t}`)}getElementPosition(e,t,n=0){const i=e.getContainer();let s=0,a=0;switch(t){case"top-left":s=0+n,a=0+n;break;case"top-right":s=parseInt(i.style.width.replace("px",""))-n,a=0+n;break;case"bottom-left":s=0+n,a=parseInt(i.style.height.replace("px",""))-n;break;case"bottom-right":s=parseInt(i.style.width.replace("px",""))-n,a=parseInt(i.style.height.replace("px",""))-n;break}return[s,a]}addNorthIconImage(e){const t=this.getIconWidth(e,this.northIconOptions.imageSizeFraction??.08);return new Promise(n=>{const i=new Image(t,t);i.onload=()=>{this.northIconOptions.imageName&&e.addImage(this.northIconOptions.imageName,i),n()};function s(a){return"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a)}this.northIconOptions.image&&(i.src=s(this.northIconOptions.image))})}addNorthIconToMap(e){let t=this.northIconOptions.visibility??"visible";return e.getZoom()<2&&this.width>this.height&&(t="none"),new Promise(n=>{this.addNorthIconImage(e).then(()=>{const i=this.getIconWidth(e,this.northIconOptions.imageSizeFraction??.08)*.8,s=this.getElementPosition(e,this.northIconOptions.position??"top-right",i),a=e.unproject(s),o=this.northIconOptions.imageName??"gl-export-north-icon";e.addSource(o,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[a.lng,a.lat]},properties:{}}}),e.addLayer({id:o,source:o,type:"symbol",layout:{"icon-image":o,"icon-size":1,"icon-rotate":e.getBearing()*-1,"icon-allow-overlap":!0,"icon-ignore-placement":!0,visibility:t},paint:{}}),n()})})}addAttributions(e){if(!this.map.getStyle().glyphs)return!1;const t=e.getContainer(),n=this.attributionOptions.position??"bottom-right",i=this.getElementPosition(e,n,5),s=i[0],a=e.unproject(i),o=t.getElementsByClassName(this.attributionClassName),u=[];if(o?.length>0){const P=o.item(0);if(P)for(let k=0;k<P.children.length;k++){const D=P.children.item(k);D&&u.push(this.stripHtml(D.outerHTML))}}else{const P=this.map.getStyle().sources;Object.keys(P).forEach(k=>{const D=P[k];if("attribution"in D){const j=D.attribution;u.push(this.stripHtml(j))}})}if(u.length===0)return!1;const d=u.join(" | "),p="attribution";e.addSource(p,{type:"geojson",data:{type:"Feature",geometry:{type:"Point",coordinates:[a.lng,a.lat]},properties:{attribution:d}}});const b=this.map.getStyle().layers.filter(P=>P.type==="symbol"&&P.layout&&"text-font"in P.layout),C=b.length>0&&b[0].layout?b[0].layout["text-font"]:this.attributionOptions.style?.fallbackTextFont;let w=this.attributionOptions.visibility??"visible";e.getZoom()<2&&this.width>this.height&&(w="none");const M=this.attributionOptions.style;return e.addLayer({id:p,source:p,type:"symbol",layout:{"text-field":["get","attribution"],"text-font":C,"text-max-width":parseInt(`${s/M.textSize}`),"text-anchor":n,"text-justify":["top-right","bottom-right"].includes(n)?"right":"left","text-size":M.textSize,"text-allow-overlap":!0,visibility:w},paint:{"text-halo-color":M.textHaloColor,"text-halo-width":M.textHaloWidth,"text-color":M.textColor}}),!0}exportImage(e,t,n){const i=e.getCanvas(),s=`${this.fileName}.${this.format}`;switch(this.format){case Nh.PNG:this.toPNG(i,s);break;case Nh.JPEG:this.toJPEG(i,s);break;case Nh.PDF:this.toPDF(e,s);break;case Nh.SVG:this.toSVG(i,s);break;default:console.error(`Invalid file format: ${this.format}`);break}e.remove(),t.parentNode?.removeChild(t),Object.defineProperty(window,"devicePixelRatio",{get(){return n}}),t.remove(),this.hideLoader()}toPNG(e,t){const n=document.createElement("a");n.href=e.toDataURL(),n.download=t,n.click(),n.remove()}toJPEG(e,t){const n=e.toDataURL("image/jpeg",.85),i=document.createElement("a");i.href=n,i.download=t,i.click(),i.remove()}toPDF(e,t){const n=e.getCanvas(),i=new Jr({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});i.addImage(n.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:s,lat:a}=e.getCenter();i.setProperties({title:e.getStyle().name,subject:`center: [${s}, ${a}], zoom: ${e.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),i.save(t)}toSVG(e,t){const n=e.toDataURL("image/png"),i=Number(this.toPixels(this.width,this.dpi).replace("px","")),s=Number(this.toPixels(this.height,this.dpi).replace("px","")),a=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${i}" 
      height="${s}" 
      viewBox="0 0 ${i} ${s}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${n}" width="${i}" height="${s}"></image>
    </svg>`,o=document.createElement("a");o.href=`data:application/xml,${encodeURIComponent(a)}`,o.download=t,o.click(),o.remove()}toPixels(e,t=96){return this.unit===qp.mm&&(t/=25.4),`${t*e}px`}addLoader(){const e=this.map.getCanvas().parentElement?.parentElement;if(!e||e.getElementsByClassName("map-export-loader").length>0)return;const t=document.createElement("span");t.classList.add("map-export-loader"),t.classList.add("loader-default"),e.appendChild(t)}showLoader(){const e=this.map.getCanvas().parentElement?.parentElement;if(!e)return;const t=e.getElementsByClassName("map-export-loader");t&&t.length>0&&t.item(0)?.classList.add("is-active")}hideLoader(){const e=this.map.getCanvas().parentElement?.parentElement;if(!e)return;const t=e.getElementsByClassName("map-export-loader");t&&t.length>0&&t.item(0)?.classList.remove("is-active")}}class Qde extends zde{constructor(e,t=ad.A4,n=300,i=Nh.PNG,s=qp.mm,a="map",o=AC,u=Ib,d=Pb){super(e,t,n,i,s,a,"maplibregl-marker",o,"maplibregl-ctrl-attrib-inner",u,d)}getRenderedMap(e,t){const n=new UI.Map({container:e,style:t,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,canvasContextAttributes:{preserveDrawingBuffer:!0},fadeDuration:0,transformRequest:this.map._requestManager._transformRequestFn});this.map.getTerrain()&&(n.setMaxPitch(85),n.setPitch(this.map.getPitch()));const i=(this.map.style.imageManager||{}).images||[];return Object.keys(i).forEach(s=>{i[s].data&&n.addImage(s,i[s].data)}),n}renderMapPost(e){const t=this.map.getTerrain();return t&&e.setTerrain({source:t.source,exaggeration:t.exaggeration}),e}}class Hde{controlContainer;exportContainer;crosshair;printableArea;map;exportButton;options={PageSize:ad.A4,PageOrientation:t_.Landscape,Format:Nh.PDF,DPI:MB[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(ad),Filename:"map",markerCirclePaint:AC,attributionOptions:Ib,northIconOptions:Pb};MAPLIB_CSS_PREFIX="maplibregl";constructor(e){e&&(e.attributionOptions=Object.assign(Ib,e.attributionOptions),e.northIconOptions=Object.assign(Pb,e.northIconOptions),this.options=Object.assign(this.options,e)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){const e=this.options.Local??"en";return Jhe(e)}onAdd(e){this.map=e,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl`),this.controlContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-group`),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-list`),this.exportButton=document.createElement("button"),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-ctrl-icon`),this.exportButton.classList.add(`${this.MAPLIB_CSS_PREFIX}-export-control`),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const t=document.createElement("TABLE");t.className="print-table";const n={};this.options.AllowedSizes?.forEach(d=>{ad[d]&&(n[d]=ad[d])});const i=this.createSelection(n,this.getTranslation().PageSize,"page-size",this.options.PageSize,(d,p)=>JSON.stringify(d[p]));t.appendChild(i);const s=this.createSelection(t_,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(d,p)=>d[p]);t.appendChild(s);const a=this.createSelection(Nh,this.getTranslation().Format,"format-type",this.options.Format,(d,p)=>d[p]);t.appendChild(a);const o=this.createSelection(MB,this.getTranslation().DPI,"dpi-type",this.options.DPI,(d,p)=>d[p]);t.appendChild(o),this.exportContainer.appendChild(t);const u=document.createElement("button");return u.type="button",u.textContent=this.getTranslation().Generate,u.classList.add("generate-button"),u.addEventListener("click",()=>{const d=document.getElementById("mapbox-gl-export-page-size"),p=document.getElementById("mapbox-gl-export-page-orientation"),b=document.getElementById("mapbox-gl-export-format-type"),C=document.getElementById("mapbox-gl-export-dpi-type"),w=p.value;let M=JSON.parse(d.value);w===t_.Portrait&&(M=M.reverse()),this.generateMap(e,M,Number(C.value),b.value,qp.mm,this.options.Filename)}),this.exportContainer.appendChild(u),this.controlContainer}generateMap(e,t,n,i,s,a){new Qde(e,t,n,i,s,a,this.options.markerCirclePaint,this.options.attributionOptions,this.options.northIconOptions).generate()}createSelection(e,t,n,i,s){const a=document.createElement("label");a.textContent=t;const o=document.createElement("select");o.setAttribute("id",`mapbox-gl-export-${n}`),o.style.width="100%",Object.keys(e).forEach(b=>{const C=document.createElement("option");C.setAttribute("value",s(e,b)),C.appendChild(document.createTextNode(b)),C.setAttribute("name",n),i===e[b]&&(C.selected=!0),o.appendChild(C)}),o.addEventListener("change",()=>{this.updatePrintableArea()});const u=document.createElement("TR"),d=document.createElement("TD"),p=document.createElement("TD");return d.appendChild(a),p.appendChild(o),u.appendChild(d),u.appendChild(p),u}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0),this.map=void 0)}onDocumentClick(e){this.controlContainer&&!this.controlContainer.contains(e.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(e){this.options.Crosshair===!0&&(e===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new Dhe(this.map),this.crosshair.create()))}togglePrintableArea(e){this.options.PrintableArea===!0&&(e===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new khe(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const e=document.getElementById("mapbox-gl-export-page-size"),t=document.getElementById("mapbox-gl-export-page-orientation").value;let n=JSON.parse(e.value);t===t_.Portrait&&(n=n.reverse()),this.printableArea.updateArea(n[0],n[1])}}function fC(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(p){try{d(n.next(p))}catch(b){a(b)}}function u(p){try{d(n.throw(p))}catch(b){a(b)}}function d(p){p.done?s(p.value):i(p.value).then(o,u)}d((n=n.apply(r,e||[])).next())})}typeof SuppressedError=="function"&&SuppressedError;var Mb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fb(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var dC,pD;function gD(){if(pD)return dC;pD=1,dC=e;var r=Object.prototype.hasOwnProperty;function e(){for(var t={},n=0;n<arguments.length;n++){var i=arguments[n];for(var s in i)r.call(i,s)&&(t[s]=i[s])}return t}return dC}var pC={exports:{}},mD;function Vde(){return mD||(mD=1,function(r,e){(function(){var t={};r.exports=t,t.simpleFilter=function(n,i){return i.filter(function(s){return t.test(n,s)})},t.test=function(n,i){return t.match(n,i)!==null},t.match=function(n,i,s){s=s||{};var a=0,o=[],u=i.length,d=0,p=0,b=s.pre||"",C=s.post||"",w=s.caseSensitive&&i||i.toLowerCase(),M;n=s.caseSensitive&&n||n.toLowerCase();for(var P=0;P<u;P++)M=i[P],w[P]===n[a]?(M=b+M+C,a+=1,p+=1+p):p=0,d+=p,o[o.length]=M;return a===n.length?(d=w===n?1/0:d,{rendered:o.join(""),score:d}):null},t.filter=function(n,i,s){return!i||i.length===0?[]:typeof n!="string"?i:(s=s||{},i.reduce(function(a,o,u,d){var p=o;s.extract&&(p=s.extract(o));var b=t.match(n,p,s);return b!=null&&(a[a.length]={string:b.rendered,score:b.score,index:u,original:o}),a},[]).sort(function(a,o){var u=o.score-a.score;return u||a.index-o.index}))}})()}(pC)),pC.exports}var gC,_D;function jde(){if(_D)return gC;_D=1;var r=function(e){return this.component=e,this.items=[],this.active=e.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};return r.prototype.show=function(){this.element.style.display="block"},r.prototype.hide=function(){this.element.style.display="none"},r.prototype.add=function(e){this.items.push(e)},r.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},r.prototype.isEmpty=function(){return!this.items.length},r.prototype.isVisible=function(){return this.element.style.display==="block"},r.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()},r.prototype.drawItem=function(e,t){var n=document.createElement("li"),i=document.createElement("a");t&&(n.className+=" active"),i.innerHTML=e.string,n.appendChild(i),this.element.appendChild(n),n.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),n.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,e)}).bind(this))},r.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()},r.prototype.move=function(e){this.active=e,this.draw()},r.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},r.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},r.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()},gC=r,gC}var mC,yD;function $de(){if(yD)return mC;yD=1;var r=gD(),e=Vde(),t=jde(),n=function(i,s,a){return a=a||{},this.options=r({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},a),this.el=i,this.data=s||[],this.list=new t(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(o){this.handleKeyUp(o.keyCode,o)}).bind(this),!1),this.el.addEventListener("keydown",(function(o){this.handleKeyDown(o)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(o){this.handlePaste(o)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};return n.prototype.handleKeyUp=function(i,s){if(!(i===40||i===38||i===27||i===9)){if(i===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),s.stopPropagation());return}this.handleInputChange(this.el.value)}},n.prototype.handleKeyDown=function(i){switch(i.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&i.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},n.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},n.prototype.handlePaste=function(i){if(i.clipboardData)this.handleInputChange(i.clipboardData.getData("Text"));else{var s=this;setTimeout(function(){s.handleInputChange(i.target.value)},100)}},n.prototype.handleInputChange=function(i){if(this.query=this.normalize(i),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(s){for(var a=0;a<s.length&&(this.list.add(s[a]),a!==this.options.limit-1);a++);this.list.draw()}).bind(this))},n.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},n.prototype.update=function(i){this.data=i,this.handleKeyUp()},n.prototype.clear=function(){this.data=[],this.list.clear()},n.prototype.normalize=function(i){return i=i.toLowerCase(),i},n.prototype.match=function(i,s){return i.indexOf(s)>-1},n.prototype.value=function(i){if(this.selected=i,this.el.value=this.getItemValue(i||{place_name:this.query}),document.createEvent){var s=document.createEvent("HTMLEvents");s.initEvent("change",!0,!1),this.el.dispatchEvent(s)}else this.el.fireEvent("onchange")},n.prototype.getCandidates=function(i){var s={pre:"<strong>",post:"</strong>",extract:(function(o){return this.getItemValue(o)}).bind(this)},a;this.options.filter?(a=e.filter(this.query,this.data,s),a=a.map((function(o){return{original:o.original,string:this.render(o.original,o.string)}}).bind(this))):a=this.data.map((function(o){var u=this.render(o);return{original:o,string:u}}).bind(this)),i(a)},n.prototype.getItemValue=function(i){return i},n.prototype.render=function(i,s){if(s)return s;for(var a=i.original?this.getItemValue(i.original):this.getItemValue(i),o=this.normalize(a),u=o.lastIndexOf(this.query);u>-1;){var d=u+this.query.length;a=a.slice(0,u)+"<strong>"+a.slice(u,d)+"</strong>"+a.slice(d),u=o.slice(0,u).lastIndexOf(this.query)}return a},n.prototype.renderError=function(i){this.list.drawError(i)},mC=n,mC}var _C,bD;function Gde(){if(bD)return _C;bD=1;var r=$de();return _C=r,typeof window<"u"&&(window.Suggestions=r),_C}var Wde=Gde(),qde=Fb(Wde),Rb={exports:{}},Kde=Rb.exports,vD;function Xde(){return vD||(vD=1,function(r){(function(e,t,n){r.exports?r.exports=n():e[t]=n()})(Kde,"subtag",function(){var e="",t=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function n(u){return u.match(t)||[]}function i(u){return n(u).filter(function(d,p){return d&&p})}function s(u){return u=n(u),{language:u[1]||e,extlang:u[2]||e,script:u[3]||e,region:u[4]||e}}function a(u,d,p){Object.defineProperty(u,d,{value:p,enumerable:!0})}function o(u,d,p){function b(C){return n(C)[u]||e}a(b,"pattern",d),a(s,p,b)}return o(1,/^[a-zA-Z]{2,3}$/,"language"),o(2,/^[a-zA-Z]{3}$/,"extlang"),o(3,/^[a-zA-Z]{4}$/,"script"),o(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),a(s,"split",i),s})}(Rb)),Rb.exports}var Yde=Xde(),Zde=Fb(Yde),yC,wD;function Jde(){if(wD)return yC;wD=1;var r="Expected a function",e=NaN,t="[object Symbol]",n=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,u=typeof Mb=="object"&&Mb&&Mb.Object===Object&&Mb,d=typeof self=="object"&&self&&self.Object===Object&&self,p=u||d||Function("return this")(),b=Object.prototype,C=b.toString,w=Math.max,M=Math.min,P=function(){return p.Date.now()};function k(q,W,ie){var se,Z,fe,te,ce,ve,me=0,qe=!1,ot=!1,st=!0;if(typeof q!="function")throw new TypeError(r);W=N(W)||0,D(ie)&&(qe=!!ie.leading,ot="maxWait"in ie,fe=ot?w(N(ie.maxWait)||0,W):fe,st="trailing"in ie?!!ie.trailing:st);function Ye(it){var Pt=se,Bt=Z;return se=Z=void 0,me=it,te=q.apply(Bt,Pt),te}function Xe(it){return me=it,ce=setTimeout(he,W),qe?Ye(it):te}function wt(it){var Pt=it-ve,Bt=it-me,Dt=W-Pt;return ot?M(Dt,fe-Bt):Dt}function ht(it){var Pt=it-ve,Bt=it-me;return ve===void 0||Pt>=W||Pt<0||ot&&Bt>=fe}function he(){var it=P();if(ht(it))return Be(it);ce=setTimeout(he,wt(it))}function Be(it){return ce=void 0,st&&se?Ye(it):(se=Z=void 0,te)}function Le(){ce!==void 0&&clearTimeout(ce),me=0,se=ve=Z=ce=void 0}function He(){return ce===void 0?te:Be(P())}function rt(){var it=P(),Pt=ht(it);if(se=arguments,Z=this,ve=it,Pt){if(ce===void 0)return Xe(ve);if(ot)return ce=setTimeout(he,W),Ye(ve)}return ce===void 0&&(ce=setTimeout(he,W)),te}return rt.cancel=Le,rt.flush=He,rt}function D(q){var W=typeof q;return!!q&&(W=="object"||W=="function")}function j(q){return!!q&&typeof q=="object"}function H(q){return typeof q=="symbol"||j(q)&&C.call(q)==t}function N(q){if(typeof q=="number")return q;if(H(q))return e;if(D(q)){var W=typeof q.valueOf=="function"?q.valueOf():q;q=D(W)?W+"":W}if(typeof q!="string")return q===0?q:+q;q=q.replace(n,"");var ie=s.test(q);return ie||a.test(q)?o(q.slice(2),ie?2:8):i.test(q)?e:+q}return yC=k,yC}var epe=Jde(),tpe=Fb(epe),rpe=gD(),Zc=Fb(rpe),Lb={exports:{}},xD;function npe(){if(xD)return Lb.exports;xD=1;var r=typeof Reflect=="object"?Reflect:null,e=r&&typeof r.apply=="function"?r.apply:function(q,W,ie){return Function.prototype.apply.call(q,W,ie)},t;r&&typeof r.ownKeys=="function"?t=r.ownKeys:Object.getOwnPropertySymbols?t=function(q){return Object.getOwnPropertyNames(q).concat(Object.getOwnPropertySymbols(q))}:t=function(q){return Object.getOwnPropertyNames(q)};function n(N){console&&console.warn&&console.warn(N)}var i=Number.isNaN||function(q){return q!==q};function s(){s.init.call(this)}Lb.exports=s,Lb.exports.once=D,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(N){if(typeof N!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof N)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(N){if(typeof N!="number"||N<0||i(N))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+N+".");a=N}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(q){if(typeof q!="number"||q<0||i(q))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+q+".");return this._maxListeners=q,this};function u(N){return N._maxListeners===void 0?s.defaultMaxListeners:N._maxListeners}s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(q){for(var W=[],ie=1;ie<arguments.length;ie++)W.push(arguments[ie]);var se=q==="error",Z=this._events;if(Z!==void 0)se=se&&Z.error===void 0;else if(!se)return!1;if(se){var fe;if(W.length>0&&(fe=W[0]),fe instanceof Error)throw fe;var te=new Error("Unhandled error."+(fe?" ("+fe.message+")":""));throw te.context=fe,te}var ce=Z[q];if(ce===void 0)return!1;if(typeof ce=="function")e(ce,this,W);else for(var ve=ce.length,me=M(ce,ve),ie=0;ie<ve;++ie)e(me[ie],this,W);return!0};function d(N,q,W,ie){var se,Z,fe;if(o(W),Z=N._events,Z===void 0?(Z=N._events=Object.create(null),N._eventsCount=0):(Z.newListener!==void 0&&(N.emit("newListener",q,W.listener?W.listener:W),Z=N._events),fe=Z[q]),fe===void 0)fe=Z[q]=W,++N._eventsCount;else if(typeof fe=="function"?fe=Z[q]=ie?[W,fe]:[fe,W]:ie?fe.unshift(W):fe.push(W),se=u(N),se>0&&fe.length>se&&!fe.warned){fe.warned=!0;var te=new Error("Possible EventEmitter memory leak detected. "+fe.length+" "+String(q)+" listeners added. Use emitter.setMaxListeners() to increase limit");te.name="MaxListenersExceededWarning",te.emitter=N,te.type=q,te.count=fe.length,n(te)}return N}s.prototype.addListener=function(q,W){return d(this,q,W,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(q,W){return d(this,q,W,!0)};function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function b(N,q,W){var ie={fired:!1,wrapFn:void 0,target:N,type:q,listener:W},se=p.bind(ie);return se.listener=W,ie.wrapFn=se,se}s.prototype.once=function(q,W){return o(W),this.on(q,b(this,q,W)),this},s.prototype.prependOnceListener=function(q,W){return o(W),this.prependListener(q,b(this,q,W)),this},s.prototype.removeListener=function(q,W){var ie,se,Z,fe,te;if(o(W),se=this._events,se===void 0)return this;if(ie=se[q],ie===void 0)return this;if(ie===W||ie.listener===W)--this._eventsCount===0?this._events=Object.create(null):(delete se[q],se.removeListener&&this.emit("removeListener",q,ie.listener||W));else if(typeof ie!="function"){for(Z=-1,fe=ie.length-1;fe>=0;fe--)if(ie[fe]===W||ie[fe].listener===W){te=ie[fe].listener,Z=fe;break}if(Z<0)return this;Z===0?ie.shift():P(ie,Z),ie.length===1&&(se[q]=ie[0]),se.removeListener!==void 0&&this.emit("removeListener",q,te||W)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(q){var W,ie,se;if(ie=this._events,ie===void 0)return this;if(ie.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):ie[q]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete ie[q]),this;if(arguments.length===0){var Z=Object.keys(ie),fe;for(se=0;se<Z.length;++se)fe=Z[se],fe!=="removeListener"&&this.removeAllListeners(fe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(W=ie[q],typeof W=="function")this.removeListener(q,W);else if(W!==void 0)for(se=W.length-1;se>=0;se--)this.removeListener(q,W[se]);return this};function C(N,q,W){var ie=N._events;if(ie===void 0)return[];var se=ie[q];return se===void 0?[]:typeof se=="function"?W?[se.listener||se]:[se]:W?k(se):M(se,se.length)}s.prototype.listeners=function(q){return C(this,q,!0)},s.prototype.rawListeners=function(q){return C(this,q,!1)},s.listenerCount=function(N,q){return typeof N.listenerCount=="function"?N.listenerCount(q):w.call(N,q)},s.prototype.listenerCount=w;function w(N){var q=this._events;if(q!==void 0){var W=q[N];if(typeof W=="function")return 1;if(W!==void 0)return W.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function M(N,q){for(var W=new Array(q),ie=0;ie<q;++ie)W[ie]=N[ie];return W}function P(N,q){for(;q+1<N.length;q++)N[q]=N[q+1];N.pop()}function k(N){for(var q=new Array(N.length),W=0;W<q.length;++W)q[W]=N[W].listener||N[W];return q}function D(N,q){return new Promise(function(W,ie){function se(fe){N.removeListener(q,Z),ie(fe)}function Z(){typeof N.removeListener=="function"&&N.removeListener("error",se),W([].slice.call(arguments))}H(N,q,Z,{once:!0}),q!=="error"&&j(N,se,{once:!0})})}function j(N,q,W){typeof N.on=="function"&&H(N,"error",q,W)}function H(N,q,W,ie){if(typeof N.on=="function")ie.once?N.once(q,W):N.on(q,W);else if(typeof N.addEventListener=="function")N.addEventListener(q,function se(Z){ie.once&&N.removeEventListener(q,se),W(Z)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof N)}return Lb.exports}var ipe=npe();const BD={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};var c_={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск",es:"Buscar"},errorNoResults:{en:"No results found",de:"Keine Ergebnisse gefunden",es:"No hay resultados",fr:"Aucun résultat trouvé"},errorConnectionFailed:{en:"There was an error reaching the server",de:"Verbindung fehlgeschlagen",es:"Error al conectarse al servidor",fr:"Une erreur est survenue lors de la connexion au serveur"}};const spe=/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;class ope{constructor(e,t){this.options={zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:void 0,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,proximityMinZoom:9,getItemValue:n=>n.text!==void 0?n.text:n.place_name,render:function(n){if(!n.geometry){const s=n.text,a=s.toLowerCase().indexOf(this.query.toLowerCase()),o=this.query.length,u=s.substring(0,a),d=s.substring(a,a+o),p=s.substring(a+o);return'<div class="maplibregl-ctrl-geocoder--suggestion"><svg class="maplibregl-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="maplibregl-ctrl-geocoder--suggestion-info"><div class="maplibregl-ctrl-geocoder--suggestion-title">'+u+'<span class="maplibregl-ctrl-geocoder--suggestion-match">'+d+"</span>"+p+"</div></div></div>"}const i=n.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--result"><svg class="maplibregl-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="maplibregl-ctrl-geocoder--result-title">'+i[0]+'</div><div class="maplibregl-ctrl-geocoder--result-address">'+i.splice(1,i.length).join(",")+"</div></div></div>"},popupRender:n=>{const i=n.place_name.split(",");return'<div class="maplibregl-ctrl-geocoder--suggestion popup-suggestion"><div class="maplibregl-ctrl-geocoder--suggestion-title popup-suggestion-title">'+i[0]+'</div><div class="maplibregl-ctrl-geocoder--suggestion-address popup-suggestion-address">'+i.splice(1,i.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},this._eventEmitter=new ipe.EventEmitter,this.options=Zc({},this.options,t),this.fresh=!0,this.lastSelected=null,this.geocoderApi=e}addTo(e){function t(n,i){if(!document.body.contains(i))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const s=n.onAdd();i.appendChild(s)}if(e instanceof HTMLElement)t(this,e);else if(typeof e=="string"){const n=document.querySelectorAll(e);if(n.length===0)throw new Error("Element "+e+"not found.");if(n.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,n[0])}else if("addControl"in e)e.addControl(this);else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")}onAdd(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);const t=this.container=document.createElement("div");t.className="maplibregl-ctrl-geocoder maplibregl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";const n=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="search",this._inputEl.className="maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",tpe(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);const i=document.createElement("div");i.classList.add("maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("type","button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="maplibregl-ctrl-geocoder--button";const s=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(s),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),i.appendChild(this._clearEl),i.appendChild(this._loadingEl),t.appendChild(n),t.appendChild(this._inputEl),t.appendChild(i),this._typeahead=new qde(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.container.addEventListener("click",()=>{this._typeahead.update(this._typeahead.data)}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),t}createIcon(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","svg");if(n.setAttribute("class","maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+e),n.setAttribute("viewBox","0 0 18 18"),n.setAttribute("xml:space","preserve"),n.setAttribute("width","18"),n.setAttribute("height","18"),"innerHTML"in n)n.innerHTML=t;else{const i=document.createElement("div");i.innerHTML="<svg>"+t.valueOf().toString()+"</svg>";const s=i.firstChild,a=s.firstChild;n.appendChild(a)}return n}onRemove(){return this.container.remove(),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this}_onPaste(e){const t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(t)}_onKeyDown(e){if(e.keyCode===27&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();const s=this._inputEl.value;if(!s)return this.fresh=!0,e.keyCode!==9&&this.clear(e),this._clearEl.style.display="none";if(!(e.metaKey||[9,27,37,39,38,40].indexOf(e.keyCode)!==-1)){if(e.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(s);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(s,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}s.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(s)}}_showButton(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")}_hideButton(){this._typeahead.selected&&(this._clearEl.style.display="none")}_onBlur(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()}_onChange(){const e=this._typeahead.selected;if(e&&!e.geometry)e.placeId?this._geocode(e.placeId,!0,!0):this._geocode(e.text,!0);else if(e&&JSON.stringify(e)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){let t;if(this._removeResultMarkers(),e.properties&&BD[e.properties.short_code])t=Zc({},this.options.flyTo),this._map&&this._map.fitBounds(BD[e.properties.short_code].bbox,t);else if(e.bbox){const n=e.bbox;t=Zc({},this.options.flyTo),this._map&&this._map.fitBounds([[n[0],n[1]],[n[2],n[3]]],t)}else{const n={zoom:this.options.zoom};t=Zc({},n,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}}this.options.marker&&this._maplibregl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:e})}}_getConfigForRequest(){return["bbox","limit","proximity","countries","types","language","reverseMode"].reduce((n,i)=>(this.options[i]&&(["countries","types","language"].indexOf(i)>-1?n[i]=this.options[i].split(/[\s,]+/):n[i]=this.options[i],i==="proximity"&&this.options[i]&&typeof this.options[i].longitude=="number"&&typeof this.options[i].latitude=="number"&&(n[i]=[this.options[i].longitude,this.options[i].latitude])),n),{})}_geocode(e){return fC(this,arguments,void 0,function*(t,n=!1,i=!1){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:t});const s=this._getConfigForRequest(),a=this._createGeocodeRequest(s,t,n,i),o=this.options.localGeocoder?this.options.localGeocoder(t)||[]:[];try{const u=yield a;yield this._handleGeocodeResponse(u,s,t,n,o)}catch(u){this._handleGeocodeErrorResponse(u,o)}return a})}_createGeocodeRequest(e,t,n,i){return this.options.localGeocoderOnly?Promise.resolve({}):this.options.reverseGeocode&&spe.test(t)?this._createReverseGeocodeRequest(t,e):(e.query=t,this.geocoderApi.getSuggestions?n?this.geocoderApi.searchByPlaceId&&i?this.geocoderApi.searchByPlaceId(e):this.geocoderApi.forwardGeocode(e):this.geocoderApi.getSuggestions(e):this.geocoderApi.forwardGeocode(e))}_createReverseGeocodeRequest(e,t){const n=e.split(/[\s(,)?]+/).map(i=>parseFloat(i)).reverse();return t.query=n,t.limit=1,"proximity"in t&&delete t.proximity,this.geocoderApi.reverseGeocode(t)}_handleGeocodeResponse(e,t,n,i,s){return fC(this,void 0,void 0,function*(){this._loadingEl.style.display="none";let a={};e?a=e:a={type:"FeatureCollection",features:[]},a.config=t,this.fresh&&(this.fresh=!1),a.features=a.features?s.concat(a.features):s;const o=this.options.externalGeocoder?this.options.externalGeocoder(n,a.features,t)||Promise.resolve([]):Promise.resolve([]);try{const d=yield o;a.features=a.features?d.concat(a.features):d}catch{}this.options.filter&&a.features.length&&(a.features=a.features.filter(this.options.filter));let u=[];"suggestions"in a?u=a.suggestions:"place"in a?u=[a.place]:u=a.features,u.length?(this._clearEl.style.display="block",this._typeahead.update(u),(!this.options.showResultsWhileTyping||i)&&this.options.showResultMarkers&&(a.features.length>0||"place"in a)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",a)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",a))})}_handleGeocodeErrorResponse(e,t){this._loadingEl.style.display="none",t.length&&this.options.localGeocoder?(this._clearEl.style.display="block",this._typeahead.update(t)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:t}),this._eventEmitter.emit("error",{error:e})}_clear(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0}clear(e){this._clear(e),this._inputEl.focus()}_clearOnBlur(e){e.relatedTarget&&this._clear(e)}_onQueryResult(e){if(!("features"in e)||!e.features.length)return;const t=e.features[0];this._typeahead.selected=t,this._inputEl.value=t.place_name,this._onChange()}_updateProximity(){if(this._map)if(this._map.getZoom()>this.options.proximityMinZoom){const e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat})}else this.setProximity(null)}_collapse(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("maplibregl-ctrl-geocoder--collapsed")}_unCollapse(){this.container.classList.remove("maplibregl-ctrl-geocoder--collapsed")}query(e){return fC(this,void 0,void 0,function*(){const t=yield this._geocode(e);this._onQueryResult(t)})}_renderError(){const e=`<div class='maplibre-gl-geocoder--error'>${this._localize("errorConnectionFailed")}</div>`;this._renderMessage(e)}_renderNoResults(){const e=`<div class='maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>
        ${this._localize("errorNoResults")}</div>`;this._renderMessage(e)}_renderMessage(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)}_localize(e){const t=Zde.language(this.options.language.split(",")[0]);return this.options.language&&c_?.[e][t]?c_[e][t]:c_[e].en}_fitBoundsForMarkers(){if(this._typeahead.data.length<1)return;const e=this._typeahead.data.filter(t=>typeof t!="string").slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){const n=Zc({},{padding:100},this.options.flyTo),i=new this._maplibregl.LngLatBounds;for(const s of e)i.extend(s.geometry.coordinates);this._map.fitBounds(i,n)}return e.length>0&&this._maplibregl&&this._handleResultMarkers(e),this}setInput(e){return this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(e),this}setProximity(e){return this.options.proximity=e,this}getProximity(){return this.options.proximity}setRenderFunction(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this}getRenderFunction(){return this._typeahead.render}setLanguage(e){return this.options.language=e||this.options.language||navigator.language,this}getLanguage(){return this.options.language}getZoom(){return this.options.zoom}setZoom(e){return this.options.zoom=e,this}getFlyTo(){return this.options.flyTo}setFlyTo(e){return this.options.flyTo=e,this}getPlaceholder(){return this.options.placeholder}setPlaceholder(e){return this.placeholder=e||this.options.placeholder||this._localize("placeholder"),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this}getBbox(){return this.options.bbox}setBbox(e){return this.options.bbox=e,this}getCountries(){return this.options.countries}setCountries(e){return this.options.countries=e,this}getTypes(){return this.options.types}setTypes(e){return this.options.types=e,this}getMinLength(){return this.options.minLength}setMinLength(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this}getLimit(){return this.options.limit}setLimit(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this}getFilter(){return this.options.filter}setFilter(e){return this.options.filter=e,this}setGeocoderApi(e){return this.geocoderApi=e,this}getGeocoderApi(){return this.geocoderApi}_handleMarker(e){if(!this._map)return;this._removeMarker();const n=Zc({},{color:"#4668F2"},this.options.marker);this.mapMarker=new this._maplibregl.Marker(n);let i;if(this.options.popup){const a=Zc({},{},this.options.popup);i=new this._maplibregl.Popup(a).setHTML(this.options.popupRender(e))}return e.center?(this.mapMarker.setLngLat(e.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(i)):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(i)),this}_removeMarker(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)}_handleResultMarkers(e){if(!this._map)return;this._removeResultMarkers();let n=Zc({},{color:"#4668F2"},this.options.showResultMarkers);for(const i of e){let s;if(this.options.showResultMarkers){this.options.showResultMarkers&&this.options.showResultMarkers.element&&(s=this.options.showResultMarkers.element.cloneNode(!0),n=Zc(n,{element:s}));const a=new this._maplibregl.Marker(Zc({},n,{element:s}));let o;if(this.options.popup){const d=Zc({},{},this.options.popup);o=new this._maplibregl.Popup(d).setHTML(this.options.popupRender(i))}i.center?(a.setLngLat(i.center).addTo(this._map),this.options.popup&&a.setPopup(o)):i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(a.setLngLat(i.geometry.coordinates).addTo(this._map),this.options.popup&&a.setPopup(o)),this.resultMarkers.push(a)}}return this}_removeResultMarkers(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(e){e.remove()}),this.resultMarkers=[])}on(e,t){return this._eventEmitter.on(e,t),this}once(e){return new Promise(t=>{this._eventEmitter.once(e,t)})}off(e,t){return this._eventEmitter.removeListener(e,t),this}}const pd={defaultOptions:JSON.parse('{"limitsUrl":"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json","geocoder":{"peliasUrl1":"https://eines.icgc.cat/geocodificador/autocompletar?text=","peliasUrl2":"&layers=topo1%2Ctopo2%2Caddress&size=5"},"mapOptions":{"container":"map","center":{"0":1.537786,"1":41.837539},"zoom":7.5,"bearing":0,"pitch":0,"hash":false,"style":"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json.json","maxZoom":18,"maxPitch":85},"logoIcgcOptions":{"logoUrlColor":"https://eines.icgc.cat/recursos/logos/icgc_logo_color.png","logoUrlWhite":"https://eines.icgc.cat/recursos/logos/icgc_logo_blanc.svg","logoLink":"https://www.icgc.cat","logoTitle":"Institut Cartogràfic i Geològic de Catalunya","logoWidth":100,"logoOpacity":0.6},"logoGencatOptions":{"logoUrlColor":"https://eines.icgc.cat/recursos/logos/gencat_logo_color.png","logoUrlWhite":"https://eines.icgc.cat/recursos/logos/gencat_logo_blanc.png","logoLink":"https://web.gencat.cat/","logoTitle":"Generalitat de Catalunya","logoWidth":100,"logoOpacity":0.6},"map3dOptions":{"spaceErrorFactor":2,"exaggeration":1,"zfactor":48,"minZoomRange":15.5,"maxZoomRange":22,"urlTilesetCities":"https://geoserveis.icgc.cat/servei/catalunya/ciutats/3dtiles/v1/tilesetV1.0.json","layerIdOrder":"place-isolated","sourceLayerFilterId":"place","minZoomFilter":14,"layerId3d":"edificisMapboxLayer","terrainSource":"ICGC5M","style3dName":"orto3d","imageIcon":"https://eines.icgc.cat/recursos//images/stick.png"},"baseStyles":[{"key":"TOPO","url":"https://geoserveis.icgc.cat/styles/icgc_mapa_base_topografic.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},{"key":"ORTO","url":"https://geoserveis.icgc.cat/styles/icgc_orto_estandard.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_estandard.png"},{"key":"ORTO3D","url":"https://eines.icgc.cat/recursos//styles/icgc_orto_3d.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_estandard.png"},{"key":"ORTOHYBRID","url":"https://geoserveis.icgc.cat/styles/icgc_orto_hibrida.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{"key":"ADMIN","url":"https://geoserveis.icgc.cat/styles/icgc_limits_administratius_gris.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},{"key":"DARK","url":"https://geoserveis.icgc.cat/styles/icgc_mapa_base_fosc.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},{"key":"LIGHT","url":"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},{"key":"GEOLOGY","url":"https://geoserveis.icgc.cat/styles/icgc_geologic_informacio.json","image":"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"},{"key":"RASTER","substyles":{"TOPO":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_topo.jpg"},"ADMIN":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_administratiu.jpg"},"LIGHT":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic-gris/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_topo_gris.jpg"},"STANDARD":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/estandard/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_estandard_0.jpg"},"Simplified":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_simplificat.jpg"},"ORTO":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto.jpg"},"ORTOGREY":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-gris/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto_gris.jpg"},"ORTOHYBRID":{"url":"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-hibrida/MON3857NW/{z}/{x}/{y}.png","image":"https://icgc-web-pro.s3.eu-central-1.amazonaws.com/produccio/s3fs-public/2024-10/mapabase_orto_hibida.jpg"}}}],"urlTerrainICGC":[{"name":"ICGC5M","url":"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},{"name":"WORLD30M","url":"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png","encoding":"terrarium"}],"ortoLayersICGC":[{"name":"ortofotoColorProvisional","key":"ortofoto_color_provisional","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},{"name":"ortofotoColor2023","key":"ortofoto_color_2023","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2023"},{"name":"ortofotoColor2022","key":"ortofoto_color_2022","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},{"name":"ortofotoColor2021","key":"ortofoto_color_2021","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},{"name":"ortofotoColor2020","key":"ortofoto_color_2020","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},{"name":"ortofotoColor2019","key":"ortofoto_color_2019","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},{"name":"ortofotoColor2018","key":"ortofoto_color_2018","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},{"name":"ortofotoColor2017","key":"ortofoto_color_2017","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},{"name":"ortofotoColor2016","key":"ortofoto_color_2016","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},{"name":"ortofotoColor2015","key":"ortofoto_color_2015","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},{"name":"ortofotoColor2014","key":"ortofoto_color_2014","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},{"name":"ortofotoColor2013","key":"ortofoto_color_2013","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},{"name":"ortofotoColor2012","key":"ortofoto_color_2012","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},{"name":"ortofotoColor2011","key":"ortofoto_color_2011","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},{"name":"ortofotoColor2010","key":"ortofoto_color_2010","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},{"name":"ortofotoColor2009","key":"ortofoto_color_2009","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},{"name":"ortofotoColor2008","key":"ortofoto_color_2008","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},{"name":"ortofotoColor20062007","key":"ortofoto_color_2006-2007","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},{"name":"ortofotoColor20042005","key":"ortofoto_color_2004-2005","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},{"name":"ortofotoColor20002003","key":"ortofoto_color_2000-2003","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},{"name":"ortofotoBlancINegre1998","key":"ortofoto_blanc_i_negre_1998","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},{"name":"ortofotoBlancINegre19941997","key":"ortofoto_blanc_i_negre_1994-1997","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},{"name":"ortofotoColor1993","key":"ortofoto_color_1993","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},{"name":"ortofotoBlancINegre19831992","key":"ortofoto_blanc_i_negre_1983-1992","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},{"name":"ortofotoBlancINegre19701977","key":"ortofoto_blanc_i_negre_1970-1977","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},{"name":"ortofotoBlancINegre1956","key":"ortofoto_blanc_i_negre_1956","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},{"name":"ortofotoBlancINegre1945","key":"ortofoto_blanc_i_negre_1945","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},{"name":"ortofotoColorSerieAnual","key":"ortofoto_color_serie_anual","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},{"name":"ortofotoInfraroigProvisional","key":"ortofoto_infraroig_provisional","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},{"name":"ortofotoInfraroig2023","key":"ortofoto_infraroig_2023","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2023"},{"name":"ortofotoInfraroig2022","key":"ortofoto_infraroig_2022","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},{"name":"ortofotoInfraroig2021","key":"ortofoto_infraroig_2021","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},{"name":"ortofotoInfraroig2020","key":"ortofoto_infraroig_2020","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},{"name":"ortofotoInfraroig2019","key":"ortofoto_infraroig_2019","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},{"name":"ortofotoInfraroig2018","key":"ortofoto_infraroig_2018","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},{"name":"ortofotoInfraroig2017","key":"ortofoto_infraroig_2017","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},{"name":"ortofotoInfraroig2016","key":"ortofoto_infraroig_2016","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},{"name":"ortofotoInfraroig2015","key":"ortofoto_infraroig_2015","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},{"name":"ortofotoInfraroig2014","key":"ortofoto_infraroig_2014","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},{"name":"ortofotoInfraroig2013","key":"ortofoto_infraroig_2013","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},{"name":"ortofotoInfraroig2012","key":"ortofoto_infraroig_2012","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},{"name":"ortofotoInfraroig2011","key":"ortofoto_infraroig_2011","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},{"name":"ortofotoInfraroig2010","key":"ortofoto_infraroig_2010","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},{"name":"ortofotoInfraroig2009","key":"ortofoto_infraroig_2009","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},{"name":"ortofotoInfraroig2008","key":"ortofoto_infraroig_2008","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},{"name":"ortofotoInfraroig20062007","key":"ortofoto_infraroig_2006-2007","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},{"name":"ortofotoInfraroig19961997","key":"ortofoto_infraroig_1996-1997","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},{"name":"ortofotoInfraroigSerieAnual","key":"ortofoto_infraroig_serie_anual","url":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}],"vectorLayersICGC":[{"name":"agrupacionsCensals2015","key":"agrupacions_censals_2015"},{"name":"agrupacionsCensals2016","key":"agrupacions_censals_2016"},{"name":"agrupacionsCensals2017","key":"agrupacions_censals_2017"},{"name":"agrupacionsCensals2018","key":"agrupacions_censals_2018"},{"name":"agrupacionsCensals2019","key":"agrupacions_censals_2019"},{"name":"agrupacionsCensals2020","key":"agrupacions_censals_2020"},{"name":"agrupacionsCensals2021","key":"agrupacions_censals_2021"},{"name":"agrupacionsCensalsVigent","key":"agrupacions_censals_vigent"},{"name":"agrupacionsCensalsVigentText","key":"agrupacions_censals_vigent_text"},{"name":"areesBasiquesPolicials2019","key":"arees_basiques_policials_2019"},{"name":"areesBasiquesPolicials2020","key":"arees_basiques_policials_2020"},{"name":"areesBasiquesPolicials2022","key":"arees_basiques_policials_2022"},{"name":"areesBasiquesPolicialsVigent","key":"arees_basiques_policials_vigent"},{"name":"areesBasiquesPolicialsVigentText","key":"arees_basiques_policials_vigent_text"},{"name":"areesBasiquesSalutVigent","key":"arees_basiques_salut_vigent"},{"name":"areesBasiquesServeisSocialsVigent","key":"arees_basiques_serveis_socials_vigent"},{"name":"areesBasiquesServeisSocialsVigentText","key":"arees_basiques_serveis_socials_vigent_text"},{"name":"areesGestioAssistencialVigent","key":"arees_gestio_assistencial_vigent"},{"name":"areesHidrogeologiquesAquifersVigent","key":"arees_hidrogeologiques_aquifers_vigent"},{"name":"catalunyaVigent","key":"catalunya_vigent"},{"name":"catalunyaVigentText","key":"catalunya_vigent_text"},{"name":"comarques2022","key":"comarques_2022"},{"name":"comarquesVigent","key":"comarques_vigent"},{"name":"comarquesVigentText","key":"comarques_vigent_text"},{"name":"districtesCensals2015","key":"districtes_censals_2015"},{"name":"districtesCensals2016","key":"districtes_censals_2016"},{"name":"districtesCensals2017","key":"districtes_censals_2017"},{"name":"districtesCensals2018","key":"districtes_censals_2018"},{"name":"districtesCensals2019","key":"districtes_censals_2019"},{"name":"districtesCensals2020","key":"districtes_censals_2020"},{"name":"districtesCensals2021","key":"districtes_censals_2021"},{"name":"districtesCensals2022","key":"districtes_censals_2022"},{"name":"districtesCensals2023","key":"districtes_censals_2023"},{"name":"districtesCensalsVigent","key":"districtes_censals_vigent"},{"name":"districtesCensalsVigentText","key":"districtes_censals_vigent_text"},{"name":"incendisForestalsVigent","key":"incendis_forestals_vigent"},{"name":"incendisForestalsVigentText","key":"incendis_forestals_vigent_text"},{"name":"municipis2022","key":"municipis_2022"},{"name":"municipis2022Text","key":"municipis_2022_text"},{"name":"municipisVigent","key":"municipis_vigent"},{"name":"municipisVigentText","key":"municipis_vigent_text"},{"name":"partitsJudicialsVigent","key":"partits_judicials_vigent"},{"name":"partitsJudicialsVigentText","key":"partits_judicials_vigent_text"},{"name":"plaTerritorial2015","key":"pla_territorial_2015"},{"name":"plaTerritorialVigent","key":"pla_territorial_vigent"},{"name":"plaTerritorialVigentText","key":"pla_territorial_vigent_text"},{"name":"provinciesVigent","key":"provincies_vigent"},{"name":"provinciesVigentText","key":"provincies_vigent_text"},{"name":"regionsPolicialsVigent","key":"regions_policials_vigent"},{"name":"regionsPolicialsVigentText","key":"regions_policials_vigent_text"},{"name":"regionsSanitariesVigent","key":"regions_sanitaries_vigent"},{"name":"regionsSanitariesVigentText","key":"regions_sanitaries_vigent_text"},{"name":"seccionsCensals2015","key":"seccions_censals_2015"},{"name":"seccionsCensals2016","key":"seccions_censals_2016"},{"name":"seccionsCensals2017","key":"seccions_censals_2017"},{"name":"seccionsCensals2018","key":"seccions_censals_2018"},{"name":"seccionsCensals2019","key":"seccions_censals_2019"},{"name":"seccionsCensals2020","key":"seccions_censals_2020"},{"name":"seccionsCensals2021","key":"seccions_censals_2021"},{"name":"seccionsCensals2022","key":"seccions_censals_2022"},{"name":"seccionsCensals2023","key":"seccions_censals_2023"},{"name":"seccionsCensalsVigent","key":"seccions_censals_vigent"},{"name":"seccionsCensalsVigentText","key":"seccions_censals_vigent_text"},{"name":"sectorsSanitarisVigent","key":"sectors_sanitaris_vigent"},{"name":"vegueriesVigent","key":"vegueries_vigent"},{"name":"vegueriesVigentText","key":"vegueries_vigent_text"}],"vectorLayers":[{"key":"cobertes2018","url":"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json","legend":"https://eines.icgc.cat/recursos//images/llegendaCobertesSol2018.jpg"}],"wmsLayers":[{"key":"espaisInteresGeologic","layer":"","url":"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{"key":"gravimetriaBouguer500000","layer":"","url":"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{"key":"cobertesSol2018","layer":"","url":"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{"key":"administratiu","layer":"","url":"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},{"key":"simplificat","layer":"","url":"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},{"key":"cims","layer":"","url":"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},{"key":"cobertesSol","layer":"","url":"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}],"fgbLayers":[{"name":"agrupacionsCensalsVigent","key":"agrupacions_censals_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},{"name":"agrupacionsCensalsVigentText","key":"agrupacions_censals_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},{"name":"areesBasiquesPolicialsVigent","key":"arees_basiques_policials_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},{"name":"areesBasiquesPolicialsVigentText","key":"arees_basiques_policials_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},{"name":"areesBasiquesSalutVigent","key":"arees_basiques_salut_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},{"name":"areesBasiquesServeisSocialsVigent","key":"arees_basiques_serveis_socials_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},{"name":"areesBasiquesServeisSocialsVigentText","key":"arees_basiques_serveis_socials_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},{"name":"areesGestioAssistencialVigent","key":"arees_gestio_assistencial_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},{"name":"areesHidrogeologiquesAquifersVigent","key":"arees_hidrogeologiques_aquifers_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},{"name":"catalunyaVigent","key":"catalunya_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},{"name":"catalunyaVigentText","key":"catalunya_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},{"name":"comarquesVigent","key":"comarques_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},{"name":"comarquesVigentText","key":"comarques_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},{"name":"districtesCensalsVigent","key":"districtes_censals_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},{"name":"districtesCensalsVigentText","key":"districtes_censals_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},{"name":"incendisForestalsVigent","key":"incendis_forestals_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},{"name":"incendisForestalsVigentText","key":"incendis_forestals_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},{"name":"municipisVigent","key":"municipis_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},{"name":"municipisVigentText","key":"municipis_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},{"name":"partitsJudicialsVigent","key":"partits_judicials_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},{"name":"partitsJudicialsVigentText","key":"partits_judicials_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},{"name":"plaTerritorialVigent","key":"pla_territorial_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},{"name":"plaTerritorialVigentText","key":"pla_territorial_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},{"name":"provinciesVigent","key":"provincies_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},{"name":"provinciesVigentText","key":"provincies_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},{"name":"regionsPolicialsVigent","key":"regions_policials_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},{"name":"regionsPolicialsVigentText","key":"regions_policials_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},{"name":"regionsSanitariesVigent","key":"regions_sanitaries_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},{"name":"regionsSanitariesVigentText","key":"regions_sanitaries_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},{"name":"seccionsCensalsVigent","key":"seccions_censals_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},{"name":"seccionsCensalsVigentText","key":"seccions_censals_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},{"name":"sectorsSanitarisVigent","key":"sectors_sanitaris_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},{"name":"vegueriesVigent","key":"vegueries_vigent","url":"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},{"name":"vegueriesVigentText","key":"vegueries_vigent_text","url":"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}]}'),Styles:{TOPO:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_topografic.json",ORTO:"https://geoserveis.icgc.cat/styles/icgc_orto_estandard.json",ORTO3D:"https://eines.icgc.cat/recursos//styles/icgc_orto_3d.json",ORTOHYBRID:"https://geoserveis.icgc.cat/styles/icgc_orto_hibrida.json",ADMIN:"https://geoserveis.icgc.cat/styles/icgc_limits_administratius_gris.json",DARK:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/styles/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/styles/icgc_geologic_informacio.json",RASTER:{TOPO:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic/MON3857NW/{z}/{x}/{y}.png",ADMIN:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",LIGHT:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/topografic-gris/MON3857NW/{z}/{x}/{y}.png",STANDARD:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/estandard/MON3857NW/{z}/{x}/{y}.png",SIMPLIFIED:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",ORTO:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto/MON3857NW/{z}/{x}/{y}.png",ORTOGREY:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-gris/MON3857NW/{z}/{x}/{y}.png",ORTOHYBRID:"https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/orto-hibrida/MON3857NW/{z}/{x}/{y}.png"}},Terrains:{ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},Layers:JSON.parse('{"Orto":{"ortofotoColorProvisional":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional","ortofotoColor2023":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2023","ortofotoColor2022":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022","ortofotoColor2021":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021","ortofotoColor2020":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020","ortofotoColor2019":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019","ortofotoColor2018":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018","ortofotoColor2017":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017","ortofotoColor2016":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016","ortofotoColor2015":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015","ortofotoColor2014":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014","ortofotoColor2013":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013","ortofotoColor2012":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012","ortofotoColor2011":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011","ortofotoColor2010":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010","ortofotoColor2009":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009","ortofotoColor2008":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008","ortofotoColor20062007":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007","ortofotoColor20042005":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005","ortofotoColor20002003":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003","ortofotoBlancINegre1998":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998","ortofotoBlancINegre19941997":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997","ortofotoColor1993":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993","ortofotoBlancINegre19831992":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992","ortofotoBlancINegre19701977":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977","ortofotoBlancINegre1956":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956","ortofotoBlancINegre1945":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945","ortofotoColorSerieAnual":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual","ortofotoInfraroigProvisional":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional","ortofotoInfraroig2023":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2023","ortofotoInfraroig2022":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022","ortofotoInfraroig2021":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021","ortofotoInfraroig2020":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020","ortofotoInfraroig2019":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019","ortofotoInfraroig2018":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018","ortofotoInfraroig2017":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017","ortofotoInfraroig2016":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016","ortofotoInfraroig2015":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015","ortofotoInfraroig2014":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014","ortofotoInfraroig2013":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013","ortofotoInfraroig2012":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012","ortofotoInfraroig2011":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011","ortofotoInfraroig2010":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010","ortofotoInfraroig2009":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009","ortofotoInfraroig2008":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008","ortofotoInfraroig20062007":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007","ortofotoInfraroig19961997":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997","ortofotoInfraroigSerieAnual":"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},"VectorAdmin":{"agrupacionsCensals2015":"agrupacions_censals_2015","agrupacionsCensals2016":"agrupacions_censals_2016","agrupacionsCensals2017":"agrupacions_censals_2017","agrupacionsCensals2018":"agrupacions_censals_2018","agrupacionsCensals2019":"agrupacions_censals_2019","agrupacionsCensals2020":"agrupacions_censals_2020","agrupacionsCensals2021":"agrupacions_censals_2021","agrupacionsCensalsVigent":"agrupacions_censals_vigent","agrupacionsCensalsVigentText":"agrupacions_censals_vigent_text","areesBasiquesPolicials2019":"arees_basiques_policials_2019","areesBasiquesPolicials2020":"arees_basiques_policials_2020","areesBasiquesPolicials2022":"arees_basiques_policials_2022","areesBasiquesPolicialsVigent":"arees_basiques_policials_vigent","areesBasiquesPolicialsVigentText":"arees_basiques_policials_vigent_text","areesBasiquesSalutVigent":"arees_basiques_salut_vigent","areesBasiquesServeisSocialsVigent":"arees_basiques_serveis_socials_vigent","areesBasiquesServeisSocialsVigentText":"arees_basiques_serveis_socials_vigent_text","areesGestioAssistencialVigent":"arees_gestio_assistencial_vigent","areesHidrogeologiquesAquifersVigent":"arees_hidrogeologiques_aquifers_vigent","catalunyaVigent":"catalunya_vigent","catalunyaVigentText":"catalunya_vigent_text","comarques2022":"comarques_2022","comarquesVigent":"comarques_vigent","comarquesVigentText":"comarques_vigent_text","districtesCensals2015":"districtes_censals_2015","districtesCensals2016":"districtes_censals_2016","districtesCensals2017":"districtes_censals_2017","districtesCensals2018":"districtes_censals_2018","districtesCensals2019":"districtes_censals_2019","districtesCensals2020":"districtes_censals_2020","districtesCensals2021":"districtes_censals_2021","districtesCensals2022":"districtes_censals_2022","districtesCensals2023":"districtes_censals_2023","districtesCensalsVigent":"districtes_censals_vigent","districtesCensalsVigentText":"districtes_censals_vigent_text","incendisForestalsVigent":"incendis_forestals_vigent","incendisForestalsVigentText":"incendis_forestals_vigent_text","municipis2022":"municipis_2022","municipis2022Text":"municipis_2022_text","municipisVigent":"municipis_vigent","municipisVigentText":"municipis_vigent_text","partitsJudicialsVigent":"partits_judicials_vigent","partitsJudicialsVigentText":"partits_judicials_vigent_text","plaTerritorial2015":"pla_territorial_2015","plaTerritorialVigent":"pla_territorial_vigent","plaTerritorialVigentText":"pla_territorial_vigent_text","provinciesVigent":"provincies_vigent","provinciesVigentText":"provincies_vigent_text","regionsPolicialsVigent":"regions_policials_vigent","regionsPolicialsVigentText":"regions_policials_vigent_text","regionsSanitariesVigent":"regions_sanitaries_vigent","regionsSanitariesVigentText":"regions_sanitaries_vigent_text","seccionsCensals2015":"seccions_censals_2015","seccionsCensals2016":"seccions_censals_2016","seccionsCensals2017":"seccions_censals_2017","seccionsCensals2018":"seccions_censals_2018","seccionsCensals2019":"seccions_censals_2019","seccionsCensals2020":"seccions_censals_2020","seccionsCensals2021":"seccions_censals_2021","seccionsCensals2022":"seccions_censals_2022","seccionsCensals2023":"seccions_censals_2023","seccionsCensalsVigent":"seccions_censals_vigent","seccionsCensalsVigentText":"seccions_censals_vigent_text","sectorsSanitarisVigent":"sectors_sanitaris_vigent","vegueriesVigent":"vegueries_vigent","vegueriesVigentText":"vegueries_vigent_text"},"FGBAdmin":{"agrupacionsCensalsVigent":"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb","agrupacionsCensalsVigentText":"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb","areesBasiquesPolicialsVigent":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb","areesBasiquesPolicialsVigentText":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb","areesBasiquesSalutVigent":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb","areesBasiquesServeisSocialsVigent":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb","areesBasiquesServeisSocialsVigentText":"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb","areesGestioAssistencialVigent":"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb","areesHidrogeologiquesAquifersVigent":"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb","catalunyaVigent":"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb","catalunyaVigentText":"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb","comarquesVigent":"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb","comarquesVigentText":"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb","districtesCensalsVigent":"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb","districtesCensalsVigentText":"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb","incendisForestalsVigent":"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb","incendisForestalsVigentText":"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb","municipisVigent":"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb","municipisVigentText":"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb","partitsJudicialsVigent":"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb","partitsJudicialsVigentText":"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb","plaTerritorialVigent":"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb","plaTerritorialVigentText":"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb","provinciesVigent":"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb","provinciesVigentText":"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb","regionsPolicialsVigent":"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb","regionsPolicialsVigentText":"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb","regionsSanitariesVigent":"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb","regionsSanitariesVigentText":"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb","seccionsCensalsVigent":"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb","seccionsCensalsVigentText":"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb","sectorsSanitarisVigent":"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb","vegueriesVigent":"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb","vegueriesVigentText":"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},"Vector":{"cobertes2018":"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"},"WMS":{"espaisInteresGeologic":"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}","gravimetriaBouguer500000":"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}","cobertesSol2018":"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}","administratiu":"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png","simplificat":"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png","cims":"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455","cobertesSol":"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}}')};class ape{constructor(e){this.options=e||{}}onAdd(e){let t=pd.defaultOptions;return this._map=e,this._img1=document.createElement("img"),this._img1.className="maplibregl-ctrl",this._img1.src=this.options.color?t.logoIcgcOptions.logoUrlColor:t.logoIcgcOptions.logoUrlWhite,this._img1.width=t.logoIcgcOptions.logoWidth,this._img1.title=t.logoIcgcOptions.logoTitle,this._img1.style.opacity=t.logoIcgcOptions.logoOpacity,this.link1=document.createElement("a"),this.link1.href=t.logoIcgcOptions.logoLink,this.link1.target="_blank",this.link1.appendChild(this._img1),this._container1=document.createElement("div"),this._container1.className="maplibregl-ctrl",this._container1.style.width=`${t.logoIcgcOptions.logoWidth}px`,this._container1.appendChild(this.link1),this._img2=document.createElement("img"),this._img2.className="maplibregl-ctrl",this._img2.src=this.options.color?t.logoGencatOptions.logoUrlColor:t.logoGencatOptions.logoUrlWhite,this._img2.width=t.logoGencatOptions.logoWidth,this._img2.title=t.logoGencatOptions.logoTitle,this._img2.style.opacity=t.logoGencatOptions.logoOpacity,this.link2=document.createElement("a"),this.link2.href=t.logoGencatOptions.logoLink,this.link2.target="_blank",this.link2.appendChild(this._img2),this._container2=document.createElement("div"),this._container2.className="maplibregl-ctrl",this._container2.style.width=`${t.logoGencatOptions.logoWidth}px`,this._container2.appendChild(this.link2),this._mainContainer=document.createElement("div"),this._mainContainer.className="divLogos",this._mainContainer.style="display: flex",this._mainContainer.appendChild(this._container1),this._mainContainer.appendChild(this._container2),this._mainContainer}}class lpe{constructor(e){this.options=e||{}}onAdd(e){this._map=e,this._img1=document.createElement("img"),this._img1.src=this.options.url,this._img1.width=150,this._img1.title=300,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const t=document.createElement("label");return t.classList.add("maplibregl-legend-title-label"),t.textContent=this.options.idLayer||"Llegenda",this.legendContainer.appendChild(t),this.legendContainer.appendChild(document.createElement("br")),this.legendContainer.appendChild(this._img1),this.controlContainer}}var bC,CD;function cpe(){if(CD)return bC;CD=1;var r=t.prototype,e="WGS 84";function t(i){i!==void 0&&(e=i),this.setEllipsoid(e)}r.convertLatLngToUtm=function(i,s,a){var o;if(this.status)return"No ecclipsoid data associated with unknown datum: "+e;if(!Number.isInteger(a))return"Precision is not integer number.";i=parseFloat(i),s=parseFloat(s);var u=s,d=this.toRadians(i),p=this.toRadians(u);u>=8&&u<=13&&i>54.5&&i<58||i>=56&&i<64&&u>=3&&u<12?o=32:(o=(u+180)/6+1,i>=72&&i<84&&(u>=0&&u<9?o=31:u>=9&&u<21?o=33:u>=21&&u<33?o=35:u>=33&&u<42&&(o=37))),o=parseInt(o);var b=(o-1)*6-180+3,C=this.toRadians(b),w=this.getUtmLetterDesignator(i),M=this.eccSquared/(1-this.eccSquared),P=this.a/Math.sqrt(1-this.eccSquared*Math.sin(d)*Math.sin(d)),k=Math.tan(d)*Math.tan(d),D=M*Math.cos(d)*Math.cos(d),j=Math.cos(d)*(p-C),H=this.a*((1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)*d-(3*this.eccSquared/8+3*this.eccSquared*this.eccSquared/32+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(2*d)+(15*this.eccSquared*this.eccSquared/256+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(4*d)-35*this.eccSquared*this.eccSquared*this.eccSquared/3072*Math.sin(6*d)),N=parseFloat(.9996*P*(j+(1-k+D)*j*j*j/6+(5-18*k+k*k+72*D-58*M)*j*j*j*j*j/120)+5e5),q=parseFloat(.9996*(H+P*Math.tan(d)*(j*j/2+(5-k+9*D+4*D*D)*j*j*j*j/24+(61-58*k+k*k+600*D-330*M)*j*j*j*j*j*j/720)));return i<0&&(q+=1e7),q=n(q,a),N=n(N,a),{Easting:N,Northing:q,ZoneNumber:parseInt(o),ZoneLetter:w}},r.convertUtmToLatLng=function(i,s,a,o){var u=(1-Math.sqrt(1-this.eccSquared))/(1+Math.sqrt(1-this.eccSquared)),d=i-5e5,p=s,b=a,C=o;if(i===void 0)return"Please pass the UTMEasting!";if(s===void 0)return"Please pass the UTMNorthing!";if(a===void 0)return"Please pass the UTMZoneNumber!";if(o===void 0)return"Please pass the UTMZoneLetter!";["N","P","Q","R","S","T","U","V","W","X","Y","Z"].indexOf(C)!==-1||(p-=1e7);var w=(b-1)*6-180+3,M=this.eccSquared/(1-this.eccSquared),P=p/.9996,k=P/(this.a*(1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)),D=k+(3*u/2-27*u*u*u/32)*Math.sin(2*k)+(21*u*u/16-55*u*u*u*u/32)*Math.sin(4*k)+151*u*u*u/96*Math.sin(6*k);this.toDegrees(D);var j=this.a/Math.sqrt(1-this.eccSquared*Math.sin(D)*Math.sin(D)),H=Math.tan(D)*Math.tan(D),N=M*Math.cos(D)*Math.cos(D),q=this.a*(1-this.eccSquared)/Math.pow(1-this.eccSquared*Math.sin(D)*Math.sin(D),1.5),W=d/(j*.9996),ie=D-j*Math.tan(D)/q*(W*W/2-(5+3*H+10*N-4*N*N-9*M)*W*W*W*W/24+(61+90*H+298*N+45*H*H-252*M-3*N*N)*W*W*W*W*W*W/720);ie=this.toDegrees(ie);var se=(W-(1+2*H+N)*W*W*W/6+(5-2*N+28*H-3*N*N+8*M+24*H*H)*W*W*W*W*W/120)/Math.cos(D);return se=w+this.toDegrees(se),{lat:ie,lng:se}},r.getUtmLetterDesignator=function(i){return i=parseFloat(i),84>=i&&i>=72?"X":72>i&&i>=64?"W":64>i&&i>=56?"V":56>i&&i>=48?"U":48>i&&i>=40?"T":40>i&&i>=32?"S":32>i&&i>=24?"R":24>i&&i>=16?"Q":16>i&&i>=8?"P":8>i&&i>=0?"N":0>i&&i>=-8?"M":-8>i&&i>=-16?"L":-16>i&&i>=-24?"K":-24>i&&i>=-32?"J":-32>i&&i>=-40?"H":-40>i&&i>=-48?"G":-48>i&&i>=-56?"F":-56>i&&i>=-64?"E":-64>i&&i>=-72?"D":-72>i&&i>=-80?"C":"Z"},r.setEllipsoid=function(i){switch(i){case"Airy":this.a=6377563,this.eccSquared=.00667054;break;case"Australian National":this.a=6378160,this.eccSquared=.006694542;break;case"Bessel 1841":this.a=6377397,this.eccSquared=.006674372;break;case"Bessel 1841 Nambia":this.a=6377484,this.eccSquared=.006674372;break;case"Clarke 1866":this.a=6378206,this.eccSquared=.006768658;break;case"Clarke 1880":this.a=6378249,this.eccSquared=.006803511;break;case"Everest":this.a=6377276,this.eccSquared=.006637847;break;case"Fischer 1960 Mercury":this.a=6378166,this.eccSquared=.006693422;break;case"Fischer 1968":this.a=6378150,this.eccSquared=.006693422;break;case"GRS 1967":this.a=6378160,this.eccSquared=.006694605;break;case"GRS 1980":this.a=6378137,this.eccSquared=.00669438;break;case"Helmert 1906":this.a=6378200,this.eccSquared=.006693422;break;case"Hough":this.a=6378270,this.eccSquared=.00672267;break;case"International":this.a=6378388,this.eccSquared=.00672267;break;case"Krassovsky":this.a=6378245,this.eccSquared=.006693422;break;case"Modified Airy":this.a=6377340,this.eccSquared=.00667054;break;case"Modified Everest":this.a=6377304,this.eccSquared=.006637847;break;case"Modified Fischer 1960":this.a=6378155,this.eccSquared=.006693422;break;case"South American 1969":this.a=6378160,this.eccSquared=.006694542;break;case"WGS 60":this.a=6378165,this.eccSquared=.006693422;break;case"WGS 66":this.a=6378145,this.eccSquared=.006694542;break;case"WGS 72":this.a=6378135,this.eccSquared=.006694318;break;case"ED50":this.a=6378388,this.eccSquared=.00672267;break;case"WGS 84":case"EUREF89":case"ETRS89":this.a=6378137,this.eccSquared=.00669438;break;default:this.status=!0}},r.toDegrees=function(i){return i/Math.PI*180},r.toRadians=function(i){return i*Math.PI/180};function n(i,s){var a=Math.pow(10,s);return Math.round(i*a)/a}return bC=t,bC}var upe=cpe();const hpe=Sf(upe);class Ape{constructor(e){this.options=e||{},this.options.utm=this.options.hasOwnProperty("utm")?this.options.utm:!0,this.options.lonlat=this.options.hasOwnProperty("lonlat")?this.options.lonlat:!0}onAdd(e){const t=new hpe;return this._map=e,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl coordControl",this._container.style.width=`${this.options.width||"225px"}`,this._map.on("mousemove",n=>{const i=n.lngLat.lat,s=n.lngLat.lng;let a="",o="";const u=t.convertLatLngToUtm(i,s,2),d=i>0?"N":"S";this.options.utm&&(a=`ETRS89 UTM ${u.ZoneNumber}${d} X:<b> ${u.Easting}</b> Y:<b> ${u.Northing}</b> <br>`),this.options.lonlat&&(o=`WGS 84 Lon:<b> ${s.toFixed(5)}</b>  Lat:<b> ${i.toFixed(5)}</b>`);const p=`${a}${o}`;this._container.innerHTML=p}),this._container}_lookUTM31(e,t){var n=0,i=0,s=6,a=84;return e>=n&&e<=s&&t>=i&&t<=a}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function TD(r,e){return function(){return r.apply(e,arguments)}}const{toString:fpe}=Object.prototype,{getPrototypeOf:vC}=Object,{iterator:Ob,toStringTag:ED}=Symbol,Ub=(r=>e=>{const t=fpe.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Jc=r=>(r=r.toLowerCase(),e=>Ub(e)===r),Db=r=>e=>typeof e===r,{isArray:og}=Array,ag=Db("undefined");function u_(r){return r!==null&&!ag(r)&&r.constructor!==null&&!ag(r.constructor)&&rl(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const SD=Jc("ArrayBuffer");function dpe(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&SD(r.buffer),e}const ppe=Db("string"),rl=Db("function"),ID=Db("number"),h_=r=>r!==null&&typeof r=="object",gpe=r=>r===!0||r===!1,kb=r=>{if(Ub(r)!=="object")return!1;const e=vC(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(ED in r)&&!(Ob in r)},mpe=r=>{if(!h_(r)||u_(r))return!1;try{return Object.keys(r).length===0&&Object.getPrototypeOf(r)===Object.prototype}catch{return!1}},_pe=Jc("Date"),ype=Jc("File"),bpe=Jc("Blob"),vpe=Jc("FileList"),wpe=r=>h_(r)&&rl(r.pipe),xpe=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||rl(r.append)&&((e=Ub(r))==="formdata"||e==="object"&&rl(r.toString)&&r.toString()==="[object FormData]"))},Bpe=Jc("URLSearchParams"),[Cpe,Tpe,Epe,Spe]=["ReadableStream","Request","Response","Headers"].map(Jc),Ipe=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function A_(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r>"u")return;let n,i;if(typeof r!="object"&&(r=[r]),og(r))for(n=0,i=r.length;n<i;n++)e.call(null,r[n],n,r);else{if(u_(r))return;const s=t?Object.getOwnPropertyNames(r):Object.keys(r),a=s.length;let o;for(n=0;n<a;n++)o=s[n],e.call(null,r[o],o,r)}}function PD(r,e){if(u_(r))return null;e=e.toLowerCase();const t=Object.keys(r);let n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}const gd=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,MD=r=>!ag(r)&&r!==gd;function wC(){const{caseless:r,skipUndefined:e}=MD(this)&&this||{},t={},n=(i,s)=>{const a=r&&PD(t,s)||s;kb(t[a])&&kb(i)?t[a]=wC(t[a],i):kb(i)?t[a]=wC({},i):og(i)?t[a]=i.slice():(!e||!ag(i))&&(t[a]=i)};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&A_(arguments[i],n);return t}const Ppe=(r,e,t,{allOwnKeys:n}={})=>(A_(e,(i,s)=>{t&&rl(i)?r[s]=TD(i,t):r[s]=i},{allOwnKeys:n}),r),Mpe=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),Fpe=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},Rpe=(r,e,t,n)=>{let i,s,a;const o={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)a=i[s],(!n||n(a,r,e))&&!o[a]&&(e[a]=r[a],o[a]=!0);r=t!==!1&&vC(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},Lpe=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const n=r.indexOf(e,t);return n!==-1&&n===t},Ope=r=>{if(!r)return null;if(og(r))return r;let e=r.length;if(!ID(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},Upe=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&vC(Uint8Array)),Dpe=(r,e)=>{const n=(r&&r[Ob]).call(r);let i;for(;(i=n.next())&&!i.done;){const s=i.value;e.call(r,s[0],s[1])}},kpe=(r,e)=>{let t;const n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},Npe=Jc("HTMLFormElement"),zpe=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),FD=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),Qpe=Jc("RegExp"),RD=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),n={};A_(t,(i,s)=>{let a;(a=e(i,s,r))!==!1&&(n[s]=a||i)}),Object.defineProperties(r,n)},Hpe=r=>{RD(r,(e,t)=>{if(rl(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=r[t];if(rl(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Vpe=(r,e)=>{const t={},n=i=>{i.forEach(s=>{t[s]=!0})};return og(r)?n(r):n(String(r).split(e)),t},jpe=()=>{},$pe=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e;function Gpe(r){return!!(r&&rl(r.append)&&r[ED]==="FormData"&&r[Ob])}const Wpe=r=>{const e=new Array(10),t=(n,i)=>{if(h_(n)){if(e.indexOf(n)>=0)return;if(u_(n))return n;if(!("toJSON"in n)){e[i]=n;const s=og(n)?[]:{};return A_(n,(a,o)=>{const u=t(a,i+1);!ag(u)&&(s[o]=u)}),e[i]=void 0,s}}return n};return t(r,0)},qpe=Jc("AsyncFunction"),Kpe=r=>r&&(h_(r)||rl(r))&&rl(r.then)&&rl(r.catch),LD=((r,e)=>r?setImmediate:e?((t,n)=>(gd.addEventListener("message",({source:i,data:s})=>{i===gd&&s===t&&n.length&&n.shift()()},!1),i=>{n.push(i),gd.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",rl(gd.postMessage)),Xpe=typeof queueMicrotask<"u"?queueMicrotask.bind(gd):typeof process<"u"&&process.nextTick||LD,Ut={isArray:og,isArrayBuffer:SD,isBuffer:u_,isFormData:xpe,isArrayBufferView:dpe,isString:ppe,isNumber:ID,isBoolean:gpe,isObject:h_,isPlainObject:kb,isEmptyObject:mpe,isReadableStream:Cpe,isRequest:Tpe,isResponse:Epe,isHeaders:Spe,isUndefined:ag,isDate:_pe,isFile:ype,isBlob:bpe,isRegExp:Qpe,isFunction:rl,isStream:wpe,isURLSearchParams:Bpe,isTypedArray:Upe,isFileList:vpe,forEach:A_,merge:wC,extend:Ppe,trim:Ipe,stripBOM:Mpe,inherits:Fpe,toFlatObject:Rpe,kindOf:Ub,kindOfTest:Jc,endsWith:Lpe,toArray:Ope,forEachEntry:Dpe,matchAll:kpe,isHTMLForm:Npe,hasOwnProperty:FD,hasOwnProp:FD,reduceDescriptors:RD,freezeMethods:Hpe,toObjectSet:Vpe,toCamelCase:zpe,noop:jpe,toFiniteNumber:$pe,findKey:PD,global:gd,isContextDefined:MD,isSpecCompliantForm:Gpe,toJSONObject:Wpe,isAsyncFn:qpe,isThenable:Kpe,setImmediate:LD,asap:Xpe,isIterable:r=>r!=null&&rl(r[Ob])};function In(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}Ut.inherits(In,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ut.toJSONObject(this.config),code:this.code,status:this.status}}});const OD=In.prototype,UD={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{UD[r]={value:r}}),Object.defineProperties(In,UD),Object.defineProperty(OD,"isAxiosError",{value:!0}),In.from=(r,e,t,n,i,s)=>{const a=Object.create(OD);Ut.toFlatObject(r,a,function(p){return p!==Error.prototype},d=>d!=="isAxiosError");const o=r&&r.message?r.message:"Error",u=e==null&&r?r.code:e;return In.call(a,o,u,t,n,i),r&&a.cause==null&&Object.defineProperty(a,"cause",{value:r,configurable:!0}),a.name=r&&r.name||"Error",s&&Object.assign(a,s),a};const Ype=null;function xC(r){return Ut.isPlainObject(r)||Ut.isArray(r)}function DD(r){return Ut.endsWith(r,"[]")?r.slice(0,-2):r}function kD(r,e,t){return r?r.concat(e).map(function(i,s){return i=DD(i),!t&&s?"["+i+"]":i}).join(t?".":""):e}function Zpe(r){return Ut.isArray(r)&&!r.some(xC)}const Jpe=Ut.toFlatObject(Ut,{},null,function(e){return/^is[A-Z]/.test(e)});function Nb(r,e,t){if(!Ut.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=Ut.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,k){return!Ut.isUndefined(k[P])});const n=t.metaTokens,i=t.visitor||p,s=t.dots,a=t.indexes,u=(t.Blob||typeof Blob<"u"&&Blob)&&Ut.isSpecCompliantForm(e);if(!Ut.isFunction(i))throw new TypeError("visitor must be a function");function d(M){if(M===null)return"";if(Ut.isDate(M))return M.toISOString();if(Ut.isBoolean(M))return M.toString();if(!u&&Ut.isBlob(M))throw new In("Blob is not supported. Use a Buffer instead.");return Ut.isArrayBuffer(M)||Ut.isTypedArray(M)?u&&typeof Blob=="function"?new Blob([M]):Buffer.from(M):M}function p(M,P,k){let D=M;if(M&&!k&&typeof M=="object"){if(Ut.endsWith(P,"{}"))P=n?P:P.slice(0,-2),M=JSON.stringify(M);else if(Ut.isArray(M)&&Zpe(M)||(Ut.isFileList(M)||Ut.endsWith(P,"[]"))&&(D=Ut.toArray(M)))return P=DD(P),D.forEach(function(H,N){!(Ut.isUndefined(H)||H===null)&&e.append(a===!0?kD([P],N,s):a===null?P:P+"[]",d(H))}),!1}return xC(M)?!0:(e.append(kD(k,P,s),d(M)),!1)}const b=[],C=Object.assign(Jpe,{defaultVisitor:p,convertValue:d,isVisitable:xC});function w(M,P){if(!Ut.isUndefined(M)){if(b.indexOf(M)!==-1)throw Error("Circular reference detected in "+P.join("."));b.push(M),Ut.forEach(M,function(D,j){(!(Ut.isUndefined(D)||D===null)&&i.call(e,D,Ut.isString(j)?j.trim():j,P,C))===!0&&w(D,P?P.concat(j):[j])}),b.pop()}}if(!Ut.isObject(r))throw new TypeError("data must be an object");return w(r),e}function ND(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function BC(r,e){this._pairs=[],r&&Nb(r,this,e)}const zD=BC.prototype;zD.append=function(e,t){this._pairs.push([e,t])},zD.toString=function(e){const t=e?function(n){return e.call(this,n,ND)}:ND;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function ege(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function QD(r,e,t){if(!e)return r;const n=t&&t.encode||ege;Ut.isFunction(t)&&(t={serialize:t});const i=t&&t.serialize;let s;if(i?s=i(e,t):s=Ut.isURLSearchParams(e)?e.toString():new BC(e,t).toString(n),s){const a=r.indexOf("#");a!==-1&&(r=r.slice(0,a)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}class HD{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ut.forEach(this.handlers,function(n){n!==null&&e(n)})}}const VD={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},tge={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:BC,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},CC=typeof window<"u"&&typeof document<"u",TC=typeof navigator=="object"&&navigator||void 0,rge=CC&&(!TC||["ReactNative","NativeScript","NS"].indexOf(TC.product)<0),nge=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ige=CC&&window.location.href||"http://localhost",da={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:CC,hasStandardBrowserEnv:rge,hasStandardBrowserWebWorkerEnv:nge,navigator:TC,origin:ige},Symbol.toStringTag,{value:"Module"})),...tge};function sge(r,e){return Nb(r,new da.classes.URLSearchParams,{visitor:function(t,n,i,s){return da.isNode&&Ut.isBuffer(t)?(this.append(n,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)},...e})}function oge(r){return Ut.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function age(r){const e={},t=Object.keys(r);let n;const i=t.length;let s;for(n=0;n<i;n++)s=t[n],e[s]=r[s];return e}function jD(r){function e(t,n,i,s){let a=t[s++];if(a==="__proto__")return!0;const o=Number.isFinite(+a),u=s>=t.length;return a=!a&&Ut.isArray(i)?i.length:a,u?(Ut.hasOwnProp(i,a)?i[a]=[i[a],n]:i[a]=n,!o):((!i[a]||!Ut.isObject(i[a]))&&(i[a]=[]),e(t,n,i[a],s)&&Ut.isArray(i[a])&&(i[a]=age(i[a])),!o)}if(Ut.isFormData(r)&&Ut.isFunction(r.entries)){const t={};return Ut.forEachEntry(r,(n,i)=>{e(oge(n),i,t,0)}),t}return null}function lge(r,e,t){if(Ut.isString(r))try{return(e||JSON.parse)(r),Ut.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}const f_={transitional:VD,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=Ut.isObject(e);if(s&&Ut.isHTMLForm(e)&&(e=new FormData(e)),Ut.isFormData(e))return i?JSON.stringify(jD(e)):e;if(Ut.isArrayBuffer(e)||Ut.isBuffer(e)||Ut.isStream(e)||Ut.isFile(e)||Ut.isBlob(e)||Ut.isReadableStream(e))return e;if(Ut.isArrayBufferView(e))return e.buffer;if(Ut.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return sge(e,this.formSerializer).toString();if((o=Ut.isFileList(e))||n.indexOf("multipart/form-data")>-1){const u=this.env&&this.env.FormData;return Nb(o?{"files[]":e}:e,u&&new u,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),lge(e)):e}],transformResponse:[function(e){const t=this.transitional||f_.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(Ut.isResponse(e)||Ut.isReadableStream(e))return e;if(e&&Ut.isString(e)&&(n&&!this.responseType||i)){const a=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e,this.parseReviver)}catch(o){if(a)throw o.name==="SyntaxError"?In.from(o,In.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:da.classes.FormData,Blob:da.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ut.forEach(["delete","get","head","post","put","patch"],r=>{f_.headers[r]={}});const cge=Ut.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),uge=r=>{const e={};let t,n,i;return r&&r.split(`
`).forEach(function(a){i=a.indexOf(":"),t=a.substring(0,i).trim().toLowerCase(),n=a.substring(i+1).trim(),!(!t||e[t]&&cge[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},$D=Symbol("internals");function d_(r){return r&&String(r).trim().toLowerCase()}function zb(r){return r===!1||r==null?r:Ut.isArray(r)?r.map(zb):String(r)}function hge(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}const Age=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function EC(r,e,t,n,i){if(Ut.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!Ut.isString(e)){if(Ut.isString(n))return e.indexOf(n)!==-1;if(Ut.isRegExp(n))return n.test(e)}}function fge(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function dge(r,e){const t=Ut.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(i,s,a){return this[n].call(this,e,i,s,a)},configurable:!0})})}let nl=class{constructor(e){e&&this.set(e)}set(e,t,n){const i=this;function s(o,u,d){const p=d_(u);if(!p)throw new Error("header name must be a non-empty string");const b=Ut.findKey(i,p);(!b||i[b]===void 0||d===!0||d===void 0&&i[b]!==!1)&&(i[b||u]=zb(o))}const a=(o,u)=>Ut.forEach(o,(d,p)=>s(d,p,u));if(Ut.isPlainObject(e)||e instanceof this.constructor)a(e,t);else if(Ut.isString(e)&&(e=e.trim())&&!Age(e))a(uge(e),t);else if(Ut.isObject(e)&&Ut.isIterable(e)){let o={},u,d;for(const p of e){if(!Ut.isArray(p))throw TypeError("Object iterator must return a key-value pair");o[d=p[0]]=(u=o[d])?Ut.isArray(u)?[...u,p[1]]:[u,p[1]]:p[1]}a(o,t)}else e!=null&&s(t,e,n);return this}get(e,t){if(e=d_(e),e){const n=Ut.findKey(this,e);if(n){const i=this[n];if(!t)return i;if(t===!0)return hge(i);if(Ut.isFunction(t))return t.call(this,i,n);if(Ut.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=d_(e),e){const n=Ut.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||EC(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let i=!1;function s(a){if(a=d_(a),a){const o=Ut.findKey(n,a);o&&(!t||EC(n,n[o],o,t))&&(delete n[o],i=!0)}}return Ut.isArray(e)?e.forEach(s):s(e),i}clear(e){const t=Object.keys(this);let n=t.length,i=!1;for(;n--;){const s=t[n];(!e||EC(this,this[s],s,e,!0))&&(delete this[s],i=!0)}return i}normalize(e){const t=this,n={};return Ut.forEach(this,(i,s)=>{const a=Ut.findKey(n,s);if(a){t[a]=zb(i),delete t[s];return}const o=e?fge(s):String(s).trim();o!==s&&delete t[s],t[o]=zb(i),n[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Ut.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&Ut.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(i=>n.set(i)),n}static accessor(e){const n=(this[$D]=this[$D]={accessors:{}}).accessors,i=this.prototype;function s(a){const o=d_(a);n[o]||(dge(i,a),n[o]=!0)}return Ut.isArray(e)?e.forEach(s):s(e),this}};nl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ut.reduceDescriptors(nl.prototype,({value:r},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(n){this[t]=n}}}),Ut.freezeMethods(nl);function SC(r,e){const t=this||f_,n=e||t,i=nl.from(n.headers);let s=n.data;return Ut.forEach(r,function(o){s=o.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function GD(r){return!!(r&&r.__CANCEL__)}function lg(r,e,t){In.call(this,r??"canceled",In.ERR_CANCELED,e,t),this.name="CanceledError"}Ut.inherits(lg,In,{__CANCEL__:!0});function WD(r,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new In("Request failed with status code "+t.status,[In.ERR_BAD_REQUEST,In.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function pge(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function gge(r,e){r=r||10;const t=new Array(r),n=new Array(r);let i=0,s=0,a;return e=e!==void 0?e:1e3,function(u){const d=Date.now(),p=n[s];a||(a=d),t[i]=u,n[i]=d;let b=s,C=0;for(;b!==i;)C+=t[b++],b=b%r;if(i=(i+1)%r,i===s&&(s=(s+1)%r),d-a<e)return;const w=p&&d-p;return w?Math.round(C*1e3/w):void 0}}function mge(r,e){let t=0,n=1e3/e,i,s;const a=(d,p=Date.now())=>{t=p,i=null,s&&(clearTimeout(s),s=null),r(...d)};return[(...d)=>{const p=Date.now(),b=p-t;b>=n?a(d,p):(i=d,s||(s=setTimeout(()=>{s=null,a(i)},n-b)))},()=>i&&a(i)]}const Qb=(r,e,t=3)=>{let n=0;const i=gge(50,250);return mge(s=>{const a=s.loaded,o=s.lengthComputable?s.total:void 0,u=a-n,d=i(u),p=a<=o;n=a;const b={loaded:a,total:o,progress:o?a/o:void 0,bytes:u,rate:d||void 0,estimated:d&&o&&p?(o-a)/d:void 0,event:s,lengthComputable:o!=null,[e?"download":"upload"]:!0};r(b)},t)},qD=(r,e)=>{const t=r!=null;return[n=>e[0]({lengthComputable:t,total:r,loaded:n}),e[1]]},KD=r=>(...e)=>Ut.asap(()=>r(...e)),_ge=da.hasStandardBrowserEnv?((r,e)=>t=>(t=new URL(t,da.origin),r.protocol===t.protocol&&r.host===t.host&&(e||r.port===t.port)))(new URL(da.origin),da.navigator&&/(msie|trident)/i.test(da.navigator.userAgent)):()=>!0,yge=da.hasStandardBrowserEnv?{write(r,e,t,n,i,s,a){if(typeof document>"u")return;const o=[`${r}=${encodeURIComponent(e)}`];Ut.isNumber(t)&&o.push(`expires=${new Date(t).toUTCString()}`),Ut.isString(n)&&o.push(`path=${n}`),Ut.isString(i)&&o.push(`domain=${i}`),s===!0&&o.push("secure"),Ut.isString(a)&&o.push(`SameSite=${a}`),document.cookie=o.join("; ")},read(r){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+r+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(r){this.write(r,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function bge(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function vge(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function XD(r,e,t){let n=!bge(e);return r&&(n||t==!1)?vge(r,e):e}const YD=r=>r instanceof nl?{...r}:r;function md(r,e){e=e||{};const t={};function n(d,p,b,C){return Ut.isPlainObject(d)&&Ut.isPlainObject(p)?Ut.merge.call({caseless:C},d,p):Ut.isPlainObject(p)?Ut.merge({},p):Ut.isArray(p)?p.slice():p}function i(d,p,b,C){if(Ut.isUndefined(p)){if(!Ut.isUndefined(d))return n(void 0,d,b,C)}else return n(d,p,b,C)}function s(d,p){if(!Ut.isUndefined(p))return n(void 0,p)}function a(d,p){if(Ut.isUndefined(p)){if(!Ut.isUndefined(d))return n(void 0,d)}else return n(void 0,p)}function o(d,p,b){if(b in e)return n(d,p);if(b in r)return n(void 0,d)}const u={url:s,method:s,data:s,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:o,headers:(d,p,b)=>i(YD(d),YD(p),b,!0)};return Ut.forEach(Object.keys({...r,...e}),function(p){const b=u[p]||i,C=b(r[p],e[p],p);Ut.isUndefined(C)&&b!==o||(t[p]=C)}),t}const ZD=r=>{const e=md({},r);let{data:t,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:s,headers:a,auth:o}=e;if(e.headers=a=nl.from(a),e.url=QD(XD(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),o&&a.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):""))),Ut.isFormData(t)){if(da.hasStandardBrowserEnv||da.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(Ut.isFunction(t.getHeaders)){const u=t.getHeaders(),d=["content-type","content-length"];Object.entries(u).forEach(([p,b])=>{d.includes(p.toLowerCase())&&a.set(p,b)})}}if(da.hasStandardBrowserEnv&&(n&&Ut.isFunction(n)&&(n=n(e)),n||n!==!1&&_ge(e.url))){const u=i&&s&&yge.read(s);u&&a.set(i,u)}return e},wge=typeof XMLHttpRequest<"u"&&function(r){return new Promise(function(t,n){const i=ZD(r);let s=i.data;const a=nl.from(i.headers).normalize();let{responseType:o,onUploadProgress:u,onDownloadProgress:d}=i,p,b,C,w,M;function P(){w&&w(),M&&M(),i.cancelToken&&i.cancelToken.unsubscribe(p),i.signal&&i.signal.removeEventListener("abort",p)}let k=new XMLHttpRequest;k.open(i.method.toUpperCase(),i.url,!0),k.timeout=i.timeout;function D(){if(!k)return;const H=nl.from("getAllResponseHeaders"in k&&k.getAllResponseHeaders()),q={data:!o||o==="text"||o==="json"?k.responseText:k.response,status:k.status,statusText:k.statusText,headers:H,config:r,request:k};WD(function(ie){t(ie),P()},function(ie){n(ie),P()},q),k=null}"onloadend"in k?k.onloadend=D:k.onreadystatechange=function(){!k||k.readyState!==4||k.status===0&&!(k.responseURL&&k.responseURL.indexOf("file:")===0)||setTimeout(D)},k.onabort=function(){k&&(n(new In("Request aborted",In.ECONNABORTED,r,k)),k=null)},k.onerror=function(N){const q=N&&N.message?N.message:"Network Error",W=new In(q,In.ERR_NETWORK,r,k);W.event=N||null,n(W),k=null},k.ontimeout=function(){let N=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const q=i.transitional||VD;i.timeoutErrorMessage&&(N=i.timeoutErrorMessage),n(new In(N,q.clarifyTimeoutError?In.ETIMEDOUT:In.ECONNABORTED,r,k)),k=null},s===void 0&&a.setContentType(null),"setRequestHeader"in k&&Ut.forEach(a.toJSON(),function(N,q){k.setRequestHeader(q,N)}),Ut.isUndefined(i.withCredentials)||(k.withCredentials=!!i.withCredentials),o&&o!=="json"&&(k.responseType=i.responseType),d&&([C,M]=Qb(d,!0),k.addEventListener("progress",C)),u&&k.upload&&([b,w]=Qb(u),k.upload.addEventListener("progress",b),k.upload.addEventListener("loadend",w)),(i.cancelToken||i.signal)&&(p=H=>{k&&(n(!H||H.type?new lg(null,r,k):H),k.abort(),k=null)},i.cancelToken&&i.cancelToken.subscribe(p),i.signal&&(i.signal.aborted?p():i.signal.addEventListener("abort",p)));const j=pge(i.url);if(j&&da.protocols.indexOf(j)===-1){n(new In("Unsupported protocol "+j+":",In.ERR_BAD_REQUEST,r));return}k.send(s||null)})},xge=(r,e)=>{const{length:t}=r=r?r.filter(Boolean):[];if(e||t){let n=new AbortController,i;const s=function(d){if(!i){i=!0,o();const p=d instanceof Error?d:this.reason;n.abort(p instanceof In?p:new lg(p instanceof Error?p.message:p))}};let a=e&&setTimeout(()=>{a=null,s(new In(`timeout ${e} of ms exceeded`,In.ETIMEDOUT))},e);const o=()=>{r&&(a&&clearTimeout(a),a=null,r.forEach(d=>{d.unsubscribe?d.unsubscribe(s):d.removeEventListener("abort",s)}),r=null)};r.forEach(d=>d.addEventListener("abort",s));const{signal:u}=n;return u.unsubscribe=()=>Ut.asap(o),u}},Bge=function*(r,e){let t=r.byteLength;if(t<e){yield r;return}let n=0,i;for(;n<t;)i=n+e,yield r.slice(n,i),n=i},Cge=async function*(r,e){for await(const t of Tge(r))yield*Bge(t,e)},Tge=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)break;yield n}}finally{await e.cancel()}},JD=(r,e,t,n)=>{const i=Cge(r,e);let s=0,a,o=u=>{a||(a=!0,n&&n(u))};return new ReadableStream({async pull(u){try{const{done:d,value:p}=await i.next();if(d){o(),u.close();return}let b=p.byteLength;if(t){let C=s+=b;t(C)}u.enqueue(new Uint8Array(p))}catch(d){throw o(d),d}},cancel(u){return o(u),i.return()}},{highWaterMark:2})},ek=64*1024,{isFunction:Hb}=Ut,Ege=(({Request:r,Response:e})=>({Request:r,Response:e}))(Ut.global),{ReadableStream:tk,TextEncoder:rk}=Ut.global,nk=(r,...e)=>{try{return!!r(...e)}catch{return!1}},Sge=r=>{r=Ut.merge.call({skipUndefined:!0},Ege,r);const{fetch:e,Request:t,Response:n}=r,i=e?Hb(e):typeof fetch=="function",s=Hb(t),a=Hb(n);if(!i)return!1;const o=i&&Hb(tk),u=i&&(typeof rk=="function"?(M=>P=>M.encode(P))(new rk):async M=>new Uint8Array(await new t(M).arrayBuffer())),d=s&&o&&nk(()=>{let M=!1;const P=new t(da.origin,{body:new tk,method:"POST",get duplex(){return M=!0,"half"}}).headers.has("Content-Type");return M&&!P}),p=a&&o&&nk(()=>Ut.isReadableStream(new n("").body)),b={stream:p&&(M=>M.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(M=>{!b[M]&&(b[M]=(P,k)=>{let D=P&&P[M];if(D)return D.call(P);throw new In(`Response type '${M}' is not supported`,In.ERR_NOT_SUPPORT,k)})});const C=async M=>{if(M==null)return 0;if(Ut.isBlob(M))return M.size;if(Ut.isSpecCompliantForm(M))return(await new t(da.origin,{method:"POST",body:M}).arrayBuffer()).byteLength;if(Ut.isArrayBufferView(M)||Ut.isArrayBuffer(M))return M.byteLength;if(Ut.isURLSearchParams(M)&&(M=M+""),Ut.isString(M))return(await u(M)).byteLength},w=async(M,P)=>{const k=Ut.toFiniteNumber(M.getContentLength());return k??C(P)};return async M=>{let{url:P,method:k,data:D,signal:j,cancelToken:H,timeout:N,onDownloadProgress:q,onUploadProgress:W,responseType:ie,headers:se,withCredentials:Z="same-origin",fetchOptions:fe}=ZD(M),te=e||fetch;ie=ie?(ie+"").toLowerCase():"text";let ce=xge([j,H&&H.toAbortSignal()],N),ve=null;const me=ce&&ce.unsubscribe&&(()=>{ce.unsubscribe()});let qe;try{if(W&&d&&k!=="get"&&k!=="head"&&(qe=await w(se,D))!==0){let ht=new t(P,{method:"POST",body:D,duplex:"half"}),he;if(Ut.isFormData(D)&&(he=ht.headers.get("content-type"))&&se.setContentType(he),ht.body){const[Be,Le]=qD(qe,Qb(KD(W)));D=JD(ht.body,ek,Be,Le)}}Ut.isString(Z)||(Z=Z?"include":"omit");const ot=s&&"credentials"in t.prototype,st={...fe,signal:ce,method:k.toUpperCase(),headers:se.normalize().toJSON(),body:D,duplex:"half",credentials:ot?Z:void 0};ve=s&&new t(P,st);let Ye=await(s?te(ve,fe):te(P,st));const Xe=p&&(ie==="stream"||ie==="response");if(p&&(q||Xe&&me)){const ht={};["status","statusText","headers"].forEach(He=>{ht[He]=Ye[He]});const he=Ut.toFiniteNumber(Ye.headers.get("content-length")),[Be,Le]=q&&qD(he,Qb(KD(q),!0))||[];Ye=new n(JD(Ye.body,ek,Be,()=>{Le&&Le(),me&&me()}),ht)}ie=ie||"text";let wt=await b[Ut.findKey(b,ie)||"text"](Ye,M);return!Xe&&me&&me(),await new Promise((ht,he)=>{WD(ht,he,{data:wt,headers:nl.from(Ye.headers),status:Ye.status,statusText:Ye.statusText,config:M,request:ve})})}catch(ot){throw me&&me(),ot&&ot.name==="TypeError"&&/Load failed|fetch/i.test(ot.message)?Object.assign(new In("Network Error",In.ERR_NETWORK,M,ve),{cause:ot.cause||ot}):In.from(ot,ot&&ot.code,M,ve)}}},Ige=new Map,ik=r=>{let e=r&&r.env||{};const{fetch:t,Request:n,Response:i}=e,s=[n,i,t];let a=s.length,o=a,u,d,p=Ige;for(;o--;)u=s[o],d=p.get(u),d===void 0&&p.set(u,d=o?new Map:Sge(e)),p=d;return d};ik();const IC={http:Ype,xhr:wge,fetch:{get:ik}};Ut.forEach(IC,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const sk=r=>`- ${r}`,Pge=r=>Ut.isFunction(r)||r===null||r===!1;function Mge(r,e){r=Ut.isArray(r)?r:[r];const{length:t}=r;let n,i;const s={};for(let a=0;a<t;a++){n=r[a];let o;if(i=n,!Pge(n)&&(i=IC[(o=String(n)).toLowerCase()],i===void 0))throw new In(`Unknown adapter '${o}'`);if(i&&(Ut.isFunction(i)||(i=i.get(e))))break;s[o||"#"+a]=i}if(!i){const a=Object.entries(s).map(([u,d])=>`adapter ${u} `+(d===!1?"is not supported by the environment":"is not available in the build"));let o=t?a.length>1?`since :
`+a.map(sk).join(`
`):" "+sk(a[0]):"as no adapter specified";throw new In("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return i}const ok={getAdapter:Mge,adapters:IC};function PC(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new lg(null,r)}function ak(r){return PC(r),r.headers=nl.from(r.headers),r.data=SC.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),ok.getAdapter(r.adapter||f_.adapter,r)(r).then(function(n){return PC(r),n.data=SC.call(r,r.transformResponse,n),n.headers=nl.from(n.headers),n},function(n){return GD(n)||(PC(r),n&&n.response&&(n.response.data=SC.call(r,r.transformResponse,n.response),n.response.headers=nl.from(n.response.headers))),Promise.reject(n)})}const lk="1.13.1",Vb={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{Vb[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});const ck={};Vb.transitional=function(e,t,n){function i(s,a){return"[Axios v"+lk+"] Transitional option '"+s+"'"+a+(n?". "+n:"")}return(s,a,o)=>{if(e===!1)throw new In(i(a," has been removed"+(t?" in "+t:"")),In.ERR_DEPRECATED);return t&&!ck[a]&&(ck[a]=!0,console.warn(i(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,a,o):!0}},Vb.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function Fge(r,e,t){if(typeof r!="object")throw new In("options must be an object",In.ERR_BAD_OPTION_VALUE);const n=Object.keys(r);let i=n.length;for(;i-- >0;){const s=n[i],a=e[s];if(a){const o=r[s],u=o===void 0||a(o,s,r);if(u!==!0)throw new In("option "+s+" must be "+u,In.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new In("Unknown option "+s,In.ERR_BAD_OPTION)}}const jb={assertOptions:Fge,validators:Vb},Ku=jb.validators;let _d=class{constructor(e){this.defaults=e||{},this.interceptors={request:new HD,response:new HD}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=md(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:s}=t;n!==void 0&&jb.assertOptions(n,{silentJSONParsing:Ku.transitional(Ku.boolean),forcedJSONParsing:Ku.transitional(Ku.boolean),clarifyTimeoutError:Ku.transitional(Ku.boolean)},!1),i!=null&&(Ut.isFunction(i)?t.paramsSerializer={serialize:i}:jb.assertOptions(i,{encode:Ku.function,serialize:Ku.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),jb.assertOptions(t,{baseUrl:Ku.spelling("baseURL"),withXsrfToken:Ku.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=s&&Ut.merge(s.common,s[t.method]);s&&Ut.forEach(["delete","get","head","post","put","patch","common"],M=>{delete s[M]}),t.headers=nl.concat(a,s);const o=[];let u=!0;this.interceptors.request.forEach(function(P){typeof P.runWhen=="function"&&P.runWhen(t)===!1||(u=u&&P.synchronous,o.unshift(P.fulfilled,P.rejected))});const d=[];this.interceptors.response.forEach(function(P){d.push(P.fulfilled,P.rejected)});let p,b=0,C;if(!u){const M=[ak.bind(this),void 0];for(M.unshift(...o),M.push(...d),C=M.length,p=Promise.resolve(t);b<C;)p=p.then(M[b++],M[b++]);return p}C=o.length;let w=t;for(;b<C;){const M=o[b++],P=o[b++];try{w=M(w)}catch(k){P.call(this,k);break}}try{p=ak.call(this,w)}catch(M){return Promise.reject(M)}for(b=0,C=d.length;b<C;)p=p.then(d[b++],d[b++]);return p}getUri(e){e=md(this.defaults,e);const t=XD(e.baseURL,e.url,e.allowAbsoluteUrls);return QD(t,e.params,e.paramsSerializer)}};Ut.forEach(["delete","get","head","options"],function(e){_d.prototype[e]=function(t,n){return this.request(md(n||{},{method:e,url:t,data:(n||{}).data}))}}),Ut.forEach(["post","put","patch"],function(e){function t(n){return function(s,a,o){return this.request(md(o||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:a}))}}_d.prototype[e]=t(),_d.prototype[e+"Form"]=t(!0)});let Rge=class N9{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s;const a=new Promise(o=>{n.subscribe(o),s=o}).then(i);return a.cancel=function(){n.unsubscribe(s)},a},e(function(s,a,o){n.reason||(n.reason=new lg(s,a,o),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=n=>{e.abort(n)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new N9(function(i){e=i}),cancel:e}}};function Lge(r){return function(t){return r.apply(null,t)}}function Oge(r){return Ut.isObject(r)&&r.isAxiosError===!0}const MC={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(MC).forEach(([r,e])=>{MC[e]=r});function uk(r){const e=new _d(r),t=TD(_d.prototype.request,e);return Ut.extend(t,_d.prototype,e,{allOwnKeys:!0}),Ut.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return uk(md(r,i))},t}const Ds=uk(f_);Ds.Axios=_d,Ds.CanceledError=lg,Ds.CancelToken=Rge,Ds.isCancel=GD,Ds.VERSION=lk,Ds.toFormData=Nb,Ds.AxiosError=In,Ds.Cancel=Ds.CanceledError,Ds.all=function(e){return Promise.all(e)},Ds.spread=Lge,Ds.isAxiosError=Oge,Ds.mergeConfig=md,Ds.AxiosHeaders=nl,Ds.formToJSON=r=>jD(Ut.isHTMLForm(r)?new FormData(r):r),Ds.getAdapter=ok.getAdapter,Ds.HttpStatusCode=MC,Ds.default=Ds;const{Axios:$Be,AxiosError:GBe,CanceledError:WBe,isCancel:qBe,CancelToken:KBe,VERSION:XBe,all:YBe,Cancel:ZBe,isAxiosError:JBe,spread:eCe,toFormData:tCe,AxiosHeaders:rCe,HttpStatusCode:nCe,formToJSON:iCe,getAdapter:sCe,mergeConfig:oCe}=Ds,Uge="https://eines.icgc.cat/recursos/mapicgc-gl-js/mapicgc-config.json",Dge=5e3;class hk{static async getConfigICGC(){try{const e=await Ds.get(Uge,{timeout:Dge});return e.data?e.data:(console.log("Resposta sense dades:",e),pd)}catch(e){return e.response?(console.error("Error de resposta:",e.response.data),console.error("Codi d'estat:",e.response.status)):e.request?console.error("No s'ha rebut resposta del servidor:",e.request):console.error("Error:",e.message),pd}}}const kge={cobertesSol:{"fill-opacity":["interpolate",["exponential",.5],["zoom"],13.5,1,18,.4],"fill-outline-color":"rgba(0,0, 0, 0)","fill-color":["interpolate",["cubic-bezier",.5,1,1,1],["get","nivell_2"],0,"#ffffff",111,"#ffff00",112,"#ccff33",113,"#af5b15",114,"#808000",115,"#cdcd00",116,"#ffffcc",221,"#33cc33",222,"#66ff33",223,"#689018",224,"#967d5f",225,"#19e61e",226,"#b4ff9b",227,"#aaa500",228,"#c3c3a0",229,"#00ff9b",230,"#ff9632",231,"#282828",232,"#79797a",233,"#f5df78",234,"#3296ff",341,"#ff007d",342,"#ff53cd",343,"#ffa4e2",344,"#ffc8e2",345,"#ffb4b4",346,"#0f3700",347,"#730055",348,"#6200c4",349,"#4a9595",350,"#ff00f0",351,"#adaaca",352,"#ffe6e6",353,"#67629a",354,"#4a466e",355,"#2f2d46",461,"#6f6fff",462,"#0000dc",463,"#000064",464,"#185f94",465,"#12466d",466,"#000080"]}},Nge="lines",$b="labels";let eu,yd,cg,Bs,gi,zge=class{constructor(e){hk.getConfigICGC().then(t=>{yd={...t.Styles},Bs={...t.Layers},cg={...t.Terrains},gi={...t.defaultOptions},this.initTheMap(e)}).catch(t=>{console.info("Configuracio per defecte",t),yd={...pd.Styles},Bs={...pd.Layers},cg={...pd.Terrains},gi={...pd.defaultOptions},this.initTheMap(e)})}initTheMap(e){if(!e)e=gi.mapOptions;else for(const i in gi.mapOptions){let s=[gi.mapOptions.center[0],gi.mapOptions.center[1]];gi.mapOptions.center=s,e.hasOwnProperty(i)||(e[i]=gi.mapOptions[i])}e.maxPitch=85,e.maplibreLogo=!1,e.attributionControl=!1;const t=e.style==="RELIEF"||typeof e.style=="object"&&e.style.hasOwnProperty("colorRelief"),n=typeof e.style=="string"&&e.style.includes("https://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/");if(t){const i=typeof e.style=="object"?e.style:{},s=i.source||{type:"raster-dem",tiles:[cg.ICGC5M],tileSize:512,maxzoom:20},a=i.colorRelief||["interpolate",["linear"],["elevation"],-50,"rgb(30, 70, 130)",0,"rgb(120, 180, 210)",5,"rgb(170, 220, 170)",100,"rgb(180, 210, 140)",300,"rgb(220, 220, 130)",500,"rgb(245, 220, 110)",800,"rgb(250, 200, 100)",1100,"rgb(245, 170, 90)",1400,"rgb(230, 140, 80)",1700,"rgb(210, 130, 90)",2e3,"rgb(190, 130, 110)",2400,"rgb(180, 150, 130)",2800,"rgb(200, 190, 180)",3200,"rgb(235, 235, 235)",3600,"rgb(255, 255, 255)"];this.map=new go.Map({container:e.container,center:e.center,zoom:e.zoom,pitch:e.pitch||0,bearing:e.bearing||0,hash:e.hash||!1,maxZoom:e.maxZoom||18,maxPitch:e.maxPitch||85,renderWorldCopies:!1,style:{version:8,sources:{terrainSource:s},layers:[{id:"color-relief",type:"color-relief",source:"terrainSource",paint:{"color-relief-color":a}}]}})}else n?(this.map=new go.Map({container:e.container,center:e.center,zoom:e.zoom,pitch:e.pitch||0,hash:e.hash||!1,style:{version:8,sources:{},layers:[]}}),this.map.on("load",()=>{this.map.addSource("raster-source",{type:"raster",tiles:[e.style],tileSize:256}),this.map.addLayer({id:"raster-layer",type:"raster",source:"raster-source"})})):this.map=new go.Map(e);this.map.on("load",()=>{if(!n&&!t){const i=this.map.getStyle().name,s=e.style;this.map.addControl(new ape({color:s.indexOf("orto")===-1,defaultOptions:gi}),"bottom-left"),this._dealOrto3dStyle(i)}})}addGeocoderICGC(e={},t="top-right"){try{e={...{collapsed:!0,marker:!0,zoom:16,popup:!0,showResultMarkers:!0,maplibregl:go,showResultsWhileTyping:!0,minLength:2},...e};const i={forwardGeocode:async a=>{const o=[];try{const u=gi.geocoder.peliasUrl1+encodeURIComponent(a.query)+gi.geocoder.peliasUrl2,p=await(await fetch(u)).json();for(const b of p.features){const C=b.geometry.coordinates,w={type:"Feature",geometry:{type:"Point",coordinates:C},place_name:b.properties.etiqueta,properties:b.properties,text:b.properties.etiqueta,place_type:["place"],center:C};o.push(w)}}catch(u){console.error(`Failed to forwardGeocode with error: ${u}`)}return{features:o}}};this.map.addControl(new ope(i,e),t);let s=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");s[0].attributes[2].nodeValue="Cerca...",s[0].addEventListener("input",function(a){a.target.value.length>3})}catch(n){console.error(`Error adding ICGC geocoder: ${n.message}`)}}async loadImage(e){try{return this.map.loadImage(e)}catch(t){console.error(`Error getting loadImage: ${t.message}`)}}getConfigStyles(){try{let e=[];for(const t of yd)e.push(t.name);return e}catch(e){console.error(`Error retrieving base styles: ${e.message}`)}}getConfigWMSLayers(){try{let e=[];for(const t in Bs.WMS)Bs.WMS.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving WMS layers: ${e.message}`)}}getConfigOrtoLayers(){try{let e=[];for(const t in Bs.Orto)Bs.Orto.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving orto image layers: ${e.message}`)}}getConfigVectorLayers(){try{let e=[];for(const t in Bs.Vector)Bs.Vector.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vector layers: ${e.message}`)}}getConfigVectorAdminLayers(){try{let e=[];for(const t in Bs.VectorAdmin)Bs.VectorAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vectorAdmin layers: ${e.message}`)}}getConfigFGBAdminLayers(){try{let e=[];for(const t in Bs.FGBAdmin)Bs.FGBAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving FGBAdmin layers: ${e.message}`)}}async fetchData(e,t,n){try{(!n||n===void 0)&&(n={type:"line",layout:{visibility:"visible"},paint:{"line-color":"grey","line-width":2},layerPosition:"top"});let i=n.layerPosition;if(e.includes(".fgb"))this.addFGBLayerICGC(e,t,n);else{const a=await(await fetch(e)).json();let o=t,u=this._dealOrderLayer(i),d=a.features[0].geometry.type;d.includes("ine")&&(n!==void 0?this.map.addLayer({id:o,type:"line",source:{type:"geojson",data:a},layout:n.layout||{},paint:n.paint||{}},u):this.map.addLayer({id:o,type:"line",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},u)),d.includes("olygon")&&(n!==void 0?this.map.addLayer({id:o,type:"fill",source:{type:"geojson",data:a},layout:n.layout,paint:n.paint},u):this.map.addLayer({id:o,type:"fill",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},u)),d.includes("oint")&&(n!==void 0?this.map.addLayer({id:o,type:"circle",source:{type:"geojson",data:a},layout:n.layout,paint:n.paint},u):this.map.addLayer({id:o,type:"circle",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},u))}}catch(i){console.error(`Error fetching data: ${i.message}`)}}async fetchDataAndMenu(e,t,n,i){try{let s;i!==null?s=i.layerPosition:s=$b;let a,o=document.getElementById("map");if(document.getElementById("menu-group")?a=document.getElementById("menu-group"):(a=document.createElement("nav"),a.id="menu-group",a.classList.add="filter-group",o.appendChild(a)),a!==null){let u="visible",d=this._dealOrderLayer(s),p;if(e.includes(".fgb")){let C=this._getKeyByUrlFGB(e);C===null&&(C="userFGB");const w=await fetch(e),M={type:"FeatureCollection",features:[]};for await(const k of GI(w.body))M.features.push(k);p=M;let P=t;if(this.map.addSource(P,{type:"geojson",data:M}),e.includes("text"))i!==void 0?this.map.addLayer({id:t,type:"symbol",source:P,layout:i.layout,paint:i.paint},d):this.map.addLayer({id:t,type:"symbol",source:P,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:u,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},d);else{let k=t+"Text";this.map.addLayer({id:k,type:"symbol",source:P,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:u,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},d)}}else p=await(await fetch(e)).json();if(n!=="all"){const C=document.createElement("div");C.id="titleDivMenu",C.textContent=t,a.appendChild(C);const w=document.createElement("div");w.id="titleDivMenuSub",w.textContent=`📂 ${n}`,a.appendChild(w)}let b;if(i.type?b=i.type:b=p.features[0].geometry.type,n==="all")b.includes("ine")&&(i!==void 0?this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:p},layout:i.layout,paint:i.paint},d):this.map.addLayer({id:t,type:"line",source:{type:"geojson",data:p},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},d)),b.includes("olygon")&&(i!==void 0?this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:p},layout:i.layout,paint:i.paint},d):this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:p},layout:{visibility:"visible"},paint:{"fill-color":"#0000FF","fill-opacity":0}},d)),b.includes("oint")&&(i!==void 0?this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:p},layout:i.layout,paint:i.paint},d):this.map.addLayer({id:t,type:"circle",source:{type:"geojson",data:p},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},d)),b.includes("ymbol")&&(i!==void 0?this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:p},layout:i.layout,paint:i.paint},d):this.map.addLayer({id:t,type:"symbol",source:{type:"geojson",data:p},layout:{visibility:"visible"},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},d)),this.addMenuItem(t);else{let C=n;const w={};p.features.forEach(M=>{const P=M.properties[C],k=P+"-userFieldFilter-"+t;P!==null&&(w[k]||(b.includes("ine")&&(i!==void 0?this.map.addLayer({id:k,type:"line",source:{type:"geojson",data:p},layout:i.layout,paint:i.paint,filter:["==",`${C}`,P]},d):this.map.addLayer({id:k,type:"line",source:{type:"geojson",data:p},layout:{visibility:"visible"},filter:["==",`${C}`,P],paint:{"line-color":"black","line-width":2,"line-opacity":1}},d)),b.includes("olygon")&&(i!==void 0?this.map.addLayer({id:k,type:"fill",source:{type:"geojson",data:p},filter:["==",`${C}`,P],layout:i.layout,paint:i.paint},d):this.map.addLayer({id:k,type:"fill",source:{type:"geojson",data:p},layout:{visibility:"visible"},filter:["==",`${C}`,P],paint:{"fill-color":"blue","fill-opacity":.6}},d)),b.includes("oint")&&(i!==void 0?this.map.addLayer({id:k,type:"circle",source:{type:"geojson",data:p},filter:["==",`${C}`,P],layout:i.layout,paint:i.paint},d):this.map.addLayer({id:k,type:"circle",source:{type:"geojson",data:p},layout:{visibility:"visible"},filter:["==",`${C}`,P],paint:{"circle-color":"red","circle-opacity":.85}},d)),w[k]=!0,this.addMenuItem(k)))})}}}catch(s){console.error(`Error fetching data: ${s.message}`)}}on(e,t){setTimeout(()=>{try{return this.map.on(e,t)}catch(n){console.error(`Error adding event ON listener: ${n.message}`)}},100)}setStyle(e,t){try{t!==void 0?this.map.setStyle(e,t):this.map.setStyle(e),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var n=window.document.querySelector(".maplibregl-compact-show");n.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(n){console.error(`Error setting style: ${n.message}`)}}addControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(e,t)}catch(n){console.error(`Error adding control: ${n.message}`)}}setSky(e){try{e===void 0&&(this.map.style.stylesheet.id.includes("orto")?e={"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("mapa_estandard_general")?e={"sky-color":"#a5f0f0","sky-horizon-blend":.3,"horizon-color":"#e1e3e3","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("icgc_mapa_vissir")?e={"sky-color":"#a5f0f0","sky-horizon-blend":.3,"horizon-color":"#e1e3e3","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#c5d6d6"}:this.map.style.stylesheet.id.includes("fosc")?e={"sky-color":"#232423","sky-horizon-blend":.3,"horizon-color":"#969996","horizon-fog-blend":.9,"fog-ground-blend":.85,"fog-color":"#383838"}:e={"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"}),this.map.setSky(e)}catch(t){console.error(`Error setting sky properties: ${t.message}`)}}addMouseCoordControl(e,t="bottom-left"){try{this.map.addControl(new Ape(e),t)}catch(n){console.error(`Error adding mouse coordinate control: ${n.message}`)}}addGeolocateControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new go.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),t):this.map.addControl(new go.GeolocateControl(e),t)}catch(n){console.error(`Error adding geolocate control: ${n.message}`)}}addFullscreenControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new go.FullscreenControl({container:HTMLElement}),t):this.map.addControl(new go.FullscreenControl(e),t)}catch(n){console.error(`Error adding fullscreen control: ${n.message}`)}}addLayer(e,t){try{this.map.addLayer(e,t)}catch(n){console.error(`Error adding layer: ${n.message}`)}}addImage(e,t,n){try{this.map.addImage(e,t,n)}catch(i){console.error(`Error adding image: ${i.message}`)}return this}addSource(e,t){try{this.map.addSource(e,t)}catch(n){console.error(`Error adding source: ${n.message}`)}return this}addSprite(e,t,n){try{this.map.addSprite(e,t,n)}catch(i){console.error(`Error adding sprite: ${i.message}`)}return this}areTilesLoaded(){return this.map.areTilesLoaded()}cameraForBounds(e,t){return this.map.cameraForBounds(e,t)}easeTo(e,t){return this.map.easeTo(e,t),this}fitBounds(e,t,n){return this.map.fitBounds(e,t,n),this}fitScreenCoordinates(e,t,n,i,s){return this.map.fitScreenCoordinates(e,t,n,i,s),this}flyTo(e,t){return this.map.flyTo(e,t),this}getBearing(){return this.map.getBearing()}getBounds(){return this.map.getBounds()}getCameraTargetElevation(){return this.map.getCameraTargetElevation()}getCanvas(){return this.map.getCanvas()}getCanvasContainer(){return this.map.getCanvasContainer()}getCenter(){return this.map.getCenter()}getContainer(){return this.map.getContainer()}getFeatureState(e){return this.map.getFeatureState(e)}getFilter(e){return this.map.getFilter(e)}getGlyphs(){return this.map.getGlyphs()}getImage(e){return this.map.getImage(e)}getLayer(e){return this.map.getLayer(e)}getLayersOrder(){return this.map.getLayersOrder()}getLayoutProperty(e,t){return this.map.getLayoutProperty(e,t)}getLight(){return this.map.getLight()}getMaxBounds(){return this.map.getMaxBounds()}getMaxPitch(){return this.map.getMaxPitch()}getMaxZoom(){return this.map.getMaxZoom()}getMinPitch(){return this.map.getMinPitch()}getMinZoom(){return this.map.getMinZoom()}getPadding(){return this.map.getPadding()}getPaintProperty(e,t){return this.map.getPaintProperty(e,t)}getPitch(){return this.map.getPitch()}getPixelRatio(){return this.map.getPixelRatio()}getRenderWorldCopies(){return this.map.getRenderWorldCopies()}getSource(e){return this.map.getSource(e)}getSprite(){return this.map.getSprite()}getStyle(){return this.map.getStyle()}getTerrain(){return this.map.getTerrain()}getZoom(){return this.map.getZoom()}hasControl(e){return this.map.hasControl(e)}hasImage(e){return this.map.hasImage(e)}isMoving(){return this.map.isMoving()}isRotating(){return this.map.isRotating()}isSourceLoaded(e){return this.map.isSourceLoaded(e)}isStyleLoaded(){return this.map.isStyleLoaded()}isZooming(){return this.map.isZooming()}jumpTo(e,t){return this.map.jumpTo(e,t)}listImages(){return this.map.listImages()}listens(e){return this.map.listens(e)}loadImage(e){return this.map.loadImage(e)}loaded(){return this.map.loaded()}LngLatBounds(e,t){return new go.LngLatBounds(e,t)}addProtocol(e,t){return this.map.addProtocol(e,t)}moveLayer(e,t){return this.map.moveLayer(e,t)}panBy(e,t,n){return this.map.panBy(e,t,n)}panTo(e,t,n){return this.map.panTo(e,t,n)}project(e){return this.map.project(e)}queryRenderedFeatures(e,t){return this.map.queryRenderedFeatures(e,t)}querySourceFeatures(e,t){return this.map.querySourceFeatures(e,t)}queryTerrainElevation(e){return this.map.queryTerrainElevation(e)}redraw(){return this.map.redraw()}remove(){return this.map.remove()}removeControl(e){return this.map.removeControl(e)}removeFeatureState(e,t){return this.map.removeFeatureState(e,t)}removeImage(e){return this.map.removeImage(e)}removeLayer(e){try{this.map.removeLayer(e)}catch(t){console.error(`Error removing layer: ${t.message}`)}}removeSource(e){try{this.map.removeSource(e)}catch(t){console.error(`Error removing source: ${t.message}`)}}removeSprite(e){return this.map.removeSprite(e)}resetNorth(e,t){return this.map.resetNorth(e,t)}resetNorthPitch(e,t){return this.map.resetNorthPitch(e,t)}resize(e){return this.map.resize(e)}rotateTo(e,t,n){return this.map.rotateTo(e,t,n)}setBearing(e,t){return this.map.setBearing(e,t)}setCenter(e,t){return this.map.setCenter(e,t)}setEventedParent(e,t){return this.map.setEventedParent(e,t)}setFeatureState(e,t){return this.map.setFeatureState(e,t)}setFilter(e,t,n){return this.map.setFilter(e,t,n)}setGlyphs(e,t){return this.map.setGlyphs(e,t)}setLayerZoomRange(e,t,n){return this.map.setLayerZoomRange(e,t,n)}setLayoutProperty(e,t,n,i){return this.map.setLayoutProperty(e,t,n,i)}setLight(e,t){return this.map.setLight(e,t)}setMaxBounds(e){return this.map.setMaxBounds(e)}setMaxPitch(e){return this.map.setMaxPitch(e)}setMaxZoom(e){return this.map.setMaxZoom(e)}setMinPitch(e){return this.map.setMinPitch(e)}setMinZoom(e){return this.map.setMinZoom(e)}setPadding(e,t){return this.map.setPadding(e,t)}setPaintProperty(e,t,n,i){return this.map.setPaintProperty(e,t,n,i)}setPitch(e,t){return this.map.setPitch(e,t)}setPixelRatio(e){return this.map.setPixelRatio(e)}setRenderWorldCopies(e){return this.map.setRenderWorldCopies(e)}setSprite(e,t){return this.map.setSprite(e,t)}setTerrain(e){return this.map.setTerrain(e)}setTransformRequest(e){return this.map.setTransformRequest(e)}setZoom(e,t){return this.map.setZoom(e,t)}snapToNorth(e,t){return this.map.snapToNorth(e,t)}stop(){return this.map.stop()}triggerRepaint(){return this.map.triggerRepaint()}unproject(e){return this.map.unproject(e)}updateImage(e,t){return this.map.updateImage(e,t)}zoomIn(e,t){return this.map.zoomIn(e,t)}zoomOut(e,t){return this.map.zoomOut(e,t)}zoomTo(e,t,n){return this.map.zoomTo(e,t,n)}addLayerGeoJSON(e,t){try{let n=this._dealOrderLayer(t);this.map.addSource(`${e.id}`,{type:"geojson",data:e.data}),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:e.type,source:`${e.id}`,layout:e.layout,paint:e.paint},n)}catch(n){console.error(`Error adding GeoJSON layer: ${n.message}`)}}addLayerWMS(e,t,n){try{let i=this._dealOrderLayer(n.layerPosition);n?(this.map.addSource(`${t}`,{type:"raster",tiles:[e],tileSize:256},i),this.map.addLayer({id:t,type:"raster",source:t,layout:n.layout,paint:n.paint},i)):(this.map.addSource(`${t}`,{type:"raster",tiles:[e],tileSize:256},i),this.map.addLayer({id:t,type:"raster",source:t,paint:{}},i))}catch(i){console.error(`Error adding WMS layer: ${i.message}`)}}addLogo(e){try{let t=document.getElementById("map"),n;n=document.createElement("div"),n.id="logos",t.appendChild(n);const i=document.createElement("img");i.src=e.url,i.style.height=e.height;const s=document.getElementById("logos"),a=document.createElement("a");a.id=e.id,a.href=e.href,a.target="_blank",a.style.position="relative",a.style.bottom="1px",a.appendChild(i),s.appendChild(a)}catch(t){console.error(`Error adding logo: ${t.message}`)}}addBasemapsICGC(e){try{const t=a=>{this.map.setStyle(a)};let n=document.getElementById("map"),i;i=document.createElement("div"),i.id="basemap-group",i.classList.add="filter-group",n.appendChild(i);const s=document.getElementById("basemap-group");for(const a of e)for(const o of Object.keys(gi.baseStyles)){const u=gi.baseStyles[o];if(a===u.url){const d=document.createElement("div");d.className="basemap-item",d.title=u.key,d.style.backgroundImage=`url('${u.image}')`,s.appendChild(d),d.addEventListener("click",()=>t(u.url))}}}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addBasemaps(e){try{const t=a=>{map.setStyle(a.url)};let n=document.getElementById("map"),i;i=document.createElement("div"),i.id="basemap-group",i.classList.add="basemap-group",n.appendChild(i);const s=document.getElementById("basemap-group");e.forEach(a=>{const o=document.createElement("div");o.className="basemap-item",o.title=a.label,o.style.backgroundImage=`url('${a.image}')`,s.appendChild(o),o.addEventListener("click",()=>t(a))})}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addFeatureQuery(e,t,n){try{let i;this.map.on("mouseenter",e,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",e,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",s=>{let a=this.map.queryRenderedFeatures(s.point);if(a&&a[0].source.includes(e)){let o=[s.lngLat.lng,s.lngLat.lat];if(t!==void 0&&t.length>0&&t!=="all"){if(t!==null){let u="";t.forEach(d=>{let p=a[0].properties[d];u=u+`<h4>${p}</h4>`}),i=u,this.addPopup(o,i,n)}}else{let u="";for(const d in a[0].properties)u+="<b>"+d+"</b>:"+a[0].properties[d]+"<br>";i=u,this.addPopup(o,i,n)}}})}catch(i){console.error(`Error adding feature query: ${i.message}`)}}addScaleControl(e,t){try{var n=new go.ScaleControl(e);this.map.addControl(n,t)}catch(i){console.error(`Error adding scale: ${i.message}`)}}addExportControl(e,t){try{typeof e=="string"&&(t=e,e=void 0),e===void 0&&(e={PageSize:ad.A4,PageOrientation:t_.Landscape,Format:Nh.PNG,DPI:MB[300],Crosshair:!0,PrintableArea:!0,Local:"ca"},t="top-right"),this.map.addControl(new Hde(e),t)}catch(n){console.error(`Error adding export control: ${n.message}`)}}addMarker(e){try{let t,n;return e.text===void 0?t=new go.Marker(e.options).setLngLat(e.coord).addTo(this.map):(n=new go.Popup({offset:e.textOffset}).setHTML(e.text),t=new go.Marker(e.options).setLngLat(e.coord).setPopup(n).addTo(this.map)),t}catch(t){return console.error(`Error adding marker: ${t.message}`),null}}addPopup(e,t,n){try{return n.image===void 0?new go.Popup().setLngLat(e).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${n.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
 ${t}
          </div>
          <div class="popupBottomDown">
          </div>
          </div>
        </div>
      `).addTo(this.map):new go.Popup().setLngLat(e).setHTML(`
        <div class="popupBody">
          <div class="popupTop">
          ${n.title}
          </div>
          <div class="popupBottom">
          <div class="popupBottomUp">
          ${t}
          </div>
          <div class="popupBottomDown">
             <img style="  padding: 8px;  width: 50%;" src=${n.image} />
          </div>
          </div>
        </div>
      `).addTo(this.map)}catch(i){return console.error(`Error adding popup: ${i.message}`),null}}addFullScreen(e){try{e===void 0&&(e="top-right"),this.map.addControl(new go.FullscreenControl,e)}catch(t){console.error(`Error adding fullscreen control: ${t.message}`)}}addMenuItem(e){try{let t;if(e.includes("-userFieldFilter-")?t=e.split("-userFieldFilter-")[0]:t=e,e.length>0){const n=document.getElementById("menu-group"),i=document.createElement("input");i.type="checkbox",i.id=e,i.checked=!0,n.appendChild(i);const s=document.createElement("label");s.setAttribute("for",e),s.textContent=t,n.appendChild(s),i.addEventListener("change",a=>{this.map.setLayoutProperty(e,"visibility",a.target.checked?"visible":"none")})}}catch(t){console.error(`Error adding menu item: ${t.message}`)}}addLayerTree(e){try{let t=e.features,n=document.getElementById("map"),i=document.createElement("nav");i.id="filter-group",n.appendChild(i);const s=document.getElementById("filter-group");this.map.addSource(`${e.id}`,{type:e.type,data:t}),t.features.forEach(a=>{const o=a.properties.icon,u=`poi-${o}`;if(!this.map.getLayer(u)){this.map.addLayer({id:u,type:"circle",source:`${e.id}`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",o]},this._firstSymbolLayer());const d=document.createElement("input");d.type="checkbox",d.id=u,d.checked=!0,s.appendChild(d);const p=document.createElement("label");p.setAttribute("for",u),p.textContent=o,s.appendChild(p),d.addEventListener("change",b=>{this.map.setLayoutProperty(u,"visibility",b.target.checked?"visible":"none")})}})}catch(t){console.error(`Error adding layer tree: ${t.message}`)}}createNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new go.NavigationControl(e),t)}catch(n){return console.error(`Error creating navigation control: ${n.message}`),null}}addNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new go.NavigationControl(e),t)}catch(n){console.error(`Error adding navigation control: ${n.message}`)}}addAttributionControl(e,t){try{this.map.addControl(new go.AttributionControl(e),t)}catch(n){console.error(`Error adding attribution control: ${n.message}`)}}addImageLayerICGC(e,t,n){try{let i=null,s,a;n?(a=n,s=n.layerPosition):a={type:"raster",layout:{visibility:"visible"},paint:{"raster-opacity":1},layerPosition:$b},i=this._findImageType(e,Bs.Orto,Bs.VectorAdmin,Bs.WMS,Bs.Vector),i||console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");let o={id:t,tiles:e};this.addLayerWMS(e,t,a)}catch(i){console.error(`Error adding ICGC image layer: ${i.message}`)}}async addVectorLayerICGC(e,t,n){try{let{type:i="line",layerPosition:s=$b,layoutOptions:a={visibility:"visible"},paintOption:o}=n||{},u=this._dealOrderLayer(s);if(!e){console.log("❌ %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");return}if(e.includes("https")){let d=this._getKeyByUrlVector(e);this.map.addSource(d,{type:"vector",url:e});let p={id:d,type:"fill",source:d,"source-layer":"cobertes",maxzoom:18,layout:n.layout,paint:kge.cobertesSol};if(d==="cobertes2018"&&this.map.addLayer(p,u),a.visibility==="visible"){let b=this._getLegendByName(d);this.addLegend(b,d)}}else{let d=t;this.map.addSource(d,{type:"vector",url:gi.limitsUrl});let p={id:t,type:i,source:d,"source-layer":e,layout:n.layout,paint:n.paint||{}};i==="fill"||i==="polygon"?p.paint=o||{"fill-color":"#0000FF","fill-opacity":0}:i==="line"&&(p.paint=o||{"line-color":"#4832a8","line-opacity":1,"line-width":1}),this.map.addLayer(p,u)}}catch(i){console.error(`Error adding ICGC vector layer: ${i.message}`)}}async addFGBLayerICGC(e,t,n){try{n||(n.layout={visibility:!0},n.paint={"line-color":"#4832a8","line-opacity":1,"line-width":1},n.type="lines",n.layerPosition="labels");let i=this._dealOrderLayer(n.layerPosition);const s=await fetch(e),a={type:"FeatureCollection",features:[]};for await(const u of GI(s.body))a.features.push(u);let o=t;this.map.addSource(o,{type:"geojson",data:a}),e.includes("text")?this.map.addLayer({id:t,type:"symbol",source:o,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:n.layout.visibility,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},i):this.map.addLayer({id:t,type:n.type,source:o,layout:n.layout,paint:n.paint},i)}catch(i){console.error(`Error adding ICGC FGB layer: ${i.message}`)}}addTerrainICGC(e,t){try{let n;for(const s in cg)if(cg.hasOwnProperty(s)){const a=cg[s];a===e&&(n=a)}let i=n;this.getSource("terrainICGC")!==void 0&&(this.getStyle().layers.forEach(a=>{a.source==="terrainICGC"&&this.removeLayer(a.id)}),this.removeSource("terrainICGC")),this.getSource("terrainICGC")===void 0&&(e.includes("terrarium")?this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[i],tileSize:256,maxzoom:14,minzoom:7})),this.map.setTerrain({source:"terrainICGC",exaggeration:1.5}),t==null||this.map.addControl(new pj({pitch:90,bearing:null,minpitchzoom:null}),t)}catch(n){console.error(`Error adding 3D terrain: ${n.message}`)}}addLegend(e,t){try{this.map.addControl(new lpe({url:e,idLayer:t}))}catch(n){console.error(`Error adding legend: ${n.message}`)}}_findImageType(e,t,n,i,s){const a=[t,n,i,s];for(const o of a)for(const[u,d]of Object.entries(o))if(d===e)return u;return null}_getKeyByUrlFGB(e){for(const t in Bs.FGBAdmin)if(Bs.FGBAdmin.hasOwnProperty(t)&&Bs.FGBAdmin[t]===e)return t;return null}_getLegendByName(e){for(const t in gi.vectorLayers){const n=gi.vectorLayers[t];if(n.key===e)return n.legend}return null}_getKeyByUrlVector(e){for(const t in Bs.Vector)if(Bs.Vector.hasOwnProperty(t)&&Bs.Vector[t]===e)return t;return null}async _raiseText3DStyle(){try{const e=await this.map.loadImage(gi.map3dOptions.imageIcon);this.map.hasImage("stick")||this.map.addImage("stick",e.data),this.map.getStyle().layers.forEach(t=>{if(t["source-layer"]===gi.map3dOptions.sourceLayerFilterId&&t.minzoom>=gi.map3dOptions.minZoomFilter&&e){const n=t.id;this.map.setLayoutProperty(n,"icon-image","stick"),this.map.setLayoutProperty(n,"text-offset",[0,-9]),this.map.setLayoutProperty(n,"symbol-placement","point"),this.map.setLayoutProperty(n,"symbol-avoid-edges",!1),this.map.setLayoutProperty(n,"text-allow-overlap",!0),this.map.setLayoutProperty(n,"text-ignore-placement",!1),this.map.setLayoutProperty(n,"text-pitch-alignment","auto"),this.map.setLayoutProperty(n,"text-rotation-alignment","auto"),this.map.setLayoutProperty(n,"text-justify","center"),this.map.setLayoutProperty(n,"text-anchor","bottom"),this.map.setLayoutProperty(n,"icon-anchor","bottom"),this.map.setPaintProperty(n,"text-color","#ffffff"),this.map.setPaintProperty(n,"text-halo-color","#000000"),this.map.setPaintProperty(n,"text-halo-width",2)}})}catch(e){return console.error(`Error dealing orto 3D: ${e.message}`),null}}_dealStyleMaps(e){try{if(e&&e.indexOf("icgc.cat")!=-1){for(const t in yd)if(yd.hasOwnProperty(t)){const n=yd[t];if(t===e)return n}return yd[0]}else return e}catch(t){return console.error(`Error dealing with map styles: ${t.message}`),null}}_dealOrto3dStyle(e){try{if(e=="orto3d"){this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const t=new s4({intensity:4}),n=new E2({ambientLight:t});this.map.setTerrain({source:gi.map3dOptions.terrainSource,exaggeration:gi.map3dOptions.exaggeration}),eu=new yne({interleaved:!0,layers:[this._createCitiesMapboxLayer(!1)],effects:[n],onAfterRender:()=>{try{const s=this.map.getZoom()>=gi.map3dOptions.minZoomRange;eu.setProps({layers:[this._createCitiesMapboxLayer(s)]})}catch{console.log("No render 3D Mesh")}}}),this.map.hasControl(eu)||(this.map.addControl(eu),this._raiseText3DStyle()),this.map.setSky({"sky-color":"#86bbd5","sky-horizon-blend":.3,"horizon-color":"#ffffff33","horizon-fog-blend":.1,"fog-ground-blend":.75,"fog-color":"#c5d6d6"}),this.map.on("zoomend",()=>{!this.map.getStyle().name=="orto3d"&&this.map.hasControl(eu)&&(this.map.removeControl(eu),eu.setProps({layers:[]}),this.map.setTerrain(null))})}else eu?.setProps({layers:[]}),this.map.hasControl(eu)&&(this.map.removeControl(eu),eu.setProps({layers:[]}),this.map.setTerrain(null))}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_dealOrderLayer(e){return e===$b?this._firstSymbolLayer():e===Nge?this._firstLineLayer():""}_firstSymbolLayer(){try{const e=this.map.getStyle().layers;let t;for(let n=0;n<e.length;n++)if(e[n].type==="symbol"&&e[n].id.indexOf("contour")===-1&&e[n].id.indexOf("water")===-1){t=e[n].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_firstLineLayer(){try{const e=this.map.getStyle().layers;let t;for(let n=0;n<e.length;n++)if(e[n].type==="line"){t=e[n].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_createCitiesMapboxLayer(e=!1){try{return new PB({id:gi.map3dOptions.layerId3d,data:gi.map3dOptions.urlTilesetCities,loader:IB,beforeId:gi.map3dOptions.layerIdOrder,visible:e,loadOptions:{tileset:{viewDistanceScale:1,memoryAdjustedScreenSpaceError:gi.map3dOptions.spaceErrorFactor,updateTransforms:!0,adjustScreenSpaceError:gi.map3dOptions.spaceErrorFactor}},onTilesetLoad:t=>{t.adjustScreenSpaceError=gi.map3dOptions.spaceErrorFactor,t.memoryAdjustedScreenSpaceError=gi.map3dOptions.spaceErrorFactor},onTileLoad:t=>{t.content.cartographicOrigin.z-=gi.map3dOptions.zfactor},operation:"terrain+draw",pickable:!1})}catch(t){return console.error(`Error adding MapboxOverlay: ${t.message}`),null}}};var FC={exports:{}},RC,Ak;function Qge(){if(Ak)return RC;Ak=1;function r(t,n){var i=t.getCenter(),s=t.getZoom(),a=t.getBearing(),o=t.getPitch();n.forEach(function(u){u.jumpTo({center:i,zoom:s,bearing:a,pitch:o})})}function e(){var t,n=arguments.length;if(n===1)t=arguments[0];else{t=[];for(var i=0;i<n;i++)t.push(arguments[i])}var s=[];t.forEach(function(d,p){s[p]=u.bind(null,d,t.filter(function(b,C){return C!==p}))});function a(){t.forEach(function(d,p){d.on("move",s[p])})}function o(){t.forEach(function(d,p){d.off("move",s[p])})}function u(d,p){o(),r(d,p),a()}return a(),function(){o(),s=[],t=[]}}return RC=e,RC}var Gb={exports:{}},fk;function Hge(){if(fk)return Gb.exports;fk=1;var r=typeof Reflect=="object"?Reflect:null,e=r&&typeof r.apply=="function"?r.apply:function(q,W,ie){return Function.prototype.apply.call(q,W,ie)},t;r&&typeof r.ownKeys=="function"?t=r.ownKeys:Object.getOwnPropertySymbols?t=function(q){return Object.getOwnPropertyNames(q).concat(Object.getOwnPropertySymbols(q))}:t=function(q){return Object.getOwnPropertyNames(q)};function n(N){console&&console.warn&&console.warn(N)}var i=Number.isNaN||function(q){return q!==q};function s(){s.init.call(this)}Gb.exports=s,Gb.exports.once=D,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(N){if(typeof N!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof N)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(N){if(typeof N!="number"||N<0||i(N))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+N+".");a=N}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(q){if(typeof q!="number"||q<0||i(q))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+q+".");return this._maxListeners=q,this};function u(N){return N._maxListeners===void 0?s.defaultMaxListeners:N._maxListeners}s.prototype.getMaxListeners=function(){return u(this)},s.prototype.emit=function(q){for(var W=[],ie=1;ie<arguments.length;ie++)W.push(arguments[ie]);var se=q==="error",Z=this._events;if(Z!==void 0)se=se&&Z.error===void 0;else if(!se)return!1;if(se){var fe;if(W.length>0&&(fe=W[0]),fe instanceof Error)throw fe;var te=new Error("Unhandled error."+(fe?" ("+fe.message+")":""));throw te.context=fe,te}var ce=Z[q];if(ce===void 0)return!1;if(typeof ce=="function")e(ce,this,W);else for(var ve=ce.length,me=M(ce,ve),ie=0;ie<ve;++ie)e(me[ie],this,W);return!0};function d(N,q,W,ie){var se,Z,fe;if(o(W),Z=N._events,Z===void 0?(Z=N._events=Object.create(null),N._eventsCount=0):(Z.newListener!==void 0&&(N.emit("newListener",q,W.listener?W.listener:W),Z=N._events),fe=Z[q]),fe===void 0)fe=Z[q]=W,++N._eventsCount;else if(typeof fe=="function"?fe=Z[q]=ie?[W,fe]:[fe,W]:ie?fe.unshift(W):fe.push(W),se=u(N),se>0&&fe.length>se&&!fe.warned){fe.warned=!0;var te=new Error("Possible EventEmitter memory leak detected. "+fe.length+" "+String(q)+" listeners added. Use emitter.setMaxListeners() to increase limit");te.name="MaxListenersExceededWarning",te.emitter=N,te.type=q,te.count=fe.length,n(te)}return N}s.prototype.addListener=function(q,W){return d(this,q,W,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(q,W){return d(this,q,W,!0)};function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function b(N,q,W){var ie={fired:!1,wrapFn:void 0,target:N,type:q,listener:W},se=p.bind(ie);return se.listener=W,ie.wrapFn=se,se}s.prototype.once=function(q,W){return o(W),this.on(q,b(this,q,W)),this},s.prototype.prependOnceListener=function(q,W){return o(W),this.prependListener(q,b(this,q,W)),this},s.prototype.removeListener=function(q,W){var ie,se,Z,fe,te;if(o(W),se=this._events,se===void 0)return this;if(ie=se[q],ie===void 0)return this;if(ie===W||ie.listener===W)--this._eventsCount===0?this._events=Object.create(null):(delete se[q],se.removeListener&&this.emit("removeListener",q,ie.listener||W));else if(typeof ie!="function"){for(Z=-1,fe=ie.length-1;fe>=0;fe--)if(ie[fe]===W||ie[fe].listener===W){te=ie[fe].listener,Z=fe;break}if(Z<0)return this;Z===0?ie.shift():P(ie,Z),ie.length===1&&(se[q]=ie[0]),se.removeListener!==void 0&&this.emit("removeListener",q,te||W)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(q){var W,ie,se;if(ie=this._events,ie===void 0)return this;if(ie.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):ie[q]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete ie[q]),this;if(arguments.length===0){var Z=Object.keys(ie),fe;for(se=0;se<Z.length;++se)fe=Z[se],fe!=="removeListener"&&this.removeAllListeners(fe);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(W=ie[q],typeof W=="function")this.removeListener(q,W);else if(W!==void 0)for(se=W.length-1;se>=0;se--)this.removeListener(q,W[se]);return this};function C(N,q,W){var ie=N._events;if(ie===void 0)return[];var se=ie[q];return se===void 0?[]:typeof se=="function"?W?[se.listener||se]:[se]:W?k(se):M(se,se.length)}s.prototype.listeners=function(q){return C(this,q,!0)},s.prototype.rawListeners=function(q){return C(this,q,!1)},s.listenerCount=function(N,q){return typeof N.listenerCount=="function"?N.listenerCount(q):w.call(N,q)},s.prototype.listenerCount=w;function w(N){var q=this._events;if(q!==void 0){var W=q[N];if(typeof W=="function")return 1;if(W!==void 0)return W.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function M(N,q){for(var W=new Array(q),ie=0;ie<q;++ie)W[ie]=N[ie];return W}function P(N,q){for(;q+1<N.length;q++)N[q]=N[q+1];N.pop()}function k(N){for(var q=new Array(N.length),W=0;W<q.length;++W)q[W]=N[W].listener||N[W];return q}function D(N,q){return new Promise(function(W,ie){function se(fe){N.removeListener(q,Z),ie(fe)}function Z(){typeof N.removeListener=="function"&&N.removeListener("error",se),W([].slice.call(arguments))}H(N,q,Z,{once:!0}),q!=="error"&&j(N,se,{once:!0})})}function j(N,q,W){typeof N.on=="function"&&H(N,"error",q,W)}function H(N,q,W,ie){if(typeof N.on=="function")ie.once?N.once(q,W):N.on(q,W);else if(typeof N.addEventListener=="function")N.addEventListener(q,function se(Z){ie.once&&N.removeEventListener(q,se),W(Z)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof N)}return Gb.exports}var dk;function Vge(){return dk||(dk=1,function(r){var e=Qge(),t=Hge().EventEmitter;function n(i,s,a,o){if(this.options=o||{},this._mapA=i,this._mapB=s,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new t,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof a=="string"&&document.body.querySelectorAll){var u=document.body.querySelectorAll(a)[0];if(!u)throw new Error("Cannot find element with specified container selector.");u.appendChild(this._controlContainer)}else if(a instanceof Element&&a.appendChild)a.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=s.getContainer().getBoundingClientRect();var d=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(d),this._clearSync=e(i,s),this._onResize=(function(){this._bounds=s.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),s.on("resize",this._onResize),this.options&&this.options.mousemove&&(i.getContainer().addEventListener("mousemove",this._onMove),s.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}n.prototype={_setPointerEvents:function(i){this._controlContainer.style.pointerEvents=i,this._swiper.style.pointerEvents=i},_onDown:function(i){i.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(i){i=Math.min(i,this._horizontal?this._bounds.height:this._bounds.width);var s=this._horizontal?"translate(0, "+i+"px)":"translate("+i+"px, 0)";this._controlContainer.style.transform=s,this._controlContainer.style.WebkitTransform=s;var a=this._horizontal?"rect(0, 999em, "+i+"px, 0)":"rect(0, "+i+"px, "+this._bounds.height+"px, 0)",o=this._horizontal?"rect("+i+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+i+"px)";this._mapA.getContainer().style.clip=a,this._mapB.getContainer().style.clip=o,this.currentPosition=i},_onMove:function(i){this.options&&this.options.mousemove&&this._setPointerEvents(i.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(i)):this._setPosition(this._getX(i))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(i){i=i.touches?i.touches[0]:i;var s=i.clientX-this._bounds.left;return s<0&&(s=0),s>this._bounds.width&&(s=this._bounds.width),s},_getY:function(i){i=i.touches?i.touches[0]:i;var s=i.clientY-this._bounds.top;return s<0&&(s=0),s>this._bounds.height&&(s=this._bounds.height),s},setSlider:function(i){this._setPosition(i)},on:function(i,s){return this._ev.on(i,s),this},fire:function(i,s){return this._ev.emit(i,s),this},off:function(i,s){return this._ev.removeListener(i,s),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var i=this._mapA.getContainer();i&&(i.style.clip=null,i.removeEventListener("mousemove",this._onMove));var s=this._mapB.getContainer();s&&(s.style.clip=null,s.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=n:r.exports=n}(FC)),FC.exports}var jge=Vge();const $ge=Sf(jge);class Gge{constructor(e,t,n,i){const s=this;setTimeout(function(){s.mapCompare=new $ge(e.map,t.map,n,{})},1e3)}}/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var LC=function(r,e){return LC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},LC(r,e)};function tu(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");LC(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var OC=function(){return OC=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},OC.apply(this,arguments)};function Ia(r,e,t,n){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(p){try{d(n.next(p))}catch(b){a(b)}}function u(p){try{d(n.throw(p))}catch(b){a(b)}}function d(p){p.done?s(p.value):i(p.value).then(o,u)}d((n=n.apply(r,[])).next())})}function pa(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(d){return function(p){return u([d,p])}}function u(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=d[0]&2?i.return:d[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,d[1])).done)return s;switch(i=0,s&&(d=[d[0]&2,s.value]),d[0]){case 0:case 1:s=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!s||d[1]>s[0]&&d[1]<s[3])){t.label=d[1];break}if(d[0]===6&&t.label<s[1]){t.label=s[1],s=d;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(d);break}s[2]&&t.ops.pop(),t.trys.pop();continue}d=e.call(r,t)}catch(p){d=[6,p],i=0}finally{n=s=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function Wb(r,e,t){if(arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||e)}for(var Vh=function(){function r(e,t,n,i){this.left=e,this.top=t,this.width=n,this.height=i}return r.prototype.add=function(e,t,n,i){return new r(this.left+e,this.top+t,this.width+n,this.height+i)},r.fromClientRect=function(e,t){return new r(t.left+e.windowBounds.left,t.top+e.windowBounds.top,t.width,t.height)},r.fromDOMRectList=function(e,t){var n=Array.from(t).find(function(i){return i.width!==0});return n?new r(n.left+e.windowBounds.left,n.top+e.windowBounds.top,n.width,n.height):r.EMPTY},r.EMPTY=new r(0,0,0,0),r}(),qb=function(r,e){return Vh.fromClientRect(r,e.getBoundingClientRect())},Wge=function(r){var e=r.body,t=r.documentElement;if(!e||!t)throw new Error("Unable to get document size");var n=Math.max(Math.max(e.scrollWidth,t.scrollWidth),Math.max(e.offsetWidth,t.offsetWidth),Math.max(e.clientWidth,t.clientWidth)),i=Math.max(Math.max(e.scrollHeight,t.scrollHeight),Math.max(e.offsetHeight,t.offsetHeight),Math.max(e.clientHeight,t.clientHeight));return new Vh(0,0,n,i)},Kb=function(r){for(var e=[],t=0,n=r.length;t<n;){var i=r.charCodeAt(t++);if(i>=55296&&i<=56319&&t<n){var s=r.charCodeAt(t++);(s&64512)===56320?e.push(((i&1023)<<10)+(s&1023)+65536):(e.push(i),t--)}else e.push(i)}return e},ks=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var t=r.length;if(!t)return"";for(var n=[],i=-1,s="";++i<t;){var a=r[i];a<=65535?n.push(a):(a-=65536,n.push((a>>10)+55296,a%1024+56320)),(i+1===t||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},pk="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qge=typeof Uint8Array>"u"?[]:new Uint8Array(256),Xb=0;Xb<pk.length;Xb++)qge[pk.charCodeAt(Xb)]=Xb;for(var gk="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p_=typeof Uint8Array>"u"?[]:new Uint8Array(256),Yb=0;Yb<gk.length;Yb++)p_[gk.charCodeAt(Yb)]=Yb;for(var Kge=function(r){var e=r.length*.75,t=r.length,n,i=0,s,a,o,u;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);var d=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),p=Array.isArray(d)?d:new Uint8Array(d);for(n=0;n<t;n+=4)s=p_[r.charCodeAt(n)],a=p_[r.charCodeAt(n+1)],o=p_[r.charCodeAt(n+2)],u=p_[r.charCodeAt(n+3)],p[i++]=s<<2|a>>4,p[i++]=(a&15)<<4|o>>2,p[i++]=(o&3)<<6|u&63;return d},Xge=function(r){for(var e=r.length,t=[],n=0;n<e;n+=2)t.push(r[n+1]<<8|r[n]);return t},Yge=function(r){for(var e=r.length,t=[],n=0;n<e;n+=4)t.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return t},bd=5,UC=11,DC=2,Zge=UC-bd,mk=65536>>bd,Jge=1<<bd,kC=Jge-1,eme=1024>>bd,tme=mk+eme,rme=tme,nme=32,ime=rme+nme,sme=65536>>UC,ome=1<<Zge,ame=ome-1,_k=function(r,e,t){return r.slice?r.slice(e,t):new Uint16Array(Array.prototype.slice.call(r,e,t))},lme=function(r,e,t){return r.slice?r.slice(e,t):new Uint32Array(Array.prototype.slice.call(r,e,t))},cme=function(r,e){var t=Kge(r),n=Array.isArray(t)?Yge(t):new Uint32Array(t),i=Array.isArray(t)?Xge(t):new Uint16Array(t),s=24,a=_k(i,s/2,n[4]/2),o=n[5]===2?_k(i,(s+n[4])/2):lme(n,Math.ceil((s+n[4])/4));return new ume(n[0],n[1],n[2],n[3],a,o)},ume=function(){function r(e,t,n,i,s,a){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=i,this.index=s,this.data=a}return r.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>bd],t=(t<<DC)+(e&kC),this.data[t];if(e<=65535)return t=this.index[mk+(e-55296>>bd)],t=(t<<DC)+(e&kC),this.data[t];if(e<this.highStart)return t=ime-sme+(e>>UC),t=this.index[t],t+=e>>bd&ame,t=this.index[t],t=(t<<DC)+(e&kC),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),yk="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",hme=typeof Uint8Array>"u"?[]:new Uint8Array(256),Zb=0;Zb<yk.length;Zb++)hme[yk.charCodeAt(Zb)]=Zb;var Ame="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",bk=50,fme=1,vk=2,wk=3,dme=4,pme=5,xk=7,Bk=8,Ck=9,XA=10,NC=11,Tk=12,zC=13,gme=14,g_=15,QC=16,Jb=17,m_=18,mme=19,Ek=20,HC=21,__=22,VC=23,ug=24,Il=25,y_=26,b_=27,hg=28,_me=29,Ag=30,yme=31,e1=32,t1=33,jC=34,$C=35,GC=36,v_=37,WC=38,r1=39,n1=40,qC=41,Sk=42,bme=43,vme=[9001,65288],Ik="!",Pa="×",i1="÷",KC=cme(Ame),jh=[Ag,GC],XC=[fme,vk,wk,pme],Pk=[XA,Bk],Mk=[b_,y_],wme=XC.concat(Pk),Fk=[WC,r1,n1,jC,$C],xme=[g_,zC],Bme=function(r,e){e===void 0&&(e="strict");var t=[],n=[],i=[];return r.forEach(function(s,a){var o=KC.get(s);if(o>bk?(i.push(!0),o-=bk):i.push(!1),["normal","auto","loose"].indexOf(e)!==-1&&[8208,8211,12316,12448].indexOf(s)!==-1)return n.push(a),t.push(QC);if(o===dme||o===NC){if(a===0)return n.push(a),t.push(Ag);var u=t[a-1];return wme.indexOf(u)===-1?(n.push(n[a-1]),t.push(u)):(n.push(a),t.push(Ag))}if(n.push(a),o===yme)return t.push(e==="strict"?HC:v_);if(o===Sk||o===_me)return t.push(Ag);if(o===bme)return s>=131072&&s<=196605||s>=196608&&s<=262141?t.push(v_):t.push(Ag);t.push(o)}),[n,t,i]},YC=function(r,e,t,n){var i=n[t];if(Array.isArray(r)?r.indexOf(i)!==-1:r===i)for(var s=t;s<=n.length;){s++;var a=n[s];if(a===e)return!0;if(a!==XA)break}if(i===XA)for(var s=t;s>0;){s--;var o=n[s];if(Array.isArray(r)?r.indexOf(o)!==-1:r===o)for(var u=t;u<=n.length;){u++;var a=n[u];if(a===e)return!0;if(a!==XA)break}if(o!==XA)break}return!1},Rk=function(r,e){for(var t=r;t>=0;){var n=e[t];if(n===XA)t--;else return n}return 0},Cme=function(r,e,t,n,i){if(t[n]===0)return Pa;var s=n-1;if(Array.isArray(i)&&i[s]===!0)return Pa;var a=s-1,o=s+1,u=e[s],d=a>=0?e[a]:0,p=e[o];if(u===vk&&p===wk)return Pa;if(XC.indexOf(u)!==-1)return Ik;if(XC.indexOf(p)!==-1||Pk.indexOf(p)!==-1)return Pa;if(Rk(s,e)===Bk)return i1;if(KC.get(r[s])===NC||(u===e1||u===t1)&&KC.get(r[o])===NC||u===xk||p===xk||u===Ck||[XA,zC,g_].indexOf(u)===-1&&p===Ck||[Jb,m_,mme,ug,hg].indexOf(p)!==-1||Rk(s,e)===__||YC(VC,__,s,e)||YC([Jb,m_],HC,s,e)||YC(Tk,Tk,s,e))return Pa;if(u===XA)return i1;if(u===VC||p===VC)return Pa;if(p===QC||u===QC)return i1;if([zC,g_,HC].indexOf(p)!==-1||u===gme||d===GC&&xme.indexOf(u)!==-1||u===hg&&p===GC||p===Ek||jh.indexOf(p)!==-1&&u===Il||jh.indexOf(u)!==-1&&p===Il||u===b_&&[v_,e1,t1].indexOf(p)!==-1||[v_,e1,t1].indexOf(u)!==-1&&p===y_||jh.indexOf(u)!==-1&&Mk.indexOf(p)!==-1||Mk.indexOf(u)!==-1&&jh.indexOf(p)!==-1||[b_,y_].indexOf(u)!==-1&&(p===Il||[__,g_].indexOf(p)!==-1&&e[o+1]===Il)||[__,g_].indexOf(u)!==-1&&p===Il||u===Il&&[Il,hg,ug].indexOf(p)!==-1)return Pa;if([Il,hg,ug,Jb,m_].indexOf(p)!==-1)for(var b=s;b>=0;){var C=e[b];if(C===Il)return Pa;if([hg,ug].indexOf(C)!==-1)b--;else break}if([b_,y_].indexOf(p)!==-1)for(var b=[Jb,m_].indexOf(u)!==-1?a:s;b>=0;){var C=e[b];if(C===Il)return Pa;if([hg,ug].indexOf(C)!==-1)b--;else break}if(WC===u&&[WC,r1,jC,$C].indexOf(p)!==-1||[r1,jC].indexOf(u)!==-1&&[r1,n1].indexOf(p)!==-1||[n1,$C].indexOf(u)!==-1&&p===n1||Fk.indexOf(u)!==-1&&[Ek,y_].indexOf(p)!==-1||Fk.indexOf(p)!==-1&&u===b_||jh.indexOf(u)!==-1&&jh.indexOf(p)!==-1||u===ug&&jh.indexOf(p)!==-1||jh.concat(Il).indexOf(u)!==-1&&p===__&&vme.indexOf(r[o])===-1||jh.concat(Il).indexOf(p)!==-1&&u===m_)return Pa;if(u===qC&&p===qC){for(var w=t[s],M=1;w>0&&(w--,e[w]===qC);)M++;if(M%2!==0)return Pa}return u===e1&&p===t1?Pa:i1},Tme=function(r,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var t=Bme(r,e.lineBreak),n=t[0],i=t[1],s=t[2];(e.wordBreak==="break-all"||e.wordBreak==="break-word")&&(i=i.map(function(o){return[Il,Ag,Sk].indexOf(o)!==-1?v_:o}));var a=e.wordBreak==="keep-all"?s.map(function(o,u){return o&&r[u]>=19968&&r[u]<=40959}):void 0;return[n,i,a]},Eme=function(){function r(e,t,n,i){this.codePoints=e,this.required=t===Ik,this.start=n,this.end=i}return r.prototype.slice=function(){return ks.apply(void 0,this.codePoints.slice(this.start,this.end))},r}(),Sme=function(r,e){var t=Kb(r),n=Tme(t,e),i=n[0],s=n[1],a=n[2],o=t.length,u=0,d=0;return{next:function(){if(d>=o)return{done:!0,value:null};for(var p=Pa;d<o&&(p=Cme(t,s,i,++d,a))===Pa;);if(p!==Pa||d===o){var b=new Eme(t,p,u,d);return u=d,{value:b,done:!1}}return{done:!0,value:null}}}},Ime=1,Pme=2,w_=4,Lk=8,s1=10,Ok=47,x_=92,Mme=9,Fme=32,o1=34,B_=61,Rme=35,Lme=36,Ome=37,a1=39,l1=40,C_=41,Ume=95,il=45,Dme=33,kme=60,Nme=62,zme=64,Qme=91,Hme=93,Vme=61,jme=123,c1=63,$me=125,Uk=124,Gme=126,Wme=128,Dk=65533,ZC=42,vd=43,qme=44,Kme=58,Xme=59,T_=46,Yme=0,Zme=8,Jme=11,e_e=14,t_e=31,r_e=127,Xu=-1,kk=48,Nk=97,zk=101,n_e=102,i_e=117,s_e=122,Qk=65,Hk=69,Vk=70,o_e=85,a_e=90,Ma=function(r){return r>=kk&&r<=57},l_e=function(r){return r>=55296&&r<=57343},fg=function(r){return Ma(r)||r>=Qk&&r<=Vk||r>=Nk&&r<=n_e},c_e=function(r){return r>=Nk&&r<=s_e},u_e=function(r){return r>=Qk&&r<=a_e},h_e=function(r){return c_e(r)||u_e(r)},A_e=function(r){return r>=Wme},u1=function(r){return r===s1||r===Mme||r===Fme},h1=function(r){return h_e(r)||A_e(r)||r===Ume},jk=function(r){return h1(r)||Ma(r)||r===il},f_e=function(r){return r>=Yme&&r<=Zme||r===Jme||r>=e_e&&r<=t_e||r===r_e},YA=function(r,e){return r!==x_?!1:e!==s1},A1=function(r,e,t){return r===il?h1(e)||YA(e,t):h1(r)?!0:!!(r===x_&&YA(r,e))},JC=function(r,e,t){return r===vd||r===il?Ma(e)?!0:e===T_&&Ma(t):Ma(r===T_?e:r)},d_e=function(r){var e=0,t=1;(r[e]===vd||r[e]===il)&&(r[e]===il&&(t=-1),e++);for(var n=[];Ma(r[e]);)n.push(r[e++]);var i=n.length?parseInt(ks.apply(void 0,n),10):0;r[e]===T_&&e++;for(var s=[];Ma(r[e]);)s.push(r[e++]);var a=s.length,o=a?parseInt(ks.apply(void 0,s),10):0;(r[e]===Hk||r[e]===zk)&&e++;var u=1;(r[e]===vd||r[e]===il)&&(r[e]===il&&(u=-1),e++);for(var d=[];Ma(r[e]);)d.push(r[e++]);var p=d.length?parseInt(ks.apply(void 0,d),10):0;return t*(i+o*Math.pow(10,-a))*Math.pow(10,u*p)},p_e={type:2},g_e={type:3},m_e={type:4},__e={type:13},y_e={type:8},b_e={type:21},v_e={type:9},w_e={type:10},x_e={type:11},B_e={type:12},C_e={type:14},f1={type:23},T_e={type:1},E_e={type:25},S_e={type:24},I_e={type:26},P_e={type:27},M_e={type:28},F_e={type:29},R_e={type:31},eT={type:32},$k=function(){function r(){this._value=[]}return r.prototype.write=function(e){this._value=this._value.concat(Kb(e))},r.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==eT;)e.push(t),t=this.consumeToken();return e},r.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case o1:return this.consumeStringToken(o1);case Rme:var t=this.peekCodePoint(0),n=this.peekCodePoint(1),i=this.peekCodePoint(2);if(jk(t)||YA(n,i)){var s=A1(t,n,i)?Pme:Ime,a=this.consumeName();return{type:5,value:a,flags:s}}break;case Lme:if(this.peekCodePoint(0)===B_)return this.consumeCodePoint(),__e;break;case a1:return this.consumeStringToken(a1);case l1:return p_e;case C_:return g_e;case ZC:if(this.peekCodePoint(0)===B_)return this.consumeCodePoint(),C_e;break;case vd:if(JC(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case qme:return m_e;case il:var o=e,u=this.peekCodePoint(0),d=this.peekCodePoint(1);if(JC(o,u,d))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(A1(o,u,d))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(u===il&&d===Nme)return this.consumeCodePoint(),this.consumeCodePoint(),S_e;break;case T_:if(JC(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case Ok:if(this.peekCodePoint(0)===ZC)for(this.consumeCodePoint();;){var p=this.consumeCodePoint();if(p===ZC&&(p=this.consumeCodePoint(),p===Ok))return this.consumeToken();if(p===Xu)return this.consumeToken()}break;case Kme:return I_e;case Xme:return P_e;case kme:if(this.peekCodePoint(0)===Dme&&this.peekCodePoint(1)===il&&this.peekCodePoint(2)===il)return this.consumeCodePoint(),this.consumeCodePoint(),E_e;break;case zme:var b=this.peekCodePoint(0),C=this.peekCodePoint(1),w=this.peekCodePoint(2);if(A1(b,C,w)){var a=this.consumeName();return{type:7,value:a}}break;case Qme:return M_e;case x_:if(YA(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case Hme:return F_e;case Vme:if(this.peekCodePoint(0)===B_)return this.consumeCodePoint(),y_e;break;case jme:return x_e;case $me:return B_e;case i_e:case o_e:var M=this.peekCodePoint(0),P=this.peekCodePoint(1);return M===vd&&(fg(P)||P===c1)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case Uk:if(this.peekCodePoint(0)===B_)return this.consumeCodePoint(),v_e;if(this.peekCodePoint(0)===Uk)return this.consumeCodePoint(),b_e;break;case Gme:if(this.peekCodePoint(0)===B_)return this.consumeCodePoint(),w_e;break;case Xu:return eT}return u1(e)?(this.consumeWhiteSpace(),R_e):Ma(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):h1(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:ks(e)}},r.prototype.consumeCodePoint=function(){var e=this._value.shift();return typeof e>"u"?-1:e},r.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},r.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},r.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();fg(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var n=!1;t===c1&&e.length<6;)e.push(t),t=this.consumeCodePoint(),n=!0;if(n){var i=parseInt(ks.apply(void 0,e.map(function(u){return u===c1?kk:u})),16),s=parseInt(ks.apply(void 0,e.map(function(u){return u===c1?Vk:u})),16);return{type:30,start:i,end:s}}var a=parseInt(ks.apply(void 0,e),16);if(this.peekCodePoint(0)===il&&fg(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var o=[];fg(t)&&o.length<6;)o.push(t),t=this.consumeCodePoint();var s=parseInt(ks.apply(void 0,o),16);return{type:30,start:a,end:s}}else return{type:30,start:a,end:a}},r.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return e.toLowerCase()==="url"&&this.peekCodePoint(0)===l1?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===l1?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},r.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Xu)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===a1||t===o1){var n=this.consumeStringToken(this.consumeCodePoint());return n.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Xu||this.peekCodePoint(0)===C_)?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),f1)}for(;;){var i=this.consumeCodePoint();if(i===Xu||i===C_)return{type:22,value:ks.apply(void 0,e)};if(u1(i))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Xu||this.peekCodePoint(0)===C_?(this.consumeCodePoint(),{type:22,value:ks.apply(void 0,e)}):(this.consumeBadUrlRemnants(),f1);if(i===o1||i===a1||i===l1||f_e(i))return this.consumeBadUrlRemnants(),f1;if(i===x_)if(YA(i,this.peekCodePoint(0)))e.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),f1;else e.push(i)}},r.prototype.consumeWhiteSpace=function(){for(;u1(this.peekCodePoint(0));)this.consumeCodePoint()},r.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===C_||e===Xu)return;YA(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},r.prototype.consumeStringSlice=function(e){for(var t=5e4,n="";e>0;){var i=Math.min(t,e);n+=ks.apply(void 0,this._value.splice(0,i)),e-=i}return this._value.shift(),n},r.prototype.consumeStringToken=function(e){var t="",n=0;do{var i=this._value[n];if(i===Xu||i===void 0||i===e)return t+=this.consumeStringSlice(n),{type:0,value:t};if(i===s1)return this._value.splice(0,n),T_e;if(i===x_){var s=this._value[n+1];s!==Xu&&s!==void 0&&(s===s1?(t+=this.consumeStringSlice(n),n=-1,this._value.shift()):YA(i,s)&&(t+=this.consumeStringSlice(n),t+=ks(this.consumeEscapedCodePoint()),n=-1))}n++}while(!0)},r.prototype.consumeNumber=function(){var e=[],t=w_,n=this.peekCodePoint(0);for((n===vd||n===il)&&e.push(this.consumeCodePoint());Ma(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0);var i=this.peekCodePoint(1);if(n===T_&&Ma(i))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=Lk;Ma(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0),i=this.peekCodePoint(1);var s=this.peekCodePoint(2);if((n===Hk||n===zk)&&((i===vd||i===il)&&Ma(s)||Ma(i)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=Lk;Ma(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[d_e(e),t]},r.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],n=e[1],i=this.peekCodePoint(0),s=this.peekCodePoint(1),a=this.peekCodePoint(2);if(A1(i,s,a)){var o=this.consumeName();return{type:15,number:t,flags:n,unit:o}}return i===Ome?(this.consumeCodePoint(),{type:16,number:t,flags:n}):{type:17,number:t,flags:n}},r.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(fg(e)){for(var t=ks(e);fg(this.peekCodePoint(0))&&t.length<6;)t+=ks(this.consumeCodePoint());u1(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(t,16);return n===0||l_e(n)||n>1114111?Dk:n}return e===Xu?Dk:e},r.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(jk(t))e+=ks(t);else if(YA(t,this.peekCodePoint(0)))e+=ks(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(t),e}},r}(),Gk=function(){function r(e){this._tokens=e}return r.create=function(e){var t=new $k;return t.write(e),new r(t.read())},r.parseValue=function(e){return r.create(e).parseComponentValue()},r.parseValues=function(e){return r.create(e).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===31;)e=this.consumeToken();if(e.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do e=this.consumeToken();while(e.type===31);if(e.type===32)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(t.type===32)return e;e.push(t),e.push()}},r.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},r.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},n=this.consumeToken();;){if(n.type===32||O_e(n,e))return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue()),n=this.consumeToken()}},r.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var n=this.consumeToken();if(n.type===32||n.type===3)return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var e=this._tokens.shift();return typeof e>"u"?eT:e},r.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},r}(),E_=function(r){return r.type===15},dg=function(r){return r.type===17},Ii=function(r){return r.type===20},L_e=function(r){return r.type===0},tT=function(r,e){return Ii(r)&&r.value===e},Wk=function(r){return r.type!==31},pg=function(r){return r.type!==31&&r.type!==4},Yu=function(r){var e=[],t=[];return r.forEach(function(n){if(n.type===4){if(t.length===0)throw new Error("Error parsing function args, zero tokens for arg");e.push(t),t=[];return}n.type!==31&&t.push(n)}),t.length&&e.push(t),e},O_e=function(r,e){return e===11&&r.type===12||e===28&&r.type===29?!0:e===2&&r.type===3},ZA=function(r){return r.type===17||r.type===15},eo=function(r){return r.type===16||ZA(r)},qk=function(r){return r.length>1?[r[0],r[1]]:[r[0]]},Wo={type:17,number:0,flags:w_},rT={type:16,number:50,flags:w_},JA={type:16,number:100,flags:w_},S_=function(r,e,t){var n=r[0],i=r[1];return[Qi(n,e),Qi(typeof i<"u"?i:n,t)]},Qi=function(r,e){if(r.type===16)return r.number/100*e;if(E_(r))switch(r.unit){case"rem":case"em":return 16*r.number;case"px":default:return r.number}return r.number},Kk="deg",Xk="grad",Yk="rad",Zk="turn",d1={name:"angle",parse:function(r,e){if(e.type===15)switch(e.unit){case Kk:return Math.PI*e.number/180;case Xk:return Math.PI/200*e.number;case Yk:return e.number;case Zk:return Math.PI*2*e.number}throw new Error("Unsupported angle type")}},Jk=function(r){return r.type===15&&(r.unit===Kk||r.unit===Xk||r.unit===Yk||r.unit===Zk)},eN=function(r){var e=r.filter(Ii).map(function(t){return t.value}).join(" ");switch(e){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Wo,Wo];case"to top":case"bottom":return ic(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Wo,JA];case"to right":case"left":return ic(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[JA,JA];case"to bottom":case"top":return ic(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[JA,Wo];case"to left":case"right":return ic(270)}return 0},ic=function(r){return Math.PI*r/180},ef={name:"color",parse:function(r,e){if(e.type===18){var t=U_e[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(r,e.values)}if(e.type===5){if(e.value.length===3){var n=e.value.substring(0,1),i=e.value.substring(1,2),s=e.value.substring(2,3);return rf(parseInt(n+n,16),parseInt(i+i,16),parseInt(s+s,16),1)}if(e.value.length===4){var n=e.value.substring(0,1),i=e.value.substring(1,2),s=e.value.substring(2,3),a=e.value.substring(3,4);return rf(parseInt(n+n,16),parseInt(i+i,16),parseInt(s+s,16),parseInt(a+a,16)/255)}if(e.value.length===6){var n=e.value.substring(0,2),i=e.value.substring(2,4),s=e.value.substring(4,6);return rf(parseInt(n,16),parseInt(i,16),parseInt(s,16),1)}if(e.value.length===8){var n=e.value.substring(0,2),i=e.value.substring(2,4),s=e.value.substring(4,6),a=e.value.substring(6,8);return rf(parseInt(n,16),parseInt(i,16),parseInt(s,16),parseInt(a,16)/255)}}if(e.type===20){var o=$h[e.value.toUpperCase()];if(typeof o<"u")return o}return $h.TRANSPARENT}},tf=function(r){return(255&r)===0},Uo=function(r){var e=255&r,t=255&r>>8,n=255&r>>16,i=255&r>>24;return e<255?"rgba("+i+","+n+","+t+","+e/255+")":"rgb("+i+","+n+","+t+")"},rf=function(r,e,t,n){return(r<<24|e<<16|t<<8|Math.round(n*255)<<0)>>>0},tN=function(r,e){if(r.type===17)return r.number;if(r.type===16){var t=e===3?1:255;return e===3?r.number/100*t:Math.round(r.number/100*t)}return 0},rN=function(r,e){var t=e.filter(pg);if(t.length===3){var n=t.map(tN),i=n[0],s=n[1],a=n[2];return rf(i,s,a,1)}if(t.length===4){var o=t.map(tN),i=o[0],s=o[1],a=o[2],u=o[3];return rf(i,s,a,u)}return 0};function nT(r,e,t){return t<0&&(t+=1),t>=1&&(t-=1),t<1/6?(e-r)*t*6+r:t<1/2?e:t<2/3?(e-r)*6*(2/3-t)+r:r}var nN=function(r,e){var t=e.filter(pg),n=t[0],i=t[1],s=t[2],a=t[3],o=(n.type===17?ic(n.number):d1.parse(r,n))/(Math.PI*2),u=eo(i)?i.number/100:0,d=eo(s)?s.number/100:0,p=typeof a<"u"&&eo(a)?Qi(a,1):1;if(u===0)return rf(d*255,d*255,d*255,1);var b=d<=.5?d*(u+1):d+u-d*u,C=d*2-b,w=nT(C,b,o+1/3),M=nT(C,b,o),P=nT(C,b,o-1/3);return rf(w*255,M*255,P*255,p)},U_e={hsl:nN,hsla:nN,rgb:rN,rgba:rN},I_=function(r,e){return ef.parse(r,Gk.create(e).parseComponentValue())},$h={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},D_e={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(r,e){return e.map(function(t){if(Ii(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},k_e={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},p1=function(r,e){var t=ef.parse(r,e[0]),n=e[1];return n&&eo(n)?{color:t,stop:n}:{color:t,stop:null}},iN=function(r,e){var t=r[0],n=r[r.length-1];t.stop===null&&(t.stop=Wo),n.stop===null&&(n.stop=JA);for(var i=[],s=0,a=0;a<r.length;a++){var o=r[a].stop;if(o!==null){var u=Qi(o,e);u>s?i.push(u):i.push(s),s=u}else i.push(null)}for(var d=null,a=0;a<i.length;a++){var p=i[a];if(p===null)d===null&&(d=a);else if(d!==null){for(var b=a-d,C=i[d-1],w=(p-C)/(b+1),M=1;M<=b;M++)i[d+M-1]=w*M;d=null}}return r.map(function(P,k){var D=P.color;return{color:D,stop:Math.max(Math.min(1,i[k]/e),0)}})},N_e=function(r,e,t){var n=e/2,i=t/2,s=Qi(r[0],e)-n,a=i-Qi(r[1],t);return(Math.atan2(a,s)+Math.PI*2)%(Math.PI*2)},z_e=function(r,e,t){var n=typeof r=="number"?r:N_e(r,e,t),i=Math.abs(e*Math.sin(n))+Math.abs(t*Math.cos(n)),s=e/2,a=t/2,o=i/2,u=Math.sin(n-Math.PI/2)*o,d=Math.cos(n-Math.PI/2)*o;return[i,s-d,s+d,a-u,a+u]},ru=function(r,e){return Math.sqrt(r*r+e*e)},sN=function(r,e,t,n,i){var s=[[0,0],[0,e],[r,0],[r,e]];return s.reduce(function(a,o){var u=o[0],d=o[1],p=ru(t-u,n-d);return(i?p<a.optimumDistance:p>a.optimumDistance)?{optimumCorner:o,optimumDistance:p}:a},{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},Q_e=function(r,e,t,n,i){var s=0,a=0;switch(r.size){case 0:r.shape===0?s=a=Math.min(Math.abs(e),Math.abs(e-n),Math.abs(t),Math.abs(t-i)):r.shape===1&&(s=Math.min(Math.abs(e),Math.abs(e-n)),a=Math.min(Math.abs(t),Math.abs(t-i)));break;case 2:if(r.shape===0)s=a=Math.min(ru(e,t),ru(e,t-i),ru(e-n,t),ru(e-n,t-i));else if(r.shape===1){var o=Math.min(Math.abs(t),Math.abs(t-i))/Math.min(Math.abs(e),Math.abs(e-n)),u=sN(n,i,e,t,!0),d=u[0],p=u[1];s=ru(d-e,(p-t)/o),a=o*s}break;case 1:r.shape===0?s=a=Math.max(Math.abs(e),Math.abs(e-n),Math.abs(t),Math.abs(t-i)):r.shape===1&&(s=Math.max(Math.abs(e),Math.abs(e-n)),a=Math.max(Math.abs(t),Math.abs(t-i)));break;case 3:if(r.shape===0)s=a=Math.max(ru(e,t),ru(e,t-i),ru(e-n,t),ru(e-n,t-i));else if(r.shape===1){var o=Math.max(Math.abs(t),Math.abs(t-i))/Math.max(Math.abs(e),Math.abs(e-n)),b=sN(n,i,e,t,!1),d=b[0],p=b[1];s=ru(d-e,(p-t)/o),a=o*s}break}return Array.isArray(r.size)&&(s=Qi(r.size[0],n),a=r.size.length===2?Qi(r.size[1],i):s),[s,a]},H_e=function(r,e){var t=ic(180),n=[];return Yu(e).forEach(function(i,s){if(s===0){var a=i[0];if(a.type===20&&a.value==="to"){t=eN(i);return}else if(Jk(a)){t=d1.parse(r,a);return}}var o=p1(r,i);n.push(o)}),{angle:t,stops:n,type:1}},g1=function(r,e){var t=ic(180),n=[];return Yu(e).forEach(function(i,s){if(s===0){var a=i[0];if(a.type===20&&["top","left","right","bottom"].indexOf(a.value)!==-1){t=eN(i);return}else if(Jk(a)){t=(d1.parse(r,a)+ic(270))%ic(360);return}}var o=p1(r,i);n.push(o)}),{angle:t,stops:n,type:1}},V_e=function(r,e){var t=ic(180),n=[],i=1,s=0,a=3,o=[];return Yu(e).forEach(function(u,d){var p=u[0];if(d===0){if(Ii(p)&&p.value==="linear"){i=1;return}else if(Ii(p)&&p.value==="radial"){i=2;return}}if(p.type===18){if(p.name==="from"){var b=ef.parse(r,p.values[0]);n.push({stop:Wo,color:b})}else if(p.name==="to"){var b=ef.parse(r,p.values[0]);n.push({stop:JA,color:b})}else if(p.name==="color-stop"){var C=p.values.filter(pg);if(C.length===2){var b=ef.parse(r,C[1]),w=C[0];dg(w)&&n.push({stop:{type:16,number:w.number*100,flags:w.flags},color:b})}}}}),i===1?{angle:(t+ic(180))%ic(360),stops:n,type:i}:{size:a,shape:s,stops:n,position:o,type:i}},oN="closest-side",aN="farthest-side",lN="closest-corner",cN="farthest-corner",uN="circle",hN="ellipse",AN="cover",fN="contain",j_e=function(r,e){var t=0,n=3,i=[],s=[];return Yu(e).forEach(function(a,o){var u=!0;if(o===0){var d=!1;u=a.reduce(function(b,C){if(d)if(Ii(C))switch(C.value){case"center":return s.push(rT),b;case"top":case"left":return s.push(Wo),b;case"right":case"bottom":return s.push(JA),b}else(eo(C)||ZA(C))&&s.push(C);else if(Ii(C))switch(C.value){case uN:return t=0,!1;case hN:return t=1,!1;case"at":return d=!0,!1;case oN:return n=0,!1;case AN:case aN:return n=1,!1;case fN:case lN:return n=2,!1;case cN:return n=3,!1}else if(ZA(C)||eo(C))return Array.isArray(n)||(n=[]),n.push(C),!1;return b},u)}if(u){var p=p1(r,a);i.push(p)}}),{size:n,shape:t,stops:i,position:s,type:2}},m1=function(r,e){var t=0,n=3,i=[],s=[];return Yu(e).forEach(function(a,o){var u=!0;if(o===0?u=a.reduce(function(p,b){if(Ii(b))switch(b.value){case"center":return s.push(rT),!1;case"top":case"left":return s.push(Wo),!1;case"right":case"bottom":return s.push(JA),!1}else if(eo(b)||ZA(b))return s.push(b),!1;return p},u):o===1&&(u=a.reduce(function(p,b){if(Ii(b))switch(b.value){case uN:return t=0,!1;case hN:return t=1,!1;case fN:case oN:return n=0,!1;case aN:return n=1,!1;case lN:return n=2,!1;case AN:case cN:return n=3,!1}else if(ZA(b)||eo(b))return Array.isArray(n)||(n=[]),n.push(b),!1;return p},u)),u){var d=p1(r,a);i.push(d)}}),{size:n,shape:t,stops:i,position:s,type:2}},$_e=function(r){return r.type===1},G_e=function(r){return r.type===2},iT={name:"image",parse:function(r,e){if(e.type===22){var t={url:e.value,type:0};return r.cache.addImage(e.value),t}if(e.type===18){var n=dN[e.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return n(r,e.values)}throw new Error("Unsupported image type "+e.type)}};function W_e(r){return!(r.type===20&&r.value==="none")&&(r.type!==18||!!dN[r.name])}var dN={"linear-gradient":H_e,"-moz-linear-gradient":g1,"-ms-linear-gradient":g1,"-o-linear-gradient":g1,"-webkit-linear-gradient":g1,"radial-gradient":j_e,"-moz-radial-gradient":m1,"-ms-radial-gradient":m1,"-o-radial-gradient":m1,"-webkit-radial-gradient":m1,"-webkit-gradient":V_e},q_e={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(r,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e.filter(function(n){return pg(n)&&W_e(n)}).map(function(n){return iT.parse(r,n)})}},K_e={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(r,e){return e.map(function(t){if(Ii(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},X_e={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(r,e){return Yu(e).map(function(t){return t.filter(eo)}).map(qk)}},Y_e={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(r,e){return Yu(e).map(function(t){return t.filter(Ii).map(function(n){return n.value}).join(" ")}).map(Z_e)}},Z_e=function(r){switch(r){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},gg;(function(r){r.AUTO="auto",r.CONTAIN="contain",r.COVER="cover"})(gg||(gg={}));var J_e={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(r,e){return Yu(e).map(function(t){return t.filter(eye)})}},eye=function(r){return Ii(r)||eo(r)},_1=function(r){return{name:"border-"+r+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},tye=_1("top"),rye=_1("right"),nye=_1("bottom"),iye=_1("left"),y1=function(r){return{name:"border-radius-"+r,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return qk(t.filter(eo))}}},sye=y1("top-left"),oye=y1("top-right"),aye=y1("bottom-right"),lye=y1("bottom-left"),b1=function(r){return{name:"border-"+r+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},cye=b1("top"),uye=b1("right"),hye=b1("bottom"),Aye=b1("left"),v1=function(r){return{name:"border-"+r+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return E_(t)?t.number:0}}},fye=v1("top"),dye=v1("right"),pye=v1("bottom"),gye=v1("left"),mye={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},_ye={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(r,e){switch(e){case"rtl":return 1;case"ltr":default:return 0}}},yye={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(r,e){return e.filter(Ii).reduce(function(t,n){return t|bye(n.value)},0)}},bye=function(r){switch(r){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},vye={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},wye={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(r,e){return e.type===20&&e.value==="normal"?0:e.type===17||e.type===15?e.number:0}},w1;(function(r){r.NORMAL="normal",r.STRICT="strict"})(w1||(w1={}));var xye={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"strict":return w1.STRICT;case"normal":default:return w1.NORMAL}}},Bye={name:"line-height",initialValue:"normal",prefix:!1,type:4},pN=function(r,e){return Ii(r)&&r.value==="normal"?1.2*e:r.type===17?e*r.number:eo(r)?Qi(r,e):e},Cye={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(r,e){return e.type===20&&e.value==="none"?null:iT.parse(r,e)}},Tye={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(r,e){switch(e){case"inside":return 0;case"outside":default:return 1}}},sT={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},x1=function(r){return{name:"margin-"+r,initialValue:"0",prefix:!1,type:4}},Eye=x1("top"),Sye=x1("right"),Iye=x1("bottom"),Pye=x1("left"),Mye={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(r,e){return e.filter(Ii).map(function(t){switch(t.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},Fye={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"break-word":return"break-word";case"normal":default:return"normal"}}},B1=function(r){return{name:"padding-"+r,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Rye=B1("top"),Lye=B1("right"),Oye=B1("bottom"),Uye=B1("left"),Dye={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(r,e){switch(e){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},kye={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(r,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Nye={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.length===1&&tT(e[0],"none")?[]:Yu(e).map(function(t){for(var n={color:$h.TRANSPARENT,offsetX:Wo,offsetY:Wo,blur:Wo},i=0,s=0;s<t.length;s++){var a=t[s];ZA(a)?(i===0?n.offsetX=a:i===1?n.offsetY=a:n.blur=a,i++):n.color=ef.parse(r,a)}return n})}},zye={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Qye={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(r,e){if(e.type===20&&e.value==="none")return null;if(e.type===18){var t=jye[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}return null}},Hye=function(r){var e=r.filter(function(t){return t.type===17}).map(function(t){return t.number});return e.length===6?e:null},Vye=function(r){var e=r.filter(function(u){return u.type===17}).map(function(u){return u.number}),t=e[0],n=e[1];e[2],e[3];var i=e[4],s=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var a=e[12],o=e[13];return e[14],e[15],e.length===16?[t,n,i,s,a,o]:null},jye={matrix:Hye,matrix3d:Vye},gN={type:16,number:50,flags:w_},$ye=[gN,gN],Gye={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(r,e){var t=e.filter(eo);return t.length!==2?$ye:[t[0],t[1]]}},Wye={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},P_;(function(r){r.NORMAL="normal",r.BREAK_ALL="break-all",r.KEEP_ALL="keep-all"})(P_||(P_={}));for(var qye={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"break-all":return P_.BREAK_ALL;case"keep-all":return P_.KEEP_ALL;case"normal":default:return P_.NORMAL}}},Kye={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(r,e){if(e.type===20)return{auto:!0,order:0};if(dg(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},mN={name:"time",parse:function(r,e){if(e.type===15)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},Xye={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(r,e){return dg(e)?e.number:1}},Yye={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Zye={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(r,e){return e.filter(Ii).map(function(t){switch(t.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(t){return t!==0})}},Jye={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(r,e){var t=[],n=[];return e.forEach(function(i){switch(i.type){case 20:case 0:t.push(i.value);break;case 17:t.push(i.number.toString());break;case 4:n.push(t.join(" ")),t.length=0;break}}),t.length&&n.push(t.join(" ")),n.map(function(i){return i.indexOf(" ")===-1?i:"'"+i+"'"})}},e0e={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},t0e={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(r,e){if(dg(e))return e.number;if(Ii(e))switch(e.value){case"bold":return 700;case"normal":default:return 400}return 400}},r0e={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.filter(Ii).map(function(t){return t.value})}},n0e={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},vo=function(r,e){return(r&e)!==0},i0e={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(r,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e}},s0e={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;for(var n=[],i=e.filter(Wk),s=0;s<i.length;s++){var a=i[s],o=i[s+1];if(a.type===20){var u=o&&dg(o)?o.number:1;n.push({counter:a.value,increment:u})}}return n}},o0e={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return[];for(var t=[],n=e.filter(Wk),i=0;i<n.length;i++){var s=n[i],a=n[i+1];if(Ii(s)&&s.value!=="none"){var o=a&&dg(a)?a.number:0;t.push({counter:s.value,reset:o})}}return t}},a0e={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(r,e){return e.filter(E_).map(function(t){return mN.parse(r,t)})}},l0e={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;var n=[],i=e.filter(L_e);if(i.length%2!==0)return null;for(var s=0;s<i.length;s+=2){var a=i[s].value,o=i[s+1].value;n.push({open:a,close:o})}return n}},_N=function(r,e,t){if(!r)return"";var n=r[Math.min(e,r.length-1)];return n?t?n.open:n.close:""},c0e={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.length===1&&tT(e[0],"none")?[]:Yu(e).map(function(t){for(var n={color:255,offsetX:Wo,offsetY:Wo,blur:Wo,spread:Wo,inset:!1},i=0,s=0;s<t.length;s++){var a=t[s];tT(a,"inset")?n.inset=!0:ZA(a)?(i===0?n.offsetX=a:i===1?n.offsetY=a:i===2?n.blur=a:n.spread=a,i++):n.color=ef.parse(r,a)}return n})}},u0e={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(r,e){var t=[0,1,2],n=[];return e.filter(Ii).forEach(function(i){switch(i.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2);break}}),t.forEach(function(i){n.indexOf(i)===-1&&n.push(i)}),n}},h0e={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},A0e={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(r,e){return E_(e)?e.number:0}},f0e=function(){function r(e,t){var n,i;this.animationDuration=Or(e,a0e,t.animationDuration),this.backgroundClip=Or(e,D_e,t.backgroundClip),this.backgroundColor=Or(e,k_e,t.backgroundColor),this.backgroundImage=Or(e,q_e,t.backgroundImage),this.backgroundOrigin=Or(e,K_e,t.backgroundOrigin),this.backgroundPosition=Or(e,X_e,t.backgroundPosition),this.backgroundRepeat=Or(e,Y_e,t.backgroundRepeat),this.backgroundSize=Or(e,J_e,t.backgroundSize),this.borderTopColor=Or(e,tye,t.borderTopColor),this.borderRightColor=Or(e,rye,t.borderRightColor),this.borderBottomColor=Or(e,nye,t.borderBottomColor),this.borderLeftColor=Or(e,iye,t.borderLeftColor),this.borderTopLeftRadius=Or(e,sye,t.borderTopLeftRadius),this.borderTopRightRadius=Or(e,oye,t.borderTopRightRadius),this.borderBottomRightRadius=Or(e,aye,t.borderBottomRightRadius),this.borderBottomLeftRadius=Or(e,lye,t.borderBottomLeftRadius),this.borderTopStyle=Or(e,cye,t.borderTopStyle),this.borderRightStyle=Or(e,uye,t.borderRightStyle),this.borderBottomStyle=Or(e,hye,t.borderBottomStyle),this.borderLeftStyle=Or(e,Aye,t.borderLeftStyle),this.borderTopWidth=Or(e,fye,t.borderTopWidth),this.borderRightWidth=Or(e,dye,t.borderRightWidth),this.borderBottomWidth=Or(e,pye,t.borderBottomWidth),this.borderLeftWidth=Or(e,gye,t.borderLeftWidth),this.boxShadow=Or(e,c0e,t.boxShadow),this.color=Or(e,mye,t.color),this.direction=Or(e,_ye,t.direction),this.display=Or(e,yye,t.display),this.float=Or(e,vye,t.cssFloat),this.fontFamily=Or(e,Jye,t.fontFamily),this.fontSize=Or(e,e0e,t.fontSize),this.fontStyle=Or(e,n0e,t.fontStyle),this.fontVariant=Or(e,r0e,t.fontVariant),this.fontWeight=Or(e,t0e,t.fontWeight),this.letterSpacing=Or(e,wye,t.letterSpacing),this.lineBreak=Or(e,xye,t.lineBreak),this.lineHeight=Or(e,Bye,t.lineHeight),this.listStyleImage=Or(e,Cye,t.listStyleImage),this.listStylePosition=Or(e,Tye,t.listStylePosition),this.listStyleType=Or(e,sT,t.listStyleType),this.marginTop=Or(e,Eye,t.marginTop),this.marginRight=Or(e,Sye,t.marginRight),this.marginBottom=Or(e,Iye,t.marginBottom),this.marginLeft=Or(e,Pye,t.marginLeft),this.opacity=Or(e,Xye,t.opacity);var s=Or(e,Mye,t.overflow);this.overflowX=s[0],this.overflowY=s[s.length>1?1:0],this.overflowWrap=Or(e,Fye,t.overflowWrap),this.paddingTop=Or(e,Rye,t.paddingTop),this.paddingRight=Or(e,Lye,t.paddingRight),this.paddingBottom=Or(e,Oye,t.paddingBottom),this.paddingLeft=Or(e,Uye,t.paddingLeft),this.paintOrder=Or(e,u0e,t.paintOrder),this.position=Or(e,kye,t.position),this.textAlign=Or(e,Dye,t.textAlign),this.textDecorationColor=Or(e,Yye,(n=t.textDecorationColor)!==null&&n!==void 0?n:t.color),this.textDecorationLine=Or(e,Zye,(i=t.textDecorationLine)!==null&&i!==void 0?i:t.textDecoration),this.textShadow=Or(e,Nye,t.textShadow),this.textTransform=Or(e,zye,t.textTransform),this.transform=Or(e,Qye,t.transform),this.transformOrigin=Or(e,Gye,t.transformOrigin),this.visibility=Or(e,Wye,t.visibility),this.webkitTextStrokeColor=Or(e,h0e,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=Or(e,A0e,t.webkitTextStrokeWidth),this.wordBreak=Or(e,qye,t.wordBreak),this.zIndex=Or(e,Kye,t.zIndex)}return r.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},r.prototype.isTransparent=function(){return tf(this.backgroundColor)},r.prototype.isTransformed=function(){return this.transform!==null},r.prototype.isPositioned=function(){return this.position!==0},r.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},r.prototype.isFloating=function(){return this.float!==0},r.prototype.isInlineLevel=function(){return vo(this.display,4)||vo(this.display,33554432)||vo(this.display,268435456)||vo(this.display,536870912)||vo(this.display,67108864)||vo(this.display,134217728)},r}(),d0e=function(){function r(e,t){this.content=Or(e,i0e,t.content),this.quotes=Or(e,l0e,t.quotes)}return r}(),yN=function(){function r(e,t){this.counterIncrement=Or(e,s0e,t.counterIncrement),this.counterReset=Or(e,o0e,t.counterReset)}return r}(),Or=function(r,e,t){var n=new $k,i=t!==null&&typeof t<"u"?t.toString():e.initialValue;n.write(i);var s=new Gk(n.read());switch(e.type){case 2:var a=s.parseComponentValue();return e.parse(r,Ii(a)?a.value:e.initialValue);case 0:return e.parse(r,s.parseComponentValue());case 1:return e.parse(r,s.parseComponentValues());case 4:return s.parseComponentValue();case 3:switch(e.format){case"angle":return d1.parse(r,s.parseComponentValue());case"color":return ef.parse(r,s.parseComponentValue());case"image":return iT.parse(r,s.parseComponentValue());case"length":var o=s.parseComponentValue();return ZA(o)?o:Wo;case"length-percentage":var u=s.parseComponentValue();return eo(u)?u:Wo;case"time":return mN.parse(r,s.parseComponentValue())}break}},p0e="data-html2canvas-debug",g0e=function(r){var e=r.getAttribute(p0e);switch(e){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},oT=function(r,e){var t=g0e(r);return t===1||e===t},Zu=function(){function r(e,t){if(this.context=e,this.textNodes=[],this.elements=[],this.flags=0,oT(t,3))debugger;this.styles=new f0e(e,window.getComputedStyle(t,null)),yT(t)&&(this.styles.animationDuration.some(function(n){return n>0})&&(t.style.animationDuration="0s"),this.styles.transform!==null&&(t.style.transform="none")),this.bounds=qb(this.context,t),oT(t,4)&&(this.flags|=16)}return r}(),m0e="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",bN="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",M_=typeof Uint8Array>"u"?[]:new Uint8Array(256),C1=0;C1<bN.length;C1++)M_[bN.charCodeAt(C1)]=C1;for(var _0e=function(r){var e=r.length*.75,t=r.length,n,i=0,s,a,o,u;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);var d=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),p=Array.isArray(d)?d:new Uint8Array(d);for(n=0;n<t;n+=4)s=M_[r.charCodeAt(n)],a=M_[r.charCodeAt(n+1)],o=M_[r.charCodeAt(n+2)],u=M_[r.charCodeAt(n+3)],p[i++]=s<<2|a>>4,p[i++]=(a&15)<<4|o>>2,p[i++]=(o&3)<<6|u&63;return d},y0e=function(r){for(var e=r.length,t=[],n=0;n<e;n+=2)t.push(r[n+1]<<8|r[n]);return t},b0e=function(r){for(var e=r.length,t=[],n=0;n<e;n+=4)t.push(r[n+3]<<24|r[n+2]<<16|r[n+1]<<8|r[n]);return t},wd=5,aT=11,lT=2,v0e=aT-wd,vN=65536>>wd,w0e=1<<wd,cT=w0e-1,x0e=1024>>wd,B0e=vN+x0e,C0e=B0e,T0e=32,E0e=C0e+T0e,S0e=65536>>aT,I0e=1<<v0e,P0e=I0e-1,wN=function(r,e,t){return r.slice?r.slice(e,t):new Uint16Array(Array.prototype.slice.call(r,e,t))},M0e=function(r,e,t){return r.slice?r.slice(e,t):new Uint32Array(Array.prototype.slice.call(r,e,t))},F0e=function(r,e){var t=_0e(r),n=Array.isArray(t)?b0e(t):new Uint32Array(t),i=Array.isArray(t)?y0e(t):new Uint16Array(t),s=24,a=wN(i,s/2,n[4]/2),o=n[5]===2?wN(i,(s+n[4])/2):M0e(n,Math.ceil((s+n[4])/4));return new R0e(n[0],n[1],n[2],n[3],a,o)},R0e=function(){function r(e,t,n,i,s,a){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=i,this.index=s,this.data=a}return r.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>wd],t=(t<<lT)+(e&cT),this.data[t];if(e<=65535)return t=this.index[vN+(e-55296>>wd)],t=(t<<lT)+(e&cT),this.data[t];if(e<this.highStart)return t=E0e-S0e+(e>>aT),t=this.index[t],t+=e>>wd&P0e,t=this.index[t],t=(t<<lT)+(e&cT),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),xN="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L0e=typeof Uint8Array>"u"?[]:new Uint8Array(256),T1=0;T1<xN.length;T1++)L0e[xN.charCodeAt(T1)]=T1;var O0e=1,uT=2,hT=3,BN=4,CN=5,U0e=7,TN=8,AT=9,fT=10,EN=11,SN=12,IN=13,PN=14,dT=15,D0e=function(r){for(var e=[],t=0,n=r.length;t<n;){var i=r.charCodeAt(t++);if(i>=55296&&i<=56319&&t<n){var s=r.charCodeAt(t++);(s&64512)===56320?e.push(((i&1023)<<10)+(s&1023)+65536):(e.push(i),t--)}else e.push(i)}return e},k0e=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var t=r.length;if(!t)return"";for(var n=[],i=-1,s="";++i<t;){var a=r[i];a<=65535?n.push(a):(a-=65536,n.push((a>>10)+55296,a%1024+56320)),(i+1===t||n.length>16384)&&(s+=String.fromCharCode.apply(String,n),n.length=0)}return s},N0e=F0e(m0e),xd="×",MN="÷",z0e=function(r){return N0e.get(r)},Q0e=function(r,e,t){var n=t-2,i=e[n],s=e[t-1],a=e[t];if(s===uT&&a===hT)return xd;if(s===uT||s===hT||s===BN||a===uT||a===hT||a===BN)return MN;if(s===TN&&[TN,AT,EN,SN].indexOf(a)!==-1||(s===EN||s===AT)&&(a===AT||a===fT)||(s===SN||s===fT)&&a===fT||a===IN||a===CN||a===U0e||s===O0e)return xd;if(s===IN&&a===PN){for(;i===CN;)i=e[--n];if(i===PN)return xd}if(s===dT&&a===dT){for(var o=0;i===dT;)o++,i=e[--n];if(o%2===0)return xd}return MN},H0e=function(r){var e=D0e(r),t=e.length,n=0,i=0,s=e.map(z0e);return{next:function(){if(n>=t)return{done:!0,value:null};for(var a=xd;n<t&&(a=Q0e(e,s,++n))===xd;);if(a!==xd||n===t){var o=k0e.apply(null,e.slice(i,n));return i=n,{value:o,done:!1}}return{done:!0,value:null}}}},V0e=function(r){for(var e=H0e(r),t=[],n;!(n=e.next()).done;)n.value&&t.push(n.value.slice());return t},j0e=function(r){var e=123;if(r.createRange){var t=r.createRange();if(t.getBoundingClientRect){var n=r.createElement("boundtest");n.style.height=e+"px",n.style.display="block",r.body.appendChild(n),t.selectNode(n);var i=t.getBoundingClientRect(),s=Math.round(i.height);if(r.body.removeChild(n),s===e)return!0}}return!1},$0e=function(r){var e=r.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",r.body.appendChild(e);var t=r.createRange();e.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var n=e.firstChild,i=Kb(n.data).map(function(u){return ks(u)}),s=0,a={},o=i.every(function(u,d){t.setStart(n,s),t.setEnd(n,s+u.length);var p=t.getBoundingClientRect();s+=u.length;var b=p.x>a.x||p.y>a.y;return a=p,d===0?!0:b});return r.body.removeChild(e),o},G0e=function(){return typeof new Image().crossOrigin<"u"},W0e=function(){return typeof new XMLHttpRequest().responseType=="string"},q0e=function(r){var e=new Image,t=r.createElement("canvas"),n=t.getContext("2d");if(!n)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(e,0,0),t.toDataURL()}catch{return!1}return!0},FN=function(r){return r[0]===0&&r[1]===255&&r[2]===0&&r[3]===255},K0e=function(r){var e=r.createElement("canvas"),t=100;e.width=t,e.height=t;var n=e.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,t,t);var i=new Image,s=e.toDataURL();i.src=s;var a=pT(t,t,0,0,i);return n.fillStyle="red",n.fillRect(0,0,t,t),RN(a).then(function(o){n.drawImage(o,0,0);var u=n.getImageData(0,0,t,t).data;n.fillStyle="red",n.fillRect(0,0,t,t);var d=r.createElement("div");return d.style.backgroundImage="url("+s+")",d.style.height=t+"px",FN(u)?RN(pT(t,t,0,0,d)):Promise.reject(!1)}).then(function(o){return n.drawImage(o,0,0),FN(n.getImageData(0,0,t,t).data)}).catch(function(){return!1})},pT=function(r,e,t,n,i){var s="http://www.w3.org/2000/svg",a=document.createElementNS(s,"svg"),o=document.createElementNS(s,"foreignObject");return a.setAttributeNS(null,"width",r.toString()),a.setAttributeNS(null,"height",e.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",t.toString()),o.setAttributeNS(null,"y",n.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(o),o.appendChild(i),a},RN=function(r){return new Promise(function(e,t){var n=new Image;n.onload=function(){return e(n)},n.onerror=t,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},qo={get SUPPORT_RANGE_BOUNDS(){var r=j0e(document);return Object.defineProperty(qo,"SUPPORT_RANGE_BOUNDS",{value:r}),r},get SUPPORT_WORD_BREAKING(){var r=qo.SUPPORT_RANGE_BOUNDS&&$0e(document);return Object.defineProperty(qo,"SUPPORT_WORD_BREAKING",{value:r}),r},get SUPPORT_SVG_DRAWING(){var r=q0e(document);return Object.defineProperty(qo,"SUPPORT_SVG_DRAWING",{value:r}),r},get SUPPORT_FOREIGNOBJECT_DRAWING(){var r=typeof Array.from=="function"&&typeof window.fetch=="function"?K0e(document):Promise.resolve(!1);return Object.defineProperty(qo,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:r}),r},get SUPPORT_CORS_IMAGES(){var r=G0e();return Object.defineProperty(qo,"SUPPORT_CORS_IMAGES",{value:r}),r},get SUPPORT_RESPONSE_TYPE(){var r=W0e();return Object.defineProperty(qo,"SUPPORT_RESPONSE_TYPE",{value:r}),r},get SUPPORT_CORS_XHR(){var r="withCredentials"in new XMLHttpRequest;return Object.defineProperty(qo,"SUPPORT_CORS_XHR",{value:r}),r},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var r=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(qo,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:r}),r}},F_=function(){function r(e,t){this.text=e,this.bounds=t}return r}(),X0e=function(r,e,t,n){var i=J0e(e,t),s=[],a=0;return i.forEach(function(o){if(t.textDecorationLine.length||o.trim().length>0)if(qo.SUPPORT_RANGE_BOUNDS){var u=LN(n,a,o.length).getClientRects();if(u.length>1){var d=gT(o),p=0;d.forEach(function(C){s.push(new F_(C,Vh.fromDOMRectList(r,LN(n,p+a,C.length).getClientRects()))),p+=C.length})}else s.push(new F_(o,Vh.fromDOMRectList(r,u)))}else{var b=n.splitText(o.length);s.push(new F_(o,Y0e(r,n))),n=b}else qo.SUPPORT_RANGE_BOUNDS||(n=n.splitText(o.length));a+=o.length}),s},Y0e=function(r,e){var t=e.ownerDocument;if(t){var n=t.createElement("html2canvaswrapper");n.appendChild(e.cloneNode(!0));var i=e.parentNode;if(i){i.replaceChild(n,e);var s=qb(r,n);return n.firstChild&&i.replaceChild(n.firstChild,n),s}}return Vh.EMPTY},LN=function(r,e,t){var n=r.ownerDocument;if(!n)throw new Error("Node has no owner document");var i=n.createRange();return i.setStart(r,e),i.setEnd(r,e+t),i},gT=function(r){if(qo.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(r)).map(function(t){return t.segment})}return V0e(r)},Z0e=function(r,e){if(qo.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(t.segment(r)).map(function(n){return n.segment})}return tbe(r,e)},J0e=function(r,e){return e.letterSpacing!==0?gT(r):Z0e(r,e)},ebe=[32,160,4961,65792,65793,4153,4241],tbe=function(r,e){for(var t=Sme(r,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap==="break-word"?"break-word":e.wordBreak}),n=[],i,s=function(){if(i.value){var a=i.value.slice(),o=Kb(a),u="";o.forEach(function(d){ebe.indexOf(d)===-1?u+=ks(d):(u.length&&n.push(u),n.push(ks(d)),u="")}),u.length&&n.push(u)}};!(i=t.next()).done;)s();return n},rbe=function(){function r(e,t,n){this.text=nbe(t.data,n.textTransform),this.textBounds=X0e(e,this.text,n,t)}return r}(),nbe=function(r,e){switch(e){case 1:return r.toLowerCase();case 3:return r.replace(ibe,sbe);case 2:return r.toUpperCase();default:return r}},ibe=/(^|\s|:|-|\(|\))([a-z])/g,sbe=function(r,e,t){return r.length>0?e+t.toUpperCase():r},ON=function(r){tu(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.src=n.currentSrc||n.src,i.intrinsicWidth=n.naturalWidth,i.intrinsicHeight=n.naturalHeight,i.context.cache.addImage(i.src),i}return e}(Zu),UN=function(r){tu(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.canvas=n,i.intrinsicWidth=n.width,i.intrinsicHeight=n.height,i}return e}(Zu),DN=function(r){tu(e,r);function e(t,n){var i=r.call(this,t,n)||this,s=new XMLSerializer,a=qb(t,n);return n.setAttribute("width",a.width+"px"),n.setAttribute("height",a.height+"px"),i.svg="data:image/svg+xml,"+encodeURIComponent(s.serializeToString(n)),i.intrinsicWidth=n.width.baseVal.value,i.intrinsicHeight=n.height.baseVal.value,i.context.cache.addImage(i.svg),i}return e}(Zu),kN=function(r){tu(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.value=n.value,i}return e}(Zu),mT=function(r){tu(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.start=n.start,i.reversed=typeof n.reversed=="boolean"&&n.reversed===!0,i}return e}(Zu),obe=[{type:15,flags:0,unit:"px",number:3}],abe=[{type:16,flags:0,number:50}],lbe=function(r){return r.width>r.height?new Vh(r.left+(r.width-r.height)/2,r.top,r.height,r.height):r.width<r.height?new Vh(r.left,r.top+(r.height-r.width)/2,r.width,r.width):r},cbe=function(r){var e=r.type===ube?new Array(r.value.length+1).join("•"):r.value;return e.length===0?r.placeholder||"":e},E1="checkbox",S1="radio",ube="password",NN=707406591,_T=function(r){tu(e,r);function e(t,n){var i=r.call(this,t,n)||this;switch(i.type=n.type.toLowerCase(),i.checked=n.checked,i.value=cbe(n),(i.type===E1||i.type===S1)&&(i.styles.backgroundColor=3739148031,i.styles.borderTopColor=i.styles.borderRightColor=i.styles.borderBottomColor=i.styles.borderLeftColor=2779096575,i.styles.borderTopWidth=i.styles.borderRightWidth=i.styles.borderBottomWidth=i.styles.borderLeftWidth=1,i.styles.borderTopStyle=i.styles.borderRightStyle=i.styles.borderBottomStyle=i.styles.borderLeftStyle=1,i.styles.backgroundClip=[0],i.styles.backgroundOrigin=[0],i.bounds=lbe(i.bounds)),i.type){case E1:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=obe;break;case S1:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=abe;break}return i}return e}(Zu),zN=function(r){tu(e,r);function e(t,n){var i=r.call(this,t,n)||this,s=n.options[n.selectedIndex||0];return i.value=s&&s.text||"",i}return e}(Zu),QN=function(r){tu(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.value=n.value,i}return e}(Zu),HN=function(r){tu(e,r);function e(t,n){var i=r.call(this,t,n)||this;i.src=n.src,i.width=parseInt(n.width,10)||0,i.height=parseInt(n.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){i.tree=jN(t,n.contentWindow.document.documentElement);var s=n.contentWindow.document.documentElement?I_(t,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):$h.TRANSPARENT,a=n.contentWindow.document.body?I_(t,getComputedStyle(n.contentWindow.document.body).backgroundColor):$h.TRANSPARENT;i.backgroundColor=tf(s)?tf(a)?i.styles.backgroundColor:a:s}}catch{}return i}return e}(Zu),hbe=["OL","UL","MENU"],I1=function(r,e,t,n){for(var i=e.firstChild,s=void 0;i;i=s)if(s=i.nextSibling,$N(i)&&i.data.trim().length>0)t.textNodes.push(new rbe(r,i,t.styles));else if(mg(i))if(YN(i)&&i.assignedNodes)i.assignedNodes().forEach(function(o){return I1(r,o,t,n)});else{var a=VN(r,i);a.styles.isVisible()&&(Abe(i,a,n)?a.flags|=4:fbe(a.styles)&&(a.flags|=2),hbe.indexOf(i.tagName)!==-1&&(a.flags|=8),t.elements.push(a),i.slot,i.shadowRoot?I1(r,i.shadowRoot,a,n):!M1(i)&&!GN(i)&&!F1(i)&&I1(r,i,a,n))}},VN=function(r,e){return vT(e)?new ON(r,e):WN(e)?new UN(r,e):GN(e)?new DN(r,e):dbe(e)?new kN(r,e):pbe(e)?new mT(r,e):gbe(e)?new _T(r,e):F1(e)?new zN(r,e):M1(e)?new QN(r,e):KN(e)?new HN(r,e):new Zu(r,e)},jN=function(r,e){var t=VN(r,e);return t.flags|=4,I1(r,e,t,t),t},Abe=function(r,e,t){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||bT(r)&&t.styles.isTransparent()},fbe=function(r){return r.isPositioned()||r.isFloating()},$N=function(r){return r.nodeType===Node.TEXT_NODE},mg=function(r){return r.nodeType===Node.ELEMENT_NODE},yT=function(r){return mg(r)&&typeof r.style<"u"&&!P1(r)},P1=function(r){return typeof r.className=="object"},dbe=function(r){return r.tagName==="LI"},pbe=function(r){return r.tagName==="OL"},gbe=function(r){return r.tagName==="INPUT"},mbe=function(r){return r.tagName==="HTML"},GN=function(r){return r.tagName==="svg"},bT=function(r){return r.tagName==="BODY"},WN=function(r){return r.tagName==="CANVAS"},qN=function(r){return r.tagName==="VIDEO"},vT=function(r){return r.tagName==="IMG"},KN=function(r){return r.tagName==="IFRAME"},XN=function(r){return r.tagName==="STYLE"},_be=function(r){return r.tagName==="SCRIPT"},M1=function(r){return r.tagName==="TEXTAREA"},F1=function(r){return r.tagName==="SELECT"},YN=function(r){return r.tagName==="SLOT"},ZN=function(r){return r.tagName.indexOf("-")>0},ybe=function(){function r(){this.counters={}}return r.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},r.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},r.prototype.pop=function(e){var t=this;e.forEach(function(n){return t.counters[n].pop()})},r.prototype.parse=function(e){var t=this,n=e.counterIncrement,i=e.counterReset,s=!0;n!==null&&n.forEach(function(o){var u=t.counters[o.counter];u&&o.increment!==0&&(s=!1,u.length||u.push(1),u[Math.max(0,u.length-1)]+=o.increment)});var a=[];return s&&i.forEach(function(o){var u=t.counters[o.counter];a.push(o.counter),u||(u=t.counters[o.counter]=[]),u.push(o.reset)}),a},r}(),JN={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},e6={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},bbe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},vbe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},_g=function(r,e,t,n,i,s){return r<e||r>t?L_(r,i,s.length>0):n.integers.reduce(function(a,o,u){for(;r>=o;)r-=o,a+=n.values[u];return a},"")+s},t6=function(r,e,t,n){var i="";do t||r--,i=n(r)+i,r/=e;while(r*e>=e);return i},Ns=function(r,e,t,n,i){var s=t-e+1;return(r<0?"-":"")+(t6(Math.abs(r),s,n,function(a){return ks(Math.floor(a%s)+e)})+i)},Bd=function(r,e,t){t===void 0&&(t=". ");var n=e.length;return t6(Math.abs(r),n,!1,function(i){return e[Math.floor(i%n)]})+t},yg=1,nf=2,sf=4,R_=8,Gh=function(r,e,t,n,i,s){if(r<-9999||r>9999)return L_(r,4,i.length>0);var a=Math.abs(r),o=i;if(a===0)return e[0]+o;for(var u=0;a>0&&u<=4;u++){var d=a%10;d===0&&vo(s,yg)&&o!==""?o=e[d]+o:d>1||d===1&&u===0||d===1&&u===1&&vo(s,nf)||d===1&&u===1&&vo(s,sf)&&r>100||d===1&&u>1&&vo(s,R_)?o=e[d]+(u>0?t[u-1]:"")+o:d===1&&u>0&&(o=t[u-1]+o),a=Math.floor(a/10)}return(r<0?n:"")+o},r6="十百千萬",n6="拾佰仟萬",i6="マイナス",wT="마이너스",L_=function(r,e,t){var n=t?". ":"",i=t?"、":"",s=t?", ":"",a=t?" ":"";switch(e){case 0:return"•"+a;case 1:return"◦"+a;case 2:return"◾"+a;case 5:var o=Ns(r,48,57,!0,n);return o.length<4?"0"+o:o;case 4:return Bd(r,"〇一二三四五六七八九",i);case 6:return _g(r,1,3999,JN,3,n).toLowerCase();case 7:return _g(r,1,3999,JN,3,n);case 8:return Ns(r,945,969,!1,n);case 9:return Ns(r,97,122,!1,n);case 10:return Ns(r,65,90,!1,n);case 11:return Ns(r,1632,1641,!0,n);case 12:case 49:return _g(r,1,9999,e6,3,n);case 35:return _g(r,1,9999,e6,3,n).toLowerCase();case 13:return Ns(r,2534,2543,!0,n);case 14:case 30:return Ns(r,6112,6121,!0,n);case 15:return Bd(r,"子丑寅卯辰巳午未申酉戌亥",i);case 16:return Bd(r,"甲乙丙丁戊己庚辛壬癸",i);case 17:case 48:return Gh(r,"零一二三四五六七八九",r6,"負",i,nf|sf|R_);case 47:return Gh(r,"零壹貳參肆伍陸柒捌玖",n6,"負",i,yg|nf|sf|R_);case 42:return Gh(r,"零一二三四五六七八九",r6,"负",i,nf|sf|R_);case 41:return Gh(r,"零壹贰叁肆伍陆柒捌玖",n6,"负",i,yg|nf|sf|R_);case 26:return Gh(r,"〇一二三四五六七八九","十百千万",i6,i,0);case 25:return Gh(r,"零壱弐参四伍六七八九","拾百千万",i6,i,yg|nf|sf);case 31:return Gh(r,"영일이삼사오육칠팔구","십백천만",wT,s,yg|nf|sf);case 33:return Gh(r,"零一二三四五六七八九","十百千萬",wT,s,0);case 32:return Gh(r,"零壹貳參四五六七八九","拾百千",wT,s,yg|nf|sf);case 18:return Ns(r,2406,2415,!0,n);case 20:return _g(r,1,19999,vbe,3,n);case 21:return Ns(r,2790,2799,!0,n);case 22:return Ns(r,2662,2671,!0,n);case 22:return _g(r,1,10999,bbe,3,n);case 23:return Bd(r,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case 24:return Bd(r,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case 27:return Ns(r,3302,3311,!0,n);case 28:return Bd(r,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",i);case 29:return Bd(r,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",i);case 34:return Ns(r,3792,3801,!0,n);case 37:return Ns(r,6160,6169,!0,n);case 38:return Ns(r,4160,4169,!0,n);case 39:return Ns(r,2918,2927,!0,n);case 40:return Ns(r,1776,1785,!0,n);case 43:return Ns(r,3046,3055,!0,n);case 44:return Ns(r,3174,3183,!0,n);case 45:return Ns(r,3664,3673,!0,n);case 46:return Ns(r,3872,3881,!0,n);case 3:default:return Ns(r,48,57,!0,n)}},s6="data-html2canvas-ignore",o6=function(){function r(e,t,n){if(this.context=e,this.options=n,this.scrolledElements=[],this.referenceElement=t,this.counters=new ybe,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return r.prototype.toIFrame=function(e,t){var n=this,i=wbe(e,t);if(!i.contentWindow)return Promise.reject("Unable to find iframe window");var s=e.defaultView.pageXOffset,a=e.defaultView.pageYOffset,o=i.contentWindow,u=o.document,d=Cbe(i).then(function(){return Ia(n,void 0,void 0,function(){var p,b;return pa(this,function(C){switch(C.label){case 0:return this.scrolledElements.forEach(Ibe),o&&(o.scrollTo(t.left,t.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(o.scrollY!==t.top||o.scrollX!==t.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(o.scrollX-t.left,o.scrollY-t.top,0,0))),p=this.options.onclone,b=this.clonedReferenceElement,typeof b>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:u.fonts&&u.fonts.ready?[4,u.fonts.ready]:[3,2];case 1:C.sent(),C.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,Bbe(u)]:[3,4];case 3:C.sent(),C.label=4;case 4:return typeof p=="function"?[2,Promise.resolve().then(function(){return p(u,b)}).then(function(){return i})]:[2,i]}})})});return u.open(),u.write(Ebe(document.doctype)+"<html></html>"),Sbe(this.referenceElement.ownerDocument,s,a),u.replaceChild(u.adoptNode(this.documentElement),u.documentElement),u.close(),d},r.prototype.createElementClone=function(e){if(oT(e,2))debugger;if(WN(e))return this.createCanvasClone(e);if(qN(e))return this.createVideoClone(e);if(XN(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return vT(t)&&(vT(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager")),ZN(t)?this.createCustomElementClone(t):t},r.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return xT(e.style,t),t},r.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var n=[].slice.call(t.cssRules,0).reduce(function(s,a){return a&&typeof a.cssText=="string"?s+a.cssText:s},""),i=e.cloneNode(!1);return i.textContent=n,i}}catch(s){if(this.context.logger.error("Unable to access cssRules property",s),s.name!=="SecurityError")throw s}return e.cloneNode(!1)},r.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var n=e.ownerDocument.createElement("img");try{return n.src=e.toDataURL(),n}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var i=e.cloneNode(!1);try{i.width=e.width,i.height=e.height;var s=e.getContext("2d"),a=i.getContext("2d");if(a)if(!this.options.allowTaint&&s)a.putImageData(s.getImageData(0,0,e.width,e.height),0,0);else{var o=(t=e.getContext("webgl2"))!==null&&t!==void 0?t:e.getContext("webgl");if(o){var u=o.getContextAttributes();u?.preserveDrawingBuffer===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}a.drawImage(e,0,0)}return i}catch{this.context.logger.info("Unable to clone canvas as it is tainted",e)}return i},r.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var n=t.getContext("2d");try{return n&&(n.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||n.getImageData(0,0,t.width,t.height)),t}catch{this.context.logger.info("Unable to clone video as it is tainted",e)}var i=e.ownerDocument.createElement("canvas");return i.width=e.offsetWidth,i.height=e.offsetHeight,i},r.prototype.appendChildNode=function(e,t,n){(!mg(t)||!_be(t)&&!t.hasAttribute(s6)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(t)))&&(!this.options.copyStyles||!mg(t)||!XN(t))&&e.appendChild(this.cloneNode(t,n))},r.prototype.cloneChildNodes=function(e,t,n){for(var i=this,s=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;s;s=s.nextSibling)if(mg(s)&&YN(s)&&typeof s.assignedNodes=="function"){var a=s.assignedNodes();a.length&&a.forEach(function(o){return i.appendChildNode(t,o,n)})}else this.appendChildNode(t,s,n)},r.prototype.cloneNode=function(e,t){if($N(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var n=e.ownerDocument.defaultView;if(n&&mg(e)&&(yT(e)||P1(e))){var i=this.createElementClone(e);i.style.transitionProperty="none";var s=n.getComputedStyle(e),a=n.getComputedStyle(e,":before"),o=n.getComputedStyle(e,":after");this.referenceElement===e&&yT(i)&&(this.clonedReferenceElement=i),bT(i)&&Fbe(i);var u=this.counters.parse(new yN(this.context,s)),d=this.resolvePseudoContent(e,i,a,O_.BEFORE);ZN(e)&&(t=!0),qN(e)||this.cloneChildNodes(e,i,t),d&&i.insertBefore(d,i.firstChild);var p=this.resolvePseudoContent(e,i,o,O_.AFTER);return p&&i.appendChild(p),this.counters.pop(u),(s&&(this.options.copyStyles||P1(e))&&!KN(e)||t)&&xT(s,i),(e.scrollTop!==0||e.scrollLeft!==0)&&this.scrolledElements.push([i,e.scrollLeft,e.scrollTop]),(M1(e)||F1(e))&&(M1(i)||F1(i))&&(i.value=e.value),i}return e.cloneNode(!1)},r.prototype.resolvePseudoContent=function(e,t,n,i){var s=this;if(n){var a=n.content,o=t.ownerDocument;if(!(!o||!a||a==="none"||a==="-moz-alt-content"||n.display==="none")){this.counters.parse(new yN(this.context,n));var u=new d0e(this.context,n),d=o.createElement("html2canvaspseudoelement");xT(n,d),u.content.forEach(function(b){if(b.type===0)d.appendChild(o.createTextNode(b.value));else if(b.type===22){var C=o.createElement("img");C.src=b.value,C.style.opacity="1",d.appendChild(C)}else if(b.type===18){if(b.name==="attr"){var w=b.values.filter(Ii);w.length&&d.appendChild(o.createTextNode(e.getAttribute(w[0].value)||""))}else if(b.name==="counter"){var M=b.values.filter(pg),P=M[0],k=M[1];if(P&&Ii(P)){var D=s.counters.getCounterValue(P.value),j=k&&Ii(k)?sT.parse(s.context,k.value):3;d.appendChild(o.createTextNode(L_(D,j,!1)))}}else if(b.name==="counters"){var H=b.values.filter(pg),P=H[0],N=H[1],k=H[2];if(P&&Ii(P)){var q=s.counters.getCounterValues(P.value),W=k&&Ii(k)?sT.parse(s.context,k.value):3,ie=N&&N.type===0?N.value:"",se=q.map(function(te){return L_(te,W,!1)}).join(ie);d.appendChild(o.createTextNode(se))}}}else if(b.type===20)switch(b.value){case"open-quote":d.appendChild(o.createTextNode(_N(u.quotes,s.quoteDepth++,!0)));break;case"close-quote":d.appendChild(o.createTextNode(_N(u.quotes,--s.quoteDepth,!1)));break;default:d.appendChild(o.createTextNode(b.value))}}),d.className=BT+" "+CT;var p=i===O_.BEFORE?" "+BT:" "+CT;return P1(t)?t.className.baseValue+=p:t.className+=p,d}}},r.destroy=function(e){return e.parentNode?(e.parentNode.removeChild(e),!0):!1},r}(),O_;(function(r){r[r.BEFORE=0]="BEFORE",r[r.AFTER=1]="AFTER"})(O_||(O_={}));var wbe=function(r,e){var t=r.createElement("iframe");return t.className="html2canvas-container",t.style.visibility="hidden",t.style.position="fixed",t.style.left="-10000px",t.style.top="0px",t.style.border="0",t.width=e.width.toString(),t.height=e.height.toString(),t.scrolling="no",t.setAttribute(s6,"true"),r.body.appendChild(t),t},xbe=function(r){return new Promise(function(e){if(r.complete){e();return}if(!r.src){e();return}r.onload=e,r.onerror=e})},Bbe=function(r){return Promise.all([].slice.call(r.images,0).map(xbe))},Cbe=function(r){return new Promise(function(e,t){var n=r.contentWindow;if(!n)return t("No window assigned for iframe");var i=n.document;n.onload=r.onload=function(){n.onload=r.onload=null;var s=setInterval(function(){i.body.childNodes.length>0&&i.readyState==="complete"&&(clearInterval(s),e(r))},50)}})},Tbe=["all","d","content"],xT=function(r,e){for(var t=r.length-1;t>=0;t--){var n=r.item(t);Tbe.indexOf(n)===-1&&e.style.setProperty(n,r.getPropertyValue(n))}return e},Ebe=function(r){var e="";return r&&(e+="<!DOCTYPE ",r.name&&(e+=r.name),r.internalSubset&&(e+=r.internalSubset),r.publicId&&(e+='"'+r.publicId+'"'),r.systemId&&(e+='"'+r.systemId+'"'),e+=">"),e},Sbe=function(r,e,t){r&&r.defaultView&&(e!==r.defaultView.pageXOffset||t!==r.defaultView.pageYOffset)&&r.defaultView.scrollTo(e,t)},Ibe=function(r){var e=r[0],t=r[1],n=r[2];e.scrollLeft=t,e.scrollTop=n},Pbe=":before",Mbe=":after",BT="___html2canvas___pseudoelement_before",CT="___html2canvas___pseudoelement_after",a6=`{
    content: "" !important;
    display: none !important;
}`,Fbe=function(r){Rbe(r,"."+BT+Pbe+a6+`
         .`+CT+Mbe+a6)},Rbe=function(r,e){var t=r.ownerDocument;if(t){var n=t.createElement("style");n.textContent=e,r.appendChild(n)}},l6=function(){function r(){}return r.getOrigin=function(e){var t=r._link;return t?(t.href=e,t.href=t.href,t.protocol+t.hostname+t.port):"about:blank"},r.isSameOrigin=function(e){return r.getOrigin(e)===r._origin},r.setContext=function(e){r._link=e.document.createElement("a"),r._origin=r.getOrigin(e.location.href)},r._origin="about:blank",r}(),Lbe=function(){function r(e,t){this.context=e,this._options=t,this._cache={}}return r.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)||(ET(e)||kbe(e))&&(this._cache[e]=this.loadImage(e)).catch(function(){}),t},r.prototype.match=function(e){return this._cache[e]},r.prototype.loadImage=function(e){return Ia(this,void 0,void 0,function(){var t,n,i,s,a=this;return pa(this,function(o){switch(o.label){case 0:return t=l6.isSameOrigin(e),n=!TT(e)&&this._options.useCORS===!0&&qo.SUPPORT_CORS_IMAGES&&!t,i=!TT(e)&&!t&&!ET(e)&&typeof this._options.proxy=="string"&&qo.SUPPORT_CORS_XHR&&!n,!t&&this._options.allowTaint===!1&&!TT(e)&&!ET(e)&&!i&&!n?[2]:(s=e,i?[4,this.proxy(s)]:[3,2]);case 1:s=o.sent(),o.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(u,d){var p=new Image;p.onload=function(){return u(p)},p.onerror=d,(Nbe(s)||n)&&(p.crossOrigin="anonymous"),p.src=s,p.complete===!0&&setTimeout(function(){return u(p)},500),a._options.imageTimeout>0&&setTimeout(function(){return d("Timed out ("+a._options.imageTimeout+"ms) loading image")},a._options.imageTimeout)})];case 3:return[2,o.sent()]}})})},r.prototype.has=function(e){return typeof this._cache[e]<"u"},r.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},r.prototype.proxy=function(e){var t=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var i=e.substring(0,256);return new Promise(function(s,a){var o=qo.SUPPORT_RESPONSE_TYPE?"blob":"text",u=new XMLHttpRequest;u.onload=function(){if(u.status===200)if(o==="text")s(u.response);else{var b=new FileReader;b.addEventListener("load",function(){return s(b.result)},!1),b.addEventListener("error",function(C){return a(C)},!1),b.readAsDataURL(u.response)}else a("Failed to proxy resource "+i+" with status code "+u.status)},u.onerror=a;var d=n.indexOf("?")>-1?"&":"?";if(u.open("GET",""+n+d+"url="+encodeURIComponent(e)+"&responseType="+o),o!=="text"&&u instanceof XMLHttpRequest&&(u.responseType=o),t._options.imageTimeout){var p=t._options.imageTimeout;u.timeout=p,u.ontimeout=function(){return a("Timed out ("+p+"ms) proxying "+i)}}u.send()})},r}(),Obe=/^data:image\/svg\+xml/i,Ube=/^data:image\/.*;base64,/i,Dbe=/^data:image\/.*/i,kbe=function(r){return qo.SUPPORT_SVG_DRAWING||!zbe(r)},TT=function(r){return Dbe.test(r)},Nbe=function(r){return Ube.test(r)},ET=function(r){return r.substr(0,4)==="blob"},zbe=function(r){return r.substr(-3).toLowerCase()==="svg"||Obe.test(r)},Pr=function(){function r(e,t){this.type=0,this.x=e,this.y=t}return r.prototype.add=function(e,t){return new r(this.x+e,this.y+t)},r}(),bg=function(r,e,t){return new Pr(r.x+(e.x-r.x)*t,r.y+(e.y-r.y)*t)},R1=function(){function r(e,t,n,i){this.type=1,this.start=e,this.startControl=t,this.endControl=n,this.end=i}return r.prototype.subdivide=function(e,t){var n=bg(this.start,this.startControl,e),i=bg(this.startControl,this.endControl,e),s=bg(this.endControl,this.end,e),a=bg(n,i,e),o=bg(i,s,e),u=bg(a,o,e);return t?new r(this.start,n,a,u):new r(u,o,s,this.end)},r.prototype.add=function(e,t){return new r(this.start.add(e,t),this.startControl.add(e,t),this.endControl.add(e,t),this.end.add(e,t))},r.prototype.reverse=function(){return new r(this.end,this.endControl,this.startControl,this.start)},r}(),sc=function(r){return r.type===1},Qbe=function(){function r(e){var t=e.styles,n=e.bounds,i=S_(t.borderTopLeftRadius,n.width,n.height),s=i[0],a=i[1],o=S_(t.borderTopRightRadius,n.width,n.height),u=o[0],d=o[1],p=S_(t.borderBottomRightRadius,n.width,n.height),b=p[0],C=p[1],w=S_(t.borderBottomLeftRadius,n.width,n.height),M=w[0],P=w[1],k=[];k.push((s+u)/n.width),k.push((M+b)/n.width),k.push((a+P)/n.height),k.push((d+C)/n.height);var D=Math.max.apply(Math,k);D>1&&(s/=D,a/=D,u/=D,d/=D,b/=D,C/=D,M/=D,P/=D);var j=n.width-u,H=n.height-C,N=n.width-b,q=n.height-P,W=t.borderTopWidth,ie=t.borderRightWidth,se=t.borderBottomWidth,Z=t.borderLeftWidth,fe=Qi(t.paddingTop,e.bounds.width),te=Qi(t.paddingRight,e.bounds.width),ce=Qi(t.paddingBottom,e.bounds.width),ve=Qi(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=s>0||a>0?is(n.left+Z/3,n.top+W/3,s-Z/3,a-W/3,mi.TOP_LEFT):new Pr(n.left+Z/3,n.top+W/3),this.topRightBorderDoubleOuterBox=s>0||a>0?is(n.left+j,n.top+W/3,u-ie/3,d-W/3,mi.TOP_RIGHT):new Pr(n.left+n.width-ie/3,n.top+W/3),this.bottomRightBorderDoubleOuterBox=b>0||C>0?is(n.left+N,n.top+H,b-ie/3,C-se/3,mi.BOTTOM_RIGHT):new Pr(n.left+n.width-ie/3,n.top+n.height-se/3),this.bottomLeftBorderDoubleOuterBox=M>0||P>0?is(n.left+Z/3,n.top+q,M-Z/3,P-se/3,mi.BOTTOM_LEFT):new Pr(n.left+Z/3,n.top+n.height-se/3),this.topLeftBorderDoubleInnerBox=s>0||a>0?is(n.left+Z*2/3,n.top+W*2/3,s-Z*2/3,a-W*2/3,mi.TOP_LEFT):new Pr(n.left+Z*2/3,n.top+W*2/3),this.topRightBorderDoubleInnerBox=s>0||a>0?is(n.left+j,n.top+W*2/3,u-ie*2/3,d-W*2/3,mi.TOP_RIGHT):new Pr(n.left+n.width-ie*2/3,n.top+W*2/3),this.bottomRightBorderDoubleInnerBox=b>0||C>0?is(n.left+N,n.top+H,b-ie*2/3,C-se*2/3,mi.BOTTOM_RIGHT):new Pr(n.left+n.width-ie*2/3,n.top+n.height-se*2/3),this.bottomLeftBorderDoubleInnerBox=M>0||P>0?is(n.left+Z*2/3,n.top+q,M-Z*2/3,P-se*2/3,mi.BOTTOM_LEFT):new Pr(n.left+Z*2/3,n.top+n.height-se*2/3),this.topLeftBorderStroke=s>0||a>0?is(n.left+Z/2,n.top+W/2,s-Z/2,a-W/2,mi.TOP_LEFT):new Pr(n.left+Z/2,n.top+W/2),this.topRightBorderStroke=s>0||a>0?is(n.left+j,n.top+W/2,u-ie/2,d-W/2,mi.TOP_RIGHT):new Pr(n.left+n.width-ie/2,n.top+W/2),this.bottomRightBorderStroke=b>0||C>0?is(n.left+N,n.top+H,b-ie/2,C-se/2,mi.BOTTOM_RIGHT):new Pr(n.left+n.width-ie/2,n.top+n.height-se/2),this.bottomLeftBorderStroke=M>0||P>0?is(n.left+Z/2,n.top+q,M-Z/2,P-se/2,mi.BOTTOM_LEFT):new Pr(n.left+Z/2,n.top+n.height-se/2),this.topLeftBorderBox=s>0||a>0?is(n.left,n.top,s,a,mi.TOP_LEFT):new Pr(n.left,n.top),this.topRightBorderBox=u>0||d>0?is(n.left+j,n.top,u,d,mi.TOP_RIGHT):new Pr(n.left+n.width,n.top),this.bottomRightBorderBox=b>0||C>0?is(n.left+N,n.top+H,b,C,mi.BOTTOM_RIGHT):new Pr(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=M>0||P>0?is(n.left,n.top+q,M,P,mi.BOTTOM_LEFT):new Pr(n.left,n.top+n.height),this.topLeftPaddingBox=s>0||a>0?is(n.left+Z,n.top+W,Math.max(0,s-Z),Math.max(0,a-W),mi.TOP_LEFT):new Pr(n.left+Z,n.top+W),this.topRightPaddingBox=u>0||d>0?is(n.left+Math.min(j,n.width-ie),n.top+W,j>n.width+ie?0:Math.max(0,u-ie),Math.max(0,d-W),mi.TOP_RIGHT):new Pr(n.left+n.width-ie,n.top+W),this.bottomRightPaddingBox=b>0||C>0?is(n.left+Math.min(N,n.width-Z),n.top+Math.min(H,n.height-se),Math.max(0,b-ie),Math.max(0,C-se),mi.BOTTOM_RIGHT):new Pr(n.left+n.width-ie,n.top+n.height-se),this.bottomLeftPaddingBox=M>0||P>0?is(n.left+Z,n.top+Math.min(q,n.height-se),Math.max(0,M-Z),Math.max(0,P-se),mi.BOTTOM_LEFT):new Pr(n.left+Z,n.top+n.height-se),this.topLeftContentBox=s>0||a>0?is(n.left+Z+ve,n.top+W+fe,Math.max(0,s-(Z+ve)),Math.max(0,a-(W+fe)),mi.TOP_LEFT):new Pr(n.left+Z+ve,n.top+W+fe),this.topRightContentBox=u>0||d>0?is(n.left+Math.min(j,n.width+Z+ve),n.top+W+fe,j>n.width+Z+ve?0:u-Z+ve,d-(W+fe),mi.TOP_RIGHT):new Pr(n.left+n.width-(ie+te),n.top+W+fe),this.bottomRightContentBox=b>0||C>0?is(n.left+Math.min(N,n.width-(Z+ve)),n.top+Math.min(H,n.height+W+fe),Math.max(0,b-(ie+te)),C-(se+ce),mi.BOTTOM_RIGHT):new Pr(n.left+n.width-(ie+te),n.top+n.height-(se+ce)),this.bottomLeftContentBox=M>0||P>0?is(n.left+Z+ve,n.top+q,Math.max(0,M-(Z+ve)),P-(se+ce),mi.BOTTOM_LEFT):new Pr(n.left+Z+ve,n.top+n.height-(se+ce))}return r}(),mi;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.TOP_RIGHT=1]="TOP_RIGHT",r[r.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",r[r.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(mi||(mi={}));var is=function(r,e,t,n,i){var s=4*((Math.sqrt(2)-1)/3),a=t*s,o=n*s,u=r+t,d=e+n;switch(i){case mi.TOP_LEFT:return new R1(new Pr(r,d),new Pr(r,d-o),new Pr(u-a,e),new Pr(u,e));case mi.TOP_RIGHT:return new R1(new Pr(r,e),new Pr(r+a,e),new Pr(u,d-o),new Pr(u,d));case mi.BOTTOM_RIGHT:return new R1(new Pr(u,e),new Pr(u,e+o),new Pr(r+a,d),new Pr(r,d));case mi.BOTTOM_LEFT:default:return new R1(new Pr(u,d),new Pr(u-a,d),new Pr(r,e+o),new Pr(r,e))}},L1=function(r){return[r.topLeftBorderBox,r.topRightBorderBox,r.bottomRightBorderBox,r.bottomLeftBorderBox]},Hbe=function(r){return[r.topLeftContentBox,r.topRightContentBox,r.bottomRightContentBox,r.bottomLeftContentBox]},O1=function(r){return[r.topLeftPaddingBox,r.topRightPaddingBox,r.bottomRightPaddingBox,r.bottomLeftPaddingBox]},Vbe=function(){function r(e,t,n){this.offsetX=e,this.offsetY=t,this.matrix=n,this.type=0,this.target=6}return r}(),U1=function(){function r(e,t){this.path=e,this.target=t,this.type=1}return r}(),jbe=function(){function r(e){this.opacity=e,this.type=2,this.target=6}return r}(),$be=function(r){return r.type===0},c6=function(r){return r.type===1},Gbe=function(r){return r.type===2},u6=function(r,e){return r.length===e.length?r.some(function(t,n){return t===e[n]}):!1},Wbe=function(r,e,t,n,i){return r.map(function(s,a){switch(a){case 0:return s.add(e,t);case 1:return s.add(e+n,t);case 2:return s.add(e+n,t+i);case 3:return s.add(e,t+i)}return s})},h6=function(){function r(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return r}(),A6=function(){function r(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new Qbe(this.container),this.container.styles.opacity<1&&this.effects.push(new jbe(this.container.styles.opacity)),this.container.styles.transform!==null){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,i=this.container.bounds.top+this.container.styles.transformOrigin[1].number,s=this.container.styles.transform;this.effects.push(new Vbe(n,i,s))}if(this.container.styles.overflowX!==0){var a=L1(this.curves),o=O1(this.curves);u6(a,o)?this.effects.push(new U1(a,6)):(this.effects.push(new U1(a,2)),this.effects.push(new U1(o,4)))}}return r.prototype.getEffects=function(e){for(var t=[2,3].indexOf(this.container.styles.position)===-1,n=this.parent,i=this.effects.slice(0);n;){var s=n.effects.filter(function(u){return!c6(u)});if(t||n.container.styles.position!==0||!n.parent){if(i.unshift.apply(i,s),t=[2,3].indexOf(n.container.styles.position)===-1,n.container.styles.overflowX!==0){var a=L1(n.curves),o=O1(n.curves);u6(a,o)||i.unshift(new U1(o,6))}}else i.unshift.apply(i,s);n=n.parent}return i.filter(function(u){return vo(u.target,e)})},r}(),ST=function(r,e,t,n){r.container.elements.forEach(function(i){var s=vo(i.flags,4),a=vo(i.flags,2),o=new A6(i,r);vo(i.styles.display,2048)&&n.push(o);var u=vo(i.flags,8)?[]:n;if(s||a){var d=s||i.styles.isPositioned()?t:e,p=new h6(o);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var b=i.styles.zIndex.order;if(b<0){var C=0;d.negativeZIndex.some(function(M,P){return b>M.element.container.styles.zIndex.order?(C=P,!1):C>0}),d.negativeZIndex.splice(C,0,p)}else if(b>0){var w=0;d.positiveZIndex.some(function(M,P){return b>=M.element.container.styles.zIndex.order?(w=P+1,!1):w>0}),d.positiveZIndex.splice(w,0,p)}else d.zeroOrAutoZIndexOrTransformedOrOpacity.push(p)}else i.styles.isFloating()?d.nonPositionedFloats.push(p):d.nonPositionedInlineLevel.push(p);ST(o,p,s?p:t,u)}else i.styles.isInlineLevel()?e.inlineLevel.push(o):e.nonInlineLevel.push(o),ST(o,e,t,u);vo(i.flags,8)&&f6(i,u)})},f6=function(r,e){for(var t=r instanceof mT?r.start:1,n=r instanceof mT?r.reversed:!1,i=0;i<e.length;i++){var s=e[i];s.container instanceof kN&&typeof s.container.value=="number"&&s.container.value!==0&&(t=s.container.value),s.listValue=L_(t,s.container.styles.listStyleType,!0),t+=n?-1:1}},qbe=function(r){var e=new A6(r,null),t=new h6(e),n=[];return ST(e,t,t,n),f6(e.container,n),t},d6=function(r,e){switch(e){case 0:return oc(r.topLeftBorderBox,r.topLeftPaddingBox,r.topRightBorderBox,r.topRightPaddingBox);case 1:return oc(r.topRightBorderBox,r.topRightPaddingBox,r.bottomRightBorderBox,r.bottomRightPaddingBox);case 2:return oc(r.bottomRightBorderBox,r.bottomRightPaddingBox,r.bottomLeftBorderBox,r.bottomLeftPaddingBox);case 3:default:return oc(r.bottomLeftBorderBox,r.bottomLeftPaddingBox,r.topLeftBorderBox,r.topLeftPaddingBox)}},Kbe=function(r,e){switch(e){case 0:return oc(r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox,r.topRightBorderBox,r.topRightBorderDoubleOuterBox);case 1:return oc(r.topRightBorderBox,r.topRightBorderDoubleOuterBox,r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox);case 2:return oc(r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox,r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox);case 3:default:return oc(r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox,r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox)}},Xbe=function(r,e){switch(e){case 0:return oc(r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox,r.topRightBorderDoubleInnerBox,r.topRightPaddingBox);case 1:return oc(r.topRightBorderDoubleInnerBox,r.topRightPaddingBox,r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox);case 2:return oc(r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox,r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox);case 3:default:return oc(r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox,r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox)}},Ybe=function(r,e){switch(e){case 0:return D1(r.topLeftBorderStroke,r.topRightBorderStroke);case 1:return D1(r.topRightBorderStroke,r.bottomRightBorderStroke);case 2:return D1(r.bottomRightBorderStroke,r.bottomLeftBorderStroke);case 3:default:return D1(r.bottomLeftBorderStroke,r.topLeftBorderStroke)}},D1=function(r,e){var t=[];return sc(r)?t.push(r.subdivide(.5,!1)):t.push(r),sc(e)?t.push(e.subdivide(.5,!0)):t.push(e),t},oc=function(r,e,t,n){var i=[];return sc(r)?i.push(r.subdivide(.5,!1)):i.push(r),sc(t)?i.push(t.subdivide(.5,!0)):i.push(t),sc(n)?i.push(n.subdivide(.5,!0).reverse()):i.push(n),sc(e)?i.push(e.subdivide(.5,!1).reverse()):i.push(e),i},p6=function(r){var e=r.bounds,t=r.styles;return e.add(t.borderLeftWidth,t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth),-(t.borderTopWidth+t.borderBottomWidth))},k1=function(r){var e=r.styles,t=r.bounds,n=Qi(e.paddingLeft,t.width),i=Qi(e.paddingRight,t.width),s=Qi(e.paddingTop,t.width),a=Qi(e.paddingBottom,t.width);return t.add(n+e.borderLeftWidth,s+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+n+i),-(e.borderTopWidth+e.borderBottomWidth+s+a))},Zbe=function(r,e){return r===0?e.bounds:r===2?k1(e):p6(e)},Jbe=function(r,e){return r===0?e.bounds:r===2?k1(e):p6(e)},IT=function(r,e,t){var n=Zbe(wg(r.styles.backgroundOrigin,e),r),i=Jbe(wg(r.styles.backgroundClip,e),r),s=e1e(wg(r.styles.backgroundSize,e),t,n),a=s[0],o=s[1],u=S_(wg(r.styles.backgroundPosition,e),n.width-a,n.height-o),d=t1e(wg(r.styles.backgroundRepeat,e),u,s,n,i),p=Math.round(n.left+u[0]),b=Math.round(n.top+u[1]);return[d,p,b,a,o]},vg=function(r){return Ii(r)&&r.value===gg.AUTO},N1=function(r){return typeof r=="number"},e1e=function(r,e,t){var n=e[0],i=e[1],s=e[2],a=r[0],o=r[1];if(!a)return[0,0];if(eo(a)&&o&&eo(o))return[Qi(a,t.width),Qi(o,t.height)];var u=N1(s);if(Ii(a)&&(a.value===gg.CONTAIN||a.value===gg.COVER)){if(N1(s)){var d=t.width/t.height;return d<s!=(a.value===gg.COVER)?[t.width,t.width/s]:[t.height*s,t.height]}return[t.width,t.height]}var p=N1(n),b=N1(i),C=p||b;if(vg(a)&&(!o||vg(o))){if(p&&b)return[n,i];if(!u&&!C)return[t.width,t.height];if(C&&u){var w=p?n:i*s,M=b?i:n/s;return[w,M]}var P=p?n:t.width,k=b?i:t.height;return[P,k]}if(u){var D=0,j=0;return eo(a)?D=Qi(a,t.width):eo(o)&&(j=Qi(o,t.height)),vg(a)?D=j*s:(!o||vg(o))&&(j=D/s),[D,j]}var H=null,N=null;if(eo(a)?H=Qi(a,t.width):o&&eo(o)&&(N=Qi(o,t.height)),H!==null&&(!o||vg(o))&&(N=p&&b?H/n*i:t.height),N!==null&&vg(a)&&(H=p&&b?N/i*n:t.width),H!==null&&N!==null)return[H,N];throw new Error("Unable to calculate background-size for element")},wg=function(r,e){var t=r[e];return typeof t>"u"?r[0]:t},t1e=function(r,e,t,n,i){var s=e[0],a=e[1],o=t[0],u=t[1];switch(r){case 2:return[new Pr(Math.round(n.left),Math.round(n.top+a)),new Pr(Math.round(n.left+n.width),Math.round(n.top+a)),new Pr(Math.round(n.left+n.width),Math.round(u+n.top+a)),new Pr(Math.round(n.left),Math.round(u+n.top+a))];case 3:return[new Pr(Math.round(n.left+s),Math.round(n.top)),new Pr(Math.round(n.left+s+o),Math.round(n.top)),new Pr(Math.round(n.left+s+o),Math.round(n.height+n.top)),new Pr(Math.round(n.left+s),Math.round(n.height+n.top))];case 1:return[new Pr(Math.round(n.left+s),Math.round(n.top+a)),new Pr(Math.round(n.left+s+o),Math.round(n.top+a)),new Pr(Math.round(n.left+s+o),Math.round(n.top+a+u)),new Pr(Math.round(n.left+s),Math.round(n.top+a+u))];default:return[new Pr(Math.round(i.left),Math.round(i.top)),new Pr(Math.round(i.left+i.width),Math.round(i.top)),new Pr(Math.round(i.left+i.width),Math.round(i.height+i.top)),new Pr(Math.round(i.left),Math.round(i.height+i.top))]}},r1e="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",g6="Hidden Text",n1e=function(){function r(e){this._data={},this._document=e}return r.prototype.parseMetrics=function(e,t){var n=this._document.createElement("div"),i=this._document.createElement("img"),s=this._document.createElement("span"),a=this._document.body;n.style.visibility="hidden",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",a.appendChild(n),i.src=r1e,i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",s.style.fontFamily=e,s.style.fontSize=t,s.style.margin="0",s.style.padding="0",s.appendChild(this._document.createTextNode(g6)),n.appendChild(s),n.appendChild(i);var o=i.offsetTop-s.offsetTop+2;n.removeChild(s),n.appendChild(this._document.createTextNode(g6)),n.style.lineHeight="normal",i.style.verticalAlign="super";var u=i.offsetTop-n.offsetTop+2;return a.removeChild(n),{baseline:o,middle:u}},r.prototype.getMetrics=function(e,t){var n=e+" "+t;return typeof this._data[n]>"u"&&(this._data[n]=this.parseMetrics(e,t)),this._data[n]},r}(),m6=function(){function r(e,t){this.context=e,this.options=t}return r}(),i1e=1e4,s1e=function(r){tu(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i._activeEffects=[],i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),n.canvas||(i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px"),i.fontMetrics=new n1e(document),i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.ctx.textBaseline="bottom",i._activeEffects=[],i.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),i}return e.prototype.applyEffects=function(t){for(var n=this;this._activeEffects.length;)this.popEffect();t.forEach(function(i){return n.applyEffect(i)})},e.prototype.applyEffect=function(t){this.ctx.save(),Gbe(t)&&(this.ctx.globalAlpha=t.opacity),$be(t)&&(this.ctx.translate(t.offsetX,t.offsetY),this.ctx.transform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this.ctx.translate(-t.offsetX,-t.offsetY)),c6(t)&&(this.path(t.path),this.ctx.clip()),this._activeEffects.push(t)},e.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},e.prototype.renderStack=function(t){return Ia(this,void 0,void 0,function(){var n;return pa(this,function(i){switch(i.label){case 0:return n=t.element.container.styles,n.isVisible()?[4,this.renderStackContent(t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},e.prototype.renderNode=function(t){return Ia(this,void 0,void 0,function(){return pa(this,function(n){switch(n.label){case 0:if(vo(t.container.flags,16))debugger;return t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return n.sent(),[4,this.renderNodeContent(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.renderTextWithLetterSpacing=function(t,n,i){var s=this;if(n===0)this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+i);else{var a=gT(t.text);a.reduce(function(o,u){return s.ctx.fillText(u,o,t.bounds.top+i),o+s.ctx.measureText(u).width},t.bounds.left)}},e.prototype.createFontStyle=function(t){var n=t.fontVariant.filter(function(a){return a==="normal"||a==="small-caps"}).join(""),i=u1e(t.fontFamily).join(", "),s=E_(t.fontSize)?""+t.fontSize.number+t.fontSize.unit:t.fontSize.number+"px";return[[t.fontStyle,n,t.fontWeight,s,i].join(" "),i,s]},e.prototype.renderTextNode=function(t,n){return Ia(this,void 0,void 0,function(){var i,s,a,o,u,d,p,b,C=this;return pa(this,function(w){return i=this.createFontStyle(n),s=i[0],a=i[1],o=i[2],this.ctx.font=s,this.ctx.direction=n.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",u=this.fontMetrics.getMetrics(a,o),d=u.baseline,p=u.middle,b=n.paintOrder,t.textBounds.forEach(function(M){b.forEach(function(P){switch(P){case 0:C.ctx.fillStyle=Uo(n.color),C.renderTextWithLetterSpacing(M,n.letterSpacing,d);var k=n.textShadow;k.length&&M.text.trim().length&&(k.slice(0).reverse().forEach(function(D){C.ctx.shadowColor=Uo(D.color),C.ctx.shadowOffsetX=D.offsetX.number*C.options.scale,C.ctx.shadowOffsetY=D.offsetY.number*C.options.scale,C.ctx.shadowBlur=D.blur.number,C.renderTextWithLetterSpacing(M,n.letterSpacing,d)}),C.ctx.shadowColor="",C.ctx.shadowOffsetX=0,C.ctx.shadowOffsetY=0,C.ctx.shadowBlur=0),n.textDecorationLine.length&&(C.ctx.fillStyle=Uo(n.textDecorationColor||n.color),n.textDecorationLine.forEach(function(D){switch(D){case 1:C.ctx.fillRect(M.bounds.left,Math.round(M.bounds.top+d),M.bounds.width,1);break;case 2:C.ctx.fillRect(M.bounds.left,Math.round(M.bounds.top),M.bounds.width,1);break;case 3:C.ctx.fillRect(M.bounds.left,Math.ceil(M.bounds.top+p),M.bounds.width,1);break}}));break;case 1:n.webkitTextStrokeWidth&&M.text.trim().length&&(C.ctx.strokeStyle=Uo(n.webkitTextStrokeColor),C.ctx.lineWidth=n.webkitTextStrokeWidth,C.ctx.lineJoin=window.chrome?"miter":"round",C.ctx.strokeText(M.text,M.bounds.left,M.bounds.top+d)),C.ctx.strokeStyle="",C.ctx.lineWidth=0,C.ctx.lineJoin="miter";break}})}),[2]})})},e.prototype.renderReplacedElement=function(t,n,i){if(i&&t.intrinsicWidth>0&&t.intrinsicHeight>0){var s=k1(t),a=O1(n);this.path(a),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(i,0,0,t.intrinsicWidth,t.intrinsicHeight,s.left,s.top,s.width,s.height),this.ctx.restore()}},e.prototype.renderNodeContent=function(t){return Ia(this,void 0,void 0,function(){var n,i,s,a,o,u,j,j,d,p,b,C,N,w,M,q,P,k,D,j,H,N,q;return pa(this,function(W){switch(W.label){case 0:this.applyEffects(t.getEffects(4)),n=t.container,i=t.curves,s=n.styles,a=0,o=n.textNodes,W.label=1;case 1:return a<o.length?(u=o[a],[4,this.renderTextNode(u,s)]):[3,4];case 2:W.sent(),W.label=3;case 3:return a++,[3,1];case 4:if(!(n instanceof ON))return[3,8];W.label=5;case 5:return W.trys.push([5,7,,8]),[4,this.context.cache.match(n.src)];case 6:return j=W.sent(),this.renderReplacedElement(n,i,j),[3,8];case 7:return W.sent(),this.context.logger.error("Error loading image "+n.src),[3,8];case 8:if(n instanceof UN&&this.renderReplacedElement(n,i,n.canvas),!(n instanceof DN))return[3,12];W.label=9;case 9:return W.trys.push([9,11,,12]),[4,this.context.cache.match(n.svg)];case 10:return j=W.sent(),this.renderReplacedElement(n,i,j),[3,12];case 11:return W.sent(),this.context.logger.error("Error loading svg "+n.svg.substring(0,255)),[3,12];case 12:return n instanceof HN&&n.tree?(d=new e(this.context,{scale:this.options.scale,backgroundColor:n.backgroundColor,x:0,y:0,width:n.width,height:n.height}),[4,d.render(n.tree)]):[3,14];case 13:p=W.sent(),n.width&&n.height&&this.ctx.drawImage(p,0,0,n.width,n.height,n.bounds.left,n.bounds.top,n.bounds.width,n.bounds.height),W.label=14;case 14:if(n instanceof _T&&(b=Math.min(n.bounds.width,n.bounds.height),n.type===E1?n.checked&&(this.ctx.save(),this.path([new Pr(n.bounds.left+b*.39363,n.bounds.top+b*.79),new Pr(n.bounds.left+b*.16,n.bounds.top+b*.5549),new Pr(n.bounds.left+b*.27347,n.bounds.top+b*.44071),new Pr(n.bounds.left+b*.39694,n.bounds.top+b*.5649),new Pr(n.bounds.left+b*.72983,n.bounds.top+b*.23),new Pr(n.bounds.left+b*.84,n.bounds.top+b*.34085),new Pr(n.bounds.left+b*.39363,n.bounds.top+b*.79)]),this.ctx.fillStyle=Uo(NN),this.ctx.fill(),this.ctx.restore()):n.type===S1&&n.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(n.bounds.left+b/2,n.bounds.top+b/2,b/4,0,Math.PI*2,!0),this.ctx.fillStyle=Uo(NN),this.ctx.fill(),this.ctx.restore())),o1e(n)&&n.value.length){switch(C=this.createFontStyle(s),N=C[0],w=C[1],M=this.fontMetrics.getMetrics(N,w).baseline,this.ctx.font=N,this.ctx.fillStyle=Uo(s.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=l1e(n.styles.textAlign),q=k1(n),P=0,n.styles.textAlign){case 1:P+=q.width/2;break;case 2:P+=q.width;break}k=q.add(P,0,0,-q.height/2+1),this.ctx.save(),this.path([new Pr(q.left,q.top),new Pr(q.left+q.width,q.top),new Pr(q.left+q.width,q.top+q.height),new Pr(q.left,q.top+q.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new F_(n.value,k),s.letterSpacing,M),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!vo(n.styles.display,2048))return[3,20];if(n.styles.listStyleImage===null)return[3,19];if(D=n.styles.listStyleImage,D.type!==0)return[3,18];j=void 0,H=D.url,W.label=15;case 15:return W.trys.push([15,17,,18]),[4,this.context.cache.match(H)];case 16:return j=W.sent(),this.ctx.drawImage(j,n.bounds.left-(j.width+10),n.bounds.top),[3,18];case 17:return W.sent(),this.context.logger.error("Error loading list-style-image "+H),[3,18];case 18:return[3,20];case 19:t.listValue&&n.styles.listStyleType!==-1&&(N=this.createFontStyle(s)[0],this.ctx.font=N,this.ctx.fillStyle=Uo(s.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",q=new Vh(n.bounds.left,n.bounds.top+Qi(n.styles.paddingTop,n.bounds.width),n.bounds.width,pN(s.lineHeight,s.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new F_(t.listValue,q),s.letterSpacing,pN(s.lineHeight,s.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),W.label=20;case 20:return[2]}})})},e.prototype.renderStackContent=function(t){return Ia(this,void 0,void 0,function(){var n,i,D,s,a,D,o,u,D,d,p,D,b,C,D,w,M,D,P,k,D;return pa(this,function(j){switch(j.label){case 0:if(vo(t.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(t.element)];case 1:j.sent(),n=0,i=t.negativeZIndex,j.label=2;case 2:return n<i.length?(D=i[n],[4,this.renderStack(D)]):[3,5];case 3:j.sent(),j.label=4;case 4:return n++,[3,2];case 5:return[4,this.renderNodeContent(t.element)];case 6:j.sent(),s=0,a=t.nonInlineLevel,j.label=7;case 7:return s<a.length?(D=a[s],[4,this.renderNode(D)]):[3,10];case 8:j.sent(),j.label=9;case 9:return s++,[3,7];case 10:o=0,u=t.nonPositionedFloats,j.label=11;case 11:return o<u.length?(D=u[o],[4,this.renderStack(D)]):[3,14];case 12:j.sent(),j.label=13;case 13:return o++,[3,11];case 14:d=0,p=t.nonPositionedInlineLevel,j.label=15;case 15:return d<p.length?(D=p[d],[4,this.renderStack(D)]):[3,18];case 16:j.sent(),j.label=17;case 17:return d++,[3,15];case 18:b=0,C=t.inlineLevel,j.label=19;case 19:return b<C.length?(D=C[b],[4,this.renderNode(D)]):[3,22];case 20:j.sent(),j.label=21;case 21:return b++,[3,19];case 22:w=0,M=t.zeroOrAutoZIndexOrTransformedOrOpacity,j.label=23;case 23:return w<M.length?(D=M[w],[4,this.renderStack(D)]):[3,26];case 24:j.sent(),j.label=25;case 25:return w++,[3,23];case 26:P=0,k=t.positiveZIndex,j.label=27;case 27:return P<k.length?(D=k[P],[4,this.renderStack(D)]):[3,30];case 28:j.sent(),j.label=29;case 29:return P++,[3,27];case 30:return[2]}})})},e.prototype.mask=function(t){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(t.slice(0).reverse()),this.ctx.closePath()},e.prototype.path=function(t){this.ctx.beginPath(),this.formatPath(t),this.ctx.closePath()},e.prototype.formatPath=function(t){var n=this;t.forEach(function(i,s){var a=sc(i)?i.start:i;s===0?n.ctx.moveTo(a.x,a.y):n.ctx.lineTo(a.x,a.y),sc(i)&&n.ctx.bezierCurveTo(i.startControl.x,i.startControl.y,i.endControl.x,i.endControl.y,i.end.x,i.end.y)})},e.prototype.renderRepeat=function(t,n,i,s){this.path(t),this.ctx.fillStyle=n,this.ctx.translate(i,s),this.ctx.fill(),this.ctx.translate(-i,-s)},e.prototype.resizeImage=function(t,n,i){var s;if(t.width===n&&t.height===i)return t;var a=(s=this.canvas.ownerDocument)!==null&&s!==void 0?s:document,o=a.createElement("canvas");o.width=Math.max(1,n),o.height=Math.max(1,i);var u=o.getContext("2d");return u.drawImage(t,0,0,t.width,t.height,0,0,n,i),o},e.prototype.renderBackgroundImage=function(t){return Ia(this,void 0,void 0,function(){var n,i,s,a,o,u;return pa(this,function(d){switch(d.label){case 0:n=t.styles.backgroundImage.length-1,i=function(p){var b,C,w,fe,ot,st,ve,me,se,M,fe,ot,st,ve,me,P,k,D,j,H,N,q,W,ie,se,Z,fe,te,ce,ve,me,qe,ot,st,Ye,Xe,wt,ht,he,Be,Le,He;return pa(this,function(rt){switch(rt.label){case 0:if(p.type!==0)return[3,5];b=void 0,C=p.url,rt.label=1;case 1:return rt.trys.push([1,3,,4]),[4,s.context.cache.match(C)];case 2:return b=rt.sent(),[3,4];case 3:return rt.sent(),s.context.logger.error("Error loading background-image "+C),[3,4];case 4:return b&&(w=IT(t,n,[b.width,b.height,b.width/b.height]),fe=w[0],ot=w[1],st=w[2],ve=w[3],me=w[4],se=s.ctx.createPattern(s.resizeImage(b,ve,me),"repeat"),s.renderRepeat(fe,se,ot,st)),[3,6];case 5:$_e(p)?(M=IT(t,n,[null,null,null]),fe=M[0],ot=M[1],st=M[2],ve=M[3],me=M[4],P=z_e(p.angle,ve,me),k=P[0],D=P[1],j=P[2],H=P[3],N=P[4],q=document.createElement("canvas"),q.width=ve,q.height=me,W=q.getContext("2d"),ie=W.createLinearGradient(D,H,j,N),iN(p.stops,k).forEach(function(it){return ie.addColorStop(it.stop,Uo(it.color))}),W.fillStyle=ie,W.fillRect(0,0,ve,me),ve>0&&me>0&&(se=s.ctx.createPattern(q,"repeat"),s.renderRepeat(fe,se,ot,st))):G_e(p)&&(Z=IT(t,n,[null,null,null]),fe=Z[0],te=Z[1],ce=Z[2],ve=Z[3],me=Z[4],qe=p.position.length===0?[rT]:p.position,ot=Qi(qe[0],ve),st=Qi(qe[qe.length-1],me),Ye=Q_e(p,ot,st,ve,me),Xe=Ye[0],wt=Ye[1],Xe>0&&wt>0&&(ht=s.ctx.createRadialGradient(te+ot,ce+st,0,te+ot,ce+st,Xe),iN(p.stops,Xe*2).forEach(function(it){return ht.addColorStop(it.stop,Uo(it.color))}),s.path(fe),s.ctx.fillStyle=ht,Xe!==wt?(he=t.bounds.left+.5*t.bounds.width,Be=t.bounds.top+.5*t.bounds.height,Le=wt/Xe,He=1/Le,s.ctx.save(),s.ctx.translate(he,Be),s.ctx.transform(1,0,0,Le,0,0),s.ctx.translate(-he,-Be),s.ctx.fillRect(te,He*(ce-Be)+Be,ve,me*He),s.ctx.restore()):s.ctx.fill())),rt.label=6;case 6:return n--,[2]}})},s=this,a=0,o=t.styles.backgroundImage.slice(0).reverse(),d.label=1;case 1:return a<o.length?(u=o[a],[5,i(u)]):[3,4];case 2:d.sent(),d.label=3;case 3:return a++,[3,1];case 4:return[2]}})})},e.prototype.renderSolidBorder=function(t,n,i){return Ia(this,void 0,void 0,function(){return pa(this,function(s){return this.path(d6(i,n)),this.ctx.fillStyle=Uo(t),this.ctx.fill(),[2]})})},e.prototype.renderDoubleBorder=function(t,n,i,s){return Ia(this,void 0,void 0,function(){var a,o;return pa(this,function(u){switch(u.label){case 0:return n<3?[4,this.renderSolidBorder(t,i,s)]:[3,2];case 1:return u.sent(),[2];case 2:return a=Kbe(s,i),this.path(a),this.ctx.fillStyle=Uo(t),this.ctx.fill(),o=Xbe(s,i),this.path(o),this.ctx.fill(),[2]}})})},e.prototype.renderNodeBackgroundAndBorders=function(t){return Ia(this,void 0,void 0,function(){var n,i,s,a,o,u,d,p,b=this;return pa(this,function(C){switch(C.label){case 0:return this.applyEffects(t.getEffects(2)),n=t.container.styles,i=!tf(n.backgroundColor)||n.backgroundImage.length,s=[{style:n.borderTopStyle,color:n.borderTopColor,width:n.borderTopWidth},{style:n.borderRightStyle,color:n.borderRightColor,width:n.borderRightWidth},{style:n.borderBottomStyle,color:n.borderBottomColor,width:n.borderBottomWidth},{style:n.borderLeftStyle,color:n.borderLeftColor,width:n.borderLeftWidth}],a=a1e(wg(n.backgroundClip,0),t.curves),i||n.boxShadow.length?(this.ctx.save(),this.path(a),this.ctx.clip(),tf(n.backgroundColor)||(this.ctx.fillStyle=Uo(n.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(t.container)]):[3,2];case 1:C.sent(),this.ctx.restore(),n.boxShadow.slice(0).reverse().forEach(function(w){b.ctx.save();var M=L1(t.curves),P=w.inset?0:i1e,k=Wbe(M,-P+(w.inset?1:-1)*w.spread.number,(w.inset?1:-1)*w.spread.number,w.spread.number*(w.inset?-2:2),w.spread.number*(w.inset?-2:2));w.inset?(b.path(M),b.ctx.clip(),b.mask(k)):(b.mask(M),b.ctx.clip(),b.path(k)),b.ctx.shadowOffsetX=w.offsetX.number+P,b.ctx.shadowOffsetY=w.offsetY.number,b.ctx.shadowColor=Uo(w.color),b.ctx.shadowBlur=w.blur.number,b.ctx.fillStyle=w.inset?Uo(w.color):"rgba(0,0,0,1)",b.ctx.fill(),b.ctx.restore()}),C.label=2;case 2:o=0,u=0,d=s,C.label=3;case 3:return u<d.length?(p=d[u],p.style!==0&&!tf(p.color)&&p.width>0?p.style!==2?[3,5]:[4,this.renderDashedDottedBorder(p.color,p.width,o,t.curves,2)]:[3,11]):[3,13];case 4:return C.sent(),[3,11];case 5:return p.style!==3?[3,7]:[4,this.renderDashedDottedBorder(p.color,p.width,o,t.curves,3)];case 6:return C.sent(),[3,11];case 7:return p.style!==4?[3,9]:[4,this.renderDoubleBorder(p.color,p.width,o,t.curves)];case 8:return C.sent(),[3,11];case 9:return[4,this.renderSolidBorder(p.color,o,t.curves)];case 10:C.sent(),C.label=11;case 11:o++,C.label=12;case 12:return u++,[3,3];case 13:return[2]}})})},e.prototype.renderDashedDottedBorder=function(t,n,i,s,a){return Ia(this,void 0,void 0,function(){var o,u,d,p,b,C,w,M,P,k,D,j,H,N,q,W,q,W;return pa(this,function(ie){return this.ctx.save(),o=Ybe(s,i),u=d6(s,i),a===2&&(this.path(u),this.ctx.clip()),sc(u[0])?(d=u[0].start.x,p=u[0].start.y):(d=u[0].x,p=u[0].y),sc(u[1])?(b=u[1].end.x,C=u[1].end.y):(b=u[1].x,C=u[1].y),i===0||i===2?w=Math.abs(d-b):w=Math.abs(p-C),this.ctx.beginPath(),a===3?this.formatPath(o):this.formatPath(u.slice(0,2)),M=n<3?n*3:n*2,P=n<3?n*2:n,a===3&&(M=n,P=n),k=!0,w<=M*2?k=!1:w<=M*2+P?(D=w/(2*M+P),M*=D,P*=D):(j=Math.floor((w+P)/(M+P)),H=(w-j*M)/(j-1),N=(w-(j+1)*M)/j,P=N<=0||Math.abs(P-H)<Math.abs(P-N)?H:N),k&&(a===3?this.ctx.setLineDash([0,M+P]):this.ctx.setLineDash([M,P])),a===3?(this.ctx.lineCap="round",this.ctx.lineWidth=n):this.ctx.lineWidth=n*2+1.1,this.ctx.strokeStyle=Uo(t),this.ctx.stroke(),this.ctx.setLineDash([]),a===2&&(sc(u[0])&&(q=u[3],W=u[0],this.ctx.beginPath(),this.formatPath([new Pr(q.end.x,q.end.y),new Pr(W.start.x,W.start.y)]),this.ctx.stroke()),sc(u[1])&&(q=u[1],W=u[2],this.ctx.beginPath(),this.formatPath([new Pr(q.end.x,q.end.y),new Pr(W.start.x,W.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},e.prototype.render=function(t){return Ia(this,void 0,void 0,function(){var n;return pa(this,function(i){switch(i.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=Uo(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),n=qbe(t),[4,this.renderStack(n)];case 1:return i.sent(),this.applyEffects([]),[2,this.canvas]}})})},e}(m6),o1e=function(r){return r instanceof QN||r instanceof zN?!0:r instanceof _T&&r.type!==S1&&r.type!==E1},a1e=function(r,e){switch(r){case 0:return L1(e);case 2:return Hbe(e);case 1:default:return O1(e)}},l1e=function(r){switch(r){case 1:return"center";case 2:return"right";case 0:default:return"left"}},c1e=["-apple-system","system-ui"],u1e=function(r){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?r.filter(function(e){return c1e.indexOf(e)===-1}):r},h1e=function(r){tu(e,r);function e(t,n){var i=r.call(this,t,n)||this;return i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),i.options=n,i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px",i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),i}return e.prototype.render=function(t){return Ia(this,void 0,void 0,function(){var n,i;return pa(this,function(s){switch(s.label){case 0:return n=pT(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,A1e(n)];case 1:return i=s.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=Uo(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(i,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e}(m6),A1e=function(r){return new Promise(function(e,t){var n=new Image;n.onload=function(){e(n)},n.onerror=t,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},f1e=function(){function r(e){var t=e.id,n=e.enabled;this.id=t,this.enabled=n,this.start=Date.now()}return r.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,Wb([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.prototype.getTime=function(){return Date.now()-this.start},r.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,Wb([this.id,this.getTime()+"ms"],e))},r.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,Wb([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,Wb([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.instances={},r}(),d1e=function(){function r(e,t){var n;this.windowBounds=t,this.instanceName="#"+r.instanceCount++,this.logger=new f1e({id:this.instanceName,enabled:e.logging}),this.cache=(n=e.cache)!==null&&n!==void 0?n:new Lbe(this,e)}return r.instanceCount=1,r}(),p1e=function(r,e){return e===void 0&&(e={}),g1e(r,e)};typeof window<"u"&&l6.setContext(window);var g1e=function(r,e){return Ia(void 0,void 0,void 0,function(){var t,n,i,s,a,o,u,d,p,b,C,w,M,P,k,D,j,H,N,q,ie,W,ie,se,Z,fe,te,ce,ve,me,qe,ot,st,Ye,Xe,wt,ht,he,Be,Le;return pa(this,function(He){switch(He.label){case 0:if(!r||typeof r!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(t=r.ownerDocument,!t)throw new Error("Element is not attached to a Document");if(n=t.defaultView,!n)throw new Error("Document is not attached to a Window");return i={allowTaint:(se=e.allowTaint)!==null&&se!==void 0?se:!1,imageTimeout:(Z=e.imageTimeout)!==null&&Z!==void 0?Z:15e3,proxy:e.proxy,useCORS:(fe=e.useCORS)!==null&&fe!==void 0?fe:!1},s=OC({logging:(te=e.logging)!==null&&te!==void 0?te:!0,cache:e.cache},i),a={windowWidth:(ce=e.windowWidth)!==null&&ce!==void 0?ce:n.innerWidth,windowHeight:(ve=e.windowHeight)!==null&&ve!==void 0?ve:n.innerHeight,scrollX:(me=e.scrollX)!==null&&me!==void 0?me:n.pageXOffset,scrollY:(qe=e.scrollY)!==null&&qe!==void 0?qe:n.pageYOffset},o=new Vh(a.scrollX,a.scrollY,a.windowWidth,a.windowHeight),u=new d1e(s,o),d=(ot=e.foreignObjectRendering)!==null&&ot!==void 0?ot:!1,p={allowTaint:(st=e.allowTaint)!==null&&st!==void 0?st:!1,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:d,copyStyles:d},u.logger.debug("Starting document clone with size "+o.width+"x"+o.height+" scrolled to "+-o.left+","+-o.top),b=new o6(u,r,p),C=b.clonedReferenceElement,C?[4,b.toIFrame(t,o)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return w=He.sent(),M=bT(C)||mbe(C)?Wge(C.ownerDocument):qb(u,C),P=M.width,k=M.height,D=M.left,j=M.top,H=m1e(u,C,e.backgroundColor),N={canvas:e.canvas,backgroundColor:H,scale:(Xe=(Ye=e.scale)!==null&&Ye!==void 0?Ye:n.devicePixelRatio)!==null&&Xe!==void 0?Xe:1,x:((wt=e.x)!==null&&wt!==void 0?wt:0)+D,y:((ht=e.y)!==null&&ht!==void 0?ht:0)+j,width:(he=e.width)!==null&&he!==void 0?he:Math.ceil(P),height:(Be=e.height)!==null&&Be!==void 0?Be:Math.ceil(k)},d?(u.logger.debug("Document cloned, using foreign object rendering"),ie=new h1e(u,N),[4,ie.render(C)]):[3,3];case 2:return q=He.sent(),[3,5];case 3:return u.logger.debug("Document cloned, element located at "+D+","+j+" with size "+P+"x"+k+" using computed rendering"),u.logger.debug("Starting DOM parsing"),W=jN(u,C),H===W.styles.backgroundColor&&(W.styles.backgroundColor=$h.TRANSPARENT),u.logger.debug("Starting renderer for element at "+N.x+","+N.y+" with size "+N.width+"x"+N.height),ie=new s1e(u,N),[4,ie.render(W)];case 4:q=He.sent(),He.label=5;case 5:return(!((Le=e.removeContainer)!==null&&Le!==void 0)||Le)&&(o6.destroy(w)||u.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),u.logger.debug("Finished rendering"),[2,q]}})})},m1e=function(r,e,t){var n=e.ownerDocument,i=n.documentElement?I_(r,getComputedStyle(n.documentElement).backgroundColor):$h.TRANSPARENT,s=n.body?I_(r,getComputedStyle(n.body).backgroundColor):$h.TRANSPARENT,a=typeof t=="string"?I_(r,t):t===null?$h.TRANSPARENT:4294967295;return e===n.documentElement?tf(i)?tf(s)?a:s:i:a};const _1e=Object.freeze(Object.defineProperty({__proto__:null,default:p1e},Symbol.toStringTag,{value:"Module"}));/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:_6,setPrototypeOf:y6,isFrozen:y1e,getPrototypeOf:b1e,getOwnPropertyDescriptor:v1e}=Object;let{freeze:Fa,seal:ac,create:b6}=Object,{apply:PT,construct:MT}=typeof Reflect<"u"&&Reflect;Fa||(Fa=function(r){return r}),ac||(ac=function(r){return r}),PT||(PT=function(r,e,t){return r.apply(e,t)}),MT||(MT=function(r,e){return new r(...e)});const z1=La(Array.prototype.forEach),w1e=La(Array.prototype.lastIndexOf),v6=La(Array.prototype.pop),U_=La(Array.prototype.push),x1e=La(Array.prototype.splice),Q1=La(String.prototype.toLowerCase),FT=La(String.prototype.toString),w6=La(String.prototype.match),D_=La(String.prototype.replace),B1e=La(String.prototype.indexOf),C1e=La(String.prototype.trim),nu=La(Object.prototype.hasOwnProperty),Ra=La(RegExp.prototype.test),k_=T1e(TypeError);function La(r){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return PT(r,e,n)}}function T1e(r){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return MT(r,t)}}function Hn(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Q1;y6&&y6(r,null);let n=e.length;for(;n--;){let i=e[n];if(typeof i=="string"){const s=t(i);s!==i&&(y1e(e)||(e[n]=s),i=s)}r[i]=!0}return r}function E1e(r){for(let e=0;e<r.length;e++)nu(r,e)||(r[e]=null);return r}function Wh(r){const e=b6(null);for(const[t,n]of _6(r))nu(r,t)&&(Array.isArray(n)?e[t]=E1e(n):n&&typeof n=="object"&&n.constructor===Object?e[t]=Wh(n):e[t]=n);return e}function N_(r,e){for(;r!==null;){const n=v1e(r,e);if(n){if(n.get)return La(n.get);if(typeof n.value=="function")return La(n.value)}r=b1e(r)}function t(){return null}return t}const x6=Fa(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),RT=Fa(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),LT=Fa(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),S1e=Fa(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),OT=Fa(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),I1e=Fa(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),B6=Fa(["#text"]),C6=Fa(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),UT=Fa(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),T6=Fa(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),H1=Fa(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),P1e=ac(/\{\{[\w\W]*|[\w\W]*\}\}/gm),M1e=ac(/<%[\w\W]*|[\w\W]*%>/gm),F1e=ac(/\$\{[\w\W]*/gm),R1e=ac(/^data-[\-\w.\u00B7-\uFFFF]+$/),L1e=ac(/^aria-[\-\w]+$/),E6=ac(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),O1e=ac(/^(?:\w+script|data):/i),U1e=ac(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),S6=ac(/^html$/i),D1e=ac(/^[a-z][.\w]*(-[.\w]+)+$/i);var I6=Object.freeze({__proto__:null,ARIA_ATTR:L1e,ATTR_WHITESPACE:U1e,CUSTOM_ELEMENT:D1e,DATA_ATTR:R1e,DOCTYPE_NAME:S6,ERB_EXPR:M1e,IS_ALLOWED_URI:E6,IS_SCRIPT_OR_DATA:O1e,MUSTACHE_EXPR:P1e,TMPLIT_EXPR:F1e});const z_={element:1,text:3,progressingInstruction:7,comment:8,document:9},k1e=function(){return typeof window>"u"?null:window},N1e=function(r,e){if(typeof r!="object"||typeof r.createPolicy!="function")return null;let t=null;const n="data-tt-policy-suffix";e&&e.hasAttribute(n)&&(t=e.getAttribute(n));const i="dompurify"+(t?"#"+t:"");try{return r.createPolicy(i,{createHTML(s){return s},createScriptURL(s){return s}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}},P6=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function M6(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:k1e();const e=Ke=>M6(Ke);if(e.version="3.2.6",e.removed=[],!r||!r.document||r.document.nodeType!==z_.document||!r.Element)return e.isSupported=!1,e;let{document:t}=r;const n=t,i=n.currentScript,{DocumentFragment:s,HTMLTemplateElement:a,Node:o,Element:u,NodeFilter:d,NamedNodeMap:p=r.NamedNodeMap||r.MozNamedAttrMap,HTMLFormElement:b,DOMParser:C,trustedTypes:w}=r,M=u.prototype,P=N_(M,"cloneNode"),k=N_(M,"remove"),D=N_(M,"nextSibling"),j=N_(M,"childNodes"),H=N_(M,"parentNode");if(typeof a=="function"){const Ke=t.createElement("template");Ke.content&&Ke.content.ownerDocument&&(t=Ke.content.ownerDocument)}let N,q="";const{implementation:W,createNodeIterator:ie,createDocumentFragment:se,getElementsByTagName:Z}=t,{importNode:fe}=n;let te=P6();e.isSupported=typeof _6=="function"&&typeof H=="function"&&W&&W.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:ce,ERB_EXPR:ve,TMPLIT_EXPR:me,DATA_ATTR:qe,ARIA_ATTR:ot,IS_SCRIPT_OR_DATA:st,ATTR_WHITESPACE:Ye,CUSTOM_ELEMENT:Xe}=I6;let{IS_ALLOWED_URI:wt}=I6,ht=null;const he=Hn({},[...x6,...RT,...LT,...OT,...B6]);let Be=null;const Le=Hn({},[...C6,...UT,...T6,...H1]);let He=Object.seal(b6(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),rt=null,it=null,Pt=!0,Bt=!0,Dt=!1,Yt=!0,nr=!1,ur=!0,xt=!1,Re=!1,Kr=!1,Ur=!1,Er=!1,Kt=!1,Br=!0,ar=!1;const Lr="user-content-";let vr=!0,kt=!1,ir={},hr=null;const Mr=Hn({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Cr=null;const wr=Hn({},["audio","video","img","source","image","track"]);let Ne=null;const re=Hn({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),ae="http://www.w3.org/1998/Math/MathML",ge="http://www.w3.org/2000/svg",xe="http://www.w3.org/1999/xhtml";let Me=xe,We=!1,nt=null;const Ge=Hn({},[ae,ge,xe],FT);let lt=Hn({},["mi","mo","mn","ms","mtext"]),Lt=Hn({},["annotation-xml"]);const Ft=Hn({},["title","style","font","a","script"]);let Wt=null;const Ze=["application/xhtml+xml","text/html"],Sr="text/html";let an=null,yr=null;const sn=t.createElement("form"),fn=function(Ke){return Ke instanceof RegExp||Ke instanceof Function},Ir=function(){let Ke=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(yr&&yr===Ke)){if((!Ke||typeof Ke!="object")&&(Ke={}),Ke=Wh(Ke),Wt=Ze.indexOf(Ke.PARSER_MEDIA_TYPE)===-1?Sr:Ke.PARSER_MEDIA_TYPE,an=Wt==="application/xhtml+xml"?FT:Q1,ht=nu(Ke,"ALLOWED_TAGS")?Hn({},Ke.ALLOWED_TAGS,an):he,Be=nu(Ke,"ALLOWED_ATTR")?Hn({},Ke.ALLOWED_ATTR,an):Le,nt=nu(Ke,"ALLOWED_NAMESPACES")?Hn({},Ke.ALLOWED_NAMESPACES,FT):Ge,Ne=nu(Ke,"ADD_URI_SAFE_ATTR")?Hn(Wh(re),Ke.ADD_URI_SAFE_ATTR,an):re,Cr=nu(Ke,"ADD_DATA_URI_TAGS")?Hn(Wh(wr),Ke.ADD_DATA_URI_TAGS,an):wr,hr=nu(Ke,"FORBID_CONTENTS")?Hn({},Ke.FORBID_CONTENTS,an):Mr,rt=nu(Ke,"FORBID_TAGS")?Hn({},Ke.FORBID_TAGS,an):Wh({}),it=nu(Ke,"FORBID_ATTR")?Hn({},Ke.FORBID_ATTR,an):Wh({}),ir=nu(Ke,"USE_PROFILES")?Ke.USE_PROFILES:!1,Pt=Ke.ALLOW_ARIA_ATTR!==!1,Bt=Ke.ALLOW_DATA_ATTR!==!1,Dt=Ke.ALLOW_UNKNOWN_PROTOCOLS||!1,Yt=Ke.ALLOW_SELF_CLOSE_IN_ATTR!==!1,nr=Ke.SAFE_FOR_TEMPLATES||!1,ur=Ke.SAFE_FOR_XML!==!1,xt=Ke.WHOLE_DOCUMENT||!1,Ur=Ke.RETURN_DOM||!1,Er=Ke.RETURN_DOM_FRAGMENT||!1,Kt=Ke.RETURN_TRUSTED_TYPE||!1,Kr=Ke.FORCE_BODY||!1,Br=Ke.SANITIZE_DOM!==!1,ar=Ke.SANITIZE_NAMED_PROPS||!1,vr=Ke.KEEP_CONTENT!==!1,kt=Ke.IN_PLACE||!1,wt=Ke.ALLOWED_URI_REGEXP||E6,Me=Ke.NAMESPACE||xe,lt=Ke.MATHML_TEXT_INTEGRATION_POINTS||lt,Lt=Ke.HTML_INTEGRATION_POINTS||Lt,He=Ke.CUSTOM_ELEMENT_HANDLING||{},Ke.CUSTOM_ELEMENT_HANDLING&&fn(Ke.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(He.tagNameCheck=Ke.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Ke.CUSTOM_ELEMENT_HANDLING&&fn(Ke.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(He.attributeNameCheck=Ke.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Ke.CUSTOM_ELEMENT_HANDLING&&typeof Ke.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(He.allowCustomizedBuiltInElements=Ke.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),nr&&(Bt=!1),Er&&(Ur=!0),ir&&(ht=Hn({},B6),Be=[],ir.html===!0&&(Hn(ht,x6),Hn(Be,C6)),ir.svg===!0&&(Hn(ht,RT),Hn(Be,UT),Hn(Be,H1)),ir.svgFilters===!0&&(Hn(ht,LT),Hn(Be,UT),Hn(Be,H1)),ir.mathMl===!0&&(Hn(ht,OT),Hn(Be,T6),Hn(Be,H1))),Ke.ADD_TAGS&&(ht===he&&(ht=Wh(ht)),Hn(ht,Ke.ADD_TAGS,an)),Ke.ADD_ATTR&&(Be===Le&&(Be=Wh(Be)),Hn(Be,Ke.ADD_ATTR,an)),Ke.ADD_URI_SAFE_ATTR&&Hn(Ne,Ke.ADD_URI_SAFE_ATTR,an),Ke.FORBID_CONTENTS&&(hr===Mr&&(hr=Wh(hr)),Hn(hr,Ke.FORBID_CONTENTS,an)),vr&&(ht["#text"]=!0),xt&&Hn(ht,["html","head","body"]),ht.table&&(Hn(ht,["tbody"]),delete rt.tbody),Ke.TRUSTED_TYPES_POLICY){if(typeof Ke.TRUSTED_TYPES_POLICY.createHTML!="function")throw k_('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof Ke.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw k_('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');N=Ke.TRUSTED_TYPES_POLICY,q=N.createHTML("")}else N===void 0&&(N=N1e(w,i)),N!==null&&typeof q=="string"&&(q=N.createHTML(""));Fa&&Fa(Ke),yr=Ke}},Gn=Hn({},[...RT,...LT,...S1e]),ii=Hn({},[...OT,...I1e]),On=function(Ke){let Vt=H(Ke);(!Vt||!Vt.tagName)&&(Vt={namespaceURI:Me,tagName:"template"});const Ar=Q1(Ke.tagName),xn=Q1(Vt.tagName);return nt[Ke.namespaceURI]?Ke.namespaceURI===ge?Vt.namespaceURI===xe?Ar==="svg":Vt.namespaceURI===ae?Ar==="svg"&&(xn==="annotation-xml"||lt[xn]):!!Gn[Ar]:Ke.namespaceURI===ae?Vt.namespaceURI===xe?Ar==="math":Vt.namespaceURI===ge?Ar==="math"&&Lt[xn]:!!ii[Ar]:Ke.namespaceURI===xe?Vt.namespaceURI===ge&&!Lt[xn]||Vt.namespaceURI===ae&&!lt[xn]?!1:!ii[Ar]&&(Ft[Ar]||!Gn[Ar]):!!(Wt==="application/xhtml+xml"&&nt[Ke.namespaceURI]):!1},pn=function(Ke){U_(e.removed,{element:Ke});try{H(Ke).removeChild(Ke)}catch{k(Ke)}},ln=function(Ke,Vt){try{U_(e.removed,{attribute:Vt.getAttributeNode(Ke),from:Vt})}catch{U_(e.removed,{attribute:null,from:Vt})}if(Vt.removeAttribute(Ke),Ke==="is")if(Ur||Er)try{pn(Vt)}catch{}else try{Vt.setAttribute(Ke,"")}catch{}},Ot=function(Ke){let Vt=null,Ar=null;if(Kr)Ke="<remove></remove>"+Ke;else{const Wn=w6(Ke,/^[\r\n\t ]+/);Ar=Wn&&Wn[0]}Wt==="application/xhtml+xml"&&Me===xe&&(Ke='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Ke+"</body></html>");const xn=N?N.createHTML(Ke):Ke;if(Me===xe)try{Vt=new C().parseFromString(xn,Wt)}catch{}if(!Vt||!Vt.documentElement){Vt=W.createDocument(Me,"template",null);try{Vt.documentElement.innerHTML=We?q:xn}catch{}}const Jn=Vt.body||Vt.documentElement;return Ke&&Ar&&Jn.insertBefore(t.createTextNode(Ar),Jn.childNodes[0]||null),Me===xe?Z.call(Vt,xt?"html":"body")[0]:xt?Vt.documentElement:Jn},vn=function(Ke){return ie.call(Ke.ownerDocument||Ke,Ke,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},wi=function(Ke){return Ke instanceof b&&(typeof Ke.nodeName!="string"||typeof Ke.textContent!="string"||typeof Ke.removeChild!="function"||!(Ke.attributes instanceof p)||typeof Ke.removeAttribute!="function"||typeof Ke.setAttribute!="function"||typeof Ke.namespaceURI!="string"||typeof Ke.insertBefore!="function"||typeof Ke.hasChildNodes!="function")},Qs=function(Ke){return typeof o=="function"&&Ke instanceof o};function Un(Ke,Vt,Ar){z1(Ke,xn=>{xn.call(e,Vt,Ar,yr)})}const er=function(Ke){let Vt=null;if(Un(te.beforeSanitizeElements,Ke,null),wi(Ke))return pn(Ke),!0;const Ar=an(Ke.nodeName);if(Un(te.uponSanitizeElement,Ke,{tagName:Ar,allowedTags:ht}),ur&&Ke.hasChildNodes()&&!Qs(Ke.firstElementChild)&&Ra(/<[/\w!]/g,Ke.innerHTML)&&Ra(/<[/\w!]/g,Ke.textContent)||Ke.nodeType===z_.progressingInstruction||ur&&Ke.nodeType===z_.comment&&Ra(/<[/\w]/g,Ke.data))return pn(Ke),!0;if(!ht[Ar]||rt[Ar]){if(!rt[Ar]&&Zr(Ar)&&(He.tagNameCheck instanceof RegExp&&Ra(He.tagNameCheck,Ar)||He.tagNameCheck instanceof Function&&He.tagNameCheck(Ar)))return!1;if(vr&&!hr[Ar]){const xn=H(Ke)||Ke.parentNode,Jn=j(Ke)||Ke.childNodes;if(Jn&&xn){const Wn=Jn.length;for(let Xi=Wn-1;Xi>=0;--Xi){const os=P(Jn[Xi],!0);os.__removalCount=(Ke.__removalCount||0)+1,xn.insertBefore(os,D(Ke))}}}return pn(Ke),!0}return Ke instanceof u&&!On(Ke)||(Ar==="noscript"||Ar==="noembed"||Ar==="noframes")&&Ra(/<\/no(script|embed|frames)/i,Ke.innerHTML)?(pn(Ke),!0):(nr&&Ke.nodeType===z_.text&&(Vt=Ke.textContent,z1([ce,ve,me],xn=>{Vt=D_(Vt,xn," ")}),Ke.textContent!==Vt&&(U_(e.removed,{element:Ke.cloneNode()}),Ke.textContent=Vt)),Un(te.afterSanitizeElements,Ke,null),!1)},Xr=function(Ke,Vt,Ar){if(Br&&(Vt==="id"||Vt==="name")&&(Ar in t||Ar in sn))return!1;if(!(Bt&&!it[Vt]&&Ra(qe,Vt))&&!(Pt&&Ra(ot,Vt))){if(!Be[Vt]||it[Vt]){if(!(Zr(Ke)&&(He.tagNameCheck instanceof RegExp&&Ra(He.tagNameCheck,Ke)||He.tagNameCheck instanceof Function&&He.tagNameCheck(Ke))&&(He.attributeNameCheck instanceof RegExp&&Ra(He.attributeNameCheck,Vt)||He.attributeNameCheck instanceof Function&&He.attributeNameCheck(Vt))||Vt==="is"&&He.allowCustomizedBuiltInElements&&(He.tagNameCheck instanceof RegExp&&Ra(He.tagNameCheck,Ar)||He.tagNameCheck instanceof Function&&He.tagNameCheck(Ar))))return!1}else if(!Ne[Vt]&&!Ra(wt,D_(Ar,Ye,""))&&!((Vt==="src"||Vt==="xlink:href"||Vt==="href")&&Ke!=="script"&&B1e(Ar,"data:")===0&&Cr[Ke])&&!(Dt&&!Ra(st,D_(Ar,Ye,"")))&&Ar)return!1}return!0},Zr=function(Ke){return Ke!=="annotation-xml"&&w6(Ke,Xe)},yi=function(Ke){Un(te.beforeSanitizeAttributes,Ke,null);const{attributes:Vt}=Ke;if(!Vt||wi(Ke))return;const Ar={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Be,forceKeepAttr:void 0};let xn=Vt.length;for(;xn--;){const Jn=Vt[xn],{name:Wn,namespaceURI:Xi,value:os}=Jn,Di=an(Wn),qn=os;let Nr=Wn==="value"?qn:C1e(qn);if(Ar.attrName=Di,Ar.attrValue=Nr,Ar.keepAttr=!0,Ar.forceKeepAttr=void 0,Un(te.uponSanitizeAttribute,Ke,Ar),Nr=Ar.attrValue,ar&&(Di==="id"||Di==="name")&&(ln(Wn,Ke),Nr=Lr+Nr),ur&&Ra(/((--!?|])>)|<\/(style|title)/i,Nr)){ln(Wn,Ke);continue}if(Ar.forceKeepAttr)continue;if(!Ar.keepAttr){ln(Wn,Ke);continue}if(!Yt&&Ra(/\/>/i,Nr)){ln(Wn,Ke);continue}nr&&z1([ce,ve,me],ma=>{Nr=D_(Nr,ma," ")});const cu=an(Ke.nodeName);if(!Xr(cu,Di,Nr)){ln(Wn,Ke);continue}if(N&&typeof w=="object"&&typeof w.getAttributeType=="function"&&!Xi)switch(w.getAttributeType(cu,Di)){case"TrustedHTML":{Nr=N.createHTML(Nr);break}case"TrustedScriptURL":{Nr=N.createScriptURL(Nr);break}}if(Nr!==qn)try{Xi?Ke.setAttributeNS(Xi,Wn,Nr):Ke.setAttribute(Wn,Nr),wi(Ke)?pn(Ke):v6(e.removed)}catch{ln(Wn,Ke)}}Un(te.afterSanitizeAttributes,Ke,null)},Xo=function Ke(Vt){let Ar=null;const xn=vn(Vt);for(Un(te.beforeSanitizeShadowDOM,Vt,null);Ar=xn.nextNode();)Un(te.uponSanitizeShadowNode,Ar,null),er(Ar),yi(Ar),Ar.content instanceof s&&Ke(Ar.content);Un(te.afterSanitizeShadowDOM,Vt,null)};return e.sanitize=function(Ke){let Vt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ar=null,xn=null,Jn=null,Wn=null;if(We=!Ke,We&&(Ke="<!-->"),typeof Ke!="string"&&!Qs(Ke))if(typeof Ke.toString=="function"){if(Ke=Ke.toString(),typeof Ke!="string")throw k_("dirty is not a string, aborting")}else throw k_("toString is not a function");if(!e.isSupported)return Ke;if(Re||Ir(Vt),e.removed=[],typeof Ke=="string"&&(kt=!1),kt){if(Ke.nodeName){const Di=an(Ke.nodeName);if(!ht[Di]||rt[Di])throw k_("root node is forbidden and cannot be sanitized in-place")}}else if(Ke instanceof o)Ar=Ot("<!---->"),xn=Ar.ownerDocument.importNode(Ke,!0),xn.nodeType===z_.element&&xn.nodeName==="BODY"||xn.nodeName==="HTML"?Ar=xn:Ar.appendChild(xn);else{if(!Ur&&!nr&&!xt&&Ke.indexOf("<")===-1)return N&&Kt?N.createHTML(Ke):Ke;if(Ar=Ot(Ke),!Ar)return Ur?null:Kt?q:""}Ar&&Kr&&pn(Ar.firstChild);const Xi=vn(kt?Ke:Ar);for(;Jn=Xi.nextNode();)er(Jn),yi(Jn),Jn.content instanceof s&&Xo(Jn.content);if(kt)return Ke;if(Ur){if(Er)for(Wn=se.call(Ar.ownerDocument);Ar.firstChild;)Wn.appendChild(Ar.firstChild);else Wn=Ar;return(Be.shadowroot||Be.shadowrootmode)&&(Wn=fe.call(n,Wn,!0)),Wn}let os=xt?Ar.outerHTML:Ar.innerHTML;return xt&&ht["!doctype"]&&Ar.ownerDocument&&Ar.ownerDocument.doctype&&Ar.ownerDocument.doctype.name&&Ra(S6,Ar.ownerDocument.doctype.name)&&(os="<!DOCTYPE "+Ar.ownerDocument.doctype.name+`>
`+os),nr&&z1([ce,ve,me],Di=>{os=D_(os,Di," ")}),N&&Kt?N.createHTML(os):os},e.setConfig=function(){let Ke=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ir(Ke),Re=!0},e.clearConfig=function(){yr=null,Re=!1},e.isValidAttribute=function(Ke,Vt,Ar){yr||Ir({});const xn=an(Ke),Jn=an(Vt);return Xr(xn,Jn,Ar)},e.addHook=function(Ke,Vt){typeof Vt=="function"&&U_(te[Ke],Vt)},e.removeHook=function(Ke,Vt){if(Vt!==void 0){const Ar=w1e(te[Ke],Vt);return Ar===-1?void 0:x1e(te[Ke],Ar,1)[0]}return v6(te[Ke])},e.removeHooks=function(Ke){te[Ke]=[]},e.removeAllHooks=function(){te=P6()},e}var z1e=M6();const Q1e=Object.freeze(Object.defineProperty({__proto__:null,default:z1e},Symbol.toStringTag,{value:"Module"}));var DT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function F6(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var H1e={},R6={},Q_,L6;function ss(){if(L6)return Q_;L6=1;var r=function(e){return e&&e.Math===Math&&e};return Q_=r(typeof globalThis=="object"&&globalThis)||r(typeof window=="object"&&window)||r(typeof self=="object"&&self)||r(typeof DT=="object"&&DT)||r(typeof Q_=="object"&&Q_)||function(){return this}()||Function("return this")(),Q_}var kT={},O6,U6;function Cs(){return U6||(U6=1,O6=function(r){try{return!!r()}catch{return!0}}),O6}var NT,D6;function iu(){if(D6)return NT;D6=1;var r=Cs();return NT=!r(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),NT}var zT,k6;function V1(){if(k6)return zT;k6=1;var r=Cs();return zT=!r(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),zT}var QT,N6;function Ko(){if(N6)return QT;N6=1;var r=V1(),e=Function.prototype.call;return QT=r?e.bind(e):function(){return e.apply(e,arguments)},QT}var HT={},z6;function V1e(){if(z6)return HT;z6=1;var r={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,t=e&&!r.call({1:2},1);return HT.f=t?function(n){var i=e(this,n);return!!i&&i.enumerable}:r,HT}var Q6,H6;function VT(){return H6||(H6=1,Q6=function(r,e){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:e}}),Q6}var jT,V6;function Ts(){if(V6)return jT;V6=1;var r=V1(),e=Function.prototype,t=e.call,n=r&&e.bind.bind(t,t);return jT=r?n:function(i){return function(){return t.apply(i,arguments)}},jT}var $T,j6;function Cd(){if(j6)return $T;j6=1;var r=Ts(),e=r({}.toString),t=r("".slice);return $T=function(n){return t(e(n),8,-1)},$T}var GT,$6;function G6(){if($6)return GT;$6=1;var r=Ts(),e=Cs(),t=Cd(),n=Object,i=r("".split);return GT=e(function(){return!n("z").propertyIsEnumerable(0)})?function(s){return t(s)==="String"?i(s,""):n(s)}:n,GT}var W6,q6;function j1(){return q6||(q6=1,W6=function(r){return r==null}),W6}var WT,K6;function su(){if(K6)return WT;K6=1;var r=j1(),e=TypeError;return WT=function(t){if(r(t))throw new e("Can't call method on "+t);return t},WT}var qT,X6;function H_(){if(X6)return qT;X6=1;var r=G6(),e=su();return qT=function(t){return r(e(t))},qT}var KT,Y6;function zs(){if(Y6)return KT;Y6=1;var r=typeof document=="object"&&document.all;return KT=typeof r>"u"&&r!==void 0?function(e){return typeof e=="function"||e===r}:function(e){return typeof e=="function"},KT}var XT,Z6;function sl(){if(Z6)return XT;Z6=1;var r=zs();return XT=function(e){return typeof e=="object"?e!==null:r(e)},XT}var YT,J6;function Td(){if(J6)return YT;J6=1;var r=ss(),e=zs(),t=function(n){return e(n)?n:void 0};return YT=function(n,i){return arguments.length<2?t(r[n]):r[n]&&r[n][i]},YT}var ZT,e8;function $1(){if(e8)return ZT;e8=1;var r=Ts();return ZT=r({}.isPrototypeOf),ZT}var JT,t8;function V_(){if(t8)return JT;t8=1;var r=ss(),e=r.navigator,t=e&&e.userAgent;return JT=t?String(t):"",JT}var eE,r8;function tE(){if(r8)return eE;r8=1;var r=ss(),e=V_(),t=r.process,n=r.Deno,i=t&&t.versions||n&&n.version,s=i&&i.v8,a,o;return s&&(a=s.split("."),o=a[0]>0&&a[0]<4?1:+(a[0]+a[1])),!o&&e&&(a=e.match(/Edge\/(\d+)/),(!a||a[1]>=74)&&(a=e.match(/Chrome\/(\d+)/),a&&(o=+a[1]))),eE=o,eE}var rE,n8;function i8(){if(n8)return rE;n8=1;var r=tE(),e=Cs(),t=ss(),n=t.String;return rE=!!Object.getOwnPropertySymbols&&!e(function(){var i=Symbol("symbol detection");return!n(i)||!(Object(i)instanceof Symbol)||!Symbol.sham&&r&&r<41}),rE}var nE,s8;function o8(){if(s8)return nE;s8=1;var r=i8();return nE=r&&!Symbol.sham&&typeof Symbol.iterator=="symbol",nE}var iE,a8;function l8(){if(a8)return iE;a8=1;var r=Td(),e=zs(),t=$1(),n=o8(),i=Object;return iE=n?function(s){return typeof s=="symbol"}:function(s){var a=r("Symbol");return e(a)&&t(a.prototype,i(s))},iE}var sE,c8;function G1(){if(c8)return sE;c8=1;var r=String;return sE=function(e){try{return r(e)}catch{return"Object"}},sE}var oE,u8;function qh(){if(u8)return oE;u8=1;var r=zs(),e=G1(),t=TypeError;return oE=function(n){if(r(n))return n;throw new t(e(n)+" is not a function")},oE}var aE,h8;function xg(){if(h8)return aE;h8=1;var r=qh(),e=j1();return aE=function(t,n){var i=t[n];return e(i)?void 0:r(i)},aE}var lE,A8;function j1e(){if(A8)return lE;A8=1;var r=Ko(),e=zs(),t=sl(),n=TypeError;return lE=function(i,s){var a,o;if(s==="string"&&e(a=i.toString)&&!t(o=r(a,i))||e(a=i.valueOf)&&!t(o=r(a,i))||s!=="string"&&e(a=i.toString)&&!t(o=r(a,i)))return o;throw new n("Can't convert object to primitive value")},lE}var cE={exports:{}},f8,d8;function Ju(){return d8||(d8=1,f8=!1),f8}var uE,p8;function hE(){if(p8)return uE;p8=1;var r=ss(),e=Object.defineProperty;return uE=function(t,n){try{e(r,t,{value:n,configurable:!0,writable:!0})}catch{r[t]=n}return n},uE}var g8;function AE(){if(g8)return cE.exports;g8=1;var r=Ju(),e=ss(),t=hE(),n="__core-js_shared__",i=cE.exports=e[n]||t(n,{});return(i.versions||(i.versions=[])).push({version:"3.45.1",mode:r?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.45.1/LICENSE",source:"https://github.com/zloirock/core-js"}),cE.exports}var fE,m8;function dE(){if(m8)return fE;m8=1;var r=AE();return fE=function(e,t){return r[e]||(r[e]=t||{})},fE}var pE,_8;function W1(){if(_8)return pE;_8=1;var r=su(),e=Object;return pE=function(t){return e(r(t))},pE}var gE,y8;function ou(){if(y8)return gE;y8=1;var r=Ts(),e=W1(),t=r({}.hasOwnProperty);return gE=Object.hasOwn||function(n,i){return t(e(n),i)},gE}var mE,b8;function v8(){if(b8)return mE;b8=1;var r=Ts(),e=0,t=Math.random(),n=r(1.1.toString);return mE=function(i){return"Symbol("+(i===void 0?"":i)+")_"+n(++e+t,36)},mE}var _E,w8;function Do(){if(w8)return _E;w8=1;var r=ss(),e=dE(),t=ou(),n=v8(),i=i8(),s=o8(),a=r.Symbol,o=e("wks"),u=s?a.for||a:a&&a.withoutSetter||n;return _E=function(d){return t(o,d)||(o[d]=i&&t(a,d)?a[d]:u("Symbol."+d)),o[d]},_E}var yE,x8;function $1e(){if(x8)return yE;x8=1;var r=Ko(),e=sl(),t=l8(),n=xg(),i=j1e(),s=Do(),a=TypeError,o=s("toPrimitive");return yE=function(u,d){if(!e(u)||t(u))return u;var p=n(u,o),b;if(p){if(d===void 0&&(d="default"),b=r(p,u,d),!e(b)||t(b))return b;throw new a("Can't convert object to primitive value")}return d===void 0&&(d="number"),i(u,d)},yE}var bE,B8;function C8(){if(B8)return bE;B8=1;var r=$1e(),e=l8();return bE=function(t){var n=r(t,"string");return e(n)?n:n+""},bE}var vE,T8;function q1(){if(T8)return vE;T8=1;var r=ss(),e=sl(),t=r.document,n=e(t)&&e(t.createElement);return vE=function(i){return n?t.createElement(i):{}},vE}var wE,E8;function S8(){if(E8)return wE;E8=1;var r=iu(),e=Cs(),t=q1();return wE=!r&&!e(function(){return Object.defineProperty(t("div"),"a",{get:function(){return 7}}).a!==7}),wE}var I8;function K1(){if(I8)return kT;I8=1;var r=iu(),e=Ko(),t=V1e(),n=VT(),i=H_(),s=C8(),a=ou(),o=S8(),u=Object.getOwnPropertyDescriptor;return kT.f=r?u:function(d,p){if(d=i(d),p=s(p),o)try{return u(d,p)}catch{}if(a(d,p))return n(!e(t.f,d,p),d[p])},kT}var xE={},BE,P8;function M8(){if(P8)return BE;P8=1;var r=iu(),e=Cs();return BE=r&&e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),BE}var CE,F8;function Oa(){if(F8)return CE;F8=1;var r=sl(),e=String,t=TypeError;return CE=function(n){if(r(n))return n;throw new t(e(n)+" is not an object")},CE}var R8;function of(){if(R8)return xE;R8=1;var r=iu(),e=S8(),t=M8(),n=Oa(),i=C8(),s=TypeError,a=Object.defineProperty,o=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",p="writable";return xE.f=r?t?function(b,C,w){if(n(b),C=i(C),n(w),typeof b=="function"&&C==="prototype"&&"value"in w&&p in w&&!w[p]){var M=o(b,C);M&&M[p]&&(b[C]=w.value,w={configurable:d in w?w[d]:M[d],enumerable:u in w?w[u]:M[u],writable:!1})}return a(b,C,w)}:a:function(b,C,w){if(n(b),C=i(C),n(w),e)try{return a(b,C,w)}catch{}if("get"in w||"set"in w)throw new s("Accessors not supported");return"value"in w&&(b[C]=w.value),b},xE}var TE,L8;function j_(){if(L8)return TE;L8=1;var r=iu(),e=of(),t=VT();return TE=r?function(n,i,s){return e.f(n,i,t(1,s))}:function(n,i,s){return n[i]=s,n},TE}var EE={exports:{}},SE,O8;function X1(){if(O8)return SE;O8=1;var r=iu(),e=ou(),t=Function.prototype,n=r&&Object.getOwnPropertyDescriptor,i=e(t,"name"),s=i&&(function(){}).name==="something",a=i&&(!r||r&&n(t,"name").configurable);return SE={EXISTS:i,PROPER:s,CONFIGURABLE:a},SE}var IE,U8;function PE(){if(U8)return IE;U8=1;var r=Ts(),e=zs(),t=AE(),n=r(Function.toString);return e(t.inspectSource)||(t.inspectSource=function(i){return n(i)}),IE=t.inspectSource,IE}var ME,D8;function G1e(){if(D8)return ME;D8=1;var r=ss(),e=zs(),t=r.WeakMap;return ME=e(t)&&/native code/.test(String(t)),ME}var FE,k8;function RE(){if(k8)return FE;k8=1;var r=dE(),e=v8(),t=r("keys");return FE=function(n){return t[n]||(t[n]=e(n))},FE}var N8,z8;function LE(){return z8||(z8=1,N8={}),N8}var OE,Q8;function Y1(){if(Q8)return OE;Q8=1;var r=G1e(),e=ss(),t=sl(),n=j_(),i=ou(),s=AE(),a=RE(),o=LE(),u="Object already initialized",d=e.TypeError,p=e.WeakMap,b,C,w,M=function(j){return w(j)?C(j):b(j,{})},P=function(j){return function(H){var N;if(!t(H)||(N=C(H)).type!==j)throw new d("Incompatible receiver, "+j+" required");return N}};if(r||s.state){var k=s.state||(s.state=new p);k.get=k.get,k.has=k.has,k.set=k.set,b=function(j,H){if(k.has(j))throw new d(u);return H.facade=j,k.set(j,H),H},C=function(j){return k.get(j)||{}},w=function(j){return k.has(j)}}else{var D=a("state");o[D]=!0,b=function(j,H){if(i(j,D))throw new d(u);return H.facade=j,n(j,D,H),H},C=function(j){return i(j,D)?j[D]:{}},w=function(j){return i(j,D)}}return OE={set:b,get:C,has:w,enforce:M,getterFor:P},OE}var H8;function V8(){if(H8)return EE.exports;H8=1;var r=Ts(),e=Cs(),t=zs(),n=ou(),i=iu(),s=X1().CONFIGURABLE,a=PE(),o=Y1(),u=o.enforce,d=o.get,p=String,b=Object.defineProperty,C=r("".slice),w=r("".replace),M=r([].join),P=i&&!e(function(){return b(function(){},"length",{value:8}).length!==8}),k=String(String).split("String"),D=EE.exports=function(j,H,N){C(p(H),0,7)==="Symbol("&&(H="["+w(p(H),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),N&&N.getter&&(H="get "+H),N&&N.setter&&(H="set "+H),(!n(j,"name")||s&&j.name!==H)&&(i?b(j,"name",{value:H,configurable:!0}):j.name=H),P&&N&&n(N,"arity")&&j.length!==N.arity&&b(j,"length",{value:N.arity});try{N&&n(N,"constructor")&&N.constructor?i&&b(j,"prototype",{writable:!1}):j.prototype&&(j.prototype=void 0)}catch{}var q=u(j);return n(q,"source")||(q.source=M(k,typeof H=="string"?H:"")),j};return Function.prototype.toString=D(function(){return t(this)&&d(this).source||a(this)},"toString"),EE.exports}var UE,j8;function Ed(){if(j8)return UE;j8=1;var r=zs(),e=of(),t=V8(),n=hE();return UE=function(i,s,a,o){o||(o={});var u=o.enumerable,d=o.name!==void 0?o.name:s;if(r(a)&&t(a,d,o),o.global)u?i[s]=a:n(s,a);else{try{o.unsafe?i[s]&&(u=!0):delete i[s]}catch{}u?i[s]=a:e.f(i,s,{value:a,enumerable:!1,configurable:!o.nonConfigurable,writable:!o.nonWritable})}return i},UE}var DE={},kE,$8;function W1e(){if($8)return kE;$8=1;var r=Math.ceil,e=Math.floor;return kE=Math.trunc||function(t){var n=+t;return(n>0?e:r)(n)},kE}var NE,G8;function Z1(){if(G8)return NE;G8=1;var r=W1e();return NE=function(e){var t=+e;return t!==t||t===0?0:r(t)},NE}var zE,W8;function q1e(){if(W8)return zE;W8=1;var r=Z1(),e=Math.max,t=Math.min;return zE=function(n,i){var s=r(n);return s<0?e(s+i,0):t(s,i)},zE}var QE,q8;function Bg(){if(q8)return QE;q8=1;var r=Z1(),e=Math.min;return QE=function(t){var n=r(t);return n>0?e(n,9007199254740991):0},QE}var HE,K8;function VE(){if(K8)return HE;K8=1;var r=Bg();return HE=function(e){return r(e.length)},HE}var jE,X8;function Y8(){if(X8)return jE;X8=1;var r=H_(),e=q1e(),t=VE(),n=function(i){return function(s,a,o){var u=r(s),d=t(u);if(d===0)return!i&&-1;var p=e(o,d),b;if(i&&a!==a){for(;d>p;)if(b=u[p++],b!==b)return!0}else for(;d>p;p++)if((i||p in u)&&u[p]===a)return i||p||0;return!i&&-1}};return jE={includes:n(!0),indexOf:n(!1)},jE}var $E,Z8;function J8(){if(Z8)return $E;Z8=1;var r=Ts(),e=ou(),t=H_(),n=Y8().indexOf,i=LE(),s=r([].push);return $E=function(a,o){var u=t(a),d=0,p=[],b;for(b in u)!e(i,b)&&e(u,b)&&s(p,b);for(;o.length>d;)e(u,b=o[d++])&&(~n(p,b)||s(p,b));return p},$E}var ez,tz;function GE(){return tz||(tz=1,ez=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),ez}var rz;function K1e(){if(rz)return DE;rz=1;var r=J8(),e=GE(),t=e.concat("length","prototype");return DE.f=Object.getOwnPropertyNames||function(n){return r(n,t)},DE}var nz={},iz;function X1e(){return iz||(iz=1,nz.f=Object.getOwnPropertySymbols),nz}var WE,sz;function Y1e(){if(sz)return WE;sz=1;var r=Td(),e=Ts(),t=K1e(),n=X1e(),i=Oa(),s=e([].concat);return WE=r("Reflect","ownKeys")||function(a){var o=t.f(i(a)),u=n.f;return u?s(o,u(a)):o},WE}var qE,oz;function Z1e(){if(oz)return qE;oz=1;var r=ou(),e=Y1e(),t=K1(),n=of();return qE=function(i,s,a){for(var o=e(s),u=n.f,d=t.f,p=0;p<o.length;p++){var b=o[p];!r(i,b)&&!(a&&r(a,b))&&u(i,b,d(s,b))}},qE}var KE,az;function lz(){if(az)return KE;az=1;var r=Cs(),e=zs(),t=/#|\.prototype\./,n=function(u,d){var p=s[i(u)];return p===o?!0:p===a?!1:e(d)?r(d):!!d},i=n.normalize=function(u){return String(u).replace(t,".").toLowerCase()},s=n.data={},a=n.NATIVE="N",o=n.POLYFILL="P";return KE=n,KE}var XE,cz;function Ua(){if(cz)return XE;cz=1;var r=ss(),e=K1().f,t=j_(),n=Ed(),i=hE(),s=Z1e(),a=lz();return XE=function(o,u){var d=o.target,p=o.global,b=o.stat,C,w,M,P,k,D;if(p?w=r:b?w=r[d]||i(d,{}):w=r[d]&&r[d].prototype,w)for(M in u){if(k=u[M],o.dontCallGetSet?(D=e(w,M),P=D&&D.value):P=w[M],C=a(p?M:d+(b?".":"#")+M,o.forced),!C&&P!==void 0){if(typeof k==typeof P)continue;s(k,P)}(o.sham||P&&P.sham)&&t(k,"sham",!0),n(w,M,k,o)}},XE}var YE,uz;function hz(){if(uz)return YE;uz=1;var r=ss(),e=V_(),t=Cd(),n=function(i){return e.slice(0,i.length)===i};return YE=function(){return n("Bun/")?"BUN":n("Cloudflare-Workers")?"CLOUDFLARE":n("Deno/")?"DENO":n("Node.js/")?"NODE":r.Bun&&typeof Bun.version=="string"?"BUN":r.Deno&&typeof Deno.version=="object"?"DENO":t(r.process)==="process"?"NODE":r.window&&r.document?"BROWSER":"REST"}(),YE}var ZE,Az;function J1(){if(Az)return ZE;Az=1;var r=hz();return ZE=r==="NODE",ZE}var JE,fz;function J1e(){if(fz)return JE;fz=1;var r=ss();return JE=r,JE}var eS,dz;function eve(){if(dz)return eS;dz=1;var r=Ts(),e=qh();return eS=function(t,n,i){try{return r(e(Object.getOwnPropertyDescriptor(t,n)[i]))}catch{}},eS}var tS,pz;function tve(){if(pz)return tS;pz=1;var r=sl();return tS=function(e){return r(e)||e===null},tS}var rS,gz;function rve(){if(gz)return rS;gz=1;var r=tve(),e=String,t=TypeError;return rS=function(n){if(r(n))return n;throw new t("Can't set "+e(n)+" as a prototype")},rS}var nS,mz;function _z(){if(mz)return nS;mz=1;var r=eve(),e=sl(),t=su(),n=rve();return nS=Object.setPrototypeOf||("__proto__"in{}?function(){var i=!1,s={},a;try{a=r(Object.prototype,"__proto__","set"),a(s,[]),i=s instanceof Array}catch{}return function(o,u){return t(o),n(u),e(o)&&(i?a(o,u):o.__proto__=u),o}}():void 0),nS}var iS,yz;function ev(){if(yz)return iS;yz=1;var r=of().f,e=ou(),t=Do(),n=t("toStringTag");return iS=function(i,s,a){i&&!a&&(i=i.prototype),i&&!e(i,n)&&r(i,n,{configurable:!0,value:s})},iS}var sS,bz;function nve(){if(bz)return sS;bz=1;var r=V8(),e=of();return sS=function(t,n,i){return i.get&&r(i.get,n,{getter:!0}),i.set&&r(i.set,n,{setter:!0}),e.f(t,n,i)},sS}var oS,vz;function ive(){if(vz)return oS;vz=1;var r=Td(),e=nve(),t=Do(),n=iu(),i=t("species");return oS=function(s){var a=r(s);n&&a&&!a[i]&&e(a,i,{configurable:!0,get:function(){return this}})},oS}var aS,wz;function sve(){if(wz)return aS;wz=1;var r=$1(),e=TypeError;return aS=function(t,n){if(r(n,t))return t;throw new e("Incorrect invocation")},aS}var lS,xz;function ove(){if(xz)return lS;xz=1;var r=Do(),e=r("toStringTag"),t={};return t[e]="z",lS=String(t)==="[object z]",lS}var cS,Bz;function uS(){if(Bz)return cS;Bz=1;var r=ove(),e=zs(),t=Cd(),n=Do(),i=n("toStringTag"),s=Object,a=t(function(){return arguments}())==="Arguments",o=function(u,d){try{return u[d]}catch{}};return cS=r?t:function(u){var d,p,b;return u===void 0?"Undefined":u===null?"Null":typeof(p=o(d=s(u),i))=="string"?p:a?t(d):(b=t(d))==="Object"&&e(d.callee)?"Arguments":b},cS}var hS,Cz;function ave(){if(Cz)return hS;Cz=1;var r=Ts(),e=Cs(),t=zs(),n=uS(),i=Td(),s=PE(),a=function(){},o=i("Reflect","construct"),u=/^\s*(?:class|function)\b/,d=r(u.exec),p=!u.test(a),b=function(w){if(!t(w))return!1;try{return o(a,[],w),!0}catch{return!1}},C=function(w){if(!t(w))return!1;switch(n(w)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return p||!!d(u,s(w))}catch{return!0}};return C.sham=!0,hS=!o||e(function(){var w;return b(b.call)||!b(Object)||!b(function(){w=!0})||w})?C:b,hS}var AS,Tz;function lve(){if(Tz)return AS;Tz=1;var r=ave(),e=G1(),t=TypeError;return AS=function(n){if(r(n))return n;throw new t(e(n)+" is not a constructor")},AS}var fS,Ez;function Sz(){if(Ez)return fS;Ez=1;var r=Oa(),e=lve(),t=j1(),n=Do(),i=n("species");return fS=function(s,a){var o=r(s).constructor,u;return o===void 0||t(u=r(o)[i])?a:e(u)},fS}var dS,Iz;function Pz(){if(Iz)return dS;Iz=1;var r=V1(),e=Function.prototype,t=e.apply,n=e.call;return dS=typeof Reflect=="object"&&Reflect.apply||(r?n.bind(t):function(){return n.apply(t,arguments)}),dS}var pS,Mz;function tv(){if(Mz)return pS;Mz=1;var r=Cd(),e=Ts();return pS=function(t){if(r(t)==="Function")return e(t)},pS}var gS,Fz;function mS(){if(Fz)return gS;Fz=1;var r=tv(),e=qh(),t=V1(),n=r(r.bind);return gS=function(i,s){return e(i),s===void 0?i:t?n(i,s):function(){return i.apply(s,arguments)}},gS}var _S,Rz;function Lz(){if(Rz)return _S;Rz=1;var r=Td();return _S=r("document","documentElement"),_S}var yS,Oz;function cve(){if(Oz)return yS;Oz=1;var r=Ts();return yS=r([].slice),yS}var bS,Uz;function uve(){if(Uz)return bS;Uz=1;var r=TypeError;return bS=function(e,t){if(e<t)throw new r("Not enough arguments");return e},bS}var vS,Dz;function kz(){if(Dz)return vS;Dz=1;var r=V_();return vS=/(?:ipad|iphone|ipod).*applewebkit/i.test(r),vS}var wS,Nz;function zz(){if(Nz)return wS;Nz=1;var r=ss(),e=Pz(),t=mS(),n=zs(),i=ou(),s=Cs(),a=Lz(),o=cve(),u=q1(),d=uve(),p=kz(),b=J1(),C=r.setImmediate,w=r.clearImmediate,M=r.process,P=r.Dispatch,k=r.Function,D=r.MessageChannel,j=r.String,H=0,N={},q="onreadystatechange",W,ie,se,Z;s(function(){W=r.location});var fe=function(me){if(i(N,me)){var qe=N[me];delete N[me],qe()}},te=function(me){return function(){fe(me)}},ce=function(me){fe(me.data)},ve=function(me){r.postMessage(j(me),W.protocol+"//"+W.host)};return(!C||!w)&&(C=function(me){d(arguments.length,1);var qe=n(me)?me:k(me),ot=o(arguments,1);return N[++H]=function(){e(qe,void 0,ot)},ie(H),H},w=function(me){delete N[me]},b?ie=function(me){M.nextTick(te(me))}:P&&P.now?ie=function(me){P.now(te(me))}:D&&!p?(se=new D,Z=se.port2,se.port1.onmessage=ce,ie=t(Z.postMessage,Z)):r.addEventListener&&n(r.postMessage)&&!r.importScripts&&W&&W.protocol!=="file:"&&!s(ve)?(ie=ve,r.addEventListener("message",ce,!1)):q in u("script")?ie=function(me){a.appendChild(u("script"))[q]=function(){a.removeChild(this),fe(me)}}:ie=function(me){setTimeout(te(me),0)}),wS={set:C,clear:w},wS}var xS,Qz;function hve(){if(Qz)return xS;Qz=1;var r=ss(),e=iu(),t=Object.getOwnPropertyDescriptor;return xS=function(n){if(!e)return r[n];var i=t(r,n);return i&&i.value},xS}var BS,Hz;function Vz(){if(Hz)return BS;Hz=1;var r=function(){this.head=null,this.tail=null};return r.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e){var t=this.head=e.next;return t===null&&(this.tail=null),e.item}}},BS=r,BS}var CS,jz;function Ave(){if(jz)return CS;jz=1;var r=V_();return CS=/ipad|iphone|ipod/i.test(r)&&typeof Pebble<"u",CS}var TS,$z;function fve(){if($z)return TS;$z=1;var r=V_();return TS=/web0s(?!.*chrome)/i.test(r),TS}var ES,Gz;function dve(){if(Gz)return ES;Gz=1;var r=ss(),e=hve(),t=mS(),n=zz().set,i=Vz(),s=kz(),a=Ave(),o=fve(),u=J1(),d=r.MutationObserver||r.WebKitMutationObserver,p=r.document,b=r.process,C=r.Promise,w=e("queueMicrotask"),M,P,k,D,j;if(!w){var H=new i,N=function(){var q,W;for(u&&(q=b.domain)&&q.exit();W=H.get();)try{W()}catch(ie){throw H.head&&M(),ie}q&&q.enter()};!s&&!u&&!o&&d&&p?(P=!0,k=p.createTextNode(""),new d(N).observe(k,{characterData:!0}),M=function(){k.data=P=!P}):!a&&C&&C.resolve?(D=C.resolve(void 0),D.constructor=C,j=t(D.then,D),M=function(){j(N)}):u?M=function(){b.nextTick(N)}:(n=t(n,r),M=function(){n(N)}),w=function(q){H.head||M(),H.add(q)}}return ES=w,ES}var Wz,qz;function pve(){return qz||(qz=1,Wz=function(r,e){try{arguments.length===1?console.error(r):console.error(r,e)}catch{}}),Wz}var Kz,Xz;function SS(){return Xz||(Xz=1,Kz=function(r){try{return{error:!1,value:r()}}catch(e){return{error:!0,value:e}}}),Kz}var IS,Yz;function $_(){if(Yz)return IS;Yz=1;var r=ss();return IS=r.Promise,IS}var PS,Zz;function G_(){if(Zz)return PS;Zz=1;var r=ss(),e=$_(),t=zs(),n=lz(),i=PE(),s=Do(),a=hz(),o=Ju(),u=tE(),d=e&&e.prototype,p=s("species"),b=!1,C=t(r.PromiseRejectionEvent),w=n("Promise",function(){var M=i(e),P=M!==String(e);if(!P&&u===66||o&&!(d.catch&&d.finally))return!0;if(!u||u<51||!/native code/.test(M)){var k=new e(function(H){H(1)}),D=function(H){H(function(){},function(){})},j=k.constructor={};if(j[p]=D,b=k.then(function(){})instanceof D,!b)return!0}return!P&&(a==="BROWSER"||a==="DENO")&&!C});return PS={CONSTRUCTOR:w,REJECTION_EVENT:C,SUBCLASSING:b},PS}var MS={},Jz;function W_(){if(Jz)return MS;Jz=1;var r=qh(),e=TypeError,t=function(n){var i,s;this.promise=new n(function(a,o){if(i!==void 0||s!==void 0)throw new e("Bad Promise constructor");i=a,s=o}),this.resolve=r(i),this.reject=r(s)};return MS.f=function(n){return new t(n)},MS}var eQ;function gve(){if(eQ)return R6;eQ=1;var r=Ua(),e=Ju(),t=J1(),n=ss(),i=J1e(),s=Ko(),a=Ed(),o=_z(),u=ev(),d=ive(),p=qh(),b=zs(),C=sl(),w=sve(),M=Sz(),P=zz().set,k=dve(),D=pve(),j=SS(),H=Vz(),N=Y1(),q=$_(),W=G_(),ie=W_(),se="Promise",Z=W.CONSTRUCTOR,fe=W.REJECTION_EVENT,te=W.SUBCLASSING,ce=N.getterFor(se),ve=N.set,me=q&&q.prototype,qe=q,ot=me,st=n.TypeError,Ye=n.document,Xe=n.process,wt=ie.f,ht=wt,he=!!(Ye&&Ye.createEvent&&n.dispatchEvent),Be="unhandledrejection",Le="rejectionhandled",He=0,rt=1,it=2,Pt=1,Bt=2,Dt,Yt,nr,ur,xt=function(kt){var ir;return C(kt)&&b(ir=kt.then)?ir:!1},Re=function(kt,ir){var hr=ir.value,Mr=ir.state===rt,Cr=Mr?kt.ok:kt.fail,wr=kt.resolve,Ne=kt.reject,re=kt.domain,ae,ge,xe;try{Cr?(Mr||(ir.rejection===Bt&&Br(ir),ir.rejection=Pt),Cr===!0?ae=hr:(re&&re.enter(),ae=Cr(hr),re&&(re.exit(),xe=!0)),ae===kt.promise?Ne(new st("Promise-chain cycle")):(ge=xt(ae))?s(ge,ae,wr,Ne):wr(ae)):Ne(hr)}catch(Me){re&&!xe&&re.exit(),Ne(Me)}},Kr=function(kt,ir){kt.notified||(kt.notified=!0,k(function(){for(var hr=kt.reactions,Mr;Mr=hr.get();)Re(Mr,kt);kt.notified=!1,ir&&!kt.rejection&&Er(kt)}))},Ur=function(kt,ir,hr){var Mr,Cr;he?(Mr=Ye.createEvent("Event"),Mr.promise=ir,Mr.reason=hr,Mr.initEvent(kt,!1,!0),n.dispatchEvent(Mr)):Mr={promise:ir,reason:hr},!fe&&(Cr=n["on"+kt])?Cr(Mr):kt===Be&&D("Unhandled promise rejection",hr)},Er=function(kt){s(P,n,function(){var ir=kt.facade,hr=kt.value,Mr=Kt(kt),Cr;if(Mr&&(Cr=j(function(){t?Xe.emit("unhandledRejection",hr,ir):Ur(Be,ir,hr)}),kt.rejection=t||Kt(kt)?Bt:Pt,Cr.error))throw Cr.value})},Kt=function(kt){return kt.rejection!==Pt&&!kt.parent},Br=function(kt){s(P,n,function(){var ir=kt.facade;t?Xe.emit("rejectionHandled",ir):Ur(Le,ir,kt.value)})},ar=function(kt,ir,hr){return function(Mr){kt(ir,Mr,hr)}},Lr=function(kt,ir,hr){kt.done||(kt.done=!0,hr&&(kt=hr),kt.value=ir,kt.state=it,Kr(kt,!0))},vr=function(kt,ir,hr){if(!kt.done){kt.done=!0,hr&&(kt=hr);try{if(kt.facade===ir)throw new st("Promise can't be resolved itself");var Mr=xt(ir);Mr?k(function(){var Cr={done:!1};try{s(Mr,ir,ar(vr,Cr,kt),ar(Lr,Cr,kt))}catch(wr){Lr(Cr,wr,kt)}}):(kt.value=ir,kt.state=rt,Kr(kt,!1))}catch(Cr){Lr({done:!1},Cr,kt)}}};if(Z&&(qe=function(kt){w(this,ot),p(kt),s(Dt,this);var ir=ce(this);try{kt(ar(vr,ir),ar(Lr,ir))}catch(hr){Lr(ir,hr)}},ot=qe.prototype,Dt=function(kt){ve(this,{type:se,done:!1,notified:!1,parent:!1,reactions:new H,rejection:!1,state:He,value:null})},Dt.prototype=a(ot,"then",function(kt,ir){var hr=ce(this),Mr=wt(M(this,qe));return hr.parent=!0,Mr.ok=b(kt)?kt:!0,Mr.fail=b(ir)&&ir,Mr.domain=t?Xe.domain:void 0,hr.state===He?hr.reactions.add(Mr):k(function(){Re(Mr,hr)}),Mr.promise}),Yt=function(){var kt=new Dt,ir=ce(kt);this.promise=kt,this.resolve=ar(vr,ir),this.reject=ar(Lr,ir)},ie.f=wt=function(kt){return kt===qe||kt===nr?new Yt(kt):ht(kt)},!e&&b(q)&&me!==Object.prototype)){ur=me.then,te||a(me,"then",function(kt,ir){var hr=this;return new qe(function(Mr,Cr){s(ur,hr,Mr,Cr)}).then(kt,ir)},{unsafe:!0});try{delete me.constructor}catch{}o&&o(me,ot)}return r({global:!0,constructor:!0,wrap:!0,forced:Z},{Promise:qe}),nr=i.Promise,u(qe,se,!1,!0),d(se),R6}var tQ={},rQ,nQ;function q_(){return nQ||(nQ=1,rQ={}),rQ}var FS,iQ;function mve(){if(iQ)return FS;iQ=1;var r=Do(),e=q_(),t=r("iterator"),n=Array.prototype;return FS=function(i){return i!==void 0&&(e.Array===i||n[t]===i)},FS}var RS,sQ;function oQ(){if(sQ)return RS;sQ=1;var r=uS(),e=xg(),t=j1(),n=q_(),i=Do(),s=i("iterator");return RS=function(a){if(!t(a))return e(a,s)||e(a,"@@iterator")||n[r(a)]},RS}var LS,aQ;function _ve(){if(aQ)return LS;aQ=1;var r=Ko(),e=qh(),t=Oa(),n=G1(),i=oQ(),s=TypeError;return LS=function(a,o){var u=arguments.length<2?i(a):o;if(e(u))return t(r(u,a));throw new s(n(a)+" is not iterable")},LS}var OS,lQ;function yve(){if(lQ)return OS;lQ=1;var r=Ko(),e=Oa(),t=xg();return OS=function(n,i,s){var a,o;e(n);try{if(a=t(n,"return"),!a){if(i==="throw")throw s;return s}a=r(a,n)}catch(u){o=!0,a=u}if(i==="throw")throw s;if(o)throw a;return e(a),s},OS}var US,cQ;function uQ(){if(cQ)return US;cQ=1;var r=mS(),e=Ko(),t=Oa(),n=G1(),i=mve(),s=VE(),a=$1(),o=_ve(),u=oQ(),d=yve(),p=TypeError,b=function(w,M){this.stopped=w,this.result=M},C=b.prototype;return US=function(w,M,P){var k=P&&P.that,D=!!(P&&P.AS_ENTRIES),j=!!(P&&P.IS_RECORD),H=!!(P&&P.IS_ITERATOR),N=!!(P&&P.INTERRUPTED),q=r(M,k),W,ie,se,Z,fe,te,ce,ve=function(qe){return W&&d(W,"normal"),new b(!0,qe)},me=function(qe){return D?(t(qe),N?q(qe[0],qe[1],ve):q(qe[0],qe[1])):N?q(qe,ve):q(qe)};if(j)W=w.iterator;else if(H)W=w;else{if(ie=u(w),!ie)throw new p(n(w)+" is not iterable");if(i(ie)){for(se=0,Z=s(w);Z>se;se++)if(fe=me(w[se]),fe&&a(C,fe))return fe;return new b(!1)}W=o(w,ie)}for(te=j?w.next:W.next;!(ce=e(te,W)).done;){try{fe=me(ce.value)}catch(qe){d(W,"throw",qe)}if(typeof fe=="object"&&fe&&a(C,fe))return fe}return new b(!1)},US}var DS,hQ;function bve(){if(hQ)return DS;hQ=1;var r=Do(),e=r("iterator"),t=!1;try{var n=0,i={next:function(){return{done:!!n++}},return:function(){t=!0}};i[e]=function(){return this},Array.from(i,function(){throw 2})}catch{}return DS=function(s,a){try{if(!a&&!t)return!1}catch{return!1}var o=!1;try{var u={};u[e]=function(){return{next:function(){return{done:o=!0}}}},s(u)}catch{}return o},DS}var kS,AQ;function fQ(){if(AQ)return kS;AQ=1;var r=$_(),e=bve(),t=G_().CONSTRUCTOR;return kS=t||!e(function(n){r.all(n).then(void 0,function(){})}),kS}var dQ;function vve(){if(dQ)return tQ;dQ=1;var r=Ua(),e=Ko(),t=qh(),n=W_(),i=SS(),s=uQ(),a=fQ();return r({target:"Promise",stat:!0,forced:a},{all:function(o){var u=this,d=n.f(u),p=d.resolve,b=d.reject,C=i(function(){var w=t(u.resolve),M=[],P=0,k=1;s(o,function(D){var j=P++,H=!1;k++,e(w,u,D).then(function(N){H||(H=!0,M[j]=N,--k||p(M))},b)}),--k||p(M)});return C.error&&b(C.value),d.promise}}),tQ}var pQ={},gQ;function wve(){if(gQ)return pQ;gQ=1;var r=Ua(),e=Ju(),t=G_().CONSTRUCTOR,n=$_(),i=Td(),s=zs(),a=Ed(),o=n&&n.prototype;if(r({target:"Promise",proto:!0,forced:t,real:!0},{catch:function(d){return this.then(void 0,d)}}),!e&&s(n)){var u=i("Promise").prototype.catch;o.catch!==u&&a(o,"catch",u,{unsafe:!0})}return pQ}var mQ={},_Q;function xve(){if(_Q)return mQ;_Q=1;var r=Ua(),e=Ko(),t=qh(),n=W_(),i=SS(),s=uQ(),a=fQ();return r({target:"Promise",stat:!0,forced:a},{race:function(o){var u=this,d=n.f(u),p=d.reject,b=i(function(){var C=t(u.resolve);s(o,function(w){e(C,u,w).then(d.resolve,p)})});return b.error&&p(b.value),d.promise}}),mQ}var yQ={},bQ;function Bve(){if(bQ)return yQ;bQ=1;var r=Ua(),e=W_(),t=G_().CONSTRUCTOR;return r({target:"Promise",stat:!0,forced:t},{reject:function(n){var i=e.f(this),s=i.reject;return s(n),i.promise}}),yQ}var vQ={},NS,wQ;function Cve(){if(wQ)return NS;wQ=1;var r=Oa(),e=sl(),t=W_();return NS=function(n,i){if(r(n),e(i)&&i.constructor===n)return i;var s=t.f(n),a=s.resolve;return a(i),s.promise},NS}var xQ;function Tve(){if(xQ)return vQ;xQ=1;var r=Ua(),e=Td(),t=Ju(),n=$_(),i=G_().CONSTRUCTOR,s=Cve(),a=e("Promise"),o=t&&!i;return r({target:"Promise",stat:!0,forced:t||i},{resolve:function(u){return s(o&&this===a?n:this,u)}}),vQ}var BQ;function Eve(){return BQ||(BQ=1,gve(),vve(),wve(),xve(),Bve(),Tve()),H1e}Eve();function CQ(r,e,t,n,i,s,a){try{var o=r[s](a),u=o.value}catch(d){return void t(d)}o.done?e(u):Promise.resolve(u).then(n,i)}function Kh(r){return function(){var e=this,t=arguments;return new Promise(function(n,i){var s=r.apply(e,t);function a(u){CQ(s,n,i,a,o,"next",u)}function o(u){CQ(s,n,i,a,o,"throw",u)}a(void 0)})}}var TQ={},EQ={},zS,SQ;function eh(){if(SQ)return zS;SQ=1;var r=uS(),e=String;return zS=function(t){if(r(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return e(t)},zS}var QS,IQ;function PQ(){if(IQ)return QS;IQ=1;var r=Oa();return QS=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},QS}var HS,MQ;function FQ(){if(MQ)return HS;MQ=1;var r=Cs(),e=ss(),t=e.RegExp,n=r(function(){var a=t("a","y");return a.lastIndex=2,a.exec("abcd")!==null}),i=n||r(function(){return!t("a","y").sticky}),s=n||r(function(){var a=t("^r","gy");return a.lastIndex=2,a.exec("str")!==null});return HS={BROKEN_CARET:s,MISSED_STICKY:i,UNSUPPORTED_Y:n},HS}var VS={},jS,RQ;function Sve(){if(RQ)return jS;RQ=1;var r=J8(),e=GE();return jS=Object.keys||function(t){return r(t,e)},jS}var LQ;function Ive(){if(LQ)return VS;LQ=1;var r=iu(),e=M8(),t=of(),n=Oa(),i=H_(),s=Sve();return VS.f=r&&!e?Object.defineProperties:function(a,o){n(a);for(var u=i(o),d=s(o),p=d.length,b=0,C;p>b;)t.f(a,C=d[b++],u[C]);return a},VS}var $S,OQ;function rv(){if(OQ)return $S;OQ=1;var r=Oa(),e=Ive(),t=GE(),n=LE(),i=Lz(),s=q1(),a=RE(),o=">",u="<",d="prototype",p="script",b=a("IE_PROTO"),C=function(){},w=function(j){return u+p+o+j+u+"/"+p+o},M=function(j){j.write(w("")),j.close();var H=j.parentWindow.Object;return j=null,H},P=function(){var j=s("iframe"),H="java"+p+":",N;return j.style.display="none",i.appendChild(j),j.src=String(H),N=j.contentWindow.document,N.open(),N.write(w("document.F=Object")),N.close(),N.F},k,D=function(){try{k=new ActiveXObject("htmlfile")}catch{}D=typeof document<"u"?document.domain&&k?M(k):P():M(k);for(var j=t.length;j--;)delete D[d][t[j]];return D()};return n[b]=!0,$S=Object.create||function(j,H){var N;return j!==null?(C[d]=r(j),N=new C,C[d]=null,N[b]=j):N=D(),H===void 0?N:e.f(N,H)},$S}var GS,UQ;function Pve(){if(UQ)return GS;UQ=1;var r=Cs(),e=ss(),t=e.RegExp;return GS=r(function(){var n=t(".","s");return!(n.dotAll&&n.test(`
`)&&n.flags==="s")}),GS}var WS,DQ;function Mve(){if(DQ)return WS;DQ=1;var r=Cs(),e=ss(),t=e.RegExp;return WS=r(function(){var n=t("(?<a>b)","g");return n.exec("b").groups.a!=="b"||"b".replace(n,"$<a>c")!=="bc"}),WS}var qS,kQ;function KS(){if(kQ)return qS;kQ=1;var r=Ko(),e=Ts(),t=eh(),n=PQ(),i=FQ(),s=dE(),a=rv(),o=Y1().get,u=Pve(),d=Mve(),p=s("native-string-replace",String.prototype.replace),b=RegExp.prototype.exec,C=b,w=e("".charAt),M=e("".indexOf),P=e("".replace),k=e("".slice),D=function(){var q=/a/,W=/b*/g;return r(b,q,"a"),r(b,W,"a"),q.lastIndex!==0||W.lastIndex!==0}(),j=i.BROKEN_CARET,H=/()??/.exec("")[1]!==void 0,N=D||H||j||u||d;return N&&(C=function(q){var W=this,ie=o(W),se=t(q),Z=ie.raw,fe,te,ce,ve,me,qe,ot;if(Z)return Z.lastIndex=W.lastIndex,fe=r(C,Z,se),W.lastIndex=Z.lastIndex,fe;var st=ie.groups,Ye=j&&W.sticky,Xe=r(n,W),wt=W.source,ht=0,he=se;if(Ye&&(Xe=P(Xe,"y",""),M(Xe,"g")===-1&&(Xe+="g"),he=k(se,W.lastIndex),W.lastIndex>0&&(!W.multiline||W.multiline&&w(se,W.lastIndex-1)!==`
`)&&(wt="(?: "+wt+")",he=" "+he,ht++),te=new RegExp("^(?:"+wt+")",Xe)),H&&(te=new RegExp("^"+wt+"$(?!\\s)",Xe)),D&&(ce=W.lastIndex),ve=r(b,Ye?te:W,he),Ye?ve?(ve.input=k(ve.input,ht),ve[0]=k(ve[0],ht),ve.index=W.lastIndex,W.lastIndex+=ve[0].length):W.lastIndex=0:D&&ve&&(W.lastIndex=W.global?ve.index+ve[0].length:ce),H&&ve&&ve.length>1&&r(p,ve[0],te,function(){for(me=1;me<arguments.length-2;me++)arguments[me]===void 0&&(ve[me]=void 0)}),ve&&st)for(ve.groups=qe=a(null),me=0;me<st.length;me++)ot=st[me],qe[ot[0]]=ve[ot[1]];return ve}),qS=C,qS}var NQ;function Fve(){if(NQ)return EQ;NQ=1;var r=Ua(),e=KS();return r({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),EQ}var XS,zQ;function YS(){if(zQ)return XS;zQ=1,Fve();var r=Ko(),e=Ed(),t=KS(),n=Cs(),i=Do(),s=j_(),a=i("species"),o=RegExp.prototype;return XS=function(u,d,p,b){var C=i(u),w=!n(function(){var D={};return D[C]=function(){return 7},""[u](D)!==7}),M=w&&!n(function(){var D=!1,j=/a/;return u==="split"&&(j={},j.constructor={},j.constructor[a]=function(){return j},j.flags="",j[C]=/./[C]),j.exec=function(){return D=!0,null},j[C](""),!D});if(!w||!M||p){var P=/./[C],k=d(C,""[u],function(D,j,H,N,q){var W=j.exec;return W===t||W===o.exec?w&&!q?{done:!0,value:r(P,j,H,N)}:{done:!0,value:r(D,H,j,N)}:{done:!1}});e(String.prototype,u,k[0]),e(o,C,k[1])}b&&s(o[C],"sham",!0)},XS}var ZS,QQ;function Rve(){if(QQ)return ZS;QQ=1;var r=Ts(),e=Z1(),t=eh(),n=su(),i=r("".charAt),s=r("".charCodeAt),a=r("".slice),o=function(u){return function(d,p){var b=t(n(d)),C=e(p),w=b.length,M,P;return C<0||C>=w?u?"":void 0:(M=s(b,C),M<55296||M>56319||C+1===w||(P=s(b,C+1))<56320||P>57343?u?i(b,C):M:u?a(b,C,C+2):(M-55296<<10)+(P-56320)+65536)}};return ZS={codeAt:o(!1),charAt:o(!0)},ZS}var JS,HQ;function e3(){if(HQ)return JS;HQ=1;var r=Rve().charAt;return JS=function(e,t,n){return t+(n?r(e,t).length:1)},JS}var t3,VQ;function Lve(){if(VQ)return t3;VQ=1;var r=ss(),e=Cs(),t=r.RegExp,n=!e(function(){var i=!0;try{t(".","d")}catch{i=!1}var s={},a="",o=i?"dgimsy":"gimsy",u=function(C,w){Object.defineProperty(s,C,{get:function(){return a+=w,!0}})},d={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};i&&(d.hasIndices="d");for(var p in d)u(p,d[p]);var b=Object.getOwnPropertyDescriptor(t.prototype,"flags").get.call(s);return b!==o||a!==o});return t3={correct:n},t3}var r3,jQ;function n3(){if(jQ)return r3;jQ=1;var r=Ko(),e=ou(),t=$1(),n=Lve(),i=PQ(),s=RegExp.prototype;return r3=n.correct?function(a){return a.flags}:function(a){return!n.correct&&t(s,a)&&!e(a,"flags")?r(i,a):a.flags},r3}var i3,$Q;function s3(){if($Q)return i3;$Q=1;var r=Ko(),e=Oa(),t=zs(),n=Cd(),i=KS(),s=TypeError;return i3=function(a,o){var u=a.exec;if(t(u)){var d=r(u,a,o);return d!==null&&e(d),d}if(n(a)==="RegExp")return r(i,a,o);throw new s("RegExp#exec called on incompatible receiver")},i3}var GQ;function Ove(){if(GQ)return TQ;GQ=1;var r=Ko(),e=Ts(),t=YS(),n=Oa(),i=sl(),s=Bg(),a=eh(),o=su(),u=xg(),d=e3(),p=n3(),b=s3(),C=e("".indexOf);return t("match",function(w,M,P){return[function(k){var D=o(this),j=i(k)?u(k,w):void 0;return j?r(j,k,D):new RegExp(k)[w](a(D))},function(k){var D=n(this),j=a(k),H=P(M,D,j);if(H.done)return H.value;var N=a(p(D));if(C(N,"g")===-1)return b(D,j);var q=C(N,"u")!==-1;D.lastIndex=0;for(var W=[],ie=0,se;(se=b(D,j))!==null;){var Z=a(se[0]);W[ie]=Z,Z===""&&(D.lastIndex=d(j,s(D.lastIndex),q)),ie++}return ie===0?null:W}]}),TQ}Ove();var WQ={},o3,qQ;function Uve(){if(qQ)return o3;qQ=1;var r=Ts(),e=W1(),t=Math.floor,n=r("".charAt),i=r("".replace),s=r("".slice),a=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,o=/\$([$&'`]|\d{1,2})/g;return o3=function(u,d,p,b,C,w){var M=p+u.length,P=b.length,k=o;return C!==void 0&&(C=e(C),k=a),i(w,k,function(D,j){var H;switch(n(j,0)){case"$":return"$";case"&":return u;case"`":return s(d,0,p);case"'":return s(d,M);case"<":H=C[s(j,1,-1)];break;default:var N=+j;if(N===0)return D;if(N>P){var q=t(N/10);return q===0?D:q<=P?b[q-1]===void 0?n(j,1):b[q-1]+n(j,1):D}H=b[N-1]}return H===void 0?"":H})},o3}var KQ;function Dve(){if(KQ)return WQ;KQ=1;var r=Pz(),e=Ko(),t=Ts(),n=YS(),i=Cs(),s=Oa(),a=zs(),o=sl(),u=Z1(),d=Bg(),p=eh(),b=su(),C=e3(),w=xg(),M=Uve(),P=n3(),k=s3(),D=Do(),j=D("replace"),H=Math.max,N=Math.min,q=t([].concat),W=t([].push),ie=t("".indexOf),se=t("".slice),Z=function(ve){return ve===void 0?ve:String(ve)},fe=function(){return"a".replace(/./,"$0")==="$0"}(),te=function(){return/./[j]?/./[j]("a","$0")==="":!1}(),ce=!i(function(){var ve=/./;return ve.exec=function(){var me=[];return me.groups={a:"7"},me},"".replace(ve,"$<a>")!=="7"});return n("replace",function(ve,me,qe){var ot=te?"$":"$0";return[function(st,Ye){var Xe=b(this),wt=o(st)?w(st,j):void 0;return wt?e(wt,st,Xe,Ye):e(me,p(Xe),st,Ye)},function(st,Ye){var Xe=s(this),wt=p(st);if(typeof Ye=="string"&&ie(Ye,ot)===-1&&ie(Ye,"$<")===-1){var ht=qe(me,Xe,wt,Ye);if(ht.done)return ht.value}var he=a(Ye);he||(Ye=p(Ye));var Be=p(P(Xe)),Le=ie(Be,"g")!==-1,He;Le&&(He=ie(Be,"u")!==-1,Xe.lastIndex=0);for(var rt=[],it;it=k(Xe,wt),!(it===null||(W(rt,it),!Le));){var Pt=p(it[0]);Pt===""&&(Xe.lastIndex=C(wt,d(Xe.lastIndex),He))}for(var Bt="",Dt=0,Yt=0;Yt<rt.length;Yt++){it=rt[Yt];for(var nr=p(it[0]),ur=H(N(u(it.index),wt.length),0),xt=[],Re,Kr=1;Kr<it.length;Kr++)W(xt,Z(it[Kr]));var Ur=it.groups;if(he){var Er=q([nr],xt,ur,wt);Ur!==void 0&&W(Er,Ur),Re=p(r(Ye,void 0,Er))}else Re=M(nr,wt,ur,xt,Ur,Ye);ur>=Dt&&(Bt+=se(wt,Dt,ur)+Re,Dt=ur+nr.length)}return Bt+se(wt,Dt)}]},!ce||!fe||te),WQ}Dve();var XQ={},a3,YQ;function kve(){if(YQ)return a3;YQ=1;var r=sl(),e=Cd(),t=Do(),n=t("match");return a3=function(i){var s;return r(i)&&((s=i[n])!==void 0?!!s:e(i)==="RegExp")},a3}var l3,ZQ;function c3(){if(ZQ)return l3;ZQ=1;var r=kve(),e=TypeError;return l3=function(t){if(r(t))throw new e("The method doesn't accept regular expressions");return t},l3}var u3,JQ;function h3(){if(JQ)return u3;JQ=1;var r=Do(),e=r("match");return u3=function(t){var n=/./;try{"/./"[t](n)}catch{try{return n[e]=!1,"/./"[t](n)}catch{}}return!1},u3}var eH;function Nve(){if(eH)return XQ;eH=1;var r=Ua(),e=tv(),t=K1().f,n=Bg(),i=eh(),s=c3(),a=su(),o=h3(),u=Ju(),d=e("".slice),p=Math.min,b=o("startsWith"),C=!u&&!b&&!!function(){var w=t(String.prototype,"startsWith");return w&&!w.writable}();return r({target:"String",proto:!0,forced:!C&&!b},{startsWith:function(w){var M=i(a(this));s(w);var P=n(p(arguments.length>1?arguments[1]:void 0,M.length)),k=i(w);return d(M,P,P+k.length)===k}}),XQ}Nve();var A3,tH;function zve(){if(tH)return A3;tH=1;var r=Do(),e=rv(),t=of().f,n=r("unscopables"),i=Array.prototype;return i[n]===void 0&&t(i,n,{configurable:!0,value:e(null)}),A3=function(s){i[n][s]=!0},A3}var f3,rH;function Qve(){if(rH)return f3;rH=1;var r=Cs();return f3=!r(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),f3}var d3,nH;function iH(){if(nH)return d3;nH=1;var r=ou(),e=zs(),t=W1(),n=RE(),i=Qve(),s=n("IE_PROTO"),a=Object,o=a.prototype;return d3=i?a.getPrototypeOf:function(u){var d=t(u);if(r(d,s))return d[s];var p=d.constructor;return e(p)&&d instanceof p?p.prototype:d instanceof a?o:null},d3}var p3,sH;function oH(){if(sH)return p3;sH=1;var r=Cs(),e=zs(),t=sl(),n=rv(),i=iH(),s=Ed(),a=Do(),o=Ju(),u=a("iterator"),d=!1,p,b,C;[].keys&&(C=[].keys(),"next"in C?(b=i(i(C)),b!==Object.prototype&&(p=b)):d=!0);var w=!t(p)||r(function(){var M={};return p[u].call(M)!==M});return w?p={}:o&&(p=n(p)),e(p[u])||s(p,u,function(){return this}),p3={IteratorPrototype:p,BUGGY_SAFARI_ITERATORS:d},p3}var g3,aH;function Hve(){if(aH)return g3;aH=1;var r=oH().IteratorPrototype,e=rv(),t=VT(),n=ev(),i=q_(),s=function(){return this};return g3=function(a,o,u,d){var p=o+" Iterator";return a.prototype=e(r,{next:t(+!d,u)}),n(a,p,!1,!0),i[p]=s,a},g3}var m3,lH;function Vve(){if(lH)return m3;lH=1;var r=Ua(),e=Ko(),t=Ju(),n=X1(),i=zs(),s=Hve(),a=iH(),o=_z(),u=ev(),d=j_(),p=Ed(),b=Do(),C=q_(),w=oH(),M=n.PROPER,P=n.CONFIGURABLE,k=w.IteratorPrototype,D=w.BUGGY_SAFARI_ITERATORS,j=b("iterator"),H="keys",N="values",q="entries",W=function(){return this};return m3=function(ie,se,Z,fe,te,ce,ve){s(Z,se,fe);var me=function(Le){if(Le===te&&Xe)return Xe;if(!D&&Le&&Le in st)return st[Le];switch(Le){case H:return function(){return new Z(this,Le)};case N:return function(){return new Z(this,Le)};case q:return function(){return new Z(this,Le)}}return function(){return new Z(this)}},qe=se+" Iterator",ot=!1,st=ie.prototype,Ye=st[j]||st["@@iterator"]||te&&st[te],Xe=!D&&Ye||me(te),wt=se==="Array"&&st.entries||Ye,ht,he,Be;if(wt&&(ht=a(wt.call(new ie)),ht!==Object.prototype&&ht.next&&(!t&&a(ht)!==k&&(o?o(ht,k):i(ht[j])||p(ht,j,W)),u(ht,qe,!0,!0),t&&(C[qe]=W))),M&&te===N&&Ye&&Ye.name!==N&&(!t&&P?d(st,"name",N):(ot=!0,Xe=function(){return e(Ye,this)})),te)if(he={values:me(N),keys:ce?Xe:me(H),entries:me(q)},ve)for(Be in he)(D||ot||!(Be in st))&&p(st,Be,he[Be]);else r({target:se,proto:!0,forced:D||ot},he);return(!t||ve)&&st[j]!==Xe&&p(st,j,Xe,{name:te}),C[se]=Xe,he},m3}var cH,uH;function jve(){return uH||(uH=1,cH=function(r,e){return{value:r,done:e}}),cH}var _3,hH;function AH(){if(hH)return _3;hH=1;var r=H_(),e=zve(),t=q_(),n=Y1(),i=of().f,s=Vve(),a=jve(),o=Ju(),u=iu(),d="Array Iterator",p=n.set,b=n.getterFor(d);_3=s(Array,"Array",function(w,M){p(this,{type:d,target:r(w),index:0,kind:M})},function(){var w=b(this),M=w.target,P=w.index++;if(!M||P>=M.length)return w.target=null,a(void 0,!0);switch(w.kind){case"keys":return a(P,!1);case"values":return a(M[P],!1)}return a([P,M[P]],!1)},"values");var C=t.Arguments=t.Array;if(e("keys"),e("values"),e("entries"),!o&&u&&C.name!=="values")try{i(C,"name",{value:"values"})}catch{}return _3}AH();var fH={},dH,pH;function $ve(){return pH||(pH=1,dH={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}),dH}var y3,gH;function Gve(){if(gH)return y3;gH=1;var r=q1(),e=r("span").classList,t=e&&e.constructor&&e.constructor.prototype;return y3=t===Object.prototype?void 0:t,y3}var mH;function Wve(){if(mH)return fH;mH=1;var r=ss(),e=$ve(),t=Gve(),n=AH(),i=j_(),s=ev(),a=Do(),o=a("iterator"),u=n.values,d=function(b,C){if(b){if(b[o]!==u)try{i(b,o,u)}catch{b[o]=u}if(s(b,C,!0),e[C]){for(var w in n)if(b[w]!==n[w])try{i(b,w,n[w])}catch{b[w]=n[w]}}}};for(var p in e)d(r[p]&&r[p].prototype,p);return d(t,"DOMTokenList"),fH}Wve();function qve(r,e){if(ni(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(ni(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function Kve(r){var e=qve(r,"string");return ni(e)=="symbol"?e:e+""}function b3(r,e,t){return(e=Kve(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var _H={},v3,yH;function Xve(){if(yH)return v3;yH=1;var r=qh(),e=W1(),t=G6(),n=VE(),i=TypeError,s="Reduce of empty array with no initial value",a=function(o){return function(u,d,p,b){var C=e(u),w=t(C),M=n(C);if(r(d),M===0&&p<2)throw new i(s);var P=o?M-1:0,k=o?-1:1;if(p<2)for(;;){if(P in w){b=w[P],P+=k;break}if(P+=k,o?P<0:M<=P)throw new i(s)}for(;o?P>=0:M>P;P+=k)P in w&&(b=d(b,w[P],P,C));return b}};return v3={left:a(!1),right:a(!0)},v3}var w3,bH;function vH(){if(bH)return w3;bH=1;var r=Cs();return w3=function(e,t){var n=[][e];return!!n&&r(function(){n.call(null,t||function(){return 1},1)})},w3}var wH;function Yve(){if(wH)return _H;wH=1;var r=Ua(),e=Xve().left,t=vH(),n=tE(),i=J1(),s=!i&&n>79&&n<83,a=s||!t("reduce");return r({target:"Array",proto:!0,forced:a},{reduce:function(o){var u=arguments.length;return e(this,o,u,u>1?arguments[1]:void 0)}}),_H}Yve();var xH={},BH;function Zve(){if(BH)return xH;BH=1;var r=Ua(),e=tv(),t=K1().f,n=Bg(),i=eh(),s=c3(),a=su(),o=h3(),u=Ju(),d=e("".slice),p=Math.min,b=o("endsWith"),C=!u&&!b&&!!function(){var w=t(String.prototype,"endsWith");return w&&!w.writable}();return r({target:"String",proto:!0,forced:!C&&!b},{endsWith:function(w){var M=i(a(this));s(w);var P=arguments.length>1?arguments[1]:void 0,k=M.length,D=P===void 0?k:p(n(P),k),j=i(w);return d(M,D-j.length,D)===j}}),xH}Zve();var CH={},TH;function Jve(){if(TH)return CH;TH=1;var r=Ko(),e=Ts(),t=YS(),n=Oa(),i=sl(),s=su(),a=Sz(),o=e3(),u=Bg(),d=eh(),p=xg(),b=s3(),C=FQ(),w=Cs(),M=C.UNSUPPORTED_Y,P=4294967295,k=Math.min,D=e([].push),j=e("".slice),H=!w(function(){var q=/(?:)/,W=q.exec;q.exec=function(){return W.apply(this,arguments)};var ie="ab".split(q);return ie.length!==2||ie[0]!=="a"||ie[1]!=="b"}),N="abbc".split(/(b)*/)[1]==="c"||"test".split(/(?:)/,-1).length!==4||"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||".".split(/()()/).length>1||"".split(/.?/).length;return t("split",function(q,W,ie){var se="0".split(void 0,0).length?function(Z,fe){return Z===void 0&&fe===0?[]:r(W,this,Z,fe)}:W;return[function(Z,fe){var te=s(this),ce=i(Z)?p(Z,q):void 0;return ce?r(ce,Z,te,fe):r(se,d(te),Z,fe)},function(Z,fe){var te=n(this),ce=d(Z);if(!N){var ve=ie(se,te,ce,fe,se!==W);if(ve.done)return ve.value}var me=a(te,RegExp),qe=te.unicode,ot=(te.ignoreCase?"i":"")+(te.multiline?"m":"")+(te.unicode?"u":"")+(M?"g":"y"),st=new me(M?"^(?:"+te.source+")":te,ot),Ye=fe===void 0?P:fe>>>0;if(Ye===0)return[];if(ce.length===0)return b(st,ce)===null?[ce]:[];for(var Xe=0,wt=0,ht=[];wt<ce.length;){st.lastIndex=M?0:wt;var he=b(st,M?j(ce,wt):ce),Be;if(he===null||(Be=k(u(st.lastIndex+(M?wt:0)),ce.length))===Xe)wt=o(ce,wt,qe);else{if(D(ht,j(ce,Xe,wt)),ht.length===Ye)return ht;for(var Le=1;Le<=he.length-1;Le++)if(D(ht,he[Le]),ht.length===Ye)return ht;wt=Xe=Be}}return D(ht,j(ce,Xe)),ht}]},N||!H,M),CH}Jve();var K_={exports:{}},Cg={exports:{}},ewe=Cg.exports,EH;function twe(){return EH||(EH=1,(function(){var r,e,t,n,i,s;typeof performance<"u"&&performance!==null&&performance.now?Cg.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(Cg.exports=function(){return(r()-i)/1e6},e=process.hrtime,r=function(){var a;return a=e(),a[0]*1e9+a[1]},n=r(),s=process.uptime()*1e9,i=n-s):Date.now?(Cg.exports=function(){return Date.now()-t},t=Date.now()):(Cg.exports=function(){return new Date().getTime()-t},t=new Date().getTime())}).call(ewe)),Cg.exports}var SH;function rwe(){if(SH)return K_.exports;SH=1;for(var r=twe(),e=typeof window>"u"?DT:window,t=["moz","webkit"],n="AnimationFrame",i=e["request"+n],s=e["cancel"+n]||e["cancelRequest"+n],a=0;!i&&a<t.length;a++)i=e[t[a]+"Request"+n],s=e[t[a]+"Cancel"+n]||e[t[a]+"CancelRequest"+n];if(!i||!s){var o=0,u=0,d=[],p=1e3/60;i=function(b){if(d.length===0){var C=r(),w=Math.max(0,p-(C-o));o=w+C,setTimeout(function(){var M=d.slice(0);d.length=0;for(var P=0;P<M.length;P++)if(!M[P].cancelled)try{M[P].callback(o)}catch(k){setTimeout(function(){throw k},0)}},Math.round(w))}return d.push({handle:++u,callback:b,cancelled:!1}),u},s=function(b){for(var C=0;C<d.length;C++)d[C].handle===b&&(d[C].cancelled=!0)}}return K_.exports=function(b){return i.call(e,b)},K_.exports.cancel=function(){s.apply(e,arguments)},K_.exports.polyfill=function(b){b||(b=e),b.requestAnimationFrame=i,b.cancelAnimationFrame=s},K_.exports}var nwe=rwe();const x3=F6(nwe);var IH={},PH,MH;function FH(){return MH||(MH=1,PH=`	
\v\f\r                　\u2028\u2029\uFEFF`),PH}var B3,RH;function iwe(){if(RH)return B3;RH=1;var r=Ts(),e=su(),t=eh(),n=FH(),i=r("".replace),s=RegExp("^["+n+"]+"),a=RegExp("(^|[^"+n+"])["+n+"]+$"),o=function(u){return function(d){var p=t(e(d));return u&1&&(p=i(p,s,"")),u&2&&(p=i(p,a,"$1")),p}};return B3={start:o(1),end:o(2),trim:o(3)},B3}var C3,LH;function swe(){if(LH)return C3;LH=1;var r=X1().PROPER,e=Cs(),t=FH(),n="​᠎";return C3=function(i){return e(function(){return!!t[i]()||n[i]()!==n||r&&t[i].name!==i})},C3}var OH;function owe(){if(OH)return IH;OH=1;var r=Ua(),e=iwe().trim,t=swe();return r({target:"String",proto:!0,forced:t("trim")},{trim:function(){return e(this)}}),IH}owe();var UH,DH;function awe(){return DH||(DH=1,UH=function(r){this.ok=!1,this.alpha=1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r=r.replace(/ /g,""),r=r.toLowerCase();var e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};r=e[r]||r;for(var t=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(u){return[parseInt(u[1]),parseInt(u[2]),parseInt(u[3]),parseFloat(u[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(u){return[parseInt(u[1]),parseInt(u[2]),parseInt(u[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(u){return[parseInt(u[1],16),parseInt(u[2],16),parseInt(u[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(u){return[parseInt(u[1]+u[1],16),parseInt(u[2]+u[2],16),parseInt(u[3]+u[3],16)]}}],n=0;n<t.length;n++){var i=t[n].re,s=t[n].process,a=i.exec(r);if(a){var o=s(a);this.r=o[0],this.g=o[1],this.b=o[2],o.length>3&&(this.alpha=o[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var u=this.r.toString(16),d=this.g.toString(16),p=this.b.toString(16);return u.length==1&&(u="0"+u),d.length==1&&(d="0"+d),p.length==1&&(p="0"+p),"#"+u+d+p},this.getHelpXML=function(){for(var u=new Array,d=0;d<t.length;d++)for(var p=t[d].example,b=0;b<p.length;b++)u[u.length]=p[b];for(var C in e)u[u.length]=C;var w=document.createElement("ul");w.setAttribute("id","rgbcolor-examples");for(var d=0;d<u.length;d++)try{var M=document.createElement("li"),P=new RGBColor(u[d]),k=document.createElement("div");k.style.cssText="margin: 3px; border: 1px solid black; background:"+P.toHex()+"; color:"+P.toHex(),k.appendChild(document.createTextNode("test"));var D=document.createTextNode(" "+u[d]+" -> "+P.toRGB()+" -> "+P.toHex());M.appendChild(k),M.appendChild(D),w.appendChild(M)}catch{}return w}}),UH}var lwe=awe();const T3=F6(lwe);var kH={},NH;function cwe(){if(NH)return kH;NH=1;var r=Ua(),e=tv(),t=Y8().indexOf,n=vH(),i=e([].indexOf),s=!!i&&1/i([1],1,-0)<0,a=s||!n("indexOf");return r({target:"Array",proto:!0,forced:a},{indexOf:function(o){var u=arguments.length>1?arguments[1]:void 0;return s?i(this,o,u)||0:t(this,o,u)}}),kH}cwe();var zH={},QH;function uwe(){if(QH)return zH;QH=1;var r=Ua(),e=Ts(),t=c3(),n=su(),i=eh(),s=h3(),a=e("".indexOf);return r({target:"String",proto:!0,forced:!s("includes")},{includes:function(o){return!!~a(i(n(this)),i(t(o)),arguments.length>1?arguments[1]:void 0)}}),zH}uwe();var HH={},E3,VH;function hwe(){if(VH)return E3;VH=1;var r=Cd();return E3=Array.isArray||function(e){return r(e)==="Array"},E3}var jH;function Awe(){if(jH)return HH;jH=1;var r=Ua(),e=Ts(),t=hwe(),n=e([].reverse),i=[1,2];return r({target:"Array",proto:!0,forced:String(i)===String(i.reverse())},{reverse:function(){return t(this)&&(this.length=this.length),n(this)}}),HH}Awe();/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var $H=function(r,e){return($H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])})(r,e)};function GH(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=r}$H(r,e),r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function fwe(r){var e="";Array.isArray(r)||(r=[r]);for(var t=0;t<r.length;t++){var n=r[t];if(n.type===lr.CLOSE_PATH)e+="z";else if(n.type===lr.HORIZ_LINE_TO)e+=(n.relative?"h":"H")+n.x;else if(n.type===lr.VERT_LINE_TO)e+=(n.relative?"v":"V")+n.y;else if(n.type===lr.MOVE_TO)e+=(n.relative?"m":"M")+n.x+" "+n.y;else if(n.type===lr.LINE_TO)e+=(n.relative?"l":"L")+n.x+" "+n.y;else if(n.type===lr.CURVE_TO)e+=(n.relative?"c":"C")+n.x1+" "+n.y1+" "+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===lr.SMOOTH_CURVE_TO)e+=(n.relative?"s":"S")+n.x2+" "+n.y2+" "+n.x+" "+n.y;else if(n.type===lr.QUAD_TO)e+=(n.relative?"q":"Q")+n.x1+" "+n.y1+" "+n.x+" "+n.y;else if(n.type===lr.SMOOTH_QUAD_TO)e+=(n.relative?"t":"T")+n.x+" "+n.y;else{if(n.type!==lr.ARC)throw new Error('Unexpected command type "'+n.type+'" at index '+t+".");e+=(n.relative?"a":"A")+n.rX+" "+n.rY+" "+n.xRot+" "+ +n.lArcFlag+" "+ +n.sweepFlag+" "+n.x+" "+n.y}}return e}function S3(r,e){var t=r[0],n=r[1];return[t*Math.cos(e)-n*Math.sin(e),t*Math.sin(e)+n*Math.cos(e)]}function au(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];for(var t=0;t<r.length;t++)if(typeof r[t]!="number")throw new Error("assertNumbers arguments["+t+"] is not a number. "+typeof r[t]+" == typeof "+r[t]);return!0}var af=Math.PI;function I3(r,e,t){r.lArcFlag=r.lArcFlag===0?0:1,r.sweepFlag=r.sweepFlag===0?0:1;var n=r.rX,i=r.rY,s=r.x,a=r.y;n=Math.abs(r.rX),i=Math.abs(r.rY);var o=S3([(e-s)/2,(t-a)/2],-r.xRot/180*af),u=o[0],d=o[1],p=Math.pow(u,2)/Math.pow(n,2)+Math.pow(d,2)/Math.pow(i,2);1<p&&(n*=Math.sqrt(p),i*=Math.sqrt(p)),r.rX=n,r.rY=i;var b=Math.pow(n,2)*Math.pow(d,2)+Math.pow(i,2)*Math.pow(u,2),C=(r.lArcFlag!==r.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(n,2)*Math.pow(i,2)-b)/b)),w=n*d/i*C,M=-i*u/n*C,P=S3([w,M],r.xRot/180*af);r.cX=P[0]+(e+s)/2,r.cY=P[1]+(t+a)/2,r.phi1=Math.atan2((d-M)/i,(u-w)/n),r.phi2=Math.atan2((-d-M)/i,(-u-w)/n),r.sweepFlag===0&&r.phi2>r.phi1&&(r.phi2-=2*af),r.sweepFlag===1&&r.phi2<r.phi1&&(r.phi2+=2*af),r.phi1*=180/af,r.phi2*=180/af}function WH(r,e,t){au(r,e,t);var n=r*r+e*e-t*t;if(0>n)return[];if(n===0)return[[r*t/(r*r+e*e),e*t/(r*r+e*e)]];var i=Math.sqrt(n);return[[(r*t+e*i)/(r*r+e*e),(e*t-r*i)/(r*r+e*e)],[(r*t-e*i)/(r*r+e*e),(e*t+r*i)/(r*r+e*e)]]}var to,Xh=Math.PI/180;function qH(r,e,t){return(1-t)*r+t*e}function KH(r,e,t,n){return r+Math.cos(n/180*af)*e+Math.sin(n/180*af)*t}function XH(r,e,t,n){var i=1e-6,s=e-r,a=t-e,o=3*s+3*(n-t)-6*a,u=6*(a-s),d=3*s;return Math.abs(o)<i?[-d/u]:function(p,b,C){var w=p*p/4-b;if(w<-C)return[];if(w<=C)return[-p/2];var M=Math.sqrt(w);return[-p/2-M,-p/2+M]}(u/o,d/o,i)}function YH(r,e,t,n,i){var s=1-i;return r*(s*s*s)+e*(3*s*s*i)+t*(3*s*i*i)+n*(i*i*i)}(function(r){function e(){return i(function(o,u,d){return o.relative&&(o.x1!==void 0&&(o.x1+=u),o.y1!==void 0&&(o.y1+=d),o.x2!==void 0&&(o.x2+=u),o.y2!==void 0&&(o.y2+=d),o.x!==void 0&&(o.x+=u),o.y!==void 0&&(o.y+=d),o.relative=!1),o})}function t(){var o=NaN,u=NaN,d=NaN,p=NaN;return i(function(b,C,w){return b.type&lr.SMOOTH_CURVE_TO&&(b.type=lr.CURVE_TO,o=isNaN(o)?C:o,u=isNaN(u)?w:u,b.x1=b.relative?C-o:2*C-o,b.y1=b.relative?w-u:2*w-u),b.type&lr.CURVE_TO?(o=b.relative?C+b.x2:b.x2,u=b.relative?w+b.y2:b.y2):(o=NaN,u=NaN),b.type&lr.SMOOTH_QUAD_TO&&(b.type=lr.QUAD_TO,d=isNaN(d)?C:d,p=isNaN(p)?w:p,b.x1=b.relative?C-d:2*C-d,b.y1=b.relative?w-p:2*w-p),b.type&lr.QUAD_TO?(d=b.relative?C+b.x1:b.x1,p=b.relative?w+b.y1:b.y1):(d=NaN,p=NaN),b})}function n(){var o=NaN,u=NaN;return i(function(d,p,b){if(d.type&lr.SMOOTH_QUAD_TO&&(d.type=lr.QUAD_TO,o=isNaN(o)?p:o,u=isNaN(u)?b:u,d.x1=d.relative?p-o:2*p-o,d.y1=d.relative?b-u:2*b-u),d.type&lr.QUAD_TO){o=d.relative?p+d.x1:d.x1,u=d.relative?b+d.y1:d.y1;var C=d.x1,w=d.y1;d.type=lr.CURVE_TO,d.x1=((d.relative?0:p)+2*C)/3,d.y1=((d.relative?0:b)+2*w)/3,d.x2=(d.x+2*C)/3,d.y2=(d.y+2*w)/3}else o=NaN,u=NaN;return d})}function i(o){var u=0,d=0,p=NaN,b=NaN;return function(C){if(isNaN(p)&&!(C.type&lr.MOVE_TO))throw new Error("path must start with moveto");var w=o(C,u,d,p,b);return C.type&lr.CLOSE_PATH&&(u=p,d=b),C.x!==void 0&&(u=C.relative?u+C.x:C.x),C.y!==void 0&&(d=C.relative?d+C.y:C.y),C.type&lr.MOVE_TO&&(p=u,b=d),w}}function s(o,u,d,p,b,C){return au(o,u,d,p,b,C),i(function(w,M,P,k){var D=w.x1,j=w.x2,H=w.relative&&!isNaN(k),N=w.x!==void 0?w.x:H?0:M,q=w.y!==void 0?w.y:H?0:P;function W(he){return he*he}w.type&lr.HORIZ_LINE_TO&&u!==0&&(w.type=lr.LINE_TO,w.y=w.relative?0:P),w.type&lr.VERT_LINE_TO&&d!==0&&(w.type=lr.LINE_TO,w.x=w.relative?0:M),w.x!==void 0&&(w.x=w.x*o+q*d+(H?0:b)),w.y!==void 0&&(w.y=N*u+w.y*p+(H?0:C)),w.x1!==void 0&&(w.x1=w.x1*o+w.y1*d+(H?0:b)),w.y1!==void 0&&(w.y1=D*u+w.y1*p+(H?0:C)),w.x2!==void 0&&(w.x2=w.x2*o+w.y2*d+(H?0:b)),w.y2!==void 0&&(w.y2=j*u+w.y2*p+(H?0:C));var ie=o*p-u*d;if(w.xRot!==void 0&&(o!==1||u!==0||d!==0||p!==1))if(ie===0)delete w.rX,delete w.rY,delete w.xRot,delete w.lArcFlag,delete w.sweepFlag,w.type=lr.LINE_TO;else{var se=w.xRot*Math.PI/180,Z=Math.sin(se),fe=Math.cos(se),te=1/W(w.rX),ce=1/W(w.rY),ve=W(fe)*te+W(Z)*ce,me=2*Z*fe*(te-ce),qe=W(Z)*te+W(fe)*ce,ot=ve*p*p-me*u*p+qe*u*u,st=me*(o*p+u*d)-2*(ve*d*p+qe*o*u),Ye=ve*d*d-me*o*d+qe*o*o,Xe=(Math.atan2(st,ot-Ye)+Math.PI)%Math.PI/2,wt=Math.sin(Xe),ht=Math.cos(Xe);w.rX=Math.abs(ie)/Math.sqrt(ot*W(ht)+st*wt*ht+Ye*W(wt)),w.rY=Math.abs(ie)/Math.sqrt(ot*W(wt)-st*wt*ht+Ye*W(ht)),w.xRot=180*Xe/Math.PI}return w.sweepFlag!==void 0&&0>ie&&(w.sweepFlag=+!w.sweepFlag),w})}function a(){return function(o){var u={};for(var d in o)u[d]=o[d];return u}}r.ROUND=function(o){function u(d){return Math.round(d*o)/o}return o===void 0&&(o=1e13),au(o),function(d){return d.x1!==void 0&&(d.x1=u(d.x1)),d.y1!==void 0&&(d.y1=u(d.y1)),d.x2!==void 0&&(d.x2=u(d.x2)),d.y2!==void 0&&(d.y2=u(d.y2)),d.x!==void 0&&(d.x=u(d.x)),d.y!==void 0&&(d.y=u(d.y)),d.rX!==void 0&&(d.rX=u(d.rX)),d.rY!==void 0&&(d.rY=u(d.rY)),d}},r.TO_ABS=e,r.TO_REL=function(){return i(function(o,u,d){return o.relative||(o.x1!==void 0&&(o.x1-=u),o.y1!==void 0&&(o.y1-=d),o.x2!==void 0&&(o.x2-=u),o.y2!==void 0&&(o.y2-=d),o.x!==void 0&&(o.x-=u),o.y!==void 0&&(o.y-=d),o.relative=!0),o})},r.NORMALIZE_HVZ=function(o,u,d){return o===void 0&&(o=!0),u===void 0&&(u=!0),d===void 0&&(d=!0),i(function(p,b,C,w,M){if(isNaN(w)&&!(p.type&lr.MOVE_TO))throw new Error("path must start with moveto");return u&&p.type&lr.HORIZ_LINE_TO&&(p.type=lr.LINE_TO,p.y=p.relative?0:C),d&&p.type&lr.VERT_LINE_TO&&(p.type=lr.LINE_TO,p.x=p.relative?0:b),o&&p.type&lr.CLOSE_PATH&&(p.type=lr.LINE_TO,p.x=p.relative?w-b:w,p.y=p.relative?M-C:M),p.type&lr.ARC&&(p.rX===0||p.rY===0)&&(p.type=lr.LINE_TO,delete p.rX,delete p.rY,delete p.xRot,delete p.lArcFlag,delete p.sweepFlag),p})},r.NORMALIZE_ST=t,r.QT_TO_C=n,r.INFO=i,r.SANITIZE=function(o){o===void 0&&(o=0),au(o);var u=NaN,d=NaN,p=NaN,b=NaN;return i(function(C,w,M,P,k){var D=Math.abs,j=!1,H=0,N=0;if(C.type&lr.SMOOTH_CURVE_TO&&(H=isNaN(u)?0:w-u,N=isNaN(d)?0:M-d),C.type&(lr.CURVE_TO|lr.SMOOTH_CURVE_TO)?(u=C.relative?w+C.x2:C.x2,d=C.relative?M+C.y2:C.y2):(u=NaN,d=NaN),C.type&lr.SMOOTH_QUAD_TO?(p=isNaN(p)?w:2*w-p,b=isNaN(b)?M:2*M-b):C.type&lr.QUAD_TO?(p=C.relative?w+C.x1:C.x1,b=C.relative?M+C.y1:C.y2):(p=NaN,b=NaN),C.type&lr.LINE_COMMANDS||C.type&lr.ARC&&(C.rX===0||C.rY===0||!C.lArcFlag)||C.type&lr.CURVE_TO||C.type&lr.SMOOTH_CURVE_TO||C.type&lr.QUAD_TO||C.type&lr.SMOOTH_QUAD_TO){var q=C.x===void 0?0:C.relative?C.x:C.x-w,W=C.y===void 0?0:C.relative?C.y:C.y-M;H=isNaN(p)?C.x1===void 0?H:C.relative?C.x:C.x1-w:p-w,N=isNaN(b)?C.y1===void 0?N:C.relative?C.y:C.y1-M:b-M;var ie=C.x2===void 0?0:C.relative?C.x:C.x2-w,se=C.y2===void 0?0:C.relative?C.y:C.y2-M;D(q)<=o&&D(W)<=o&&D(H)<=o&&D(N)<=o&&D(ie)<=o&&D(se)<=o&&(j=!0)}return C.type&lr.CLOSE_PATH&&D(w-P)<=o&&D(M-k)<=o&&(j=!0),j?[]:C})},r.MATRIX=s,r.ROTATE=function(o,u,d){u===void 0&&(u=0),d===void 0&&(d=0),au(o,u,d);var p=Math.sin(o),b=Math.cos(o);return s(b,p,-p,b,u-u*b+d*p,d-u*p-d*b)},r.TRANSLATE=function(o,u){return u===void 0&&(u=0),au(o,u),s(1,0,0,1,o,u)},r.SCALE=function(o,u){return u===void 0&&(u=o),au(o,u),s(o,0,0,u,0,0)},r.SKEW_X=function(o){return au(o),s(1,0,Math.atan(o),1,0,0)},r.SKEW_Y=function(o){return au(o),s(1,Math.atan(o),0,1,0,0)},r.X_AXIS_SYMMETRY=function(o){return o===void 0&&(o=0),au(o),s(-1,0,0,1,o,0)},r.Y_AXIS_SYMMETRY=function(o){return o===void 0&&(o=0),au(o),s(1,0,0,-1,0,o)},r.A_TO_C=function(){return i(function(o,u,d){return lr.ARC===o.type?function(p,b,C){var w,M,P,k;p.cX||I3(p,b,C);for(var D=Math.min(p.phi1,p.phi2),j=Math.max(p.phi1,p.phi2)-D,H=Math.ceil(j/90),N=new Array(H),q=b,W=C,ie=0;ie<H;ie++){var se=qH(p.phi1,p.phi2,ie/H),Z=qH(p.phi1,p.phi2,(ie+1)/H),fe=Z-se,te=4/3*Math.tan(fe*Xh/4),ce=[Math.cos(se*Xh)-te*Math.sin(se*Xh),Math.sin(se*Xh)+te*Math.cos(se*Xh)],ve=ce[0],me=ce[1],qe=[Math.cos(Z*Xh),Math.sin(Z*Xh)],ot=qe[0],st=qe[1],Ye=[ot+te*Math.sin(Z*Xh),st-te*Math.cos(Z*Xh)],Xe=Ye[0],wt=Ye[1];N[ie]={relative:p.relative,type:lr.CURVE_TO};var ht=function(he,Be){var Le=S3([he*p.rX,Be*p.rY],p.xRot),He=Le[0],rt=Le[1];return[p.cX+He,p.cY+rt]};w=ht(ve,me),N[ie].x1=w[0],N[ie].y1=w[1],M=ht(Xe,wt),N[ie].x2=M[0],N[ie].y2=M[1],P=ht(ot,st),N[ie].x=P[0],N[ie].y=P[1],p.relative&&(N[ie].x1-=q,N[ie].y1-=W,N[ie].x2-=q,N[ie].y2-=W,N[ie].x-=q,N[ie].y-=W),q=(k=[N[ie].x,N[ie].y])[0],W=k[1]}return N}(o,o.relative?0:u,o.relative?0:d):o})},r.ANNOTATE_ARCS=function(){return i(function(o,u,d){return o.relative&&(u=0,d=0),lr.ARC===o.type&&I3(o,u,d),o})},r.CLONE=a,r.CALCULATE_BOUNDS=function(){var o=function(C){var w={};for(var M in C)w[M]=C[M];return w},u=e(),d=n(),p=t(),b=i(function(C,w,M){var P=p(d(u(o(C))));function k(wt){wt>b.maxX&&(b.maxX=wt),wt<b.minX&&(b.minX=wt)}function D(wt){wt>b.maxY&&(b.maxY=wt),wt<b.minY&&(b.minY=wt)}if(P.type&lr.DRAWING_COMMANDS&&(k(w),D(M)),P.type&lr.HORIZ_LINE_TO&&k(P.x),P.type&lr.VERT_LINE_TO&&D(P.y),P.type&lr.LINE_TO&&(k(P.x),D(P.y)),P.type&lr.CURVE_TO){k(P.x),D(P.y);for(var j=0,H=XH(w,P.x1,P.x2,P.x);j<H.length;j++)0<(Xe=H[j])&&1>Xe&&k(YH(w,P.x1,P.x2,P.x,Xe));for(var N=0,q=XH(M,P.y1,P.y2,P.y);N<q.length;N++)0<(Xe=q[N])&&1>Xe&&D(YH(M,P.y1,P.y2,P.y,Xe))}if(P.type&lr.ARC){k(P.x),D(P.y),I3(P,w,M);for(var W=P.xRot/180*Math.PI,ie=Math.cos(W)*P.rX,se=Math.sin(W)*P.rX,Z=-Math.sin(W)*P.rY,fe=Math.cos(W)*P.rY,te=P.phi1<P.phi2?[P.phi1,P.phi2]:-180>P.phi2?[P.phi2+360,P.phi1+360]:[P.phi2,P.phi1],ce=te[0],ve=te[1],me=function(wt){var ht=wt[0],he=wt[1],Be=180*Math.atan2(he,ht)/Math.PI;return Be<ce?Be+360:Be},qe=0,ot=WH(Z,-ie,0).map(me);qe<ot.length;qe++)(Xe=ot[qe])>ce&&Xe<ve&&k(KH(P.cX,ie,Z,Xe));for(var st=0,Ye=WH(fe,-se,0).map(me);st<Ye.length;st++){var Xe;(Xe=Ye[st])>ce&&Xe<ve&&D(KH(P.cY,se,fe,Xe))}}return C});return b.minX=1/0,b.maxX=-1/0,b.minY=1/0,b.maxY=-1/0,b}})(to||(to={}));var lu,ZH=function(){function r(){}return r.prototype.round=function(e){return this.transform(to.ROUND(e))},r.prototype.toAbs=function(){return this.transform(to.TO_ABS())},r.prototype.toRel=function(){return this.transform(to.TO_REL())},r.prototype.normalizeHVZ=function(e,t,n){return this.transform(to.NORMALIZE_HVZ(e,t,n))},r.prototype.normalizeST=function(){return this.transform(to.NORMALIZE_ST())},r.prototype.qtToC=function(){return this.transform(to.QT_TO_C())},r.prototype.aToC=function(){return this.transform(to.A_TO_C())},r.prototype.sanitize=function(e){return this.transform(to.SANITIZE(e))},r.prototype.translate=function(e,t){return this.transform(to.TRANSLATE(e,t))},r.prototype.scale=function(e,t){return this.transform(to.SCALE(e,t))},r.prototype.rotate=function(e,t,n){return this.transform(to.ROTATE(e,t,n))},r.prototype.matrix=function(e,t,n,i,s,a){return this.transform(to.MATRIX(e,t,n,i,s,a))},r.prototype.skewX=function(e){return this.transform(to.SKEW_X(e))},r.prototype.skewY=function(e){return this.transform(to.SKEW_Y(e))},r.prototype.xSymmetry=function(e){return this.transform(to.X_AXIS_SYMMETRY(e))},r.prototype.ySymmetry=function(e){return this.transform(to.Y_AXIS_SYMMETRY(e))},r.prototype.annotateArcs=function(){return this.transform(to.ANNOTATE_ARCS())},r}(),dwe=function(r){return r===" "||r==="	"||r==="\r"||r===`
`},JH=function(r){return 48<=r.charCodeAt(0)&&r.charCodeAt(0)<=57},pwe=function(r){function e(){var t=r.call(this)||this;return t.curNumber="",t.curCommandType=-1,t.curCommandRelative=!1,t.canParseCommandOrComma=!0,t.curNumberHasExp=!1,t.curNumberHasExpDigits=!1,t.curNumberHasDecimal=!1,t.curArgs=[],t}return GH(e,r),e.prototype.finish=function(t){if(t===void 0&&(t=[]),this.parse(" ",t),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return t},e.prototype.parse=function(t,n){var i=this;n===void 0&&(n=[]);for(var s=function(b){n.push(b),i.curArgs.length=0,i.canParseCommandOrComma=!0},a=0;a<t.length;a++){var o=t[a],u=!(this.curCommandType!==lr.ARC||this.curArgs.length!==3&&this.curArgs.length!==4||this.curNumber.length!==1||this.curNumber!=="0"&&this.curNumber!=="1"),d=JH(o)&&(this.curNumber==="0"&&o==="0"||u);if(!JH(o)||d)if(o!=="e"&&o!=="E")if(o!=="-"&&o!=="+"||!this.curNumberHasExp||this.curNumberHasExpDigits)if(o!=="."||this.curNumberHasExp||this.curNumberHasDecimal||u){if(this.curNumber&&this.curCommandType!==-1){var p=Number(this.curNumber);if(isNaN(p))throw new SyntaxError("Invalid number ending at "+a);if(this.curCommandType===lr.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>p)throw new SyntaxError('Expected positive number, got "'+p+'" at index "'+a+'"')}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+a+'"')}this.curArgs.push(p),this.curArgs.length===gwe[this.curCommandType]&&(lr.HORIZ_LINE_TO===this.curCommandType?s({type:lr.HORIZ_LINE_TO,relative:this.curCommandRelative,x:p}):lr.VERT_LINE_TO===this.curCommandType?s({type:lr.VERT_LINE_TO,relative:this.curCommandRelative,y:p}):this.curCommandType===lr.MOVE_TO||this.curCommandType===lr.LINE_TO||this.curCommandType===lr.SMOOTH_QUAD_TO?(s({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),lr.MOVE_TO===this.curCommandType&&(this.curCommandType=lr.LINE_TO)):this.curCommandType===lr.CURVE_TO?s({type:lr.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===lr.SMOOTH_CURVE_TO?s({type:lr.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===lr.QUAD_TO?s({type:lr.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===lr.ARC&&s({type:lr.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!dwe(o))if(o===","&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if(o!=="+"&&o!=="-"&&o!==".")if(d)this.curNumber=o,this.curNumberHasDecimal=!1;else{if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index "+a+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+o+'" at index '+a+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,o!=="z"&&o!=="Z")if(o==="h"||o==="H")this.curCommandType=lr.HORIZ_LINE_TO,this.curCommandRelative=o==="h";else if(o==="v"||o==="V")this.curCommandType=lr.VERT_LINE_TO,this.curCommandRelative=o==="v";else if(o==="m"||o==="M")this.curCommandType=lr.MOVE_TO,this.curCommandRelative=o==="m";else if(o==="l"||o==="L")this.curCommandType=lr.LINE_TO,this.curCommandRelative=o==="l";else if(o==="c"||o==="C")this.curCommandType=lr.CURVE_TO,this.curCommandRelative=o==="c";else if(o==="s"||o==="S")this.curCommandType=lr.SMOOTH_CURVE_TO,this.curCommandRelative=o==="s";else if(o==="q"||o==="Q")this.curCommandType=lr.QUAD_TO,this.curCommandRelative=o==="q";else if(o==="t"||o==="T")this.curCommandType=lr.SMOOTH_QUAD_TO,this.curCommandRelative=o==="t";else{if(o!=="a"&&o!=="A")throw new SyntaxError('Unexpected character "'+o+'" at index '+a+".");this.curCommandType=lr.ARC,this.curCommandRelative=o==="a"}else n.push({type:lr.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=o,this.curNumberHasDecimal=o==="."}else this.curNumber+=o,this.curNumberHasDecimal=!0;else this.curNumber+=o;else this.curNumber+=o,this.curNumberHasExp=!0;else this.curNumber+=o,this.curNumberHasExpDigits=this.curNumberHasExp}return n},e.prototype.transform=function(t){return Object.create(this,{parse:{value:function(n,i){i===void 0&&(i=[]);for(var s=0,a=Object.getPrototypeOf(this).parse.call(this,n);s<a.length;s++){var o=a[s],u=t(o);Array.isArray(u)?i.push.apply(i,u):i.push(u)}return i}}})},e}(ZH),lr=function(r){function e(t){var n=r.call(this)||this;return n.commands=typeof t=="string"?e.parse(t):t,n}return GH(e,r),e.prototype.encode=function(){return e.encode(this.commands)},e.prototype.getBounds=function(){var t=to.CALCULATE_BOUNDS();return this.transform(t),t},e.prototype.transform=function(t){for(var n=[],i=0,s=this.commands;i<s.length;i++){var a=t(s[i]);Array.isArray(a)?n.push.apply(n,a):n.push(a)}return this.commands=n,this},e.encode=function(t){return fwe(t)},e.parse=function(t){var n=new pwe,i=[];return n.parse(t,i),n.finish(i),i},e.CLOSE_PATH=1,e.MOVE_TO=2,e.HORIZ_LINE_TO=4,e.VERT_LINE_TO=8,e.LINE_TO=16,e.CURVE_TO=32,e.SMOOTH_CURVE_TO=64,e.QUAD_TO=128,e.SMOOTH_QUAD_TO=256,e.ARC=512,e.LINE_COMMANDS=e.LINE_TO|e.HORIZ_LINE_TO|e.VERT_LINE_TO,e.DRAWING_COMMANDS=e.HORIZ_LINE_TO|e.VERT_LINE_TO|e.LINE_TO|e.CURVE_TO|e.SMOOTH_CURVE_TO|e.QUAD_TO|e.SMOOTH_QUAD_TO|e.ARC,e}(ZH),gwe=((lu={})[lr.MOVE_TO]=2,lu[lr.LINE_TO]=2,lu[lr.HORIZ_LINE_TO]=1,lu[lr.VERT_LINE_TO]=1,lu[lr.CLOSE_PATH]=0,lu[lr.QUAD_TO]=4,lu[lr.SMOOTH_QUAD_TO]=2,lu[lr.CURVE_TO]=6,lu[lr.SMOOTH_CURVE_TO]=4,lu[lr.ARC]=7,lu),e7={},t7;function mwe(){if(t7)return e7;t7=1;var r=X1().PROPER,e=Ed(),t=Oa(),n=eh(),i=Cs(),s=n3(),a="toString",o=RegExp.prototype,u=o[a],d=i(function(){return u.call({source:"a",flags:"b"})!=="/a/b"}),p=r&&u.name!==a;return(d||p)&&e(o,a,function(){var b=t(this),C=n(b.source),w=n(s(b));return"/"+C+"/"+w},{unsafe:!0}),e7}mwe();function nv(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?nv=function(e){return typeof e}:nv=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nv(r)}function _we(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var ywe=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],bwe=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function vwe(r,e,t,n,i){if(typeof r=="string"&&(r=document.getElementById(r)),!r||nv(r)!=="object"||!("getContext"in r))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var s=r.getContext("2d");try{return s.getImageData(e,t,n,i)}catch(a){throw new Error("unable to access image data: "+a)}}function wwe(r,e,t,n,i,s){if(!(isNaN(s)||s<1)){s|=0;var a=vwe(r,e,t,n,i);a=xwe(a,e,t,n,i,s),r.getContext("2d").putImageData(a,e,t)}}function xwe(r,e,t,n,i,s){for(var a=r.data,o=2*s+1,u=n-1,d=i-1,p=s+1,b=p*(p+1)/2,C=new r7,w=C,M,P=1;P<o;P++)w=w.next=new r7,P===p&&(M=w);w.next=C;for(var k=null,D=null,j=0,H=0,N=ywe[s],q=bwe[s],W=0;W<i;W++){w=C;for(var ie=a[H],se=a[H+1],Z=a[H+2],fe=a[H+3],te=0;te<p;te++)w.r=ie,w.g=se,w.b=Z,w.a=fe,w=w.next;for(var ce=0,ve=0,me=0,qe=0,ot=p*ie,st=p*se,Ye=p*Z,Xe=p*fe,wt=b*ie,ht=b*se,he=b*Z,Be=b*fe,Le=1;Le<p;Le++){var He=H+((u<Le?u:Le)<<2),rt=a[He],it=a[He+1],Pt=a[He+2],Bt=a[He+3],Dt=p-Le;wt+=(w.r=rt)*Dt,ht+=(w.g=it)*Dt,he+=(w.b=Pt)*Dt,Be+=(w.a=Bt)*Dt,ce+=rt,ve+=it,me+=Pt,qe+=Bt,w=w.next}k=C,D=M;for(var Yt=0;Yt<n;Yt++){var nr=Be*N>>>q;if(a[H+3]=nr,nr!==0){var ur=255/nr;a[H]=(wt*N>>>q)*ur,a[H+1]=(ht*N>>>q)*ur,a[H+2]=(he*N>>>q)*ur}else a[H]=a[H+1]=a[H+2]=0;wt-=ot,ht-=st,he-=Ye,Be-=Xe,ot-=k.r,st-=k.g,Ye-=k.b,Xe-=k.a;var xt=Yt+s+1;xt=j+(xt<u?xt:u)<<2,ce+=k.r=a[xt],ve+=k.g=a[xt+1],me+=k.b=a[xt+2],qe+=k.a=a[xt+3],wt+=ce,ht+=ve,he+=me,Be+=qe,k=k.next;var Re=D,Kr=Re.r,Ur=Re.g,Er=Re.b,Kt=Re.a;ot+=Kr,st+=Ur,Ye+=Er,Xe+=Kt,ce-=Kr,ve-=Ur,me-=Er,qe-=Kt,D=D.next,H+=4}j+=n}for(var Br=0;Br<n;Br++){H=Br<<2;var ar=a[H],Lr=a[H+1],vr=a[H+2],kt=a[H+3],ir=p*ar,hr=p*Lr,Mr=p*vr,Cr=p*kt,wr=b*ar,Ne=b*Lr,re=b*vr,ae=b*kt;w=C;for(var ge=0;ge<p;ge++)w.r=ar,w.g=Lr,w.b=vr,w.a=kt,w=w.next;for(var xe=n,Me=0,We=0,nt=0,Ge=0,lt=1;lt<=s;lt++){H=xe+Br<<2;var Lt=p-lt;wr+=(w.r=ar=a[H])*Lt,Ne+=(w.g=Lr=a[H+1])*Lt,re+=(w.b=vr=a[H+2])*Lt,ae+=(w.a=kt=a[H+3])*Lt,Ge+=ar,Me+=Lr,We+=vr,nt+=kt,w=w.next,lt<d&&(xe+=n)}H=Br,k=C,D=M;for(var Ft=0;Ft<i;Ft++){var Wt=H<<2;a[Wt+3]=kt=ae*N>>>q,kt>0?(kt=255/kt,a[Wt]=(wr*N>>>q)*kt,a[Wt+1]=(Ne*N>>>q)*kt,a[Wt+2]=(re*N>>>q)*kt):a[Wt]=a[Wt+1]=a[Wt+2]=0,wr-=ir,Ne-=hr,re-=Mr,ae-=Cr,ir-=k.r,hr-=k.g,Mr-=k.b,Cr-=k.a,Wt=Br+((Wt=Ft+p)<d?Wt:d)*n<<2,wr+=Ge+=k.r=a[Wt],Ne+=Me+=k.g=a[Wt+1],re+=We+=k.b=a[Wt+2],ae+=nt+=k.a=a[Wt+3],k=k.next,ir+=ar=D.r,hr+=Lr=D.g,Mr+=vr=D.b,Cr+=kt=D.a,Ge-=ar,Me-=Lr,We-=vr,nt-=kt,D=D.next,H+=n}}return r}var r7=function r(){_we(this,r),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function Bwe(){var{DOMParser:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e={window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:r,createCanvas(t,n){return new OffscreenCanvas(t,n)},createImage(t){return Kh(function*(){var n=yield fetch(t),i=yield n.blob(),s=yield createImageBitmap(i);return s})()}};return(typeof DOMParser<"u"||typeof r>"u")&&Reflect.deleteProperty(e,"DOMParser"),e}function Cwe(r){var{DOMParser:e,canvas:t,fetch:n}=r;return{window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:e,fetch:n,createCanvas:t.createCanvas,createImage:t.loadImage}}var Twe=Object.freeze({__proto__:null,offscreen:Bwe,node:Cwe});function Sd(r){return r.replace(/(?!\u3000)\s+/gm," ")}function n7(r){return r.replace(/^[\n \t]+/,"")}function i7(r){return r.replace(/[\n \t]+$/,"")}function ol(r){var e=(r||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[];return e.map(parseFloat)}var Ewe=/^[A-Z-]+$/;function s7(r){return Ewe.test(r)?r.toLowerCase():r}function P3(r){var e=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(r)||[];return e[2]||e[3]||e[4]}function o7(r){if(!r.startsWith("rgb"))return r;var e=3,t=r.replace(/\d+(\.\d+)?/g,(n,i)=>e--&&i?String(Math.round(parseFloat(n))):n);return t}var Swe=/(\[[^\]]+\])/g,Iwe=/(#[^\s+>~.[:]+)/g,Pwe=/(\.[^\s+>~.[:]+)/g,Mwe=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,Fwe=/(:[\w-]+\([^)]*\))/gi,Rwe=/(:[^\s+>~.[:]+)/g,Lwe=/([^\s+>~.[:]+)/g;function Id(r,e){var t=e.exec(r);return t?[r.replace(e," "),t.length]:[r,0]}function a7(r){var e=[0,0,0],t=r.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),n=0;return[t,n]=Id(t,Swe),e[1]+=n,[t,n]=Id(t,Iwe),e[0]+=n,[t,n]=Id(t,Pwe),e[1]+=n,[t,n]=Id(t,Mwe),e[2]+=n,[t,n]=Id(t,Fwe),e[1]+=n,[t,n]=Id(t,Rwe),e[1]+=n,t=t.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[t,n]=Id(t,Lwe),e[2]+=n,e.join("")}var Pd=1e-8;function M3(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2))}function iv(r,e){return(r[0]*e[0]+r[1]*e[1])/(M3(r)*M3(e))}function F3(r,e){return(r[0]*e[1]<r[1]*e[0]?-1:1)*Math.acos(iv(r,e))}function R3(r){return r*r*r}function L3(r){return 3*r*r*(1-r)}function O3(r){return 3*r*(1-r)*(1-r)}function U3(r){return(1-r)*(1-r)*(1-r)}function D3(r){return r*r}function k3(r){return 2*r*(1-r)}function N3(r){return(1-r)*(1-r)}class nn{constructor(e,t,n){this.document=e,this.name=t,this.value=n,this.isNormalizedColor=!1}static empty(e){return new nn(e,"EMPTY","")}split(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ",{document:t,name:n}=this;return Sd(this.getString()).trim().split(e).map(i=>new nn(t,n,i))}hasValue(e){var{value:t}=this;return t!==null&&t!==""&&(e||t!==0)&&typeof t<"u"}isString(e){var{value:t}=this,n=typeof t=="string";return!n||!e?n:e.test(t)}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;var e=this.getString();switch(!0){case e.endsWith("px"):case/^[0-9]+$/.test(e):return!0;default:return!1}}setValue(e){return this.value=e,this}getValue(e){return typeof e>"u"||this.hasValue()?this.value:e}getNumber(e){if(!this.hasValue())return typeof e>"u"?0:parseFloat(e);var{value:t}=this,n=parseFloat(t);return this.isString(/%$/)&&(n/=100),n}getString(e){return typeof e>"u"||this.hasValue()?typeof this.value>"u"?"":String(this.value):String(e)}getColor(e){var t=this.getString(e);return this.isNormalizedColor||(this.isNormalizedColor=!0,t=o7(t),this.value=t),t}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasValue())return 0;var[n,i]=typeof e=="boolean"?[void 0,e]:[e],{viewPort:s}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(s.computeSize("x"),s.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(s.computeSize("x"),s.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*s.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*s.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case(this.isString(/%$/)&&i):return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*s.computeSize(n);default:{var a=this.getNumber();return t&&a<1?a*s.computeSize(n):a}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){var e=this.getString(),t=/#([^)'"]+)/.exec(e);return t&&(t=t[1]),t||(t=e),this.document.definitions[t]}getFillStyleDefinition(e,t){var n=this.getDefinition();if(!n)return null;if(typeof n.createGradient=="function")return n.createGradient(this.document.ctx,e,t);if(typeof n.createPattern=="function"){if(n.getHrefAttribute().hasValue()){var i=n.getAttribute("patternTransform");n=n.getHrefAttribute().getDefinition(),i.hasValue()&&n.getAttribute("patternTransform",!0).setValue(i.value)}return n.createPattern(this.document.ctx,e,t)}return null}getTextBaseline(){return this.hasValue()?nn.textBaselineMapping[this.getString()]:null}addOpacity(e){for(var t=this.getColor(),n=t.length,i=0,s=0;s<n&&(t[s]===","&&i++,i!==3);s++);if(e.hasValue()&&this.isString()&&i!==3){var a=new T3(t);a.ok&&(a.alpha=e.getNumber(),t=a.toRGBA())}return new nn(this.document,this.name,t)}}nn.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class l7{constructor(){this.viewPorts=[]}clear(){this.viewPorts=[]}setCurrent(e,t){this.viewPorts.push({width:e,height:t})}removeCurrent(){this.viewPorts.pop()}getCurrent(){var{viewPorts:e}=this;return e[e.length-1]}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(e){return typeof e=="number"?e:e==="x"?this.width:e==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}}class Es{constructor(e,t){this.x=e,this.y=t}static parse(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,[n=t,i=t]=ol(e);return new Es(n,i)}static parseScale(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,[n=t,i=n]=ol(e);return new Es(n,i)}static parsePath(e){for(var t=ol(e),n=t.length,i=[],s=0;s<n;s+=2)i.push(new Es(t[s],t[s+1]));return i}angleTo(e){return Math.atan2(e.y-this.y,e.x-this.x)}applyTransform(e){var{x:t,y:n}=this,i=t*e[0]+n*e[2]+e[4],s=t*e[1]+n*e[3]+e[5];this.x=i,this.y=s}}class c7{constructor(e){this.screen=e,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}isWorking(){return this.working}start(){if(!this.working){var{screen:e,onClick:t,onMouseMove:n}=this,i=e.ctx.canvas;i.onclick=t,i.onmousemove=n,this.working=!0}}stop(){if(this.working){var e=this.screen.ctx.canvas;this.working=!1,e.onclick=null,e.onmousemove=null}}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(this.working){var{screen:e,events:t,eventElements:n}=this,{style:i}=e.ctx.canvas;i&&(i.cursor=""),t.forEach((s,a)=>{for(var{run:o}=s,u=n[a];u;)o(u),u=u.parent}),this.events=[],this.eventElements=[]}}checkPath(e,t){if(!(!this.working||!t)){var{events:n,eventElements:i}=this;n.forEach((s,a)=>{var{x:o,y:u}=s;!i[a]&&t.isPointInPath&&t.isPointInPath(o,u)&&(i[a]=e)})}}checkBoundingBox(e,t){if(!(!this.working||!t)){var{events:n,eventElements:i}=this;n.forEach((s,a)=>{var{x:o,y:u}=s;!i[a]&&t.isPointInBox(o,u)&&(i[a]=e)})}}mapXY(e,t){for(var{window:n,ctx:i}=this.screen,s=new Es(e,t),a=i.canvas;a;)s.x-=a.offsetLeft,s.y-=a.offsetTop,a=a.offsetParent;return n.scrollX&&(s.x+=n.scrollX),n.scrollY&&(s.y+=n.scrollY),s}onClick(e){var{x:t,y:n}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onclick",x:t,y:n,run(i){i.onClick&&i.onClick()}})}onMouseMove(e){var{x:t,y:n}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onmousemove",x:t,y:n,run(i){i.onMouseMove&&i.onMouseMove()}})}}var u7=typeof window<"u"?window:null,h7=typeof fetch<"u"?fetch.bind(void 0):null;class X_{constructor(e){var{fetch:t=h7,window:n=u7}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ctx=e,this.FRAMERATE=30,this.MAX_VIRTUAL_PIXELS=3e4,this.CLIENT_WIDTH=800,this.CLIENT_HEIGHT=600,this.viewPort=new l7,this.mouse=new c7(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=n,this.fetch=t}wait(e){this.waits.push(e)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;var e=this.waits.every(t=>t());return e&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=e,e}setDefaults(e){e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4}setViewBox(e){var{document:t,ctx:n,aspectRatio:i,width:s,desiredWidth:a,height:o,desiredHeight:u,minX:d=0,minY:p=0,refX:b,refY:C,clip:w=!1,clipX:M=0,clipY:P=0}=e,k=Sd(i).replace(/^defer\s/,""),[D,j]=k.split(" "),H=D||"xMidYMid",N=j||"meet",q=s/a,W=o/u,ie=Math.min(q,W),se=Math.max(q,W),Z=a,fe=u;N==="meet"&&(Z*=ie,fe*=ie),N==="slice"&&(Z*=se,fe*=se);var te=new nn(t,"refX",b),ce=new nn(t,"refY",C),ve=te.hasValue()&&ce.hasValue();if(ve&&n.translate(-ie*te.getPixels("x"),-ie*ce.getPixels("y")),w){var me=ie*M,qe=ie*P;n.beginPath(),n.moveTo(me,qe),n.lineTo(s,qe),n.lineTo(s,o),n.lineTo(me,o),n.closePath(),n.clip()}if(!ve){var ot=N==="meet"&&ie===W,st=N==="slice"&&se===W,Ye=N==="meet"&&ie===q,Xe=N==="slice"&&se===q;H.startsWith("xMid")&&(ot||st)&&n.translate(s/2-Z/2,0),H.endsWith("YMid")&&(Ye||Xe)&&n.translate(0,o/2-fe/2),H.startsWith("xMax")&&(ot||st)&&n.translate(s-Z,0),H.endsWith("YMax")&&(Ye||Xe)&&n.translate(0,o-fe)}switch(!0){case H==="none":n.scale(q,W);break;case N==="meet":n.scale(ie,ie);break;case N==="slice":n.scale(se,se);break}n.translate(-d,-p)}start(e){var{enableRedraw:t=!1,ignoreMouse:n=!1,ignoreAnimation:i=!1,ignoreDimensions:s=!1,ignoreClear:a=!1,forceRedraw:o,scaleWidth:u,scaleHeight:d,offsetX:p,offsetY:b}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{FRAMERATE:C,mouse:w}=this,M=1e3/C;if(this.frameDuration=M,this.readyPromise=new Promise(H=>{this.resolveReady=H}),this.isReady()&&this.render(e,s,a,u,d,p,b),!!t){var P=Date.now(),k=P,D=0,j=()=>{P=Date.now(),D=P-k,D>=M&&(k=P-D%M,this.shouldUpdate(i,o)&&(this.render(e,s,a,u,d,p,b),w.runEvents())),this.intervalId=x3(j)};n||w.start(),this.intervalId=x3(j)}}stop(){this.intervalId&&(x3.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(e,t){if(!e){var{frameDuration:n}=this,i=this.animations.reduce((s,a)=>a.update(n)||s,!1);if(i)return!0}return!!(typeof t=="function"&&t()||!this.isReadyLock&&this.isReady()||this.mouse.hasEvents())}render(e,t,n,i,s,a,o){var{CLIENT_WIDTH:u,CLIENT_HEIGHT:d,viewPort:p,ctx:b,isFirstRender:C}=this,w=b.canvas;p.clear(),w.width&&w.height?p.setCurrent(w.width,w.height):p.setCurrent(u,d);var M=e.getStyle("width"),P=e.getStyle("height");!t&&(C||typeof i!="number"&&typeof s!="number")&&(M.hasValue()&&(w.width=M.getPixels("x"),w.style&&(w.style.width="".concat(w.width,"px"))),P.hasValue()&&(w.height=P.getPixels("y"),w.style&&(w.style.height="".concat(w.height,"px"))));var k=w.clientWidth||w.width,D=w.clientHeight||w.height;if(t&&M.hasValue()&&P.hasValue()&&(k=M.getPixels("x"),D=P.getPixels("y")),p.setCurrent(k,D),typeof a=="number"&&e.getAttribute("x",!0).setValue(a),typeof o=="number"&&e.getAttribute("y",!0).setValue(o),typeof i=="number"||typeof s=="number"){var j=ol(e.getAttribute("viewBox").getString()),H=0,N=0;if(typeof i=="number"){var q=e.getStyle("width");q.hasValue()?H=q.getPixels("x")/i:isNaN(j[2])||(H=j[2]/i)}if(typeof s=="number"){var W=e.getStyle("height");W.hasValue()?N=W.getPixels("y")/s:isNaN(j[3])||(N=j[3]/s)}H||(H=N),N||(N=H),e.getAttribute("width",!0).setValue(i),e.getAttribute("height",!0).setValue(s);var ie=e.getStyle("transform",!0,!0);ie.setValue("".concat(ie.getString()," scale(").concat(1/H,", ").concat(1/N,")"))}n||b.clearRect(0,0,k,D),e.render(b),C&&(this.isFirstRender=!1)}}X_.defaultWindow=u7,X_.defaultFetch=h7;var{defaultFetch:Owe}=X_,Uwe=typeof DOMParser<"u"?DOMParser:null;class sv{constructor(){var{fetch:e=Owe,DOMParser:t=Uwe}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fetch=e,this.DOMParser=t}parse(e){var t=this;return Kh(function*(){return e.startsWith("<")?t.parseFromString(e):t.load(e)})()}parseFromString(e){var t=new this.DOMParser;try{return this.checkDocument(t.parseFromString(e,"image/svg+xml"))}catch{return this.checkDocument(t.parseFromString(e,"text/xml"))}}checkDocument(e){var t=e.getElementsByTagName("parsererror")[0];if(t)throw new Error(t.textContent);return e}load(e){var t=this;return Kh(function*(){var n=yield t.fetch(e),i=yield n.text();return t.parseFromString(i)})()}}class A7{constructor(e,t){this.type="translate",this.point=null,this.point=Es.parse(t)}apply(e){var{x:t,y:n}=this.point;e.translate(t||0,n||0)}unapply(e){var{x:t,y:n}=this.point;e.translate(-1*t||0,-1*n||0)}applyToPoint(e){var{x:t,y:n}=this.point;e.applyTransform([1,0,0,1,t||0,n||0])}}class f7{constructor(e,t,n){this.type="rotate",this.angle=null,this.originX=null,this.originY=null,this.cx=0,this.cy=0;var i=ol(t);this.angle=new nn(e,"angle",i[0]),this.originX=n[0],this.originY=n[1],this.cx=i[1]||0,this.cy=i[2]||0}apply(e){var{cx:t,cy:n,originX:i,originY:s,angle:a}=this,o=t+i.getPixels("x"),u=n+s.getPixels("y");e.translate(o,u),e.rotate(a.getRadians()),e.translate(-o,-u)}unapply(e){var{cx:t,cy:n,originX:i,originY:s,angle:a}=this,o=t+i.getPixels("x"),u=n+s.getPixels("y");e.translate(o,u),e.rotate(-1*a.getRadians()),e.translate(-o,-u)}applyToPoint(e){var{cx:t,cy:n,angle:i}=this,s=i.getRadians();e.applyTransform([1,0,0,1,t||0,n||0]),e.applyTransform([Math.cos(s),Math.sin(s),-Math.sin(s),Math.cos(s),0,0]),e.applyTransform([1,0,0,1,-t||0,-n||0])}}class d7{constructor(e,t,n){this.type="scale",this.scale=null,this.originX=null,this.originY=null;var i=Es.parseScale(t);(i.x===0||i.y===0)&&(i.x=Pd,i.y=Pd),this.scale=i,this.originX=n[0],this.originY=n[1]}apply(e){var{scale:{x:t,y:n},originX:i,originY:s}=this,a=i.getPixels("x"),o=s.getPixels("y");e.translate(a,o),e.scale(t,n||t),e.translate(-a,-o)}unapply(e){var{scale:{x:t,y:n},originX:i,originY:s}=this,a=i.getPixels("x"),o=s.getPixels("y");e.translate(a,o),e.scale(1/t,1/n||t),e.translate(-a,-o)}applyToPoint(e){var{x:t,y:n}=this.scale;e.applyTransform([t||0,0,0,n||0,0,0])}}class z3{constructor(e,t,n){this.type="matrix",this.matrix=[],this.originX=null,this.originY=null,this.matrix=ol(t),this.originX=n[0],this.originY=n[1]}apply(e){var{originX:t,originY:n,matrix:i}=this,s=t.getPixels("x"),a=n.getPixels("y");e.translate(s,a),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),e.translate(-s,-a)}unapply(e){var{originX:t,originY:n,matrix:i}=this,s=i[0],a=i[2],o=i[4],u=i[1],d=i[3],p=i[5],b=0,C=0,w=1,M=1/(s*(d*w-p*C)-a*(u*w-p*b)+o*(u*C-d*b)),P=t.getPixels("x"),k=n.getPixels("y");e.translate(P,k),e.transform(M*(d*w-p*C),M*(p*b-u*w),M*(o*C-a*w),M*(s*w-o*b),M*(a*p-o*d),M*(o*u-s*p)),e.translate(-P,-k)}applyToPoint(e){e.applyTransform(this.matrix)}}class Q3 extends z3{constructor(e,t,n){super(e,t,n),this.type="skew",this.angle=null,this.angle=new nn(e,"angle",t)}}class p7 extends Q3{constructor(e,t,n){super(e,t,n),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class g7 extends Q3{constructor(e,t,n){super(e,t,n),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function Dwe(r){return Sd(r).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function kwe(r){var[e,t]=r.split("(");return[e.trim(),t.trim().replace(")","")]}class lf{constructor(e,t,n){this.document=e,this.transforms=[];var i=Dwe(t);i.forEach(s=>{if(s!=="none"){var[a,o]=kwe(s),u=lf.transformTypes[a];typeof u<"u"&&this.transforms.push(new u(this.document,o,n))}})}static fromElement(e,t){var n=t.getStyle("transform",!1,!0),[i,s=i]=t.getStyle("transform-origin",!1,!0).split(),a=[i,s];return n.hasValue()?new lf(e,n.getString(),a):null}apply(e){for(var{transforms:t}=this,n=t.length,i=0;i<n;i++)t[i].apply(e)}unapply(e){for(var{transforms:t}=this,n=t.length,i=n-1;i>=0;i--)t[i].unapply(e)}applyToPoint(e){for(var{transforms:t}=this,n=t.length,i=0;i<n;i++)t[i].applyToPoint(e)}}lf.transformTypes={translate:A7,rotate:f7,scale:d7,matrix:z3,skewX:p7,skewY:g7};class Hi{constructor(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this.document=e,this.node=t,this.captureTextNodes=n,this.attributes=Object.create(null),this.styles=Object.create(null),this.stylesSpecificity=Object.create(null),this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!(!t||t.nodeType!==1)){if(Array.from(t.attributes).forEach(o=>{var u=s7(o.nodeName);this.attributes[u]=new nn(e,u,o.value)}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()){var i=this.getAttribute("style").getString().split(";").map(o=>o.trim());i.forEach(o=>{if(o){var[u,d]=o.split(":").map(p=>p.trim());this.styles[u]=new nn(e,u,d)}})}var{definitions:s}=e,a=this.getAttribute("id");a.hasValue()&&(s[a.getString()]||(s[a.getString()]=this)),Array.from(t.childNodes).forEach(o=>{if(o.nodeType===1)this.addChild(o);else if(n&&(o.nodeType===3||o.nodeType===4)){var u=e.createTextNode(o);u.getText().length>0&&this.addChild(u)}})}}getAttribute(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=this.attributes[e];if(!n&&t){var i=new nn(this.document,e,"");return this.attributes[e]=i,i}return n||nn.empty(this.document)}getHrefAttribute(){for(var e in this.attributes)if(e==="href"||e.endsWith(":href"))return this.attributes[e];return nn.empty(this.document)}getStyle(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.styles[e];if(i)return i;var s=this.getAttribute(e);if(s!=null&&s.hasValue())return this.styles[e]=s,s;if(!n){var{parent:a}=this;if(a){var o=a.getStyle(e);if(o!=null&&o.hasValue())return o}}if(t){var u=new nn(this.document,e,"");return this.styles[e]=u,u}return i||nn.empty(this.document)}render(e){if(!(this.getStyle("display").getString()==="none"||this.getStyle("visibility").getString()==="hidden")){if(e.save(),this.getStyle("mask").hasValue()){var t=this.getStyle("mask").getDefinition();t&&(this.applyEffects(e),t.apply(e,this))}else if(this.getStyle("filter").getValue("none")!=="none"){var n=this.getStyle("filter").getDefinition();n&&(this.applyEffects(e),n.apply(e,this))}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}}setContext(e){}applyEffects(e){var t=lf.fromElement(this.document,this);t&&t.apply(e);var n=this.getStyle("clip-path",!1,!0);if(n.hasValue()){var i=n.getDefinition();i&&i.apply(e)}}clearContext(e){}renderChildren(e){this.children.forEach(t=>{t.render(e)})}addChild(e){var t=e instanceof Hi?e:this.document.createElement(e);t.parent=this,Hi.ignoreChildTypes.includes(t.type)||this.children.push(t)}matchesSelector(e){var t,{node:n}=this;if(typeof n.matches=="function")return n.matches(e);var i=(t=n.getAttribute)===null||t===void 0?void 0:t.call(n,"class");return!i||i===""?!1:i.split(" ").some(s=>".".concat(s)===e)}addStylesFromStyleDefinition(){var{styles:e,stylesSpecificity:t}=this.document;for(var n in e)if(!n.startsWith("@")&&this.matchesSelector(n)){var i=e[n],s=t[n];if(i)for(var a in i){var o=this.stylesSpecificity[a];typeof o>"u"&&(o="000"),s>=o&&(this.styles[a]=i[a],this.stylesSpecificity[a]=s)}}}removeStyles(e,t){var n=t.reduce((i,s)=>{var a=e.getStyle(s);if(!a.hasValue())return i;var o=a.getString();return a.setValue(""),[...i,[s,o]]},[]);return n}restoreStyles(e,t){t.forEach(n=>{var[i,s]=n;e.getStyle(i,!0).setValue(s)})}isFirstChild(){var e;return((e=this.parent)===null||e===void 0?void 0:e.children.indexOf(this))===0}}Hi.ignoreChildTypes=["title"];class m7 extends Hi{constructor(e,t,n){super(e,t,n)}}function Nwe(r){var e=r.trim();return/^('|")/.test(e)?e:'"'.concat(e,'"')}function zwe(r){return typeof process>"u"?r:r.trim().split(",").map(Nwe).join(",")}function Qwe(r){if(!r)return"";var e=r.trim().toLowerCase();switch(e){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return e;default:return/^oblique\s+(-|)\d+deg$/.test(e)?e:""}}function Hwe(r){if(!r)return"";var e=r.trim().toLowerCase();switch(e){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return e;default:return/^[\d.]+$/.test(e)?e:""}}class ga{constructor(e,t,n,i,s,a){var o=a?typeof a=="string"?ga.parse(a):a:{};this.fontFamily=s||o.fontFamily,this.fontSize=i||o.fontSize,this.fontStyle=e||o.fontStyle,this.fontWeight=n||o.fontWeight,this.fontVariant=t||o.fontVariant}static parse(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n="",i="",s="",a="",o="",u=Sd(e).trim().split(" "),d={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return u.forEach(p=>{switch(!0){case(!d.fontStyle&&ga.styles.includes(p)):p!=="inherit"&&(n=p),d.fontStyle=!0;break;case(!d.fontVariant&&ga.variants.includes(p)):p!=="inherit"&&(i=p),d.fontStyle=!0,d.fontVariant=!0;break;case(!d.fontWeight&&ga.weights.includes(p)):p!=="inherit"&&(s=p),d.fontStyle=!0,d.fontVariant=!0,d.fontWeight=!0;break;case!d.fontSize:p!=="inherit"&&([a]=p.split("/")),d.fontStyle=!0,d.fontVariant=!0,d.fontWeight=!0,d.fontSize=!0;break;default:p!=="inherit"&&(o+=p)}}),new ga(n,i,s,a,o,t)}toString(){return[Qwe(this.fontStyle),this.fontVariant,Hwe(this.fontWeight),this.fontSize,zwe(this.fontFamily)].join(" ").trim()}}ga.styles="normal|italic|oblique|inherit",ga.variants="normal|small-caps|inherit",ga.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class lc{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.NaN,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.NaN,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.NaN,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.NaN;this.x1=e,this.y1=t,this.x2=n,this.y2=i,this.addPoint(e,t),this.addPoint(n,i)}get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(e,t){typeof e<"u"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),typeof t<"u"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))}addX(e){this.addPoint(e,null)}addY(e){this.addPoint(null,e)}addBoundingBox(e){if(e){var{x1:t,y1:n,x2:i,y2:s}=e;this.addPoint(t,n),this.addPoint(i,s)}}sumCubic(e,t,n,i,s){return Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*n+3*(1-e)*Math.pow(e,2)*i+Math.pow(e,3)*s}bezierCurveAdd(e,t,n,i,s){var a=6*t-12*n+6*i,o=-3*t+9*n-9*i+3*s,u=3*n-3*t;if(o===0){if(a===0)return;var d=-u/a;0<d&&d<1&&(e?this.addX(this.sumCubic(d,t,n,i,s)):this.addY(this.sumCubic(d,t,n,i,s)));return}var p=Math.pow(a,2)-4*u*o;if(!(p<0)){var b=(-a+Math.sqrt(p))/(2*o);0<b&&b<1&&(e?this.addX(this.sumCubic(b,t,n,i,s)):this.addY(this.sumCubic(b,t,n,i,s)));var C=(-a-Math.sqrt(p))/(2*o);0<C&&C<1&&(e?this.addX(this.sumCubic(C,t,n,i,s)):this.addY(this.sumCubic(C,t,n,i,s)))}}addBezierCurve(e,t,n,i,s,a,o,u){this.addPoint(e,t),this.addPoint(o,u),this.bezierCurveAdd(!0,e,n,s,o),this.bezierCurveAdd(!1,t,i,a,u)}addQuadraticCurve(e,t,n,i,s,a){var o=e+.6666666666666666*(n-e),u=t+2/3*(i-t),d=o+1/3*(s-e),p=u+1/3*(a-t);this.addBezierCurve(e,t,o,d,u,p,s,a)}isPointInBox(e,t){var{x1:n,y1:i,x2:s,y2:a}=this;return n<=e&&e<=s&&i<=t&&t<=a}}class Sn extends lr{constructor(e){super(e.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=null,this.start=null,this.current=null,this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new Es(0,0),this.control=new Es(0,0),this.current=new Es(0,0),this.points=[],this.angles=[]}isEnd(){var{i:e,commands:t}=this;return e>=t.length-1}next(){var e=this.commands[++this.i];return this.previousCommand=this.command,this.command=e,e}getPoint(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y",n=new Es(this.command[e],this.command[t]);return this.makeAbsolute(n)}getAsControlPoint(e,t){var n=this.getPoint(e,t);return this.control=n,n}getAsCurrentPoint(e,t){var n=this.getPoint(e,t);return this.current=n,n}getReflectedControlPoint(){var e=this.previousCommand.type;if(e!==lr.CURVE_TO&&e!==lr.SMOOTH_CURVE_TO&&e!==lr.QUAD_TO&&e!==lr.SMOOTH_QUAD_TO)return this.current;var{current:{x:t,y:n},control:{x:i,y:s}}=this,a=new Es(2*t-i,2*n-s);return a}makeAbsolute(e){if(this.command.relative){var{x:t,y:n}=this.current;e.x+=t,e.y+=n}return e}addMarker(e,t,n){var{points:i,angles:s}=this;n&&s.length>0&&!s[s.length-1]&&(s[s.length-1]=i[i.length-1].angleTo(n)),this.addMarkerAngle(e,t?t.angleTo(e):null)}addMarkerAngle(e,t){this.points.push(e),this.angles.push(t)}getMarkerPoints(){return this.points}getMarkerAngles(){for(var{angles:e}=this,t=e.length,n=0;n<t;n++)if(!e[n]){for(var i=n+1;i<t;i++)if(e[i]){e[n]=e[i];break}}return e}}class cf extends Hi{constructor(){super(...arguments),this.modifiedEmSizeStack=!1}calculateOpacity(){for(var e=1,t=this;t;){var n=t.getStyle("opacity",!1,!0);n.hasValue(!0)&&(e*=n.getNumber()),t=t.parent}return e}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!t){var n=this.getStyle("fill"),i=this.getStyle("fill-opacity"),s=this.getStyle("stroke"),a=this.getStyle("stroke-opacity");if(n.isUrlDefinition()){var o=n.getFillStyleDefinition(this,i);o&&(e.fillStyle=o)}else if(n.hasValue()){n.getString()==="currentColor"&&n.setValue(this.getStyle("color").getColor());var u=n.getColor();u!=="inherit"&&(e.fillStyle=u==="none"?"rgba(0,0,0,0)":u)}if(i.hasValue()){var d=new nn(this.document,"fill",e.fillStyle).addOpacity(i).getColor();e.fillStyle=d}if(s.isUrlDefinition()){var p=s.getFillStyleDefinition(this,a);p&&(e.strokeStyle=p)}else if(s.hasValue()){s.getString()==="currentColor"&&s.setValue(this.getStyle("color").getColor());var b=s.getString();b!=="inherit"&&(e.strokeStyle=b==="none"?"rgba(0,0,0,0)":b)}if(a.hasValue()){var C=new nn(this.document,"stroke",e.strokeStyle).addOpacity(a).getString();e.strokeStyle=C}var w=this.getStyle("stroke-width");if(w.hasValue()){var M=w.getPixels();e.lineWidth=M||Pd}var P=this.getStyle("stroke-linecap"),k=this.getStyle("stroke-linejoin"),D=this.getStyle("stroke-miterlimit"),j=this.getStyle("stroke-dasharray"),H=this.getStyle("stroke-dashoffset");if(P.hasValue()&&(e.lineCap=P.getString()),k.hasValue()&&(e.lineJoin=k.getString()),D.hasValue()&&(e.miterLimit=D.getNumber()),j.hasValue()&&j.getString()!=="none"){var N=ol(j.getString());typeof e.setLineDash<"u"?e.setLineDash(N):typeof e.webkitLineDash<"u"?e.webkitLineDash=N:typeof e.mozDash<"u"&&!(N.length===1&&N[0]===0)&&(e.mozDash=N);var q=H.getPixels();typeof e.lineDashOffset<"u"?e.lineDashOffset=q:typeof e.webkitLineDashOffset<"u"?e.webkitLineDashOffset=q:typeof e.mozDashOffset<"u"&&(e.mozDashOffset=q)}}if(this.modifiedEmSizeStack=!1,typeof e.font<"u"){var W=this.getStyle("font"),ie=this.getStyle("font-style"),se=this.getStyle("font-variant"),Z=this.getStyle("font-weight"),fe=this.getStyle("font-size"),te=this.getStyle("font-family"),ce=new ga(ie.getString(),se.getString(),Z.getString(),fe.hasValue()?"".concat(fe.getPixels(!0),"px"):"",te.getString(),ga.parse(W.getString(),e.font));ie.setValue(ce.fontStyle),se.setValue(ce.fontVariant),Z.setValue(ce.fontWeight),fe.setValue(ce.fontSize),te.setValue(ce.fontFamily),e.font=ce.toString(),fe.isPixels()&&(this.document.emSize=fe.getPixels(),this.modifiedEmSizeStack=!0)}t||(this.applyEffects(e),e.globalAlpha=this.calculateOpacity())}clearContext(e){super.clearContext(e),this.modifiedEmSizeStack&&this.document.popEmSize()}}class _i extends cf{constructor(e,t,n){super(e,t,n),this.type="path",this.pathParser=null,this.pathParser=new Sn(this.getAttribute("d").getString())}path(e){var{pathParser:t}=this,n=new lc;for(t.reset(),e&&e.beginPath();!t.isEnd();)switch(t.next().type){case Sn.MOVE_TO:this.pathM(e,n);break;case Sn.LINE_TO:this.pathL(e,n);break;case Sn.HORIZ_LINE_TO:this.pathH(e,n);break;case Sn.VERT_LINE_TO:this.pathV(e,n);break;case Sn.CURVE_TO:this.pathC(e,n);break;case Sn.SMOOTH_CURVE_TO:this.pathS(e,n);break;case Sn.QUAD_TO:this.pathQ(e,n);break;case Sn.SMOOTH_QUAD_TO:this.pathT(e,n);break;case Sn.ARC:this.pathA(e,n);break;case Sn.CLOSE_PATH:this.pathZ(e,n);break}return n}getBoundingBox(e){return this.path()}getMarkers(){var{pathParser:e}=this,t=e.getMarkerPoints(),n=e.getMarkerAngles(),i=t.map((s,a)=>[s,n[a]]);return i}renderChildren(e){this.path(e),this.document.screen.mouse.checkPath(this,e);var t=this.getStyle("fill-rule");e.fillStyle!==""&&(t.getString("inherit")!=="inherit"?e.fill(t.getString()):e.fill()),e.strokeStyle!==""&&(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"?(e.save(),e.setTransform(1,0,0,1,0,0),e.stroke(),e.restore()):e.stroke());var n=this.getMarkers();if(n){var i=n.length-1,s=this.getStyle("marker-start"),a=this.getStyle("marker-mid"),o=this.getStyle("marker-end");if(s.isUrlDefinition()){var u=s.getDefinition(),[d,p]=n[0];u.render(e,d,p)}if(a.isUrlDefinition())for(var b=a.getDefinition(),C=1;C<i;C++){var[w,M]=n[C];b.render(e,w,M)}if(o.isUrlDefinition()){var P=o.getDefinition(),[k,D]=n[i];P.render(e,k,D)}}}static pathM(e){var t=e.getAsCurrentPoint();return e.start=e.current,{point:t}}pathM(e,t){var{pathParser:n}=this,{point:i}=_i.pathM(n),{x:s,y:a}=i;n.addMarker(i),t.addPoint(s,a),e&&e.moveTo(s,a)}static pathL(e){var{current:t}=e,n=e.getAsCurrentPoint();return{current:t,point:n}}pathL(e,t){var{pathParser:n}=this,{current:i,point:s}=_i.pathL(n),{x:a,y:o}=s;n.addMarker(s,i),t.addPoint(a,o),e&&e.lineTo(a,o)}static pathH(e){var{current:t,command:n}=e,i=new Es((n.relative?t.x:0)+n.x,t.y);return e.current=i,{current:t,point:i}}pathH(e,t){var{pathParser:n}=this,{current:i,point:s}=_i.pathH(n),{x:a,y:o}=s;n.addMarker(s,i),t.addPoint(a,o),e&&e.lineTo(a,o)}static pathV(e){var{current:t,command:n}=e,i=new Es(t.x,(n.relative?t.y:0)+n.y);return e.current=i,{current:t,point:i}}pathV(e,t){var{pathParser:n}=this,{current:i,point:s}=_i.pathV(n),{x:a,y:o}=s;n.addMarker(s,i),t.addPoint(a,o),e&&e.lineTo(a,o)}static pathC(e){var{current:t}=e,n=e.getPoint("x1","y1"),i=e.getAsControlPoint("x2","y2"),s=e.getAsCurrentPoint();return{current:t,point:n,controlPoint:i,currentPoint:s}}pathC(e,t){var{pathParser:n}=this,{current:i,point:s,controlPoint:a,currentPoint:o}=_i.pathC(n);n.addMarker(o,a,s),t.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,o.x,o.y),e&&e.bezierCurveTo(s.x,s.y,a.x,a.y,o.x,o.y)}static pathS(e){var{current:t}=e,n=e.getReflectedControlPoint(),i=e.getAsControlPoint("x2","y2"),s=e.getAsCurrentPoint();return{current:t,point:n,controlPoint:i,currentPoint:s}}pathS(e,t){var{pathParser:n}=this,{current:i,point:s,controlPoint:a,currentPoint:o}=_i.pathS(n);n.addMarker(o,a,s),t.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,o.x,o.y),e&&e.bezierCurveTo(s.x,s.y,a.x,a.y,o.x,o.y)}static pathQ(e){var{current:t}=e,n=e.getAsControlPoint("x1","y1"),i=e.getAsCurrentPoint();return{current:t,controlPoint:n,currentPoint:i}}pathQ(e,t){var{pathParser:n}=this,{current:i,controlPoint:s,currentPoint:a}=_i.pathQ(n);n.addMarker(a,s,s),t.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),e&&e.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathT(e){var{current:t}=e,n=e.getReflectedControlPoint();e.control=n;var i=e.getAsCurrentPoint();return{current:t,controlPoint:n,currentPoint:i}}pathT(e,t){var{pathParser:n}=this,{current:i,controlPoint:s,currentPoint:a}=_i.pathT(n);n.addMarker(a,s,s),t.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),e&&e.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathA(e){var{current:t,command:n}=e,{rX:i,rY:s,xRot:a,lArcFlag:o,sweepFlag:u}=n,d=a*(Math.PI/180),p=e.getAsCurrentPoint(),b=new Es(Math.cos(d)*(t.x-p.x)/2+Math.sin(d)*(t.y-p.y)/2,-Math.sin(d)*(t.x-p.x)/2+Math.cos(d)*(t.y-p.y)/2),C=Math.pow(b.x,2)/Math.pow(i,2)+Math.pow(b.y,2)/Math.pow(s,2);C>1&&(i*=Math.sqrt(C),s*=Math.sqrt(C));var w=(o===u?-1:1)*Math.sqrt((Math.pow(i,2)*Math.pow(s,2)-Math.pow(i,2)*Math.pow(b.y,2)-Math.pow(s,2)*Math.pow(b.x,2))/(Math.pow(i,2)*Math.pow(b.y,2)+Math.pow(s,2)*Math.pow(b.x,2)));isNaN(w)&&(w=0);var M=new Es(w*i*b.y/s,w*-s*b.x/i),P=new Es((t.x+p.x)/2+Math.cos(d)*M.x-Math.sin(d)*M.y,(t.y+p.y)/2+Math.sin(d)*M.x+Math.cos(d)*M.y),k=F3([1,0],[(b.x-M.x)/i,(b.y-M.y)/s]),D=[(b.x-M.x)/i,(b.y-M.y)/s],j=[(-b.x-M.x)/i,(-b.y-M.y)/s],H=F3(D,j);return iv(D,j)<=-1&&(H=Math.PI),iv(D,j)>=1&&(H=0),{currentPoint:p,rX:i,rY:s,sweepFlag:u,xAxisRotation:d,centp:P,a1:k,ad:H}}pathA(e,t){var{pathParser:n}=this,{currentPoint:i,rX:s,rY:a,sweepFlag:o,xAxisRotation:u,centp:d,a1:p,ad:b}=_i.pathA(n),C=1-o?1:-1,w=p+C*(b/2),M=new Es(d.x+s*Math.cos(w),d.y+a*Math.sin(w));if(n.addMarkerAngle(M,w-C*Math.PI/2),n.addMarkerAngle(i,w-C*Math.PI),t.addPoint(i.x,i.y),e&&!isNaN(p)&&!isNaN(b)){var P=s>a?s:a,k=s>a?1:s/a,D=s>a?a/s:1;e.translate(d.x,d.y),e.rotate(u),e.scale(k,D),e.arc(0,0,P,p,p+b,!!(1-o)),e.scale(1/k,1/D),e.rotate(-u),e.translate(-d.x,-d.y)}}static pathZ(e){e.current=e.start}pathZ(e,t){_i.pathZ(this.pathParser),e&&t.x1!==t.x2&&t.y1!==t.y2&&e.closePath()}}class H3 extends _i{constructor(e,t,n){super(e,t,n),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}}class Yh extends cf{constructor(e,t,n){super(e,t,new.target===Yh?!0:n),this.type="text",this.x=0,this.y=0,this.measureCache=-1}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.setContext(e,t);var n=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();n&&(e.textBaseline=n)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(e){if(this.type!=="text")return this.getTElementBoundingBox(e);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e);var t=null;return this.children.forEach((n,i)=>{var s=this.getChildBoundingBox(e,this,this,i);t?t.addBoundingBox(s):t=s}),t}getFontSize(){var{document:e,parent:t}=this,n=ga.parse(e.ctx.font).fontSize,i=t.getStyle("font-size").getNumber(n);return i}getTElementBoundingBox(e){var t=this.getFontSize();return new lc(this.x,this.y-t,this.x+this.measureText(e),this.y)}getGlyph(e,t,n){var i=t[n],s=null;if(e.isArabic){var a=t.length,o=t[n-1],u=t[n+1],d="isolated";if((n===0||o===" ")&&n<a-1&&u!==" "&&(d="terminal"),n>0&&o!==" "&&n<a-1&&u!==" "&&(d="medial"),n>0&&o!==" "&&(n===a-1||u===" ")&&(d="initial"),typeof e.glyphs[i]<"u"){var p=e.glyphs[i];s=p instanceof H3?p:p[d]}}else s=e.glyphs[i];return s||(s=e.missingGlyph),s}getText(){return""}getTextFromNode(e){var t=e||this.node,n=Array.from(t.parentNode.childNodes),i=n.indexOf(t),s=n.length-1,a=Sd(t.textContent||"");return i===0&&(a=n7(a)),i===s&&(a=i7(a)),a}renderChildren(e){if(this.type!=="text"){this.renderTElementChildren(e);return}this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e),this.children.forEach((n,i)=>{this.renderChild(e,this,this,i)});var{mouse:t}=this.document.screen;t.isWorking()&&t.checkBoundingBox(this,this.getBoundingBox(e))}renderTElementChildren(e){var{document:t,parent:n}=this,i=this.getText(),s=n.getStyle("font-family").getDefinition();if(s){for(var{unitsPerEm:a}=s.fontFace,o=ga.parse(t.ctx.font),u=n.getStyle("font-size").getNumber(o.fontSize),d=n.getStyle("font-style").getString(o.fontStyle),p=u/a,b=s.isRTL?i.split("").reverse().join(""):i,C=ol(n.getAttribute("dx").getString()),w=b.length,M=0;M<w;M++){var P=this.getGlyph(s,b,M);e.translate(this.x,this.y),e.scale(p,-p);var k=e.lineWidth;e.lineWidth=e.lineWidth*a/u,d==="italic"&&e.transform(1,0,.4,1,0,0),P.render(e),d==="italic"&&e.transform(1,0,-.4,1,0,0),e.lineWidth=k,e.scale(1/p,-1/p),e.translate(-this.x,-this.y),this.x+=u*(P.horizAdvX||s.horizAdvX)/a,typeof C[M]<"u"&&!isNaN(C[M])&&(this.x+=C[M])}return}var{x:D,y:j}=this;e.fillStyle&&e.fillText(i,D,j),e.strokeStyle&&e.strokeText(i,D,j)}applyAnchoring(){if(!(this.textChunkStart>=this.leafTexts.length)){var e=this.leafTexts[this.textChunkStart],t=e.getStyle("text-anchor").getString("start"),n=!1,i=0;t==="start"&&!n||t==="end"&&n?i=e.x-this.minX:t==="end"&&!n||t==="start"&&n?i=e.x-this.maxX:i=e.x-(this.minX+this.maxX)/2;for(var s=this.textChunkStart;s<this.leafTexts.length;s++)this.leafTexts[s].x+=i;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}}adjustChildCoordinatesRecursive(e){this.children.forEach((t,n)=>{this.adjustChildCoordinatesRecursiveCore(e,this,this,n)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(e,t,n,i){var s=n.children[i];s.children.length>0?s.children.forEach((a,o)=>{t.adjustChildCoordinatesRecursiveCore(e,t,s,o)}):this.adjustChildCoordinates(e,t,n,i)}adjustChildCoordinates(e,t,n,i){var s=n.children[i];if(typeof s.measureText!="function")return s;e.save(),s.setContext(e,!0);var a=s.getAttribute("x"),o=s.getAttribute("y"),u=s.getAttribute("dx"),d=s.getAttribute("dy"),p=s.getStyle("font-family").getDefinition(),b=!!p&&p.isRTL;i===0&&(a.hasValue()||a.setValue(s.getInheritedAttribute("x")),o.hasValue()||o.setValue(s.getInheritedAttribute("y")),u.hasValue()||u.setValue(s.getInheritedAttribute("dx")),d.hasValue()||d.setValue(s.getInheritedAttribute("dy")));var C=s.measureText(e);return b&&(t.x-=C),a.hasValue()?(t.applyAnchoring(),s.x=a.getPixels("x"),u.hasValue()&&(s.x+=u.getPixels("x"))):(u.hasValue()&&(t.x+=u.getPixels("x")),s.x=t.x),t.x=s.x,b||(t.x+=C),o.hasValue()?(s.y=o.getPixels("y"),d.hasValue()&&(s.y+=d.getPixels("y"))):(d.hasValue()&&(t.y+=d.getPixels("y")),s.y=t.y),t.y=s.y,t.leafTexts.push(s),t.minX=Math.min(t.minX,s.x,s.x+C),t.maxX=Math.max(t.maxX,s.x,s.x+C),s.clearContext(e),e.restore(),s}getChildBoundingBox(e,t,n,i){var s=n.children[i];if(typeof s.getBoundingBox!="function")return null;var a=s.getBoundingBox(e);return a?(s.children.forEach((o,u)=>{var d=t.getChildBoundingBox(e,t,s,u);a.addBoundingBox(d)}),a):null}renderChild(e,t,n,i){var s=n.children[i];s.render(e),s.children.forEach((a,o)=>{t.renderChild(e,t,s,o)})}measureText(e){var{measureCache:t}=this;if(~t)return t;var n=this.getText(),i=this.measureTargetText(e,n);return this.measureCache=i,i}measureTargetText(e,t){if(!t.length)return 0;var{parent:n}=this,i=n.getStyle("font-family").getDefinition();if(i){for(var s=this.getFontSize(),a=i.isRTL?t.split("").reverse().join(""):t,o=ol(n.getAttribute("dx").getString()),u=a.length,d=0,p=0;p<u;p++){var b=this.getGlyph(i,a,p);d+=(b.horizAdvX||i.horizAdvX)*s/i.fontFace.unitsPerEm,typeof o[p]<"u"&&!isNaN(o[p])&&(d+=o[p])}return d}if(!e.measureText)return t.length*10;e.save(),this.setContext(e,!0);var{width:C}=e.measureText(t);return this.clearContext(e),e.restore(),C}getInheritedAttribute(e){for(var t=this;t instanceof Yh&&t.isFirstChild();){var n=t.parent.getAttribute(e);if(n.hasValue(!0))return n.getValue("0");t=t.parent}return null}}class Y_ extends Yh{constructor(e,t,n){super(e,t,new.target===Y_?!0:n),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}getText(){return this.text}}class Vwe extends Y_{constructor(){super(...arguments),this.type="textNode"}}class Tg extends cf{constructor(){super(...arguments),this.type="svg",this.root=!1}setContext(e){var t,{document:n}=this,{screen:i,window:s}=n,a=e.canvas;if(i.setDefaults(e),a.style&&typeof e.font<"u"&&s&&typeof s.getComputedStyle<"u"){e.font=s.getComputedStyle(a).getPropertyValue("font");var o=new nn(n,"fontSize",ga.parse(e.font).fontSize);o.hasValue()&&(n.rootEmSize=o.getPixels("y"),n.emSize=n.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);var{width:u,height:d}=i.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");var p=this.getAttribute("refX"),b=this.getAttribute("refY"),C=this.getAttribute("viewBox"),w=C.hasValue()?ol(C.getString()):null,M=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible",P=0,k=0,D=0,j=0;w&&(P=w[0],k=w[1]),this.root||(u=this.getStyle("width").getPixels("x"),d=this.getStyle("height").getPixels("y"),this.type==="marker"&&(D=P,j=k,P=0,k=0)),i.viewPort.setCurrent(u,d),this.node&&(!this.parent||((t=this.node.parentNode)===null||t===void 0?void 0:t.nodeName)==="foreignObject")&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(e),e.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),w&&(u=w[2],d=w[3]),n.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:i.viewPort.width,desiredWidth:u,height:i.viewPort.height,desiredHeight:d,minX:P,minY:k,refX:p.getValue(),refY:b.getValue(),clip:M,clipX:D,clipY:j}),w&&(i.viewPort.removeCurrent(),i.viewPort.setCurrent(u,d))}clearContext(e){super.clearContext(e),this.document.screen.viewPort.removeCurrent()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.getAttribute("width",!0),s=this.getAttribute("height",!0),a=this.getAttribute("viewBox"),o=this.getAttribute("style"),u=i.getNumber(0),d=s.getNumber(0);if(n)if(typeof n=="string")this.getAttribute("preserveAspectRatio",!0).setValue(n);else{var p=this.getAttribute("preserveAspectRatio");p.hasValue()&&p.setValue(p.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(i.setValue(e),s.setValue(t),a.hasValue()||a.setValue("0 0 ".concat(u||e," ").concat(d||t)),o.hasValue()){var b=this.getStyle("width"),C=this.getStyle("height");b.hasValue()&&b.setValue("".concat(e,"px")),C.hasValue()&&C.setValue("".concat(t,"px"))}}}class V3 extends _i{constructor(){super(...arguments),this.type="rect"}path(e){var t=this.getAttribute("x").getPixels("x"),n=this.getAttribute("y").getPixels("y"),i=this.getStyle("width",!1,!0).getPixels("x"),s=this.getStyle("height",!1,!0).getPixels("y"),a=this.getAttribute("rx"),o=this.getAttribute("ry"),u=a.getPixels("x"),d=o.getPixels("y");if(a.hasValue()&&!o.hasValue()&&(d=u),o.hasValue()&&!a.hasValue()&&(u=d),u=Math.min(u,i/2),d=Math.min(d,s/2),e){var p=4*((Math.sqrt(2)-1)/3);e.beginPath(),s>0&&i>0&&(e.moveTo(t+u,n),e.lineTo(t+i-u,n),e.bezierCurveTo(t+i-u+p*u,n,t+i,n+d-p*d,t+i,n+d),e.lineTo(t+i,n+s-d),e.bezierCurveTo(t+i,n+s-d+p*d,t+i-u+p*u,n+s,t+i-u,n+s),e.lineTo(t+u,n+s),e.bezierCurveTo(t+u-p*u,n+s,t,n+s-d+p*d,t,n+s-d),e.lineTo(t,n+d),e.bezierCurveTo(t,n+d-p*d,t+u-p*u,n,t+u,n),e.closePath())}return new lc(t,n,t+i,n+s)}getMarkers(){return null}}class _7 extends _i{constructor(){super(...arguments),this.type="circle"}path(e){var t=this.getAttribute("cx").getPixels("x"),n=this.getAttribute("cy").getPixels("y"),i=this.getAttribute("r").getPixels();return e&&i>0&&(e.beginPath(),e.arc(t,n,i,0,Math.PI*2,!1),e.closePath()),new lc(t-i,n-i,t+i,n+i)}getMarkers(){return null}}class y7 extends _i{constructor(){super(...arguments),this.type="ellipse"}path(e){var t=4*((Math.sqrt(2)-1)/3),n=this.getAttribute("rx").getPixels("x"),i=this.getAttribute("ry").getPixels("y"),s=this.getAttribute("cx").getPixels("x"),a=this.getAttribute("cy").getPixels("y");return e&&n>0&&i>0&&(e.beginPath(),e.moveTo(s+n,a),e.bezierCurveTo(s+n,a+t*i,s+t*n,a+i,s,a+i),e.bezierCurveTo(s-t*n,a+i,s-n,a+t*i,s-n,a),e.bezierCurveTo(s-n,a-t*i,s-t*n,a-i,s,a-i),e.bezierCurveTo(s+t*n,a-i,s+n,a-t*i,s+n,a),e.closePath()),new lc(s-n,a-i,s+n,a+i)}getMarkers(){return null}}class b7 extends _i{constructor(){super(...arguments),this.type="line"}getPoints(){return[new Es(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new Es(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(e){var[{x:t,y:n},{x:i,y:s}]=this.getPoints();return e&&(e.beginPath(),e.moveTo(t,n),e.lineTo(i,s)),new lc(t,n,i,s)}getMarkers(){var[e,t]=this.getPoints(),n=e.angleTo(t);return[[e,n],[t,n]]}}class j3 extends _i{constructor(e,t,n){super(e,t,n),this.type="polyline",this.points=[],this.points=Es.parsePath(this.getAttribute("points").getString())}path(e){var{points:t}=this,[{x:n,y:i}]=t,s=new lc(n,i);return e&&(e.beginPath(),e.moveTo(n,i)),t.forEach(a=>{var{x:o,y:u}=a;s.addPoint(o,u),e&&e.lineTo(o,u)}),s}getMarkers(){var{points:e}=this,t=e.length-1,n=[];return e.forEach((i,s)=>{s!==t&&n.push([i,i.angleTo(e[s+1])])}),n.length>0&&n.push([e[e.length-1],n[n.length-1][1]]),n}}class v7 extends j3{constructor(){super(...arguments),this.type="polygon"}path(e){var t=super.path(e),[{x:n,y:i}]=this.points;return e&&(e.lineTo(n,i),e.closePath()),t}}class w7 extends Hi{constructor(){super(...arguments),this.type="pattern"}createPattern(e,t,n){var i=this.getStyle("width").getPixels("x",!0),s=this.getStyle("height").getPixels("y",!0),a=new Tg(this.document,null);a.attributes.viewBox=new nn(this.document,"viewBox",this.getAttribute("viewBox").getValue()),a.attributes.width=new nn(this.document,"width","".concat(i,"px")),a.attributes.height=new nn(this.document,"height","".concat(s,"px")),a.attributes.transform=new nn(this.document,"transform",this.getAttribute("patternTransform").getValue()),a.children=this.children;var o=this.document.createCanvas(i,s),u=o.getContext("2d"),d=this.getAttribute("x"),p=this.getAttribute("y");d.hasValue()&&p.hasValue()&&u.translate(d.getPixels("x",!0),p.getPixels("y",!0)),n.hasValue()?this.styles["fill-opacity"]=n:Reflect.deleteProperty(this.styles,"fill-opacity");for(var b=-1;b<=1;b++)for(var C=-1;C<=1;C++)u.save(),a.attributes.x=new nn(this.document,"x",b*o.width),a.attributes.y=new nn(this.document,"y",C*o.height),a.render(u),u.restore();var w=e.createPattern(o,"repeat");return w}}class x7 extends Hi{constructor(){super(...arguments),this.type="marker"}render(e,t,n){if(t){var{x:i,y:s}=t,a=this.getAttribute("orient").getString("auto"),o=this.getAttribute("markerUnits").getString("strokeWidth");e.translate(i,s),a==="auto"&&e.rotate(n),o==="strokeWidth"&&e.scale(e.lineWidth,e.lineWidth),e.save();var u=new Tg(this.document,null);u.type=this.type,u.attributes.viewBox=new nn(this.document,"viewBox",this.getAttribute("viewBox").getValue()),u.attributes.refX=new nn(this.document,"refX",this.getAttribute("refX").getValue()),u.attributes.refY=new nn(this.document,"refY",this.getAttribute("refY").getValue()),u.attributes.width=new nn(this.document,"width",this.getAttribute("markerWidth").getValue()),u.attributes.height=new nn(this.document,"height",this.getAttribute("markerHeight").getValue()),u.attributes.overflow=new nn(this.document,"overflow",this.getAttribute("overflow").getValue()),u.attributes.fill=new nn(this.document,"fill",this.getAttribute("fill").getColor("black")),u.attributes.stroke=new nn(this.document,"stroke",this.getAttribute("stroke").getValue("none")),u.children=this.children,u.render(e),e.restore(),o==="strokeWidth"&&e.scale(1/e.lineWidth,1/e.lineWidth),a==="auto"&&e.rotate(-n),e.translate(-i,-s)}}}class B7 extends Hi{constructor(){super(...arguments),this.type="defs"}render(){}}class ov extends cf{constructor(){super(...arguments),this.type="g"}getBoundingBox(e){var t=new lc;return this.children.forEach(n=>{t.addBoundingBox(n.getBoundingBox(e))}),t}}class $3 extends Hi{constructor(e,t,n){super(e,t,n),this.attributesToInherit=["gradientUnits"],this.stops=[];var{stops:i,children:s}=this;s.forEach(a=>{a.type==="stop"&&i.push(a)})}getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(e,t,n){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(i));var{stops:s}=i,a=this.getGradient(e,t);if(!a)return this.addParentOpacity(n,s[s.length-1].color);if(s.forEach(k=>{a.addColorStop(k.offset,this.addParentOpacity(n,k.color))}),this.getAttribute("gradientTransform").hasValue()){var{document:o}=this,{MAX_VIRTUAL_PIXELS:u,viewPort:d}=o.screen,[p]=d.viewPorts,b=new V3(o,null);b.attributes.x=new nn(o,"x",-u/3),b.attributes.y=new nn(o,"y",-u/3),b.attributes.width=new nn(o,"width",u),b.attributes.height=new nn(o,"height",u);var C=new ov(o,null);C.attributes.transform=new nn(o,"transform",this.getAttribute("gradientTransform").getValue()),C.children=[b];var w=new Tg(o,null);w.attributes.x=new nn(o,"x",0),w.attributes.y=new nn(o,"y",0),w.attributes.width=new nn(o,"width",p.width),w.attributes.height=new nn(o,"height",p.height),w.children=[C];var M=o.createCanvas(p.width,p.height),P=M.getContext("2d");return P.fillStyle=a,w.render(P),P.createPattern(M,"no-repeat")}return a}inheritStopContainer(e){this.attributesToInherit.forEach(t=>{!this.getAttribute(t).hasValue()&&e.getAttribute(t).hasValue()&&this.getAttribute(t,!0).setValue(e.getAttribute(t).getValue())})}addParentOpacity(e,t){if(e.hasValue()){var n=new nn(this.document,"color",t);return n.addOpacity(e).getColor()}return t}}class C7 extends $3{constructor(e,t,n){super(e,t,n),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}getGradient(e,t){var n=this.getGradientUnits()==="objectBoundingBox",i=n?t.getBoundingBox(e):null;if(n&&!i)return null;!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()&&(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));var s=n?i.x+i.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),a=n?i.y+i.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),o=n?i.x+i.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),u=n?i.y+i.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return s===o&&a===u?null:e.createLinearGradient(s,a,o,u)}}class T7 extends $3{constructor(e,t,n){super(e,t,n),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}getGradient(e,t){var n=this.getGradientUnits()==="objectBoundingBox",i=t.getBoundingBox(e);if(n&&!i)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");var s=n?i.x+i.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),a=n?i.y+i.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y"),o=s,u=a;this.getAttribute("fx").hasValue()&&(o=n?i.x+i.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(u=n?i.y+i.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));var d=n?(i.width+i.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),p=this.getAttribute("fr").getPixels();return e.createRadialGradient(o,u,p,s,a,d)}}class E7 extends Hi{constructor(e,t,n){super(e,t,n),this.type="stop";var i=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),s=this.getStyle("stop-opacity"),a=this.getStyle("stop-color",!0);a.getString()===""&&a.setValue("#000"),s.hasValue()&&(a=a.addOpacity(s)),this.offset=i,this.color=a.getColor()}}class av extends Hi{constructor(e,t,n){super(e,t,n),this.type="animate",this.duration=0,this.initialValue=null,this.initialUnits="",this.removed=!1,this.frozen=!1,e.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new nn(e,"values",null);var i=this.getAttribute("values");i.hasValue()&&this.values.setValue(i.getString().split(";"))}getProperty(){var e=this.getAttribute("attributeType").getString(),t=this.getAttribute("attributeName").getString();return e==="CSS"?this.parent.getStyle(t,!0):this.parent.getAttribute(t,!0)}calcValue(){var{initialUnits:e}=this,{progress:t,from:n,to:i}=this.getProgress(),s=n.getNumber()+(i.getNumber()-n.getNumber())*t;return e==="%"&&(s*=100),"".concat(s).concat(e)}update(e){var{parent:t}=this,n=this.getProperty();if(this.initialValue||(this.initialValue=n.getString(),this.initialUnits=n.getUnits()),this.duration>this.maxDuration){var i=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(i==="freeze"&&!this.frozen)this.frozen=!0,t.animationFrozen=!0,t.animationFrozenValue=n.getString();else if(i==="remove"&&!this.removed)return this.removed=!0,n.setValue(t.animationFrozen?t.animationFrozenValue:this.initialValue),!0;return!1}this.duration+=e;var s=!1;if(this.begin<this.duration){var a=this.calcValue(),o=this.getAttribute("type");if(o.hasValue()){var u=o.getString();a="".concat(u,"(").concat(a,")")}n.setValue(a),s=!0}return s}getProgress(){var{document:e,values:t}=this,n={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(t.hasValue()){var i=n.progress*(t.getValue().length-1),s=Math.floor(i),a=Math.ceil(i);n.from=new nn(e,"from",parseFloat(t.getValue()[s])),n.to=new nn(e,"to",parseFloat(t.getValue()[a])),n.progress=(i-s)/(a-s)}else n.from=this.from,n.to=this.to;return n}}class S7 extends av{constructor(){super(...arguments),this.type="animateColor"}calcValue(){var{progress:e,from:t,to:n}=this.getProgress(),i=new T3(t.getColor()),s=new T3(n.getColor());if(i.ok&&s.ok){var a=i.r+(s.r-i.r)*e,o=i.g+(s.g-i.g)*e,u=i.b+(s.b-i.b)*e;return"rgb(".concat(Math.floor(a),", ").concat(Math.floor(o),", ").concat(Math.floor(u),")")}return this.getAttribute("from").getColor()}}class I7 extends av{constructor(){super(...arguments),this.type="animateTransform"}calcValue(){var{progress:e,from:t,to:n}=this.getProgress(),i=ol(t.getString()),s=ol(n.getString()),a=i.map((o,u)=>{var d=s[u];return o+(d-o)*e}).join(" ");return a}}class P7 extends Hi{constructor(e,t,n){super(e,t,n),this.type="font",this.glyphs=Object.create(null),this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();var{definitions:i}=e,{children:s}=this;for(var a of s)switch(a.type){case"font-face":{this.fontFace=a;var o=a.getStyle("font-family");o.hasValue()&&(i[o.getString()]=this);break}case"missing-glyph":this.missingGlyph=a;break;case"glyph":{var u=a;u.arabicForm?(this.isRTL=!0,this.isArabic=!0,typeof this.glyphs[u.unicode]>"u"&&(this.glyphs[u.unicode]=Object.create(null)),this.glyphs[u.unicode][u.arabicForm]=u):this.glyphs[u.unicode]=u;break}}}render(){}}class M7 extends Hi{constructor(e,t,n){super(e,t,n),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class F7 extends _i{constructor(){super(...arguments),this.type="missing-glyph",this.horizAdvX=0}}class R7 extends Yh{constructor(){super(...arguments),this.type="tref"}getText(){var e=this.getHrefAttribute().getDefinition();if(e){var t=e.children[0];if(t)return t.getText()}return""}}class L7 extends Yh{constructor(e,t,n){super(e,t,n),this.type="a";var{childNodes:i}=t,s=i[0],a=i.length>0&&Array.from(i).every(o=>o.nodeType===3);this.hasText=a,this.text=a?this.getTextFromNode(s):""}getText(){return this.text}renderChildren(e){if(this.hasText){super.renderChildren(e);var{document:t,x:n,y:i}=this,{mouse:s}=t.screen,a=new nn(t,"fontSize",ga.parse(t.ctx.font).fontSize);s.isWorking()&&s.checkBoundingBox(this,new lc(n,i-a.getPixels("y"),n+this.measureText(e),i))}else if(this.children.length>0){var o=new ov(this.document,null);o.children=this.children,o.parent=this,o.render(e)}}onClick(){var{window:e}=this.document;e&&e.open(this.getHrefAttribute().getString())}onMouseMove(){var e=this.document.ctx;e.canvas.style.cursor="pointer"}}function O7(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function lv(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?O7(Object(t),!0).forEach(function(n){b3(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):O7(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}class U7 extends Yh{constructor(e,t,n){super(e,t,n),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);var i=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(i)}getText(){return this.text}path(e){var{dataArray:t}=this;e&&e.beginPath(),t.forEach(n=>{var{type:i,points:s}=n;switch(i){case Sn.LINE_TO:e&&e.lineTo(s[0],s[1]);break;case Sn.MOVE_TO:e&&e.moveTo(s[0],s[1]);break;case Sn.CURVE_TO:e&&e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case Sn.QUAD_TO:e&&e.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case Sn.ARC:{var[a,o,u,d,p,b,C,w]=s,M=u>d?u:d,P=u>d?1:u/d,k=u>d?d/u:1;e&&(e.translate(a,o),e.rotate(C),e.scale(P,k),e.arc(0,0,M,p,p+b,!!(1-w)),e.scale(1/P,1/k),e.rotate(-C),e.translate(-a,-o));break}case Sn.CLOSE_PATH:e&&e.closePath();break}})}renderChildren(e){this.setTextData(e),e.save();var t=this.parent.getStyle("text-decoration").getString(),n=this.getFontSize(),{glyphInfo:i}=this,s=e.fillStyle;t==="underline"&&e.beginPath(),i.forEach((a,o)=>{var{p0:u,p1:d,rotation:p,text:b}=a;e.save(),e.translate(u.x,u.y),e.rotate(p),e.fillStyle&&e.fillText(b,0,0),e.strokeStyle&&e.strokeText(b,0,0),e.restore(),t==="underline"&&(o===0&&e.moveTo(u.x,u.y+n/8),e.lineTo(d.x,d.y+n/5))}),t==="underline"&&(e.lineWidth=n/20,e.strokeStyle=s,e.stroke(),e.closePath()),e.restore()}getLetterSpacingAt(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[e]||0}findSegmentToFitChar(e,t,n,i,s,a,o,u,d){var p=a,b=this.measureText(e,u);u===" "&&t==="justify"&&n<i&&(b+=(i-n)/s),d>-1&&(p+=this.getLetterSpacingAt(d));var C=this.textHeight/20,w=this.getEquidistantPointOnPath(p,C,0),M=this.getEquidistantPointOnPath(p+b,C,0),P={p0:w,p1:M},k=w&&M?Math.atan2(M.y-w.y,M.x-w.x):0;if(o){var D=Math.cos(Math.PI/2+k)*o,j=Math.cos(-k)*o;P.p0=lv(lv({},w),{},{x:w.x+D,y:w.y+j}),P.p1=lv(lv({},M),{},{x:M.x+D,y:M.y+j})}return p+=b,{offset:p,segment:P,rotation:k}}measureText(e,t){var{measuresCache:n}=this,i=t||this.getText();if(n.has(i))return n.get(i);var s=this.measureTargetText(e,i);return n.set(i,s),s}setTextData(e){if(!this.glyphInfo){var t=this.getText(),n=t.split(""),i=t.split(" ").length-1,s=this.parent.getAttribute("dx").split().map(N=>N.getPixels("x")),a=this.parent.getAttribute("dy").getPixels("y"),o=this.parent.getStyle("text-anchor").getString("start"),u=this.getStyle("letter-spacing"),d=this.parent.getStyle("letter-spacing"),p=0;!u.hasValue()||u.getValue()==="inherit"?p=d.getPixels():u.hasValue()&&u.getValue()!=="initial"&&u.getValue()!=="unset"&&(p=u.getPixels());var b=[],C=t.length;this.letterSpacingCache=b;for(var w=0;w<C;w++)b.push(typeof s[w]<"u"?s[w]:p);var M=b.reduce((N,q,W)=>W===0?0:N+q||0,0),P=this.measureText(e),k=Math.max(P+M,0);this.textWidth=P,this.textHeight=this.getFontSize(),this.glyphInfo=[];var D=this.getPathLength(),j=this.getStyle("startOffset").getNumber(0)*D,H=0;(o==="middle"||o==="center")&&(H=-k/2),(o==="end"||o==="right")&&(H=-k),H+=j,n.forEach((N,q)=>{var{offset:W,segment:ie,rotation:se}=this.findSegmentToFitChar(e,o,k,D,i,H,a,N,q);H=W,!(!ie.p0||!ie.p1)&&this.glyphInfo.push({text:n[q],p0:ie.p0,p1:ie.p1,rotation:se})})}}parsePathData(e){if(this.pathLength=-1,!e)return[];var t=[],{pathParser:n}=e;for(n.reset();!n.isEnd();){var{current:i}=n,s=i?i.x:0,a=i?i.y:0,o=n.next(),u=o.type,d=[];switch(o.type){case Sn.MOVE_TO:this.pathM(n,d);break;case Sn.LINE_TO:u=this.pathL(n,d);break;case Sn.HORIZ_LINE_TO:u=this.pathH(n,d);break;case Sn.VERT_LINE_TO:u=this.pathV(n,d);break;case Sn.CURVE_TO:this.pathC(n,d);break;case Sn.SMOOTH_CURVE_TO:u=this.pathS(n,d);break;case Sn.QUAD_TO:this.pathQ(n,d);break;case Sn.SMOOTH_QUAD_TO:u=this.pathT(n,d);break;case Sn.ARC:d=this.pathA(n);break;case Sn.CLOSE_PATH:_i.pathZ(n);break}o.type!==Sn.CLOSE_PATH?t.push({type:u,points:d,start:{x:s,y:a},pathLength:this.calcLength(s,a,u,d)}):t.push({type:Sn.CLOSE_PATH,points:[],pathLength:0})}return t}pathM(e,t){var{x:n,y:i}=_i.pathM(e).point;t.push(n,i)}pathL(e,t){var{x:n,y:i}=_i.pathL(e).point;return t.push(n,i),Sn.LINE_TO}pathH(e,t){var{x:n,y:i}=_i.pathH(e).point;return t.push(n,i),Sn.LINE_TO}pathV(e,t){var{x:n,y:i}=_i.pathV(e).point;return t.push(n,i),Sn.LINE_TO}pathC(e,t){var{point:n,controlPoint:i,currentPoint:s}=_i.pathC(e);t.push(n.x,n.y,i.x,i.y,s.x,s.y)}pathS(e,t){var{point:n,controlPoint:i,currentPoint:s}=_i.pathS(e);return t.push(n.x,n.y,i.x,i.y,s.x,s.y),Sn.CURVE_TO}pathQ(e,t){var{controlPoint:n,currentPoint:i}=_i.pathQ(e);t.push(n.x,n.y,i.x,i.y)}pathT(e,t){var{controlPoint:n,currentPoint:i}=_i.pathT(e);return t.push(n.x,n.y,i.x,i.y),Sn.QUAD_TO}pathA(e){var{rX:t,rY:n,sweepFlag:i,xAxisRotation:s,centp:a,a1:o,ad:u}=_i.pathA(e);return i===0&&u>0&&(u-=2*Math.PI),i===1&&u<0&&(u+=2*Math.PI),[a.x,a.y,t,n,o,u,s,i]}calcLength(e,t,n,i){var s=0,a=null,o=null,u=0;switch(n){case Sn.LINE_TO:return this.getLineLength(e,t,i[0],i[1]);case Sn.CURVE_TO:for(s=0,a=this.getPointOnCubicBezier(0,e,t,i[0],i[1],i[2],i[3],i[4],i[5]),u=.01;u<=1;u+=.01)o=this.getPointOnCubicBezier(u,e,t,i[0],i[1],i[2],i[3],i[4],i[5]),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return s;case Sn.QUAD_TO:for(s=0,a=this.getPointOnQuadraticBezier(0,e,t,i[0],i[1],i[2],i[3]),u=.01;u<=1;u+=.01)o=this.getPointOnQuadraticBezier(u,e,t,i[0],i[1],i[2],i[3]),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return s;case Sn.ARC:{s=0;var d=i[4],p=i[5],b=i[4]+p,C=Math.PI/180;if(Math.abs(d-b)<C&&(C=Math.abs(d-b)),a=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],d,0),p<0)for(u=d-C;u>b;u-=C)o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;else for(u=d+C;u<b;u+=C)o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],u,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),a=o;return o=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],b,0),s+=this.getLineLength(a.x,a.y,o.x,o.y),s}}return 0}getPointOnLine(e,t,n,i,s){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:t,o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:n,u=(s-n)/(i-t+Pd),d=Math.sqrt(e*e/(1+u*u));i<t&&(d*=-1);var p=u*d,b=null;if(i===t)b={x:a,y:o+p};else if((o-n)/(a-t+Pd)===u)b={x:a+d,y:o+p};else{var C=0,w=0,M=this.getLineLength(t,n,i,s);if(M<Pd)return null;var P=(a-t)*(i-t)+(o-n)*(s-n);P/=M*M,C=t+P*(i-t),w=n+P*(s-n);var k=this.getLineLength(a,o,C,w),D=Math.sqrt(e*e-k*k);d=Math.sqrt(D*D/(1+u*u)),i<t&&(d*=-1),p=u*d,b={x:C+d,y:w+p}}return b}getPointOnPath(e){var t=this.getPathLength(),n=0,i=null;if(e<-5e-5||e-5e-5>t)return null;var{dataArray:s}=this;for(var a of s){if(a&&(a.pathLength<5e-5||n+a.pathLength+5e-5<e)){n+=a.pathLength;continue}var o=e-n,u=0;switch(a.type){case Sn.LINE_TO:i=this.getPointOnLine(o,a.start.x,a.start.y,a.points[0],a.points[1],a.start.x,a.start.y);break;case Sn.ARC:{var d=a.points[4],p=a.points[5],b=a.points[4]+p;if(u=d+o/a.pathLength*p,p<0&&u<b||p>=0&&u>b)break;i=this.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],u,a.points[6]);break}case Sn.CURVE_TO:u=o/a.pathLength,u>1&&(u=1),i=this.getPointOnCubicBezier(u,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3],a.points[4],a.points[5]);break;case Sn.QUAD_TO:u=o/a.pathLength,u>1&&(u=1),i=this.getPointOnQuadraticBezier(u,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3]);break}if(i)return i;break}return null}getLineLength(e,t,n,i){return Math.sqrt((n-e)*(n-e)+(i-t)*(i-t))}getPathLength(){return this.pathLength===-1&&(this.pathLength=this.dataArray.reduce((e,t)=>t.pathLength>0?e+t.pathLength:e,0)),this.pathLength}getPointOnCubicBezier(e,t,n,i,s,a,o,u,d){var p=u*R3(e)+a*L3(e)+i*O3(e)+t*U3(e),b=d*R3(e)+o*L3(e)+s*O3(e)+n*U3(e);return{x:p,y:b}}getPointOnQuadraticBezier(e,t,n,i,s,a,o){var u=a*D3(e)+i*k3(e)+t*N3(e),d=o*D3(e)+s*k3(e)+n*N3(e);return{x:u,y:d}}getPointOnEllipticalArc(e,t,n,i,s,a){var o=Math.cos(a),u=Math.sin(a),d={x:n*Math.cos(s),y:i*Math.sin(s)};return{x:e+(d.x*o-d.y*u),y:t+(d.x*u+d.y*o)}}buildEquidistantCache(e,t){var n=this.getPathLength(),i=t||.25,s=e||n/100;if(!this.equidistantCache||this.equidistantCache.step!==s||this.equidistantCache.precision!==i){this.equidistantCache={step:s,precision:i,points:[]};for(var a=0,o=0;o<=n;o+=i){var u=this.getPointOnPath(o),d=this.getPointOnPath(o+i);!u||!d||(a+=this.getLineLength(u.x,u.y,d.x,d.y),a>=s&&(this.equidistantCache.points.push({x:u.x,y:u.y,distance:o}),a-=s))}}}getEquidistantPointOnPath(e,t,n){if(this.buildEquidistantCache(t,n),e<0||e-this.getPathLength()>5e-5)return null;var i=Math.round(e/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[i]||null}}var jwe=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class D7 extends cf{constructor(e,t,n){super(e,t,n),this.type="image",this.loaded=!1;var i=this.getHrefAttribute().getString();if(i){var s=i.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(i);e.images.push(this),s?this.loadSvg(i):this.loadImage(i),this.isSvg=s}}loadImage(e){var t=this;return Kh(function*(){try{var n=yield t.document.createImage(e);t.image=n}catch(i){console.error('Error while loading image "'.concat(e,'":'),i)}t.loaded=!0})()}loadSvg(e){var t=this;return Kh(function*(){var n=jwe.exec(e);if(n){var i=n[5];n[4]==="base64"?t.image=atob(i):t.image=decodeURIComponent(i)}else try{var s=yield t.document.fetch(e),a=yield s.text();t.image=a}catch(o){console.error('Error while loading image "'.concat(e,'":'),o)}t.loaded=!0})()}renderChildren(e){var{document:t,image:n,loaded:i}=this,s=this.getAttribute("x").getPixels("x"),a=this.getAttribute("y").getPixels("y"),o=this.getStyle("width").getPixels("x"),u=this.getStyle("height").getPixels("y");if(!(!i||!n||!o||!u)){if(e.save(),e.translate(s,a),this.isSvg){var d=t.canvg.forkString(e,this.image,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:o,scaleHeight:u});d.document.documentElement.parent=this,d.render()}else{var p=this.image;t.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:o,desiredWidth:p.width,height:u,desiredHeight:p.height}),this.loaded&&(typeof p.complete>"u"||p.complete)&&e.drawImage(p,0,0)}e.restore()}}getBoundingBox(){var e=this.getAttribute("x").getPixels("x"),t=this.getAttribute("y").getPixels("y"),n=this.getStyle("width").getPixels("x"),i=this.getStyle("height").getPixels("y");return new lc(e,t,e+n,t+i)}}class k7 extends cf{constructor(){super(...arguments),this.type="symbol"}render(e){}}class N7{constructor(e){this.document=e,this.loaded=!1,e.fonts.push(this)}load(e,t){var n=this;return Kh(function*(){try{var{document:i}=n,s=yield i.canvg.parser.load(t),a=s.getElementsByTagName("font");Array.from(a).forEach(o=>{var u=i.createElement(o);i.definitions[e]=u})}catch(o){console.error('Error while loading font "'.concat(t,'":'),o)}n.loaded=!0})()}}class G3 extends Hi{constructor(e,t,n){super(e,t,n),this.type="style";var i=Sd(Array.from(t.childNodes).map(a=>a.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")),s=i.split("}");s.forEach(a=>{var o=a.trim();if(o){var u=o.split("{"),d=u[0].split(","),p=u[1].split(";");d.forEach(b=>{var C=b.trim();if(C){var w=e.styles[C]||{};if(p.forEach(k=>{var D=k.indexOf(":"),j=k.substr(0,D).trim(),H=k.substr(D+1,k.length-D).trim();j&&H&&(w[j]=new nn(e,j,H))}),e.styles[C]=w,e.stylesSpecificity[C]=a7(C),C==="@font-face"){var M=w["font-family"].getString().replace(/"|'/g,""),P=w.src.getString().split(",");P.forEach(k=>{if(k.indexOf('format("svg")')>0){var D=P3(k);D&&new N7(e).load(M,D)}})}}})}})}}G3.parseExternalUrl=P3;class z7 extends cf{constructor(){super(...arguments),this.type="use"}setContext(e){super.setContext(e);var t=this.getAttribute("x"),n=this.getAttribute("y");t.hasValue()&&e.translate(t.getPixels("x"),0),n.hasValue()&&e.translate(0,n.getPixels("y"))}path(e){var{element:t}=this;t&&t.path(e)}renderChildren(e){var{document:t,element:n}=this;if(n){var i=n;if(n.type==="symbol"&&(i=new Tg(t,null),i.attributes.viewBox=new nn(t,"viewBox",n.getAttribute("viewBox").getString()),i.attributes.preserveAspectRatio=new nn(t,"preserveAspectRatio",n.getAttribute("preserveAspectRatio").getString()),i.attributes.overflow=new nn(t,"overflow",n.getAttribute("overflow").getString()),i.children=n.children,n.styles.opacity=new nn(t,"opacity",this.calculateOpacity())),i.type==="svg"){var s=this.getStyle("width",!1,!0),a=this.getStyle("height",!1,!0);s.hasValue()&&(i.attributes.width=new nn(t,"width",s.getString())),a.hasValue()&&(i.attributes.height=new nn(t,"height",a.getString()))}var o=i.parent;i.parent=this,i.render(e),i.parent=o}}getBoundingBox(e){var{element:t}=this;return t?t.getBoundingBox(e):null}elementTransform(){var{document:e,element:t}=this;return lf.fromElement(e,t)}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}}function cv(r,e,t,n,i,s){return r[t*n*4+e*4+s]}function uv(r,e,t,n,i,s,a){r[t*n*4+e*4+s]=a}function ro(r,e,t){var n=r[e];return n*t}function Zh(r,e,t,n){return e+Math.cos(r)*t+Math.sin(r)*n}class W3 extends Hi{constructor(e,t,n){super(e,t,n),this.type="feColorMatrix";var i=ol(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{var s=i[0];i=[.213+.787*s,.715-.715*s,.072-.072*s,0,0,.213-.213*s,.715+.285*s,.072-.072*s,0,0,.213-.213*s,.715-.715*s,.072+.928*s,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{var a=i[0]*Math.PI/180;i=[Zh(a,.213,.787,-.213),Zh(a,.715,-.715,-.715),Zh(a,.072,-.072,.928),0,0,Zh(a,.213,-.213,.143),Zh(a,.715,.285,.14),Zh(a,.072,-.072,-.283),0,0,Zh(a,.213,-.213,-.787),Zh(a,.715,-.715,.715),Zh(a,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=i,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}apply(e,t,n,i,s){for(var{includeOpacity:a,matrix:o}=this,u=e.getImageData(0,0,i,s),d=0;d<s;d++)for(var p=0;p<i;p++){var b=cv(u.data,p,d,i,s,0),C=cv(u.data,p,d,i,s,1),w=cv(u.data,p,d,i,s,2),M=cv(u.data,p,d,i,s,3),P=ro(o,0,b)+ro(o,1,C)+ro(o,2,w)+ro(o,3,M)+ro(o,4,1),k=ro(o,5,b)+ro(o,6,C)+ro(o,7,w)+ro(o,8,M)+ro(o,9,1),D=ro(o,10,b)+ro(o,11,C)+ro(o,12,w)+ro(o,13,M)+ro(o,14,1),j=ro(o,15,b)+ro(o,16,C)+ro(o,17,w)+ro(o,18,M)+ro(o,19,1);a&&(P=0,k=0,D=0,j*=M/255),uv(u.data,p,d,i,s,0,P),uv(u.data,p,d,i,s,1,k),uv(u.data,p,d,i,s,2,D),uv(u.data,p,d,i,s,3,j)}e.clearRect(0,0,i,s),e.putImageData(u,0,0)}}class Z_ extends Hi{constructor(){super(...arguments),this.type="mask"}apply(e,t){var{document:n}=this,i=this.getAttribute("x").getPixels("x"),s=this.getAttribute("y").getPixels("y"),a=this.getStyle("width").getPixels("x"),o=this.getStyle("height").getPixels("y");if(!a&&!o){var u=new lc;this.children.forEach(M=>{u.addBoundingBox(M.getBoundingBox(e))}),i=Math.floor(u.x1),s=Math.floor(u.y1),a=Math.floor(u.width),o=Math.floor(u.height)}var d=this.removeStyles(t,Z_.ignoreStyles),p=n.createCanvas(i+a,s+o),b=p.getContext("2d");n.screen.setDefaults(b),this.renderChildren(b),new W3(n,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(b,0,0,i+a,s+o);var C=n.createCanvas(i+a,s+o),w=C.getContext("2d");n.screen.setDefaults(w),t.render(w),w.globalCompositeOperation="destination-in",w.fillStyle=b.createPattern(p,"no-repeat"),w.fillRect(0,0,i+a,s+o),e.fillStyle=w.createPattern(C,"no-repeat"),e.fillRect(0,0,i+a,s+o),this.restoreStyles(t,d)}render(e){}}Z_.ignoreStyles=["mask","transform","clip-path"];var Q7=()=>{};class H7 extends Hi{constructor(){super(...arguments),this.type="clipPath"}apply(e){var{document:t}=this,n=Reflect.getPrototypeOf(e),{beginPath:i,closePath:s}=e;n&&(n.beginPath=Q7,n.closePath=Q7),Reflect.apply(i,e,[]),this.children.forEach(a=>{if(!(typeof a.path>"u")){var o=typeof a.elementTransform<"u"?a.elementTransform():null;o||(o=lf.fromElement(t,a)),o&&o.apply(e),a.path(e),n&&(n.closePath=s),o&&o.unapply(e)}}),Reflect.apply(s,e,[]),e.clip(),n&&(n.beginPath=i,n.closePath=s)}render(e){}}class J_ extends Hi{constructor(){super(...arguments),this.type="filter"}apply(e,t){var{document:n,children:i}=this,s=t.getBoundingBox(e);if(s){var a=0,o=0;i.forEach(D=>{var j=D.extraFilterDistance||0;a=Math.max(a,j),o=Math.max(o,j)});var u=Math.floor(s.width),d=Math.floor(s.height),p=u+2*a,b=d+2*o;if(!(p<1||b<1)){var C=Math.floor(s.x),w=Math.floor(s.y),M=this.removeStyles(t,J_.ignoreStyles),P=n.createCanvas(p,b),k=P.getContext("2d");n.screen.setDefaults(k),k.translate(-C+a,-w+o),t.render(k),i.forEach(D=>{typeof D.apply=="function"&&D.apply(k,0,0,p,b)}),e.drawImage(P,0,0,p,b,C-a,w-o,p,b),this.restoreStyles(t,M)}}}render(e){}}J_.ignoreStyles=["filter","transform","clip-path"];class V7 extends Hi{constructor(e,t,n){super(e,t,n),this.type="feDropShadow",this.addStylesFromStyleDefinition()}apply(e,t,n,i,s){}}class j7 extends Hi{constructor(){super(...arguments),this.type="feMorphology"}apply(e,t,n,i,s){}}class $7 extends Hi{constructor(){super(...arguments),this.type="feComposite"}apply(e,t,n,i,s){}}class G7 extends Hi{constructor(e,t,n){super(e,t,n),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}apply(e,t,n,i,s){var{document:a,blurRadius:o}=this,u=a.window?a.window.document.body:null,d=e.canvas;d.id=a.getUniqueId(),u&&(d.style.display="none",u.appendChild(d)),wwe(d,t,n,i,s,o),u&&u.removeChild(d)}}class W7 extends Hi{constructor(){super(...arguments),this.type="title"}}class q7 extends Hi{constructor(){super(...arguments),this.type="desc"}}var $we={svg:Tg,rect:V3,circle:_7,ellipse:y7,line:b7,polyline:j3,polygon:v7,path:_i,pattern:w7,marker:x7,defs:B7,linearGradient:C7,radialGradient:T7,stop:E7,animate:av,animateColor:S7,animateTransform:I7,font:P7,"font-face":M7,"missing-glyph":F7,glyph:H3,text:Yh,tspan:Y_,tref:R7,a:L7,textPath:U7,image:D7,g:ov,symbol:k7,style:G3,use:z7,mask:Z_,clipPath:H7,filter:J_,feDropShadow:V7,feMorphology:j7,feComposite:$7,feColorMatrix:W3,feGaussianBlur:G7,title:W7,desc:q7};function K7(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Gwe(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?K7(Object(t),!0).forEach(function(n){b3(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):K7(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function Wwe(r,e){var t=document.createElement("canvas");return t.width=r,t.height=e,t}function qwe(r){return q3.apply(this,arguments)}function q3(){return q3=Kh(function*(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=document.createElement("img");return e&&(t.crossOrigin="Anonymous"),new Promise((n,i)=>{t.onload=()=>{n(t)},t.onerror=(s,a,o,u,d)=>{i(d)},t.src=r})}),q3.apply(this,arguments)}class Jh{constructor(e){var{rootEmSize:t=12,emSize:n=12,createCanvas:i=Jh.createCanvas,createImage:s=Jh.createImage,anonymousCrossOrigin:a}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.canvg=e,this.definitions=Object.create(null),this.styles=Object.create(null),this.stylesSpecificity=Object.create(null),this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=e.screen,this.rootEmSize=t,this.emSize=n,this.createCanvas=i,this.createImage=this.bindCreateImage(s,a),this.screen.wait(this.isImagesLoaded.bind(this)),this.screen.wait(this.isFontsLoaded.bind(this))}bindCreateImage(e,t){return typeof t=="boolean"?(n,i)=>e(n,typeof i=="boolean"?i:t):e}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){var{emSizeStack:e}=this;return e[e.length-1]}set emSize(e){var{emSizeStack:t}=this;t.push(e)}popEmSize(){var{emSizeStack:e}=this;e.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(e=>e.loaded)}isFontsLoaded(){return this.fonts.every(e=>e.loaded)}createDocumentElement(e){var t=this.createElement(e.documentElement);return t.root=!0,t.addStylesFromStyleDefinition(),this.documentElement=t,t}createElement(e){var t=e.nodeName.replace(/^[^:]+:/,""),n=Jh.elementTypes[t];return typeof n<"u"?new n(this,e):new m7(this,e)}createTextNode(e){return new Vwe(this,e)}setViewBox(e){this.screen.setViewBox(Gwe({document:this},e))}}Jh.createCanvas=Wwe,Jh.createImage=qwe,Jh.elementTypes=$we;function X7(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Md(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?X7(Object(t),!0).forEach(function(n){b3(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):X7(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}class Fd{constructor(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.parser=new sv(n),this.screen=new X_(e,n),this.options=n;var i=new Jh(this,n),s=i.createDocumentElement(t);this.document=i,this.documentElement=s}static from(e,t){var n=arguments;return Kh(function*(){var i=n.length>2&&n[2]!==void 0?n[2]:{},s=new sv(i),a=yield s.parse(t);return new Fd(e,a,i)})()}static fromString(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=new sv(n),s=i.parseFromString(t);return new Fd(e,s,n)}fork(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Fd.from(e,t,Md(Md({},this.options),n))}forkString(e,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Fd.fromString(e,t,Md(Md({},this.options),n))}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}render(){var e=arguments,t=this;return Kh(function*(){var n=e.length>0&&e[0]!==void 0?e[0]:{};t.start(Md({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0},n)),yield t.ready(),t.stop()})()}start(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{documentElement:t,screen:n,options:i}=this;n.start(t,Md(Md({enableRedraw:!0},i),e))}stop(){this.screen.stop()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.documentElement.resize(e,t,n)}}const Kwe=Object.freeze(Object.defineProperty({__proto__:null,AElement:L7,AnimateColorElement:S7,AnimateElement:av,AnimateTransformElement:I7,BoundingBox:lc,CB1:R3,CB2:L3,CB3:O3,CB4:U3,Canvg:Fd,CircleElement:_7,ClipPathElement:H7,DefsElement:B7,DescElement:q7,Document:Jh,Element:Hi,EllipseElement:y7,FeColorMatrixElement:W3,FeCompositeElement:$7,FeDropShadowElement:V7,FeGaussianBlurElement:G7,FeMorphologyElement:j7,FilterElement:J_,Font:ga,FontElement:P7,FontFaceElement:M7,GElement:ov,GlyphElement:H3,GradientElement:$3,ImageElement:D7,LineElement:b7,LinearGradientElement:C7,MarkerElement:x7,MaskElement:Z_,Matrix:z3,MissingGlyphElement:F7,Mouse:c7,PSEUDO_ZERO:Pd,Parser:sv,PathElement:_i,PathParser:Sn,PatternElement:w7,Point:Es,PolygonElement:v7,PolylineElement:j3,Property:nn,QB1:D3,QB2:k3,QB3:N3,RadialGradientElement:T7,RectElement:V3,RenderedElement:cf,Rotate:f7,SVGElement:Tg,SVGFontLoader:N7,Scale:d7,Screen:X_,Skew:Q3,SkewX:p7,SkewY:g7,StopElement:E7,StyleElement:G3,SymbolElement:k7,TRefElement:R7,TSpanElement:Y_,TextElement:Yh,TextPathElement:U7,TitleElement:W7,Transform:lf,Translate:A7,UnknownElement:m7,UseElement:z7,ViewPort:l7,compressSpaces:Sd,default:Fd,getSelectorSpecificity:a7,normalizeAttributeName:s7,normalizeColor:o7,parseExternalUrl:P3,presets:Twe,toNumbers:ol,trimLeft:n7,trimRight:i7,vectorMagnitude:M3,vectorsAngle:F3,vectorsRatio:iv},Symbol.toStringTag,{value:"Module"}));CA.CompareMaps=Gge,CA.Config=hk,CA.Map=zge,Object.defineProperty(CA,Symbol.toStringTag,{value:"Module"})});
