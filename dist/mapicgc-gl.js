(function(Ll,Km){typeof exports=="object"&&typeof module<"u"?Km(exports):typeof define=="function"&&define.amd?define(["exports"],Km):(Ll=typeof globalThis<"u"?globalThis:Ll||self,Km(Ll.mapicgcgl={}))})(this,function(Ll){"use strict";function Km(r,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const n in i)if(n!=="default"&&!(n in r)){const o=Object.getOwnPropertyDescriptor(i,n);o&&Object.defineProperty(r,n,o.get?o:{enumerable:!0,get:()=>i[n]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var mf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wm(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var C5={exports:{}};(function(r,e){(function(t,i){r.exports=i()})(mf,function(){var t={},i={};function n(a,s,g){if(i[a]=g,a==="index"){var y="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",T={};return i.shared(T),i.index(t,T),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([y],{type:"text/javascript"}))),t}}n("shared",["exports"],function(a){function s(f,u,m,C){return new(m||(m=Promise))(function(D,Q){function H(de){try{ie(C.next(de))}catch(h){Q(h)}}function X(de){try{ie(C.throw(de))}catch(h){Q(h)}}function ie(de){var h;de.done?D(de.value):(h=de.value,h instanceof m?h:new m(function(c){c(h)})).then(H,X)}ie((C=C.apply(f,u||[])).next())})}function g(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}typeof SuppressedError=="function"&&SuppressedError;var y=T;function T(f,u){this.x=f,this.y=u}T.prototype={clone:function(){return new T(this.x,this.y)},add:function(f){return this.clone()._add(f)},sub:function(f){return this.clone()._sub(f)},multByPoint:function(f){return this.clone()._multByPoint(f)},divByPoint:function(f){return this.clone()._divByPoint(f)},mult:function(f){return this.clone()._mult(f)},div:function(f){return this.clone()._div(f)},rotate:function(f){return this.clone()._rotate(f)},rotateAround:function(f,u){return this.clone()._rotateAround(f,u)},matMult:function(f){return this.clone()._matMult(f)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(f){return this.x===f.x&&this.y===f.y},dist:function(f){return Math.sqrt(this.distSqr(f))},distSqr:function(f){var u=f.x-this.x,m=f.y-this.y;return u*u+m*m},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(f){return Math.atan2(this.y-f.y,this.x-f.x)},angleWith:function(f){return this.angleWithSep(f.x,f.y)},angleWithSep:function(f,u){return Math.atan2(this.x*u-this.y*f,this.x*f+this.y*u)},_matMult:function(f){var u=f[2]*this.x+f[3]*this.y;return this.x=f[0]*this.x+f[1]*this.y,this.y=u,this},_add:function(f){return this.x+=f.x,this.y+=f.y,this},_sub:function(f){return this.x-=f.x,this.y-=f.y,this},_mult:function(f){return this.x*=f,this.y*=f,this},_div:function(f){return this.x/=f,this.y/=f,this},_multByPoint:function(f){return this.x*=f.x,this.y*=f.y,this},_divByPoint:function(f){return this.x/=f.x,this.y/=f.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var f=this.y;return this.y=this.x,this.x=-f,this},_rotate:function(f){var u=Math.cos(f),m=Math.sin(f),C=m*this.x+u*this.y;return this.x=u*this.x-m*this.y,this.y=C,this},_rotateAround:function(f,u){var m=Math.cos(f),C=Math.sin(f),D=u.y+C*(this.x-u.x)+m*(this.y-u.y);return this.x=u.x+m*(this.x-u.x)-C*(this.y-u.y),this.y=D,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},T.convert=function(f){return f instanceof T?f:Array.isArray(f)?new T(f[0],f[1]):f};var I=g(y),R=U;function U(f,u,m,C){this.cx=3*f,this.bx=3*(m-f)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(C-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=f,this.p1y=u,this.p2x=m,this.p2y=C}U.prototype={sampleCurveX:function(f){return((this.ax*f+this.bx)*f+this.cx)*f},sampleCurveY:function(f){return((this.ay*f+this.by)*f+this.cy)*f},sampleCurveDerivativeX:function(f){return(3*this.ax*f+2*this.bx)*f+this.cx},solveCurveX:function(f,u){if(u===void 0&&(u=1e-6),f<0)return 0;if(f>1)return 1;for(var m=f,C=0;C<8;C++){var D=this.sampleCurveX(m)-f;if(Math.abs(D)<u)return m;var Q=this.sampleCurveDerivativeX(m);if(Math.abs(Q)<1e-6)break;m-=D/Q}var H=0,X=1;for(m=f,C=0;C<20&&(D=this.sampleCurveX(m),!(Math.abs(D-f)<u));C++)f>D?H=m:X=m,m=.5*(X-H)+H;return m},solve:function(f,u){return this.sampleCurveY(this.solveCurveX(f,u))}};var Z=g(R);let Y,he;function ce(){return Y==null&&(Y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Y}function pe(){if(he==null&&(he=!1,ce())){const u=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(u){for(let C=0;C<5*5;C++){const D=4*C;u.fillStyle=`rgb(${D},${D+1},${D+2})`,u.fillRect(C%5,Math.floor(C/5),1,1)}const m=u.getImageData(0,0,5,5).data;for(let C=0;C<5*5*4;C++)if(C%4!=3&&m[C]!==C){he=!0;break}}}return he||!1}function be(f,u,m,C){const D=new Z(f,u,m,C);return function(Q){return D.solve(Q)}}const Te=be(.25,.1,.25,1);function qe(f,u,m){return Math.min(m,Math.max(u,f))}function je(f,u,m){const C=m-u,D=((f-u)%C+C)%C+u;return D===u?m:D}function We(f){for(var u=arguments.length,m=new Array(u>1?u-1:0),C=1;C<u;C++)m[C-1]=arguments[C];for(const D of m)for(const Q in D)f[Q]=D[Q];return f}let Ne=1;function at(f,u,m){const C={};for(const D in f)C[D]=u.call(m||this,f[D],D,f);return C}function nt(f,u,m){const C={};for(const D in f)u.call(m||this,f[D],D,f)&&(C[D]=f[D]);return C}function ke(f){return Array.isArray(f)?f.map(ke):typeof f=="object"&&f?at(f,ke):f}const De={};function Ye(f){De[f]||(typeof console<"u"&&console.warn(f),De[f]=!0)}function Xe(f,u,m){return(m.y-f.y)*(u.x-f.x)>(u.y-f.y)*(m.x-f.x)}function Ct(f){let u=0;for(let m,C,D=0,Q=f.length,H=Q-1;D<Q;H=D++)m=f[D],C=f[H],u+=(C.x-m.x)*(m.y+C.y);return u}function Et(f){return typeof WorkerGlobalScope<"u"&&f!==void 0&&f instanceof WorkerGlobalScope}let Pt=null;function bt(f){return typeof ImageBitmap<"u"&&f instanceof ImageBitmap}const Rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ft(f,u,m,C,D){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const Q=new VideoFrame(f,{timestamp:0});try{const H=Q==null?void 0:Q.format;if(!H||!H.startsWith("BGR")&&!H.startsWith("RGB"))throw new Error(`Unrecognized format ${H}`);const X=H.startsWith("BGR"),ie=new Uint8ClampedArray(C*D*4);if(yield Q.copyTo(ie,function(de,h,c,d,v){const S=4*Math.max(-h,0),P=(Math.max(0,c)-c)*d*4+S,k=4*d,G=Math.max(0,h),W=Math.max(0,c);return{rect:{x:G,y:W,width:Math.min(de.width,h+d)-G,height:Math.min(de.height,c+v)-W},layout:[{offset:P,stride:k}]}}(f,u,m,C,D)),X)for(let de=0;de<ie.length;de+=4){const h=ie[de];ie[de]=ie[de+2],ie[de+2]=h}return ie}finally{Q.close()}})}let Zt,Le;const Ze="AbortError";function rt(){return new Error(Ze)}const pt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function mt(f){return pt.REGISTERED_PROTOCOLS[f.substring(0,f.indexOf("://"))]}const Bt="global-dispatcher";class Dt extends Error{constructor(u,m,C,D){super(`AJAXError: ${m} (${u}): ${C}`),this.status=u,this.statusText=m,this.url=C,this.body=D}}const Mt=()=>Et(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,qt=function(f,u){if(/:\/\//.test(f.url)&&!/^https?:|^file:/.test(f.url)){const C=mt(f.url);if(C)return C(f,u);if(Et(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:f,targetMapId:Bt},u)}if(!(/^file:/.test(m=f.url)||/^file:/.test(Mt())&&!/^\w+:/.test(m))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(C,D){return s(this,void 0,void 0,function*(){const Q=new Request(C.url,{method:C.method||"GET",body:C.body,credentials:C.credentials,headers:C.headers,cache:C.cache,referrer:Mt(),signal:D.signal});C.type==="json"&&Q.headers.set("Accept","application/json");const H=yield fetch(Q);if(!H.ok){const de=yield H.blob();throw new Dt(H.status,H.statusText,C.url,de)}let X;X=C.type==="arrayBuffer"||C.type==="image"?H.arrayBuffer():C.type==="json"?H.json():H.text();const ie=yield X;if(D.signal.aborted)throw rt();return{data:ie,cacheControl:H.headers.get("Cache-Control"),expires:H.headers.get("Expires")}})}(f,u);if(Et(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:f,mustQueue:!0,targetMapId:Bt},u)}var m;return function(C,D){return new Promise((Q,H)=>{const X=new XMLHttpRequest;X.open(C.method||"GET",C.url,!0),C.type!=="arrayBuffer"&&C.type!=="image"||(X.responseType="arraybuffer");for(const ie in C.headers)X.setRequestHeader(ie,C.headers[ie]);C.type==="json"&&(X.responseType="text",X.setRequestHeader("Accept","application/json")),X.withCredentials=C.credentials==="include",X.onerror=()=>{H(new Error(X.statusText))},X.onload=()=>{if(!D.signal.aborted)if((X.status>=200&&X.status<300||X.status===0)&&X.response!==null){let ie=X.response;if(C.type==="json")try{ie=JSON.parse(X.response)}catch(de){return void H(de)}Q({data:ie,cacheControl:X.getResponseHeader("Cache-Control"),expires:X.getResponseHeader("Expires")})}else{const ie=new Blob([X.response],{type:X.getResponseHeader("Content-Type")});H(new Dt(X.status,X.statusText,C.url,ie))}},D.signal.addEventListener("abort",()=>{X.abort(),H(rt())}),X.send(C.body)})}(f,u)};function nr(f){if(!f||f.indexOf("://")<=0||f.indexOf("data:image/")===0||f.indexOf("blob:")===0)return!0;const u=new URL(f),m=window.location;return u.protocol===m.protocol&&u.host===m.host}function vr(f,u,m){m[f]&&m[f].indexOf(u)!==-1||(m[f]=m[f]||[],m[f].push(u))}function br(f,u,m){if(m&&m[f]){const C=m[f].indexOf(u);C!==-1&&m[f].splice(C,1)}}class Fr{constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};We(this,m),this.type=u}}class kt extends Fr{constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",We({error:u},m))}}class lt{on(u,m){return this._listeners=this._listeners||{},vr(u,m,this._listeners),this}off(u,m){return br(u,m,this._listeners),br(u,m,this._oneTimeListeners),this}once(u,m){return m?(this._oneTimeListeners=this._oneTimeListeners||{},vr(u,m,this._oneTimeListeners),this):new Promise(C=>this.once(u,C))}fire(u,m){typeof u=="string"&&(u=new Fr(u,m||{}));const C=u.type;if(this.listens(C)){u.target=this;const D=this._listeners&&this._listeners[C]?this._listeners[C].slice():[];for(const X of D)X.call(this,u);const Q=this._oneTimeListeners&&this._oneTimeListeners[C]?this._oneTimeListeners[C].slice():[];for(const X of Q)br(C,X,this._oneTimeListeners),X.call(this,u);const H=this._eventedParent;H&&(We(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),H.fire(u))}else u instanceof kt&&console.error(u.error);return this}listens(u){return this._listeners&&this._listeners[u]&&this._listeners[u].length>0||this._oneTimeListeners&&this._oneTimeListeners[u]&&this._oneTimeListeners[u].length>0||this._eventedParent&&this._eventedParent.listens(u)}setEventedParent(u,m){return this._eventedParent=u,this._eventedParentData=m,this}}var wt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ur=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function tr(f,u){const m={};for(const C in f)C!=="ref"&&(m[C]=f[C]);return Ur.forEach(C=>{C in u&&(m[C]=u[C])}),m}function ht(f,u){if(Array.isArray(f)){if(!Array.isArray(u)||f.length!==u.length)return!1;for(let m=0;m<f.length;m++)if(!ht(f[m],u[m]))return!1;return!0}if(typeof f=="object"&&f!==null&&u!==null){if(typeof u!="object"||Object.keys(f).length!==Object.keys(u).length)return!1;for(const m in f)if(!ht(f[m],u[m]))return!1;return!0}return f===u}function $t(f,u){f.push(u)}function or(f,u,m){$t(m,{command:"addSource",args:[f,u[f]]})}function mr(f,u,m){$t(u,{command:"removeSource",args:[f]}),m[f]=!0}function ur(f,u,m,C){mr(f,m,C),or(f,u,m)}function Wr(f,u,m){let C;for(C in f[m])if(Object.prototype.hasOwnProperty.call(f[m],C)&&C!=="data"&&!ht(f[m][C],u[m][C]))return!1;for(C in u[m])if(Object.prototype.hasOwnProperty.call(u[m],C)&&C!=="data"&&!ht(f[m][C],u[m][C]))return!1;return!0}function ri(f,u,m,C,D,Q){f=f||{},u=u||{};for(const H in f)Object.prototype.hasOwnProperty.call(f,H)&&(ht(f[H],u[H])||m.push({command:Q,args:[C,H,u[H],D]}));for(const H in u)Object.prototype.hasOwnProperty.call(u,H)&&!Object.prototype.hasOwnProperty.call(f,H)&&(ht(f[H],u[H])||m.push({command:Q,args:[C,H,u[H],D]}))}function gi(f){return f.id}function Pi(f,u){return f[u.id]=u,f}class zt{constructor(u,m,C,D){this.message=(u?`${u}: `:"")+C,D&&(this.identifier=D),m!=null&&m.__line__&&(this.line=m.__line__)}}function Xr(f){for(var u=arguments.length,m=new Array(u>1?u-1:0),C=1;C<u;C++)m[C-1]=arguments[C];for(const D of m)for(const Q in D)f[Q]=D[Q];return f}class Ar extends Error{constructor(u,m){super(m),this.message=m,this.key=u}}class Wt{constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=u,this.bindings={};for(const[C,D]of m)this.bindings[C]=D}concat(u){return new Wt(this,u)}get(u){if(this.bindings[u])return this.bindings[u];if(this.parent)return this.parent.get(u);throw new Error(`${u} not found in scope.`)}has(u){return!!this.bindings[u]||!!this.parent&&this.parent.has(u)}}const di={kind:"null"},Qt={kind:"number"},Tr={kind:"string"},Lr={kind:"boolean"},Xt={kind:"color"},xr={kind:"object"},er={kind:"value"},vi={kind:"collator"},Zi={kind:"formatted"},Qe={kind:"padding"},Be={kind:"resolvedImage"},ue={kind:"variableAnchorOffsetCollection"};function re(f,u){return{kind:"array",itemType:f,N:u}}function Ae(f){if(f.kind==="array"){const u=Ae(f.itemType);return typeof f.N=="number"?`array<${u}, ${f.N}>`:f.itemType.kind==="value"?"array":`array<${u}>`}return f.kind}const ge=[di,Qt,Tr,Lr,Xt,Zi,xr,re(er),Qe,Be,ue];function xe(f,u){if(u.kind==="error")return null;if(f.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!xe(f.itemType,u.itemType))&&(typeof f.N!="number"||f.N===u.N))return null}else{if(f.kind===u.kind)return null;if(f.kind==="value"){for(const m of ge)if(!xe(m,u))return null}}return`Expected ${Ae(f)} but found ${Ae(u)} instead.`}function Ee(f,u){return u.some(m=>m.kind===f.kind)}function we(f,u){return u.some(m=>m==="null"?f===null:m==="array"?Array.isArray(f):m==="object"?f&&!Array.isArray(f)&&typeof f=="object":m===typeof f)}function Fe(f,u){return f.kind==="array"&&u.kind==="array"?f.itemType.kind===u.itemType.kind&&typeof f.N=="number":f.kind===u.kind}const ze=.96422,Ge=.82521,st=4/29,vt=6/29,Tt=3*vt*vt,Kt=vt*vt*vt,rr=Math.PI/180,Gt=180/Math.PI;function dr(f){return(f%=360)<0&&(f+=360),f}function Cr(f){let[u,m,C,D]=f,Q,H;const X=Er((.2225045*(u=Gr(u))+.7168786*(m=Gr(m))+.0606169*(C=Gr(C)))/1);u===m&&m===C?Q=H=X:(Q=Er((.4360747*u+.3850649*m+.1430804*C)/ze),H=Er((.0139322*u+.0971045*m+.7141733*C)/Ge));const ie=116*X-16;return[ie<0?0:ie,500*(Q-X),200*(X-H),D]}function Gr(f){return f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4)}function Er(f){return f>Kt?Math.pow(f,1/3):f/Tt+st}function zr(f){let[u,m,C,D]=f,Q=(u+16)/116,H=isNaN(m)?Q:Q+m/500,X=isNaN(C)?Q:Q-C/200;return Q=1*ir(Q),H=ze*ir(H),X=Ge*ir(X),[ot(3.1338561*H-1.6168667*Q-.4906146*X),ot(-.9787684*H+1.9161415*Q+.033454*X),ot(.0719453*H-.2289914*Q+1.4052427*X),D]}function ot(f){return(f=f<=.00304?12.92*f:1.055*Math.pow(f,1/2.4)-.055)<0?0:f>1?1:f}function ir(f){return f>vt?f*f*f:Tt*(f-st)}function Vt(f){return parseInt(f.padEnd(2,f),16)/255}function Hr(f,u){return ci(u?f/100:f,0,1)}function ci(f,u,m){return Math.min(Math.max(u,f),m)}function un(f){return!f.some(Number.isNaN)}const wn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class mi{constructor(u,m,C){let D=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=u,this.g=m,this.b=C,this.a=D,Q||(this.r*=D,this.g*=D,this.b*=D,D||this.overwriteGetter("rgb",[u,m,C,D]))}static parse(u){if(u instanceof mi)return u;if(typeof u!="string")return;const m=function(C){if((C=C.toLowerCase().trim())==="transparent")return[0,0,0,0];const D=wn[C];if(D){const[H,X,ie]=D;return[H/255,X/255,ie/255,1]}if(C.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(C)){const H=C.length<6?1:2;let X=1;return[Vt(C.slice(X,X+=H)),Vt(C.slice(X,X+=H)),Vt(C.slice(X,X+=H)),Vt(C.slice(X,X+H)||"ff")]}if(C.startsWith("rgb")){const H=C.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(H){const[X,ie,de,h,c,d,v,S,P,k,G,W]=H,ee=[h||" ",v||" ",k].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const ae=[de,d,P].join(""),fe=ae==="%%%"?100:ae===""?255:0;if(fe){const me=[ci(+ie/fe,0,1),ci(+c/fe,0,1),ci(+S/fe,0,1),G?Hr(+G,W):1];if(un(me))return me}}return}}const Q=C.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(Q){const[H,X,ie,de,h,c,d,v,S]=Q,P=[ie||" ",h||" ",d].join("");if(P==="  "||P==="  /"||P===",,"||P===",,,"){const k=[+X,ci(+de,0,100),ci(+c,0,100),v?Hr(+v,S):1];if(un(k))return function(G){let[W,ee,ae,fe]=G;function me(Ce){const Me=(Ce+W/30)%12,Ue=ee*Math.min(ae,1-ae);return ae-Ue*Math.max(-1,Math.min(Me-3,9-Me,1))}return W=dr(W),ee/=100,ae/=100,[me(0),me(8),me(4),fe]}(k)}}}(u);return m?new mi(...m,!1):void 0}get rgb(){const{r:u,g:m,b:C,a:D}=this,Q=D||1/0;return this.overwriteGetter("rgb",[u/Q,m/Q,C/Q,D])}get hcl(){return this.overwriteGetter("hcl",function(u){const[m,C,D,Q]=Cr(u),H=Math.sqrt(C*C+D*D);return[Math.round(1e4*H)?dr(Math.atan2(D,C)*Gt):NaN,H,m,Q]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Cr(this.rgb))}overwriteGetter(u,m){return Object.defineProperty(this,u,{value:m}),m}toString(){const[u,m,C,D]=this.rgb;return`rgba(${[u,m,C].map(Q=>Math.round(255*Q)).join(",")},${D})`}}mi.black=new mi(0,0,0,1),mi.white=new mi(1,1,1,1),mi.transparent=new mi(0,0,0,0),mi.red=new mi(1,0,0,1);class mn{constructor(u,m,C){this.sensitivity=u?m?"variant":"case":m?"accent":"base",this.locale=C,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(u,m){return this.collator.compare(u,m)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yn{constructor(u,m,C,D,Q){this.text=u,this.image=m,this.scale=C,this.fontStack=D,this.textColor=Q}}class fi{constructor(u){this.sections=u}static fromString(u){return new fi([new yn(u,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(u=>u.text.length!==0||u.image&&u.image.name.length!==0)}static factory(u){return u instanceof fi?u:fi.fromString(u)}toString(){return this.sections.length===0?"":this.sections.map(u=>u.text).join("")}}class jn{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof jn)return u;if(typeof u=="number")return new jn([u,u,u,u]);if(Array.isArray(u)&&!(u.length<1||u.length>4)){for(const m of u)if(typeof m!="number")return;switch(u.length){case 1:u=[u[0],u[0],u[0],u[0]];break;case 2:u=[u[0],u[1],u[0],u[1]];break;case 3:u=[u[0],u[1],u[2],u[1]]}return new jn(u)}}toString(){return JSON.stringify(this.values)}}const qs=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ui{constructor(u){this.values=u.slice()}static parse(u){if(u instanceof Ui)return u;if(Array.isArray(u)&&!(u.length<1)&&u.length%2==0){for(let m=0;m<u.length;m+=2){const C=u[m],D=u[m+1];if(typeof C!="string"||!qs.has(C)||!Array.isArray(D)||D.length!==2||typeof D[0]!="number"||typeof D[1]!="number")return}return new Ui(u)}}toString(){return JSON.stringify(this.values)}}class Bn{constructor(u){this.name=u.name,this.available=u.available}toString(){return this.name}static fromString(u){return u?new Bn({name:u,available:!1}):null}}function Xa(f,u,m,C){return typeof f=="number"&&f>=0&&f<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof m=="number"&&m>=0&&m<=255?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid rgba value [${[f,u,m,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof C=="number"?[f,u,m,C]:[f,u,m]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Nn(f){if(f===null||typeof f=="string"||typeof f=="boolean"||typeof f=="number"||f instanceof mi||f instanceof mn||f instanceof fi||f instanceof jn||f instanceof Ui||f instanceof Bn)return!0;if(Array.isArray(f)){for(const u of f)if(!Nn(u))return!1;return!0}if(typeof f=="object"){for(const u in f)if(!Nn(f[u]))return!1;return!0}return!1}function Zr(f){if(f===null)return di;if(typeof f=="string")return Tr;if(typeof f=="boolean")return Lr;if(typeof f=="number")return Qt;if(f instanceof mi)return Xt;if(f instanceof mn)return vi;if(f instanceof fi)return Zi;if(f instanceof jn)return Qe;if(f instanceof Ui)return ue;if(f instanceof Bn)return Be;if(Array.isArray(f)){const u=f.length;let m;for(const C of f){const D=Zr(C);if(m){if(m===D)continue;m=er;break}m=D}return re(m||er,u)}return xr}function co(f){const u=typeof f;return f===null?"":u==="string"||u==="number"||u==="boolean"?String(f):f instanceof mi||f instanceof fi||f instanceof jn||f instanceof Ui||f instanceof Bn?f.toString():JSON.stringify(f)}class Fs{constructor(u,m){this.type=u,this.value=m}static parse(u,m){if(u.length!==2)return m.error(`'literal' expression requires exactly one argument, but found ${u.length-1} instead.`);if(!Nn(u[1]))return m.error("invalid value");const C=u[1];let D=Zr(C);const Q=m.expectedType;return D.kind!=="array"||D.N!==0||!Q||Q.kind!=="array"||typeof Q.N=="number"&&Q.N!==0||(D=Q),new Fs(D,C)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class bi{constructor(u){this.name="ExpressionEvaluationError",this.message=u}toJSON(){return this.message}}const Ii={string:Tr,number:Qt,boolean:Lr,object:xr};class ss{constructor(u,m){this.type=u,this.args=m}static parse(u,m){if(u.length<2)return m.error("Expected at least one argument.");let C,D=1;const Q=u[0];if(Q==="array"){let X,ie;if(u.length>2){const de=u[1];if(typeof de!="string"||!(de in Ii)||de==="object")return m.error('The item type argument of "array" must be one of string, number, boolean',1);X=Ii[de],D++}else X=er;if(u.length>3){if(u[2]!==null&&(typeof u[2]!="number"||u[2]<0||u[2]!==Math.floor(u[2])))return m.error('The length argument to "array" must be a positive integer literal',2);ie=u[2],D++}C=re(X,ie)}else{if(!Ii[Q])throw new Error(`Types doesn't contain name = ${Q}`);C=Ii[Q]}const H=[];for(;D<u.length;D++){const X=m.parse(u[D],D,er);if(!X)return null;H.push(X)}return new ss(C,H)}evaluate(u){for(let m=0;m<this.args.length;m++){const C=this.args[m].evaluate(u);if(!xe(this.type,Zr(C)))return C;if(m===this.args.length-1)throw new bi(`Expected value to be of type ${Ae(this.type)}, but found ${Ae(Zr(C))} instead.`)}throw new Error}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}const ji={"to-boolean":Lr,"to-color":Xt,"to-number":Qt,"to-string":Tr};class Tn{constructor(u,m){this.type=u,this.args=m}static parse(u,m){if(u.length<2)return m.error("Expected at least one argument.");const C=u[0];if(!ji[C])throw new Error(`Can't parse ${C} as it is not part of the known types`);if((C==="to-boolean"||C==="to-string")&&u.length!==2)return m.error("Expected one argument.");const D=ji[C],Q=[];for(let H=1;H<u.length;H++){const X=m.parse(u[H],H,er);if(!X)return null;Q.push(X)}return new Tn(D,Q)}evaluate(u){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(u);case"color":{let m,C;for(const D of this.args){if(m=D.evaluate(u),C=null,m instanceof mi)return m;if(typeof m=="string"){const Q=u.parseColor(m);if(Q)return Q}else if(Array.isArray(m)&&(C=m.length<3||m.length>4?`Invalid rbga value ${JSON.stringify(m)}: expected an array containing either three or four numeric values.`:Xa(m[0],m[1],m[2],m[3]),!C))return new mi(m[0]/255,m[1]/255,m[2]/255,m[3])}throw new bi(C||`Could not parse color from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"padding":{let m;for(const C of this.args){m=C.evaluate(u);const D=jn.parse(m);if(D)return D}throw new bi(`Could not parse padding from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"variableAnchorOffsetCollection":{let m;for(const C of this.args){m=C.evaluate(u);const D=Ui.parse(m);if(D)return D}throw new bi(`Could not parse variableAnchorOffsetCollection from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"number":{let m=null;for(const C of this.args){if(m=C.evaluate(u),m===null)return 0;const D=Number(m);if(!isNaN(D))return D}throw new bi(`Could not convert ${JSON.stringify(m)} to number.`)}case"formatted":return fi.fromString(co(this.args[0].evaluate(u)));case"resolvedImage":return Bn.fromString(co(this.args[0].evaluate(u)));default:return co(this.args[0].evaluate(u))}}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}const Cn=["Unknown","Point","LineString","Polygon"];class mo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Cn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(u){let m=this._parseColorCache[u];return m||(m=this._parseColorCache[u]=mi.parse(u)),m}}class Mi{constructor(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],D=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Wt,H=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=u,this.path=C,this.key=C.map(X=>`[${X}]`).join(""),this.scope=Q,this.errors=H,this.expectedType=D,this._isConstant=m}parse(u,m,C,D){let Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return m?this.concat(m,C,D)._parse(u,Q):this._parse(u,Q)}_parse(u,m){function C(D,Q,H){return H==="assert"?new ss(Q,[D]):H==="coerce"?new Tn(Q,[D]):D}if(u!==null&&typeof u!="string"&&typeof u!="boolean"&&typeof u!="number"||(u=["literal",u]),Array.isArray(u)){if(u.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const D=u[0];if(typeof D!="string")return this.error(`Expression name must be a string, but found ${typeof D} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Q=this.registry[D];if(Q){let H=Q.parse(u,this);if(!H)return null;if(this.expectedType){const X=this.expectedType,ie=H.type;if(X.kind!=="string"&&X.kind!=="number"&&X.kind!=="boolean"&&X.kind!=="object"&&X.kind!=="array"||ie.kind!=="value")if(X.kind!=="color"&&X.kind!=="formatted"&&X.kind!=="resolvedImage"||ie.kind!=="value"&&ie.kind!=="string")if(X.kind!=="padding"||ie.kind!=="value"&&ie.kind!=="number"&&ie.kind!=="array")if(X.kind!=="variableAnchorOffsetCollection"||ie.kind!=="value"&&ie.kind!=="array"){if(this.checkSubtype(X,ie))return null}else H=C(H,X,m.typeAnnotation||"coerce");else H=C(H,X,m.typeAnnotation||"coerce");else H=C(H,X,m.typeAnnotation||"coerce");else H=C(H,X,m.typeAnnotation||"assert")}if(!(H instanceof Fs)&&H.type.kind!=="resolvedImage"&&this._isConstant(H)){const X=new mo;try{H=new Fs(H.type,H.evaluate(X))}catch(ie){return this.error(ie.message),null}}return H}return this.error(`Unknown expression "${D}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(u===void 0?"'undefined' value invalid. Use null instead.":typeof u=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof u} instead.`)}concat(u,m,C){const D=typeof u=="number"?this.path.concat(u):this.path,Q=C?this.scope.concat(C):this.scope;return new Mi(this.registry,this._isConstant,D,m||null,Q,this.errors)}error(u){for(var m=arguments.length,C=new Array(m>1?m-1:0),D=1;D<m;D++)C[D-1]=arguments[D];const Q=`${this.key}${C.map(H=>`[${H}]`).join("")}`;this.errors.push(new Ar(Q,u))}checkSubtype(u,m){const C=xe(u,m);return C&&this.error(C),C}}class Za{constructor(u,m,C){this.type=vi,this.locale=C,this.caseSensitive=u,this.diacriticSensitive=m}static parse(u,m){if(u.length!==2)return m.error("Expected one argument.");const C=u[1];if(typeof C!="object"||Array.isArray(C))return m.error("Collator options argument must be an object.");const D=m.parse(C["case-sensitive"]!==void 0&&C["case-sensitive"],1,Lr);if(!D)return null;const Q=m.parse(C["diacritic-sensitive"]!==void 0&&C["diacritic-sensitive"],1,Lr);if(!Q)return null;let H=null;return C.locale&&(H=m.parse(C.locale,1,Tr),!H)?null:new Za(D,Q,H)}evaluate(u){return new mn(this.caseSensitive.evaluate(u),this.diacriticSensitive.evaluate(u),this.locale?this.locale.evaluate(u):null)}eachChild(u){u(this.caseSensitive),u(this.diacriticSensitive),this.locale&&u(this.locale)}outputDefined(){return!1}}const Ys=8192;function Ja(f,u){f[0]=Math.min(f[0],u[0]),f[1]=Math.min(f[1],u[1]),f[2]=Math.max(f[2],u[0]),f[3]=Math.max(f[3],u[1])}function He(f,u){return!(f[0]<=u[0]||f[2]>=u[2]||f[1]<=u[1]||f[3]>=u[3])}function Je(f,u){const m=(180+f[0])/360,C=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f[1]*Math.PI/360)))/360,D=Math.pow(2,u.z);return[Math.round(m*D*Ys),Math.round(C*D*Ys)]}function gt(f,u,m){const C=f[0]-u[0],D=f[1]-u[1],Q=f[0]-m[0],H=f[1]-m[1];return C*H-Q*D==0&&C*Q<=0&&D*H<=0}function Ot(f,u){let m=!1;for(let H=0,X=u.length;H<X;H++){const ie=u[H];for(let de=0,h=ie.length;de<h-1;de++){if(gt(f,ie[de],ie[de+1]))return!1;(D=ie[de])[1]>(C=f)[1]!=(Q=ie[de+1])[1]>C[1]&&C[0]<(Q[0]-D[0])*(C[1]-D[1])/(Q[1]-D[1])+D[0]&&(m=!m)}}var C,D,Q;return m}function fr(f,u){for(let m=0;m<u.length;m++)if(Ot(f,u[m]))return!0;return!1}function qr(f,u,m,C){const D=C[0]-m[0],Q=C[1]-m[1],H=(f[0]-m[0])*Q-D*(f[1]-m[1]),X=(u[0]-m[0])*Q-D*(u[1]-m[1]);return H>0&&X<0||H<0&&X>0}function Ci(f,u,m){for(const de of m)for(let h=0;h<de.length-1;++h)if((X=[(H=de[h+1])[0]-(Q=de[h])[0],H[1]-Q[1]])[0]*(ie=[(D=u)[0]-(C=f)[0],D[1]-C[1]])[1]-X[1]*ie[0]!=0&&qr(C,D,Q,H)&&qr(Q,H,C,D))return!0;var C,D,Q,H,X,ie;return!1}function In(f,u){for(let m=0;m<f.length;++m)if(!Ot(f[m],u))return!1;for(let m=0;m<f.length-1;++m)if(Ci(f[m],f[m+1],u))return!1;return!0}function qn(f,u){for(let m=0;m<u.length;m++)if(In(f,u[m]))return!0;return!1}function os(f,u,m){const C=[];for(let D=0;D<f.length;D++){const Q=[];for(let H=0;H<f[D].length;H++){const X=Je(f[D][H],m);Ja(u,X),Q.push(X)}C.push(Q)}return C}function _n(f,u,m){const C=[];for(let D=0;D<f.length;D++){const Q=os(f[D],u,m);C.push(Q)}return C}function fu(f,u,m,C){if(f[0]<m[0]||f[0]>m[2]){const D=.5*C;let Q=f[0]-m[0]>D?-C:m[0]-f[0]>D?C:0;Q===0&&(Q=f[0]-m[2]>D?-C:m[2]-f[0]>D?C:0),f[0]+=Q}Ja(u,f)}function Hl(f,u,m,C){const D=Math.pow(2,C.z)*Ys,Q=[C.x*Ys,C.y*Ys],H=[];for(const X of f)for(const ie of X){const de=[ie.x+Q[0],ie.y+Q[1]];fu(de,u,m,D),H.push(de)}return H}function Ei(f,u,m,C){const D=Math.pow(2,C.z)*Ys,Q=[C.x*Ys,C.y*Ys],H=[];for(const ie of f){const de=[];for(const h of ie){const c=[h.x+Q[0],h.y+Q[1]];Ja(u,c),de.push(c)}H.push(de)}if(u[2]-u[0]<=D/2){(X=u)[0]=X[1]=1/0,X[2]=X[3]=-1/0;for(const ie of H)for(const de of ie)fu(de,u,m,D)}var X;return H}class Ya{constructor(u,m){this.type=Lr,this.geojson=u,this.geometries=m}static parse(u,m){if(u.length!==2)return m.error(`'within' expression requires exactly one argument, but found ${u.length-1} instead.`);if(Nn(u[1])){const C=u[1];if(C.type==="FeatureCollection"){const D=[];for(const Q of C.features){const{type:H,coordinates:X}=Q.geometry;H==="Polygon"&&D.push(X),H==="MultiPolygon"&&D.push(...X)}if(D.length)return new Ya(C,{type:"MultiPolygon",coordinates:D})}else if(C.type==="Feature"){const D=C.geometry.type;if(D==="Polygon"||D==="MultiPolygon")return new Ya(C,C.geometry)}else if(C.type==="Polygon"||C.type==="MultiPolygon")return new Ya(C,C)}return m.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(u){if(u.geometry()!=null&&u.canonicalID()!=null){if(u.geometryType()==="Point")return function(m,C){const D=[1/0,1/0,-1/0,-1/0],Q=[1/0,1/0,-1/0,-1/0],H=m.canonicalID();if(C.type==="Polygon"){const X=os(C.coordinates,Q,H),ie=Hl(m.geometry(),D,Q,H);if(!He(D,Q))return!1;for(const de of ie)if(!Ot(de,X))return!1}if(C.type==="MultiPolygon"){const X=_n(C.coordinates,Q,H),ie=Hl(m.geometry(),D,Q,H);if(!He(D,Q))return!1;for(const de of ie)if(!fr(de,X))return!1}return!0}(u,this.geometries);if(u.geometryType()==="LineString")return function(m,C){const D=[1/0,1/0,-1/0,-1/0],Q=[1/0,1/0,-1/0,-1/0],H=m.canonicalID();if(C.type==="Polygon"){const X=os(C.coordinates,Q,H),ie=Ei(m.geometry(),D,Q,H);if(!He(D,Q))return!1;for(const de of ie)if(!In(de,X))return!1}if(C.type==="MultiPolygon"){const X=_n(C.coordinates,Q,H),ie=Ei(m.geometry(),D,Q,H);if(!He(D,Q))return!1;for(const de of ie)if(!qn(de,X))return!1}return!0}(u,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Gl{constructor(u,m){this.type=m.type,this.name=u,this.boundExpression=m}static parse(u,m){if(u.length!==2||typeof u[1]!="string")return m.error("'var' expression requires exactly one string literal argument.");const C=u[1];return m.scope.has(C)?new Gl(C,m.scope.get(C)):m.error(`Unknown variable "${C}". Make sure "${C}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(u){return this.boundExpression.evaluate(u)}eachChild(){}outputDefined(){return!1}}class as{constructor(u,m,C,D){this.name=u,this.type=m,this._evaluate=C,this.args=D}evaluate(u){return this._evaluate(u,this.args)}eachChild(u){this.args.forEach(u)}outputDefined(){return!1}static parse(u,m){const C=u[0],D=as.definitions[C];if(!D)return m.error(`Unknown expression "${C}". If you wanted a literal array, use ["literal", [...]].`,0);const Q=Array.isArray(D)?D[0]:D.type,H=Array.isArray(D)?[[D[1],D[2]]]:D.overloads,X=H.filter(de=>{let[h]=de;return!Array.isArray(h)||h.length===u.length-1});let ie=null;for(const[de,h]of X){ie=new Mi(m.registry,Lo,m.path,null,m.scope);const c=[];let d=!1;for(let v=1;v<u.length;v++){const S=u[v],P=Array.isArray(de)?de[v-1]:de.type,k=ie.parse(S,1+c.length,P);if(!k){d=!0;break}c.push(k)}if(!d)if(Array.isArray(de)&&de.length!==c.length)ie.error(`Expected ${de.length} arguments, but found ${c.length} instead.`);else{for(let v=0;v<c.length;v++){const S=Array.isArray(de)?de[v]:de.type,P=c[v];ie.concat(v+1).checkSubtype(S,P.type)}if(ie.errors.length===0)return new as(C,Q,h,c)}}if(X.length===1)m.errors.push(...ie.errors);else{const de=(X.length?X:H).map(c=>{let[d]=c;return v=d,Array.isArray(v)?`(${v.map(Ae).join(", ")})`:`(${Ae(v.type)}...)`;var v}).join(" | "),h=[];for(let c=1;c<u.length;c++){const d=m.parse(u[c],1+h.length);if(!d)return null;h.push(Ae(d.type))}m.error(`Expected arguments of type ${de}, but found (${h.join(", ")}) instead.`)}return null}static register(u,m){as.definitions=m;for(const C in m)u[C]=as}}function Lo(f){if(f instanceof Gl)return Lo(f.boundExpression);if(f instanceof as&&f.name==="error"||f instanceof Za||f instanceof Ya)return!1;const u=f instanceof Tn||f instanceof ss;let m=!0;return f.eachChild(C=>{m=u?m&&Lo(C):m&&C instanceof Fs}),!!m&&Ia(f)&&La(f,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ia(f){if(f instanceof as&&(f.name==="get"&&f.args.length===1||f.name==="feature-state"||f.name==="has"&&f.args.length===1||f.name==="properties"||f.name==="geometry-type"||f.name==="id"||/^filter-/.test(f.name))||f instanceof Ya)return!1;let u=!0;return f.eachChild(m=>{u&&!Ia(m)&&(u=!1)}),u}function ys(f){if(f instanceof as&&f.name==="feature-state")return!1;let u=!0;return f.eachChild(m=>{u&&!ys(m)&&(u=!1)}),u}function La(f,u){if(f instanceof as&&u.indexOf(f.name)>=0)return!1;let m=!0;return f.eachChild(C=>{m&&!La(C,u)&&(m=!1)}),m}function el(f,u){const m=f.length-1;let C,D,Q=0,H=m,X=0;for(;Q<=H;)if(X=Math.floor((Q+H)/2),C=f[X],D=f[X+1],C<=u){if(X===m||u<D)return X;Q=X+1}else{if(!(C>u))throw new bi("Input is not a number.");H=X-1}return 0}class Aa{constructor(u,m,C){this.type=u,this.input=m,this.labels=[],this.outputs=[];for(const[D,Q]of C)this.labels.push(D),this.outputs.push(Q)}static parse(u,m){if(u.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return m.error("Expected an even number of arguments.");const C=m.parse(u[1],1,Qt);if(!C)return null;const D=[];let Q=null;m.expectedType&&m.expectedType.kind!=="value"&&(Q=m.expectedType);for(let H=1;H<u.length;H+=2){const X=H===1?-1/0:u[H],ie=u[H+1],de=H,h=H+1;if(typeof X!="number")return m.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',de);if(D.length&&D[D.length-1][0]>=X)return m.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',de);const c=m.parse(ie,h,Q);if(!c)return null;Q=Q||c.type,D.push([X,c])}return new Aa(Q,C,D)}evaluate(u){const m=this.labels,C=this.outputs;if(m.length===1)return C[0].evaluate(u);const D=this.input.evaluate(u);if(D<=m[0])return C[0].evaluate(u);const Q=m.length;return D>=m[Q-1]?C[Q-1].evaluate(u):C[el(m,D)].evaluate(u)}eachChild(u){u(this.input);for(const m of this.outputs)u(m)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}}function Vc(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var tl=yo;function yo(f,u,m,C){this.cx=3*f,this.bx=3*(m-f)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(C-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=f,this.p1y=u,this.p2x=m,this.p2y=C}yo.prototype={sampleCurveX:function(f){return((this.ax*f+this.bx)*f+this.cx)*f},sampleCurveY:function(f){return((this.ay*f+this.by)*f+this.cy)*f},sampleCurveDerivativeX:function(f){return(3*this.ax*f+2*this.bx)*f+this.cx},solveCurveX:function(f,u){if(u===void 0&&(u=1e-6),f<0)return 0;if(f>1)return 1;for(var m=f,C=0;C<8;C++){var D=this.sampleCurveX(m)-f;if(Math.abs(D)<u)return m;var Q=this.sampleCurveDerivativeX(m);if(Math.abs(Q)<1e-6)break;m-=D/Q}var H=0,X=1;for(m=f,C=0;C<20&&(D=this.sampleCurveX(m),!(Math.abs(D-f)<u));C++)f>D?H=m:X=m,m=.5*(X-H)+H;return m},solve:function(f,u){return this.sampleCurveY(this.solveCurveX(f,u))}};var Fi=Vc(tl);function da(f,u,m){return f+m*(u-f)}function As(f,u,m){return f.map((C,D)=>da(C,u[D],m))}const En={number:da,color:function(f,u,m){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[D,Q,H,X]=As(f.rgb,u.rgb,m);return new mi(D,Q,H,X,!1)}case"hcl":{const[D,Q,H,X]=f.hcl,[ie,de,h,c]=u.hcl;let d,v;if(isNaN(D)||isNaN(ie))isNaN(D)?isNaN(ie)?d=NaN:(d=ie,H!==1&&H!==0||(v=de)):(d=D,h!==1&&h!==0||(v=Q));else{let W=ie-D;ie>D&&W>180?W-=360:ie<D&&D-ie>180&&(W+=360),d=D+m*W}const[S,P,k,G]=function(W){let[ee,ae,fe,me]=W;return ee=isNaN(ee)?0:ee*rr,zr([fe,Math.cos(ee)*ae,Math.sin(ee)*ae,me])}([d,v??da(Q,de,m),da(H,h,m),da(X,c,m)]);return new mi(S,P,k,G,!1)}case"lab":{const[D,Q,H,X]=zr(As(f.lab,u.lab,m));return new mi(D,Q,H,X,!1)}}},array:As,padding:function(f,u,m){return new jn(As(f.values,u.values,m))},variableAnchorOffsetCollection:function(f,u,m){const C=f.values,D=u.values;if(C.length!==D.length)throw new bi(`Cannot interpolate values of different length. from: ${f.toString()}, to: ${u.toString()}`);const Q=[];for(let H=0;H<C.length;H+=2){if(C[H]!==D[H])throw new bi(`Cannot interpolate values containing mismatched anchors. from[${H}]: ${C[H]}, to[${H}]: ${D[H]}`);Q.push(C[H]);const[X,ie]=C[H+1],[de,h]=D[H+1];Q.push([da(X,de,m),da(ie,h,m)])}return new Ui(Q)}};class ds{constructor(u,m,C,D,Q){this.type=u,this.operator=m,this.interpolation=C,this.input=D,this.labels=[],this.outputs=[];for(const[H,X]of Q)this.labels.push(H),this.outputs.push(X)}static interpolationFactor(u,m,C,D){let Q=0;if(u.name==="exponential")Q=fa(m,u.base,C,D);else if(u.name==="linear")Q=fa(m,1,C,D);else if(u.name==="cubic-bezier"){const H=u.controlPoints;Q=new Fi(H[0],H[1],H[2],H[3]).solve(fa(m,1,C,D))}return Q}static parse(u,m){let[C,D,Q,...H]=u;if(!Array.isArray(D)||D.length===0)return m.error("Expected an interpolation type expression.",1);if(D[0]==="linear")D={name:"linear"};else if(D[0]==="exponential"){const de=D[1];if(typeof de!="number")return m.error("Exponential interpolation requires a numeric base.",1,1);D={name:"exponential",base:de}}else{if(D[0]!=="cubic-bezier")return m.error(`Unknown interpolation type ${String(D[0])}`,1,0);{const de=D.slice(1);if(de.length!==4||de.some(h=>typeof h!="number"||h<0||h>1))return m.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);D={name:"cubic-bezier",controlPoints:de}}}if(u.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if((u.length-1)%2!=0)return m.error("Expected an even number of arguments.");if(Q=m.parse(Q,2,Qt),!Q)return null;const X=[];let ie=null;C==="interpolate-hcl"||C==="interpolate-lab"?ie=Xt:m.expectedType&&m.expectedType.kind!=="value"&&(ie=m.expectedType);for(let de=0;de<H.length;de+=2){const h=H[de],c=H[de+1],d=de+3,v=de+4;if(typeof h!="number")return m.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',d);if(X.length&&X[X.length-1][0]>=h)return m.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',d);const S=m.parse(c,v,ie);if(!S)return null;ie=ie||S.type,X.push([h,S])}return Fe(ie,Qt)||Fe(ie,Xt)||Fe(ie,Qe)||Fe(ie,ue)||Fe(ie,re(Qt))?new ds(ie,C,D,Q,X):m.error(`Type ${Ae(ie)} is not interpolatable.`)}evaluate(u){const m=this.labels,C=this.outputs;if(m.length===1)return C[0].evaluate(u);const D=this.input.evaluate(u);if(D<=m[0])return C[0].evaluate(u);const Q=m.length;if(D>=m[Q-1])return C[Q-1].evaluate(u);const H=el(m,D),X=ds.interpolationFactor(this.interpolation,D,m[H],m[H+1]),ie=C[H].evaluate(u),de=C[H+1].evaluate(u);switch(this.operator){case"interpolate":return En[this.type.kind](ie,de,X);case"interpolate-hcl":return En.color(ie,de,X,"hcl");case"interpolate-lab":return En.color(ie,de,X,"lab")}}eachChild(u){u(this.input);for(const m of this.outputs)u(m)}outputDefined(){return this.outputs.every(u=>u.outputDefined())}}function fa(f,u,m,C){const D=C-m,Q=f-m;return D===0?0:u===1?Q/D:(Math.pow(u,Q)-1)/(Math.pow(u,D)-1)}class qi{constructor(u,m){this.type=u,this.args=m}static parse(u,m){if(u.length<2)return m.error("Expectected at least one argument.");let C=null;const D=m.expectedType;D&&D.kind!=="value"&&(C=D);const Q=[];for(const X of u.slice(1)){const ie=m.parse(X,1+Q.length,C,void 0,{typeAnnotation:"omit"});if(!ie)return null;C=C||ie.type,Q.push(ie)}if(!C)throw new Error("No output type");const H=D&&Q.some(X=>xe(D,X.type));return new qi(H?er:C,Q)}evaluate(u){let m,C=null,D=0;for(const Q of this.args)if(D++,C=Q.evaluate(u),C&&C instanceof Bn&&!C.available&&(m||(m=C.name),C=null,D===this.args.length&&(C=m)),C!==null)break;return C}eachChild(u){this.args.forEach(u)}outputDefined(){return this.args.every(u=>u.outputDefined())}}class dl{constructor(u,m){this.type=m.type,this.bindings=[].concat(u),this.result=m}evaluate(u){return this.result.evaluate(u)}eachChild(u){for(const m of this.bindings)u(m[1]);u(this.result)}static parse(u,m){if(u.length<4)return m.error(`Expected at least 3 arguments, but found ${u.length-1} instead.`);const C=[];for(let Q=1;Q<u.length-1;Q+=2){const H=u[Q];if(typeof H!="string")return m.error(`Expected string, but found ${typeof H} instead.`,Q);if(/[^a-zA-Z0-9_]/.test(H))return m.error("Variable names must contain only alphanumeric characters or '_'.",Q);const X=m.parse(u[Q+1],Q+1);if(!X)return null;C.push([H,X])}const D=m.parse(u[u.length-1],u.length-1,m.expectedType,C);return D?new dl(C,D):null}outputDefined(){return this.result.outputDefined()}}class jl{constructor(u,m,C){this.type=u,this.index=m,this.input=C}static parse(u,m){if(u.length!==3)return m.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,Qt),D=m.parse(u[2],2,re(m.expectedType||er));return C&&D?new jl(D.type.itemType,C,D):null}evaluate(u){const m=this.index.evaluate(u),C=this.input.evaluate(u);if(m<0)throw new bi(`Array index out of bounds: ${m} < 0.`);if(m>=C.length)throw new bi(`Array index out of bounds: ${m} > ${C.length-1}.`);if(m!==Math.floor(m))throw new bi(`Array index must be an integer, but found ${m} instead.`);return C[m]}eachChild(u){u(this.index),u(this.input)}outputDefined(){return!1}}class Mo{constructor(u,m){this.type=Lr,this.needle=u,this.haystack=m}static parse(u,m){if(u.length!==3)return m.error(`Expected 2 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,er),D=m.parse(u[2],2,er);return C&&D?Ee(C.type,[Lr,Tr,Qt,di,er])?new Mo(C,D):m.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ae(C.type)} instead`):null}evaluate(u){const m=this.needle.evaluate(u),C=this.haystack.evaluate(u);if(!C)return!1;if(!we(m,["boolean","string","number","null"]))throw new bi(`Expected first argument to be of type boolean, string, number or null, but found ${Ae(Zr(m))} instead.`);if(!we(C,["string","array"]))throw new bi(`Expected second argument to be of type array or string, but found ${Ae(Zr(C))} instead.`);return C.indexOf(m)>=0}eachChild(u){u(this.needle),u(this.haystack)}outputDefined(){return!0}}class Zo{constructor(u,m,C){this.type=Qt,this.needle=u,this.haystack=m,this.fromIndex=C}static parse(u,m){if(u.length<=2||u.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,er),D=m.parse(u[2],2,er);if(!C||!D)return null;if(!Ee(C.type,[Lr,Tr,Qt,di,er]))return m.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ae(C.type)} instead`);if(u.length===4){const Q=m.parse(u[3],3,Qt);return Q?new Zo(C,D,Q):null}return new Zo(C,D)}evaluate(u){const m=this.needle.evaluate(u),C=this.haystack.evaluate(u);if(!we(m,["boolean","string","number","null"]))throw new bi(`Expected first argument to be of type boolean, string, number or null, but found ${Ae(Zr(m))} instead.`);if(!we(C,["string","array"]))throw new bi(`Expected second argument to be of type array or string, but found ${Ae(Zr(C))} instead.`);if(this.fromIndex){const D=this.fromIndex.evaluate(u);return C.indexOf(m,D)}return C.indexOf(m)}eachChild(u){u(this.needle),u(this.haystack),this.fromIndex&&u(this.fromIndex)}outputDefined(){return!1}}class bc{constructor(u,m,C,D,Q,H){this.inputType=u,this.type=m,this.input=C,this.cases=D,this.outputs=Q,this.otherwise=H}static parse(u,m){if(u.length<5)return m.error(`Expected at least 4 arguments, but found only ${u.length-1}.`);if(u.length%2!=1)return m.error("Expected an even number of arguments.");let C,D;m.expectedType&&m.expectedType.kind!=="value"&&(D=m.expectedType);const Q={},H=[];for(let de=2;de<u.length-1;de+=2){let h=u[de];const c=u[de+1];Array.isArray(h)||(h=[h]);const d=m.concat(de);if(h.length===0)return d.error("Expected at least one branch label.");for(const S of h){if(typeof S!="number"&&typeof S!="string")return d.error("Branch labels must be numbers or strings.");if(typeof S=="number"&&Math.abs(S)>Number.MAX_SAFE_INTEGER)return d.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof S=="number"&&Math.floor(S)!==S)return d.error("Numeric branch labels must be integer values.");if(C){if(d.checkSubtype(C,Zr(S)))return null}else C=Zr(S);if(Q[String(S)]!==void 0)return d.error("Branch labels must be unique.");Q[String(S)]=H.length}const v=m.parse(c,de,D);if(!v)return null;D=D||v.type,H.push(v)}const X=m.parse(u[1],1,er);if(!X)return null;const ie=m.parse(u[u.length-1],u.length-1,D);return ie?X.type.kind!=="value"&&m.concat(1).checkSubtype(C,X.type)?null:new bc(C,D,X,Q,H,ie):null}evaluate(u){const m=this.input.evaluate(u);return(Zr(m)===this.inputType&&this.outputs[this.cases[m]]||this.otherwise).evaluate(u)}eachChild(u){u(this.input),this.outputs.forEach(u),u(this.otherwise)}outputDefined(){return this.outputs.every(u=>u.outputDefined())&&this.otherwise.outputDefined()}}class Jo{constructor(u,m,C){this.type=u,this.branches=m,this.otherwise=C}static parse(u,m){if(u.length<4)return m.error(`Expected at least 3 arguments, but found only ${u.length-1}.`);if(u.length%2!=0)return m.error("Expected an odd number of arguments.");let C;m.expectedType&&m.expectedType.kind!=="value"&&(C=m.expectedType);const D=[];for(let H=1;H<u.length-1;H+=2){const X=m.parse(u[H],H,Lr);if(!X)return null;const ie=m.parse(u[H+1],H+1,C);if(!ie)return null;D.push([X,ie]),C=C||ie.type}const Q=m.parse(u[u.length-1],u.length-1,C);if(!Q)return null;if(!C)throw new Error("Can't infer output type");return new Jo(C,D,Q)}evaluate(u){for(const[m,C]of this.branches)if(m.evaluate(u))return C.evaluate(u);return this.otherwise.evaluate(u)}eachChild(u){for(const[m,C]of this.branches)u(m),u(C);u(this.otherwise)}outputDefined(){return this.branches.every(u=>{let[m,C]=u;return C.outputDefined()})&&this.otherwise.outputDefined()}}class _o{constructor(u,m,C,D){this.type=u,this.input=m,this.beginIndex=C,this.endIndex=D}static parse(u,m){if(u.length<=2||u.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${u.length-1} instead.`);const C=m.parse(u[1],1,er),D=m.parse(u[2],2,Qt);if(!C||!D)return null;if(!Ee(C.type,[re(er),Tr,er]))return m.error(`Expected first argument to be of type array or string, but found ${Ae(C.type)} instead`);if(u.length===4){const Q=m.parse(u[3],3,Qt);return Q?new _o(C.type,C,D,Q):null}return new _o(C.type,C,D)}evaluate(u){const m=this.input.evaluate(u),C=this.beginIndex.evaluate(u);if(!we(m,["string","array"]))throw new bi(`Expected first argument to be of type array or string, but found ${Ae(Zr(m))} instead.`);if(this.endIndex){const D=this.endIndex.evaluate(u);return m.slice(C,D)}return m.slice(C)}eachChild(u){u(this.input),u(this.beginIndex),this.endIndex&&u(this.endIndex)}outputDefined(){return!1}}function xc(f,u){return f==="=="||f==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function Yo(f,u,m,C){return C.compare(u,m)===0}function ql(f,u,m){const C=f!=="=="&&f!=="!=";return class Fz{constructor(Q,H,X){this.type=Lr,this.lhs=Q,this.rhs=H,this.collator=X,this.hasUntypedArgument=Q.type.kind==="value"||H.type.kind==="value"}static parse(Q,H){if(Q.length!==3&&Q.length!==4)return H.error("Expected two or three arguments.");const X=Q[0];let ie=H.parse(Q[1],1,er);if(!ie)return null;if(!xc(X,ie.type))return H.concat(1).error(`"${X}" comparisons are not supported for type '${Ae(ie.type)}'.`);let de=H.parse(Q[2],2,er);if(!de)return null;if(!xc(X,de.type))return H.concat(2).error(`"${X}" comparisons are not supported for type '${Ae(de.type)}'.`);if(ie.type.kind!==de.type.kind&&ie.type.kind!=="value"&&de.type.kind!=="value")return H.error(`Cannot compare types '${Ae(ie.type)}' and '${Ae(de.type)}'.`);C&&(ie.type.kind==="value"&&de.type.kind!=="value"?ie=new ss(de.type,[ie]):ie.type.kind!=="value"&&de.type.kind==="value"&&(de=new ss(ie.type,[de])));let h=null;if(Q.length===4){if(ie.type.kind!=="string"&&de.type.kind!=="string"&&ie.type.kind!=="value"&&de.type.kind!=="value")return H.error("Cannot use collator to compare non-string types.");if(h=H.parse(Q[3],3,vi),!h)return null}return new Fz(ie,de,h)}evaluate(Q){const H=this.lhs.evaluate(Q),X=this.rhs.evaluate(Q);if(C&&this.hasUntypedArgument){const ie=Zr(H),de=Zr(X);if(ie.kind!==de.kind||ie.kind!=="string"&&ie.kind!=="number")throw new bi(`Expected arguments for "${f}" to be (string, string) or (number, number), but found (${ie.kind}, ${de.kind}) instead.`)}if(this.collator&&!C&&this.hasUntypedArgument){const ie=Zr(H),de=Zr(X);if(ie.kind!=="string"||de.kind!=="string")return u(Q,H,X)}return this.collator?m(Q,H,X,this.collator.evaluate(Q)):u(Q,H,X)}eachChild(Q){Q(this.lhs),Q(this.rhs),this.collator&&Q(this.collator)}outputDefined(){return!0}}}const Hc=ql("==",function(f,u,m){return u===m},Yo),Eh=ql("!=",function(f,u,m){return u!==m},function(f,u,m,C){return!Yo(0,u,m,C)}),pu=ql("<",function(f,u,m){return u<m},function(f,u,m,C){return C.compare(u,m)<0}),gu=ql(">",function(f,u,m){return u>m},function(f,u,m,C){return C.compare(u,m)>0}),Vu=ql("<=",function(f,u,m){return u<=m},function(f,u,m,C){return C.compare(u,m)<=0}),$l=ql(">=",function(f,u,m){return u>=m},function(f,u,m,C){return C.compare(u,m)>=0});class rl{constructor(u,m,C,D,Q){this.type=Tr,this.number=u,this.locale=m,this.currency=C,this.minFractionDigits=D,this.maxFractionDigits=Q}static parse(u,m){if(u.length!==3)return m.error("Expected two arguments.");const C=m.parse(u[1],1,Qt);if(!C)return null;const D=u[2];if(typeof D!="object"||Array.isArray(D))return m.error("NumberFormat options argument must be an object.");let Q=null;if(D.locale&&(Q=m.parse(D.locale,1,Tr),!Q))return null;let H=null;if(D.currency&&(H=m.parse(D.currency,1,Tr),!H))return null;let X=null;if(D["min-fraction-digits"]&&(X=m.parse(D["min-fraction-digits"],1,Qt),!X))return null;let ie=null;return D["max-fraction-digits"]&&(ie=m.parse(D["max-fraction-digits"],1,Qt),!ie)?null:new rl(C,Q,H,X,ie)}evaluate(u){return new Intl.NumberFormat(this.locale?this.locale.evaluate(u):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(u):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(u):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(u):void 0}).format(this.number.evaluate(u))}eachChild(u){u(this.number),this.locale&&u(this.locale),this.currency&&u(this.currency),this.minFractionDigits&&u(this.minFractionDigits),this.maxFractionDigits&&u(this.maxFractionDigits)}outputDefined(){return!1}}class il{constructor(u){this.type=Zi,this.sections=u}static parse(u,m){if(u.length<2)return m.error("Expected at least one argument.");const C=u[1];if(!Array.isArray(C)&&typeof C=="object")return m.error("First argument must be an image or text section.");const D=[];let Q=!1;for(let H=1;H<=u.length-1;++H){const X=u[H];if(Q&&typeof X=="object"&&!Array.isArray(X)){Q=!1;let ie=null;if(X["font-scale"]&&(ie=m.parse(X["font-scale"],1,Qt),!ie))return null;let de=null;if(X["text-font"]&&(de=m.parse(X["text-font"],1,re(Tr)),!de))return null;let h=null;if(X["text-color"]&&(h=m.parse(X["text-color"],1,Xt),!h))return null;const c=D[D.length-1];c.scale=ie,c.font=de,c.textColor=h}else{const ie=m.parse(u[H],1,er);if(!ie)return null;const de=ie.type.kind;if(de!=="string"&&de!=="value"&&de!=="null"&&de!=="resolvedImage")return m.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");Q=!0,D.push({content:ie,scale:null,font:null,textColor:null})}}return new il(D)}evaluate(u){return new fi(this.sections.map(m=>{const C=m.content.evaluate(u);return Zr(C)===Be?new yn("",C,null,null,null):new yn(co(C),null,m.scale?m.scale.evaluate(u):null,m.font?m.font.evaluate(u).join(","):null,m.textColor?m.textColor.evaluate(u):null)}))}eachChild(u){for(const m of this.sections)u(m.content),m.scale&&u(m.scale),m.font&&u(m.font),m.textColor&&u(m.textColor)}outputDefined(){return!1}}class Kl{constructor(u){this.type=Be,this.input=u}static parse(u,m){if(u.length!==2)return m.error("Expected two arguments.");const C=m.parse(u[1],1,Tr);return C?new Kl(C):m.error("No image name provided.")}evaluate(u){const m=this.input.evaluate(u),C=Bn.fromString(m);return C&&u.availableImages&&(C.available=u.availableImages.indexOf(m)>-1),C}eachChild(u){u(this.input)}outputDefined(){return!1}}class nl{constructor(u){this.type=Qt,this.input=u}static parse(u,m){if(u.length!==2)return m.error(`Expected 1 argument, but found ${u.length-1} instead.`);const C=m.parse(u[1],1);return C?C.type.kind!=="array"&&C.type.kind!=="string"&&C.type.kind!=="value"?m.error(`Expected argument of type string or array, but found ${Ae(C.type)} instead.`):new nl(C):null}evaluate(u){const m=this.input.evaluate(u);if(typeof m=="string"||Array.isArray(m))return m.length;throw new bi(`Expected value to be of type string or array, but found ${Ae(Zr(m))} instead.`)}eachChild(u){u(this.input)}outputDefined(){return!1}}const pa={"==":Hc,"!=":Eh,">":gu,"<":pu,">=":$l,"<=":Vu,array:ss,at:jl,boolean:ss,case:Jo,coalesce:qi,collator:Za,format:il,image:Kl,in:Mo,"index-of":Zo,interpolate:ds,"interpolate-hcl":ds,"interpolate-lab":ds,length:nl,let:dl,literal:Fs,match:bc,number:ss,"number-format":rl,object:ss,slice:_o,step:Aa,string:ss,"to-boolean":Tn,"to-color":Tn,"to-number":Tn,"to-string":Tn,var:Gl,within:Ya};function fl(f,u){let[m,C,D,Q]=u;m=m.evaluate(f),C=C.evaluate(f),D=D.evaluate(f);const H=Q?Q.evaluate(f):1,X=Xa(m,C,D,H);if(X)throw new bi(X);return new mi(m/255,C/255,D/255,H,!1)}function Wl(f,u){return f in u}function uo(f,u){const m=u[f];return m===void 0?null:m}function ga(f){return{type:f}}function ne(f){return{result:"success",value:f}}function Pe(f){return{result:"error",value:f}}function ct(f){return f["property-type"]==="data-driven"||f["property-type"]==="cross-faded-data-driven"}function _t(f){return!!f.expression&&f.expression.parameters.indexOf("zoom")>-1}function xt(f){return!!f.expression&&f.expression.interpolated}function Lt(f){return f instanceof Number?"number":f instanceof String?"string":f instanceof Boolean?"boolean":Array.isArray(f)?"array":f===null?"null":typeof f}function gr(f){return typeof f=="object"&&f!==null&&!Array.isArray(f)}function sr(f){return f}function si(f,u){const m=u.type==="color",C=f.stops&&typeof f.stops[0][0]=="object",D=C||!(C||f.property!==void 0),Q=f.type||(xt(u)?"exponential":"interval");if(m||u.type==="padding"){const h=m?mi.parse:jn.parse;(f=Xr({},f)).stops&&(f.stops=f.stops.map(c=>[c[0],h(c[1])])),f.default=h(f.default?f.default:u.default)}if(f.colorSpace&&(H=f.colorSpace)!=="rgb"&&H!=="hcl"&&H!=="lab")throw new Error(`Unknown color space: "${f.colorSpace}"`);var H;let X,ie,de;if(Q==="exponential")X=$n;else if(Q==="interval")X=ui;else if(Q==="categorical"){X=ei,ie=Object.create(null);for(const h of f.stops)ie[h[0]]=h[1];de=typeof f.stops[0][0]}else{if(Q!=="identity")throw new Error(`Unknown function type "${Q}"`);X=ai}if(C){const h={},c=[];for(let S=0;S<f.stops.length;S++){const P=f.stops[S],k=P[0].zoom;h[k]===void 0&&(h[k]={zoom:k,type:f.type,property:f.property,default:f.default,stops:[]},c.push(k)),h[k].stops.push([P[0].value,P[1]])}const d=[];for(const S of c)d.push([h[S].zoom,si(h[S],u)]);const v={name:"linear"};return{kind:"composite",interpolationType:v,interpolationFactor:ds.interpolationFactor.bind(void 0,v),zoomStops:d.map(S=>S[0]),evaluate:(S,P)=>{let{zoom:k}=S;return $n({stops:d,base:f.base},u,k).evaluate(k,P)}}}if(D){const h=Q==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:h,interpolationFactor:ds.interpolationFactor.bind(void 0,h),zoomStops:f.stops.map(c=>c[0]),evaluate:c=>{let{zoom:d}=c;return X(f,u,d,ie,de)}}}return{kind:"source",evaluate(h,c){const d=c&&c.properties?c.properties[f.property]:void 0;return d===void 0?$r(f.default,u.default):X(f,u,d,ie,de)}}}function $r(f,u,m){return f!==void 0?f:u!==void 0?u:m!==void 0?m:void 0}function ei(f,u,m,C,D){return $r(typeof m===D?C[m]:void 0,f.default,u.default)}function ui(f,u,m){if(Lt(m)!=="number")return $r(f.default,u.default);const C=f.stops.length;if(C===1||m<=f.stops[0][0])return f.stops[0][1];if(m>=f.stops[C-1][0])return f.stops[C-1][1];const D=el(f.stops.map(Q=>Q[0]),m);return f.stops[D][1]}function $n(f,u,m){const C=f.base!==void 0?f.base:1;if(Lt(m)!=="number")return $r(f.default,u.default);const D=f.stops.length;if(D===1||m<=f.stops[0][0])return f.stops[0][1];if(m>=f.stops[D-1][0])return f.stops[D-1][1];const Q=el(f.stops.map(h=>h[0]),m),H=function(h,c,d,v){const S=v-d,P=h-d;return S===0?0:c===1?P/S:(Math.pow(c,P)-1)/(Math.pow(c,S)-1)}(m,C,f.stops[Q][0],f.stops[Q+1][0]),X=f.stops[Q][1],ie=f.stops[Q+1][1],de=En[u.type]||sr;return typeof X.evaluate=="function"?{evaluate(){for(var h=arguments.length,c=new Array(h),d=0;d<h;d++)c[d]=arguments[d];const v=X.evaluate.apply(void 0,c),S=ie.evaluate.apply(void 0,c);if(v!==void 0&&S!==void 0)return de(v,S,H,f.colorSpace)}}:de(X,ie,H,f.colorSpace)}function ai(f,u,m){switch(u.type){case"color":m=mi.parse(m);break;case"formatted":m=fi.fromString(m.toString());break;case"resolvedImage":m=Bn.fromString(m.toString());break;case"padding":m=jn.parse(m);break;default:Lt(m)===u.type||u.type==="enum"&&u.values[m]||(m=void 0)}return $r(m,f.default,u.default)}as.register(pa,{error:[{kind:"error"},[Tr],(f,u)=>{let[m]=u;throw new bi(m.evaluate(f))}],typeof:[Tr,[er],(f,u)=>{let[m]=u;return Ae(Zr(m.evaluate(f)))}],"to-rgba":[re(Qt,4),[Xt],(f,u)=>{let[m]=u;const[C,D,Q,H]=m.evaluate(f).rgb;return[255*C,255*D,255*Q,H]}],rgb:[Xt,[Qt,Qt,Qt],fl],rgba:[Xt,[Qt,Qt,Qt,Qt],fl],has:{type:Lr,overloads:[[[Tr],(f,u)=>{let[m]=u;return Wl(m.evaluate(f),f.properties())}],[[Tr,xr],(f,u)=>{let[m,C]=u;return Wl(m.evaluate(f),C.evaluate(f))}]]},get:{type:er,overloads:[[[Tr],(f,u)=>{let[m]=u;return uo(m.evaluate(f),f.properties())}],[[Tr,xr],(f,u)=>{let[m,C]=u;return uo(m.evaluate(f),C.evaluate(f))}]]},"feature-state":[er,[Tr],(f,u)=>{let[m]=u;return uo(m.evaluate(f),f.featureState||{})}],properties:[xr,[],f=>f.properties()],"geometry-type":[Tr,[],f=>f.geometryType()],id:[er,[],f=>f.id()],zoom:[Qt,[],f=>f.globals.zoom],"heatmap-density":[Qt,[],f=>f.globals.heatmapDensity||0],"line-progress":[Qt,[],f=>f.globals.lineProgress||0],accumulated:[er,[],f=>f.globals.accumulated===void 0?null:f.globals.accumulated],"+":[Qt,ga(Qt),(f,u)=>{let m=0;for(const C of u)m+=C.evaluate(f);return m}],"*":[Qt,ga(Qt),(f,u)=>{let m=1;for(const C of u)m*=C.evaluate(f);return m}],"-":{type:Qt,overloads:[[[Qt,Qt],(f,u)=>{let[m,C]=u;return m.evaluate(f)-C.evaluate(f)}],[[Qt],(f,u)=>{let[m]=u;return-m.evaluate(f)}]]},"/":[Qt,[Qt,Qt],(f,u)=>{let[m,C]=u;return m.evaluate(f)/C.evaluate(f)}],"%":[Qt,[Qt,Qt],(f,u)=>{let[m,C]=u;return m.evaluate(f)%C.evaluate(f)}],ln2:[Qt,[],()=>Math.LN2],pi:[Qt,[],()=>Math.PI],e:[Qt,[],()=>Math.E],"^":[Qt,[Qt,Qt],(f,u)=>{let[m,C]=u;return Math.pow(m.evaluate(f),C.evaluate(f))}],sqrt:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.sqrt(m.evaluate(f))}],log10:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.log(m.evaluate(f))/Math.LN10}],ln:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.log(m.evaluate(f))}],log2:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.log(m.evaluate(f))/Math.LN2}],sin:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.sin(m.evaluate(f))}],cos:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.cos(m.evaluate(f))}],tan:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.tan(m.evaluate(f))}],asin:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.asin(m.evaluate(f))}],acos:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.acos(m.evaluate(f))}],atan:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.atan(m.evaluate(f))}],min:[Qt,ga(Qt),(f,u)=>Math.min(...u.map(m=>m.evaluate(f)))],max:[Qt,ga(Qt),(f,u)=>Math.max(...u.map(m=>m.evaluate(f)))],abs:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.abs(m.evaluate(f))}],round:[Qt,[Qt],(f,u)=>{let[m]=u;const C=m.evaluate(f);return C<0?-Math.round(-C):Math.round(C)}],floor:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.floor(m.evaluate(f))}],ceil:[Qt,[Qt],(f,u)=>{let[m]=u;return Math.ceil(m.evaluate(f))}],"filter-==":[Lr,[Tr,er],(f,u)=>{let[m,C]=u;return f.properties()[m.value]===C.value}],"filter-id-==":[Lr,[er],(f,u)=>{let[m]=u;return f.id()===m.value}],"filter-type-==":[Lr,[Tr],(f,u)=>{let[m]=u;return f.geometryType()===m.value}],"filter-<":[Lr,[Tr,er],(f,u)=>{let[m,C]=u;const D=f.properties()[m.value],Q=C.value;return typeof D==typeof Q&&D<Q}],"filter-id-<":[Lr,[er],(f,u)=>{let[m]=u;const C=f.id(),D=m.value;return typeof C==typeof D&&C<D}],"filter->":[Lr,[Tr,er],(f,u)=>{let[m,C]=u;const D=f.properties()[m.value],Q=C.value;return typeof D==typeof Q&&D>Q}],"filter-id->":[Lr,[er],(f,u)=>{let[m]=u;const C=f.id(),D=m.value;return typeof C==typeof D&&C>D}],"filter-<=":[Lr,[Tr,er],(f,u)=>{let[m,C]=u;const D=f.properties()[m.value],Q=C.value;return typeof D==typeof Q&&D<=Q}],"filter-id-<=":[Lr,[er],(f,u)=>{let[m]=u;const C=f.id(),D=m.value;return typeof C==typeof D&&C<=D}],"filter->=":[Lr,[Tr,er],(f,u)=>{let[m,C]=u;const D=f.properties()[m.value],Q=C.value;return typeof D==typeof Q&&D>=Q}],"filter-id->=":[Lr,[er],(f,u)=>{let[m]=u;const C=f.id(),D=m.value;return typeof C==typeof D&&C>=D}],"filter-has":[Lr,[er],(f,u)=>{let[m]=u;return m.value in f.properties()}],"filter-has-id":[Lr,[],f=>f.id()!==null&&f.id()!==void 0],"filter-type-in":[Lr,[re(Tr)],(f,u)=>{let[m]=u;return m.value.indexOf(f.geometryType())>=0}],"filter-id-in":[Lr,[re(er)],(f,u)=>{let[m]=u;return m.value.indexOf(f.id())>=0}],"filter-in-small":[Lr,[Tr,re(er)],(f,u)=>{let[m,C]=u;return C.value.indexOf(f.properties()[m.value])>=0}],"filter-in-large":[Lr,[Tr,re(er)],(f,u)=>{let[m,C]=u;return function(D,Q,H,X){for(;H<=X;){const ie=H+X>>1;if(Q[ie]===D)return!0;Q[ie]>D?X=ie-1:H=ie+1}return!1}(f.properties()[m.value],C.value,0,C.value.length-1)}],all:{type:Lr,overloads:[[[Lr,Lr],(f,u)=>{let[m,C]=u;return m.evaluate(f)&&C.evaluate(f)}],[ga(Lr),(f,u)=>{for(const m of u)if(!m.evaluate(f))return!1;return!0}]]},any:{type:Lr,overloads:[[[Lr,Lr],(f,u)=>{let[m,C]=u;return m.evaluate(f)||C.evaluate(f)}],[ga(Lr),(f,u)=>{for(const m of u)if(m.evaluate(f))return!0;return!1}]]},"!":[Lr,[Lr],(f,u)=>{let[m]=u;return!m.evaluate(f)}],"is-supported-script":[Lr,[Tr],(f,u)=>{let[m]=u;const C=f.globals&&f.globals.isSupportedScript;return!C||C(m.evaluate(f))}],upcase:[Tr,[Tr],(f,u)=>{let[m]=u;return m.evaluate(f).toUpperCase()}],downcase:[Tr,[Tr],(f,u)=>{let[m]=u;return m.evaluate(f).toLowerCase()}],concat:[Tr,ga(er),(f,u)=>u.map(m=>co(m.evaluate(f))).join("")],"resolved-locale":[Tr,[vi],(f,u)=>{let[m]=u;return m.evaluate(f).resolvedLocale()}]});class Pn{constructor(u,m){var C;this.expression=u,this._warningHistory={},this._evaluator=new mo,this._defaultValue=m?(C=m).type==="color"&&gr(C.default)?new mi(0,0,0,0):C.type==="color"?mi.parse(C.default)||null:C.type==="padding"?jn.parse(C.default)||null:C.type==="variableAnchorOffsetCollection"?Ui.parse(C.default)||null:C.default===void 0?null:C.default:null,this._enumValues=m&&m.type==="enum"?m.values:null}evaluateWithoutErrorHandling(u,m,C,D,Q,H){return this._evaluator.globals=u,this._evaluator.feature=m,this._evaluator.featureState=C,this._evaluator.canonical=D,this._evaluator.availableImages=Q||null,this._evaluator.formattedSection=H,this.expression.evaluate(this._evaluator)}evaluate(u,m,C,D,Q,H){this._evaluator.globals=u,this._evaluator.feature=m||null,this._evaluator.featureState=C||null,this._evaluator.canonical=D,this._evaluator.availableImages=Q||null,this._evaluator.formattedSection=H||null;try{const X=this.expression.evaluate(this._evaluator);if(X==null||typeof X=="number"&&X!=X)return this._defaultValue;if(this._enumValues&&!(X in this._enumValues))throw new bi(`Expected value to be one of ${Object.keys(this._enumValues).map(ie=>JSON.stringify(ie)).join(", ")}, but found ${JSON.stringify(X)} instead.`);return X}catch(X){return this._warningHistory[X.message]||(this._warningHistory[X.message]=!0,typeof console<"u"&&console.warn(X.message)),this._defaultValue}}}function Di(f){return Array.isArray(f)&&f.length>0&&typeof f[0]=="string"&&f[0]in pa}function Li(f,u){const m=new Mi(pa,Lo,[],u?function(D){const Q={color:Xt,string:Tr,number:Qt,enum:Tr,boolean:Lr,formatted:Zi,padding:Qe,resolvedImage:Be,variableAnchorOffsetCollection:ue};return D.type==="array"?re(Q[D.value]||er,D.length):Q[D.type]}(u):void 0),C=m.parse(f,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return C?ne(new Pn(C,u)):Pe(m.errors)}class Ds{constructor(u,m){this.kind=u,this._styleExpression=m,this.isStateDependent=u!=="constant"&&!ys(m.expression)}evaluateWithoutErrorHandling(u,m,C,D,Q,H){return this._styleExpression.evaluateWithoutErrorHandling(u,m,C,D,Q,H)}evaluate(u,m,C,D,Q,H){return this._styleExpression.evaluate(u,m,C,D,Q,H)}}class eo{constructor(u,m,C,D){this.kind=u,this.zoomStops=C,this._styleExpression=m,this.isStateDependent=u!=="camera"&&!ys(m.expression),this.interpolationType=D}evaluateWithoutErrorHandling(u,m,C,D,Q,H){return this._styleExpression.evaluateWithoutErrorHandling(u,m,C,D,Q,H)}evaluate(u,m,C,D,Q,H){return this._styleExpression.evaluate(u,m,C,D,Q,H)}interpolationFactor(u,m,C){return this.interpolationType?ds.interpolationFactor(this.interpolationType,u,m,C):0}}function Po(f,u){const m=Li(f,u);if(m.result==="error")return m;const C=m.value.expression,D=Ia(C);if(!D&&!ct(u))return Pe([new Ar("","data expressions not supported")]);const Q=La(C,["zoom"]);if(!Q&&!_t(u))return Pe([new Ar("","zoom expressions not supported")]);const H=ma(C);return H||Q?H instanceof Ar?Pe([H]):H instanceof ds&&!xt(u)?Pe([new Ar("",'"interpolate" expressions cannot be used with this property')]):ne(H?new eo(D?"camera":"composite",m.value,H.labels,H instanceof ds?H.interpolation:void 0):new Ds(D?"constant":"source",m.value)):Pe([new Ar("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ma{constructor(u,m){this._parameters=u,this._specification=m,Xr(this,si(this._parameters,this._specification))}static deserialize(u){return new Ma(u._parameters,u._specification)}static serialize(u){return{_parameters:u._parameters,_specification:u._specification}}}function ma(f){let u=null;if(f instanceof dl)u=ma(f.result);else if(f instanceof qi){for(const m of f.args)if(u=ma(m),u)break}else(f instanceof Aa||f instanceof ds)&&f.input instanceof as&&f.input.name==="zoom"&&(u=f);return u instanceof Ar||f.eachChild(m=>{const C=ma(m);C instanceof Ar?u=C:!u&&C?u=new Ar("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):u&&C&&u!==C&&(u=new Ar("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),u}function wc(f){if(f===!0||f===!1)return!0;if(!Array.isArray(f)||f.length===0)return!1;switch(f[0]){case"has":return f.length>=2&&f[1]!=="$id"&&f[1]!=="$type";case"in":return f.length>=3&&(typeof f[1]!="string"||Array.isArray(f[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return f.length!==3||Array.isArray(f[1])||Array.isArray(f[2]);case"any":case"all":for(const u of f.slice(1))if(!wc(u)&&typeof u!="boolean")return!1;return!0;default:return!0}}const pl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Xl(f){if(f==null)return{filter:()=>!0,needGeometry:!1};wc(f)||(f=_s(f));const u=Li(f,pl);if(u.result==="error")throw new Error(u.value.map(m=>`${m.key}: ${m.message}`).join(", "));return{filter:(m,C,D)=>u.value.evaluate(m,C,{},D),needGeometry:Pa(f)}}function Bc(f,u){return f<u?-1:f>u?1:0}function Pa(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(let u=1;u<f.length;u++)if(Pa(f[u]))return!0;return!1}function _s(f){if(!f)return!0;const u=f[0];return f.length<=1?u!=="any":u==="=="?gl(f[1],f[2],"=="):u==="!="?Da(gl(f[1],f[2],"==")):u==="<"||u===">"||u==="<="||u===">="?gl(f[1],f[2],u):u==="any"?(m=f.slice(1),["any"].concat(m.map(_s))):u==="all"?["all"].concat(f.slice(1).map(_s)):u==="none"?["all"].concat(f.slice(1).map(_s).map(Da)):u==="in"?Zl(f[1],f.slice(2)):u==="!in"?Da(Zl(f[1],f.slice(2))):u==="has"?Fa(f[1]):u==="!has"?Da(Fa(f[1])):u!=="within"||f;var m}function gl(f,u,m){switch(f){case"$type":return[`filter-type-${m}`,u];case"$id":return[`filter-id-${m}`,u];default:return[`filter-${m}`,f,u]}}function Zl(f,u){if(u.length===0)return!1;switch(f){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(m=>typeof m!=typeof u[0])?["filter-in-large",f,["literal",u.sort(Bc)]]:["filter-in-small",f,["literal",u]]}}function Fa(f){switch(f){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",f]}}function Da(f){return["!",f]}function Rs(f){const u=typeof f;if(u==="number"||u==="boolean"||u==="string"||f==null)return JSON.stringify(f);if(Array.isArray(f)){let D="[";for(const Q of f)D+=`${Rs(Q)},`;return`${D}]`}const m=Object.keys(f).sort();let C="{";for(let D=0;D<m.length;D++)C+=`${JSON.stringify(m[D])}:${Rs(f[m[D]])},`;return`${C}}`}function Hu(f){let u="";for(const m of Ur)u+=`/${Rs(f[m])}`;return u}function Ln(f){const u=f.value;return u?[new zt(f.key,u,"constants have been deprecated as of v8")]:[]}function fn(f){return f instanceof Number||f instanceof String||f instanceof Boolean?f.valueOf():f}function pn(f){if(Array.isArray(f))return f.map(pn);if(f instanceof Object&&!(f instanceof Number||f instanceof String||f instanceof Boolean)){const u={};for(const m in f)u[m]=pn(f[m]);return u}return fn(f)}function fs(f){const u=f.key,m=f.value,C=f.valueSpec||{},D=f.objectElementValidators||{},Q=f.style,H=f.styleSpec,X=f.validateSpec;let ie=[];const de=Lt(m);if(de!=="object")return[new zt(u,m,`object expected, ${de} found`)];for(const h in m){const c=h.split(".")[0],d=C[c]||C["*"];let v;if(D[c])v=D[c];else if(C[c])v=X;else if(D["*"])v=D["*"];else{if(!C["*"]){ie.push(new zt(u,m[h],`unknown property "${h}"`));continue}v=X}ie=ie.concat(v({key:(u&&`${u}.`)+h,value:m[h],valueSpec:d,style:Q,styleSpec:H,object:m,objectKey:h,validateSpec:X},m))}for(const h in C)D[h]||C[h].required&&C[h].default===void 0&&m[h]===void 0&&ie.push(new zt(u,m,`missing required property "${h}"`));return ie}function ya(f){const u=f.value,m=f.valueSpec,C=f.style,D=f.styleSpec,Q=f.key,H=f.arrayElementValidator||f.validateSpec;if(Lt(u)!=="array")return[new zt(Q,u,`array expected, ${Lt(u)} found`)];if(m.length&&u.length!==m.length)return[new zt(Q,u,`array length ${m.length} expected, length ${u.length} found`)];if(m["min-length"]&&u.length<m["min-length"])return[new zt(Q,u,`array length at least ${m["min-length"]} expected, length ${u.length} found`)];let X={type:m.value,values:m.values};D.$version<7&&(X.function=m.function),Lt(m.value)==="object"&&(X=m.value);let ie=[];for(let de=0;de<u.length;de++)ie=ie.concat(H({array:u,arrayIndex:de,value:u[de],valueSpec:X,validateSpec:f.validateSpec,style:C,styleSpec:D,key:`${Q}[${de}]`}));return ie}function Jl(f){const u=f.key,m=f.value,C=f.valueSpec;let D=Lt(m);return D==="number"&&m!=m&&(D="NaN"),D!=="number"?[new zt(u,m,`number expected, ${D} found`)]:"minimum"in C&&m<C.minimum?[new zt(u,m,`${m} is less than the minimum value ${C.minimum}`)]:"maximum"in C&&m>C.maximum?[new zt(u,m,`${m} is greater than the maximum value ${C.maximum}`)]:[]}function ho(f){const u=f.valueSpec,m=fn(f.value.type);let C,D,Q,H={};const X=m!=="categorical"&&f.value.property===void 0,ie=!X,de=Lt(f.value.stops)==="array"&&Lt(f.value.stops[0])==="array"&&Lt(f.value.stops[0][0])==="object",h=fs({key:f.key,value:f.value,valueSpec:f.styleSpec.function,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(v){if(m==="identity")return[new zt(v.key,v.value,'identity function may not have a "stops" property')];let S=[];const P=v.value;return S=S.concat(ya({key:v.key,value:P,valueSpec:v.valueSpec,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec,arrayElementValidator:c})),Lt(P)==="array"&&P.length===0&&S.push(new zt(v.key,P,"array must have at least one stop")),S},default:function(v){return v.validateSpec({key:v.key,value:v.value,valueSpec:u,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec})}}});return m==="identity"&&X&&h.push(new zt(f.key,f.value,'missing required property "property"')),m==="identity"||f.value.stops||h.push(new zt(f.key,f.value,'missing required property "stops"')),m==="exponential"&&f.valueSpec.expression&&!xt(f.valueSpec)&&h.push(new zt(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(ie&&!ct(f.valueSpec)?h.push(new zt(f.key,f.value,"property functions not supported")):X&&!_t(f.valueSpec)&&h.push(new zt(f.key,f.value,"zoom functions not supported"))),m!=="categorical"&&!de||f.value.property!==void 0||h.push(new zt(f.key,f.value,'"property" property is required')),h;function c(v){let S=[];const P=v.value,k=v.key;if(Lt(P)!=="array")return[new zt(k,P,`array expected, ${Lt(P)} found`)];if(P.length!==2)return[new zt(k,P,`array length 2 expected, length ${P.length} found`)];if(de){if(Lt(P[0])!=="object")return[new zt(k,P,`object expected, ${Lt(P[0])} found`)];if(P[0].zoom===void 0)return[new zt(k,P,"object stop key must have zoom")];if(P[0].value===void 0)return[new zt(k,P,"object stop key must have value")];if(Q&&Q>fn(P[0].zoom))return[new zt(k,P[0].zoom,"stop zoom values must appear in ascending order")];fn(P[0].zoom)!==Q&&(Q=fn(P[0].zoom),D=void 0,H={}),S=S.concat(fs({key:`${k}[0]`,value:P[0],valueSpec:{zoom:{}},validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{zoom:Jl,value:d}}))}else S=S.concat(d({key:`${k}[0]`,value:P[0],valueSpec:{},validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec},P));return Di(pn(P[1]))?S.concat([new zt(`${k}[1]`,P[1],"expressions are not allowed in function stops.")]):S.concat(v.validateSpec({key:`${k}[1]`,value:P[1],valueSpec:u,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec}))}function d(v,S){const P=Lt(v.value),k=fn(v.value),G=v.value!==null?v.value:S;if(C){if(P!==C)return[new zt(v.key,G,`${P} stop domain type must match previous stop domain type ${C}`)]}else C=P;if(P!=="number"&&P!=="string"&&P!=="boolean")return[new zt(v.key,G,"stop domain value must be a number, string, or boolean")];if(P!=="number"&&m!=="categorical"){let W=`number expected, ${P} found`;return ct(u)&&m===void 0&&(W+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new zt(v.key,G,W)]}return m!=="categorical"||P!=="number"||isFinite(k)&&Math.floor(k)===k?m!=="categorical"&&P==="number"&&D!==void 0&&k<D?[new zt(v.key,G,"stop domain values must appear in ascending order")]:(D=k,m==="categorical"&&k in H?[new zt(v.key,G,"stop domain values must be unique")]:(H[k]=!0,[])):[new zt(v.key,G,`integer expected, found ${k}`)]}}function vs(f){const u=(f.expressionContext==="property"?Po:Li)(pn(f.value),f.valueSpec);if(u.result==="error")return u.value.map(C=>new zt(`${f.key}${C.key}`,f.value,C.message));const m=u.value.expression||u.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!m.outputDefined())return[new zt(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!ys(m))return[new zt(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter"&&!ys(m))return[new zt(f.key,f.value,'"feature-state" data expressions are not supported with filters.')];if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!La(m,["zoom","feature-state"]))return[new zt(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!Ia(m))return[new zt(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ps(f){const u=f.key,m=f.value,C=f.valueSpec,D=[];return Array.isArray(C.values)?C.values.indexOf(fn(m))===-1&&D.push(new zt(u,m,`expected one of [${C.values.join(", ")}], ${JSON.stringify(m)} found`)):Object.keys(C.values).indexOf(fn(m))===-1&&D.push(new zt(u,m,`expected one of [${Object.keys(C.values).join(", ")}], ${JSON.stringify(m)} found`)),D}function Fo(f){return wc(pn(f.value))?vs(Xr({},f,{expressionContext:"filter",valueSpec:{value:"boolean"}})):vo(f)}function vo(f){const u=f.value,m=f.key;if(Lt(u)!=="array")return[new zt(m,u,`array expected, ${Lt(u)} found`)];const C=f.styleSpec;let D,Q=[];if(u.length<1)return[new zt(m,u,"filter array must have at least 1 element")];switch(Q=Q.concat(ps({key:`${m}[0]`,value:u[0],valueSpec:C.filter_operator,style:f.style,styleSpec:f.styleSpec})),fn(u[0])){case"<":case"<=":case">":case">=":u.length>=2&&fn(u[1])==="$type"&&Q.push(new zt(m,u,`"$type" cannot be use with operator "${u[0]}"`));case"==":case"!=":u.length!==3&&Q.push(new zt(m,u,`filter array for operator "${u[0]}" must have 3 elements`));case"in":case"!in":u.length>=2&&(D=Lt(u[1]),D!=="string"&&Q.push(new zt(`${m}[1]`,u[1],`string expected, ${D} found`)));for(let H=2;H<u.length;H++)D=Lt(u[H]),fn(u[1])==="$type"?Q=Q.concat(ps({key:`${m}[${H}]`,value:u[H],valueSpec:C.geometry_type,style:f.style,styleSpec:f.styleSpec})):D!=="string"&&D!=="number"&&D!=="boolean"&&Q.push(new zt(`${m}[${H}]`,u[H],`string, number, or boolean expected, ${D} found`));break;case"any":case"all":case"none":for(let H=1;H<u.length;H++)Q=Q.concat(vo({key:`${m}[${H}]`,value:u[H],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":D=Lt(u[1]),u.length!==2?Q.push(new zt(m,u,`filter array for "${u[0]}" operator must have 2 elements`)):D!=="string"&&Q.push(new zt(`${m}[1]`,u[1],`string expected, ${D} found`));break;case"within":D=Lt(u[1]),u.length!==2?Q.push(new zt(m,u,`filter array for "${u[0]}" operator must have 2 elements`)):D!=="object"&&Q.push(new zt(`${m}[1]`,u[1],`object expected, ${D} found`))}return Q}function _a(f,u){const m=f.key,C=f.validateSpec,D=f.style,Q=f.styleSpec,H=f.value,X=f.objectKey,ie=Q[`${u}_${f.layerType}`];if(!ie)return[];const de=X.match(/^(.*)-transition$/);if(u==="paint"&&de&&ie[de[1]]&&ie[de[1]].transition)return C({key:m,value:H,valueSpec:Q.transition,style:D,styleSpec:Q});const h=f.valueSpec||ie[X];if(!h)return[new zt(m,H,`unknown property "${X}"`)];let c;if(Lt(H)==="string"&&ct(h)&&!h.tokens&&(c=/^{([^}]+)}$/.exec(H)))return[new zt(m,H,`"${X}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(c[1])} }\`.`)];const d=[];return f.layerType==="symbol"&&(X==="text-field"&&D&&!D.glyphs&&d.push(new zt(m,H,'use of "text-field" requires a style "glyphs" property')),X==="text-font"&&gr(pn(H))&&fn(H.type)==="identity"&&d.push(new zt(m,H,'"text-font" does not support identity functions'))),d.concat(C({key:f.key,value:H,valueSpec:h,style:D,styleSpec:Q,expressionContext:"property",propertyType:u,propertyKey:X}))}function sl(f){return _a(f,"paint")}function Do(f){return _a(f,"layout")}function to(f){let u=[];const m=f.value,C=f.key,D=f.style,Q=f.styleSpec;m.type||m.ref||u.push(new zt(C,m,'either "type" or "ref" is required'));let H=fn(m.type);const X=fn(m.ref);if(m.id){const ie=fn(m.id);for(let de=0;de<f.arrayIndex;de++){const h=D.layers[de];fn(h.id)===ie&&u.push(new zt(C,m.id,`duplicate layer id "${m.id}", previously used at line ${h.id.__line__}`))}}if("ref"in m){let ie;["type","source","source-layer","filter","layout"].forEach(de=>{de in m&&u.push(new zt(C,m[de],`"${de}" is prohibited for ref layers`))}),D.layers.forEach(de=>{fn(de.id)===X&&(ie=de)}),ie?ie.ref?u.push(new zt(C,m.ref,"ref cannot reference another ref layer")):H=fn(ie.type):u.push(new zt(C,m.ref,`ref layer "${X}" not found`))}else if(H!=="background")if(m.source){const ie=D.sources&&D.sources[m.source],de=ie&&fn(ie.type);ie?de==="vector"&&H==="raster"?u.push(new zt(C,m.source,`layer "${m.id}" requires a raster source`)):de!=="raster-dem"&&H==="hillshade"?u.push(new zt(C,m.source,`layer "${m.id}" requires a raster-dem source`)):de==="raster"&&H!=="raster"?u.push(new zt(C,m.source,`layer "${m.id}" requires a vector source`)):de!=="vector"||m["source-layer"]?de==="raster-dem"&&H!=="hillshade"?u.push(new zt(C,m.source,"raster-dem source can only be used with layer type 'hillshade'.")):H!=="line"||!m.paint||!m.paint["line-gradient"]||de==="geojson"&&ie.lineMetrics||u.push(new zt(C,m,`layer "${m.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):u.push(new zt(C,m,`layer "${m.id}" must specify a "source-layer"`)):u.push(new zt(C,m.source,`source "${m.source}" not found`))}else u.push(new zt(C,m,'missing required property "source"'));return u=u.concat(fs({key:C,value:m,valueSpec:Q.layer,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,objectElementValidators:{"*":()=>[],type:()=>f.validateSpec({key:`${C}.type`,value:m.type,valueSpec:Q.layer.type,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,object:m,objectKey:"type"}),filter:Fo,layout:ie=>fs({layer:m,key:ie.key,value:ie.value,style:ie.style,styleSpec:ie.styleSpec,validateSpec:ie.validateSpec,objectElementValidators:{"*":de=>Do(Xr({layerType:H},de))}}),paint:ie=>fs({layer:m,key:ie.key,value:ie.value,style:ie.style,styleSpec:ie.styleSpec,validateSpec:ie.validateSpec,objectElementValidators:{"*":de=>sl(Xr({layerType:H},de))}})}})),u}function $s(f){const u=f.value,m=f.key,C=Lt(u);return C!=="string"?[new zt(m,u,`string expected, ${C} found`)]:[]}const bs={promoteId:function(f){let{key:u,value:m}=f;if(Lt(m)==="string")return $s({key:u,value:m});{const C=[];for(const D in m)C.push(...$s({key:`${u}.${D}`,value:m[D]}));return C}}};function Ao(f){const u=f.value,m=f.key,C=f.styleSpec,D=f.style,Q=f.validateSpec;if(!u.type)return[new zt(m,u,'"type" is required')];const H=fn(u.type);let X;switch(H){case"vector":case"raster":return X=fs({key:m,value:u,valueSpec:C[`source_${H.replace("-","_")}`],style:f.style,styleSpec:C,objectElementValidators:bs,validateSpec:Q}),X;case"raster-dem":return X=function(ie){var de;const h=(de=ie.sourceName)!==null&&de!==void 0?de:"",c=ie.value,d=ie.styleSpec,v=d.source_raster_dem,S=ie.style;let P=[];const k=Lt(c);if(c===void 0)return P;if(k!=="object")return P.push(new zt("source_raster_dem",c,`object expected, ${k} found`)),P;const G=fn(c.encoding)==="custom",W=["redFactor","greenFactor","blueFactor","baseShift"],ee=ie.value.encoding?`"${ie.value.encoding}"`:"Default";for(const ae in c)!G&&W.includes(ae)?P.push(new zt(ae,c[ae],`In "${h}": "${ae}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):v[ae]?P=P.concat(ie.validateSpec({key:ae,value:c[ae],valueSpec:v[ae],validateSpec:ie.validateSpec,style:S,styleSpec:d})):P.push(new zt(ae,c[ae],`unknown property "${ae}"`));return P}({sourceName:m,value:u,style:f.style,styleSpec:C,validateSpec:Q}),X;case"geojson":if(X=fs({key:m,value:u,valueSpec:C.source_geojson,style:D,styleSpec:C,validateSpec:Q,objectElementValidators:bs}),u.cluster)for(const ie in u.clusterProperties){const[de,h]=u.clusterProperties[ie],c=typeof de=="string"?[de,["accumulated"],["get",ie]]:de;X.push(...vs({key:`${m}.${ie}.map`,value:h,validateSpec:Q,expressionContext:"cluster-map"})),X.push(...vs({key:`${m}.${ie}.reduce`,value:c,validateSpec:Q,expressionContext:"cluster-reduce"}))}return X;case"video":return fs({key:m,value:u,valueSpec:C.source_video,style:D,validateSpec:Q,styleSpec:C});case"image":return fs({key:m,value:u,valueSpec:C.source_image,style:D,validateSpec:Q,styleSpec:C});case"canvas":return[new zt(m,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ps({key:`${m}.type`,value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:D,validateSpec:Q,styleSpec:C})}}function Ra(f){const u=f.value,m=f.styleSpec,C=m.light,D=f.style;let Q=[];const H=Lt(u);if(u===void 0)return Q;if(H!=="object")return Q=Q.concat([new zt("light",u,`object expected, ${H} found`)]),Q;for(const X in u){const ie=X.match(/^(.*)-transition$/);Q=Q.concat(ie&&C[ie[1]]&&C[ie[1]].transition?f.validateSpec({key:X,value:u[X],valueSpec:m.transition,validateSpec:f.validateSpec,style:D,styleSpec:m}):C[X]?f.validateSpec({key:X,value:u[X],valueSpec:C[X],validateSpec:f.validateSpec,style:D,styleSpec:m}):[new zt(X,u[X],`unknown property "${X}"`)])}return Q}function ml(f){const u=f.value,m=f.styleSpec,C=m.sky,D=f.style,Q=Lt(u);if(u===void 0)return[];if(Q!=="object")return[new zt("sky",u,`object expected, ${Q} found`)];let H=[];for(const X in u)H=H.concat(C[X]?ln({key:X,value:u[X],valueSpec:C[X],style:D,styleSpec:m}):[new zt(X,u[X],`unknown property "${X}"`)]);return H}function Yl(f){const u=f.value,m=f.styleSpec,C=m.terrain,D=f.style;let Q=[];const H=Lt(u);if(u===void 0)return Q;if(H!=="object")return Q=Q.concat([new zt("terrain",u,`object expected, ${H} found`)]),Q;for(const X in u)Q=Q.concat(C[X]?f.validateSpec({key:X,value:u[X],valueSpec:C[X],validateSpec:f.validateSpec,style:D,styleSpec:m}):[new zt(X,u[X],`unknown property "${X}"`)]);return Q}function ks(f){let u=[];const m=f.value,C=f.key;if(Array.isArray(m)){const D=[],Q=[];for(const H in m)m[H].id&&D.includes(m[H].id)&&u.push(new zt(C,m,`all the sprites' ids must be unique, but ${m[H].id} is duplicated`)),D.push(m[H].id),m[H].url&&Q.includes(m[H].url)&&u.push(new zt(C,m,`all the sprites' URLs must be unique, but ${m[H].url} is duplicated`)),Q.push(m[H].url),u=u.concat(fs({key:`${C}[${H}]`,value:m[H],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:f.validateSpec}));return u}return $s({key:C,value:m})}const ea={"*":()=>[],array:ya,boolean:function(f){const u=f.value,m=f.key,C=Lt(u);return C!=="boolean"?[new zt(m,u,`boolean expected, ${C} found`)]:[]},number:Jl,color:function(f){const u=f.key,m=f.value,C=Lt(m);return C!=="string"?[new zt(u,m,`color expected, ${C} found`)]:mi.parse(String(m))?[]:[new zt(u,m,`color expected, "${m}" found`)]},constants:Ln,enum:ps,filter:Fo,function:ho,layer:to,object:fs,source:Ao,light:Ra,sky:ml,terrain:Yl,string:$s,formatted:function(f){return $s(f).length===0?[]:vs(f)},resolvedImage:function(f){return $s(f).length===0?[]:vs(f)},padding:function(f){const u=f.key,m=f.value;if(Lt(m)==="array"){if(m.length<1||m.length>4)return[new zt(u,m,`padding requires 1 to 4 values; ${m.length} values found`)];const C={type:"number"};let D=[];for(let Q=0;Q<m.length;Q++)D=D.concat(f.validateSpec({key:`${u}[${Q}]`,value:m[Q],validateSpec:f.validateSpec,valueSpec:C}));return D}return Jl({key:u,value:m,valueSpec:{}})},variableAnchorOffsetCollection:function(f){const u=f.key,m=f.value,C=Lt(m),D=f.styleSpec;if(C!=="array"||m.length<1||m.length%2!=0)return[new zt(u,m,"variableAnchorOffsetCollection requires a non-empty array of even length")];let Q=[];for(let H=0;H<m.length;H+=2)Q=Q.concat(ps({key:`${u}[${H}]`,value:m[H],valueSpec:D.layout_symbol["text-anchor"]})),Q=Q.concat(ya({key:`${u}[${H+1}]`,value:m[H+1],valueSpec:{length:2,value:"number"},validateSpec:f.validateSpec,style:f.style,styleSpec:D}));return Q},sprite:ks};function ln(f){const u=f.value,m=f.valueSpec,C=f.styleSpec;return f.validateSpec=ln,m.expression&&gr(fn(u))?ho(f):m.expression&&Di(pn(u))?vs(f):m.type&&ea[m.type]?ea[m.type](f):fs(Xr({},f,{valueSpec:m.type?C[m.type]:m}))}function Kn(f){const u=f.value,m=f.key,C=$s(f);return C.length||(u.indexOf("{fontstack}")===-1&&C.push(new zt(m,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&C.push(new zt(m,u,'"glyphs" url must include a "{range}" token'))),C}function ls(f){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:wt,m=[];return m=m.concat(ln({key:"",value:f,valueSpec:u.$root,styleSpec:u,style:f,validateSpec:ln,objectElementValidators:{glyphs:Kn,"*":()=>[]}})),f.constants&&(m=m.concat(Ln({key:"constants",value:f.constants,style:f,styleSpec:u,validateSpec:ln}))),tn(m)}function Ni(f){return function(u){return f({...u,validateSpec:ln})}}function tn(f){return[].concat(f).sort((u,m)=>u.line-m.line)}function nn(f){return function(){for(var u=arguments.length,m=new Array(u),C=0;C<u;C++)m[C]=arguments[C];return tn(f.apply(this,m))}}ls.source=nn(Ni(Ao)),ls.sprite=nn(Ni(ks)),ls.glyphs=nn(Ni(Kn)),ls.light=nn(Ni(Ra)),ls.sky=nn(Ni(ml)),ls.terrain=nn(Ni(Yl)),ls.layer=nn(Ni(to)),ls.filter=nn(Ni(Fo)),ls.paintProperty=nn(Ni(sl)),ls.layoutProperty=nn(Ni(Do));const zn=ls,va=zn.light,ka=zn.paintProperty,ta=zn.layoutProperty;function ra(f,u){let m=!1;if(u&&u.length)for(const C of u)f.fire(new kt(new Error(C.message))),m=!0;return m}class Nr{constructor(u,m,C){const D=this.cells=[];if(u instanceof ArrayBuffer){this.arrayBuffer=u;const H=new Int32Array(this.arrayBuffer);u=H[0],this.d=(m=H[1])+2*(C=H[2]);for(let ie=0;ie<this.d*this.d;ie++){const de=H[3+ie],h=H[3+ie+1];D.push(de===h?null:H.subarray(de,h))}const X=H[3+D.length+1];this.keys=H.subarray(H[3+D.length],X),this.bboxes=H.subarray(X),this.insert=this._insertReadonly}else{this.d=m+2*C;for(let H=0;H<this.d*this.d;H++)D.push([]);this.keys=[],this.bboxes=[]}this.n=m,this.extent=u,this.padding=C,this.scale=m/u,this.uid=0;const Q=C/m*u;this.min=-Q,this.max=u+Q}insert(u,m,C,D,Q){this._forEachCell(m,C,D,Q,this._insertCell,this.uid++,void 0,void 0),this.keys.push(u),this.bboxes.push(m),this.bboxes.push(C),this.bboxes.push(D),this.bboxes.push(Q)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(u,m,C,D,Q,H){this.cells[Q].push(H)}query(u,m,C,D,Q){const H=this.min,X=this.max;if(u<=H&&m<=H&&X<=C&&X<=D&&!Q)return Array.prototype.slice.call(this.keys);{const ie=[];return this._forEachCell(u,m,C,D,this._queryCell,ie,{},Q),ie}}_queryCell(u,m,C,D,Q,H,X,ie){const de=this.cells[Q];if(de!==null){const h=this.keys,c=this.bboxes;for(let d=0;d<de.length;d++){const v=de[d];if(X[v]===void 0){const S=4*v;(ie?ie(c[S+0],c[S+1],c[S+2],c[S+3]):u<=c[S+2]&&m<=c[S+3]&&C>=c[S+0]&&D>=c[S+1])?(X[v]=!0,H.push(h[v])):X[v]=!1}}}}_forEachCell(u,m,C,D,Q,H,X,ie){const de=this._convertToCellCoord(u),h=this._convertToCellCoord(m),c=this._convertToCellCoord(C),d=this._convertToCellCoord(D);for(let v=de;v<=c;v++)for(let S=h;S<=d;S++){const P=this.d*S+v;if((!ie||ie(this._convertFromCellCoord(v),this._convertFromCellCoord(S),this._convertFromCellCoord(v+1),this._convertFromCellCoord(S+1)))&&Q.call(this,u,m,C,D,P,H,X,ie))return}}_convertFromCellCoord(u){return(u-this.padding)/this.scale}_convertToCellCoord(u){return Math.max(0,Math.min(this.d-1,Math.floor(u*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const u=this.cells,m=3+this.cells.length+1+1;let C=0;for(let H=0;H<this.cells.length;H++)C+=this.cells[H].length;const D=new Int32Array(m+C+this.keys.length+this.bboxes.length);D[0]=this.extent,D[1]=this.n,D[2]=this.padding;let Q=m;for(let H=0;H<u.length;H++){const X=u[H];D[3+H]=Q,D.set(X,Q),Q+=X.length}return D[3+u.length]=Q,D.set(this.keys,Q),Q+=this.keys.length,D[3+u.length+1]=Q,D.set(this.bboxes,Q),Q+=this.bboxes.length,D.buffer}static serialize(u,m){const C=u.toArrayBuffer();return m&&m.push(C),{buffer:C}}static deserialize(u){return new Nr(u.buffer)}}const ba={};function Rr(f,u){let m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(ba[f])throw new Error(`${f} is already registered.`);Object.defineProperty(u,"_classRegistryKey",{value:f,writeable:!1}),ba[f]={klass:u,omit:m.omit||[],shallow:m.shallow||[]}}Rr("Object",Object),Rr("TransferableGridIndex",Nr),Rr("Color",mi),Rr("Error",Error),Rr("AJAXError",Dt),Rr("ResolvedImage",Bn),Rr("StylePropertyFunction",Ma),Rr("StyleExpression",Pn,{omit:["_evaluator"]}),Rr("ZoomDependentExpression",eo),Rr("ZoomConstantExpression",Ds),Rr("CompoundExpression",as,{omit:["_evaluate"]});for(const f in pa)pa[f]._classRegistryKey||Rr(`Expression_${f}`,pa[f]);function yl(f){return f&&typeof ArrayBuffer<"u"&&(f instanceof ArrayBuffer||f.constructor&&f.constructor.name==="ArrayBuffer")}function _l(f,u){if(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob||f instanceof Error)return f;if(yl(f)||bt(f))return u&&u.push(f),f;if(ArrayBuffer.isView(f)){const m=f;return u&&u.push(m.buffer),m}if(f instanceof ImageData)return u&&u.push(f.data.buffer),f;if(Array.isArray(f)){const m=[];for(const C of f)m.push(_l(C,u));return m}if(typeof f=="object"){const m=f.constructor,C=m._classRegistryKey;if(!C)throw new Error(`can't serialize object of unregistered class ${m.name}`);if(!ba[C])throw new Error(`${C} is not registered.`);const D=m.serialize?m.serialize(f,u):{};if(m.serialize){if(u&&D===u[u.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const Q in f){if(!f.hasOwnProperty(Q)||ba[C].omit.indexOf(Q)>=0)continue;const H=f[Q];D[Q]=ba[C].shallow.indexOf(Q)>=0?H:_l(H,u)}f instanceof Error&&(D.message=f.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return C!=="Object"&&(D.$name=C),D}throw new Error("can't serialize object of type "+typeof f)}function Mr(f){if(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob||f instanceof Error||yl(f)||bt(f)||ArrayBuffer.isView(f)||f instanceof ImageData)return f;if(Array.isArray(f))return f.map(Mr);if(typeof f=="object"){const u=f.$name||"Object";if(!ba[u])throw new Error(`can't deserialize unregistered class ${u}`);const{klass:m}=ba[u];if(!m)throw new Error(`can't deserialize unregistered class ${u}`);if(m.deserialize)return m.deserialize(f);const C=Object.create(m.prototype);for(const D of Object.keys(f)){if(D==="$name")continue;const Q=f[D];C[D]=ba[u].shallow.indexOf(D)>=0?Q:Mr(Q)}return C}throw new Error("can't deserialize object of type "+typeof f)}class Cc{constructor(){this.first=!0}update(u,m){const C=Math.floor(u);return this.first?(this.first=!1,this.lastIntegerZoom=C,this.lastIntegerZoomTime=0,this.lastZoom=u,this.lastFloorZoom=C,!0):(this.lastFloorZoom>C?(this.lastIntegerZoom=C+1,this.lastIntegerZoomTime=m):this.lastFloorZoom<C&&(this.lastIntegerZoom=C,this.lastIntegerZoomTime=m),u!==this.lastZoom&&(this.lastZoom=u,this.lastFloorZoom=C,!0))}}const Dr={"Latin-1 Supplement":f=>f>=128&&f<=255,Arabic:f=>f>=1536&&f<=1791,"Arabic Supplement":f=>f>=1872&&f<=1919,"Arabic Extended-A":f=>f>=2208&&f<=2303,"Hangul Jamo":f=>f>=4352&&f<=4607,"Unified Canadian Aboriginal Syllabics":f=>f>=5120&&f<=5759,Khmer:f=>f>=6016&&f<=6143,"Unified Canadian Aboriginal Syllabics Extended":f=>f>=6320&&f<=6399,"General Punctuation":f=>f>=8192&&f<=8303,"Letterlike Symbols":f=>f>=8448&&f<=8527,"Number Forms":f=>f>=8528&&f<=8591,"Miscellaneous Technical":f=>f>=8960&&f<=9215,"Control Pictures":f=>f>=9216&&f<=9279,"Optical Character Recognition":f=>f>=9280&&f<=9311,"Enclosed Alphanumerics":f=>f>=9312&&f<=9471,"Geometric Shapes":f=>f>=9632&&f<=9727,"Miscellaneous Symbols":f=>f>=9728&&f<=9983,"Miscellaneous Symbols and Arrows":f=>f>=11008&&f<=11263,"CJK Radicals Supplement":f=>f>=11904&&f<=12031,"Kangxi Radicals":f=>f>=12032&&f<=12255,"Ideographic Description Characters":f=>f>=12272&&f<=12287,"CJK Symbols and Punctuation":f=>f>=12288&&f<=12351,Hiragana:f=>f>=12352&&f<=12447,Katakana:f=>f>=12448&&f<=12543,Bopomofo:f=>f>=12544&&f<=12591,"Hangul Compatibility Jamo":f=>f>=12592&&f<=12687,Kanbun:f=>f>=12688&&f<=12703,"Bopomofo Extended":f=>f>=12704&&f<=12735,"CJK Strokes":f=>f>=12736&&f<=12783,"Katakana Phonetic Extensions":f=>f>=12784&&f<=12799,"Enclosed CJK Letters and Months":f=>f>=12800&&f<=13055,"CJK Compatibility":f=>f>=13056&&f<=13311,"CJK Unified Ideographs Extension A":f=>f>=13312&&f<=19903,"Yijing Hexagram Symbols":f=>f>=19904&&f<=19967,"CJK Unified Ideographs":f=>f>=19968&&f<=40959,"Yi Syllables":f=>f>=40960&&f<=42127,"Yi Radicals":f=>f>=42128&&f<=42191,"Hangul Jamo Extended-A":f=>f>=43360&&f<=43391,"Hangul Syllables":f=>f>=44032&&f<=55215,"Hangul Jamo Extended-B":f=>f>=55216&&f<=55295,"Private Use Area":f=>f>=57344&&f<=63743,"CJK Compatibility Ideographs":f=>f>=63744&&f<=64255,"Arabic Presentation Forms-A":f=>f>=64336&&f<=65023,"Vertical Forms":f=>f>=65040&&f<=65055,"CJK Compatibility Forms":f=>f>=65072&&f<=65103,"Small Form Variants":f=>f>=65104&&f<=65135,"Arabic Presentation Forms-B":f=>f>=65136&&f<=65279,"Halfwidth and Fullwidth Forms":f=>f>=65280&&f<=65519};function ro(f){for(const u of f)if(ec(u.charCodeAt(0)))return!0;return!1}function io(f){for(const u of f)if(!Gc(u.charCodeAt(0)))return!1;return!0}function Gc(f){return!(Dr.Arabic(f)||Dr["Arabic Supplement"](f)||Dr["Arabic Extended-A"](f)||Dr["Arabic Presentation Forms-A"](f)||Dr["Arabic Presentation Forms-B"](f))}function ec(f){return!(f!==746&&f!==747&&(f<4352||!(Dr["Bopomofo Extended"](f)||Dr.Bopomofo(f)||Dr["CJK Compatibility Forms"](f)&&!(f>=65097&&f<=65103)||Dr["CJK Compatibility Ideographs"](f)||Dr["CJK Compatibility"](f)||Dr["CJK Radicals Supplement"](f)||Dr["CJK Strokes"](f)||!(!Dr["CJK Symbols and Punctuation"](f)||f>=12296&&f<=12305||f>=12308&&f<=12319||f===12336)||Dr["CJK Unified Ideographs Extension A"](f)||Dr["CJK Unified Ideographs"](f)||Dr["Enclosed CJK Letters and Months"](f)||Dr["Hangul Compatibility Jamo"](f)||Dr["Hangul Jamo Extended-A"](f)||Dr["Hangul Jamo Extended-B"](f)||Dr["Hangul Jamo"](f)||Dr["Hangul Syllables"](f)||Dr.Hiragana(f)||Dr["Ideographic Description Characters"](f)||Dr.Kanbun(f)||Dr["Kangxi Radicals"](f)||Dr["Katakana Phonetic Extensions"](f)||Dr.Katakana(f)&&f!==12540||!(!Dr["Halfwidth and Fullwidth Forms"](f)||f===65288||f===65289||f===65293||f>=65306&&f<=65310||f===65339||f===65341||f===65343||f>=65371&&f<=65503||f===65507||f>=65512&&f<=65519)||!(!Dr["Small Form Variants"](f)||f>=65112&&f<=65118||f>=65123&&f<=65126)||Dr["Unified Canadian Aboriginal Syllabics"](f)||Dr["Unified Canadian Aboriginal Syllabics Extended"](f)||Dr["Vertical Forms"](f)||Dr["Yijing Hexagram Symbols"](f)||Dr["Yi Syllables"](f)||Dr["Yi Radicals"](f))))}function mu(f){return!(ec(f)||function(u){return!!(Dr["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||Dr["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||Dr["Letterlike Symbols"](u)||Dr["Number Forms"](u)||Dr["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||Dr["Control Pictures"](u)&&u!==9251||Dr["Optical Character Recognition"](u)||Dr["Enclosed Alphanumerics"](u)||Dr["Geometric Shapes"](u)||Dr["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||Dr["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||Dr["CJK Symbols and Punctuation"](u)||Dr.Katakana(u)||Dr["Private Use Area"](u)||Dr["CJK Compatibility Forms"](u)||Dr["Small Form Variants"](u)||Dr["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(f))}function jc(f){return f>=1424&&f<=2303||Dr["Arabic Presentation Forms-A"](f)||Dr["Arabic Presentation Forms-B"](f)}function tc(f,u){return!(!u&&jc(f)||f>=2304&&f<=3583||f>=3840&&f<=4255||Dr.Khmer(f))}function qc(f){for(const u of f)if(jc(u.charCodeAt(0)))return!0;return!1}const ol=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(f){this.pluginStatus=f.pluginStatus,this.pluginURL=f.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(f){this.applyArabicShaping=f.applyArabicShaping,this.processBidirectionalText=f.processBidirectionalText,this.processStyledBidirectionalText=f.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class vn{constructor(u,m){this.zoom=u,m?(this.now=m.now,this.fadeDuration=m.fadeDuration,this.zoomHistory=m.zoomHistory,this.transition=m.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Cc,this.transition={})}isSupportedScript(u){return function(m,C){for(const D of m)if(!tc(D.charCodeAt(0),C))return!1;return!0}(u,ol.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const u=this.zoom,m=u-Math.floor(u),C=this.crossFadingFactor();return u>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:m+(1-m)*C}:{fromScale:.5,toScale:1,t:1-(1-C)*m}}}class Os{constructor(u,m){this.property=u,this.value=m,this.expression=function(C,D){if(gr(C))return new Ma(C,D);if(Di(C)){const Q=Po(C,D);if(Q.result==="error")throw new Error(Q.value.map(H=>`${H.key}: ${H.message}`).join(", "));return Q.value}{let Q=C;return D.type==="color"&&typeof C=="string"?Q=mi.parse(C):D.type!=="padding"||typeof C!="number"&&!Array.isArray(C)?D.type==="variableAnchorOffsetCollection"&&Array.isArray(C)&&(Q=Ui.parse(C)):Q=jn.parse(C),{kind:"constant",evaluate:()=>Q}}}(m===void 0?u.specification.default:m,u.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(u,m,C){return this.property.possiblyEvaluate(this,u,m,C)}}class Ro{constructor(u){this.property=u,this.value=new Os(u,void 0)}transitioned(u,m){return new yu(this.property,this.value,m,We({},u.transition,this.transition),u.now)}untransitioned(){return new yu(this.property,this.value,null,{},0)}}class vl{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitionablePropertyValues)}getValue(u){return ke(this._values[u].value.value)}setValue(u,m){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Ro(this._values[u].property)),this._values[u].value=new Os(this._values[u].property,m===null?void 0:ke(m))}getTransition(u){return ke(this._values[u].transition)}setTransition(u,m){Object.prototype.hasOwnProperty.call(this._values,u)||(this._values[u]=new Ro(this._values[u].property)),this._values[u].transition=ke(m)||void 0}serialize(){const u={};for(const m of Object.keys(this._values)){const C=this.getValue(m);C!==void 0&&(u[m]=C);const D=this.getTransition(m);D!==void 0&&(u[`${m}-transition`]=D)}return u}transitioned(u,m){const C=new $c(this._properties);for(const D of Object.keys(this._values))C._values[D]=this._values[D].transitioned(u,m._values[D]);return C}untransitioned(){const u=new $c(this._properties);for(const m of Object.keys(this._values))u._values[m]=this._values[m].untransitioned();return u}}class yu{constructor(u,m,C,D,Q){this.property=u,this.value=m,this.begin=Q+D.delay||0,this.end=this.begin+D.duration||0,u.specification.transition&&(D.delay||D.duration)&&(this.prior=C)}possiblyEvaluate(u,m,C){const D=u.now||0,Q=this.value.possiblyEvaluate(u,m,C),H=this.prior;if(H){if(D>this.end)return this.prior=null,Q;if(this.value.isDataDriven())return this.prior=null,Q;if(D<this.begin)return H.possiblyEvaluate(u,m,C);{const X=(D-this.begin)/(this.end-this.begin);return this.property.interpolate(H.possiblyEvaluate(u,m,C),Q,function(ie){if(ie<=0)return 0;if(ie>=1)return 1;const de=ie*ie,h=de*ie;return 4*(ie<.5?h:3*(ie-de)+h-.75)}(X))}}return Q}}class $c{constructor(u){this._properties=u,this._values=Object.create(u.defaultTransitioningPropertyValues)}possiblyEvaluate(u,m,C){const D=new no(this._properties);for(const Q of Object.keys(this._values))D._values[Q]=this._values[Q].possiblyEvaluate(u,m,C);return D}hasTransition(){for(const u of Object.keys(this._values))if(this._values[u].prior)return!0;return!1}}class Gu{constructor(u){this._properties=u,this._values=Object.create(u.defaultPropertyValues)}hasValue(u){return this._values[u].value!==void 0}getValue(u){return ke(this._values[u].value)}setValue(u,m){this._values[u]=new Os(this._values[u].property,m===null?void 0:ke(m))}serialize(){const u={};for(const m of Object.keys(this._values)){const C=this.getValue(m);C!==void 0&&(u[m]=C)}return u}possiblyEvaluate(u,m,C){const D=new no(this._properties);for(const Q of Object.keys(this._values))D._values[Q]=this._values[Q].possiblyEvaluate(u,m,C);return D}}class xa{constructor(u,m,C){this.property=u,this.value=m,this.parameters=C}isConstant(){return this.value.kind==="constant"}constantOr(u){return this.value.kind==="constant"?this.value.value:u}evaluate(u,m,C,D){return this.property.evaluate(this.value,this.parameters,u,m,C,D)}}class no{constructor(u){this._properties=u,this._values=Object.create(u.defaultPossiblyEvaluatedValues)}get(u){return this._values[u]}}class Sr{constructor(u){this.specification=u}possiblyEvaluate(u,m){if(u.isDataDriven())throw new Error("Value should not be data driven");return u.expression.evaluate(m)}interpolate(u,m,C){const D=En[this.specification.type];return D?D(u,m,C):u}}class oi{constructor(u,m){this.specification=u,this.overrides=m}possiblyEvaluate(u,m,C,D){return new xa(this,u.expression.kind==="constant"||u.expression.kind==="camera"?{kind:"constant",value:u.expression.evaluate(m,null,{},C,D)}:u.expression,m)}interpolate(u,m,C){if(u.value.kind!=="constant"||m.value.kind!=="constant")return u;if(u.value.value===void 0||m.value.value===void 0)return new xa(this,{kind:"constant",value:void 0},u.parameters);const D=En[this.specification.type];if(D){const Q=D(u.value.value,m.value.value,C);return new xa(this,{kind:"constant",value:Q},u.parameters)}return u}evaluate(u,m,C,D,Q,H){return u.kind==="constant"?u.value:u.evaluate(m,C,D,Q,H)}}class bl extends oi{possiblyEvaluate(u,m,C,D){if(u.value===void 0)return new xa(this,{kind:"constant",value:void 0},m);if(u.expression.kind==="constant"){const Q=u.expression.evaluate(m,null,{},C,D),H=u.property.specification.type==="resolvedImage"&&typeof Q!="string"?Q.name:Q,X=this._calculate(H,H,H,m);return new xa(this,{kind:"constant",value:X},m)}if(u.expression.kind==="camera"){const Q=this._calculate(u.expression.evaluate({zoom:m.zoom-1}),u.expression.evaluate({zoom:m.zoom}),u.expression.evaluate({zoom:m.zoom+1}),m);return new xa(this,{kind:"constant",value:Q},m)}return new xa(this,u.expression,m)}evaluate(u,m,C,D,Q,H){if(u.kind==="source"){const X=u.evaluate(m,C,D,Q,H);return this._calculate(X,X,X,m)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(m.zoom)-1},C,D),u.evaluate({zoom:Math.floor(m.zoom)},C,D),u.evaluate({zoom:Math.floor(m.zoom)+1},C,D),m):u.value}_calculate(u,m,C,D){return D.zoom>D.zoomHistory.lastIntegerZoom?{from:u,to:m}:{from:C,to:m}}interpolate(u){return u}}class Kc{constructor(u){this.specification=u}possiblyEvaluate(u,m,C,D){if(u.value!==void 0){if(u.expression.kind==="constant"){const Q=u.expression.evaluate(m,null,{},C,D);return this._calculate(Q,Q,Q,m)}return this._calculate(u.expression.evaluate(new vn(Math.floor(m.zoom-1),m)),u.expression.evaluate(new vn(Math.floor(m.zoom),m)),u.expression.evaluate(new vn(Math.floor(m.zoom+1),m)),m)}}_calculate(u,m,C,D){return D.zoom>D.zoomHistory.lastIntegerZoom?{from:u,to:m}:{from:C,to:m}}interpolate(u){return u}}class rc{constructor(u){this.specification=u}possiblyEvaluate(u,m,C,D){return!!u.expression.evaluate(m,null,{},C,D)}interpolate(){return!1}}class Us{constructor(u){this.properties=u,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const m in u){const C=u[m];C.specification.overridable&&this.overridableProperties.push(m);const D=this.defaultPropertyValues[m]=new Os(C,void 0),Q=this.defaultTransitionablePropertyValues[m]=new Ro(C);this.defaultTransitioningPropertyValues[m]=Q.untransitioned(),this.defaultPossiblyEvaluatedValues[m]=D.possiblyEvaluate({})}}}Rr("DataDrivenProperty",oi),Rr("DataConstantProperty",Sr),Rr("CrossFadedDataDrivenProperty",bl),Rr("CrossFadedProperty",Kc),Rr("ColorRampProperty",rc);const uA="-transition";class Wn extends lt{constructor(u,m){if(super(),this.id=u.id,this.type=u.type,this._featureFilter={filter:()=>!0,needGeometry:!1},u.type!=="custom"&&(this.metadata=u.metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),m.layout&&(this._unevaluatedLayout=new Gu(m.layout)),m.paint)){this._transitionablePaint=new vl(m.paint);for(const C in u.paint)this.setPaintProperty(C,u.paint[C],{validate:!1});for(const C in u.layout)this.setLayoutProperty(C,u.layout[C],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new no(m.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)}setLayoutProperty(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};m!=null&&this._validate(ta,`layers.${this.id}.layout.${u}`,u,m,C)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,m):this.visibility=m)}getPaintProperty(u){return u.endsWith(uA)?this._transitionablePaint.getTransition(u.slice(0,-11)):this._transitionablePaint.getValue(u)}setPaintProperty(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(m!=null&&this._validate(ka,`layers.${this.id}.paint.${u}`,u,m,C))return!1;if(u.endsWith(uA))return this._transitionablePaint.setTransition(u.slice(0,-11),m||void 0),!1;{const D=this._transitionablePaint._values[u],Q=D.property.specification["property-type"]==="cross-faded-data-driven",H=D.value.isDataDriven(),X=D.value;this._transitionablePaint.setValue(u,m),this._handleSpecialPaintPropertyUpdate(u);const ie=this._transitionablePaint._values[u].value;return ie.isDataDriven()||H||Q||this._handleOverridablePaintPropertyUpdate(u,X,ie)}}_handleSpecialPaintPropertyUpdate(u){}_handleOverridablePaintPropertyUpdate(u,m,C){return!1}isHidden(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"}updateTransitions(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(u,m){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,m)}serialize(){const u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),nt(u,(m,C)=>!(m===void 0||C==="layout"&&!Object.keys(m).length||C==="paint"&&!Object.keys(m).length))}_validate(u,m,C,D){let Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!Q||Q.validate!==!1)&&ra(this,u.call(zn,{key:m,layerType:this.type,objectKey:C,value:D,styleSpec:wt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const u in this.paint._values){const m=this.paint.get(u);if(m instanceof xa&&ct(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1}}const Wc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Kr{constructor(u,m){this._structArray=u,this._pos1=m*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Qr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(u,m){return u._trim(),m&&(u.isTransferred=!0,m.push(u.arrayBuffer)),{length:u.length,arrayBuffer:u.arrayBuffer}}static deserialize(u){const m=Object.create(this.prototype);return m.arrayBuffer=u.arrayBuffer,m.length=u.length,m.capacity=u.arrayBuffer.byteLength/m.bytesPerElement,m._refreshViews(),m}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(u){this.reserve(u),this.length=u}reserve(u){if(u>this.capacity){this.capacity=Math.max(u,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const m=this.uint8;this._refreshViews(),m&&this.uint8.set(m)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Xn(f){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,m=0,C=0;return{members:f.map(D=>{const Q=Wc[D.type].BYTES_PER_ELEMENT,H=m=ju(m,Math.max(u,Q)),X=D.components||1;return C=Math.max(C,Q),m+=Q*X,{name:D.name,type:D.type,components:X,offset:H}}),size:ju(m,Math.max(C,u)),alignment:u}}function ju(f,u){return Math.ceil(f/u)*u}class ko extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m){const C=this.length;return this.resize(C+1),this.emplace(C,u,m)}emplace(u,m,C){const D=2*u;return this.int16[D+0]=m,this.int16[D+1]=C,u}}ko.prototype.bytesPerElement=4,Rr("StructArrayLayout2i4",ko);class sn extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C){const D=this.length;return this.resize(D+1),this.emplace(D,u,m,C)}emplace(u,m,C,D){const Q=3*u;return this.int16[Q+0]=m,this.int16[Q+1]=C,this.int16[Q+2]=D,u}}sn.prototype.bytesPerElement=6,Rr("StructArrayLayout3i6",sn);class Ks extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,D){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,m,C,D)}emplace(u,m,C,D,Q){const H=4*u;return this.int16[H+0]=m,this.int16[H+1]=C,this.int16[H+2]=D,this.int16[H+3]=Q,u}}Ks.prototype.bytesPerElement=8,Rr("StructArrayLayout4i8",Ks);class Oo extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H){const X=this.length;return this.resize(X+1),this.emplace(X,u,m,C,D,Q,H)}emplace(u,m,C,D,Q,H,X){const ie=6*u;return this.int16[ie+0]=m,this.int16[ie+1]=C,this.int16[ie+2]=D,this.int16[ie+3]=Q,this.int16[ie+4]=H,this.int16[ie+5]=X,u}}Oo.prototype.bytesPerElement=12,Rr("StructArrayLayout2i4i12",Oo);class _u extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H){const X=this.length;return this.resize(X+1),this.emplace(X,u,m,C,D,Q,H)}emplace(u,m,C,D,Q,H,X){const ie=4*u,de=8*u;return this.int16[ie+0]=m,this.int16[ie+1]=C,this.uint8[de+4]=D,this.uint8[de+5]=Q,this.uint8[de+6]=H,this.uint8[de+7]=X,u}}_u.prototype.bytesPerElement=8,Rr("StructArrayLayout2i4ub8",_u);class Ws extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m){const C=this.length;return this.resize(C+1),this.emplace(C,u,m)}emplace(u,m,C){const D=2*u;return this.float32[D+0]=m,this.float32[D+1]=C,u}}Ws.prototype.bytesPerElement=8,Rr("StructArrayLayout2f8",Ws);class Yi extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H,X,ie,de,h){const c=this.length;return this.resize(c+1),this.emplace(c,u,m,C,D,Q,H,X,ie,de,h)}emplace(u,m,C,D,Q,H,X,ie,de,h,c){const d=10*u;return this.uint16[d+0]=m,this.uint16[d+1]=C,this.uint16[d+2]=D,this.uint16[d+3]=Q,this.uint16[d+4]=H,this.uint16[d+5]=X,this.uint16[d+6]=ie,this.uint16[d+7]=de,this.uint16[d+8]=h,this.uint16[d+9]=c,u}}Yi.prototype.bytesPerElement=20,Rr("StructArrayLayout10ui20",Yi);class Fn extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H,X,ie,de,h,c,d){const v=this.length;return this.resize(v+1),this.emplace(v,u,m,C,D,Q,H,X,ie,de,h,c,d)}emplace(u,m,C,D,Q,H,X,ie,de,h,c,d,v){const S=12*u;return this.int16[S+0]=m,this.int16[S+1]=C,this.int16[S+2]=D,this.int16[S+3]=Q,this.uint16[S+4]=H,this.uint16[S+5]=X,this.uint16[S+6]=ie,this.uint16[S+7]=de,this.int16[S+8]=h,this.int16[S+9]=c,this.int16[S+10]=d,this.int16[S+11]=v,u}}Fn.prototype.bytesPerElement=24,Rr("StructArrayLayout4i4ui4i24",Fn);class ic extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C){const D=this.length;return this.resize(D+1),this.emplace(D,u,m,C)}emplace(u,m,C,D){const Q=3*u;return this.float32[Q+0]=m,this.float32[Q+1]=C,this.float32[Q+2]=D,u}}ic.prototype.bytesPerElement=12,Rr("StructArrayLayout3f12",ic);class nc extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(u){const m=this.length;return this.resize(m+1),this.emplace(m,u)}emplace(u,m){return this.uint32[1*u+0]=m,u}}nc.prototype.bytesPerElement=4,Rr("StructArrayLayout1ul4",nc);class Uo extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H,X,ie,de){const h=this.length;return this.resize(h+1),this.emplace(h,u,m,C,D,Q,H,X,ie,de)}emplace(u,m,C,D,Q,H,X,ie,de,h){const c=10*u,d=5*u;return this.int16[c+0]=m,this.int16[c+1]=C,this.int16[c+2]=D,this.int16[c+3]=Q,this.int16[c+4]=H,this.int16[c+5]=X,this.uint32[d+3]=ie,this.uint16[c+8]=de,this.uint16[c+9]=h,u}}Uo.prototype.bytesPerElement=20,Rr("StructArrayLayout6i1ul2ui20",Uo);class Oa extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H){const X=this.length;return this.resize(X+1),this.emplace(X,u,m,C,D,Q,H)}emplace(u,m,C,D,Q,H,X){const ie=6*u;return this.int16[ie+0]=m,this.int16[ie+1]=C,this.int16[ie+2]=D,this.int16[ie+3]=Q,this.int16[ie+4]=H,this.int16[ie+5]=X,u}}Oa.prototype.bytesPerElement=12,Rr("StructArrayLayout2i2i2i12",Oa);class sc extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q){const H=this.length;return this.resize(H+1),this.emplace(H,u,m,C,D,Q)}emplace(u,m,C,D,Q,H){const X=4*u,ie=8*u;return this.float32[X+0]=m,this.float32[X+1]=C,this.float32[X+2]=D,this.int16[ie+6]=Q,this.int16[ie+7]=H,u}}sc.prototype.bytesPerElement=16,Rr("StructArrayLayout2f1f2i16",sc);class Xc extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,D){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,m,C,D)}emplace(u,m,C,D,Q){const H=12*u,X=3*u;return this.uint8[H+0]=m,this.uint8[H+1]=C,this.float32[X+1]=D,this.float32[X+2]=Q,u}}Xc.prototype.bytesPerElement=12,Rr("StructArrayLayout2ub2f12",Xc);class No extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C){const D=this.length;return this.resize(D+1),this.emplace(D,u,m,C)}emplace(u,m,C,D){const Q=3*u;return this.uint16[Q+0]=m,this.uint16[Q+1]=C,this.uint16[Q+2]=D,u}}No.prototype.bytesPerElement=6,Rr("StructArrayLayout3ui6",No);class oc extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H,X,ie,de,h,c,d,v,S,P,k,G){const W=this.length;return this.resize(W+1),this.emplace(W,u,m,C,D,Q,H,X,ie,de,h,c,d,v,S,P,k,G)}emplace(u,m,C,D,Q,H,X,ie,de,h,c,d,v,S,P,k,G,W){const ee=24*u,ae=12*u,fe=48*u;return this.int16[ee+0]=m,this.int16[ee+1]=C,this.uint16[ee+2]=D,this.uint16[ee+3]=Q,this.uint32[ae+2]=H,this.uint32[ae+3]=X,this.uint32[ae+4]=ie,this.uint16[ee+10]=de,this.uint16[ee+11]=h,this.uint16[ee+12]=c,this.float32[ae+7]=d,this.float32[ae+8]=v,this.uint8[fe+36]=S,this.uint8[fe+37]=P,this.uint8[fe+38]=k,this.uint32[ae+10]=G,this.int16[ee+22]=W,u}}oc.prototype.bytesPerElement=48,Rr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",oc);class wa extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,D,Q,H,X,ie,de,h,c,d,v,S,P,k,G,W,ee,ae,fe,me,Ce,Me,Ue,$e,Ke,ut){const tt=this.length;return this.resize(tt+1),this.emplace(tt,u,m,C,D,Q,H,X,ie,de,h,c,d,v,S,P,k,G,W,ee,ae,fe,me,Ce,Me,Ue,$e,Ke,ut)}emplace(u,m,C,D,Q,H,X,ie,de,h,c,d,v,S,P,k,G,W,ee,ae,fe,me,Ce,Me,Ue,$e,Ke,ut,tt){const it=32*u,yt=16*u;return this.int16[it+0]=m,this.int16[it+1]=C,this.int16[it+2]=D,this.int16[it+3]=Q,this.int16[it+4]=H,this.int16[it+5]=X,this.int16[it+6]=ie,this.int16[it+7]=de,this.uint16[it+8]=h,this.uint16[it+9]=c,this.uint16[it+10]=d,this.uint16[it+11]=v,this.uint16[it+12]=S,this.uint16[it+13]=P,this.uint16[it+14]=k,this.uint16[it+15]=G,this.uint16[it+16]=W,this.uint16[it+17]=ee,this.uint16[it+18]=ae,this.uint16[it+19]=fe,this.uint16[it+20]=me,this.uint16[it+21]=Ce,this.uint16[it+22]=Me,this.uint32[yt+12]=Ue,this.float32[yt+13]=$e,this.float32[yt+14]=Ke,this.uint16[it+30]=ut,this.uint16[it+31]=tt,u}}wa.prototype.bytesPerElement=64,Rr("StructArrayLayout8i15ui1ul2f2ui64",wa);class Qi extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u){const m=this.length;return this.resize(m+1),this.emplace(m,u)}emplace(u,m){return this.float32[1*u+0]=m,u}}Qi.prototype.bytesPerElement=4,Rr("StructArrayLayout1f4",Qi);class N extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C){const D=this.length;return this.resize(D+1),this.emplace(D,u,m,C)}emplace(u,m,C,D){const Q=3*u;return this.uint16[6*u+0]=m,this.float32[Q+1]=C,this.float32[Q+2]=D,u}}N.prototype.bytesPerElement=12,Rr("StructArrayLayout1ui2f12",N);class A extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m,C){const D=this.length;return this.resize(D+1),this.emplace(D,u,m,C)}emplace(u,m,C,D){const Q=4*u;return this.uint32[2*u+0]=m,this.uint16[Q+2]=C,this.uint16[Q+3]=D,u}}A.prototype.bytesPerElement=8,Rr("StructArrayLayout1ul2ui8",A);class b extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u,m){const C=this.length;return this.resize(C+1),this.emplace(C,u,m)}emplace(u,m,C){const D=2*u;return this.uint16[D+0]=m,this.uint16[D+1]=C,u}}b.prototype.bytesPerElement=4,Rr("StructArrayLayout2ui4",b);class M extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(u){const m=this.length;return this.resize(m+1),this.emplace(m,u)}emplace(u,m){return this.uint16[1*u+0]=m,u}}M.prototype.bytesPerElement=2,Rr("StructArrayLayout1ui2",M);class O extends Qr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(u,m,C,D){const Q=this.length;return this.resize(Q+1),this.emplace(Q,u,m,C,D)}emplace(u,m,C,D,Q){const H=4*u;return this.float32[H+0]=m,this.float32[H+1]=C,this.float32[H+2]=D,this.float32[H+3]=Q,u}}O.prototype.bytesPerElement=16,Rr("StructArrayLayout4f16",O);class z extends Kr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new I(this.anchorPointX,this.anchorPointY)}}z.prototype.size=20;class J extends Uo{get(u){return new z(this,u)}}Rr("CollisionBoxArray",J);class w extends Kr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(u){this._structArray.uint8[this._pos1+37]=u}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(u){this._structArray.uint8[this._pos1+38]=u}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(u){this._structArray.uint32[this._pos4+10]=u}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}w.prototype.size=48;class l extends oc{get(u){return new w(this,u)}}Rr("PlacedSymbolArray",l);class p extends Kr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(u){this._structArray.uint32[this._pos4+12]=u}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}p.prototype.size=64;class x extends wa{get(u){return new p(this,u)}}Rr("SymbolInstanceArray",x);class B extends Qi{getoffsetX(u){return this.float32[1*u+0]}}Rr("GlyphOffsetArray",B);class L extends sn{getx(u){return this.int16[3*u+0]}gety(u){return this.int16[3*u+1]}gettileUnitDistanceFromAnchor(u){return this.int16[3*u+2]}}Rr("SymbolLineVertexArray",L);class j extends Kr{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}j.prototype.size=12;class _ extends N{get(u){return new j(this,u)}}Rr("TextAnchorOffsetArray",_);class E extends Kr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}E.prototype.size=8;class F extends A{get(u){return new E(this,u)}}Rr("FeatureIndexArray",F);class V extends ko{}class q extends ko{}class K extends ko{}class te extends Oo{}class se extends _u{}class oe extends Ws{}class le extends Yi{}class _e extends Fn{}class Ie extends ic{}class ve extends nc{}class Se extends Oa{}class et extends Xc{}class Oe extends No{}class Re extends b{}const Ve=Xn([{name:"a_pos",components:2,type:"Int16"}],4),{members:At}=Ve;class dt{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=u}prepareSegment(u,m,C,D){let Q=this.segments[this.segments.length-1];return u>dt.MAX_VERTEX_ARRAY_LENGTH&&Ye(`Max vertices per segment is ${dt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${u}`),(!Q||Q.vertexLength+u>dt.MAX_VERTEX_ARRAY_LENGTH||Q.sortKey!==D)&&(Q={vertexOffset:m.length,primitiveOffset:C.length,vertexLength:0,primitiveLength:0},D!==void 0&&(Q.sortKey=D),this.segments.push(Q)),Q}get(){return this.segments}destroy(){for(const u of this.segments)for(const m in u.vaos)u.vaos[m].destroy()}static simpleSegment(u,m,C,D){return new dt([{vertexOffset:u,primitiveOffset:m,vertexLength:C,primitiveLength:D,vaos:{},sortKey:0}])}}function ft(f,u){return 256*(f=qe(Math.floor(f),0,255))+qe(Math.floor(u),0,255)}dt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Rr("SegmentVector",dt);const Nt=Xn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var It={exports:{}},jt={exports:{}};jt.exports=function(f,u){var m,C,D,Q,H,X,ie,de;for(C=f.length-(m=3&f.length),D=u,H=3432918353,X=461845907,de=0;de<C;)ie=255&f.charCodeAt(de)|(255&f.charCodeAt(++de))<<8|(255&f.charCodeAt(++de))<<16|(255&f.charCodeAt(++de))<<24,++de,D=27492+(65535&(Q=5*(65535&(D=(D^=ie=(65535&(ie=(ie=(65535&ie)*H+(((ie>>>16)*H&65535)<<16)&4294967295)<<15|ie>>>17))*X+(((ie>>>16)*X&65535)<<16)&4294967295)<<13|D>>>19))+((5*(D>>>16)&65535)<<16)&4294967295))+((58964+(Q>>>16)&65535)<<16);switch(ie=0,m){case 3:ie^=(255&f.charCodeAt(de+2))<<16;case 2:ie^=(255&f.charCodeAt(de+1))<<8;case 1:D^=ie=(65535&(ie=(ie=(65535&(ie^=255&f.charCodeAt(de)))*H+(((ie>>>16)*H&65535)<<16)&4294967295)<<15|ie>>>17))*X+(((ie>>>16)*X&65535)<<16)&4294967295}return D^=f.length,D=2246822507*(65535&(D^=D>>>16))+((2246822507*(D>>>16)&65535)<<16)&4294967295,D=3266489909*(65535&(D^=D>>>13))+((3266489909*(D>>>16)&65535)<<16)&4294967295,(D^=D>>>16)>>>0};var Ht=jt.exports,Pr={exports:{}};Pr.exports=function(f,u){for(var m,C=f.length,D=u^C,Q=0;C>=4;)m=1540483477*(65535&(m=255&f.charCodeAt(Q)|(255&f.charCodeAt(++Q))<<8|(255&f.charCodeAt(++Q))<<16|(255&f.charCodeAt(++Q))<<24))+((1540483477*(m>>>16)&65535)<<16),D=1540483477*(65535&D)+((1540483477*(D>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),C-=4,++Q;switch(C){case 3:D^=(255&f.charCodeAt(Q+2))<<16;case 2:D^=(255&f.charCodeAt(Q+1))<<8;case 1:D=1540483477*(65535&(D^=255&f.charCodeAt(Q)))+((1540483477*(D>>>16)&65535)<<16)}return D=1540483477*(65535&(D^=D>>>13))+((1540483477*(D>>>16)&65535)<<16),(D^=D>>>15)>>>0};var yr=Ht,Ir=Pr.exports;It.exports=yr,It.exports.murmur3=yr,It.exports.murmur2=Ir;var hr=g(It.exports);class li{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(u,m,C,D){this.ids.push(ti(u)),this.positions.push(m,C,D)}getPositions(u){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const m=ti(u);let C=0,D=this.ids.length-1;for(;C<D;){const H=C+D>>1;this.ids[H]>=m?D=H:C=H+1}const Q=[];for(;this.ids[C]===m;)Q.push({index:this.positions[3*C],start:this.positions[3*C+1],end:this.positions[3*C+2]}),C++;return Q}static serialize(u,m){const C=new Float64Array(u.ids),D=new Uint32Array(u.positions);return ii(C,D,0,C.length-1),m&&m.push(C.buffer,D.buffer),{ids:C,positions:D}}static deserialize(u){const m=new li;return m.ids=u.ids,m.positions=u.positions,m.indexed=!0,m}}function ti(f){const u=+f;return!isNaN(u)&&u<=Number.MAX_SAFE_INTEGER?u:hr(String(f))}function ii(f,u,m,C){for(;m<C;){const D=f[m+C>>1];let Q=m-1,H=C+1;for(;;){do Q++;while(f[Q]<D);do H--;while(f[H]>D);if(Q>=H)break;Ri(f,Q,H),Ri(u,3*Q,3*H),Ri(u,3*Q+1,3*H+1),Ri(u,3*Q+2,3*H+2)}H-m<C-H?(ii(f,u,m,H),m=H+1):(ii(f,u,H+1,C),C=H)}}function Ri(f,u,m){const C=f[u];f[u]=f[m],f[m]=C}Rr("FeaturePositionMap",li);class ki{constructor(u,m){this.gl=u.gl,this.location=m}}class wi extends ki{constructor(u,m){super(u,m),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Ki extends ki{constructor(u,m){super(u,m),this.current=[0,0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))}}class xi extends ki{constructor(u,m){super(u,m),this.current=mi.transparent}set(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))}}const Zn=new Float32Array(16);function Wi(f){return[ft(255*f.r,255*f.g),ft(255*f.b,255*f.a)]}class Oi{constructor(u,m,C){this.value=u,this.uniformNames=m.map(D=>`u_${D}`),this.type=C}setUniform(u,m,C){u.set(C.constantOr(this.value))}getBinding(u,m,C){return this.type==="color"?new xi(u,m):new wi(u,m)}}class Xi{constructor(u,m){this.uniformNames=m.map(C=>`u_${C}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(u,m){this.pixelRatioFrom=m.pixelRatio,this.pixelRatioTo=u.pixelRatio,this.patternFrom=m.tlbr,this.patternTo=u.tlbr}setUniform(u,m,C,D){const Q=D==="u_pattern_to"?this.patternTo:D==="u_pattern_from"?this.patternFrom:D==="u_pixel_ratio_to"?this.pixelRatioTo:D==="u_pixel_ratio_from"?this.pixelRatioFrom:null;Q&&u.set(Q)}getBinding(u,m,C){return C.substr(0,9)==="u_pattern"?new Ki(u,m):new wi(u,m)}}class hi{constructor(u,m,C,D){this.expression=u,this.type=C,this.maxValue=0,this.paintVertexAttributes=m.map(Q=>({name:`a_${Q}`,type:"Float32",components:C==="color"?2:1,offset:0})),this.paintVertexArray=new D}populatePaintArray(u,m,C,D,Q){const H=this.paintVertexArray.length,X=this.expression.evaluate(new vn(0),m,{},D,[],Q);this.paintVertexArray.resize(u),this._setPaintValue(H,u,X)}updatePaintArray(u,m,C,D){const Q=this.expression.evaluate({zoom:0},C,D);this._setPaintValue(u,m,Q)}_setPaintValue(u,m,C){if(this.type==="color"){const D=Wi(C);for(let Q=u;Q<m;Q++)this.paintVertexArray.emplace(Q,D[0],D[1])}else{for(let D=u;D<m;D++)this.paintVertexArray.emplace(D,C);this.maxValue=Math.max(this.maxValue,Math.abs(C))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class zi{constructor(u,m,C,D,Q,H){this.expression=u,this.uniformNames=m.map(X=>`u_${X}_t`),this.type=C,this.useIntegerZoom=D,this.zoom=Q,this.maxValue=0,this.paintVertexAttributes=m.map(X=>({name:`a_${X}`,type:"Float32",components:C==="color"?4:2,offset:0})),this.paintVertexArray=new H}populatePaintArray(u,m,C,D,Q){const H=this.expression.evaluate(new vn(this.zoom),m,{},D,[],Q),X=this.expression.evaluate(new vn(this.zoom+1),m,{},D,[],Q),ie=this.paintVertexArray.length;this.paintVertexArray.resize(u),this._setPaintValue(ie,u,H,X)}updatePaintArray(u,m,C,D){const Q=this.expression.evaluate({zoom:this.zoom},C,D),H=this.expression.evaluate({zoom:this.zoom+1},C,D);this._setPaintValue(u,m,Q,H)}_setPaintValue(u,m,C,D){if(this.type==="color"){const Q=Wi(C),H=Wi(D);for(let X=u;X<m;X++)this.paintVertexArray.emplace(X,Q[0],Q[1],H[0],H[1])}else{for(let Q=u;Q<m;Q++)this.paintVertexArray.emplace(Q,C,D);this.maxValue=Math.max(this.maxValue,Math.abs(C),Math.abs(D))}}upload(u){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=u.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(u,m){const C=this.useIntegerZoom?Math.floor(m.zoom):m.zoom,D=qe(this.expression.interpolationFactor(C,this.zoom,this.zoom+1),0,1);u.set(D)}getBinding(u,m,C){return new wi(u,m)}}class on{constructor(u,m,C,D,Q,H){this.expression=u,this.type=m,this.useIntegerZoom=C,this.zoom=D,this.layerId=H,this.zoomInPaintVertexArray=new Q,this.zoomOutPaintVertexArray=new Q}populatePaintArray(u,m,C){const D=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(u),this.zoomOutPaintVertexArray.resize(u),this._setPaintValues(D,u,m.patterns&&m.patterns[this.layerId],C)}updatePaintArray(u,m,C,D,Q){this._setPaintValues(u,m,C.patterns&&C.patterns[this.layerId],Q)}_setPaintValues(u,m,C,D){if(!D||!C)return;const{min:Q,mid:H,max:X}=C,ie=D[Q],de=D[H],h=D[X];if(ie&&de&&h)for(let c=u;c<m;c++)this.zoomInPaintVertexArray.emplace(c,de.tl[0],de.tl[1],de.br[0],de.br[1],ie.tl[0],ie.tl[1],ie.br[0],ie.br[1],de.pixelRatio,ie.pixelRatio),this.zoomOutPaintVertexArray.emplace(c,de.tl[0],de.tl[1],de.br[0],de.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],de.pixelRatio,h.pixelRatio)}upload(u){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=u.createVertexBuffer(this.zoomInPaintVertexArray,Nt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=u.createVertexBuffer(this.zoomOutPaintVertexArray,Nt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class rs{constructor(u,m,C){this.binders={},this._buffers=[];const D=[];for(const Q in u.paint._values){if(!C(Q))continue;const H=u.paint.get(Q);if(!(H instanceof xa&&ct(H.property.specification)))continue;const X=is(Q,u.type),ie=H.value,de=H.property.specification.type,h=H.property.useIntegerZoom,c=H.property.specification["property-type"],d=c==="cross-faded"||c==="cross-faded-data-driven";if(ie.kind==="constant")this.binders[Q]=d?new Xi(ie.value,X):new Oi(ie.value,X,de),D.push(`/u_${Q}`);else if(ie.kind==="source"||d){const v=Es(Q,de,"source");this.binders[Q]=d?new on(ie,de,h,m,v,u.id):new hi(ie,X,de,v),D.push(`/a_${Q}`)}else{const v=Es(Q,de,"composite");this.binders[Q]=new zi(ie,X,de,h,m,v),D.push(`/z_${Q}`)}}this.cacheKey=D.sort().join("")}getMaxValue(u){const m=this.binders[u];return m instanceof hi||m instanceof zi?m.maxValue:0}populatePaintArrays(u,m,C,D,Q){for(const H in this.binders){const X=this.binders[H];(X instanceof hi||X instanceof zi||X instanceof on)&&X.populatePaintArray(u,m,C,D,Q)}}setConstantPatternPositions(u,m){for(const C in this.binders){const D=this.binders[C];D instanceof Xi&&D.setConstantPatternPositions(u,m)}}updatePaintArrays(u,m,C,D,Q){let H=!1;for(const X in u){const ie=m.getPositions(X);for(const de of ie){const h=C.feature(de.index);for(const c in this.binders){const d=this.binders[c];if((d instanceof hi||d instanceof zi||d instanceof on)&&d.expression.isStateDependent===!0){const v=D.paint.get(c);d.expression=v.value,d.updatePaintArray(de.start,de.end,h,u[X],Q),H=!0}}}}return H}defines(){const u=[];for(const m in this.binders){const C=this.binders[m];(C instanceof Oi||C instanceof Xi)&&u.push(...C.uniformNames.map(D=>`#define HAS_UNIFORM_${D}`))}return u}getBinderAttributes(){const u=[];for(const m in this.binders){const C=this.binders[m];if(C instanceof hi||C instanceof zi)for(let D=0;D<C.paintVertexAttributes.length;D++)u.push(C.paintVertexAttributes[D].name);else if(C instanceof on)for(let D=0;D<Nt.members.length;D++)u.push(Nt.members[D].name)}return u}getBinderUniforms(){const u=[];for(const m in this.binders){const C=this.binders[m];if(C instanceof Oi||C instanceof Xi||C instanceof zi)for(const D of C.uniformNames)u.push(D)}return u}getPaintVertexBuffers(){return this._buffers}getUniforms(u,m){const C=[];for(const D in this.binders){const Q=this.binders[D];if(Q instanceof Oi||Q instanceof Xi||Q instanceof zi){for(const H of Q.uniformNames)if(m[H]){const X=Q.getBinding(u,m[H],H);C.push({name:H,property:D,binding:X})}}}return C}setUniforms(u,m,C,D){for(const{name:Q,property:H,binding:X}of m)this.binders[H].setUniform(X,D,C.get(H),Q)}updatePaintBuffers(u){this._buffers=[];for(const m in this.binders){const C=this.binders[m];if(u&&C instanceof on){const D=u.fromScale===2?C.zoomInPaintVertexBuffer:C.zoomOutPaintVertexBuffer;D&&this._buffers.push(D)}else(C instanceof hi||C instanceof zi)&&C.paintVertexBuffer&&this._buffers.push(C.paintVertexBuffer)}}upload(u){for(const m in this.binders){const C=this.binders[m];(C instanceof hi||C instanceof zi||C instanceof on)&&C.upload(u)}this.updatePaintBuffers()}destroy(){for(const u in this.binders){const m=this.binders[u];(m instanceof hi||m instanceof zi||m instanceof on)&&m.destroy()}}}class an{constructor(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const D of u)this.programConfigurations[D.id]=new rs(D,m,C);this.needsUpload=!1,this._featureMap=new li,this._bufferOffset=0}populatePaintArrays(u,m,C,D,Q,H){for(const X in this.programConfigurations)this.programConfigurations[X].populatePaintArrays(u,m,D,Q,H);m.id!==void 0&&this._featureMap.add(m.id,C,this._bufferOffset,u),this._bufferOffset=u,this.needsUpload=!0}updatePaintArrays(u,m,C,D){for(const Q of C)this.needsUpload=this.programConfigurations[Q.id].updatePaintArrays(u,this._featureMap,m,Q,D)||this.needsUpload}get(u){return this.programConfigurations[u]}upload(u){if(this.needsUpload){for(const m in this.programConfigurations)this.programConfigurations[m].upload(u);this.needsUpload=!1}}destroy(){for(const u in this.programConfigurations)this.programConfigurations[u].destroy()}}function is(f,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[f]||[f.replace(`${u}-`,"").replace(/-/g,"_")]}function Es(f,u,m){const C={color:{source:Ws,composite:O},number:{source:Qi,composite:Ws}},D=function(Q){return{"line-pattern":{source:le,composite:le},"fill-pattern":{source:le,composite:le},"fill-extrusion-pattern":{source:le,composite:le}}[Q]}(f);return D&&D[m]||C[u][m]}Rr("ConstantBinder",Oi),Rr("CrossFadedConstantBinder",Xi),Rr("SourceExpressionBinder",hi),Rr("CrossFadedCompositeBinder",on),Rr("CompositeExpressionBinder",zi),Rr("ProgramConfiguration",rs,{omit:["_buffers"]}),Rr("ProgramConfigurationSet",an);const yi=8192,bn=Math.pow(2,14)-1,ia=-bn-1;function Ns(f){const u=yi/f.extent,m=f.loadGeometry();for(let C=0;C<m.length;C++){const D=m[C];for(let Q=0;Q<D.length;Q++){const H=D[Q],X=Math.round(H.x*u),ie=Math.round(H.y*u);H.x=qe(X,ia,bn),H.y=qe(ie,ia,bn),(X<H.x||X>H.x+1||ie<H.y||ie>H.y+1)&&Ye("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return m}function so(f,u){return{type:f.type,id:f.id,properties:f.properties,geometry:u?Ns(f):[]}}function xl(f,u,m,C,D){f.emplaceBack(2*u+(C+1)/2,2*m+(D+1)/2)}class bo{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new q,this.indexArray=new Oe,this.segments=new dt,this.programConfigurations=new an(u.layers,u.zoom),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){const D=this.layers[0],Q=[];let H=null,X=!1;D.type==="circle"&&(H=D.layout.get("circle-sort-key"),X=!H.isConstant());for(const{feature:ie,id:de,index:h,sourceLayerIndex:c}of u){const d=this.layers[0]._featureFilter.needGeometry,v=so(ie,d);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),v,C))continue;const S=X?H.evaluate(v,{},C):void 0,P={id:de,properties:ie.properties,type:ie.type,sourceLayerIndex:c,index:h,geometry:d?v.geometry:Ns(ie),patterns:{},sortKey:S};Q.push(P)}X&&Q.sort((ie,de)=>ie.sortKey-de.sortKey);for(const ie of Q){const{geometry:de,index:h,sourceLayerIndex:c}=ie,d=u[h].feature;this.addFeature(ie,de,h,C),m.featureIndex.insert(d,de,h,c,this.index)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,At),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(u,m,C,D){for(const Q of m)for(const H of Q){const X=H.x,ie=H.y;if(X<0||X>=yi||ie<0||ie>=yi)continue;const de=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,u.sortKey),h=de.vertexLength;xl(this.layoutVertexArray,X,ie,-1,-1),xl(this.layoutVertexArray,X,ie,1,-1),xl(this.layoutVertexArray,X,ie,1,1),xl(this.layoutVertexArray,X,ie,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),de.vertexLength+=4,de.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,{},D)}}function ac(f,u){for(let m=0;m<f.length;m++)if(Zc(u,f[m]))return!0;for(let m=0;m<u.length;m++)if(Zc(f,u[m]))return!0;return!!vu(f,u)}function Ua(f,u,m){return!!Zc(f,u)||!!al(u,f,m)}function Dn(f,u){if(f.length===1)return hA(u,f[0]);for(let m=0;m<u.length;m++){const C=u[m];for(let D=0;D<C.length;D++)if(Zc(f,C[D]))return!0}for(let m=0;m<f.length;m++)if(hA(u,f[m]))return!0;for(let m=0;m<u.length;m++)if(vu(f,u[m]))return!0;return!1}function Ec(f,u,m){if(f.length>1){if(vu(f,u))return!0;for(let C=0;C<u.length;C++)if(al(u[C],f,m))return!0}for(let C=0;C<f.length;C++)if(al(f[C],u,m))return!0;return!1}function vu(f,u){if(f.length===0||u.length===0)return!1;for(let m=0;m<f.length-1;m++){const C=f[m],D=f[m+1];for(let Q=0;Q<u.length-1;Q++)if(wl(C,D,u[Q],u[Q+1]))return!0}return!1}function wl(f,u,m,C){return Xe(f,m,C)!==Xe(u,m,C)&&Xe(f,u,m)!==Xe(f,u,C)}function al(f,u,m){const C=m*m;if(u.length===1)return f.distSqr(u[0])<C;for(let D=1;D<u.length;D++)if(qu(f,u[D-1],u[D])<C)return!0;return!1}function qu(f,u,m){const C=u.distSqr(m);if(C===0)return f.distSqr(u);const D=((f.x-u.x)*(m.x-u.x)+(f.y-u.y)*(m.y-u.y))/C;return f.distSqr(D<0?u:D>1?m:m.sub(u)._mult(D)._add(u))}function hA(f,u){let m,C,D,Q=!1;for(let H=0;H<f.length;H++){m=f[H];for(let X=0,ie=m.length-1;X<m.length;ie=X++)C=m[X],D=m[ie],C.y>u.y!=D.y>u.y&&u.x<(D.x-C.x)*(u.y-C.y)/(D.y-C.y)+C.x&&(Q=!Q)}return Q}function Zc(f,u){let m=!1;for(let C=0,D=f.length-1;C<f.length;D=C++){const Q=f[C],H=f[D];Q.y>u.y!=H.y>u.y&&u.x<(H.x-Q.x)*(u.y-Q.y)/(H.y-Q.y)+Q.x&&(m=!m)}return m}function JA(f,u,m){const C=m[0],D=m[2];if(f.x<C.x&&u.x<C.x||f.x>D.x&&u.x>D.x||f.y<C.y&&u.y<C.y||f.y>D.y&&u.y>D.y)return!1;const Q=Xe(f,u,m[0]);return Q!==Xe(f,u,m[1])||Q!==Xe(f,u,m[2])||Q!==Xe(f,u,m[3])}function AA(f,u,m){const C=u.paint.get(f).value;return C.kind==="constant"?C.value:m.programConfigurations.get(u.id).getMaxValue(f)}function Gd(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])}function $u(f,u,m,C,D){if(!u[0]&&!u[1])return f;const Q=I.convert(u)._mult(D);m==="viewport"&&Q._rotate(-C);const H=[];for(let X=0;X<f.length;X++)H.push(f[X].sub(Q));return H}let bu,jd;Rr("CircleBucket",bo,{omit:["layers"]});var wm={get paint(){return jd=jd||new Us({"circle-radius":new oi(wt.paint_circle["circle-radius"]),"circle-color":new oi(wt.paint_circle["circle-color"]),"circle-blur":new oi(wt.paint_circle["circle-blur"]),"circle-opacity":new oi(wt.paint_circle["circle-opacity"]),"circle-translate":new Sr(wt.paint_circle["circle-translate"]),"circle-translate-anchor":new Sr(wt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Sr(wt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Sr(wt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new oi(wt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new oi(wt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new oi(wt.paint_circle["circle-stroke-opacity"])})},get layout(){return bu=bu||new Us({"circle-sort-key":new oi(wt.layout_circle["circle-sort-key"])})}},na=1e-6,lc=typeof Float32Array<"u"?Float32Array:Array;function dA(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function Sh(f,u,m){var C=u[0],D=u[1],Q=u[2],H=u[3],X=u[4],ie=u[5],de=u[6],h=u[7],c=u[8],d=u[9],v=u[10],S=u[11],P=u[12],k=u[13],G=u[14],W=u[15],ee=m[0],ae=m[1],fe=m[2],me=m[3];return f[0]=ee*C+ae*X+fe*c+me*P,f[1]=ee*D+ae*ie+fe*d+me*k,f[2]=ee*Q+ae*de+fe*v+me*G,f[3]=ee*H+ae*h+fe*S+me*W,f[4]=(ee=m[4])*C+(ae=m[5])*X+(fe=m[6])*c+(me=m[7])*P,f[5]=ee*D+ae*ie+fe*d+me*k,f[6]=ee*Q+ae*de+fe*v+me*G,f[7]=ee*H+ae*h+fe*S+me*W,f[8]=(ee=m[8])*C+(ae=m[9])*X+(fe=m[10])*c+(me=m[11])*P,f[9]=ee*D+ae*ie+fe*d+me*k,f[10]=ee*Q+ae*de+fe*v+me*G,f[11]=ee*H+ae*h+fe*S+me*W,f[12]=(ee=m[12])*C+(ae=m[13])*X+(fe=m[14])*c+(me=m[15])*P,f[13]=ee*D+ae*ie+fe*d+me*k,f[14]=ee*Q+ae*de+fe*v+me*G,f[15]=ee*H+ae*h+fe*S+me*W,f}Math.hypot||(Math.hypot=function(){for(var f=0,u=arguments.length;u--;)f+=arguments[u]*arguments[u];return Math.sqrt(f)});var xu,Th=Sh;function Ih(f,u,m){var C=u[0],D=u[1],Q=u[2],H=u[3];return f[0]=m[0]*C+m[4]*D+m[8]*Q+m[12]*H,f[1]=m[1]*C+m[5]*D+m[9]*Q+m[13]*H,f[2]=m[2]*C+m[6]*D+m[10]*Q+m[14]*H,f[3]=m[3]*C+m[7]*D+m[11]*Q+m[15]*H,f}xu=new lc(4),lc!=Float32Array&&(xu[0]=0,xu[1]=0,xu[2]=0,xu[3]=0);class fA extends Wn{constructor(u){super(u,wm)}createBucket(u){return new bo(u)}queryRadius(u){const m=u;return AA("circle-radius",this,m)+AA("circle-stroke-width",this,m)+Gd(this.paint.get("circle-translate"))}queryIntersectsFeature(u,m,C,D,Q,H,X,ie){const de=$u(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),H.angle,X),h=this.paint.get("circle-radius").evaluate(m,C)+this.paint.get("circle-stroke-width").evaluate(m,C),c=this.paint.get("circle-pitch-alignment")==="map",d=c?de:function(S,P){return S.map(k=>cp(k,P))}(de,ie),v=c?h*X:h;for(const S of D)for(const P of S){const k=c?P:cp(P,ie);let G=v;const W=Ih([],[P.x,P.y,0,1],ie);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?G*=W[3]/H.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(G*=H.cameraToCenterDistance/W[3]),Ua(d,k,G))return!0}return!1}}function cp(f,u){const m=Ih([],[f.x,f.y,0,1],u);return new I(m[0]/m[3],m[1]/m[3])}class sa extends bo{}let Jc;Rr("HeatmapBucket",sa,{omit:["layers"]});var qd={get paint(){return Jc=Jc||new Us({"heatmap-radius":new oi(wt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new oi(wt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Sr(wt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rc(wt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Sr(wt.paint_heatmap["heatmap-opacity"])})}};function pA(f,u,m,C){let{width:D,height:Q}=u;if(C){if(C instanceof Uint8ClampedArray)C=new Uint8Array(C.buffer);else if(C.length!==D*Q*m)throw new RangeError(`mismatched image size. expected: ${C.length} but got: ${D*Q*m}`)}else C=new Uint8Array(D*Q*m);return f.width=D,f.height=Q,f.data=C,f}function Bl(f,u,m){let{width:C,height:D}=u;if(C===f.width&&D===f.height)return;const Q=pA({},{width:C,height:D},m);$d(f,Q,{x:0,y:0},{x:0,y:0},{width:Math.min(f.width,C),height:Math.min(f.height,D)},m),f.width=C,f.height=D,f.data=Q.data}function $d(f,u,m,C,D,Q){if(D.width===0||D.height===0)return u;if(D.width>f.width||D.height>f.height||m.x>f.width-D.width||m.y>f.height-D.height)throw new RangeError("out of range source coordinates for image copy");if(D.width>u.width||D.height>u.height||C.x>u.width-D.width||C.y>u.height-D.height)throw new RangeError("out of range destination coordinates for image copy");const H=f.data,X=u.data;if(H===X)throw new Error("srcData equals dstData, so image is already copied");for(let ie=0;ie<D.height;ie++){const de=((m.y+ie)*f.width+m.x)*Q,h=((C.y+ie)*u.width+C.x)*Q;for(let c=0;c<D.width*Q;c++)X[h+c]=H[de+c]}return u}class wu{constructor(u,m){pA(this,u,1,m)}resize(u){Bl(this,u,1)}clone(){return new wu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,m,C,D,Q){$d(u,m,C,D,Q,1)}}class Cl{constructor(u,m){pA(this,u,4,m)}resize(u){Bl(this,u,4)}replace(u,m){m?this.data.set(u):this.data=u instanceof Uint8ClampedArray?new Uint8Array(u.buffer):u}clone(){return new Cl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(u,m,C,D,Q){$d(u,m,C,D,Q,4)}}function Kd(f){const u={},m=f.resolution||256,C=f.clips?f.clips.length:1,D=f.image||new Cl({width:m,height:C});if(Math.log(m)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${m}`);const Q=(H,X,ie)=>{u[f.evaluationKey]=ie;const de=f.expression.evaluate(u);D.data[H+X+0]=Math.floor(255*de.r/de.a),D.data[H+X+1]=Math.floor(255*de.g/de.a),D.data[H+X+2]=Math.floor(255*de.b/de.a),D.data[H+X+3]=Math.floor(255*de.a)};if(f.clips)for(let H=0,X=0;H<C;++H,X+=4*m)for(let ie=0,de=0;ie<m;ie++,de+=4){const h=ie/(m-1),{start:c,end:d}=f.clips[H];Q(X,de,c*(1-h)+d*h)}else for(let H=0,X=0;H<m;H++,X+=4)Q(0,X,H/(m-1));return D}Rr("AlphaImage",wu),Rr("RGBAImage",Cl);class Lh extends Wn{createBucket(u){return new sa(u)}constructor(u){super(u,qd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Kd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let up;var Bm={get paint(){return up=up||new Us({"hillshade-illumination-direction":new Sr(wt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Sr(wt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Sr(wt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Sr(wt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Sr(wt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Sr(wt.paint_hillshade["hillshade-accent-color"])})}};class hp extends Wn{constructor(u){super(u,Bm)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Ap=Xn([{name:"a_pos",components:2,type:"Int16"}],4),{members:dp}=Ap;var Sc={exports:{}};function zo(f,u,m){m=m||2;var C,D,Q,H,X,ie,de,h=u&&u.length,c=h?u[0]*m:f.length,d=gA(f,0,c,m,!0),v=[];if(!d||d.next===d.prev)return v;if(h&&(d=function(P,k,G,W){var ee,ae,fe,me=[];for(ee=0,ae=k.length;ee<ae;ee++)(fe=gA(P,k[ee]*W,ee<ae-1?k[ee+1]*W:P.length,W,!1))===fe.next&&(fe.steiner=!0),me.push(gp(fe));for(me.sort(pp),ee=0;ee<me.length;ee++)G=mA(me[ee],G);return G}(f,u,d,m)),f.length>80*m){C=Q=f[0],D=H=f[1];for(var S=m;S<c;S+=m)(X=f[S])<C&&(C=X),(ie=f[S+1])<D&&(D=ie),X>Q&&(Q=X),ie>H&&(H=ie);de=(de=Math.max(Q-C,H-D))!==0?32767/de:0}return El(d,v,m,C,D,de,0),v}function gA(f,u,m,C,D){var Q,H;if(D===Jd(f,u,m,C)>0)for(Q=u;Q<m;Q+=C)H=ed(Q,f[Q],f[Q+1],H);else for(Q=m-C;Q>=u;Q-=C)H=ed(Q,f[Q],f[Q+1],H);return H&&Em(H,H.next)&&(mp(H),H=H.next),H}function Na(f,u){if(!f)return f;u||(u=f);var m,C=f;do if(m=!1,C.steiner||!Em(C,C.next)&&oo(C.prev,C,C.next)!==0)C=C.next;else{if(mp(C),(C=u=C.prev)===C.next)break;m=!0}while(m||C!==u);return u}function El(f,u,m,C,D,Q,H){if(f){!H&&Q&&function(h,c,d,v){var S=h;do S.z===0&&(S.z=Mh(S.x,S.y,c,d,v)),S.prevZ=S.prev,S.nextZ=S.next,S=S.next;while(S!==h);S.prevZ.nextZ=null,S.prevZ=null,function(P){var k,G,W,ee,ae,fe,me,Ce,Me=1;do{for(G=P,P=null,ae=null,fe=0;G;){for(fe++,W=G,me=0,k=0;k<Me&&(me++,W=W.nextZ);k++);for(Ce=Me;me>0||Ce>0&&W;)me!==0&&(Ce===0||!W||G.z<=W.z)?(ee=G,G=G.nextZ,me--):(ee=W,W=W.nextZ,Ce--),ae?ae.nextZ=ee:P=ee,ee.prevZ=ae,ae=ee;G=W}ae.nextZ=null,Me*=2}while(fe>1)}(S)}(f,C,D,Q);for(var X,ie,de=f;f.prev!==f.next;)if(X=f.prev,ie=f.next,Q?Wd(f,C,D,Q):Ku(f))u.push(X.i/m|0),u.push(f.i/m|0),u.push(ie.i/m|0),mp(f),f=ie.next,de=ie.next;else if((f=ie)===de){H?H===1?El(f=fp(Na(f),u,m),u,m,C,D,Q,2):H===2&&Cm(f,u,m,C,D,Q):El(Na(f),u,m,C,D,Q,1);break}}}function Ku(f){var u=f.prev,m=f,C=f.next;if(oo(u,m,C)>=0)return!1;for(var D=u.x,Q=m.x,H=C.x,X=u.y,ie=m.y,de=C.y,h=D<Q?D<H?D:H:Q<H?Q:H,c=X<ie?X<de?X:de:ie<de?ie:de,d=D>Q?D>H?D:H:Q>H?Q:H,v=X>ie?X>de?X:de:ie>de?ie:de,S=C.next;S!==u;){if(S.x>=h&&S.x<=d&&S.y>=c&&S.y<=v&&Zd(D,X,Q,ie,H,de,S.x,S.y)&&oo(S.prev,S,S.next)>=0)return!1;S=S.next}return!0}function Wd(f,u,m,C){var D=f.prev,Q=f,H=f.next;if(oo(D,Q,H)>=0)return!1;for(var X=D.x,ie=Q.x,de=H.x,h=D.y,c=Q.y,d=H.y,v=X<ie?X<de?X:de:ie<de?ie:de,S=h<c?h<d?h:d:c<d?c:d,P=X>ie?X>de?X:de:ie>de?ie:de,k=h>c?h>d?h:d:c>d?c:d,G=Mh(v,S,u,m,C),W=Mh(P,k,u,m,C),ee=f.prevZ,ae=f.nextZ;ee&&ee.z>=G&&ae&&ae.z<=W;){if(ee.x>=v&&ee.x<=P&&ee.y>=S&&ee.y<=k&&ee!==D&&ee!==H&&Zd(X,h,ie,c,de,d,ee.x,ee.y)&&oo(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,ae.x>=v&&ae.x<=P&&ae.y>=S&&ae.y<=k&&ae!==D&&ae!==H&&Zd(X,h,ie,c,de,d,ae.x,ae.y)&&oo(ae.prev,ae,ae.next)>=0))return!1;ae=ae.nextZ}for(;ee&&ee.z>=G;){if(ee.x>=v&&ee.x<=P&&ee.y>=S&&ee.y<=k&&ee!==D&&ee!==H&&Zd(X,h,ie,c,de,d,ee.x,ee.y)&&oo(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;ae&&ae.z<=W;){if(ae.x>=v&&ae.x<=P&&ae.y>=S&&ae.y<=k&&ae!==D&&ae!==H&&Zd(X,h,ie,c,de,d,ae.x,ae.y)&&oo(ae.prev,ae,ae.next)>=0)return!1;ae=ae.nextZ}return!0}function fp(f,u,m){var C=f;do{var D=C.prev,Q=C.next.next;!Em(D,Q)&&Lx(D,C,C.next,Q)&&YA(D,Q)&&YA(Q,D)&&(u.push(D.i/m|0),u.push(C.i/m|0),u.push(Q.i/m|0),mp(C),mp(C.next),C=f=Q),C=C.next}while(C!==f);return Na(C)}function Cm(f,u,m,C,D,Q){var H=f;do{for(var X=H.next.next;X!==H.prev;){if(H.i!==X.i&&YI(H,X)){var ie=Mx(H,X);return H=Na(H,H.next),ie=Na(ie,ie.next),El(H,u,m,C,D,Q,0),void El(ie,u,m,C,D,Q,0)}X=X.next}H=H.next}while(H!==f)}function pp(f,u){return f.x-u.x}function mA(f,u){var m=function(D,Q){var H,X=Q,ie=D.x,de=D.y,h=-1/0;do{if(de<=X.y&&de>=X.next.y&&X.next.y!==X.y){var c=X.x+(de-X.y)*(X.next.x-X.x)/(X.next.y-X.y);if(c<=ie&&c>h&&(h=c,H=X.x<X.next.x?X:X.next,c===ie))return H}X=X.next}while(X!==Q);if(!H)return null;var d,v=H,S=H.x,P=H.y,k=1/0;X=H;do ie>=X.x&&X.x>=S&&ie!==X.x&&Zd(de<P?ie:h,de,S,P,de<P?h:ie,de,X.x,X.y)&&(d=Math.abs(de-X.y)/(ie-X.x),YA(X,D)&&(d<k||d===k&&(X.x>H.x||X.x===H.x&&Xd(H,X)))&&(H=X,k=d)),X=X.next;while(X!==v);return H}(f,u);if(!m)return u;var C=Mx(m,f);return Na(C,C.next),Na(m,m.next)}function Xd(f,u){return oo(f.prev,f,u.prev)<0&&oo(u.next,f,f.next)<0}function Mh(f,u,m,C,D){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-m)*D|0)|f<<8))|f<<4))|f<<2))|f<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-C)*D|0)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function gp(f){var u=f,m=f;do(u.x<m.x||u.x===m.x&&u.y<m.y)&&(m=u),u=u.next;while(u!==f);return m}function Zd(f,u,m,C,D,Q,H,X){return(D-H)*(u-X)>=(f-H)*(Q-X)&&(f-H)*(C-X)>=(m-H)*(u-X)&&(m-H)*(Q-X)>=(D-H)*(C-X)}function YI(f,u){return f.next.i!==u.i&&f.prev.i!==u.i&&!function(m,C){var D=m;do{if(D.i!==m.i&&D.next.i!==m.i&&D.i!==C.i&&D.next.i!==C.i&&Lx(D,D.next,m,C))return!0;D=D.next}while(D!==m);return!1}(f,u)&&(YA(f,u)&&YA(u,f)&&function(m,C){var D=m,Q=!1,H=(m.x+C.x)/2,X=(m.y+C.y)/2;do D.y>X!=D.next.y>X&&D.next.y!==D.y&&H<(D.next.x-D.x)*(X-D.y)/(D.next.y-D.y)+D.x&&(Q=!Q),D=D.next;while(D!==m);return Q}(f,u)&&(oo(f.prev,f,u.prev)||oo(f,u.prev,u))||Em(f,u)&&oo(f.prev,f,f.next)>0&&oo(u.prev,u,u.next)>0)}function oo(f,u,m){return(u.y-f.y)*(m.x-u.x)-(u.x-f.x)*(m.y-u.y)}function Em(f,u){return f.x===u.x&&f.y===u.y}function Lx(f,u,m,C){var D=Tm(oo(f,u,m)),Q=Tm(oo(f,u,C)),H=Tm(oo(m,C,f)),X=Tm(oo(m,C,u));return D!==Q&&H!==X||!(D!==0||!Sm(f,m,u))||!(Q!==0||!Sm(f,C,u))||!(H!==0||!Sm(m,f,C))||!(X!==0||!Sm(m,u,C))}function Sm(f,u,m){return u.x<=Math.max(f.x,m.x)&&u.x>=Math.min(f.x,m.x)&&u.y<=Math.max(f.y,m.y)&&u.y>=Math.min(f.y,m.y)}function Tm(f){return f>0?1:f<0?-1:0}function YA(f,u){return oo(f.prev,f,f.next)<0?oo(f,u,f.next)>=0&&oo(f,f.prev,u)>=0:oo(f,u,f.prev)<0||oo(f,f.next,u)<0}function Mx(f,u){var m=new zs(f.i,f.x,f.y),C=new zs(u.i,u.x,u.y),D=f.next,Q=u.prev;return f.next=u,u.prev=f,m.next=D,D.prev=m,C.next=m,m.prev=C,Q.next=C,C.prev=Q,C}function ed(f,u,m,C){var D=new zs(f,u,m);return C?(D.next=C.next,D.prev=C,C.next.prev=D,C.next=D):(D.prev=D,D.next=D),D}function mp(f){f.next.prev=f.prev,f.prev.next=f.next,f.prevZ&&(f.prevZ.nextZ=f.nextZ),f.nextZ&&(f.nextZ.prevZ=f.prevZ)}function zs(f,u,m){this.i=f,this.x=u,this.y=m,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Jd(f,u,m,C){for(var D=0,Q=u,H=m-C;Q<m;Q+=C)D+=(f[H]-f[Q])*(f[Q+1]+f[H+1]),H=Q;return D}Sc.exports=zo,Sc.exports.default=zo,zo.deviation=function(f,u,m,C){var D=u&&u.length,Q=Math.abs(Jd(f,0,D?u[0]*m:f.length,m));if(D)for(var H=0,X=u.length;H<X;H++)Q-=Math.abs(Jd(f,u[H]*m,H<X-1?u[H+1]*m:f.length,m));var ie=0;for(H=0;H<C.length;H+=3){var de=C[H]*m,h=C[H+1]*m,c=C[H+2]*m;ie+=Math.abs((f[de]-f[c])*(f[h+1]-f[de+1])-(f[de]-f[h])*(f[c+1]-f[de+1]))}return Q===0&&ie===0?0:Math.abs((ie-Q)/Q)},zo.flatten=function(f){for(var u=f[0][0].length,m={vertices:[],holes:[],dimensions:u},C=0,D=0;D<f.length;D++){for(var Q=0;Q<f[D].length;Q++)for(var H=0;H<u;H++)m.vertices.push(f[D][Q][H]);D>0&&m.holes.push(C+=f[D-1].length)}return m};var e_=g(Sc.exports);function Im(f,u,m,C,D){yp(f,u,m||0,C||f.length-1,D||Px)}function yp(f,u,m,C,D){for(;C>m;){if(C-m>600){var Q=C-m+1,H=u-m+1,X=Math.log(Q),ie=.5*Math.exp(2*X/3),de=.5*Math.sqrt(X*ie*(Q-ie)/Q)*(H-Q/2<0?-1:1);yp(f,u,Math.max(m,Math.floor(u-H*ie/Q+de)),Math.min(C,Math.floor(u+(Q-H)*ie/Q+de)),D)}var h=f[u],c=m,d=C;for(Ph(f,m,u),D(f[C],h)>0&&Ph(f,m,C);c<d;){for(Ph(f,c,d),c++,d--;D(f[c],h)<0;)c++;for(;D(f[d],h)>0;)d--}D(f[m],h)===0?Ph(f,m,d):Ph(f,++d,C),d<=u&&(m=d+1),u<=d&&(C=d-1)}}function Ph(f,u,m){var C=f[u];f[u]=f[m],f[m]=C}function Px(f,u){return f<u?-1:f>u?1:0}function Lm(f,u){const m=f.length;if(m<=1)return[f];const C=[];let D,Q;for(let H=0;H<m;H++){const X=Ct(f[H]);X!==0&&(f[H].area=Math.abs(X),Q===void 0&&(Q=X<0),Q===X<0?(D&&C.push(D),D=[f[H]]):D.push(f[H]))}if(D&&C.push(D),u>1)for(let H=0;H<C.length;H++)C[H].length<=u||(Im(C[H],u,1,C[H].length-1,_p),C[H]=C[H].slice(0,u));return C}function _p(f,u){return u.area-f.area}function vp(f,u,m){const C=m.patternDependencies;let D=!1;for(const Q of u){const H=Q.paint.get(`${f}-pattern`);H.isConstant()||(D=!0);const X=H.constantOr(null);X&&(D=!0,C[X.to]=!0,C[X.from]=!0)}return D}function bp(f,u,m,C,D){const Q=D.patternDependencies;for(const H of u){const X=H.paint.get(`${f}-pattern`).value;if(X.kind!=="constant"){let ie=X.evaluate({zoom:C-1},m,{},D.availableImages),de=X.evaluate({zoom:C},m,{},D.availableImages),h=X.evaluate({zoom:C+1},m,{},D.availableImages);ie=ie&&ie.name?ie.name:ie,de=de&&de.name?de.name:de,h=h&&h.name?h.name:h,Q[ie]=!0,Q[de]=!0,Q[h]=!0,m.patterns[H.id]={min:ie,mid:de,max:h}}}return m}class Mm{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new K,this.indexArray=new Oe,this.indexArray2=new Re,this.programConfigurations=new an(u.layers,u.zoom),this.segments=new dt,this.segments2=new dt,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){this.hasPattern=vp("fill",this.layers,m);const D=this.layers[0].layout.get("fill-sort-key"),Q=!D.isConstant(),H=[];for(const{feature:X,id:ie,index:de,sourceLayerIndex:h}of u){const c=this.layers[0]._featureFilter.needGeometry,d=so(X,c);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),d,C))continue;const v=Q?D.evaluate(d,{},C,m.availableImages):void 0,S={id:ie,properties:X.properties,type:X.type,sourceLayerIndex:h,index:de,geometry:c?d.geometry:Ns(X),patterns:{},sortKey:v};H.push(S)}Q&&H.sort((X,ie)=>X.sortKey-ie.sortKey);for(const X of H){const{geometry:ie,index:de,sourceLayerIndex:h}=X;if(this.hasPattern){const c=bp("fill",this.layers,X,this.zoom,m);this.patternFeatures.push(c)}else this.addFeature(X,ie,de,C,{});m.featureIndex.insert(u[de].feature,ie,de,h,this.index)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}addFeatures(u,m,C){for(const D of this.patternFeatures)this.addFeature(D,D.geometry,D.index,m,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,dp),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.indexBuffer2=u.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(u,m,C,D,Q){for(const H of Lm(m,500)){let X=0;for(const v of H)X+=v.length;const ie=this.segments.prepareSegment(X,this.layoutVertexArray,this.indexArray),de=ie.vertexLength,h=[],c=[];for(const v of H){if(v.length===0)continue;v!==H[0]&&c.push(h.length/2);const S=this.segments2.prepareSegment(v.length,this.layoutVertexArray,this.indexArray2),P=S.vertexLength;this.layoutVertexArray.emplaceBack(v[0].x,v[0].y),this.indexArray2.emplaceBack(P+v.length-1,P),h.push(v[0].x),h.push(v[0].y);for(let k=1;k<v.length;k++)this.layoutVertexArray.emplaceBack(v[k].x,v[k].y),this.indexArray2.emplaceBack(P+k-1,P+k),h.push(v[k].x),h.push(v[k].y);S.vertexLength+=v.length,S.primitiveLength+=v.length}const d=e_(h,c);for(let v=0;v<d.length;v+=3)this.indexArray.emplaceBack(de+d[v],de+d[v+1],de+d[v+2]);ie.vertexLength+=X,ie.primitiveLength+=d.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,D)}}let Fx,t_;Rr("FillBucket",Mm,{omit:["layers","patternFeatures"]});var xp={get paint(){return t_=t_||new Us({"fill-antialias":new Sr(wt.paint_fill["fill-antialias"]),"fill-opacity":new oi(wt.paint_fill["fill-opacity"]),"fill-color":new oi(wt.paint_fill["fill-color"]),"fill-outline-color":new oi(wt.paint_fill["fill-outline-color"]),"fill-translate":new Sr(wt.paint_fill["fill-translate"]),"fill-translate-anchor":new Sr(wt.paint_fill["fill-translate-anchor"]),"fill-pattern":new bl(wt.paint_fill["fill-pattern"])})},get layout(){return Fx=Fx||new Us({"fill-sort-key":new oi(wt.layout_fill["fill-sort-key"])})}};class e5 extends Wn{constructor(u){super(u,xp)}recalculate(u,m){super.recalculate(u,m);const C=this.paint._values["fill-outline-color"];C.value.kind==="constant"&&C.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new Mm(u)}queryRadius(){return Gd(this.paint.get("fill-translate"))}queryIntersectsFeature(u,m,C,D,Q,H,X){return Dn($u(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),H.angle,X),D)}isTileClipped(){return!0}}const r_=Xn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),t5=Xn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:i_}=r_;var Wu={},n_=y,s_=td;function td(f,u,m,C,D){this.properties={},this.extent=m,this.type=0,this._pbf=f,this._geometry=-1,this._keys=C,this._values=D,f.readFields(r5,this,u)}function r5(f,u,m){f==1?u.id=m.readVarint():f==2?function(C,D){for(var Q=C.readVarint()+C.pos;C.pos<Q;){var H=D._keys[C.readVarint()],X=D._values[C.readVarint()];D.properties[H]=X}}(m,u):f==3?u.type=m.readVarint():f==4&&(u._geometry=m.pos)}function i5(f){for(var u,m,C=0,D=0,Q=f.length,H=Q-1;D<Q;H=D++)C+=((m=f[H]).x-(u=f[D]).x)*(u.y+m.y);return C}td.types=["Unknown","Point","LineString","Polygon"],td.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var u,m=f.readVarint()+f.pos,C=1,D=0,Q=0,H=0,X=[];f.pos<m;){if(D<=0){var ie=f.readVarint();C=7&ie,D=ie>>3}if(D--,C===1||C===2)Q+=f.readSVarint(),H+=f.readSVarint(),C===1&&(u&&X.push(u),u=[]),u.push(new n_(Q,H));else{if(C!==7)throw new Error("unknown command "+C);u&&u.push(u[0].clone())}}return u&&X.push(u),X},td.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var u=f.readVarint()+f.pos,m=1,C=0,D=0,Q=0,H=1/0,X=-1/0,ie=1/0,de=-1/0;f.pos<u;){if(C<=0){var h=f.readVarint();m=7&h,C=h>>3}if(C--,m===1||m===2)(D+=f.readSVarint())<H&&(H=D),D>X&&(X=D),(Q+=f.readSVarint())<ie&&(ie=Q),Q>de&&(de=Q);else if(m!==7)throw new Error("unknown command "+m)}return[H,ie,X,de]},td.prototype.toGeoJSON=function(f,u,m){var C,D,Q=this.extent*Math.pow(2,m),H=this.extent*f,X=this.extent*u,ie=this.loadGeometry(),de=td.types[this.type];function h(v){for(var S=0;S<v.length;S++){var P=v[S];v[S]=[360*(P.x+H)/Q-180,360/Math.PI*Math.atan(Math.exp((180-360*(P.y+X)/Q)*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(C=0;C<ie.length;C++)c[C]=ie[C][0];h(ie=c);break;case 2:for(C=0;C<ie.length;C++)h(ie[C]);break;case 3:for(ie=function(v){var S=v.length;if(S<=1)return[v];for(var P,k,G=[],W=0;W<S;W++){var ee=i5(v[W]);ee!==0&&(k===void 0&&(k=ee<0),k===ee<0?(P&&G.push(P),P=[v[W]]):P.push(v[W]))}return P&&G.push(P),G}(ie),C=0;C<ie.length;C++)for(D=0;D<ie[C].length;D++)h(ie[C][D])}ie.length===1?ie=ie[0]:de="Multi"+de;var d={type:"Feature",geometry:{type:de,coordinates:ie},properties:this.properties};return"id"in this&&(d.id=this.id),d};var n5=s_,Dx=Rx;function Rx(f,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=f,this._keys=[],this._values=[],this._features=[],f.readFields(yA,this,u),this.length=this._features.length}function yA(f,u,m){f===15?u.version=m.readVarint():f===1?u.name=m.readString():f===5?u.extent=m.readVarint():f===2?u._features.push(m.pos):f===3?u._keys.push(m.readString()):f===4&&u._values.push(function(C){for(var D=null,Q=C.readVarint()+C.pos;C.pos<Q;){var H=C.readVarint()>>3;D=H===1?C.readString():H===2?C.readFloat():H===3?C.readDouble():H===4?C.readVarint64():H===5?C.readVarint():H===6?C.readSVarint():H===7?C.readBoolean():null}return D}(m))}Rx.prototype.feature=function(f){if(f<0||f>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[f];var u=this._pbf.readVarint()+this._pbf.pos;return new n5(this._pbf,u,this.extent,this._keys,this._values)};var s5=Dx;function kx(f,u,m){if(f===3){var C=new s5(m,m.readVarint()+m.pos);C.length&&(u[C.name]=C)}}Wu.VectorTile=function(f,u){this.layers=f.readFields(kx,{},u)},Wu.VectorTileFeature=s_,Wu.VectorTileLayer=Dx;const Yd=Wu.VectorTileFeature.types,o_=Math.pow(2,13);function wp(f,u,m,C,D,Q,H,X){f.emplaceBack(u,m,2*Math.floor(C*o_)+H,D*o_*2,Q*o_*2,Math.round(X))}class a_{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new te,this.centroidVertexArray=new V,this.indexArray=new Oe,this.programConfigurations=new an(u.layers,u.zoom),this.segments=new dt,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){this.features=[],this.hasPattern=vp("fill-extrusion",this.layers,m);for(const{feature:D,id:Q,index:H,sourceLayerIndex:X}of u){const ie=this.layers[0]._featureFilter.needGeometry,de=so(D,ie);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),de,C))continue;const h={id:Q,sourceLayerIndex:X,index:H,geometry:ie?de.geometry:Ns(D),properties:D.properties,type:D.type,patterns:{}};this.hasPattern?this.features.push(bp("fill-extrusion",this.layers,h,this.zoom,m)):this.addFeature(h,h.geometry,H,C,{}),m.featureIndex.insert(D,h.geometry,H,X,this.index,!0)}}addFeatures(u,m,C){for(const D of this.features){const{geometry:Q}=D;this.addFeature(D,Q,D.index,m,C)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,i_),this.centroidVertexBuffer=u.createVertexBuffer(this.centroidVertexArray,t5.members,!0),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(u,m,C,D,Q){const H={x:0,y:0,vertexCount:0};for(const X of Lm(m,500)){let ie=0;for(const S of X)ie+=S.length;let de=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const S of X){if(S.length===0||Ux(S))continue;let P=0;for(let k=0;k<S.length;k++){const G=S[k];if(k>=1){const W=S[k-1];if(!Ox(G,W)){de.vertexLength+4>dt.MAX_VERTEX_ARRAY_LENGTH&&(de=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ee=G.sub(W)._perp()._unit(),ae=W.dist(G);P+ae>32768&&(P=0),wp(this.layoutVertexArray,G.x,G.y,ee.x,ee.y,0,0,P),wp(this.layoutVertexArray,G.x,G.y,ee.x,ee.y,0,1,P),H.x+=2*G.x,H.y+=2*G.y,H.vertexCount+=2,P+=ae,wp(this.layoutVertexArray,W.x,W.y,ee.x,ee.y,0,0,P),wp(this.layoutVertexArray,W.x,W.y,ee.x,ee.y,0,1,P),H.x+=2*W.x,H.y+=2*W.y,H.vertexCount+=2;const fe=de.vertexLength;this.indexArray.emplaceBack(fe,fe+2,fe+1),this.indexArray.emplaceBack(fe+1,fe+2,fe+3),de.vertexLength+=4,de.primitiveLength+=2}}}}if(de.vertexLength+ie>dt.MAX_VERTEX_ARRAY_LENGTH&&(de=this.segments.prepareSegment(ie,this.layoutVertexArray,this.indexArray)),Yd[u.type]!=="Polygon")continue;const h=[],c=[],d=de.vertexLength;for(const S of X)if(S.length!==0){S!==X[0]&&c.push(h.length/2);for(let P=0;P<S.length;P++){const k=S[P];wp(this.layoutVertexArray,k.x,k.y,0,0,1,1,0),H.x+=k.x,H.y+=k.y,H.vertexCount+=1,h.push(k.x),h.push(k.y)}}const v=e_(h,c);for(let S=0;S<v.length;S+=3)this.indexArray.emplaceBack(d+v[S],d+v[S+2],d+v[S+1]);de.primitiveLength+=v.length/3,de.vertexLength+=ie}for(let X=0;X<H.vertexCount;X++)this.centroidVertexArray.emplaceBack(Math.floor(H.x/H.vertexCount),Math.floor(H.y/H.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,D)}}function Ox(f,u){return f.x===u.x&&(f.x<0||f.x>yi)||f.y===u.y&&(f.y<0||f.y>yi)}function Ux(f){return f.every(u=>u.x<0)||f.every(u=>u.x>yi)||f.every(u=>u.y<0)||f.every(u=>u.y>yi)}let Nx;Rr("FillExtrusionBucket",a_,{omit:["layers","features"]});var o5={get paint(){return Nx=Nx||new Us({"fill-extrusion-opacity":new Sr(wt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new oi(wt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Sr(wt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Sr(wt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new bl(wt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new oi(wt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new oi(wt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Sr(wt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class a5 extends Wn{constructor(u){super(u,o5)}createBucket(u){return new a_(u)}queryRadius(){return Gd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(u,m,C,D,Q,H,X,ie){const de=$u(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),H.angle,X),h=this.paint.get("fill-extrusion-height").evaluate(m,C),c=this.paint.get("fill-extrusion-base").evaluate(m,C),d=function(S,P,k,G){const W=[];for(const ee of S){const ae=[ee.x,ee.y,0,1];Ih(ae,ae,P),W.push(new I(ae[0]/ae[3],ae[1]/ae[3]))}return W}(de,ie),v=function(S,P,k,G){const W=[],ee=[],ae=G[8]*P,fe=G[9]*P,me=G[10]*P,Ce=G[11]*P,Me=G[8]*k,Ue=G[9]*k,$e=G[10]*k,Ke=G[11]*k;for(const ut of S){const tt=[],it=[];for(const yt of ut){const St=yt.x,Jt=yt.y,Br=G[0]*St+G[4]*Jt+G[12],ar=G[1]*St+G[5]*Jt+G[13],pr=G[2]*St+G[6]*Jt+G[14],_r=G[3]*St+G[7]*Jt+G[15],kr=pr+me,lr=_r+Ce,Yt=Br+Me,jr=ar+Ue,Vr=pr+$e,_i=_r+Ke,Vi=new I((Br+ae)/lr,(ar+fe)/lr);Vi.z=kr/lr,tt.push(Vi);const $i=new I(Yt/_i,jr/_i);$i.z=Vr/_i,it.push($i)}W.push(tt),ee.push(it)}return[W,ee]}(D,c,h,ie);return function(S,P,k){let G=1/0;Dn(k,P)&&(G=Pm(k,P[0]));for(let W=0;W<P.length;W++){const ee=P[W],ae=S[W];for(let fe=0;fe<ee.length-1;fe++){const me=ee[fe],Ce=[me,ee[fe+1],ae[fe+1],ae[fe],me];ac(k,Ce)&&(G=Math.min(G,Pm(k,Ce)))}}return G!==1/0&&G}(v[0],v[1],d)}}function Bp(f,u){return f.x*u.x+f.y*u.y}function Pm(f,u){if(f.length===1){let m=0;const C=u[m++];let D;for(;!D||C.equals(D);)if(D=u[m++],!D)return 1/0;for(;m<u.length;m++){const Q=u[m],H=f[0],X=D.sub(C),ie=Q.sub(C),de=H.sub(C),h=Bp(X,X),c=Bp(X,ie),d=Bp(ie,ie),v=Bp(de,X),S=Bp(de,ie),P=h*d-c*c,k=(d*v-c*S)/P,G=(h*S-c*v)/P,W=C.z*(1-k-G)+D.z*k+Q.z*G;if(isFinite(W))return W}return 1/0}{let m=1/0;for(const C of u)m=Math.min(m,C.z);return m}}const Cp=Xn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:l_}=Cp,l5=Xn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:c5}=l5,zx=Wu.VectorTileFeature.types,u5=Math.cos(Math.PI/180*37.5),Qx=Math.pow(2,14)/.5;class rd{constructor(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(m=>m.id),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(m=>{this.gradients[m.id]={}}),this.layoutVertexArray=new se,this.layoutVertexArray2=new oe,this.indexArray=new Oe,this.programConfigurations=new an(u.layers,u.zoom),this.segments=new dt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(u,m,C){this.hasPattern=vp("line",this.layers,m);const D=this.layers[0].layout.get("line-sort-key"),Q=!D.isConstant(),H=[];for(const{feature:X,id:ie,index:de,sourceLayerIndex:h}of u){const c=this.layers[0]._featureFilter.needGeometry,d=so(X,c);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),d,C))continue;const v=Q?D.evaluate(d,{},C):void 0,S={id:ie,properties:X.properties,type:X.type,sourceLayerIndex:h,index:de,geometry:c?d.geometry:Ns(X),patterns:{},sortKey:v};H.push(S)}Q&&H.sort((X,ie)=>X.sortKey-ie.sortKey);for(const X of H){const{geometry:ie,index:de,sourceLayerIndex:h}=X;if(this.hasPattern){const c=bp("line",this.layers,X,this.zoom,m);this.patternFeatures.push(c)}else this.addFeature(X,ie,de,C,{});m.featureIndex.insert(u[de].feature,ie,de,h,this.index)}}update(u,m,C){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(u,m,this.stateDependentLayers,C)}addFeatures(u,m,C){for(const D of this.patternFeatures)this.addFeature(D,D.geometry,D.index,m,C)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(u){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=u.createVertexBuffer(this.layoutVertexArray2,c5)),this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,l_),this.indexBuffer=u.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(u),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(u){if(u.properties&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(u.properties,"mapbox_clip_end"))return{start:+u.properties.mapbox_clip_start,end:+u.properties.mapbox_clip_end}}addFeature(u,m,C,D,Q){const H=this.layers[0].layout,X=H.get("line-join").evaluate(u,{}),ie=H.get("line-cap"),de=H.get("line-miter-limit"),h=H.get("line-round-limit");this.lineClips=this.lineFeatureClips(u);for(const c of m)this.addLine(c,u,X,ie,de,h);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,u,C,Q,D)}addLine(u,m,C,D,Q,H){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<u.length-1;G++)this.totalDistance+=u[G].dist(u[G+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const X=zx[m.type]==="Polygon";let ie=u.length;for(;ie>=2&&u[ie-1].equals(u[ie-2]);)ie--;let de=0;for(;de<ie-1&&u[de].equals(u[de+1]);)de++;if(ie<(X?3:2))return;C==="bevel"&&(Q=1.05);const h=this.overscaling<=16?15*yi/(512*this.overscaling):0,c=this.segments.prepareSegment(10*ie,this.layoutVertexArray,this.indexArray);let d,v,S,P,k;this.e1=this.e2=-1,X&&(d=u[ie-2],k=u[de].sub(d)._unit()._perp());for(let G=de;G<ie;G++){if(S=G===ie-1?X?u[de+1]:void 0:u[G+1],S&&u[G].equals(S))continue;k&&(P=k),d&&(v=d),d=u[G],k=S?S.sub(d)._unit()._perp():P,P=P||k;let W=P.add(k);W.x===0&&W.y===0||W._unit();const ee=P.x*k.x+P.y*k.y,ae=W.x*k.x+W.y*k.y,fe=ae!==0?1/ae:1/0,me=2*Math.sqrt(2-2*ae),Ce=ae<u5&&v&&S,Me=P.x*k.y-P.y*k.x>0;if(Ce&&G>de){const Ke=d.dist(v);if(Ke>2*h){const ut=d.sub(d.sub(v)._mult(h/Ke)._round());this.updateDistance(v,ut),this.addCurrentVertex(ut,P,0,0,c),v=ut}}const Ue=v&&S;let $e=Ue?C:X?"butt":D;if(Ue&&$e==="round"&&(fe<H?$e="miter":fe<=2&&($e="fakeround")),$e==="miter"&&fe>Q&&($e="bevel"),$e==="bevel"&&(fe>2&&($e="flipbevel"),fe<Q&&($e="miter")),v&&this.updateDistance(v,d),$e==="miter")W._mult(fe),this.addCurrentVertex(d,W,0,0,c);else if($e==="flipbevel"){if(fe>100)W=k.mult(-1);else{const Ke=fe*P.add(k).mag()/P.sub(k).mag();W._perp()._mult(Ke*(Me?-1:1))}this.addCurrentVertex(d,W,0,0,c),this.addCurrentVertex(d,W.mult(-1),0,0,c)}else if($e==="bevel"||$e==="fakeround"){const Ke=-Math.sqrt(fe*fe-1),ut=Me?Ke:0,tt=Me?0:Ke;if(v&&this.addCurrentVertex(d,P,ut,tt,c),$e==="fakeround"){const it=Math.round(180*me/Math.PI/20);for(let yt=1;yt<it;yt++){let St=yt/it;if(St!==.5){const Br=St-.5;St+=St*Br*(St-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*Br*Br+(.848013+ee*(.215638*ee-1.06021)))}const Jt=k.sub(P)._mult(St)._add(P)._unit()._mult(Me?-1:1);this.addHalfVertex(d,Jt.x,Jt.y,!1,Me,0,c)}}S&&this.addCurrentVertex(d,k,-ut,-tt,c)}else if($e==="butt")this.addCurrentVertex(d,W,0,0,c);else if($e==="square"){const Ke=v?1:-1;this.addCurrentVertex(d,W,Ke,Ke,c)}else $e==="round"&&(v&&(this.addCurrentVertex(d,P,0,0,c),this.addCurrentVertex(d,P,1,1,c,!0)),S&&(this.addCurrentVertex(d,k,-1,-1,c,!0),this.addCurrentVertex(d,k,0,0,c)));if(Ce&&G<ie-1){const Ke=d.dist(S);if(Ke>2*h){const ut=d.add(S.sub(d)._mult(h/Ke)._round());this.updateDistance(d,ut),this.addCurrentVertex(ut,k,0,0,c),d=ut}}}}addCurrentVertex(u,m,C,D,Q){let H=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const X=m.y*D-m.x,ie=-m.y-m.x*D;this.addHalfVertex(u,m.x+m.y*C,m.y-m.x*C,H,!1,C,Q),this.addHalfVertex(u,X,ie,H,!0,-D,Q),this.distance>Qx/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(u,m,C,D,Q,H))}addHalfVertex(u,m,C,D,Q,H,X){let{x:ie,y:de}=u;const h=.5*(this.lineClips?this.scaledDistance*(Qx-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((ie<<1)+(D?1:0),(de<<1)+(Q?1:0),Math.round(63*m)+128,Math.round(63*C)+128,1+(H===0?0:H<0?-1:1)|(63&h)<<2,h>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=X.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),X.primitiveLength++),Q?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(u,m){this.distance+=u.dist(m),this.updateScaledDistance()}}let c_,Vx;Rr("LineBucket",rd,{omit:["layers","patternFeatures"]});var Hx={get paint(){return Vx=Vx||new Us({"line-opacity":new oi(wt.paint_line["line-opacity"]),"line-color":new oi(wt.paint_line["line-color"]),"line-translate":new Sr(wt.paint_line["line-translate"]),"line-translate-anchor":new Sr(wt.paint_line["line-translate-anchor"]),"line-width":new oi(wt.paint_line["line-width"]),"line-gap-width":new oi(wt.paint_line["line-gap-width"]),"line-offset":new oi(wt.paint_line["line-offset"]),"line-blur":new oi(wt.paint_line["line-blur"]),"line-dasharray":new Kc(wt.paint_line["line-dasharray"]),"line-pattern":new bl(wt.paint_line["line-pattern"]),"line-gradient":new rc(wt.paint_line["line-gradient"])})},get layout(){return c_=c_||new Us({"line-cap":new Sr(wt.layout_line["line-cap"]),"line-join":new oi(wt.layout_line["line-join"]),"line-miter-limit":new Sr(wt.layout_line["line-miter-limit"]),"line-round-limit":new Sr(wt.layout_line["line-round-limit"]),"line-sort-key":new oi(wt.layout_line["line-sort-key"])})}};class h5 extends oi{possiblyEvaluate(u,m){return m=new vn(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),super.possiblyEvaluate(u,m)}evaluate(u,m,C,D){return m=We({},m,{zoom:Math.floor(m.zoom)}),super.evaluate(u,m,C,D)}}let Fm;class A5 extends Wn{constructor(u){super(u,Hx),this.gradientVersion=0,Fm||(Fm=new h5(Hx.paint.properties["line-width"].specification),Fm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const m=this.gradientExpression();this.stepInterpolant=!!function(C){return C._styleExpression!==void 0}(m)&&m._styleExpression.expression instanceof Aa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(u,m){super.recalculate(u,m),this.paint._values["line-floorwidth"]=Fm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new rd(u)}queryRadius(u){const m=u,C=Gx(AA("line-width",this,m),AA("line-gap-width",this,m)),D=AA("line-offset",this,m);return C/2+Math.abs(D)+Gd(this.paint.get("line-translate"))}queryIntersectsFeature(u,m,C,D,Q,H,X){const ie=$u(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),H.angle,X),de=X/2*Gx(this.paint.get("line-width").evaluate(m,C),this.paint.get("line-gap-width").evaluate(m,C)),h=this.paint.get("line-offset").evaluate(m,C);return h&&(D=function(c,d){const v=[];for(let S=0;S<c.length;S++){const P=c[S],k=[];for(let G=0;G<P.length;G++){const W=P[G-1],ee=P[G],ae=P[G+1],fe=G===0?new I(0,0):ee.sub(W)._unit()._perp(),me=G===P.length-1?new I(0,0):ae.sub(ee)._unit()._perp(),Ce=fe._add(me)._unit(),Me=Ce.x*me.x+Ce.y*me.y;Me!==0&&Ce._mult(1/Me),k.push(Ce._mult(d)._add(ee))}v.push(k)}return v}(D,h*X)),function(c,d,v){for(let S=0;S<d.length;S++){const P=d[S];if(c.length>=3){for(let k=0;k<P.length;k++)if(Zc(c,P[k]))return!0}if(Ec(c,P,v))return!0}return!1}(ie,D,de)}isTileClipped(){return!0}}function Gx(f,u){return u>0?u+2*f:f}const jx=Xn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),u_=Xn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Xn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const qx=Xn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Xn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const h_=Xn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$x=Xn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function d5(f,u,m){return f.sections.forEach(C=>{C.text=function(D,Q,H){const X=Q.layout.get("text-transform").evaluate(H,{});return X==="uppercase"?D=D.toLocaleUpperCase():X==="lowercase"&&(D=D.toLocaleLowerCase()),ol.applyArabicShaping&&(D=ol.applyArabicShaping(D)),D}(C.text,u,m)}),f}Xn([{name:"triangle",components:3,type:"Uint16"}]),Xn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Xn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Xn([{type:"Float32",name:"offsetX"}]),Xn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Xn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const _A={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var xo=24,A_=Jn,Kx=function(f,u,m,C,D){var Q,H,X=8*D-C-1,ie=(1<<X)-1,de=ie>>1,h=-7,c=m?D-1:0,d=m?-1:1,v=f[u+c];for(c+=d,Q=v&(1<<-h)-1,v>>=-h,h+=X;h>0;Q=256*Q+f[u+c],c+=d,h-=8);for(H=Q&(1<<-h)-1,Q>>=-h,h+=C;h>0;H=256*H+f[u+c],c+=d,h-=8);if(Q===0)Q=1-de;else{if(Q===ie)return H?NaN:1/0*(v?-1:1);H+=Math.pow(2,C),Q-=de}return(v?-1:1)*H*Math.pow(2,Q-C)},Wx=function(f,u,m,C,D,Q){var H,X,ie,de=8*Q-D-1,h=(1<<de)-1,c=h>>1,d=D===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=C?0:Q-1,S=C?1:-1,P=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(X=isNaN(u)?1:0,H=h):(H=Math.floor(Math.log(u)/Math.LN2),u*(ie=Math.pow(2,-H))<1&&(H--,ie*=2),(u+=H+c>=1?d/ie:d*Math.pow(2,1-c))*ie>=2&&(H++,ie/=2),H+c>=h?(X=0,H=h):H+c>=1?(X=(u*ie-1)*Math.pow(2,D),H+=c):(X=u*Math.pow(2,c-1)*Math.pow(2,D),H=0));D>=8;f[m+v]=255&X,v+=S,X/=256,D-=8);for(H=H<<D|X,de+=D;de>0;f[m+v]=255&H,v+=S,H/=256,de-=8);f[m+v-S]|=128*P};function Jn(f){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(f)?f:new Uint8Array(f||0),this.pos=0,this.type=0,this.length=this.buf.length}Jn.Varint=0,Jn.Fixed64=1,Jn.Bytes=2,Jn.Fixed32=5;var Dm=4294967296,Xx=1/Dm,Zx=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Tc(f){return f.type===Jn.Bytes?f.readVarint()+f.pos:f.pos+1}function Ss(f,u,m){return m?4294967296*u+(f>>>0):4294967296*(u>>>0)+(f>>>0)}function d_(f,u,m){var C=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));m.realloc(C);for(var D=m.pos-1;D>=f;D--)m.buf[D+C]=m.buf[D]}function Jx(f,u){for(var m=0;m<f.length;m++)u.writeVarint(f[m])}function Yx(f,u){for(var m=0;m<f.length;m++)u.writeSVarint(f[m])}function Yn(f,u){for(var m=0;m<f.length;m++)u.writeFloat(f[m])}function f_(f,u){for(var m=0;m<f.length;m++)u.writeDouble(f[m])}function ew(f,u){for(var m=0;m<f.length;m++)u.writeBoolean(f[m])}function tw(f,u){for(var m=0;m<f.length;m++)u.writeFixed32(f[m])}function Fh(f,u){for(var m=0;m<f.length;m++)u.writeSFixed32(f[m])}function ef(f,u){for(var m=0;m<f.length;m++)u.writeFixed64(f[m])}function rw(f,u){for(var m=0;m<f.length;m++)u.writeSFixed64(f[m])}function Rm(f,u){return(f[u]|f[u+1]<<8|f[u+2]<<16)+16777216*f[u+3]}function tf(f,u,m){f[m]=u,f[m+1]=u>>>8,f[m+2]=u>>>16,f[m+3]=u>>>24}function iw(f,u){return(f[u]|f[u+1]<<8|f[u+2]<<16)+(f[u+3]<<24)}Jn.prototype={destroy:function(){this.buf=null},readFields:function(f,u,m){for(m=m||this.length;this.pos<m;){var C=this.readVarint(),D=C>>3,Q=this.pos;this.type=7&C,f(D,u,this),this.pos===Q&&this.skip(C)}return u},readMessage:function(f,u){return this.readFields(f,u,this.readVarint()+this.pos)},readFixed32:function(){var f=Rm(this.buf,this.pos);return this.pos+=4,f},readSFixed32:function(){var f=iw(this.buf,this.pos);return this.pos+=4,f},readFixed64:function(){var f=Rm(this.buf,this.pos)+Rm(this.buf,this.pos+4)*Dm;return this.pos+=8,f},readSFixed64:function(){var f=Rm(this.buf,this.pos)+iw(this.buf,this.pos+4)*Dm;return this.pos+=8,f},readFloat:function(){var f=Kx(this.buf,this.pos,!0,23,4);return this.pos+=4,f},readDouble:function(){var f=Kx(this.buf,this.pos,!0,52,8);return this.pos+=8,f},readVarint:function(f){var u,m,C=this.buf;return u=127&(m=C[this.pos++]),m<128?u:(u|=(127&(m=C[this.pos++]))<<7,m<128?u:(u|=(127&(m=C[this.pos++]))<<14,m<128?u:(u|=(127&(m=C[this.pos++]))<<21,m<128?u:function(D,Q,H){var X,ie,de=H.buf;if(X=(112&(ie=de[H.pos++]))>>4,ie<128||(X|=(127&(ie=de[H.pos++]))<<3,ie<128)||(X|=(127&(ie=de[H.pos++]))<<10,ie<128)||(X|=(127&(ie=de[H.pos++]))<<17,ie<128)||(X|=(127&(ie=de[H.pos++]))<<24,ie<128)||(X|=(1&(ie=de[H.pos++]))<<31,ie<128))return Ss(D,X,Q);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(m=C[this.pos]))<<28,f,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var f=this.readVarint();return f%2==1?(f+1)/-2:f/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var f=this.readVarint()+this.pos,u=this.pos;return this.pos=f,f-u>=12&&Zx?function(m,C,D){return Zx.decode(m.subarray(C,D))}(this.buf,u,f):function(m,C,D){for(var Q="",H=C;H<D;){var X,ie,de,h=m[H],c=null,d=h>239?4:h>223?3:h>191?2:1;if(H+d>D)break;d===1?h<128&&(c=h):d===2?(192&(X=m[H+1]))==128&&(c=(31&h)<<6|63&X)<=127&&(c=null):d===3?(ie=m[H+2],(192&(X=m[H+1]))==128&&(192&ie)==128&&((c=(15&h)<<12|(63&X)<<6|63&ie)<=2047||c>=55296&&c<=57343)&&(c=null)):d===4&&(ie=m[H+2],de=m[H+3],(192&(X=m[H+1]))==128&&(192&ie)==128&&(192&de)==128&&((c=(15&h)<<18|(63&X)<<12|(63&ie)<<6|63&de)<=65535||c>=1114112)&&(c=null)),c===null?(c=65533,d=1):c>65535&&(c-=65536,Q+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),Q+=String.fromCharCode(c),H+=d}return Q}(this.buf,u,f)},readBytes:function(){var f=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,f);return this.pos=f,u},readPackedVarint:function(f,u){if(this.type!==Jn.Bytes)return f.push(this.readVarint(u));var m=Tc(this);for(f=f||[];this.pos<m;)f.push(this.readVarint(u));return f},readPackedSVarint:function(f){if(this.type!==Jn.Bytes)return f.push(this.readSVarint());var u=Tc(this);for(f=f||[];this.pos<u;)f.push(this.readSVarint());return f},readPackedBoolean:function(f){if(this.type!==Jn.Bytes)return f.push(this.readBoolean());var u=Tc(this);for(f=f||[];this.pos<u;)f.push(this.readBoolean());return f},readPackedFloat:function(f){if(this.type!==Jn.Bytes)return f.push(this.readFloat());var u=Tc(this);for(f=f||[];this.pos<u;)f.push(this.readFloat());return f},readPackedDouble:function(f){if(this.type!==Jn.Bytes)return f.push(this.readDouble());var u=Tc(this);for(f=f||[];this.pos<u;)f.push(this.readDouble());return f},readPackedFixed32:function(f){if(this.type!==Jn.Bytes)return f.push(this.readFixed32());var u=Tc(this);for(f=f||[];this.pos<u;)f.push(this.readFixed32());return f},readPackedSFixed32:function(f){if(this.type!==Jn.Bytes)return f.push(this.readSFixed32());var u=Tc(this);for(f=f||[];this.pos<u;)f.push(this.readSFixed32());return f},readPackedFixed64:function(f){if(this.type!==Jn.Bytes)return f.push(this.readFixed64());var u=Tc(this);for(f=f||[];this.pos<u;)f.push(this.readFixed64());return f},readPackedSFixed64:function(f){if(this.type!==Jn.Bytes)return f.push(this.readSFixed64());var u=Tc(this);for(f=f||[];this.pos<u;)f.push(this.readSFixed64());return f},skip:function(f){var u=7&f;if(u===Jn.Varint)for(;this.buf[this.pos++]>127;);else if(u===Jn.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Jn.Fixed32)this.pos+=4;else{if(u!==Jn.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(f,u){this.writeVarint(f<<3|u)},realloc:function(f){for(var u=this.length||16;u<this.pos+f;)u*=2;if(u!==this.length){var m=new Uint8Array(u);m.set(this.buf),this.buf=m,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(f){this.realloc(4),tf(this.buf,f,this.pos),this.pos+=4},writeSFixed32:function(f){this.realloc(4),tf(this.buf,f,this.pos),this.pos+=4},writeFixed64:function(f){this.realloc(8),tf(this.buf,-1&f,this.pos),tf(this.buf,Math.floor(f*Xx),this.pos+4),this.pos+=8},writeSFixed64:function(f){this.realloc(8),tf(this.buf,-1&f,this.pos),tf(this.buf,Math.floor(f*Xx),this.pos+4),this.pos+=8},writeVarint:function(f){(f=+f||0)>268435455||f<0?function(u,m){var C,D;if(u>=0?(C=u%4294967296|0,D=u/4294967296|0):(D=~(-u/4294967296),4294967295^(C=~(-u%4294967296))?C=C+1|0:(C=0,D=D+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");m.realloc(10),function(Q,H,X){X.buf[X.pos++]=127&Q|128,Q>>>=7,X.buf[X.pos++]=127&Q|128,Q>>>=7,X.buf[X.pos++]=127&Q|128,Q>>>=7,X.buf[X.pos++]=127&Q|128,X.buf[X.pos]=127&(Q>>>=7)}(C,0,m),function(Q,H){var X=(7&Q)<<4;H.buf[H.pos++]|=X|((Q>>>=3)?128:0),Q&&(H.buf[H.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(H.buf[H.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(H.buf[H.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(H.buf[H.pos++]=127&Q|((Q>>>=7)?128:0),Q&&(H.buf[H.pos++]=127&Q)))))}(D,m)}(f,this):(this.realloc(4),this.buf[this.pos++]=127&f|(f>127?128:0),f<=127||(this.buf[this.pos++]=127&(f>>>=7)|(f>127?128:0),f<=127||(this.buf[this.pos++]=127&(f>>>=7)|(f>127?128:0),f<=127||(this.buf[this.pos++]=f>>>7&127))))},writeSVarint:function(f){this.writeVarint(f<0?2*-f-1:2*f)},writeBoolean:function(f){this.writeVarint(!!f)},writeString:function(f){f=String(f),this.realloc(4*f.length),this.pos++;var u=this.pos;this.pos=function(C,D,Q){for(var H,X,ie=0;ie<D.length;ie++){if((H=D.charCodeAt(ie))>55295&&H<57344){if(!X){H>56319||ie+1===D.length?(C[Q++]=239,C[Q++]=191,C[Q++]=189):X=H;continue}if(H<56320){C[Q++]=239,C[Q++]=191,C[Q++]=189,X=H;continue}H=X-55296<<10|H-56320|65536,X=null}else X&&(C[Q++]=239,C[Q++]=191,C[Q++]=189,X=null);H<128?C[Q++]=H:(H<2048?C[Q++]=H>>6|192:(H<65536?C[Q++]=H>>12|224:(C[Q++]=H>>18|240,C[Q++]=H>>12&63|128),C[Q++]=H>>6&63|128),C[Q++]=63&H|128)}return Q}(this.buf,f,this.pos);var m=this.pos-u;m>=128&&d_(u,m,this),this.pos=u-1,this.writeVarint(m),this.pos+=m},writeFloat:function(f){this.realloc(4),Wx(this.buf,f,this.pos,!0,23,4),this.pos+=4},writeDouble:function(f){this.realloc(8),Wx(this.buf,f,this.pos,!0,52,8),this.pos+=8},writeBytes:function(f){var u=f.length;this.writeVarint(u),this.realloc(u);for(var m=0;m<u;m++)this.buf[this.pos++]=f[m]},writeRawMessage:function(f,u){this.pos++;var m=this.pos;f(u,this);var C=this.pos-m;C>=128&&d_(m,C,this),this.pos=m-1,this.writeVarint(C),this.pos+=C},writeMessage:function(f,u,m){this.writeTag(f,Jn.Bytes),this.writeRawMessage(u,m)},writePackedVarint:function(f,u){u.length&&this.writeMessage(f,Jx,u)},writePackedSVarint:function(f,u){u.length&&this.writeMessage(f,Yx,u)},writePackedBoolean:function(f,u){u.length&&this.writeMessage(f,ew,u)},writePackedFloat:function(f,u){u.length&&this.writeMessage(f,Yn,u)},writePackedDouble:function(f,u){u.length&&this.writeMessage(f,f_,u)},writePackedFixed32:function(f,u){u.length&&this.writeMessage(f,tw,u)},writePackedSFixed32:function(f,u){u.length&&this.writeMessage(f,Fh,u)},writePackedFixed64:function(f,u){u.length&&this.writeMessage(f,ef,u)},writePackedSFixed64:function(f,u){u.length&&this.writeMessage(f,rw,u)},writeBytesField:function(f,u){this.writeTag(f,Jn.Bytes),this.writeBytes(u)},writeFixed32Field:function(f,u){this.writeTag(f,Jn.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(f,u){this.writeTag(f,Jn.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(f,u){this.writeTag(f,Jn.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(f,u){this.writeTag(f,Jn.Fixed64),this.writeSFixed64(u)},writeVarintField:function(f,u){this.writeTag(f,Jn.Varint),this.writeVarint(u)},writeSVarintField:function(f,u){this.writeTag(f,Jn.Varint),this.writeSVarint(u)},writeStringField:function(f,u){this.writeTag(f,Jn.Bytes),this.writeString(u)},writeFloatField:function(f,u){this.writeTag(f,Jn.Fixed32),this.writeFloat(u)},writeDoubleField:function(f,u){this.writeTag(f,Jn.Fixed64),this.writeDouble(u)},writeBooleanField:function(f,u){this.writeVarintField(f,!!u)}};var p_=g(A_);const g_=3;function f5(f,u,m){f===1&&m.readMessage(p5,u)}function p5(f,u,m){if(f===3){const{id:C,bitmap:D,width:Q,height:H,left:X,top:ie,advance:de}=m.readMessage(g5,{});u.push({id:C,bitmap:new wu({width:Q+2*g_,height:H+2*g_},D),metrics:{width:Q,height:H,left:X,top:ie,advance:de}})}}function g5(f,u,m){f===1?u.id=m.readVarint():f===2?u.bitmap=m.readBytes():f===3?u.width=m.readVarint():f===4?u.height=m.readVarint():f===5?u.left=m.readSVarint():f===6?u.top=m.readSVarint():f===7&&(u.advance=m.readVarint())}const nw=g_;function Ep(f){let u=0,m=0;for(const H of f)u+=H.w*H.h,m=Math.max(m,H.w);f.sort((H,X)=>X.h-H.h);const C=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),m),h:1/0}];let D=0,Q=0;for(const H of f)for(let X=C.length-1;X>=0;X--){const ie=C[X];if(!(H.w>ie.w||H.h>ie.h)){if(H.x=ie.x,H.y=ie.y,Q=Math.max(Q,H.y+H.h),D=Math.max(D,H.x+H.w),H.w===ie.w&&H.h===ie.h){const de=C.pop();X<C.length&&(C[X]=de)}else H.h===ie.h?(ie.x+=H.w,ie.w-=H.w):H.w===ie.w?(ie.y+=H.h,ie.h-=H.h):(C.push({x:ie.x+H.w,y:ie.y,w:ie.w-H.w,h:H.h}),ie.y+=H.h,ie.h-=H.h);break}}return{w:D,h:Q,fill:u/(D*Q)||0}}const Qo=1;class km{constructor(u,m){let{pixelRatio:C,version:D,stretchX:Q,stretchY:H,content:X}=m;this.paddedRect=u,this.pixelRatio=C,this.stretchX=Q,this.stretchY=H,this.content=X,this.version=D}get tl(){return[this.paddedRect.x+Qo,this.paddedRect.y+Qo]}get br(){return[this.paddedRect.x+this.paddedRect.w-Qo,this.paddedRect.y+this.paddedRect.h-Qo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Qo)/this.pixelRatio,(this.paddedRect.h-2*Qo)/this.pixelRatio]}}class Om{constructor(u,m){const C={},D={};this.haveRenderCallbacks=[];const Q=[];this.addImages(u,C,Q),this.addImages(m,D,Q);const{w:H,h:X}=Ep(Q),ie=new Cl({width:H||1,height:X||1});for(const de in u){const h=u[de],c=C[de].paddedRect;Cl.copy(h.data,ie,{x:0,y:0},{x:c.x+Qo,y:c.y+Qo},h.data)}for(const de in m){const h=m[de],c=D[de].paddedRect,d=c.x+Qo,v=c.y+Qo,S=h.data.width,P=h.data.height;Cl.copy(h.data,ie,{x:0,y:0},{x:d,y:v},h.data),Cl.copy(h.data,ie,{x:0,y:P-1},{x:d,y:v-1},{width:S,height:1}),Cl.copy(h.data,ie,{x:0,y:0},{x:d,y:v+P},{width:S,height:1}),Cl.copy(h.data,ie,{x:S-1,y:0},{x:d-1,y:v},{width:1,height:P}),Cl.copy(h.data,ie,{x:0,y:0},{x:d+S,y:v},{width:1,height:P})}this.image=ie,this.iconPositions=C,this.patternPositions=D}addImages(u,m,C){for(const D in u){const Q=u[D],H={x:0,y:0,w:Q.data.width+2*Qo,h:Q.data.height+2*Qo};C.push(H),m[D]=new km(H,Q),Q.hasRenderCallback&&this.haveRenderCallbacks.push(D)}}patchUpdatedImages(u,m){u.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const C in u.updatedImages)this.patchUpdatedImage(this.iconPositions[C],u.getImage(C),m),this.patchUpdatedImage(this.patternPositions[C],u.getImage(C),m)}patchUpdatedImage(u,m,C){if(!u||!m||u.version===m.version)return;u.version=m.version;const[D,Q]=u.tl;C.update(m.data,void 0,{x:D,y:Q})}}var Xu;Rr("ImagePosition",km),Rr("ImageAtlas",Om),a.ah=void 0,(Xu=a.ah||(a.ah={}))[Xu.none=0]="none",Xu[Xu.horizontal=1]="horizontal",Xu[Xu.vertical=2]="vertical",Xu[Xu.horizontalOnly=3]="horizontalOnly";const Sp=-17;class Tp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(u,m){const C=new Tp;return C.scale=u||1,C.fontStack=m,C}static forImage(u){const m=new Tp;return m.imageName=u,m}}class rf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(u,m){const C=new rf;for(let D=0;D<u.sections.length;D++){const Q=u.sections[D];Q.image?C.addImageSection(Q):C.addTextSection(Q,m)}return C}length(){return this.text.length}getSection(u){return this.sections[this.sectionIndex[u]]}getSectionIndex(u){return this.sectionIndex[u]}getCharCode(u){return this.text.charCodeAt(u)}verticalizePunctuation(){this.text=function(u){let m="";for(let C=0;C<u.length;C++){const D=u.charCodeAt(C+1)||null,Q=u.charCodeAt(C-1)||null;m+=D&&mu(D)&&!_A[u[C+1]]||Q&&mu(Q)&&!_A[u[C-1]]||!_A[u[C]]?u[C]:_A[u[C]]}return m}(this.text)}trim(){let u=0;for(let C=0;C<this.text.length&&Lp[this.text.charCodeAt(C)];C++)u++;let m=this.text.length;for(let C=this.text.length-1;C>=0&&C>=u&&Lp[this.text.charCodeAt(C)];C--)m--;this.text=this.text.substring(u,m),this.sectionIndex=this.sectionIndex.slice(u,m)}substring(u,m){const C=new rf;return C.text=this.text.substring(u,m),C.sectionIndex=this.sectionIndex.slice(u,m),C.sections=this.sections,C}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((u,m)=>Math.max(u,this.sections[m].scale),0)}addTextSection(u,m){this.text+=u.text,this.sections.push(Tp.forText(u.scale,u.fontStack||m));const C=this.sections.length-1;for(let D=0;D<u.text.length;++D)this.sectionIndex.push(C)}addImageSection(u){const m=u.image?u.image.name:"";if(m.length===0)return void Ye("Can't add FormattedSection with an empty image.");const C=this.getNextImageSectionCharCode();C?(this.text+=String.fromCharCode(C),this.sections.push(Tp.forImage(m)),this.sectionIndex.push(this.sections.length-1)):Ye("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ip(f,u,m,C,D,Q,H,X,ie,de,h,c,d,v,S,P){const k=rf.fromFeature(f,D);let G;c===a.ah.vertical&&k.verticalizePunctuation();const{processBidirectionalText:W,processStyledBidirectionalText:ee}=ol;if(W&&k.sections.length===1){G=[];const me=W(k.toString(),bA(k,de,Q,u,C,v,S));for(const Ce of me){const Me=new rf;Me.text=Ce,Me.sections=k.sections;for(let Ue=0;Ue<Ce.length;Ue++)Me.sectionIndex.push(0);G.push(Me)}}else if(ee){G=[];const me=ee(k.text,k.sectionIndex,bA(k,de,Q,u,C,v,S));for(const Ce of me){const Me=new rf;Me.text=Ce[0],Me.sectionIndex=Ce[1],Me.sections=k.sections,G.push(Me)}}else G=function(me,Ce){const Me=[],Ue=me.text;let $e=0;for(const Ke of Ce)Me.push(me.substring($e,Ke)),$e=Ke;return $e<Ue.length&&Me.push(me.substring($e,Ue.length)),Me}(k,bA(k,de,Q,u,C,v,S));const ae=[],fe={positionedLines:ae,text:k.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:c,iconsInText:!1,verticalizable:!1};return function(me,Ce,Me,Ue,$e,Ke,ut,tt,it,yt,St,Jt){let Br=0,ar=Sp,pr=0,_r=0;const kr=tt==="right"?1:tt==="left"?0:.5;let lr=0;for(const Vi of $e){Vi.trim();const $i=Vi.getMaxScale(),gn=($i-1)*xo,cs={positionedGlyphs:[],lineOffset:0};me.positionedLines[lr]=cs;const Qn=cs.positionedGlyphs;let xn=0;if(!Vi.length()){ar+=Ke,++lr;continue}for(let hn=0;hn<Vi.length();hn++){const Bi=Vi.getSection(hn),Vn=Vi.getSectionIndex(hn),An=Vi.getCharCode(hn);let rn=0,gs=null,Ts=null,xs=null,ao=xo;const Is=!(it===a.ah.horizontal||!St&&!ec(An)||St&&(Lp[An]||(Yt=An,Dr.Arabic(Yt)||Dr["Arabic Supplement"](Yt)||Dr["Arabic Extended-A"](Yt)||Dr["Arabic Presentation Forms-A"](Yt)||Dr["Arabic Presentation Forms-B"](Yt))));if(Bi.imageName){const kn=Ue[Bi.imageName];if(!kn)continue;xs=Bi.imageName,me.iconsInText=me.iconsInText||!0,Ts=kn.paddedRect;const Si=kn.displaySize;Bi.scale=Bi.scale*xo/Jt,gs={width:Si[0],height:Si[1],left:Qo,top:-nw,advance:Is?Si[1]:Si[0]},rn=gn+(xo-Si[1]*Bi.scale),ao=gs.advance;const Qs=Is?Si[0]*Bi.scale-xo*$i:Si[1]*Bi.scale-xo*$i;Qs>0&&Qs>xn&&(xn=Qs)}else{const kn=Me[Bi.fontStack],Si=kn&&kn[An];if(Si&&Si.rect)Ts=Si.rect,gs=Si.metrics;else{const Qs=Ce[Bi.fontStack],fo=Qs&&Qs[An];if(!fo)continue;gs=fo.metrics}rn=($i-Bi.scale)*xo}Is?(me.verticalizable=!0,Qn.push({glyph:An,imageName:xs,x:Br,y:ar+rn,vertical:Is,scale:Bi.scale,fontStack:Bi.fontStack,sectionIndex:Vn,metrics:gs,rect:Ts}),Br+=ao*Bi.scale+yt):(Qn.push({glyph:An,imageName:xs,x:Br,y:ar+rn,vertical:Is,scale:Bi.scale,fontStack:Bi.fontStack,sectionIndex:Vn,metrics:gs,rect:Ts}),Br+=gs.advance*Bi.scale+yt)}Qn.length!==0&&(pr=Math.max(Br-yt,pr),Nm(Qn,0,Qn.length-1,kr,xn)),Br=0;const Rn=Ke*$i+xn;cs.lineOffset=Math.max(xn,gn),ar+=Rn,_r=Math.max(Rn,_r),++lr}var Yt;const jr=ar-Sp,{horizontalAlign:Vr,verticalAlign:_i}=of(ut);(function(Vi,$i,gn,cs,Qn,xn,Rn,hn,Bi){const Vn=($i-gn)*Qn;let An=0;An=xn!==Rn?-hn*cs-Sp:(-cs*Bi+.5)*Rn;for(const rn of Vi)for(const gs of rn.positionedGlyphs)gs.x+=Vn,gs.y+=An})(me.positionedLines,kr,Vr,_i,pr,_r,Ke,jr,$e.length),me.top+=-_i*jr,me.bottom=me.top+jr,me.left+=-Vr*pr,me.right=me.left+pr}(fe,u,m,C,G,H,X,ie,c,de,d,P),!function(me){for(const Ce of me)if(Ce.positionedGlyphs.length!==0)return!1;return!0}(ae)&&fe}const Lp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Sl={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Um(f,u,m,C,D,Q){if(u.imageName){const H=C[u.imageName];return H?H.displaySize[0]*u.scale*xo/Q+D:0}{const H=m[u.fontStack],X=H&&H[f];return X?X.metrics.advance*u.scale+D:0}}function m_(f,u,m,C){const D=Math.pow(f-u,2);return C?f<u?D/2:2*D:D+Math.abs(m)*m}function vA(f,u,m){let C=0;return f===10&&(C-=1e4),m&&(C+=150),f!==40&&f!==65288||(C+=50),u!==41&&u!==65289||(C+=50),C}function nf(f,u,m,C,D,Q){let H=null,X=m_(u,m,D,Q);for(const ie of C){const de=m_(u-ie.x,m,D,Q)+ie.badness;de<=X&&(H=ie,X=de)}return{index:f,x:u,priorBreak:H,badness:X}}function sf(f){return f?sf(f.priorBreak).concat(f.index):[]}function bA(f,u,m,C,D,Q,H){if(Q!=="point")return[];if(!f)return[];const X=[],ie=function(d,v,S,P,k,G){let W=0;for(let ee=0;ee<d.length();ee++){const ae=d.getSection(ee);W+=Um(d.getCharCode(ee),ae,P,k,v,G)}return W/Math.max(1,Math.ceil(W/S))}(f,u,m,C,D,H),de=f.text.indexOf("")>=0;let h=0;for(let d=0;d<f.length();d++){const v=f.getSection(d),S=f.getCharCode(d);if(Lp[S]||(h+=Um(S,v,C,D,u,H)),d<f.length()-1){const P=!((c=S)<11904||!(Dr["Bopomofo Extended"](c)||Dr.Bopomofo(c)||Dr["CJK Compatibility Forms"](c)||Dr["CJK Compatibility Ideographs"](c)||Dr["CJK Compatibility"](c)||Dr["CJK Radicals Supplement"](c)||Dr["CJK Strokes"](c)||Dr["CJK Symbols and Punctuation"](c)||Dr["CJK Unified Ideographs Extension A"](c)||Dr["CJK Unified Ideographs"](c)||Dr["Enclosed CJK Letters and Months"](c)||Dr["Halfwidth and Fullwidth Forms"](c)||Dr.Hiragana(c)||Dr["Ideographic Description Characters"](c)||Dr["Kangxi Radicals"](c)||Dr["Katakana Phonetic Extensions"](c)||Dr.Katakana(c)||Dr["Vertical Forms"](c)||Dr["Yi Radicals"](c)||Dr["Yi Syllables"](c)));(Sl[S]||P||v.imageName)&&X.push(nf(d+1,h,ie,X,vA(S,f.getCharCode(d+1),P&&de),!1))}}var c;return sf(nf(f.length(),h,ie,X,0,!0))}function of(f){let u=.5,m=.5;switch(f){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(f){case"bottom":case"bottom-right":case"bottom-left":m=1;break;case"top":case"top-right":case"top-left":m=0}return{horizontalAlign:u,verticalAlign:m}}function Nm(f,u,m,C,D){if(!C&&!D)return;const Q=f[m],H=(f[m].x+Q.metrics.advance*Q.scale)*C;for(let X=u;X<=m;X++)f[X].x-=H,f[X].y+=D}function m5(f,u,m){const{horizontalAlign:C,verticalAlign:D}=of(m),Q=u[0]-f.displaySize[0]*C,H=u[1]-f.displaySize[1]*D;return{image:f,top:H,bottom:H+f.displaySize[1],left:Q,right:Q+f.displaySize[0]}}function y_(f,u,m,C,D,Q){const H=f.image;let X;if(H.content){const k=H.content,G=H.pixelRatio||1;X=[k[0]/G,k[1]/G,H.displaySize[0]-k[2]/G,H.displaySize[1]-k[3]/G]}const ie=u.left*Q,de=u.right*Q;let h,c,d,v;m==="width"||m==="both"?(v=D[0]+ie-C[3],c=D[0]+de+C[1]):(v=D[0]+(ie+de-H.displaySize[0])/2,c=v+H.displaySize[0]);const S=u.top*Q,P=u.bottom*Q;return m==="height"||m==="both"?(h=D[1]+S-C[0],d=D[1]+P+C[2]):(h=D[1]+(S+P-H.displaySize[1])/2,d=h+H.displaySize[1]),{image:H,top:h,right:c,bottom:d,left:v,collisionPadding:X}}const af=255,Zu=128,Dh=af*Zu;function __(f,u){const{expression:m}=u;if(m.kind==="constant")return{kind:"constant",layoutSize:m.evaluate(new vn(f+1))};if(m.kind==="source")return{kind:"source"};{const{zoomStops:C,interpolationType:D}=m;let Q=0;for(;Q<C.length&&C[Q]<=f;)Q++;Q=Math.max(0,Q-1);let H=Q;for(;H<C.length&&C[H]<f+1;)H++;H=Math.min(C.length-1,H);const X=C[Q],ie=C[H];return m.kind==="composite"?{kind:"composite",minZoom:X,maxZoom:ie,interpolationType:D}:{kind:"camera",minZoom:X,maxZoom:ie,minSize:m.evaluate(new vn(X)),maxSize:m.evaluate(new vn(ie)),interpolationType:D}}}function Mp(f,u,m){let C="never";const D=f.get(u);return D?C=D:f.get(m)&&(C="always"),C}const v_=Wu.VectorTileFeature.types,y5=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zm(f,u,m,C,D,Q,H,X,ie,de,h,c,d){const v=X?Math.min(Dh,Math.round(X[0])):0,S=X?Math.min(Dh,Math.round(X[1])):0;f.emplaceBack(u,m,Math.round(32*C),Math.round(32*D),Q,H,(v<<1)+(ie?1:0),S,16*de,16*h,256*c,256*d)}function Qm(f,u,m){f.emplaceBack(u.x,u.y,m),f.emplaceBack(u.x,u.y,m),f.emplaceBack(u.x,u.y,m),f.emplaceBack(u.x,u.y,m)}function Pp(f){for(const u of f.sections)if(qc(u.text))return!0;return!1}class Yc{constructor(u){this.layoutVertexArray=new _e,this.indexArray=new Oe,this.programConfigurations=u,this.segments=new dt,this.dynamicLayoutVertexArray=new Ie,this.opacityVertexArray=new ve,this.hasVisibleVertices=!1,this.placedSymbolArray=new l}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(u,m,C,D){this.isEmpty()||(C&&(this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,jx.members),this.indexBuffer=u.createIndexBuffer(this.indexArray,m),this.dynamicLayoutVertexBuffer=u.createVertexBuffer(this.dynamicLayoutVertexArray,u_.members,!0),this.opacityVertexBuffer=u.createVertexBuffer(this.opacityVertexArray,y5,!0),this.opacityVertexBuffer.itemSize=1),(C||D)&&this.programConfigurations.upload(u))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Rr("SymbolBuffers",Yc);class Ju{constructor(u,m,C){this.layoutVertexArray=new u,this.layoutAttributes=m,this.indexArray=new C,this.segments=new dt,this.collisionVertexArray=new et}upload(u){this.layoutVertexBuffer=u.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=u.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=u.createVertexBuffer(this.collisionVertexArray,qx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Rr("CollisionBuffers",Ju);class id{constructor(u){this.collisionBoxArray=u.collisionBoxArray,this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(H=>H.id),this.index=u.index,this.pixelRatio=u.pixelRatio,this.sourceLayerIndex=u.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=dA([]),this.placementViewportMatrix=dA([]);const m=this.layers[0]._unevaluatedLayout._values;this.textSizeData=__(this.zoom,m["text-size"]),this.iconSizeData=__(this.zoom,m["icon-size"]);const C=this.layers[0].layout,D=C.get("symbol-sort-key"),Q=C.get("symbol-z-order");this.canOverlap=Mp(C,"text-overlap","text-allow-overlap")!=="never"||Mp(C,"icon-overlap","icon-allow-overlap")!=="never"||C.get("text-ignore-placement")||C.get("icon-ignore-placement"),this.sortFeaturesByKey=Q!=="viewport-y"&&!D.isConstant(),this.sortFeaturesByY=(Q==="viewport-y"||Q==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,C.get("symbol-placement")==="point"&&(this.writingModes=C.get("text-writing-mode").map(H=>a.ah[H])),this.stateDependentLayerIds=this.layers.filter(H=>H.isStateDependent()).map(H=>H.id),this.sourceID=u.sourceID}createArrays(){this.text=new Yc(new an(this.layers,this.zoom,u=>/^text/.test(u))),this.icon=new Yc(new an(this.layers,this.zoom,u=>/^icon/.test(u))),this.glyphOffsetArray=new B,this.lineVertexArray=new L,this.symbolInstances=new x,this.textAnchorOffsets=new _}calculateGlyphDependencies(u,m,C,D,Q){for(let H=0;H<u.length;H++)if(m[u.charCodeAt(H)]=!0,(C||D)&&Q){const X=_A[u.charAt(H)];X&&(m[X.charCodeAt(0)]=!0)}}populate(u,m,C){const D=this.layers[0],Q=D.layout,H=Q.get("text-font"),X=Q.get("text-field"),ie=Q.get("icon-image"),de=(X.value.kind!=="constant"||X.value.value instanceof fi&&!X.value.value.isEmpty()||X.value.value.toString().length>0)&&(H.value.kind!=="constant"||H.value.value.length>0),h=ie.value.kind!=="constant"||!!ie.value.value||Object.keys(ie.parameters).length>0,c=Q.get("symbol-sort-key");if(this.features=[],!de&&!h)return;const d=m.iconDependencies,v=m.glyphDependencies,S=m.availableImages,P=new vn(this.zoom);for(const{feature:k,id:G,index:W,sourceLayerIndex:ee}of u){const ae=D._featureFilter.needGeometry,fe=so(k,ae);if(!D._featureFilter.filter(P,fe,C))continue;let me,Ce;if(ae||(fe.geometry=Ns(k)),de){const Ue=D.getValueAndResolveTokens("text-field",fe,C,S),$e=fi.factory(Ue),Ke=this.hasRTLText=this.hasRTLText||Pp($e);(!Ke||ol.getRTLTextPluginStatus()==="unavailable"||Ke&&ol.isParsed())&&(me=d5($e,D,fe))}if(h){const Ue=D.getValueAndResolveTokens("icon-image",fe,C,S);Ce=Ue instanceof Bn?Ue:Bn.fromString(Ue)}if(!me&&!Ce)continue;const Me=this.sortFeaturesByKey?c.evaluate(fe,{},C):void 0;if(this.features.push({id:G,text:me,icon:Ce,index:W,sourceLayerIndex:ee,geometry:fe.geometry,properties:k.properties,type:v_[k.type],sortKey:Me}),Ce&&(d[Ce.name]=!0),me){const Ue=H.evaluate(fe,{},C).join(","),$e=Q.get("text-rotation-alignment")!=="viewport"&&Q.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ah.vertical)>=0;for(const Ke of me.sections)if(Ke.image)d[Ke.image.name]=!0;else{const ut=ro(me.toString()),tt=Ke.fontStack||Ue,it=v[tt]=v[tt]||{};this.calculateGlyphDependencies(Ke.text,it,$e,this.allowVerticalPlacement,ut)}}}Q.get("symbol-placement")==="line"&&(this.features=function(k){const G={},W={},ee=[];let ae=0;function fe(Ue){ee.push(k[Ue]),ae++}function me(Ue,$e,Ke){const ut=W[Ue];return delete W[Ue],W[$e]=ut,ee[ut].geometry[0].pop(),ee[ut].geometry[0]=ee[ut].geometry[0].concat(Ke[0]),ut}function Ce(Ue,$e,Ke){const ut=G[$e];return delete G[$e],G[Ue]=ut,ee[ut].geometry[0].shift(),ee[ut].geometry[0]=Ke[0].concat(ee[ut].geometry[0]),ut}function Me(Ue,$e,Ke){const ut=Ke?$e[0][$e[0].length-1]:$e[0][0];return`${Ue}:${ut.x}:${ut.y}`}for(let Ue=0;Ue<k.length;Ue++){const $e=k[Ue],Ke=$e.geometry,ut=$e.text?$e.text.toString():null;if(!ut){fe(Ue);continue}const tt=Me(ut,Ke),it=Me(ut,Ke,!0);if(tt in W&&it in G&&W[tt]!==G[it]){const yt=Ce(tt,it,Ke),St=me(tt,it,ee[yt].geometry);delete G[tt],delete W[it],W[Me(ut,ee[St].geometry,!0)]=St,ee[yt].geometry=null}else tt in W?me(tt,it,Ke):it in G?Ce(tt,it,Ke):(fe(Ue),G[tt]=ae-1,W[it]=ae-1)}return ee.filter(Ue=>Ue.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((k,G)=>k.sortKey-G.sortKey)}update(u,m,C){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(u,m,this.layers,C),this.icon.programConfigurations.updatePaintArrays(u,m,this.layers,C))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(u){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(u),this.iconCollisionBox.upload(u)),this.text.upload(u,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(u,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(u,m){const C=this.lineVertexArray.length;if(u.segment!==void 0){let D=u.dist(m[u.segment+1]),Q=u.dist(m[u.segment]);const H={};for(let X=u.segment+1;X<m.length;X++)H[X]={x:m[X].x,y:m[X].y,tileUnitDistanceFromAnchor:D},X<m.length-1&&(D+=m[X+1].dist(m[X]));for(let X=u.segment||0;X>=0;X--)H[X]={x:m[X].x,y:m[X].y,tileUnitDistanceFromAnchor:Q},X>0&&(Q+=m[X-1].dist(m[X]));for(let X=0;X<m.length;X++){const ie=H[X];this.lineVertexArray.emplaceBack(ie.x,ie.y,ie.tileUnitDistanceFromAnchor)}}return{lineStartIndex:C,lineLength:this.lineVertexArray.length-C}}addSymbols(u,m,C,D,Q,H,X,ie,de,h,c,d){const v=u.indexArray,S=u.layoutVertexArray,P=u.segments.prepareSegment(4*m.length,S,v,this.canOverlap?H.sortKey:void 0),k=this.glyphOffsetArray.length,G=P.vertexLength,W=this.allowVerticalPlacement&&X===a.ah.vertical?Math.PI/2:0,ee=H.text&&H.text.sections;for(let ae=0;ae<m.length;ae++){const{tl:fe,tr:me,bl:Ce,br:Me,tex:Ue,pixelOffsetTL:$e,pixelOffsetBR:Ke,minFontScaleX:ut,minFontScaleY:tt,glyphOffset:it,isSDF:yt,sectionIndex:St}=m[ae],Jt=P.vertexLength,Br=it[1];zm(S,ie.x,ie.y,fe.x,Br+fe.y,Ue.x,Ue.y,C,yt,$e.x,$e.y,ut,tt),zm(S,ie.x,ie.y,me.x,Br+me.y,Ue.x+Ue.w,Ue.y,C,yt,Ke.x,$e.y,ut,tt),zm(S,ie.x,ie.y,Ce.x,Br+Ce.y,Ue.x,Ue.y+Ue.h,C,yt,$e.x,Ke.y,ut,tt),zm(S,ie.x,ie.y,Me.x,Br+Me.y,Ue.x+Ue.w,Ue.y+Ue.h,C,yt,Ke.x,Ke.y,ut,tt),Qm(u.dynamicLayoutVertexArray,ie,W),v.emplaceBack(Jt,Jt+1,Jt+2),v.emplaceBack(Jt+1,Jt+2,Jt+3),P.vertexLength+=4,P.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(it[0]),ae!==m.length-1&&St===m[ae+1].sectionIndex||u.programConfigurations.populatePaintArrays(S.length,H,H.index,{},d,ee&&ee[St])}u.placedSymbolArray.emplaceBack(ie.x,ie.y,k,this.glyphOffsetArray.length-k,G,de,h,ie.segment,C?C[0]:0,C?C[1]:0,D[0],D[1],X,0,!1,0,c)}_addCollisionDebugVertex(u,m,C,D,Q,H){return m.emplaceBack(0,0),u.emplaceBack(C.x,C.y,D,Q,Math.round(H.x),Math.round(H.y))}addCollisionDebugVertices(u,m,C,D,Q,H,X){const ie=Q.segments.prepareSegment(4,Q.layoutVertexArray,Q.indexArray),de=ie.vertexLength,h=Q.layoutVertexArray,c=Q.collisionVertexArray,d=X.anchorX,v=X.anchorY;this._addCollisionDebugVertex(h,c,H,d,v,new I(u,m)),this._addCollisionDebugVertex(h,c,H,d,v,new I(C,m)),this._addCollisionDebugVertex(h,c,H,d,v,new I(C,D)),this._addCollisionDebugVertex(h,c,H,d,v,new I(u,D)),ie.vertexLength+=4;const S=Q.indexArray;S.emplaceBack(de,de+1),S.emplaceBack(de+1,de+2),S.emplaceBack(de+2,de+3),S.emplaceBack(de+3,de),ie.primitiveLength+=4}addDebugCollisionBoxes(u,m,C,D){for(let Q=u;Q<m;Q++){const H=this.collisionBoxArray.get(Q);this.addCollisionDebugVertices(H.x1,H.y1,H.x2,H.y2,D?this.textCollisionBox:this.iconCollisionBox,H.anchorPoint,C)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ju(Se,h_.members,Re),this.iconCollisionBox=new Ju(Se,h_.members,Re);for(let u=0;u<this.symbolInstances.length;u++){const m=this.symbolInstances.get(u);this.addDebugCollisionBoxes(m.textBoxStartIndex,m.textBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.iconBoxStartIndex,m.iconBoxEndIndex,m,!1),this.addDebugCollisionBoxes(m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m,!1)}}_deserializeCollisionBoxesForSymbol(u,m,C,D,Q,H,X,ie,de){const h={};for(let c=m;c<C;c++){const d=u.get(c);h.textBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},h.textFeatureIndex=d.featureIndex;break}for(let c=D;c<Q;c++){const d=u.get(c);h.verticalTextBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},h.verticalTextFeatureIndex=d.featureIndex;break}for(let c=H;c<X;c++){const d=u.get(c);h.iconBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},h.iconFeatureIndex=d.featureIndex;break}for(let c=ie;c<de;c++){const d=u.get(c);h.verticalIconBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},h.verticalIconFeatureIndex=d.featureIndex;break}return h}deserializeCollisionBoxes(u){this.collisionArrays=[];for(let m=0;m<this.symbolInstances.length;m++){const C=this.symbolInstances.get(m);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(u,C.textBoxStartIndex,C.textBoxEndIndex,C.verticalTextBoxStartIndex,C.verticalTextBoxEndIndex,C.iconBoxStartIndex,C.iconBoxEndIndex,C.verticalIconBoxStartIndex,C.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(u,m){const C=u.placedSymbolArray.get(m),D=C.vertexStartIndex+4*C.numGlyphs;for(let Q=C.vertexStartIndex;Q<D;Q+=4)u.indexArray.emplaceBack(Q,Q+1,Q+2),u.indexArray.emplaceBack(Q+1,Q+2,Q+3)}getSortedSymbolIndexes(u){if(this.sortedAngle===u&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const m=Math.sin(u),C=Math.cos(u),D=[],Q=[],H=[];for(let X=0;X<this.symbolInstances.length;++X){H.push(X);const ie=this.symbolInstances.get(X);D.push(0|Math.round(m*ie.anchorX+C*ie.anchorY)),Q.push(ie.featureIndex)}return H.sort((X,ie)=>D[X]-D[ie]||Q[ie]-Q[X]),H}addToSortKeyRanges(u,m){const C=this.sortKeyRanges[this.sortKeyRanges.length-1];C&&C.sortKey===m?C.symbolInstanceEnd=u+1:this.sortKeyRanges.push({sortKey:m,symbolInstanceStart:u,symbolInstanceEnd:u+1})}sortFeatures(u){if(this.sortFeaturesByY&&this.sortedAngle!==u&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(u),this.sortedAngle=u,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const m of this.symbolInstanceIndexes){const C=this.symbolInstances.get(m);this.featureSortOrder.push(C.featureIndex),[C.rightJustifiedTextSymbolIndex,C.centerJustifiedTextSymbolIndex,C.leftJustifiedTextSymbolIndex].forEach((D,Q,H)=>{D>=0&&H.indexOf(D)===Q&&this.addIndicesForPlacedSymbol(this.text,D)}),C.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,C.verticalPlacedTextSymbolIndex),C.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.placedIconSymbolIndex),C.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,C.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Vm,sw;Rr("SymbolBucket",id,{omit:["layers","collisionBoxArray","features","compareText"]}),id.MAX_GLYPHS=65535,id.addDynamicAttributes=Qm;var b_={get paint(){return sw=sw||new Us({"icon-opacity":new oi(wt.paint_symbol["icon-opacity"]),"icon-color":new oi(wt.paint_symbol["icon-color"]),"icon-halo-color":new oi(wt.paint_symbol["icon-halo-color"]),"icon-halo-width":new oi(wt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new oi(wt.paint_symbol["icon-halo-blur"]),"icon-translate":new Sr(wt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Sr(wt.paint_symbol["icon-translate-anchor"]),"text-opacity":new oi(wt.paint_symbol["text-opacity"]),"text-color":new oi(wt.paint_symbol["text-color"],{runtimeType:Xt,getOverride:f=>f.textColor,hasOverride:f=>!!f.textColor}),"text-halo-color":new oi(wt.paint_symbol["text-halo-color"]),"text-halo-width":new oi(wt.paint_symbol["text-halo-width"]),"text-halo-blur":new oi(wt.paint_symbol["text-halo-blur"]),"text-translate":new Sr(wt.paint_symbol["text-translate"]),"text-translate-anchor":new Sr(wt.paint_symbol["text-translate-anchor"])})},get layout(){return Vm=Vm||new Us({"symbol-placement":new Sr(wt.layout_symbol["symbol-placement"]),"symbol-spacing":new Sr(wt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Sr(wt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new oi(wt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Sr(wt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Sr(wt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Sr(wt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Sr(wt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Sr(wt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Sr(wt.layout_symbol["icon-rotation-alignment"]),"icon-size":new oi(wt.layout_symbol["icon-size"]),"icon-text-fit":new Sr(wt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Sr(wt.layout_symbol["icon-text-fit-padding"]),"icon-image":new oi(wt.layout_symbol["icon-image"]),"icon-rotate":new oi(wt.layout_symbol["icon-rotate"]),"icon-padding":new oi(wt.layout_symbol["icon-padding"]),"icon-keep-upright":new Sr(wt.layout_symbol["icon-keep-upright"]),"icon-offset":new oi(wt.layout_symbol["icon-offset"]),"icon-anchor":new oi(wt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Sr(wt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Sr(wt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Sr(wt.layout_symbol["text-rotation-alignment"]),"text-field":new oi(wt.layout_symbol["text-field"]),"text-font":new oi(wt.layout_symbol["text-font"]),"text-size":new oi(wt.layout_symbol["text-size"]),"text-max-width":new oi(wt.layout_symbol["text-max-width"]),"text-line-height":new Sr(wt.layout_symbol["text-line-height"]),"text-letter-spacing":new oi(wt.layout_symbol["text-letter-spacing"]),"text-justify":new oi(wt.layout_symbol["text-justify"]),"text-radial-offset":new oi(wt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Sr(wt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new oi(wt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new oi(wt.layout_symbol["text-anchor"]),"text-max-angle":new Sr(wt.layout_symbol["text-max-angle"]),"text-writing-mode":new Sr(wt.layout_symbol["text-writing-mode"]),"text-rotate":new oi(wt.layout_symbol["text-rotate"]),"text-padding":new Sr(wt.layout_symbol["text-padding"]),"text-keep-upright":new Sr(wt.layout_symbol["text-keep-upright"]),"text-transform":new oi(wt.layout_symbol["text-transform"]),"text-offset":new oi(wt.layout_symbol["text-offset"]),"text-allow-overlap":new Sr(wt.layout_symbol["text-allow-overlap"]),"text-overlap":new Sr(wt.layout_symbol["text-overlap"]),"text-ignore-placement":new Sr(wt.layout_symbol["text-ignore-placement"]),"text-optional":new Sr(wt.layout_symbol["text-optional"])})}};class Fp{constructor(u){if(u.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=u.property.overrides?u.property.overrides.runtimeType:di,this.defaultValue=u}evaluate(u){if(u.formattedSection){const m=this.defaultValue.property.overrides;if(m&&m.hasOverride(u.formattedSection))return m.getOverride(u.formattedSection)}return u.feature&&u.featureState?this.defaultValue.evaluate(u.feature,u.featureState):this.defaultValue.property.specification.default}eachChild(u){this.defaultValue.isConstant()||u(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Rr("FormatSectionOverride",Fp,{omit:["defaultValue"]});class lf extends Wn{constructor(u){super(u,b_)}recalculate(u,m){if(super.recalculate(u,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const C=this.layout.get("text-writing-mode");if(C){const D=[];for(const Q of C)D.indexOf(Q)<0&&D.push(Q);this.layout._values["text-writing-mode"]=D}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(u,m,C,D){const Q=this.layout.get(u).evaluate(m,{},C,D),H=this._unevaluatedLayout._values[u];return H.isDataDriven()||Di(H.value)||!Q?Q:function(X,ie){return ie.replace(/{([^{}]+)}/g,(de,h)=>X&&h in X?String(X[h]):"")}(m.properties,Q)}createBucket(u){return new id(u)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const u of b_.paint.overridableProperties){if(!lf.hasPaintOverride(this.layout,u))continue;const m=this.paint.get(u),C=new Fp(m),D=new Pn(C,m.property.specification);let Q=null;Q=m.value.kind==="constant"||m.value.kind==="source"?new Ds("source",D):new eo("composite",D,m.value.zoomStops),this.paint._values[u]=new xa(m.property,Q,m.parameters)}}_handleOverridablePaintPropertyUpdate(u,m,C){return!(!this.layout||m.isDataDriven()||C.isDataDriven())&&lf.hasPaintOverride(this.layout,u)}static hasPaintOverride(u,m){const C=u.get("text-field"),D=b_.paint.properties[m];let Q=!1;const H=X=>{for(const ie of X)if(D.overrides&&D.overrides.hasOverride(ie))return void(Q=!0)};if(C.value.kind==="constant"&&C.value.value instanceof fi)H(C.value.value.sections);else if(C.value.kind==="source"){const X=de=>{Q||(de instanceof Fs&&Zr(de.value)===Zi?H(de.value.sections):de instanceof il?H(de.sections):de.eachChild(X))},ie=C.value;ie._styleExpression&&X(ie._styleExpression.expression)}return Q}}let ow;var x_={get paint(){return ow=ow||new Us({"background-color":new Sr(wt.paint_background["background-color"]),"background-pattern":new Kc(wt.paint_background["background-pattern"]),"background-opacity":new Sr(wt.paint_background["background-opacity"])})}};class w_ extends Wn{constructor(u){super(u,x_)}}let nd;var aw={get paint(){return nd=nd||new Us({"raster-opacity":new Sr(wt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Sr(wt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Sr(wt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Sr(wt.paint_raster["raster-brightness-max"]),"raster-saturation":new Sr(wt.paint_raster["raster-saturation"]),"raster-contrast":new Sr(wt.paint_raster["raster-contrast"]),"raster-resampling":new Sr(wt.paint_raster["raster-resampling"]),"raster-fade-duration":new Sr(wt.paint_raster["raster-fade-duration"])})}};class lw extends Wn{constructor(u){super(u,aw)}}class B_ extends Wn{constructor(u){super(u,{}),this.onAdd=m=>{this.implementation.onAdd&&this.implementation.onAdd(m,m.painter.context.gl)},this.onRemove=m=>{this.implementation.onRemove&&this.implementation.onRemove(m,m.painter.context.gl)},this.implementation=u}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class cw{constructor(u){this._methodToThrottle=u,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const cf=63710088e-1;class Rh{constructor(u,m){if(isNaN(u)||isNaN(m))throw new Error(`Invalid LngLat object: (${u}, ${m})`);if(this.lng=+u,this.lat=+m,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Rh(je(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(u){const m=Math.PI/180,C=this.lat*m,D=u.lat*m,Q=Math.sin(C)*Math.sin(D)+Math.cos(C)*Math.cos(D)*Math.cos((u.lng-this.lng)*m);return cf*Math.acos(Math.min(Q,1))}static convert(u){if(u instanceof Rh)return u;if(Array.isArray(u)&&(u.length===2||u.length===3))return new Rh(Number(u[0]),Number(u[1]));if(!Array.isArray(u)&&typeof u=="object"&&u!==null)return new Rh(Number("lng"in u?u.lng:u.lon),Number(u.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const uw=2*Math.PI*cf;function hw(f){return uw*Math.cos(f*Math.PI/180)}function C_(f){return(180+f)/360}function Aw(f){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f*Math.PI/360)))/360}function dw(f,u){return f/hw(u)}function E_(f){return 360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90}class Hm{constructor(u,m){let C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+u,this.y=+m,this.z=+C}static fromLngLat(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const C=Rh.convert(u);return new Hm(C_(C.lng),Aw(C.lat),dw(m,C.lat))}toLngLat(){return new Rh(360*this.x-180,E_(this.y))}toAltitude(){return this.z*hw(E_(this.y))}meterInMercatorCoordinateUnits(){return 1/uw*(u=E_(this.y),1/Math.cos(u*Math.PI/180));var u}}function Gm(f,u,m){var C=2*Math.PI*6378137/256/Math.pow(2,m);return[f*C-2*Math.PI*6378137/2,u*C-2*Math.PI*6378137/2]}class Yu{constructor(u,m,C){if(u<0||u>25||C<0||C>=Math.pow(2,u)||m<0||m>=Math.pow(2,u))throw new Error(`x=${m}, y=${C}, z=${u} outside of bounds. 0<=x<${Math.pow(2,u)}, 0<=y<${Math.pow(2,u)} 0<=z<=25 `);this.z=u,this.x=m,this.y=C,this.key=uf(0,u,u,m,C)}equals(u){return this.z===u.z&&this.x===u.x&&this.y===u.y}url(u,m,C){const D=(H=this.y,X=this.z,ie=Gm(256*(Q=this.x),256*(H=Math.pow(2,X)-H-1),X),de=Gm(256*(Q+1),256*(H+1),X),ie[0]+","+ie[1]+","+de[0]+","+de[1]);var Q,H,X,ie,de;const h=function(c,d,v){let S,P="";for(let k=c;k>0;k--)S=1<<k-1,P+=(d&S?1:0)+(v&S?2:0);return P}(this.z,this.x,this.y);return u[(this.x+this.y)%u.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(C==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,m>1?"@2x":"").replace(/{quadkey}/g,h).replace(/{bbox-epsg-3857}/g,D)}isChildOf(u){const m=this.z-u.z;return m>0&&u.x===this.x>>m&&u.y===this.y>>m}getTilePoint(u){const m=Math.pow(2,this.z);return new I((u.x*m-this.x)*yi,(u.y*m-this.y)*yi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class S_{constructor(u,m){this.wrap=u,this.canonical=m,this.key=uf(u,m.z,m.z,m.x,m.y)}}class cc{constructor(u,m,C,D,Q){if(u<C)throw new Error(`overscaledZ should be >= z; overscaledZ = ${u}; z = ${C}`);this.overscaledZ=u,this.wrap=m,this.canonical=new Yu(C,+D,+Q),this.key=uf(m,u,C,D,Q)}clone(){return new cc(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(u){return this.overscaledZ===u.overscaledZ&&this.wrap===u.wrap&&this.canonical.equals(u.canonical)}scaledTo(u){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-u;return u>this.canonical.z?new cc(u,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new cc(u,this.wrap,u,this.canonical.x>>m,this.canonical.y>>m)}calculateScaledKey(u,m){if(u>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${u}; overscaledZ = ${this.overscaledZ}`);const C=this.canonical.z-u;return u>this.canonical.z?uf(this.wrap*+m,u,this.canonical.z,this.canonical.x,this.canonical.y):uf(this.wrap*+m,u,u,this.canonical.x>>C,this.canonical.y>>C)}isChildOf(u){if(u.wrap!==this.wrap)return!1;const m=this.canonical.z-u.canonical.z;return u.overscaledZ===0||u.overscaledZ<this.overscaledZ&&u.canonical.x===this.canonical.x>>m&&u.canonical.y===this.canonical.y>>m}children(u){if(this.overscaledZ>=u)return[new cc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const m=this.canonical.z+1,C=2*this.canonical.x,D=2*this.canonical.y;return[new cc(m,this.wrap,m,C,D),new cc(m,this.wrap,m,C+1,D),new cc(m,this.wrap,m,C,D+1),new cc(m,this.wrap,m,C+1,D+1)]}isLessThan(u){return this.wrap<u.wrap||!(this.wrap>u.wrap)&&(this.overscaledZ<u.overscaledZ||!(this.overscaledZ>u.overscaledZ)&&(this.canonical.x<u.canonical.x||!(this.canonical.x>u.canonical.x)&&this.canonical.y<u.canonical.y))}wrapped(){return new cc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(u){return new cc(this.overscaledZ,u,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new S_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(u){return this.canonical.getTilePoint(new Hm(u.x-this.wrap,u.y))}}function uf(f,u,m,C,D){(f*=2)<0&&(f=-1*f-1);const Q=1<<m;return(Q*Q*f+Q*D+C).toString(36)+m.toString(36)+u.toString(36)}Rr("CanonicalTileID",Yu),Rr("OverscaledTileID",cc,{omit:["posMatrix"]});class T_{constructor(u,m,C){let D=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,Q=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,H=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,X=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=u,m.height!==m.width)throw new RangeError("DEM tiles must be square");if(C&&!["mapbox","terrarium","custom"].includes(C))return void Ye(`"${C}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=m.height;const ie=this.dim=m.height-2;switch(this.data=new Uint32Array(m.data.buffer),C){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=D,this.greenFactor=Q,this.blueFactor=H,this.baseShift=X;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let de=0;de<ie;de++)this.data[this._idx(-1,de)]=this.data[this._idx(0,de)],this.data[this._idx(ie,de)]=this.data[this._idx(ie-1,de)],this.data[this._idx(de,-1)]=this.data[this._idx(de,0)],this.data[this._idx(de,ie)]=this.data[this._idx(de,ie-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(ie,-1)]=this.data[this._idx(ie-1,0)],this.data[this._idx(-1,ie)]=this.data[this._idx(0,ie-1)],this.data[this._idx(ie,ie)]=this.data[this._idx(ie-1,ie-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let de=0;de<ie;de++)for(let h=0;h<ie;h++){const c=this.get(de,h);c>this.max&&(this.max=c),c<this.min&&(this.min=c)}}get(u,m){const C=new Uint8Array(this.data.buffer),D=4*this._idx(u,m);return this.unpack(C[D],C[D+1],C[D+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(u,m){if(u<-1||u>=this.dim+1||m<-1||m>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(m+1)*this.stride+(u+1)}unpack(u,m,C){return u*this.redFactor+m*this.greenFactor+C*this.blueFactor-this.baseShift}getPixels(){return new Cl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(u,m,C){if(this.dim!==u.dim)throw new Error("dem dimension mismatch");let D=m*this.dim,Q=m*this.dim+this.dim,H=C*this.dim,X=C*this.dim+this.dim;switch(m){case-1:D=Q-1;break;case 1:Q=D+1}switch(C){case-1:H=X-1;break;case 1:X=H+1}const ie=-m*this.dim,de=-C*this.dim;for(let h=H;h<X;h++)for(let c=D;c<Q;c++)this.data[this._idx(c,h)]=u.data[this._idx(c+ie,h+de)]}}Rr("DEMData",T_);class I_{constructor(u){this._stringToNumber={},this._numberToString=[];for(let m=0;m<u.length;m++){const C=u[m];this._stringToNumber[C]=m,this._numberToString[m]=C}}encode(u){return this._stringToNumber[u]}decode(u){if(u>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${u} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[u]}}class L_{constructor(u,m,C,D,Q){this.type="Feature",this._vectorTileFeature=u,u._z=m,u._x=C,u._y=D,this.properties=u.properties,this.id=Q}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(u){this._geometry=u}toJSON(){const u={geometry:this.geometry};for(const m in this)m!=="_geometry"&&m!=="_vectorTileFeature"&&(u[m]=this[m]);return u}}class jm{constructor(u,m){this.tileID=u,this.x=u.canonical.x,this.y=u.canonical.y,this.z=u.canonical.z,this.grid=new Nr(yi,16,0),this.grid3D=new Nr(yi,16,0),this.featureIndexArray=new F,this.promoteId=m}insert(u,m,C,D,Q,H){const X=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(C,D,Q);const ie=H?this.grid3D:this.grid;for(let de=0;de<m.length;de++){const h=m[de],c=[1/0,1/0,-1/0,-1/0];for(let d=0;d<h.length;d++){const v=h[d];c[0]=Math.min(c[0],v.x),c[1]=Math.min(c[1],v.y),c[2]=Math.max(c[2],v.x),c[3]=Math.max(c[3],v.y)}c[0]<yi&&c[1]<yi&&c[2]>=0&&c[3]>=0&&ie.insert(X,c[0],c[1],c[2],c[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Wu.VectorTile(new p_(this.rawTileData)).layers,this.sourceLayerCoder=new I_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(u,m,C,D){this.loadVTLayers();const Q=u.params||{},H=yi/u.tileSize/u.scale,X=Xl(Q.filter),ie=u.queryGeometry,de=u.queryPadding*H,h=M_(ie),c=this.grid.query(h.minX-de,h.minY-de,h.maxX+de,h.maxY+de),d=M_(u.cameraQueryGeometry),v=this.grid3D.query(d.minX-de,d.minY-de,d.maxX+de,d.maxY+de,(k,G,W,ee)=>function(ae,fe,me,Ce,Me){for(const $e of ae)if(fe<=$e.x&&me<=$e.y&&Ce>=$e.x&&Me>=$e.y)return!0;const Ue=[new I(fe,me),new I(fe,Me),new I(Ce,Me),new I(Ce,me)];if(ae.length>2){for(const $e of Ue)if(Zc(ae,$e))return!0}for(let $e=0;$e<ae.length-1;$e++)if(JA(ae[$e],ae[$e+1],Ue))return!0;return!1}(u.cameraQueryGeometry,k-de,G-de,W+de,ee+de));for(const k of v)c.push(k);c.sort(P_);const S={};let P;for(let k=0;k<c.length;k++){const G=c[k];if(G===P)continue;P=G;const W=this.featureIndexArray.get(G);let ee=null;this.loadMatchingFeature(S,W.bucketIndex,W.sourceLayerIndex,W.featureIndex,X,Q.layers,Q.availableImages,m,C,D,(ae,fe,me)=>(ee||(ee=Ns(ae)),fe.queryIntersectsFeature(ie,ae,me,ee,this.z,u.transform,H,u.pixelPosMatrix)))}return S}loadMatchingFeature(u,m,C,D,Q,H,X,ie,de,h,c){const d=this.bucketLayerIDs[m];if(H&&!function(k,G){for(let W=0;W<k.length;W++)if(G.indexOf(k[W])>=0)return!0;return!1}(H,d))return;const v=this.sourceLayerCoder.decode(C),S=this.vtLayers[v].feature(D);if(Q.needGeometry){const k=so(S,!0);if(!Q.filter(new vn(this.tileID.overscaledZ),k,this.tileID.canonical))return}else if(!Q.filter(new vn(this.tileID.overscaledZ),S))return;const P=this.getId(S,v);for(let k=0;k<d.length;k++){const G=d[k];if(H&&H.indexOf(G)<0)continue;const W=ie[G];if(!W)continue;let ee={};P&&h&&(ee=h.getState(W.sourceLayer||"_geojsonTileLayer",P));const ae=We({},de[G]);ae.paint=Dp(ae.paint,W.paint,S,ee,X),ae.layout=Dp(ae.layout,W.layout,S,ee,X);const fe=!c||c(S,W,ee);if(!fe)continue;const me=new L_(S,this.z,this.x,this.y,P);me.layer=ae;let Ce=u[G];Ce===void 0&&(Ce=u[G]=[]),Ce.push({featureIndex:D,feature:me,intersectionZ:fe})}}lookupSymbolFeatures(u,m,C,D,Q,H,X,ie){const de={};this.loadVTLayers();const h=Xl(Q);for(const c of u)this.loadMatchingFeature(de,C,D,c,h,H,X,ie,m);return de}hasLayer(u){for(const m of this.bucketLayerIDs)for(const C of m)if(u===C)return!0;return!1}getId(u,m){let C=u.id;return this.promoteId&&(C=u.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[m]],typeof C=="boolean"&&(C=Number(C))),C}}function Dp(f,u,m,C,D){return at(f,(Q,H)=>{const X=u instanceof no?u.get(H):null;return X&&X.evaluate?X.evaluate(m,C,D):X})}function M_(f){let u=1/0,m=1/0,C=-1/0,D=-1/0;for(const Q of f)u=Math.min(u,Q.x),m=Math.min(m,Q.y),C=Math.max(C,Q.x),D=Math.max(D,Q.y);return{minX:u,minY:m,maxX:C,maxY:D}}function P_(f,u){return u-f}function F_(f,u,m,C,D){const Q=[];for(let H=0;H<f.length;H++){const X=f[H];let ie;for(let de=0;de<X.length-1;de++){let h=X[de],c=X[de+1];h.x<u&&c.x<u||(h.x<u?h=new I(u,h.y+(u-h.x)/(c.x-h.x)*(c.y-h.y))._round():c.x<u&&(c=new I(u,h.y+(u-h.x)/(c.x-h.x)*(c.y-h.y))._round()),h.y<m&&c.y<m||(h.y<m?h=new I(h.x+(m-h.y)/(c.y-h.y)*(c.x-h.x),m)._round():c.y<m&&(c=new I(h.x+(m-h.y)/(c.y-h.y)*(c.x-h.x),m)._round()),h.x>=C&&c.x>=C||(h.x>=C?h=new I(C,h.y+(C-h.x)/(c.x-h.x)*(c.y-h.y))._round():c.x>=C&&(c=new I(C,h.y+(C-h.x)/(c.x-h.x)*(c.y-h.y))._round()),h.y>=D&&c.y>=D||(h.y>=D?h=new I(h.x+(D-h.y)/(c.y-h.y)*(c.x-h.x),D)._round():c.y>=D&&(c=new I(h.x+(D-h.y)/(c.y-h.y)*(c.x-h.x),D)._round()),ie&&h.equals(ie[ie.length-1])||(ie=[h],Q.push(ie)),ie.push(c)))))}}return Q}Rr("FeatureIndex",jm,{omit:["rawTileData","sourceLayerCoder"]});class Vo extends I{constructor(u,m,C,D){super(u,m),this.angle=C,D!==void 0&&(this.segment=D)}clone(){return new Vo(this.x,this.y,this.angle,this.segment)}}function hf(f,u,m,C,D){if(u.segment===void 0||m===0)return!0;let Q=u,H=u.segment+1,X=0;for(;X>-m/2;){if(H--,H<0)return!1;X-=f[H].dist(Q),Q=f[H]}X+=f[H].dist(f[H+1]),H++;const ie=[];let de=0;for(;X<m/2;){const h=f[H],c=f[H+1];if(!c)return!1;let d=f[H-1].angleTo(h)-h.angleTo(c);for(d=Math.abs((d+3*Math.PI)%(2*Math.PI)-Math.PI),ie.push({distance:X,angleDelta:d}),de+=d;X-ie[0].distance>C;)de-=ie.shift().angleDelta;if(de>D)return!1;H++,X+=h.dist(c)}return!0}function D_(f){let u=0;for(let m=0;m<f.length-1;m++)u+=f[m].dist(f[m+1]);return u}function R_(f,u,m){return f?.6*u*m:0}function k_(f,u){return Math.max(f?f.right-f.left:0,u?u.right-u.left:0)}function fw(f,u,m,C,D,Q){const H=R_(m,D,Q),X=k_(m,C)*Q;let ie=0;const de=D_(f)/2;for(let h=0;h<f.length-1;h++){const c=f[h],d=f[h+1],v=c.dist(d);if(ie+v>de){const S=(de-ie)/v,P=En.number(c.x,d.x,S),k=En.number(c.y,d.y,S),G=new Vo(P,k,d.angleTo(c),h);return G._round(),!H||hf(f,G,X,H,u)?G:void 0}ie+=v}}function pw(f,u,m,C,D,Q,H,X,ie){const de=R_(C,Q,H),h=k_(C,D),c=h*H,d=f[0].x===0||f[0].x===ie||f[0].y===0||f[0].y===ie;return u-c<u/4&&(u=c+u/4),O_(f,d?u/2*X%u:(h/2+2*Q)*H*X%u,u,de,m,c,d,!1,ie)}function O_(f,u,m,C,D,Q,H,X,ie){const de=Q/2,h=D_(f);let c=0,d=u-m,v=[];for(let S=0;S<f.length-1;S++){const P=f[S],k=f[S+1],G=P.dist(k),W=k.angleTo(P);for(;d+m<c+G;){d+=m;const ee=(d-c)/G,ae=En.number(P.x,k.x,ee),fe=En.number(P.y,k.y,ee);if(ae>=0&&ae<ie&&fe>=0&&fe<ie&&d-de>=0&&d+de<=h){const me=new Vo(ae,fe,W,S);me._round(),C&&!hf(f,me,Q,C,D)||v.push(me)}}c+=G}return X||v.length||H||(v=O_(f,c/2,m,C,D,Q,H,!0,ie)),v}Rr("Anchor",Vo);const Af=Qo;function U_(f,u,m,C){const D=[],Q=f.image,H=Q.pixelRatio,X=Q.paddedRect.w-2*Af,ie=Q.paddedRect.h-2*Af,de=f.right-f.left,h=f.bottom-f.top,c=Q.stretchX||[[0,X]],d=Q.stretchY||[[0,ie]],v=(Ke,ut)=>Ke+ut[1]-ut[0],S=c.reduce(v,0),P=d.reduce(v,0),k=X-S,G=ie-P;let W=0,ee=S,ae=0,fe=P,me=0,Ce=k,Me=0,Ue=G;if(Q.content&&C){const Ke=Q.content;W=Bu(c,0,Ke[0]),ae=Bu(d,0,Ke[1]),ee=Bu(c,Ke[0],Ke[2]),fe=Bu(d,Ke[1],Ke[3]),me=Ke[0]-W,Me=Ke[1]-ae,Ce=Ke[2]-Ke[0]-ee,Ue=Ke[3]-Ke[1]-fe}const $e=(Ke,ut,tt,it)=>{const yt=Rp(Ke.stretch-W,ee,de,f.left),St=kp(Ke.fixed-me,Ce,Ke.stretch,S),Jt=Rp(ut.stretch-ae,fe,h,f.top),Br=kp(ut.fixed-Me,Ue,ut.stretch,P),ar=Rp(tt.stretch-W,ee,de,f.left),pr=kp(tt.fixed-me,Ce,tt.stretch,S),_r=Rp(it.stretch-ae,fe,h,f.top),kr=kp(it.fixed-Me,Ue,it.stretch,P),lr=new I(yt,Jt),Yt=new I(ar,Jt),jr=new I(ar,_r),Vr=new I(yt,_r),_i=new I(St/H,Br/H),Vi=new I(pr/H,kr/H),$i=u*Math.PI/180;if($i){const Qn=Math.sin($i),xn=Math.cos($i),Rn=[xn,-Qn,Qn,xn];lr._matMult(Rn),Yt._matMult(Rn),Vr._matMult(Rn),jr._matMult(Rn)}const gn=Ke.stretch+Ke.fixed,cs=ut.stretch+ut.fixed;return{tl:lr,tr:Yt,bl:Vr,br:jr,tex:{x:Q.paddedRect.x+Af+gn,y:Q.paddedRect.y+Af+cs,w:tt.stretch+tt.fixed-gn,h:it.stretch+it.fixed-cs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:_i,pixelOffsetBR:Vi,minFontScaleX:Ce/H/de,minFontScaleY:Ue/H/h,isSDF:m}};if(C&&(Q.stretchX||Q.stretchY)){const Ke=N_(c,k,S),ut=N_(d,G,P);for(let tt=0;tt<Ke.length-1;tt++){const it=Ke[tt],yt=Ke[tt+1];for(let St=0;St<ut.length-1;St++)D.push($e(it,ut[St],yt,ut[St+1]))}}else D.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:X+1},{fixed:0,stretch:ie+1}));return D}function Bu(f,u,m){let C=0;for(const D of f)C+=Math.max(u,Math.min(m,D[1]))-Math.max(u,Math.min(m,D[0]));return C}function N_(f,u,m){const C=[{fixed:-Af,stretch:0}];for(const[D,Q]of f){const H=C[C.length-1];C.push({fixed:D-H.stretch,stretch:H.stretch}),C.push({fixed:D-H.stretch,stretch:H.stretch+(Q-D)})}return C.push({fixed:u+Af,stretch:m}),C}function Rp(f,u,m,C){return f/u*m+C}function kp(f,u,m,C){return f-u*m/C}class Op{constructor(u,m,C,D,Q,H,X,ie,de,h){if(this.boxStartIndex=u.length,de){let c=H.top,d=H.bottom;const v=H.collisionPadding;v&&(c-=v[1],d+=v[3]);let S=d-c;S>0&&(S=Math.max(10,S),this.circleDiameter=S)}else{let c=H.top*X-ie[0],d=H.bottom*X+ie[2],v=H.left*X-ie[3],S=H.right*X+ie[1];const P=H.collisionPadding;if(P&&(v-=P[0]*X,c-=P[1]*X,S+=P[2]*X,d+=P[3]*X),h){const k=new I(v,c),G=new I(S,c),W=new I(v,d),ee=new I(S,d),ae=h*Math.PI/180;k._rotate(ae),G._rotate(ae),W._rotate(ae),ee._rotate(ae),v=Math.min(k.x,G.x,W.x,ee.x),S=Math.max(k.x,G.x,W.x,ee.x),c=Math.min(k.y,G.y,W.y,ee.y),d=Math.max(k.y,G.y,W.y,ee.y)}u.emplaceBack(m.x,m.y,v,c,S,d,C,D,Q)}this.boxEndIndex=u.length}}class _5{constructor(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:v5;if(this.data=u,this.length=this.data.length,this.compare=m,this.length>0)for(let C=(this.length>>1)-1;C>=0;C--)this._down(C)}push(u){this.data.push(u),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const u=this.data[0],m=this.data.pop();return this.length--,this.length>0&&(this.data[0]=m,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:m,compare:C}=this,D=m[u];for(;u>0;){const Q=u-1>>1,H=m[Q];if(C(D,H)>=0)break;m[u]=H,u=Q}m[u]=D}_down(u){const{data:m,compare:C}=this,D=this.length>>1,Q=m[u];for(;u<D;){let H=1+(u<<1),X=m[H];const ie=H+1;if(ie<this.length&&C(m[ie],X)<0&&(H=ie,X=m[ie]),C(X,Q)>=0)break;m[u]=X,u=H}m[u]=Q}}function v5(f,u){return f<u?-1:f>u?1:0}function gw(f){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,C=1/0,D=1/0,Q=-1/0,H=-1/0;const X=f[0];for(let v=0;v<X.length;v++){const S=X[v];(!v||S.x<C)&&(C=S.x),(!v||S.y<D)&&(D=S.y),(!v||S.x>Q)&&(Q=S.x),(!v||S.y>H)&&(H=S.y)}const ie=Math.min(Q-C,H-D);let de=ie/2;const h=new _5([],df);if(ie===0)return new I(C,D);for(let v=C;v<Q;v+=ie)for(let S=D;S<H;S+=ie)h.push(new sd(v+de,S+de,de,f));let c=function(v){let S=0,P=0,k=0;const G=v[0];for(let W=0,ee=G.length,ae=ee-1;W<ee;ae=W++){const fe=G[W],me=G[ae],Ce=fe.x*me.y-me.x*fe.y;P+=(fe.x+me.x)*Ce,k+=(fe.y+me.y)*Ce,S+=3*Ce}return new sd(P/S,k/S,0,v)}(f),d=h.length;for(;h.length;){const v=h.pop();(v.d>c.d||!c.d)&&(c=v,m&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,d)),v.max-c.d<=u||(de=v.h/2,h.push(new sd(v.p.x-de,v.p.y-de,de,f)),h.push(new sd(v.p.x+de,v.p.y-de,de,f)),h.push(new sd(v.p.x-de,v.p.y+de,de,f)),h.push(new sd(v.p.x+de,v.p.y+de,de,f)),d+=4)}return m&&(console.log(`num probes: ${d}`),console.log(`best distance: ${c.d}`)),c.p}function df(f,u){return u.max-f.max}function sd(f,u,m,C){this.p=new I(f,u),this.h=m,this.d=function(D,Q){let H=!1,X=1/0;for(let ie=0;ie<Q.length;ie++){const de=Q[ie];for(let h=0,c=de.length,d=c-1;h<c;d=h++){const v=de[h],S=de[d];v.y>D.y!=S.y>D.y&&D.x<(S.x-v.x)*(D.y-v.y)/(S.y-v.y)+v.x&&(H=!H),X=Math.min(X,qu(D,v,S))}}return(H?1:-1)*Math.sqrt(X)}(this.p,C),this.max=this.d+this.h*Math.SQRT2}var wo;a.ap=void 0,(wo=a.ap||(a.ap={}))[wo.center=1]="center",wo[wo.left=2]="left",wo[wo.right=3]="right",wo[wo.top=4]="top",wo[wo.bottom=5]="bottom",wo[wo["top-left"]=6]="top-left",wo[wo["top-right"]=7]="top-right",wo[wo["bottom-left"]=8]="bottom-left",wo[wo["bottom-right"]=9]="bottom-right";const kh=7,ff=Number.POSITIVE_INFINITY;function Up(f,u){return u[1]!==ff?function(m,C,D){let Q=0,H=0;switch(C=Math.abs(C),D=Math.abs(D),m){case"top-right":case"top-left":case"top":H=D-kh;break;case"bottom-right":case"bottom-left":case"bottom":H=-D+kh}switch(m){case"top-right":case"bottom-right":case"right":Q=-C;break;case"top-left":case"bottom-left":case"left":Q=C}return[Q,H]}(f,u[0],u[1]):function(m,C){let D=0,Q=0;C<0&&(C=0);const H=C/Math.SQRT2;switch(m){case"top-right":case"top-left":Q=H-kh;break;case"bottom-right":case"bottom-left":Q=-H+kh;break;case"bottom":Q=-C+kh;break;case"top":Q=C-kh}switch(m){case"top-right":case"bottom-right":D=-H;break;case"top-left":case"bottom-left":D=H;break;case"left":D=C;break;case"right":D=-C}return[D,Q]}(f,u[0])}function Np(f,u,m){var C;const D=f.layout,Q=(C=D.get("text-variable-anchor-offset"))===null||C===void 0?void 0:C.evaluate(u,{},m);if(Q){const X=Q.values,ie=[];for(let de=0;de<X.length;de+=2){const h=ie[de]=X[de],c=X[de+1].map(d=>d*xo);h.startsWith("top")?c[1]-=kh:h.startsWith("bottom")&&(c[1]+=kh),ie[de+1]=c}return new Ui(ie)}const H=D.get("text-variable-anchor");if(H){let X;X=f._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[D.get("text-radial-offset").evaluate(u,{},m)*xo,ff]:D.get("text-offset").evaluate(u,{},m).map(de=>de*xo);const ie=[];for(const de of H)ie.push(de,Up(de,X));return new Ui(ie)}return null}function z_(f){switch(f){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function b5(f,u,m,C,D,Q,H,X,ie,de,h){let c=Q.textMaxSize.evaluate(u,{});c===void 0&&(c=H);const d=f.layers[0].layout,v=d.get("icon-offset").evaluate(u,{},h),S=yw(m.horizontal),P=H/24,k=f.tilePixelRatio*P,G=f.tilePixelRatio*c/24,W=f.tilePixelRatio*X,ee=f.tilePixelRatio*d.get("symbol-spacing"),ae=d.get("text-padding")*f.tilePixelRatio,fe=function(it,yt,St){let Jt=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const Br=it.get("icon-padding").evaluate(yt,{},St),ar=Br&&Br.values;return[ar[0]*Jt,ar[1]*Jt,ar[2]*Jt,ar[3]*Jt]}(d,u,h,f.tilePixelRatio),me=d.get("text-max-angle")/180*Math.PI,Ce=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point",Me=d.get("icon-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point",Ue=d.get("symbol-placement"),$e=ee/2,Ke=d.get("icon-text-fit");let ut;C&&Ke!=="none"&&(f.allowVerticalPlacement&&m.vertical&&(ut=y_(C,m.vertical,Ke,d.get("icon-text-fit-padding"),v,P)),S&&(C=y_(C,S,Ke,d.get("icon-text-fit-padding"),v,P)));const tt=(it,yt)=>{yt.x<0||yt.x>=yi||yt.y<0||yt.y>=yi||function(St,Jt,Br,ar,pr,_r,kr,lr,Yt,jr,Vr,_i,Vi,$i,gn,cs,Qn,xn,Rn,hn,Bi,Vn,An,rn,gs){const Ts=St.addToLineVertexArray(Jt,Br);let xs,ao,Is,kn,Si=0,Qs=0,fo=0,po=0,uc=-1,Ic=-1;const aa={};let th=hr("");if(St.allowVerticalPlacement&&ar.vertical){const za=lr.layout.get("text-rotate").evaluate(Bi,{},rn)+90;Is=new Op(Yt,Jt,jr,Vr,_i,ar.vertical,Vi,$i,gn,za),kr&&(kn=new Op(Yt,Jt,jr,Vr,_i,kr,Qn,xn,gn,za))}if(pr){const za=lr.layout.get("icon-rotate").evaluate(Bi,{}),Pc=lr.layout.get("icon-text-fit")!=="none",od=U_(pr,za,An,Pc),Cu=kr?U_(kr,za,An,Pc):void 0;ao=new Op(Yt,Jt,jr,Vr,_i,pr,Qn,xn,!1,za),Si=4*od.length;const Qa=St.iconSizeData;let Fc=null;Qa.kind==="source"?(Fc=[Zu*lr.layout.get("icon-size").evaluate(Bi,{})],Fc[0]>Dh&&Ye(`${St.layerIds[0]}: Value for "icon-size" is >= ${af}. Reduce your "icon-size".`)):Qa.kind==="composite"&&(Fc=[Zu*Vn.compositeIconSizes[0].evaluate(Bi,{},rn),Zu*Vn.compositeIconSizes[1].evaluate(Bi,{},rn)],(Fc[0]>Dh||Fc[1]>Dh)&&Ye(`${St.layerIds[0]}: Value for "icon-size" is >= ${af}. Reduce your "icon-size".`)),St.addSymbols(St.icon,od,Fc,hn,Rn,Bi,a.ah.none,Jt,Ts.lineStartIndex,Ts.lineLength,-1,rn),uc=St.icon.placedSymbolArray.length-1,Cu&&(Qs=4*Cu.length,St.addSymbols(St.icon,Cu,Fc,hn,Rn,Bi,a.ah.vertical,Jt,Ts.lineStartIndex,Ts.lineLength,-1,rn),Ic=St.icon.placedSymbolArray.length-1)}const Lc=Object.keys(ar.horizontal);for(const za of Lc){const Pc=ar.horizontal[za];if(!xs){th=hr(Pc.text);const Cu=lr.layout.get("text-rotate").evaluate(Bi,{},rn);xs=new Op(Yt,Jt,jr,Vr,_i,Pc,Vi,$i,gn,Cu)}const od=Pc.positionedLines.length===1;if(fo+=mw(St,Jt,Pc,_r,lr,gn,Bi,cs,Ts,ar.vertical?a.ah.horizontal:a.ah.horizontalOnly,od?Lc:[za],aa,uc,Vn,rn),od)break}ar.vertical&&(po+=mw(St,Jt,ar.vertical,_r,lr,gn,Bi,cs,Ts,a.ah.vertical,["vertical"],aa,Ic,Vn,rn));const Mc=xs?xs.boxStartIndex:St.collisionBoxArray.length,Tl=xs?xs.boxEndIndex:St.collisionBoxArray.length,Oh=Is?Is.boxStartIndex:St.collisionBoxArray.length,qp=Is?Is.boxEndIndex:St.collisionBoxArray.length,bw=ao?ao.boxStartIndex:St.collisionBoxArray.length,V_=ao?ao.boxEndIndex:St.collisionBoxArray.length,H_=kn?kn.boxStartIndex:St.collisionBoxArray.length,Uh=kn?kn.boxEndIndex:St.collisionBoxArray.length;let eu=-1;const $p=(za,Pc)=>za&&za.circleDiameter?Math.max(za.circleDiameter,Pc):Pc;eu=$p(xs,eu),eu=$p(Is,eu),eu=$p(ao,eu),eu=$p(kn,eu);const xw=eu>-1?1:0;xw&&(eu*=gs/xo),St.glyphOffsetArray.length>=id.MAX_GLYPHS&&Ye("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Bi.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,Bi.sortKey);const x5=Np(lr,Bi,rn),[w5,B5]=function(za,Pc){const od=za.length,Cu=Pc==null?void 0:Pc.values;if((Cu==null?void 0:Cu.length)>0)for(let Qa=0;Qa<Cu.length;Qa+=2){const Fc=Cu[Qa+1];za.emplaceBack(a.ap[Cu[Qa]],Fc[0],Fc[1])}return[od,za.length]}(St.textAnchorOffsets,x5);St.symbolInstances.emplaceBack(Jt.x,Jt.y,aa.right>=0?aa.right:-1,aa.center>=0?aa.center:-1,aa.left>=0?aa.left:-1,aa.vertical||-1,uc,Ic,th,Mc,Tl,Oh,qp,bw,V_,H_,Uh,jr,fo,po,Si,Qs,xw,0,Vi,eu,w5,B5)}(f,yt,it,m,C,D,ut,f.layers[0],f.collisionBoxArray,u.index,u.sourceLayerIndex,f.index,k,[ae,ae,ae,ae],Ce,ie,W,fe,Me,v,u,Q,de,h,H)};if(Ue==="line")for(const it of F_(u.geometry,0,0,yi,yi)){const yt=pw(it,ee,me,m.vertical||S,C,24,G,f.overscaling,yi);for(const St of yt)S&&pf(f,S.text,$e,St)||tt(it,St)}else if(Ue==="line-center"){for(const it of u.geometry)if(it.length>1){const yt=fw(it,me,m.vertical||S,C,24,G);yt&&tt(it,yt)}}else if(u.type==="Polygon")for(const it of Lm(u.geometry,0)){const yt=gw(it,16);tt(it[0],new Vo(yt.x,yt.y,0))}else if(u.type==="LineString")for(const it of u.geometry)tt(it,new Vo(it[0].x,it[0].y,0));else if(u.type==="Point")for(const it of u.geometry)for(const yt of it)tt([yt],new Vo(yt.x,yt.y,0))}function mw(f,u,m,C,D,Q,H,X,ie,de,h,c,d,v,S){const P=function(W,ee,ae,fe,me,Ce,Me,Ue){const $e=fe.layout.get("text-rotate").evaluate(Ce,{})*Math.PI/180,Ke=[];for(const ut of ee.positionedLines)for(const tt of ut.positionedGlyphs){if(!tt.rect)continue;const it=tt.rect||{};let yt=nw+1,St=!0,Jt=1,Br=0;const ar=(me||Ue)&&tt.vertical,pr=tt.metrics.advance*tt.scale/2;if(Ue&&ee.verticalizable&&(Br=ut.lineOffset/2-(tt.imageName?-(xo-tt.metrics.width*tt.scale)/2:(tt.scale-1)*xo)),tt.imageName){const hn=Me[tt.imageName];St=hn.sdf,Jt=hn.pixelRatio,yt=Qo/Jt}const _r=me?[tt.x+pr,tt.y]:[0,0];let kr=me?[0,0]:[tt.x+pr+ae[0],tt.y+ae[1]-Br],lr=[0,0];ar&&(lr=kr,kr=[0,0]);const Yt=tt.metrics.isDoubleResolution?2:1,jr=(tt.metrics.left-yt)*tt.scale-pr+kr[0],Vr=(-tt.metrics.top-yt)*tt.scale+kr[1],_i=jr+it.w/Yt*tt.scale/Jt,Vi=Vr+it.h/Yt*tt.scale/Jt,$i=new I(jr,Vr),gn=new I(_i,Vr),cs=new I(jr,Vi),Qn=new I(_i,Vi);if(ar){const hn=new I(-pr,pr-Sp),Bi=-Math.PI/2,Vn=xo/2-pr,An=new I(5-Sp-Vn,-(tt.imageName?Vn:0)),rn=new I(...lr);$i._rotateAround(Bi,hn)._add(An)._add(rn),gn._rotateAround(Bi,hn)._add(An)._add(rn),cs._rotateAround(Bi,hn)._add(An)._add(rn),Qn._rotateAround(Bi,hn)._add(An)._add(rn)}if($e){const hn=Math.sin($e),Bi=Math.cos($e),Vn=[Bi,-hn,hn,Bi];$i._matMult(Vn),gn._matMult(Vn),cs._matMult(Vn),Qn._matMult(Vn)}const xn=new I(0,0),Rn=new I(0,0);Ke.push({tl:$i,tr:gn,bl:cs,br:Qn,tex:it,writingMode:ee.writingMode,glyphOffset:_r,sectionIndex:tt.sectionIndex,isSDF:St,pixelOffsetTL:xn,pixelOffsetBR:Rn,minFontScaleX:0,minFontScaleY:0})}return Ke}(0,m,X,D,Q,H,C,f.allowVerticalPlacement),k=f.textSizeData;let G=null;k.kind==="source"?(G=[Zu*D.layout.get("text-size").evaluate(H,{})],G[0]>Dh&&Ye(`${f.layerIds[0]}: Value for "text-size" is >= ${af}. Reduce your "text-size".`)):k.kind==="composite"&&(G=[Zu*v.compositeTextSizes[0].evaluate(H,{},S),Zu*v.compositeTextSizes[1].evaluate(H,{},S)],(G[0]>Dh||G[1]>Dh)&&Ye(`${f.layerIds[0]}: Value for "text-size" is >= ${af}. Reduce your "text-size".`)),f.addSymbols(f.text,P,G,X,Q,H,de,u,ie.lineStartIndex,ie.lineLength,d,S);for(const W of h)c[W]=f.text.placedSymbolArray.length-1;return 4*P.length}function yw(f){for(const u in f)return f[u];return null}function pf(f,u,m,C){const D=f.compareText;if(u in D){const Q=D[u];for(let H=Q.length-1;H>=0;H--)if(C.dist(Q[H])<m)return!0}else D[u]=[];return D[u].push(C),!1}const oa=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class eh{static from(u){if(!(u instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[m,C]=new Uint8Array(u,0,2);if(m!==219)throw new Error("Data does not appear to be in a KDBush format.");const D=C>>4;if(D!==1)throw new Error(`Got v${D} data when expected v1.`);const Q=oa[15&C];if(!Q)throw new Error("Unrecognized array type.");const[H]=new Uint16Array(u,2,1),[X]=new Uint32Array(u,4,1);return new eh(X,H,Q,u)}constructor(u){let m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,C=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,D=arguments.length>3?arguments[3]:void 0;if(isNaN(u)||u<0)throw new Error(`Unpexpected numItems value: ${u}.`);this.numItems=+u,this.nodeSize=Math.min(Math.max(+m,2),65535),this.ArrayType=C,this.IndexArrayType=u<65536?Uint16Array:Uint32Array;const Q=oa.indexOf(this.ArrayType),H=2*u*this.ArrayType.BYTES_PER_ELEMENT,X=u*this.IndexArrayType.BYTES_PER_ELEMENT,ie=(8-X%8)%8;if(Q<0)throw new Error(`Unexpected typed array class: ${C}.`);D&&D instanceof ArrayBuffer?(this.data=D,this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+X+ie,2*u),this._pos=2*u,this._finished=!0):(this.data=new ArrayBuffer(8+H+X+ie),this.ids=new this.IndexArrayType(this.data,8,u),this.coords=new this.ArrayType(this.data,8+X+ie,2*u),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+Q]),new Uint16Array(this.data,2,1)[0]=m,new Uint32Array(this.data,4,1)[0]=u)}add(u,m){const C=this._pos>>1;return this.ids[C]=C,this.coords[this._pos++]=u,this.coords[this._pos++]=m,C}finish(){const u=this._pos>>1;if(u!==this.numItems)throw new Error(`Added ${u} items when expected ${this.numItems}.`);return zp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(u,m,C,D){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:Q,coords:H,nodeSize:X}=this,ie=[0,Q.length-1,0],de=[];for(;ie.length;){const h=ie.pop()||0,c=ie.pop()||0,d=ie.pop()||0;if(c-d<=X){for(let k=d;k<=c;k++){const G=H[2*k],W=H[2*k+1];G>=u&&G<=C&&W>=m&&W<=D&&de.push(Q[k])}continue}const v=d+c>>1,S=H[2*v],P=H[2*v+1];S>=u&&S<=C&&P>=m&&P<=D&&de.push(Q[v]),(h===0?u<=S:m<=P)&&(ie.push(d),ie.push(v-1),ie.push(1-h)),(h===0?C>=S:D>=P)&&(ie.push(v+1),ie.push(c),ie.push(1-h))}return de}within(u,m,C){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:D,coords:Q,nodeSize:H}=this,X=[0,D.length-1,0],ie=[],de=C*C;for(;X.length;){const h=X.pop()||0,c=X.pop()||0,d=X.pop()||0;if(c-d<=H){for(let k=d;k<=c;k++)_w(Q[2*k],Q[2*k+1],u,m)<=de&&ie.push(D[k]);continue}const v=d+c>>1,S=Q[2*v],P=Q[2*v+1];_w(S,P,u,m)<=de&&ie.push(D[v]),(h===0?u-C<=S:m-C<=P)&&(X.push(d),X.push(v-1),X.push(1-h)),(h===0?u+C>=S:m+C>=P)&&(X.push(v+1),X.push(c),X.push(1-h))}return ie}}function zp(f,u,m,C,D,Q){if(D-C<=m)return;const H=C+D>>1;Q_(f,u,H,C,D,Q),zp(f,u,m,C,H-1,1-Q),zp(f,u,m,H+1,D,1-Q)}function Q_(f,u,m,C,D,Q){for(;D>C;){if(D-C>600){const de=D-C+1,h=m-C+1,c=Math.log(de),d=.5*Math.exp(2*c/3),v=.5*Math.sqrt(c*d*(de-d)/de)*(h-de/2<0?-1:1);Q_(f,u,m,Math.max(C,Math.floor(m-h*d/de+v)),Math.min(D,Math.floor(m+(de-h)*d/de+v)),Q)}const H=u[2*m+Q];let X=C,ie=D;for(gf(f,u,C,m),u[2*D+Q]>H&&gf(f,u,C,D);X<ie;){for(gf(f,u,X,ie),X++,ie--;u[2*X+Q]<H;)X++;for(;u[2*ie+Q]>H;)ie--}u[2*C+Q]===H?gf(f,u,C,ie):(ie++,gf(f,u,ie,D)),ie<=m&&(C=ie+1),m<=ie&&(D=ie-1)}}function gf(f,u,m,C){Qp(f,m,C),Qp(u,2*m,2*C),Qp(u,2*m+1,2*C+1)}function Qp(f,u,m){const C=f[u];f[u]=f[m],f[m]=C}function _w(f,u,m,C){const D=f-m,Q=u-C;return D*D+Q*Q}var qm;a.bd=void 0,(qm=a.bd||(a.bd={})).create="create",qm.load="load",qm.fullLoad="fullLoad";let Vp=null,Hp=[];const $m=1e3/60,Gp="loadTime",jp="fullLoadTime",vw={mark(f){performance.mark(f)},frame(f){const u=f;Vp!=null&&Hp.push(u-Vp),Vp=u},clearMetrics(){Vp=null,Hp=[],performance.clearMeasures(Gp),performance.clearMeasures(jp);for(const f in a.bd)performance.clearMarks(a.bd[f])},getPerformanceMetrics(){performance.measure(Gp,a.bd.create,a.bd.load),performance.measure(jp,a.bd.create,a.bd.fullLoad);const f=performance.getEntriesByName(Gp)[0].duration,u=performance.getEntriesByName(jp)[0].duration,m=Hp.length,C=1/(Hp.reduce((Q,H)=>Q+H,0)/m/1e3),D=Hp.filter(Q=>Q>$m).reduce((Q,H)=>Q+(H-$m)/$m,0);return{loadTime:f,fullLoadTime:u,fps:C,percentDroppedFrames:D/(m+D)*100,totalFrames:m}}};a.$=dt,a.A=lc,a.B=function(f){if(Pt==null){const u=f.navigator?f.navigator.userAgent:null;Pt=!!f.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Pt},a.C=class{constructor(f,u){this.target=f,this.mapId=u,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new cw(()=>this.process()),this.subscription=function(m,C,D,Q){return m.addEventListener(C,D,!1),{unsubscribe:()=>{m.removeEventListener(C,D,!1)}}}(this.target,"message",m=>this.receive(m)),this.globalScope=Et(self)?f:window}registerMessageHandler(f,u){this.messageHandlers[f]=u}sendAsync(f,u){return new Promise((m,C)=>{const D=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[D]={resolve:m,reject:C},u&&u.signal.addEventListener("abort",()=>{delete this.resolveRejects[D];const X={id:D,type:"<cancel>",origin:location.origin,targetMapId:f.targetMapId,sourceMapId:this.mapId};this.target.postMessage(X)},{once:!0});const Q=[],H=Object.assign(Object.assign({},f),{id:D,sourceMapId:this.mapId,origin:location.origin,data:_l(f.data,Q)});this.target.postMessage(H,{transfer:Q})})}receive(f){const u=f.data,m=u.id;if(!(u.origin!=="file://"&&location.origin!=="file://"&&u.origin!==location.origin||u.targetMapId&&this.mapId!==u.targetMapId)){if(u.type==="<cancel>"){delete this.tasks[m];const C=this.abortControllers[m];return delete this.abortControllers[m],void(C&&C.abort())}if(Et(self)||u.mustQueue)return this.tasks[m]=u,this.taskQueue.push(m),void this.invoker.trigger();this.processTask(m,u)}}process(){if(this.taskQueue.length===0)return;const f=this.taskQueue.shift(),u=this.tasks[f];delete this.tasks[f],this.taskQueue.length>0&&this.invoker.trigger(),u&&this.processTask(f,u)}processTask(f,u){return s(this,void 0,void 0,function*(){if(u.type==="<response>"){const D=this.resolveRejects[f];return delete this.resolveRejects[f],D?void(u.error?D.reject(Mr(u.error)):D.resolve(Mr(u.data))):void 0}if(!this.messageHandlers[u.type])return void this.completeTask(f,new Error(`Could not find a registered handler for ${u.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const m=Mr(u.data),C=new AbortController;this.abortControllers[f]=C;try{const D=yield this.messageHandlers[u.type](u.sourceMapId,m,C);this.completeTask(f,null,D)}catch(D){this.completeTask(f,D)}})}completeTask(f,u,m){const C=[];delete this.abortControllers[f];const D={id:f,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:u?_l(u):null,data:_l(m,C)};this.target.postMessage(D,{transfer:C})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},a.D=Sr,a.E=lt,a.F=function(){var f=new lc(16);return lc!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0),f[0]=1,f[5]=1,f[10]=1,f[15]=1,f},a.G=Bt,a.H=function(f,u,m){var C,D,Q,H,X,ie,de,h,c,d,v,S,P=m[0],k=m[1],G=m[2];return u===f?(f[12]=u[0]*P+u[4]*k+u[8]*G+u[12],f[13]=u[1]*P+u[5]*k+u[9]*G+u[13],f[14]=u[2]*P+u[6]*k+u[10]*G+u[14],f[15]=u[3]*P+u[7]*k+u[11]*G+u[15]):(D=u[1],Q=u[2],H=u[3],X=u[4],ie=u[5],de=u[6],h=u[7],c=u[8],d=u[9],v=u[10],S=u[11],f[0]=C=u[0],f[1]=D,f[2]=Q,f[3]=H,f[4]=X,f[5]=ie,f[6]=de,f[7]=h,f[8]=c,f[9]=d,f[10]=v,f[11]=S,f[12]=C*P+X*k+c*G+u[12],f[13]=D*P+ie*k+d*G+u[13],f[14]=Q*P+de*k+v*G+u[14],f[15]=H*P+h*k+S*G+u[15]),f},a.I=km,a.J=function(f,u,m){var C=m[0],D=m[1],Q=m[2];return f[0]=u[0]*C,f[1]=u[1]*C,f[2]=u[2]*C,f[3]=u[3]*C,f[4]=u[4]*D,f[5]=u[5]*D,f[6]=u[6]*D,f[7]=u[7]*D,f[8]=u[8]*Q,f[9]=u[9]*Q,f[10]=u[10]*Q,f[11]=u[11]*Q,f[12]=u[12],f[13]=u[13],f[14]=u[14],f[15]=u[15],f},a.K=Sh,a.L=function(f,u){const m={};for(let C=0;C<u.length;C++){const D=u[C];D in f&&(m[D]=f[D])}return m},a.M=Rh,a.N=C_,a.O=Aw,a.P=I,a.Q=cc,a.R=Cl,a.S=ce,a.T=vl,a.U=pe,a.V=Ft,a.W=yi,a.X=Xn,a.Y=Hm,a.Z=class extends Ks{},a._=s,a.a=pt,a.a$=function(f,u,m){return f[0]=u[0]*m[0],f[1]=u[1]*m[1],f[2]=u[2]*m[2],f[3]=u[3]*m[3],f},a.a0=Yu,a.a1=zt,a.a2=f=>{const u=window.document.createElement("video");return u.muted=!0,new Promise(m=>{u.onloadstart=()=>{m(u)};for(const C of f){const D=window.document.createElement("source");nr(C)||(u.crossOrigin="Anonymous"),D.src=C,u.appendChild(D)}})},a.a3=function(){return Ne++},a.a4=J,a.a5=id,a.a6=Xl,a.a7=so,a.a8=vn,a.a9=L_,a.aA=ke,a.aB=function(f,u){if(!f)return[{command:"setStyle",args:[u]}];let m=[];try{if(!ht(f.version,u.version))return[{command:"setStyle",args:[u]}];ht(f.center,u.center)||m.push({command:"setCenter",args:[u.center]}),ht(f.zoom,u.zoom)||m.push({command:"setZoom",args:[u.zoom]}),ht(f.bearing,u.bearing)||m.push({command:"setBearing",args:[u.bearing]}),ht(f.pitch,u.pitch)||m.push({command:"setPitch",args:[u.pitch]}),ht(f.sprite,u.sprite)||m.push({command:"setSprite",args:[u.sprite]}),ht(f.glyphs,u.glyphs)||m.push({command:"setGlyphs",args:[u.glyphs]}),ht(f.transition,u.transition)||m.push({command:"setTransition",args:[u.transition]}),ht(f.light,u.light)||m.push({command:"setLight",args:[u.light]}),ht(f.terrain,u.terrain)||m.push({command:"setTerrain",args:[u.terrain]}),ht(f.sky,u.sky)||m.push({command:"setSky",args:[u.sky]});const C={},D=[];(function(H,X,ie,de){let h;for(h in X=X||{},H=H||{})Object.prototype.hasOwnProperty.call(H,h)&&(Object.prototype.hasOwnProperty.call(X,h)||mr(h,ie,de));for(h in X)Object.prototype.hasOwnProperty.call(X,h)&&(Object.prototype.hasOwnProperty.call(H,h)?ht(H[h],X[h])||(H[h].type==="geojson"&&X[h].type==="geojson"&&Wr(H,X,h)?$t(ie,{command:"setGeoJSONSourceData",args:[h,X[h].data]}):ur(h,X,ie,de)):or(h,X,ie))})(f.sources,u.sources,D,C);const Q=[];f.layers&&f.layers.forEach(H=>{"source"in H&&C[H.source]?m.push({command:"removeLayer",args:[H.id]}):Q.push(H)}),m=m.concat(D),function(H,X,ie){X=X||[];const de=(H=H||[]).map(gi),h=X.map(gi),c=H.reduce(Pi,{}),d=X.reduce(Pi,{}),v=de.slice(),S=Object.create(null);let P,k,G,W,ee;for(let ae=0,fe=0;ae<de.length;ae++)P=de[ae],Object.prototype.hasOwnProperty.call(d,P)?fe++:($t(ie,{command:"removeLayer",args:[P]}),v.splice(v.indexOf(P,fe),1));for(let ae=0,fe=0;ae<h.length;ae++)P=h[h.length-1-ae],v[v.length-1-ae]!==P&&(Object.prototype.hasOwnProperty.call(c,P)?($t(ie,{command:"removeLayer",args:[P]}),v.splice(v.lastIndexOf(P,v.length-fe),1)):fe++,W=v[v.length-ae],$t(ie,{command:"addLayer",args:[d[P],W]}),v.splice(v.length-ae,0,P),S[P]=!0);for(let ae=0;ae<h.length;ae++)if(P=h[ae],k=c[P],G=d[P],!S[P]&&!ht(k,G))if(ht(k.source,G.source)&&ht(k["source-layer"],G["source-layer"])&&ht(k.type,G.type)){for(ee in ri(k.layout,G.layout,ie,P,null,"setLayoutProperty"),ri(k.paint,G.paint,ie,P,null,"setPaintProperty"),ht(k.filter,G.filter)||$t(ie,{command:"setFilter",args:[P,G.filter]}),ht(k.minzoom,G.minzoom)&&ht(k.maxzoom,G.maxzoom)||$t(ie,{command:"setLayerZoomRange",args:[P,G.minzoom,G.maxzoom]}),k)Object.prototype.hasOwnProperty.call(k,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?ri(k[ee],G[ee],ie,P,ee.slice(6),"setPaintProperty"):ht(k[ee],G[ee])||$t(ie,{command:"setLayerProperty",args:[P,ee,G[ee]]}));for(ee in G)Object.prototype.hasOwnProperty.call(G,ee)&&!Object.prototype.hasOwnProperty.call(k,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?ri(k[ee],G[ee],ie,P,ee.slice(6),"setPaintProperty"):ht(k[ee],G[ee])||$t(ie,{command:"setLayerProperty",args:[P,ee,G[ee]]}))}else $t(ie,{command:"removeLayer",args:[P]}),W=v[v.lastIndexOf(P)+1],$t(ie,{command:"addLayer",args:[G,W]})}(Q,u.layers,m)}catch(C){console.warn("Unable to compute style diff:",C),m=[{command:"setStyle",args:[u]}]}return m},a.aC=function(f){const u=[],m=f.id;return m===void 0&&u.push({message:`layers.${m}: missing required property "id"`}),f.render===void 0&&u.push({message:`layers.${m}: missing required method "render"`}),f.renderingMode&&f.renderingMode!=="2d"&&f.renderingMode!=="3d"&&u.push({message:`layers.${m}: property "renderingMode" must be either "2d" or "3d"`}),u},a.aD=function f(u,m){if(Array.isArray(u)){if(!Array.isArray(m)||u.length!==m.length)return!1;for(let C=0;C<u.length;C++)if(!f(u[C],m[C]))return!1;return!0}if(typeof u=="object"&&u!==null&&m!==null){if(typeof m!="object"||Object.keys(u).length!==Object.keys(m).length)return!1;for(const C in u)if(!f(u[C],m[C]))return!1;return!0}return u===m},a.aE=at,a.aF=nt,a.aG=class extends ki{constructor(f,u){super(f,u),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}},a.aH=wi,a.aI=class extends ki{constructor(f,u){super(f,u),this.current=Zn}set(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let u=1;u<16;u++)if(f[u]!==this.current[u]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}},a.aJ=Ki,a.aK=class extends ki{constructor(f,u){super(f,u),this.current=[0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))}},a.aL=class extends ki{constructor(f,u){super(f,u),this.current=[0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))}},a.aM=xi,a.aN=function(f,u,m,C,D,Q,H){var X=1/(u-m),ie=1/(C-D),de=1/(Q-H);return f[0]=-2*X,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*ie,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*de,f[11]=0,f[12]=(u+m)*X,f[13]=(D+C)*ie,f[14]=(H+Q)*de,f[15]=1,f},a.aO=mi,a.aP=Th,a.aQ=class extends sc{},a.aR=$x,a.aS=class extends No{},a.aT=function(f){return f<=1?1:Math.pow(2,Math.ceil(Math.log(f)/Math.LN2))},a.aU=Kd,a.aV=V,a.aW=class extends M{},a.aX=Oe,a.aY=function(f,u){return f[0]===u[0]&&f[1]===u[1]&&f[2]===u[2]&&f[3]===u[3]&&f[4]===u[4]&&f[5]===u[5]&&f[6]===u[6]&&f[7]===u[7]&&f[8]===u[8]&&f[9]===u[9]&&f[10]===u[10]&&f[11]===u[11]&&f[12]===u[12]&&f[13]===u[13]&&f[14]===u[14]&&f[15]===u[15]},a.aZ=function(f,u){var m=f[0],C=f[1],D=f[2],Q=f[3],H=f[4],X=f[5],ie=f[6],de=f[7],h=f[8],c=f[9],d=f[10],v=f[11],S=f[12],P=f[13],k=f[14],G=f[15],W=u[0],ee=u[1],ae=u[2],fe=u[3],me=u[4],Ce=u[5],Me=u[6],Ue=u[7],$e=u[8],Ke=u[9],ut=u[10],tt=u[11],it=u[12],yt=u[13],St=u[14],Jt=u[15];return Math.abs(m-W)<=na*Math.max(1,Math.abs(m),Math.abs(W))&&Math.abs(C-ee)<=na*Math.max(1,Math.abs(C),Math.abs(ee))&&Math.abs(D-ae)<=na*Math.max(1,Math.abs(D),Math.abs(ae))&&Math.abs(Q-fe)<=na*Math.max(1,Math.abs(Q),Math.abs(fe))&&Math.abs(H-me)<=na*Math.max(1,Math.abs(H),Math.abs(me))&&Math.abs(X-Ce)<=na*Math.max(1,Math.abs(X),Math.abs(Ce))&&Math.abs(ie-Me)<=na*Math.max(1,Math.abs(ie),Math.abs(Me))&&Math.abs(de-Ue)<=na*Math.max(1,Math.abs(de),Math.abs(Ue))&&Math.abs(h-$e)<=na*Math.max(1,Math.abs(h),Math.abs($e))&&Math.abs(c-Ke)<=na*Math.max(1,Math.abs(c),Math.abs(Ke))&&Math.abs(d-ut)<=na*Math.max(1,Math.abs(d),Math.abs(ut))&&Math.abs(v-tt)<=na*Math.max(1,Math.abs(v),Math.abs(tt))&&Math.abs(S-it)<=na*Math.max(1,Math.abs(S),Math.abs(it))&&Math.abs(P-yt)<=na*Math.max(1,Math.abs(P),Math.abs(yt))&&Math.abs(k-St)<=na*Math.max(1,Math.abs(k),Math.abs(St))&&Math.abs(G-Jt)<=na*Math.max(1,Math.abs(G),Math.abs(Jt))},a.a_=function(f,u){return f[0]=u[0],f[1]=u[1],f[2]=u[2],f[3]=u[3],f[4]=u[4],f[5]=u[5],f[6]=u[6],f[7]=u[7],f[8]=u[8],f[9]=u[9],f[10]=u[10],f[11]=u[11],f[12]=u[12],f[13]=u[13],f[14]=u[14],f[15]=u[15],f},a.aa=function(f){const u={};if(f.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(m,C,D,Q)=>{const H=D||Q;return u[C]=!H||H.toLowerCase(),""}),u["max-age"]){const m=parseInt(u["max-age"],10);isNaN(m)?delete u["max-age"]:u["max-age"]=m}return u},a.ab=function(f,u){const m=[];for(const C in f)C in u||m.push(C);return m},a.ac=qe,a.ad=function(f,u,m){var C=Math.sin(m),D=Math.cos(m),Q=u[0],H=u[1],X=u[2],ie=u[3],de=u[4],h=u[5],c=u[6],d=u[7];return u!==f&&(f[8]=u[8],f[9]=u[9],f[10]=u[10],f[11]=u[11],f[12]=u[12],f[13]=u[13],f[14]=u[14],f[15]=u[15]),f[0]=Q*D+de*C,f[1]=H*D+h*C,f[2]=X*D+c*C,f[3]=ie*D+d*C,f[4]=de*D-Q*C,f[5]=h*D-H*C,f[6]=c*D-X*C,f[7]=d*D-ie*C,f},a.ae=function(f){var u=new lc(16);return u[0]=f[0],u[1]=f[1],u[2]=f[2],u[3]=f[3],u[4]=f[4],u[5]=f[5],u[6]=f[6],u[7]=f[7],u[8]=f[8],u[9]=f[9],u[10]=f[10],u[11]=f[11],u[12]=f[12],u[13]=f[13],u[14]=f[14],u[15]=f[15],u},a.af=Ih,a.ag=function(f,u){let m=0,C=0;if(f.kind==="constant")C=f.layoutSize;else if(f.kind!=="source"){const{interpolationType:D,minZoom:Q,maxZoom:H}=f,X=D?qe(ds.interpolationFactor(D,u,Q,H),0,1):0;f.kind==="camera"?C=En.number(f.minSize,f.maxSize,X):m=X}return{uSizeT:m,uSize:C}},a.ai=function(f,u,m){let{uSize:C,uSizeT:D}=u,{lowerSize:Q,upperSize:H}=m;return f.kind==="source"?Q/Zu:f.kind==="composite"?En.number(Q/Zu,H/Zu,D):C},a.aj=Qm,a.ak=function(f,u,m,C){const D=u.y-f.y,Q=u.x-f.x,H=C.y-m.y,X=C.x-m.x,ie=H*Q-X*D;if(ie===0)return null;const de=(X*(f.y-m.y)-H*(f.x-m.x))/ie;return new I(f.x+de*Q,f.y+de*D)},a.al=F_,a.am=ac,a.an=dA,a.ao=xo,a.aq=Mp,a.ar=function(f,u){var m=u[0],C=u[1],D=u[2],Q=u[3],H=u[4],X=u[5],ie=u[6],de=u[7],h=u[8],c=u[9],d=u[10],v=u[11],S=u[12],P=u[13],k=u[14],G=u[15],W=m*X-C*H,ee=m*ie-D*H,ae=m*de-Q*H,fe=C*ie-D*X,me=C*de-Q*X,Ce=D*de-Q*ie,Me=h*P-c*S,Ue=h*k-d*S,$e=h*G-v*S,Ke=c*k-d*P,ut=c*G-v*P,tt=d*G-v*k,it=W*tt-ee*ut+ae*Ke+fe*$e-me*Ue+Ce*Me;return it?(f[0]=(X*tt-ie*ut+de*Ke)*(it=1/it),f[1]=(D*ut-C*tt-Q*Ke)*it,f[2]=(P*Ce-k*me+G*fe)*it,f[3]=(d*me-c*Ce-v*fe)*it,f[4]=(ie*$e-H*tt-de*Ue)*it,f[5]=(m*tt-D*$e+Q*Ue)*it,f[6]=(k*ae-S*Ce-G*ee)*it,f[7]=(h*Ce-d*ae+v*ee)*it,f[8]=(H*ut-X*$e+de*Me)*it,f[9]=(C*$e-m*ut-Q*Me)*it,f[10]=(S*me-P*ae+G*W)*it,f[11]=(c*ae-h*me-v*W)*it,f[12]=(X*Ue-H*Ke-ie*Me)*it,f[13]=(m*Ke-C*Ue+D*Me)*it,f[14]=(P*ee-S*fe-k*W)*it,f[15]=(h*fe-c*ee+d*W)*it,f):null},a.as=z_,a.at=of,a.au=eh,a.av=function(){const f={},u=wt.$version;for(const m in wt.$root){const C=wt.$root[m];if(C.required){let D=null;D=m==="version"?u:C.type==="array"?[]:{},D!=null&&(f[m]=D)}}return f},a.aw=Cc,a.ax=Mt,a.ay=function(f){f=f.slice();const u=Object.create(null);for(let m=0;m<f.length;m++)u[f[m].id]=f[m];for(let m=0;m<f.length;m++)"ref"in f[m]&&(f[m]=tr(f[m],u[f[m].ref]));return f},a.az=function(f){if(f.type==="custom")return new B_(f);switch(f.type){case"background":return new w_(f);case"circle":return new fA(f);case"fill":return new e5(f);case"fill-extrusion":return new a5(f);case"heatmap":return new Lh(f);case"hillshade":return new hp(f);case"line":return new A5(f);case"raster":return new lw(f);case"symbol":return new lf(f)}},a.b=bt,a.b0=function(f,u){return f[0]*u[0]+f[1]*u[1]+f[2]*u[2]+f[3]*u[3]},a.b1=je,a.b2=S_,a.b3=dw,a.b4=function(f,u,m,C,D){var Q,H=1/Math.tan(u/2);return f[0]=H/m,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=H,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,D!=null&&D!==1/0?(f[10]=(D+C)*(Q=1/(C-D)),f[14]=2*D*C*Q):(f[10]=-1,f[14]=-2*C),f},a.b5=function(f,u,m){var C=Math.sin(m),D=Math.cos(m),Q=u[4],H=u[5],X=u[6],ie=u[7],de=u[8],h=u[9],c=u[10],d=u[11];return u!==f&&(f[0]=u[0],f[1]=u[1],f[2]=u[2],f[3]=u[3],f[12]=u[12],f[13]=u[13],f[14]=u[14],f[15]=u[15]),f[4]=Q*D+de*C,f[5]=H*D+h*C,f[6]=X*D+c*C,f[7]=ie*D+d*C,f[8]=de*D-Q*C,f[9]=h*D-H*C,f[10]=c*D-X*C,f[11]=d*D-ie*C,f},a.b6=be,a.b7=Te,a.b8=function(f){return f*Math.PI/180},a.b9=function(f,u){return f[0]=u[0],f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=u[1],f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=u[2],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f},a.bA=ol,a.ba=class extends sn{},a.bb=cf,a.bc=vw,a.be=Dt,a.bf=function(f,u){pt.REGISTERED_PROTOCOLS[f]=u},a.bg=function(f){delete pt.REGISTERED_PROTOCOLS[f]},a.bh=function(f,u){const m={};for(let D=0;D<f.length;D++){const Q=u&&u[f[D].id]||Hu(f[D]);u&&(u[f[D].id]=Q);let H=m[Q];H||(H=m[Q]=[]),H.push(f[D])}const C=[];for(const D in m)C.push(m[D]);return C},a.bi=Rr,a.bj=I_,a.bk=jm,a.bl=Om,a.bm=function(f){f.bucket.createArrays(),f.bucket.tilePixelRatio=yi/(512*f.bucket.overscaling),f.bucket.compareText={},f.bucket.iconsNeedLinear=!1;const u=f.bucket.layers[0],m=u.layout,C=u._unevaluatedLayout._values,D={layoutIconSize:C["icon-size"].possiblyEvaluate(new vn(f.bucket.zoom+1),f.canonical),layoutTextSize:C["text-size"].possiblyEvaluate(new vn(f.bucket.zoom+1),f.canonical),textMaxSize:C["text-size"].possiblyEvaluate(new vn(18))};if(f.bucket.textSizeData.kind==="composite"){const{minZoom:de,maxZoom:h}=f.bucket.textSizeData;D.compositeTextSizes=[C["text-size"].possiblyEvaluate(new vn(de),f.canonical),C["text-size"].possiblyEvaluate(new vn(h),f.canonical)]}if(f.bucket.iconSizeData.kind==="composite"){const{minZoom:de,maxZoom:h}=f.bucket.iconSizeData;D.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new vn(de),f.canonical),C["icon-size"].possiblyEvaluate(new vn(h),f.canonical)]}const Q=m.get("text-line-height")*xo,H=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point",X=m.get("text-keep-upright"),ie=m.get("text-size");for(const de of f.bucket.features){const h=m.get("text-font").evaluate(de,{},f.canonical).join(","),c=ie.evaluate(de,{},f.canonical),d=D.layoutTextSize.evaluate(de,{},f.canonical),v=D.layoutIconSize.evaluate(de,{},f.canonical),S={horizontal:{},vertical:void 0},P=de.text;let k,G=[0,0];if(P){const ae=P.toString(),fe=m.get("text-letter-spacing").evaluate(de,{},f.canonical)*xo,me=io(ae)?fe:0,Ce=m.get("text-anchor").evaluate(de,{},f.canonical),Me=Np(u,de,f.canonical);if(!Me){const tt=m.get("text-radial-offset").evaluate(de,{},f.canonical);G=tt?Up(Ce,[tt*xo,ff]):m.get("text-offset").evaluate(de,{},f.canonical).map(it=>it*xo)}let Ue=H?"center":m.get("text-justify").evaluate(de,{},f.canonical);const $e=m.get("symbol-placement"),Ke=$e==="point"?m.get("text-max-width").evaluate(de,{},f.canonical)*xo:0,ut=()=>{f.bucket.allowVerticalPlacement&&ro(ae)&&(S.vertical=Ip(P,f.glyphMap,f.glyphPositions,f.imagePositions,h,Ke,Q,Ce,"left",me,G,a.ah.vertical,!0,$e,d,c))};if(!H&&Me){const tt=new Set;if(Ue==="auto")for(let yt=0;yt<Me.values.length;yt+=2)tt.add(z_(Me.values[yt]));else tt.add(Ue);let it=!1;for(const yt of tt)if(!S.horizontal[yt])if(it)S.horizontal[yt]=S.horizontal[0];else{const St=Ip(P,f.glyphMap,f.glyphPositions,f.imagePositions,h,Ke,Q,"center",yt,me,G,a.ah.horizontal,!1,$e,d,c);St&&(S.horizontal[yt]=St,it=St.positionedLines.length===1)}ut()}else{Ue==="auto"&&(Ue=z_(Ce));const tt=Ip(P,f.glyphMap,f.glyphPositions,f.imagePositions,h,Ke,Q,Ce,Ue,me,G,a.ah.horizontal,!1,$e,d,c);tt&&(S.horizontal[Ue]=tt),ut(),ro(ae)&&H&&X&&(S.vertical=Ip(P,f.glyphMap,f.glyphPositions,f.imagePositions,h,Ke,Q,Ce,Ue,me,G,a.ah.vertical,!1,$e,d,c))}}let W=!1;if(de.icon&&de.icon.name){const ae=f.imageMap[de.icon.name];ae&&(k=m5(f.imagePositions[de.icon.name],m.get("icon-offset").evaluate(de,{},f.canonical),m.get("icon-anchor").evaluate(de,{},f.canonical)),W=!!ae.sdf,f.bucket.sdfIcons===void 0?f.bucket.sdfIcons=W:f.bucket.sdfIcons!==W&&Ye("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ae.pixelRatio!==f.bucket.pixelRatio||m.get("icon-rotate").constantOr(1)!==0)&&(f.bucket.iconsNeedLinear=!0))}const ee=yw(S.horizontal)||S.vertical;f.bucket.iconsInText=!!ee&&ee.iconsInText,(ee||k)&&b5(f.bucket,de,S,k,f.imageMap,D,d,v,G,W,f.canonical)}f.showCollisionBoxes&&f.bucket.generateCollisionDebugBuffers()},a.bn=rd,a.bo=Mm,a.bp=a_,a.bq=Wu,a.br=p_,a.bs=class{constructor(f){this._marks={start:[f.url,"start"].join("#"),end:[f.url,"end"].join("#"),measure:f.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let f=performance.getEntriesByName(this._marks.measure);return f.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),f=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),f}},a.bt=function(f,u,m,C,D){return s(this,void 0,void 0,function*(){if(pe())try{return yield Ft(f,u,m,C,D)}catch{}return function(Q,H,X,ie,de){const h=Q.width,c=Q.height;Zt&&Le||(Zt=new OffscreenCanvas(h,c),Le=Zt.getContext("2d",{willReadFrequently:!0})),Zt.width=h,Zt.height=c,Le.drawImage(Q,0,0,h,c);const d=Le.getImageData(H,X,ie,de);return Le.clearRect(0,0,h,c),d.data}(f,u,m,C,D)})},a.bu=T_,a.bv=g,a.bw=y,a.bx=A_,a.by=Li,a.bz=function(f){return f.message===Ze},a.c=rt,a.d=f=>s(void 0,void 0,void 0,function*(){if(f.byteLength===0)return createImageBitmap(new ImageData(1,1));const u=new Blob([new Uint8Array(f)],{type:"image/png"});try{return createImageBitmap(u)}catch(m){throw new Error(`Could not load image because of ${m.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),a.e=We,a.f=f=>new Promise((u,m)=>{const C=new Image;C.onload=()=>{u(C),URL.revokeObjectURL(C.src),C.onload=null,window.requestAnimationFrame(()=>{C.src=Rt})},C.onerror=()=>m(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Blob([new Uint8Array(f)],{type:"image/png"});C.src=f.byteLength?URL.createObjectURL(D):Rt}),a.g=mt,a.h=(f,u)=>qt(We(f,{type:"json"}),u),a.i=Et,a.j=kt,a.k=Fr,a.l=(f,u)=>qt(We(f,{type:"arrayBuffer"}),u),a.m=qt,a.n=function(f){return new p_(f).readFields(f5,[])},a.o=wu,a.p=Ep,a.q=Us,a.r=va,a.s=nr,a.t=ra,a.u=Dr,a.v=wt,a.w=Ye,a.x=zn,a.y=function(f){let[u,m,C]=f;return m+=90,m*=Math.PI/180,C*=Math.PI/180,{x:u*Math.cos(m)*Math.sin(C),y:u*Math.sin(m)*Math.sin(C),z:u*Math.cos(C)}},a.z=En}),n("worker",["./shared"],function(a){class s{constructor(Be){this.keyCache={},Be&&this.replace(Be)}replace(Be){this._layerConfigs={},this._layers={},this.update(Be,[])}update(Be,ue){for(const Ae of Be){this._layerConfigs[Ae.id]=Ae;const ge=this._layers[Ae.id]=a.az(Ae);ge._featureFilter=a.a6(ge.filter),this.keyCache[Ae.id]&&delete this.keyCache[Ae.id]}for(const Ae of ue)delete this.keyCache[Ae],delete this._layerConfigs[Ae],delete this._layers[Ae];this.familiesBySource={};const re=a.bh(Object.values(this._layerConfigs),this.keyCache);for(const Ae of re){const ge=Ae.map(Ge=>this._layers[Ge.id]),xe=ge[0];if(xe.visibility==="none")continue;const Ee=xe.source||"";let we=this.familiesBySource[Ee];we||(we=this.familiesBySource[Ee]={});const Fe=xe.sourceLayer||"_geojsonTileLayer";let ze=we[Fe];ze||(ze=we[Fe]=[]),ze.push(ge)}}}class g{constructor(Be){const ue={},re=[];for(const Ee in Be){const we=Be[Ee],Fe=ue[Ee]={};for(const ze in we){const Ge=we[+ze];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const st={x:0,y:0,w:Ge.bitmap.width+2,h:Ge.bitmap.height+2};re.push(st),Fe[ze]={rect:st,metrics:Ge.metrics}}}const{w:Ae,h:ge}=a.p(re),xe=new a.o({width:Ae||1,height:ge||1});for(const Ee in Be){const we=Be[Ee];for(const Fe in we){const ze=we[+Fe];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const Ge=ue[Ee][Fe].rect;a.o.copy(ze.bitmap,xe,{x:0,y:0},{x:Ge.x+1,y:Ge.y+1},ze.bitmap)}}this.image=xe,this.positions=ue}}a.bi("GlyphAtlas",g);class y{constructor(Be){this.tileID=new a.Q(Be.tileID.overscaledZ,Be.tileID.wrap,Be.tileID.canonical.z,Be.tileID.canonical.x,Be.tileID.canonical.y),this.uid=Be.uid,this.zoom=Be.zoom,this.pixelRatio=Be.pixelRatio,this.tileSize=Be.tileSize,this.source=Be.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Be.showCollisionBoxes,this.collectResourceTiming=!!Be.collectResourceTiming,this.returnDependencies=!!Be.returnDependencies,this.promoteId=Be.promoteId,this.inFlightDependencies=[]}parse(Be,ue,re,Ae){return a._(this,void 0,void 0,function*(){this.status="parsing",this.data=Be,this.collisionBoxArray=new a.a4;const ge=new a.bj(Object.keys(Be.layers).sort()),xe=new a.bk(this.tileID,this.promoteId);xe.bucketLayerIDs=[];const Ee={},we={featureIndex:xe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:re},Fe=ue.familiesBySource[this.source];for(const Er in Fe){const zr=Be.layers[Er];if(!zr)continue;zr.version===1&&a.w(`Vector tile source "${this.source}" layer "${Er}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ot=ge.encode(Er),ir=[];for(let Vt=0;Vt<zr.length;Vt++){const Hr=zr.feature(Vt),ci=xe.getId(Hr,Er);ir.push({feature:Hr,id:ci,index:Vt,sourceLayerIndex:ot})}for(const Vt of Fe[Er]){const Hr=Vt[0];Hr.source!==this.source&&a.w(`layer.source = ${Hr.source} does not equal this.source = ${this.source}`),Hr.minzoom&&this.zoom<Math.floor(Hr.minzoom)||Hr.maxzoom&&this.zoom>=Hr.maxzoom||Hr.visibility!=="none"&&(T(Vt,this.zoom,re),(Ee[Hr.id]=Hr.createBucket({index:xe.bucketLayerIDs.length,layers:Vt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ot,sourceID:this.source})).populate(ir,we,this.tileID.canonical),xe.bucketLayerIDs.push(Vt.map(ci=>ci.id)))}}const ze=a.aE(we.glyphDependencies,Er=>Object.keys(Er).map(Number));this.inFlightDependencies.forEach(Er=>Er==null?void 0:Er.abort()),this.inFlightDependencies=[];let Ge=Promise.resolve({});if(Object.keys(ze).length){const Er=new AbortController;this.inFlightDependencies.push(Er),Ge=Ae.sendAsync({type:"getGlyphs",data:{stacks:ze,source:this.source,tileID:this.tileID,type:"glyphs"}},Er)}const st=Object.keys(we.iconDependencies);let vt=Promise.resolve({});if(st.length){const Er=new AbortController;this.inFlightDependencies.push(Er),vt=Ae.sendAsync({type:"getImages",data:{icons:st,source:this.source,tileID:this.tileID,type:"icons"}},Er)}const Tt=Object.keys(we.patternDependencies);let Kt=Promise.resolve({});if(Tt.length){const Er=new AbortController;this.inFlightDependencies.push(Er),Kt=Ae.sendAsync({type:"getImages",data:{icons:Tt,source:this.source,tileID:this.tileID,type:"patterns"}},Er)}const[rr,Gt,dr]=yield Promise.all([Ge,vt,Kt]),Cr=new g(rr),Gr=new a.bl(Gt,dr);for(const Er in Ee){const zr=Ee[Er];zr instanceof a.a5?(T(zr.layers,this.zoom,re),a.bm({bucket:zr,glyphMap:rr,glyphPositions:Cr.positions,imageMap:Gt,imagePositions:Gr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):zr.hasPattern&&(zr instanceof a.bn||zr instanceof a.bo||zr instanceof a.bp)&&(T(zr.layers,this.zoom,re),zr.addFeatures(we,this.tileID.canonical,Gr.patternPositions))}return this.status="done",{buckets:Object.values(Ee).filter(Er=>!Er.isEmpty()),featureIndex:xe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Cr.image,imageAtlas:Gr,glyphMap:this.returnDependencies?rr:null,iconMap:this.returnDependencies?Gt:null,glyphPositions:this.returnDependencies?Cr.positions:null}})}}function T(Qe,Be,ue){const re=new a.a8(Be);for(const Ae of Qe)Ae.recalculate(re,ue)}class I{constructor(Be,ue,re){this.actor=Be,this.layerIndex=ue,this.availableImages=re,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Be,ue){return a._(this,void 0,void 0,function*(){const re=yield a.l(Be.request,ue);try{return{vectorTile:new a.bq.VectorTile(new a.br(re.data)),rawData:re.data,cacheControl:re.cacheControl,expires:re.expires}}catch(Ae){const ge=new Uint8Array(re.data);let xe=`Unable to parse the tile at ${Be.request.url}, `;throw xe+=ge[0]===31&&ge[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Ae.messge}`,new Error(xe)}})}loadTile(Be){return a._(this,void 0,void 0,function*(){const ue=Be.uid,re=!!(Be&&Be.request&&Be.request.collectResourceTiming)&&new a.bs(Be.request),Ae=new y(Be);this.loading[ue]=Ae;const ge=new AbortController;Ae.abort=ge;try{const xe=yield this.loadVectorTile(Be,ge);if(delete this.loading[ue],!xe)return null;const Ee=xe.rawData,we={};xe.expires&&(we.expires=xe.expires),xe.cacheControl&&(we.cacheControl=xe.cacheControl);const Fe={};if(re){const Ge=re.finish();Ge&&(Fe.resourceTiming=JSON.parse(JSON.stringify(Ge)))}Ae.vectorTile=xe.vectorTile;const ze=Ae.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ue]=Ae,this.fetching[ue]={rawTileData:Ee,cacheControl:we,resourceTiming:Fe};try{const Ge=yield ze;return a.e({rawTileData:Ee.slice(0)},Ge,we,Fe)}finally{delete this.fetching[ue]}}catch(xe){throw delete this.loading[ue],Ae.status="done",this.loaded[ue]=Ae,xe}})}reloadTile(Be){return a._(this,void 0,void 0,function*(){const ue=Be.uid;if(!this.loaded||!this.loaded[ue])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const re=this.loaded[ue];if(re.showCollisionBoxes=Be.showCollisionBoxes,re.status==="parsing"){const Ae=yield re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor);let ge;if(this.fetching[ue]){const{rawTileData:xe,cacheControl:Ee,resourceTiming:we}=this.fetching[ue];delete this.fetching[ue],ge=a.e({rawTileData:xe.slice(0)},Ae,Ee,we)}else ge=Ae;return ge}if(re.status==="done"&&re.vectorTile)return re.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(Be){return a._(this,void 0,void 0,function*(){const ue=this.loading,re=Be.uid;ue&&ue[re]&&ue[re].abort&&(ue[re].abort.abort(),delete ue[re])})}removeTile(Be){return a._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Be.uid]&&delete this.loaded[Be.uid]})}}class R{constructor(){this.loaded={}}loadTile(Be){return a._(this,void 0,void 0,function*(){const{uid:ue,encoding:re,rawImageData:Ae,redFactor:ge,greenFactor:xe,blueFactor:Ee,baseShift:we}=Be,Fe=Ae.width+2,ze=Ae.height+2,Ge=a.b(Ae)?new a.R({width:Fe,height:ze},yield a.bt(Ae,-1,-1,Fe,ze)):Ae,st=new a.bu(ue,Ge,re,ge,xe,Ee,we);return this.loaded=this.loaded||{},this.loaded[ue]=st,st})}removeTile(Be){const ue=this.loaded,re=Be.uid;ue&&ue[re]&&delete ue[re]}}function U(Qe,Be){if(Qe.length!==0){Z(Qe[0],Be);for(var ue=1;ue<Qe.length;ue++)Z(Qe[ue],!Be)}}function Z(Qe,Be){for(var ue=0,re=0,Ae=0,ge=Qe.length,xe=ge-1;Ae<ge;xe=Ae++){var Ee=(Qe[Ae][0]-Qe[xe][0])*(Qe[xe][1]+Qe[Ae][1]),we=ue+Ee;re+=Math.abs(ue)>=Math.abs(Ee)?ue-we+Ee:Ee-we+ue,ue=we}ue+re>=0!=!!Be&&Qe.reverse()}var Y=a.bv(function Qe(Be,ue){var re,Ae=Be&&Be.type;if(Ae==="FeatureCollection")for(re=0;re<Be.features.length;re++)Qe(Be.features[re],ue);else if(Ae==="GeometryCollection")for(re=0;re<Be.geometries.length;re++)Qe(Be.geometries[re],ue);else if(Ae==="Feature")Qe(Be.geometry,ue);else if(Ae==="Polygon")U(Be.coordinates,ue);else if(Ae==="MultiPolygon")for(re=0;re<Be.coordinates.length;re++)U(Be.coordinates[re],ue);return Be});const he=a.bq.VectorTileFeature.prototype.toGeoJSON;var ce={exports:{}},pe=a.bw,be=a.bq.VectorTileFeature,Te=qe;function qe(Qe,Be){this.options=Be||{},this.features=Qe,this.length=Qe.length}function je(Qe,Be){this.id=typeof Qe.id=="number"?Qe.id:void 0,this.type=Qe.type,this.rawGeometry=Qe.type===1?[Qe.geometry]:Qe.geometry,this.properties=Qe.tags,this.extent=Be||4096}qe.prototype.feature=function(Qe){return new je(this.features[Qe],this.options.extent)},je.prototype.loadGeometry=function(){var Qe=this.rawGeometry;this.geometry=[];for(var Be=0;Be<Qe.length;Be++){for(var ue=Qe[Be],re=[],Ae=0;Ae<ue.length;Ae++)re.push(new pe(ue[Ae][0],ue[Ae][1]));this.geometry.push(re)}return this.geometry},je.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Qe=this.geometry,Be=1/0,ue=-1/0,re=1/0,Ae=-1/0,ge=0;ge<Qe.length;ge++)for(var xe=Qe[ge],Ee=0;Ee<xe.length;Ee++){var we=xe[Ee];Be=Math.min(Be,we.x),ue=Math.max(ue,we.x),re=Math.min(re,we.y),Ae=Math.max(Ae,we.y)}return[Be,re,ue,Ae]},je.prototype.toGeoJSON=be.prototype.toGeoJSON;var We=a.bx,Ne=Te;function at(Qe){var Be=new We;return function(ue,re){for(var Ae in ue.layers)re.writeMessage(3,nt,ue.layers[Ae])}(Qe,Be),Be.finish()}function nt(Qe,Be){var ue;Be.writeVarintField(15,Qe.version||1),Be.writeStringField(1,Qe.name||""),Be.writeVarintField(5,Qe.extent||4096);var re={keys:[],values:[],keycache:{},valuecache:{}};for(ue=0;ue<Qe.length;ue++)re.feature=Qe.feature(ue),Be.writeMessage(2,ke,re);var Ae=re.keys;for(ue=0;ue<Ae.length;ue++)Be.writeStringField(3,Ae[ue]);var ge=re.values;for(ue=0;ue<ge.length;ue++)Be.writeMessage(4,Et,ge[ue])}function ke(Qe,Be){var ue=Qe.feature;ue.id!==void 0&&Be.writeVarintField(1,ue.id),Be.writeMessage(2,De,Qe),Be.writeVarintField(3,ue.type),Be.writeMessage(4,Ct,ue)}function De(Qe,Be){var ue=Qe.feature,re=Qe.keys,Ae=Qe.values,ge=Qe.keycache,xe=Qe.valuecache;for(var Ee in ue.properties){var we=ue.properties[Ee],Fe=ge[Ee];if(we!==null){Fe===void 0&&(re.push(Ee),ge[Ee]=Fe=re.length-1),Be.writeVarint(Fe);var ze=typeof we;ze!=="string"&&ze!=="boolean"&&ze!=="number"&&(we=JSON.stringify(we));var Ge=ze+":"+we,st=xe[Ge];st===void 0&&(Ae.push(we),xe[Ge]=st=Ae.length-1),Be.writeVarint(st)}}}function Ye(Qe,Be){return(Be<<3)+(7&Qe)}function Xe(Qe){return Qe<<1^Qe>>31}function Ct(Qe,Be){for(var ue=Qe.loadGeometry(),re=Qe.type,Ae=0,ge=0,xe=ue.length,Ee=0;Ee<xe;Ee++){var we=ue[Ee],Fe=1;re===1&&(Fe=we.length),Be.writeVarint(Ye(1,Fe));for(var ze=re===3?we.length-1:we.length,Ge=0;Ge<ze;Ge++){Ge===1&&re!==1&&Be.writeVarint(Ye(2,ze-1));var st=we[Ge].x-Ae,vt=we[Ge].y-ge;Be.writeVarint(Xe(st)),Be.writeVarint(Xe(vt)),Ae+=st,ge+=vt}re===3&&Be.writeVarint(Ye(7,1))}}function Et(Qe,Be){var ue=typeof Qe;ue==="string"?Be.writeStringField(1,Qe):ue==="boolean"?Be.writeBooleanField(7,Qe):ue==="number"&&(Qe%1!=0?Be.writeDoubleField(3,Qe):Qe<0?Be.writeSVarintField(6,Qe):Be.writeVarintField(5,Qe))}ce.exports=at,ce.exports.fromVectorTileJs=at,ce.exports.fromGeojsonVt=function(Qe,Be){Be=Be||{};var ue={};for(var re in Qe)ue[re]=new Ne(Qe[re].features,Be),ue[re].name=re,ue[re].version=Be.version,ue[re].extent=Be.extent;return at({layers:ue})},ce.exports.GeoJSONWrapper=Ne;var Pt=a.bv(ce.exports);const bt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Qe=>Qe},Rt=Math.fround||(Ft=new Float32Array(1),Qe=>(Ft[0]=+Qe,Ft[0]));var Ft;const Zt=3,Le=5,Ze=6;class rt{constructor(Be){this.options=Object.assign(Object.create(bt),Be),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Be){const{log:ue,minZoom:re,maxZoom:Ae}=this.options;ue&&console.time("total time");const ge=`prepare ${Be.length} points`;ue&&console.time(ge),this.points=Be;const xe=[];for(let we=0;we<Be.length;we++){const Fe=Be[we];if(!Fe.geometry)continue;const[ze,Ge]=Fe.geometry.coordinates,st=Rt(Bt(ze)),vt=Rt(Dt(Ge));xe.push(st,vt,1/0,we,-1,1),this.options.reduce&&xe.push(0)}let Ee=this.trees[Ae+1]=this._createTree(xe);ue&&console.timeEnd(ge);for(let we=Ae;we>=re;we--){const Fe=+Date.now();Ee=this.trees[we]=this._createTree(this._cluster(Ee,we)),ue&&console.log("z%d: %d clusters in %dms",we,Ee.numItems,+Date.now()-Fe)}return ue&&console.timeEnd("total time"),this}getClusters(Be,ue){let re=((Be[0]+180)%360+360)%360-180;const Ae=Math.max(-90,Math.min(90,Be[1]));let ge=Be[2]===180?180:((Be[2]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,Be[3]));if(Be[2]-Be[0]>=360)re=-180,ge=180;else if(re>ge){const Ge=this.getClusters([re,Ae,180,xe],ue),st=this.getClusters([-180,Ae,ge,xe],ue);return Ge.concat(st)}const Ee=this.trees[this._limitZoom(ue)],we=Ee.range(Bt(re),Dt(xe),Bt(ge),Dt(Ae)),Fe=Ee.data,ze=[];for(const Ge of we){const st=this.stride*Ge;ze.push(Fe[st+Le]>1?pt(Fe,st,this.clusterProps):this.points[Fe[st+Zt]])}return ze}getChildren(Be){const ue=this._getOriginId(Be),re=this._getOriginZoom(Be),Ae="No cluster with the specified id.",ge=this.trees[re];if(!ge)throw new Error(Ae);const xe=ge.data;if(ue*this.stride>=xe.length)throw new Error(Ae);const Ee=this.options.radius/(this.options.extent*Math.pow(2,re-1)),we=ge.within(xe[ue*this.stride],xe[ue*this.stride+1],Ee),Fe=[];for(const ze of we){const Ge=ze*this.stride;xe[Ge+4]===Be&&Fe.push(xe[Ge+Le]>1?pt(xe,Ge,this.clusterProps):this.points[xe[Ge+Zt]])}if(Fe.length===0)throw new Error(Ae);return Fe}getLeaves(Be,ue,re){const Ae=[];return this._appendLeaves(Ae,Be,ue=ue||10,re=re||0,0),Ae}getTile(Be,ue,re){const Ae=this.trees[this._limitZoom(Be)],ge=Math.pow(2,Be),{extent:xe,radius:Ee}=this.options,we=Ee/xe,Fe=(re-we)/ge,ze=(re+1+we)/ge,Ge={features:[]};return this._addTileFeatures(Ae.range((ue-we)/ge,Fe,(ue+1+we)/ge,ze),Ae.data,ue,re,ge,Ge),ue===0&&this._addTileFeatures(Ae.range(1-we/ge,Fe,1,ze),Ae.data,ge,re,ge,Ge),ue===ge-1&&this._addTileFeatures(Ae.range(0,Fe,we/ge,ze),Ae.data,-1,re,ge,Ge),Ge.features.length?Ge:null}getClusterExpansionZoom(Be){let ue=this._getOriginZoom(Be)-1;for(;ue<=this.options.maxZoom;){const re=this.getChildren(Be);if(ue++,re.length!==1)break;Be=re[0].properties.cluster_id}return ue}_appendLeaves(Be,ue,re,Ae,ge){const xe=this.getChildren(ue);for(const Ee of xe){const we=Ee.properties;if(we&&we.cluster?ge+we.point_count<=Ae?ge+=we.point_count:ge=this._appendLeaves(Be,we.cluster_id,re,Ae,ge):ge<Ae?ge++:Be.push(Ee),Be.length===re)break}return ge}_createTree(Be){const ue=new a.au(Be.length/this.stride|0,this.options.nodeSize,Float32Array);for(let re=0;re<Be.length;re+=this.stride)ue.add(Be[re],Be[re+1]);return ue.finish(),ue.data=Be,ue}_addTileFeatures(Be,ue,re,Ae,ge,xe){for(const Ee of Be){const we=Ee*this.stride,Fe=ue[we+Le]>1;let ze,Ge,st;if(Fe)ze=mt(ue,we,this.clusterProps),Ge=ue[we],st=ue[we+1];else{const Kt=this.points[ue[we+Zt]];ze=Kt.properties;const[rr,Gt]=Kt.geometry.coordinates;Ge=Bt(rr),st=Dt(Gt)}const vt={type:1,geometry:[[Math.round(this.options.extent*(Ge*ge-re)),Math.round(this.options.extent*(st*ge-Ae))]],tags:ze};let Tt;Tt=Fe||this.options.generateId?ue[we+Zt]:this.points[ue[we+Zt]].id,Tt!==void 0&&(vt.id=Tt),xe.features.push(vt)}}_limitZoom(Be){return Math.max(this.options.minZoom,Math.min(Math.floor(+Be),this.options.maxZoom+1))}_cluster(Be,ue){const{radius:re,extent:Ae,reduce:ge,minPoints:xe}=this.options,Ee=re/(Ae*Math.pow(2,ue)),we=Be.data,Fe=[],ze=this.stride;for(let Ge=0;Ge<we.length;Ge+=ze){if(we[Ge+2]<=ue)continue;we[Ge+2]=ue;const st=we[Ge],vt=we[Ge+1],Tt=Be.within(we[Ge],we[Ge+1],Ee),Kt=we[Ge+Le];let rr=Kt;for(const Gt of Tt){const dr=Gt*ze;we[dr+2]>ue&&(rr+=we[dr+Le])}if(rr>Kt&&rr>=xe){let Gt,dr=st*Kt,Cr=vt*Kt,Gr=-1;const Er=((Ge/ze|0)<<5)+(ue+1)+this.points.length;for(const zr of Tt){const ot=zr*ze;if(we[ot+2]<=ue)continue;we[ot+2]=ue;const ir=we[ot+Le];dr+=we[ot]*ir,Cr+=we[ot+1]*ir,we[ot+4]=Er,ge&&(Gt||(Gt=this._map(we,Ge,!0),Gr=this.clusterProps.length,this.clusterProps.push(Gt)),ge(Gt,this._map(we,ot)))}we[Ge+4]=Er,Fe.push(dr/rr,Cr/rr,1/0,Er,-1,rr),ge&&Fe.push(Gr)}else{for(let Gt=0;Gt<ze;Gt++)Fe.push(we[Ge+Gt]);if(rr>1)for(const Gt of Tt){const dr=Gt*ze;if(!(we[dr+2]<=ue)){we[dr+2]=ue;for(let Cr=0;Cr<ze;Cr++)Fe.push(we[dr+Cr])}}}}return Fe}_getOriginId(Be){return Be-this.points.length>>5}_getOriginZoom(Be){return(Be-this.points.length)%32}_map(Be,ue,re){if(Be[ue+Le]>1){const xe=this.clusterProps[Be[ue+Ze]];return re?Object.assign({},xe):xe}const Ae=this.points[Be[ue+Zt]].properties,ge=this.options.map(Ae);return re&&ge===Ae?Object.assign({},ge):ge}}function pt(Qe,Be,ue){return{type:"Feature",id:Qe[Be+Zt],properties:mt(Qe,Be,ue),geometry:{type:"Point",coordinates:[(re=Qe[Be],360*(re-.5)),Mt(Qe[Be+1])]}};var re}function mt(Qe,Be,ue){const re=Qe[Be+Le],Ae=re>=1e4?`${Math.round(re/1e3)}k`:re>=1e3?Math.round(re/100)/10+"k":re,ge=Qe[Be+Ze],xe=ge===-1?{}:Object.assign({},ue[ge]);return Object.assign(xe,{cluster:!0,cluster_id:Qe[Be+Zt],point_count:re,point_count_abbreviated:Ae})}function Bt(Qe){return Qe/360+.5}function Dt(Qe){const Be=Math.sin(Qe*Math.PI/180),ue=.5-.25*Math.log((1+Be)/(1-Be))/Math.PI;return ue<0?0:ue>1?1:ue}function Mt(Qe){const Be=(180-360*Qe)*Math.PI/180;return 360*Math.atan(Math.exp(Be))/Math.PI-90}function qt(Qe,Be,ue,re){for(var Ae,ge=re,xe=ue-Be>>1,Ee=ue-Be,we=Qe[Be],Fe=Qe[Be+1],ze=Qe[ue],Ge=Qe[ue+1],st=Be+3;st<ue;st+=3){var vt=nr(Qe[st],Qe[st+1],we,Fe,ze,Ge);if(vt>ge)Ae=st,ge=vt;else if(vt===ge){var Tt=Math.abs(st-xe);Tt<Ee&&(Ae=st,Ee=Tt)}}ge>re&&(Ae-Be>3&&qt(Qe,Be,Ae,re),Qe[Ae+2]=ge,ue-Ae>3&&qt(Qe,Ae,ue,re))}function nr(Qe,Be,ue,re,Ae,ge){var xe=Ae-ue,Ee=ge-re;if(xe!==0||Ee!==0){var we=((Qe-ue)*xe+(Be-re)*Ee)/(xe*xe+Ee*Ee);we>1?(ue=Ae,re=ge):we>0&&(ue+=xe*we,re+=Ee*we)}return(xe=Qe-ue)*xe+(Ee=Be-re)*Ee}function vr(Qe,Be,ue,re){var Ae={id:Qe===void 0?null:Qe,type:Be,geometry:ue,tags:re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ge){var xe=ge.geometry,Ee=ge.type;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")br(ge,xe);else if(Ee==="Polygon"||Ee==="MultiLineString")for(var we=0;we<xe.length;we++)br(ge,xe[we]);else if(Ee==="MultiPolygon")for(we=0;we<xe.length;we++)for(var Fe=0;Fe<xe[we].length;Fe++)br(ge,xe[we][Fe])}(Ae),Ae}function br(Qe,Be){for(var ue=0;ue<Be.length;ue+=3)Qe.minX=Math.min(Qe.minX,Be[ue]),Qe.minY=Math.min(Qe.minY,Be[ue+1]),Qe.maxX=Math.max(Qe.maxX,Be[ue]),Qe.maxY=Math.max(Qe.maxY,Be[ue+1])}function Fr(Qe,Be,ue,re){if(Be.geometry){var Ae=Be.geometry.coordinates,ge=Be.geometry.type,xe=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2),Ee=[],we=Be.id;if(ue.promoteId?we=Be.properties[ue.promoteId]:ue.generateId&&(we=re||0),ge==="Point")kt(Ae,Ee);else if(ge==="MultiPoint")for(var Fe=0;Fe<Ae.length;Fe++)kt(Ae[Fe],Ee);else if(ge==="LineString")lt(Ae,Ee,xe,!1);else if(ge==="MultiLineString"){if(ue.lineMetrics){for(Fe=0;Fe<Ae.length;Fe++)lt(Ae[Fe],Ee=[],xe,!1),Qe.push(vr(we,"LineString",Ee,Be.properties));return}wt(Ae,Ee,xe,!1)}else if(ge==="Polygon")wt(Ae,Ee,xe,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(Fe=0;Fe<Be.geometry.geometries.length;Fe++)Fr(Qe,{id:we,geometry:Be.geometry.geometries[Fe],properties:Be.properties},ue,re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Fe=0;Fe<Ae.length;Fe++){var ze=[];wt(Ae[Fe],ze,xe,!0),Ee.push(ze)}}Qe.push(vr(we,ge,Ee,Be.properties))}}function kt(Qe,Be){Be.push(Ur(Qe[0])),Be.push(tr(Qe[1])),Be.push(0)}function lt(Qe,Be,ue,re){for(var Ae,ge,xe=0,Ee=0;Ee<Qe.length;Ee++){var we=Ur(Qe[Ee][0]),Fe=tr(Qe[Ee][1]);Be.push(we),Be.push(Fe),Be.push(0),Ee>0&&(xe+=re?(Ae*Fe-we*ge)/2:Math.sqrt(Math.pow(we-Ae,2)+Math.pow(Fe-ge,2))),Ae=we,ge=Fe}var ze=Be.length-3;Be[2]=1,qt(Be,0,ze,ue),Be[ze+2]=1,Be.size=Math.abs(xe),Be.start=0,Be.end=Be.size}function wt(Qe,Be,ue,re){for(var Ae=0;Ae<Qe.length;Ae++){var ge=[];lt(Qe[Ae],ge,ue,re),Be.push(ge)}}function Ur(Qe){return Qe/360+.5}function tr(Qe){var Be=Math.sin(Qe*Math.PI/180),ue=.5-.25*Math.log((1+Be)/(1-Be))/Math.PI;return ue<0?0:ue>1?1:ue}function ht(Qe,Be,ue,re,Ae,ge,xe,Ee){if(re/=Be,ge>=(ue/=Be)&&xe<re)return Qe;if(xe<ue||ge>=re)return null;for(var we=[],Fe=0;Fe<Qe.length;Fe++){var ze=Qe[Fe],Ge=ze.geometry,st=ze.type,vt=Ae===0?ze.minX:ze.minY,Tt=Ae===0?ze.maxX:ze.maxY;if(vt>=ue&&Tt<re)we.push(ze);else if(!(Tt<ue||vt>=re)){var Kt=[];if(st==="Point"||st==="MultiPoint")$t(Ge,Kt,ue,re,Ae);else if(st==="LineString")or(Ge,Kt,ue,re,Ae,!1,Ee.lineMetrics);else if(st==="MultiLineString")ur(Ge,Kt,ue,re,Ae,!1);else if(st==="Polygon")ur(Ge,Kt,ue,re,Ae,!0);else if(st==="MultiPolygon")for(var rr=0;rr<Ge.length;rr++){var Gt=[];ur(Ge[rr],Gt,ue,re,Ae,!0),Gt.length&&Kt.push(Gt)}if(Kt.length){if(Ee.lineMetrics&&st==="LineString"){for(rr=0;rr<Kt.length;rr++)we.push(vr(ze.id,st,Kt[rr],ze.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(Kt.length===1?(st="LineString",Kt=Kt[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=Kt.length===3?"Point":"MultiPoint"),we.push(vr(ze.id,st,Kt,ze.tags))}}}return we.length?we:null}function $t(Qe,Be,ue,re,Ae){for(var ge=0;ge<Qe.length;ge+=3){var xe=Qe[ge+Ae];xe>=ue&&xe<=re&&(Be.push(Qe[ge]),Be.push(Qe[ge+1]),Be.push(Qe[ge+2]))}}function or(Qe,Be,ue,re,Ae,ge,xe){for(var Ee,we,Fe=mr(Qe),ze=Ae===0?ri:gi,Ge=Qe.start,st=0;st<Qe.length-3;st+=3){var vt=Qe[st],Tt=Qe[st+1],Kt=Qe[st+2],rr=Qe[st+3],Gt=Qe[st+4],dr=Ae===0?vt:Tt,Cr=Ae===0?rr:Gt,Gr=!1;xe&&(Ee=Math.sqrt(Math.pow(vt-rr,2)+Math.pow(Tt-Gt,2))),dr<ue?Cr>ue&&(we=ze(Fe,vt,Tt,rr,Gt,ue),xe&&(Fe.start=Ge+Ee*we)):dr>re?Cr<re&&(we=ze(Fe,vt,Tt,rr,Gt,re),xe&&(Fe.start=Ge+Ee*we)):Wr(Fe,vt,Tt,Kt),Cr<ue&&dr>=ue&&(we=ze(Fe,vt,Tt,rr,Gt,ue),Gr=!0),Cr>re&&dr<=re&&(we=ze(Fe,vt,Tt,rr,Gt,re),Gr=!0),!ge&&Gr&&(xe&&(Fe.end=Ge+Ee*we),Be.push(Fe),Fe=mr(Qe)),xe&&(Ge+=Ee)}var Er=Qe.length-3;vt=Qe[Er],Tt=Qe[Er+1],Kt=Qe[Er+2],(dr=Ae===0?vt:Tt)>=ue&&dr<=re&&Wr(Fe,vt,Tt,Kt),Er=Fe.length-3,ge&&Er>=3&&(Fe[Er]!==Fe[0]||Fe[Er+1]!==Fe[1])&&Wr(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&Be.push(Fe)}function mr(Qe){var Be=[];return Be.size=Qe.size,Be.start=Qe.start,Be.end=Qe.end,Be}function ur(Qe,Be,ue,re,Ae,ge){for(var xe=0;xe<Qe.length;xe++)or(Qe[xe],Be,ue,re,Ae,ge,!1)}function Wr(Qe,Be,ue,re){Qe.push(Be),Qe.push(ue),Qe.push(re)}function ri(Qe,Be,ue,re,Ae,ge){var xe=(ge-Be)/(re-Be);return Qe.push(ge),Qe.push(ue+(Ae-ue)*xe),Qe.push(1),xe}function gi(Qe,Be,ue,re,Ae,ge){var xe=(ge-ue)/(Ae-ue);return Qe.push(Be+(re-Be)*xe),Qe.push(ge),Qe.push(1),xe}function Pi(Qe,Be){for(var ue=[],re=0;re<Qe.length;re++){var Ae,ge=Qe[re],xe=ge.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Ae=zt(ge.geometry,Be);else if(xe==="MultiLineString"||xe==="Polygon"){Ae=[];for(var Ee=0;Ee<ge.geometry.length;Ee++)Ae.push(zt(ge.geometry[Ee],Be))}else if(xe==="MultiPolygon")for(Ae=[],Ee=0;Ee<ge.geometry.length;Ee++){for(var we=[],Fe=0;Fe<ge.geometry[Ee].length;Fe++)we.push(zt(ge.geometry[Ee][Fe],Be));Ae.push(we)}ue.push(vr(ge.id,xe,Ae,ge.tags))}return ue}function zt(Qe,Be){var ue=[];ue.size=Qe.size,Qe.start!==void 0&&(ue.start=Qe.start,ue.end=Qe.end);for(var re=0;re<Qe.length;re+=3)ue.push(Qe[re]+Be,Qe[re+1],Qe[re+2]);return ue}function Xr(Qe,Be){if(Qe.transformed)return Qe;var ue,re,Ae,ge=1<<Qe.z,xe=Qe.x,Ee=Qe.y;for(ue=0;ue<Qe.features.length;ue++){var we=Qe.features[ue],Fe=we.geometry,ze=we.type;if(we.geometry=[],ze===1)for(re=0;re<Fe.length;re+=2)we.geometry.push(Ar(Fe[re],Fe[re+1],Be,ge,xe,Ee));else for(re=0;re<Fe.length;re++){var Ge=[];for(Ae=0;Ae<Fe[re].length;Ae+=2)Ge.push(Ar(Fe[re][Ae],Fe[re][Ae+1],Be,ge,xe,Ee));we.geometry.push(Ge)}}return Qe.transformed=!0,Qe}function Ar(Qe,Be,ue,re,Ae,ge){return[Math.round(ue*(Qe*re-Ae)),Math.round(ue*(Be*re-ge))]}function Wt(Qe,Be,ue,re,Ae){for(var ge=Be===Ae.maxZoom?0:Ae.tolerance/((1<<Be)*Ae.extent),xe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ue,y:re,z:Be,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ee=0;Ee<Qe.length;Ee++){xe.numFeatures++,di(xe,Qe[Ee],ge,Ae);var we=Qe[Ee].minX,Fe=Qe[Ee].minY,ze=Qe[Ee].maxX,Ge=Qe[Ee].maxY;we<xe.minX&&(xe.minX=we),Fe<xe.minY&&(xe.minY=Fe),ze>xe.maxX&&(xe.maxX=ze),Ge>xe.maxY&&(xe.maxY=Ge)}return xe}function di(Qe,Be,ue,re){var Ae=Be.geometry,ge=Be.type,xe=[];if(ge==="Point"||ge==="MultiPoint")for(var Ee=0;Ee<Ae.length;Ee+=3)xe.push(Ae[Ee]),xe.push(Ae[Ee+1]),Qe.numPoints++,Qe.numSimplified++;else if(ge==="LineString")Qt(xe,Ae,Qe,ue,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(Ee=0;Ee<Ae.length;Ee++)Qt(xe,Ae[Ee],Qe,ue,ge==="Polygon",Ee===0);else if(ge==="MultiPolygon")for(var we=0;we<Ae.length;we++){var Fe=Ae[we];for(Ee=0;Ee<Fe.length;Ee++)Qt(xe,Fe[Ee],Qe,ue,!0,Ee===0)}if(xe.length){var ze=Be.tags||null;if(ge==="LineString"&&re.lineMetrics){for(var Ge in ze={},Be.tags)ze[Ge]=Be.tags[Ge];ze.mapbox_clip_start=Ae.start/Ae.size,ze.mapbox_clip_end=Ae.end/Ae.size}var st={geometry:xe,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:ze};Be.id!==null&&(st.id=Be.id),Qe.features.push(st)}}function Qt(Qe,Be,ue,re,Ae,ge){var xe=re*re;if(re>0&&Be.size<(Ae?xe:re))ue.numPoints+=Be.length/3;else{for(var Ee=[],we=0;we<Be.length;we+=3)(re===0||Be[we+2]>xe)&&(ue.numSimplified++,Ee.push(Be[we]),Ee.push(Be[we+1])),ue.numPoints++;Ae&&function(Fe,ze){for(var Ge=0,st=0,vt=Fe.length,Tt=vt-2;st<vt;Tt=st,st+=2)Ge+=(Fe[st]-Fe[Tt])*(Fe[st+1]+Fe[Tt+1]);if(Ge>0===ze)for(st=0,vt=Fe.length;st<vt/2;st+=2){var Kt=Fe[st],rr=Fe[st+1];Fe[st]=Fe[vt-2-st],Fe[st+1]=Fe[vt-1-st],Fe[vt-2-st]=Kt,Fe[vt-1-st]=rr}}(Ee,ge),Qe.push(Ee)}}function Tr(Qe,Be){var ue=(Be=this.options=function(Ae,ge){for(var xe in ge)Ae[xe]=ge[xe];return Ae}(Object.create(this.options),Be)).debug;if(ue&&console.time("preprocess data"),Be.maxZoom<0||Be.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Be.promoteId&&Be.generateId)throw new Error("promoteId and generateId cannot be used together.");var re=function(Ae,ge){var xe=[];if(Ae.type==="FeatureCollection")for(var Ee=0;Ee<Ae.features.length;Ee++)Fr(xe,Ae.features[Ee],ge,Ee);else Fr(xe,Ae.type==="Feature"?Ae:{geometry:Ae},ge);return xe}(Qe,Be);this.tiles={},this.tileCoords=[],ue&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Be.indexMaxZoom,Be.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),re=function(Ae,ge){var xe=ge.buffer/ge.extent,Ee=Ae,we=ht(Ae,1,-1-xe,xe,0,-1,2,ge),Fe=ht(Ae,1,1-xe,2+xe,0,-1,2,ge);return(we||Fe)&&(Ee=ht(Ae,1,-xe,1+xe,0,-1,2,ge)||[],we&&(Ee=Pi(we,1).concat(Ee)),Fe&&(Ee=Ee.concat(Pi(Fe,-1)))),Ee}(re,Be),re.length&&this.splitTile(re,0,0,0),ue&&(re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Lr(Qe,Be,ue){return 32*((1<<Qe)*ue+Be)+Qe}function Xt(Qe,Be){return Be?Qe.properties[Be]:Qe.id}function xr(Qe,Be){if(Qe==null)return!0;if(Qe.type==="Feature")return Xt(Qe,Be)!=null;if(Qe.type==="FeatureCollection"){const ue=new Set;for(const re of Qe.features){const Ae=Xt(re,Be);if(Ae==null||ue.has(Ae))return!1;ue.add(Ae)}return!0}return!1}function er(Qe,Be){const ue=new Map;if(Qe!=null)if(Qe.type==="Feature")ue.set(Xt(Qe,Be),Qe);else for(const re of Qe.features)ue.set(Xt(re,Be),re);return ue}Tr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Tr.prototype.splitTile=function(Qe,Be,ue,re,Ae,ge,xe){for(var Ee=[Qe,Be,ue,re],we=this.options,Fe=we.debug;Ee.length;){re=Ee.pop(),ue=Ee.pop(),Be=Ee.pop(),Qe=Ee.pop();var ze=1<<Be,Ge=Lr(Be,ue,re),st=this.tiles[Ge];if(!st&&(Fe>1&&console.time("creation"),st=this.tiles[Ge]=Wt(Qe,Be,ue,re,we),this.tileCoords.push({z:Be,x:ue,y:re}),Fe)){Fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Be,ue,re,st.numFeatures,st.numPoints,st.numSimplified),console.timeEnd("creation"));var vt="z"+Be;this.stats[vt]=(this.stats[vt]||0)+1,this.total++}if(st.source=Qe,Ae){if(Be===we.maxZoom||Be===Ae)continue;var Tt=1<<Ae-Be;if(ue!==Math.floor(ge/Tt)||re!==Math.floor(xe/Tt))continue}else if(Be===we.indexMaxZoom||st.numPoints<=we.indexMaxPoints)continue;if(st.source=null,Qe.length!==0){Fe>1&&console.time("clipping");var Kt,rr,Gt,dr,Cr,Gr,Er=.5*we.buffer/we.extent,zr=.5-Er,ot=.5+Er,ir=1+Er;Kt=rr=Gt=dr=null,Cr=ht(Qe,ze,ue-Er,ue+ot,0,st.minX,st.maxX,we),Gr=ht(Qe,ze,ue+zr,ue+ir,0,st.minX,st.maxX,we),Qe=null,Cr&&(Kt=ht(Cr,ze,re-Er,re+ot,1,st.minY,st.maxY,we),rr=ht(Cr,ze,re+zr,re+ir,1,st.minY,st.maxY,we),Cr=null),Gr&&(Gt=ht(Gr,ze,re-Er,re+ot,1,st.minY,st.maxY,we),dr=ht(Gr,ze,re+zr,re+ir,1,st.minY,st.maxY,we),Gr=null),Fe>1&&console.timeEnd("clipping"),Ee.push(Kt||[],Be+1,2*ue,2*re),Ee.push(rr||[],Be+1,2*ue,2*re+1),Ee.push(Gt||[],Be+1,2*ue+1,2*re),Ee.push(dr||[],Be+1,2*ue+1,2*re+1)}}},Tr.prototype.getTile=function(Qe,Be,ue){var re=this.options,Ae=re.extent,ge=re.debug;if(Qe<0||Qe>24)return null;var xe=1<<Qe,Ee=Lr(Qe,Be=(Be%xe+xe)%xe,ue);if(this.tiles[Ee])return Xr(this.tiles[Ee],Ae);ge>1&&console.log("drilling down to z%d-%d-%d",Qe,Be,ue);for(var we,Fe=Qe,ze=Be,Ge=ue;!we&&Fe>0;)Fe--,ze=Math.floor(ze/2),Ge=Math.floor(Ge/2),we=this.tiles[Lr(Fe,ze,Ge)];return we&&we.source?(ge>1&&console.log("found parent tile z%d-%d-%d",Fe,ze,Ge),ge>1&&console.time("drilling down"),this.splitTile(we.source,Fe,ze,Ge,Qe,Be,ue),ge>1&&console.timeEnd("drilling down"),this.tiles[Ee]?Xr(this.tiles[Ee],Ae):null):null};class vi extends I{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Be,ue){return a._(this,void 0,void 0,function*(){const re=Be.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Ae=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!Ae)return null;const ge=new class{constructor(Ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.W,this.length=Ee.length,this._features=Ee}feature(Ee){return new class{constructor(we){this._feature=we,this.extent=a.W,this.type=we.type,this.properties=we.tags,"id"in we&&!isNaN(we.id)&&(this.id=parseInt(we.id,10))}loadGeometry(){if(this._feature.type===1){const we=[];for(const Fe of this._feature.geometry)we.push([new a.P(Fe[0],Fe[1])]);return we}{const we=[];for(const Fe of this._feature.geometry){const ze=[];for(const Ge of Fe)ze.push(new a.P(Ge[0],Ge[1]));we.push(ze)}return we}}toGeoJSON(we,Fe,ze){return he.call(this,we,Fe,ze)}}(this._features[Ee])}}(Ae.features);let xe=Pt(ge);return xe.byteOffset===0&&xe.byteLength===xe.buffer.byteLength||(xe=new Uint8Array(xe)),{vectorTile:ge,rawData:xe.buffer}})}loadData(Be){return a._(this,void 0,void 0,function*(){var ue;(ue=this._pendingRequest)===null||ue===void 0||ue.abort();const re=!!(Be&&Be.request&&Be.request.collectResourceTiming)&&new a.bs(Be.request);this._pendingRequest=new AbortController;try{let Ae=yield this.loadGeoJSON(Be,this._pendingRequest);if(delete this._pendingRequest,typeof Ae!="object")throw new Error(`Input data given to '${Be.source}' is not a valid GeoJSON object.`);if(Y(Ae,!0),Be.filter){const xe=a.by(Be.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(xe.result==="error")throw new Error(xe.value.map(we=>`${we.key}: ${we.message}`).join(", "));Ae={type:"FeatureCollection",features:Ae.features.filter(we=>xe.value.evaluate({zoom:0},we))}}this._geoJSONIndex=Be.cluster?new rt(function(xe){let{superclusterOptions:Ee,clusterProperties:we}=xe;if(!we||!Ee)return Ee;const Fe={},ze={},Ge={accumulated:null,zoom:0},st={properties:null},vt=Object.keys(we);for(const Tt of vt){const[Kt,rr]=we[Tt],Gt=a.by(rr),dr=a.by(typeof Kt=="string"?[Kt,["accumulated"],["get",Tt]]:Kt);Fe[Tt]=Gt.value,ze[Tt]=dr.value}return Ee.map=Tt=>{st.properties=Tt;const Kt={};for(const rr of vt)Kt[rr]=Fe[rr].evaluate(Ge,st);return Kt},Ee.reduce=(Tt,Kt)=>{st.properties=Kt;for(const rr of vt)Ge.accumulated=Tt[rr],Tt[rr]=ze[rr].evaluate(Ge,st)},Ee}(Be)).load(Ae.features):function(xe,Ee){return new Tr(xe,Ee)}(Ae,Be.geojsonVtOptions),this.loaded={};const ge={};if(re){const xe=re.finish();xe&&(ge.resourceTiming={},ge.resourceTiming[Be.source]=JSON.parse(JSON.stringify(xe)))}return ge}catch(Ae){if(delete this._pendingRequest,a.bz(Ae))return{abandoned:!0};throw Ae}})}reloadTile(Be){const ue=this.loaded;return ue&&ue[Be.uid]?super.reloadTile(Be):this.loadTile(Be)}loadGeoJSON(Be,ue){return a._(this,void 0,void 0,function*(){const{promoteId:re}=Be;if(Be.request){const Ae=yield a.h(Be.request,ue);return this._dataUpdateable=xr(Ae.data,re)?er(Ae.data,re):void 0,Ae.data}if(typeof Be.data=="string")try{const Ae=JSON.parse(Be.data);return this._dataUpdateable=xr(Ae,re)?er(Ae,re):void 0,Ae}catch{throw new Error(`Input data given to '${Be.source}' is not a valid GeoJSON object.`)}if(!Be.dataDiff)throw new Error(`Input data given to '${Be.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Be.source}`);return function(Ae,ge,xe){var Ee,we,Fe,ze;if(ge.removeAll&&Ae.clear(),ge.remove)for(const Ge of ge.remove)Ae.delete(Ge);if(ge.add)for(const Ge of ge.add){const st=Xt(Ge,xe);st!=null&&Ae.set(st,Ge)}if(ge.update)for(const Ge of ge.update){let st=Ae.get(Ge.id);if(st==null)continue;const vt=!Ge.removeAllProperties&&(((Ee=Ge.removeProperties)===null||Ee===void 0?void 0:Ee.length)>0||((we=Ge.addOrUpdateProperties)===null||we===void 0?void 0:we.length)>0);if((Ge.newGeometry||Ge.removeAllProperties||vt)&&(st=Object.assign({},st),Ae.set(Ge.id,st),vt&&(st.properties=Object.assign({},st.properties))),Ge.newGeometry&&(st.geometry=Ge.newGeometry),Ge.removeAllProperties)st.properties={};else if(((Fe=Ge.removeProperties)===null||Fe===void 0?void 0:Fe.length)>0)for(const Tt of Ge.removeProperties)Object.prototype.hasOwnProperty.call(st.properties,Tt)&&delete st.properties[Tt];if(((ze=Ge.addOrUpdateProperties)===null||ze===void 0?void 0:ze.length)>0)for(const{key:Tt,value:Kt}of Ge.addOrUpdateProperties)st.properties[Tt]=Kt}}(this._dataUpdateable,Be.dataDiff,re),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Be){return a._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Be){return this._geoJSONIndex.getClusterExpansionZoom(Be.clusterId)}getClusterChildren(Be){return this._geoJSONIndex.getChildren(Be.clusterId)}getClusterLeaves(Be){return this._geoJSONIndex.getLeaves(Be.clusterId,Be.limit,Be.offset)}}class Zi{constructor(Be){this.self=Be,this.actor=new a.C(Be),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ue,re)=>{if(this.externalWorkerSourceTypes[ue])throw new Error(`Worker source with name "${ue}" already registered.`);this.externalWorkerSourceTypes[ue]=re},this.self.addProtocol=a.bf,this.self.removeProtocol=a.bg,this.self.registerRTLTextPlugin=ue=>{if(a.bA.isParsed())throw new Error("RTL text plugin already registered.");a.bA.setMethods(ue)},this.actor.registerMessageHandler("loadDEMTile",(ue,re)=>this._getDEMWorkerSource(ue,re.source).loadTile(re)),this.actor.registerMessageHandler("removeDEMTile",(ue,re)=>a._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ue,re.source).removeTile(re)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(ue,re)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(ue,re.type,re.source).getClusterExpansionZoom(re)})),this.actor.registerMessageHandler("getClusterChildren",(ue,re)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(ue,re.type,re.source).getClusterChildren(re)})),this.actor.registerMessageHandler("getClusterLeaves",(ue,re)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(ue,re.type,re.source).getClusterLeaves(re)})),this.actor.registerMessageHandler("loadData",(ue,re)=>this._getWorkerSource(ue,re.type,re.source).loadData(re)),this.actor.registerMessageHandler("loadTile",(ue,re)=>this._getWorkerSource(ue,re.type,re.source).loadTile(re)),this.actor.registerMessageHandler("reloadTile",(ue,re)=>this._getWorkerSource(ue,re.type,re.source).reloadTile(re)),this.actor.registerMessageHandler("abortTile",(ue,re)=>this._getWorkerSource(ue,re.type,re.source).abortTile(re)),this.actor.registerMessageHandler("removeTile",(ue,re)=>this._getWorkerSource(ue,re.type,re.source).removeTile(re)),this.actor.registerMessageHandler("removeSource",(ue,re)=>a._(this,void 0,void 0,function*(){if(!this.workerSources[ue]||!this.workerSources[ue][re.type]||!this.workerSources[ue][re.type][re.source])return;const Ae=this.workerSources[ue][re.type][re.source];delete this.workerSources[ue][re.type][re.source],Ae.removeSource!==void 0&&Ae.removeSource(re)})),this.actor.registerMessageHandler("removeMap",ue=>a._(this,void 0,void 0,function*(){delete this.layerIndexes[ue],delete this.availableImages[ue],delete this.workerSources[ue],delete this.demWorkerSources[ue]})),this.actor.registerMessageHandler("setReferrer",(ue,re)=>a._(this,void 0,void 0,function*(){this.referrer=re})),this.actor.registerMessageHandler("syncRTLPluginState",(ue,re)=>this._syncRTLPluginState(ue,re)),this.actor.registerMessageHandler("importScript",(ue,re)=>a._(this,void 0,void 0,function*(){this.self.importScripts(re)})),this.actor.registerMessageHandler("setImages",(ue,re)=>this._setImages(ue,re)),this.actor.registerMessageHandler("updateLayers",(ue,re)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(ue).update(re.layers,re.removedIds)})),this.actor.registerMessageHandler("setLayers",(ue,re)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(ue).replace(re)}))}_setImages(Be,ue){return a._(this,void 0,void 0,function*(){this.availableImages[Be]=ue;for(const re in this.workerSources[Be]){const Ae=this.workerSources[Be][re];for(const ge in Ae)Ae[ge].availableImages=ue}})}_syncRTLPluginState(Be,ue){return a._(this,void 0,void 0,function*(){if(a.bA.isParsed())return a.bA.getState();if(ue.pluginStatus!=="loading")return a.bA.setState(ue),ue;const re=ue.pluginURL;if(this.self.importScripts(re),a.bA.isParsed()){const Ae={pluginStatus:"loaded",pluginURL:re};return a.bA.setState(Ae),Ae}throw a.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${re}`)})}_getAvailableImages(Be){let ue=this.availableImages[Be];return ue||(ue=[]),ue}_getLayerIndex(Be){let ue=this.layerIndexes[Be];return ue||(ue=this.layerIndexes[Be]=new s),ue}_getWorkerSource(Be,ue,re){if(this.workerSources[Be]||(this.workerSources[Be]={}),this.workerSources[Be][ue]||(this.workerSources[Be][ue]={}),!this.workerSources[Be][ue][re]){const Ae={sendAsync:(ge,xe)=>(ge.targetMapId=Be,this.actor.sendAsync(ge,xe))};switch(ue){case"vector":this.workerSources[Be][ue][re]=new I(Ae,this._getLayerIndex(Be),this._getAvailableImages(Be));break;case"geojson":this.workerSources[Be][ue][re]=new vi(Ae,this._getLayerIndex(Be),this._getAvailableImages(Be));break;default:this.workerSources[Be][ue][re]=new this.externalWorkerSourceTypes[ue](Ae,this._getLayerIndex(Be),this._getAvailableImages(Be))}}return this.workerSources[Be][ue][re]}_getDEMWorkerSource(Be,ue){return this.demWorkerSources[Be]||(this.demWorkerSources[Be]={}),this.demWorkerSources[Be][ue]||(this.demWorkerSources[Be][ue]=new R),this.demWorkerSources[Be][ue]}}return a.i(self)&&(self.worker=new Zi(self)),Zi}),n("index",["exports","./shared"],function(a,s){var g="4.1.2";let y,T;const I={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:w=>new Promise((l,p)=>{const x=requestAnimationFrame(l);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(x),p(s.c())})}),getImageData(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(w).getImageData(-l,-l,w.width+2*l,w.height+2*l)},getImageCanvasContext(w){const l=window.document.createElement("canvas"),p=l.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return l.width=w.width,l.height=w.height,p.drawImage(w,0,0,w.width,w.height),p},resolveURL:w=>(y||(y=document.createElement("a")),y.href=w,y.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(T==null&&(T=matchMedia("(prefers-reduced-motion: reduce)")),T.matches)}};class R{static testProp(l){if(!R.docStyle)return l[0];for(let p=0;p<l.length;p++)if(l[p]in R.docStyle)return l[p];return l[0]}static create(l,p,x){const B=window.document.createElement(l);return p!==void 0&&(B.className=p),x&&x.appendChild(B),B}static createNS(l,p){return window.document.createElementNS(l,p)}static disableDrag(){R.docStyle&&R.selectProp&&(R.userSelect=R.docStyle[R.selectProp],R.docStyle[R.selectProp]="none")}static enableDrag(){R.docStyle&&R.selectProp&&(R.docStyle[R.selectProp]=R.userSelect)}static setTransform(l,p){l.style[R.transformProp]=p}static addEventListener(l,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};l.addEventListener(p,x,"passive"in B?B:B.capture)}static removeEventListener(l,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};l.removeEventListener(p,x,"passive"in B?B:B.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",R.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",R.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",R.suppressClickInternal,!0)},0)}static getScale(l){const p=l.getBoundingClientRect();return{x:p.width/l.offsetWidth||1,y:p.height/l.offsetHeight||1,boundingClientRect:p}}static getPoint(l,p,x){const B=p.boundingClientRect;return new s.P((x.clientX-B.left)/p.x-l.clientLeft,(x.clientY-B.top)/p.y-l.clientTop)}static mousePos(l,p){const x=R.getScale(l);return R.getPoint(l,x,p)}static touchPos(l,p){const x=[],B=R.getScale(l);for(let L=0;L<p.length;L++)x.push(R.getPoint(l,B,p[L]));return x}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}R.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,R.selectProp=R.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),R.transformProp=R.testProp(["transform","WebkitTransform"]);const U={supported:!1,testSupport:function(w){!he&&Y&&(ce?pe(w):Z=w)}};let Z,Y,he=!1,ce=!1;function pe(w){const l=w.createTexture();w.bindTexture(w.TEXTURE_2D,l);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,Y),w.isContextLost())return;U.supported=!0}catch{}w.deleteTexture(l),he=!0}var be,Te;typeof document<"u"&&(Y=document.createElement("img"),Y.onload=function(){Z&&pe(Z),Z=null,ce=!0},Y.onerror=function(){he=!0,Z=null},Y.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let l,p,x,B;w.resetRequestQueue=()=>{l=[],p=0,x=0,B={}},w.addThrottleControl=E=>{const F=x++;return B[F]=E,F},w.removeThrottleControl=E=>{delete B[E],j()},w.getImage=function(E,F){let V=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new Promise((q,K)=>{U.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),s.e(E,{type:"image"}),l.push({abortController:F,requestParameters:E,supportImageRefresh:V,state:"queued",onError:te=>{K(te)},onSuccess:te=>{q(te)}}),j()})};const L=E=>s._(this,void 0,void 0,function*(){E.state="running";const{requestParameters:F,supportImageRefresh:V,onError:q,onSuccess:K,abortController:te}=E,se=V===!1&&!s.i(self)&&!s.g(F.url)&&(!F.headers||Object.keys(F.headers).reduce((_e,Ie)=>_e&&Ie==="accept",!0));p++;const oe=se?_(F,te):s.m(F,te);try{const _e=yield oe;delete E.abortController,E.state="completed",_e.data instanceof HTMLImageElement||s.b(_e.data)?K(_e):_e.data&&K({data:yield(le=_e.data,typeof createImageBitmap=="function"?s.d(le):s.f(le)),cacheControl:_e.cacheControl,expires:_e.expires})}catch(_e){delete E.abortController,q(_e)}finally{p--,j()}var le}),j=()=>{const E=(()=>{for(const F of Object.keys(B))if(B[F]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let F=p;F<E&&l.length>0;F++){const V=l.shift();V.abortController.signal.aborted?F--:L(V)}},_=(E,F)=>new Promise((V,q)=>{const K=new Image,te=E.url,se=E.credentials;se&&se==="include"?K.crossOrigin="use-credentials":(se&&se==="same-origin"||!s.s(te))&&(K.crossOrigin="anonymous"),F.signal.addEventListener("abort",()=>{K.src="",q(s.c())}),K.fetchPriority="high",K.onload=()=>{K.onerror=K.onload=null,V({data:K})},K.onerror=()=>{K.onerror=K.onload=null,F.signal.aborted||q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},K.src=te})}(be||(be={})),be.resetRequestQueue(),function(w){w.Glyphs="Glyphs",w.Image="Image",w.Source="Source",w.SpriteImage="SpriteImage",w.SpriteJSON="SpriteJSON",w.Style="Style",w.Tile="Tile",w.Unknown="Unknown"}(Te||(Te={}));class qe{constructor(l){this._transformRequestFn=l}transformRequest(l,p){return this._transformRequestFn&&this._transformRequestFn(l,p)||{url:l}}normalizeSpriteURL(l,p,x){const B=function(L){const j=L.match(je);if(!j)throw new Error(`Unable to parse URL "${L}"`);return{protocol:j[1],authority:j[2],path:j[3]||"/",params:j[4]?j[4].split("&"):[]}}(l);return B.path+=`${p}${x}`,function(L){const j=L.params.length?`?${L.params.join("&")}`:"";return`${L.protocol}://${L.authority}${L.path}${j}`}(B)}setTransformRequest(l){this._transformRequestFn=l}}const je=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function We(w){var l=new s.A(3);return l[0]=w[0],l[1]=w[1],l[2]=w[2],l}var Ne,at=function(w,l,p){return w[0]=l[0]-p[0],w[1]=l[1]-p[1],w[2]=l[2]-p[2],w};Ne=new s.A(3),s.A!=Float32Array&&(Ne[0]=0,Ne[1]=0,Ne[2]=0);var nt=function(w){var l=w[0],p=w[1];return l*l+p*p};function ke(w){const l=[];if(typeof w=="string")l.push({id:"default",url:w});else if(w&&w.length>0){const p=[];for(const{id:x,url:B}of w){const L=`${x}${B}`;p.indexOf(L)===-1&&(p.push(L),l.push({id:x,url:B}))}}return l}(function(){var w=new s.A(2);s.A!=Float32Array&&(w[0]=0,w[1]=0)})();class De{constructor(l,p,x,B){this.context=l,this.format=x,this.texture=l.gl.createTexture(),this.update(p,B)}update(l,p,x){const{width:B,height:L}=l,j=!(this.size&&this.size[0]===B&&this.size[1]===L||x),{context:_}=this,{gl:E}=_;if(this.useMipmap=!!(p&&p.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!p||p.premultiply!==!1)),j)this.size=[B,L],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||s.b(l)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,l):E.texImage2D(E.TEXTURE_2D,0,this.format,B,L,0,this.format,E.UNSIGNED_BYTE,l.data);else{const{x:F,y:V}=x||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||s.b(l)?E.texSubImage2D(E.TEXTURE_2D,0,F,V,E.RGBA,E.UNSIGNED_BYTE,l):E.texSubImage2D(E.TEXTURE_2D,0,F,V,B,L,E.RGBA,E.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(l,p,x){const{context:B}=this,{gl:L}=B;L.bindTexture(L.TEXTURE_2D,this.texture),x!==L.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(x=L.LINEAR),l!==this.filter&&(L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MAG_FILTER,l),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,x||l),this.filter=l),p!==this.wrap&&(L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,p),L.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,p),this.wrap=p)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function Ye(w){const{userImage:l}=w;return!!(l&&l.render&&l.render())&&(w.data.replace(new Uint8Array(l.data.buffer)),!0)}class Xe extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:p,promiseResolve:x}of this.requestors)x(this._getImagesForIds(p));this.requestors=[]}}getImage(l){const p=this.images[l];if(p&&!p.data&&p.spriteData){const x=p.spriteData;p.data=new s.R({width:x.width,height:x.height},x.context.getImageData(x.x,x.y,x.width,x.height).data),p.spriteData=null}return p}addImage(l,p){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,p)&&(this.images[l]=p)}_validate(l,p){let x=!0;const B=p.data||p.spriteData;return this._validateStretch(p.stretchX,B&&B.width)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "stretchX" value`))),x=!1),this._validateStretch(p.stretchY,B&&B.height)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "stretchY" value`))),x=!1),this._validateContent(p.content,p)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "content" value`))),x=!1),x}_validateStretch(l,p){if(!l)return!0;let x=0;for(const B of l){if(B[0]<x||B[1]<B[0]||p<B[1])return!1;x=B[1]}return!0}_validateContent(l,p){if(!l)return!0;if(l.length!==4)return!1;const x=p.spriteData,B=x&&x.width||p.data.width,L=x&&x.height||p.data.height;return!(l[0]<0||B<l[0]||l[1]<0||L<l[1]||l[2]<0||B<l[2]||l[3]<0||L<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,p){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const B=this.getImage(l);if(x&&(B.data.width!==p.data.width||B.data.height!==p.data.height))throw new Error(`size mismatch between old image (${B.data.width}x${B.data.height}) and new image (${p.data.width}x${p.data.height}).`);p.version=B.version+1,this.images[l]=p,this.updatedImages[l]=!0}removeImage(l){const p=this.images[l];delete this.images[l],delete this.patterns[l],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((p,x)=>{let B=!0;if(!this.isLoaded())for(const L of l)this.images[L]||(B=!1);this.isLoaded()||B?p(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:p})})}_getImagesForIds(l){const p={};for(const x of l){let B=this.getImage(x);B||(this.fire(new s.k("styleimagemissing",{id:x})),B=this.getImage(x)),B?p[x]={data:B.data.clone(),pixelRatio:B.pixelRatio,sdf:B.sdf,version:B.version,stretchX:B.stretchX,stretchY:B.stretchY,content:B.content,hasRenderCallback:!!(B.userImage&&B.userImage.render)}:s.w(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return p}getPixelSize(){const{width:l,height:p}=this.atlasImage;return{width:l,height:p}}getPattern(l){const p=this.patterns[l],x=this.getImage(l);if(!x)return null;if(p&&p.position.version===x.version)return p.position;if(p)p.position.version=x.version;else{const B={w:x.data.width+2,h:x.data.height+2,x:0,y:0},L=new s.I(B,x);this.patterns[l]={bin:B,position:L}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const p=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new De(l,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const L in this.patterns)l.push(this.patterns[L].bin);const{w:p,h:x}=s.p(l),B=this.atlasImage;B.resize({width:p||1,height:x||1});for(const L in this.patterns){const{bin:j}=this.patterns[L],_=j.x+1,E=j.y+1,F=this.getImage(L).data,V=F.width,q=F.height;s.R.copy(F,B,{x:0,y:0},{x:_,y:E},{width:V,height:q}),s.R.copy(F,B,{x:0,y:q-1},{x:_,y:E-1},{width:V,height:1}),s.R.copy(F,B,{x:0,y:0},{x:_,y:E+q},{width:V,height:1}),s.R.copy(F,B,{x:V-1,y:0},{x:_-1,y:E},{width:1,height:q}),s.R.copy(F,B,{x:0,y:0},{x:_+V,y:E},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const p of l){if(this.callbackDispatchedThisFrame[p])continue;this.callbackDispatchedThisFrame[p]=!0;const x=this.getImage(p);x||s.w(`Image with ID: "${p}" was not found`),Ye(x)&&this.updateImage(p,x)}}}const Ct=1e20;function Et(w,l,p,x,B,L,j,_,E){for(let F=l;F<l+x;F++)Pt(w,p*L+F,L,B,j,_,E);for(let F=p;F<p+B;F++)Pt(w,F*L+l,1,x,j,_,E)}function Pt(w,l,p,x,B,L,j){L[0]=0,j[0]=-Ct,j[1]=Ct,B[0]=w[l];for(let _=1,E=0,F=0;_<x;_++){B[_]=w[l+_*p];const V=_*_;do{const q=L[E];F=(B[_]-B[q]+V-q*q)/(_-q)/2}while(F<=j[E]&&--E>-1);E++,L[E]=_,j[E]=F,j[E+1]=Ct}for(let _=0,E=0;_<x;_++){for(;j[E+1]<_;)E++;const F=L[E],V=_-F;w[l+_*p]=B[F]+V*V}}class bt{constructor(l,p){this.requestManager=l,this.localIdeographFontFamily=p,this.entries={}}setURL(l){this.url=l}getGlyphs(l){return s._(this,void 0,void 0,function*(){const p=[];for(const L in l)for(const j of l[L])p.push(this._getAndCacheGlyphsPromise(L,j));const x=yield Promise.all(p),B={};for(const{stack:L,id:j,glyph:_}of x)B[L]||(B[L]={}),B[L][j]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics};return B})}_getAndCacheGlyphsPromise(l,p){return s._(this,void 0,void 0,function*(){let x=this.entries[l];x||(x=this.entries[l]={glyphs:{},requests:{},ranges:{}});let B=x.glyphs[p];if(B!==void 0)return{stack:l,id:p,glyph:B};if(B=this._tinySDF(x,l,p),B)return x.glyphs[p]=B,{stack:l,id:p,glyph:B};const L=Math.floor(p/256);if(256*L>65535)throw new Error("glyphs > 65535 not supported");if(x.ranges[L])return{stack:l,id:p,glyph:B};if(!this.url)throw new Error("glyphsUrl is not set");if(!x.requests[L]){const _=bt.loadGlyphRange(l,L,this.url,this.requestManager);x.requests[L]=_}const j=yield x.requests[L];for(const _ in j)this._doesCharSupportLocalGlyph(+_)||(x.glyphs[+_]=j[+_]);return x.ranges[L]=!0,{stack:l,id:p,glyph:j[p]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](l)||s.u["Hangul Syllables"](l)||s.u.Hiragana(l)||s.u.Katakana(l))}_tinySDF(l,p,x){const B=this.localIdeographFontFamily;if(!B||!this._doesCharSupportLocalGlyph(x))return;let L=l.tinySDF;if(!L){let _="400";/bold/i.test(p)?_="900":/medium/i.test(p)?_="500":/light/i.test(p)&&(_="200"),L=l.tinySDF=new bt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:B,fontWeight:_})}const j=L.draw(String.fromCharCode(x));return{id:x,bitmap:new s.o({width:j.width||60,height:j.height||60},j.data),metrics:{width:j.glyphWidth/2||24,height:j.glyphHeight/2||24,left:j.glyphLeft/2+.5||0,top:j.glyphTop/2-27.5||-8,advance:j.glyphAdvance/2||24,isDoubleResolution:!0}}}}bt.loadGlyphRange=function(w,l,p,x){return s._(this,void 0,void 0,function*(){const B=256*l,L=B+255,j=x.transformRequest(p.replace("{fontstack}",w).replace("{range}",`${B}-${L}`),Te.Glyphs),_=yield s.l(j,new AbortController);if(!_||!_.data)throw new Error(`Could not load glyph range. range: ${l}, ${B}-${L}`);const E={};for(const F of s.n(_.data))E[F.id]=F;return E})},bt.TinySDF=class{constructor(){let{fontSize:w=24,buffer:l=3,radius:p=8,cutoff:x=.25,fontFamily:B="sans-serif",fontWeight:L="normal",fontStyle:j="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=l,this.cutoff=x,this.radius=p;const _=this.size=w+4*l,E=this._createCanvas(_),F=this.ctx=E.getContext("2d",{willReadFrequently:!0});F.font=`${j} ${L} ${w}px ${B}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(w){const l=document.createElement("canvas");return l.width=l.height=w,l}draw(w){const{width:l,actualBoundingBoxAscent:p,actualBoundingBoxDescent:x,actualBoundingBoxLeft:B,actualBoundingBoxRight:L}=this.ctx.measureText(w),j=Math.ceil(p),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(L-B))),E=Math.min(this.size-this.buffer,j+Math.ceil(x)),F=_+2*this.buffer,V=E+2*this.buffer,q=Math.max(F*V,0),K=new Uint8ClampedArray(q),te={data:K,width:F,height:V,glyphWidth:_,glyphHeight:E,glyphTop:j,glyphLeft:0,glyphAdvance:l};if(_===0||E===0)return te;const{ctx:se,buffer:oe,gridInner:le,gridOuter:_e}=this;se.clearRect(oe,oe,_,E),se.fillText(w,oe,oe+j);const Ie=se.getImageData(oe,oe,_,E);_e.fill(Ct,0,q),le.fill(0,0,q);for(let ve=0;ve<E;ve++)for(let Se=0;Se<_;Se++){const et=Ie.data[4*(ve*_+Se)+3]/255;if(et===0)continue;const Oe=(ve+oe)*F+Se+oe;if(et===1)_e[Oe]=0,le[Oe]=Ct;else{const Re=.5-et;_e[Oe]=Re>0?Re*Re:0,le[Oe]=Re<0?Re*Re:0}}Et(_e,0,0,F,V,F,this.f,this.v,this.z),Et(le,oe,oe,_,E,F,this.f,this.v,this.z);for(let ve=0;ve<q;ve++){const Se=Math.sqrt(_e[ve])-Math.sqrt(le[ve]);K[ve]=Math.round(255-255*(Se/this.radius+this.cutoff))}return te}};class Rt{constructor(){this.specification=s.v.light.position}possiblyEvaluate(l,p){return s.y(l.expression.evaluate(p))}interpolate(l,p,x){return{x:s.z.number(l.x,p.x,x),y:s.z.number(l.y,p.y,x),z:s.z.number(l.z,p.z,x)}}}let Ft;class Zt extends s.E{constructor(l){super(),Ft=Ft||new s.q({anchor:new s.D(s.v.light.anchor),position:new Rt,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(Ft),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(s.r,l,p))for(const x in l){const B=l[x];x.endsWith("-transition")?this._transitionable.setTransition(x.slice(0,-11),B):this._transitionable.setValue(x,B)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,p,x){return(!x||x.validate!==!1)&&s.t(this,l.call(s.x,{value:p,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}class Le{constructor(l,p){this.width=l,this.height=p,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,p){const x=l.join(",")+String(p);return this.dashEntry[x]||(this.dashEntry[x]=this.addDash(l,p)),this.dashEntry[x]}getDashRanges(l,p,x){const B=[];let L=l.length%2==1?-l[l.length-1]*x:0,j=l[0]*x,_=!0;B.push({left:L,right:j,isDash:_,zeroLength:l[0]===0});let E=l[0];for(let F=1;F<l.length;F++){_=!_;const V=l[F];L=E*x,E+=V,j=E*x,B.push({left:L,right:j,isDash:_,zeroLength:V===0})}return B}addRoundDash(l,p,x){const B=p/2;for(let L=-x;L<=x;L++){const j=this.width*(this.nextRow+x+L);let _=0,E=l[_];for(let F=0;F<this.width;F++){F/E.right>1&&(E=l[++_]);const V=Math.abs(F-E.left),q=Math.abs(F-E.right),K=Math.min(V,q);let te;const se=L/x*(B+1);if(E.isDash){const oe=B-Math.abs(se);te=Math.sqrt(K*K+oe*oe)}else te=B-Math.sqrt(K*K+se*se);this.data[j+F]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(l){for(let _=l.length-1;_>=0;--_){const E=l[_],F=l[_+1];E.zeroLength?l.splice(_,1):F&&F.isDash===E.isDash&&(F.left=E.left,l.splice(_,1))}const p=l[0],x=l[l.length-1];p.isDash===x.isDash&&(p.left=x.left-this.width,x.right=p.right+this.width);const B=this.width*this.nextRow;let L=0,j=l[L];for(let _=0;_<this.width;_++){_/j.right>1&&(j=l[++L]);const E=Math.abs(_-j.left),F=Math.abs(_-j.right),V=Math.min(E,F);this.data[B+_]=Math.max(0,Math.min(255,(j.isDash?V:-V)+128))}}addDash(l,p){const x=p?7:0,B=2*x+1;if(this.nextRow+B>this.height)return s.w("LineAtlas out of space"),null;let L=0;for(let _=0;_<l.length;_++)L+=l[_];if(L!==0){const _=this.width/L,E=this.getDashRanges(l,this.width,_);p?this.addRoundDash(E,_,x):this.addRegularDash(E)}const j={y:(this.nextRow+x+.5)/this.height,height:2*x/this.height,width:L};return this.nextRow+=B,this.dirty=!0,j}bind(l){const p=l.gl;this.texture?(p.bindTexture(p.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,p.texSubImage2D(p.TEXTURE_2D,0,0,0,this.width,this.height,p.ALPHA,p.UNSIGNED_BYTE,this.data))):(this.texture=p.createTexture(),p.bindTexture(p.TEXTURE_2D,this.texture),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR),p.texImage2D(p.TEXTURE_2D,0,p.ALPHA,this.width,this.height,0,p.ALPHA,p.UNSIGNED_BYTE,this.data))}}const Ze="maplibre_preloaded_worker_pool";class rt{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<rt.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(p=>{p.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ze]}numActive(){return Object.keys(this.active).length}}const pt=Math.floor(I.hardwareConcurrency/2);let mt,Bt;function Dt(){return mt||(mt=new rt),mt}rt.workerCount=s.B(globalThis)?Math.max(Math.min(pt,3),1):1;class Mt{constructor(l,p){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=p;const x=this.workerPool.acquire(p);for(let B=0;B<x.length;B++){const L=new s.C(x[B],p);L.name=`Worker ${B}`,this.actors.push(L)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,p){const x=[];for(const B of this.actors)x.push(B.sendAsync({type:l,data:p}));return Promise.all(x)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(p=>{p.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,p){for(const x of this.actors)x.registerMessageHandler(l,p)}}function qt(){return Bt||(Bt=new Mt(Dt(),s.G),Bt.registerMessageHandler("getResource",(w,l,p)=>s.m(l,p))),Bt}function nr(w,l){const p=s.F();return s.H(p,p,[1,1,0]),s.J(p,p,[.5*w.width,.5*w.height,1]),s.K(p,p,w.calculatePosMatrix(l.toUnwrapped()))}function vr(w,l,p,x,B,L){const j=function(q,K,te){if(q)for(const se of q){const oe=K[se];if(oe&&oe.source===te&&oe.type==="fill-extrusion")return!0}else for(const se in K){const oe=K[se];if(oe.source===te&&oe.type==="fill-extrusion")return!0}return!1}(B&&B.layers,l,w.id),_=L.maxPitchScaleFactor(),E=w.tilesIn(x,_,j);E.sort(br);const F=[];for(const q of E)F.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(l,p,w._state,q.queryGeometry,q.cameraQueryGeometry,q.scale,B,L,_,nr(w.transform,q.tileID))});const V=function(q){const K={},te={};for(const se of q){const oe=se.queryResults,le=se.wrappedTileID,_e=te[le]=te[le]||{};for(const Ie in oe){const ve=oe[Ie],Se=_e[Ie]=_e[Ie]||{},et=K[Ie]=K[Ie]||[];for(const Oe of ve)Se[Oe.featureIndex]||(Se[Oe.featureIndex]=!0,et.push(Oe))}}return K}(F);for(const q in V)V[q].forEach(K=>{const te=K.feature,se=w.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=se});return V}function br(w,l){const p=w.tileID,x=l.tileID;return p.overscaledZ-x.overscaledZ||p.canonical.y-x.canonical.y||p.wrap-x.wrap||p.canonical.x-x.canonical.x}function Fr(w,l,p){return s._(this,void 0,void 0,function*(){let x=w;if(w.url?x=(yield s.h(l.transformRequest(w.url,Te.Source),p)).data:yield I.frameAsync(p),!x)return null;const B=s.L(s.e(x,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in x&&x.vector_layers&&(B.vectorLayerIds=x.vector_layers.map(L=>L.id)),B})}class kt{constructor(l,p){l&&(p?this.setSouthWest(l).setNorthEast(p):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof s.M?new s.M(l.lng,l.lat):s.M.convert(l),this}setSouthWest(l){return this._sw=l instanceof s.M?new s.M(l.lng,l.lat):s.M.convert(l),this}extend(l){const p=this._sw,x=this._ne;let B,L;if(l instanceof s.M)B=l,L=l;else{if(!(l instanceof kt))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(kt.convert(l)):this.extend(s.M.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(s.M.convert(l)):this;if(B=l._sw,L=l._ne,!B||!L)return this}return p||x?(p.lng=Math.min(B.lng,p.lng),p.lat=Math.min(B.lat,p.lat),x.lng=Math.max(L.lng,x.lng),x.lat=Math.max(L.lat,x.lat)):(this._sw=new s.M(B.lng,B.lat),this._ne=new s.M(L.lng,L.lat)),this}getCenter(){return new s.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.M(this.getWest(),this.getNorth())}getSouthEast(){return new s.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:p,lat:x}=s.M.convert(l);let B=this._sw.lng<=p&&p<=this._ne.lng;return this._sw.lng>this._ne.lng&&(B=this._sw.lng>=p&&p>=this._ne.lng),this._sw.lat<=x&&x<=this._ne.lat&&B}static convert(l){return l instanceof kt?l:l&&new kt(l)}static fromLngLat(l){const x=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,B=x/Math.cos(Math.PI/180*l.lat);return new kt(new s.M(l.lng-B,l.lat-x),new s.M(l.lng+B,l.lat+x))}}class lt{constructor(l,p,x){this.bounds=kt.convert(this.validateBounds(l)),this.minzoom=p||0,this.maxzoom=x||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const p=Math.pow(2,l.z),x=Math.floor(s.N(this.bounds.getWest())*p),B=Math.floor(s.O(this.bounds.getNorth())*p),L=Math.ceil(s.N(this.bounds.getEast())*p),j=Math.ceil(s.O(this.bounds.getSouth())*p);return l.x>=x&&l.x<L&&l.y>=B&&l.y<j}}class wt extends s.E{constructor(l,p,x,B){if(super(),this.id=l,this.dispatcher=x,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.L(p,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},p),this._collectResourceTiming=p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(B)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield Fr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(s.e(this,l),l.bounds&&(this.tileBounds=new lt(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new s.j(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(l){return s._(this,void 0,void 0,function*(){const p=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),x={request:this.map._requestManager.transformRequest(p,Te.Tile),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};x.request.collectResourceTiming=this._collectResourceTiming;let B="reloadTile";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((L,j)=>{l.reloadPromise={resolve:L,reject:j}})}else l.actor=this.dispatcher.getActor(),B="loadTile";l.abortController=new AbortController;try{const L=yield l.actor.sendAsync({type:B,data:x},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,L)}catch(L){if(delete l.abortController,l.aborted)return;if(L&&L.status!==404)throw L;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,p){if(p&&p.resourceTiming&&(l.resourceTiming=p.resourceTiming),p&&this.map._refreshExpiredTiles&&l.setExpiryData(p),l.loadVectorData(p,this.map.painter),l.reloadPromise){const x=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(x.resolve).catch(x.reject)}}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"abortTile",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"removeTile",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ur extends s.E{constructor(l,p,x,B){super(),this.id=l,this.dispatcher=x,this.setEventedParent(B),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},p),s.e(this,s.L(p,["url","scheme","tileSize"]))}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield Fr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(s.e(this,l),l.bounds&&(this.tileBounds=new lt(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new s.j(l))}})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return s.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return s._(this,void 0,void 0,function*(){const p=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const x=yield be.getImage(this.map._requestManager.transformRequest(p,Te.Tile),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(x&&x.data){this.map._refreshExpiredTiles&&x.cacheControl&&x.expires&&l.setExpiryData({cacheControl:x.cacheControl,expires:x.expires});const B=this.map.painter.context,L=B.gl,j=x.data;l.texture=this.map.painter.getTileTexture(j.width),l.texture?l.texture.update(j,{useMipmap:!0}):(l.texture=new De(B,j,L.RGBA,{useMipmap:!0}),l.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),B.extTextureFilterAnisotropic&&L.texParameterf(L.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax)),l.state="loaded"}}catch(x){if(delete l.abortController,l.aborted)l.state="unloaded";else if(x)throw l.state="errored",x}})}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class tr extends Ur{constructor(l,p,x,B){super(l,p,x,B),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},p),this.encoding=p.encoding||"mapbox",this.redFactor=p.redFactor,this.greenFactor=p.greenFactor,this.blueFactor=p.blueFactor,this.baseShift=p.baseShift}loadTile(l){return s._(this,void 0,void 0,function*(){const p=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),x=this.map._requestManager.transformRequest(p,Te.Tile);l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const B=yield be.getImage(x,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(B&&B.data){const L=B.data;this.map._refreshExpiredTiles&&B.cacheControl&&B.expires&&l.setExpiryData({cacheControl:B.cacheControl,expires:B.expires});const j=s.b(L)&&s.S()?L:yield this.readImageNow(L),_={type:this.type,uid:l.uid,source:this.id,rawImageData:j,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const E=yield l.actor.sendAsync({type:"loadDEMTile",data:_});l.dem=E,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(B){if(delete l.abortController,l.aborted)l.state="unloaded";else if(B)throw l.state="errored",B}})}readImageNow(l){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.U()){const p=l.width+2,x=l.height+2;try{return new s.R({width:p,height:x},yield s.V(l,-1,-1,p,x))}catch{}}return I.getImageData(l,1)})}_getNeighboringTiles(l){const p=l.canonical,x=Math.pow(2,p.z),B=(p.x-1+x)%x,L=p.x===0?l.wrap-1:l.wrap,j=(p.x+1+x)%x,_=p.x+1===x?l.wrap+1:l.wrap,E={};return E[new s.Q(l.overscaledZ,L,p.z,B,p.y).key]={backfilled:!1},E[new s.Q(l.overscaledZ,_,p.z,j,p.y).key]={backfilled:!1},p.y>0&&(E[new s.Q(l.overscaledZ,L,p.z,B,p.y-1).key]={backfilled:!1},E[new s.Q(l.overscaledZ,l.wrap,p.z,p.x,p.y-1).key]={backfilled:!1},E[new s.Q(l.overscaledZ,_,p.z,j,p.y-1).key]={backfilled:!1}),p.y+1<x&&(E[new s.Q(l.overscaledZ,L,p.z,B,p.y+1).key]={backfilled:!1},E[new s.Q(l.overscaledZ,l.wrap,p.z,p.x,p.y+1).key]={backfilled:!1},E[new s.Q(l.overscaledZ,_,p.z,j,p.y+1).key]={backfilled:!1}),E}unloadTile(l){return s._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class ht extends s.E{constructor(l,p,x,B){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=x.getActor(),this.setEventedParent(B),this._data=p.data,this._options=s.e({},p),this._collectResourceTiming=p.collectResourceTiming,p.maxzoom!==void 0&&(this.maxzoom=p.maxzoom),p.type&&(this.type=p.type),p.attribution&&(this.attribution=p.attribution),this.promoteId=p.promoteId;const L=s.W/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:p.cluster||!1,geojsonVtOptions:{buffer:(p.buffer!==void 0?p.buffer:128)*L,tolerance:(p.tolerance!==void 0?p.tolerance:.375)*L,extent:s.W,maxZoom:this.maxzoom,lineMetrics:p.lineMetrics||!1,generateId:p.generateId||!1},superclusterOptions:{maxZoom:p.clusterMaxZoom!==void 0?p.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,p.clusterMinPoints||2),extent:s.W,radius:(p.clusterRadius||50)*L,log:!1,generateId:p.generateId||!1},clusterProperties:p.clusterProperties,filter:p.filter},p.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=l.clusterRadius),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,p,x){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:l,limit:p,offset:x}})}_updateWorkerData(l){return s._(this,void 0,void 0,function*(){const p=s.e({type:this.type},this.workerOptions);l?p.dataDiff=l:typeof this._data=="string"?(p.request=this.map._requestManager.transformRequest(I.resolveURL(this._data),Te.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"}));try{const x=yield this.actor.sendAsync({type:"loadData",data:p});if(this._pendingLoads--,this._removed||x.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let B=null;x.resourceTiming&&x.resourceTiming[this.id]&&(B=x.resourceTiming[this.id].slice(0));const L={dataType:"source"};this._collectResourceTiming&&B&&B.length>0&&s.e(L,{resourceTiming:B}),this.fire(new s.k("data",Object.assign(Object.assign({},L),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},L),{sourceDataType:"content"})))}catch(x){if(this._pendingLoads--,this._removed)return void this.fire(new s.k("dataabort",{dataType:"source"}));this.fire(new s.j(x))}})}loaded(){return this._pendingLoads===0}loadTile(l){return s._(this,void 0,void 0,function*(){const p=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const x={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.abortController=new AbortController;const B=yield this.actor.sendAsync({type:p,data:x},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(B,this.map.painter,p==="reloadTile")})}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var $t=s.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class or extends s.E{constructor(l,p,x,B){super(),this.id=l,this.dispatcher=x,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(B),this.options=p}load(l){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const p=yield be.getImage(this.map._requestManager.transformRequest(this.url,Te.Image),this._request);this._request=null,this._loaded=!0,p&&p.data&&(this.image=p.data,l&&(this.coordinates=l),this._finishLoading())}catch(p){this._request=null,this.fire(new s.j(p))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const p=l.map(s.Y.fromLngLat);this.tileID=function(B){let L=1/0,j=1/0,_=-1/0,E=-1/0;for(const K of B)L=Math.min(L,K.x),j=Math.min(j,K.y),_=Math.max(_,K.x),E=Math.max(E,K.y);const F=Math.max(_-L,E-j),V=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),q=Math.pow(2,V);return new s.a0(V,Math.floor((L+_)/2*q),Math.floor((j+E)/2*q))}(p),this.minzoom=this.maxzoom=this.tileID.z;const x=p.map(B=>this.tileID.getTilePoint(B)._round());return this._boundsArray=new s.Z,this._boundsArray.emplaceBack(x[0].x,x[0].y,0,0),this._boundsArray.emplaceBack(x[1].x,x[1].y,s.W,0),this._boundsArray.emplaceBack(x[3].x,x[3].y,0,s.W),this._boundsArray.emplaceBack(x[2].x,x[2].y,s.W,s.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,p=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,$t.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new De(l,this.image,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE));let x=!1;for(const B in this.tiles){const L=this.tiles[B];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture,x=!0)}x&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class mr extends or{constructor(l,p,x,B){super(l,p,x,B),this.roundZoom=!0,this.type="video",this.options=p}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const p of l.urls)this.urls.push(this.map._requestManager.transformRequest(p,Te.Source).url);try{const p=yield s.a2(this.urls);if(this._loaded=!0,!p)return;this.video=p,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(p){this.fire(new s.j(p))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const p=this.video.seekable;l<p.start(0)||l>p.end(0)?this.fire(new s.j(new s.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${p.start(0)} and ${p.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,p=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,$t.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),p.texSubImage2D(p.TEXTURE_2D,0,0,0,p.RGBA,p.UNSIGNED_BYTE,this.video)):(this.texture=new De(l,this.video,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE));let x=!1;for(const B in this.tiles){const L=this.tiles[B];L.state!=="loaded"&&(L.state="loaded",L.texture=this.texture,x=!0)}x&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ur extends or{constructor(l,p,x,B){super(l,p,x,B),p.coordinates?Array.isArray(p.coordinates)&&p.coordinates.length===4&&!p.coordinates.some(L=>!Array.isArray(L)||L.length!==2||L.some(j=>typeof j!="number"))||this.fire(new s.j(new s.a1(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.a1(`sources.${l}`,null,'missing required property "coordinates"'))),p.animate&&typeof p.animate!="boolean"&&this.fire(new s.j(new s.a1(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),p.canvas?typeof p.canvas=="string"||p.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.a1(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.a1(`sources.${l}`,null,'missing required property "canvas"'))),this.options=p,this.animate=p.animate===void 0||p.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const p=this.map.painter.context,x=p.gl;this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,$t.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new De(p,this.canvas,x.RGBA,{premultiply:!0});let B=!1;for(const L in this.tiles){const j=this.tiles[L];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture,B=!0)}B&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const Wr={},ri=w=>{switch(w){case"geojson":return ht;case"image":return or;case"raster":return Ur;case"raster-dem":return tr;case"vector":return wt;case"video":return mr;case"canvas":return ur}return Wr[w]},gi="RTLPluginLoaded";class Pi extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=qt()}_syncState(l){return this.status=l,this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:l,pluginURL:this.url}).catch(p=>{throw this.status="error",p})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return s._(this,arguments,void 0,function(p){var x=this;let B=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(x.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(x.url=I.resolveURL(p),!x.url)throw new Error(`requested url ${p} is invalid`);if(x.status==="unavailable"){if(!B)return x._requestImport();x.status="deferred",x._syncState(x.status)}else if(x.status==="requested")return x._requestImport()}()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.k(gi))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let zt=null;function Xr(){return zt||(zt=new Pi),zt}class Ar{constructor(l,p){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=s.a3(),this.uses=0,this.tileSize=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const p=l+this.timeAdded;p<this.fadeEndTime||(this.fadeEndTime=p)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,p,x){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(B,L){const j={};if(!L)return j;for(const _ of B){const E=_.layerIds.map(F=>L.getLayer(F)).filter(Boolean);if(E.length!==0){_.layers=E,_.stateDependentLayerIds&&(_.stateDependentLayers=_.stateDependentLayerIds.map(F=>E.filter(V=>V.id===F)[0]));for(const F of E)j[F.id]=_}}return j}(l.buckets,p.style),this.hasSymbolBuckets=!1;for(const B in this.buckets){const L=this.buckets[B];if(L instanceof s.a5){if(this.hasSymbolBuckets=!0,!x)break;L.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const B in this.buckets){const L=this.buckets[B];if(L instanceof s.a5&&L.hasRTLText){this.hasRTLText=!0,Xr().lazyLoad();break}}this.queryPadding=0;for(const B in this.buckets){const L=this.buckets[B];this.queryPadding=Math.max(this.queryPadding,p.style.getLayer(B).queryRadius(L))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new s.a4}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const x in this.buckets){const B=this.buckets[x];B.uploadPending()&&B.upload(l)}const p=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new De(l,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new De(l,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,p,x,B,L,j,_,E,F,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:B,cameraQueryGeometry:L,scale:j,tileSize:this.tileSize,pixelPosMatrix:V,transform:E,params:_,queryPadding:this.queryPadding*F},l,p,x):{}}querySourceFeatures(l,p){const x=this.latestFeatureIndex;if(!x||!x.rawTileData)return;const B=x.loadVTLayers(),L=p&&p.sourceLayer?p.sourceLayer:"",j=B._geojsonTileLayer||B[L];if(!j)return;const _=s.a6(p&&p.filter),{z:E,x:F,y:V}=this.tileID.canonical,q={z:E,x:F,y:V};for(let K=0;K<j.length;K++){const te=j.feature(K);if(_.needGeometry){const le=s.a7(te,!0);if(!_.filter(new s.a8(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!_.filter(new s.a8(this.tileID.overscaledZ),te))continue;const se=x.getId(te,L),oe=new s.a9(te,E,F,V,se);oe.tile=q,l.push(oe)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const p=this.expirationTime;if(l.cacheControl){const x=s.aa(l.cacheControl);x["max-age"]&&(this.expirationTime=Date.now()+1e3*x["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const x=Date.now();let B=!1;if(this.expirationTime>x)B=!1;else if(p)if(this.expirationTime<p)B=!0;else{const L=this.expirationTime-p;L?this.expirationTime=x+Math.max(L,3e4):B=!0}else B=!0;B?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,p){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const x=this.latestFeatureIndex.loadVTLayers();for(const B in this.buckets){if(!p.style.hasLayer(B))continue;const L=this.buckets[B],j=L.layers[0].sourceLayer||"_geojsonTileLayer",_=x[j],E=l[j];if(!_||!E||Object.keys(E).length===0)continue;L.update(E,_,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=p&&p.style&&p.style.getLayer(B);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(L)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<I.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=I.now()+l}setDependencies(l,p){const x={};for(const B of p)x[B]=!0;this.dependencies[l]=x}hasDependency(l,p){for(const x of l){const B=this.dependencies[x];if(B){for(const L of p)if(B[L])return!0}}return!1}}class Wt{constructor(l,p){this.max=l,this.onRemove=p,this.reset()}reset(){for(const l in this.data)for(const p of this.data[l])p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value);return this.data={},this.order=[],this}add(l,p,x){const B=l.wrapped().key;this.data[B]===void 0&&(this.data[B]=[]);const L={value:p,timeout:void 0};if(x!==void 0&&(L.timeout=setTimeout(()=>{this.remove(l,L)},x)),this.data[B].push(L),this.order.push(B),this.order.length>this.max){const j=this._getAndRemoveByKey(this.order[0]);j&&this.onRemove(j)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const p=this.data[l].shift();return p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),p.value}getByKey(l){const p=this.data[l];return p?p[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,p){if(!this.has(l))return this;const x=l.wrapped().key,B=p===void 0?0:this.data[x].indexOf(p),L=this.data[x][B];return this.data[x].splice(B,1),L.timeout&&clearTimeout(L.timeout),this.data[x].length===0&&delete this.data[x],this.onRemove(L.value),this.order.splice(this.order.indexOf(x),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}filter(l){const p=[];for(const x in this.data)for(const B of this.data[x])l(B.value)||p.push(B);for(const x of p)this.remove(x.value.tileID,x)}}class di{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,p,x){const B=String(p);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][B]=this.stateChanges[l][B]||{},s.e(this.stateChanges[l][B],x),this.deletedStates[l]===null){this.deletedStates[l]={};for(const L in this.state[l])L!==B&&(this.deletedStates[l][L]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][B]===null){this.deletedStates[l][B]={};for(const L in this.state[l][B])x[L]||(this.deletedStates[l][B][L]=null)}else for(const L in x)this.deletedStates[l]&&this.deletedStates[l][B]&&this.deletedStates[l][B][L]===null&&delete this.deletedStates[l][B][L]}removeFeatureState(l,p,x){if(this.deletedStates[l]===null)return;const B=String(p);if(this.deletedStates[l]=this.deletedStates[l]||{},x&&p!==void 0)this.deletedStates[l][B]!==null&&(this.deletedStates[l][B]=this.deletedStates[l][B]||{},this.deletedStates[l][B][x]=null);else if(p!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][B])for(x in this.deletedStates[l][B]={},this.stateChanges[l][B])this.deletedStates[l][B][x]=null;else this.deletedStates[l][B]=null;else this.deletedStates[l]=null}getState(l,p){const x=String(p),B=s.e({},(this.state[l]||{})[x],(this.stateChanges[l]||{})[x]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const L=this.deletedStates[l][p];if(L===null)return{};for(const j in L)delete B[j]}return B}initializeTileState(l,p){l.setFeatureState(this.state,p)}coalesceChanges(l,p){const x={};for(const B in this.stateChanges){this.state[B]=this.state[B]||{};const L={};for(const j in this.stateChanges[B])this.state[B][j]||(this.state[B][j]={}),s.e(this.state[B][j],this.stateChanges[B][j]),L[j]=this.state[B][j];x[B]=L}for(const B in this.deletedStates){this.state[B]=this.state[B]||{};const L={};if(this.deletedStates[B]===null)for(const j in this.state[B])L[j]={},this.state[B][j]={};else for(const j in this.deletedStates[B]){if(this.deletedStates[B][j]===null)this.state[B][j]={};else for(const _ of Object.keys(this.deletedStates[B][j]))delete this.state[B][j][_];L[j]=this.state[B][j]}x[B]=x[B]||{},s.e(x[B],L)}if(this.stateChanges={},this.deletedStates={},Object.keys(x).length!==0)for(const B in l)l[B].setFeatureState(x,p)}}class Qt extends s.E{constructor(l,p,x){super(),this.id=l,this.dispatcher=x,this.on("data",B=>{B.dataType==="source"&&B.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&B.dataType==="source"&&B.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((B,L,j,_)=>{const E=new(ri(L.type))(B,L,j,_);if(E.id!==B)throw new Error(`Expected Source id to be ${B} instead of ${E.id}`);return E})(l,p,x,this),this._tiles={},this._cache=new Wt(0,B=>this._unloadTile(B)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new di,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const p=this._tiles[l];if(p.state!=="loaded"&&p.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,p,x){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,p,x)}catch(B){l.state="errored",B.status!==404?this._source.fire(new s.j(B,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new s.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const p in this._tiles){const x=this._tiles[p];x.upload(l),x.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(Tr).map(l=>l.key)}getRenderableIds(l){const p=[];for(const x in this._tiles)this._isIdRenderable(x,l)&&p.push(this._tiles[x]);return l?p.sort((x,B)=>{const L=x.tileID,j=B.tileID,_=new s.P(L.canonical.x,L.canonical.y)._rotate(this.transform.angle),E=new s.P(j.canonical.x,j.canonical.y)._rotate(this.transform.angle);return L.overscaledZ-j.overscaledZ||E.y-_.y||E.x-_.x}).map(x=>x.tileID.key):p.map(x=>x.tileID).sort(Tr).map(x=>x.key)}hasRenderableParent(l){const p=this.findLoadedParent(l,0);return!!p&&this._isIdRenderable(p.tileID.key)}_isIdRenderable(l,p){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(p||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(l,p){return s._(this,void 0,void 0,function*(){const x=this._tiles[l];x&&(x.state!=="loading"&&(x.state=p),yield this._loadTile(x,l,p))})}_tileLoaded(l,p,x){l.timeAdded=I.now(),x==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(p,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const p=this.getRenderableIds();for(let B=0;B<p.length;B++){const L=p[B];if(l.neighboringTiles&&l.neighboringTiles[L]){const j=this.getTileByID(L);x(l,j),x(j,l)}}function x(B,L){B.needsHillshadePrepare=!0,B.needsTerrainPrepare=!0;let j=L.tileID.canonical.x-B.tileID.canonical.x;const _=L.tileID.canonical.y-B.tileID.canonical.y,E=Math.pow(2,B.tileID.canonical.z),F=L.tileID.key;j===0&&_===0||Math.abs(_)>1||(Math.abs(j)>1&&(Math.abs(j+E)===1?j+=E:Math.abs(j-E)===1&&(j-=E)),L.dem&&B.dem&&(B.dem.backfillBorder(L.dem,j,_),B.neighboringTiles&&B.neighboringTiles[F]&&(B.neighboringTiles[F].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,p,x,B){for(const L in this._tiles){let j=this._tiles[L];if(B[L]||!j.hasData()||j.tileID.overscaledZ<=p||j.tileID.overscaledZ>x)continue;let _=j.tileID;for(;j&&j.tileID.overscaledZ>p+1;){const F=j.tileID.scaledTo(j.tileID.overscaledZ-1);j=this._tiles[F.key],j&&j.hasData()&&(_=F)}let E=_;for(;E.overscaledZ>p;)if(E=E.scaledTo(E.overscaledZ-1),l[E.key]){B[_.key]=_;break}}}findLoadedParent(l,p){if(l.key in this._loadedParentTiles){const x=this._loadedParentTiles[l.key];return x&&x.tileID.overscaledZ>=p?x:null}for(let x=l.overscaledZ-1;x>=p;x--){const B=l.scaledTo(x),L=this._getLoadedTile(B);if(L)return L}}_getLoadedTile(l){const p=this._tiles[l.key];return p&&p.hasData()?p:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const p=Math.ceil(l.width/this._source.tileSize)+1,x=Math.ceil(l.height/this._source.tileSize)+1,B=Math.floor(p*x*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),L=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,B):B;this._cache.setMaxSize(L)}handleWrapJump(l){const p=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,p){const x={};for(const B in this._tiles){const L=this._tiles[B];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+p),x[L.tileID.key]=L}this._tiles=x;for(const B in this._timers)clearTimeout(this._timers[B]),delete this._timers[B];for(const B in this._tiles)this._setTileReloadTimer(B,this._tiles[B])}}update(l,p){if(this.transform=l,this.terrain=p,!this._sourceLoaded||this._paused)return;let x;this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?x=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(V=>new s.Q(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y)):(x=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:p}),this._source.hasTile&&(x=x.filter(V=>this._source.hasTile(V)))):x=[];const B=l.coveringZoomLevel(this._source),L=Math.max(B-Qt.maxOverzooming,this._source.minzoom),j=Math.max(B+Qt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const V={};for(const q of x)if(q.canonical.z>this._source.minzoom){const K=q.scaledTo(q.canonical.z-1);V[K.key]=K;const te=q.scaledTo(Math.max(this._source.minzoom,Math.min(q.canonical.z,5)));V[te.key]=te}x=x.concat(Object.values(V))}const _=x.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,_&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=this._updateRetainedTiles(x,B);if(Lr(this._source.type)){const V={},q={},K=Object.keys(E),te=I.now();for(const se of K){const oe=E[se],le=this._tiles[se];if(!le||le.fadeEndTime!==0&&le.fadeEndTime<=te)continue;const _e=this.findLoadedParent(oe,L);_e&&(this._addTile(_e.tileID),V[_e.tileID.key]=_e.tileID),q[se]=oe}this._retainLoadedChildren(q,B,j,E);for(const se in V)E[se]||(this._coveredTiles[se]=!0,E[se]=V[se]);if(p){const se={},oe={};for(const le of x)this._tiles[le.key].hasData()?se[le.key]=le:oe[le.key]=le;for(const le in oe){const _e=oe[le].children(this._source.maxzoom);this._tiles[_e[0].key]&&this._tiles[_e[1].key]&&this._tiles[_e[2].key]&&this._tiles[_e[3].key]&&(se[_e[0].key]=E[_e[0].key]=_e[0],se[_e[1].key]=E[_e[1].key]=_e[1],se[_e[2].key]=E[_e[2].key]=_e[2],se[_e[3].key]=E[_e[3].key]=_e[3],delete oe[le])}for(const le in oe){const _e=this.findLoadedParent(oe[le],this._source.minzoom);if(_e){se[_e.tileID.key]=E[_e.tileID.key]=_e.tileID;for(const Ie in se)se[Ie].isChildOf(_e.tileID)&&delete se[Ie]}}for(const le in this._tiles)se[le]||(this._coveredTiles[le]=!0)}}for(const V in E)this._tiles[V].clearFadeHold();const F=s.ab(this._tiles,E);for(const V of F){const q=this._tiles[V];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(V)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,p){const x={},B={},L=Math.max(p-Qt.maxOverzooming,this._source.minzoom),j=Math.max(p+Qt.maxUnderzooming,this._source.minzoom),_={};for(const E of l){const F=this._addTile(E);x[E.key]=E,F.hasData()||p<this._source.maxzoom&&(_[E.key]=E)}this._retainLoadedChildren(_,p,j,x);for(const E of l){let F=this._tiles[E.key];if(F.hasData())continue;if(p+1>this._source.maxzoom){const q=E.children(this._source.maxzoom)[0],K=this.getTile(q);if(K&&K.hasData()){x[q.key]=q;continue}}else{const q=E.children(this._source.maxzoom);if(x[q[0].key]&&x[q[1].key]&&x[q[2].key]&&x[q[3].key])continue}let V=F.wasRequested();for(let q=E.overscaledZ-1;q>=L;--q){const K=E.scaledTo(q);if(B[K.key])break;if(B[K.key]=!0,F=this.getTile(K),!F&&V&&(F=this._addTile(K)),F){const te=F.hasData();if((V||te)&&(x[K.key]=K),V=F.wasRequested(),te)break}}}return x}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const p=[];let x,B=this._tiles[l].tileID;for(;B.overscaledZ>0;){if(B.key in this._loadedParentTiles){x=this._loadedParentTiles[B.key];break}p.push(B.key);const L=B.scaledTo(B.overscaledZ-1);if(x=this._getLoadedTile(L),x)break;B=L}for(const L of p)this._loadedParentTiles[L]=x}}_addTile(l){let p=this._tiles[l.key];if(p)return p;p=this._cache.getAndRemove(l),p&&(this._setTileReloadTimer(l.key,p),p.tileID=l,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,p)));const x=p;return p||(p=new Ar(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(p,l.key,p.state)),p.uses++,this._tiles[l.key]=p,x||this._source.fire(new s.k("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p}_setTileReloadTimer(l,p){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const x=p.getExpiryTimeout();x&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},x))}_removeTile(l){const p=this._tiles[l];p&&(p.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),p.uses>0||(p.hasData()&&p.state!=="reloading"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,p,x){const B=[],L=this.transform;if(!L)return B;const j=x?L.getCameraQueryGeometry(l):l,_=l.map(se=>L.pointCoordinate(se,this.terrain)),E=j.map(se=>L.pointCoordinate(se,this.terrain)),F=this.getIds();let V=1/0,q=1/0,K=-1/0,te=-1/0;for(const se of E)V=Math.min(V,se.x),q=Math.min(q,se.y),K=Math.max(K,se.x),te=Math.max(te,se.y);for(let se=0;se<F.length;se++){const oe=this._tiles[F[se]];if(oe.holdingForFade())continue;const le=oe.tileID,_e=Math.pow(2,L.zoom-oe.tileID.overscaledZ),Ie=p*oe.queryPadding*s.W/oe.tileSize/_e,ve=[le.getTilePoint(new s.Y(V,q)),le.getTilePoint(new s.Y(K,te))];if(ve[0].x-Ie<s.W&&ve[0].y-Ie<s.W&&ve[1].x+Ie>=0&&ve[1].y+Ie>=0){const Se=_.map(Oe=>le.getTilePoint(Oe)),et=E.map(Oe=>le.getTilePoint(Oe));B.push({tile:oe,tileID:le,queryGeometry:Se,cameraQueryGeometry:et,scale:_e})}}return B}getVisibleCoordinates(l){const p=this.getRenderableIds(l).map(x=>this._tiles[x].tileID);for(const x of p)x.posMatrix=this.transform.calculatePosMatrix(x.toUnwrapped());return p}hasTransition(){if(this._source.hasTransition())return!0;if(Lr(this._source.type)){const l=I.now();for(const p in this._tiles)if(this._tiles[p].fadeEndTime>=l)return!0}return!1}setFeatureState(l,p,x){this._state.updateState(l=l||"_geojsonTileLayer",p,x)}removeFeatureState(l,p,x){this._state.removeFeatureState(l=l||"_geojsonTileLayer",p,x)}getFeatureState(l,p){return this._state.getState(l=l||"_geojsonTileLayer",p)}setDependencies(l,p,x){const B=this._tiles[l];B&&B.setDependencies(p,x)}reloadTilesForDependencies(l,p){for(const x in this._tiles)this._tiles[x].hasDependency(l,p)&&this._reloadTile(x,"reloading");this._cache.filter(x=>!x.hasDependency(l,p))}}function Tr(w,l){const p=Math.abs(2*w.wrap)-+(w.wrap<0),x=Math.abs(2*l.wrap)-+(l.wrap<0);return w.overscaledZ-l.overscaledZ||x-p||l.canonical.y-w.canonical.y||l.canonical.x-w.canonical.x}function Lr(w){return w==="raster"||w==="image"||w==="video"}Qt.maxOverzooming=10,Qt.maxUnderzooming=3;class Xt{constructor(l,p){this.reset(l,p)}reset(l,p){this.points=l||[],this._distances=[0];for(let x=1;x<this.points.length;x++)this._distances[x]=this._distances[x-1]+this.points[x].dist(this.points[x-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.ac(l,0,1);let p=1,x=this._distances[p];const B=l*this.paddedLength+this.padding;for(;x<B&&p<this._distances.length;)x=this._distances[++p];const L=p-1,j=this._distances[L],_=x-j,E=_>0?(B-j)/_:0;return this.points[L].mult(1-E).add(this.points[p].mult(E))}}function xr(w,l){let p=!0;return w==="always"||w!=="never"&&l!=="never"||(p=!1),p}class er{constructor(l,p,x){const B=this.boxCells=[],L=this.circleCells=[];this.xCellCount=Math.ceil(l/x),this.yCellCount=Math.ceil(p/x);for(let j=0;j<this.xCellCount*this.yCellCount;j++)B.push([]),L.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=p,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,p,x,B,L){this._forEachCell(p,x,B,L,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(B),this.bboxes.push(L)}insertCircle(l,p,x,B){this._forEachCell(p-B,x-B,p+B,x+B,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(p),this.circles.push(x),this.circles.push(B)}_insertBoxCell(l,p,x,B,L,j){this.boxCells[L].push(j)}_insertCircleCell(l,p,x,B,L,j){this.circleCells[L].push(j)}_query(l,p,x,B,L,j,_){if(x<0||l>this.width||B<0||p>this.height)return[];const E=[];if(l<=0&&p<=0&&this.width<=x&&this.height<=B){if(L)return[{key:null,x1:l,y1:p,x2:x,y2:B}];for(let F=0;F<this.boxKeys.length;F++)E.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const V=this.circles[3*F],q=this.circles[3*F+1],K=this.circles[3*F+2];E.push({key:this.circleKeys[F],x1:V-K,y1:q-K,x2:V+K,y2:q+K})}}else this._forEachCell(l,p,x,B,this._queryCell,E,{hitTest:L,overlapMode:j,seenUids:{box:{},circle:{}}},_);return E}query(l,p,x,B){return this._query(l,p,x,B,!1,null)}hitTest(l,p,x,B,L,j){return this._query(l,p,x,B,!0,L,j).length>0}hitTestCircle(l,p,x,B,L){const j=l-x,_=l+x,E=p-x,F=p+x;if(_<0||j>this.width||F<0||E>this.height)return!1;const V=[];return this._forEachCell(j,E,_,F,this._queryCellCircle,V,{hitTest:!0,overlapMode:B,circle:{x:l,y:p,radius:x},seenUids:{box:{},circle:{}}},L),V.length>0}_queryCell(l,p,x,B,L,j,_,E){const{seenUids:F,hitTest:V,overlapMode:q}=_,K=this.boxCells[L];if(K!==null){const se=this.bboxes;for(const oe of K)if(!F.box[oe]){F.box[oe]=!0;const le=4*oe,_e=this.boxKeys[oe];if(l<=se[le+2]&&p<=se[le+3]&&x>=se[le+0]&&B>=se[le+1]&&(!E||E(_e))&&(!V||!xr(q,_e.overlapMode))&&(j.push({key:_e,x1:se[le],y1:se[le+1],x2:se[le+2],y2:se[le+3]}),V))return!0}}const te=this.circleCells[L];if(te!==null){const se=this.circles;for(const oe of te)if(!F.circle[oe]){F.circle[oe]=!0;const le=3*oe,_e=this.circleKeys[oe];if(this._circleAndRectCollide(se[le],se[le+1],se[le+2],l,p,x,B)&&(!E||E(_e))&&(!V||!xr(q,_e.overlapMode))){const Ie=se[le],ve=se[le+1],Se=se[le+2];if(j.push({key:_e,x1:Ie-Se,y1:ve-Se,x2:Ie+Se,y2:ve+Se}),V)return!0}}}return!1}_queryCellCircle(l,p,x,B,L,j,_,E){const{circle:F,seenUids:V,overlapMode:q}=_,K=this.boxCells[L];if(K!==null){const se=this.bboxes;for(const oe of K)if(!V.box[oe]){V.box[oe]=!0;const le=4*oe,_e=this.boxKeys[oe];if(this._circleAndRectCollide(F.x,F.y,F.radius,se[le+0],se[le+1],se[le+2],se[le+3])&&(!E||E(_e))&&!xr(q,_e.overlapMode))return j.push(!0),!0}}const te=this.circleCells[L];if(te!==null){const se=this.circles;for(const oe of te)if(!V.circle[oe]){V.circle[oe]=!0;const le=3*oe,_e=this.circleKeys[oe];if(this._circlesCollide(se[le],se[le+1],se[le+2],F.x,F.y,F.radius)&&(!E||E(_e))&&!xr(q,_e.overlapMode))return j.push(!0),!0}}}_forEachCell(l,p,x,B,L,j,_,E){const F=this._convertToXCellCoord(l),V=this._convertToYCellCoord(p),q=this._convertToXCellCoord(x),K=this._convertToYCellCoord(B);for(let te=F;te<=q;te++)for(let se=V;se<=K;se++)if(L.call(this,l,p,x,B,this.xCellCount*se+te,j,_,E))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,p,x,B,L,j){const _=B-l,E=L-p,F=x+j;return F*F>_*_+E*E}_circleAndRectCollide(l,p,x,B,L,j,_){const E=(j-B)/2,F=Math.abs(l-(B+E));if(F>E+x)return!1;const V=(_-L)/2,q=Math.abs(p-(L+V));if(q>V+x)return!1;if(F<=E||q<=V)return!0;const K=F-E,te=q-V;return K*K+te*te<=x*x}}function vi(w,l,p,x,B){const L=s.F();return l?(s.J(L,L,[1/B,1/B,1]),p||s.ad(L,L,x.angle)):s.K(L,x.labelPlaneMatrix,w),L}function Zi(w,l,p,x,B){if(l){const L=s.ae(w);return s.J(L,L,[B,B,1]),p||s.ad(L,L,-x.angle),L}return x.glCoordMatrix}function Qe(w,l,p){let x;p?(x=[w.x,w.y,p(w.x,w.y),1],s.af(x,x,l)):(x=[w.x,w.y,0,1],Tt(x,x,l));const B=x[3];return{point:new s.P(x[0]/B,x[1]/B),signedDistanceFromCamera:B}}function Be(w,l){return .5+w/l*.5}function ue(w,l){const p=w[0]/w[3],x=w[1]/w[3];return p>=-l[0]&&p<=l[0]&&x>=-l[1]&&x<=l[1]}function re(w,l,p,x,B,L,j,_,E,F){const V=x?w.textSizeData:w.iconSizeData,q=s.ag(V,p.transform.zoom),K=[256/p.width*2+1,256/p.height*2+1],te=x?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;te.clear();const se=w.lineVertexArray,oe=x?w.text.placedSymbolArray:w.icon.placedSymbolArray,le=p.transform.width/p.transform.height;let _e=!1;for(let Ie=0;Ie<oe.length;Ie++){const ve=oe.get(Ie);if(ve.hidden||ve.writingMode===s.ah.vertical&&!_e){vt(ve.numGlyphs,te);continue}let Se;if(_e=!1,F?(Se=[ve.anchorX,ve.anchorY,F(ve.anchorX,ve.anchorY),1],s.af(Se,Se,l)):(Se=[ve.anchorX,ve.anchorY,0,1],Tt(Se,Se,l)),!ue(Se,K)){vt(ve.numGlyphs,te);continue}const et=Be(p.transform.cameraToCenterDistance,Se[3]),Oe=s.ai(V,q,ve),Re=j?Oe/et:Oe*et,Ve=new s.P(ve.anchorX,ve.anchorY),At=Qe(Ve,B,F).point,dt={projections:{},offsets:{}},ft=xe(ve,Re,!1,_,l,B,L,w.glyphOffsetArray,se,te,At,Ve,dt,le,E,F);_e=ft.useVertical,(ft.notEnoughRoom||_e||ft.needsFlipping&&xe(ve,Re,!0,_,l,B,L,w.glyphOffsetArray,se,te,At,Ve,dt,le,E,F).notEnoughRoom)&&vt(ve.numGlyphs,te)}x?w.text.dynamicLayoutVertexBuffer.updateData(te):w.icon.dynamicLayoutVertexBuffer.updateData(te)}function Ae(w,l,p,x,B,L,j,_,E,F,V,q,K){const te=_.glyphStartIndex+_.numGlyphs,se=_.lineStartIndex,oe=_.lineStartIndex+_.lineLength,le=l.getoffsetX(_.glyphStartIndex),_e=l.getoffsetX(te-1),Ie=Ge(w*le,p,x,B,L,j,_.segment,se,oe,E,F,V,q,K);if(!Ie)return null;const ve=Ge(w*_e,p,x,B,L,j,_.segment,se,oe,E,F,V,q,K);return ve?{first:Ie,last:ve}:null}function ge(w,l,p,x){return w===s.ah.horizontal&&Math.abs(p.y-l.y)>Math.abs(p.x-l.x)*x?{useVertical:!0}:(w===s.ah.vertical?l.y<p.y:l.x>p.x)?{needsFlipping:!0}:null}function xe(w,l,p,x,B,L,j,_,E,F,V,q,K,te,se,oe){const le=l/24,_e=w.lineOffsetX*le,Ie=w.lineOffsetY*le;let ve;if(w.numGlyphs>1){const Se=w.glyphStartIndex+w.numGlyphs,et=w.lineStartIndex,Oe=w.lineStartIndex+w.lineLength,Re=Ae(le,_,_e,Ie,p,V,q,w,E,L,K,se,oe);if(!Re)return{notEnoughRoom:!0};const Ve=Qe(Re.first.point,j,oe).point,At=Qe(Re.last.point,j,oe).point;if(x&&!p){const dt=ge(w.writingMode,Ve,At,te);if(dt)return dt}ve=[Re.first];for(let dt=w.glyphStartIndex+1;dt<Se-1;dt++)ve.push(Ge(le*_.getoffsetX(dt),_e,Ie,p,V,q,w.segment,et,Oe,E,L,K,se,oe));ve.push(Re.last)}else{if(x&&!p){const et=Qe(q,B,oe).point,Oe=w.lineStartIndex+w.segment+1,Re=new s.P(E.getx(Oe),E.gety(Oe)),Ve=Qe(Re,B,oe),At=Ve.signedDistanceFromCamera>0?Ve.point:Ee(q,Re,et,1,B,oe),dt=ge(w.writingMode,et,At,te);if(dt)return dt}const Se=Ge(le*_.getoffsetX(w.glyphStartIndex),_e,Ie,p,V,q,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,E,L,K,se,oe);if(!Se)return{notEnoughRoom:!0};ve=[Se]}for(const Se of ve)s.aj(F,Se.point,Se.angle);return{}}function Ee(w,l,p,x,B,L){const j=Qe(w.add(w.sub(l)._unit()),B,L).point,_=p.sub(j);return p.add(_._mult(x/_.mag()))}function we(w,l){const{projectionCache:p,lineVertexArray:x,labelPlaneMatrix:B,tileAnchorPoint:L,distanceFromAnchor:j,getElevation:_,previousVertex:E,direction:F,absOffsetX:V}=l;if(p.projections[w])return p.projections[w];const q=new s.P(x.getx(w),x.gety(w)),K=Qe(q,B,_);if(K.signedDistanceFromCamera>0)return p.projections[w]=K.point,K.point;const te=w-F;return Ee(j===0?L:new s.P(x.getx(te),x.gety(te)),q,E,V-j+1,B,_)}function Fe(w,l,p){return w._unit()._perp()._mult(l*p)}function ze(w,l,p,x,B,L,j,_){const{projectionCache:E,direction:F}=_;if(E.offsets[w])return E.offsets[w];const V=p.add(l);if(w+F<x||w+F>=B)return E.offsets[w]=V,V;const q=we(w+F,_),K=Fe(q.sub(p),j,F),te=p.add(K),se=q.add(K);return E.offsets[w]=s.ak(L,V,te,se)||V,E.offsets[w]}function Ge(w,l,p,x,B,L,j,_,E,F,V,q,K,te){const se=x?w-l:w+l;let oe=se>0?1:-1,le=0;x&&(oe*=-1,le=Math.PI),oe<0&&(le+=Math.PI);let _e,Ie,ve=oe>0?_+j:_+j+1,Se=B,et=B,Oe=0,Re=0;const Ve=Math.abs(se),At=[];let dt;for(;Oe+Re<=Ve;){if(ve+=oe,ve<_||ve>=E)return null;Oe+=Re,et=Se,Ie=_e;const It={projectionCache:q,lineVertexArray:F,labelPlaneMatrix:V,tileAnchorPoint:L,distanceFromAnchor:Oe,getElevation:te,previousVertex:et,direction:oe,absOffsetX:Ve};if(Se=we(ve,It),p===0)At.push(et),dt=Se.sub(et);else{let jt;const Ht=Se.sub(et);jt=Ht.mag()===0?Fe(we(ve+oe,It).sub(Se),p,oe):Fe(Ht,p,oe),Ie||(Ie=et.add(jt)),_e=ze(ve,jt,Se,_,E,Ie,p,It),At.push(Ie),dt=_e.sub(Ie)}Re=dt.mag()}const ft=dt._mult((Ve-Oe)/Re)._add(Ie||et),Nt=le+Math.atan2(Se.y-et.y,Se.x-et.x);return At.push(ft),{point:ft,angle:K?Nt:0,path:At}}const st=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function vt(w,l){for(let p=0;p<w;p++){const x=l.length;l.resize(x+4),l.float32.set(st,3*x)}}function Tt(w,l,p){const x=l[0],B=l[1];return w[0]=p[0]*x+p[4]*B+p[12],w[1]=p[1]*x+p[5]*B+p[13],w[3]=p[3]*x+p[7]*B+p[15],w}const Kt=100;class rr{constructor(l){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new er(l.width+200,l.height+200,25),x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new er(l.width+200,l.height+200,25);this.transform=l,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Kt,this.screenBottomBoundary=l.height+Kt,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,p,x,B,L,j){const _=this.projectAndGetPerspectiveRatio(B,l.anchorPointX,l.anchorPointY,j),E=x*_.perspectiveRatio,F=l.x1*E+_.point.x,V=l.y1*E+_.point.y,q=l.x2*E+_.point.x,K=l.y2*E+_.point.y;return!this.isInsideGrid(F,V,q,K)||p!=="always"&&this.grid.hitTest(F,V,q,K,p,L)||_.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[F,V,q,K],offscreen:this.isOffscreen(F,V,q,K)}}placeCollisionCircles(l,p,x,B,L,j,_,E,F,V,q,K,te,se){const oe=[],le=new s.P(p.anchorX,p.anchorY),_e=Qe(le,j,se),Ie=Be(this.transform.cameraToCenterDistance,_e.signedDistanceFromCamera),ve=(V?L/Ie:L*Ie)/s.ao,Se=Qe(le,_,se).point,et=Ae(ve,B,p.lineOffsetX*ve,p.lineOffsetY*ve,!1,Se,le,p,x,_,{projections:{},offsets:{}},!1,se);let Oe=!1,Re=!1,Ve=!0;if(et){const At=.5*K*Ie+te,dt=new s.P(-100,-100),ft=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Nt=new Xt,It=et.first,jt=et.last;let Ht=[];for(let Ir=It.path.length-1;Ir>=1;Ir--)Ht.push(It.path[Ir]);for(let Ir=1;Ir<jt.path.length;Ir++)Ht.push(jt.path[Ir]);const Pr=2.5*At;if(E){const Ir=Ht.map(hr=>Qe(hr,E,se));Ht=Ir.some(hr=>hr.signedDistanceFromCamera<=0)?[]:Ir.map(hr=>hr.point)}let yr=[];if(Ht.length>0){const Ir=Ht[0].clone(),hr=Ht[0].clone();for(let li=1;li<Ht.length;li++)Ir.x=Math.min(Ir.x,Ht[li].x),Ir.y=Math.min(Ir.y,Ht[li].y),hr.x=Math.max(hr.x,Ht[li].x),hr.y=Math.max(hr.y,Ht[li].y);yr=Ir.x>=dt.x&&hr.x<=ft.x&&Ir.y>=dt.y&&hr.y<=ft.y?[Ht]:hr.x<dt.x||Ir.x>ft.x||hr.y<dt.y||Ir.y>ft.y?[]:s.al([Ht],dt.x,dt.y,ft.x,ft.y)}for(const Ir of yr){Nt.reset(Ir,.25*At);let hr=0;hr=Nt.length<=.5*At?1:Math.ceil(Nt.paddedLength/Pr)+1;for(let li=0;li<hr;li++){const ti=li/Math.max(hr-1,1),ii=Nt.lerp(ti),Ri=ii.x+Kt,ki=ii.y+Kt;oe.push(Ri,ki,At,0);const wi=Ri-At,Ki=ki-At,xi=Ri+At,Zn=ki+At;if(Ve=Ve&&this.isOffscreen(wi,Ki,xi,Zn),Re=Re||this.isInsideGrid(wi,Ki,xi,Zn),l!=="always"&&this.grid.hitTestCircle(Ri,ki,At,l,q)&&(Oe=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Oe}}}}return{circles:!F&&Oe||!Re||Ie<this.perspectiveRatioCutoff?[]:oe,offscreen:Ve,collisionDetected:Oe}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const p=[];let x=1/0,B=1/0,L=-1/0,j=-1/0;for(const V of l){const q=new s.P(V.x+Kt,V.y+Kt);x=Math.min(x,q.x),B=Math.min(B,q.y),L=Math.max(L,q.x),j=Math.max(j,q.y),p.push(q)}const _=this.grid.query(x,B,L,j).concat(this.ignoredGrid.query(x,B,L,j)),E={},F={};for(const V of _){const q=V.key;if(E[q.bucketInstanceId]===void 0&&(E[q.bucketInstanceId]={}),E[q.bucketInstanceId][q.featureIndex])continue;const K=[new s.P(V.x1,V.y1),new s.P(V.x2,V.y1),new s.P(V.x2,V.y2),new s.P(V.x1,V.y2)];s.am(p,K)&&(E[q.bucketInstanceId][q.featureIndex]=!0,F[q.bucketInstanceId]===void 0&&(F[q.bucketInstanceId]=[]),F[q.bucketInstanceId].push(q.featureIndex))}return F}insertCollisionBox(l,p,x,B,L,j){(x?this.ignoredGrid:this.grid).insert({bucketInstanceId:B,featureIndex:L,collisionGroupID:j,overlapMode:p},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,p,x,B,L,j){const _=x?this.ignoredGrid:this.grid,E={bucketInstanceId:B,featureIndex:L,collisionGroupID:j,overlapMode:p};for(let F=0;F<l.length;F+=4)_.insertCircle(E,l[F],l[F+1],l[F+2])}projectAndGetPerspectiveRatio(l,p,x,B){let L;return B?(L=[p,x,B(p,x),1],s.af(L,L,l)):(L=[p,x,0,1],Tt(L,L,l)),{point:new s.P((L[0]/L[3]+1)/2*this.transform.width+Kt,(-L[1]/L[3]+1)/2*this.transform.height+Kt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/L[3]*.5}}isOffscreen(l,p,x,B){return x<Kt||l>=this.screenRightBoundary||B<Kt||p>this.screenBottomBoundary}isInsideGrid(l,p,x,B){return x>=0&&l<this.gridRightBoundary&&B>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const l=s.an([]);return s.H(l,l,[-100,-100,0]),l}}function Gt(w,l,p){return l*(s.W/(w.tileSize*Math.pow(2,p-w.tileID.overscaledZ)))}class dr{constructor(l,p,x,B){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?p:-p))):B&&x?1:0,this.placed=x}isHidden(){return this.opacity===0&&!this.placed}}class Cr{constructor(l,p,x,B,L){this.text=new dr(l?l.text:null,p,x,L),this.icon=new dr(l?l.icon:null,p,B,L)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Gr{constructor(l,p,x){this.text=l,this.icon=p,this.skipFade=x}}class Er{constructor(){this.invProjMatrix=s.F(),this.viewportMatrix=s.F(),this.circles=[]}}class zr{constructor(l,p,x,B,L){this.bucketInstanceId=l,this.featureIndex=p,this.sourceLayerIndex=x,this.bucketIndex=B,this.tileID=L}}class ot{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const p=++this.maxGroupID;this.collisionGroups[l]={ID:p,predicate:x=>x.collisionGroupID===p}}return this.collisionGroups[l]}}function ir(w,l,p,x,B){const{horizontalAlign:L,verticalAlign:j}=s.at(w);return new s.P(-(L-.5)*l+x[0]*B,-(j-.5)*p+x[1]*B)}function Vt(w,l,p,x,B,L){const{x1:j,x2:_,y1:E,y2:F,anchorPointX:V,anchorPointY:q}=w,K=new s.P(l,p);return x&&K._rotate(B?L:-L),{x1:j+K.x,y1:E+K.y,x2:_+K.x,y2:F+K.y,anchorPointX:V,anchorPointY:q}}class Hr{constructor(l,p,x,B,L){this.transform=l.clone(),this.terrain=p,this.collisionIndex=new rr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=x,this.retainedQueryData={},this.collisionGroups=new ot(B),this.collisionCircleArrays={},this.prevPlacement=L,L&&(L.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,p,x,B){const L=x.getBucket(p),j=x.latestFeatureIndex;if(!L||!j||p.id!==L.layerIds[0])return;const _=x.collisionBoxArray,E=L.layers[0].layout,F=Math.pow(2,this.transform.zoom-x.tileID.overscaledZ),V=x.tileSize/s.W,q=this.transform.calculatePosMatrix(x.tileID.toUnwrapped()),K=E.get("text-pitch-alignment")==="map",te=E.get("text-rotation-alignment")==="map",se=Gt(x,1,this.transform.zoom),oe=vi(q,K,te,this.transform,se);let le=null;if(K){const Ie=Zi(q,K,te,this.transform,se);le=s.K([],this.transform.labelPlaneMatrix,Ie)}this.retainedQueryData[L.bucketInstanceId]=new zr(L.bucketInstanceId,j,L.sourceLayerIndex,L.index,x.tileID);const _e={bucket:L,layout:E,posMatrix:q,textLabelPlaneMatrix:oe,labelToScreenMatrix:le,scale:F,textPixelRatio:V,holdingForFade:x.holdingForFade(),collisionBoxArray:_,partiallyEvaluatedTextSize:s.ag(L.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(L.sourceID)};if(B)for(const Ie of L.sortKeyRanges){const{sortKey:ve,symbolInstanceStart:Se,symbolInstanceEnd:et}=Ie;l.push({sortKey:ve,symbolInstanceStart:Se,symbolInstanceEnd:et,parameters:_e})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:L.symbolInstances.length,parameters:_e})}attemptAnchorPlacement(l,p,x,B,L,j,_,E,F,V,q,K,te,se,oe,le){const _e=s.ap[l.textAnchor],Ie=[l.textOffset0,l.textOffset1],ve=ir(_e,x,B,Ie,L),Se=this.collisionIndex.placeCollisionBox(Vt(p,ve.x,ve.y,j,_,this.transform.angle),q,E,F,V.predicate,le);if((!oe||this.collisionIndex.placeCollisionBox(Vt(oe,ve.x,ve.y,j,_,this.transform.angle),q,E,F,V.predicate,le).box.length!==0)&&Se.box.length>0){let et;if(this.prevPlacement&&this.prevPlacement.variableOffsets[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID].text&&(et=this.prevPlacement.variableOffsets[K.crossTileID].anchor),K.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[K.crossTileID]={textOffset:Ie,width:x,height:B,anchor:_e,textBoxScale:L,prevAnchor:et},this.markUsedJustification(te,_e,K,se),te.allowVerticalPlacement&&(this.markUsedOrientation(te,se,K),this.placedOrientations[K.crossTileID]=se),{shift:ve,placedGlyphBoxes:Se}}}placeLayerBucketPart(l,p,x){const{bucket:B,layout:L,posMatrix:j,textLabelPlaneMatrix:_,labelToScreenMatrix:E,textPixelRatio:F,holdingForFade:V,collisionBoxArray:q,partiallyEvaluatedTextSize:K,collisionGroup:te}=l.parameters,se=L.get("text-optional"),oe=L.get("icon-optional"),le=s.aq(L,"text-overlap","text-allow-overlap"),_e=le==="always",Ie=s.aq(L,"icon-overlap","icon-allow-overlap"),ve=Ie==="always",Se=L.get("text-rotation-alignment")==="map",et=L.get("text-pitch-alignment")==="map",Oe=L.get("icon-text-fit")!=="none",Re=L.get("symbol-z-order")==="viewport-y",Ve=_e&&(ve||!B.hasIconData()||oe),At=ve&&(_e||!B.hasTextData()||se);!B.collisionArrays&&q&&B.deserializeCollisionBoxes(q);const dt=this.retainedQueryData[B.bucketInstanceId].tileID,ft=this.terrain?(It,jt)=>this.terrain.getElevation(dt,It,jt):null,Nt=(It,jt)=>{var Ht,Pr;if(p[It.crossTileID])return;if(V)return void(this.placements[It.crossTileID]=new Gr(!1,!1,!1));let yr=!1,Ir=!1,hr=!0,li=null,ti={box:null,offscreen:null},ii={box:null,offscreen:null},Ri=null,ki=null,wi=null,Ki=0,xi=0,Zn=0;jt.textFeatureIndex?Ki=jt.textFeatureIndex:It.useRuntimeCollisionCircles&&(Ki=It.featureIndex),jt.verticalTextFeatureIndex&&(xi=jt.verticalTextFeatureIndex);const Wi=jt.textBox;if(Wi){const hi=an=>{let is=s.ah.horizontal;if(B.allowVerticalPlacement&&!an&&this.prevPlacement){const Es=this.prevPlacement.placedOrientations[It.crossTileID];Es&&(this.placedOrientations[It.crossTileID]=Es,is=Es,this.markUsedOrientation(B,is,It))}return is},zi=(an,is)=>{if(B.allowVerticalPlacement&&It.numVerticalGlyphVertices>0&&jt.verticalTextBox){for(const Es of B.writingModes)if(Es===s.ah.vertical?(ti=is(),ii=ti):ti=an(),ti&&ti.box&&ti.box.length)break}else ti=an()},on=It.textAnchorOffsetStartIndex,rs=It.textAnchorOffsetEndIndex;if(rs===on){const an=(is,Es)=>{const yi=this.collisionIndex.placeCollisionBox(is,le,F,j,te.predicate,ft);return yi&&yi.box&&yi.box.length&&(this.markUsedOrientation(B,Es,It),this.placedOrientations[It.crossTileID]=Es),yi};zi(()=>an(Wi,s.ah.horizontal),()=>{const is=jt.verticalTextBox;return B.allowVerticalPlacement&&It.numVerticalGlyphVertices>0&&is?an(is,s.ah.vertical):{box:null,offscreen:null}}),hi(ti&&ti.box&&ti.box.length)}else{let an=s.ap[(Pr=(Ht=this.prevPlacement)===null||Ht===void 0?void 0:Ht.variableOffsets[It.crossTileID])===null||Pr===void 0?void 0:Pr.anchor];const is=(yi,bn,ia)=>{const Ns=yi.x2-yi.x1,so=yi.y2-yi.y1,xl=It.textBoxScale,bo=Oe&&Ie==="never"?bn:null;let ac={box:[],offscreen:!1},Ua=le==="never"?1:2,Dn="never";an&&Ua++;for(let Ec=0;Ec<Ua;Ec++){for(let vu=on;vu<rs;vu++){const wl=B.textAnchorOffsets.get(vu);if(an&&wl.textAnchor!==an)continue;const al=this.attemptAnchorPlacement(wl,yi,Ns,so,xl,Se,et,F,j,te,Dn,It,B,ia,bo,ft);if(al&&(ac=al.placedGlyphBoxes,ac&&ac.box&&ac.box.length))return yr=!0,li=al.shift,ac}an?an=null:Dn=le}return ac};zi(()=>is(Wi,jt.iconBox,s.ah.horizontal),()=>{const yi=jt.verticalTextBox;return B.allowVerticalPlacement&&!(ti&&ti.box&&ti.box.length)&&It.numVerticalGlyphVertices>0&&yi?is(yi,jt.verticalIconBox,s.ah.vertical):{box:null,offscreen:null}}),ti&&(yr=ti.box,hr=ti.offscreen);const Es=hi(ti&&ti.box);if(!yr&&this.prevPlacement){const yi=this.prevPlacement.variableOffsets[It.crossTileID];yi&&(this.variableOffsets[It.crossTileID]=yi,this.markUsedJustification(B,yi.anchor,It,Es))}}}if(Ri=ti,yr=Ri&&Ri.box&&Ri.box.length>0,hr=Ri&&Ri.offscreen,It.useRuntimeCollisionCircles){const hi=B.text.placedSymbolArray.get(It.centerJustifiedTextSymbolIndex),zi=s.ai(B.textSizeData,K,hi),on=L.get("text-padding");ki=this.collisionIndex.placeCollisionCircles(le,hi,B.lineVertexArray,B.glyphOffsetArray,zi,j,_,E,x,et,te.predicate,It.collisionCircleDiameter,on,ft),ki.circles.length&&ki.collisionDetected&&!x&&s.w("Collisions detected, but collision boxes are not shown"),yr=_e||ki.circles.length>0&&!ki.collisionDetected,hr=hr&&ki.offscreen}if(jt.iconFeatureIndex&&(Zn=jt.iconFeatureIndex),jt.iconBox){const hi=zi=>{const on=Oe&&li?Vt(zi,li.x,li.y,Se,et,this.transform.angle):zi;return this.collisionIndex.placeCollisionBox(on,Ie,F,j,te.predicate,ft)};ii&&ii.box&&ii.box.length&&jt.verticalIconBox?(wi=hi(jt.verticalIconBox),Ir=wi.box.length>0):(wi=hi(jt.iconBox),Ir=wi.box.length>0),hr=hr&&wi.offscreen}const Oi=se||It.numHorizontalGlyphVertices===0&&It.numVerticalGlyphVertices===0,Xi=oe||It.numIconVertices===0;if(Oi||Xi?Xi?Oi||(Ir=Ir&&yr):yr=Ir&&yr:Ir=yr=Ir&&yr,yr&&Ri&&Ri.box&&this.collisionIndex.insertCollisionBox(Ri.box,le,L.get("text-ignore-placement"),B.bucketInstanceId,ii&&ii.box&&xi?xi:Ki,te.ID),Ir&&wi&&this.collisionIndex.insertCollisionBox(wi.box,Ie,L.get("icon-ignore-placement"),B.bucketInstanceId,Zn,te.ID),ki&&(yr&&this.collisionIndex.insertCollisionCircles(ki.circles,le,L.get("text-ignore-placement"),B.bucketInstanceId,Ki,te.ID),x)){const hi=B.bucketInstanceId;let zi=this.collisionCircleArrays[hi];zi===void 0&&(zi=this.collisionCircleArrays[hi]=new Er);for(let on=0;on<ki.circles.length;on+=4)zi.circles.push(ki.circles[on+0]),zi.circles.push(ki.circles[on+1]),zi.circles.push(ki.circles[on+2]),zi.circles.push(ki.collisionDetected?1:0)}if(It.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(B.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[It.crossTileID]=new Gr(yr||Ve,Ir||At,hr||B.justReloaded),p[It.crossTileID]=!0};if(Re){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const It=B.getSortedSymbolIndexes(this.transform.angle);for(let jt=It.length-1;jt>=0;--jt){const Ht=It[jt];Nt(B.symbolInstances.get(Ht),B.collisionArrays[Ht])}}else for(let It=l.symbolInstanceStart;It<l.symbolInstanceEnd;It++)Nt(B.symbolInstances.get(It),B.collisionArrays[It]);if(x&&B.bucketInstanceId in this.collisionCircleArrays){const It=this.collisionCircleArrays[B.bucketInstanceId];s.ar(It.invProjMatrix,j),It.viewportMatrix=this.collisionIndex.getViewportMatrix()}B.justReloaded=!1}markUsedJustification(l,p,x,B){let L;L=B===s.ah.vertical?x.verticalPlacedTextSymbolIndex:{left:x.leftJustifiedTextSymbolIndex,center:x.centerJustifiedTextSymbolIndex,right:x.rightJustifiedTextSymbolIndex}[s.as(p)];const j=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex,x.verticalPlacedTextSymbolIndex];for(const _ of j)_>=0&&(l.text.placedSymbolArray.get(_).crossTileID=L>=0&&_!==L?0:x.crossTileID)}markUsedOrientation(l,p,x){const B=p===s.ah.horizontal||p===s.ah.horizontalOnly?p:0,L=p===s.ah.vertical?p:0,j=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex];for(const _ of j)l.text.placedSymbolArray.get(_).placedOrientation=B;x.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(x.verticalPlacedTextSymbolIndex).placedOrientation=L)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let x=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const B=p?p.symbolFadeChange(l):1,L=p?p.opacities:{},j=p?p.variableOffsets:{},_=p?p.placedOrientations:{};for(const E in this.placements){const F=this.placements[E],V=L[E];V?(this.opacities[E]=new Cr(V,B,F.text,F.icon),x=x||F.text!==V.text.placed||F.icon!==V.icon.placed):(this.opacities[E]=new Cr(null,B,F.text,F.icon,F.skipFade),x=x||F.text||F.icon)}for(const E in L){const F=L[E];if(!this.opacities[E]){const V=new Cr(F,B,!1,!1);V.isHidden()||(this.opacities[E]=V,x=x||F.text.placed||F.icon.placed)}}for(const E in j)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=j[E]);for(const E in _)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=_[E]);if(p&&p.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");x?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:l)}updateLayerOpacities(l,p){const x={};for(const B of p){const L=B.getBucket(l);L&&B.latestFeatureIndex&&l.id===L.layerIds[0]&&this.updateBucketOpacities(L,x,B.collisionBoxArray)}}updateBucketOpacities(l,p,x){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const B=l.layers[0],L=B.layout,j=new Cr(null,0,!1,!1,!0),_=L.get("text-allow-overlap"),E=L.get("icon-allow-overlap"),F=B._unevaluatedLayout.hasValue("text-variable-anchor")||B._unevaluatedLayout.hasValue("text-variable-anchor-offset"),V=L.get("text-rotation-alignment")==="map",q=L.get("text-pitch-alignment")==="map",K=L.get("icon-text-fit")!=="none",te=new Cr(null,0,_&&(E||!l.hasIconData()||L.get("icon-optional")),E&&(_||!l.hasTextData()||L.get("text-optional")),!0);!l.collisionArrays&&x&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(x);const se=(oe,le,_e)=>{for(let Ie=0;Ie<le/4;Ie++)oe.opacityVertexArray.emplaceBack(_e);oe.hasVisibleVertices=oe.hasVisibleVertices||_e!==Ui};for(let oe=0;oe<l.symbolInstances.length;oe++){const le=l.symbolInstances.get(oe),{numHorizontalGlyphVertices:_e,numVerticalGlyphVertices:Ie,crossTileID:ve}=le;let Se=this.opacities[ve];p[ve]?Se=j:Se||(Se=te,this.opacities[ve]=Se),p[ve]=!0;const et=le.numIconVertices>0,Oe=this.placedOrientations[le.crossTileID],Re=Oe===s.ah.vertical,Ve=Oe===s.ah.horizontal||Oe===s.ah.horizontalOnly;if(_e>0||Ie>0){const At=qs(Se.text);se(l.text,_e,Re?Ui:At),se(l.text,Ie,Ve?Ui:At);const dt=Se.text.isHidden();[le.rightJustifiedTextSymbolIndex,le.centerJustifiedTextSymbolIndex,le.leftJustifiedTextSymbolIndex].forEach(It=>{It>=0&&(l.text.placedSymbolArray.get(It).hidden=dt||Re?1:0)}),le.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(le.verticalPlacedTextSymbolIndex).hidden=dt||Ve?1:0);const ft=this.variableOffsets[le.crossTileID];ft&&this.markUsedJustification(l,ft.anchor,le,Oe);const Nt=this.placedOrientations[le.crossTileID];Nt&&(this.markUsedJustification(l,"left",le,Nt),this.markUsedOrientation(l,Nt,le))}if(et){const At=qs(Se.icon),dt=!(K&&le.verticalPlacedIconSymbolIndex&&Re);le.placedIconSymbolIndex>=0&&(se(l.icon,le.numIconVertices,dt?At:Ui),l.icon.placedSymbolArray.get(le.placedIconSymbolIndex).hidden=Se.icon.isHidden()),le.verticalPlacedIconSymbolIndex>=0&&(se(l.icon,le.numVerticalIconVertices,dt?Ui:At),l.icon.placedSymbolArray.get(le.verticalPlacedIconSymbolIndex).hidden=Se.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const At=l.collisionArrays[oe];if(At){let dt=new s.P(0,0);if(At.textBox||At.verticalTextBox){let Nt=!0;if(F){const It=this.variableOffsets[ve];It?(dt=ir(It.anchor,It.width,It.height,It.textOffset,It.textBoxScale),V&&dt._rotate(q?this.transform.angle:-this.transform.angle)):Nt=!1}At.textBox&&ci(l.textCollisionBox.collisionVertexArray,Se.text.placed,!Nt||Re,dt.x,dt.y),At.verticalTextBox&&ci(l.textCollisionBox.collisionVertexArray,Se.text.placed,!Nt||Ve,dt.x,dt.y)}const ft=!!(!Ve&&At.verticalIconBox);At.iconBox&&ci(l.iconCollisionBox.collisionVertexArray,Se.icon.placed,ft,K?dt.x:0,K?dt.y:0),At.verticalIconBox&&ci(l.iconCollisionBox.collisionVertexArray,Se.icon.placed,!ft,K?dt.x:0,K?dt.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const oe=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=oe.invProjMatrix,l.placementViewportMatrix=oe.viewportMatrix,l.collisionCircleArray=oe.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,p){const x=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*x>l}setStale(){this.stale=!0}}function ci(w,l,p,x,B){w.emplaceBack(l?1:0,p?1:0,x||0,B||0),w.emplaceBack(l?1:0,p?1:0,x||0,B||0),w.emplaceBack(l?1:0,p?1:0,x||0,B||0),w.emplaceBack(l?1:0,p?1:0,x||0,B||0)}const un=Math.pow(2,25),wn=Math.pow(2,24),mi=Math.pow(2,17),mn=Math.pow(2,16),yn=Math.pow(2,9),fi=Math.pow(2,8),jn=Math.pow(2,1);function qs(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const l=w.placed?1:0,p=Math.floor(127*w.opacity);return p*un+l*wn+p*mi+l*mn+p*yn+l*fi+p*jn+l}const Ui=0;class Bn{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,p,x,B,L){const j=this._bucketParts;for(;this._currentTileIndex<l.length;)if(p.getBucketParts(j,B,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,L())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,j.sort((_,E)=>_.sortKey-E.sortKey));this._currentPartIndex<j.length;)if(p.placeLayerBucketPart(j[this._currentPartIndex],this._seenCrossTileIDs,x),this._currentPartIndex++,L())return!0;return!1}}class Xa{constructor(l,p,x,B,L,j,_,E){this.placement=new Hr(l,p,j,_,E),this._currentPlacementIndex=x.length-1,this._forceFullPlacement=B,this._showCollisionBoxes=L,this._done=!1}isDone(){return this._done}continuePlacement(l,p,x){const B=I.now(),L=()=>!this._forceFullPlacement&&I.now()-B>2;for(;this._currentPlacementIndex>=0;){const j=p[l[this._currentPlacementIndex]],_=this.placement.collisionIndex.transform.zoom;if(j.type==="symbol"&&(!j.minzoom||j.minzoom<=_)&&(!j.maxzoom||j.maxzoom>_)){if(this._inProgressLayer||(this._inProgressLayer=new Bn(j)),this._inProgressLayer.continuePlacement(x[j.source],this.placement,this._showCollisionBoxes,j,L))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Nn=512/s.W/2;class Zr{constructor(l,p,x){this.tileID=l,this.bucketInstanceId=x,this._symbolsByKey={};const B=new Map;for(let L=0;L<p.length;L++){const j=p.get(L),_=j.key,E=B.get(_);E?E.push(j):B.set(_,[j])}for(const[L,j]of B){const _={positions:j.map(E=>({x:Math.floor(E.anchorX*Nn),y:Math.floor(E.anchorY*Nn)})),crossTileIDs:j.map(E=>E.crossTileID)};if(_.positions.length>128){const E=new s.au(_.positions.length,16,Uint16Array);for(const{x:F,y:V}of _.positions)E.add(F,V);E.finish(),delete _.positions,_.index=E}this._symbolsByKey[L]=_}}getScaledCoordinates(l,p){const{x,y:B,z:L}=this.tileID.canonical,{x:j,y:_,z:E}=p.canonical,F=Nn/Math.pow(2,E-L),V=(_*s.W+l.anchorY)*F,q=B*s.W*Nn;return{x:Math.floor((j*s.W+l.anchorX)*F-x*s.W*Nn),y:Math.floor(V-q)}}findMatches(l,p,x){const B=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z);for(let L=0;L<l.length;L++){const j=l.get(L);if(j.crossTileID)continue;const _=this._symbolsByKey[j.key];if(!_)continue;const E=this.getScaledCoordinates(j,p);if(_.index){const F=_.index.range(E.x-B,E.y-B,E.x+B,E.y+B).sort();for(const V of F){const q=_.crossTileIDs[V];if(!x[q]){x[q]=!0,j.crossTileID=q;break}}}else if(_.positions)for(let F=0;F<_.positions.length;F++){const V=_.positions[F],q=_.crossTileIDs[F];if(Math.abs(V.x-E.x)<=B&&Math.abs(V.y-E.y)<=B&&!x[q]){x[q]=!0,j.crossTileID=q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(l=>{let{crossTileIDs:p}=l;return p})}}class co{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Fs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const p=Math.round((l-this.lng)/360);if(p!==0)for(const x in this.indexes){const B=this.indexes[x],L={};for(const j in B){const _=B[j];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+p),L[_.tileID.key]=_}this.indexes[x]=L}this.lng=l}addBucket(l,p,x){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let L=0;L<p.symbolInstances.length;L++)p.symbolInstances.get(L).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const B=this.usedCrossTileIDs[l.overscaledZ];for(const L in this.indexes){const j=this.indexes[L];if(Number(L)>l.overscaledZ)for(const _ in j){const E=j[_];E.tileID.isChildOf(l)&&E.findMatches(p.symbolInstances,l,B)}else{const _=j[l.scaledTo(Number(L)).key];_&&_.findMatches(p.symbolInstances,l,B)}}for(let L=0;L<p.symbolInstances.length;L++){const j=p.symbolInstances.get(L);j.crossTileID||(j.crossTileID=x.generate(),B[j.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Zr(l,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(l,p){for(const x of p.getCrossTileIDsLists())for(const B of x)delete this.usedCrossTileIDs[l][B]}removeStaleBuckets(l){let p=!1;for(const x in this.indexes){const B=this.indexes[x];for(const L in B)l[B[L].bucketInstanceId]||(this.removeBucketCrossTileIDs(x,B[L]),delete B[L],p=!0)}return p}}class bi{constructor(){this.layerIndexes={},this.crossTileIDs=new co,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,p,x){let B=this.layerIndexes[l.id];B===void 0&&(B=this.layerIndexes[l.id]=new Fs);let L=!1;const j={};B.handleWrapJump(x);for(const _ of p){const E=_.getBucket(l);E&&l.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),B.addBucket(_.tileID,E,this.crossTileIDs)&&(L=!0),j[E.bucketInstanceId]=!0)}return B.removeStaleBuckets(j)&&(L=!0),L}pruneUnusedLayers(l){const p={};l.forEach(x=>{p[x]=!0});for(const x in this.layerIndexes)p[x]||delete this.layerIndexes[x]}}const Ii=(w,l)=>s.t(w,l&&l.filter(p=>p.identifier!=="source.canvas")),ss=s.av();class ji extends s.E{constructor(l){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this._rtlPluginLoaded=()=>{for(const x in this.sourceCaches){const B=this.sourceCaches[x].getSource().type;B!=="vector"&&B!=="geojson"||this.sourceCaches[x].reload()}},this.map=l,this.dispatcher=new Mt(Dt(),l._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(x,B)=>this.getGlyphs(x,B)),this.dispatcher.registerMessageHandler("getImages",(x,B)=>this.getImages(x,B)),this.imageManager=new Xe,this.imageManager.setEventedParent(this),this.glyphManager=new bt(l._requestManager,p.localIdeographFontFamily),this.lineAtlas=new Le(256,512),this.crossTileSymbolIndex=new bi,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.ax()),Xr().on(gi,this._rtlPluginLoaded),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const B=this.sourceCaches[x.sourceId];if(!B)return;const L=B.getSource();if(L&&L.vectorLayerIds)for(const j in this._layers){const _=this._layers[j];_.source===L.id&&this._validateLayer(_)}})}loadURL(l){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),p.validate=typeof p.validate!="boolean"||p.validate;const B=this.map._requestManager.transformRequest(l,Te.Style);this._loadStyleRequest=new AbortController,s.h(B,this._loadStyleRequest).then(L=>{this._loadStyleRequest=null,this._load(L.data,p,x)}).catch(L=>{this._loadStyleRequest=null,L&&this.fire(new s.j(L))})}loadJSON(l){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,I.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,p.validate=p.validate!==!1,this._load(l,p,x)}).catch(()=>{})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(ss,{validate:!1})}_load(l,p,x){var B;const L=p.transformStyle?p.transformStyle(x,l):l;if(!p.validate||!Ii(this,s.x(L))){this._loaded=!0,this.stylesheet=L;for(const j in L.sources)this.addSource(j,L.sources[j],{validate:!1});L.sprite?this._loadSprite(L.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(L.glyphs),this._createLayers(),this.light=new Zt(this.stylesheet.light),this.map.setTerrain((B=this.stylesheet.terrain)!==null&&B!==void 0?B:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const l=s.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",l),this._order=l.map(p=>p.id),this._layers={},this._serializedLayers=null;for(const p of l){const x=s.az(p);x.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=x}}_loadSprite(l){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,B;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(L,j,_,E){return s._(this,void 0,void 0,function*(){const F=ke(L),V=_>1?"@2x":"",q={},K={};for(const{id:te,url:se}of F){const oe=j.transformRequest(j.normalizeSpriteURL(se,V,".json"),Te.SpriteJSON);q[te]=s.h(oe,E);const le=j.transformRequest(j.normalizeSpriteURL(se,V,".png"),Te.SpriteImage);K[te]=be.getImage(le,E)}return yield Promise.all([...Object.values(q),...Object.values(K)]),function(te,se){return s._(this,void 0,void 0,function*(){const oe={};for(const le in te){oe[le]={};const _e=I.getImageCanvasContext((yield se[le]).data),Ie=(yield te[le]).data;for(const ve in Ie){const{width:Se,height:et,x:Oe,y:Re,sdf:Ve,pixelRatio:At,stretchX:dt,stretchY:ft,content:Nt}=Ie[ve];oe[le][ve]={data:null,pixelRatio:At,sdf:Ve,stretchX:dt,stretchY:ft,content:Nt,spriteData:{width:Se,height:et,x:Oe,y:Re,context:_e}}}}return oe})}(q,K)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(L=>{if(this._spriteRequest=null,L)for(const j in L){this._spritesImagesIds[j]=[];const _=this._spritesImagesIds[j]?this._spritesImagesIds[j].filter(E=>!(E in L)):[];for(const E of _)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in L[j]){const F=j==="default"?E:`${j}:${E}`;this._spritesImagesIds[j].push(F),F in this.imageManager.images?this.imageManager.updateImage(F,L[j][E],!1):this.imageManager.addImage(F,L[j][E]),p&&(this._changedImages[F]=!0)}}}).catch(L=>{this._spriteRequest=null,B=L,this.fire(new s.j(B))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),p&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),x&&x(B)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(l){const p=this.sourceCaches[l.source];if(!p)return;const x=l.sourceLayer;if(!x)return;const B=p.getSource();(B.type==="geojson"||B.vectorLayerIds&&B.vectorLayerIds.indexOf(x)===-1)&&this.fire(new s.j(new Error(`Source layer "${x}" does not exist on source "${B.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){const p=this._serializedAllLayers();if(!l||l.length===0)return Object.values(p);const x=[];for(const B of l)p[B]&&x.push(p[B]);return x}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const p=Object.keys(this._layers);for(const x of p){const B=this._layers[x];B.type!=="custom"&&(l[x]=B.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const p=this._changed;if(this._changed){const B=Object.keys(this._updatedLayers),L=Object.keys(this._removedLayers);(B.length||L.length)&&this._updateWorkerLayers(B,L);for(const j in this._updatedSources){const _=this._updatedSources[j];if(_==="reload")this._reloadSource(j);else{if(_!=="clear")throw new Error(`Invalid action ${_}`);this._clearSource(j)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const j in this._updatedPaintProps)this._layers[j].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const x={};for(const B in this.sourceCaches){const L=this.sourceCaches[B];x[B]=L.used,L.used=!1}for(const B of this._order){const L=this._layers[B];L.recalculate(l,this._availableImages),!L.isHidden(l.zoom)&&L.source&&(this.sourceCaches[L.source].used=!0)}for(const B in x){const L=this.sourceCaches[B];x[B]!==L.used&&L.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:B}))}this.light.recalculate(l),this.z=l.zoom,p&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const p in this.sourceCaches)this.sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(l),removedIds:p})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var x;this._checkLoaded();const B=this.serialize();if(l=p.transformStyle?p.transformStyle(B,l):l,((x=p.validate)===null||x===void 0||x)&&Ii(this,s.x(l)))return!1;(l=s.aA(l)).layers=s.ay(l.layers);const L=s.aB(B,l),j=this._getOperationsToPerform(L);if(j.unimplemented.length>0)throw new Error(`Unimplemented: ${j.unimplemented.join(", ")}.`);if(j.operations.length===0)return!1;for(const _ of j.operations)_();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const p=[],x=[];for(const B of l)switch(B.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":p.push(()=>this.addLayer.apply(this,B.args));break;case"removeLayer":p.push(()=>this.removeLayer.apply(this,B.args));break;case"setPaintProperty":p.push(()=>this.setPaintProperty.apply(this,B.args));break;case"setLayoutProperty":p.push(()=>this.setLayoutProperty.apply(this,B.args));break;case"setFilter":p.push(()=>this.setFilter.apply(this,B.args));break;case"addSource":p.push(()=>this.addSource.apply(this,B.args));break;case"removeSource":p.push(()=>this.removeSource.apply(this,B.args));break;case"setLayerZoomRange":p.push(()=>this.setLayerZoomRange.apply(this,B.args));break;case"setLight":p.push(()=>this.setLight.apply(this,B.args));break;case"setGeoJSONSourceData":p.push(()=>this.setGeoJSONSourceData.apply(this,B.args));break;case"setGlyphs":p.push(()=>this.setGlyphs.apply(this,B.args));break;case"setSprite":p.push(()=>this.setSprite.apply(this,B.args));break;case"setTerrain":p.push(()=>this.map.setTerrain.apply(this,B.args));break;case"setTransition":p.push(()=>{});break;default:x.push(B.command)}return{operations:p,unimplemented:x}}addImage(l,p){if(this.getImage(l))return this.fire(new s.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,p),this._afterImageUpdated(l)}updateImage(l,p){this.imageManager.updateImage(l,p)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new s.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,p){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(s.x.source,`sources.${l}`,p,null,x))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const B=this.sourceCaches[l]=new Qt(l,p,this.dispatcher);B.style=this,B.setEventedParent(this,()=>({isSourceLoaded:B.loaded(),source:B.serialize(),sourceId:l})),B.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===l)return this.fire(new s.j(new Error(`Source "${l}" cannot be removed while layer "${x}" is using it.`)));const p=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],p.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),p.setEventedParent(null),p.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,p){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const x=this.sourceCaches[l].getSource();if(x.type!=="geojson")throw new Error(`geojsonSource.type is ${x.type}, which is !== 'geojson`);x.setData(p),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,p){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const B=l.id;if(this.getLayer(B))return void this.fire(new s.j(new Error(`Layer "${B}" already exists on this map.`)));let L;if(l.type==="custom"){if(Ii(this,s.aC(l)))return;L=s.az(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(B,l.source),l=s.aA(l),l=s.e(l,{source:B})),this._validate(s.x.layer,`layers.${B}`,l,{arrayIndex:-1},x))return;L=s.az(l),this._validateLayer(L),L.setEventedParent(this,{layer:{id:B}})}const j=p?this._order.indexOf(p):this._order.length;if(p&&j===-1)this.fire(new s.j(new Error(`Cannot add layer "${B}" before non-existing layer "${p}".`)));else{if(this._order.splice(j,0,B),this._layerOrderChanged=!0,this._layers[B]=L,this._removedLayers[B]&&L.source&&L.type!=="custom"){const _=this._removedLayers[B];delete this._removedLayers[B],_.type!==L.type?this._updatedSources[L.source]="clear":(this._updatedSources[L.source]="reload",this.sourceCaches[L.source].pause())}this._updateLayer(L),L.onAdd&&L.onAdd(this.map)}}moveLayer(l,p){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new s.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===p)return;const x=this._order.indexOf(l);this._order.splice(x,1);const B=p?this._order.indexOf(p):this._order.length;p&&B===-1?this.fire(new s.j(new Error(`Cannot move layer "${l}" before non-existing layer "${p}".`))):(this._order.splice(B,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const p=this._layers[l];if(!p)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${l}".`)));p.setEventedParent(null);const x=this._order.indexOf(l);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=p,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],p.onRemove&&p.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,p,x){this._checkLoaded();const B=this.getLayer(l);B?B.minzoom===p&&B.maxzoom===x||(p!=null&&(B.minzoom=p),x!=null&&(B.maxzoom=x),this._updateLayer(B)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,p){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const B=this.getLayer(l);if(B){if(!s.aD(B.filter,p))return p==null?(B.filter=void 0,void this._updateLayer(B)):void(this._validate(s.x.filter,`layers.${B.id}.filter`,p,null,x)||(B.filter=s.aA(p),this._updateLayer(B)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return s.aA(this.getLayer(l).filter)}setLayoutProperty(l,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const L=this.getLayer(l);L?s.aD(L.getLayoutProperty(p),x)||(L.setLayoutProperty(p,x,B),this._updateLayer(L)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,p){const x=this.getLayer(l);if(x)return x.getLayoutProperty(p);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const L=this.getLayer(l);L?s.aD(L.getPaintProperty(p),x)||(L.setPaintProperty(p,x,B)&&this._updateLayer(L),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,p){return this.getLayer(l).getPaintProperty(p)}setFeatureState(l,p){this._checkLoaded();const x=l.source,B=l.sourceLayer,L=this.sourceCaches[x];if(L===void 0)return void this.fire(new s.j(new Error(`The source '${x}' does not exist in the map's style.`)));const j=L.getSource().type;j==="geojson"&&B?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):j!=="vector"||B?(l.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),L.setFeatureState(B,l.id,p)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,p){this._checkLoaded();const x=l.source,B=this.sourceCaches[x];if(B===void 0)return void this.fire(new s.j(new Error(`The source '${x}' does not exist in the map's style.`)));const L=B.getSource().type,j=L==="vector"?l.sourceLayer:void 0;L!=="vector"||j?p&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):B.removeFeatureState(j,l.id,p):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const p=l.source,x=l.sourceLayer,B=this.sourceCaches[p];if(B!==void 0)return B.getSource().type!=="vector"||x?(l.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),B.getFeatureState(x,l.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${p}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=s.aE(this.sourceCaches,L=>L.serialize()),p=this._serializeByIds(this._order),x=this.map.getTerrain()||void 0,B=this.stylesheet;return s.aF({version:B.version,name:B.name,metadata:B.metadata,light:B.light,center:B.center,zoom:B.zoom,bearing:B.bearing,pitch:B.pitch,sprite:B.sprite,glyphs:B.glyphs,transition:B.transition,sources:l,layers:p,terrain:x},L=>L!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const p=j=>this._layers[j].type==="fill-extrusion",x={},B=[];for(let j=this._order.length-1;j>=0;j--){const _=this._order[j];if(p(_)){x[_]=j;for(const E of l){const F=E[_];if(F)for(const V of F)B.push(V)}}}B.sort((j,_)=>_.intersectionZ-j.intersectionZ);const L=[];for(let j=this._order.length-1;j>=0;j--){const _=this._order[j];if(p(_))for(let E=B.length-1;E>=0;E--){const F=B[E].feature;if(x[F.layer.id]<j)break;L.push(F),B.pop()}else for(const E of l){const F=E[_];if(F)for(const V of F)L.push(V.feature)}}return L}queryRenderedFeatures(l,p,x){p&&p.filter&&this._validate(s.x.filter,"queryRenderedFeatures.filter",p.filter,null,p);const B={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const _ of p.layers){const E=this._layers[_];if(!E)return this.fire(new s.j(new Error(`The layer '${_}' does not exist in the map's style and cannot be queried for features.`))),[];B[E.source]=!0}}const L=[];p.availableImages=this._availableImages;const j=this._serializedAllLayers();for(const _ in this.sourceCaches)p.layers&&!B[_]||L.push(vr(this.sourceCaches[_],this._layers,j,l,p,x));return this.placement&&L.push(function(_,E,F,V,q,K,te){const se={},oe=K.queryRenderedSymbols(V),le=[];for(const _e of Object.keys(oe).map(Number))le.push(te[_e]);le.sort(br);for(const _e of le){const Ie=_e.featureIndex.lookupSymbolFeatures(oe[_e.bucketInstanceId],E,_e.bucketIndex,_e.sourceLayerIndex,q.filter,q.layers,q.availableImages,_);for(const ve in Ie){const Se=se[ve]=se[ve]||[],et=Ie[ve];et.sort((Oe,Re)=>{const Ve=_e.featureSortOrder;if(Ve){const At=Ve.indexOf(Oe.featureIndex);return Ve.indexOf(Re.featureIndex)-At}return Re.featureIndex-Oe.featureIndex});for(const Oe of et)Se.push(Oe)}}for(const _e in se)se[_e].forEach(Ie=>{const ve=Ie.feature,Se=F[_[_e].source].getFeatureState(ve.layer["source-layer"],ve.id);ve.source=ve.layer.source,ve.layer["source-layer"]&&(ve.sourceLayer=ve.layer["source-layer"]),ve.state=Se});return se}(this._layers,j,this.sourceCaches,l,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(L)}querySourceFeatures(l,p){p&&p.filter&&this._validate(s.x.filter,"querySourceFeatures.filter",p.filter,null,p);const x=this.sourceCaches[l];return x?function(B,L){const j=B.getRenderableIds().map(F=>B.getTileByID(F)),_=[],E={};for(let F=0;F<j.length;F++){const V=j[F],q=V.tileID.canonical.key;E[q]||(E[q]=!0,V.querySourceFeatures(_,L))}return _}(x,p):[]}getLight(){return this.light.getLight()}setLight(l){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const x=this.light.getLight();let B=!1;for(const j in l)if(!s.aD(l[j],x[j])){B=!0;break}if(!B)return;const L={now:I.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,p),this.light.updateTransitions(L)}_validate(l,p,x,B){let L=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!L||L.validate!==!1)&&Ii(this,l.call(s.x,s.e({key:p,style:this.serialize(),value:x,styleSpec:s.v},B)))}_remove(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Xr().off(gi,this._rtlPluginLoaded);for(const p in this._layers)this._layers[p].setEventedParent(null);for(const p in this.sourceCaches){const x=this.sourceCaches[p];x.setEventedParent(null),x.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const p in this.sourceCaches)this.sourceCaches[p].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,p,x,B){let L=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,j=!1,_=!1;const E={};for(const F of this._order){const V=this._layers[F];if(V.type!=="symbol")continue;if(!E[V.source]){const K=this.sourceCaches[V.source];E[V.source]=K.getRenderableIds(!0).map(te=>K.getTileByID(te)).sort((te,se)=>se.tileID.overscaledZ-te.tileID.overscaledZ||(te.tileID.isLessThan(se.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(V,E[V.source],l.center.lng);j=j||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((L=L||this._layerOrderChanged||x===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(I.now(),l.zoom))&&(this.pauseablePlacement=new Xa(l,this.map.terrain,this._order,L,p,x,B,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(I.now()),_=!0),j&&this.pauseablePlacement.placement.setStale()),_||j)for(const F of this._order){const V=this._layers[F];V.type==="symbol"&&this.placement.updateLayerOpacities(V,E[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(I.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,p){return s._(this,void 0,void 0,function*(){const x=yield this.imageManager.getImages(p.icons);this._updateTilesForChangedImages();const B=this.sourceCaches[p.source];return B&&B.setDependencies(p.tileID.key,p.type,p.icons),x})}getGlyphs(l,p){return s._(this,void 0,void 0,function*(){const x=yield this.glyphManager.getGlyphs(p.stacks),B=this.sourceCaches[p.source];return B&&B.setDependencies(p.tileID.key,p.type,[""]),x})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),l&&this._validate(s.x.glyphs,"glyphs",l,null,p)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,p){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},B=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const L=[{id:l,url:p}],j=[...ke(this.stylesheet.sprite),...L];this._validate(s.x.sprite,"sprite",j,null,x)||(this.stylesheet.sprite=j,this._loadSprite(L,!0,B))}removeSprite(l){this._checkLoaded();const p=ke(this.stylesheet.sprite);if(p.find(x=>x.id===l)){if(this._spritesImagesIds[l])for(const x of this._spritesImagesIds[l])this.imageManager.removeImage(x),this._changedImages[x]=!0;p.splice(p.findIndex(x=>x.id===l),1),this.stylesheet.sprite=p.length>0?p:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return ke(this.stylesheet.sprite)}setSprite(l){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},x=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),l&&this._validate(s.x.sprite,"sprite",l,null,p)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,x):(this._unloadSprite(),x&&x(null)))}}var Tn=s.X([{name:"a_pos",type:"Int16",components:2}]),Cn="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const mo={prelude:Mi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Mi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Mi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Mi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Mi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Mi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Mi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Mi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Mi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Mi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Mi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Mi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Mi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Mi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Mi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Mi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Mi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Mi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Mi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Mi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Mi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Mi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Mi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Mi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Mi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Cn),terrainDepth:Mi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Cn),terrainCoords:Mi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Cn)};function Mi(w,l){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=l.match(/attribute ([\w]+) ([\w]+)/g),B=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),L=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),j=L?L.concat(B):B,_={};return{fragmentSource:w=w.replace(p,(E,F,V,q,K)=>(_[K]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${K}
varying ${V} ${q} ${K};
#else
uniform ${V} ${q} u_${K};
#endif
`:`
#ifdef HAS_UNIFORM_u_${K}
    ${V} ${q} ${K} = u_${K};
#endif
`)),vertexSource:l=l.replace(p,(E,F,V,q,K)=>{const te=q==="float"?"vec2":"vec4",se=K.match(/color/)?"color":te;return _[K]?F==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
attribute ${V} ${te} a_${K};
varying ${V} ${q} ${K};
#else
uniform ${V} ${q} u_${K};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = a_${K};
#else
    ${V} ${q} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = unpack_mix_${se}(a_${K}, u_${K}_t);
#else
    ${V} ${q} ${K} = u_${K};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
attribute ${V} ${te} a_${K};
#else
uniform ${V} ${q} u_${K};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${V} ${q} ${K} = a_${K};
#else
    ${V} ${q} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${V} ${q} ${K} = unpack_mix_${se}(a_${K}, u_${K}_t);
#else
    ${V} ${q} ${K} = u_${K};
#endif
`}),staticAttributes:x,staticUniforms:j}}class Za{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,p,x,B,L,j,_,E,F){this.context=l;let V=this.boundPaintVertexBuffers.length!==B.length;for(let q=0;!V&&q<B.length;q++)this.boundPaintVertexBuffers[q]!==B[q]&&(V=!0);!this.vao||this.boundProgram!==p||this.boundLayoutVertexBuffer!==x||V||this.boundIndexBuffer!==L||this.boundVertexOffset!==j||this.boundDynamicVertexBuffer!==_||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==F?this.freshBind(p,x,B,L,j,_,E,F):(l.bindVertexArray.set(this.vao),_&&_.bind(),L&&L.dynamicDraw&&L.bind(),E&&E.bind(),F&&F.bind())}freshBind(l,p,x,B,L,j,_,E){const F=l.numAttributes,V=this.context,q=V.gl;this.vao&&this.destroy(),this.vao=V.createVertexArray(),V.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=x,this.boundIndexBuffer=B,this.boundVertexOffset=L,this.boundDynamicVertexBuffer=j,this.boundDynamicVertexBuffer2=_,this.boundDynamicVertexBuffer3=E,p.enableAttributes(q,l);for(const K of x)K.enableAttributes(q,l);j&&j.enableAttributes(q,l),_&&_.enableAttributes(q,l),E&&E.enableAttributes(q,l),p.bind(),p.setVertexAttribPointers(q,l,L);for(const K of x)K.bind(),K.setVertexAttribPointers(q,l,L);j&&(j.bind(),j.setVertexAttribPointers(q,l,L)),B&&B.bind(),_&&(_.bind(),_.setVertexAttribPointers(q,l,L)),E&&(E.bind(),E.setVertexAttribPointers(q,l,L)),V.currentNumAttributes=F}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ys(w){const l=[];for(let p=0;p<w.length;p++){if(w[p]===null)continue;const x=w[p].split(" ");l.push(x.pop())}return l}class Ja{constructor(l,p,x,B,L,j){const _=l.gl;this.program=_.createProgram();const E=Ys(p.staticAttributes),F=x?x.getBinderAttributes():[],V=E.concat(F),q=mo.prelude.staticUniforms?Ys(mo.prelude.staticUniforms):[],K=p.staticUniforms?Ys(p.staticUniforms):[],te=x?x.getBinderUniforms():[],se=q.concat(K).concat(te),oe=[];for(const Oe of se)oe.indexOf(Oe)<0&&oe.push(Oe);const le=x?x.defines():[];L&&le.push("#define OVERDRAW_INSPECTOR;"),j&&le.push("#define TERRAIN3D;");const _e=le.concat(mo.prelude.fragmentSource,p.fragmentSource).join(`
`),Ie=le.concat(mo.prelude.vertexSource,p.vertexSource).join(`
`),ve=_.createShader(_.FRAGMENT_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(ve,_e),_.compileShader(ve),!_.getShaderParameter(ve,_.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${_.getShaderInfoLog(ve)}`);_.attachShader(this.program,ve);const Se=_.createShader(_.VERTEX_SHADER);if(_.isContextLost())return void(this.failedToCreate=!0);if(_.shaderSource(Se,Ie),_.compileShader(Se),!_.getShaderParameter(Se,_.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${_.getShaderInfoLog(Se)}`);_.attachShader(this.program,Se),this.attributes={};const et={};this.numAttributes=V.length;for(let Oe=0;Oe<this.numAttributes;Oe++)V[Oe]&&(_.bindAttribLocation(this.program,Oe,V[Oe]),this.attributes[V[Oe]]=Oe);if(_.linkProgram(this.program),!_.getProgramParameter(this.program,_.LINK_STATUS))throw new Error(`Program failed to link: ${_.getProgramInfoLog(this.program)}`);_.deleteShader(Se),_.deleteShader(ve);for(let Oe=0;Oe<oe.length;Oe++){const Re=oe[Oe];if(Re&&!et[Re]){const Ve=_.getUniformLocation(this.program,Re);Ve&&(et[Re]=Ve)}}this.fixedUniforms=B(l,et),this.terrainUniforms=((Oe,Re)=>({u_depth:new s.aG(Oe,Re.u_depth),u_terrain:new s.aG(Oe,Re.u_terrain),u_terrain_dim:new s.aH(Oe,Re.u_terrain_dim),u_terrain_matrix:new s.aI(Oe,Re.u_terrain_matrix),u_terrain_unpack:new s.aJ(Oe,Re.u_terrain_unpack),u_terrain_exaggeration:new s.aH(Oe,Re.u_terrain_exaggeration)}))(l,et),this.binderUniforms=x?x.getUniforms(l,et):[]}draw(l,p,x,B,L,j,_,E,F,V,q,K,te,se,oe,le,_e,Ie){const ve=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(x),l.setStencilMode(B),l.setColorMode(L),l.setCullFace(j),E){l.activeTexture.set(ve.TEXTURE2),ve.bindTexture(ve.TEXTURE_2D,E.depthTexture),l.activeTexture.set(ve.TEXTURE3),ve.bindTexture(ve.TEXTURE_2D,E.texture);for(const et in this.terrainUniforms)this.terrainUniforms[et].set(E[et])}for(const et in this.fixedUniforms)this.fixedUniforms[et].set(_[et]);oe&&oe.setUniforms(l,this.binderUniforms,te,{zoom:se});let Se=0;switch(p){case ve.LINES:Se=2;break;case ve.TRIANGLES:Se=3;break;case ve.LINE_STRIP:Se=1}for(const et of K.get()){const Oe=et.vaos||(et.vaos={});(Oe[F]||(Oe[F]=new Za)).bind(l,this,V,oe?oe.getPaintVertexBuffers():[],q,et.vertexOffset,le,_e,Ie),ve.drawElements(p,et.primitiveLength*Se,ve.UNSIGNED_SHORT,et.primitiveOffset*Se*2)}}}function He(w,l,p){const x=1/Gt(p,1,l.transform.tileZoom),B=Math.pow(2,p.tileID.overscaledZ),L=p.tileSize*Math.pow(2,l.transform.tileZoom)/B,j=L*(p.tileID.canonical.x+p.tileID.wrap*B),_=L*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[x,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[j>>16,_>>16],u_pixel_coord_lower:[65535&j,65535&_]}}const Je=(w,l,p,x)=>{const B=l.style.light,L=B.properties.get("position"),j=[L.x,L.y,L.z],_=function(){var F=new s.A(9);return s.A!=Float32Array&&(F[1]=0,F[2]=0,F[3]=0,F[5]=0,F[6]=0,F[7]=0),F[0]=1,F[4]=1,F[8]=1,F}();B.properties.get("anchor")==="viewport"&&function(F,V){var q=Math.sin(V),K=Math.cos(V);F[0]=K,F[1]=q,F[2]=0,F[3]=-q,F[4]=K,F[5]=0,F[6]=0,F[7]=0,F[8]=1}(_,-l.transform.angle),function(F,V,q){var K=V[0],te=V[1],se=V[2];F[0]=K*q[0]+te*q[3]+se*q[6],F[1]=K*q[1]+te*q[4]+se*q[7],F[2]=K*q[2]+te*q[5]+se*q[8]}(j,j,_);const E=B.properties.get("color");return{u_matrix:w,u_lightpos:j,u_lightintensity:B.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+p,u_opacity:x}},gt=(w,l,p,x,B,L,j)=>s.e(Je(w,l,p,x),He(L,l,j),{u_height_factor:-Math.pow(2,B.overscaledZ)/j.tileSize/8}),Ot=w=>({u_matrix:w}),fr=(w,l,p,x)=>s.e(Ot(w),He(p,l,x)),qr=(w,l)=>({u_matrix:w,u_world:l}),Ci=(w,l,p,x,B)=>s.e(fr(w,l,p,x),{u_world:B}),In=(w,l,p,x)=>{const B=w.transform;let L,j;if(x.paint.get("circle-pitch-alignment")==="map"){const _=Gt(p,1,B.zoom);L=!0,j=[_,_]}else L=!1,j=B.pixelsToGLUnits;return{u_camera_to_center_distance:B.cameraToCenterDistance,u_scale_with_map:+(x.paint.get("circle-pitch-scale")==="map"),u_matrix:w.translatePosMatrix(l.posMatrix,p,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_pitch_with_map:+L,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:j}},qn=(w,l,p)=>{const x=Gt(p,1,l.zoom),B=Math.pow(2,l.zoom-p.tileID.overscaledZ),L=p.tileID.overscaleFactor();return{u_matrix:w,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:x,u_extrude_scale:[l.pixelsToGLUnits[0]/(x*B),l.pixelsToGLUnits[1]/(x*B)],u_overscale_factor:L}},os=function(w,l){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:w,u_color:l,u_overlay:0,u_overlay_scale:p}},_n=w=>({u_matrix:w}),fu=(w,l,p,x)=>({u_matrix:w,u_extrude_scale:Gt(l,1,p),u_intensity:x});function Hl(w,l){const p=Math.pow(2,l.canonical.z),x=l.canonical.y;return[new s.Y(0,x/p).toLngLat().lat,new s.Y(0,(x+1)/p).toLngLat().lat]}const Ei=(w,l,p,x)=>{const B=w.transform;return{u_matrix:Ia(w,l,p,x),u_ratio:1/Gt(l,1,B.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/B.pixelsToGLUnits[0],1/B.pixelsToGLUnits[1]]}},Ya=(w,l,p,x,B)=>s.e(Ei(w,l,p,B),{u_image:0,u_image_height:x}),Gl=(w,l,p,x,B)=>{const L=w.transform,j=Lo(l,L);return{u_matrix:Ia(w,l,p,B),u_texsize:l.imageAtlasTexture.size,u_ratio:1/Gt(l,1,L.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[j,x.fromScale,x.toScale],u_fade:x.t,u_units_to_pixels:[1/L.pixelsToGLUnits[0],1/L.pixelsToGLUnits[1]]}},as=(w,l,p,x,B,L)=>{const j=w.lineAtlas,_=Lo(l,w.transform),E=p.layout.get("line-cap")==="round",F=j.getDash(x.from,E),V=j.getDash(x.to,E),q=F.width*B.fromScale,K=V.width*B.toScale;return s.e(Ei(w,l,p,L),{u_patternscale_a:[_/q,-F.height/2],u_patternscale_b:[_/K,-V.height/2],u_sdfgamma:j.width/(256*Math.min(q,K)*w.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:V.y,u_mix:B.t})};function Lo(w,l){return 1/Gt(w,1,l.tileZoom)}function Ia(w,l,p,x){return w.translatePosMatrix(x?x.posMatrix:l.tileID.posMatrix,l,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}const ys=(w,l,p,x,B)=>{return{u_matrix:w,u_tl_parent:l,u_scale_parent:p,u_buffer_scale:1,u_fade_t:x.mix,u_opacity:x.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:(j=B.paint.get("raster-saturation"),j>0?1-1/(1.001-j):-j),u_contrast_factor:(L=B.paint.get("raster-contrast"),L>0?1/(1-L):1+L),u_spin_weights:La(B.paint.get("raster-hue-rotate"))};var L,j};function La(w){w*=Math.PI/180;const l=Math.sin(w),p=Math.cos(w);return[(2*p+1)/3,(-Math.sqrt(3)*l-p+1)/3,(Math.sqrt(3)*l-p+1)/3]}const el=(w,l,p,x,B,L,j,_,E,F)=>{const V=B.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+p,u_aspect_ratio:V.width/V.height,u_fade_change:B.options.fadeDuration?B.symbolFadeChange:1,u_matrix:L,u_label_plane_matrix:j,u_coord_matrix:_,u_is_text:+E,u_pitch_with_map:+x,u_texsize:F,u_texture:0}},Aa=(w,l,p,x,B,L,j,_,E,F,V)=>{const q=B.transform;return s.e(el(w,l,p,x,B,L,j,_,E,F),{u_gamma_scale:x?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:B.pixelRatio,u_is_halo:+V})},Vc=(w,l,p,x,B,L,j,_,E,F)=>s.e(Aa(w,l,p,x,B,L,j,_,!0,E,!0),{u_texsize_icon:F,u_texture_icon:1}),tl=(w,l,p)=>({u_matrix:w,u_opacity:l,u_color:p}),yo=(w,l,p,x,B,L)=>s.e(function(j,_,E,F){const V=E.imageManager.getPattern(j.from.toString()),q=E.imageManager.getPattern(j.to.toString()),{width:K,height:te}=E.imageManager.getPixelSize(),se=Math.pow(2,F.tileID.overscaledZ),oe=F.tileSize*Math.pow(2,E.transform.tileZoom)/se,le=oe*(F.tileID.canonical.x+F.tileID.wrap*se),_e=oe*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:V.tl,u_pattern_br_a:V.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[K,te],u_mix:_.t,u_pattern_size_a:V.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/Gt(F,1,E.transform.tileZoom),u_pixel_coord_upper:[le>>16,_e>>16],u_pixel_coord_lower:[65535&le,65535&_e]}}(x,L,p,B),{u_matrix:w,u_opacity:l}),Fi={fillExtrusion:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_lightpos:new s.aK(w,l.u_lightpos),u_lightintensity:new s.aH(w,l.u_lightintensity),u_lightcolor:new s.aK(w,l.u_lightcolor),u_vertical_gradient:new s.aH(w,l.u_vertical_gradient),u_opacity:new s.aH(w,l.u_opacity)}),fillExtrusionPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_lightpos:new s.aK(w,l.u_lightpos),u_lightintensity:new s.aH(w,l.u_lightintensity),u_lightcolor:new s.aK(w,l.u_lightcolor),u_vertical_gradient:new s.aH(w,l.u_vertical_gradient),u_height_factor:new s.aH(w,l.u_height_factor),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade),u_opacity:new s.aH(w,l.u_opacity)}),fill:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix)}),fillPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),fillOutline:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world)}),fillOutlinePattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),circle:(w,l)=>({u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_scale_with_map:new s.aG(w,l.u_scale_with_map),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_extrude_scale:new s.aL(w,l.u_extrude_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_matrix:new s.aI(w,l.u_matrix)}),collisionBox:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aH(w,l.u_pixels_to_tile_units),u_extrude_scale:new s.aL(w,l.u_extrude_scale),u_overscale_factor:new s.aH(w,l.u_overscale_factor)}),collisionCircle:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_inv_matrix:new s.aI(w,l.u_inv_matrix),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_viewport_size:new s.aL(w,l.u_viewport_size)}),debug:(w,l)=>({u_color:new s.aM(w,l.u_color),u_matrix:new s.aI(w,l.u_matrix),u_overlay:new s.aG(w,l.u_overlay),u_overlay_scale:new s.aH(w,l.u_overlay_scale)}),clippingMask:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix)}),heatmap:(w,l)=>({u_extrude_scale:new s.aH(w,l.u_extrude_scale),u_intensity:new s.aH(w,l.u_intensity),u_matrix:new s.aI(w,l.u_matrix)}),heatmapTexture:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world),u_image:new s.aG(w,l.u_image),u_color_ramp:new s.aG(w,l.u_color_ramp),u_opacity:new s.aH(w,l.u_opacity)}),hillshade:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_latrange:new s.aL(w,l.u_latrange),u_light:new s.aL(w,l.u_light),u_shadow:new s.aM(w,l.u_shadow),u_highlight:new s.aM(w,l.u_highlight),u_accent:new s.aM(w,l.u_accent)}),hillshadePrepare:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_dimension:new s.aL(w,l.u_dimension),u_zoom:new s.aH(w,l.u_zoom),u_unpack:new s.aJ(w,l.u_unpack)}),line:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels)}),lineGradient:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_image:new s.aG(w,l.u_image),u_image_height:new s.aH(w,l.u_image_height)}),linePattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texsize:new s.aL(w,l.u_texsize),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_image:new s.aG(w,l.u_image),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),lineSDF:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_patternscale_a:new s.aL(w,l.u_patternscale_a),u_patternscale_b:new s.aL(w,l.u_patternscale_b),u_sdfgamma:new s.aH(w,l.u_sdfgamma),u_image:new s.aG(w,l.u_image),u_tex_y_a:new s.aH(w,l.u_tex_y_a),u_tex_y_b:new s.aH(w,l.u_tex_y_b),u_mix:new s.aH(w,l.u_mix)}),raster:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_tl_parent:new s.aL(w,l.u_tl_parent),u_scale_parent:new s.aH(w,l.u_scale_parent),u_buffer_scale:new s.aH(w,l.u_buffer_scale),u_fade_t:new s.aH(w,l.u_fade_t),u_opacity:new s.aH(w,l.u_opacity),u_image0:new s.aG(w,l.u_image0),u_image1:new s.aG(w,l.u_image1),u_brightness_low:new s.aH(w,l.u_brightness_low),u_brightness_high:new s.aH(w,l.u_brightness_high),u_saturation_factor:new s.aH(w,l.u_saturation_factor),u_contrast_factor:new s.aH(w,l.u_contrast_factor),u_spin_weights:new s.aK(w,l.u_spin_weights)}),symbolIcon:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texture:new s.aG(w,l.u_texture)}),symbolSDF:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texture:new s.aG(w,l.u_texture),u_gamma_scale:new s.aH(w,l.u_gamma_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_is_halo:new s.aG(w,l.u_is_halo)}),symbolTextAndIcon:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texsize_icon:new s.aL(w,l.u_texsize_icon),u_texture:new s.aG(w,l.u_texture),u_texture_icon:new s.aG(w,l.u_texture_icon),u_gamma_scale:new s.aH(w,l.u_gamma_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_is_halo:new s.aG(w,l.u_is_halo)}),background:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_opacity:new s.aH(w,l.u_opacity),u_color:new s.aM(w,l.u_color)}),backgroundPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_opacity:new s.aH(w,l.u_opacity),u_image:new s.aG(w,l.u_image),u_pattern_tl_a:new s.aL(w,l.u_pattern_tl_a),u_pattern_br_a:new s.aL(w,l.u_pattern_br_a),u_pattern_tl_b:new s.aL(w,l.u_pattern_tl_b),u_pattern_br_b:new s.aL(w,l.u_pattern_br_b),u_texsize:new s.aL(w,l.u_texsize),u_mix:new s.aH(w,l.u_mix),u_pattern_size_a:new s.aL(w,l.u_pattern_size_a),u_pattern_size_b:new s.aL(w,l.u_pattern_size_b),u_scale_a:new s.aH(w,l.u_scale_a),u_scale_b:new s.aH(w,l.u_scale_b),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aH(w,l.u_tile_units_to_pixels)}),terrain:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texture:new s.aG(w,l.u_texture),u_ele_delta:new s.aH(w,l.u_ele_delta)}),terrainDepth:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ele_delta:new s.aH(w,l.u_ele_delta)}),terrainCoords:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texture:new s.aG(w,l.u_texture),u_terrain_coords_id:new s.aH(w,l.u_terrain_coords_id),u_ele_delta:new s.aH(w,l.u_ele_delta)})};class da{constructor(l,p,x){this.context=l;const B=l.gl;this.buffer=B.createBuffer(),this.dynamicDraw=!!x,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),B.bufferData(B.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?B.DYNAMIC_DRAW:B.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const p=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const As={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class En{constructor(l,p,x,B){this.length=p.length,this.attributes=x,this.itemSize=p.bytesPerElement,this.dynamicDraw=B,this.context=l;const L=l.gl;this.buffer=L.createBuffer(),l.bindVertexBuffer.set(this.buffer),L.bufferData(L.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?L.DYNAMIC_DRAW:L.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,p){for(let x=0;x<this.attributes.length;x++){const B=p.attributes[this.attributes[x].name];B!==void 0&&l.enableVertexAttribArray(B)}}setVertexAttribPointers(l,p,x){for(let B=0;B<this.attributes.length;B++){const L=this.attributes[B],j=p.attributes[L.name];j!==void 0&&l.vertexAttribPointer(j,L.components,l[As[L.type]],!1,this.itemSize,L.offset+this.itemSize*(x||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ds=new WeakMap;function fa(w){var l;if(ds.has(w))return ds.get(w);{const p=(l=w.getParameter(w.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return ds.set(w,p),p}}class qi{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class dl extends qi{getDefault(){return s.aO.transparent}set(l){const p=this.current;(l.r!==p.r||l.g!==p.g||l.b!==p.b||l.a!==p.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class jl extends qi{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Mo extends qi{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Zo extends qi{getDefault(){return[!0,!0,!0,!0]}set(l){const p=this.current;(l[0]!==p[0]||l[1]!==p[1]||l[2]!==p[2]||l[3]!==p[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class bc extends qi{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class Jo extends qi{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class _o extends qi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const p=this.current;(l.func!==p.func||l.ref!==p.ref||l.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class xc extends qi{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const p=this.current;(l[0]!==p[0]||l[1]!==p[1]||l[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Yo extends qi{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;l?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=l,this.dirty=!1}}class ql extends qi{getDefault(){return[0,1]}set(l){const p=this.current;(l[0]!==p[0]||l[1]!==p[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class Hc extends qi{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;l?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=l,this.dirty=!1}}class Eh extends qi{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class pu extends qi{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;l?p.enable(p.BLEND):p.disable(p.BLEND),this.current=l,this.dirty=!1}}class gu extends qi{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const p=this.current;(l[0]!==p[0]||l[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Vu extends qi{getDefault(){return s.aO.transparent}set(l){const p=this.current;(l.r!==p.r||l.g!==p.g||l.b!==p.b||l.a!==p.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class $l extends qi{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class rl extends qi{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;l?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=l,this.dirty=!1}}class il extends qi{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Kl extends qi{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class nl extends qi{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class pa extends qi{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class fl extends qi{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const p=this.current;(l[0]!==p[0]||l[1]!==p[1]||l[2]!==p[2]||l[3]!==p[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Wl extends qi{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class uo extends qi{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class ga extends qi{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class ne extends qi{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Pe extends qi{getDefault(){return null}set(l){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ct extends qi{getDefault(){return null}set(l){var p;if(l===this.current&&!this.dirty)return;const x=this.gl;fa(x)?x.bindVertexArray(l):(p=x.getExtension("OES_vertex_array_object"))===null||p===void 0||p.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class _t extends qi{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class xt extends qi{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Lt extends qi{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class gr extends qi{constructor(l,p){super(l),this.context=l,this.parent=p}getDefault(){return null}}class sr extends gr{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class si extends gr{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class $r extends gr{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_STENCIL_ATTACHMENT,p.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class ei{constructor(l,p,x,B,L){this.context=l,this.width=p,this.height=x;const j=l.gl,_=this.framebuffer=j.createFramebuffer();if(this.colorAttachment=new sr(l,_),B)this.depthAttachment=L?new $r(l,_):new si(l,_);else if(L)throw new Error("Stencil cannot be set without depth");if(j.checkFramebufferStatus(j.FRAMEBUFFER)!==j.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,p=this.colorAttachment.get();if(p&&l.deleteTexture(p),this.depthAttachment){const x=this.depthAttachment.get();x&&l.deleteRenderbuffer(x)}l.deleteFramebuffer(this.framebuffer)}}class ui{constructor(l,p,x){this.blendFunction=l,this.blendColor=p,this.mask=x}}ui.Replace=[1,0],ui.disabled=new ui(ui.Replace,s.aO.transparent,[!1,!1,!1,!1]),ui.unblended=new ui(ui.Replace,s.aO.transparent,[!0,!0,!0,!0]),ui.alphaBlended=new ui([1,771],s.aO.transparent,[!0,!0,!0,!0]);class $n{constructor(l){var p,x;if(this.gl=l,this.clearColor=new dl(this),this.clearDepth=new jl(this),this.clearStencil=new Mo(this),this.colorMask=new Zo(this),this.depthMask=new bc(this),this.stencilMask=new Jo(this),this.stencilFunc=new _o(this),this.stencilOp=new xc(this),this.stencilTest=new Yo(this),this.depthRange=new ql(this),this.depthTest=new Hc(this),this.depthFunc=new Eh(this),this.blend=new pu(this),this.blendFunc=new gu(this),this.blendColor=new Vu(this),this.blendEquation=new $l(this),this.cullFace=new rl(this),this.cullFaceSide=new il(this),this.frontFace=new Kl(this),this.program=new nl(this),this.activeTexture=new pa(this),this.viewport=new fl(this),this.bindFramebuffer=new Wl(this),this.bindRenderbuffer=new uo(this),this.bindTexture=new ga(this),this.bindVertexBuffer=new ne(this),this.bindElementBuffer=new Pe(this),this.bindVertexArray=new ct(this),this.pixelStoreUnpack=new _t(this),this.pixelStoreUnpackPremultiplyAlpha=new xt(this),this.pixelStoreUnpackFlipY=new Lt(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),fa(l)){this.HALF_FLOAT=l.HALF_FLOAT;const B=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(p=l.RGBA16F)!==null&&p!==void 0?p:B==null?void 0:B.RGBA16F_EXT,this.RGB16F=(x=l.RGB16F)!==null&&x!==void 0?x:B==null?void 0:B.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const B=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=B==null?void 0:B.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,p){return new da(this,l,p)}createVertexBuffer(l,p,x){return new En(this,l,p,x)}createRenderbuffer(l,p,x){const B=this.gl,L=B.createRenderbuffer();return this.bindRenderbuffer.set(L),B.renderbufferStorage(B.RENDERBUFFER,l,p,x),this.bindRenderbuffer.set(null),L}createFramebuffer(l,p,x,B){return new ei(this,l,p,x,B)}clear(l){let{color:p,depth:x,stencil:B}=l;const L=this.gl;let j=0;p&&(j|=L.COLOR_BUFFER_BIT,this.clearColor.set(p),this.colorMask.set([!0,!0,!0,!0])),x!==void 0&&(j|=L.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(x),this.depthMask.set(!0)),B!==void 0&&(j|=L.STENCIL_BUFFER_BIT,this.clearStencil.set(B),this.stencilMask.set(255)),L.clear(j)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){s.aD(l.blendFunction,ui.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return fa(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var p;return fa(this.gl)?this.gl.deleteVertexArray(l):(p=this.gl.getExtension("OES_vertex_array_object"))===null||p===void 0?void 0:p.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}class ai{constructor(l,p,x){this.func=l,this.mask=p,this.range=x}}ai.ReadOnly=!1,ai.ReadWrite=!0,ai.disabled=new ai(519,ai.ReadOnly,[0,1]);const Pn=7680;class Di{constructor(l,p,x,B,L,j){this.test=l,this.ref=p,this.mask=x,this.fail=B,this.depthFail=L,this.pass=j}}Di.disabled=new Di({func:519,mask:0},0,0,Pn,Pn,Pn);class Li{constructor(l,p,x){this.enable=l,this.mode=p,this.frontFace=x}}let Ds;function eo(w,l,p,x,B,L,j){const _=w.context,E=_.gl,F=w.useProgram("collisionBox"),V=[];let q=0,K=0;for(let ve=0;ve<x.length;ve++){const Se=x[ve],et=l.getTile(Se),Oe=et.getBucket(p);if(!Oe)continue;let Re=Se.posMatrix;B[0]===0&&B[1]===0||(Re=w.translatePosMatrix(Se.posMatrix,et,B,L));const Ve=j?Oe.textCollisionBox:Oe.iconCollisionBox,At=Oe.collisionCircleArray;if(At.length>0){const dt=s.F(),ft=Re;s.aP(dt,Oe.placementInvProjMatrix,w.transform.glCoordMatrix),s.aP(dt,dt,Oe.placementViewportMatrix),V.push({circleArray:At,circleOffset:K,transform:ft,invTransform:dt,coord:Se}),q+=At.length/4,K=q}Ve&&F.draw(_,E.LINES,ai.disabled,Di.disabled,w.colorModeForRenderPass(),Li.disabled,qn(Re,w.transform,et),w.style.map.terrain&&w.style.map.terrain.getTerrainData(Se),p.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,null,w.transform.zoom,null,null,Ve.collisionVertexBuffer)}if(!j||!V.length)return;const te=w.useProgram("collisionCircle"),se=new s.aQ;se.resize(4*q),se._trim();let oe=0;for(const ve of V)for(let Se=0;Se<ve.circleArray.length/4;Se++){const et=4*Se,Oe=ve.circleArray[et+0],Re=ve.circleArray[et+1],Ve=ve.circleArray[et+2],At=ve.circleArray[et+3];se.emplace(oe++,Oe,Re,Ve,At,0),se.emplace(oe++,Oe,Re,Ve,At,1),se.emplace(oe++,Oe,Re,Ve,At,2),se.emplace(oe++,Oe,Re,Ve,At,3)}(!Ds||Ds.length<2*q)&&(Ds=function(ve){const Se=2*ve,et=new s.aS;et.resize(Se),et._trim();for(let Oe=0;Oe<Se;Oe++){const Re=6*Oe;et.uint16[Re+0]=4*Oe+0,et.uint16[Re+1]=4*Oe+1,et.uint16[Re+2]=4*Oe+2,et.uint16[Re+3]=4*Oe+2,et.uint16[Re+4]=4*Oe+3,et.uint16[Re+5]=4*Oe+0}return et}(q));const le=_.createIndexBuffer(Ds,!0),_e=_.createVertexBuffer(se,s.aR.members,!0);for(const ve of V){const Se={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(Ie=w.transform).cameraToCenterDistance,u_viewport_size:[Ie.width,Ie.height]};te.draw(_,E.TRIANGLES,ai.disabled,Di.disabled,w.colorModeForRenderPass(),Li.disabled,Se,w.style.map.terrain&&w.style.map.terrain.getTerrainData(ve.coord),p.id,_e,le,s.$.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,w.transform.zoom,null,null,null)}var Ie;_e.destroy(),le.destroy()}Li.disabled=new Li(!1,1029,2305),Li.backCCW=new Li(!0,1029,2305);const Po=s.an(new Float32Array(16));function Ma(w,l,p,x,B,L){const{horizontalAlign:j,verticalAlign:_}=s.at(w);return new s.P((-(j-.5)*l/B+x[0])*L,(-(_-.5)*p/B+x[1])*L)}function ma(w,l,p,x,B,L,j,_,E,F,V){const q=w.text.placedSymbolArray,K=w.text.dynamicLayoutVertexArray,te=w.icon.dynamicLayoutVertexArray,se={};K.clear();for(let oe=0;oe<q.length;oe++){const le=q.get(oe),_e=le.hidden||!le.crossTileID||w.allowVerticalPlacement&&!le.placedOrientation?null:x[le.crossTileID];if(_e){const Ie=new s.P(le.anchorX,le.anchorY),ve=Qe(Ie,p?j:L,V),Se=Be(B.cameraToCenterDistance,ve.signedDistanceFromCamera);let et=s.ai(w.textSizeData,E,le)*Se/s.ao;p&&(et*=w.tilePixelRatio/_);const{width:Oe,height:Re,anchor:Ve,textOffset:At,textBoxScale:dt}=_e,ft=Ma(Ve,Oe,Re,At,dt,et),Nt=p?Qe(Ie.add(ft),L,V).point:ve.point.add(l?ft.rotate(-B.angle):ft),It=w.allowVerticalPlacement&&le.placedOrientation===s.ah.vertical?Math.PI/2:0;for(let jt=0;jt<le.numGlyphs;jt++)s.aj(K,Nt,It);F&&le.associatedIconIndex>=0&&(se[le.associatedIconIndex]={shiftedAnchor:Nt,angle:It})}else vt(le.numGlyphs,K)}if(F){te.clear();const oe=w.icon.placedSymbolArray;for(let le=0;le<oe.length;le++){const _e=oe.get(le);if(_e.hidden)vt(_e.numGlyphs,te);else{const Ie=se[le];if(Ie)for(let ve=0;ve<_e.numGlyphs;ve++)s.aj(te,Ie.shiftedAnchor,Ie.angle);else vt(_e.numGlyphs,te)}}w.icon.dynamicLayoutVertexBuffer.updateData(te)}w.text.dynamicLayoutVertexBuffer.updateData(K)}function wc(w,l,p){return p.iconsInText&&l?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function pl(w,l,p,x,B,L,j,_,E,F,V,q){const K=w.context,te=K.gl,se=w.transform,oe=_==="map",le=E==="map",_e=_!=="viewport"&&p.layout.get("symbol-placement")!=="point",Ie=oe&&!le&&!_e,ve=!p.layout.get("symbol-sort-key").isConstant();let Se=!1;const et=w.depthModeForSublayer(0,ai.ReadOnly),Oe=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Re=[];for(const Ve of x){const At=l.getTile(Ve),dt=At.getBucket(p);if(!dt)continue;const ft=B?dt.text:dt.icon;if(!ft||!ft.segments.get().length||!ft.hasVisibleVertices)continue;const Nt=ft.programConfigurations.get(p.id),It=B||dt.sdfIcons,jt=B?dt.textSizeData:dt.iconSizeData,Ht=le||se.pitch!==0,Pr=w.useProgram(wc(It,B,dt),Nt),yr=s.ag(jt,se.zoom),Ir=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ve);let hr,li,ti,ii,Ri=[0,0],ki=null;if(B)li=At.glyphAtlasTexture,ti=te.LINEAR,hr=At.glyphAtlasTexture.size,dt.iconsInText&&(Ri=At.imageAtlasTexture.size,ki=At.imageAtlasTexture,ii=Ht||w.options.rotating||w.options.zooming||jt.kind==="composite"||jt.kind==="camera"?te.LINEAR:te.NEAREST);else{const an=p.layout.get("icon-size").constantOr(0)!==1||dt.iconsNeedLinear;li=At.imageAtlasTexture,ti=It||w.options.rotating||w.options.zooming||an||Ht?te.LINEAR:te.NEAREST,hr=At.imageAtlasTexture.size}const wi=Gt(At,1,w.transform.zoom),Ki=vi(Ve.posMatrix,le,oe,w.transform,wi),xi=Zi(Ve.posMatrix,le,oe,w.transform,wi),Zn=Oe&&dt.hasTextData(),Wi=p.layout.get("icon-text-fit")!=="none"&&Zn&&dt.hasIconData();if(_e){const an=w.style.map.terrain?(Es,yi)=>w.style.map.terrain.getElevation(Ve,Es,yi):null,is=p.layout.get("text-rotation-alignment")==="map";re(dt,Ve.posMatrix,w,B,Ki,xi,le,F,is,an)}const Oi=w.translatePosMatrix(Ve.posMatrix,At,L,j),Xi=_e||B&&Oe||Wi?Po:Ki,hi=w.translatePosMatrix(xi,At,L,j,!0),zi=It&&p.paint.get(B?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let on;on=It?dt.iconsInText?Vc(jt.kind,yr,Ie,le,w,Oi,Xi,hi,hr,Ri):Aa(jt.kind,yr,Ie,le,w,Oi,Xi,hi,B,hr,!0):el(jt.kind,yr,Ie,le,w,Oi,Xi,hi,B,hr);const rs={program:Pr,buffers:ft,uniformValues:on,atlasTexture:li,atlasTextureIcon:ki,atlasInterpolation:ti,atlasInterpolationIcon:ii,isSDF:It,hasHalo:zi};if(ve&&dt.canOverlap){Se=!0;const an=ft.segments.get();for(const is of an)Re.push({segments:new s.$([is]),sortKey:is.sortKey,state:rs,terrainData:Ir})}else Re.push({segments:ft.segments,sortKey:0,state:rs,terrainData:Ir})}Se&&Re.sort((Ve,At)=>Ve.sortKey-At.sortKey);for(const Ve of Re){const At=Ve.state;if(K.activeTexture.set(te.TEXTURE0),At.atlasTexture.bind(At.atlasInterpolation,te.CLAMP_TO_EDGE),At.atlasTextureIcon&&(K.activeTexture.set(te.TEXTURE1),At.atlasTextureIcon&&At.atlasTextureIcon.bind(At.atlasInterpolationIcon,te.CLAMP_TO_EDGE)),At.isSDF){const dt=At.uniformValues;At.hasHalo&&(dt.u_is_halo=1,Xl(At.buffers,Ve.segments,p,w,At.program,et,V,q,dt,Ve.terrainData)),dt.u_is_halo=0}Xl(At.buffers,Ve.segments,p,w,At.program,et,V,q,At.uniformValues,Ve.terrainData)}}function Xl(w,l,p,x,B,L,j,_,E,F){const V=x.context;B.draw(V,V.gl.TRIANGLES,L,j,_,Li.disabled,E,F,p.id,w.layoutVertexBuffer,w.indexBuffer,l,p.paint,x.transform.zoom,w.programConfigurations.get(p.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function Bc(w,l,p,x,B){if(!p||!x||!x.imageAtlas)return;const L=x.imageAtlas.patternPositions;let j=L[p.to.toString()],_=L[p.from.toString()];if(!j&&_&&(j=_),!_&&j&&(_=j),!j||!_){const E=B.getPaintProperty(l);j=L[E],_=L[E]}j&&_&&w.setConstantPatternPositions(j,_)}function Pa(w,l,p,x,B,L,j){const _=w.context.gl,E="fill-pattern",F=p.paint.get(E),V=F&&F.constantOr(1),q=p.getCrossfadeParameters();let K,te,se,oe,le;j?(te=V&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",K=_.LINES):(te=V?"fillPattern":"fill",K=_.TRIANGLES);const _e=F.constantOr(null);for(const Ie of x){const ve=l.getTile(Ie);if(V&&!ve.patternsLoaded())continue;const Se=ve.getBucket(p);if(!Se)continue;const et=Se.programConfigurations.get(p.id),Oe=w.useProgram(te,et),Re=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ie);V&&(w.context.activeTexture.set(_.TEXTURE0),ve.imageAtlasTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),et.updatePaintBuffers(q)),Bc(et,E,_e,ve,p);const Ve=Re?Ie:null,At=w.translatePosMatrix(Ve?Ve.posMatrix:Ie.posMatrix,ve,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(j){oe=Se.indexBuffer2,le=Se.segments2;const dt=[_.drawingBufferWidth,_.drawingBufferHeight];se=te==="fillOutlinePattern"&&V?Ci(At,w,q,ve,dt):qr(At,dt)}else oe=Se.indexBuffer,le=Se.segments,se=V?fr(At,w,q,ve):Ot(At);Oe.draw(w.context,K,B,w.stencilModeForClipping(Ie),L,Li.disabled,se,Re,p.id,Se.layoutVertexBuffer,oe,le,p.paint,w.transform.zoom,et)}}function _s(w,l,p,x,B,L,j){const _=w.context,E=_.gl,F="fill-extrusion-pattern",V=p.paint.get(F),q=V.constantOr(1),K=p.getCrossfadeParameters(),te=p.paint.get("fill-extrusion-opacity"),se=V.constantOr(null);for(const oe of x){const le=l.getTile(oe),_e=le.getBucket(p);if(!_e)continue;const Ie=w.style.map.terrain&&w.style.map.terrain.getTerrainData(oe),ve=_e.programConfigurations.get(p.id),Se=w.useProgram(q?"fillExtrusionPattern":"fillExtrusion",ve);q&&(w.context.activeTexture.set(E.TEXTURE0),le.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ve.updatePaintBuffers(K)),Bc(ve,F,se,le,p);const et=w.translatePosMatrix(oe.posMatrix,le,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),Oe=p.paint.get("fill-extrusion-vertical-gradient"),Re=q?gt(et,w,Oe,te,oe,K,le):Je(et,w,Oe,te);Se.draw(_,_.gl.TRIANGLES,B,L,j,Li.backCCW,Re,Ie,p.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,p.paint,w.transform.zoom,ve,w.style.map.terrain&&_e.centroidVertexBuffer)}}function gl(w,l,p,x,B,L,j){const _=w.context,E=_.gl,F=p.fbo;if(!F)return;const V=w.useProgram("hillshade"),q=w.style.map.terrain&&w.style.map.terrain.getTerrainData(l);_.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,F.colorAttachment.get()),V.draw(_,E.TRIANGLES,B,L,j,Li.disabled,((K,te,se,oe)=>{const le=se.paint.get("hillshade-shadow-color"),_e=se.paint.get("hillshade-highlight-color"),Ie=se.paint.get("hillshade-accent-color");let ve=se.paint.get("hillshade-illumination-direction")*(Math.PI/180);se.paint.get("hillshade-illumination-anchor")==="viewport"&&(ve-=K.transform.angle);const Se=!K.options.moving;return{u_matrix:oe?oe.posMatrix:K.transform.calculatePosMatrix(te.tileID.toUnwrapped(),Se),u_image:0,u_latrange:Hl(0,te.tileID),u_light:[se.paint.get("hillshade-exaggeration"),ve],u_shadow:le,u_highlight:_e,u_accent:Ie}})(w,p,x,q?l:null),q,x.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}function Zl(w,l,p,x,B,L){const j=w.context,_=j.gl,E=l.dem;if(E&&E.data){const F=E.dim,V=E.stride,q=E.getPixels();if(j.activeTexture.set(_.TEXTURE1),j.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||w.getTileTexture(V),l.demTexture){const te=l.demTexture;te.update(q,{premultiply:!1}),te.bind(_.NEAREST,_.CLAMP_TO_EDGE)}else l.demTexture=new De(j,q,_.RGBA,{premultiply:!1}),l.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);j.activeTexture.set(_.TEXTURE0);let K=l.fbo;if(!K){const te=new De(j,{width:F,height:F,data:null},_.RGBA);te.bind(_.LINEAR,_.CLAMP_TO_EDGE),K=l.fbo=j.createFramebuffer(F,F,!0,!1),K.colorAttachment.set(te.texture)}j.bindFramebuffer.set(K.framebuffer),j.viewport.set([0,0,F,F]),w.useProgram("hillshadePrepare").draw(j,_.TRIANGLES,x,B,L,Li.disabled,((te,se)=>{const oe=se.stride,le=s.F();return s.aN(le,0,s.W,-s.W,0,0,1),s.H(le,le,[0,-s.W,0]),{u_matrix:le,u_image:1,u_dimension:[oe,oe],u_zoom:te.overscaledZ,u_unpack:se.getUnpackVector()}})(l.tileID,E),null,p.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function Fa(w,l,p,x,B,L){const j=x.paint.get("raster-fade-duration");if(!L&&j>0){const _=I.now(),E=(_-w.timeAdded)/j,F=l?(_-l.timeAdded)/j:-1,V=p.getSource(),q=B.coveringZoomLevel({tileSize:V.tileSize,roundZoom:V.roundZoom}),K=!l||Math.abs(l.tileID.overscaledZ-q)>Math.abs(w.tileID.overscaledZ-q),te=K&&w.refreshedUponExpiration?1:s.ac(K?E:1-F,0,1);return w.refreshedUponExpiration&&E>=1&&(w.refreshedUponExpiration=!1),l?{opacity:1,mix:1-te}:{opacity:te,mix:0}}return{opacity:1,mix:0}}const Da=new s.aO(1,0,0,1),Rs=new s.aO(0,1,0,1),Hu=new s.aO(0,0,1,1),Ln=new s.aO(1,0,1,1),fn=new s.aO(0,1,1,1);function pn(w,l,p,x){ya(w,0,l+p/2,w.transform.width,p,x)}function fs(w,l,p,x){ya(w,l-p/2,0,p,w.transform.height,x)}function ya(w,l,p,x,B,L){const j=w.context,_=j.gl;_.enable(_.SCISSOR_TEST),_.scissor(l*w.pixelRatio,p*w.pixelRatio,x*w.pixelRatio,B*w.pixelRatio),j.clear({color:L}),_.disable(_.SCISSOR_TEST)}function Jl(w,l,p){const x=w.context,B=x.gl,L=p.posMatrix,j=w.useProgram("debug"),_=ai.disabled,E=Di.disabled,F=w.colorModeForRenderPass(),V="$debug",q=w.style.map.terrain&&w.style.map.terrain.getTerrainData(p);x.activeTexture.set(B.TEXTURE0);const K=l.getTileByID(p.key).latestRawTileData,te=Math.floor((K&&K.byteLength||0)/1024),se=l.getTile(p).tileSize,oe=512/Math.min(se,512)*(p.overscaledZ/w.transform.zoom)*.5;let le=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(le+=` => ${p.overscaledZ}`),function(_e,Ie){_e.initDebugOverlayCanvas();const ve=_e.debugOverlayCanvas,Se=_e.context.gl,et=_e.debugOverlayCanvas.getContext("2d");et.clearRect(0,0,ve.width,ve.height),et.shadowColor="white",et.shadowBlur=2,et.lineWidth=1.5,et.strokeStyle="white",et.textBaseline="top",et.font="bold 36px Open Sans, sans-serif",et.fillText(Ie,5,5),et.strokeText(Ie,5,5),_e.debugOverlayTexture.update(ve),_e.debugOverlayTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE)}(w,`${le} ${te}kB`),j.draw(x,B.TRIANGLES,_,E,ui.alphaBlended,Li.disabled,os(L,s.aO.transparent,oe),null,V,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),j.draw(x,B.LINE_STRIP,_,E,F,Li.disabled,os(L,s.aO.red),q,V,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function ho(w,l,p){const x=w.context,B=x.gl,L=w.colorModeForRenderPass(),j=new ai(B.LEQUAL,ai.ReadWrite,w.depthRangeFor3D),_=w.useProgram("terrain"),E=l.getTerrainMesh();x.bindFramebuffer.set(null),x.viewport.set([0,0,w.width,w.height]);for(const F of p){const V=w.renderToTexture.getTexture(F),q=l.getTerrainData(F.tileID);x.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,V.texture);const K={u_matrix:w.transform.calculatePosMatrix(F.tileID.toUnwrapped()),u_texture:0,u_ele_delta:l.getMeshFrameDelta(w.transform.zoom)};_.draw(x,B.TRIANGLES,j,Di.disabled,L,Li.backCCW,K,q,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}}class vs{constructor(l,p){this.context=new $n(l),this.transform=p,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Qt.maxUnderzooming+Qt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new bi}resize(l,p,x){if(this.width=Math.floor(l*x),this.height=Math.floor(p*x),this.pixelRatio=x,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const B of this.style._order)this.style._layers[B].resize()}setup(){const l=this.context,p=new s.aV;p.emplaceBack(0,0),p.emplaceBack(s.W,0),p.emplaceBack(0,s.W),p.emplaceBack(s.W,s.W),this.tileExtentBuffer=l.createVertexBuffer(p,Tn.members),this.tileExtentSegments=s.$.simpleSegment(0,0,4,2);const x=new s.aV;x.emplaceBack(0,0),x.emplaceBack(s.W,0),x.emplaceBack(0,s.W),x.emplaceBack(s.W,s.W),this.debugBuffer=l.createVertexBuffer(x,Tn.members),this.debugSegments=s.$.simpleSegment(0,0,4,5);const B=new s.Z;B.emplaceBack(0,0,0,0),B.emplaceBack(s.W,0,s.W,0),B.emplaceBack(0,s.W,0,s.W),B.emplaceBack(s.W,s.W,s.W,s.W),this.rasterBoundsBuffer=l.createVertexBuffer(B,$t.members),this.rasterBoundsSegments=s.$.simpleSegment(0,0,4,2);const L=new s.aV;L.emplaceBack(0,0),L.emplaceBack(1,0),L.emplaceBack(0,1),L.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(L,Tn.members),this.viewportSegments=s.$.simpleSegment(0,0,4,2);const j=new s.aW;j.emplaceBack(0),j.emplaceBack(1),j.emplaceBack(3),j.emplaceBack(2),j.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(j);const _=new s.aX;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(_);const E=this.context.gl;this.stencilClearMode=new Di({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){const l=this.context,p=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const x=s.F();s.aN(x,0,this.width,this.height,0,0,1),s.J(x,x,[p.drawingBufferWidth,p.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,p.TRIANGLES,ai.disabled,this.stencilClearMode,ui.disabled,Li.disabled,_n(x),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,p){if(this.currentStencilSource===l.source||!l.isTileClipped()||!p||!p.length)return;this.currentStencilSource=l.source;const x=this.context,B=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(ui.disabled),x.setDepthMode(ai.disabled);const L=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const j of p){const _=this._tileClippingMaskIDs[j.key]=this.nextStencilID++,E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(j);L.draw(x,B.TRIANGLES,ai.disabled,new Di({func:B.ALWAYS,mask:0},_,255,B.KEEP,B.KEEP,B.REPLACE),ui.disabled,Li.disabled,_n(j.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,p=this.context.gl;return new Di({func:p.NOTEQUAL,mask:255},l,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(l){const p=this.context.gl;return new Di({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(l){const p=this.context.gl,x=l.sort((j,_)=>_.overscaledZ-j.overscaledZ),B=x[x.length-1].overscaledZ,L=x[0].overscaledZ-B+1;if(L>1){this.currentStencilSource=void 0,this.nextStencilID+L>256&&this.clearStencil();const j={};for(let _=0;_<L;_++)j[_+B]=new Di({func:p.GEQUAL,mask:255},_+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=L,[j,x]}return[{[B]:Di.disabled},x]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new ui([l.CONSTANT_COLOR,l.ONE],new s.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ui.unblended:ui.alphaBlended}depthModeForSublayer(l,p,x){if(!this.opaquePassEnabledForLayer())return ai.disabled;const B=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ai(x||this.context.gl.LEQUAL,p,[B,B])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,p){this.style=l,this.options=p,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(I.now()),this.imageManager.beginFrame();const x=this.style._order,B=this.style.sourceCaches,L={},j={},_={};for(const E in B){const F=B[E];F.used&&F.prepare(this.context),L[E]=F.getVisibleCoordinates(),j[E]=L[E].slice().reverse(),_[E]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<x.length;E++)if(this.style._layers[x[E]].is3D()){this.opaquePassCutoff=E;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const E of x){const F=this.style._layers[E];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const V=j[F.source];(F.type==="custom"||V.length)&&this.renderLayer(this,B[F.source],F,V)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:p.showOverdrawInspector?s.aO.black:s.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[x[this.currentLayer]],F=B[E.source],V=L[E.source];this._renderTileClippingMasks(E,V),this.renderLayer(this,F,E,V)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const E=this.style._layers[x[this.currentLayer]],F=B[E.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(E))continue;const V=(E.type==="symbol"?_:j)[E.source];this._renderTileClippingMasks(E,L[E.source]),this.renderLayer(this,F,E,V)}if(this.options.showTileBoundaries){const E=function(F,V){let q=null;const K=Object.values(F._layers).flatMap(le=>le.source&&!le.isHidden(V)?[F.sourceCaches[le.source]]:[]),te=K.filter(le=>le.getSource().type==="vector"),se=K.filter(le=>le.getSource().type!=="vector"),oe=le=>{(!q||q.getSource().maxzoom<le.getSource().maxzoom)&&(q=le)};return te.forEach(le=>oe(le)),q||se.forEach(le=>oe(le)),q}(this.style,this.transform.zoom);E&&function(F,V,q){for(let K=0;K<q.length;K++)Jl(F,V,q[K])}(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const F=E.transform.padding;pn(E,E.transform.height-(F.top||0),3,Da),pn(E,F.bottom||0,3,Rs),fs(E,F.left||0,3,Hu),fs(E,E.transform.width-(F.right||0),3,Ln);const V=E.transform.centerPoint;(function(q,K,te,se){ya(q,K-1,te-10,2,20,se),ya(q,K-10,te-1,20,2,se)})(E,V.x,E.transform.height-V.y,fn)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const p=this.terrainFacilitator.matrix,x=this.transform.projMatrix;let B=this.terrainFacilitator.dirty;B||(B=l?!s.aY(p,x):!s.aZ(p,x)),B||(B=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),B&&(s.a_(p,x),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(L,j){const _=L.context,E=_.gl,F=ui.unblended,V=new ai(E.LEQUAL,ai.ReadWrite,[0,1]),q=j.getTerrainMesh(),K=j.sourceCache.getRenderableTiles(),te=L.useProgram("terrainDepth");_.bindFramebuffer.set(j.getFramebuffer("depth").framebuffer),_.viewport.set([0,0,L.width/devicePixelRatio,L.height/devicePixelRatio]),_.clear({color:s.aO.transparent,depth:1});for(const se of K){const oe=j.getTerrainData(se.tileID),le={u_matrix:L.transform.calculatePosMatrix(se.tileID.toUnwrapped()),u_ele_delta:j.getMeshFrameDelta(L.transform.zoom)};te.draw(_,E.TRIANGLES,V,Di.disabled,F,Li.backCCW,le,oe,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}_.bindFramebuffer.set(null),_.viewport.set([0,0,L.width,L.height])}(this,this.style.map.terrain),function(L,j){const _=L.context,E=_.gl,F=ui.unblended,V=new ai(E.LEQUAL,ai.ReadWrite,[0,1]),q=j.getTerrainMesh(),K=j.getCoordsTexture(),te=j.sourceCache.getRenderableTiles(),se=L.useProgram("terrainCoords");_.bindFramebuffer.set(j.getFramebuffer("coords").framebuffer),_.viewport.set([0,0,L.width/devicePixelRatio,L.height/devicePixelRatio]),_.clear({color:s.aO.transparent,depth:1}),j.coordsIndex=[];for(const oe of te){const le=j.getTerrainData(oe.tileID);_.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,K.texture);const _e={u_matrix:L.transform.calculatePosMatrix(oe.tileID.toUnwrapped()),u_terrain_coords_id:(255-j.coordsIndex.length)/255,u_texture:0,u_ele_delta:j.getMeshFrameDelta(L.transform.zoom)};se.draw(_,E.TRIANGLES,V,Di.disabled,F,Li.backCCW,_e,le,"terrain",q.vertexBuffer,q.indexBuffer,q.segments),j.coordsIndex.push(oe.tileID.key)}_.bindFramebuffer.set(null),_.viewport.set([0,0,L.width,L.height])}(this,this.style.map.terrain))}renderLayer(l,p,x,B){if(!x.isHidden(this.transform.zoom)&&(x.type==="background"||x.type==="custom"||(B||[]).length))switch(this.id=x.id,x.type){case"symbol":(function(L,j,_,E,F){if(L.renderPass!=="translucent")return;const V=Di.disabled,q=L.colorModeForRenderPass();(_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(K,te,se,oe,le,_e,Ie){const ve=te.transform,Se=le==="map",et=_e==="map";for(const Oe of K){const Re=oe.getTile(Oe),Ve=Re.getBucket(se);if(!Ve||!Ve.text||!Ve.text.segments.get().length)continue;const At=s.ag(Ve.textSizeData,ve.zoom),dt=Gt(Re,1,te.transform.zoom),ft=vi(Oe.posMatrix,et,Se,te.transform,dt),Nt=se.layout.get("icon-text-fit")!=="none"&&Ve.hasIconData();if(At){const It=Math.pow(2,ve.zoom-Re.tileID.overscaledZ);ma(Ve,Se,et,Ie,ve,ft,Oe.posMatrix,It,At,Nt,te.style.map.terrain?(jt,Ht)=>te.style.map.terrain.getElevation(Oe,jt,Ht):null)}}}(E,L,_,j,_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),F),_.paint.get("icon-opacity").constantOr(1)!==0&&pl(L,j,_,E,!1,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),_.layout.get("icon-rotation-alignment"),_.layout.get("icon-pitch-alignment"),_.layout.get("icon-keep-upright"),V,q),_.paint.get("text-opacity").constantOr(1)!==0&&pl(L,j,_,E,!0,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.layout.get("text-keep-upright"),V,q),j.map.showCollisionBoxes&&(eo(L,j,_,E,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),!0),eo(L,j,_,E,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),!1))})(l,p,x,B,this.style.placement.variableOffsets);break;case"circle":(function(L,j,_,E){if(L.renderPass!=="translucent")return;const F=_.paint.get("circle-opacity"),V=_.paint.get("circle-stroke-width"),q=_.paint.get("circle-stroke-opacity"),K=!_.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&(V.constantOr(1)===0||q.constantOr(1)===0))return;const te=L.context,se=te.gl,oe=L.depthModeForSublayer(0,ai.ReadOnly),le=Di.disabled,_e=L.colorModeForRenderPass(),Ie=[];for(let ve=0;ve<E.length;ve++){const Se=E[ve],et=j.getTile(Se),Oe=et.getBucket(_);if(!Oe)continue;const Re=Oe.programConfigurations.get(_.id),Ve=L.useProgram("circle",Re),At=Oe.layoutVertexBuffer,dt=Oe.indexBuffer,ft=L.style.map.terrain&&L.style.map.terrain.getTerrainData(Se),Nt={programConfiguration:Re,program:Ve,layoutVertexBuffer:At,indexBuffer:dt,uniformValues:In(L,Se,et,_),terrainData:ft};if(K){const It=Oe.segments.get();for(const jt of It)Ie.push({segments:new s.$([jt]),sortKey:jt.sortKey,state:Nt})}else Ie.push({segments:Oe.segments,sortKey:0,state:Nt})}K&&Ie.sort((ve,Se)=>ve.sortKey-Se.sortKey);for(const ve of Ie){const{programConfiguration:Se,program:et,layoutVertexBuffer:Oe,indexBuffer:Re,uniformValues:Ve,terrainData:At}=ve.state;et.draw(te,se.TRIANGLES,oe,le,_e,Li.disabled,Ve,At,_.id,Oe,Re,ve.segments,_.paint,L.transform.zoom,Se)}})(l,p,x,B);break;case"heatmap":(function(L,j,_,E){if(_.paint.get("heatmap-opacity")!==0)if(L.renderPass==="offscreen"){const F=L.context,V=F.gl,q=Di.disabled,K=new ui([V.ONE,V.ONE],s.aO.transparent,[!0,!0,!0,!0]);(function(te,se,oe){const le=te.gl;te.activeTexture.set(le.TEXTURE1),te.viewport.set([0,0,se.width/4,se.height/4]);let _e=oe.heatmapFbo;if(_e)le.bindTexture(le.TEXTURE_2D,_e.colorAttachment.get()),te.bindFramebuffer.set(_e.framebuffer);else{const Ie=le.createTexture();le.bindTexture(le.TEXTURE_2D,Ie),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MAG_FILTER,le.LINEAR),_e=oe.heatmapFbo=te.createFramebuffer(se.width/4,se.height/4,!1,!1),function(ve,Se,et,Oe){var Re,Ve;const At=ve.gl,dt=(Re=ve.HALF_FLOAT)!==null&&Re!==void 0?Re:At.UNSIGNED_BYTE,ft=(Ve=ve.RGBA16F)!==null&&Ve!==void 0?Ve:At.RGBA;At.texImage2D(At.TEXTURE_2D,0,ft,Se.width/4,Se.height/4,0,At.RGBA,dt,null),Oe.colorAttachment.set(et)}(te,se,Ie,_e)}})(F,L,_),F.clear({color:s.aO.transparent});for(let te=0;te<E.length;te++){const se=E[te];if(j.hasRenderableParent(se))continue;const oe=j.getTile(se),le=oe.getBucket(_);if(!le)continue;const _e=le.programConfigurations.get(_.id),Ie=L.useProgram("heatmap",_e),{zoom:ve}=L.transform;Ie.draw(F,V.TRIANGLES,ai.disabled,q,K,Li.disabled,fu(se.posMatrix,oe,ve,_.paint.get("heatmap-intensity")),null,_.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,_.paint,L.transform.zoom,_e)}F.viewport.set([0,0,L.width,L.height])}else L.renderPass==="translucent"&&(L.context.setColorMode(L.colorModeForRenderPass()),function(F,V){const q=F.context,K=q.gl,te=V.heatmapFbo;if(!te)return;q.activeTexture.set(K.TEXTURE0),K.bindTexture(K.TEXTURE_2D,te.colorAttachment.get()),q.activeTexture.set(K.TEXTURE1);let se=V.colorRampTexture;se||(se=V.colorRampTexture=new De(q,V.colorRamp,K.RGBA)),se.bind(K.LINEAR,K.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(q,K.TRIANGLES,ai.disabled,Di.disabled,F.colorModeForRenderPass(),Li.disabled,((oe,le,_e,Ie)=>{const ve=s.F();s.aN(ve,0,oe.width,oe.height,0,0,1);const Se=oe.context.gl;return{u_matrix:ve,u_world:[Se.drawingBufferWidth,Se.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:le.paint.get("heatmap-opacity")}})(F,V),null,V.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,V.paint,F.transform.zoom)}(L,_))})(l,p,x,B);break;case"line":(function(L,j,_,E){if(L.renderPass!=="translucent")return;const F=_.paint.get("line-opacity"),V=_.paint.get("line-width");if(F.constantOr(1)===0||V.constantOr(1)===0)return;const q=L.depthModeForSublayer(0,ai.ReadOnly),K=L.colorModeForRenderPass(),te=_.paint.get("line-dasharray"),se=_.paint.get("line-pattern"),oe=se.constantOr(1),le=_.paint.get("line-gradient"),_e=_.getCrossfadeParameters(),Ie=oe?"linePattern":te?"lineSDF":le?"lineGradient":"line",ve=L.context,Se=ve.gl;let et=!0;for(const Oe of E){const Re=j.getTile(Oe);if(oe&&!Re.patternsLoaded())continue;const Ve=Re.getBucket(_);if(!Ve)continue;const At=Ve.programConfigurations.get(_.id),dt=L.context.program.get(),ft=L.useProgram(Ie,At),Nt=et||ft.program!==dt,It=L.style.map.terrain&&L.style.map.terrain.getTerrainData(Oe),jt=se.constantOr(null);if(jt&&Re.imageAtlas){const yr=Re.imageAtlas,Ir=yr.patternPositions[jt.to.toString()],hr=yr.patternPositions[jt.from.toString()];Ir&&hr&&At.setConstantPatternPositions(Ir,hr)}const Ht=It?Oe:null,Pr=oe?Gl(L,Re,_,_e,Ht):te?as(L,Re,_,te,_e,Ht):le?Ya(L,Re,_,Ve.lineClipsArray.length,Ht):Ei(L,Re,_,Ht);if(oe)ve.activeTexture.set(Se.TEXTURE0),Re.imageAtlasTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),At.updatePaintBuffers(_e);else if(te&&(Nt||L.lineAtlas.dirty))ve.activeTexture.set(Se.TEXTURE0),L.lineAtlas.bind(ve);else if(le){const yr=Ve.gradients[_.id];let Ir=yr.texture;if(_.gradientVersion!==yr.version){let hr=256;if(_.stepInterpolant){const li=j.getSource().maxzoom,ti=Oe.canonical.z===li?Math.ceil(1<<L.transform.maxZoom-Oe.canonical.z):1;hr=s.ac(s.aT(Ve.maxLineLength/s.W*1024*ti),256,ve.maxTextureSize)}yr.gradient=s.aU({expression:_.gradientExpression(),evaluationKey:"lineProgress",resolution:hr,image:yr.gradient||void 0,clips:Ve.lineClipsArray}),yr.texture?yr.texture.update(yr.gradient):yr.texture=new De(ve,yr.gradient,Se.RGBA),yr.version=_.gradientVersion,Ir=yr.texture}ve.activeTexture.set(Se.TEXTURE0),Ir.bind(_.stepInterpolant?Se.NEAREST:Se.LINEAR,Se.CLAMP_TO_EDGE)}ft.draw(ve,Se.TRIANGLES,q,L.stencilModeForClipping(Oe),K,Li.disabled,Pr,It,_.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,_.paint,L.transform.zoom,At,Ve.layoutVertexBuffer2),et=!1}})(l,p,x,B);break;case"fill":(function(L,j,_,E){const F=_.paint.get("fill-color"),V=_.paint.get("fill-opacity");if(V.constantOr(1)===0)return;const q=L.colorModeForRenderPass(),K=_.paint.get("fill-pattern"),te=L.opaquePassEnabledForLayer()&&!K.constantOr(1)&&F.constantOr(s.aO.transparent).a===1&&V.constantOr(0)===1?"opaque":"translucent";if(L.renderPass===te){const se=L.depthModeForSublayer(1,L.renderPass==="opaque"?ai.ReadWrite:ai.ReadOnly);Pa(L,j,_,E,se,q,!1)}if(L.renderPass==="translucent"&&_.paint.get("fill-antialias")){const se=L.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,ai.ReadOnly);Pa(L,j,_,E,se,q,!0)}})(l,p,x,B);break;case"fill-extrusion":(function(L,j,_,E){const F=_.paint.get("fill-extrusion-opacity");if(F!==0&&L.renderPass==="translucent"){const V=new ai(L.context.gl.LEQUAL,ai.ReadWrite,L.depthRangeFor3D);if(F!==1||_.paint.get("fill-extrusion-pattern").constantOr(1))_s(L,j,_,E,V,Di.disabled,ui.disabled),_s(L,j,_,E,V,L.stencilModeFor3D(),L.colorModeForRenderPass());else{const q=L.colorModeForRenderPass();_s(L,j,_,E,V,Di.disabled,q)}}})(l,p,x,B);break;case"hillshade":(function(L,j,_,E){if(L.renderPass!=="offscreen"&&L.renderPass!=="translucent")return;const F=L.context,V=L.depthModeForSublayer(0,ai.ReadOnly),q=L.colorModeForRenderPass(),[K,te]=L.renderPass==="translucent"?L.stencilConfigForOverlap(E):[{},E];for(const se of te){const oe=j.getTile(se);oe.needsHillshadePrepare!==void 0&&oe.needsHillshadePrepare&&L.renderPass==="offscreen"?Zl(L,oe,_,V,Di.disabled,q):L.renderPass==="translucent"&&gl(L,se,oe,_,V,K[se.overscaledZ],q)}F.viewport.set([0,0,L.width,L.height])})(l,p,x,B);break;case"raster":(function(L,j,_,E){if(L.renderPass!=="translucent"||_.paint.get("raster-opacity")===0||!E.length)return;const F=L.context,V=F.gl,q=j.getSource(),K=L.useProgram("raster"),te=L.colorModeForRenderPass(),[se,oe]=q instanceof or?[{},E]:L.stencilConfigForOverlap(E),le=oe[oe.length-1].overscaledZ,_e=!L.options.moving;for(const Ie of oe){const ve=L.depthModeForSublayer(Ie.overscaledZ-le,_.paint.get("raster-opacity")===1?ai.ReadWrite:ai.ReadOnly,V.LESS),Se=j.getTile(Ie);Se.registerFadeDuration(_.paint.get("raster-fade-duration"));const et=j.findLoadedParent(Ie,0),Oe=Fa(Se,et,j,_,L.transform,L.style.map.terrain);let Re,Ve;const At=_.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR;F.activeTexture.set(V.TEXTURE0),Se.texture.bind(At,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),F.activeTexture.set(V.TEXTURE1),et?(et.texture.bind(At,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),Re=Math.pow(2,et.tileID.overscaledZ-Se.tileID.overscaledZ),Ve=[Se.tileID.canonical.x*Re%1,Se.tileID.canonical.y*Re%1]):Se.texture.bind(At,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST);const dt=L.style.map.terrain&&L.style.map.terrain.getTerrainData(Ie),ft=dt?Ie:null,Nt=ft?ft.posMatrix:L.transform.calculatePosMatrix(Ie.toUnwrapped(),_e),It=ys(Nt,Ve||[0,0],Re||1,Oe,_);q instanceof or?K.draw(F,V.TRIANGLES,ve,Di.disabled,te,Li.disabled,It,dt,_.id,q.boundsBuffer,L.quadTriangleIndexBuffer,q.boundsSegments):K.draw(F,V.TRIANGLES,ve,se[Ie.overscaledZ],te,Li.disabled,It,dt,_.id,L.rasterBoundsBuffer,L.quadTriangleIndexBuffer,L.rasterBoundsSegments)}})(l,p,x,B);break;case"background":(function(L,j,_,E){const F=_.paint.get("background-color"),V=_.paint.get("background-opacity");if(V===0)return;const q=L.context,K=q.gl,te=L.transform,se=te.tileSize,oe=_.paint.get("background-pattern");if(L.isPatternMissing(oe))return;const le=!oe&&F.a===1&&V===1&&L.opaquePassEnabledForLayer()?"opaque":"translucent";if(L.renderPass!==le)return;const _e=Di.disabled,Ie=L.depthModeForSublayer(0,le==="opaque"?ai.ReadWrite:ai.ReadOnly),ve=L.colorModeForRenderPass(),Se=L.useProgram(oe?"backgroundPattern":"background"),et=E||te.coveringTiles({tileSize:se,terrain:L.style.map.terrain});oe&&(q.activeTexture.set(K.TEXTURE0),L.imageManager.bind(L.context));const Oe=_.getCrossfadeParameters();for(const Re of et){const Ve=E?Re.posMatrix:L.transform.calculatePosMatrix(Re.toUnwrapped()),At=oe?yo(Ve,V,L,oe,{tileID:Re,tileSize:se},Oe):tl(Ve,V,F),dt=L.style.map.terrain&&L.style.map.terrain.getTerrainData(Re);Se.draw(q,K.TRIANGLES,Ie,_e,ve,Li.disabled,At,dt,_.id,L.tileExtentBuffer,L.quadTriangleIndexBuffer,L.tileExtentSegments)}})(l,0,x,B);break;case"custom":(function(L,j,_){const E=L.context,F=_.implementation;if(L.renderPass==="offscreen"){const V=F.prerender;V&&(L.setCustomLayerDefaults(),E.setColorMode(L.colorModeForRenderPass()),V.call(F,E.gl,L.transform.customLayerMatrix()),E.setDirty(),L.setBaseState())}else if(L.renderPass==="translucent"){L.setCustomLayerDefaults(),E.setColorMode(L.colorModeForRenderPass()),E.setStencilMode(Di.disabled);const V=F.renderingMode==="3d"?new ai(L.context.gl.LEQUAL,ai.ReadWrite,L.depthRangeFor3D):L.depthModeForSublayer(0,ai.ReadOnly);E.setDepthMode(V),F.render(E.gl,L.transform.customLayerMatrix()),E.setDirty(),L.setBaseState(),E.bindFramebuffer.set(null)}})(l,0,x)}}translatePosMatrix(l,p,x,B,L){if(!x[0]&&!x[1])return l;const j=L?B==="map"?this.transform.angle:0:B==="viewport"?-this.transform.angle:0;if(j){const F=Math.sin(j),V=Math.cos(j);x=[x[0]*V-x[1]*F,x[0]*F+x[1]*V]}const _=[L?x[0]:Gt(p,x[0],this.transform.zoom),L?x[1]:Gt(p,x[1],this.transform.zoom),0],E=new Float32Array(16);return s.H(E,l,_),E}saveTileTexture(l){const p=this._tileTextures[l.size[0]];p?p.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const p=this._tileTextures[l];return p&&p.length>0?p.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const p=this.imageManager.getPattern(l.from.toString()),x=this.imageManager.getPattern(l.to.toString());return!p||!x}useProgram(l,p){this.cache=this.cache||{};const x=l+(p?p.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[x]||(this.cache[x]=new Ja(this.context,mo[l],p,Fi[l],this._showOverdrawInspector,this.style.map.terrain)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new De(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:p}=this.context.gl;return this.width!==l||this.height!==p}}class ps{constructor(l,p){this.points=l,this.planes=p}static fromInvProjectionMatrix(l,p,x){const B=Math.pow(2,x),L=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(_=>{const E=1/(_=s.af([],_,l))[3]/p*B;return s.a$(_,_,[E,E,1/_[3],E])}),j=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(_=>{const E=function(K,te){var se=te[0],oe=te[1],le=te[2],_e=se*se+oe*oe+le*le;return _e>0&&(_e=1/Math.sqrt(_e)),K[0]=te[0]*_e,K[1]=te[1]*_e,K[2]=te[2]*_e,K}([],function(K,te,se){var oe=te[0],le=te[1],_e=te[2],Ie=se[0],ve=se[1],Se=se[2];return K[0]=le*Se-_e*ve,K[1]=_e*Ie-oe*Se,K[2]=oe*ve-le*Ie,K}([],at([],L[_[0]],L[_[1]]),at([],L[_[2]],L[_[1]]))),F=-((V=E)[0]*(q=L[_[1]])[0]+V[1]*q[1]+V[2]*q[2]);var V,q;return E.concat(F)});return new ps(L,j)}}class Fo{constructor(l,p){this.min=l,this.max=p,this.center=function(x,B,L){return x[0]=.5*B[0],x[1]=.5*B[1],x[2]=.5*B[2],x}([],function(x,B,L){return x[0]=B[0]+L[0],x[1]=B[1]+L[1],x[2]=B[2]+L[2],x}([],this.min,this.max))}quadrant(l){const p=[l%2==0,l<2],x=We(this.min),B=We(this.max);for(let L=0;L<p.length;L++)x[L]=p[L]?this.min[L]:this.center[L],B[L]=p[L]?this.center[L]:this.max[L];return B[2]=this.max[2],new Fo(x,B)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const p=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let x=!0;for(let B=0;B<l.planes.length;B++){const L=l.planes[B];let j=0;for(let _=0;_<p.length;_++)s.b0(L,p[_])>=0&&j++;if(j===0)return 0;j!==p.length&&(x=!1)}if(x)return 2;for(let B=0;B<3;B++){let L=Number.MAX_VALUE,j=-Number.MAX_VALUE;for(let _=0;_<l.points.length;_++){const E=l.points[_][B]-this.min[B];L=Math.min(L,E),j=Math.max(j,E)}if(j<0||L>this.max[B]-this.min[B])return 0}return 1}}class vo{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(l)||l<0||isNaN(p)||p<0||isNaN(x)||x<0||isNaN(B)||B<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=p,this.left=x,this.right=B}interpolate(l,p,x){return p.top!=null&&l.top!=null&&(this.top=s.z.number(l.top,p.top,x)),p.bottom!=null&&l.bottom!=null&&(this.bottom=s.z.number(l.bottom,p.bottom,x)),p.left!=null&&l.left!=null&&(this.left=s.z.number(l.left,p.left,x)),p.right!=null&&l.right!=null&&(this.right=s.z.number(l.right,p.right,x)),this}getCenter(l,p){const x=s.ac((this.left+l-this.right)/2,0,l),B=s.ac((this.top+p-this.bottom)/2,0,p);return new s.P(x,B)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new vo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const _a=85.051129;class sl{constructor(l,p,x,B,L){this.tileSize=512,this._renderWorldCopies=L===void 0||!!L,this._minZoom=l||0,this._maxZoom=p||22,this._minPitch=x??0,this._maxPitch=B??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new vo,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const l=new sl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.apply(this),l}apply(l){this.tileSize=l.tileSize,this.latRange=l.latRange,this.width=l.width,this.height=l.height,this._center=l._center,this._elevation=l._elevation,this.minElevationForCurrentTile=l.minElevationForCurrentTile,this.zoom=l.zoom,this.angle=l.angle,this._fov=l._fov,this._pitch=l._pitch,this._unmodified=l._unmodified,this._edgeInsets=l._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const p=-s.b1(l,-180,180)*Math.PI/180;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=function(){var x=new s.A(4);return s.A!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x}(),function(x,B,L){var j=B[0],_=B[1],E=B[2],F=B[3],V=Math.sin(L),q=Math.cos(L);x[0]=j*q+E*V,x[1]=_*q+F*V,x[2]=j*-V+E*q,x[3]=_*-V+F*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const p=s.ac(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const p=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._zoom=p,this.tileZoom=Math.max(0,Math.floor(p)),this.scale=this.zoomScale(p),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,p,x){this._unmodified=!1,this._edgeInsets.interpolate(l,p,x),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const p=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(l){const p=[new s.b2(0,l)];if(this._renderWorldCopies){const x=this.pointCoordinate(new s.P(0,0)),B=this.pointCoordinate(new s.P(this.width,0)),L=this.pointCoordinate(new s.P(this.width,this.height)),j=this.pointCoordinate(new s.P(0,this.height)),_=Math.floor(Math.min(x.x,B.x,L.x,j.x)),E=Math.floor(Math.max(x.x,B.x,L.x,j.x)),F=1;for(let V=_-F;V<=E+F;V++)V!==0&&p.push(new s.b2(V,l))}return p}coveringTiles(l){var p,x;let B=this.coveringZoomLevel(l);const L=B;if(l.minzoom!==void 0&&B<l.minzoom)return[];l.maxzoom!==void 0&&B>l.maxzoom&&(B=l.maxzoom);const j=this.pointCoordinate(this.getCameraPoint()),_=s.Y.fromLngLat(this.center),E=Math.pow(2,B),F=[E*j.x,E*j.y,0],V=[E*_.x,E*_.y,0],q=ps.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,B);let K=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(K=B);const te=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,se=ve=>({aabb:new Fo([ve*E,0,0],[(ve+1)*E,E,0]),zoom:0,x:0,y:0,wrap:ve,fullyVisible:!1}),oe=[],le=[],_e=B,Ie=l.reparseOverscaled?L:B;if(this._renderWorldCopies)for(let ve=1;ve<=3;ve++)oe.push(se(-ve)),oe.push(se(ve));for(oe.push(se(0));oe.length>0;){const ve=oe.pop(),Se=ve.x,et=ve.y;let Oe=ve.fullyVisible;if(!Oe){const ft=ve.aabb.intersects(q);if(ft===0)continue;Oe=ft===2}const Re=l.terrain?F:V,Ve=ve.aabb.distanceX(Re),At=ve.aabb.distanceY(Re),dt=Math.max(Math.abs(Ve),Math.abs(At));if(ve.zoom===_e||dt>te+(1<<_e-ve.zoom)-2&&ve.zoom>=K){const ft=_e-ve.zoom,Nt=F[0]-.5-(Se<<ft),It=F[1]-.5-(et<<ft);le.push({tileID:new s.Q(ve.zoom===_e?Ie:ve.zoom,ve.wrap,ve.zoom,Se,et),distanceSq:nt([V[0]-.5-Se,V[1]-.5-et]),tileDistanceToCamera:Math.sqrt(Nt*Nt+It*It)})}else for(let ft=0;ft<4;ft++){const Nt=(Se<<1)+ft%2,It=(et<<1)+(ft>>1),jt=ve.zoom+1;let Ht=ve.aabb.quadrant(ft);if(l.terrain){const Pr=new s.Q(jt,ve.wrap,jt,Nt,It),yr=l.terrain.getMinMaxElevation(Pr),Ir=(p=yr.minElevation)!==null&&p!==void 0?p:this.elevation,hr=(x=yr.maxElevation)!==null&&x!==void 0?x:this.elevation;Ht=new Fo([Ht.min[0],Ht.min[1],Ir],[Ht.max[0],Ht.max[1],hr])}oe.push({aabb:Ht,zoom:jt,x:Nt,y:It,wrap:ve.wrap,fullyVisible:Oe})}}return le.sort((ve,Se)=>ve.distanceSq-Se.distanceSq).map(ve=>ve.tileID)}resize(l,p){this.width=l,this.height=p,this.pixelsToGLUnits=[2/l,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const p=s.ac(l.lat,-85.051129,_a);return new s.P(s.N(l.lng)*this.worldSize,s.O(p)*this.worldSize)}unproject(l){return new s.Y(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const p=this.elevation,x=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,B=this.pointLocation(this.centerPoint,l),L=l.getElevationForLngLatZoom(B,this.tileZoom);if(!(this.elevation-L))return;const j=x+p-L,_=Math.cos(this._pitch)*this.cameraToCenterDistance/j/s.b3(1,B.lat),E=this.scaleZoom(_/this.tileSize);this._elevation=L,this._center=B,this.zoom=E}setLocationAtPoint(l,p){const x=this.pointCoordinate(p),B=this.pointCoordinate(this.centerPoint),L=this.locationCoordinate(l),j=new s.Y(L.x-(x.x-B.x),L.y-(x.y-B.y));this.center=this.coordinateLocation(j),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,p){return p?this.coordinatePoint(this.locationCoordinate(l),p.getElevationForLngLatZoom(l,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,p){return this.coordinateLocation(this.pointCoordinate(l,p))}locationCoordinate(l){return s.Y.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,p){if(p){const K=p.pointCoordinate(l);if(K!=null)return K}const x=[l.x,l.y,0,1],B=[l.x,l.y,1,1];s.af(x,x,this.pixelMatrixInverse),s.af(B,B,this.pixelMatrixInverse);const L=x[3],j=B[3],_=x[1]/L,E=B[1]/j,F=x[2]/L,V=B[2]/j,q=F===V?0:(0-F)/(V-F);return new s.Y(s.z.number(x[0]/L,B[0]/j,q)/this.worldSize,s.z.number(_,E,q)/this.worldSize)}coordinatePoint(l){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const B=[l.x*this.worldSize,l.y*this.worldSize,p,1];return s.af(B,B,x),new s.P(B[0]/B[3],B[1]/B[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return new kt().extend(this.pointLocation(new s.P(0,l))).extend(this.pointLocation(new s.P(this.width,l))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new kt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,_a])}calculatePosMatrix(l){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const x=l.key,B=p?this._alignedPosMatrixCache:this._posMatrixCache;if(B[x])return B[x];const L=l.canonical,j=this.worldSize/this.zoomScale(L.z),_=L.x+Math.pow(2,L.z)*l.wrap,E=s.an(new Float64Array(16));return s.H(E,E,[_*j,L.y*j,0]),s.J(E,E,[j/s.W,j/s.W,1]),s.K(E,p?this.alignedProjMatrix:this.projMatrix,E),B[x]=new Float32Array(E),B[x]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(l,p){p=s.ac(+p,this.minZoom,this.maxZoom);const x={center:new s.M(l.lng,l.lat),zoom:p};let B=this.lngRange;if(!this._renderWorldCopies&&B===null){const ve=179.9999999999;B=[-ve,ve]}const L=this.tileSize*this.zoomScale(x.zoom);let j=0,_=L,E=0,F=L,V=0,q=0;const{x:K,y:te}=this.size;if(this.latRange){const ve=this.latRange;j=s.O(ve[1])*L,_=s.O(ve[0])*L,_-j<te&&(V=te/(_-j))}B&&(E=s.b1(s.N(B[0])*L,0,L),F=s.b1(s.N(B[1])*L,0,L),F<E&&(F+=L),F-E<K&&(q=K/(F-E)));const{x:se,y:oe}=this.project.call({worldSize:L},l);let le,_e;const Ie=Math.max(q||0,V||0);if(Ie){const ve=new s.P(q?(F+E)/2:se,V?(_+j)/2:oe);return x.center=this.unproject.call({worldSize:L},ve).wrap(),x.zoom+=this.scaleZoom(Ie),x}if(this.latRange){const ve=te/2;oe-ve<j&&(_e=j+ve),oe+ve>_&&(_e=_-ve)}if(B){const ve=(E+F)/2;let Se=se;this._renderWorldCopies&&(Se=s.b1(se,ve-L/2,ve+L/2));const et=K/2;Se-et<E&&(le=E+et),Se+et>F&&(le=F-et)}if(le!==void 0||_e!==void 0){const ve=new s.P(le??se,_e??oe);x.center=this.unproject.call({worldSize:L},ve).wrap()}return x}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:p,zoom:x}=this.getConstrained(this.center,this.zoom);this.center=p,this.zoom=x,this._unmodified=l,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,p=this.point.x,x=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b3(1,this.center.lat)*this.worldSize;let B=s.an(new Float64Array(16));s.J(B,B,[this.width/2,-this.height/2,1]),s.H(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=s.an(new Float64Array(16)),s.J(B,B,[1,-1,1]),s.H(B,B,[-1,-1,0]),s.J(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B;const L=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),j=Math.min(this.elevation,this.minElevationForCurrentTile),_=L-j*this._pixelPerMeter/Math.cos(this._pitch),E=j<0?_:L,F=Math.PI/2+this._pitch,V=this._fov*(.5+l.y/this.height),q=Math.sin(V)*E/Math.sin(s.ac(Math.PI-F-V,.01,Math.PI-.01)),K=this.getHorizon(),te=2*Math.atan(K/this.cameraToCenterDistance)*(.5+l.y/(2*K)),se=Math.sin(te)*E/Math.sin(s.ac(Math.PI-F-te,.01,Math.PI-.01)),oe=Math.min(q,se),le=1.01*(Math.cos(Math.PI/2-this._pitch)*oe+E),_e=this.height/50;B=new Float64Array(16),s.b4(B,this._fov,this.width/this.height,_e,le),B[8]=2*-l.x/this.width,B[9]=2*l.y/this.height,s.J(B,B,[1,-1,1]),s.H(B,B,[0,0,-this.cameraToCenterDistance]),s.b5(B,B,this._pitch),s.ad(B,B,this.angle),s.H(B,B,[-p,-x,0]),this.mercatorMatrix=s.J([],B,[this.worldSize,this.worldSize,this.worldSize]),s.J(B,B,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.K(new Float64Array(16),this.labelPlaneMatrix,B),s.H(B,B,[0,0,-this.elevation]),this.projMatrix=B,this.invProjMatrix=s.ar([],B),this.pixelMatrix3D=s.K(new Float64Array(16),this.labelPlaneMatrix,B);const Ie=this.width%2/2,ve=this.height%2/2,Se=Math.cos(this.angle),et=Math.sin(this.angle),Oe=p-Math.round(p)+Se*Ie+et*ve,Re=x-Math.round(x)+Se*ve+et*Ie,Ve=new Float64Array(B);if(s.H(Ve,Ve,[Oe>.5?Oe-1:Oe,Re>.5?Re-1:Re,0]),this.alignedProjMatrix=Ve,B=s.ar(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");this.pixelMatrixInverse=B,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new s.P(0,0)),p=[l.x*this.worldSize,l.y*this.worldSize,0,1];return s.af(p,p,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,l))}getCameraQueryGeometry(l){const p=this.getCameraPoint();if(l.length===1)return[l[0],p];{let x=p.x,B=p.y,L=p.x,j=p.y;for(const _ of l)x=Math.min(x,_.x),B=Math.min(B,_.y),L=Math.max(L,_.x),j=Math.max(j,_.y);return[new s.P(x,B),new s.P(L,B),new s.P(L,j),new s.P(x,j),new s.P(x,B)]}}lngLatToCameraDepth(l,p){const x=this.locationCoordinate(l),B=[x.x*this.worldSize,x.y*this.worldSize,p,1];return s.af(B,B,this.projMatrix),B[2]/B[3]}}function Do(w,l){var p=this;let x,B=!1,L=null,j=null;const _=()=>{L=null,B&&(w.apply(j,x),L=setTimeout(_,l),B=!1)};return function(){for(var E=arguments.length,F=new Array(E),V=0;V<E;V++)F[V]=arguments[V];return B=!0,j=p,x=F,L||_(),L}}class to{constructor(l){this._getCurrentHash=()=>{const p=window.location.hash.replace("#","");if(this._hashName){let x;return p.split("&").map(B=>B.split("=")).forEach(B=>{B[0]===this._hashName&&(x=B)}),(x&&x[1]||"").split("/")}return p.split("/")},this._onHashChange=()=>{const p=this._getCurrentHash();if(p.length>=3&&!p.some(x=>isNaN(x))){const x=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(p[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:x,pitch:+(p[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const p=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,p)}catch{}},this._updateHash=Do(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const p=this._map.getCenter(),x=Math.round(100*this._map.getZoom())/100,B=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),L=Math.pow(10,B),j=Math.round(p.lng*L)/L,_=Math.round(p.lat*L)/L,E=this._map.getBearing(),F=this._map.getPitch();let V="";if(V+=l?`/${j}/${_}/${x}`:`${x}/${_}/${j}`,(E||F)&&(V+="/"+Math.round(10*E)/10),F&&(V+=`/${Math.round(F)}`),this._hashName){const q=this._hashName;let K=!1;const te=window.location.hash.slice(1).split("&").map(se=>{const oe=se.split("=")[0];return oe===q?(K=!0,`${oe}=${V}`):se}).filter(se=>se);return K||te.push(`${q}=${V}`),`#${te.join("&")}`}return`#${V}`}}const $s={linearity:.3,easing:s.b6(0,0,.3,1)},bs=s.e({deceleration:2500,maxSpeed:1400},$s),Ao=s.e({deceleration:20,maxSpeed:1400},$s),Ra=s.e({deceleration:1e3,maxSpeed:360},$s),ml=s.e({deceleration:1e3,maxSpeed:90},$s);class Yl{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:I.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,p=I.now();for(;l.length>0&&p-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const p={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:L}of this._inertiaBuffer)p.zoom+=L.zoomDelta||0,p.bearing+=L.bearingDelta||0,p.pitch+=L.pitchDelta||0,L.panDelta&&p.pan._add(L.panDelta),L.around&&(p.around=L.around),L.pinchAround&&(p.pinchAround=L.pinchAround);const x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,B={};if(p.pan.mag()){const L=ea(p.pan.mag(),x,s.e({},bs,l||{}));B.offset=p.pan.mult(L.amount/p.pan.mag()),B.center=this._map.transform.center,ks(B,L)}if(p.zoom){const L=ea(p.zoom,x,Ao);B.zoom=this._map.transform.zoom+L.amount,ks(B,L)}if(p.bearing){const L=ea(p.bearing,x,Ra);B.bearing=this._map.transform.bearing+s.ac(L.amount,-179,179),ks(B,L)}if(p.pitch){const L=ea(p.pitch,x,ml);B.pitch=this._map.transform.pitch+L.amount,ks(B,L)}if(B.zoom||B.bearing){const L=p.pinchAround===void 0?p.around:p.pinchAround;B.around=L?this._map.unproject(L):this._map.getCenter()}return this.clear(),s.e(B,{noMoveStart:!0})}}function ks(w,l){(!w.duration||w.duration<l.duration)&&(w.duration=l.duration,w.easing=l.easing)}function ea(w,l,p){const{maxSpeed:x,linearity:B,deceleration:L}=p,j=s.ac(w*B/(l/1e3),-x,x),_=Math.abs(j)/(L*B);return{easing:p.easing,duration:1e3*_,amount:j*(_/2)}}class ln extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const L=R.mousePos(p.getCanvas(),x),j=p.unproject(L);super(l,s.e({point:L,lngLat:j,originalEvent:x},B)),this._defaultPrevented=!1,this.target=p}}class Kn extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,p,x){const B=l==="touchend"?x.changedTouches:x.touches,L=R.touchPos(p.getCanvasContainer(),B),j=L.map(E=>p.unproject(E)),_=L.reduce((E,F,V,q)=>E.add(F.div(q.length)),new s.P(0,0));super(l,{points:L,point:_,lngLats:j,lngLat:p.unproject(_),originalEvent:x}),this._defaultPrevented=!1}}class ls extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,p,x){super(l,{originalEvent:x}),this._defaultPrevented=!1}}class Ni{constructor(l,p){this._map=l,this._clickTolerance=p.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new ls(l.type,this._map,l))}mousedown(l,p){return this._mousedownPos=p,this._firePreventable(new ln(l.type,this._map,l))}mouseup(l){this._map.fire(new ln(l.type,this._map,l))}click(l,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||this._map.fire(new ln(l.type,this._map,l))}dblclick(l){return this._firePreventable(new ln(l.type,this._map,l))}mouseover(l){this._map.fire(new ln(l.type,this._map,l))}mouseout(l){this._map.fire(new ln(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Kn(l.type,this._map,l))}touchmove(l){this._map.fire(new Kn(l.type,this._map,l))}touchend(l){this._map.fire(new Kn(l.type,this._map,l))}touchcancel(l){this._map.fire(new Kn(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tn{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new ln(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ln("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new ln(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class nn{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.pointLocation(s.P.convert(l),this._map.terrain)}}class zn{constructor(l,p){this._map=l,this._tr=new nn(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,p){this.isEnabled()&&l.shiftKey&&l.button===0&&(R.disableDrag(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(l,p){if(!this._active)return;const x=p;if(this._lastPos.equals(x)||!this._box&&x.dist(this._startPos)<this._clickTolerance)return;const B=this._startPos;this._lastPos=x,this._box||(this._box=R.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const L=Math.min(B.x,x.x),j=Math.max(B.x,x.x),_=Math.min(B.y,x.y),E=Math.max(B.y,x.y);R.setTransform(this._box,`translate(${L}px,${_}px)`),this._box.style.width=j-L+"px",this._box.style.height=E-_+"px"}mouseupWindow(l,p){if(!this._active||l.button!==0)return;const x=this._startPos,B=p;if(this.reset(),R.suppressClick(),x.x!==B.x||x.y!==B.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:l})),{cameraAnimation:L=>L.fitScreenCoordinates(x,B,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(R.remove(this._box),this._box=null),R.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,p){return this._map.fire(new s.k(l,{originalEvent:p}))}}function va(w,l){if(w.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${l.length}`);const p={};for(let x=0;x<w.length;x++)p[w[x].identifier]=l[x];return p}class ka{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,p,x){(this.centroid||x.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),x.length===this.numTouches&&(this.centroid=function(B){const L=new s.P(0,0);for(const j of B)L._add(j);return L.div(B.length)}(p),this.touches=va(x,p)))}touchmove(l,p,x){if(this.aborted||!this.centroid)return;const B=va(x,p);for(const L in this.touches){const j=B[L];(!j||j.dist(this.touches[L])>30)&&(this.aborted=!0)}}touchend(l,p,x){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),x.length===0){const B=!this.aborted&&this.centroid;if(this.reset(),B)return B}}}class ta{constructor(l){this.singleTap=new ka(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,p,x){this.singleTap.touchstart(l,p,x)}touchmove(l,p,x){this.singleTap.touchmove(l,p,x)}touchend(l,p,x){const B=this.singleTap.touchend(l,p,x);if(B){const L=l.timeStamp-this.lastTime<500,j=!this.lastTap||this.lastTap.dist(B)<30;if(L&&j||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=B,this.count===this.numTaps)return this.reset(),B}}}class ra{constructor(l){this._tr=new nn(l),this._zoomIn=new ta({numTouches:1,numTaps:2}),this._zoomOut=new ta({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,p,x){this._zoomIn.touchstart(l,p,x),this._zoomOut.touchstart(l,p,x)}touchmove(l,p,x){this._zoomIn.touchmove(l,p,x),this._zoomOut.touchmove(l,p,x)}touchend(l,p,x){const B=this._zoomIn.touchend(l,p,x),L=this._zoomOut.touchend(l,p,x),j=this._tr;return B?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:j.zoom+1,around:j.unproject(B)},{originalEvent:l})}):L?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:j.zoom-1,around:j.unproject(L)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nr{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(){const l=this._moveFunction(...arguments);if(l.bearingDelta||l.pitchDelta||l.around||l.panDelta)return this._active=!0,l}dragStart(l,p){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=p.length?p[0]:p,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,p){if(!this.isEnabled())return;const x=this._lastPoint;if(!x)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const B=p.length?p[0]:p;return!this._moved&&B.dist(x)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=B,this._move(x,B))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&R.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ba={0:1,2:2};class Rr{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const p=R.mouseButton(l);this._eventButton=p}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(p,x){const B=ba[x];return p.buttons===void 0||(p.buttons&B)!==B}(l,this._eventButton)}isValidEndEvent(l){return R.mouseButton(l)===this._eventButton}}class yl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}const _l=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=function(l){l.preventDefault()}},Mr=w=>{let{enable:l,clickTolerance:p,bearingDegreesPerPixelMoved:x=.8}=w;const B=new Rr({checkCorrectEvent:L=>R.mouseButton(L)===0&&L.ctrlKey||R.mouseButton(L)===2});return new Nr({clickTolerance:p,move:(L,j)=>({bearingDelta:(j.x-L.x)*x}),moveStateManager:B,enable:l,assignEvents:_l})},Cc=w=>{let{enable:l,clickTolerance:p,pitchDegreesPerPixelMoved:x=-.5}=w;const B=new Rr({checkCorrectEvent:L=>R.mouseButton(L)===0&&L.ctrlKey||R.mouseButton(L)===2});return new Nr({clickTolerance:p,move:(L,j)=>({pitchDelta:(j.y-L.y)*x}),moveStateManager:B,enable:l,assignEvents:_l})};class Dr{constructor(l,p){this._clickTolerance=l.clickTolerance||1,this._map=p,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(l,p,x){return this._calculateTransform(l,p,x)}touchmove(l,p,x){if(this._active&&!(x.length<this.minTouchs()))return l.preventDefault(),this._calculateTransform(l,p,x)}touchend(l,p,x){this._calculateTransform(l,p,x),this._active&&x.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,p,x){x.length>0&&(this._active=!0);const B=va(x,p),L=new s.P(0,0),j=new s.P(0,0);let _=0;for(const F in B){const V=B[F],q=this._touches[F];q&&(L._add(V),j._add(V.sub(q)),_++,B[F]=V)}if(this._touches=B,_<this.minTouchs()||!j.mag())return;const E=j.div(_);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:L.div(_),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ro{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,p,x){this._firstTwoTouches||x.length<2||(this._firstTwoTouches=[x[0].identifier,x[1].identifier],this._start([p[0],p[1]]))}touchmove(l,p,x){if(!this._firstTwoTouches)return;l.preventDefault();const[B,L]=this._firstTwoTouches,j=io(x,p,B),_=io(x,p,L);if(!j||!_)return;const E=this._aroundCenter?null:j.add(_).div(2);return this._move([j,_],E,l)}touchend(l,p,x){if(!this._firstTwoTouches)return;const[B,L]=this._firstTwoTouches,j=io(x,p,B),_=io(x,p,L);j&&_||(this._active&&R.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function io(w,l,p){for(let x=0;x<w.length;x++)if(w[x].identifier===p)return l[x]}function Gc(w,l){return Math.log(w/l)/Math.LN2}class ec extends ro{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,p){const x=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Gc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gc(this._distance,x),pinchAround:p}}}function mu(w,l){return 180*w.angleWith(l)/Math.PI}class jc extends ro{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,p,x){const B=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:mu(this._vector,B),pinchAround:p}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const p=25/(Math.PI*this._minDiameter)*360,x=mu(l,this._startVector);return Math.abs(x)<p}}function tc(w){return Math.abs(w.y)>Math.abs(w.x)}class qc extends ro{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,p,x){super.touchstart(l,p,x),this._currentTouchCount=x.length}_start(l){this._lastPoints=l,tc(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,p,x){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const B=l[0].sub(this._lastPoints[0]),L=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(B,L,x.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(B.y+L.y)/2*-.5}):void 0}gestureBeginsVertically(l,p,x){if(this._valid!==void 0)return this._valid;const B=l.mag()>=2,L=p.mag()>=2;if(!B&&!L)return;if(!B||!L)return this._firstMove===void 0&&(this._firstMove=x),x-this._firstMove<100&&void 0;const j=l.y>0==p.y>0;return tc(l)&&tc(p)&&j}}const ol={panStep:100,bearingStep:15,pitchStep:10};class vn{constructor(l){this._tr=new nn(l);const p=ol;this._panStep=p.panStep,this._bearingStep=p.bearingStep,this._pitchStep=p.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let p=0,x=0,B=0,L=0,j=0;switch(l.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:l.shiftKey?x=-1:(l.preventDefault(),L=-1);break;case 39:l.shiftKey?x=1:(l.preventDefault(),L=1);break;case 38:l.shiftKey?B=1:(l.preventDefault(),j=-1);break;case 40:l.shiftKey?B=-1:(l.preventDefault(),j=1);break;default:return}return this._rotationDisabled&&(x=0,B=0),{cameraAnimation:_=>{const E=this._tr;_.easeTo({duration:300,easeId:"keyboardHandler",easing:Os,zoom:p?Math.round(E.zoom)+p*(l.shiftKey?2:1):E.zoom,bearing:E.bearing+x*this._bearingStep,pitch:E.pitch+B*this._pitchStep,offset:[-L*this._panStep,-j*this._panStep],center:E.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Os(w){return w*(2-w)}const Ro=4.000244140625;class vl{constructor(l,p){this._onTimeout=x=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(x)},this._map=l,this._tr=new nn(l),this._triggerRenderFrame=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!l[this._map.cooperativeGestures._bypassKey])return;let p=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const x=I.now(),B=x-(this._lastWheelEventTime||0);this._lastWheelEventTime=x,p!==0&&p%Ro==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":B>400?(this._type=null,this._lastValue=p,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(B*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),l.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=l,this._delta-=p,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=R.mousePos(this._map.getCanvas(),l),x=this._tr;this._around=p.y>x.transform.height/2-x.transform.getHorizon()?s.M.convert(this._aroundCenter?x.center:x.unproject(p)):s.M.convert(x.center),this._aroundPoint=x.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(this._delta!==0){const _=this._type==="wheel"&&Math.abs(this._delta)>Ro?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*_)));this._delta<0&&E!==0&&(E=1/E);const F=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(F*E))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,x=this._startZoom,B=this._easing;let L,j=!1;if(this._type==="wheel"&&x&&B){const _=Math.min((I.now()-this._lastWheelEventTime)/200,1),E=B(_);L=s.z.number(x,p,E),_<1?this._frameId||(this._frameId=!0):j=!0}else L=p,j=!0;return this._active=!0,j&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!j,zoomDelta:L-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let p=s.b7;if(this._prevEase){const x=this._prevEase,B=(I.now()-x.start)/x.duration,L=x.easing(B+.01)-x.easing(B),j=.27/Math.sqrt(L*L+1e-4)*.01,_=Math.sqrt(.0729-j*j);p=s.b6(j,_,.25,1)}return this._prevEase={start:I.now(),duration:l,easing:p},p}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class yu{constructor(l,p){this._clickZoom=l,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class $c{constructor(l){this._tr=new nn(l),this.reset()}reset(){this._active=!1}dblclick(l,p){return l.preventDefault(),{cameraAnimation:x=>{x.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(p)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gu{constructor(){this._tap=new ta({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,p,x){if(!this._swipePoint)if(this._tapTime){const B=p[0],L=l.timeStamp-this._tapTime<500,j=this._tapPoint.dist(B)<30;L&&j?x.length>0&&(this._swipePoint=B,this._swipeTouch=x[0].identifier):this.reset()}else this._tap.touchstart(l,p,x)}touchmove(l,p,x){if(this._tapTime){if(this._swipePoint){if(x[0].identifier!==this._swipeTouch)return;const B=p[0],L=B.y-this._swipePoint.y;return this._swipePoint=B,l.preventDefault(),this._active=!0,{zoomDelta:L/128}}}else this._tap.touchmove(l,p,x)}touchend(l,p,x){if(this._tapTime)this._swipePoint&&x.length===0&&this.reset();else{const B=this._tap.touchend(l,p,x);B&&(this._tapTime=l.timeStamp,this._tapPoint=B)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xa{constructor(l,p,x){this._el=l,this._mousePan=p,this._touchPan=x}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class no{constructor(l,p,x){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=p,this._mousePitch=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Sr{constructor(l,p,x,B){this._el=l,this._touchZoom=p,this._touchRotate=x,this._tapDragZoom=B,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class oi{constructor(l,p){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=p,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=R.create("div","maplibregl-cooperative-gesture-screen",l);let p=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(p=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const x=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),B=document.createElement("div");B.className="maplibregl-desktop-message",B.textContent=p,this._container.appendChild(B);const L=document.createElement("div");L.className="maplibregl-mobile-message",L.textContent=x,this._container.appendChild(L),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(R.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(l){this._onCooperativeGesture(l.touches.length===1)}wheel(l){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!l[this._bypassKey])}_onCooperativeGesture(l){this._enabled&&l&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const bl=w=>w.zoom||w.drag||w.pitch||w.rotate;class Kc extends s.k{}function rc(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class Us{constructor(l,p){this.handleWindowEvent=B=>{this.handleEvent(B,`${B.type}Window`)},this.handleEvent=(B,L)=>{if(B.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const j=B.type==="renderFrame"?void 0:B,_={needsRenderFrame:!1},E={},F={},V=B.touches,q=V?this._getMapTouches(V):void 0,K=q?R.touchPos(this._map.getCanvas(),q):R.mousePos(this._map.getCanvas(),B);for(const{handlerName:oe,handler:le,allowed:_e}of this._handlers){if(!le.isEnabled())continue;let Ie;this._blockedByActive(F,_e,oe)?le.reset():le[L||B.type]&&(Ie=le[L||B.type](B,K,q),this.mergeHandlerResult(_,E,Ie,oe,j),Ie&&Ie.needsRenderFrame&&this._triggerRenderFrame()),(Ie||le.isActive())&&(F[oe]=le)}const te={};for(const oe in this._previousActiveHandlers)F[oe]||(te[oe]=j);this._previousActiveHandlers=F,(Object.keys(te).length||rc(_))&&(this._changes.push([_,E,te]),this._triggerRenderFrame()),(Object.keys(F).length||rc(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:se}=_;se&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],se(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yl(l),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(p);const x=this._el;this._listeners=[[x,"touchstart",{passive:!0}],[x,"touchmove",{passive:!1}],[x,"touchend",void 0],[x,"touchcancel",void 0],[x,"mousedown",void 0],[x,"mousemove",void 0],[x,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[x,"mouseover",void 0],[x,"mouseout",void 0],[x,"dblclick",void 0],[x,"click",void 0],[x,"keydown",{capture:!1}],[x,"keyup",void 0],[x,"wheel",{passive:!1}],[x,"contextmenu",void 0],[window,"blur",void 0]];for(const[B,L,j]of this._listeners)R.addEventListener(B,L,B===document?this.handleWindowEvent:this.handleEvent,j)}destroy(){for(const[l,p,x]of this._listeners)R.removeEventListener(l,p,l===document?this.handleWindowEvent:this.handleEvent,x)}_addDefaultHandlers(l){const p=this._map,x=p.getCanvasContainer();this._add("mapEvent",new Ni(p,l));const B=p.boxZoom=new zn(p,l);this._add("boxZoom",B),l.interactive&&l.boxZoom&&B.enable();const L=p.cooperativeGestures=new oi(p,l.cooperativeGestures);this._add("cooperativeGestures",L),l.cooperativeGestures&&L.enable();const j=new ra(p),_=new $c(p);p.doubleClickZoom=new yu(_,j),this._add("tapZoom",j),this._add("clickZoom",_),l.interactive&&l.doubleClickZoom&&p.doubleClickZoom.enable();const E=new Gu;this._add("tapDragZoom",E);const F=p.touchPitch=new qc(p);this._add("touchPitch",F),l.interactive&&l.touchPitch&&p.touchPitch.enable(l.touchPitch);const V=Mr(l),q=Cc(l);p.dragRotate=new no(l,V,q),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]),l.interactive&&l.dragRotate&&p.dragRotate.enable();const K=(Ie=>{let{enable:ve,clickTolerance:Se}=Ie;const et=new Rr({checkCorrectEvent:Oe=>R.mouseButton(Oe)===0&&!Oe.ctrlKey});return new Nr({clickTolerance:Se,move:(Oe,Re)=>({around:Re,panDelta:Re.sub(Oe)}),activateOnStart:!0,moveStateManager:et,enable:ve,assignEvents:_l})})(l),te=new Dr(l,p);p.dragPan=new xa(x,K,te),this._add("mousePan",K),this._add("touchPan",te,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&p.dragPan.enable(l.dragPan);const se=new jc,oe=new ec;p.touchZoomRotate=new Sr(x,oe,se,E),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",oe,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&p.touchZoomRotate.enable(l.touchZoomRotate);const le=p.scrollZoom=new vl(p,()=>this._triggerRenderFrame());this._add("scrollZoom",le,["mousePan"]),l.interactive&&l.scrollZoom&&p.scrollZoom.enable(l.scrollZoom);const _e=p.keyboard=new vn(p);this._add("keyboard",_e),l.interactive&&l.keyboard&&p.keyboard.enable(),this._add("blockableMapEvent",new tn(p))}_add(l,p,x){this._handlers.push({handlerName:l,handler:p,allowed:x}),this._handlersById[l]=p}stop(l){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!bl(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,p,x){for(const B in l)if(B!==x&&(!p||p.indexOf(B)<0))return!0;return!1}_getMapTouches(l){const p=[];for(const x of l)this._el.contains(x.target)&&p.push(x);return p}mergeHandlerResult(l,p,x,B,L){if(!x)return;s.e(l,x);const j={handlerName:B,originalEvent:x.originalEvent||L};x.zoomDelta!==void 0&&(p.zoom=j),x.panDelta!==void 0&&(p.drag=j),x.pitchDelta!==void 0&&(p.pitch=j),x.bearingDelta!==void 0&&(p.rotate=j)}_applyChanges(){const l={},p={},x={};for(const[B,L,j]of this._changes)B.panDelta&&(l.panDelta=(l.panDelta||new s.P(0,0))._add(B.panDelta)),B.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+B.zoomDelta),B.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+B.bearingDelta),B.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+B.pitchDelta),B.around!==void 0&&(l.around=B.around),B.pinchAround!==void 0&&(l.pinchAround=B.pinchAround),B.noInertia&&(l.noInertia=B.noInertia),s.e(p,L),s.e(x,j);this._updateMapTransform(l,p,x),this._changes=[]}_updateMapTransform(l,p,x){const B=this._map,L=B._getTransformForUpdate(),j=B.terrain;if(!(rc(l)||j&&this._terrainMovement))return this._fireEvents(p,x,!0);let{panDelta:_,zoomDelta:E,bearingDelta:F,pitchDelta:V,around:q,pinchAround:K}=l;K!==void 0&&(q=K),B._stop(!0),q=q||B.transform.centerPoint;const te=L.pointLocation(_?q.sub(_):q);F&&(L.bearing+=F),V&&(L.pitch+=V),E&&(L.zoom+=E),j?this._terrainMovement||!p.drag&&!p.zoom?p.drag&&this._terrainMovement?L.center=L.pointLocation(L.centerPoint.sub(_)):L.setLocationAtPoint(te,q):(this._terrainMovement=!0,this._map._elevationFreeze=!0,L.setLocationAtPoint(te,q),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,L.recalculateZoom(B.terrain)})):L.setLocationAtPoint(te,q),B._applyUpdatedTransform(L),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(p,x,!0)}_fireEvents(l,p,x){const B=bl(this._eventsInProgress),L=bl(l),j={};for(const V in l){const{originalEvent:q}=l[V];this._eventsInProgress[V]||(j[`${V}start`]=q),this._eventsInProgress[V]=l[V]}!B&&L&&this._fireEvent("movestart",L.originalEvent);for(const V in j)this._fireEvent(V,j[V]);L&&this._fireEvent("move",L.originalEvent);for(const V in l){const{originalEvent:q}=l[V];this._fireEvent(V,q)}const _={};let E;for(const V in this._eventsInProgress){const{handlerName:q,originalEvent:K}=this._eventsInProgress[V];this._handlersById[q].isActive()||(delete this._eventsInProgress[V],E=p[q]||K,_[`${V}end`]=E)}for(const V in _)this._fireEvent(V,_[V]);const F=bl(this._eventsInProgress);if(x&&(B||L)&&!F){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=K=>K!==0&&-this._bearingSnap<K&&K<this._bearingSnap;!V||!V.essential&&I.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:E})),q(this._map.getBearing())&&this._map.resetNorth()):(q(V.bearing||this._map.getBearing())&&(V.bearing=0),V.freezeElevation=!0,this._map.easeTo(V,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(l,p){this._map.fire(new s.k(l,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new Kc("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class uA extends s.E{constructor(l,p){super(),this._renderFrameCallback=()=>{const x=Math.min((I.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(x)),x<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=p.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.M(this.transform.center.lng,this.transform.center.lat)}setCenter(l,p){return this.jumpTo({center:l},p)}panBy(l,p,x){return l=s.P.convert(l).mult(-1),this.panTo(this.transform.center,s.e({offset:l},p),x)}panTo(l,p,x){return this.easeTo(s.e({center:l},p),x)}getZoom(){return this.transform.zoom}setZoom(l,p){return this.jumpTo({zoom:l},p),this}zoomTo(l,p,x){return this.easeTo(s.e({zoom:l},p),x)}zoomIn(l,p){return this.zoomTo(this.getZoom()+1,l,p),this}zoomOut(l,p){return this.zoomTo(this.getZoom()-1,l,p),this}getBearing(){return this.transform.bearing}setBearing(l,p){return this.jumpTo({bearing:l},p),this}getPadding(){return this.transform.padding}setPadding(l,p){return this.jumpTo({padding:l},p),this}rotateTo(l,p,x){return this.easeTo(s.e({bearing:l},p),x)}resetNorth(l,p){return this.rotateTo(0,s.e({duration:1e3},l),p),this}resetNorthPitch(l,p){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},l),p),this}snapToNorth(l,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,p):this}getPitch(){return this.transform.pitch}setPitch(l,p){return this.jumpTo({pitch:l},p),this}cameraForBounds(l,p){l=kt.convert(l);const x=p&&p.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),x,p)}_cameraForBoxAndBearing(l,p,x,B){const L={top:0,bottom:0,right:0,left:0};if(typeof(B=s.e({padding:L,offset:[0,0],maxZoom:this.transform.maxZoom},B)).padding=="number"){const ft=B.padding;B.padding={top:ft,bottom:ft,right:ft,left:ft}}B.padding=s.e(L,B.padding);const j=this.transform,_=j.padding,E=new kt(l,p),F=j.project(E.getNorthWest()),V=j.project(E.getNorthEast()),q=j.project(E.getSouthEast()),K=j.project(E.getSouthWest()),te=s.b8(-x),se=F.rotate(te),oe=V.rotate(te),le=q.rotate(te),_e=K.rotate(te),Ie=new s.P(Math.max(se.x,oe.x,_e.x,le.x),Math.max(se.y,oe.y,_e.y,le.y)),ve=new s.P(Math.min(se.x,oe.x,_e.x,le.x),Math.min(se.y,oe.y,_e.y,le.y)),Se=Ie.sub(ve),et=(j.width-(_.left+_.right+B.padding.left+B.padding.right))/Se.x,Oe=(j.height-(_.top+_.bottom+B.padding.top+B.padding.bottom))/Se.y;if(Oe<0||et<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Re=Math.min(j.scaleZoom(j.scale*Math.min(et,Oe)),B.maxZoom),Ve=s.P.convert(B.offset),At=new s.P((B.padding.left-B.padding.right)/2,(B.padding.top-B.padding.bottom)/2).rotate(s.b8(x)),dt=Ve.add(At).mult(j.scale/j.zoomScale(Re));return{center:j.unproject(F.add(q).div(2).sub(dt)),zoom:Re,bearing:x}}fitBounds(l,p,x){return this._fitInternal(this.cameraForBounds(l,p),p,x)}fitScreenCoordinates(l,p,x,B,L){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(l)),this.transform.pointLocation(s.P.convert(p)),x,B),B,L)}_fitInternal(l,p,x){return l?(delete(p=s.e(l,p)).padding,p.linear?this.easeTo(p,x):this.flyTo(p,x)):this}jumpTo(l,p){this.stop();const x=this._getTransformForUpdate();let B=!1,L=!1,j=!1;return"zoom"in l&&x.zoom!==+l.zoom&&(B=!0,x.zoom=+l.zoom),l.center!==void 0&&(x.center=s.M.convert(l.center)),"bearing"in l&&x.bearing!==+l.bearing&&(L=!0,x.bearing=+l.bearing),"pitch"in l&&x.pitch!==+l.pitch&&(j=!0,x.pitch=+l.pitch),l.padding==null||x.isPaddingEqual(l.padding)||(x.padding=l.padding),this._applyUpdatedTransform(x),this.fire(new s.k("movestart",p)).fire(new s.k("move",p)),B&&this.fire(new s.k("zoomstart",p)).fire(new s.k("zoom",p)).fire(new s.k("zoomend",p)),L&&this.fire(new s.k("rotatestart",p)).fire(new s.k("rotate",p)).fire(new s.k("rotateend",p)),j&&this.fire(new s.k("pitchstart",p)).fire(new s.k("pitch",p)).fire(new s.k("pitchend",p)),this.fire(new s.k("moveend",p))}calculateCameraOptionsFromTo(l,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const L=s.Y.fromLngLat(l,p),j=s.Y.fromLngLat(x,B),_=j.x-L.x,E=j.y-L.y,F=j.z-L.z,V=Math.hypot(_,E,F);if(V===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(_,E),K=this.transform.scaleZoom(this.transform.cameraToCenterDistance/V/this.transform.tileSize),te=180*Math.atan2(_,-E)/Math.PI;let se=180*Math.acos(q/V)/Math.PI;return se=F<0?90-se:90+se,{center:j.toLngLat(),zoom:K,pitch:se,bearing:te}}easeTo(l,p){var x;this._stop(!1,l.easeId),((l=s.e({offset:[0,0],duration:500,easing:s.b7},l)).animate===!1||!l.essential&&I.prefersReducedMotion)&&(l.duration=0);const B=this._getTransformForUpdate(),L=this.getZoom(),j=this.getBearing(),_=this.getPitch(),E=this.getPadding(),F="bearing"in l?this._normalizeBearing(l.bearing,j):j,V="pitch"in l?+l.pitch:_,q="padding"in l?l.padding:B.padding,K=s.P.convert(l.offset);let te=B.centerPoint.add(K);const se=B.pointLocation(te),{center:oe,zoom:le}=B.getConstrained(s.M.convert(l.center||se),(x=l.zoom)!==null&&x!==void 0?x:L);this._normalizeCenter(oe);const _e=B.project(se),Ie=B.project(oe).sub(_e),ve=B.zoomScale(le-L);let Se,et;l.around&&(Se=s.M.convert(l.around),et=B.locationPoint(Se));const Oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||le!==L,this._rotating=this._rotating||j!==F,this._pitching=this._pitching||V!==_,this._padding=!B.isPaddingEqual(q),this._easeId=l.easeId,this._prepareEase(p,l.noMoveStart,Oe),this.terrain&&this._prepareElevation(oe),this._ease(Re=>{if(this._zooming&&(B.zoom=s.z.number(L,le,Re)),this._rotating&&(B.bearing=s.z.number(j,F,Re)),this._pitching&&(B.pitch=s.z.number(_,V,Re)),this._padding&&(B.interpolatePadding(E,q,Re),te=B.centerPoint.add(K)),this.terrain&&!l.freezeElevation&&this._updateElevation(Re),Se)B.setLocationAtPoint(Se,et);else{const Ve=B.zoomScale(B.zoom-L),At=le>L?Math.min(2,ve):Math.max(.5,ve),dt=Math.pow(At,1-Re),ft=B.unproject(_e.add(Ie.mult(Re*dt)).mult(Ve));B.setLocationAtPoint(B.renderWorldCopies?ft.wrap():ft,te)}this._applyUpdatedTransform(B),this._fireMoveEvents(p)},Re=>{this.terrain&&this._finalizeElevation(),this._afterEase(p,Re)},l),this}_prepareEase(l,p){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,p||x.moving||this.fire(new s.k("movestart",l)),this._zooming&&!x.zooming&&this.fire(new s.k("zoomstart",l)),this._rotating&&!x.rotating&&this.fire(new s.k("rotatestart",l)),this._pitching&&!x.pitching&&this.fire(new s.k("pitchstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const p=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&p!==this._elevationTarget){const x=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(x-(p-(x*l+this._elevationStart))/(1-l)),this._elevationTarget=p}this.transform.elevation=s.z.number(this._elevationStart,this._elevationTarget,l)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(l){if(!this.transformCameraUpdate)return;const p=l.clone(),{center:x,zoom:B,pitch:L,bearing:j,elevation:_}=this.transformCameraUpdate(p);x&&(p.center=x),B!==void 0&&(p.zoom=B),L!==void 0&&(p.pitch=L),j!==void 0&&(p.bearing=j),_!==void 0&&(p.elevation=_),this.transform.apply(p)}_fireMoveEvents(l){this.fire(new s.k("move",l)),this._zooming&&this.fire(new s.k("zoom",l)),this._rotating&&this.fire(new s.k("rotate",l)),this._pitching&&this.fire(new s.k("pitch",l))}_afterEase(l,p){if(this._easeId&&p&&this._easeId===p)return;delete this._easeId;const x=this._zooming,B=this._rotating,L=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new s.k("zoomend",l)),B&&this.fire(new s.k("rotateend",l)),L&&this.fire(new s.k("pitchend",l)),this.fire(new s.k("moveend",l))}flyTo(l,p){var x;if(!l.essential&&I.prefersReducedMotion){const Pr=s.L(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Pr,p)}this.stop(),l=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.b7},l);const B=this._getTransformForUpdate(),L=this.getZoom(),j=this.getBearing(),_=this.getPitch(),E=this.getPadding(),F="bearing"in l?this._normalizeBearing(l.bearing,j):j,V="pitch"in l?+l.pitch:_,q="padding"in l?l.padding:B.padding,K=s.P.convert(l.offset);let te=B.centerPoint.add(K);const se=B.pointLocation(te),{center:oe,zoom:le}=B.getConstrained(s.M.convert(l.center||se),(x=l.zoom)!==null&&x!==void 0?x:L);this._normalizeCenter(oe);const _e=B.zoomScale(le-L),Ie=B.project(se),ve=B.project(oe).sub(Ie);let Se=l.curve;const et=Math.max(B.width,B.height),Oe=et/_e,Re=ve.mag();if("minZoom"in l){const Pr=s.ac(Math.min(l.minZoom,L,le),B.minZoom,B.maxZoom),yr=et/B.zoomScale(Pr-L);Se=Math.sqrt(yr/Re*2)}const Ve=Se*Se;function At(Pr){const yr=(Oe*Oe-et*et+(Pr?-1:1)*Ve*Ve*Re*Re)/(2*(Pr?Oe:et)*Ve*Re);return Math.log(Math.sqrt(yr*yr+1)-yr)}function dt(Pr){return(Math.exp(Pr)-Math.exp(-Pr))/2}function ft(Pr){return(Math.exp(Pr)+Math.exp(-Pr))/2}const Nt=At(!1);let It=function(Pr){return ft(Nt)/ft(Nt+Se*Pr)},jt=function(Pr){return et*((ft(Nt)*(dt(yr=Nt+Se*Pr)/ft(yr))-dt(Nt))/Ve)/Re;var yr},Ht=(At(!0)-Nt)/Se;if(Math.abs(Re)<1e-6||!isFinite(Ht)){if(Math.abs(et-Oe)<1e-6)return this.easeTo(l,p);const Pr=Oe<et?-1:1;Ht=Math.abs(Math.log(Oe/et))/Se,jt=function(){return 0},It=function(yr){return Math.exp(Pr*Se*yr)}}return l.duration="duration"in l?+l.duration:1e3*Ht/("screenSpeed"in l?+l.screenSpeed/Se:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=j!==F,this._pitching=V!==_,this._padding=!B.isPaddingEqual(q),this._prepareEase(p,!1),this.terrain&&this._prepareElevation(oe),this._ease(Pr=>{const yr=Pr*Ht,Ir=1/It(yr);B.zoom=Pr===1?le:L+B.scaleZoom(Ir),this._rotating&&(B.bearing=s.z.number(j,F,Pr)),this._pitching&&(B.pitch=s.z.number(_,V,Pr)),this._padding&&(B.interpolatePadding(E,q,Pr),te=B.centerPoint.add(K)),this.terrain&&!l.freezeElevation&&this._updateElevation(Pr);const hr=Pr===1?oe:B.unproject(Ie.add(ve.mult(jt(yr))).mult(Ir));B.setLocationAtPoint(B.renderWorldCopies?hr.wrap():hr,te),this._applyUpdatedTransform(B),this._fireMoveEvents(p)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(p)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,p)}if(!l){const x=this.handlers;x&&x.stop(!1)}return this}_ease(l,p,x){x.animate===!1||x.duration===0?(l(1),p()):(this._easeStart=I.now(),this._easeOptions=x,this._onEaseFrame=l,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,p){l=s.b1(l,-180,180);const x=Math.abs(l-p);return Math.abs(l-360-p)<x&&(l-=360),Math.abs(l+360-p)<x&&(l+=360),l}_normalizeCenter(l){const p=this.transform;if(!p.renderWorldCopies||p.lngRange)return;const x=l.lng-p.center.lng;l.lng+=x>180?-360:x<-180?360:0}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(s.M.convert(l),this.transform.tileZoom)-this.transform.elevation:null}}const Wn={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Wc{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Wn;this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=p=>{!p||p.sourceDataType!=="metadata"&&p.sourceDataType!=="visibility"&&p.dataType!=="style"&&p.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=R.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=R.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,p){const x=this._map._getUIString(`AttributionControl.${p}`);l.title=x,l.setAttribute("aria-label",x)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(B=>typeof B!="string"?"":B)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const B=this._map.style.stylesheet;this.styleOwner=B.owner,this.styleId=B.id}const p=this._map.style.sourceCaches;for(const B in p){const L=p[B];if(L.used||L.usedForTerrain){const j=L.getSource();j.attribution&&l.indexOf(j.attribution)<0&&l.push(j.attribution)}}l=l.filter(B=>String(B).trim()),l.sort((B,L)=>B.length-L.length),l=l.filter((B,L)=>{for(let j=L+1;j<l.length;j++)if(l[j].indexOf(B)>=0)return!1;return!0});const x=l.join(" | ");x!==this._attribHTML&&(this._attribHTML=x,l.length?(this._innerContainer.innerHTML=x,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Kr{constructor(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const p=this._container.children;if(p.length){const x=p[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&x.classList.add("maplibregl-compact"):x.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=R.create("div","maplibregl-ctrl");const p=R.create("a","maplibregl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://maplibre.org/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){R.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Qr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const p=++this._id;return this._queue.push({callback:l,id:p,cancelled:!1}),p}remove(l){const p=this._currentlyRunning,x=p?this._queue.concat(p):this._queue;for(const B of x)if(B.id===l)return void(B.cancelled=!0)}run(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const p=this._currentlyRunning=this._queue;this._queue=[];for(const x of p)if(!x.cancelled&&(x.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Xn=s.X([{name:"a_pos3d",type:"Int16",components:3}]);class ju extends s.E{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,p){this.sourceCache.update(l,p),this._renderableTilesKeys=[];const x={};for(const B of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:p}))x[B.key]=!0,this._renderableTilesKeys.push(B.key),this._tiles[B.key]||(B.posMatrix=new Float64Array(16),s.aN(B.posMatrix,0,s.W,0,s.W,0,1),this._tiles[B.key]=new Ar(B,this.tileSize));for(const B in this._tiles)x[B]||delete this._tiles[B]}freeRtt(l){for(const p in this._tiles){const x=this._tiles[p];(!l||x.tileID.equals(l)||x.tileID.isChildOf(l)||l.isChildOf(x.tileID))&&(x.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const p={};for(const x of this._renderableTilesKeys){const B=this._tiles[x].tileID;if(B.canonical.equals(l.canonical)){const L=l.clone();L.posMatrix=new Float64Array(16),s.aN(L.posMatrix,0,s.W,0,s.W,0,1),p[x]=L}else if(B.canonical.isChildOf(l.canonical)){const L=l.clone();L.posMatrix=new Float64Array(16);const j=B.canonical.z-l.canonical.z,_=B.canonical.x-(B.canonical.x>>j<<j),E=B.canonical.y-(B.canonical.y>>j<<j),F=s.W>>j;s.aN(L.posMatrix,0,F,0,F,0,1),s.H(L.posMatrix,L.posMatrix,[-_*F,-E*F,0]),p[x]=L}else if(l.canonical.isChildOf(B.canonical)){const L=l.clone();L.posMatrix=new Float64Array(16);const j=l.canonical.z-B.canonical.z,_=l.canonical.x-(l.canonical.x>>j<<j),E=l.canonical.y-(l.canonical.y>>j<<j),F=s.W>>j;s.aN(L.posMatrix,0,s.W,0,s.W,0,1),s.H(L.posMatrix,L.posMatrix,[_*F,E*F,0]),s.J(L.posMatrix,L.posMatrix,[1/2**j,1/2**j,0]),p[x]=L}}return p}getSourceTile(l,p){const x=this.sourceCache._source;let B=l.overscaledZ-this.deltaZoom;if(B>x.maxzoom&&(B=x.maxzoom),B<x.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(B).key);let L=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!L||!L.dem)&&p)for(;B>=x.minzoom&&(!L||!L.dem);)L=this.sourceCache.getTileByID(l.scaledTo(B--).key);return L}tilesAfterTime(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(p=>p.timeAdded>=l)}}class ko{constructor(l,p,x){this.painter=l,this.sourceCache=new ju(p),this.options=x,this.exaggeration=typeof x.exaggeration=="number"?x.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.W;var L;if(!(p>=0&&p<B&&x>=0&&x<B))return 0;const j=this.getTerrainData(l),_=(L=j.tile)===null||L===void 0?void 0:L.dem;if(!_)return 0;const E=function(se,oe,le){var _e=oe[0],Ie=oe[1];return se[0]=le[0]*_e+le[4]*Ie+le[12],se[1]=le[1]*_e+le[5]*Ie+le[13],se}([],[p/B*s.W,x/B*s.W],j.u_terrain_matrix),F=[E[0]*_.dim,E[1]*_.dim],V=Math.floor(F[0]),q=Math.floor(F[1]),K=F[0]-V,te=F[1]-q;return _.get(V,q)*(1-K)*(1-te)+_.get(V+1,q)*K*(1-te)+_.get(V,q+1)*(1-K)*te+_.get(V+1,q+1)*K*te}getElevationForLngLatZoom(l,p){const{tileID:x,mercatorX:B,mercatorY:L}=this._getOverscaledTileIDFromLngLatZoom(l,p);return this.getElevation(x,B%s.W,L%s.W,s.W)}getElevation(l,p,x){let B=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.W;return this.getDEMElevation(l,p,x,B)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const B=this.painter.context,L=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new De(B,L,B.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new De(B,new s.R({width:1,height:1}),B.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(B.gl.NEAREST,B.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.an([])}const p=this.sourceCache.getSourceTile(l,!0);if(p&&p.dem&&(!p.demTexture||p.needsTerrainPrepare)){const B=this.painter.context;p.demTexture=this.painter.getTileTexture(p.dem.stride),p.demTexture?p.demTexture.update(p.dem.getPixels(),{premultiply:!1}):p.demTexture=new De(B,p.dem.getPixels(),B.gl.RGBA,{premultiply:!1}),p.demTexture.bind(B.gl.NEAREST,B.gl.CLAMP_TO_EDGE),p.needsTerrainPrepare=!1}const x=p&&p+p.tileID.key+l.key;if(x&&!this._demMatrixCache[x]){const B=this.sourceCache.sourceCache._source.maxzoom;let L=l.canonical.z-p.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=B?L=l.canonical.z-B:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const j=l.canonical.x-(l.canonical.x>>L<<L),_=l.canonical.y-(l.canonical.y>>L<<L),E=s.b9(new Float64Array(16),[1/(s.W<<L),1/(s.W<<L),0]);s.H(E,E,[j*s.W,_*s.W,0]),this._demMatrixCache[l.key]={matrix:E,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:p&&p.dem&&p.dem.dim||1,u_terrain_matrix:x?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:p&&p.dem&&p.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(p&&p.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:p}}getFramebuffer(l){const p=this.painter,x=p.width/devicePixelRatio,B=p.height/devicePixelRatio;return!this._fbo||this._fbo.width===x&&this._fbo.height===B||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new De(p.context,{width:x,height:B,data:null},p.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(p.context.gl.NEAREST,p.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new De(p.context,{width:x,height:B,data:null},p.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(p.context.gl.NEAREST,p.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=p.context.createFramebuffer(x,B,!0,!1),this._fbo.depthAttachment.set(p.context.createRenderbuffer(p.context.gl.DEPTH_COMPONENT16,x,B))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const p=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let L=0,j=0;L<this._coordsTextureSize;L++)for(let _=0;_<this._coordsTextureSize;_++,j+=4)p[j+0]=255&_,p[j+1]=255&L,p[j+2]=_>>8<<4|L>>8,p[j+3]=0;const x=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(p.buffer)),B=new De(l,x,l.gl.RGBA,{premultiply:!1});return B.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=B,B}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const p=new Uint8Array(4),x=this.painter.context,B=x.gl;x.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),B.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,B.RGBA,B.UNSIGNED_BYTE,p),x.bindFramebuffer.set(null);const L=p[0]+(p[2]>>4<<8),j=p[1]+((15&p[2])<<8),_=this.coordsIndex[255-p[3]],E=_&&this.sourceCache.getTileByID(_);if(!E)return null;const F=this._coordsTextureSize,V=(1<<E.tileID.canonical.z)*F;return new s.Y((E.tileID.canonical.x*F+L)/V+E.tileID.wrap,(E.tileID.canonical.y*F+j)/V,this.getElevation(E.tileID,L,j,F))}depthAtPoint(l){const p=new Uint8Array(4),x=this.painter.context,B=x.gl;return x.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),B.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,B.RGBA,B.UNSIGNED_BYTE,p),x.bindFramebuffer.set(null),(p[0]/16777216+p[1]/65536+p[2]/256+p[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.painter.context,p=new s.ba,x=new s.aX,B=this.meshSize,L=s.W/B,j=B*B;for(let q=0;q<=B;q++)for(let K=0;K<=B;K++)p.emplaceBack(K*L,q*L,0);for(let q=0;q<j;q+=B+1)for(let K=0;K<B;K++)x.emplaceBack(K+q,B+K+q+1,B+K+q+2),x.emplaceBack(K+q,B+K+q+2,K+q+1);const _=p.length,E=_+2*(B+1);for(const q of[0,1])for(let K=0;K<=B;K++)for(const te of[0,1])p.emplaceBack(K*L,q*s.W,te);for(let q=0;q<2*B;q+=2)x.emplaceBack(E+q,E+q+1,E+q+3),x.emplaceBack(E+q,E+q+3,E+q+2),x.emplaceBack(_+q,_+q+3,_+q+1),x.emplaceBack(_+q,_+q+2,_+q+3);const F=p.length,V=F+2*(B+1);for(const q of[0,1])for(let K=0;K<=B;K++)for(const te of[0,1])p.emplaceBack(q*s.W,K*L,te);for(let q=0;q<2*B;q+=2)x.emplaceBack(F+q,F+q+1,F+q+3),x.emplaceBack(F+q,F+q+3,F+q+2),x.emplaceBack(V+q,V+q+3,V+q+1),x.emplaceBack(V+q,V+q+2,V+q+3);return this._mesh={indexBuffer:l.createIndexBuffer(x),vertexBuffer:l.createVertexBuffer(p,Xn.members),segments:s.$.simpleSegment(0,0,p.length,x.length)},this._mesh}getMeshFrameDelta(l){return 2*Math.PI*s.bb/Math.pow(2,l)/5}getMinTileElevationForLngLatZoom(l,p){var x;const{tileID:B}=this._getOverscaledTileIDFromLngLatZoom(l,p);return(x=this.getMinMaxElevation(B).minElevation)!==null&&x!==void 0?x:0}getMinMaxElevation(l){const p=this.getTerrainData(l).tile,x={minElevation:null,maxElevation:null};return p&&p.dem&&(x.minElevation=p.dem.min*this.exaggeration,x.maxElevation=p.dem.max*this.exaggeration),x}_getOverscaledTileIDFromLngLatZoom(l,p){const x=s.Y.fromLngLat(l.wrap()),B=(1<<p)*s.W,L=x.x*B,j=x.y*B,_=Math.floor(L/s.W),E=Math.floor(j/s.W);return{tileID:new s.Q(p,0,p,_,E),mercatorX:L,mercatorY:j}}}class sn{constructor(l,p,x){this._context=l,this._size=p,this._tileSize=x,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const p=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),x=new De(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return x.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),p.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),p.colorAttachment.set(x.texture),{id:l,fbo:p,texture:x,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(p=>l.id!==p),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const p of this._recentlyUsed)if(!this._objects[p].inUse)return this._objects[p];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const Ks={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Oo{constructor(l,p){this.painter=l,this.terrain=p,this.pool=new sn(l.context,30,p.sourceCache.tileSize*p.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,p){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(x=>!l._layers[x].isHidden(p)),this._coordsDescendingInv={};for(const x in l.sourceCaches){this._coordsDescendingInv[x]={};const B=l.sourceCaches[x].getVisibleCoordinates();for(const L of B){const j=this.terrain.sourceCache.getTerrainCoords(L);for(const _ in j)this._coordsDescendingInv[x][_]||(this._coordsDescendingInv[x][_]=[]),this._coordsDescendingInv[x][_].push(j[_])}}this._coordsDescendingInvStr={};for(const x of l._order){const B=l._layers[x],L=B.source;if(Ks[B.type]&&!this._coordsDescendingInvStr[L]){this._coordsDescendingInvStr[L]={};for(const j in this._coordsDescendingInv[L])this._coordsDescendingInvStr[L][j]=this._coordsDescendingInv[L][j].map(_=>_.key).sort().join()}}for(const x of this._renderableTiles)for(const B in this._coordsDescendingInvStr){const L=this._coordsDescendingInvStr[B][x.tileID.key];L&&L!==x.rttCoords[B]&&(x.rtt=[])}}renderLayer(l){if(l.isHidden(this.painter.transform.zoom))return!1;const p=l.type,x=this.painter,B=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(Ks[p]&&(this._prevType&&Ks[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(l.id),!B))return!0;if(Ks[this._prevType]||Ks[p]&&B){this._prevType=p;const L=this._stacks.length-1,j=this._stacks[L]||[];for(const _ of this._renderableTiles){if(this.pool.isFull()&&(ho(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(_),_.rtt[L]){const F=this.pool.getObjectForId(_.rtt[L].id);if(F.stamp===_.rtt[L].stamp){this.pool.useObject(F);continue}}const E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),_.rtt[L]={id:E.id,stamp:E.stamp},x.context.bindFramebuffer.set(E.fbo.framebuffer),x.context.clear({color:s.aO.transparent,stencil:0}),x.currentStencilSource=void 0;for(let F=0;F<j.length;F++){const V=x.style._layers[j[F]],q=V.source?this._coordsDescendingInv[V.source][_.tileID.key]:[_.tileID];x.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),x._renderTileClippingMasks(V,q),x.renderLayer(x,x.style.sourceCaches[V.source],V,q),V.source&&(_.rttCoords[V.source]=this._coordsDescendingInvStr[V.source][_.tileID.key])}}return ho(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ks[p]}return!1}}const _u={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ws=g,Yi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Wn,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Fn=w=>{w.touchstart=w.dragStart,w.touchmoveWindow=w.dragMove,w.touchend=w.dragEnd},ic={showCompass:!0,showZoom:!0,visualizePitch:!1};class nc{constructor(l,p){let x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=j=>{this.startMouse(s.e({},j,{ctrlKey:!0,preventDefault:()=>j.preventDefault()}),R.mousePos(this.element,j)),R.addEventListener(window,"mousemove",this.mousemove),R.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=j=>{this.moveMouse(j,R.mousePos(this.element,j))},this.mouseup=j=>{this.mouseRotate.dragEnd(j),this.mousePitch&&this.mousePitch.dragEnd(j),this.offTemp()},this.touchstart=j=>{j.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=R.touchPos(this.element,j.targetTouches)[0],this.startTouch(j,this._startPos),R.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.addEventListener(window,"touchend",this.touchend))},this.touchmove=j=>{j.targetTouches.length!==1?this.reset():(this._lastPos=R.touchPos(this.element,j.targetTouches)[0],this.moveTouch(j,this._lastPos))},this.touchend=j=>{j.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const B=l.dragRotate._mouseRotate.getClickTolerance(),L=l.dragRotate._mousePitch.getClickTolerance();this.element=p,this.mouseRotate=Mr({clickTolerance:B,enable:!0}),this.touchRotate=(j=>{let{enable:_,clickTolerance:E,bearingDegreesPerPixelMoved:F=.8}=j;const V=new yl;return new Nr({clickTolerance:E,move:(q,K)=>({bearingDelta:(K.x-q.x)*F}),moveStateManager:V,enable:_,assignEvents:Fn})})({clickTolerance:B,enable:!0}),this.map=l,x&&(this.mousePitch=Cc({clickTolerance:L,enable:!0}),this.touchPitch=(j=>{let{enable:_,clickTolerance:E,pitchDegreesPerPixelMoved:F=-.5}=j;const V=new yl;return new Nr({clickTolerance:E,move:(q,K)=>({pitchDelta:(K.y-q.y)*F}),moveStateManager:V,enable:_,assignEvents:Fn})})({clickTolerance:L,enable:!0})),R.addEventListener(p,"mousedown",this.mousedown),R.addEventListener(p,"touchstart",this.touchstart,{passive:!1}),R.addEventListener(p,"touchcancel",this.reset)}startMouse(l,p){this.mouseRotate.dragStart(l,p),this.mousePitch&&this.mousePitch.dragStart(l,p),R.disableDrag()}startTouch(l,p){this.touchRotate.dragStart(l,p),this.touchPitch&&this.touchPitch.dragStart(l,p),R.disableDrag()}moveMouse(l,p){const x=this.map,{bearingDelta:B}=this.mouseRotate.dragMove(l,p)||{};if(B&&x.setBearing(x.getBearing()+B),this.mousePitch){const{pitchDelta:L}=this.mousePitch.dragMove(l,p)||{};L&&x.setPitch(x.getPitch()+L)}}moveTouch(l,p){const x=this.map,{bearingDelta:B}=this.touchRotate.dragMove(l,p)||{};if(B&&x.setBearing(x.getBearing()+B),this.touchPitch){const{pitchDelta:L}=this.touchPitch.dragMove(l,p)||{};L&&x.setPitch(x.getPitch()+L)}}off(){const l=this.element;R.removeEventListener(l,"mousedown",this.mousedown),R.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend),R.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){R.enableDrag(),R.removeEventListener(window,"mousemove",this.mousemove),R.removeEventListener(window,"mouseup",this.mouseup),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend)}}let Uo;function Oa(w,l,p){const x=new s.M(w.lng,w.lat);if(w=new s.M(w.lng,w.lat),l){const B=new s.M(w.lng-360,w.lat),L=new s.M(w.lng+360,w.lat),j=p.locationPoint(w).distSqr(l);p.locationPoint(B).distSqr(l)<j?w=B:p.locationPoint(L).distSqr(l)<j&&(w=L)}for(;Math.abs(w.lng-p.center.lng)>180;){const B=p.locationPoint(w);if(B.x>=0&&B.y>=0&&B.x<=p.width&&B.y<=p.height)break;w.lng>p.center.lng?w.lng-=360:w.lng+=360}return w.lng!==x.lng&&p.locationPoint(w).y>p.height/2-p.getHorizon()?w:x}const sc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Xc(w,l,p){const x=w.classList;for(const B in sc)x.remove(`maplibregl-${p}-anchor-${B}`);x.add(`maplibregl-${p}-anchor-${l}`)}class No extends s.E{constructor(l){if(super(),this._onKeyPress=p=>{const x=p.code,B=p.charCode||p.keyCode;x!=="Space"&&x!=="Enter"&&B!==32&&B!==13||this.togglePopup()},this._onMapClick=p=>{const x=p.originalEvent.target,B=this._element;this._popup&&(x===B||B.contains(x))&&this.togglePopup()},this._update=p=>{var x;if(!this._map)return;const B=this._map.loaded()&&!this._map.isMoving();((p==null?void 0:p.type)==="terrain"||(p==null?void 0:p.type)==="render"&&!B)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Oa(this._lngLat,this._flatPos,this._map.transform):(x=this._lngLat)===null||x===void 0?void 0:x.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let L="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?L=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(L=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let j="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?j="rotateX(0deg)":this._pitchAlignment==="map"&&(j=`rotateX(${this._map.getPitch()}deg)`),p&&p.type!=="moveend"||(this._pos=this._pos.round()),R.setTransform(this._element,`${sc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${j} ${L}`),I.frameAsync(new AbortController).then(()=>{this._updateOpacity(p&&p.type==="moveend")}).catch(()=>{})},this._onMove=p=>{if(!this._isDragging){const x=this._clickTolerance||this._map._clickTolerance;this._isDragging=p.point.dist(this._pointerdownPos)>=x}this._isDragging&&(this._pos=p.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=p=>{this._element.contains(p.originalEvent.target)&&(p.preventDefault(),this._positionDelta=p.point.sub(this._pos).add(this._offset),this._pointerdownPos=p.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(l==null?void 0:l.opacity,l==null?void 0:l.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=s.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=R.create("div"),this._element.setAttribute("aria-label","Map marker");const p=R.createNS("http://www.w3.org/2000/svg","svg"),x=41,B=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${x}px`),p.setAttributeNS(null,"width",`${B}px`),p.setAttributeNS(null,"viewBox",`0 0 ${B} ${x}`);const L=R.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"stroke","none"),L.setAttributeNS(null,"stroke-width","1"),L.setAttributeNS(null,"fill","none"),L.setAttributeNS(null,"fill-rule","evenodd");const j=R.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"fill-rule","nonzero");const _=R.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(3.0, 29.0)"),_.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const _e of E){const Ie=R.createNS("http://www.w3.org/2000/svg","ellipse");Ie.setAttributeNS(null,"opacity","0.04"),Ie.setAttributeNS(null,"cx","10.5"),Ie.setAttributeNS(null,"cy","5.80029008"),Ie.setAttributeNS(null,"rx",_e.rx),Ie.setAttributeNS(null,"ry",_e.ry),_.appendChild(Ie)}const F=R.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const V=R.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(V);const q=R.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const K=R.createNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(K);const te=R.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"transform","translate(6.0, 7.0)"),te.setAttributeNS(null,"fill","#FFFFFF");const se=R.createNS("http://www.w3.org/2000/svg","g");se.setAttributeNS(null,"transform","translate(8.0, 8.0)");const oe=R.createNS("http://www.w3.org/2000/svg","circle");oe.setAttributeNS(null,"fill","#000000"),oe.setAttributeNS(null,"opacity","0.25"),oe.setAttributeNS(null,"cx","5.5"),oe.setAttributeNS(null,"cy","5.5"),oe.setAttributeNS(null,"r","5.4999962");const le=R.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#FFFFFF"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962"),se.appendChild(oe),se.appendChild(le),j.appendChild(_),j.appendChild(F),j.appendChild(q),j.appendChild(te),j.appendChild(se),p.appendChild(j),p.setAttributeNS(null,"height",x*this._scale+"px"),p.setAttributeNS(null,"width",B*this._scale+"px"),this._element.appendChild(p),this._offset=s.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),Xc(this._element,this._anchor,"marker"),l&&l.className)for(const p of l.className.split(" "))this._element.classList.add(p);this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),R.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.M.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const B=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[B,-1*(38.1-13.5+B)],"bottom-right":[-B,-1*(38.1-13.5+B)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;var p,x;if(!(!((p=this._map)===null||p===void 0)&&p.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const B=this._map,L=B.terrain.depthAtPoint(this._pos),j=B.terrain.getElevationForLngLatZoom(this._lngLat,B.transform.tileZoom);if(B.transform.lngLatToCameraDepth(this._lngLat,j)-L<.006)return void(this._element.style.opacity=this._opacity);const _=-this._offset.y/B.transform._pixelPerMeter,E=Math.sin(B.getPitch()*Math.PI/180)*_,F=B.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),V=B.transform.lngLatToCameraDepth(this._lngLat,j+E)-F>.006;!((x=this._popup)===null||x===void 0)&&x.isOpen()&&V&&this._popup.remove(),this._element.style.opacity=V?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=s.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,p){return l===void 0&&p===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),p!==void 0&&(this._opacityWhenCovered=p),this._map&&this._updateOpacity(!0),this}}const oc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let wa=0,Qi=!1;const N={maxWidth:100,unit:"metric"};function A(w,l,p){const x=p&&p.maxWidth||100,B=w._container.clientHeight/2,L=w.unproject([0,B]),j=w.unproject([x,B]),_=L.distanceTo(j);if(p&&p.unit==="imperial"){const E=3.2808*_;E>5280?b(l,x,E/5280,w._getUIString("ScaleControl.Miles")):b(l,x,E,w._getUIString("ScaleControl.Feet"))}else p&&p.unit==="nautical"?b(l,x,_/1852,w._getUIString("ScaleControl.NauticalMiles")):_>=1e3?b(l,x,_/1e3,w._getUIString("ScaleControl.Kilometers")):b(l,x,_,w._getUIString("ScaleControl.Meters"))}function b(w,l,p,x){const B=function(L){const j=Math.pow(10,`${Math.floor(L)}`.length-1);let _=L/j;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:_>=1?1:function(E){const F=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*F)/F}(_),j*_}(p);w.style.width=l*(B/p)+"px",w.innerHTML=`${B}&nbsp;${x}`}const M={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},O=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function z(w){if(w){if(typeof w=="number"){const l=Math.round(Math.abs(w)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,w),"top-left":new s.P(l,l),"top-right":new s.P(-l,l),bottom:new s.P(0,-w),"bottom-left":new s.P(l,-l),"bottom-right":new s.P(-l,-l),left:new s.P(w,0),right:new s.P(-w,0)}}if(w instanceof s.P||Array.isArray(w)){const l=s.P.convert(w);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:s.P.convert(w.center||[0,0]),top:s.P.convert(w.top||[0,0]),"top-left":s.P.convert(w["top-left"]||[0,0]),"top-right":s.P.convert(w["top-right"]||[0,0]),bottom:s.P.convert(w.bottom||[0,0]),"bottom-left":s.P.convert(w["bottom-left"]||[0,0]),"bottom-right":s.P.convert(w["bottom-right"]||[0,0]),left:s.P.convert(w.left||[0,0]),right:s.P.convert(w.right||[0,0])}}return z(new s.P(0,0))}const J=g;a.AJAXError=s.be,a.Evented=s.E,a.LngLat=s.M,a.MercatorCoordinate=s.Y,a.Point=s.P,a.addProtocol=s.bf,a.config=s.a,a.removeProtocol=s.bg,a.AttributionControl=Wc,a.BoxZoomHandler=zn,a.CanvasSource=ur,a.CooperativeGesturesHandler=oi,a.DoubleClickZoomHandler=yu,a.DragPanHandler=xa,a.DragRotateHandler=no,a.EdgeInsets=vo,a.FullscreenControl=class extends s.E{constructor(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{var l;let p=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=p==null?void 0:p.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)p=p.shadowRoot.fullscreenElement;p===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){R.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=R.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);R.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},a.GeoJSONSource=ht,a.GeolocateControl=class extends s.E{constructor(w){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const p=new s.M(l.coords.longitude,l.coords.latitude),x=l.coords.accuracy,B=this._map.getBearing(),L=s.e({bearing:B},this.options.fitBoundsOptions),j=kt.fromLngLat(p,x);this._map.fitBounds(j,L,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const p=new s.M(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(p).addTo(this._map),this._userLocationDotMarker.setLngLat(p).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&Qi)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=l=>{if(this._map){if(this._container.addEventListener("contextmenu",p=>p.preventDefault()),this._geolocateButton=R.create("button","maplibregl-ctrl-geolocate",this._container),R.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p)}else{const p=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new No({element:this._dotElement}),this._circleElement=R.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new No({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",p=>{p.geolocateSource||this._watchState!=="ACTIVE_LOCK"||p.originalEvent&&p.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},oc,w)}onAdd(w){return this._map=w,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return s._(this,arguments,void 0,function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return function*(){if(Uo!==void 0&&!l)return Uo;if(window.navigator.permissions===void 0)return Uo=!!window.navigator.geolocation,Uo;try{Uo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Uo=!!window.navigator.geolocation}return Uo}()})}().then(l=>this._setupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),R.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,wa=0,Qi=!1}_isOutOfMapMaxBounds(w){const l=this._map.getMaxBounds(),p=w.coords;return l&&(p.longitude<l.getWest()||p.longitude>l.getEast()||p.latitude<l.getSouth()||p.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const w=this._map.getBounds(),l=w.getSouthEast(),p=w.getNorthEast(),x=l.distanceTo(p),B=Math.ceil(this._accuracy/(x/this._map._container.clientHeight)*2);this._circleElement.style.width=`${B}px`,this._circleElement.style.height=`${B}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":wa--,Qi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),wa++,wa>1?(w={maximumAge:6e5,timeout:0},Qi=!0):(w=this.options.positionOptions,Qi=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},a.Hash=to,a.ImageSource=or,a.KeyboardHandler=vn,a.LngLatBounds=kt,a.LogoControl=Kr,a.Map=class extends uA{constructor(w){if(s.bc.mark(s.bd.create),(w=s.e({},Yi,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new sl(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),{bearingSnap:w.bearingSnap}),this._contextLost=l=>{l.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new Qr,this._controls=[],this._mapId=s.a3(),this._locale=s.e({},_u,w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this._imageQueueHandle=be.addThrottleControl(()=>this.isMoving()),this._requestManager=new qe(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const p=Do(x=>{this._trackResize&&!this._removed&&this.resize(x)._update()},50);this._resizeObserver=new ResizeObserver(x=>{l?p(x):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Us(this,w),this._hash=w.hash&&new to(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,s.e({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new Wc(typeof w.attributionControl=="boolean"?void 0:w.attributionControl)),w.maplibreLogo&&this.addControl(new Kr,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new s.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new s.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new s.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(w,l){if(l===void 0&&(l=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=w.onAdd(this);this._controls.push(w);const x=this._controlPositions[l];return l.indexOf("bottom")!==-1?x.insertBefore(p,x.firstChild):x.appendChild(p),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(w);return l>-1&&this._controls.splice(l,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}calculateCameraOptionsFromTo(w,l,p,x){return x==null&&this.terrain&&(x=this.terrain.getElevationForLngLatZoom(p,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,l,p,x)}resize(w){var l;const p=this._containerDimensions(),x=p[0],B=p[1],L=this._getClampedPixelRatio(x,B);if(this._resizeCanvas(x,B,L),this.painter.resize(x,B,L),this.painter.overLimit()){const _=this.painter.context.gl;this._maxCanvasSize=[_.drawingBufferWidth,_.drawingBufferHeight];const E=this._getClampedPixelRatio(x,B);this._resizeCanvas(x,B,E),this.painter.resize(x,B,E)}this.transform.resize(x,B),(l=this._requestedCameraState)===null||l===void 0||l.resize(x,B);const j=!this._moving;return j&&(this.stop(),this.fire(new s.k("movestart",w)).fire(new s.k("move",w))),this.fire(new s.k("resize",w)),j&&this.fire(new s.k("moveend",w)),this}_getClampedPixelRatio(w,l){const{0:p,1:x}=this._maxCanvasSize,B=this.getPixelRatio(),L=w*B,j=l*B;return Math.min(L>p?p/L:1,j>x?x/j:1)*B}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(kt.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this._update()}project(w){return this.transform.locationPoint(s.M.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.pointLocation(s.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,l,p){if(w==="mouseenter"||w==="mouseover"){let x=!1;return{layer:l,listener:p,delegates:{mousemove:L=>{const j=this.getLayer(l)?this.queryRenderedFeatures(L.point,{layers:[l]}):[];j.length?x||(x=!0,p.call(this,new ln(w,this,L.originalEvent,{features:j}))):x=!1},mouseout:()=>{x=!1}}}}if(w==="mouseleave"||w==="mouseout"){let x=!1;return{layer:l,listener:p,delegates:{mousemove:j=>{(this.getLayer(l)?this.queryRenderedFeatures(j.point,{layers:[l]}):[]).length?x=!0:x&&(x=!1,p.call(this,new ln(w,this,j.originalEvent)))},mouseout:j=>{x&&(x=!1,p.call(this,new ln(w,this,j.originalEvent)))}}}}{const x=B=>{const L=this.getLayer(l)?this.queryRenderedFeatures(B.point,{layers:[l]}):[];L.length&&(B.features=L,p.call(this,B),delete B.features)};return{layer:l,listener:p,delegates:{[w]:x}}}}on(w,l,p){if(p===void 0)return super.on(w,l);const x=this._createDelegatedListener(w,l,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(x);for(const B in x.delegates)this.on(B,x.delegates[B]);return this}once(w,l,p){if(p===void 0)return super.once(w,l);const x=this._createDelegatedListener(w,l,p);for(const B in x.delegates)this.once(B,x.delegates[B]);return this}off(w,l,p){return p===void 0?super.off(w,l):(this._delegatedListeners&&this._delegatedListeners[w]&&(x=>{const B=this._delegatedListeners[w];for(let L=0;L<B.length;L++){const j=B[L];if(j.layer===l&&j.listener===p){for(const _ in j.delegates)this.off(_,j.delegates[_]);return B.splice(L,1),this}}})(),this)}queryRenderedFeatures(w,l){if(!this.style)return[];let p;const x=w instanceof s.P||Array.isArray(w),B=x?w:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(x?{}:w)||{},B instanceof s.P||typeof B[0]=="number")p=[s.P.convert(B)];else{const L=s.P.convert(B[0]),j=s.P.convert(B[1]);p=[L,new s.P(j.x,L.y),j,new s.P(L.x,j.y),L]}return this.style.queryRenderedFeatures(p,l,this.transform)}querySourceFeatures(w,l){return this.style.querySourceFeatures(w,l)}setStyle(w,l){return(l=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(w,l))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const l=this._locale[w];if(l==null)throw new Error(`Missing UI string '${w}'`);return l}_updateStyle(w,l){if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(w,l));const p=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new ji(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,l,p):this.style.loadJSON(w,l,p),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ji(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,l){if(typeof w=="string"){const p=this._requestManager.transformRequest(w,Te.Style);s.h(p,new AbortController).then(x=>{this._updateDiff(x.data,l)}).catch(x=>{x&&this.fire(new s.j(x))})}else typeof w=="object"&&this._updateDiff(w,l)}_updateDiff(w,l){try{this.style.setState(w,l)&&this._update(!0)}catch(p){s.w(`Unable to perform style diff: ${p.message||p.error||p}.  Rebuilding the style from scratch.`),this._updateStyle(w,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(w,l){return this._lazyInitEmptyStyle(),this.style.addSource(w,l),this._update(!0)}isSourceLoaded(w){const l=this.style&&this.style.sourceCaches[w];if(l!==void 0)return l.loaded();this.fire(new s.j(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const l=this.style.sourceCaches[w.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);this.terrain===null&&l.reload();for(const p in this.style._layers){const x=this.style._layers[p];x.type==="hillshade"&&x.source===w.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ko(this.painter,l,w),this.painter.renderToTexture=new Oo(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=p=>{p.dataType==="style"?this.terrain.sourceCache.freeRtt():p.dataType==="source"&&p.tile&&(p.sourceId!==w.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(p.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:w})),this}getTerrain(){var w,l;return(l=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const l in w){const p=w[l]._tiles;for(const x in p){const B=p[x];if(B.state!=="loaded"&&B.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,l){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:x=1,sdf:B=!1,stretchX:L,stretchY:j,content:_}=p;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||s.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:F,data:V}=l,q=l;return this.style.addImage(w,{data:new s.R({width:E,height:F},new Uint8Array(V)),pixelRatio:x,stretchX:L,stretchY:j,content:_,sdf:B,version:0,userImage:q}),q.onAdd&&q.onAdd(this,w),this}}{const{width:E,height:F,data:V}=I.getImageData(l);this.style.addImage(w,{data:new s.R({width:E,height:F},V),pixelRatio:x,stretchX:L,stretchY:j,content:_,sdf:B,version:0})}}updateImage(w,l){const p=this.style.getImage(w);if(!p)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=l instanceof HTMLImageElement||s.b(l)?I.getImageData(l):l,{width:B,height:L,data:j}=x;if(B===void 0||L===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(B!==p.data.width||L!==p.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const _=!(l instanceof HTMLImageElement||s.b(l));return p.data.replace(j,_),this.style.updateImage(w,p),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return be.getImage(this._requestManager.transformRequest(w,Te.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,l){return this._lazyInitEmptyStyle(),this.style.addLayer(w,l),this._update(!0)}moveLayer(w,l){return this.style.moveLayer(w,l),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,l,p){return this.style.setLayerZoomRange(w,l,p),this._update(!0)}setFilter(w,l){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(w,l,p),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,l,p){let x=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(w,l,p,x),this._update(!0)}getPaintProperty(w,l){return this.style.getPaintProperty(w,l)}setLayoutProperty(w,l,p){let x=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(w,l,p,x),this._update(!0)}getLayoutProperty(w,l){return this.style.getLayoutProperty(w,l)}setGlyphs(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,l){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(w,l,p,x=>{x||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(w,l,p=>{p||this._update(!0)}),this}setLight(w){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(w,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(w,l){return this.style.setFeatureState(w,l),this._update()}removeFeatureState(w,l){return this.style.removeFeatureState(w,l),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,l=0;return this._container&&(w=this._container.clientWidth||400,l=this._container.clientHeight||300),[w,l]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const l=this._canvasContainer=R.create("div","maplibregl-canvas-container",w);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=R.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const p=this._containerDimensions(),x=this._getClampedPixelRatio(p[0],p[1]);this._resizeCanvas(p[0],p[1],x);const B=this._controlContainer=R.create("div","maplibregl-control-container",w),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(j=>{L[j]=R.create("div",`maplibregl-ctrl-${j} `,B)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,l,p){this._canvas.width=Math.floor(p*w),this._canvas.height=Math.floor(p*l),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const w={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let l=null;this._canvas.addEventListener("webglcontextcreationerror",x=>{l={requestedAttributes:w},x&&(l.statusMessage=x.statusMessage,l.type=x.type)},{once:!0});const p=this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w);if(!p){const x="Failed to initialize WebGL";throw l?(l.message=x,new Error(JSON.stringify(l))):new Error(x)}this.painter=new vs(p,this.transform),U.testSupport(p)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){const l=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let p=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const B=this.transform.zoom,L=I.now();this.style.zoomHistory.update(B,L);const j=new s.a8(B,{now:L,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_=j.crossFadingFactor();_===1&&_===this._crossFadingFactor||(p=!0,this._crossFadingFactor=_),this.style.update(j)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bc.mark(s.bd.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||p)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const x=this._sourcesDirty||this._styleDirty||this._placementDirty;return x||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||x||(this._fullyLoaded=!0,s.bc.mark(s.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const p of this._controls)p.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),be.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),R.remove(this._canvasContainer),R.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),s.bc.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,I.frameAsync(this._frameRequest).then(w=>{s.bc.frame(w),this._frameRequest=null,this._render(w)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return Ws}getCameraTargetElevation(){return this.transform.elevation}},a.MapMouseEvent=ln,a.MapTouchEvent=Kn,a.MapWheelEvent=ls,a.Marker=No,a.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const l=this._map.getZoom(),p=l===this._map.getMaxZoom(),x=l===this._map.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=x,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",x.toString())},this._rotateCompassArrow=()=>{const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l},this._setButtonTitle=(l,p)=>{const x=this._map._getUIString(`NavigationControl.${p}`);l.title=x,l.setAttribute("aria-label",x)},this.options=s.e({},ic,w),this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),R.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),R.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=R.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new nc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){R.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,l){const p=R.create("button",w,this._container);return p.type="button",p.addEventListener("click",l),p}},a.Popup=class extends s.E{constructor(w){super(),this.remove=()=>(this._content&&R.remove(this._content),this._container&&(R.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.k("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{var p;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=R.create("div","maplibregl-popup",this._map.getContainer()),this._tip=R.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const _ of this.options.className.split(" "))this._container.classList.add(_);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Oa(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._trackPointer&&!l)return;const x=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationPoint(this._lngLat));let B=this.options.anchor;const L=z(this.options.offset);if(!B){const _=this._container.offsetWidth,E=this._container.offsetHeight;let F;F=x.y+L.bottom.y<E?["top"]:x.y>this._map.transform.height-E?["bottom"]:[],x.x<_/2?F.push("left"):x.x>this._map.transform.width-_/2&&F.push("right"),B=F.length===0?"bottom":F.join("-")}let j=x.add(L[B]);this.options.subpixelPositioning||(j=j.round()),R.setTransform(this._container,`${sc[B]} translate(${j.x}px,${j.y}px)`),Xc(this._container,B,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(M),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=s.M.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const l=document.createDocumentFragment(),p=document.createElement("body");let x;for(p.innerHTML=w;x=p.firstChild,x;)l.appendChild(x);return this.setDOMContent(l)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=R.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){this._container&&this._container.classList.add(w)}removeClassName(w){this._container&&this._container.classList.remove(w)}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}_createCloseButton(){this.options.closeButton&&(this._closeButton=R.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(O);w&&w.focus()}},a.RasterDEMTileSource=tr,a.RasterTileSource=Ur,a.ScaleControl=class{constructor(w){this._onMove=()=>{A(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,A(this._map,this._container,this.options)},this.options=s.e({},N,w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){R.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},a.ScrollZoomHandler=vl,a.Style=ji,a.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=R.create("button","maplibregl-ctrl-terrain",this._container),R.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){R.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},a.TwoFingersTouchPitchHandler=qc,a.TwoFingersTouchRotateHandler=jc,a.TwoFingersTouchZoomHandler=ec,a.TwoFingersTouchZoomRotateHandler=Sr,a.VectorTileSource=wt,a.VideoSource=mr,a.addSourceType=(w,l)=>s._(void 0,void 0,void 0,function*(){if(ri(w))throw new Error(`A source type called "${w}" already exists.`);((p,x)=>{Wr[p]=x})(w,l)}),a.clearPrewarmedResources=function(){const w=mt;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(Ze),mt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},a.getRTLTextPluginStatus=function(){return Xr().getRTLTextPluginStatus()},a.getVersion=function(){return J},a.getWorkerCount=function(){return rt.workerCount},a.getWorkerUrl=function(){return s.a.WORKER_URL},a.importScriptInWorkers=function(w){return qt().broadcast("importScript",w)},a.prewarm=function(){Dt().acquire(Ze)},a.setMaxParallelImageRequests=function(w){s.a.MAX_PARALLEL_IMAGE_REQUESTS=w},a.setRTLTextPlugin=function(w,l){return Xr().setRTLTextPlugin(w,l)},a.setWorkerCount=function(w){rt.workerCount=w},a.setWorkerUrl=function(w){s.a.WORKER_URL=w}});var o=t;return o})})(C5);var Rz=C5.exports;const Va=Wm(Rz);var Ha;(function(r){r[r.Unknown=0]="Unknown",r[r.Point=1]="Point",r[r.LineString=2]="LineString",r[r.Polygon=3]="Polygon",r[r.MultiPoint=4]="MultiPoint",r[r.MultiLineString=5]="MultiLineString",r[r.MultiPolygon=6]="MultiPolygon",r[r.GeometryCollection=7]="GeometryCollection",r[r.CircularString=8]="CircularString",r[r.CompoundCurve=9]="CompoundCurve",r[r.CurvePolygon=10]="CurvePolygon",r[r.MultiCurve=11]="MultiCurve",r[r.MultiSurface=12]="MultiSurface",r[r.Curve=13]="Curve",r[r.Surface=14]="Surface",r[r.PolyhedralSurface=15]="PolyhedralSurface",r[r.TIN=16]="TIN",r[r.Triangle=17]="Triangle"})(Ha||(Ha={}));const Xm=4,Zm=4,Jm=4,ad=new Int32Array(2),E5=new Float32Array(ad.buffer),S5=new Float64Array(ad.buffer),G_=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var ww;(function(r){r[r.UTF8_BYTES=1]="UTF8_BYTES",r[r.UTF16_STRING=2]="UTF16_STRING"})(ww||(ww={}));class wA{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new wA(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return ad[0]=this.readInt32(e),E5[0]}readFloat64(e){return ad[G_?0:1]=this.readInt32(e),ad[G_?1:0]=this.readInt32(e+4),S5[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){E5[0]=t,this.writeInt32(e,ad[0])}writeFloat64(e,t){S5[0]=t,this.writeInt32(e,ad[G_?0:1]),this.writeInt32(e+4,ad[G_?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Xm+Zm)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<Zm;t++)e+=String.fromCharCode(this.readInt8(this.position_+Xm+t));return e}__offset(e,t){const i=e-this.readInt32(e);return t<this.readInt16(i)?this.readInt16(i+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const i=this.readInt32(e);e+=Xm;const n=this.bytes_.subarray(e,e+i);return t===ww.UTF8_BYTES?n:this.text_decoder_.decode(n)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Xm}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Zm)throw new Error("FlatBuffers: file identifier must be length "+Zm);for(let t=0;t<Zm;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+Xm+t))return!1;return!0}createScalarList(e,t){const i=[];for(let n=0;n<t;++n){const o=e(n);o!==null&&i.push(o)}return i}createObjList(e,t){const i=[];for(let n=0;n<t;++n){const o=e(n);o!==null&&i.push(o.unpack())}return i}}let kz=class tu{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new tu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+Jm),(t||new tu).__init(e.readInt32(e.position())+e.position(),e)}ends(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+e*4):0}endsLength(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){const e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}xyLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}zLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){const e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}mLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){const e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}tLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){const e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+e*8):BigInt(0)}tmLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):Ha.Unknown}parts(e,t){const i=this.bb.__offset(this.bb_pos,18);return i?(t||new tu).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}partsLength(){const e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addInt32(t[i]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let i=t.length-1;i>=0;i--)e.addFloat64(t[i]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let i=t.length-1;i>=0;i--)e.addFloat64(t[i]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let i=t.length-1;i>=0;i--)e.addFloat64(t[i]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let i=t.length-1;i>=0;i--)e.addFloat64(t[i]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let i=t.length-1;i>=0;i--)e.addInt64(t[i]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,Ha.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,i,n,o,a,s,g,y){return tu.startGeometry(e),tu.addEnds(e,t),tu.addXy(e,i),tu.addZ(e,n),tu.addM(e,o),tu.addT(e,a),tu.addTm(e,s),tu.addType(e,g),tu.addParts(e,y),tu.endGeometry(e)}};function Bw(r,e){const t=[];for(let i=0;i<r.length;i+=2){const n=[r[i],r[i+1]];e&&n.push(e[i>>1]),t.push(n)}return t}function T5(r,e,t){if(!t||t.length===0)return[Bw(r,e)];let i=0;const n=Array.from(t).map(a=>r.slice(i,i=a<<1));let o;return e&&(i=0,o=Array.from(t).map(a=>e.slice(i,i=a))),n.map((a,s)=>Bw(a,o?o[s]:void 0))}function Oz(r,e){const t=r.xyArray(),i=r.zArray();switch(e){case Ha.Point:{const n=Array.from(t);return i&&n.push(i[0]),n}case Ha.MultiPoint:case Ha.LineString:return Bw(t,i);case Ha.MultiLineString:return T5(t,i,r.endsArray());case Ha.Polygon:return T5(t,i,r.endsArray())}}function Cw(r,e){let t=e;if(t===Ha.Unknown&&(t=r.type()),t===Ha.GeometryCollection){const n=[];for(let o=0;o<r.partsLength();o++){const a=r.parts(o),s=a.type();n.push(Cw(a,s))}return{type:Ha[t],geometries:n}}else if(t===Ha.MultiPolygon){const n=[];for(let o=0;o<r.partsLength();o++)n.push(Cw(r.parts(o),Ha.Polygon));return{type:Ha[t],coordinates:n.map(o=>o.coordinates)}}const i=Oz(r,t);return{type:Ha[t],coordinates:i}}var Ga;(function(r){r[r.Byte=0]="Byte",r[r.UByte=1]="UByte",r[r.Bool=2]="Bool",r[r.Short=3]="Short",r[r.UShort=4]="UShort",r[r.Int=5]="Int",r[r.UInt=6]="UInt",r[r.Long=7]="Long",r[r.ULong=8]="ULong",r[r.Float=9]="Float",r[r.Double=10]="Double",r[r.String=11]="String",r[r.Json=12]="Json",r[r.DateTime=13]="DateTime",r[r.Binary=14]="Binary"})(Ga||(Ga={}));class ja{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new ja).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+Jm),(t||new ja).__init(e.readInt32(e.position())+e.position(),e)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):Ga.Byte}title(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){const e=this.bb.__offset(this.bb_pos,18);return e?!!this.bb.readInt8(this.bb_pos+e):!0}unique(){const e=this.bb.__offset(this.bb_pos,20);return e?!!this.bb.readInt8(this.bb_pos+e):!1}primaryKey(){const e=this.bb.__offset(this.bb_pos,22);return e?!!this.bb.readInt8(this.bb_pos+e):!1}metadata(e){const t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,Ga.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){const t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,i,n,o,a,s,g,y,T,I,R){return ja.startColumn(e),ja.addName(e,t),ja.addType(e,i),ja.addTitle(e,n),ja.addDescription(e,o),ja.addWidth(e,a),ja.addPrecision(e,s),ja.addScale(e,g),ja.addNullable(e,y),ja.addUnique(e,T),ja.addPrimaryKey(e,I),ja.addMetadata(e,R),ja.endColumn(e)}}class rh{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new rh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+Jm),(t||new rh).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){const t=this.bb.__offset(this.bb_pos,4);return t?(e||new kz).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){const i=this.bb.__offset(this.bb_pos,8);return i?(t||new ja).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}columnsLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let i=t.length-1;i>=0;i--)e.addInt8(t[i]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,i,n){return rh.startFeature(e),rh.addGeometry(e,t),rh.addProperties(e,i),rh.addColumns(e,n),rh.endFeature(e)}}new TextEncoder;const I5=new TextDecoder;function Uz(r,e){const t={};if(!e||e.length===0)return t;const i=r.propertiesArray();if(!i)return t;const n=new DataView(i.buffer,i.byteOffset),o=r.propertiesLength();let a=0;for(;a<o;){const s=n.getUint16(a,!0);a+=2;const g=e[s],y=g.name;switch(g.type){case Ga.Bool:{t[y]=!!n.getUint8(a),a+=1;break}case Ga.Byte:{t[y]=n.getInt8(a),a+=1;break}case Ga.UByte:{t[y]=n.getUint8(a),a+=1;break}case Ga.Short:{t[y]=n.getInt16(a,!0),a+=2;break}case Ga.UShort:{t[y]=n.getUint16(a,!0),a+=2;break}case Ga.Int:{t[y]=n.getInt32(a,!0),a+=4;break}case Ga.UInt:{t[y]=n.getUint32(a,!0),a+=4;break}case Ga.Long:{t[y]=Number(n.getBigInt64(a,!0)),a+=8;break}case Ga.ULong:{t[y]=Number(n.getBigUint64(a,!0)),a+=8;break}case Ga.Float:{t[y]=n.getFloat32(a,!0),a+=4;break}case Ga.Double:{t[y]=n.getFloat64(a,!0),a+=8;break}case Ga.DateTime:case Ga.String:{const T=n.getUint32(a,!0);a+=4,t[y]=I5.decode(i.subarray(a,a+T)),a+=T;break}case Ga.Json:{const T=n.getUint32(a,!0);a+=4;const I=I5.decode(i.subarray(a,a+T));t[y]=JSON.parse(I),a+=T;break}default:throw new Error("Unknown type "+g.type)}}return t}function Ew(r,e){const t=e.columns;return{type:"Feature",geometry:Cw(r.geometry(),e.geometryType),properties:Uz(r,t)}}const Sw=new Uint8Array(0);function Nz(){return this._source.cancel()}function zz(r,e){if(!r.length)return e;if(!e.length)return r;var t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function Qz(){var r=this,e=r._array.subarray(r._index);return r._source.read().then(function(t){return r._array=Sw,r._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:zz(e,t.value)}})}function Vz(r){if((r|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+r<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=r));var i=new Uint8Array(r);return i.set(this._array.subarray(this._index)),function n(){return e._source.read().then(function(o){return o.done?(e._array=Sw,e._index=0,t>0?i.subarray(0,t):null):t+o.value.length>=r?(e._array=o.value,e._index=r-t,i.set(o.value.subarray(0,r-t),t),i):(i.set(o.value,t),t+=o.value.length,n())})}()}function Hz(r){return typeof r.slice=="function"?r:new j_(typeof r.read=="function"?r:r.getReader())}function j_(r){this._source=r,this._array=Sw,this._index=0}j_.prototype.read=Qz,j_.prototype.slice=Vz,j_.prototype.cancel=Nz;class Su{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new Su).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+Jm),(t||new Su).__init(e.readInt32(e.position())+e.position(),e)}org(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,i,n,o,a,s){return Su.startCrs(e),Su.addOrg(e,t),Su.addCode(e,i),Su.addName(e,n),Su.addDescription(e,o),Su.addWkt(e,a),Su.addCodeString(e,s),Su.endCrs(e)}}class q_{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new q_).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+Jm),(t||new q_).__init(e.readInt32(e.position())+e.position(),e)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+e*8):0}envelopeLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):Ha.Unknown}hasZ(){const e=this.bb.__offset(this.bb_pos,10);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasM(){const e=this.bb.__offset(this.bb_pos,12);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasT(){const e=this.bb.__offset(this.bb_pos,14);return e?!!this.bb.readInt8(this.bb_pos+e):!1}hasTm(){const e=this.bb.__offset(this.bb_pos,16);return e?!!this.bb.readInt8(this.bb_pos+e):!1}columns(e,t){const i=this.bb.__offset(this.bb_pos,18);return i?(t||new ja).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}columnsLength(){const e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){const e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){const e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){const t=this.bb.__offset(this.bb_pos,24);return t?(e||new Su).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){const t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){const t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){const t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let i=t.length-1;i>=0;i--)e.addFloat64(t[i]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,Ha.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function Tw(r){const e=q_.getRootAsHeader(r),t=e.featuresCount(),i=e.indexNodeSize(),n=[];for(let g=0;g<e.columnsLength();g++){const y=e.columns(g);if(!y)throw new Error("Column unexpectedly missing");if(!y.name())throw new Error("Column name unexpectedly missing");n.push({name:y.name(),type:y.type(),title:y.title(),description:y.description(),width:y.width(),precision:y.precision(),scale:y.scale(),nullable:y.nullable(),unique:y.unique(),primary_key:y.primaryKey()})}const o=e.crs(),a=o?{org:o.org(),code:o.code(),name:o.name(),description:o.description(),wkt:o.wkt(),code_string:o.codeString()}:null;return{geometryType:e.geometryType(),columns:n,envelope:null,featuresCount:Number(t),indexNodeSize:i,crs:a,title:e.title(),description:e.description(),metadata:e.metadata()}}/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Iw=function(r,e){return Iw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])},Iw(r,e)};function Gz(r,e){Iw(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Xp(r,e,t,i){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(T){try{y(i.next(T))}catch(I){a(I)}}function g(T){try{y(i.throw(T))}catch(I){a(I)}}function y(T){T.done?o(T.value):n(T.value).then(s,g)}y((i=i.apply(r,e||[])).next())})}function ld(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,n,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(y){return function(T){return g([y,T])}}function g(y){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(o=y[0]&2?n.return:y[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,y[1])).done)return o;switch(n=0,o&&(y=[y[0]&2,o.value]),y[0]){case 0:case 1:o=y;break;case 4:return t.label++,{value:y[1],done:!1};case 5:t.label++,n=y[1],y=[0];continue;case 7:y=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(y[0]===6||y[0]===2)){t=0;continue}if(y[0]===3&&(!o||y[1]>o[0]&&y[1]<o[3])){t.label=y[1];break}if(y[0]===6&&t.label<o[1]){t.label=o[1],o=y;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(y);break}o[2]&&t.ops.pop(),t.trys.pop();continue}y=e.call(r,t)}catch(T){y=[6,T],n=0}finally{i=o=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function Zp(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ym(r){return this instanceof Ym?(this.v=r,this):new Ym(r)}function jz(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),n,o=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(R){i[R]&&(n[R]=function(U){return new Promise(function(Z,Y){o.push([R,U,Z,Y])>1||s(R,U)})})}function s(R,U){try{g(i[R](U))}catch(Z){I(o[0][3],Z)}}function g(R){R.value instanceof Ym?Promise.resolve(R.value.v).then(y,T):I(o[0][2],R)}function y(R){s("next",R)}function T(R){s("throw",R)}function I(R,U){R(U),o.shift(),o.length&&s(o[0][0],o[0][1])}}var L5=function(r){Gz(e,r);function e(t){var i=r.call(this,t)||this;return Object.defineProperty(i,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(i,i.constructor.prototype):i.__proto__=i.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(i,i.constructor),i}return e}(Error);(function(){function r(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),r.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})(),function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r}(),function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r}();function Lw(r){r!=null&&typeof r.then=="function"&&r.then(W_,W_)}var Mw=0,M5=1,yf=2,$_=3,Pw=4,K_=1024,W_=function(){};function Jp(r){var e=r.err,t=Promise.resolve(r.execution).then(function(i){if(e!=null)throw e;return i});return r.err=void 0,r.execution=t.then(function(){},function(){}),r.pending===void 0?t:r.pending.then(function(){return t})}function _f(r,e){var t=r.state>=$_;return Promise.resolve(e).then(function(i){return!t&&r.state>=Pw?Jp(r).then(function(n){return{value:n,done:!0}}):{value:i,done:t}})}function Fw(r,e){var t,i;if(!(r.state>=yf))if(r.state=yf,r.onnext(),r.onstop(),r.err==null&&(r.err=e),r.pushes.length===0&&(typeof r.buffer>"u"||r.buffer.empty))ey(r);else try{for(var n=Zp(r.pushes),o=n.next();!o.done;o=n.next()){var a=o.value;a.resolve()}}catch(s){t={error:s}}finally{try{o&&!o.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}}function ey(r){var e,t;if(!(r.state>=$_)){r.state<yf&&Fw(r),r.state=$_,r.buffer=void 0;try{for(var i=Zp(r.nexts),n=i.next();!n.done;n=i.next()){var o=n.value,a=r.pending===void 0?Jp(r):r.pending.then(function(){return Jp(r)});o.resolve(_f(r,a))}}catch(s){e={error:s}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}r.pushes=[],r.nexts=[]}}function P5(r){r.state>=Pw||(r.state<$_&&ey(r),r.state=Pw)}function qz(r,e){if(Lw(e),r.pushes.length>=K_)throw new L5("No more than "+K_+" pending calls to push are allowed on a single repeater.");if(r.state>=yf)return Promise.resolve(void 0);var t=r.pending===void 0?Promise.resolve(e):r.pending.then(function(){return e});t=t.catch(function(g){r.state<yf&&(r.err=g),P5(r)});var i;if(r.nexts.length){var n=r.nexts.shift();n.resolve(_f(r,t)),r.nexts.length?i=Promise.resolve(r.nexts[0].value):i=new Promise(function(g){return r.onnext=g})}else typeof r.buffer<"u"&&!r.buffer.full?(r.buffer.add(t),i=Promise.resolve(void 0)):i=new Promise(function(g){return r.pushes.push({resolve:g,value:t})});var o=!0,a={},s=i.catch(function(g){if(o)throw g});return a.then=function(g,y){return o=!1,Promise.prototype.then.call(i,g,y)},a.catch=function(g){return o=!1,Promise.prototype.catch.call(i,g)},a.finally=i.finally.bind(i),r.pending=t.then(function(){return s}).catch(function(g){r.err=g,P5(r)}),a}function $z(r){var e=Fw.bind(null,r),t=new Promise(function(i){return r.onstop=i});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function Kz(r){if(!(r.state>=M5)){r.state=M5;var e=qz.bind(null,r),t=$z(r);r.execution=new Promise(function(i){return i(r.executor(e,t))}),r.execution.catch(function(){return Fw(r)})}}var X_=new WeakMap,ty=function(){function r(e,t){X_.set(this,{executor:e,buffer:t,err:void 0,state:Mw,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:W_,onstop:W_})}return r.prototype.next=function(e){Lw(e);var t=X_.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=K_)throw new L5("No more than "+K_+" pending calls to next are allowed on a single repeater.");if(t.state<=Mw&&Kz(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var i=_f(t,t.buffer.remove());if(t.pushes.length){var n=t.pushes.shift();t.buffer.add(n.value),t.onnext=n.resolve}return i}else if(t.pushes.length){var o=t.pushes.shift();return t.onnext=o.resolve,_f(t,o.value)}else if(t.state>=yf)return ey(t),_f(t,Jp(t));return new Promise(function(a){return t.nexts.push({resolve:a,value:e})})},r.prototype.return=function(e){Lw(e);var t=X_.get(this);if(t===void 0)throw new Error("WeakMap error");return ey(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),_f(t,Jp(t))},r.prototype.throw=function(e){var t=X_.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=Mw||t.state>=yf||typeof t.buffer<"u"&&!t.buffer.empty?(ey(t),t.err==null&&(t.err=e),_f(t,Jp(t))):this.next(Promise.reject(e))},r.prototype[Symbol.asyncIterator]=function(){return this},r.race=Wz,r.merge=Xz,r.zip=Zz,r.latest=Jz,r}();function Z_(r,e){var t,i,n=[],o=function(y){y!=null&&typeof y[Symbol.asyncIterator]=="function"?n.push(y[Symbol.asyncIterator]()):y!=null&&typeof y[Symbol.iterator]=="function"?n.push(y[Symbol.iterator]()):n.push(function(){return jz(this,arguments,function(){return ld(this,function(R){switch(R.label){case 0:return e.yieldValues?[4,Ym(y)]:[3,3];case 1:return[4,R.sent()];case 2:R.sent(),R.label=3;case 3:return e.returnValues?[4,Ym(y)]:[3,5];case 4:return[2,R.sent()];case 5:return[2]}})})}())};try{for(var a=Zp(r),s=a.next();!s.done;s=a.next()){var g=s.value;o(g)}}catch(y){t={error:y}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}return n}function Wz(r){var e=this,t=Z_(r,{returnValues:!0});return new ty(function(i,n){return Xp(e,void 0,void 0,function(){var o,a,s,g,y,T;return ld(this,function(I){switch(I.label){case 0:if(!t.length)return n(),[2];a=!1,n.then(function(){o(),a=!0}),I.label=1;case 1:I.trys.push([1,,5,7]),g=void 0,y=0,T=function(){var R,U,Z,Y,he,ce;return ld(this,function(pe){switch(pe.label){case 0:R=y;try{for(U=(he=void 0,Zp(t)),Z=U.next();!Z.done;Z=U.next())Y=Z.value,Promise.resolve(Y.next()).then(function(be){be.done?(n(),s===void 0&&(s=be)):y===R&&(y++,o(be))},function(be){return n(be)})}catch(be){he={error:be}}finally{try{Z&&!Z.done&&(ce=U.return)&&ce.call(U)}finally{if(he)throw he.error}}return[4,new Promise(function(be){return o=be})];case 1:return g=pe.sent(),g===void 0?[3,3]:[4,i(g.value)];case 2:pe.sent(),pe.label=3;case 3:return[2]}})},I.label=2;case 2:return a?[3,4]:[5,T()];case 3:return I.sent(),[3,2];case 4:return[2,s&&s.value];case 5:return n(),[4,Promise.race(t.map(function(R){return R.return&&R.return()}))];case 6:return I.sent(),[7];case 7:return[2]}})})})}function Xz(r){var e=this,t=Z_(r,{yieldValues:!0});return new ty(function(i,n){return Xp(e,void 0,void 0,function(){var o,a,s,g=this;return ld(this,function(y){switch(y.label){case 0:if(!t.length)return n(),[2];o=[],a=!1,n.then(function(){var T,I;a=!0;try{for(var R=Zp(o),U=R.next();!U.done;U=R.next()){var Z=U.value;Z()}}catch(Y){T={error:Y}}finally{try{U&&!U.done&&(I=R.return)&&I.call(R)}finally{if(T)throw T.error}}}),y.label=1;case 1:return y.trys.push([1,,3,4]),[4,Promise.all(t.map(function(T,I){return Xp(g,void 0,void 0,function(){var R,U;return ld(this,function(Z){switch(Z.label){case 0:Z.trys.push([0,,6,9]),Z.label=1;case 1:return a?[3,5]:(Promise.resolve(T.next()).then(function(Y){return o[I](Y)},function(Y){return n(Y)}),[4,new Promise(function(Y){o[I]=Y})]);case 2:return R=Z.sent(),R===void 0?[3,4]:R.done?(s=R,[2]):[4,i(R.value)];case 3:Z.sent(),Z.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return U=T.return,U?[4,T.return()]:[3,8];case 7:U=Z.sent(),Z.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return y.sent(),[2,s&&s.value];case 3:return n(),[7];case 4:return[2]}})})})}function Zz(r){var e=this,t=Z_(r,{returnValues:!0});return new ty(function(i,n){return Xp(e,void 0,void 0,function(){var o,a,s,g;return ld(this,function(y){switch(y.label){case 0:if(!t.length)return n(),[2,[]];a=!1,n.then(function(){o(),a=!0}),y.label=1;case 1:y.trys.push([1,,6,8]),y.label=2;case 2:return a?[3,5]:(Promise.all(t.map(function(T){return T.next()})).then(function(T){return o(T)},function(T){return n(T)}),[4,new Promise(function(T){return o=T})]);case 3:return s=y.sent(),s===void 0?[2]:(g=s.map(function(T){return T.value}),s.some(function(T){return T.done})?[2,g]:[4,i(g)]);case 4:return y.sent(),[3,2];case 5:return[3,8];case 6:return n(),[4,Promise.all(t.map(function(T){return T.return&&T.return()}))];case 7:return y.sent(),[7];case 8:return[2]}})})})}function Jz(r){var e=this,t=Z_(r,{yieldValues:!0,returnValues:!0});return new ty(function(i,n){return Xp(e,void 0,void 0,function(){var o,a,s,g,y,T=this;return ld(this,function(I){switch(I.label){case 0:if(!t.length)return n(),[2,[]];a=[],s=!1,n.then(function(){var R,U;o();try{for(var Z=Zp(a),Y=Z.next();!Y.done;Y=Z.next()){var he=Y.value;he()}}catch(ce){R={error:ce}}finally{try{Y&&!Y.done&&(U=Z.return)&&U.call(Z)}finally{if(R)throw R.error}}s=!0}),I.label=1;case 1:return I.trys.push([1,,5,7]),Promise.all(t.map(function(R){return R.next()})).then(function(R){return o(R)},function(R){return n(R)}),[4,new Promise(function(R){return o=R})];case 2:return g=I.sent(),g===void 0?[2]:(y=g.map(function(R){return R.value}),g.every(function(R){return R.done})?[2,y]:[4,i(y.slice())]);case 3:return I.sent(),[4,Promise.all(t.map(function(R,U){return Xp(T,void 0,void 0,function(){var Z;return ld(this,function(Y){switch(Y.label){case 0:if(g[U].done)return[2,g[U].value];Y.label=1;case 1:return s?[3,4]:(Promise.resolve(R.next()).then(function(he){return a[U](he)},function(he){return n(he)}),[4,new Promise(function(he){return a[U]=he})]);case 2:return Z=Y.sent(),Z===void 0?[2,g[U].value]:Z.done?[2,Z.value]:(y[U]=Z.value,[4,i(y.slice())]);case 3:return Y.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,I.sent()];case 5:return n(),[4,Promise.all(t.map(function(R){return R.return&&R.return()}))];case 6:return I.sent(),[7];case 7:return[2]}})})})}class J_{constructor(){this._extraRequestThreshold=256*1024}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw new Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}}J_.global=new J_;var ih;(function(r){r[r.Debug=0]="Debug",r[r.Info=1]="Info",r[r.Warn=2]="Warn",r[r.Error=3]="Error"})(ih||(ih={}));class qa{static debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(ih.Debug,...t)}static info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(ih.Info,...t)}static warn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(ih.Warn,...t)}static error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(ih.Error,...t)}static log(e){if(!(this.logLevel>e)){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];switch(e){case ih.Debug:{console.debug(...i);break}case ih.Info:{console.info(...i);break}case ih.Warn:{console.warn(...i);break}case ih.Error:{console.error(...i);break}}}}}qa.logLevel=ih.Warn;const vf=8*4+8,Yz=16;function Dw(r,e){e=Math.min(Math.max(+e,2),65535);let t=r,i=t;do t=Math.ceil(t/e),i+=t;while(t!==1);return i*vf}function eQ(r,e){if(e<2)throw new Error("Node size must be at least 2");if(r===0)throw new Error("Number of items must be greater than 0");let t=r,i=t;const n=[t];do t=Math.ceil(t/e),i+=t,n.push(t);while(t!==1);const o=[];t=i;for(const s of n)o.push(t-s),t-=s;const a=[];for(let s=0;s<n.length;s++)a.push([o[s],o[s]+n[s]]);return a}async function*tQ(r,e,t,i){class n{constructor(Z,Y){this._level=Y,this.nodes=Z}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(Z){console.assert(Z>this.nodes[1]),this.nodes[1]=Z}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}const{minX:o,minY:a,maxX:s,maxY:g}=t;qa.info(`tree items: ${r}, nodeSize: ${e}`);const y=eQ(r,e),T=y[0][0],R=[(()=>{const U=[0,1],Z=y.length-1;return new n(U,Z)})()];for(qa.debug(`starting stream search with queue: ${R}, numItems: ${r}, nodeSize: ${e}, levelBounds: ${y}`);R.length!=0;){const U=R.shift();qa.debug(`popped node: ${U}, queueLength: ${R.length}`);const Z=U.startNodeIdx(),Y=Z>=T,he=(()=>{const[,Te]=y[U.level()],qe=Math.min(U.endNodeIdx()+e,Te);return Y&&qe<Te?qe+1:qe})(),ce=he-Z,pe=await i(Z*vf,ce*vf),be=new DataView(pe);for(let Te=Z;Te<he;Te++){const qe=Te-Z,je=qe*vf;if(s<be.getFloat64(je+0,!0)||g<be.getFloat64(je+8,!0)||o>be.getFloat64(je+16,!0)||a>be.getFloat64(je+24,!0))continue;const We=be.getBigUint64(je+32,!0);if(Y){const De=We,Ye=(()=>{if(Te<r-1){const Ct=(qe+1)*vf;return be.getBigUint64(Ct+32,!0)-De}else return null})(),Xe=Te-T;yield[Number(De),Xe,Number(Ye)];continue}const Ne=We,at=J_.global.extraRequestThreshold()/vf,nt=R[R.length-1];if(nt!==void 0&&nt.level()==U.level()-1&&Ne<nt.endNodeIdx()+at){qa.debug(`Merging "nodeRange" request into existing range: ${nt}, newEndNodeIdx: ${nt.endNodeIdx()} -> ${Ne}`),nt.extendEndNodeIdx(Number(Ne));continue}const ke=(()=>{const De=U.level()-1,Ye=[Number(Ne),Number(Ne)+1];return new n(Ye,De)})();nt!==void 0&&nt.level()==ke.level()?qa.info(`Same level, but too far away. Pushing new request for nodeIdx: ${Ne} rather than merging with distant ${nt}`):qa.info(`Pushing new level for ${ke} onto queue with nearestNodeRange: ${nt} since there's not already a range for this level.`),R.push(ke)}}}const cd=new Uint8Array([102,103,98,3,102,103,98,0]),BA=4;class Rw{constructor(e,t,i,n){this.headerClient=e,this.header=t,this.headerLength=i,this.indexLength=n}static async open(e){const i=new F5(e),n=(()=>{const I=Yz,R=3;let U=0,Z;for(Z=0;Z<R;Z++){const Y=I**Z*vf;U+=Y}return U})(),o=2024+n;qa.debug(`fetching header. minReqLength: ${o} (assumedHeaderLength: 2024, assumedIndexLength: ${n})`);{const I=new Uint8Array(await i.getRange(0,8,o,"header"));if(!I.subarray(0,3).every((R,U)=>cd[U]===R))throw qa.error(`bytes: ${I} != ${cd}`),new Error("Not a FlatGeobuf file");qa.debug("magic bytes look good")}let a;{const I=await i.getRange(8,4,o,"header");a=new DataView(I).getUint32(0,!0);const R=1048576*10;if(a>R||a<8)throw new Error("Invalid header size");qa.debug(`headerLength: ${a}`)}const s=await i.getRange(12,a,o,"header"),g=new wA(new Uint8Array(s)),y=Tw(g),T=Dw(y.featuresCount,y.indexNodeSize);return qa.debug("completed: opening http reader"),new Rw(i,y,a,T)}async*selectBbox(e){const t=this.lengthBeforeTree(),i=this.headerClient,n=async function(g,y){return i.getRange(t+g,y,0,"index")},o=[];let a=[];for await(const g of tQ(this.header.featuresCount,this.header.indexNodeSize,e,n)){const[y,,]=g;let[,,T]=g;if(T||(qa.info("final feature"),T=4),a.length==0){a.push([y,T]);continue}const I=a[a.length-1],R=y-(I[0]+I[1]);R>J_.global.extraRequestThreshold()&&(qa.info(`Pushing new feature batch, since gap ${R} was too large`),o.push(a),a=[]),a.push([y,T])}this.headerClient.logUsage("header+index"),a.length>0&&o.push(a);const s=o.flatMap(g=>this.readFeatureBatch(g));yield*ty.merge(s)}lengthBeforeTree(){return cd.length+BA+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(){return new F5(this.headerClient.httpClient)}async*readFeatureBatch(e){const[t]=e[0],[i,n]=e[e.length-1],o=t,s=i+n-o,g=this.buildFeatureClient();let y=s;for(const[T]of e)yield await this.readFeature(g,T,y),y=0;g.logUsage("feature")}async readFeature(e,t,i){const n=t+this.lengthBeforeFeatures();let o;{const T=await e.getRange(n,4,i,"feature length");o=new DataView(T).getUint32(0,!0)}const a=await e.getRange(n+4,o,i,"feature data"),s=new Uint8Array(a),g=new Uint8Array(o+BA);g.set(s,BA);const y=new wA(g);return y.setPosition(BA),rh.getRootAsFeature(y)}}class F5{constructor(e){if(this.bytesEverUsed=0,this.bytesEverFetched=0,this.buffer=new ArrayBuffer(0),this.head=0,typeof e=="string")this.httpClient=new D5(e);else if(e instanceof D5)this.httpClient=e;else throw new Error("Unknown source ")}async getRange(e,t,i,n){this.bytesEverUsed+=t;const o=e-this.head,a=o+t;if(o>=0&&a<=this.buffer.byteLength)return this.buffer.slice(o,a);const s=Math.max(t,i);return this.bytesEverFetched+=s,qa.debug(`requesting for new Range: ${e}-${e+s-1}`),this.buffer=await this.httpClient.getRange(e,s,n),this.head=e,this.buffer.slice(0,t)}logUsage(e){const t=e.split(" ")[0],i=this.bytesEverUsed,n=this.bytesEverFetched,o=(100*i/n).toFixed(2);qa.info(`${t} bytes used/requested: ${i} / ${n} = ${o}%`)}}class D5{constructor(e){this.requestsEverMade=0,this.bytesEverRequested=0,this.url=e}async getRange(e,t,i){this.requestsEverMade+=1,this.bytesEverRequested+=t;const n=`bytes=${e}-${e+t-1}`;return qa.info(`request: #${this.requestsEverMade}, purpose: ${i}), bytes: (this_request: ${t}, ever: ${this.bytesEverRequested}), Range: ${n}`),(await fetch(this.url,{headers:{Range:n}})).arrayBuffer()}}function rQ(r,e,t){if(!r.subarray(0,3).every((T,I)=>cd[I]===T))throw new Error("Not a FlatGeobuf file");const i=new wA(r),n=i.readUint32(cd.length);i.setPosition(cd.length+BA);const o=Tw(i);t&&t(o);let a=cd.length+BA+n;const{indexNodeSize:s,featuresCount:g}=o;s>0&&(a+=Dw(g,s));const y=[];for(;a<i.capacity();){const T=i.readUint32(a);i.setPosition(a+BA);const I=rh.getRootAsFeature(i);y.push(e(I,o)),a+=BA+T}return y}async function*iQ(r,e,t){const i=Hz(r),n=async R=>await i.slice(R);let o=new Uint8Array(await n(8));if(!o.subarray(0,3).every((R,U)=>cd[U]===R))throw new Error("Not a FlatGeobuf file");o=new Uint8Array(await n(4));let a=new wA(o);const s=a.readUint32(0);o=new Uint8Array(await n(s)),a=new wA(o);const g=Tw(a);t&&t(g);const{indexNodeSize:y,featuresCount:T}=g;if(y>0){const R=Dw(T,y);await n(R)}let I;for(;I=await sQ(n,g,e);)yield I}async function*nQ(r,e,t,i){const n=await Rw.open(r);qa.debug("opened reader"),i&&i(n.header);for await(const o of n.selectBbox(e))yield t(o,n.header)}async function sQ(r,e,t){let i=new Uint8Array(await r(4,"feature length"));if(i.byteLength===0)return;let n=new wA(i);const o=n.readUint32(0);i=new Uint8Array(await r(o,"feature data"));const a=new Uint8Array(o+4);a.set(i,4),n=new wA(a),n.setPosition(BA);const s=rh.getRootAsFeature(n);return t(s,e)}function oQ(r,e){return{type:"FeatureCollection",features:rQ(r,Ew,e)}}function aQ(r,e){return iQ(r,Ew,e)}function lQ(r,e,t){return nQ(r,e,Ew,t)}function R5(r,e,t){return r instanceof Uint8Array?oQ(r,t):r instanceof ReadableStream?aQ(r,t):lQ(r,e,t)}class cQ{constructor(){this._bearing=0,this._pitch=60,this._minpitchzoom=null}onAdd(e){this._map=e;let t=this;return this._btn=document.createElement("button"),this._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d",this._btn.id="bt3D",this._btn.type="button",this._btn["aria-label"]="Vista 3D",this._btn.onclick=function(){if(t._btn.className.indexOf("3d")!=-1){let y={pitch:t._pitch,bearing:t._bearing};t._minpitchzoom&&e.getZoom()>t._minpitchzoom&&(y.zoom=t._minpitchzoom);var i=0,n=38.5,o=6,a=62.33,{longitude:s,latitude:g}=e.getCenter();e.getZoom()<10?e.setTerrain({source:"terrainMapZen",exaggeration:1.5}):s>=i&&s<=o&&g>=n&&g<=a?e.setTerrain({source:"terrainICGC",exaggeration:1.2}):e.setTerrain({source:"terrainMapZen",exaggeration:1.5}),e.easeTo(y),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-2d"}else e.setTerrain(null),e.easeTo({pitch:0,bearing:0}),t._btn.className="maplibregl-ctrl-icon maplibregl-ctrl-pitchtoggle-3d"},this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.title="Vista 3D",this._container.appendChild(this._btn),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function ry(r){"@babel/helpers - typeof";return ry=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ry(r)}function uQ(r,e){if(ry(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e||"default");if(ry(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function hQ(r){var e=uQ(r,"string");return ry(e)=="symbol"?e:String(e)}function ye(r,e,t){return e=hQ(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Ls(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const Y_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),k5=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);k5&&parseFloat(k5[1]);const AQ="3.4.14";function zh(r,e){if(!r)throw new Error(e||"loaders.gl assertion failed.")}const kw={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},dQ=kw.global||kw.self||kw.window||{},CA=typeof process!="object"||String(process)!=="[object process]"||process.browser,Ow=typeof importScripts=="function",fQ=typeof window<"u"&&typeof window.orientation<"u",O5=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);O5&&parseFloat(O5[1]);class pQ{constructor(e,t){ye(this,"name",void 0),ye(this,"workerThread",void 0),ye(this,"isRunning",!0),ye(this,"result",void 0),ye(this,"_resolve",()=>{}),ye(this,"_reject",()=>{}),this.name=e,this.workerThread=t,this.result=new Promise((i,n)=>{this._resolve=i,this._reject=n})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){zh(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){zh(this.isRunning),this.isRunning=!1,this._reject(e)}}let Uw=class{terminate(){}};const Nw=new Map;function gQ(r){zh(r.source&&!r.url||!r.source&&r.url);let e=Nw.get(r.source||r.url);return e||(r.url&&(e=mQ(r.url),Nw.set(r.url,e)),r.source&&(e=U5(r.source),Nw.set(r.source,e))),zh(e),e}function mQ(r){if(!r.startsWith("http"))return r;const e=yQ(r);return U5(e)}function U5(r){const e=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(e)}function yQ(r){return`try {
  importScripts('`.concat(r,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function N5(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2?arguments[2]:void 0;const i=t||new Set;if(r){if(z5(r))i.add(r);else if(z5(r.buffer))i.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(e&&typeof r=="object")for(const n in r)N5(r[n],e,i)}}return t===void 0?Array.from(i):[]}function z5(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const zw=()=>{};class Qw{static isSupported(){return typeof Worker<"u"&&CA||typeof Uw<"u"&&!CA}constructor(e){ye(this,"name",void 0),ye(this,"source",void 0),ye(this,"url",void 0),ye(this,"terminated",!1),ye(this,"worker",void 0),ye(this,"onMessage",void 0),ye(this,"onError",void 0),ye(this,"_loadableURL","");const{name:t,source:i,url:n}=e;zh(i||n),this.name=t,this.source=i,this.url=n,this.onMessage=zw,this.onError=o=>console.log(o),this.worker=CA?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=zw,this.onError=zw,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||N5(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=gQ({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Uw(i,{eval:!1})}else if(this.source)e=new Uw(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class _Q{static isSupported(){return Qw.isSupported()}constructor(e){ye(this,"name","unnamed"),ye(this,"source",void 0),ye(this,"url",void 0),ye(this,"maxConcurrency",1),ye(this,"maxMobileConcurrency",1),ye(this,"onDebug",()=>{}),ye(this,"reuseWorkers",!0),ye(this,"props",{}),ye(this,"jobQueue",[]),ye(this,"idleQueue",[]),ye(this,"count",0),ye(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(o,a,s)=>o.done(s),i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(o,a)=>o.error(a);const n=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:o}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new pQ(t.name,e);e.onMessage=n=>t.onMessage(i,n.type,n.payload),e.onError=n=>t.onError(i,n),t.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Qw({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return fQ?this.maxMobileConcurrency:this.maxConcurrency}}const vQ={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class EA{static isSupported(){return Qw.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return EA._workerFarm=EA._workerFarm||new EA({}),EA._workerFarm.setProps(e),EA._workerFarm}constructor(e){ye(this,"props",void 0),ye(this,"workerPools",new Map),this.props={...vQ},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:n}=e;let o=this.workerPools.get(t);return o||(o=new _Q({name:t,source:i,url:n}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}ye(EA,"_workerFarm",void 0);const bQ="latest";function xQ(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e[r.id]||{},i="".concat(r.id,"-worker.js");let n=t.workerUrl;if(!n&&r.id==="compression"&&(n=e.workerUrl),e._workerType==="test"&&(n="modules/".concat(r.module,"/dist/").concat(i)),!n){let o=r.version;o==="latest"&&(o=bQ);const a=o?"@".concat(o):"";n="https://unpkg.com/@loaders.gl/".concat(r.module).concat(a,"/dist/").concat(i)}return zh(n),n}function wQ(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:AQ;zh(r,"no worker provided");const t=r.version;return!(!e||!t)}const BQ=null,CQ=null,Vw=null,Q5=null,EQ=Object.freeze(Object.defineProperty({__proto__:null,readFileAsArrayBuffer:BQ,readFileAsText:CQ,requireFromFile:Vw,requireFromString:Q5},Symbol.toStringTag,{value:"Module"})),SQ="3.4.14",Hw={};async function bf(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e&&(r=TQ(r,e,t)),Hw[r]=Hw[r]||IQ(r),await Hw[r]}function TQ(r,e,t){if(r.startsWith("http"))return r;const i=t.modules||{};return i[r]?i[r]:CA?t.CDN?(zh(t.CDN.startsWith("http")),"".concat(t.CDN,"/").concat(e,"@").concat(SQ,"/dist/libs/").concat(r)):Ow?"../src/libs/".concat(r):"modules/".concat(e,"/src/libs/").concat(r):"modules/".concat(e,"/dist/libs/").concat(r)}async function IQ(r){if(r.endsWith("wasm"))return await(await fetch(r)).arrayBuffer();if(!CA)try{return EQ&&Vw&&await Vw(r)}catch{return null}if(Ow)return importScripts(r);const t=await(await fetch(r)).text();return LQ(t,r)}function LQ(r,e){if(!CA)return Q5;if(Ow)return eval.call(dQ,r),null;const t=document.createElement("script");t.id=e;try{t.appendChild(document.createTextNode(r))}catch{t.text=r}return document.body.appendChild(t),null}function MQ(r,e){return!EA.isSupported()||!CA&&!(e!=null&&e._nodeWorkers)?!1:r.worker&&(e==null?void 0:e.worker)}async function PQ(r,e,t,i,n){const o=r.id,a=xQ(r,t),g=EA.getWorkerFarm(t).getWorkerPool({name:o,url:a});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));const y=await g.startJob("process-on-worker",FQ.bind(null,n));return y.postMessage("process",{input:e,options:t,context:i}),await(await y.result).result}async function FQ(r,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:n,input:o,options:a}=i;try{const s=await r(o,a);e.postMessage("done",{id:n,result:s})}catch(s){const g=s instanceof Error?s.message:"unknown error";e.postMessage("error",{id:n,error:g})}break;default:console.warn("parse-with-worker unknown message ".concat(t))}}function DQ(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?V5(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?V5(r,0,e):""}function V5(r,e,t){if(r.byteLength<=e+t)return"";const i=new DataView(r);let n="";for(let o=0;o<t;o++)n+=String.fromCharCode(i.getUint8(e+o));return n}function RQ(r){try{return JSON.parse(r)}catch{throw new Error('Failed to parse JSON from data starting with "'.concat(DQ(r),'"'))}}function kQ(r,e,t){if(t=t||r.byteLength,r.byteLength<t||e.byteLength<t)return!1;const i=new Uint8Array(r),n=new Uint8Array(e);for(let o=0;o<i.length;++o)if(i[o]!==n[o])return!1;return!0}function OQ(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];const i=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=i.reduce((s,g)=>s+g.byteLength,0),o=new Uint8Array(n);let a=0;for(const s of i)o.set(s,a),a+=s.byteLength;return o.buffer}function Gw(r,e,t){const i=t!==void 0?new Uint8Array(r).subarray(e,e+t):new Uint8Array(r).subarray(e);return new Uint8Array(i).buffer}function iy(r,e){return Ls(r>=0),Ls(e>0),r+(e-1)&~(e-1)}function UQ(r,e,t){let i;if(r instanceof ArrayBuffer)i=new Uint8Array(r);else{const n=r.byteOffset,o=r.byteLength;i=new Uint8Array(r.buffer||r.arrayBuffer,n,o)}return e.set(i,t),t+iy(i.byteLength,4)}async function NQ(r){const e=[];for await(const t of r)e.push(t);return OQ(...e)}function H5(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}let G5=class{constructor(e,t){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=H5(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(H5()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},zQ=class{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let n=this.stats[t];return n||(e instanceof G5?n=e:n=new G5(t,i),this.stats[t]=n),n}};const QQ="Queued Requests",VQ="Active Requests",HQ="Cancelled Requests",GQ="Queued Requests Ever",jQ="Active Requests Ever",qQ={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class $Q{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"props",void 0),ye(this,"stats",void 0),ye(this,"activeRequestCount",0),ye(this,"requestQueue",[]),ye(this,"requestMap",new Map),ye(this,"deferredUpdate",null),this.props={...qQ,...e},this.stats=new zQ({id:this.props.id}),this.stats.get(QQ),this.stats.get(VQ),this.stats.get(HQ),this.stats.get(GQ),this.stats.get(jQ)}scheduleRequest(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const i={handle:e,priority:0,getPriority:t},n=new Promise(o=>(i.resolve=o,i));return this.requestQueue.push(i),this.requestMap.set(e,n),this._issueNewRequests(),n}_issueRequest(e){const{handle:t,resolve:i}=e;let n=!1;const o=()=>{n||(n=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:o}):Promise.resolve({done:o})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let t=0;t<e;++t){const i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){const e=this.requestQueue;for(let t=0;t<e.length;++t){const i=e[t];this._updateRequest(i)||(e.splice(t,1),this.requestMap.delete(i.handle),t--)}e.sort((t,i)=>t.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let KQ="";const j5={};function WQ(r){for(const e in j5)if(r.startsWith(e)){const t=j5[e];r=r.replace(e,t)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r="".concat(KQ).concat(r)),r}function ywe(r){return r}function XQ(r){return r&&typeof r=="object"&&r.isBuffer}function q5(r){if(XQ(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function $5(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(e+1):""}function jw(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}const ZQ=r=>typeof r=="boolean",ny=r=>typeof r=="function",sy=r=>r!==null&&typeof r=="object",K5=r=>sy(r)&&r.constructor==={}.constructor,JQ=r=>r&&typeof r[Symbol.iterator]=="function",YQ=r=>r&&typeof r[Symbol.asyncIterator]=="function",xf=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,wf=r=>typeof Blob<"u"&&r instanceof Blob,eV=r=>r&&typeof r=="object"&&r.isBuffer,tV=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||sy(r)&&ny(r.tee)&&ny(r.cancel)&&ny(r.getReader),rV=r=>sy(r)&&ny(r.read)&&ny(r.pipe)&&ZQ(r.readable),W5=r=>tV(r)||rV(r),iV=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,nV=/^([-\w.]+\/[-\w.+]+)/;function sV(r){const e=nV.exec(r);return e?e[1]:r}function X5(r){const e=iV.exec(r);return e?e[1]:""}const Z5=/\?.*/;function oV(r){const e=r.match(Z5);return e&&e[0]}function qw(r){return r.replace(Z5,"")}function e1(r){return xf(r)?r.url:wf(r)?r.name||"":typeof r=="string"?r:""}function $w(r){if(xf(r)){const e=r,t=e.headers.get("content-type")||"",i=qw(e.url);return sV(t)||X5(i)}return wf(r)?r.type||"":typeof r=="string"?X5(r):""}function aV(r){return xf(r)?r.headers["content-length"]||-1:wf(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function J5(r){if(xf(r))return r;const e={},t=aV(r);t>=0&&(e["content-length"]=String(t));const i=e1(r),n=$w(r);n&&(e["content-type"]=n);const o=await uV(r);o&&(e["x-first-bytes"]=o),typeof r=="string"&&(r=new TextEncoder().encode(r));const a=new Response(r,{headers:e});return Object.defineProperty(a,"url",{value:i}),a}async function lV(r){if(!r.ok){const e=await cV(r);throw new Error(e)}}async function cV(r){let e="Failed to fetch resource ".concat(r.url," (").concat(r.status,"): ");try{const t=r.headers.get("Content-Type");let i=r.statusText;t.includes("application/json")&&(i+=" ".concat(await r.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function uV(r){if(typeof r=="string")return"data:,".concat(r.slice(0,5));if(r instanceof Blob){const t=r.slice(0,5);return await new Promise(i=>{const n=new FileReader;n.onload=o=>{var a;return i(o==null||(a=o.target)===null||a===void 0?void 0:a.result)},n.readAsDataURL(t)})}if(r instanceof ArrayBuffer){const t=r.slice(0,5),i=hV(t);return"data:base64,".concat(i)}return null}function hV(r){let e="";const t=new Uint8Array(r);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}async function Y5(r,e){if(typeof r=="string"){r=WQ(r);let t=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(t=e.fetch),await fetch(r,t)}return await J5(r)}function AV(r){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=r||e;return!!(t&&t.indexOf("Electron")>=0)}function oy(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||AV()}const t1=globalThis.window||globalThis.self||globalThis.global,ay=globalThis.process||{},e3=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";oy();function dV(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}let fV=class{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=dV(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function pV(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function gV(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}function Kw(r,e,t){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const n=r.src.replace(/\(/g,"%28").replace(/\)/g,"%29");r.width>i&&(t=Math.min(t,i/r.width));const o=r.width*t,a=r.height*t,s=["font-size:1px;",`padding:${Math.floor(a/2)}px ${Math.floor(o/2)}px;`,`line-height:${a}px;`,`background:url(${n});`,`background-size:${o}px ${a}px;`,"color:transparent;"].join("");return[`${e} %c+`,s]}let r1;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(r1||(r1={}));const mV=10;function t3(r){return typeof r!="string"?r:(r=r.toUpperCase(),r1[r]||r1.WHITE)}function yV(r,e,t){return!oy&&typeof r=="string"&&(e&&(r=`\x1B[${t3(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${t3(t)+mV}m${r}\x1B[49m`)),r}function _V(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(r),i=Object.getOwnPropertyNames(t),n=r;for(const o of i){const a=n[o];typeof a=="function"&&(e.find(s=>o===s)||(n[o]=a.bind(r)))}}function i1(r,e){if(!r)throw new Error(e||"Assertion failed")}function Yp(){let r;if(oy()&&t1.performance){var e,t;r=t1==null||(e=t1.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in ay){var i;const n=ay==null||(i=ay.hrtime)===null||i===void 0?void 0:i.call(ay);r=n[0]*1e3+n[1]/1e6}else r=Date.now();return r}const eg={debug:oy()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},vV={enabled:!0,level:0};function Tu(){}const r3={},i3={once:!0};let Ww=class{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=e3,this._startTs=Yp(),this._deltaTs=Yp(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new fV(`__probe-${this.id}__`,vV),this.timeStamp(`${this.id} started`),_V(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Yp()-this._startTs).toPrecision(10))}getDelta(){return Number((Yp()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){i1(e,t)}warn(e){return this._getLogFunction(0,e,eg.warn,arguments,i3)}error(e){return this._getLogFunction(0,e,eg.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,eg.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,eg.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,eg.debug||eg.info,arguments,i3)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||Tu,i&&[i],{tag:BV(t)}):Tu}image(e){let{logLevel:t,priority:i,image:n,message:o="",scale:a=1}=e;return this._shouldLog(t||i)?oy()?wV({image:n,message:o,scale:a}):xV():Tu}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Tu)}group(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const n=s3({logLevel:e,message:t,opts:i}),{collapsed:o}=i;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Tu)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=n3(e)}_getLogFunction(e,t,i,n,o){if(this._shouldLog(e)){o=s3({logLevel:e,message:t,args:n,opts:o}),i=i||o.method,i1(i),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Yp();const a=o.tag||o.message;if(o.once&&a)if(!r3[a])r3[a]=Yp();else return Tu;return t=bV(this.id,o.message,o),i.bind(console,t,...o.args)}return Tu}};Ww.VERSION=e3;function n3(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return i1(Number.isFinite(e)&&e>=0),e}function s3(r){const{logLevel:e,message:t}=r;r.logLevel=n3(e);const i=r.args?Array.from(r.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const n=typeof r.message;return i1(n==="string"||n==="object"),Object.assign(r,{args:i},r.opts)}function bV(r,e,t){if(typeof e=="string"){const i=t.time?gV(pV(t.total)):"";e=t.time?`${r}: ${i}  ${e}`:`${r}: ${e}`,e=yV(e,t.color,t.background)}return e}function xV(r){return console.warn("removed"),Tu}function wV(r){let{image:e,message:t="",scale:i=1}=r;if(typeof e=="string"){const o=new Image;return o.onload=()=>{const a=Kw(o,t,i);console.log(...a)},o.src=e,Tu}const n=e.nodeName||"";if(n.toLowerCase()==="img")return console.log(...Kw(e,t,i)),Tu;if(n.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...Kw(o,t,i)),o.src=e.toDataURL(),Tu}return Tu}function BV(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}const o3=new Ww({id:"loaders.gl"});class CV{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class EV{constructor(){ye(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.console.log.bind(this.console,...t)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.console.info.bind(this.console,...t)}warn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.console.warn.bind(this.console,...t)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.console.error.bind(this.console,...t)}}const a3={fetch:null,mimeType:void 0,nothrow:!1,log:new EV,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Y_,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},SV={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function l3(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state=r._state||{},r._state}const c3=()=>{const r=l3();return r.globalOptions=r.globalOptions||{...a3},r.globalOptions};function TV(r,e,t,i){return t=t||[],t=Array.isArray(t)?t:[t],IV(r,t),MV(e,r,i)}function IV(r,e){u3(r,null,a3,SV,e);for(const t of e){const i=r&&r[t.id]||{},n=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};u3(i,t.id,n,o,e)}}function u3(r,e,t,i,n){const o=e||"Top level",a=e?"".concat(e,"."):"";for(const s in r){const g=!e&&sy(r[s]),y=s==="baseUri"&&!e,T=s==="workerUrl"&&e;if(!(s in t)&&!y&&!T){if(s in i)o3.warn("".concat(o," loader option '").concat(a).concat(s,"' no longer supported, use '").concat(i[s],"'"))();else if(!g){const I=LV(s,n);o3.warn("".concat(o," loader option '").concat(a).concat(s,"' not recognized. ").concat(I))()}}}}function LV(r,e){const t=r.toLowerCase();let i="";for(const n of e)for(const o in n.options){if(r===o)return"Did you mean '".concat(n.id,".").concat(o,"'?");const a=o.toLowerCase();(t.startsWith(a)||a.startsWith(t))&&(i=i||"Did you mean '".concat(n.id,".").concat(o,"'?"))}return i}function MV(r,e,t){const n={...r.options||{}};return PV(n,t),n.log===null&&(n.log=new CV),h3(n,c3()),h3(n,e),n}function h3(r,e){for(const t in e)if(t in e){const i=e[t];K5(i)&&K5(r[t])?r[t]={...r[t],...e[t]}:r[t]=e[t]}}function PV(r,e){e&&!("baseUri"in r)&&(r.baseUri=e)}function Xw(r){var e;return r?(Array.isArray(r)&&(r=r[0]),Array.isArray((e=r)===null||e===void 0?void 0:e.extensions)):!1}function Zw(r){var e,t;Ls(r,"null loader"),Ls(Xw(r),"invalid loader");let i;return Array.isArray(r)&&(i=r[1],r=r[0],r={...r,options:{...r.options,...i}}),((e=r)!==null&&e!==void 0&&e.parseTextSync||(t=r)!==null&&t!==void 0&&t.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const A3=()=>{const r=l3();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function FV(r){const e=A3();r=Array.isArray(r)?r:[r];for(const t of r){const i=Zw(t);e.find(n=>i===n)||e.unshift(i)}}function DV(){return A3()}const RV=new Ww({id:"loaders.gl"}),kV=/\.([^.]+)$/;async function OV(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!f3(r))return null;let n=d3(r,e,{...t,nothrow:!0},i);if(n)return n;if(wf(r)&&(r=await r.slice(0,10).arrayBuffer(),n=d3(r,e,t,i)),!n&&!(t!=null&&t.nothrow))throw new Error(p3(r));return n}function d3(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(!f3(r))return null;if(e&&!Array.isArray(e))return Zw(e);let n=[];e&&(n=n.concat(e)),t!=null&&t.ignoreRegisteredLoaders||n.push(...DV()),NV(n);const o=UV(r,n,t,i);if(!o&&!(t!=null&&t.nothrow))throw new Error(p3(r));return o}function UV(r,e,t,i){const n=e1(r),o=$w(r),a=qw(n)||(i==null?void 0:i.url);let s=null,g="";if(t!=null&&t.mimeType&&(s=Jw(e,t==null?void 0:t.mimeType),g="match forced by supplied MIME type ".concat(t==null?void 0:t.mimeType)),s=s||zV(e,a),g=g||(s?"matched url ".concat(a):""),s=s||Jw(e,o),g=g||(s?"matched MIME type ".concat(o):""),s=s||VV(e,r),g=g||(s?"matched initial data ".concat(m3(r)):""),s=s||Jw(e,t==null?void 0:t.fallbackMimeType),g=g||(s?"matched fallback MIME type ".concat(o):""),g){var y;RV.log(1,"selectLoader selected ".concat((y=s)===null||y===void 0?void 0:y.name,": ").concat(g,"."))}return s}function f3(r){return!(r instanceof Response&&r.status===204)}function p3(r){const e=e1(r),t=$w(r);let i="No valid loader found (";i+=e?"".concat($5(e),", "):"no url provided, ",i+="MIME type: ".concat(t?'"'.concat(t,'"'):"not provided",", ");const n=r?m3(r):"";return i+=n?' first bytes: "'.concat(n,'"'):"first bytes: not available",i+=")",i}function NV(r){for(const e of r)Zw(e)}function zV(r,e){const t=e&&kV.exec(e),i=t&&t[1];return i?QV(r,i):null}function QV(r,e){e=e.toLowerCase();for(const t of r)for(const i of t.extensions)if(i.toLowerCase()===e)return t;return null}function Jw(r,e){for(const t of r)if(t.mimeTypes&&t.mimeTypes.includes(e)||e==="application/x.".concat(t.id))return t;return null}function VV(r,e){if(!e)return null;for(const t of r)if(typeof e=="string"){if(HV(e,t))return t}else if(ArrayBuffer.isView(e)){if(g3(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&g3(e,0,t))return t;return null}function HV(r,e){return e.testText?e.testText(r):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>r.startsWith(i))}function g3(r,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>GV(r,e,t,n))}function GV(r,e,t,i){if(i instanceof ArrayBuffer)return kQ(i,r,i.byteLength);switch(typeof i){case"function":return i(r,t);case"string":const n=Yw(r,e,i.length);return i===n;default:return!1}}function m3(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?Yw(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?Yw(r,0,e):""}function Yw(r,e,t){if(r.byteLength<e+t)return"";const i=new DataView(r);let n="";for(let o=0;o<t;o++)n+=String.fromCharCode(i.getUint8(e+o));return n}const jV=256*1024;function*qV(r,e){const t=(e==null?void 0:e.chunkSize)||jV;let i=0;const n=new TextEncoder;for(;i<r.length;){const o=Math.min(r.length-i,t),a=r.slice(i,i+o);i+=o,yield n.encode(a)}}const $V=256*1024;function KV(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:t=$V}=e;let i=0;for(;i<r.byteLength;){const n=Math.min(r.byteLength-i,t),o=new ArrayBuffer(n),a=new Uint8Array(r,i,n);new Uint8Array(o).set(a),i+=n,yield o}}()}const WV=1024*1024;async function*XV(r,e){const t=(e==null?void 0:e.chunkSize)||WV;let i=0;for(;i<r.size;){const n=i+t,o=await r.slice(i,n).arrayBuffer();i=n,yield o}}function y3(r,e){return Y_?ZV(r,e):JV(r)}async function*ZV(r,e){const t=r.getReader();let i;try{for(;;){const n=i||t.read();e!=null&&e._streamReadAhead&&(i=t.read());const{done:o,value:a}=await n;if(o)return;yield q5(a)}}catch{t.releaseLock()}}async function*JV(r,e){for await(const t of r)yield q5(t)}function YV(r,e){if(typeof r=="string")return qV(r,e);if(r instanceof ArrayBuffer)return KV(r,e);if(wf(r))return XV(r,e);if(W5(r))return y3(r,e);if(xf(r))return y3(r.body,e);throw new Error("makeIterator")}const _3="Cannot convert supplied data type";function eH(r,e,t){if(e.text&&typeof r=="string")return r;if(eV(r)&&(r=r.buffer),r instanceof ArrayBuffer){const i=r;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(r)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(r);let i=r.buffer;const n=r.byteLength||r.length;return(r.byteOffset!==0||n!==i.byteLength)&&(i=i.slice(r.byteOffset,r.byteOffset+n)),i}throw new Error(_3)}async function tH(r,e,t){const i=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||i)return eH(r,e);if(wf(r)&&(r=await J5(r)),xf(r)){const n=r;return await lV(n),e.binary?await n.arrayBuffer():await n.text()}if(W5(r)&&(r=YV(r,t)),JQ(r)||YQ(r))return NQ(r);throw new Error(_3)}function v3(r,e){const t=c3(),i=r||t;return typeof i.fetch=="function"?i.fetch:sy(i.fetch)?n=>Y5(n,i):e!=null&&e.fetch?e==null?void 0:e.fetch:Y5}function rH(r,e,t){if(t)return t;const i={fetch:v3(e,r),...r};if(i.url){const n=qw(i.url);i.baseUrl=n,i.queryString=oV(i.url),i.filename=$5(n),i.baseUrl=jw(n)}return Array.isArray(i.loaders)||(i.loaders=null),i}function iH(r,e){if(!e&&r&&!Array.isArray(r))return r;let t;if(r&&(t=Array.isArray(r)?r:[r]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:null}async function e2(r,e,t,i){zh(!i||typeof i=="object"),e&&!Array.isArray(e)&&!Xw(e)&&(i=void 0,t=e,e=void 0),r=await r,t=t||{};const n=e1(r),a=iH(e,i),s=await OV(r,a,t);return s?(t=TV(t,s,a,n),i=rH({url:n,parse:e2,loaders:a},t,i||null),await nH(s,r,t,i)):null}async function nH(r,e,t,i){if(wQ(r),xf(e)){const n=e,{ok:o,redirected:a,status:s,statusText:g,type:y,url:T}=n,I=Object.fromEntries(n.headers.entries());i.response={headers:I,ok:o,redirected:a,status:s,statusText:g,type:y,url:T}}if(e=await tH(e,r,t),r.parseTextSync&&typeof e=="string")return t.dataType="text",r.parseTextSync(e,t,i,r);if(MQ(r,t))return await PQ(r,e,t,i,e2);if(r.parseText&&typeof e=="string")return await r.parseText(e,t,i,r);if(r.parse)return await r.parse(e,t,i,r);throw zh(!r.parseSync),new Error("".concat(r.id," loader - no parser found and worker is disabled"))}async function ud(r,e,t,i){!Array.isArray(e)&&!Xw(e)&&(t=e,e=void 0);const n=v3(t);let o=r;return typeof r=="string"&&(o=await n(r)),wf(r)&&(o=await n(r)),await e2(o,e,t)}const sH="3.4.14",{_parseImageNode:oH}=globalThis,t2=typeof Image<"u",r2=typeof ImageBitmap<"u",i2=Y_?!0:!!oH;function aH(r){switch(r){case"auto":return r2||t2||i2;case"imagebitmap":return r2;case"image":return t2;case"data":return i2;default:throw new Error("@loaders.gl/images: image ".concat(r," not supported in this environment"))}}function lH(){if(r2)return"imagebitmap";if(t2)return"image";if(i2)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function cH(r){const e=hH(r);if(!e)throw new Error("Not an image");return e}function uH(r){switch(cH(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function hH(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const AH=/^data:image\/svg\+xml/,dH=/\.svg((\?|#).*)?$/;function n2(r){return r&&(AH.test(r)||dH.test(r))}function fH(r,e){if(n2(e)){let i=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(o){throw new Error(o.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return b3(r,e)}function b3(r,e){if(n2(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function x3(r,e,t){const i=fH(r,t),n=self.URL||self.webkitURL,o=typeof i!="string"&&n.createObjectURL(i);try{return await pH(o||i,e)}finally{o&&n.revokeObjectURL(o)}}async function pH(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((i,n)=>{try{t.onload=()=>i(t),t.onerror=o=>n(new Error("Could not load image ".concat(r,": ").concat(o)))}catch(o){n(o)}})}const gH={};let w3=!0;async function mH(r,e,t){let i;n2(t)?i=await x3(r,e,t):i=b3(r,t);const n=e&&e.imagebitmap;return await yH(i,n)}async function yH(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((_H(e)||!w3)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),w3=!1}return await createImageBitmap(r)}function _H(r){for(const e in r||gH)return!1;return!0}function vH(r){return!BH(r,"ftyp",4)||!(r[8]&96)?null:bH(r)}function bH(r){switch(xH(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function xH(r,e,t){return String.fromCharCode(...r.slice(e,t))}function wH(r){return[...r].map(e=>e.charCodeAt(0))}function BH(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=wH(e);for(let n=0;n<i.length;++n)if(i[n]!==r[n+t])return!1;return!0}const Qh=!1,ly=!0;function s2(r){const e=cy(r);return EH(e)||IH(e)||SH(e)||TH(e)||CH(e)}function CH(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=vH(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function EH(r){const e=cy(r);return e.byteLength>=24&&e.getUint32(0,Qh)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Qh),height:e.getUint32(20,Qh)}:null}function SH(r){const e=cy(r);return e.byteLength>=10&&e.getUint32(0,Qh)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,ly),height:e.getUint16(8,ly)}:null}function TH(r){const e=cy(r);return e.byteLength>=14&&e.getUint16(0,Qh)===16973&&e.getUint32(2,ly)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,ly),height:e.getUint32(22,ly)}:null}function IH(r){const e=cy(r);if(!(e.byteLength>=3&&e.getUint16(0,Qh)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:n}=LH();let o=2;for(;o+9<e.byteLength;){const a=e.getUint16(o,Qh);if(n.has(a))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Qh),width:e.getUint16(o+7,Qh)};if(!i.has(a))return null;o+=2,o+=e.getUint16(o,Qh)}return null}function LH(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function cy(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function MH(r,e){const{mimeType:t}=s2(r)||{},i=globalThis._parseImageNode;return Ls(i),await i(r,t)}async function PH(r,e,t){e=e||{};const n=(e.image||{}).type||"auto",{url:o}=t||{},a=FH(n);let s;switch(a){case"imagebitmap":s=await mH(r,e,o);break;case"image":s=await x3(r,e,o);break;case"data":s=await MH(r);break;default:Ls(!1)}return n==="data"&&(s=uH(s)),s}function FH(r){switch(r){case"auto":case"data":return lH();default:return aH(r),r}}const B3={id:"image",module:"images",name:"Images",version:sH,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:PH,tests:[r=>!!s2(new DataView(r))],options:{image:{type:"auto",decode:!0}}},o2={};function DH(r){if(o2[r]===void 0){const e=Y_?kH(r):RH(r);o2[r]=e}return o2[r]}function RH(r){const e=["image/png","image/jpeg","image/gif"],{_parseImageNode:t,_imageFormatsNode:i=e}=globalThis;return!!t&&i.includes(r)}function kH(r){switch(r){case"image/avif":case"image/webp":return OH(r);default:return!0}}function OH(r){try{return document.createElement("canvas").toDataURL(r).indexOf("data:".concat(r))===0}catch{return!1}}function C3(r){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=r||e;return!!(t&&t.indexOf("Electron")>=0)}function SA(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||C3()}const n1={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},s1=n1.window||n1.self||n1.global,uy=n1.process||{},E3=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";SA();const a2=globalThis;function S3(r){if(!r&&!SA())return"Node";if(C3(r))return"Electron";const t=r||(typeof navigator<"u"?navigator:{}).userAgent||"";if(t.indexOf("Edge")>-1)return"Edge";const i=t.indexOf("MSIE ")!==-1,n=t.indexOf("Trident/")!==-1;return i||n?"IE":a2.chrome?"Chrome":a2.safari?"Safari":a2.mozInnerScreenX?"Firefox":"Unknown"}function UH(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class NH{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";ye(this,"storage",void 0),ye(this,"id",void 0),ye(this,"config",void 0),this.storage=UH(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function zH(r){let e;return r<10?e="".concat(r.toFixed(2),"ms"):r<100?e="".concat(r.toFixed(1),"ms"):r<1e3?e="".concat(r.toFixed(0),"ms"):e="".concat((r/1e3).toFixed(2),"s"),e}function QH(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const t=Math.max(e-r.length,0);return"".concat(" ".repeat(t)).concat(r)}function l2(r,e,t){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const n=r.src.replace(/\(/g,"%28").replace(/\)/g,"%29");r.width>i&&(t=Math.min(t,i/r.width));const o=r.width*t,a=r.height*t,s=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(n,");"),"background-size:".concat(o,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),s]}let o1;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(o1||(o1={}));function T3(r){return typeof r=="string"?o1[r.toUpperCase()]||o1.WHITE:r}function VH(r,e,t){return!SA&&typeof r=="string"&&(e&&(e=T3(e),r="\x1B[".concat(e,"m").concat(r,"\x1B[39m")),t&&(e=T3(t),r="\x1B[".concat(t+10,"m").concat(r,"\x1B[49m"))),r}function HH(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const t=Object.getPrototypeOf(r),i=Object.getOwnPropertyNames(t);for(const n of i)typeof r[n]=="function"&&(e.find(o=>n===o)||(r[n]=r[n].bind(r)))}function a1(r,e){if(!r)throw new Error(e||"Assertion failed")}function tg(){let r;if(SA&&"performance"in s1){var e,t;r=s1==null||(e=s1.performance)===null||e===void 0||(t=e.now)===null||t===void 0?void 0:t.call(e)}else if("hrtime"in uy){var i;const n=uy==null||(i=uy.hrtime)===null||i===void 0?void 0:i.call(uy);r=n[0]*1e3+n[1]/1e6}else r=Date.now();return r}const rg={debug:SA&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},GH={enabled:!0,level:0};function Iu(){}const I3={},L3={once:!0};class c2{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};ye(this,"id",void 0),ye(this,"VERSION",E3),ye(this,"_startTs",tg()),ye(this,"_deltaTs",tg()),ye(this,"_storage",void 0),ye(this,"userData",{}),ye(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new NH("__probe-".concat(this.id,"__"),GH),this.timeStamp("".concat(this.id," started")),HH(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((tg()-this._startTs).toPrecision(10))}getDelta(){return Number((tg()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){a1(e,t)}warn(e){return this._getLogFunction(0,e,rg.warn,arguments,L3)}error(e){return this._getLogFunction(0,e,rg.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,rg.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,rg.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),o=2;o<i;o++)n[o-2]=arguments[o];return this._getLogFunction(e,t,rg.debug||rg.info,arguments,L3)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||Iu,i&&[i],{tag:KH(t)}):Iu}image(e){let{logLevel:t,priority:i,image:n,message:o="",scale:a=1}=e;return this._shouldLog(t||i)?SA?$H({image:n,message:o,scale:a}):qH():Iu}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Iu)}group(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const n=P3({logLevel:e,message:t,opts:i}),{collapsed:o}=i;return n.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Iu)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=M3(e)}_getLogFunction(e,t,i,n,o){if(this._shouldLog(e)){o=P3({logLevel:e,message:t,args:n,opts:o}),i=i||o.method,a1(i),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=tg();const a=o.tag||o.message;if(o.once)if(!I3[a])I3[a]=tg();else return Iu;return t=jH(this.id,o.message,o),i.bind(console,t,...o.args)}return Iu}}ye(c2,"VERSION",E3);function M3(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return a1(Number.isFinite(e)&&e>=0),e}function P3(r){const{logLevel:e,message:t}=r;r.logLevel=M3(e);const i=r.args?Array.from(r.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const n=typeof r.message;return a1(n==="string"||n==="object"),Object.assign(r,{args:i},r.opts)}function jH(r,e,t){if(typeof e=="string"){const i=t.time?QH(zH(t.total)):"";e=t.time?"".concat(r,": ").concat(i,"  ").concat(e):"".concat(r,": ").concat(e),e=VH(e,t.color,t.background)}return e}function qH(r){return console.warn("removed"),Iu}function $H(r){let{image:e,message:t="",scale:i=1}=r;if(typeof e=="string"){const o=new Image;return o.onload=()=>{const a=l2(o,t,i);console.log(...a)},o.src=e,Iu}const n=e.nodeName||"";if(n.toLowerCase()==="img")return console.log(...l2(e,t,i)),Iu;if(n.toLowerCase()==="canvas"){const o=new Image;return o.onload=()=>console.log(...l2(o,t,i)),o.src=e.toDataURL(),Iu}return Iu}function KH(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}const On=new c2({id:"deck"}),hd={attributeUpdateStart:-1,attributeManagerUpdateStart:-1,attributeUpdateMessages:[]},u2=1,hy=2,h2=3,A2=4,WH=2,XH=r=>({"layer.changeFlag":(e,t,i)=>{r.log(h2,"".concat(e.id," ").concat(t,": "),i[t])()},"layer.initialize":e=>{r.log(u2,"Initializing ".concat(e))()},"layer.update":(e,t)=>{if(t){const i=e.getChangeFlags();r.log(hy,"Updating ".concat(e," because: ").concat(Object.keys(i).filter(n=>i[n]).join(", ")))()}else r.log(A2,"".concat(e," does not need update"))()},"layer.matched":(e,t)=>{t&&r.log(A2,"Matched ".concat(e,", state transfered"))()},"layer.finalize":e=>{r.log(u2,"Finalizing ".concat(e))()},"compositeLayer.renderLayers":(e,t,i)=>{t?r.log(hy,"Composite layer rendered new subLayers ".concat(e),i)():r.log(A2,"Composite layer reused subLayers ".concat(e),i)()},"layerManager.setLayers":(e,t,i)=>{t&&r.log(hy,"Updating ".concat(i.length," deck layers"))()},"layerManager.activateViewport":(e,t)=>{r.log(h2,"Viewport changed",t)()},"attributeManager.invalidate":(e,t,i)=>{r.log(u2,i?"invalidated attributes ".concat(i," (").concat(t,") for ").concat(e.id):"invalidated all attributes for ".concat(e.id))()},"attributeManager.updateStart":e=>{hd.attributeUpdateMessages.length=0,hd.attributeManagerUpdateStart=Date.now()},"attributeManager.updateEnd":(e,t)=>{const i=Math.round(Date.now()-hd.attributeManagerUpdateStart);r.groupCollapsed(hy,"Updated attributes for ".concat(t," instances in ").concat(e.id," in ").concat(i,"ms"))();for(const n of hd.attributeUpdateMessages)r.log(h2,n)();r.groupEnd(hy)()},"attribute.updateStart":e=>{hd.attributeUpdateStart=Date.now()},"attribute.allocate":(e,t)=>{const i="".concat(e.id," allocated ").concat(t);hd.attributeUpdateMessages.push(i)},"attribute.updateEnd":(e,t)=>{const i=Math.round(Date.now()-hd.attributeUpdateStart),n="".concat(e.id," updated ").concat(t," in ").concat(i,"ms");hd.attributeUpdateMessages.push(n)},"deckRenderer.renderLayers":(e,t,i)=>{const{pass:n,redrawReason:o,stats:a}=i;for(const s of t){const{totalCount:g,visibleCount:y,compositeCount:T,pickableCount:I}=s,U=g-T-y;r.log(WH,"RENDER #".concat(e.renderCount,"   ").concat(y," (of ").concat(g," layers) to ").concat(n," because ").concat(o,"   (").concat(U," hidden, ").concat(T," composite ").concat(I," pickable)"))(),a&&a.get("Redraw Layers").add(y)}}});var ZH={};let l1={};ZH.NODE_ENV!=="production"&&(l1=XH(On));function JH(r){l1=r}function Ml(r,e,t,i){On.level>0&&l1[r]&&l1[r].call(null,e,t,i)}function YH(r){const e=r[0],t=r[r.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const e9={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:YH,parseTextSync:JSON.parse};function t9(){const r="8.9.35",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==r)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(r));return e||(On.log(1,"deck.gl ".concat(r))(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:On,_registerLoggers:JH},FV([e9,[B3,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}const r9=t9(),Mn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Mn,"IDENTITY",{get:()=>(On.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Vh={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},d2={common:0,meters:1,pixels:2},F3={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},Ai=new c2({id:"luma.gl"});function hc(r,e){if(!r)throw new Error(e||"luma.gl: assertion failed.")}const i9="Invalid WebGLRenderingContext",n9="Requires WebGL2";function c1(r){return typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}function dn(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&r._version===2)}function s9(r){return dn(r)?r:null}function u1(r){return hc(c1(r),i9),r}function Ac(r){return hc(dn(r),n9),r}const Ay={};function o9(r){globalThis.console&&globalThis.console.error&&globalThis.console.error(r)}function a9(r){globalThis.console&&globalThis.console.log&&globalThis.console.log(r)}function l9(r,e){Ay[r]=!0,e!==void 0&&o9(e)}function c9(r){const e=r.getError;r.getError=function(){let i;do i=e.apply(r),i!==0&&(Ay[i]=!0);while(i!==0);for(i in Ay)if(Ay[i])return delete Ay[i],parseInt(i,10);return 0}}const dy=function r(e){const t=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const n=new r.VertexAttrib(t);this.attribs[i]=n}this.maxAttrib=0};dy.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()},dy.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Bf=function(e){const t=this;this.gl=e,c9(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(o){return o===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(o){const a=t.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,o);const s=a.attribs[o];return s.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(o){const a=t.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,o);const s=a.attribs[o];return s.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(o,a){switch(o){case 34962:t.currentArrayBuffer=a;break;case 34963:t.currentVertexArrayObject.elementArrayBuffer=a;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(o,a){const g=t.currentVertexArrayObject.attribs[o];switch(a){case 34975:return g.buffer;case 34338:return g.enabled;case 34339:return g.size;case 34340:return g.stride;case 34341:return g.type;case 34922:return g.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(o,a,s,g,y,T){const I=t.currentVertexArrayObject;I.maxAttrib=Math.max(I.maxAttrib,o);const R=I.attribs[o];return R.buffer=t.currentArrayBuffer,R.size=a,R.type=s,R.normalized=g,R.stride=y,R.offset=T,R.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{a9("OESVertexArrayObject emulation library context restored"),t.reset_()},!0),this.reset_()};Bf.prototype.VERTEX_ARRAY_BINDING_OES=34229,Bf.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const t=this.gl;this.maxVertexAttribs=t.getParameter(34921),this.defaultVertexArrayObject=new dy(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},Bf.prototype.createVertexArrayOES=function(){const e=new dy(this);return this.vertexArrayObjects.push(e),e},Bf.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},Bf.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof dy&&e.hasBeenBound&&e.ext===this)},Bf.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive){l9(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,n=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const o=this.currentVertexArrayObject;if(n===o)return;(!n||o.elementArrayBuffer!==n.elementArrayBuffer)&&i.bindBuffer.call(t,34963,o.elementArrayBuffer);let a=this.currentArrayBuffer;const s=Math.max(n?n.maxAttrib:0,o.maxAttrib);for(let g=0;g<=s;g++){const y=o.attribs[g],T=n?n.attribs[g]:null;if((!n||y.enabled!==T.enabled)&&(y.enabled?i.enableVertexAttribArray.call(t,g):i.disableVertexAttribArray.call(t,g)),y.enabled){let I=!1;(!n||y.buffer!==T.buffer)&&(a!==y.buffer&&(i.bindBuffer.call(t,34962,y.buffer),a=y.buffer),I=!0),(I||y.cached!==T.cached)&&i.vertexAttribPointer.call(t,g,y.size,y.type,y.normalized,y.stride,y.offset)}}this.currentArrayBuffer!==a&&i.bindBuffer.call(t,34962,this.currentArrayBuffer)};function u9(r){if(typeof r.createVertexArray=="function")return;const e=r.getSupportedExtensions;r.getSupportedExtensions=function(){const n=e.call(this)||[];return n.indexOf("OES_vertex_array_object")<0&&n.push("OES_vertex_array_object"),n};const t=r.getExtension;r.getExtension=function(n){const o=t.call(this,n);return o||(n!=="OES_vertex_array_object"?null:(r.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Bf(this)),this.__OESVertexArrayObject))}}const D3="OES_element_index",R3="WEBGL_draw_buffers",h9="EXT_disjoint_timer_query",A9="EXT_disjoint_timer_query_webgl2",d9="EXT_texture_filter_anisotropic",k3="WEBGL_debug_renderer_info",f9=35723,p9=4352,g9=36795,m9=34047,y9=37445,_9=37446,Vs=r=>dn(r)?void 0:0,v9={3074:r=>dn(r)?void 0:36064,[f9]:r=>dn(r)?void 0:p9,35977:Vs,32937:Vs,[g9]:(r,e)=>{const t=dn(r)?r.getExtension(A9):r.getExtension(h9);return t&&t.GPU_DISJOINT_EXT?e(t.GPU_DISJOINT_EXT):0},[y9]:(r,e)=>{const t=r.getExtension(k3);return e(t&&t.UNMASKED_VENDOR_WEBGL||7936)},[_9]:(r,e)=>{const t=r.getExtension(k3);return e(t&&t.UNMASKED_RENDERER_WEBGL||7937)},[m9]:(r,e)=>{const t=r.luma.extensions[d9];return t?e(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:Vs,35071:Vs,37447:Vs,36063:(r,e)=>{if(!dn(r)){const t=r.getExtension(R3);return t?e(t.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:Vs,35374:Vs,35377:Vs,34852:r=>{if(!dn(r)){const e=r.getExtension(R3);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:r=>r.getExtension(D3)?2147483647:65535,33001:r=>r.getExtension(D3)?16777216:65535,33e3:r=>16777216,37157:Vs,35373:Vs,35657:Vs,36183:Vs,37137:Vs,34045:Vs,35978:Vs,35979:Vs,35968:Vs,35376:Vs,35375:Vs,35659:Vs,37154:Vs,35371:Vs,35658:Vs,35076:Vs,35077:Vs,35380:Vs};function b9(r,e,t){const i=v9[t],n=typeof i=="function"?i(r,e,t):i;return n!==void 0?n:e(t)}const x9="OES_vertex_array_object",O3="ANGLE_instanced_arrays",w9="WEBGL_draw_buffers",B9="EXT_disjoint_timer_query",C9="EXT_texture_filter_anisotropic",E9="VertexArray requires WebGL2 or OES_vertex_array_object extension";function S9(r,e){return{webgl2:dn(r),ext:r.getExtension(e)}}const U3={[x9]:{meta:{suffix:"OES"},createVertexArray:()=>{hc(!1,E9)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[O3]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(r,e){hc(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[w9]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{hc(!1)}},[B9]:{meta:{suffix:"EXT"},createQuery:()=>{hc(!1)},deleteQuery:()=>{hc(!1)},beginQuery:()=>{hc(!1)},endQuery:()=>{},getQuery(r,e){return this.getQueryObject(r,e)},getQueryParameter(r,e){return this.getQueryObject(r,e)},getQueryObject:()=>{}}},f2={readBuffer:(r,e,t)=>{dn(r)&&e(t)},getVertexAttrib:(r,e,t,i)=>{const{webgl2:n,ext:o}=S9(r,O3);let a;switch(i){case 35069:a=n?void 0:!1;break;case 35070:a=!n&&!o?0:void 0;break}return a!==void 0?a:e(t,i)},getProgramParameter:(r,e,t,i)=>{if(!dn(r))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(t,i)},getInternalformatParameter:(r,e,t,i,n)=>{if(!dn(r))switch(n){case 32937:return new Int32Array([0])}return r.getInternalformatParameter(t,i,n)},getTexParameter(r,e,t,i){switch(i){case 34046:const{extensions:n}=r.luma,o=n[C9];i=o&&o.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(t,i)},getParameter:b9,hint(r,e,t,i){return e(t,i)}};function T9(r){r.luma=r.luma||{};const{luma:e}=r;return e.polyfilled||(u9(r),I9(r),M9(r,U3),L9(r,{target:e,target2:r}),e.polyfilled=!0),r}globalThis.polyfillContext=T9;function I9(r){r.luma.extensions={};const e=r.getSupportedExtensions()||[];for(const t of e)r.luma[t]=r.getExtension(t)}function L9(r,e){let{target:t,target2:i}=e;Object.keys(f2).forEach(n=>{if(typeof f2[n]=="function"){const o=r[n]?r[n].bind(r):()=>{},a=f2[n].bind(null,r,o);t[n]=a,i[n]=a}})}function M9(r,e){for(const t of Object.getOwnPropertyNames(e))t!=="overrides"&&P9(r,{extension:t,target:r.luma,target2:r})}function P9(r,e){let{extension:t,target:i,target2:n}=e;const o=U3[t];hc(o);const{meta:a={}}=o,{suffix:s=""}=a,g=r.getExtension(t);for(const y of Object.keys(o)){const T="".concat(y).concat(s);let I=null;y==="meta"||typeof r[y]=="function"||(g&&typeof g[T]=="function"?I=function(){return g[T](...arguments)}:typeof o[y]=="function"&&(I=o[y].bind(i))),I&&(i[y]=I,n[y]=I)}}const p2={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ad=(r,e,t)=>e?r.enable(t):r.disable(t),N3=(r,e,t)=>r.hint(t,e),ru=(r,e,t)=>r.pixelStorei(t,e),F9=(r,e)=>{const t=dn(r)?36009:36160;return r.bindFramebuffer(t,e)},D9=(r,e)=>r.bindFramebuffer(36008,e);function fy(r){return Array.isArray(r)||ArrayBuffer.isView(r)}const R9={3042:Ad,32773:(r,e)=>r.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,e)=>r.clearColor(...e),3107:(r,e)=>r.colorMask(...e),2884:Ad,2885:(r,e)=>r.cullFace(e),2929:Ad,2931:(r,e)=>r.clearDepth(e),2932:(r,e)=>r.depthFunc(e),2928:(r,e)=>r.depthRange(...e),2930:(r,e)=>r.depthMask(e),3024:Ad,35723:N3,36006:F9,2886:(r,e)=>r.frontFace(e),33170:N3,2849:(r,e)=>r.lineWidth(e),32823:Ad,32824:"polygonOffset",10752:"polygonOffset",35977:Ad,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ad,3088:(r,e)=>r.scissor(...e),2960:Ad,2961:(r,e)=>r.clearStencil(e),2968:(r,e)=>r.stencilMaskSeparate(1028,e),36005:(r,e)=>r.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,e)=>r.viewport(...e),3333:ru,3317:ru,37440:ru,37441:ru,37443:ru,3330:ru,3332:ru,3331:ru,36010:D9,3314:ru,32878:ru,3316:ru,3315:ru,32877:ru,framebuffer:(r,e)=>{const t=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,t)},blend:(r,e)=>e?r.enable(3042):r.disable(3042),blendColor:(r,e)=>r.blendColor(...e),blendEquation:(r,e)=>{e=fy(e)?e:[e,e],r.blendEquationSeparate(...e)},blendFunc:(r,e)=>{e=fy(e)&&e.length===2?[...e,...e]:e,r.blendFuncSeparate(...e)},clearColor:(r,e)=>r.clearColor(...e),clearDepth:(r,e)=>r.clearDepth(e),clearStencil:(r,e)=>r.clearStencil(e),colorMask:(r,e)=>r.colorMask(...e),cull:(r,e)=>e?r.enable(2884):r.disable(2884),cullFace:(r,e)=>r.cullFace(e),depthTest:(r,e)=>e?r.enable(2929):r.disable(2929),depthFunc:(r,e)=>r.depthFunc(e),depthMask:(r,e)=>r.depthMask(e),depthRange:(r,e)=>r.depthRange(...e),dither:(r,e)=>e?r.enable(3024):r.disable(3024),derivativeHint:(r,e)=>{r.hint(35723,e)},frontFace:(r,e)=>r.frontFace(e),mipmapHint:(r,e)=>r.hint(33170,e),lineWidth:(r,e)=>r.lineWidth(e),polygonOffsetFill:(r,e)=>e?r.enable(32823):r.disable(32823),polygonOffset:(r,e)=>r.polygonOffset(...e),sampleCoverage:(r,e)=>r.sampleCoverage(...e),scissorTest:(r,e)=>e?r.enable(3089):r.disable(3089),scissor:(r,e)=>r.scissor(...e),stencilTest:(r,e)=>e?r.enable(2960):r.disable(2960),stencilMask:(r,e)=>{e=fy(e)?e:[e,e];const[t,i]=e;r.stencilMaskSeparate(1028,t),r.stencilMaskSeparate(1029,i)},stencilFunc:(r,e)=>{e=fy(e)&&e.length===3?[...e,...e]:e;const[t,i,n,o,a,s]=e;r.stencilFuncSeparate(1028,t,i,n),r.stencilFuncSeparate(1029,o,a,s)},stencilOp:(r,e)=>{e=fy(e)&&e.length===3?[...e,...e]:e;const[t,i,n,o,a,s]=e;r.stencilOpSeparate(1028,t,i,n),r.stencilOpSeparate(1029,o,a,s)},viewport:(r,e)=>r.viewport(...e)};function Bo(r,e,t){return e[r]!==void 0?e[r]:t[r]}const k9={blendEquation:(r,e,t)=>r.blendEquationSeparate(Bo(32777,e,t),Bo(34877,e,t)),blendFunc:(r,e,t)=>r.blendFuncSeparate(Bo(32969,e,t),Bo(32968,e,t),Bo(32971,e,t),Bo(32970,e,t)),polygonOffset:(r,e,t)=>r.polygonOffset(Bo(32824,e,t),Bo(10752,e,t)),sampleCoverage:(r,e,t)=>r.sampleCoverage(Bo(32938,e,t),Bo(32939,e,t)),stencilFuncFront:(r,e,t)=>r.stencilFuncSeparate(1028,Bo(2962,e,t),Bo(2967,e,t),Bo(2963,e,t)),stencilFuncBack:(r,e,t)=>r.stencilFuncSeparate(1029,Bo(34816,e,t),Bo(36003,e,t),Bo(36004,e,t)),stencilOpFront:(r,e,t)=>r.stencilOpSeparate(1028,Bo(2964,e,t),Bo(2965,e,t),Bo(2966,e,t)),stencilOpBack:(r,e,t)=>r.stencilOpSeparate(1029,Bo(34817,e,t),Bo(34818,e,t),Bo(34819,e,t))},z3={enable:(r,e)=>r({[e]:!0}),disable:(r,e)=>r({[e]:!1}),pixelStorei:(r,e,t)=>r({[e]:t}),hint:(r,e,t)=>r({[e]:t}),bindFramebuffer:(r,e,t)=>{switch(e){case 36160:return r({36006:t,36010:t});case 36009:return r({36006:t});case 36008:return r({36010:t});default:return null}},blendColor:(r,e,t,i,n)=>r({32773:new Float32Array([e,t,i,n])}),blendEquation:(r,e)=>r({32777:e,34877:e}),blendEquationSeparate:(r,e,t)=>r({32777:e,34877:t}),blendFunc:(r,e,t)=>r({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(r,e,t,i,n)=>r({32969:e,32968:t,32971:i,32970:n}),clearColor:(r,e,t,i,n)=>r({3106:new Float32Array([e,t,i,n])}),clearDepth:(r,e)=>r({2931:e}),clearStencil:(r,e)=>r({2961:e}),colorMask:(r,e,t,i,n)=>r({3107:[e,t,i,n]}),cullFace:(r,e)=>r({2885:e}),depthFunc:(r,e)=>r({2932:e}),depthRange:(r,e,t)=>r({2928:new Float32Array([e,t])}),depthMask:(r,e)=>r({2930:e}),frontFace:(r,e)=>r({2886:e}),lineWidth:(r,e)=>r({2849:e}),polygonOffset:(r,e,t)=>r({32824:e,10752:t}),sampleCoverage:(r,e,t)=>r({32938:e,32939:t}),scissor:(r,e,t,i,n)=>r({3088:new Int32Array([e,t,i,n])}),stencilMask:(r,e)=>r({2968:e,36005:e}),stencilMaskSeparate:(r,e,t)=>r({[e===1028?2968:36005]:t}),stencilFunc:(r,e,t,i)=>r({2962:e,2967:t,2963:i,34816:e,36003:t,36004:i}),stencilFuncSeparate:(r,e,t,i,n)=>r({[e===1028?2962:34816]:t,[e===1028?2967:36003]:i,[e===1028?2963:36004]:n}),stencilOp:(r,e,t,i)=>r({2964:e,2965:t,2966:i,34817:e,34818:t,34819:i}),stencilOpSeparate:(r,e,t,i,n)=>r({[e===1028?2964:34817]:t,[e===1028?2965:34818]:i,[e===1028?2966:34819]:n}),viewport:(r,e,t,i,n)=>r({2978:[e,t,i,n]})},Hh=(r,e)=>r.isEnabled(e),Q3={3042:Hh,2884:Hh,2929:Hh,3024:Hh,32823:Hh,32926:Hh,32928:Hh,3089:Hh,2960:Hh,35977:Hh};function V3(r){for(const e in r)return!1;return!0}function O9(r,e){if(r===e)return!0;const t=Array.isArray(r)||ArrayBuffer.isView(r),i=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&i&&r.length===e.length){for(let n=0;n<r.length;++n)if(r[n]!==e[n])return!1;return!0}return!1}function H3(r,e){const t=r[e].bind(r);r[e]=function(){const n=arguments.length<=0?void 0:arguments[0];return n in r.state.cache?r.state.enable?r.state.cache[n]:t(...arguments):t(...arguments)},Object.defineProperty(r[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function U9(r,e,t){const i=r[e].bind(r);r[e]=function(){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];const{valueChanged:g,oldValue:y}=t(r.state._updateCache,...a);return g&&i(...a),y},Object.defineProperty(r[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function N9(r){const e=r.useProgram.bind(r);r.useProgram=function(i){r.state.program!==i&&(e(i),r.state.program=i)}}class z9{constructor(e){let{copyState:t=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=t?V9(e):Object.assign({},p2),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){hc(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];TA(this.gl,e),this.stateStack.pop()}_updateCache(e){let t=!1,i;const n=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const o in e){hc(o!==void 0);const a=e[o],s=this.cache[o];O9(a,s)||(t=!0,i=s,n&&!(o in n)&&(n[o]=s),this.cache[o]=a)}return{valueChanged:t,oldValue:i}}}function G3(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:t=!0,copyState:i}=e;if(hc(i!==void 0),!r.state){const{polyfillContext:n}=globalThis;n&&n(r),r.state=new z9(r,{copyState:i}),N9(r);for(const o in z3){const a=z3[o];U9(r,o,a)}H3(r,"getParameter"),H3(r,"isEnabled")}return r.state.enable=t,r}function Q9(r){r.state||G3(r,{copyState:!1}),r.state.push()}function j3(r){hc(r.state),r.state.pop()}function TA(r,e){if(hc(c1(r),"setParameters requires a WebGL context"),V3(e))return;const t={};for(const n in e){const o=Number(n),a=R9[n];a&&(typeof a=="string"?t[a]=!0:a(r,e[n],o))}const i=r.state&&r.state.cache;if(i)for(const n in t){const o=k9[n];o(r,e,i)}}function V9(r,e){if(e=e||p2,typeof e=="number"){const n=e,o=Q3[n];return o?o(r,n):r.getParameter(n)}const t=Array.isArray(e)?e:Object.keys(e),i={};for(const n of t){const o=Q3[n];i[n]=o?o(r,Number(n)):r.getParameter(Number(n))}return i}function H9(r){TA(r,p2)}function nh(r,e,t){if(V3(e))return t(r);const{nocatch:i=!0}=e;Q9(r),TA(r,e);let n;if(i)n=t(r),j3(r);else try{n=t(r)}finally{j3(r)}return n}function ig(r){const{luma:e}=r;if(r.canvas&&e){const t=e.canvasSizeInfo,i="clientWidth"in t?t.clientWidth:r.canvas.clientWidth;return i?r.drawingBufferWidth/i:1}return 1}function g2(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=ig(r),n=r.drawingBufferWidth,o=r.drawingBufferHeight;return j9(e,i,n,o,t)}function G9(r){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(r)?r<=0?1:r:r?e:1}function j9(r,e,t,i,n){const o=q3(r[0],e,t);let a=$3(r[1],e,i,n),s=q3(r[0]+1,e,t);const g=s===t-1?s:s-1;s=$3(r[1]+1,e,i,n);let y;return n?(s=s===0?s:s+1,y=a,a=s):y=s===i-1?s:s-1,{x:o,y:a,width:Math.max(g-o+1,1),height:Math.max(y-a+1,1)}}function q3(r,e,t){return Math.min(Math.round(r*e),t-1)}function $3(r,e,t,i){return i?Math.max(0,t-1-Math.round(r*e)):Math.min(Math.round(r*e),t-1)}const m2=SA(),q9=m2&&typeof document<"u",K3={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function W3(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};hc(m2,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),r=Object.assign({},K3,r);const{width:e,height:t}=r;function i(s){if(r.throwOnError)throw new Error(s);return console.error(s),null}r.onError=i;let n;const{canvas:o}=r,a=X9({canvas:o,width:e,height:t,onError:i});return n=W9(a,r),n?(n=y2(n,r),Z9(n),n):null}function y2(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!r||r._instrumented)return r;r._version=r._version||J9(r),r.luma=r.luma||{},r.luma.canvasSizeInfo=r.luma.canvasSizeInfo||{},e=Object.assign({},K3,e);const{manageState:t,debug:i}=e;return t&&G3(r,{copyState:!1,log:function(){for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return Ai.log(1,...o)()}}),m2&&i&&(globalThis.makeDebugContext?(r=globalThis.makeDebugContext(r,e),Ai.level=Math.max(Ai.level,1)):Ai.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),r._instrumented=!0,r}function $9(r){const e=r.getParameter(7936),t=r.getParameter(7937),i=r.getExtension("WEBGL_debug_renderer_info"),n=i&&r.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),o=i&&r.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:n||e,renderer:o||t,vendorMasked:e,rendererMasked:t,version:r.getParameter(7938),shadingLanguageVersion:r.getParameter(35724)}}function K9(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(r.canvas){const i=G9(e.useDevicePixels);Y9(r,i,e);return}const t=r.getExtension("STACKGL_resize_drawingbuffer");t&&"width"in e&&"height"in e&&t.resize(e.width,e.height)}function W9(r,e){const{onError:t}=e;let i=null;const n=g=>i=g.statusMessage||i;r.addEventListener("webglcontextcreationerror",n,!1);const{webgl1:o=!0,webgl2:a=!0}=e;let s=null;return a&&(s=s||r.getContext("webgl2",e),s=s||r.getContext("experimental-webgl2",e)),o&&(s=s||r.getContext("webgl",e),s=s||r.getContext("experimental-webgl",e)),r.removeEventListener("webglcontextcreationerror",n,!1),s?(e.onContextLost&&r.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&r.addEventListener("webglcontextrestored",e.onContextRestored,!1),s):t("Failed to create ".concat(a&&!o?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function X9(r){let{canvas:e,width:t=800,height:i=600,onError:n}=r,o;return typeof e=="string"?(q9&&document.readyState==="complete"||n("createGLContext called on canvas '".concat(e,"' before page was loaded")),o=document.getElementById(e)):e?o=e:(o=document.createElement("canvas"),o.id="lumagl-canvas",o.style.width=Number.isFinite(t)?"".concat(t,"px"):"100%",o.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(o,document.body.firstChild)),o}function Z9(r){const e=dn(r)?"WebGL2":"WebGL1",t=$9(r),i=t?"(".concat(t.vendor,",").concat(t.renderer,")"):"",n=r.debug?" debug":"";Ai.info(1,"".concat(e).concat(n," context ").concat(i))()}function J9(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?2:1}function Y9(r,e,t){let i="width"in t?t.width:r.canvas.clientWidth,n="height"in t?t.height:r.canvas.clientHeight;(!i||!n)&&(Ai.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=r.canvas.width||1,n=r.canvas.height||1),r.luma=r.luma||{},r.luma.canvasSizeInfo=r.luma.canvasSizeInfo||{};const o=r.luma.canvasSizeInfo;if(o.clientWidth!==i||o.clientHeight!==n||o.devicePixelRatio!==e){let a=e;const s=Math.floor(i*a),g=Math.floor(n*a);r.canvas.width=s,r.canvas.height=g,(r.drawingBufferWidth!==s||r.drawingBufferHeight!==g)&&(Ai.warn("Device pixel ratio clamped")(),a=Math.min(r.drawingBufferWidth/i,r.drawingBufferHeight/n),r.canvas.width=Math.floor(i*a),r.canvas.height=Math.floor(n*a)),Object.assign(r.luma.canvasSizeInfo,{clientWidth:i,clientHeight:n,devicePixelRatio:e})}}function X3(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}let Z3=class{constructor(e,t){ye(this,"name",void 0),ye(this,"type",void 0),ye(this,"sampleSize",1),ye(this,"time",void 0),ye(this,"count",void 0),ye(this,"samples",void 0),ye(this,"lastTiming",void 0),ye(this,"lastSampleTime",void 0),ye(this,"lastSampleCount",void 0),ye(this,"_count",0),ye(this,"_time",0),ye(this,"_samples",0),ye(this,"_startTime",0),ye(this,"_timerPending",!1),this.name=e,this.type=t,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=X3(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(X3()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},_2=class{constructor(e){ye(this,"id",void 0),ye(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const t in this.stats)e(this.stats[t])}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){if(!e||!e.name)return null;const{name:t,type:i}=e;return this.stats[t]||(e instanceof Z3?this.stats[t]=e:this.stats[t]=new Z3(t,i)),this.stats[t]}};const py="8.5.21",e7="set luma.log.level=1 (or higher) to trace rendering";class t7{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new _2({id:e})),this.stats.get(e)}}const Cf=new t7;if(globalThis.luma&&globalThis.luma.VERSION!==py)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(py));globalThis.luma||(SA()&&Ai.log(1,"luma.gl ".concat(py," - ").concat(e7))(),globalThis.luma=globalThis.luma||{VERSION:py,version:py,log:Ai,stats:Cf,globals:{modules:{},nodeIO:{}}});function r7(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function i7(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}function Jr(r,e){if(!r)throw new Error(e||"luma.gl: assertion failed.")}function v2(r,e){if(typeof e!="string")return e;const t=Number(e);if(!isNaN(t))return t;e=e.replace(/^.*\./,"");const i=r[e];return Jr(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function dd(r,e){e=Number(e);for(const t in r)if(r[t]===e)return"GL.".concat(t);return String(e)}const b2={};function IA(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";b2[r]=b2[r]||1;const e=b2[r]++;return"".concat(r,"-").concat(e)}function J3(r){return Jr(typeof r=="number","Input must be a number"),r&&(r&r-1)===0}function ng(r){let e=!0;for(const t in r){e=!1;break}return e}function Y3(r,e,t,i){const n="See luma.gl ".concat(t," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),o=Object.getPrototypeOf(r);i.forEach(a=>{o.methodName||(o[a]=()=>{throw Ai.removed("Calling removed method ".concat(e,".").concat(a,": "),n)(),new Error(a)})})}const sg="Resource subclass must define virtual methods";let LA=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};u1(e);const{id:i,userData:n={}}=t;this.gl=e,this.gl2=e,this.id=i||IA(this[Symbol.toStringTag]),this.userData=n,this._bound=!1,this._handle=t.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=v2(this.gl,e),Jr(e);const n=(this.constructor.PARAMETERS||{})[e];if(n){const o=dn(this.gl);if(!((!("webgl2"in n)||o)&&(!("extension"in n)||this.gl.getExtension(n.extension)))){const s=n.webgl1,g="webgl2"in n?n.webgl2:n.webgl1;return o?g:s}}return this._getParameter(e,t)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:t,keys:i}=e,n=this.constructor.PARAMETERS||{},o=dn(this.gl),a={},s=t||Object.keys(n);for(const g of s){const y=n[g];if(y&&(!("webgl2"in y)||o)&&(!("extension"in y)||this.gl.getExtension(y.extension))){const I=i?dd(this.gl,g):g;a[I]=this.getParameter(g,e),i&&y.type==="GLenum"&&(a[I]=dd(this.gl,a[I]))}}return a}setParameter(e,t){e=v2(this.gl,e),Jr(e);const n=(this.constructor.PARAMETERS||{})[e];if(n){const o=dn(this.gl);if(!((!("webgl2"in n)||o)&&(!("extension"in n)||this.gl.getExtension(n.extension))))throw new Error("Parameter not available on this platform");n.type==="GLenum"&&(t=v2(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,i){return Y3(this,e,t,i)}initialize(e){}_createHandle(){throw new Error(sg)}_deleteHandle(){throw new Error(sg)}_bindHandle(e){throw new Error(sg)}_getOptsFromHandle(){throw new Error(sg)}_getParameter(e,t){throw new Error(sg)}_setParameter(e,t){throw new Error(sg)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],t=Cf.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get("".concat(e,"s Created")).incrementCount(),t.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Cf.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,t),this._trackAllocatedMemoryForContext(e,t,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const n=Cf.get("Memory Usage".concat(i));n.get("GPU Memory").addCount(e),n.get("".concat(t," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=Cf.get("Memory Usage".concat(t));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const n7="Failed to deduce GL constant from typed array";function x2(r){switch(ArrayBuffer.isView(r)?r.constructor:r){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(n7)}}function gy(r){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(r){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function s7(r){let{data:e,width:t,height:i,bytesPerPixel:n=4,temp:o}=r;const a=t*n;o=o||new Uint8Array(a);for(let s=0;s<i/2;++s){const g=s*a,y=(i-s-1)*a;o.set(e.subarray(g,g+a)),e.copyWithin(g,y,y+a),e.set(o,y)}}function o7(r){let{data:e,width:t,height:i}=r;const n=Math.round(t/2),o=Math.round(i/2),a=new Uint8Array(n*o*4);for(let s=0;s<o;s++)for(let g=0;g<n;g++)for(let y=0;y<4;y++)a[(s*n+g)*4+y]=e[(s*2*t+g*2)*4+y];return{data:a,width:n,height:o}}function w2(r,e,t){const{removedProps:i={},deprecatedProps:n={},replacedProps:o={}}=t;for(const s in i)if(s in e){const y=i[s]?"".concat(r,".").concat(i[s]):"N/A";Ai.removed("".concat(r,".").concat(s),y)()}for(const s in n)if(s in e){const g=n[s];Ai.deprecated("".concat(r,".").concat(s),"".concat(r,".").concat(g))()}let a=null;for(const s in o)if(s in e){const g=o[s];Ai.deprecated("".concat(r,".").concat(s),"".concat(r,".").concat(g))(),a=a||Object.assign({},e),a[g]=e[s],delete a[s]}return a||e}const a7={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},l7={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Dc{static getBytesPerElement(e){return gy(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return Jr(e.size),gy(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Dc(a7,...t)}constructor(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach(n=>this._assign(n)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Dc.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Dc.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=w2("Accessor",e,l7),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const eL=10,tL={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},c7={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:tL},u7={removedProps:tL};let ws=class extends LA{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?36662:34962),this.initialize(t),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Dc.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Dc.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=w2("Buffer",e,c7),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=w2("Buffer",e,u7),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Dc(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:i=0,srcOffset:n=0}=e,o=e.byteLength||e.length;Jr(t);const a=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(a,this.handle),n!==0||o!==void 0?(Ac(this.gl),this.gl.bufferSubData(this.target,i,t,n,o)):this.gl.bufferSubData(a,i,t),this.gl.bindBuffer(a,null),this.debugData=null,this._inferType(t),this}copyData(e){let{sourceBuffer:t,readOffset:i=0,writeOffset:n=0,size:o}=e;const{gl:a}=this;return Ac(a),a.bindBuffer(36662,t.handle),a.bindBuffer(36663,this.handle),a.copyBufferSubData(36662,36663,i,n,o),a.bindBuffer(36662,null),a.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:t=0,dstOffset:i=0,length:n=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ac(this.gl);const o=gy(this.accessor.type||5126,{clamped:!1}),a=this._getAvailableElementCount(t),s=i;let g,y;e?(y=e.length,g=y-s):(g=Math.min(a,n||a),y=s+g);const T=Math.min(a,g);return n=n||T,Jr(n<=T),e=e||new o(y),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,e,i,n),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:i=0,size:n}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?n!==void 0?this.gl.bindBufferRange(e,t,this.handle,i,n):(Jr(i===0),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:t=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(eL,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+t;Jr(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const n=this._getTarget();this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,i,this.usage),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this.debugData=e.slice(0,eL),this.bytesUsed=i,this._trackAllocatedMemory(i);const o=x2(e);return Jr(o),this.setAccessor(new Dc(this.accessor,{type:o})),this}_setByteLength(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;Jr(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const n=this._getTarget();return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,i,t),this.gl.bindBuffer(n,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const t=gy(this.accessor.type||5126,{clamped:!1}),i=e/t.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new Dc(this.accessor,{type:x2(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return Ai.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Ai.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Ai.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Ai.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Dc(this.accessor,e),this}};const B2={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},rL={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},iL={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function h7(r,e){const t=B2[e];if(!t)return!1;if(t.gl1===void 0&&t.gl2===void 0)return!0;const i=dn(r)&&t.gl2||t.gl1;return typeof i=="string"?r.getExtension(i):i}function A7(r,e){const t=B2[e];switch(t&&t.types[0]){case 5126:return r.getExtension("OES_texture_float_linear");case 5131:return r.getExtension("OES_texture_half_float_linear");default:return!0}}const d7=[9729,9728],nL=globalThis.WebGLBuffer||function(){};class og extends LA{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:n}=t;let o=!0;return i&&(o=o&&h7(e,i),o=o&&(!n||A7(e,i))),o}constructor(e,t){const{id:i=IA("texture"),handle:n,target:o}=t;super(e,{id:i,handle:n}),this.target=o,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.data;if(t instanceof Promise)return t.then(pe=>this.initialize(Object.assign({},e,{pixels:pe,data:pe}))),this;const i=typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement;if(i&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:n=null,format:o=6408,border:a=0,recreate:s=!1,parameters:g={},pixelStore:y={},textureUnit:T=void 0}=e;t||(t=n);let{width:I,height:R,dataFormat:U,type:Z,compressed:Y=!1,mipmaps:he=!0}=e;const{depth:ce=0}=e;return{width:I,height:R,compressed:Y,dataFormat:U,type:Z}=this._deduceParameters({format:o,type:Z,dataFormat:U,compressed:Y,data:t,width:I,height:R}),this.width=I,this.height=R,this.depth=ce,this.format=o,this.type=Z,this.dataFormat=U,this.border=a,this.textureUnit=T,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),he&&this._isNPOT()&&(Ai.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),he=!1,this._updateForNPOT(g)),this.mipmaps=he,this.setImageData({data:t,width:I,height:R,depth:ce,format:o,type:Z,dataFormat:U,border:a,mipmaps:he,parameters:y,compressed:Y}),he&&this.generateMipmap(),this.setParameters(g),s&&(this.data=t),i&&(this._video={video:t,parameters:g,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:t,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:t,width:i,mipmaps:n=!1}=e;return i!==this.width||t!==this.height?this.initialize({width:i,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:n}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Ai.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),nh(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:i=null,level:n=0,format:o=this.format,border:a=this.border,offset:s=0,parameters:g={}}=e;let{data:y=null,type:T=this.type,width:I=this.width,height:R=this.height,dataFormat:U=this.dataFormat,compressed:Z=!1}=e;y||(y=i),{type:T,dataFormat:U,compressed:Z,width:I,height:R}=this._deduceParameters({format:o,type:T,dataFormat:U,compressed:Z,data:y,width:I,height:R});const{gl:Y}=this;Y.bindTexture(this.target,this.handle);let he=null;({data:y,dataType:he}=this._getDataType({data:y,compressed:Z}));let ce,pe=0;if(nh(this.gl,g,()=>{switch(he){case"null":Y.texImage2D(t,n,o,I,R,a,U,T,y);break;case"typed-array":Y.texImage2D(t,n,o,I,R,a,U,T,y,s);break;case"buffer":ce=Ac(Y),ce.bindBuffer(35052,y.handle||y),ce.texImage2D(t,n,o,I,R,a,U,T,s),ce.bindBuffer(35052,null);break;case"browser-object":dn(Y)?Y.texImage2D(t,n,o,I,R,a,U,T,y):Y.texImage2D(t,n,o,U,T,y);break;case"compressed":for(const[be,Te]of y.entries())Y.compressedTexImage2D(t,be,Te.format,Te.width,Te.height,a,Te.data),pe+=Te.levelSize;break;default:Jr(!1,"Unknown image data type")}}),he==="compressed")this._trackAllocatedMemory(pe,"Texture");else if(y&&y.byteLength)this._trackAllocatedMemory(y.byteLength,"Texture");else{const be=rL[this.dataFormat]||4,Te=iL[this.type]||1;this._trackAllocatedMemory(this.width*this.height*be*Te,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:t=this.target,pixels:i=null,data:n=null,x:o=0,y:a=0,width:s=this.width,height:g=this.height,level:y=0,format:T=this.format,type:I=this.type,dataFormat:R=this.dataFormat,compressed:U=!1,offset:Z=0,border:Y=this.border,parameters:he={}}=e;if({type:I,dataFormat:R,compressed:U,width:s,height:g}=this._deduceParameters({format:T,type:I,dataFormat:R,compressed:U,data:n,width:s,height:g}),Jr(this.depth===0,"texSubImage not supported for 3D textures"),n||(n=i),n&&n.data){const ce=n;n=ce.data,s=ce.shape[0],g=ce.shape[1]}n instanceof ws&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),nh(this.gl,he,()=>{if(U)this.gl.compressedTexSubImage2D(t,y,o,a,s,g,T,n);else if(n===null)this.gl.texSubImage2D(t,y,o,a,s,g,R,I,null);else if(ArrayBuffer.isView(n))this.gl.texSubImage2D(t,y,o,a,s,g,R,I,n,Z);else if(n instanceof nL){const ce=Ac(this.gl);ce.bindBuffer(35052,n),ce.texSubImage2D(t,y,o,a,s,g,R,I,Z),ce.bindBuffer(35052,null)}else dn(this.gl)?Ac(this.gl).texSubImage2D(t,y,o,a,s,g,R,I,n):this.gl.texSubImage2D(t,y,o,a,R,I,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Ai.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType(e){let{data:t,compressed:i=!1}=e;return i?{data:t,dataType:"compressed"}:t===null?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof ws?{data:t.handle,dataType:"buffer"}:t instanceof nL?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:i}=e;let{width:n,height:o,dataFormat:a,type:s,compressed:g}=e;const y=B2[t];return a=a||y&&y.dataFormat,s=s||y&&y.types[0],g=g||y&&y.compressed,{width:n,height:o}=this._deduceImageSize(i,n,o),{dataFormat:a,type:s,compressed:g,width:n,height:o,format:t,data:i}}_deduceImageSize(e,t,i){let n;return typeof ImageData<"u"&&e instanceof ImageData?n={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?n={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?n={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?n={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?n={width:e.videoWidth,height:e.videoHeight}:e?n={width:t,height:i}:n={width:t>=0?t:1,height:i>=0?i:1},Jr(n,"Could not deduced texture size"),Jr(t===void 0||n.width===t,"Deduced texture width does not match supplied width"),Jr(i===void 0||n.height===i,"Deduced texture height does not match supplied height"),n}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,t);break;case 4096:case 4097:Jr(!1);break;default:this.gl.texParameteri(this.target,e,t);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return dn(this.gl)||!this.width||!this.height?!1:!J3(this.width)||!J3(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case 10241:d7.indexOf(t)===-1&&(t=9729);break;case 10242:case 10243:t!==33071&&(t=33071);break}return t}}let f7="";function p7(r,e){return Jr(typeof r=="string"),r=f7+r,new Promise((t,i)=>{try{const n=new Image;n.onload=()=>t(n),n.onerror=()=>i(new Error("Could not load image ".concat(r,"."))),n.crossOrigin=e&&e.crossOrigin||"anonymous",n.src=r}catch(n){i(n)}})}class iu extends og{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,t){return og.isSupported(e,t)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};u1(e),(t instanceof Promise||typeof t=="string")&&(t={data:t}),typeof t.data=="string"&&(t=Object.assign({},t,{data:p7(t.data)})),super(e,Object.assign({},t,{target:3553})),this.initialize(t),Object.seal(this)}}const C2=[34069,34070,34071,34072,34073,34074];class sL extends og{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};u1(e),super(e,Object.assign({},t,{target:34067})),this.initialize(t),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:t=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:t,data:i,x:n=0,y:o=0,mipmapLevel:a=0}=e;return this._subImage({target:t,data:i,x:n,y:o,mipmapLevel:a})}async setCubeMapImageData(e){let{width:t,height:i,pixels:n,data:o,border:a=0,format:s=6408,type:g=5121}=e;const{gl:y}=this,T=n||o,I=await Promise.all(C2.map(R=>{const U=T[R];return Promise.all(Array.isArray(U)?U:[U])}));this.bind(),C2.forEach((R,U)=>{I[U].length>1&&this.opts.mipmaps!==!1&&Ai.warn("".concat(this.id," has mipmap and multiple LODs."))(),I[U].forEach((Z,Y)=>{t&&i?y.texImage2D(R,Y,s,t,i,a,s,g,Z):y.texImage2D(R,Y,s,s,g,Z)})}),this.unbind()}setImageDataForFace(e){const{face:t,width:i,height:n,pixels:o,data:a,border:s=0,format:g=6408,type:y=5121}=e,{gl:T}=this,I=o||a;return this.bind(),I instanceof Promise?I.then(R=>this.setImageDataForFace(Object.assign({},e,{face:t,data:R,pixels:R}))):this.width||this.height?T.texImage2D(t,0,g,i,n,s,g,y,I):T.texImage2D(t,0,g,g,y,I),this}}sL.FACES=C2;class g7 extends og{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return dn(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ac(e),t=Object.assign({depth:1},t,{target:32879,unpackFlipY:!1}),super(e,t),this.initialize(t),Object.seal(this)}setImageData(e){let{level:t=0,dataFormat:i=6408,width:n,height:o,depth:a=1,border:s=0,format:g,type:y=5121,offset:T=0,data:I,parameters:R={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),nh(this.gl,R,()=>{ArrayBuffer.isView(I)&&this.gl.texImage3D(this.target,t,i,n,o,a,s,g,y,I),I instanceof ws&&(this.gl.bindBuffer(35052,I.handle),this.gl.texImage3D(this.target,t,i,n,o,a,s,g,y,T))}),I&&I.byteLength)this._trackAllocatedMemory(I.byteLength,"Texture");else{const U=rL[this.dataFormat]||4,Z=iL[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*U*Z,"Texture")}return this.loaded=!0,this}}const Ef="EXT_color_buffer_float",oL={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:Ef,bpp:2},33327:{gl2:Ef,bpp:4},34842:{gl2:Ef,bpp:8},33326:{gl2:Ef,bpp:4},33328:{gl2:Ef,bpp:8},34836:{gl2:Ef,bpp:16},35898:{gl2:Ef,bpp:4}};function m7(r,e,t){const i=t[e];if(!i)return!1;const n=dn(r)&&i.gl2||i.gl1;return typeof n=="string"?r.getExtension(n):n}class ag extends LA{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!t||m7(e,t,oL)}static getSamplesForFormat(e,t){let{format:i}=t;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.initialize(t),Object.seal(this)}initialize(e){let{format:t,width:i=1,height:n=1,samples:o=0}=e;return Jr(t,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),o!==0&&dn(this.gl)?this.gl.renderbufferStorageMultisample(36161,o,t,i,n):this.gl.renderbufferStorage(36161,t,i,n),this.format=t,this.width=i,this.height=n,this.samples=o,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*oL[this.format].bpp),this}resize(e){let{width:t,height:i}=e;return t!==this.width||i!==this.height?this.initialize({width:t,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const y7=256,_7=1024,v7=16384,aL=6144,lL=6145,cL=6146,uL=34041,hL="clear: bad arguments";function E2(r){let{framebuffer:e=null,color:t=null,depth:i=null,stencil:n=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};e&&(o.framebuffer=e);let a=0;t&&(a|=v7,t!==!0&&(o.clearColor=t)),i&&(a|=y7,i!==!0&&(o.clearDepth=i)),n&&(a|=_7,i!==!0&&(o.clearStencil=i)),Jr(a!==0,hL),nh(r,o,()=>{r.clear(a)})}function b7(r){let{framebuffer:e=null,buffer:t=aL,drawBuffer:i=0,value:n=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ac(r),nh(r,{framebuffer:e},()=>{switch(t){case aL:switch(n.constructor){case Int32Array:r.clearBufferiv(t,i,n);break;case Uint32Array:r.clearBufferuiv(t,i,n);break;case Float32Array:default:r.clearBufferfv(t,i,n)}break;case lL:r.clearBufferfv(lL,0,[n]);break;case cL:r.clearBufferiv(cL,0,[n]);break;case uL:const[o,a]=n;r.clearBufferfi(uL,0,o,a);break;default:Jr(!1,hL)}})}function x7(r){switch(r){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return Jr(!1),0}}function h1(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:t=0,sourceY:i=0,sourceFormat:n=6408}=e;let{sourceAttachment:o=36064,target:a=null,sourceWidth:s,sourceHeight:g,sourceType:y}=e;const{framebuffer:T,deleteFramebuffer:I}=w7(r);Jr(T);const{gl:R,handle:U,attachments:Z}=T;s=s||T.width,g=g||T.height,o===36064&&U===null&&(o=1028),Jr(Z[o]),y=y||Z[o].type,a=B7(a,y,n,s,g),y=y||x2(a);const Y=R.bindFramebuffer(36160,U);return R.readPixels(t,i,s,g,n,y,a),R.bindFramebuffer(36160,Y||null),I&&T.delete(),a}function AL(r){let{sourceAttachment:e=36064,targetMaxHeight:t=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=h1(r,{sourceAttachment:e}),{width:n,height:o}=r;for(;o>t;)({data:i,width:n,height:o}=o7({data:i,width:n,height:o}));s7({data:i,width:n,height:o});const a=document.createElement("canvas");a.width=n,a.height=o;const s=a.getContext("2d"),g=s.createImageData(n,o);return g.data.set(i),s.putImageData(g,0,0),a.toDataURL()}function w7(r){return r instanceof Ba?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:F7(r),deleteFramebuffer:!0}}function B7(r,e,t,i,n){if(r)return r;e=e||5121;const o=gy(e,{clamped:!1}),a=x7(t);return new o(i*n*a)}const Hs={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function C7(r){const e=new iu(r,{format:6408,type:5126,dataFormat:6408}),t=new Ba(r,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),i=t.getStatus();return e.delete(),t.delete(),i===36053}const dL={[Hs.WEBGL2]:[!1,!0],[Hs.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Hs.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Hs.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Hs.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Hs.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Hs.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Hs.FLOAT_BLEND]:["EXT_float_blend"],[Hs.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Hs.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Hs.TEXTURE_FLOAT]:["OES_texture_float",!0],[Hs.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Hs.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Hs.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Hs.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Hs.COLOR_ATTACHMENT_RGBA32F]:[C7,"EXT_color_buffer_float"],[Hs.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Hs.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Hs.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Hs.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Hs.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Hs.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},E7=2;function S2(r,e){return fL(r,e)}function fL(r,e){return e=Array.isArray(e)?e:[e],e.every(t=>pL(r,t))}function S7(r){r.luma=r.luma||{},r.luma.caps=r.luma.caps||{};for(const e in dL)r.luma.caps[e]===void 0&&(r.luma.caps[e]=pL(r,e));return r.luma.caps}function pL(r,e){return r.luma=r.luma||{},r.luma.caps=r.luma.caps||{},r.luma.caps[e]===void 0&&(r.luma.caps[e]=T7(r,e)),r.luma.caps[e]||Ai.log(E7,"Feature: ".concat(e," not supported"))(),r.luma.caps[e]}function T7(r,e){const t=dL[e];Jr(t,e);let i;const n=dn(r)&&t[1]||t[0];if(typeof n=="function")i=n(r);else if(Array.isArray(n)){i=!0;for(const o of n)i=i&&!!r.getExtension(o)}else typeof n=="string"?i=!!r.getExtension(n):typeof n=="boolean"?i=n:Jr(!1);return i}const gL="Multiple render targets not supported";class Ba extends LA{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:n}=t;let o=!0;return i&&(o=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),n&&(o=o&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),o}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new Ba(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Ac(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Ac(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:t=1,height:i=1,attachments:n=null,color:o=!0,depth:a=!0,stencil:s=!1,check:g=!0,readBuffer:y=void 0,drawBuffers:T=void 0}=e;if(Jr(t>=0&&i>=0,"Width and height need to be integers"),this.width=t,this.height=i,n)for(const I in n){const R=n[I];(Array.isArray(R)?R[0]:R).resize({width:t,height:i})}else n=this._createDefaultAttachments(o,a,s,t,i);this.update({clearAttachments:!0,attachments:n,readBuffer:y,drawBuffers:T}),n&&g&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:t={},readBuffer:i,drawBuffers:n,clearAttachments:o=!1,resizeAttachments:a=!0}=e;this.attach(t,{clearAttachments:o,resizeAttachments:a});const{gl:s}=this,g=s.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),n&&this._setDrawBuffers(n),s.bindFramebuffer(36160,g||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:t,height:i}=e;if(this.handle===null)return Jr(t===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;t===void 0&&(t=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),t!==this.width&&i!==this.height&&Ai.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(t,"x").concat(i))();for(const n in this.attachments)this.attachments[n].resize({width:t,height:i});return this.width=t,this.height=i,this}attach(e){let{clearAttachments:t=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={};t&&Object.keys(this.attachments).forEach(a=>{n[a]=null}),Object.assign(n,e);const o=this.gl.bindFramebuffer(36160,this.handle);for(const a in n){Jr(a!==void 0,"Misspelled framebuffer binding point?");const s=Number(a),g=n[s];let y=g;if(!y)this._unattach(s);else if(y instanceof ag)this._attachRenderbuffer({attachment:s,renderbuffer:y});else if(Array.isArray(g)){const[T,I=0,R=0]=g;y=T,this._attachTexture({attachment:s,texture:T,layer:I,level:R})}else this._attachTexture({attachment:s,texture:y,layer:0,level:0});i&&y&&y.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,o||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(a=>!this.attachments[a]).forEach(a=>{delete this.attachments[a]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(L7(e));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,t||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:t,depth:i,stencil:n,drawBuffers:o=[]}=e,a=this.gl.bindFramebuffer(36160,this.handle);return(t||i||n)&&E2(this.gl,{color:t,depth:i,stencil:n}),o.forEach((s,g)=>{b7(this.gl,{drawBuffer:g,value:s})}),this.gl.bindFramebuffer(36160,a||null),this}readPixels(){return Ai.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Ai.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Ai.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Ai.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Ai.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Ai.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:t=[],x:i=0,y:n=0,width:o,height:a}=e;const s=Ac(this.gl),g=s.bindFramebuffer(36008,this.handle);return i===0&&n===0&&o===void 0&&a===void 0?s.invalidateFramebuffer(36008,t):s.invalidateFramebuffer(36008,t,i,n,o,a),s.bindFramebuffer(36008,g),this}getAttachmentParameter(e,t,i){let n=this._getAttachmentParameterFallback(t);return n===null&&(this.gl.bindFramebuffer(36160,this.handle),n=this.gl.getFramebufferAttachmentParameter(36160,e,t),this.gl.bindFramebuffer(36160,null)),i&&n>1e3&&(n=dd(this.gl,n)),n}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const n={};for(const o of i){const a=t?dd(this.gl,o):o;n[a]=this.getAttachmentParameter(e,o,t)}return n}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const t=Object.keys(this.attachments),i={};for(const n of t){const o=Number(n),a=e?dd(this.gl,o):o;i[a]=this.getAttachmentParameters(o,e)}return i}show(){return typeof window<"u"&&window.open(AL(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Ai.level||typeof window>"u")return this;t=t||"Framebuffer ".concat(this.id);const i=AL(this,{targetMaxHeight:100});return Ai.image({logLevel:e,message:t,image:i},t)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,i,n,o){let a=null;return e&&(a=a||{},a[36064]=new iu(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:n,height:o,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(a[36064])),t&&i?(a=a||{},a[33306]=new ag(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:n,height:111}),this.ownResources.push(a[33306])):t?(a=a||{},a[36096]=new ag(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:n,height:o}),this.ownResources.push(a[36096])):i&&Jr(!1),a}_unattach(e){const t=this.attachments[e];t&&(t instanceof ag?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:t=36064,renderbuffer:i}=e;const{gl:n}=this;n.framebufferRenderbuffer(36160,t,36161,i.handle),this.attachments[t]=i}_attachTexture(e){let{attachment:t=36064,texture:i,layer:n,level:o}=e;const{gl:a}=this;switch(a.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:Ac(a).framebufferTextureLayer(36160,t,i.target,o,n);break;case 34067:const g=I7(n);a.framebufferTexture2D(36160,t,g,i.handle,o);break;case 3553:a.framebufferTexture2D(36160,t,3553,i.handle,o);break;default:Jr(!1,"Illegal texture type")}a.bindTexture(i.target,null),this.attachments[t]=i}_setReadBuffer(e){const t=s9(this.gl);t?t.readBuffer(e):Jr(e===36064||e===1029,gL),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this,i=Ac(t);if(i)i.drawBuffers(e);else{const n=t.getExtension("WEBGL_draw_buffers");n?n.drawBuffersWEBGL(e):Jr(e.length===1&&(e[0]===36064||e[0]===1029),gL)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=S7(this.gl);switch(e){case 36052:return t.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return t.WEBGL2?null:8;case 33297:return t.WEBGL2?null:5125;case 33296:return!t.WEBGL2&&!t.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function I7(r){return r<34069?r+34069:r}function L7(r){return(Ba.STATUS||{})[r]||"Framebuffer error ".concat(r)}const M7=[36049,36048,33296,33298,33299,33300,33301,33302,33303];Ba.ATTACHMENT_PARAMETERS=M7;function P7(r,e){Jr(r instanceof iu||r instanceof sL||r instanceof g7);const t=r.constructor,{gl:i,width:n,height:o,format:a,type:s,dataFormat:g,border:y,mipmaps:T}=r,I=Object.assign({width:n,height:o,format:a,type:s,dataFormat:g,border:y,mipmaps:T},e);return new t(i,I)}function F7(r,e){const{gl:t,width:i,height:n,id:o}=r;return new Ba(t,Object.assign({},e,{id:"framebuffer-for-".concat(o),width:i,height:n,attachments:{36064:r}}))}function A1(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const t=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=r.match(t);return i?i[1]:e}const D7=35632,R7=35633;function k7(r){switch(r){case D7:return"fragment";case R7:return"vertex";default:return"unknown type"}}function O7(r,e,t,i){const n=r.split(/\r?\n/),o={},a={},s=i||A1(e)||"(unnamed)",g="".concat(k7(t)," shader ").concat(s);for(let T=0;T<n.length;T++){const I=n[T];if(I.length<=1)continue;const R=I.split(":"),U=R[0],Z=parseInt(R[2],10);if(isNaN(Z))throw new Error("GLSL compilation error in ".concat(g,": ").concat(r));U!=="WARNING"?o[Z]=I:a[Z]=I}const y=U7(e);return{shaderName:g,errors:mL(o,y),warnings:mL(a,y)}}function mL(r,e){let t="";for(let i=0;i<e.length;i++){const n=e[i];if(!(!r[i+3]&&!r[i+2]&&!r[i+1])&&(t+="".concat(n,`
`),r[i+1])){const o=r[i+1],a=o.split(":",3),s=a[0],g=parseInt(a[1],10)||0,y=o.substring(a.join(":").length+1).trim();t+=yL("^^^ ".concat(s,": ").concat(y,`

`),g)}}return t}function U7(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=r.split(/\r?\n/),n=String(i.length+e-1).length;return i.map((o,a)=>{const s=String(a+e),g=s.length;return yL(s,n-g)+t+o})}function yL(r,e){let t="";for(let i=0;i<e;++i)t+=" ";return"".concat(t).concat(r)}function _L(r){let e=100;const t=r.match(/[^\s]+/g);if(t.length>=2&&t[0]==="#version"){const i=parseInt(t[1],10);Number.isFinite(i)&&(e=i)}return e}const N7="Shader: GLSL source code must be a JavaScript string";class my extends LA{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return Jr(!1),"unknown"}}constructor(e,t){u1(e),Jr(typeof t.source=="string",N7);const i=A1(t.source,null)||t.id||IA("unnamed ".concat(my.getTypeName(t.shaderType)));super(e,{id:i}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize(e){let{source:t}=e;const i=A1(t,null);i&&(this.id=IA(i)),this._compile(t)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(my.getTypeName(this.shaderType),":").concat(this.id)}getName(){return A1(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:n,errors:o,warnings:a}=O7(i,this.source,this.shaderType,this.id);throw Ai.error("GLSL compilation errors in ".concat(n,`
`).concat(o))(),Ai.warn("GLSL compilation warnings in ".concat(n,`
`).concat(a))(),new Error("GLSL compilation errors in ".concat(n))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class T2 extends my{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class I2 extends my{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,t){typeof t=="string"&&(t={source:t}),super(e,Object.assign({},t,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const z7={5126:Xs.bind(null,"uniform1fv",nu,1,Pl),35664:Xs.bind(null,"uniform2fv",nu,2,Pl),35665:Xs.bind(null,"uniform3fv",nu,3,Pl),35666:Xs.bind(null,"uniform4fv",nu,4,Pl),5124:Xs.bind(null,"uniform1iv",fd,1,Pl),35667:Xs.bind(null,"uniform2iv",fd,2,Pl),35668:Xs.bind(null,"uniform3iv",fd,3,Pl),35669:Xs.bind(null,"uniform4iv",fd,4,Pl),35670:Xs.bind(null,"uniform1iv",fd,1,Pl),35671:Xs.bind(null,"uniform2iv",fd,2,Pl),35672:Xs.bind(null,"uniform3iv",fd,3,Pl),35673:Xs.bind(null,"uniform4iv",fd,4,Pl),35674:Xs.bind(null,"uniformMatrix2fv",nu,4,MA),35675:Xs.bind(null,"uniformMatrix3fv",nu,9,MA),35676:Xs.bind(null,"uniformMatrix4fv",nu,16,MA),35678:ll,35680:ll,5125:Xs.bind(null,"uniform1uiv",d1,1,Pl),36294:Xs.bind(null,"uniform2uiv",d1,2,Pl),36295:Xs.bind(null,"uniform3uiv",d1,3,Pl),36296:Xs.bind(null,"uniform4uiv",d1,4,Pl),35685:Xs.bind(null,"uniformMatrix2x3fv",nu,6,MA),35686:Xs.bind(null,"uniformMatrix2x4fv",nu,8,MA),35687:Xs.bind(null,"uniformMatrix3x2fv",nu,6,MA),35688:Xs.bind(null,"uniformMatrix3x4fv",nu,12,MA),35689:Xs.bind(null,"uniformMatrix4x2fv",nu,8,MA),35690:Xs.bind(null,"uniformMatrix4x3fv",nu,12,MA),35678:ll,35680:ll,35679:ll,35682:ll,36289:ll,36292:ll,36293:ll,36298:ll,36299:ll,36300:ll,36303:ll,36306:ll,36307:ll,36308:ll,36311:ll},Q7={},V7={},H7={},vL=[0];function L2(r,e,t,i){e===1&&typeof r=="boolean"&&(r=r?1:0),Number.isFinite(r)&&(vL[0]=r,r=vL);const n=r.length;if(n%e&&Ai.warn("Uniform size should be multiples of ".concat(e),r)(),r instanceof t)return r;let o=i[n];o||(o=new t(n),i[n]=o);for(let a=0;a<n;a++)o[a]=r[a];return o}function nu(r,e){return L2(r,e,Float32Array,Q7)}function fd(r,e){return L2(r,e,Int32Array,V7)}function d1(r,e){return L2(r,e,Uint32Array,H7)}function bL(r,e,t){const i=z7[t.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(t.type));return i().bind(null,r,e)}function G7(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,t=r.match(e);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(r));return{name:t[1],length:t[2]||1,isArray:!!t[2]}}function j7(r,e,t){for(const i in r){const n=r[i];if((!t||!!t[i])&&!q7(n))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),n),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function q7(r){return Array.isArray(r)||ArrayBuffer.isView(r)?K7(r):isFinite(r)||r===!0||r===!1||r instanceof og||r instanceof ag?!0:r instanceof Ba?!!r.texture:!1}function $7(r,e,t){if(Array.isArray(t)||ArrayBuffer.isView(t))if(r[e]){const i=r[e];for(let n=0,o=t.length;n<o;++n)i[n]=t[n]}else r[e]=t.slice();else r[e]=t}function K7(r){if(r.length===0)return!1;const e=Math.min(r.length,16);for(let t=0;t<e;++t)if(!Number.isFinite(r[t]))return!1;return!0}function ll(){let r=null;return(e,t,i)=>{const n=r!==i;return n&&(e.uniform1i(t,i),r=i),n}}function Xs(r,e,t,i){let n=null,o=null;return(a,s,g)=>{const y=e(g,t),T=y.length;let I=!1;if(n===null)n=new Float32Array(T),o=T,I=!0;else{Jr(o===T,"Uniform length cannot change.");for(let R=0;R<T;++R)if(y[R]!==n[R]){I=!0;break}}return I&&(i(a,r,s,y),n.set(y)),I}}function Pl(r,e,t,i){r[e](t,i)}function MA(r,e,t,i){r[e](t,!1,i)}const W7=5120,X7=5121,Z7=5122,J7=5123,xL=0,f1=1,Y7=2,eG=3,p1=4,tG=5,rG=6,Ca=5126,iG=35664,nG=35665,sG=35666,yy=5124,oG=35667,aG=35668,lG=35669,_y=5125,cG=36294,uG=36295,hG=36296,AG=35670,dG=35671,fG=35672,pG=35673,gG=35674,mG=35675,yG=35676,_G=35685,vG=35686,bG=35687,xG=35688,wG=35689,BG=35690,M2={[Ca]:[Ca,1,"float"],[iG]:[Ca,2,"vec2"],[nG]:[Ca,3,"vec3"],[sG]:[Ca,4,"vec4"],[yy]:[yy,1,"int"],[oG]:[yy,2,"ivec2"],[aG]:[yy,3,"ivec3"],[lG]:[yy,4,"ivec4"],[_y]:[_y,1,"uint"],[cG]:[_y,2,"uvec2"],[uG]:[_y,3,"uvec3"],[hG]:[_y,4,"uvec4"],[AG]:[Ca,1,"bool"],[dG]:[Ca,2,"bvec2"],[fG]:[Ca,3,"bvec3"],[pG]:[Ca,4,"bvec4"],[gG]:[Ca,8,"mat2"],[_G]:[Ca,8,"mat2x3"],[vG]:[Ca,8,"mat2x4"],[mG]:[Ca,12,"mat3"],[bG]:[Ca,12,"mat3x2"],[xG]:[Ca,12,"mat3x4"],[yG]:[Ca,16,"mat4"],[wG]:[Ca,16,"mat4x2"],[BG]:[Ca,16,"mat4x3"]};function CG(r){switch(r){case xL:return xL;case f1:return f1;case eG:return f1;case Y7:return f1;case p1:return p1;case tG:return p1;case rG:return p1;default:return Jr(!1),0}}function wL(r){const e=M2[r];if(!e)return null;const[t,i]=e;return{type:t,components:i}}function BL(r,e){switch(r){case W7:case X7:case Z7:case J7:r=Ca;break}for(const t in M2){const[i,n,o]=M2[t];if(i===r&&n===e)return{glType:t,name:o}}return null}class EG{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,i=t.getProgramParameter(e.handle,35721);for(let n=0;n<i;n++){const{name:o,type:a,size:s}=t.getActiveAttrib(e.handle,n),g=t.getAttribLocation(e.handle,o);g>=0&&this._addAttribute(g,o,a,s)}this.attributeInfos.sort((n,o)=>n.location-o.location)}_readVaryingsFromProgram(e){const{gl:t}=e;if(!dn(t))return;const i=t.getProgramParameter(e.handle,35971);for(let n=0;n<i;n++){const{name:o,type:a,size:s}=t.getTransformFeedbackVarying(e.handle,n);this._addVarying(n,o,a,s)}this.varyingInfos.sort((n,o)=>n.location-o.location)}_addAttribute(e,t,i,n){const{type:o,components:a}=wL(i),s={type:o,size:n*a};this._inferProperties(e,t,s);const g={location:e,name:t,accessor:new Dc(s)};this.attributeInfos.push(g),this.attributeInfosByLocation[e]=g,this.attributeInfosByName[g.name]=g}_inferProperties(e,t,i){/instance/i.test(t)&&(i.divisor=1)}_addVarying(e,t,i,n){const{type:o,components:a}=wL(i),s=new Dc({type:o,size:n*a}),g={location:e,name:t,accessor:s};this.varyingInfos.push(g),this.varyingInfosByName[g.name]=g}}const CL=4,SG=35981,TG=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class EL extends LA{get[Symbol.toStringTag](){return"Program"}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.stubRemovedMethods("Program","v6.0",TG),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:t,vs:i,fs:n,varyings:o,bufferMode:a=SG}=e;return this.hash=t||"",this.vs=typeof i=="string"?new T2(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof n=="string"?new I2(this.gl,{id:"".concat(e.id,"-fs"),source:n}):n,Jr(this.vs instanceof T2),Jr(this.fs instanceof I2),this.uniforms={},this._textureUniforms={},o&&o.length>0&&(Ac(this.gl),this.varyings=o,this.gl2.transformFeedbackVaryings(this.handle,o,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new EG(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:t,drawMode:i=4,vertexCount:n,offset:o=0,start:a,end:s,isIndexed:g=!1,indexType:y=5123,instanceCount:T=0,isInstanced:I=T>0,vertexArray:R=null,transformFeedback:U,framebuffer:Z,parameters:Y={},uniforms:he,samplers:ce}=e;if((he||ce)&&(Ai.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(he||{})),Ai.priority>=t){const pe=Z?Z.id:"default",be="mode=".concat(dd(this.gl,i)," verts=").concat(n," ")+"instances=".concat(T," indexType=").concat(dd(this.gl,y)," ")+"isInstanced=".concat(I," isIndexed=").concat(g," ")+"Framebuffer=".concat(pe);Ai.log(t,be)()}return Jr(R),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||n===0||I&&T===0?!1:(R.bindForDraw(n,T,()=>{if(Z!==void 0&&(Y=Object.assign({},Y,{framebuffer:Z})),U){const pe=CG(i);U.begin(pe)}this._bindTextures(),nh(this.gl,Y,()=>{g&&I?this.gl2.drawElementsInstanced(i,n,y,o,T):g&&dn(this.gl)&&!isNaN(a)&&!isNaN(s)?this.gl2.drawRangeElements(i,a,s,n,y,o):g?this.gl.drawElements(i,n,y,o):I?this.gl2.drawArraysInstanced(i,o,n,T):this.gl.drawArrays(i,o,n)}),U&&U.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ai.priority>=2&&j7(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const t in e){const i=e[t],n=this._uniformSetters[t];if(n){let o=i,a=!1;if(o instanceof Ba&&(o=o.texture),o instanceof og)if(a=this.uniforms[t]!==i,a){n.textureIndex===void 0&&(n.textureIndex=this._textureIndexCounter++);const s=o,{textureIndex:g}=n;s.bind(g),o=g,this._textureUniforms[t]=s}else o=n.textureIndex;else this._textureUniforms[t]&&delete this._textureUniforms[t];(n(o)||a)&&$7(this.uniforms,t,i)}}return this}_areTexturesRenderable(){let e=!0;for(const t in this._textureUniforms){const i=this._textureUniforms[t];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const t=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(t)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),i={};for(const n of t)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new T2({handle:n});break;case 35632:i.fs=new I2({handle:n});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const t=this._getName();this.id=IA(t)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Ai.time(CL,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Ai.timeEnd(CL,"linkProgram for ".concat(this._getName()))(),e.debug||Ai.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let t=0;t<this._uniformCount;t++){const i=this.gl.getActiveUniform(this.handle,t),{name:n}=G7(i.name);let o=e.getUniformLocation(this.handle,n);if(this._uniformSetters[n]=bL(e,o,i),i.size>1)for(let a=0;a<i.size;a++)o=e.getUniformLocation(this.handle,"".concat(n,"[").concat(a,"]")),this._uniformSetters["".concat(n,"[").concat(a,"]")]=bL(e,o,i)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl2.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl2.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl2.uniformBlockBinding(this.handle,e,t)}}const IG=34918,LG=34919,MG=35007,PG=36795,FG=35976,DG=35887,RG=36202;class g1 extends LA{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=dn(e),n=fL(e,Hs.TIMER_QUERY);let o=i||n;for(const a of t)switch(a){case"queries":o=o&&i;break;case"timers":o=o&&n;break;default:Jr(!1)}return o}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(MG)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?RG:DG)}beginTransformFeedbackQuery(){return this.begin(FG)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,LG);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(PG)}getResult(){return this.gl2.getQueryParameter(this.handle,IG)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((i,n)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):t++>e?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}_createHandle(){return g1.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class SL extends LA{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return dn(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ac(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,ng(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])}),this}setBuffer(e,t){const i=this._getVaryingIndex(e),{buffer:n,byteSize:o,byteOffset:a}=this._getBufferParams(t);return i<0?(this.unused[e]=n,Ai.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=t,this.bindOnUse||this._bindBuffer(i,n,a,o),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let t,i,n;return e instanceof ws?n=e:(n=e.buffer,i=e.byteSize,t=e.byteOffset),(t!==void 0||i!==void 0)&&(t=t||0,i=i||n.byteLength-t),{buffer:n,byteOffset:t,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:i,byteOffset:n}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,n,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;const o=t&&t.handle;return!o||n===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,i,n),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let m1=null;function kG(r){return(!m1||m1.byteLength<r)&&(m1=new ArrayBuffer(r)),m1}function OG(r,e){const t=kG(r.BYTES_PER_ELEMENT*e);return new r(t,0,e)}function UG(r){let{target:e,source:t,start:i=0,count:n=1}=r;const o=t.length,a=n*o;let s=0;for(let g=i;s<o;s++)e[g++]=t[s];for(;s<a;)s<a-s?(e.copyWithin(i+s,i,i+s),s*=2):(e.copyWithin(i+s,i,i+a-s),s=a);return e}const NG="elements must be GL.ELEMENT_ARRAY_BUFFER";class su extends LA{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?dn(e)||S3()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new su(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return su.MAX_ATTRIBUTES=su.MAX_ATTRIBUTES||e.getParameter(34921),su.MAX_ATTRIBUTES}static setConstant(e,t,i){switch(i.constructor){case Float32Array:su._setConstantFloatArray(e,t,i);break;case Int32Array:su._setConstantIntArray(e,t,i);break;case Uint32Array:su._setConstantUintArray(e,t,i);break;default:Jr(!1)}}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=t.isDefaultArray||!1,this.gl2=e,this.initialize(t),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return su.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return Jr(!e||e.target===34963,NG),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,t,i){if(t.target===34963)return this.setElementBuffer(t,i);const{size:n,type:o,stride:a,offset:s,normalized:g,integer:y,divisor:T}=i,{gl:I,gl2:R}=this;return e=Number(e),this.bind(()=>{I.bindBuffer(34962,t.handle),y?(Jr(dn(I)),R.vertexAttribIPointer(e,n,o,a,s)):I.vertexAttribPointer(e,n,o,g,a,s),I.enableVertexAttribArray(e),R.vertexAttribDivisor(e,T||0)}),this}enable(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!t&&e===0&&!su.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t){const i=this._normalizeConstantArrayValue(t),n=i.byteLength*e,o=i.length*e;let a=!this.buffer;if(this.buffer=this.buffer||new ws(this.gl,n),a=a||this.buffer.reallocate(n),a=a||!this._compareConstantArrayValues(i,this.bufferValue),a){const s=OG(t.constructor,o);UG({target:s,source:i,start:0,count:o}),this.buffer.subData(s),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}static _setConstantFloatArray(e,t,i){switch(i.length){case 1:e.vertexAttrib1fv(t,i);break;case 2:e.vertexAttrib2fv(t,i);break;case 3:e.vertexAttrib3fv(t,i);break;case 4:e.vertexAttrib4fv(t,i);break;default:Jr(!1)}}static _setConstantIntArray(e,t,i){switch(Jr(dn(e)),i.length){case 1:e.vertexAttribI1iv(t,i);break;case 2:e.vertexAttribI2iv(t,i);break;case 3:e.vertexAttribI3iv(t,i);break;case 4:e.vertexAttribI4iv(t,i);break;default:Jr(!1)}}static _setConstantUintArray(e,t,i){switch(Jr(dn(e)),i.length){case 1:e.vertexAttribI1uiv(t,i);break;case 2:e.vertexAttribI2uiv(t,i);break;case 3:e.vertexAttribI3uiv(t,i);break;case 4:e.vertexAttribI4uiv(t,i);break;default:Jr(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,t){let{location:i}=t;return Jr(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const zG="VertexArray: attributes must be Buffers or constants (i.e. typed array)",QG=/^(.+)__LOCATION_([0-9]+)$/,VG=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class HG{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=t.id||t.program&&t.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new su(e),Y3(this,"VertexArray","v6.0",VG),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const t in e){const i=e[t];this._setAttribute(t,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.target===34963)return this.setElementBuffer(t,i);const{location:n,accessor:o}=this._resolveLocationAndAccessor(e,t,t.accessor,i);return n>=0&&(this.values[n]=t,this.accessors[n]=o,this.clearDrawParams(),this.vertexArrayObject.setBuffer(n,t,o)),this}setConstant(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:n,accessor:o}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},i));return n>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t),this.values[n]=t,this.accessors[n]=o,this.clearDrawParams(),this.vertexArrayObject.enable(n,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new ws(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof ws&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof ws&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,i){let n;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),n=i()}),n}_resolveLocationAndAccessor(e,t,i,n){const o={location:-1,accessor:null},{location:a,name:s}=this._getAttributeIndex(e);if(!Number.isFinite(a)||a<0)return this.unused[e]=t,Ai.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),o;const g=this._getAttributeInfo(s||a);if(!g)return o;const y=this.accessors[a]||{},T=Dc.resolve(g.accessor,y,i,n),{size:I,type:R}=T;return Jr(Number.isFinite(I)&&Number.isFinite(R)),{location:a,accessor:T}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const i=QG.exec(e),n=i?i[1]:e,o=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(n)+o,name:n}:{location:-1}}_setAttribute(e,t){if(t instanceof ws)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof ws){const i=t[0],n=t[1];this.setBuffer(e,i,n)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){const i=t;this.setConstant(e,i)}else if(t.buffer instanceof ws){const i=t;this.setBuffer(e,i.buffer,i)}else throw new Error(zG)}_setConstantAttributes(e,t){const i=Math.max(e|0,t|0);let n=this.values[0];ArrayBuffer.isView(n)&&this._setConstantAttributeZero(n,i);for(let o=1;o<this.vertexArrayObject.MAX_ATTRIBUTES;o++)n=this.values[o],ArrayBuffer.isView(n)&&this._setConstantAttribute(o,n)}_setConstantAttributeZero(e,t){if(su.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,t){su.setConstant(this.gl,e,t)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const i=this.values[t],n=this.accessors[t];if(!i)return;const{divisor:o}=n,a=o>0;if(e.isInstanced=e.isInstanced||a,i instanceof ws){const s=i;if(a){const g=s.getVertexCount(n);e.instanceCount=Math.min(e.instanceCount,g)}else{const g=s.getVertexCount(n);e.vertexCount=Math.min(e.vertexCount,g)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Ai.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}function GG(r,e){const{maxElts:t=16,size:i=1}=e;let n="[";for(let a=0;a<r.length&&a<t;++a)a>0&&(n+=",".concat(a%i===0?" ":"")),n+=vy(r[a],e);const o=r.length>t?"...":"]";return"".concat(n).concat(o)}function vy(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=1e-16,{isInteger:i=!1}=e;if(Array.isArray(r)||ArrayBuffer.isView(r))return GG(r,e);if(!Number.isFinite(r))return String(r);if(Math.abs(r)<t)return i?"0":"0.";if(i||Math.abs(r)>100&&Math.abs(r)<1e4)return r.toFixed(0);const n=r.toPrecision(2);return n.indexOf(".0")===n.length-2?n.slice(0,-1):n}function TL(r){let{header:e="Uniforms",program:t,uniforms:i,undefinedOnly:n=!1}=r;Jr(t);const o=".*_.*",a=".*Matrix",s=t._uniformSetters,g={},y=Object.keys(s).sort();let T=0;for(const U of y)!U.match(o)&&!U.match(a)&&P2({table:g,header:e,uniforms:i,uniformName:U,undefinedOnly:n})&&T++;for(const U of y)U.match(a)&&P2({table:g,header:e,uniforms:i,uniformName:U,undefinedOnly:n})&&T++;for(const U of y)g[U]||P2({table:g,header:e,uniforms:i,uniformName:U,undefinedOnly:n})&&T++;let I=0;const R={};if(!n)for(const U in i){const Z=i[U];g[U]||(I++,R[U]={Type:"NOT USED: ".concat(Z),[e]:vy(Z)})}return{table:g,count:T,unusedTable:R,unusedCount:I}}function P2(r){let{table:e,header:t,uniforms:i,uniformName:n,undefinedOnly:o}=r;const a=i[n],s=jG(a);return!o||!s?(e[n]={[t]:s?vy(a):"N/A","Uniform Type":s?a:"NOT PROVIDED"},!0):!1}function jG(r){return r!=null}function qG(r){let{vertexArray:e,header:t="Attributes"}=r;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=IL(e,e.elements,null,t));const n=e.values;for(const o in n){const a=e._getAttributeInfo(o);if(a){let s="".concat(o,": ").concat(a.name);const g=e.accessors[a.location];g&&(s="".concat(o,": ").concat($G(a.name,g))),i[s]=IL(e,n[o],g,t)}}return i}function IL(r,e,t,i){const{gl:n}=r;if(!e)return{[i]:"null","Format ":"N/A"};let o="NOT PROVIDED",a=1,s=0,g=0,y,T,I;if(t&&(o=t.type,a=t.size,o=String(o).replace("Array",""),y=o.indexOf("nt")!==-1),e instanceof ws){const R=e,{data:U,changed:Z}=R.getDebugData();T=Z?"*":"",I=U,g=R.byteLength,s=g/U.BYTES_PER_ELEMENT/a;let Y;if(t){const he=t.divisor>0;Y="".concat(he?"I ":"P "," ").concat(s," (x").concat(a,"=").concat(g," bytes ").concat(dd(n,o),")")}else y=!0,Y="".concat(g," bytes");return{[i]:"".concat(T).concat(vy(I,{size:a,isInteger:y})),"Format ":Y}}return I=e,a=e.length,o=String(e.constructor.name).replace("Array",""),y=o.indexOf("nt")!==-1,{[i]:"".concat(vy(I,{size:a,isInteger:y})," (constant)"),"Format ":"".concat(a,"x").concat(o," (constant)")}}function $G(r,e){const{type:t,size:i}=e,n=BL(t,i);return n?"".concat(r," (").concat(n.name,")"):r}function KG(r){const e={},t="Accessors for ".concat(r.id);for(const i of r.attributeInfos)if(i){const n=LL(i);e["in ".concat(n)]={[t]:JSON.stringify(i.accessor)}}for(const i of r.varyingInfos)if(i){const n=LL(i);e["out ".concat(n)]={[t]:JSON.stringify(i.accessor)}}return e}function LL(r){const{type:e,size:t}=r.accessor,i=BL(e,t);return i?"".concat(i.name," ").concat(r.name):r.name}const ML=SA()&&typeof document<"u";let WG=0;class XG{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:t=he=>W3(he),onAddHTML:i=null,onInitialize:n=()=>{},onRender:o=()=>{},onFinalize:a=()=>{},onError:s,gl:g=null,glOptions:y={},debug:T=!1,createFramebuffer:I=!1,autoResizeViewport:R=!0,autoResizeDrawingBuffer:U=!0,stats:Z=Cf.get("animation-loop-".concat(WG++))}=e;let{useDevicePixels:Y=!0}=e;"useDevicePixelRatio"in e&&(Ai.deprecated("useDevicePixelRatio","useDevicePixels")(),Y=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:i,onInitialize:n,onRender:o,onFinalize:a,onError:s,gl:g,glOptions:y,debug:T,createFramebuffer:I},this.gl=g,this.needsRedraw=null,this.timeline=null,this.stats=Z,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:R,autoResizeDrawingBuffer:U,useDevicePixels:Y}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return Jr(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const t=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=g1.isSupported(this.gl,["timers"])?new g1(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&t.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):t}setViewParameters(){return Ai.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=ML?new Promise((e,t)=>{if(ML&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):i7(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):r7(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?y2(this.props.gl,e):this.onCreateContext(e),!c1(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");H9(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);const i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let i=1;const{canvas:n}=this.gl;return n&&n.clientHeight?i=n.clientWidth/n.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&K9(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new Ba(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const by="vs",F2="fs";function ou(r,e){if(!r)throw new Error(e||"shadertools: assertion failed.")}const D2={number:{validate(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},array:{validate(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function ZG(r){const e={};for(const t in r){const i=r[t],n=JG(i);e[t]=n}return e}function JG(r){let e=PL(r);return e==="object"?r?"type"in r?Object.assign({},r,D2[r.type]):"value"in r?(e=PL(r.value),Object.assign({type:e},r,D2[e])):{type:"object",value:r}:{type:"object",value:null}:Object.assign({type:e,value:r},D2[e])}function PL(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const YG="vs",ej="fs";class FL{constructor(e){let{name:t,vs:i,fs:n,dependencies:o=[],uniforms:a,getUniforms:s,deprecations:g=[],defines:y={},inject:T={},vertexShader:I,fragmentShader:R}=e;ou(typeof t=="string"),this.name=t,this.vs=i||I,this.fs=n||R,this.getModuleUniforms=s,this.dependencies=o,this.deprecations=this._parseDeprecationDefinitions(g),this.defines=y,this.injections=tj(T),a&&(this.uniforms=ZG(a))}getModuleSource(e){let t;switch(e){case YG:t=this.vs||"";break;case ej:t=this.fs||"";break;default:ou(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(t,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp("\\b".concat(t.old,"\\("));break;default:t.regex=new RegExp("".concat(t.type," ").concat(t.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={},i=this.uniforms;for(const n in i){const o=i[n];n in e&&!o.private?(o.validate&&ou(o.validate(e[n],o),"".concat(this.name,": invalid ").concat(n)),t[n]=e[n]):t[n]=o.value}return t}}function tj(r){const e={vs:{},fs:{}};for(const t in r){let i=r[t];const n=t.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[n][t]=i}return e}function rj(r){return ij(RL(r))}function ij(r){const e={},t={};return DL({modules:r,level:0,moduleMap:e,moduleDepth:t}),Object.keys(t).sort((i,n)=>t[n]-t[i]).map(i=>e[i])}function DL(r){let{modules:e,level:t,moduleMap:i,moduleDepth:n}=r;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)i[o.name]=o,(n[o.name]===void 0||n[o.name]<t)&&(n[o.name]=t);for(const o of e)o.dependencies&&DL({modules:o.dependencies,level:t+1,moduleMap:i,moduleDepth:n})}function RL(r,e){return r.map(t=>(t instanceof FL||(ou(typeof t!="string","Shader module use by name is deprecated. Import shader module '".concat(t,"' and use it directly.")),ou(t.name,"shader module has no name"),t=new FL(t),t.dependencies=RL(t.dependencies)),t))}function nj(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},t=r.userAgent||e.userAgent||"",i=t.indexOf("MSIE ")!==-1,n=t.indexOf("Trident/")!==-1;return i||n}const sj=7936,oj=7937,aj=7938,lj=35724,R2={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},Sf={};Object.keys(R2).forEach(r=>{Sf[r]=r});function cj(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&r._version===2)}function uj(r){const e=r.getExtension("WEBGL_debug_renderer_info"),t=r.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||sj),i=r.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||oj);return{gpuVendor:hj(t,i),vendor:t,renderer:i,version:r.getParameter(aj),shadingLanguageVersion:r.getParameter(lj)}}function hj(r,e){return r.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":r.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":r.match(/AMD/i)||e.match(/AMD/i)||r.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const k2={};function kL(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=R2[e];if(ou(i,e),!nj(t))return!0;if(e in k2)return k2[e];const n=i[0],o=t.behavior||"enable",a="#extension GL_".concat(n," : ").concat(o,`
void main(void) {}`),s=r.createShader(35633);r.shaderSource(s,a),r.compileShader(s);const g=r.getShaderParameter(s,35713);return r.deleteShader(s),k2[e]=g,g}function Aj(r,e){const t=R2[e];ou(t,e);const i=cj(r)&&t[1]||t[0],n=typeof i=="string"?!!r.getExtension(i):i;return ou(n===!1||n===!0),n}function y1(r,e){return e=Array.isArray(e)?e:[e],e.every(t=>Aj(r,t))}function dj(r){switch(uj(r).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function fj(r,e,t){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return y1(r,Sf.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),y1(r,Sf.GLSL_DERIVATIVES)&&kL(r,Sf.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),y1(r,Sf.GLSL_FRAG_DATA)&&kL(r,Sf.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),y1(r,Sf.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const pj=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,gj=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,mj={[by]:pj,[F2]:gj},_1="__LUMA_INJECT_DECLARATIONS__",OL=/void\s+main\s*\([^)]*\)\s*\{\n?/,UL=/}\n?[^{}]*$/,O2=[];function NL(r,e,t){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const n=e===by;for(const o in t){const a=t[o];a.sort((g,y)=>g.order-y.order),O2.length=a.length;for(let g=0,y=a.length;g<y;++g)O2[g]=a[g].injection;const s="".concat(O2.join(`
`),`
`);switch(o){case"vs:#decl":n&&(r=r.replace(_1,s));break;case"vs:#main-start":n&&(r=r.replace(OL,g=>g+s));break;case"vs:#main-end":n&&(r=r.replace(UL,g=>s+g));break;case"fs:#decl":n||(r=r.replace(_1,s));break;case"fs:#main-start":n||(r=r.replace(OL,g=>g+s));break;case"fs:#main-end":n||(r=r.replace(UL,g=>s+g));break;default:r=r.replace(o,g=>g+s)}}return r=r.replace(_1,""),i&&(r=r.replace(/\}\s*$/,o=>o+mj[e])),r}function U2(r){const e={};return ou(Array.isArray(r)&&r.length>1),r.forEach(t=>{for(const i in t)e[i]=e[i]?"".concat(e[i],`
`).concat(t[i]):t[i]}),e}function lg(r){return new RegExp("\\b".concat(r,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const zL=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],yj=[...zL,[lg("attribute"),"in $1"],[lg("varying"),"out $1"]],_j=[...zL,[lg("varying"),"in $1"]],QL=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],vj=[...QL,[lg("in"),"attribute $1"],[lg("out"),"varying $1"]],bj=[...QL,[lg("in"),"varying $1"]],N2="gl_FragColor",z2=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,xj=/void\s+main\s*\([^)]*\)\s*\{\n?/;function wj(r,e,t){switch(e){case 300:return t?v1(r,yj):Bj(r);case 100:return t?v1(r,vj):Cj(r);default:throw new Error("unknown GLSL version ".concat(e))}}function v1(r,e){for(const[t,i]of e)r=r.replace(t,i);return r}function Bj(r){r=v1(r,_j);const e=r.match(z2);if(e){const t=e[1];r=r.replace(new RegExp("\\b".concat(N2,"\\b"),"g"),t)}else{const t="fragmentColor";r=r.replace(xj,i=>"out vec4 ".concat(t,`;
`).concat(i)).replace(new RegExp("\\b".concat(N2,"\\b"),"g"),t)}return r}function Cj(r){r=v1(r,bj);const e=r.match(z2);if(e){const t=e[1];r=r.replace(z2,"").replace(new RegExp("\\b".concat(t,"\\b"),"g"),N2)}return r}const Ej=`

`.concat(_1,`

`),VL={[by]:"vertex",[F2]:"fragment"},Sj=`precision highp float;

`;function Tj(r,e){const{vs:t,fs:i}=e,n=rj(e.modules||[]);return{gl:r,vs:HL(r,Object.assign({},e,{source:t,type:by,modules:n})),fs:HL(r,Object.assign({},e,{source:i,type:F2,modules:n})),getUniforms:Ij(n)}}function HL(r,e){let{id:t,source:i,type:n,modules:o,defines:a={},hookFunctions:s=[],inject:g={},transpileToGLSL100:y=!1,prologue:T=!0,log:I}=e;ou(typeof i=="string","shader source must be a string");const R=n===by,U=i.split(`
`);let Z=100,Y="",he=i;U[0].indexOf("#version ")===0?(Z=300,Y=U[0],he=U.slice(1).join(`
`)):Y="#version ".concat(Z);const ce={};o.forEach(We=>{Object.assign(ce,We.getDefines())}),Object.assign(ce,a);let pe=T?"".concat(Y,`
`).concat(Mj({id:t,source:i,type:n}),`
`).concat(Lj({type:n}),`
`).concat(dj(r),`
`).concat(fj(r),`
`).concat(Pj(ce),`
`).concat(R?"":Sj,`
`):"".concat(Y,`
`);const be=Dj(s),Te={},qe={},je={};for(const We in g){const Ne=typeof g[We]=="string"?{injection:g[We],order:0}:g[We],at=We.match(/^(v|f)s:(#)?([\w-]+)$/);if(at){const nt=at[2],ke=at[3];nt?ke==="decl"?qe[We]=[Ne]:je[We]=[Ne]:Te[We]=[Ne]}else je[We]=[Ne]}for(const We of o){I&&We.checkDeprecations(he,I);const Ne=We.getModuleSource(n,Z);pe+=Ne;const at=We.injections[n];for(const nt in at){const ke=nt.match(/^(v|f)s:#([\w-]+)$/);if(ke){const Ye=ke[2]==="decl"?qe:je;Ye[nt]=Ye[nt]||[],Ye[nt].push(at[nt])}else Te[nt]=Te[nt]||[],Te[nt].push(at[nt])}}return pe+=Ej,pe=NL(pe,n,qe),pe+=Fj(be[n],Te),pe+=he,pe=NL(pe,n,je),pe=wj(pe,y?100:Z,R),pe}function Ij(r){return function(t){const i={};for(const n of r){const o=n.getUniforms(t,i);Object.assign(i,o)}return i}}function Lj(r){let{type:e}=r;return`
#define SHADER_TYPE_`.concat(VL[e].toUpperCase(),`
`)}function Mj(r){let{id:e,source:t,type:i}=r;return e&&typeof e=="string"&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(VL[i],`

`):""}function Pj(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,t="";for(const i in r){e===0&&(t+=`
// APPLICATION DEFINES
`),e++;const n=r[i];(n||Number.isFinite(n))&&(t+="#define ".concat(i.toUpperCase()," ").concat(r[i],`
`))}return e===0&&(t+=`
`),t}function Fj(r,e){let t="";for(const i in r){const n=r[i];if(t+="void ".concat(n.signature,` {
`),n.header&&(t+="  ".concat(n.header)),e[i]){const o=e[i];o.sort((a,s)=>a.order-s.order);for(const a of o)t+="  ".concat(a.injection,`
`)}n.footer&&(t+="  ".concat(n.footer)),t+=`}
`}return t}function Dj(r){const e={vs:{},fs:{}};return r.forEach(t=>{let i;typeof t!="string"?(i=t,t=i.hook):i={},t=t.trim();const[n,o]=t.split(":"),a=t.replace(/\(.+/,"");e[n][a]=Object.assign(i,{signature:o})}),e}const Rj="void main() {gl_FragColor = vec4(0);}",jL=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,kj=`#version 300 es
`.concat(jL);function qL(r,e){e=Array.isArray(e)?e:[e];const t=r.replace(/^\s+/,"").split(/\s+/),[i,n,o]=t;if(!e.includes(i)||!n||!o)return null;const a=o.split(";")[0];return{qualifier:i,type:n,name:a}}function $L(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:t,inputType:i,output:n}=r;if(!t)return e===300?kj:e>300?"#version ".concat(e,`
`).concat(jL):Rj;const o=Nj(t,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(t,`;
out vec4 `).concat(n,`;
void main() {
  `).concat(n," = ").concat(o,`;
}`):"varying ".concat(i," ").concat(t,`;
void main() {
  gl_FragColor = `).concat(o,`;
}`)}function Oj(r){switch(r){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return ou(!1),null}}function Uj(r){switch(r){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return ou(!1),null}}function Nj(r,e){switch(e){case"float":return"vec4(".concat(r,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(r,", 0.0, 1.0)");case"vec3":return"vec4(".concat(r,", 1.0)");case"vec4":return r;default:return ou(!1),null}}const zj={name:"fp32",vs:`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fs:null};function sh(r,e){if(!r)throw new Error("math.gl assertion ".concat(e))}const Qj=1/Math.PI*180,Vj=1/180*Math.PI,Ea={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function Hj(r){let{precision:e=Ea.precision}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return r=$j(r),"".concat(parseFloat(r.toPrecision(e)))}function pd(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Gj(r){return qj(r)}function jj(r){return PA(r)}function qj(r,e){return Q2(r,t=>t*Vj,e)}function PA(r,e){return Q2(r,t=>t*Qj,e)}function FA(r,e,t){return Q2(r,i=>Math.max(e,Math.min(t,i)))}function b1(r,e,t){return pd(r)?r.map((i,n)=>b1(i,e[n],t)):t*e+(1-t)*r}function oh(r,e,t){const i=Ea.EPSILON;t&&(Ea.EPSILON=t);try{if(r===e)return!0;if(pd(r)&&pd(e)){if(r.length!==e.length)return!1;for(let n=0;n<r.length;++n)if(!oh(r[n],e[n]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=Ea.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{Ea.EPSILON=i}}function $j(r){return Math.round(r/Ea.EPSILON)*Ea.EPSILON}function Kj(r){return r.clone?r.clone():new Array(r.length)}function Q2(r,e,t){if(pd(r)){const i=r;t=t||Kj(i);for(let n=0;n<t.length&&n<i.length;++n)t[n]=e(r[n],n,t);return t}return e(r)}function Wj(r){function e(){var t=Reflect.construct(r,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return e.prototype=Object.create(r.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r,e}class V2 extends Wj(Array){clone(){return new this.constructor().copy(this)}fromArray(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:pd(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Ea)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+Hj(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!oh(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(i===void 0)return this.lerp(this,e,t);for(let n=0;n<this.ELEMENTS;++n){const o=e[n];this[n]=o+i*(t[n]-o)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]+=n[o];return this.check()}subtract(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]-=n[o];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Ea.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}}function Xj(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function ns(r){if(!Number.isFinite(r))throw new Error("Invalid number ".concat(r));return r}function xy(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(Ea.debug&&!Xj(r,e))throw new Error("math.gl: ".concat(t," some fields set to invalid numbers'"));return r}class H2 extends V2{get x(){return this[0]}set x(e){this[0]=ns(e)}get y(){return this[1]}set y(e){this[1]=ns(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){const n=this[i]-e[i];t+=n*n}return ns(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return ns(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]*=n[o];return this.check()}divide(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(const n of t)for(let o=0;o<this.ELEMENTS;++o)this[o]/=n[o];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return sh(e>=0&&e<this.ELEMENTS,"index is out of range"),ns(this[e])}setComponent(e,t){return sh(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}var wy=1e-6,ah=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});function Zj(){var r=new ah(2);return ah!=Float32Array&&(r[0]=0,r[1]=0),r}function KL(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function Jj(r,e){return r[0]=-e[0],r[1]=-e[1],r}function WL(r,e,t,i){var n=e[0],o=e[1];return r[0]=n+i*(t[0]-n),r[1]=o+i*(t[1]-o),r}function Yj(r,e,t){var i=e[0],n=e[1];return r[0]=t[0]*i+t[2]*n,r[1]=t[1]*i+t[3]*n,r}function eq(r,e,t){var i=e[0],n=e[1];return r[0]=t[0]*i+t[2]*n+t[4],r[1]=t[1]*i+t[3]*n+t[5],r}function XL(r,e,t){var i=e[0],n=e[1];return r[0]=t[0]*i+t[3]*n+t[6],r[1]=t[1]*i+t[4]*n+t[7],r}function ZL(r,e,t){var i=e[0],n=e[1];return r[0]=t[0]*i+t[4]*n+t[12],r[1]=t[1]*i+t[5]*n+t[13],r}(function(){var r=Zj();return function(e,t,i,n,o,a){var s,g;for(t||(t=2),i||(i=0),n?g=Math.min(n*t+i,e.length):g=e.length,s=i;s<g;s+=t)r[0]=e[s],r[1]=e[s+1],o(r,r,a),e[s]=r[0],e[s+1]=r[1];return e}})();function JL(r,e,t){const i=e[0],n=e[1],o=t[3]*i+t[7]*n||1;return r[0]=(t[0]*i+t[4]*n)/o,r[1]=(t[1]*i+t[5]*n)/o,r}function YL(r,e,t){const i=e[0],n=e[1],o=e[2],a=t[3]*i+t[7]*n+t[11]*o||1;return r[0]=(t[0]*i+t[4]*n+t[8]*o)/a,r[1]=(t[1]*i+t[5]*n+t[9]*o)/a,r[2]=(t[2]*i+t[6]*n+t[10]*o)/a,r}function tq(r,e,t){const i=e[0],n=e[1];return r[0]=t[0]*i+t[2]*n,r[1]=t[1]*i+t[3]*n,r[2]=e[2],r}function rq(r,e,t){const i=e[0],n=e[1];return r[0]=t[0]*i+t[2]*n,r[1]=t[1]*i+t[3]*n,r[2]=e[2],r[3]=e[3],r}function eM(r,e,t){const i=e[0],n=e[1],o=e[2];return r[0]=t[0]*i+t[3]*n+t[6]*o,r[1]=t[1]*i+t[4]*n+t[7]*o,r[2]=t[2]*i+t[5]*n+t[8]*o,r[3]=e[3],r}class G2 extends H2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;super(2),pd(e)&&arguments.length===1?this.copy(e):(Ea.debug&&(ns(e),ns(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Ea.debug&&(ns(e.x),ns(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return ZL(this,this,e),this.check()}transformAsVector(e){return JL(this,this,e),this.check()}transformByMatrix3(e){return XL(this,this,e),this.check()}transformByMatrix2x3(e){return eq(this,this,e),this.check()}transformByMatrix2(e){return Yj(this,this,e),this.check()}}function tM(){var r=new ah(3);return ah!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function rM(r){var e=r[0],t=r[1],i=r[2];return Math.hypot(e,t,i)}function iM(r,e,t){var i=new ah(3);return i[0]=r,i[1]=e,i[2]=t,i}function iq(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function nq(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function sq(r,e){var t=e[0],i=e[1],n=e[2],o=t*t+i*i+n*n;return o>0&&(o=1/Math.sqrt(o)),r[0]=e[0]*o,r[1]=e[1]*o,r[2]=e[2]*o,r}function j2(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function x1(r,e,t){var i=e[0],n=e[1],o=e[2],a=t[0],s=t[1],g=t[2];return r[0]=n*g-o*s,r[1]=o*a-i*g,r[2]=i*s-n*a,r}function q2(r,e,t){var i=e[0],n=e[1],o=e[2],a=t[3]*i+t[7]*n+t[11]*o+t[15];return a=a||1,r[0]=(t[0]*i+t[4]*n+t[8]*o+t[12])/a,r[1]=(t[1]*i+t[5]*n+t[9]*o+t[13])/a,r[2]=(t[2]*i+t[6]*n+t[10]*o+t[14])/a,r}function nM(r,e,t){var i=e[0],n=e[1],o=e[2];return r[0]=i*t[0]+n*t[3]+o*t[6],r[1]=i*t[1]+n*t[4]+o*t[7],r[2]=i*t[2]+n*t[5]+o*t[8],r}function sM(r,e,t){var i=t[0],n=t[1],o=t[2],a=t[3],s=e[0],g=e[1],y=e[2],T=n*y-o*g,I=o*s-i*y,R=i*g-n*s,U=n*R-o*I,Z=o*T-i*R,Y=i*I-n*T,he=a*2;return T*=he,I*=he,R*=he,U*=2,Z*=2,Y*=2,r[0]=s+T+U,r[1]=g+I+Z,r[2]=y+R+Y,r}function oq(r,e,t,i){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[0],o[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),o[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),r[0]=o[0]+t[0],r[1]=o[1]+t[1],r[2]=o[2]+t[2],r}function aq(r,e,t,i){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),o[1]=n[1],o[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),r[0]=o[0]+t[0],r[1]=o[1]+t[1],r[2]=o[2]+t[2],r}function lq(r,e,t,i){var n=[],o=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],o[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),o[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),o[2]=n[2],r[0]=o[0]+t[0],r[1]=o[1]+t[1],r[2]=o[2]+t[2],r}function cq(r,e){var t=r[0],i=r[1],n=r[2],o=e[0],a=e[1],s=e[2],g=Math.sqrt(t*t+i*i+n*n),y=Math.sqrt(o*o+a*a+s*s),T=g*y,I=T&&j2(r,e)/T;return Math.acos(Math.min(Math.max(I,-1),1))}var uq=iq,hq=rM;(function(){var r=tM();return function(e,t,i,n,o,a){var s,g;for(t||(t=3),i||(i=0),n?g=Math.min(n*t+i,e.length):g=e.length,s=i;s<g;s+=t)r[0]=e[s],r[1]=e[s+1],r[2]=e[s+2],o(r,r,a),e[s]=r[0],e[s+1]=r[1],e[s+2]=r[2];return e}})();const $2=[0,0,0];let w1;class Ut extends H2{static get ZERO(){return w1||(w1=new Ut(0,0,0),Object.freeze(w1)),w1}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;super(-0,-0,-0),arguments.length===1&&pd(e)?this.copy(e):(Ea.debug&&(ns(e),ns(t),ns(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Ea.debug&&(ns(e.x),ns(e.y),ns(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ns(e)}angle(e){return cq(this,e)}cross(e){return x1(this,this,e),this.check()}rotateX(e){let{radians:t,origin:i=$2}=e;return oq(this,this,i,t),this.check()}rotateY(e){let{radians:t,origin:i=$2}=e;return aq(this,this,i,t),this.check()}rotateZ(e){let{radians:t,origin:i=$2}=e;return lq(this,this,i,t),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return q2(this,this,e),this.check()}transformAsVector(e){return YL(this,this,e),this.check()}transformByMatrix3(e){return nM(this,this,e),this.check()}transformByMatrix2(e){return tq(this,this,e),this.check()}transformByQuaternion(e){return sM(this,this,e),this.check()}}let B1;class K2 extends H2{static get ZERO(){return B1||(B1=new K2(0,0,0,0),Object.freeze(B1)),B1}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;super(-0,-0,-0,-0),pd(e)&&arguments.length===1?this.copy(e):(Ea.debug&&(ns(e),ns(t),ns(i),ns(n)),this[0]=e,this[1]=t,this[2]=i,this[3]=n)}set(e,t,i,n){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Ea.debug&&(ns(e.x),ns(e.y),ns(e.z),ns(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=ns(e)}get w(){return this[3]}set w(e){this[3]=ns(e)}transform(e){return q2(this,this,e),this.check()}transformByMatrix3(e){return eM(this,this,e),this.check()}transformByMatrix2(e){return rq(this,this,e),this.check()}transformByQuaternion(e){return sM(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class oM extends V2{toString(){let e="[";if(Ea.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+t])}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=" ".concat(this[t])}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=ns(i),this}getColumn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Array(this.RANK).fill(-0);const i=e*this.RANK;for(let n=0;n<this.RANK;++n)t[n]=this[i+n];return t}setColumn(e,t){const i=e*this.RANK;for(let n=0;n<this.RANK;++n)this[i+n]=t[n];return this}}function Aq(){var r=new ah(9);return ah!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function dq(r,e){if(r===e){var t=e[1],i=e[2],n=e[5];r[1]=e[3],r[2]=e[6],r[3]=t,r[5]=e[7],r[6]=i,r[7]=n}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r}function fq(r,e){var t=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],g=e[6],y=e[7],T=e[8],I=T*a-s*y,R=-T*o+s*g,U=y*o-a*g,Z=t*I+i*R+n*U;return Z?(Z=1/Z,r[0]=I*Z,r[1]=(-T*i+n*y)*Z,r[2]=(s*i-n*a)*Z,r[3]=R*Z,r[4]=(T*t-n*g)*Z,r[5]=(-s*t+n*o)*Z,r[6]=U*Z,r[7]=(-y*t+i*g)*Z,r[8]=(a*t-i*o)*Z,r):null}function pq(r){var e=r[0],t=r[1],i=r[2],n=r[3],o=r[4],a=r[5],s=r[6],g=r[7],y=r[8];return e*(y*o-a*g)+t*(-y*n+a*s)+i*(g*n-o*s)}function aM(r,e,t){var i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],g=e[5],y=e[6],T=e[7],I=e[8],R=t[0],U=t[1],Z=t[2],Y=t[3],he=t[4],ce=t[5],pe=t[6],be=t[7],Te=t[8];return r[0]=R*i+U*a+Z*y,r[1]=R*n+U*s+Z*T,r[2]=R*o+U*g+Z*I,r[3]=Y*i+he*a+ce*y,r[4]=Y*n+he*s+ce*T,r[5]=Y*o+he*g+ce*I,r[6]=pe*i+be*a+Te*y,r[7]=pe*n+be*s+Te*T,r[8]=pe*o+be*g+Te*I,r}function gq(r,e,t){var i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],g=e[5],y=e[6],T=e[7],I=e[8],R=t[0],U=t[1];return r[0]=i,r[1]=n,r[2]=o,r[3]=a,r[4]=s,r[5]=g,r[6]=R*i+U*a+y,r[7]=R*n+U*s+T,r[8]=R*o+U*g+I,r}function mq(r,e,t){var i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],g=e[5],y=e[6],T=e[7],I=e[8],R=Math.sin(t),U=Math.cos(t);return r[0]=U*i+R*a,r[1]=U*n+R*s,r[2]=U*o+R*g,r[3]=U*a-R*i,r[4]=U*s-R*n,r[5]=U*g-R*o,r[6]=y,r[7]=T,r[8]=I,r}function lM(r,e,t){var i=t[0],n=t[1];return r[0]=i*e[0],r[1]=i*e[1],r[2]=i*e[2],r[3]=n*e[3],r[4]=n*e[4],r[5]=n*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r}function yq(r,e){var t=e[0],i=e[1],n=e[2],o=e[3],a=t+t,s=i+i,g=n+n,y=t*a,T=i*a,I=i*s,R=n*a,U=n*s,Z=n*g,Y=o*a,he=o*s,ce=o*g;return r[0]=1-I-Z,r[3]=T-ce,r[6]=R+he,r[1]=T+ce,r[4]=1-y-Z,r[7]=U-Y,r[2]=R-he,r[5]=U+Y,r[8]=1-y-I,r}var W2;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL1ROW0=3]="COL1ROW0",r[r.COL1ROW1=4]="COL1ROW1",r[r.COL1ROW2=5]="COL1ROW2",r[r.COL2ROW0=6]="COL2ROW0",r[r.COL2ROW1=7]="COL2ROW1",r[r.COL2ROW2=8]="COL2ROW2"})(W2||(W2={}));const _q=Object.freeze([1,0,0,0,1,0,0,0,1]);class Co extends oM{static get IDENTITY(){return bq()}static get ZERO(){return vq()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return W2}constructor(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):i.length>0?this.copy([e,...i]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(_q)}fromObject(e){return this.check()}fromQuaternion(e){return yq(this,e),this.check()}set(e,t,i,n,o,a,s,g,y){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this[4]=o,this[5]=a,this[6]=s,this[7]=g,this[8]=y,this.check()}setRowMajor(e,t,i,n,o,a,s,g,y){return this[0]=e,this[1]=n,this[2]=s,this[3]=t,this[4]=o,this[5]=g,this[6]=i,this[7]=a,this[8]=y,this.check()}determinant(){return pq(this)}transpose(){return dq(this,this),this.check()}invert(){return fq(this,this),this.check()}multiplyLeft(e){return aM(this,e,this),this.check()}multiplyRight(e){return aM(this,this,e),this.check()}rotate(e){return mq(this,this,e),this.check()}scale(e){return Array.isArray(e)?lM(this,this,e):lM(this,this,[e,e]),this.check()}translate(e){return gq(this,this,e),this.check()}transform(e,t){let i;switch(e.length){case 2:i=XL(t||[-0,-0],e,this);break;case 3:i=nM(t||[-0,-0,-0],e,this);break;case 4:i=eM(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return xy(i,e.length),i}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let C1,E1;function vq(){return C1||(C1=new Co([0,0,0,0,0,0,0,0,0]),Object.freeze(C1)),C1}function bq(){return E1||(E1=new Co,Object.freeze(E1)),E1}function xq(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function wq(r,e){if(r===e){var t=e[1],i=e[2],n=e[3],o=e[6],a=e[7],s=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=i,r[9]=o,r[11]=e[14],r[12]=n,r[13]=a,r[14]=s}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function X2(r,e){var t=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],g=e[6],y=e[7],T=e[8],I=e[9],R=e[10],U=e[11],Z=e[12],Y=e[13],he=e[14],ce=e[15],pe=t*s-i*a,be=t*g-n*a,Te=t*y-o*a,qe=i*g-n*s,je=i*y-o*s,We=n*y-o*g,Ne=T*Y-I*Z,at=T*he-R*Z,nt=T*ce-U*Z,ke=I*he-R*Y,De=I*ce-U*Y,Ye=R*ce-U*he,Xe=pe*Ye-be*De+Te*ke+qe*nt-je*at+We*Ne;return Xe?(Xe=1/Xe,r[0]=(s*Ye-g*De+y*ke)*Xe,r[1]=(n*De-i*Ye-o*ke)*Xe,r[2]=(Y*We-he*je+ce*qe)*Xe,r[3]=(R*je-I*We-U*qe)*Xe,r[4]=(g*nt-a*Ye-y*at)*Xe,r[5]=(t*Ye-n*nt+o*at)*Xe,r[6]=(he*Te-Z*We-ce*be)*Xe,r[7]=(T*We-R*Te+U*be)*Xe,r[8]=(a*De-s*nt+y*Ne)*Xe,r[9]=(i*nt-t*De-o*Ne)*Xe,r[10]=(Z*je-Y*Te+ce*pe)*Xe,r[11]=(I*Te-T*je-U*pe)*Xe,r[12]=(s*at-a*ke-g*Ne)*Xe,r[13]=(t*ke-i*at+n*Ne)*Xe,r[14]=(Y*be-Z*qe-he*pe)*Xe,r[15]=(T*qe-I*be+R*pe)*Xe,r):null}function Bq(r){var e=r[0],t=r[1],i=r[2],n=r[3],o=r[4],a=r[5],s=r[6],g=r[7],y=r[8],T=r[9],I=r[10],R=r[11],U=r[12],Z=r[13],Y=r[14],he=r[15],ce=e*a-t*o,pe=e*s-i*o,be=e*g-n*o,Te=t*s-i*a,qe=t*g-n*a,je=i*g-n*s,We=y*Z-T*U,Ne=y*Y-I*U,at=y*he-R*U,nt=T*Y-I*Z,ke=T*he-R*Z,De=I*he-R*Y;return ce*De-pe*ke+be*nt+Te*at-qe*Ne+je*We}function Tf(r,e,t){var i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],g=e[5],y=e[6],T=e[7],I=e[8],R=e[9],U=e[10],Z=e[11],Y=e[12],he=e[13],ce=e[14],pe=e[15],be=t[0],Te=t[1],qe=t[2],je=t[3];return r[0]=be*i+Te*s+qe*I+je*Y,r[1]=be*n+Te*g+qe*R+je*he,r[2]=be*o+Te*y+qe*U+je*ce,r[3]=be*a+Te*T+qe*Z+je*pe,be=t[4],Te=t[5],qe=t[6],je=t[7],r[4]=be*i+Te*s+qe*I+je*Y,r[5]=be*n+Te*g+qe*R+je*he,r[6]=be*o+Te*y+qe*U+je*ce,r[7]=be*a+Te*T+qe*Z+je*pe,be=t[8],Te=t[9],qe=t[10],je=t[11],r[8]=be*i+Te*s+qe*I+je*Y,r[9]=be*n+Te*g+qe*R+je*he,r[10]=be*o+Te*y+qe*U+je*ce,r[11]=be*a+Te*T+qe*Z+je*pe,be=t[12],Te=t[13],qe=t[14],je=t[15],r[12]=be*i+Te*s+qe*I+je*Y,r[13]=be*n+Te*g+qe*R+je*he,r[14]=be*o+Te*y+qe*U+je*ce,r[15]=be*a+Te*T+qe*Z+je*pe,r}function S1(r,e,t){var i=t[0],n=t[1],o=t[2],a,s,g,y,T,I,R,U,Z,Y,he,ce;return e===r?(r[12]=e[0]*i+e[4]*n+e[8]*o+e[12],r[13]=e[1]*i+e[5]*n+e[9]*o+e[13],r[14]=e[2]*i+e[6]*n+e[10]*o+e[14],r[15]=e[3]*i+e[7]*n+e[11]*o+e[15]):(a=e[0],s=e[1],g=e[2],y=e[3],T=e[4],I=e[5],R=e[6],U=e[7],Z=e[8],Y=e[9],he=e[10],ce=e[11],r[0]=a,r[1]=s,r[2]=g,r[3]=y,r[4]=T,r[5]=I,r[6]=R,r[7]=U,r[8]=Z,r[9]=Y,r[10]=he,r[11]=ce,r[12]=a*i+T*n+Z*o+e[12],r[13]=s*i+I*n+Y*o+e[13],r[14]=g*i+R*n+he*o+e[14],r[15]=y*i+U*n+ce*o+e[15]),r}function Z2(r,e,t){var i=t[0],n=t[1],o=t[2];return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r[4]=e[4]*n,r[5]=e[5]*n,r[6]=e[6]*n,r[7]=e[7]*n,r[8]=e[8]*o,r[9]=e[9]*o,r[10]=e[10]*o,r[11]=e[11]*o,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Cq(r,e,t,i){var n=i[0],o=i[1],a=i[2],s=Math.hypot(n,o,a),g,y,T,I,R,U,Z,Y,he,ce,pe,be,Te,qe,je,We,Ne,at,nt,ke,De,Ye,Xe,Ct;return s<wy?null:(s=1/s,n*=s,o*=s,a*=s,g=Math.sin(t),y=Math.cos(t),T=1-y,I=e[0],R=e[1],U=e[2],Z=e[3],Y=e[4],he=e[5],ce=e[6],pe=e[7],be=e[8],Te=e[9],qe=e[10],je=e[11],We=n*n*T+y,Ne=o*n*T+a*g,at=a*n*T-o*g,nt=n*o*T-a*g,ke=o*o*T+y,De=a*o*T+n*g,Ye=n*a*T+o*g,Xe=o*a*T-n*g,Ct=a*a*T+y,r[0]=I*We+Y*Ne+be*at,r[1]=R*We+he*Ne+Te*at,r[2]=U*We+ce*Ne+qe*at,r[3]=Z*We+pe*Ne+je*at,r[4]=I*nt+Y*ke+be*De,r[5]=R*nt+he*ke+Te*De,r[6]=U*nt+ce*ke+qe*De,r[7]=Z*nt+pe*ke+je*De,r[8]=I*Ye+Y*Xe+be*Ct,r[9]=R*Ye+he*Xe+Te*Ct,r[10]=U*Ye+ce*Xe+qe*Ct,r[11]=Z*Ye+pe*Xe+je*Ct,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function cM(r,e,t){var i=Math.sin(t),n=Math.cos(t),o=e[4],a=e[5],s=e[6],g=e[7],y=e[8],T=e[9],I=e[10],R=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=o*n+y*i,r[5]=a*n+T*i,r[6]=s*n+I*i,r[7]=g*n+R*i,r[8]=y*n-o*i,r[9]=T*n-a*i,r[10]=I*n-s*i,r[11]=R*n-g*i,r}function Eq(r,e,t){var i=Math.sin(t),n=Math.cos(t),o=e[0],a=e[1],s=e[2],g=e[3],y=e[8],T=e[9],I=e[10],R=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=o*n-y*i,r[1]=a*n-T*i,r[2]=s*n-I*i,r[3]=g*n-R*i,r[8]=o*i+y*n,r[9]=a*i+T*n,r[10]=s*i+I*n,r[11]=g*i+R*n,r}function uM(r,e,t){var i=Math.sin(t),n=Math.cos(t),o=e[0],a=e[1],s=e[2],g=e[3],y=e[4],T=e[5],I=e[6],R=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=o*n+y*i,r[1]=a*n+T*i,r[2]=s*n+I*i,r[3]=g*n+R*i,r[4]=y*n-o*i,r[5]=T*n-a*i,r[6]=I*n-s*i,r[7]=R*n-g*i,r}function Sq(r,e){var t=e[0],i=e[1],n=e[2],o=e[4],a=e[5],s=e[6],g=e[8],y=e[9],T=e[10];return r[0]=Math.hypot(t,i,n),r[1]=Math.hypot(o,a,s),r[2]=Math.hypot(g,y,T),r}function Tq(r,e){var t=e[0],i=e[1],n=e[2],o=e[3],a=t+t,s=i+i,g=n+n,y=t*a,T=i*a,I=i*s,R=n*a,U=n*s,Z=n*g,Y=o*a,he=o*s,ce=o*g;return r[0]=1-I-Z,r[1]=T+ce,r[2]=R-he,r[3]=0,r[4]=T-ce,r[5]=1-y-Z,r[6]=U+Y,r[7]=0,r[8]=R+he,r[9]=U-Y,r[10]=1-y-I,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Iq(r,e,t,i,n,o,a){var s=1/(t-e),g=1/(n-i),y=1/(o-a);return r[0]=o*2*s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o*2*g,r[6]=0,r[7]=0,r[8]=(t+e)*s,r[9]=(n+i)*g,r[10]=(a+o)*y,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*o*2*y,r[15]=0,r}function Lq(r,e,t,i,n){var o=1/Math.tan(e/2),a;return r[0]=o/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0?(a=1/(i-n),r[10]=(n+i)*a,r[14]=2*n*i*a):(r[10]=-1,r[14]=-2*i),r}var Mq=Lq;function Pq(r,e,t,i,n,o,a){var s=1/(e-t),g=1/(i-n),y=1/(o-a);return r[0]=-2*s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*y,r[11]=0,r[12]=(e+t)*s,r[13]=(n+i)*g,r[14]=(a+o)*y,r[15]=1,r}var Fq=Pq;function Dq(r,e,t,i){var n,o,a,s,g,y,T,I,R,U,Z=e[0],Y=e[1],he=e[2],ce=i[0],pe=i[1],be=i[2],Te=t[0],qe=t[1],je=t[2];return Math.abs(Z-Te)<wy&&Math.abs(Y-qe)<wy&&Math.abs(he-je)<wy?xq(r):(T=Z-Te,I=Y-qe,R=he-je,U=1/Math.hypot(T,I,R),T*=U,I*=U,R*=U,n=pe*R-be*I,o=be*T-ce*R,a=ce*I-pe*T,U=Math.hypot(n,o,a),U?(U=1/U,n*=U,o*=U,a*=U):(n=0,o=0,a=0),s=I*a-R*o,g=R*n-T*a,y=T*o-I*n,U=Math.hypot(s,g,y),U?(U=1/U,s*=U,g*=U,y*=U):(s=0,g=0,y=0),r[0]=n,r[1]=s,r[2]=T,r[3]=0,r[4]=o,r[5]=g,r[6]=I,r[7]=0,r[8]=a,r[9]=y,r[10]=R,r[11]=0,r[12]=-(n*Z+o*Y+a*he),r[13]=-(s*Z+g*Y+y*he),r[14]=-(T*Z+I*Y+R*he),r[15]=1,r)}function Rq(){var r=new ah(4);return ah!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function kq(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}function hM(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function Oq(r){var e=r[0],t=r[1],i=r[2],n=r[3];return Math.hypot(e,t,i,n)}function Uq(r){var e=r[0],t=r[1],i=r[2],n=r[3];return e*e+t*t+i*i+n*n}function Nq(r,e){var t=e[0],i=e[1],n=e[2],o=e[3],a=t*t+i*i+n*n+o*o;return a>0&&(a=1/Math.sqrt(a)),r[0]=t*a,r[1]=i*a,r[2]=n*a,r[3]=o*a,r}function zq(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]}function Qq(r,e,t,i){var n=e[0],o=e[1],a=e[2],s=e[3];return r[0]=n+i*(t[0]-n),r[1]=o+i*(t[1]-o),r[2]=a+i*(t[2]-a),r[3]=s+i*(t[3]-s),r}function By(r,e,t){var i=e[0],n=e[1],o=e[2],a=e[3];return r[0]=t[0]*i+t[4]*n+t[8]*o+t[12]*a,r[1]=t[1]*i+t[5]*n+t[9]*o+t[13]*a,r[2]=t[2]*i+t[6]*n+t[10]*o+t[14]*a,r[3]=t[3]*i+t[7]*n+t[11]*o+t[15]*a,r}function Vq(r,e,t){var i=e[0],n=e[1],o=e[2],a=t[0],s=t[1],g=t[2],y=t[3],T=y*i+s*o-g*n,I=y*n+g*i-a*o,R=y*o+a*n-s*i,U=-a*i-s*n-g*o;return r[0]=T*y+U*-a+I*-g-R*-s,r[1]=I*y+U*-s+R*-a-T*-g,r[2]=R*y+U*-g+T*-s-I*-a,r[3]=e[3],r}(function(){var r=Rq();return function(e,t,i,n,o,a){var s,g;for(t||(t=4),i||(i=0),n?g=Math.min(n*t+i,e.length):g=e.length,s=i;s<g;s+=t)r[0]=e[s],r[1]=e[s+1],r[2]=e[s+2],r[3]=e[s+3],o(r,r,a),e[s]=r[0],e[s+1]=r[1],e[s+2]=r[2],e[s+3]=r[3];return e}})();var J2;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(J2||(J2={}));const Hq=45*Math.PI/180,Gq=1,Y2=.1,eB=500,jq=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Sn extends oM{static get IDENTITY(){return $q()}static get ZERO(){return qq()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return J2}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,n,o,a,s,g,y,T,I,R,U,Z,Y,he){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this[4]=o,this[5]=a,this[6]=s,this[7]=g,this[8]=y,this[9]=T,this[10]=I,this[11]=R,this[12]=U,this[13]=Z,this[14]=Y,this[15]=he,this.check()}setRowMajor(e,t,i,n,o,a,s,g,y,T,I,R,U,Z,Y,he){return this[0]=e,this[1]=o,this[2]=y,this[3]=U,this[4]=t,this[5]=a,this[6]=T,this[7]=Z,this[8]=i,this[9]=s,this[10]=I,this[11]=Y,this[12]=n,this[13]=g,this[14]=R,this[15]=he,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(jq)}fromObject(e){return this.check()}fromQuaternion(e){return Tq(this,e),this.check()}frustum(e){const{left:t,right:i,bottom:n,top:o,near:a=Y2,far:s=eB}=e;return s===1/0?Kq(this,t,i,n,o,a):Iq(this,t,i,n,o,a,s),this.check()}lookAt(e){const{eye:t,center:i=[0,0,0],up:n=[0,1,0]}=e;return Dq(this,t,i,n),this.check()}ortho(e){const{left:t,right:i,bottom:n,top:o,near:a=Y2,far:s=eB}=e;return Fq(this,t,i,n,o,a,s),this.check()}orthographic(e){const{fovy:t=Hq,aspect:i=Gq,focalDistance:n=1,near:o=Y2,far:a=eB}=e;AM(t);const s=t/2,g=n*Math.tan(s),y=g*i;return this.ortho({left:-y,right:y,bottom:-g,top:g,near:o,far:a})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:i=1,near:n=.1,far:o=500}=e;return AM(t),Mq(this,t,i,n,o),this.check()}determinant(){return Bq(this)}getScale(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),n=1/i[0],o=1/i[1],a=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*o,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*n,e[5]=this[5]*o,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*n,e[9]=this[9]*o,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),n=1/i[0],o=1/i[1],a=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*o,e[2]=this[2]*a,e[3]=this[4]*n,e[4]=this[5]*o,e[5]=this[6]*a,e[6]=this[8]*n,e[7]=this[9]*o,e[8]=this[10]*a,e}transpose(){return wq(this,this),this.check()}invert(){return X2(this,this),this.check()}multiplyLeft(e){return Tf(this,e,this),this.check()}multiplyRight(e){return Tf(this,this,e),this.check()}rotateX(e){return cM(this,this,e),this.check()}rotateY(e){return Eq(this,this,e),this.check()}rotateZ(e){return uM(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return Cq(this,this,e,t),this.check()}scale(e){return Z2(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return S1(this,this,e),this.check()}transform(e,t){return e.length===4?(t=By(t||[-0,-0,-0,-0],e,this),xy(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:i}=e;let n;switch(i){case 2:n=ZL(t||[-0,-0],e,this);break;case 3:n=q2(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return xy(n,e.length),n}transformAsVector(e,t){let i;switch(e.length){case 2:i=JL(t||[-0,-0],e,this);break;case 3:i=YL(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return xy(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}}let T1,I1;function qq(){return T1||(T1=new Sn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(T1)),T1}function $q(){return I1||(I1=new Sn,Object.freeze(I1)),I1}function AM(r){if(r>Math.PI*2)throw Error("expected radians")}function Kq(r,e,t,i,n,o){const a=2*o/(t-e),s=2*o/(n-i),g=(t+e)/(t-e),y=(n+i)/(n-i),T=-1,I=-1,R=-2*o;return r[0]=a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=g,r[9]=y,r[10]=T,r[11]=I,r[12]=0,r[13]=0,r[14]=R,r[15]=0,r}function dM(){var r=new ah(4);return ah!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Wq(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function fM(r,e,t){t=t*.5;var i=Math.sin(t);return r[0]=i*e[0],r[1]=i*e[1],r[2]=i*e[2],r[3]=Math.cos(t),r}function pM(r,e,t){var i=e[0],n=e[1],o=e[2],a=e[3],s=t[0],g=t[1],y=t[2],T=t[3];return r[0]=i*T+a*s+n*y-o*g,r[1]=n*T+a*g+o*s-i*y,r[2]=o*T+a*y+i*g-n*s,r[3]=a*T-i*s-n*g-o*y,r}function Xq(r,e,t){t*=.5;var i=e[0],n=e[1],o=e[2],a=e[3],s=Math.sin(t),g=Math.cos(t);return r[0]=i*g+a*s,r[1]=n*g+o*s,r[2]=o*g-n*s,r[3]=a*g-i*s,r}function Zq(r,e,t){t*=.5;var i=e[0],n=e[1],o=e[2],a=e[3],s=Math.sin(t),g=Math.cos(t);return r[0]=i*g-o*s,r[1]=n*g+a*s,r[2]=o*g+i*s,r[3]=a*g-n*s,r}function Jq(r,e,t){t*=.5;var i=e[0],n=e[1],o=e[2],a=e[3],s=Math.sin(t),g=Math.cos(t);return r[0]=i*g+n*s,r[1]=n*g-i*s,r[2]=o*g+a*s,r[3]=a*g-o*s,r}function Yq(r,e){var t=e[0],i=e[1],n=e[2];return r[0]=t,r[1]=i,r[2]=n,r[3]=Math.sqrt(Math.abs(1-t*t-i*i-n*n)),r}function L1(r,e,t,i){var n=e[0],o=e[1],a=e[2],s=e[3],g=t[0],y=t[1],T=t[2],I=t[3],R,U,Z,Y,he;return U=n*g+o*y+a*T+s*I,U<0&&(U=-U,g=-g,y=-y,T=-T,I=-I),1-U>wy?(R=Math.acos(U),Z=Math.sin(R),Y=Math.sin((1-i)*R)/Z,he=Math.sin(i*R)/Z):(Y=1-i,he=i),r[0]=Y*n+he*g,r[1]=Y*o+he*y,r[2]=Y*a+he*T,r[3]=Y*s+he*I,r}function e$(r,e){var t=e[0],i=e[1],n=e[2],o=e[3],a=t*t+i*i+n*n+o*o,s=a?1/a:0;return r[0]=-t*s,r[1]=-i*s,r[2]=-n*s,r[3]=o*s,r}function t$(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r}function gM(r,e){var t=e[0]+e[4]+e[8],i;if(t>0)i=Math.sqrt(t+1),r[3]=.5*i,i=.5/i,r[0]=(e[5]-e[7])*i,r[1]=(e[6]-e[2])*i,r[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);var o=(n+1)%3,a=(n+2)%3;i=Math.sqrt(e[n*3+n]-e[o*3+o]-e[a*3+a]+1),r[n]=.5*i,i=.5/i,r[3]=(e[o*3+a]-e[a*3+o])*i,r[o]=(e[o*3+n]+e[n*3+o])*i,r[a]=(e[a*3+n]+e[n*3+a])*i}return r}var r$=kq,i$=hM,n$=zq,s$=Qq,o$=Oq,a$=Uq,mM=Nq,l$=function(){var r=tM(),e=iM(1,0,0),t=iM(0,1,0);return function(i,n,o){var a=j2(n,o);return a<-.999999?(x1(r,e,n),hq(r)<1e-6&&x1(r,t,n),sq(r,r),fM(i,r,Math.PI),i):a>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(x1(r,n,o),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=1+a,mM(i,i))}}();(function(){var r=dM(),e=dM();return function(t,i,n,o,a,s){return L1(r,i,a,s),L1(e,n,o,s),L1(t,r,e,2*s*(1-s)),t}})(),function(){var r=Aq();return function(e,t,i,n){return r[0]=i[0],r[3]=i[1],r[6]=i[2],r[1]=n[0],r[4]=n[1],r[7]=n[2],r[2]=-t[0],r[5]=-t[1],r[8]=-t[2],mM(e,gM(e,r))}}();const c$=[0,0,0,1];class Cy extends V2{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,t,i,n)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,i,n){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return gM(this,e),this.check()}fromAxisRotation(e,t){return fM(this,e,t),this.check()}identity(){return Wq(this),this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=ns(e)}get y(){return this[1]}set y(e){this[1]=ns(e)}get z(){return this[2]}set z(e){this[2]=ns(e)}get w(){return this[3]}set w(e){this[3]=ns(e)}len(){return o$(this)}lengthSquared(){return a$(this)}dot(e){return n$(this,e)}rotationTo(e,t){return l$(this,e,t),this.check()}add(e){return r$(this,this,e),this.check()}calculateW(){return Yq(this,this),this.check()}conjugate(){return t$(this,this),this.check()}invert(){return e$(this,this),this.check()}lerp(e,t,i){return i===void 0?this.lerp(this,e,t):(s$(this,e,t,i),this.check())}multiplyRight(e){return pM(this,this,e),this.check()}multiplyLeft(e){return pM(this,e,this),this.check()}normalize(){const e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,e===0&&(this[3]=1),this.check()}rotateX(e){return Xq(this,this,e),this.check()}rotateY(e){return Zq(this,this,e),this.check()}rotateZ(e){return Jq(this,this,e),this.check()}scale(e){return i$(this,this,e),this.check()}slerp(e,t,i){let n,o,a;switch(arguments.length){case 1:({start:n=c$,target:o,ratio:a}=e);break;case 2:n=this,o=e,a=t;break;default:n=e,o=t,a=i}return L1(this,n,o,a),this.check()}transformVector4(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new K2;return Vq(t,e,this),xy(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const Ey={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,EPSILON13:1e-13,EPSILON14:1e-14,EPSILON15:1e-15,EPSILON16:1e-16,EPSILON17:1e-17,EPSILON18:1e-18,EPSILON19:1e-19,EPSILON20:1e-20,PI_OVER_TWO:Math.PI/2,PI_OVER_FOUR:Math.PI/4,PI_OVER_SIX:Math.PI/6,TWO_PI:Math.PI*2},yM=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,u$={lightSources:{}};function tB(){let{color:r=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return r.map(t=>t*e/255)}function h$(r){let{ambientLight:e,pointLights:t=[],directionalLights:i=[]}=r;const n={};return e?n["lighting_uAmbientLight.color"]=tB(e):n["lighting_uAmbientLight.color"]=[0,0,0],t.forEach((o,a)=>{n["lighting_uPointLight[".concat(a,"].color")]=tB(o),n["lighting_uPointLight[".concat(a,"].position")]=o.position,n["lighting_uPointLight[".concat(a,"].attenuation")]=o.attenuation||[1,0,0]}),n.lighting_uPointLightCount=t.length,i.forEach((o,a)=>{n["lighting_uDirectionalLight[".concat(a,"].color")]=tB(o),n["lighting_uDirectionalLight[".concat(a,"].direction")]=o.direction}),n.lighting_uDirectionalLightCount=i.length,n}function _M(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:u$;if("lightSources"in r){const{ambientLight:e,pointLights:t,directionalLights:i}=r.lightSources||{};return e||t&&t.length>0||i&&i.length>0?Object.assign({},h$({ambientLight:e,pointLights:t,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in r){const e={pointLights:[],directionalLights:[]};for(const t of r.lights||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights.push(t);break;case"point":e.pointLights.push(t);break}return _M({lightSources:e})}return{}}const rB={name:"lights",vs:yM,fs:yM,getUniforms:_M,defines:{MAX_LIGHTS:3}},A$={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};function d$(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:A$;const e={};if(r.pickingSelectedColor!==void 0)if(!r.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const t=r.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=t}if(r.pickingHighlightColor){const t=Array.from(r.pickingHighlightColor,i=>i/255);Number.isFinite(t[3])||(t[3]=1),e.picking_uHighlightColor=t}return r.pickingActive!==void 0&&(e.picking_uActive=!!r.pickingActive,e.picking_uAttribute=!!r.pickingAttribute),e}const f$={name:"picking",vs:`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,getUniforms:d$},vM=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,p$={};function g$(r){const{ambient:e=.35,diffuse:t=.6,shininess:i=32,specularColor:n=[30,30,30]}=r;return{lighting_uAmbient:e,lighting_uDiffuse:t,lighting_uShininess:i,lighting_uSpecularColor:n.map(o=>o/255)}}function bM(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p$;if(!("material"in r))return{};const{material:e}=r;return e?g$(e):{lighting_uEnabled:!1}}const m$={name:"gouraud-lighting",dependencies:[rB],vs:vM,defines:{LIGHTING_VERTEX:1},getUniforms:bM},y$={name:"phong-lighting",dependencies:[rB],fs:vM,defines:{LIGHTING_FRAGMENT:1},getUniforms:bM},iB={name:"pbr",vs:`uniform mat4 u_MVPMatrix;
uniform mat4 u_ModelMatrix;
uniform mat4 u_NormalMatrix;

varying vec3 pbr_vPosition;
varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
# else
varying vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = u_ModelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else
  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,fs:`#if defined(USE_TEX_LOD) && !defined(FEATURE_GLSL_TEXTURE_LOD)
# error PBR fragment shader: Texture LOD is not available
#endif

#if !defined(HAS_TANGENTS) && !defined(FEATURE_GLSL_DERIVATIVES)
# error PBR fragment shader: Derivatives are not available
#endif


#if (__VERSION__ < 300)
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)
#else
  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)
#endif

precision highp float;

uniform bool pbr_uUnlit;

#ifdef USE_IBL
uniform samplerCube u_DiffuseEnvSampler;
uniform samplerCube u_SpecularEnvSampler;
uniform sampler2D u_brdfLUT;
uniform vec2 u_ScaleIBLAmbient;
#endif

#ifdef HAS_BASECOLORMAP
uniform sampler2D u_BaseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D u_NormalSampler;
uniform float u_NormalScale;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D u_EmissiveSampler;
uniform vec3 u_EmissiveFactor;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D u_MetallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D u_OcclusionSampler;
uniform float u_OcclusionStrength;
#endif

#ifdef ALPHA_CUTOFF
uniform float u_AlphaCutoff;
#endif

uniform vec2 u_MetallicRoughnessValues;
uniform vec4 u_BaseColorFactor;

uniform vec3 u_Camera;
#ifdef PBR_DEBUG
uniform vec4 u_ScaleDiffBaseMR;
uniform vec4 u_ScaleFGDSpec;
#endif

varying vec3 pbr_vPosition;

varying vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
varying mat3 pbr_vTBN;
#else
varying vec3 pbr_vNormal;
#endif
#endif


struct PBRInfo
{
  float NdotL;
  float NdotV;
  float NdotH;
  float LdotH;
  float VdotH;
  float perceptualRoughness;
  float metalness;
  vec3 reflectance0;
  vec3 reflectance90;
  float alphaRoughness;
  vec3 diffuseColor;
  vec3 specularColor;
  vec3 n;
  vec3 v;
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif
  return vec4(linOut,srgbIn.w);;
#else
  return srgbIn;
#endif
}

vec3 getNormal()
{
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));
#else
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}


#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)
{
  float mipCount = 9.0;
  float lod = (pbrInputs.perceptualRoughness * mipCount);
  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,
    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(textureCubeLod(u_SpecularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;
  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);
  diffuse *= u_ScaleIBLAmbient.x;
  specular *= u_ScaleIBLAmbient.y;

  return diffuse + specular;
}
#endif


vec3 diffuse(PBRInfo pbrInputs)
{
  return pbrInputs.diffuseColor / M_PI;
}

vec3 specularReflection(PBRInfo pbrInputs)
{
  return pbrInputs.reflectance0 +
    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *
    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);
}



float geometricOcclusion(PBRInfo pbrInputs)
{
  float NdotL = pbrInputs.NdotL;
  float NdotV = pbrInputs.NdotV;
  float r = pbrInputs.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}





float microfacetDistribution(PBRInfo pbrInputs)
{
  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;
  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {
  pbrInputs.NdotL = 1.0;
  pbrInputs.NdotH = 0.0;
  pbrInputs.LdotH = 0.0;
  pbrInputs.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {
  vec3 n = pbrInputs.n;
  vec3 v = pbrInputs.v;
  vec3 l = normalize(lightDirection);
  vec3 h = normalize(l+v);

  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInputs, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {
  vec3 F = specularReflection(pbrInputs);
  float G = geometricOcclusion(pbrInputs);
  float D = microfacetDistribution(pbrInputs);
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);
  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);
  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;
#else
  vec4 baseColor = u_BaseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < u_AlphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbr_uUnlit){
    color.rgb = baseColor.rgb;
  }
  else{


    float perceptualRoughness = u_MetallicRoughnessValues.y;
    float metallic = u_MetallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP

    vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);

    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);



    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();
    vec3 v = normalize(u_Camera - pbr_vPosition);

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInputs = PBRInfo(
      0.0,
      NdotV,
      0.0,
      0.0,
      0.0,
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );

#ifdef USE_LIGHTS
    PBRInfo_setAmbientLight(pbrInputs);
    color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {
      if (i < lighting_uDirectionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);
        color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);
      }
    }
    SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {
      if (i < lighting_uPointLightCount) {
        PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);
        float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));
        color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);
      }
    }
#endif
#ifdef USE_IBL
    color += getIBLContribution(pbrInputs, n, reflection);
#endif
#ifdef HAS_OCCLUSIONMAP
    float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;
    color = mix(color, color * ao, u_OcclusionStrength);
#endif

#ifdef HAS_EMISSIVEMAP
    vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;
    color += emissive;
#endif

#ifdef PBR_DEBUG





    color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,defines:{LIGHTING_FRAGMENT:1},dependencies:[rB]},_$={name:"transform",vs:`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,fs:null};class Sy{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Sy(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(t=>t.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==t),this.stateHash++}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:t="",fs:i="",defines:n={},inject:o={},varyings:a=[],bufferMode:s=35981,transpileToGLSL100:g=!1}=e,y=this._getModuleList(e.modules),T=this._getHash(t),I=this._getHash(i),R=y.map(be=>this._getHash(be.name)).sort(),U=a.map(be=>this._getHash(be)),Z=Object.keys(n).sort(),Y=Object.keys(o).sort(),he=[],ce=[];for(const be of Z)he.push(this._getHash(be)),he.push(this._getHash(n[be]));for(const be of Y)ce.push(this._getHash(be)),ce.push(this._getHash(o[be]));const pe="".concat(T,"/").concat(I,"D").concat(he.join("/"),"M").concat(R.join("/"),"I").concat(ce.join("/"),"V").concat(U.join("/"),"H").concat(this.stateHash,"B").concat(s).concat(g?"T":"");if(!this._programCache[pe]){const be=Tj(this.gl,{vs:t,fs:i,modules:y,inject:o,defines:n,hookFunctions:this._hookFunctions,transpileToGLSL100:g});this._programCache[pe]=new EL(this.gl,{hash:pe,vs:be.vs,fs:be.fs,varyings:a,bufferMode:s}),this._getUniforms[pe]=be.getUniforms||(Te=>{}),this._useCounts[pe]=0}return this._useCounts[pe]++,this._programCache[pe]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const t=e.hash;this._useCounts[t]--,this._useCounts[t]===0&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const t=new Array(this._defaultModules.length+e.length),i={};let n=0;for(let o=0,a=this._defaultModules.length;o<a;++o){const s=this._defaultModules[o],g=s.name;t[n++]=s,i[g]=!0}for(let o=0,a=e.length;o<a;++o){const s=e[o],g=s.name;i[g]||(t[n++]=s,i[g]=!0)}return t.length=n,t}}const v$={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function b$(r,e,t){const i={};let n=e.indices;for(const o in e.attributes){const a=e.attributes[o],s=x$(o,t);if(o==="indices")n=a;else if(a.constant)i[s]=a.value;else{const g=a.value,y={...a};delete y.value,i[s]=[new ws(r,g),y],w$(o,y)}}if(n){const o=n.value||n;Jr(o instanceof Uint16Array||o instanceof Uint32Array,'attribute array for "indices" must be of integer type');const a={size:1,isIndexed:n.isIndexed===void 0?!0:n.isIndexed};i.indices=[new ws(r,{data:o,target:34963}),a]}return i}function x$(r,e){const{attributeMap:t=v$}=e||{};return t&&t[r]||r}function w$(r,e){let t;switch(r){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":t="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":t="vectors";break}switch(t){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}Jr(Number.isFinite(e.size),"attribute ".concat(r," needs size"))}const cg=2,B$=1e4,C$="Model needs drawMode and vertexCount",xM=()=>{},E$={};class ug{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=IA("model")}=t;Jr(c1(e)),this.id=i,this.gl=e,this.id=t.id||IA("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(t)}initialize(e){this.props={},this.programManager=e.programManager||Sy.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:t=null,vs:i,fs:n,modules:o,defines:a,inject:s,varyings:g,bufferMode:y,transpileToGLSL100:T}=e;this.programProps={program:t,vs:i,fs:n,modules:o,defines:a,inject:s,varyings:g,bufferMode:y,transpileToGLSL100:T},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},Jr(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),C$)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:t,vs:i,fs:n,modules:o,defines:a,inject:s,varyings:g,bufferMode:y,transpileToGLSL100:T}=e;this.programProps={program:t,vs:i,fs:n,modules:o,defines:a,inject:s,varyings:g,bufferMode:y,transpileToGLSL100:T},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return Jr(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return Jr(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=b$(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ng(e))return this;const t={};for(const i in e){const n=e[i];t[i]=n.getValue?n.getValue():n}return this.vertexArray.setAttributes(t),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){const t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return E2(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:t=null,framebuffer:i,uniforms:n={},attributes:o={},transformFeedback:a=this.transformFeedback,parameters:s={},vertexArray:g=this.vertexArray}=e;this.setAttributes(o),this.updateModuleSettings(t),this.setUniforms(n);let y;Ai.priority>=cg&&(y=this._logDrawCallStart(cg));const T=this.vertexArray.getDrawParams(),{isIndexed:I=T.isIndexed,indexType:R=T.indexType,indexOffset:U=T.indexOffset,vertexArrayInstanced:Z=T.isInstanced}=this.props;Z&&!this.isInstanced&&Ai.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:Y,instanceCount:he}=this,{onBeforeRender:ce=xM,onAfterRender:pe=xM}=this.props;ce(),this.program.setUniforms(this.uniforms);const be=this.program.draw(Object.assign(E$,e,{logPriority:y,uniforms:null,framebuffer:i,parameters:s,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:g,transformFeedback:a,isIndexed:I,indexType:R,isInstanced:Y,instanceCount:he,offset:I?U:0}));return pe(),Ai.priority>=cg&&this._logDrawCallEnd(y,g,i),be}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:t=!0,feedbackBuffers:i,unbindModels:n=[]}=e;let{parameters:o}=e;i&&this._setFeedbackBuffers(i),t&&(o=Object.assign({},o,{35977:t})),n.forEach(a=>a.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:o}))}finally{n.forEach(a=>a.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Ai.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:i,fs:n,modules:o,inject:a,defines:s,varyings:g,bufferMode:y,transpileToGLSL100:T}=this.programProps;t=this.programManager.get({vs:i,fs:n,modules:o,inject:a,defines:s,varyings:g,bufferMode:y,transpileToGLSL100:T}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}Jr(t instanceof EL,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new HG(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof ws&&t.delete()}}_setAnimationProps(e){this.animated&&Jr(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(ng(e))return this;const{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new SL(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const t=e>3?0:B$;if(!(Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),Ai.group(cg,">>> DRAWING MODEL ".concat(this.id),{collapsed:Ai.level<=2})(),e}_logDrawCallEnd(e,t,i,n){if(e===void 0)return;const o=qG({vertexArray:t,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:a,unusedTable:s,unusedCount:g}=TL({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:y,count:T}=TL({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});T>0&&Ai.log("MISSING UNIFORMS",Object.keys(y))(),g>0&&Ai.log("UNUSED UNIFORMS",Object.keys(s))();const I=KG(this.vertexArray.configuration);Ai.table(e,o)(),Ai.table(e,a)(),Ai.table(e+1,I)(),n&&n.log({logLevel:cg,message:"Rendered to ".concat(n.id)}),Ai.groupEnd(cg)()}}class S${constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:n}=t;return{attributes:Object.assign({},i,e.attributes),transformFeedback:n}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:t}=this.bindings[this.currentIndex],i=e?t[e]:null;return i?i instanceof ws?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:t}=e,i=this.getBuffer(t);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Jr(dn(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:t={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const n in this.feedbackMap){const o=this.feedbackMap[n];n in t&&(i[o]=n)}Object.assign(i,e.feedbackBuffers);for(const n in i){const o=i[n];if(typeof o=="string"){const a=t[o],{byteLength:s,usage:g,accessor:y}=a;i[n]=this._createNewBuffer(n,{byteLength:s,usage:g,accessor:y})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:i})}_setupTransformFeedback(e,t){let{model:i}=t;const{program:n}=i;e.transformFeedback=new SL(this.gl,{program:n,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:t,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:t,feedbackBuffers:i})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const n in this.feedbackMap){const o=this.feedbackMap[n];t[n]=e.feedbackBuffers[o],i[o]=e.sourceBuffers[n],Jr(i[o]instanceof ws)}return{sourceBuffers:t,feedbackBuffers:i}}_createNewBuffer(e,t){const i=new ws(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const T$="transform_uSampler_",M1="transform_uSize_",wM="transform_position";function I$(r){let{vs:e,sourceTextureMap:t,targetTextureVarying:i,targetTexture:n}=r,a=Object.keys(t).length,s=null;const g={};let y=e,T={};if(a>0||i){const I=y.split(`
`),R=I.slice();if(I.forEach((U,Z,Y)=>{if(a>0){const he=D$(U,t);if(he){const{updatedLine:ce,inject:pe}=he;R[Z]=ce,T=U2([T,pe]),Object.assign(g,he.samplerTextureMap),a--}}i&&!s&&(s=F$(U,i))}),i){Jr(n);const U="".concat(M1).concat(i),Z="uniform vec2 ".concat(U,`;
`),Y="     vec2 ".concat(wM," = transform_getPos(").concat(U,`);
     gl_Position = vec4(`).concat(wM,`, 0, 1.);
`);T=U2([T,{"vs:#decl":Z,"vs:#main-start":Y}])}y=R.join(`
`)}return{vs:y,targetTextureType:s,inject:T,samplerTextureMap:g}}function L$(r){let{sourceTextureMap:e,targetTextureVarying:t,targetTexture:i}=r;const n={};let o,a;t&&({width:o,height:a}=i,n["".concat(M1).concat(t)]=[o,a]);for(const s in e)({width:o,height:a}=e[s]),n["".concat(M1).concat(s)]=[o,a];return n}function M$(r){return qL(r,["attribute","in"])}function P$(r){const e="".concat(T$).concat(r),t="".concat(M1).concat(r),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(t,";");return{samplerName:e,sizeName:t,uniformDeclerations:i}}function F$(r,e){const t=qL(r,["varying","out"]);return t&&t.name===e?t.type:null}function D$(r,e){const t={},i=M$(r);if(!i)return null;const{type:n,name:o}=i;if(o&&e[o]){const a="// ".concat(r," => Replaced by Transform with a sampler"),{samplerName:s,sizeName:g,uniformDeclerations:y}=P$(o),T=Oj(n),I="  ".concat(n," ").concat(o," = transform_getInput(").concat(s,", ").concat(g,").").concat(T,`;
`);return t[s]=o,{updatedLine:a,inject:{"vs:#decl":y,"vs:#main-start":I},samplerTextureMap:t}}return null}const R$={10241:9728,10240:9728,10242:33071,10243:33071},k$="transform_output";class O${constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,sourceTextures:i,framebuffer:n,targetTexture:o}=this.bindings[this.currentIndex],a=Object.assign({},t,e.attributes),s=Object.assign({},e.uniforms),g=Object.assign({},e.parameters);let y=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){a.transform_elementID=this.elementIDBuffer;for(const I in this.samplerTextureMap){const R=this.samplerTextureMap[I];s[I]=i[R]}this._setSourceTextureParameters();const T=L$({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:o});Object.assign(s,T)}return this.hasTargetTexture&&(y=!1,g.viewport=[0,0,n.width,n.height]),{attributes:a,framebuffer:n,uniforms:s,discard:y,parameters:g}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:t}=this.bindings[this.currentIndex],i=h1(t);if(!e)return i;const n=i.constructor,o=Uj(this.targetTextureType),a=new n(i.length*o/4);let s=0;for(let g=0;g<i.length;g+=4)for(let y=0;y<o;y++)a[s++]=i[g+y];return a}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:t,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:t,textureOrReference:i}=e;if(i instanceof iu)return i;const n=t[i];return n?(this._targetRefTexName=i,this._createNewTexture(n)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:t,_sourceTextures:i={},_targetTexture:n}=e,o=this._createTargetTexture({sourceTextures:i,textureOrReference:n});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:t,sourceTextures:i,targetTexture:o}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const t=new Float32Array(e);t.forEach((i,n,o)=>{o[n]=n}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new ws(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:t,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:t,targetTexture:i})}}_updateBinding(e,t){const{sourceBuffers:i,sourceTextures:n,targetTexture:o}=t;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),Object.assign(e.sourceBuffers,i),o){e.targetTexture=o;const{width:a,height:s}=o,{framebuffer:g}=e;g?(g.update({attachments:{36064:o},resizeAttachments:!1}),g.resize({width:a,height:s})):e.framebuffer=new Ba(this.gl,{id:"transform-framebuffer",width:a,height:s,attachments:{36064:o}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const i in t)t[i].setParameters(R$)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);t[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:t,targetTexture:i}}_createNewTexture(e){const t=P7(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:t,targetTexture:i}=this.bindings[this.currentIndex],{vs:n,uniforms:o,targetTextureType:a,inject:s,samplerTextureMap:g}=I$({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),y=U2([e.inject||{},s]);this.targetTextureType=a,this.samplerTextureMap=g;const T=e._fs||$L({version:_L(n),input:this.targetTextureVarying,inputType:a,output:k$}),I=this.hasSourceTextures||this.targetTextureVarying?[_$].concat(e.modules||[]):e.modules;return{vs:n,fs:T,modules:I,uniforms:o,inject:y}}}class nB{static isSupported(e){return dn(e)}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:i}=this;e&&e.delete(),t&&t.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:t=!0}=e,i=this._updateDrawOptions(e);t&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of t)e=e||i.swap();Jr(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of t){const n=i.getData(e);if(n)return n}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of t)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new ug(t,Object.assign({},e,{fs:e.fs||$L({version:_L(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of i)t=n.updateModelProps(t);return t}_buildResourceTransforms(e,t){U$(t)&&(this.bufferTransform=new S$(e,t)),N$(t)&&(this.textureTransform=new O$(e,t)),Jr(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of i)t=Object.assign(t,n.getDrawOptions(t));return t}}function U$(r){return!!(!ng(r.feedbackBuffers)||!ng(r.feedbackMap)||r.varyings&&r.varyings.length>0)}function N$(r){return!!(!ng(r._sourceTextures)||r._targetTexture||r._targetTextureVarying)}const BM={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Ty{static get DRAW_MODE(){return BM}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t=IA("geometry"),drawMode:i=BM.TRIANGLES,attributes:n={},indices:o=null,vertexCount:a=null}=e;this.id=t,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(n,o),this.vertexCount=a||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(const i in e){let n=e[i];n=ArrayBuffer.isView(n)?{value:n}:n,Jr(ArrayBuffer.isView(n.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!n.size&&(n.size=3),i==="indices"?(Jr(!this.indices),this.indices=n):this.attributes[i]=n}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(const n in e){const o=e[n],{value:a,size:s,constant:g}=o;!g&&a&&s>=1&&(i=Math.min(i,a.length/s))}return Jr(Number.isFinite(i)),i}}let z$=1,Q$=1;class CM{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:n=1,repeat:o=1}=e,a=z$++,s={time:0,delay:t,duration:i,rate:n,repeat:o};return this._setChannelTime(s,this.time),this.channels.set(a,s),a}removeChannel(e){this.channels.delete(e);for(const[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const n of t)this._setChannelTime(n,this.time);const i=this.animations.values();for(const n of i){const{animation:o,channel:a}=n;o.setTime(this.getTime(a))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const i=Q$++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const i=t-e.delay,n=e.duration*e.repeat;i>=n?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const V$=[255,255,255],H$=1;let G$=0;class EM{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id",void 0),ye(this,"color",void 0),ye(this,"intensity",void 0),ye(this,"type","ambient");const{color:t=V$}=e,{intensity:i=H$}=e;this.id=e.id||"ambient-".concat(G$++),this.color=t,this.intensity=i}}const j$=[255,255,255],q$=1,$$=[0,0,-1];let K$=0;class SM{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id",void 0),ye(this,"color",void 0),ye(this,"intensity",void 0),ye(this,"type","directional"),ye(this,"direction",void 0),ye(this,"shadow",void 0);const{color:t=j$}=e,{intensity:i=q$}=e,{direction:n=$$}=e,{_shadow:o=!1}=e;this.id=e.id||"directional-".concat(K$++),this.color=t,this.intensity=i,this.type="directional",this.direction=new Ut(n).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class W${constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"pass"};ye(this,"id",void 0),ye(this,"gl",void 0),ye(this,"props",void 0);const{id:i}=t;this.id=i,this.gl=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class sB extends W${constructor(){super(...arguments),ye(this,"_lastRenderIndex",-1)}render(e){const t=this.gl;return TA(t,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:t,moduleParameters:i,viewports:n,views:o,onViewportActive:a,clearStack:s=!0,clearCanvas:g=!0}=e;e.pass=e.pass||"unknown";const y=this.gl;g&&Z$(y,t),s&&(this._lastRenderIndex=-1);const T=[];for(const I of n){const R=o&&o[I.id];a==null||a(I);const U=this._getDrawLayerParams(I,e),Z=I.subViewports||[I];for(const Y of Z){const he=this._drawLayersInViewport(y,{target:t,moduleParameters:i,viewport:Y,view:R,pass:e.pass,layers:e.layers},U);T.push(he)}}return T}_getDrawLayerParams(e,t){let{layers:i,pass:n,isPicking:o=!1,layerFilter:a,cullRect:s,effects:g,moduleParameters:y}=t,T=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const I=[],R=TM(this._lastRenderIndex+1),U={layer:i[0],viewport:e,isPicking:o,renderPass:n,cullRect:s},Z={};for(let Y=0;Y<i.length;Y++){const he=i[Y],ce=this._shouldDrawLayer(he,U,a,Z),pe={shouldDrawLayer:ce};ce&&!T&&(pe.layerRenderIndex=R(he,ce),pe.moduleParameters=this._getModuleParameters(he,g,n,y),pe.layerParameters=this.getLayerParameters(he,Y,e)),I[Y]=pe}return I}_drawLayersInViewport(e,t,i){let{layers:n,moduleParameters:o,pass:a,target:s,viewport:g,view:y}=t;const T=X$(e,{moduleParameters:o,target:s,viewport:g});if(y&&y.props.clear){const R=y.props.clear===!0?{color:!0,depth:!0}:y.props.clear;nh(e,{scissorTest:!0,scissor:T},()=>E2(e,R))}const I={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};TA(e,{viewport:T});for(let R=0;R<n.length;R++){const U=n[R],{shouldDrawLayer:Z,layerRenderIndex:Y,moduleParameters:he,layerParameters:ce}=i[R];if(Z&&U.props.pickable&&I.pickableCount++,U.isComposite)I.compositeCount++;else if(Z){I.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,Y),he.viewport=g;try{U._drawLayer({moduleParameters:he,uniforms:{layerIndex:Y},parameters:ce})}catch(pe){U.raiseError(pe,"drawing ".concat(U," to ").concat(a))}}}return I}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,n){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let a=e.parent;for(;a;){if(!a.props.visible||!a.filterSubLayer(t))return!1;t.layer=a,a=a.parent}if(i){const s=t.layer.id;if(s in n||(n[s]=i(t)),!n[s])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,i,n){var o;const a=Object.assign(Object.create(((o=e.internalState)===null||o===void 0?void 0:o.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:ig(this.gl)});if(t)for(const g of t){var s;Object.assign(a,(s=g.getModuleParameters)===null||s===void 0?void 0:s.call(g,e))}return Object.assign(a,this.getModuleParameters(e,t),n)}}function TM(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t={},i=(n,o)=>{const a=n.props._offset,s=n.id,g=n.parent&&n.parent.id;let y;if(g&&!(g in e)&&i(n.parent,!1),g in t){const T=t[g]=t[g]||TM(e[g],e);y=T(n,o),t[s]=T}else Number.isFinite(a)?(y=a+(e[g]||0),t[s]=null):y=r;return o&&y>=r&&(r=y+1),e[s]=y,y};return i}function X$(r,e){let{moduleParameters:t,target:i,viewport:n}=e;const o=i&&i.id!=="default-framebuffer",a=t&&t.devicePixelRatio||ig(r),s=o?i.height:r.drawingBufferHeight,g=n;return[g.x*a,s-(g.y+g.height)*a,g.width*a,g.height*a]}function Z$(r,e){const t=e?e.width:r.drawingBufferWidth,i=e?e.height:r.drawingBufferHeight;TA(r,{viewport:[0,0,t,i]}),r.clear(16640)}class J$ extends sB{constructor(e,t){super(e,t),ye(this,"shadowMap",void 0),ye(this,"depthBuffer",void 0),ye(this,"fbo",void 0),this.shadowMap=new iu(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new ag(e,{format:33189,width:1,height:1}),this.fbo=new Ba(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const t=this.fbo;nh(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],n=ig(this.gl),o=i.width*n,a=i.height*n;(o!==t.width||a!==t.height)&&t.resize({width:o,height:a}),super.render({...e,target:t,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const IM="#define SMOOTH_EDGE_RADIUS 0.5",Y$=`
`.concat(IM,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),eK=`
`.concat(IM,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),tK={name:"geometry",vs:Y$,fs:eK},rK=Object.keys(Mn).map(r=>"const int COORDINATE_SYSTEM_".concat(r," = ").concat(Mn[r],";")).join(""),iK=Object.keys(Vh).map(r=>"const int PROJECTION_MODE_".concat(r," = ").concat(Vh[r],";")).join(""),nK=Object.keys(d2).map(r=>"const int UNIT_".concat(r.toUpperCase()," = ").concat(d2[r],";")).join(""),sK="".concat(rK,`
`).concat(iK,`
`).concat(nK,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function oK(r,e){if(r===e)return!0;if(Array.isArray(r)){const t=r.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(r[i]!==e[i])return!1;return!0}return!1}function Iy(r){let e={},t;return i=>{for(const n in i)if(!oK(i[n],e[n])){t=r(i),e=i;break}return t}}const LM=[0,0,0,0],aK=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],MM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],lK=[0,0,0],PM=[0,0,0],cK=Iy(AK);function FM(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:PM;t.length<3&&(t=[t[0],t[1],0]);let i=t,n,o=!0;switch(e===Mn.LNGLAT_OFFSETS||e===Mn.METER_OFFSETS?n=t:n=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case Vh.WEB_MERCATOR:(e===Mn.LNGLAT||e===Mn.CARTESIAN)&&(n=[0,0,0],o=!1);break;case Vh.WEB_MERCATOR_AUTO_OFFSET:e===Mn.LNGLAT?i=n:e===Mn.CARTESIAN&&(i=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],n=r.unprojectPosition(i),i[0]-=t[0],i[1]-=t[1],i[2]-=t[2]);break;case Vh.IDENTITY:i=r.position.map(Math.fround),i[2]=i[2]||0;break;case Vh.GLOBE:o=!1,n=null;break;default:o=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:i,offsetMode:o}}function uK(r,e,t){const{viewMatrixUncentered:i,projectionMatrix:n}=r;let{viewMatrix:o,viewProjectionMatrix:a}=r,s=LM,g=LM,y=r.cameraPosition;const{geospatialOrigin:T,shaderCoordinateOrigin:I,offsetMode:R}=FM(r,e,t);return R&&(g=r.projectPosition(T||I),y=[y[0]-g[0],y[1]-g[1],y[2]-g[2]],g[3]=1,s=By([],g,a),o=i||o,a=Tf([],n,o),a=Tf([],a,aK)),{viewMatrix:o,viewProjectionMatrix:a,projectionCenter:s,originCommon:g,cameraPosCommon:y,shaderCoordinateOrigin:I,geospatialOrigin:T}}function hK(r){let{viewport:e,devicePixelRatio:t=1,modelMatrix:i=null,coordinateSystem:n=Mn.DEFAULT,coordinateOrigin:o=PM,autoWrapLongitude:a=!1}=r;n===Mn.DEFAULT&&(n=e.isGeospatial?Mn.LNGLAT:Mn.CARTESIAN);const s=cK({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:o});return s.project_uWrapLongitude=a,s.project_uModelMatrix=i||MM,s}function AK(r){let{viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:n}=r;const{projectionCenter:o,viewProjectionMatrix:a,originCommon:s,cameraPosCommon:g,shaderCoordinateOrigin:y,geospatialOrigin:T}=uK(e,i,n),I=e.getDistanceScales(),R=[e.width*t,e.height*t],U=By([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,Z={project_uCoordinateSystem:i,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:y,project_uCommonOrigin:s.slice(0,3),project_uCenter:o,project_uPseudoMeters:!!e._pseudoMeters,project_uViewportSize:R,project_uDevicePixelRatio:t,project_uFocalDistance:U,project_uCommonUnitsPerMeter:I.unitsPerMeter,project_uCommonUnitsPerWorldUnit:I.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:lK,project_uScale:e.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:a,project_uModelMatrix:MM,project_uCameraPosition:g};if(T){const Y=e.getDistanceScales(T);switch(i){case Mn.METER_OFFSETS:Z.project_uCommonUnitsPerWorldUnit=Y.unitsPerMeter,Z.project_uCommonUnitsPerWorldUnit2=Y.unitsPerMeter2;break;case Mn.LNGLAT:case Mn.LNGLAT_OFFSETS:e._pseudoMeters||(Z.project_uCommonUnitsPerMeter=Y.unitsPerMeter),Z.project_uCommonUnitsPerWorldUnit=Y.unitsPerDegree,Z.project_uCommonUnitsPerWorldUnit2=Y.unitsPerDegree2;break;case Mn.CARTESIAN:Z.project_uCommonUnitsPerWorldUnit=[1,1,Y.unitsPerMeter[2]],Z.project_uCommonUnitsPerWorldUnit2=[0,0,Y.unitsPerMeter2[2]];break}}return Z}const dK={};function fK(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:dK;return"viewport"in r?hK(r):{}}const oB={name:"project",dependencies:[zj,tK],vs:sK,getUniforms:fK};function pK(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function hg(r,e){const t=By([],e,r);return hM(t,t,1/t[3]),t}function DM(r,e){const t=r%e;return t<0?e+t:t}function aB(r,e,t){return r<e?e:r>t?t:r}function gK(r){return Math.log(r)*Math.LOG2E}const lB=Math.log2||gK;function DA(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const lh=Math.PI,RM=lh/4,Lu=lh/180,cB=180/lh,Ag=512,P1=4003e4,F1=85.051129,mK=1.5;function yK(r){return lB(r)}function Ly(r){const[e,t]=r;DA(Number.isFinite(e)),DA(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const i=e*Lu,n=t*Lu,o=Ag*(i+lh)/(2*lh),a=Ag*(lh+Math.log(Math.tan(RM+n*.5)))/(2*lh);return[o,a]}function dg(r){const[e,t]=r,i=e/Ag*(2*lh)-lh,n=2*(Math.atan(Math.exp(t/Ag*(2*lh)-lh))-RM);return[i*cB,n*cB]}function _K(r){const{latitude:e}=r;DA(Number.isFinite(e));const t=Math.cos(e*Lu);return yK(P1*t)-9}function D1(r){const e=Math.cos(r*Lu);return Ag/P1/e}function uB(r){const{latitude:e,longitude:t,highPrecision:i=!1}=r;DA(Number.isFinite(e)&&Number.isFinite(t));const n=Ag,o=Math.cos(e*Lu),a=n/360,s=a/o,g=n/P1/o,y={unitsPerMeter:[g,g,g],metersPerUnit:[1/g,1/g,1/g],unitsPerDegree:[a,s,g],degreesPerUnit:[1/a,1/s,1/g]};if(i){const T=Lu*Math.tan(e*Lu)/o,I=a*T/2,R=n/P1*T,U=R/s*g;y.unitsPerDegree2=[0,I,R],y.unitsPerMeter2=[U,0,U]}return y}function kM(r,e){const[t,i,n]=r,[o,a,s]=e,{unitsPerMeter:g,unitsPerMeter2:y}=uB({longitude:t,latitude:i,highPrecision:!0}),T=Ly(r);T[0]+=o*(g[0]+y[0]*a),T[1]+=a*(g[1]+y[1]*a);const I=dg(T),R=(n||0)+(s||0);return Number.isFinite(n)||Number.isFinite(s)?[I[0],I[1],R]:I}function vK(r){const{height:e,pitch:t,bearing:i,altitude:n,scale:o,center:a}=r,s=pK();S1(s,s,[0,0,-n]),cM(s,s,-t*Lu),uM(s,s,i*Lu);const g=o/e;return Z2(s,s,[g,g,g]),a&&S1(s,s,nq([],a)),s}function bK(r){const{width:e,height:t,altitude:i,pitch:n=0,offset:o,center:a,scale:s,nearZMultiplier:g=1,farZMultiplier:y=1}=r;let{fovy:T=R1(mK)}=r;i!==void 0&&(T=R1(i));const I=T*Lu,R=n*Lu,U=OM(T);let Z=U;a&&(Z+=a[2]*s/Math.cos(R)/t);const Y=I*(.5+(o?o[1]:0)/t),he=Math.sin(Y)*Z/Math.sin(aB(Math.PI/2-R-Y,.01,Math.PI-.01)),ce=Math.sin(R)*he+Z,pe=Z*10,be=Math.min(ce*y,pe);return{fov:I,aspect:e/t,focalDistance:U,near:g,far:be}}function R1(r){return 2*Math.atan(.5/r)*cB}function OM(r){return .5/Math.tan(.5*r*Lu)}function UM(r,e){const[t,i,n=0]=r;return DA(Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(n)),hg(e,[t,i,n,1])}function hB(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const[i,n,o]=r;if(DA(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(o))return hg(e,[i,n,o,1]);const a=hg(e,[i,n,0,1]),s=hg(e,[i,n,1,1]),g=a[2],y=s[2],T=g===y?0:((t||0)-g)/(y-g);return WL([],a,s,T)}function xK(r){const{width:e,height:t,bounds:i,minExtent:n=0,maxZoom:o=24,offset:a=[0,0]}=r,[[s,g],[y,T]]=i,I=wK(r.padding),R=Ly([s,aB(T,-F1,F1)]),U=Ly([y,aB(g,-F1,F1)]),Z=[Math.max(Math.abs(U[0]-R[0]),n),Math.max(Math.abs(U[1]-R[1]),n)],Y=[e-I.left-I.right-Math.abs(a[0])*2,t-I.top-I.bottom-Math.abs(a[1])*2];DA(Y[0]>0&&Y[1]>0);const he=Y[0]/Z[0],ce=Y[1]/Z[1],pe=(I.right-I.left)/2/he,be=(I.top-I.bottom)/2/ce,Te=[(U[0]+R[0])/2+pe,(U[1]+R[1])/2+be],qe=dg(Te),je=Math.min(o,lB(Math.abs(Math.min(he,ce))));return DA(Number.isFinite(je)),{longitude:qe[0],latitude:qe[1],zoom:je}}function wK(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(DA(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const NM=Math.PI/180;function BK(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const{width:t,height:i,unproject:n}=r,o={targetZ:e},a=n([0,i],o),s=n([t,i],o);let g,y;const T=r.fovy?.5*r.fovy*NM:Math.atan(.5/r.altitude),I=(90-r.pitch)*NM;return T>I-.01?(g=zM(r,0,e),y=zM(r,t,e)):(g=n([0,0],o),y=n([t,0],o)),[a,s,y,g]}function zM(r,e,t){const{pixelUnprojectionMatrix:i}=r,n=hg(i,[e,0,1,1]),o=hg(i,[e,r.height,1,1]),s=(t*r.distanceScales.unitsPerMeter[2]-n[2])/(o[2]-n[2]),g=WL([],n,o,s),y=dg(g);return y.push(t),y}const QM=512;function CK(r){const{width:e,height:t,pitch:i=0}=r;let{longitude:n,latitude:o,zoom:a,bearing:s=0}=r;(n<-180||n>180)&&(n=DM(n+180,360)-180),(s<-180||s>180)&&(s=DM(s+180,360)-180);const g=lB(t/QM);if(a<=g)a=g,o=0;else{const y=t/2/Math.pow(2,a),T=dg([0,y])[1];if(o<T)o=T;else{const I=dg([0,QM-y])[1];o>I&&(o=I)}}return{width:e,height:t,longitude:n,latitude:o,zoom:a,pitch:i,bearing:s}}const EK=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,SK=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,TK=Iy(FK),IK=Iy(DK),LK=[0,0,0,1],MK=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function PK(r,e){const[t,i,n]=r,o=hB([t,i,n],e);return Number.isFinite(n)?o:[o[0],o[1],0]}function FK(r){let{viewport:e,center:t}=r;return new Sn(e.viewProjectionMatrix).invert().transform(t)}function DK(r){let{viewport:e,shadowMatrices:t}=r;const i=[],n=e.pixelUnprojectionMatrix,o=e.isGeospatial?void 0:1,a=[[0,0,o],[e.width,0,o],[0,e.height,o],[e.width,e.height,o],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(s=>PK(s,n));for(const s of t){const g=s.clone().translate(new Ut(e.center).negate()),y=a.map(I=>g.transform(I)),T=new Sn().ortho({left:Math.min(...y.map(I=>I[0])),right:Math.max(...y.map(I=>I[0])),bottom:Math.min(...y.map(I=>I[1])),top:Math.max(...y.map(I=>I[1])),near:Math.min(...y.map(I=>-I[2])),far:Math.max(...y.map(I=>-I[2]))});i.push(T.multiplyRight(s))}return i}function RK(r,e){const{shadowEnabled:t=!0}=r;if(!t||!r.shadowMatrices||!r.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:!!r.drawToShadowMap,shadow_uUseShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,shadow_uColor:r.shadowColor||LK,shadow_uLightId:r.shadowLightId||0,shadow_uLightCount:r.shadowMatrices.length},n=TK({viewport:r.viewport,center:e.project_uCenter}),o=[],a=IK({shadowMatrices:r.shadowMatrices,viewport:r.viewport}).slice();for(let s=0;s<r.shadowMatrices.length;s++){const g=a[s],y=g.clone().translate(new Ut(r.viewport.center).negate());e.project_uCoordinateSystem===Mn.LNGLAT&&e.project_uProjectionMode===Vh.WEB_MERCATOR?(a[s]=y,o[s]=n):(a[s]=g.clone().multiplyRight(MK),o[s]=y.transform(n))}for(let s=0;s<a.length;s++)i["shadow_uViewProjectionMatrices[".concat(s,"]")]=a[s],i["shadow_uProjectCenters[".concat(s,"]")]=o[s],r.shadowMaps&&r.shadowMaps.length>0?i["shadow_uShadowMap".concat(s)]=r.shadowMaps[s]:i["shadow_uShadowMap".concat(s)]=r.dummyShadowMap;return i}const AB={name:"shadow",dependencies:[oB],vs:EK,fs:SK,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"viewport"in r&&(r.drawToShadowMap||r.shadowMaps&&r.shadowMaps.length>0)?RK(r,e):{}}},kK={color:[255,255,255],intensity:1},VM=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],OK=[0,0,0,200/255];class dB{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id","lighting-effect"),ye(this,"props",void 0),ye(this,"shadowColor",OK),ye(this,"shadow",void 0),ye(this,"ambientLight",void 0),ye(this,"directionalLights",void 0),ye(this,"pointLights",void 0),ye(this,"shadowPasses",[]),ye(this,"shadowMaps",[]),ye(this,"dummyShadowMap",null),ye(this,"programManager",void 0),ye(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const t in e){const i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.props=e}preRender(e,t){let{layers:i,layerFilter:n,viewports:o,onViewportActive:a,views:s}=t;if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=Sy.getDefaultProgramManager(e),AB&&this.programManager.addDefaultModule(AB)),this.dummyShadowMap||(this.dummyShadowMap=new iu(e,{width:1,height:1}));for(let g=0;g<this.shadowPasses.length;g++)this.shadowPasses[g].render({layers:i,layerFilter:n,viewports:o,onViewportActive:a,views:s,moduleParameters:{shadowLightId:g,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},t}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(AB),this.programManager=null)}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const i=new Sn().lookAt({eye:new Ut(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const i=new J$(e);this.shadowPasses[t]=i,this.shadowMaps[t]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&t.length===0&&i.length===0&&(this.ambientLight=new EM(kK),this.directionalLights.push(new SM(VM[0]),new SM(VM[1])))}}class UK{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"_pool",[]),ye(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,i){let{size:n=1,type:o,padding:a=0,copy:s=!1,initialize:g=!1,maxCount:y}=i;const T=o||e&&e.constructor||Float32Array,I=t*n+a;if(ArrayBuffer.isView(e)){if(I<=e.length)return e;if(I*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new T(e.buffer,0,I)}let R=1/0;y&&(R=y*n+a);const U=this._allocate(T,I,g,R);return e&&s?U.set(e):g||U.fill(0,0,4),this._release(e),U}release(e){this._release(e)}_allocate(e,t,i,n){let o=Math.max(Math.ceil(t*this.opts.overAlloc),1);o>n&&(o=n);const a=this._pool,s=e.BYTES_PER_ELEMENT*o,g=a.findIndex(y=>y.byteLength>=s);if(g>=0){const y=new e(a.splice(g,1)[0],0,o);return i&&y.fill(0),y}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:i}=e,{byteLength:n}=i,o=t.findIndex(a=>a.byteLength>=n);o<0?t.push(i):(o>0||t.length<this.opts.poolSize)&&t.splice(o,0,i),t.length>this.opts.poolSize&&t.shift()}}const My=new UK;function Py(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function NK(r){return[r[12],r[13],r[14]]}function zK(r){return{left:fg(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:fg(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:fg(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:fg(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:fg(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:fg(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const HM=new Ut;function fg(r,e,t,i){HM.set(r,e,t);const n=HM.len();return{distance:i/n,normal:new Ut(-r/n,-e/n,-t/n)}}function QK(r){return r-Math.fround(r)}let Fy;function fB(r,e){const{size:t=1,startIndex:i=0}=e,n=e.endIndex!==void 0?e.endIndex:r.length,o=(n-i)/t;Fy=My.allocate(Fy,o,{type:Float32Array,size:t*2});let a=i,s=0;for(;a<n;){for(let g=0;g<t;g++){const y=r[a++];Fy[s+g]=y,Fy[s+g+t]=QK(y)}s+=t*2}return Fy.subarray(0,o*t*2)}function VK(r){let e=null,t=!1;for(const i of r)i&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const HK=Math.PI/180,GK=Py(),GM=[0,0,0],jK={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function qK(r){let{width:e,height:t,orthographic:i,fovyRadians:n,focalDistance:o,padding:a,near:s,far:g}=r;const y=e/t,T=i?new Sn().orthographic({fovy:n,aspect:y,focalDistance:o,near:s,far:g}):new Sn().perspective({fovy:n,aspect:y,near:s,far:g});if(a){const{left:I=0,right:R=0,top:U=0,bottom:Z=0}=a,Y=FA((I+e-R)/2,0,e)-e/2,he=FA((U+t-Z)/2,0,t)-t/2;T[8]-=Y*2/e,T[9]+=he*2/t}return T}class pg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ye(this,"id",void 0),ye(this,"x",void 0),ye(this,"y",void 0),ye(this,"width",void 0),ye(this,"height",void 0),ye(this,"padding",void 0),ye(this,"isGeospatial",void 0),ye(this,"zoom",void 0),ye(this,"focalDistance",void 0),ye(this,"position",void 0),ye(this,"modelMatrix",void 0),ye(this,"distanceScales",void 0),ye(this,"scale",void 0),ye(this,"center",void 0),ye(this,"cameraPosition",void 0),ye(this,"projectionMatrix",void 0),ye(this,"viewMatrix",void 0),ye(this,"viewMatrixUncentered",void 0),ye(this,"viewMatrixInverse",void 0),ye(this,"viewProjectionMatrix",void 0),ye(this,"pixelProjectionMatrix",void 0),ye(this,"pixelUnprojectionMatrix",void 0),ye(this,"resolution",void 0),ye(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||jK,this.focalDistance=e.focalDistance||1,this.position=e.position||GM,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Vh.WEB_MERCATOR:Vh.WEB_MERCATOR_AUTO_OFFSET:Vh.IDENTITY}equals(e){return e instanceof pg?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&oh(e.projectionMatrix,this.projectionMatrix)&&oh(e.viewMatrix,this.viewMatrix):!1}project(e){let{topLeft:t=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=this.projectPosition(e),n=UM(i,this.pixelProjectionMatrix),[o,a]=n,s=t?a:this.height-a;return e.length===2?[o,s]:[o,s,n[2]]}unproject(e){let{topLeft:t=!0,targetZ:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const[n,o,a]=e,s=t?o:this.height-o,g=i&&i*this.distanceScales.unitsPerMeter[2],y=hB([n,s,a],this.pixelUnprojectionMatrix,g),[T,I,R]=this.unprojectPosition(y);return Number.isFinite(a)?[T,I,R]:Number.isFinite(i)?[T,I,i]:[T,I]}projectPosition(e){const[t,i]=this.projectFlat(e),n=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,i,n]}unprojectPosition(e){const[t,i]=this.unprojectFlat(e),n=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,i,n]}projectFlat(e){if(this.isGeospatial){const t=Ly(e);return t[1]=FA(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?dg(e):e}getBounds(){const t={targetZ:(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).z||0},i=this.unproject([0,0],t),n=this.unproject([this.width,0],t),o=this.unproject([0,this.height],t),a=this.unproject([this.width,this.height],t);return[Math.min(i[0],n[0],o[0],a[0]),Math.min(i[1],n[1],o[1],a[1]),Math.max(i[0],n[0],o[0],a[0]),Math.max(i[1],n[1],o[1],a[1])]}getDistanceScales(e){return e?uB({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel(e){let{x:t,y:i,width:n=1,height:o=1}=e;return t<this.x+this.width&&this.x<t+n&&i<this.y+this.height&&this.y<i+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,zK(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=_K({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||uB({latitude:i,longitude:t}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:o,modelMatrix:a}=e;let s=GM;if(o&&(s=a?new Sn(a).transformAsVector(o,[]):o),this.isGeospatial){const g=this.projectPosition([t,i,0]);this.center=new Ut(s).scale(this.distanceScales.unitsPerMeter).add(g)}else this.center=this.projectPosition(s)}_initMatrices(e){const{viewMatrix:t=GK,projectionMatrix:i=null,orthographic:n=!1,fovyRadians:o,fovy:a=75,near:s=.1,far:g=1e3,padding:y=null,focalDistance:T=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Sn().multiplyRight(t).translate(new Ut(this.center).negate()),this.projectionMatrix=i||qK({width:this.width,height:this.height,orthographic:n,fovyRadians:o||a*HK,focalDistance:T,padding:y,near:s,far:g});const I=Py();Tf(I,I,this.projectionMatrix),Tf(I,I,this.viewMatrix),this.viewProjectionMatrix=I,this.viewMatrixInverse=X2([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=NK(this.viewMatrixInverse);const R=Py(),U=Py();Z2(R,R,[this.width/2,-this.height/2,1]),S1(R,R,[1,-1,0]),Tf(U,R,this.viewProjectionMatrix),this.pixelProjectionMatrix=U,this.pixelUnprojectionMatrix=X2(Py(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||On.warn("Pixel project matrix not invertible")()}}ye(pg,"displayName","Viewport");class If extends pg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{latitude:t=0,longitude:i=0,zoom:n=0,pitch:o=0,bearing:a=0,nearZMultiplier:s=.1,farZMultiplier:g=1.01,nearZ:y,farZ:T,orthographic:I=!1,projectionMatrix:R,repeat:U=!1,worldOffset:Z=0,position:Y,padding:he,legacyMeterSizes:ce=!1}=e;let{width:pe,height:be,altitude:Te=1.5}=e;const qe=Math.pow(2,n);pe=pe||1,be=be||1;let je,We=null;if(R)Te=R[5]/2,je=R1(Te);else{e.fovy?(je=e.fovy,Te=OM(je)):je=R1(Te);let at;if(he){const{top:nt=0,bottom:ke=0}=he;at=[0,FA((nt+be-ke)/2,0,be)-be/2]}We=bK({width:pe,height:be,scale:qe,center:Y&&[0,0,Y[2]*D1(t)],offset:at,pitch:o,fovy:je,nearZMultiplier:s,farZMultiplier:g}),Number.isFinite(y)&&(We.near=y),Number.isFinite(T)&&(We.far=T)}let Ne=vK({height:be,pitch:o,bearing:a,scale:qe,altitude:Te});Z&&(Ne=new Sn().translate([512*Z,0,0]).multiplyLeft(Ne)),super({...e,width:pe,height:be,viewMatrix:Ne,longitude:i,latitude:t,zoom:n,...We,fovy:je,focalDistance:Te}),ye(this,"longitude",void 0),ye(this,"latitude",void 0),ye(this,"pitch",void 0),ye(this,"bearing",void 0),ye(this,"altitude",void 0),ye(this,"fovy",void 0),ye(this,"orthographic",void 0),ye(this,"_subViewports",void 0),ye(this,"_pseudoMeters",void 0),this.latitude=t,this.longitude=i,this.zoom=n,this.pitch=o,this.bearing=a,this.altitude=Te,this.fovy=je,this.orthographic=I,this._subViewports=U?[]:null,this._pseudoMeters=ce,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let n=t;n<=i;n++){const o=n?new If({...this,worldOffset:n}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,i]=this.projectFlat(e),n=(e[2]||0)*D1(e[1]);return[t,i,n]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,i]=this.unprojectFlat(e),n=(e[2]||0)/D1(i);return[t,i,n]}addMetersToLngLat(e,t){return kM(e,t)}panByPosition(e,t){const i=hB(t,this.pixelUnprojectionMatrix),n=this.projectFlat(e),o=KL([],n,Jj([],i)),a=KL([],this.center,o),[s,g]=this.unprojectFlat(a);return{longitude:s,latitude:g}}getBounds(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=BK(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{width:i,height:n}=this,{longitude:o,latitude:a,zoom:s}=xK({width:i,height:n,bounds:e,...t});return new If({width:i,height:n,longitude:o,latitude:a,zoom:s})}}ye(If,"displayName","WebMercatorViewport");const jM=[0,0,0];function pB(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=e.projectPosition(r);if(t&&e instanceof If){const[n,o,a=0]=r,s=e.getDistanceScales([n,o]);i[2]=a*s.unitsPerMeter[2]}return i}function $K(r){const{viewport:e,modelMatrix:t,coordinateOrigin:i}=r;let{coordinateSystem:n,fromCoordinateSystem:o,fromCoordinateOrigin:a}=r;return n===Mn.DEFAULT&&(n=e.isGeospatial?Mn.LNGLAT:Mn.CARTESIAN),o===void 0&&(o=n),a===void 0&&(a=i),{viewport:e,coordinateSystem:n,coordinateOrigin:i,modelMatrix:t,fromCoordinateSystem:o,fromCoordinateOrigin:a}}function qM(r,e){let{viewport:t,modelMatrix:i,coordinateSystem:n,coordinateOrigin:o,offsetMode:a}=e,[s,g,y=0]=r;switch(i&&([s,g,y]=By([],[s,g,y,1],i)),n){case Mn.LNGLAT:return pB([s,g,y],t,a);case Mn.LNGLAT_OFFSETS:return pB([s+o[0],g+o[1],y+(o[2]||0)],t,a);case Mn.METER_OFFSETS:return pB(kM(o,[s,g,y]),t,a);case Mn.CARTESIAN:default:return t.isGeospatial?[s+o[0],g+o[1],y+o[2]]:t.projectPosition([s,g,y])}}function KK(r,e){const{viewport:t,coordinateSystem:i,coordinateOrigin:n,modelMatrix:o,fromCoordinateSystem:a,fromCoordinateOrigin:s}=$K(e),{autoOffset:g=!0}=e,{geospatialOrigin:y=jM,shaderCoordinateOrigin:T=jM,offsetMode:I=!1}=g?FM(t,i,n):{},R=qM(r,{viewport:t,modelMatrix:o,coordinateSystem:a,coordinateOrigin:s,offsetMode:I});if(I){const U=t.projectPosition(y||T);uq(R,R,U)}return R}const $M={blendFunc:[1,0,32771,0],blendEquation:32774};class KM extends sB{constructor(){super(...arguments),ye(this,"pickZ",void 0),ye(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer(e){let{layers:t,layerFilter:i,views:n,viewports:o,onViewportActive:a,pickingFBO:s,deviceRect:{x:g,y,width:T,height:I},cullRect:R,effects:U,pass:Z="picking",pickZ:Y,moduleParameters:he}=e;const ce=this.gl;this.pickZ=Y;const pe=this._resetColorEncoder(Y),be=nh(ce,{scissorTest:!0,scissor:[g,y,T,I],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...$M,blend:!Y},()=>super.render({target:s,layers:t,layerFilter:i,views:n,viewports:o,onViewportActive:a,cullRect:R,effects:U==null?void 0:U.filter(qe=>qe.useInPicking),pass:Z,isPicking:!0,moduleParameters:he}));return this._colorEncoderState=null,{decodePickingColor:pe&&XK.bind(null,pe),stats:be}}shouldDrawLayer(e){const{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,t,i){const n={...e.props.parameters},{pickable:o,operation:a}=e.props;return this._colorEncoderState?o&&a.includes("draw")&&(Object.assign(n,$M),n.blend=!0,n.blendColor=WK(this._colorEncoderState,e,i)):n.blend=!1,a.includes("terrain")&&(n.blend=!1),n}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function WK(r,e,t){const{byLayer:i,byAlpha:n}=r;let o,a=i.get(e);return a?(a.viewports.push(t),o=a.a):(o=i.size+1,o<=255?(a={a:o,layer:e,viewports:[t]},i.set(e,a),n[o]=a):(On.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function XK(r,e){const t=r.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const gg={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},k1=Symbol.for("component"),gd=Symbol.for("propTypes"),gB=Symbol.for("deprecatedProps"),mg=Symbol.for("asyncPropDefaults"),Lf=Symbol.for("asyncPropOriginal"),md=Symbol.for("asyncPropResolved");function O1(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>!0;return Array.isArray(r)?WM(r,e,[]):e(r)?[r]:[]}function WM(r,e,t){let i=-1;for(;++i<r.length;){const n=r[i];Array.isArray(n)?WM(n,e,t):e(n)&&t.push(n)}return t}function ZK(r){let{target:e,source:t,start:i=0,count:n=1}=r;const o=t.length,a=n*o;let s=0;for(let g=i;s<o;s++)e[g++]=t[s];for(;s<a;)s<a-s?(e.copyWithin(i+s,i,i+s),s*=2):(e.copyWithin(i+s,i,i+a-s),s=a);return e}class JK{constructor(e,t,i){ye(this,"id",void 0),ye(this,"context",void 0),ye(this,"isLoaded",void 0),ye(this,"persistent",void 0),ye(this,"_loadCount",0),ye(this,"_subscribers",new Set),ye(this,"_data",void 0),ye(this,"_loader",void 0),ye(this,"_error",void 0),ye(this,"_content",void 0),this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const i=++this._loadCount;let n=e;typeof e=="string"&&(n=ud(e)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(o=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===i&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class YK{constructor(e){let{gl:t,protocol:i}=e;ye(this,"protocol",void 0),ye(this,"_context",void 0),ye(this,"_resources",void 0),ye(this,"_consumers",void 0),ye(this,"_pruneRequest",void 0),this.protocol=i||"resource://",this._context={gl:t,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add(e){let{resourceId:t,data:i,forceUpdate:n=!1,persistent:o=!0}=e,a=this._resources[t];a?a.setData(i,n):(a=new JK(t,i,this._context),this._resources[t]=a),a.persistent=o}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe(e){let{consumerId:t}=e;const i=this._consumers[t];if(i){for(const n in i){const o=i[n],a=this._resources[o.resourceId];a&&a.unsubscribe(o)}delete this._consumers[t],this.prune()}}subscribe(e){let{resourceId:t,onChange:i,consumerId:n,requestId:o="default"}=e;const{_resources:a,protocol:s}=this;t.startsWith(s)&&(t=t.replace(s,""),a[t]||this.add({resourceId:t,data:null,persistent:!1}));const g=a[t];if(this._track(n,o,g,i),g)return g.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,i,n){const o=this._consumers,a=o[e]=o[e]||{},s=a[t]||{},g=s.resourceId&&this._resources[s.resourceId];g&&(g.unsubscribe(s),this.prune()),i&&(a[t]=s,s.onChange=n,s.resourceId=i.id,i.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const mB={name:"project32",dependencies:[oB],vs:`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`},yB={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...f$},eW=[oB],tW=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function rW(r){const e=Sy.getDefaultProgramManager(r);for(const t of eW)e.addDefaultModule(t);for(const t of tW)e.addShaderHook(t);return e}const iW="layerManager.setLayers",nW="layerManager.activateViewport";class sW{constructor(e){let{deck:t,stats:i,viewport:n,timeline:o}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ye(this,"layers",void 0),ye(this,"context",void 0),ye(this,"resourceManager",void 0),ye(this,"_lastRenderedLayers",[]),ye(this,"_needsRedraw",!1),ye(this,"_needsUpdate",!1),ye(this,"_nextLayers",null),ye(this,"_debug",!1),ye(this,"activateViewport",a=>{Ml(nW,this,a),a&&(this.context.viewport=a)}),this.layers=[],this.resourceManager=new YK({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:t,programManager:e&&rW(e),stats:i||new _2({id:"deck.gl"}),viewport:n||new pg({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new CM,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1},t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const n=i.getNeedsRedraw(e);t=t||n}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers(){let{layerIds:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e?this.layers.filter(t=>e.find(i=>t.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Ml(iW,this,t,e),this._lastRenderedLayers=e;const i=O1(e,Boolean);for(const n of i)n.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,t,i){i.raiseError(t,"".concat(e," of ").concat(i))}_updateLayers(e,t){const i={};for(const a of e)i[a.id]?On.warn("Multiple old layers with same id ".concat(a.id))():i[a.id]=a;const n=[];this._updateSublayersRecursively(t,i,n),this._finalizeOldLayers(i);let o=!1;for(const a of n)if(a.hasUniformTransition()){o="Uniform transition in ".concat(a);break}this._needsUpdate=o,this.layers=n}_updateSublayersRecursively(e,t,i){for(const n of e){n.context=this.context;const o=t[n.id];o===null&&On.warn("Multiple new layers with same id ".concat(n.id))(),t[n.id]=null;let a=null;try{this._debug&&o!==n&&n.validateProps(),o?(this._transferLayerState(o,n),this._updateLayer(n)):this._initializeLayer(n),i.push(n),a=n.isComposite?n.getSubLayers():null}catch(s){this._handleError("matching",s,n)}a&&this._updateSublayersRecursively(a,t,i)}}_finalizeOldLayers(e){for(const t in e){const i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=gg.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=gg.MATCHED,t!==e&&(e.lifecycle=gg.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=gg.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=gg.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Gh(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!Gh(r[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const i=Object.keys(r),n=Object.keys(e);if(i.length!==n.length)return!1;for(const o of i)if(!e.hasOwnProperty(o)||!Gh(r[o],e[o],t-1))return!1;return!0}return!1}class oW{constructor(e){ye(this,"width",void 0),ye(this,"height",void 0),ye(this,"views",void 0),ye(this,"viewState",void 0),ye(this,"controllers",void 0),ye(this,"timeline",void 0),ye(this,"_viewports",void 0),ye(this,"_viewportMap",void 0),ye(this,"_isUpdating",void 0),ye(this,"_needsRedraw",void 0),ye(this,"_needsUpdate",void 0),ye(this,"_eventManager",void 0),ye(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){const i=this.getViewports(),n={x:e[0],y:e[1]};for(let o=i.length-1;o>=0;--o){const a=i[o];if(a.containsPixel(n)){const s=e.slice();return s[0]-=a.x,s[1]-=a.y,a.unproject(s,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=O1(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Gh(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):On.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,t){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...t,viewId:e})}_createController(e,t){const i=t.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,t.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>{var a;return(a=this.getView(e.id))===null||a===void 0?void 0:a.makeViewport({viewState:o,width:this.width,height:this.height})}})}_updateController(e,t,i,n){const o=e.controller;if(o&&i){const a={...t,...o,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!n||n.constructor!==o.type)&&(n=this._createController(e,a)),n&&n.setProps(a),n}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let n=e.length;n--;){const o=e[n],a=this.getViewState(o),s=o.makeViewport({viewState:a,width:this.width,height:this.height});let g=t[o.id];const y=!!o.controller;y&&!g&&(i=!0),(i||!y)&&g&&(g.finalize(),g=null),this.controllers[o.id]=this._updateController(o,a,s,g),s&&this._viewports.unshift(s)}for(const n in t){const o=t[n];o&&!this.controllers[n]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((i,n)=>!e[n].equals(t[n]))}}const aW=/([0-9]+\.?[0-9]*)(%|px)/;function yd(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const e=aW.exec(r);if(e&&e.length>=3){const t=e[2]==="%",i=parseFloat(e[1]);return{position:t?i/100:i,relative:t}}default:throw new Error("Could not parse position string ".concat(r))}}function _d(r,e){return r.relative?Math.round(r.position*e):r.position}function cl(r,e){if(!r)throw new Error(e||"deck.gl: assertion failed.")}class lW{constructor(e){ye(this,"id",void 0),ye(this,"viewportInstance",void 0),ye(this,"_x",void 0),ye(this,"_y",void 0),ye(this,"_width",void 0),ye(this,"_height",void 0),ye(this,"_padding",void 0),ye(this,"props",void 0);const{id:t,x:i=0,y:n=0,width:o="100%",height:a="100%",padding:s=null,viewportInstance:g}=e||{};cl(!g||g instanceof pg),this.viewportInstance=g,this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=yd(i),this._y=yd(n),this._width=yd(o),this._height=yd(a),this._padding=s&&{left:yd(s.left||0),right:yd(s.right||0),top:yd(s.top||0),bottom:yd(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&Gh(this.props,e.props,2)}makeViewport(e){let{width:t,height:i,viewState:n}=e;if(this.viewportInstance)return this.viewportInstance;n=this.filterViewState(n);const o=this.getDimensions({width:t,height:i});return!o.height||!o.width?null:new this.ViewportType({...n,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const i in this.props.viewState)i!=="id"&&(t[i]=this.props.viewState[i]);return t}return e}getDimensions(e){let{width:t,height:i}=e;const n={x:_d(this._x,t),y:_d(this._y,i),width:_d(this._width,t),height:_d(this._height,i)};return this._padding&&(n.padding={left:_d(this._padding.left,t),top:_d(this._padding.top,i),right:_d(this._padding.right,t),bottom:_d(this._padding.bottom,i)}),n}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Dy{constructor(e){ye(this,"_inProgress",void 0),ye(this,"_handle",void 0),ye(this,"_timeline",void 0),ye(this,"time",void 0),ye(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var t,i;this.cancel(),this.settings=e,this._inProgress=!0,(t=(i=this.settings).onStart)===null||t===void 0||t.call(i,this)}end(){if(this._inProgress){var e,t;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(t=this.settings).onEnd)===null||e===void 0||e.call(t,this)}}cancel(){if(this._inProgress){var e,t;(e=(t=this.settings).onInterrupt)===null||e===void 0||e.call(t,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:n}=this;this._handle=i.addChannel({delay:i.getTime(),duration:n.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(t=this.settings).onUpdate)===null||e===void 0||e.call(t,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const XM=()=>{},_B={BREAK:1,SNAP_TO_END:2,IGNORE:3},cW=r=>r,uW=_B.BREAK;class hW{constructor(e){ye(this,"getControllerState",void 0),ye(this,"props",void 0),ye(this,"propsInTransition",void 0),ye(this,"transition",void 0),ye(this,"onViewStateChange",void 0),ye(this,"onStateChange",void 0),ye(this,"_onTransitionUpdate",t=>{const{time:i,settings:{interpolator:n,startProps:o,endProps:a,duration:s,easing:g}}=t,y=g(i/s),T=n.interpolateProps(o,a,y);this.propsInTransition=this.getControllerState({...this.props,...T}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Dy(e.timeline),this.onViewStateChange=e.onViewStateChange||XM,this.onStateChange=e.onStateChange||XM}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let n=i;if(this.transition.inProgress){const{interruption:o,endProps:a}=this.transition.settings;n={...i,...o===_B.SNAP_TO_END?a:this.propsInTransition||i}}this._triggerTransition(n,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===_B.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const i=this.getControllerState(e),n=this.getControllerState(t).shortestPathFrom(i),o=t.transitionInterpolator,a=o.getDuration?o.getDuration(e,t):t.transitionDuration;if(a===0)return;const s=o.initializeProps(e,n);this.propsInTransition={};const g={duration:a,easing:t.transitionEasing||cW,interpolator:o,interruption:t.transitionInterruption||uW,startProps:s.start,endProps:s.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(g),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}class AW{constructor(e){ye(this,"_propsToCompare",void 0),ye(this,"_propsToExtract",void 0),ye(this,"_requiredProps",void 0);const{compare:t,extract:i,required:n}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=n}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!oh(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},n={};for(const o of this._propsToExtract)(o in e||o in t)&&(i[o]=e[o],n[o]=t[o]);return this._checkRequiredProps(i),this._checkRequiredProps(n),{start:i,end:n}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const i=e[t];cl(Number.isFinite(i)||Array.isArray(i),"".concat(t," is required for transition"))})}}const dW=["longitude","latitude","zoom","bearing","pitch"],fW=["longitude","latitude","zoom"];class ZM extends AW{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:dW,required:fW},super(i.transitionProps),ye(this,"opts",void 0),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:n,around:o}=this.opts;if(n&&o){const a=n(e),s=n(t),g=a.unproject(o);i.start.around=o,Object.assign(i.end,{around:s.project(g),aroundPosition:g,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const n={};for(const o of this._propsToExtract)n[o]=b1(e[o]||0,t[o]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...t,...n});Object.assign(n,o.panByPosition(t.aroundPosition,b1(e.around,t.around,i)))}return n}}const vd={transitionDuration:0},pW=300,U1=r=>1-(1-r)*(1-r),yg={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},Mf={};class gW{constructor(e){ye(this,"props",void 0),ye(this,"state",{}),ye(this,"transitionManager",void 0),ye(this,"eventManager",void 0),ye(this,"onViewStateChange",void 0),ye(this,"onStateChange",void 0),ye(this,"makeViewport",void 0),ye(this,"_controllerState",void 0),ye(this,"_events",{}),ye(this,"_interactionState",{isDragging:!1}),ye(this,"_customEvents",[]),ye(this,"_eventStartBlocked",null),ye(this,"_panMove",!1),ye(this,"invertPan",!1),ye(this,"dragMode","rotate"),ye(this,"inertia",0),ye(this,"scrollZoom",!0),ye(this,"dragPan",!0),ye(this,"dragRotate",!0),ye(this,"doubleClickZoom",!0),ye(this,"touchZoom",!0),ye(this,"touchRotate",!1),ye(this,"keyboard",!0),this.transitionManager=new hW({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)if(this._events[t]){var e;(e=this.eventManager)===null||e===void 0||e.off(t,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return t?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:i}=this.props,{offsetCenter:n}=e;return[n.x-t,n.y-i]}isPointInBounds(e,t){const{width:i,height:n}=this.props;if(t&&t.handled)return!1;const o=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=n;return o&&t&&t.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?pW:0;const{scrollZoom:i=!0,dragPan:n=!0,dragRotate:o=!0,doubleClickZoom:a=!0,touchZoom:s=!0,touchRotate:g=!1,keyboard:y=!0}=e,T=!!this.onViewStateChange;this.toggleEvents(yg.WHEEL,T&&i),this.toggleEvents(yg.PAN,T),this.toggleEvents(yg.PINCH,T&&(s||g)),this.toggleEvents(yg.TRIPLE_PAN,T&&g),this.toggleEvents(yg.DOUBLE_TAP,T&&a),this.toggleEvents(yg.KEYBOARD,T&&y),this.scrollZoom=i,this.dragPan=n,this.dragRotate=o,this.doubleClickZoom=a,this.touchZoom=s,this.touchRotate=g,this.keyboard=y}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(i=>{this._events[i]!==t&&(this._events[i]=t,t?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const n={...e.getViewportProps(),...t},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),o){const a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:a})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const n=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(n,vd,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,vd,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const i=this.getCenter(e),n=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],o=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:U1},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,vd,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const i=this.getCenter(e),n=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],o=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:U1},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let a=2/(1+Math.exp(-Math.abs(o*i)));o<0&&a!==0&&(a=1/a);const s=this.controllerState.zoom({pos:t,scale:a});return this.updateViewport(s,{...this._getTransitionProps({around:t}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,vd,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const i=this.controllerState.rotate({pos:t});return this.updateViewport(i,vd,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const i=this.getCenter(e),n=[i[0],i[1]+=e.velocityY*t/2],o=this.controllerState.rotate({pos:n});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:U1},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Mf._startPinchRotation=e.rotation,Mf._lastPinchEvent=e,this.updateViewport(i,vd,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:i}=e,n=this.getCenter(e);t=t.zoom({pos:n,scale:i})}if(this.touchRotate){const{rotation:i}=e;t=t.rotate({deltaAngleX:Mf._startPinchRotation-i})}return this.updateViewport(t,vd,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Mf._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:i}=Mf;if(this.touchZoom&&t&&i&&e.scale!==i.scale){const n=this.getCenter(e);let o=this.controllerState.rotateEnd();const a=Math.log2(e.scale),s=(a-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),g=Math.pow(2,a+s*t/2);o=o.zoom({pos:n,scale:g}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:n}),transitionDuration:t,transitionEasing:U1},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Mf._startPinchRotation=null,Mf._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(n,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:n,rotateSpeedX:o,rotateSpeedY:a}=this.keyboard===!0?{}:this.keyboard,{controllerState:s}=this;let g;const y={};switch(e.srcEvent.code){case"Minus":g=t?s.zoomOut(i).zoomOut(i):s.zoomOut(i),y.isZooming=!0;break;case"Equal":g=t?s.zoomIn(i).zoomIn(i):s.zoomIn(i),y.isZooming=!0;break;case"ArrowLeft":t?(g=s.rotateLeft(o),y.isRotating=!0):(g=s.moveLeft(n),y.isPanning=!0);break;case"ArrowRight":t?(g=s.rotateRight(o),y.isRotating=!0):(g=s.moveRight(n),y.isPanning=!0);break;case"ArrowUp":t?(g=s.rotateUp(a),y.isRotating=!0):(g=s.moveUp(n),y.isPanning=!0);break;case"ArrowDown":t?(g=s.rotateDown(a),y.isRotating=!0):(g=s.moveDown(n),y.isPanning=!0);break;default:return!1}return this.updateViewport(g,this._getTransitionProps(),y),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?vd:e?{...t,transitionInterpolator:new ZM({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class mW{constructor(e,t){ye(this,"_viewportProps",void 0),ye(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const JM=5,yW=1.2;class _W extends mW{constructor(e){const{width:t,height:i,latitude:n,longitude:o,zoom:a,bearing:s=0,pitch:g=0,altitude:y=1.5,position:T=[0,0,0],maxZoom:I=20,minZoom:R=0,maxPitch:U=60,minPitch:Z=0,startPanLngLat:Y,startZoomLngLat:he,startRotatePos:ce,startBearing:pe,startPitch:be,startZoom:Te,normalize:qe=!0}=e;cl(Number.isFinite(o)),cl(Number.isFinite(n)),cl(Number.isFinite(a)),super({width:t,height:i,latitude:n,longitude:o,zoom:a,bearing:s,pitch:g,altitude:y,maxZoom:I,minZoom:R,maxPitch:U,minPitch:Z,normalize:qe,position:T},{startPanLngLat:Y,startZoomLngLat:he,startRotatePos:ce,startBearing:pe,startPitch:be,startZoom:Te}),ye(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart(e){let{pos:t}=e;return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan(e){let{pos:t,startPos:i}=e;const n=this.getState().startPanLngLat||this._unproject(i);if(!n)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart(e){let{pos:t}=e;return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate(e){let{pos:t,deltaAngleX:i=0,deltaAngleY:n=0}=e;const{startRotatePos:o,startBearing:a,startPitch:s}=this.getState();if(!o||a===void 0||s===void 0)return this;let g;return t?g=this._getNewRotation(t,o,s,a):g={bearing:a+i,pitch:s+n},this._getUpdatedState(g)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart(e){let{pos:t}=e;return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom(e){let{pos:t,startPos:i,scale:n}=e,{startZoom:o,startZoomLngLat:a}=this.getState();if(a||(o=this.getViewportProps().zoom,a=this._unproject(i)||this._unproject(t)),!a)return this;const{maxZoom:s,minZoom:g}=this.getViewportProps();let y=o+Math.log2(n);y=FA(y,g,s);const T=this.makeViewport({...this.getViewportProps(),zoom:y});return this._getUpdatedState({zoom:y,...T.panByPosition(a,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(e)}zoomOut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2;return this._zoomFromCenter(1/e)}moveLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([e,0])}moveRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([-e,0])}moveUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,e])}moveDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return this._panFromCenter([0,-e])}rotateLeft(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:15;return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:n,longitude:o}=i;return Math.abs(n-t.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(o-t.longitude)>180&&(i.longitude=o<0?o+360:o-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:n}=e;e.zoom=FA(n,i,t);const{maxPitch:o,minPitch:a,pitch:s}=e;e.pitch=FA(s,a,o);const{normalize:g=!0}=e;return g&&Object.assign(e,CK(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,n){const o=e[0]-t[0],a=e[1]-t[1],s=e[1],g=t[1],{width:y,height:T}=this.getViewportProps(),I=o/y;let R=0;a>0?Math.abs(T-g)>JM&&(R=a/(g-T)*yW):a<0&&g>JM&&(R=1-s/g),R=FA(R,-1,1);const{minPitch:U,maxPitch:Z}=this.getViewportProps(),Y=n+180*I;let he=i;return R>0?he=i+R*(Z-i):R<0&&(he=i-R*(U-i)),{pitch:he,bearing:Y}}}class vW extends gW{constructor(){super(...arguments),ye(this,"ControllerState",_W),ye(this,"transition",{transitionDuration:300,transitionInterpolator:new ZM({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),ye(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class vB extends lW{get ViewportType(){return If}get ControllerType(){return vW}}ye(vB,"displayName","MapView");const bW=new dB;function xW(r,e){var t,i;const n=(t=r.order)!==null&&t!==void 0?t:1/0,o=(i=e.order)!==null&&i!==void 0?i:1/0;return n-o}class wW{constructor(){ye(this,"effects",void 0),ye(this,"_resolvedEffects",[]),ye(this,"_defaultEffects",[]),ye(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(i=>i.id===e.id)){const i=t.findIndex(n=>xW(n,e)>0);i<0?t.push(e):t.splice(i,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Gh(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const n of this.effects)t[n.id]=n;const i=[];for(const n of e){const o=t[n.id];o&&o!==n?o.setProps?(o.setProps(n.props),i.push(o)):(o.cleanup(),i.push(n)):i.push(n),delete t[n.id]}for(const n in t)t[n].cleanup();this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(n=>n instanceof dB)||this._resolvedEffects.push(bW),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class BW extends sB{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const CW="deckRenderer.renderLayers";class EW{constructor(e){ye(this,"gl",void 0),ye(this,"layerFilter",void 0),ye(this,"drawPickingColors",void 0),ye(this,"drawLayersPass",void 0),ye(this,"pickLayersPass",void 0),ye(this,"renderCount",void 0),ye(this,"_needsRedraw",void 0),ye(this,"renderBuffers",void 0),ye(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new BW(e),this.pickLayersPass=new KM(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||Ba.getDefaultFramebuffer(this.gl)};i.effects&&this._preRender(i.effects,i);const n=this.lastPostProcessEffect?this.renderBuffers[0]:i.target,o=t.render({...i,target:n});i.effects&&this._postRender(i.effects,i),this.renderCount++,Ml(CW,this,o,e)}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const i of e)t.preRenderStats[i.id]=i.preRender(this.gl,t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new Ba(this.gl),new Ba(this.gl));for(const t of e)t.resize()}_postRender(e,t){const{renderBuffers:i}=this,n={...t,inputBuffer:i[0],swapBuffer:i[1],target:null};for(const o of e)if(o.postRender){if(o.id===this.lastPostProcessEffect){n.target=t.target,o.postRender(this.gl,n);break}const a=o.postRender(this.gl,n);n.inputBuffer=a,n.swapBuffer=a===i[0]?i[1]:i[0]}}}const SW={pickedColor:null,pickedObjectIndex:-1};function TW(r){let{pickedColors:e,decodePickingColor:t,deviceX:i,deviceY:n,deviceRadius:o,deviceRect:a}=r;const{x:s,y:g,width:y,height:T}=a;let I=o*o,R=-1,U=0;for(let Z=0;Z<T;Z++){const Y=Z+g-n,he=Y*Y;if(he>I)U+=4*y;else for(let ce=0;ce<y;ce++){if(e[U+3]-1>=0){const be=ce+s-i,Te=be*be+he;Te<=I&&(I=Te,R=U)}U+=4}}if(R>=0){const Z=e.slice(R,R+4),Y=t(Z);if(Y){const he=Math.floor(R/4/y),ce=R/4-he*y;return{...Y,pickedColor:Z,pickedX:s+ce,pickedY:g+he}}On.error("Picked non-existent layer. Is picking buffer corrupt?")()}return SW}function IW(r){let{pickedColors:e,decodePickingColor:t}=r;const i=new Map;if(e){for(let n=0;n<e.length;n+=4)if(e[n+3]-1>=0){const a=e.slice(n,n+4),s=a.join(",");if(!i.has(s)){const g=t(a);g?i.set(s,{...g,color:a}):On.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function YM(r){let{pickInfo:e,viewports:t,pixelRatio:i,x:n,y:o,z:a}=r,s=t[0];t.length>1&&(s=MW((e==null?void 0:e.pickedViewports)||t,{x:n,y:o}));let g;if(s){const y=[n-s.x,o-s.y];a!==void 0&&(y[2]=a),g=s.unproject(y)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:n,y:o,pixel:[n,o],coordinate:g,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:i}}function LW(r){const{pickInfo:e,lastPickedInfo:t,mode:i,layers:n}=r,{pickedColor:o,pickedLayer:a,pickedObjectIndex:s}=e,g=a?[a]:[];if(i==="hover"){const I=t.index,R=t.layerId,U=a?a.props.id:null;if(U!==R||s!==I){if(U!==R){const Z=n.find(Y=>Y.props.id===R);Z&&g.unshift(Z)}t.layerId=U,t.index=s,t.info=null}}const y=YM(r),T=new Map;return T.set(null,y),g.forEach(I=>{let R={...y};I===a&&(R.color=o,R.index=s,R.picked=!0),R=eP({layer:I,info:R,mode:i});const U=R.layer;I===a&&i==="hover"&&(t.info=R),T.set(U.id,R),i==="hover"&&U.updateAutoHighlight(R)}),T}function eP(r){let{layer:e,info:t,mode:i}=r;for(;e&&t;){const n=t.layer||null;t.sourceLayer=n,t.layer=e,t=e.getPickingInfo({info:t,mode:i,sourceLayer:n}),e=e.parent}return t}function MW(r,e){for(let t=r.length-1;t>=0;t--){const i=r[t];if(i.containsPixel(e))return i}return r[0]}class PW{constructor(e){ye(this,"gl",void 0),ye(this,"pickingFBO",void 0),ye(this,"depthFBO",void 0),ye(this,"pickLayersPass",void 0),ye(this,"layerFilter",void 0),ye(this,"lastPickedInfo",void 0),ye(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new KM(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject(e){let{x:t,y:i,layers:n,viewports:o}=e,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.lastPickedInfo.info;const s=a&&a.layer&&a.layer.id,g=a&&a.viewport&&a.viewport.id,y=s?n.find(U=>U.id===s):null,T=g&&o.find(U=>U.id===g)||o[0],I=T&&T.unproject([t-T.x,i-T.y]);return{...a,...{x:t,y:i,viewport:T,coordinate:I,layer:y}}}_resizeBuffer(){var e,t;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new Ba(i),Ba.isSupported(i,{colorBufferFloat:!0}))){const n=new Ba(i);n.attach({36064:new iu(i,{format:dn(i)?34836:6408,type:5126})}),this.depthFBO=n}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(t=this.depthFBO)===null||t===void 0||t.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return t.length?t:null}_pickClosestObject(e){let{layers:t,views:i,viewports:n,x:o,y:a,radius:s=0,depth:g=1,mode:y="query",unproject3D:T,onViewportActive:I,effects:R}=e;const U=this._getPickable(t),Z=ig(this.gl);if(!U)return{result:[],emptyInfo:YM({viewports:n,x:o,y:a,pixelRatio:Z})};this._resizeBuffer();const Y=g2(this.gl,[o,a],!0),he=[Y.x+Math.floor(Y.width/2),Y.y+Math.floor(Y.height/2)],ce=Math.round(s*Z),{width:pe,height:be}=this.pickingFBO,Te=this._getPickingRect({deviceX:he[0],deviceY:he[1],deviceRadius:ce,deviceWidth:pe,deviceHeight:be}),qe={x:o-s,y:a-s,width:s*2+1,height:s*2+1};let je;const We=[],Ne=new Set;for(let at=0;at<g;at++){let nt;if(Te){const De=this._drawAndSample({layers:U,views:i,viewports:n,onViewportActive:I,deviceRect:Te,cullRect:qe,effects:R,pass:"picking:".concat(y)});nt=TW({...De,deviceX:he[0],deviceY:he[1],deviceRadius:ce,deviceRect:Te})}else nt={pickedColor:null,pickedObjectIndex:-1};let ke;if(nt.pickedLayer&&T&&this.depthFBO){const{pickedColors:De}=this._drawAndSample({layers:[nt.pickedLayer],views:i,viewports:n,onViewportActive:I,deviceRect:{x:nt.pickedX,y:nt.pickedY,width:1,height:1},cullRect:qe,effects:R,pass:"picking:".concat(y,":z")},!0);De[3]&&(ke=De[0])}nt.pickedLayer&&at+1<g&&(Ne.add(nt.pickedLayer),nt.pickedLayer.disablePickingIndex(nt.pickedObjectIndex)),je=LW({pickInfo:nt,lastPickedInfo:this.lastPickedInfo,mode:y,layers:U,viewports:n,x:o,y:a,z:ke,pixelRatio:Z});for(const De of je.values())De.layer&&We.push(De);if(!nt.pickedColor)break}for(const at of Ne)at.restorePickingColors();return{result:We,emptyInfo:je.get(null)}}_pickVisibleObjects(e){let{layers:t,views:i,viewports:n,x:o,y:a,width:s=1,height:g=1,mode:y="query",maxObjects:T=null,onViewportActive:I,effects:R}=e;const U=this._getPickable(t);if(!U)return[];this._resizeBuffer();const Z=ig(this.gl),Y=g2(this.gl,[o,a],!0),he=Y.x,ce=Y.y+Y.height,pe=g2(this.gl,[o+s,a+g],!0),be=pe.x+pe.width,Te=pe.y,qe={x:he,y:Te,width:be-he,height:ce-Te},je=this._drawAndSample({layers:U,views:i,viewports:n,onViewportActive:I,deviceRect:qe,cullRect:{x:o,y:a,width:s,height:g},effects:R,pass:"picking:".concat(y)}),We=IW(je),Ne=new Map,at=Number.isFinite(T);for(let ke=0;ke<We.length;ke++){var nt;if(at&&T&&Ne.size>=T)break;const De=We[ke];let Ye={color:De.pickedColor,layer:null,index:De.pickedObjectIndex,picked:!0,x:o,y:a,pixelRatio:Z};Ye=eP({layer:De.pickedLayer,info:Ye,mode:y});const Xe=(nt=Ye.object)!==null&&nt!==void 0?nt:"".concat(Ye.layer.id,"[").concat(Ye.index,"]");Ne.has(Xe)||Ne.set(Xe,Ye)}return Array.from(Ne.values())}_drawAndSample(e){let{layers:t,views:i,viewports:n,onViewportActive:o,deviceRect:a,cullRect:s,effects:g,pass:y}=e,T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const I=T?this.depthFBO:this.pickingFBO,R={layers:t,layerFilter:this.layerFilter,views:i,viewports:n,onViewportActive:o,pickingFBO:I,deviceRect:a,cullRect:s,effects:g,pass:y,pickZ:T,preRenderStats:{}};for(const be of g)be.useInPicking&&(R.preRenderStats[be.id]=be.preRender(this.gl,R));const{decodePickingColor:U}=this.pickLayersPass.render(R),{x:Z,y:Y,width:he,height:ce}=a,pe=new(T?Float32Array:Uint8Array)(he*ce*4);return h1(I,{sourceX:Z,sourceY:Y,sourceWidth:he,sourceHeight:ce,target:pe}),{pickedColors:pe,decodePickingColor:U}}_getPickingRect(e){let{deviceX:t,deviceY:i,deviceRadius:n,deviceWidth:o,deviceHeight:a}=e;const s=Math.max(0,t-n),g=Math.max(0,i-n),y=Math.min(o,t+n+1)-s,T=Math.min(a,i+n+1)-g;return y<=0||T<=0?null:{x:s,y:g,width:y,height:T}}}const FW={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class DW{constructor(e){ye(this,"el",null),ye(this,"isVisible",!1);const t=e.parentElement;t&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,FW),t.appendChild(this.el))}setTooltip(e,t,i){const n=this.el;if(n){if(typeof e=="string")n.innerText=e;else if(e)e.text&&(n.innerText=e.text),e.html&&(n.innerHTML=e.html),e.className&&(n.className=e.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform="translate(".concat(t,"px, ").concat(i,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(n.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var tP={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(r){(function(e,t,i,n){var o=["","webkit","Moz","MS","ms","o"],a=t.createElement("div"),s="function",g=Math.round,y=Math.abs,T=Date.now;function I(He,Je,gt){return setTimeout(be(He,gt),Je)}function R(He,Je,gt){return Array.isArray(He)?(U(He,gt[Je],gt),!0):!1}function U(He,Je,gt){var Ot;if(He)if(He.forEach)He.forEach(Je,gt);else if(He.length!==n)for(Ot=0;Ot<He.length;)Je.call(gt,He[Ot],Ot,He),Ot++;else for(Ot in He)He.hasOwnProperty(Ot)&&Je.call(gt,He[Ot],Ot,He)}function Z(He,Je,gt){var Ot="DEPRECATED METHOD: "+Je+`
`+gt+` AT 
`;return function(){var fr=new Error("get-stack-trace"),qr=fr&&fr.stack?fr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ci=e.console&&(e.console.warn||e.console.log);return Ci&&Ci.call(e.console,Ot,qr),He.apply(this,arguments)}}var Y;typeof Object.assign!="function"?Y=function(Je){if(Je===n||Je===null)throw new TypeError("Cannot convert undefined or null to object");for(var gt=Object(Je),Ot=1;Ot<arguments.length;Ot++){var fr=arguments[Ot];if(fr!==n&&fr!==null)for(var qr in fr)fr.hasOwnProperty(qr)&&(gt[qr]=fr[qr])}return gt}:Y=Object.assign;var he=Z(function(Je,gt,Ot){for(var fr=Object.keys(gt),qr=0;qr<fr.length;)(!Ot||Ot&&Je[fr[qr]]===n)&&(Je[fr[qr]]=gt[fr[qr]]),qr++;return Je},"extend","Use `assign`."),ce=Z(function(Je,gt){return he(Je,gt,!0)},"merge","Use `assign`.");function pe(He,Je,gt){var Ot=Je.prototype,fr;fr=He.prototype=Object.create(Ot),fr.constructor=He,fr._super=Ot,gt&&Y(fr,gt)}function be(He,Je){return function(){return He.apply(Je,arguments)}}function Te(He,Je){return typeof He==s?He.apply(Je&&Je[0]||n,Je):He}function qe(He,Je){return He===n?Je:He}function je(He,Je,gt){U(nt(Je),function(Ot){He.addEventListener(Ot,gt,!1)})}function We(He,Je,gt){U(nt(Je),function(Ot){He.removeEventListener(Ot,gt,!1)})}function Ne(He,Je){for(;He;){if(He==Je)return!0;He=He.parentNode}return!1}function at(He,Je){return He.indexOf(Je)>-1}function nt(He){return He.trim().split(/\s+/g)}function ke(He,Je,gt){if(He.indexOf&&!gt)return He.indexOf(Je);for(var Ot=0;Ot<He.length;){if(gt&&He[Ot][gt]==Je||!gt&&He[Ot]===Je)return Ot;Ot++}return-1}function De(He){return Array.prototype.slice.call(He,0)}function Ye(He,Je,gt){for(var Ot=[],fr=[],qr=0;qr<He.length;){var Ci=Je?He[qr][Je]:He[qr];ke(fr,Ci)<0&&Ot.push(He[qr]),fr[qr]=Ci,qr++}return gt&&(Je?Ot=Ot.sort(function(qn,os){return qn[Je]>os[Je]}):Ot=Ot.sort()),Ot}function Xe(He,Je){for(var gt,Ot,fr=Je[0].toUpperCase()+Je.slice(1),qr=0;qr<o.length;){if(gt=o[qr],Ot=gt?gt+fr:Je,Ot in He)return Ot;qr++}return n}var Ct=1;function Et(){return Ct++}function Pt(He){var Je=He.ownerDocument||He;return Je.defaultView||Je.parentWindow||e}var bt=/mobile|tablet|ip(ad|hone|od)|android/i,Rt="ontouchstart"in e,Ft=Xe(e,"PointerEvent")!==n,Zt=Rt&&bt.test(navigator.userAgent),Le="touch",Ze="pen",rt="mouse",pt="kinect",mt=25,Bt=1,Dt=2,Mt=4,qt=8,nr=1,vr=2,br=4,Fr=8,kt=16,lt=vr|br,wt=Fr|kt,Ur=lt|wt,tr=["x","y"],ht=["clientX","clientY"];function $t(He,Je){var gt=this;this.manager=He,this.callback=Je,this.element=He.element,this.target=He.options.inputTarget,this.domHandler=function(Ot){Te(He.options.enable,[He])&&gt.handler(Ot)},this.init()}$t.prototype={handler:function(){},init:function(){this.evEl&&je(this.element,this.evEl,this.domHandler),this.evTarget&&je(this.target,this.evTarget,this.domHandler),this.evWin&&je(Pt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&We(this.element,this.evEl,this.domHandler),this.evTarget&&We(this.target,this.evTarget,this.domHandler),this.evWin&&We(Pt(this.element),this.evWin,this.domHandler)}};function or(He){var Je,gt=He.options.inputClass;return gt?Je=gt:Ft?Je=Be:Zt?Je=Fe:Rt?Je=vt:Je=xr,new Je(He,mr)}function mr(He,Je,gt){var Ot=gt.pointers.length,fr=gt.changedPointers.length,qr=Je&Bt&&Ot-fr===0,Ci=Je&(Mt|qt)&&Ot-fr===0;gt.isFirst=!!qr,gt.isFinal=!!Ci,qr&&(He.session={}),gt.eventType=Je,ur(He,gt),He.emit("hammer.input",gt),He.recognize(gt),He.session.prevInput=gt}function ur(He,Je){var gt=He.session,Ot=Je.pointers,fr=Ot.length;gt.firstInput||(gt.firstInput=gi(Je)),fr>1&&!gt.firstMultiple?gt.firstMultiple=gi(Je):fr===1&&(gt.firstMultiple=!1);var qr=gt.firstInput,Ci=gt.firstMultiple,In=Ci?Ci.center:qr.center,qn=Je.center=Pi(Ot);Je.timeStamp=T(),Je.deltaTime=Je.timeStamp-qr.timeStamp,Je.angle=Wt(In,qn),Je.distance=Ar(In,qn),Wr(gt,Je),Je.offsetDirection=Xr(Je.deltaX,Je.deltaY);var os=zt(Je.deltaTime,Je.deltaX,Je.deltaY);Je.overallVelocityX=os.x,Je.overallVelocityY=os.y,Je.overallVelocity=y(os.x)>y(os.y)?os.x:os.y,Je.scale=Ci?Qt(Ci.pointers,Ot):1,Je.rotation=Ci?di(Ci.pointers,Ot):0,Je.maxPointers=gt.prevInput?Je.pointers.length>gt.prevInput.maxPointers?Je.pointers.length:gt.prevInput.maxPointers:Je.pointers.length,ri(gt,Je);var _n=He.element;Ne(Je.srcEvent.target,_n)&&(_n=Je.srcEvent.target),Je.target=_n}function Wr(He,Je){var gt=Je.center,Ot=He.offsetDelta||{},fr=He.prevDelta||{},qr=He.prevInput||{};(Je.eventType===Bt||qr.eventType===Mt)&&(fr=He.prevDelta={x:qr.deltaX||0,y:qr.deltaY||0},Ot=He.offsetDelta={x:gt.x,y:gt.y}),Je.deltaX=fr.x+(gt.x-Ot.x),Je.deltaY=fr.y+(gt.y-Ot.y)}function ri(He,Je){var gt=He.lastInterval||Je,Ot=Je.timeStamp-gt.timeStamp,fr,qr,Ci,In;if(Je.eventType!=qt&&(Ot>mt||gt.velocity===n)){var qn=Je.deltaX-gt.deltaX,os=Je.deltaY-gt.deltaY,_n=zt(Ot,qn,os);qr=_n.x,Ci=_n.y,fr=y(_n.x)>y(_n.y)?_n.x:_n.y,In=Xr(qn,os),He.lastInterval=Je}else fr=gt.velocity,qr=gt.velocityX,Ci=gt.velocityY,In=gt.direction;Je.velocity=fr,Je.velocityX=qr,Je.velocityY=Ci,Je.direction=In}function gi(He){for(var Je=[],gt=0;gt<He.pointers.length;)Je[gt]={clientX:g(He.pointers[gt].clientX),clientY:g(He.pointers[gt].clientY)},gt++;return{timeStamp:T(),pointers:Je,center:Pi(Je),deltaX:He.deltaX,deltaY:He.deltaY}}function Pi(He){var Je=He.length;if(Je===1)return{x:g(He[0].clientX),y:g(He[0].clientY)};for(var gt=0,Ot=0,fr=0;fr<Je;)gt+=He[fr].clientX,Ot+=He[fr].clientY,fr++;return{x:g(gt/Je),y:g(Ot/Je)}}function zt(He,Je,gt){return{x:Je/He||0,y:gt/He||0}}function Xr(He,Je){return He===Je?nr:y(He)>=y(Je)?He<0?vr:br:Je<0?Fr:kt}function Ar(He,Je,gt){gt||(gt=tr);var Ot=Je[gt[0]]-He[gt[0]],fr=Je[gt[1]]-He[gt[1]];return Math.sqrt(Ot*Ot+fr*fr)}function Wt(He,Je,gt){gt||(gt=tr);var Ot=Je[gt[0]]-He[gt[0]],fr=Je[gt[1]]-He[gt[1]];return Math.atan2(fr,Ot)*180/Math.PI}function di(He,Je){return Wt(Je[1],Je[0],ht)+Wt(He[1],He[0],ht)}function Qt(He,Je){return Ar(Je[0],Je[1],ht)/Ar(He[0],He[1],ht)}var Tr={mousedown:Bt,mousemove:Dt,mouseup:Mt},Lr="mousedown",Xt="mousemove mouseup";function xr(){this.evEl=Lr,this.evWin=Xt,this.pressed=!1,$t.apply(this,arguments)}pe(xr,$t,{handler:function(Je){var gt=Tr[Je.type];gt&Bt&&Je.button===0&&(this.pressed=!0),gt&Dt&&Je.which!==1&&(gt=Mt),this.pressed&&(gt&Mt&&(this.pressed=!1),this.callback(this.manager,gt,{pointers:[Je],changedPointers:[Je],pointerType:rt,srcEvent:Je}))}});var er={pointerdown:Bt,pointermove:Dt,pointerup:Mt,pointercancel:qt,pointerout:qt},vi={2:Le,3:Ze,4:rt,5:pt},Zi="pointerdown",Qe="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Zi="MSPointerDown",Qe="MSPointerMove MSPointerUp MSPointerCancel");function Be(){this.evEl=Zi,this.evWin=Qe,$t.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}pe(Be,$t,{handler:function(Je){var gt=this.store,Ot=!1,fr=Je.type.toLowerCase().replace("ms",""),qr=er[fr],Ci=vi[Je.pointerType]||Je.pointerType,In=Ci==Le,qn=ke(gt,Je.pointerId,"pointerId");qr&Bt&&(Je.button===0||In)?qn<0&&(gt.push(Je),qn=gt.length-1):qr&(Mt|qt)&&(Ot=!0),!(qn<0)&&(gt[qn]=Je,this.callback(this.manager,qr,{pointers:gt,changedPointers:[Je],pointerType:Ci,srcEvent:Je}),Ot&&gt.splice(qn,1))}});var ue={touchstart:Bt,touchmove:Dt,touchend:Mt,touchcancel:qt},re="touchstart",Ae="touchstart touchmove touchend touchcancel";function ge(){this.evTarget=re,this.evWin=Ae,this.started=!1,$t.apply(this,arguments)}pe(ge,$t,{handler:function(Je){var gt=ue[Je.type];if(gt===Bt&&(this.started=!0),!!this.started){var Ot=xe.call(this,Je,gt);gt&(Mt|qt)&&Ot[0].length-Ot[1].length===0&&(this.started=!1),this.callback(this.manager,gt,{pointers:Ot[0],changedPointers:Ot[1],pointerType:Le,srcEvent:Je})}}});function xe(He,Je){var gt=De(He.touches),Ot=De(He.changedTouches);return Je&(Mt|qt)&&(gt=Ye(gt.concat(Ot),"identifier",!0)),[gt,Ot]}var Ee={touchstart:Bt,touchmove:Dt,touchend:Mt,touchcancel:qt},we="touchstart touchmove touchend touchcancel";function Fe(){this.evTarget=we,this.targetIds={},$t.apply(this,arguments)}pe(Fe,$t,{handler:function(Je){var gt=Ee[Je.type],Ot=ze.call(this,Je,gt);Ot&&this.callback(this.manager,gt,{pointers:Ot[0],changedPointers:Ot[1],pointerType:Le,srcEvent:Je})}});function ze(He,Je){var gt=De(He.touches),Ot=this.targetIds;if(Je&(Bt|Dt)&&gt.length===1)return Ot[gt[0].identifier]=!0,[gt,gt];var fr,qr,Ci=De(He.changedTouches),In=[],qn=this.target;if(qr=gt.filter(function(os){return Ne(os.target,qn)}),Je===Bt)for(fr=0;fr<qr.length;)Ot[qr[fr].identifier]=!0,fr++;for(fr=0;fr<Ci.length;)Ot[Ci[fr].identifier]&&In.push(Ci[fr]),Je&(Mt|qt)&&delete Ot[Ci[fr].identifier],fr++;if(In.length)return[Ye(qr.concat(In),"identifier",!0),In]}var Ge=2500,st=25;function vt(){$t.apply(this,arguments);var He=be(this.handler,this);this.touch=new Fe(this.manager,He),this.mouse=new xr(this.manager,He),this.primaryTouch=null,this.lastTouches=[]}pe(vt,$t,{handler:function(Je,gt,Ot){var fr=Ot.pointerType==Le,qr=Ot.pointerType==rt;if(!(qr&&Ot.sourceCapabilities&&Ot.sourceCapabilities.firesTouchEvents)){if(fr)Tt.call(this,gt,Ot);else if(qr&&rr.call(this,Ot))return;this.callback(Je,gt,Ot)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Tt(He,Je){He&Bt?(this.primaryTouch=Je.changedPointers[0].identifier,Kt.call(this,Je)):He&(Mt|qt)&&Kt.call(this,Je)}function Kt(He){var Je=He.changedPointers[0];if(Je.identifier===this.primaryTouch){var gt={x:Je.clientX,y:Je.clientY};this.lastTouches.push(gt);var Ot=this.lastTouches,fr=function(){var qr=Ot.indexOf(gt);qr>-1&&Ot.splice(qr,1)};setTimeout(fr,Ge)}}function rr(He){for(var Je=He.srcEvent.clientX,gt=He.srcEvent.clientY,Ot=0;Ot<this.lastTouches.length;Ot++){var fr=this.lastTouches[Ot],qr=Math.abs(Je-fr.x),Ci=Math.abs(gt-fr.y);if(qr<=st&&Ci<=st)return!0}return!1}var Gt=Xe(a.style,"touchAction"),dr=Gt!==n,Cr="compute",Gr="auto",Er="manipulation",zr="none",ot="pan-x",ir="pan-y",Vt=un();function Hr(He,Je){this.manager=He,this.set(Je)}Hr.prototype={set:function(He){He==Cr&&(He=this.compute()),dr&&this.manager.element.style&&Vt[He]&&(this.manager.element.style[Gt]=He),this.actions=He.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var He=[];return U(this.manager.recognizers,function(Je){Te(Je.options.enable,[Je])&&(He=He.concat(Je.getTouchAction()))}),ci(He.join(" "))},preventDefaults:function(He){var Je=He.srcEvent,gt=He.offsetDirection;if(this.manager.session.prevented){Je.preventDefault();return}var Ot=this.actions,fr=at(Ot,zr)&&!Vt[zr],qr=at(Ot,ir)&&!Vt[ir],Ci=at(Ot,ot)&&!Vt[ot];if(fr){var In=He.pointers.length===1,qn=He.distance<2,os=He.deltaTime<250;if(In&&qn&&os)return}if(!(Ci&&qr)&&(fr||qr&&gt&lt||Ci&&gt&wt))return this.preventSrc(Je)},preventSrc:function(He){this.manager.session.prevented=!0,He.preventDefault()}};function ci(He){if(at(He,zr))return zr;var Je=at(He,ot),gt=at(He,ir);return Je&&gt?zr:Je||gt?Je?ot:ir:at(He,Er)?Er:Gr}function un(){if(!dr)return!1;var He={},Je=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(gt){He[gt]=Je?e.CSS.supports("touch-action",gt):!0}),He}var wn=1,mi=2,mn=4,yn=8,fi=yn,jn=16,qs=32;function Ui(He){this.options=Y({},this.defaults,He||{}),this.id=Et(),this.manager=null,this.options.enable=qe(this.options.enable,!0),this.state=wn,this.simultaneous={},this.requireFail=[]}Ui.prototype={defaults:{},set:function(He){return Y(this.options,He),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(He){if(R(He,"recognizeWith",this))return this;var Je=this.simultaneous;return He=Nn(He,this),Je[He.id]||(Je[He.id]=He,He.recognizeWith(this)),this},dropRecognizeWith:function(He){return R(He,"dropRecognizeWith",this)?this:(He=Nn(He,this),delete this.simultaneous[He.id],this)},requireFailure:function(He){if(R(He,"requireFailure",this))return this;var Je=this.requireFail;return He=Nn(He,this),ke(Je,He)===-1&&(Je.push(He),He.requireFailure(this)),this},dropRequireFailure:function(He){if(R(He,"dropRequireFailure",this))return this;He=Nn(He,this);var Je=ke(this.requireFail,He);return Je>-1&&this.requireFail.splice(Je,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(He){return!!this.simultaneous[He.id]},emit:function(He){var Je=this,gt=this.state;function Ot(fr){Je.manager.emit(fr,He)}gt<yn&&Ot(Je.options.event+Bn(gt)),Ot(Je.options.event),He.additionalEvent&&Ot(He.additionalEvent),gt>=yn&&Ot(Je.options.event+Bn(gt))},tryEmit:function(He){if(this.canEmit())return this.emit(He);this.state=qs},canEmit:function(){for(var He=0;He<this.requireFail.length;){if(!(this.requireFail[He].state&(qs|wn)))return!1;He++}return!0},recognize:function(He){var Je=Y({},He);if(!Te(this.options.enable,[this,Je])){this.reset(),this.state=qs;return}this.state&(fi|jn|qs)&&(this.state=wn),this.state=this.process(Je),this.state&(mi|mn|yn|jn)&&this.tryEmit(Je)},process:function(He){},getTouchAction:function(){},reset:function(){}};function Bn(He){return He&jn?"cancel":He&yn?"end":He&mn?"move":He&mi?"start":""}function Xa(He){return He==kt?"down":He==Fr?"up":He==vr?"left":He==br?"right":""}function Nn(He,Je){var gt=Je.manager;return gt?gt.get(He):He}function Zr(){Ui.apply(this,arguments)}pe(Zr,Ui,{defaults:{pointers:1},attrTest:function(He){var Je=this.options.pointers;return Je===0||He.pointers.length===Je},process:function(He){var Je=this.state,gt=He.eventType,Ot=Je&(mi|mn),fr=this.attrTest(He);return Ot&&(gt&qt||!fr)?Je|jn:Ot||fr?gt&Mt?Je|yn:Je&mi?Je|mn:mi:qs}});function co(){Zr.apply(this,arguments),this.pX=null,this.pY=null}pe(co,Zr,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ur},getTouchAction:function(){var He=this.options.direction,Je=[];return He&lt&&Je.push(ir),He&wt&&Je.push(ot),Je},directionTest:function(He){var Je=this.options,gt=!0,Ot=He.distance,fr=He.direction,qr=He.deltaX,Ci=He.deltaY;return fr&Je.direction||(Je.direction&lt?(fr=qr===0?nr:qr<0?vr:br,gt=qr!=this.pX,Ot=Math.abs(He.deltaX)):(fr=Ci===0?nr:Ci<0?Fr:kt,gt=Ci!=this.pY,Ot=Math.abs(He.deltaY))),He.direction=fr,gt&&Ot>Je.threshold&&fr&Je.direction},attrTest:function(He){return Zr.prototype.attrTest.call(this,He)&&(this.state&mi||!(this.state&mi)&&this.directionTest(He))},emit:function(He){this.pX=He.deltaX,this.pY=He.deltaY;var Je=Xa(He.direction);Je&&(He.additionalEvent=this.options.event+Je),this._super.emit.call(this,He)}});function Fs(){Zr.apply(this,arguments)}pe(Fs,Zr,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[zr]},attrTest:function(He){return this._super.attrTest.call(this,He)&&(Math.abs(He.scale-1)>this.options.threshold||this.state&mi)},emit:function(He){if(He.scale!==1){var Je=He.scale<1?"in":"out";He.additionalEvent=this.options.event+Je}this._super.emit.call(this,He)}});function bi(){Ui.apply(this,arguments),this._timer=null,this._input=null}pe(bi,Ui,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Gr]},process:function(He){var Je=this.options,gt=He.pointers.length===Je.pointers,Ot=He.distance<Je.threshold,fr=He.deltaTime>Je.time;if(this._input=He,!Ot||!gt||He.eventType&(Mt|qt)&&!fr)this.reset();else if(He.eventType&Bt)this.reset(),this._timer=I(function(){this.state=fi,this.tryEmit()},Je.time,this);else if(He.eventType&Mt)return fi;return qs},reset:function(){clearTimeout(this._timer)},emit:function(He){this.state===fi&&(He&&He.eventType&Mt?this.manager.emit(this.options.event+"up",He):(this._input.timeStamp=T(),this.manager.emit(this.options.event,this._input)))}});function Ii(){Zr.apply(this,arguments)}pe(Ii,Zr,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[zr]},attrTest:function(He){return this._super.attrTest.call(this,He)&&(Math.abs(He.rotation)>this.options.threshold||this.state&mi)}});function ss(){Zr.apply(this,arguments)}pe(ss,Zr,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:lt|wt,pointers:1},getTouchAction:function(){return co.prototype.getTouchAction.call(this)},attrTest:function(He){var Je=this.options.direction,gt;return Je&(lt|wt)?gt=He.overallVelocity:Je&lt?gt=He.overallVelocityX:Je&wt&&(gt=He.overallVelocityY),this._super.attrTest.call(this,He)&&Je&He.offsetDirection&&He.distance>this.options.threshold&&He.maxPointers==this.options.pointers&&y(gt)>this.options.velocity&&He.eventType&Mt},emit:function(He){var Je=Xa(He.offsetDirection);Je&&this.manager.emit(this.options.event+Je,He),this.manager.emit(this.options.event,He)}});function ji(){Ui.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}pe(ji,Ui,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Er]},process:function(He){var Je=this.options,gt=He.pointers.length===Je.pointers,Ot=He.distance<Je.threshold,fr=He.deltaTime<Je.time;if(this.reset(),He.eventType&Bt&&this.count===0)return this.failTimeout();if(Ot&&fr&&gt){if(He.eventType!=Mt)return this.failTimeout();var qr=this.pTime?He.timeStamp-this.pTime<Je.interval:!0,Ci=!this.pCenter||Ar(this.pCenter,He.center)<Je.posThreshold;this.pTime=He.timeStamp,this.pCenter=He.center,!Ci||!qr?this.count=1:this.count+=1,this._input=He;var In=this.count%Je.taps;if(In===0)return this.hasRequireFailures()?(this._timer=I(function(){this.state=fi,this.tryEmit()},Je.interval,this),mi):fi}return qs},failTimeout:function(){return this._timer=I(function(){this.state=qs},this.options.interval,this),qs},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==fi&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Tn(He,Je){return Je=Je||{},Je.recognizers=qe(Je.recognizers,Tn.defaults.preset),new Mi(He,Je)}Tn.VERSION="2.0.7",Tn.defaults={domEvents:!1,touchAction:Cr,enable:!0,inputTarget:null,inputClass:null,preset:[[Ii,{enable:!1}],[Fs,{enable:!1},["rotate"]],[ss,{direction:lt}],[co,{direction:lt},["swipe"]],[ji],[ji,{event:"doubletap",taps:2},["tap"]],[bi]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Cn=1,mo=2;function Mi(He,Je){this.options=Y({},Tn.defaults,Je||{}),this.options.inputTarget=this.options.inputTarget||He,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=He,this.input=or(this),this.touchAction=new Hr(this,this.options.touchAction),Za(this,!0),U(this.options.recognizers,function(gt){var Ot=this.add(new gt[0](gt[1]));gt[2]&&Ot.recognizeWith(gt[2]),gt[3]&&Ot.requireFailure(gt[3])},this)}Mi.prototype={set:function(He){return Y(this.options,He),He.touchAction&&this.touchAction.update(),He.inputTarget&&(this.input.destroy(),this.input.target=He.inputTarget,this.input.init()),this},stop:function(He){this.session.stopped=He?mo:Cn},recognize:function(He){var Je=this.session;if(!Je.stopped){this.touchAction.preventDefaults(He);var gt,Ot=this.recognizers,fr=Je.curRecognizer;(!fr||fr&&fr.state&fi)&&(fr=Je.curRecognizer=null);for(var qr=0;qr<Ot.length;)gt=Ot[qr],Je.stopped!==mo&&(!fr||gt==fr||gt.canRecognizeWith(fr))?gt.recognize(He):gt.reset(),!fr&&gt.state&(mi|mn|yn)&&(fr=Je.curRecognizer=gt),qr++}},get:function(He){if(He instanceof Ui)return He;for(var Je=this.recognizers,gt=0;gt<Je.length;gt++)if(Je[gt].options.event==He)return Je[gt];return null},add:function(He){if(R(He,"add",this))return this;var Je=this.get(He.options.event);return Je&&this.remove(Je),this.recognizers.push(He),He.manager=this,this.touchAction.update(),He},remove:function(He){if(R(He,"remove",this))return this;if(He=this.get(He),He){var Je=this.recognizers,gt=ke(Je,He);gt!==-1&&(Je.splice(gt,1),this.touchAction.update())}return this},on:function(He,Je){if(He!==n&&Je!==n){var gt=this.handlers;return U(nt(He),function(Ot){gt[Ot]=gt[Ot]||[],gt[Ot].push(Je)}),this}},off:function(He,Je){if(He!==n){var gt=this.handlers;return U(nt(He),function(Ot){Je?gt[Ot]&&gt[Ot].splice(ke(gt[Ot],Je),1):delete gt[Ot]}),this}},emit:function(He,Je){this.options.domEvents&&Ys(He,Je);var gt=this.handlers[He]&&this.handlers[He].slice();if(!(!gt||!gt.length)){Je.type=He,Je.preventDefault=function(){Je.srcEvent.preventDefault()};for(var Ot=0;Ot<gt.length;)gt[Ot](Je),Ot++}},destroy:function(){this.element&&Za(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Za(He,Je){var gt=He.element;if(gt.style){var Ot;U(He.options.cssProps,function(fr,qr){Ot=Xe(gt.style,qr),Je?(He.oldCssProps[Ot]=gt.style[Ot],gt.style[Ot]=fr):gt.style[Ot]=He.oldCssProps[Ot]||""}),Je||(He.oldCssProps={})}}function Ys(He,Je){var gt=t.createEvent("Event");gt.initEvent(He,!0,!0),gt.gesture=Je,Je.target.dispatchEvent(gt)}Y(Tn,{INPUT_START:Bt,INPUT_MOVE:Dt,INPUT_END:Mt,INPUT_CANCEL:qt,STATE_POSSIBLE:wn,STATE_BEGAN:mi,STATE_CHANGED:mn,STATE_ENDED:yn,STATE_RECOGNIZED:fi,STATE_CANCELLED:jn,STATE_FAILED:qs,DIRECTION_NONE:nr,DIRECTION_LEFT:vr,DIRECTION_RIGHT:br,DIRECTION_UP:Fr,DIRECTION_DOWN:kt,DIRECTION_HORIZONTAL:lt,DIRECTION_VERTICAL:wt,DIRECTION_ALL:Ur,Manager:Mi,Input:$t,TouchAction:Hr,TouchInput:Fe,MouseInput:xr,PointerEventInput:Be,TouchMouseInput:vt,SingleTouchInput:ge,Recognizer:Ui,AttrRecognizer:Zr,Tap:ji,Pan:co,Swipe:ss,Pinch:Fs,Rotate:Ii,Press:bi,on:je,off:We,each:U,merge:ce,extend:he,assign:Y,inherit:pe,bindFn:be,prefixed:Xe});var Ja=typeof e<"u"?e:typeof self<"u"?self:{};Ja.Hammer=Tn,typeof n=="function"&&n.amd?n(function(){return Tn}):r.exports?r.exports=Tn:e[i]=Tn})(window,document,"Hammer")})(tP);var Ry=tP.exports;const jh=Km({__proto__:null,default:Wm(Ry)},[Ry]),rP=1,iP=2,bB=4,RW={mousedown:rP,mousemove:iP,mouseup:bB};function kW(r,e){for(let t=0;t<r.length;t++)if(e(r[t]))return!0;return!1}function OW(r){const e=r.prototype.handler;r.prototype.handler=function(i){const n=this.store;i.button>0&&i.type==="pointerdown"&&(kW(n,o=>o.pointerId===i.pointerId)||n.push(i)),e.call(this,i)}}function UW(r){r.prototype.handler=function(t){let i=RW[t.type];i&rP&&t.button>=0&&(this.pressed=!0),i&iP&&t.which===0&&(i=bB),this.pressed&&(i&bB&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}OW(Ry.PointerEventInput),UW(Ry.MouseInput);const NW=Ry.Manager;class N1{constructor(e,t,i){this.element=e,this.callback=t,this.options={enable:!0,...i}}}const zW=jh?[[jh.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[jh.Rotate,{enable:!1}],[jh.Pinch,{enable:!1}],[jh.Swipe,{enable:!1}],[jh.Pan,{threshold:0,enable:!1}],[jh.Press,{enable:!1}],[jh.Tap,{event:"doubletap",taps:2,enable:!1}],[jh.Tap,{event:"anytap",enable:!1}],[jh.Tap,{enable:!1}]]:null,nP={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},QW={doubletap:["tap"]},VW={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},xB={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},HW={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},sP={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},GW=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",_g=typeof window<"u"?window:global;let wB=!1;try{const r={get passive(){return wB=!0,!0}};_g.addEventListener("test",null,r),_g.removeEventListener("test",null)}catch{wB=!1}const jW=GW.indexOf("firefox")!==-1,{WHEEL_EVENTS:qW}=xB,oP="wheel",aP=4.000244140625,$W=40,KW=.25;class WW extends N1{constructor(e,t,i){super(e,t,i),this.handleEvent=n=>{if(!this.options.enable)return;let o=n.deltaY;_g.WheelEvent&&(jW&&n.deltaMode===_g.WheelEvent.DOM_DELTA_PIXEL&&(o/=_g.devicePixelRatio),n.deltaMode===_g.WheelEvent.DOM_DELTA_LINE&&(o*=$W)),o!==0&&o%aP===0&&(o=Math.floor(o/aP)),n.shiftKey&&o&&(o=o*KW),this.callback({type:oP,center:{x:n.clientX,y:n.clientY},delta:-o,srcEvent:n,pointerType:"mouse",target:n.target})},this.events=(this.options.events||[]).concat(qW),this.events.forEach(n=>e.addEventListener(n,this.handleEvent,wB?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===oP&&(this.options.enable=t)}}const{MOUSE_EVENTS:XW}=xB,lP="pointermove",cP="pointerover",uP="pointerout",hP="pointerenter",AP="pointerleave";class ZW extends N1{constructor(e,t,i){super(e,t,i),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,this.events=(this.options.events||[]).concat(XW),this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===lP&&(this.enableMoveEvent=t),e===cP&&(this.enableOverEvent=t),e===uP&&(this.enableOutEvent=t),e===hP&&(this.enableEnterEvent=t),e===AP&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(cP,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(uP,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(hP,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(AP,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(lP,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:JW}=xB,dP="keydown",fP="keyup";class YW extends N1{constructor(e,t,i){super(e,t,i),this.handleEvent=n=>{const o=n.target||n.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:dP,srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:fP,srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(JW),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e===dP&&(this.enableDownEvent=t),e===fP&&(this.enableUpEvent=t)}}const pP="contextmenu";class eX extends N1{constructor(e,t,i){super(e,t,i),this.handleEvent=n=>{this.options.enable&&this.callback({type:pP,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===pP&&(this.options.enable=t)}}const BB=1,z1=2,CB=4,tX={pointerdown:BB,pointermove:z1,pointerup:CB,mousedown:BB,mousemove:z1,mouseup:CB},rX=1,iX=2,nX=3,sX=0,oX=1,aX=2,lX=1,cX=2,uX=4;function hX(r){const e=tX[r.srcEvent.type];if(!e)return null;const{buttons:t,button:i,which:n}=r.srcEvent;let o=!1,a=!1,s=!1;return e===CB||e===z1&&!Number.isFinite(t)?(o=n===rX,a=n===iX,s=n===nX):e===z1?(o=!!(t&lX),a=!!(t&uX),s=!!(t&cX)):e===BB&&(o=i===sX,a=i===oX,s=i===aX),{leftButton:o,middleButton:a,rightButton:s}}function AX(r,e){const t=r.center;if(!t)return null;const i=e.getBoundingClientRect(),n=i.width/e.offsetWidth||1,o=i.height/e.offsetHeight||1,a={x:(t.x-i.left-e.clientLeft)/n,y:(t.y-i.top-e.clientTop)/o};return{center:t,offsetCenter:a}}const EB={srcElement:"root",priority:0};class dX{constructor(e){this.handleEvent=t=>{if(this.isEmpty())return;const i=this._normalizeEvent(t);let n=t.srcEvent.target;for(;n&&n!==i.rootElement;){if(this._emit(i,n),i.handled)return;n=n.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const{handlers:a,handlersByElement:s}=this;let g=EB;typeof i=="string"||i&&i.addEventListener?g={...EB,srcElement:i}:i&&(g={...EB,...i});let y=s.get(g.srcElement);y||(y=[],s.set(g.srcElement,y));const T={type:e,handler:t,srcElement:g.srcElement,priority:g.priority};n&&(T.once=!0),o&&(T.passive=!0),a.push(T),this._active=this._active||!T.passive;let I=y.length-1;for(;I>=0&&!(y[I].priority>=T.priority);)I--;y.splice(I+1,0,T)}remove(e,t){const{handlers:i,handlersByElement:n}=this;for(let o=i.length-1;o>=0;o--){const a=i[o];if(a.type===e&&a.handler===t){i.splice(o,1);const s=n.get(a.srcElement);s.splice(s.indexOf(a),1),s.length===0&&n.delete(a.srcElement)}}this._active=i.some(o=>!o.passive)}_emit(e,t){const i=this.handlersByElement.get(t);if(i){let n=!1;const o=()=>{e.handled=!0},a=()=>{e.handled=!0,n=!0},s=[];for(let g=0;g<i.length;g++){const{type:y,handler:T,once:I}=i[g];if(T({...e,type:y,stopPropagation:o,stopImmediatePropagation:a}),I&&s.push(i[g]),n)break}for(let g=0;g<s.length;g++){const{type:y,handler:T}=s[g];this.remove(y,T)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...hX(e),...AX(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const fX={events:null,recognizers:null,recognizerOptions:{},Manager:NW,touchAction:"none",tabIndex:0};class pX{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;this._onBasicInput=n=>{const{srcEvent:o}=n,a=VW[o.type];a&&this.manager.emit(a,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={...fX,...t},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,i=t.Manager;this.manager=new i(e,{touchAction:t.touchAction,recognizers:t.recognizers||zW}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(nP).forEach(n=>{const o=this.manager.get(n);o&&nP[n].forEach(a=>{o.recognizeWith(a)})});for(const n in t.recognizerOptions){const o=this.manager.get(n);if(o){const a=t.recognizerOptions[n];delete a.enable,o.set(a)}}this.wheelInput=new WW(e,this._onOtherEvent,{enable:!1}),this.moveInput=new ZW(e,this._onOtherEvent,{enable:!1}),this.keyInput=new YW(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new eX(e,this._onOtherEvent,{enable:!1});for(const[n,o]of this.events)o.isEmpty()||(this._toggleRecognizer(o.recognizerName,!0),this.manager.on(n,o.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:i}=this;if(!i)return;const n=i.get(e);if(n&&n.options.enable!==t){n.set({enable:t});const o=QW[e];o&&!this.options.recognizers&&o.forEach(a=>{const s=i.get(a);t?(s.requireFailure(e),n.dropRequireFailure(a)):s.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,i,n,o){if(typeof e!="string"){i=t;for(const T in e)this._addEventHandler(T,e[T],i,n,o);return}const{manager:a,events:s}=this,g=sP[e]||e;let y=s.get(g);y||(y=new dX(this),s.set(g,y),y.recognizerName=HW[g]||g,a&&a.on(g,y.handleEvent)),y.add(e,t,i,n,o),y.isEmpty()||this._toggleRecognizer(y.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const a in e)this._removeEventHandler(a,e[a]);return}const{events:i}=this,n=sP[e]||e,o=i.get(n);if(o&&(o.remove(e,t),o.isEmpty())){const{recognizerName:a}=o;let s=!1;for(const g of i.values())if(g.recognizerName===a&&!g.isEmpty()){s=!0;break}s||this._toggleRecognizer(a,!1)}}}function Pf(){}const gP={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:Pf,onResize:Pf,onViewStateChange:Pf,onInteractionStateChange:Pf,onBeforeRender:Pf,onAfterRender:Pf,onLoad:Pf,onError:r=>On.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:r=>{let{isDragging:e}=r;return e?"grabbing":"grab"},getTooltip:null,debug:!1,drawPickingColors:!1};class SB{constructor(e){ye(this,"props",void 0),ye(this,"width",0),ye(this,"height",0),ye(this,"userData",{}),ye(this,"canvas",null),ye(this,"viewManager",null),ye(this,"layerManager",null),ye(this,"effectManager",null),ye(this,"deckRenderer",null),ye(this,"deckPicker",null),ye(this,"eventManager",null),ye(this,"tooltip",null),ye(this,"metrics",void 0),ye(this,"animationLoop",void 0),ye(this,"stats",void 0),ye(this,"viewState",void 0),ye(this,"cursorState",void 0),ye(this,"_needsRedraw",void 0),ye(this,"_pickRequest",void 0),ye(this,"_lastPointerDownInfo",null),ye(this,"_metricsCounter",void 0),ye(this,"_onPointerMove",t=>{const{_pickRequest:i}=this;if(t.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(t.leftButton||t.rightButton)return;{const n=t.offsetCenter;if(!n)return;i.x=n.x,i.y=n.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=t}),ye(this,"_onEvent",t=>{const i=F3[t.type],n=t.offsetCenter;if(!i||!n||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:o,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:s}=a,g=s&&(s[i.handler]||s.props[i.handler]),y=this.props[i.handler];let T=!1;g&&(T=g.call(s,a,t)),!T&&y&&y(a,t)}),ye(this,"_onPointerDown",t=>{const i=t.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo}),this.props={...gP,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&On.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),S3()==="IE"&&On.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new _2({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&My.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,i,n,o,a,s,g;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(t=this.layerManager)===null||t===void 0||t.finalize(),this.layerManager=null,(i=this.viewManager)===null||i===void 0||i.finalize(),this.viewManager=null,(n=this.effectManager)===null||n===void 0||n.finalize(),this.effectManager=null,(o=this.deckRenderer)===null||o===void 0||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)===null||a===void 0||a.finalize(),this.deckPicker=null,(s=this.eventManager)===null||s===void 0||s.destroy(),this.eventManager=null,(g=this.tooltip)===null||g===void 0||g.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var y;(y=this.canvas.parentElement)===null||y===void 0||y.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&On.removed("onLayerHover","onHover")(),"onLayerClick"in e&&On.removed("onLayerClick","onClick")(),e.initialViewState&&!Gh(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return t=t||i||n||o||a,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return cl(this.viewManager),this.viewManager.views}getViewports(e){return cl(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,t,i){cl(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(t).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return n.get(t).timeEnd(),o}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),cl(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:i}=e;if(t||t===0){const o=Number.isFinite(t)?"".concat(t,"px"):t;this.canvas.style.width=o}if(i||i===0){var n;const o=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((n=e.style)===null||n===void 0?void 0:n.position)||"absolute",this.canvas.style.height=o}}_updateCanvasSize(){var e,t;const{canvas:i}=this;if(!i)return;const n=(e=i.clientWidth)!==null&&e!==void 0?e:i.width,o=(t=i.clientHeight)!==null&&t!==void 0?t:i.height;if(n!==this.width||o!==this.height){var a,s;this.width=n,this.height=o,(a=this.viewManager)===null||a===void 0||a.setProps({width:n,height:o}),(s=this.layerManager)===null||s===void 0||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:o})}}_createAnimationLoop(e){const{width:t,height:i,gl:n,glOptions:o,debug:a,onError:s,onBeforeRender:g,onAfterRender:y,useDevicePixels:T}=e;return new XG({width:t,height:i,useDevicePixels:T,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,gl:n,onCreateContext:I=>W3({...o,...I,canvas:this.canvas,debug:a,onContextLost:()=>this._onContextLost()}),onInitialize:I=>this._setGLContext(I.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:g,onAfterRender:y,onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new vB({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let o=n,a=!1;for(const s of i){var t;o=s,a=((t=s.layer)===null||t===void 0?void 0:t.onHover(s,e.event))||a}if(!a&&this.props.onHover&&this.props.onHover(o,e.event),this.props.getTooltip&&this.tooltip){const s=this.props.getTooltip(o);this.tooltip.setTooltip(s,o.x,o.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,y2(e,{enable:!0,copyState:!0})),this.tooltip=new DW(this.canvas),TA(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const t=new CM;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new pX(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const n in F3)this.eventManager.on(n,this._onEvent);this.viewManager=new oW({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new sW(e,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new wW,this.deckRenderer=new EW(e),this.deckPicker=new PW(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{gl:i}=this.layerManager.context;TA(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),On.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const i=Cf.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}ye(SB,"defaultProps",gP),ye(SB,"VERSION",r9);class TB{constructor(e,t){ye(this,"opts",void 0),ye(this,"source",void 0),this.opts=t,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),t=this.getAccessor();if(e)return[e,t];const{value:i}=this.source,{size:n}=t;let o=i;if(i&&i.length!==n){o=new Float32Array(n);const a=t.elementOffset||0;for(let s=0;s<n;++s)o[s]=i[a+s]}return o}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function gX(r){switch(r){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Q1(r){return r.stride||r.size*r.bytesPerElement}function mP(r,e){e.offset&&On.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Q1(r),i=e.vertexOffset!==void 0?e.vertexOffset:r.vertexOffset||0,n=e.elementOffset||0,o=i*t+n*r.bytesPerElement+(r.offset||0);return{...e,offset:o,stride:t}}function mX(r,e){const t=mP(r,e);return{high:t,low:{...t,offset:t.offset+r.size*4}}}class yX{constructor(e,t,i){ye(this,"gl",void 0),ye(this,"id",void 0),ye(this,"size",void 0),ye(this,"settings",void 0),ye(this,"value",void 0),ye(this,"doublePrecision",void 0),ye(this,"_buffer",void 0),ye(this,"state",void 0),this.gl=e,this.id=t.id||"",this.size=t.size||1;const n=t.logicalType||t.type,o=n===5130;let{defaultValue:a}=t;a=Number.isFinite(a)?[a]:a||new Array(this.size).fill(0);let s;o?s=5126:!n&&t.isIndexed?s=e&&S2(e,Hs.ELEMENT_INDEX_UINT32)?5125:5123:s=n||5126;let g=gX(n||s||5126);this.doublePrecision=o,o&&t.fp64===!1&&(g=Float32Array),this.value=null,this.settings={...t,defaultType:g,defaultValue:a,logicalType:n,type:s,size:this.size,bytesPerElement:g.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:t}=this.settings;this._buffer=new ws(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:t}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Q1(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),My.release(this.state.allocatedValue)}getShaderAttributes(e,t){if(this.doublePrecision){const i={},n=this.value instanceof Float64Array,o=mX(this.getAccessor(),t||{});return i[e]=new TB(this,o.high),i["".concat(e,"64Low")]=n?new TB(this,o.low):new Float32Array(this.size),i}if(t){const i=mP(this.getAccessor(),t);return{[e]:new TB(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:i,size:n}=this,o=i*n;if(t&&o&&t.length>=o){const a=new Array(n).fill(1/0),s=new Array(n).fill(-1/0);for(let g=0;g<o;)for(let y=0;y<n;y++){const T=t[g++];T<a[y]&&(a[y]=T),T>s[y]&&(s[y]=T)}e=[a,s]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof ws?i={buffer:e}:i=e;const n={...this.settings,...i};if(t.bufferAccessor=n,t.bounds=null,i.constant){let o=i.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!t.constant||!this._areValuesEqual(o,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=o}else if(i.buffer){const o=i.buffer;t.externalBuffer=o,t.constant=!1,this.value=i.value||null;const a=i.value instanceof Float64Array;n.type=i.type||o.accessor.type,n.bytesPerElement=o.accessor.BYTES_PER_ELEMENT*(a?2:1),n.stride=Q1(n)}else if(i.value){this._checkExternalBuffer(i);let o=i.value;t.externalBuffer=null,t.constant=!1,this.value=o,n.bytesPerElement=o.BYTES_PER_ELEMENT,n.stride=Q1(n);const{buffer:a,byteOffset:s}=this;this.doublePrecision&&o instanceof Float64Array&&(o=fB(o,n));const g=o.byteLength+s+n.stride*2;a.byteLength<g&&a.reallocate(g),a.setAccessor(null),a.subData({data:o,offset:s}),n.type=i.type||a.accessor.type}return!0}updateSubBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.state.bounds=null;const t=this.value,{startOffset:i=0,endOffset:n}=e;this.buffer.subData({data:this.doublePrecision&&t instanceof Float64Array?fB(t,{size:this.size,startIndex:i,endIndex:n}):t.subarray(i,n),offset:i*t.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{state:i}=this,n=i.allocatedValue,o=My.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=o;const{buffer:a,byteOffset:s}=this;return a.byteLength<o.byteLength+s&&(a.reallocate(o.byteLength+s),t&&n&&a.subData({data:n instanceof Float64Array?fB(n,this):n,offset:s})),i.allocatedValue=o,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=t.BYTES_PER_ELEMENT<4),n)throw new Error("Attribute ".concat(this.id," does not support ").concat(t.constructor.name));!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&On.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(t=>(t+128)/255*2-1);case 5122:return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case 5121:return new Float32Array(e).map(t=>t/255);case 5123:return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,i){const{defaultValue:n,size:o}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let a=o;for(;--a>=0;)t[i+a]=n[a];return t}switch(o){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:n[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:n[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:n[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:n[0];break;default:let a=o;for(;--a>=0;)t[i+a]=Number.isFinite(e[a])?e[a]:n[a]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:i}=this;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}}const yP=[],_P=[];function vP(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1/0,i=yP;const n={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?i=r:r.length>0&&(_P.length=r.length,i=_P):i=yP,(e>0||Number.isFinite(t))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,t),n.index=e-1),{iterable:i,objectInfo:n}}function bP(r){return r&&r[Symbol.asyncIterator]}function _X(r,e){const{size:t,stride:i,offset:n,startIndices:o,nested:a}=e,s=r.BYTES_PER_ELEMENT,g=i?i/s:t,y=n?n/s:0,T=Math.floor((r.length-y)/g);return(I,R)=>{let{index:U,target:Z}=R;if(!o){const pe=U*g+y;for(let be=0;be<t;be++)Z[be]=r[pe+be];return Z}const Y=o[U],he=o[U+1]||T;let ce;if(a){ce=new Array(he-Y);for(let pe=Y;pe<he;pe++){const be=pe*g+y;Z=new Array(t);for(let Te=0;Te<t;Te++)Z[Te]=r[be+Te];ce[pe-Y]=Z}}else if(g===t)ce=r.subarray(Y*t+y,he*t+y);else{ce=new r.constructor((he-Y)*t);let pe=0;for(let be=Y;be<he;be++){const Te=be*g+y;for(let qe=0;qe<t;qe++)ce[pe++]=r[Te+qe]}}return ce}}const vX=[],V1=[[0,1/0]];function bX(r,e){if(r===V1||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return r;const t=[],i=r.length;let n=0;for(let o=0;o<i;o++){const a=r[o];a[1]<e[0]?(t.push(a),n=o+1):a[0]>e[1]?t.push(a):e=[Math.min(a[0],e[0]),Math.max(a[1],e[1])]}return t.splice(n,0,e),t}function IB(r){const{source:e,target:t,start:i=0,size:n,getData:o}=r,a=r.end||t.length,s=e.length,g=a-i;if(s>g){t.set(e.subarray(0,g),i);return}if(t.set(e,i),!o)return;let y=s;for(;y<g;){const T=o(y,e);for(let I=0;I<n;I++)t[i+y]=T[I]||0,y++}}function xX(r){let{source:e,target:t,size:i,getData:n,sourceStartIndices:o,targetStartIndices:a}=r;if(!Array.isArray(a))return IB({source:e,target:t,size:i,getData:n}),t;let s=0,g=0;const y=n&&((I,R)=>n(I+g,R)),T=Math.min(o.length,a.length);for(let I=1;I<T;I++){const R=o[I]*i,U=a[I]*i;IB({source:e.subarray(s,R),target:t,start:g,end:U,size:i,getData:y}),s=R,g=U}return g<t.length&&IB({source:[],target:t,start:g,size:i,getData:y}),t}const wX={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function xP(r,e){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const t=r.type||"interpolation";return{...wX[t],...e,...r,type:t}}function wP(r,e){const t=e.getBuffer();return t?[t,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function BP(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(r,'"'))}}function CP(r){r.push(r.shift())}function LB(r,e){const{doublePrecision:t,settings:i,value:n,size:o}=r,a=t&&n instanceof Float64Array?2:1;return(i.noAlloc?n.length:e*o)*a}function EP(r){let{buffer:e,numInstances:t,attribute:i,fromLength:n,fromStartIndices:o,getData:a=pe=>pe}=r;const s=i.doublePrecision&&i.value instanceof Float64Array?2:1,g=i.size*s,y=i.byteOffset,T=i.startIndices,I=o&&T,R=LB(i,t),U=i.isConstant;if(!I&&n>=R)return;const Z=U?i.value:i.getBuffer().getData({srcByteOffset:y});if(i.settings.normalized&&!U){const pe=a;a=(be,Te)=>i.normalizeConstant(pe(be,Te))}const Y=U?(pe,be)=>a(Z,be):(pe,be)=>a(Z.subarray(pe,pe+g),be),he=e.getData({length:n}),ce=new Float32Array(R);xX({source:he,target:ce,sourceStartIndices:o,targetStartIndices:T,size:g,getData:Y}),e.byteLength<ce.byteLength+y&&e.reallocate(ce.byteLength+y),e.subData({data:ce,offset:y})}class MB extends yX{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:V1}),ye(this,"constant",!1),this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw(){let{clearChangedFlags:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,i=this.settings.transition,n=Array.isArray(t)?e[t.find(o=>e[o])]:e[t];return xP(n,i)}setNeedsUpdate(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id,t=arguments.length>1?arguments[1]:void 0;if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:i=0,endRow:n=1/0}=t;this.state.updateRanges=bX(this.state.updateRanges,[i,n])}else this.state.updateRanges=V1}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=vX}setNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.id;this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,t.updateRanges!==V1),!0):!1}updateBuffer(e){let{numInstances:t,data:i,props:n,context:o}=e;if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:s,noAlloc:g}}=this;let y=!0;if(s){for(const[T,I]of a)s.call(o,this,{data:i,startRow:T,endRow:I,props:n,numInstances:t});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[T,I]of a){const R=Number.isFinite(T)?this.getVertexOffset(T):0,U=Number.isFinite(I)?this.getVertexOffset(I):g||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:R,endOffset:U})}this._checkAttributeArray()}else y=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),y}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;const{state:i,settings:n}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),n.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const a=e;cl(ArrayBuffer.isView(a.value),"invalid ".concat(n.accessor));const s=!!a.size&&a.size!==this.size;return i.binaryAccessor=_X(a.value,{size:a.size||this.size,stride:a.stride,offset:a.offset,startIndices:t,nested:s}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},t={};for(const i in e)Object.assign(t,super.getShaderAttributes(i,e[i]));return t}_autoUpdater(e,t){let{data:i,startRow:n,endRow:o,props:a,numInstances:s}=t;if(e.constant)return;const{settings:g,state:y,value:T,size:I,startIndices:R}=e,{accessor:U,transform:Z}=g,Y=y.binaryAccessor||(typeof U=="function"?U:a[U]);cl(typeof Y=="function",'accessor "'.concat(U,'" is not a function'));let he=e.getVertexOffset(n);const{iterable:ce,objectInfo:pe}=vP(i,n,o);for(const be of ce){pe.index++;let Te=Y(be,pe);if(Z&&(Te=Z.call(this,Te)),R){const qe=(pe.index<R.length-1?R[pe.index+1]:s)-R[pe.index];if(Te&&Array.isArray(Te[0])){let je=he;for(const We of Te)e._normalizeValue(We,T,je),je+=I}else Te&&Te.length>I?T.set(Te,he):(e._normalizeValue(Te,pe.target,0),ZK({target:T,source:pe.target,start:he,count:qe}));he+=qe*I}else e._normalizeValue(Te,T,he),he+=I}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class BX{constructor(e){let{gl:t,attribute:i,timeline:n}=e;ye(this,"gl",void 0),ye(this,"type","interpolation"),ye(this,"attributeInTransition",void 0),ye(this,"settings",void 0),ye(this,"attribute",void 0),ye(this,"transition",void 0),ye(this,"currentStartIndices",void 0),ye(this,"currentLength",void 0),ye(this,"transform",void 0),ye(this,"buffers",void 0),this.gl=t,this.transition=new Dy(n),this.attribute=i,this.attributeInTransition=new MB(t,i.settings),this.currentStartIndices=i.startIndices,this.currentLength=0,this.transform=EX(t,i);const o={byteLength:0,usage:35050};this.buffers=[new ws(t,o),new ws(t,o)]}get inProgress(){return this.transition.inProgress}start(e,t){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:n,attribute:o}=this;CP(n);const a={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of n)EP({buffer:s,...a});this.currentStartIndices=o.startIndices,this.currentLength=LB(o,t),this.attributeInTransition.setData({buffer:n[1],value:o.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aFrom:n[0],aTo:wP(i,o)},feedbackBuffers:{vCurrent:n[1]}})}update(){const e=this.transition.update();if(e){const{duration:t,easing:i}=this.settings,{time:n}=this.transition;let o=n/t;i&&(o=i(o)),this.transform.run({uniforms:{time:o}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const CX=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function EX(r,e){const t=BP(e.size);return new nB(r,{vs:CX,defines:{ATTRIBUTE_TYPE:t},varyings:["vCurrent"]})}class SX{constructor(e){let{gl:t,attribute:i,timeline:n}=e;ye(this,"gl",void 0),ye(this,"type","spring"),ye(this,"attributeInTransition",void 0),ye(this,"settings",void 0),ye(this,"attribute",void 0),ye(this,"transition",void 0),ye(this,"currentStartIndices",void 0),ye(this,"currentLength",void 0),ye(this,"texture",void 0),ye(this,"framebuffer",void 0),ye(this,"transform",void 0),ye(this,"buffers",void 0),this.gl=t,this.type="spring",this.transition=new Dy(n),this.attribute=i,this.attributeInTransition=new MB(t,{...i.settings,normalized:!1}),this.currentStartIndices=i.startIndices,this.currentLength=0,this.texture=IX(t),this.framebuffer=LX(t,this.texture),this.transform=TX(t,i,this.framebuffer);const o={byteLength:0,usage:35050};this.buffers=[new ws(t,o),new ws(t,o),new ws(t,o)]}get inProgress(){return this.transition.inProgress}start(e,t){const{gl:i,buffers:n,attribute:o}=this,a={numInstances:t,attribute:o,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const s of n)EP({buffer:s,...a});this.settings=e,this.currentStartIndices=o.startIndices,this.currentLength=LB(o,t),this.attributeInTransition.setData({buffer:n[1],value:o.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/o.size),sourceBuffers:{aTo:wP(i,o)}})}update(){const{buffers:e,transform:t,framebuffer:i,transition:n}=this;if(!n.update())return!1;const a=this.settings;return t.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),t.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:a.stiffness,damping:a.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),CP(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),h1(i)[0]>0||n.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function TX(r,e,t){const i=BP(e.size);return new nB(r,{framebuffer:t,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function IX(r){return new iu(r,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function LX(r,e){return new Ba(r,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const MX={interpolation:BX,spring:SX};class PX{constructor(e,t){let{id:i,timeline:n}=t;ye(this,"id",void 0),ye(this,"isSupported",void 0),ye(this,"gl",void 0),ye(this,"timeline",void 0),ye(this,"transitions",void 0),ye(this,"needsRedraw",void 0),ye(this,"numInstances",void 0),this.id=i,this.gl=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=nB.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update(e){let{attributes:t,transitions:i,numInstances:n}=e;this.numInstances=n||1;for(const o in t){const a=t[o],s=a.getTransitionSetting(i);s&&this._updateAttribute(o,a,s)}for(const o in this.transitions){const a=t[o];(!a||!a.getTransitionSetting(i))&&this._removeTransition(o)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,t,i){const n=this.transitions[e];let o=!n||n.type!==i.type;if(o){if(!this.isSupported){On.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}n&&this._removeTransition(e);const a=MX[i.type];a?this.transitions[e]=new a({attribute:t,timeline:this.timeline,gl:this.gl}):(On.error("unsupported transition type '".concat(i.type,"'"))(),o=!1)}(o||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const SP="attributeManager.invalidate",FX="attributeManager.updateStart",DX="attributeManager.updateEnd",RX="attribute.updateStart",kX="attribute.allocate",OX="attribute.updateEnd";class UX{constructor(e){let{id:t="attribute-manager",stats:i,timeline:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ye(this,"id",void 0),ye(this,"gl",void 0),ye(this,"attributes",void 0),ye(this,"updateTriggers",void 0),ye(this,"needsRedraw",void 0),ye(this,"userData",void 0),ye(this,"stats",void 0),ye(this,"attributeTransitionManager",void 0),ye(this,"mergeBoundsMemoized",Iy(VK)),this.id=t,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new PX(e,{id:"".concat(t,"-transitions"),timeline:n}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const i=this._invalidateTrigger(e,t);Ml(SP,this,e,i)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Ml(SP,this,"all")}update(e){let{data:t,numInstances:i,startIndices:n=null,transitions:o,props:a={},buffers:s={},context:g={}}=e,y=!1;Ml(FX,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const T in this.attributes){const I=this.attributes[T],R=I.settings.accessor;I.startIndices=n,I.numInstances=i,a[T]&&On.removed("props.".concat(T),"data.attributes.".concat(T))(),I.setExternalBuffer(s[T])||I.setBinaryValue(typeof R=="string"?s[R]:void 0,t.startIndices)||typeof R=="string"&&!s[R]&&I.setConstantValue(a[R])||I.needsUpdate()&&(y=!0,this._updateAttribute({attribute:I,numInstances:i,data:t,props:a,context:g})),this.needsRedraw=this.needsRedraw||I.needsRedraw()}y&&Ml(DX,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return this.attributes}getBounds(e){const t=e.map(i=>{var n;return(n=this.attributes[i])===null||n===void 0?void 0:n.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearChangedFlags:!1};const{attributes:t,attributeTransitionManager:i}=this,n={...i.getAttributes()};for(const o in t){const a=t[o];a.needsRedraw(e)&&!i.hasAttribute(o)&&(n[o]=a)}return n}getShaderAttributes(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e||(e=this.getAttributes());const i={};for(const n in e)t[n]||Object.assign(i,e[n].getShaderAttributes());return i}_add(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};for(const i in e){const n=e[i];this.attributes[i]=this._createAttribute(i,n,t)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,t,i){const n={...t,id:e,size:t.isIndexed&&1||t.size||1,divisor:i.instanced?1:t.divisor||0};return new MB(this.gl,n)}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:i,updateTriggers:n}=this,o=n[e];return o&&o.forEach(a=>{const s=i[a];s&&s.setNeedsUpdate(s.id,t)}),o}_updateAttribute(e){const{attribute:t,numInstances:i}=e;if(Ml(RX,t),t.constant){t.setConstantValue(t.value);return}t.allocate(i)&&Ml(kX,t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,Ml(OX,t,i))}}class NX extends Dy{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:i,duration:n,easing:o}}=this,a=o(e/n);this._value=b1(t,i,a)}}const TP=1e-5;function IP(r,e,t,i,n){const o=e-r,s=(t-e)*n,g=-o*i;return s+g+o+e}function zX(r,e,t,i,n){if(Array.isArray(t)){const o=[];for(let a=0;a<t.length;a++)o[a]=IP(r[a],e[a],t[a],i,n);return o}return IP(r,e,t,i,n)}function LP(r,e){if(Array.isArray(r)){let t=0;for(let i=0;i<r.length;i++){const n=r[i]-e[i];t+=n*n}return Math.sqrt(t)}return Math.abs(r-e)}class QX extends Dy{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:i,stiffness:n}=this.settings,{_prevValue:o=e,_currValue:a=e}=this;let s=zX(o,a,t,i,n);const g=LP(s,t),y=LP(s,a);g<TP&&y<TP&&(s=t,this.end()),this._prevValue=a,this._currValue=s}}const VX={interpolation:NX,spring:QX};class HX{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,n){const{transitions:o}=this;if(o.has(e)){const g=o.get(e),{value:y=g.settings.fromValue}=g;t=y,this.remove(e)}if(n=xP(n),!n)return;const a=VX[n.type];if(!a){On.error("unsupported transition type '".concat(n.type,"'"))();return}const s=new a(this.timeline);s.start({...n,fromValue:t,toValue:i}),o.set(e,s)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function GX(r){const e=r[gd];for(const t in e){const i=e[t],{validate:n}=i;if(n&&!n(r[t],i))throw new Error("Invalid prop ".concat(t,": ").concat(r[t]))}}function jX(r,e){const t=MP({newProps:r,oldProps:e,propTypes:r[gd],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=$X(r,e);let n=!1;return i||(n=KX(r,e)),{dataChanged:i,propsChanged:t,updateTriggersChanged:n,extensionsChanged:WX(r,e),transitionsChanged:qX(r,e)}}function qX(r,e){if(!r.transitions)return!1;const t={},i=r[gd];let n=!1;for(const o in r.transitions){const a=i[o],s=a&&a.type;(s==="number"||s==="color"||s==="array")&&PB(r[o],e[o],a)&&(t[o]=!0,n=!0)}return n?t:!1}function MP(r){let{newProps:e,oldProps:t,ignoreProps:i={},propTypes:n={},triggerName:o="props"}=r;if(t===e)return!1;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return"".concat(o," changed shallowly");for(const a of Object.keys(e))if(!(a in i)){if(!(a in t))return"".concat(o,".").concat(a," added");const s=PB(e[a],t[a],n[a]);if(s)return"".concat(o,".").concat(a," ").concat(s)}for(const a of Object.keys(t))if(!(a in i)){if(!(a in e))return"".concat(o,".").concat(a," dropped");if(!Object.hasOwnProperty.call(e,a)){const s=PB(e[a],t[a],n[a]);if(s)return"".concat(o,".").concat(a," ").concat(s)}}return!1}function PB(r,e,t){let i=t&&t.equal;return i&&!i(r,e,t)||!i&&(i=r&&e&&r.equals,i&&!i.call(r,e))?"changed deeply":!i&&e!==r?"changed shallowly":null}function $X(r,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:i,_dataDiff:n}=r;return i?i(r.data,e.data)||(t="Data comparator detected a change"):r.data!==e.data&&(t="A new data container was supplied"),t&&n&&(t=n(r.data,e.data)||t),t}function KX(r,e){if(e===null)return{all:!0};if("all"in r.updateTriggers&&PP(r,e,"all"))return{all:!0};const t={};let i=!1;for(const n in r.updateTriggers)n!=="all"&&PP(r,e,n)&&(t[n]=!0,i=!0);return i?t:!1}function WX(r,e){if(e===null)return!0;const t=e.extensions,{extensions:i}=r;if(i===t)return!1;if(!t||!i||i.length!==t.length)return!0;for(let n=0;n<i.length;n++)if(!i[n].equals(t[n]))return!0;return!1}function PP(r,e,t){let i=r.updateTriggers[t];i=i??{};let n=e.updateTriggers[t];return n=n??{},MP({oldProps:n,newProps:i,triggerName:t})}const XX="count(): argument not an object",ZX="count(): argument not a container";function JX(r){if(!eZ(r))throw new Error(XX);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(YX(r))return Object.keys(r).length;throw new Error(ZX)}function YX(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function eZ(r){return r!==null&&typeof r=="object"}function tZ(r,e){if(!e)return r;const t={...r,...e};if("defines"in e&&(t.defines={...r.defines,...e.defines}),"modules"in e&&(t.modules=(r.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=t.modules.findIndex(n=>n.name==="project32");i>=0&&t.modules.splice(i,1)}if("inject"in e)if(!r.inject)t.inject=e.inject;else{const i={...r.inject};for(const n in e.inject)i[n]=(i[n]||"")+e.inject[n];t.inject=i}return t}const rZ={10241:9987,10240:9729,10242:33071,10243:33071},FB={};function iZ(r,e,t,i){if(t instanceof iu)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let n=null;t.compressed&&(n={10241:t.data.length>1?9985:9729});const o=new iu(e,{...t,parameters:{...rZ,...n,...i}});return FB[o.id]=r,o}function nZ(r,e){!e||!(e instanceof iu)||FB[e.id]===r&&(e.delete(),delete FB[e.id])}const sZ={boolean:{validate(r,e){return!0},equal(r,e,t){return!!r==!!e}},number:{validate(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate(r,e){return e.optional&&!r||DB(r)&&(r.length===3||r.length===4)},equal(r,e,t){return Gh(r,e,1)}},accessor:{validate(r,e){const t=H1(r);return t==="function"||t===H1(e.value)},equal(r,e,t){return typeof e=="function"?!0:Gh(r,e,1)}},array:{validate(r,e){return e.optional&&!r||DB(r)},equal(r,e,t){const{compare:i}=t,n=Number.isInteger(i)?i:i?1:0;return i?Gh(r,e,n):r===e}},object:{equal(r,e,t){if(t.ignore)return!0;const{compare:i}=t,n=Number.isInteger(i)?i:i?1:0;return i?Gh(r,e,n):r===e}},function:{validate(r,e){return e.optional&&!r||typeof r=="function"},equal(r,e,t){return!t.compare&&t.ignore!==!1||r===e}},data:{transform:(r,e,t)=>{const{dataTransform:i}=t.props;return i&&r?i(r):r}},image:{transform:(r,e,t)=>{const i=t.context;return!i||!i.gl?null:iZ(t.id,i.gl,r,{...e.parameters,...t.props.textureParameters})},release:(r,e,t)=>{nZ(t.id,r)}}};function oZ(r){const e={},t={},i={};for(const[n,o]of Object.entries(r)){const a=o==null?void 0:o.deprecatedFor;if(a)i[n]=Array.isArray(a)?a:[a];else{const s=aZ(n,o);e[n]=s,t[n]=s.value}}return{propTypes:e,defaultProps:t,deprecatedProps:i}}function aZ(r,e){switch(H1(e)){case"object":return ky(r,e);case"array":return ky(r,{type:"array",value:e,compare:!1});case"boolean":return ky(r,{type:"boolean",value:e});case"number":return ky(r,{type:"number",value:e});case"function":return ky(r,{type:"function",value:e,compare:!0});default:return{name:r,type:"unknown",value:e}}}function ky(r,e){return"type"in e?{name:r,...sZ[e.type],...e}:"value"in e?{name:r,type:H1(e.value),...e}:{name:r,type:"object",value:e}}function DB(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function H1(r){return DB(r)?"array":r===null?"null":typeof r}function lZ(r,e){let t;for(let o=e.length-1;o>=0;o--){const a=e[o];"extensions"in a&&(t=a.extensions)}const i=RB(r.constructor,t),n=Object.create(i);n[k1]=r,n[Lf]={},n[md]={};for(let o=0;o<e.length;++o){const a=e[o];for(const s in a)n[s]=a[s]}return Object.freeze(n),n}const cZ="_mergedDefaultProps";function RB(r,e){let t=cZ;if(e)for(const n of e){const o=n.constructor;o&&(t+=":".concat(o.extensionName||o.name))}const i=FP(r,t);return i||(r[t]=uZ(r,e||[]))}function uZ(r,e){if(!r.prototype)return null;const i=Object.getPrototypeOf(r),n=RB(i),o=FP(r,"defaultProps")||{},a=oZ(o),s=Object.assign(Object.create(null),n,a.defaultProps),g=Object.assign(Object.create(null),n==null?void 0:n[gd],a.propTypes),y=Object.assign(Object.create(null),n==null?void 0:n[gB],a.deprecatedProps);for(const T of e){const I=RB(T.constructor);I&&(Object.assign(s,I),Object.assign(g,I[gd]),Object.assign(y,I[gB]))}return hZ(s,r),dZ(s,g),AZ(s,y),s[gd]=g,s[gB]=y,e.length===0&&!kB(r,"_propTypes")&&(r._propTypes=g),s}function hZ(r,e){const t=pZ(e);Object.defineProperties(r,{id:{writable:!0,value:t}})}function AZ(r,e){for(const t in e)Object.defineProperty(r,t,{enumerable:!1,set(i){const n="".concat(this.id,": ").concat(t);for(const o of e[t])kB(this,o)||(this[o]=i);On.deprecated(n,e[t].join("/"))()}})}function dZ(r,e){const t={},i={};for(const n in e){const o=e[n],{name:a,value:s}=o;o.async&&(t[a]=s,i[a]=fZ(a))}r[mg]=t,r[Lf]={},Object.defineProperties(r,i)}function fZ(r){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||bP(e)?this[Lf][r]=e:this[md][r]=e},get(){if(this[md]){if(r in this[md])return this[md][r]||this[mg][r];if(r in this[Lf]){const e=this[k1]&&this[k1].internalState;if(e&&e.hasAsyncProp(r))return e.getAsyncProp(r)||this[mg][r]}}return this[mg][r]}}}function kB(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function FP(r,e){return kB(r,e)&&r[e]}function pZ(r){const e=r.componentName;return e||On.warn("".concat(r.name,".componentName not specified"))(),e||r.name}let gZ=0;class OB{constructor(){ye(this,"id",void 0),ye(this,"props",void 0),ye(this,"count",void 0);for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.props=lZ(this,t),this.id=this.props.id,this.count=gZ++}clone(e){const{props:t}=this,i={};for(const n in t[mg])n in t[md]?i[n]=t[md][n]:n in t[Lf]&&(i[n]=t[Lf][n]);return new this.constructor({...t,...i,...e})}}ye(OB,"componentName","Component"),ye(OB,"defaultProps",{});const mZ=Object.freeze({});class yZ{constructor(e){ye(this,"component",void 0),ye(this,"onAsyncPropUpdated",void 0),ye(this,"asyncProps",void 0),ye(this,"oldProps",void 0),ye(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||mZ}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[k1]||this.component;const t=e[md]||{},i=e[Lf]||e,n=e[mg]||{};for(const o in t){const a=t[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,a),t[o]=this.getAsyncProp(o)}for(const o in i){const a=i[o];this._createAsyncPropData(o,n[o]),this._updateAsyncProp(o,a)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(bP(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const i=this.asyncProps[e];return t===i.resolvedValue||t===i.lastValue?!1:(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){const n=this.asyncProps[e];n&&i>=n.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=t,n.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const n=i.pendingLoadCount;t.then(o=>{this.component&&(o=this._postProcessValue(i,o),this._setAsyncPropValue(e,o,n),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const n=i.pendingLoadCount;let o=[],a=0;for await(const s of t){if(!this.component)return;const{dataTransform:g}=this.component.props;g?o=g(s,o):o=o.concat(s),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:a,endRow:o.length}]}),a=o.length,this._setAsyncPropValue(e,o,n)}this._onResolve(e,o)}_postProcessValue(e,t){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.props[gd];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class _Z extends yZ{constructor(e){let{attributeManager:t,layer:i}=e;super(i),ye(this,"attributeManager",void 0),ye(this,"needsRedraw",void 0),ye(this,"needsUpdate",void 0),ye(this,"subLayers",void 0),ye(this,"usesPickingColorCache",void 0),ye(this,"hasPickingBuffer",void 0),ye(this,"changeFlags",void 0),ye(this,"viewport",void 0),ye(this,"uniformTransitions",void 0),ye(this,"propsInTransition",void 0),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const i=this.layer,n=i==null?void 0:i.props.fetch;return n?n(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){const i=this.layer;if(i){const n=i.props.onDataLoad;e==="data"&&n&&n(t,{propName:e,layer:i})}}_onError(e,t){const i=this.layer;i&&i.raiseError(t,"loading ".concat(e," of ").concat(this.layer))}}const vZ="layer.changeFlag",bZ="layer.initialize",xZ="layer.update",wZ="layer.finalize",BZ="layer.matched",DP=2**24-1,CZ=Object.freeze([]),EZ=Iy(r=>{let{oldViewport:e,viewport:t}=r;return e.equals(t)});let qh=new Uint8ClampedArray(0);const SZ={data:{type:"data",value:CZ,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,e)=>{let{propName:t,layer:i,loaders:n,loadOptions:o,signal:a}=e;const{resourceManager:s}=i.context;if(o=o||i.getLoadOptions(),n=n||i.props.loaders,a){var g;o={...o,fetch:{...(g=o)===null||g===void 0?void 0:g.fetch,signal:a}}}let y=s.contains(r);return!y&&!o&&(s.add({resourceId:r,data:ud(r,n),persistent:!1}),y=!0),y?s.subscribe({resourceId:r,onChange:T=>{var I;return(I=i.internalState)===null||I===void 0?void 0:I.reloadAsyncProp(t,T)},consumerId:i.id,requestId:t}):ud(r,n,o)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Mn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:r=>{let{layerIndex:e}=r;return[0,-e*100]}},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class vg extends OB{constructor(){super(...arguments),ye(this,"internalState",null),ye(this,"lifecycle",gg.NO_STATE),ye(this,"context",void 0),ye(this,"state",void 0),ye(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){cl(this.internalState);const t=this.internalState.viewport||this.context.viewport,i=qM(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,o,a]=UM(i,t.pixelProjectionMatrix);return e.length===2?[n,o]:[n,o,a]}unproject(e){return cl(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){cl(this.internalState);const i=this.internalState.viewport||this.context.viewport;return KK(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Mn.DEFAULT||e===Mn.LNGLAT||e===Mn.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){cl(e instanceof Uint8Array);const[t,i,n]=e;return t+i*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:JX(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const t of this.props.extensions)e=tZ(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(const n of i)t.invalidateAll(n);else t.invalidateAll();if(t){const{props:n}=e,o=this.internalState.hasPickingBuffer,a=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(s=>s.getNeedsPickingBuffer.call(this,s));if(o!==a){this.internalState.hasPickingBuffer=a;const{pickingColors:s,instancePickingColors:g}=t.attributes,y=s||g;y&&(a&&y.constant&&(y.constant=!1,t.invalidate(y.id)),!y.value&&!a&&(y.constant=!0,y.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.delete();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo(e){let{info:t,mode:i,sourceLayer:n}=e;const{index:o}=t;return o>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[o]),t}raiseError(e,t){var i,n;if(t&&(e=new Error("".concat(t,": ").concat(e.message),{cause:e})),!((i=(n=this.props).onError)!==null&&i!==void 0&&i.call(n,e))){var o,a;(o=this.context)===null||o===void 0||(a=o.onError)===null||a===void 0||a.call(o,e,this)}}getNeedsRedraw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{clearRedrawFlags:!1};return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!EZ({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"all";const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){for(const t of this.getModels())this._setModelAttributes(t,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,i=this.getNumInstances(),n=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:n,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),i=Object.create(this.props);for(const n in t)Object.defineProperty(i,n,{value:t[n]});return i}return this.props}calculateInstancePickingColors(e,t){let{numInstances:i}=t;if(e.constant)return;const n=Math.floor(qh.length/3);if(this.internalState.usesPickingColorCache=!0,n<i){i>DP&&On.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),qh=My.allocate(qh,i,{size:3,copy:!0,maxCount:Math.max(i,DP)});const o=Math.floor(qh.length/3),a=[];for(let s=n;s<o;s++)this.encodePickingColor(s,a),qh[s*3+0]=a[0],qh[s*3+1]=a[1],qh[s*3+2]=a[2]}e.value=qh.subarray(0,i*3)}_setModelAttributes(e,t){const i=this.getAttributeManager(),n=e.userData.excludeAttributes||{},o=i.getShaderAttributes(t,n);e.setAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,o=i||n,a=o&&t.attributes&&t.attributes[o.id];if(a&&a.value){const s=a.value,g=this.encodePickingColor(e);for(let y=0;y<t.length;y++){const T=o.getVertexOffset(y);s[T]===g[0]&&s[T+1]===g[1]&&s[T+2]===g[2]&&this._disablePickingIndex(y)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,n=t||i;if(!n)return;const o=n.getVertexOffset(e),a=n.getVertexOffset(e+1);n.buffer.subData({data:new Uint8Array(a-o),offset:o})}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==qh.buffer&&(i.value=qh.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){cl(!this.internalState),cl(Number.isFinite(this.props.coordinateSystem)),Ml(bZ,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new _Z({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(On.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new HX(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Ml(BZ,this,this===e);const{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Ml(xZ,this,e),!e)return;const t=this.props,i=this.context,n=this.internalState,o=i.viewport,a=this._updateUniformTransition();n.propsInTransition=a,i.viewport=n.viewport||o,this.props=a;try{const s=this._getUpdateParams(),g=this.getModels();if(i.gl)this.updateState(s);else try{this.updateState(s)}catch{}for(const T of this.props.extensions)T.updateState.call(this,s,T);const y=this.getModels()[0]!==g[0];this._postUpdate(s,y)}finally{i.viewport=o,this.props=t,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){Ml(wZ,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer(e){let{moduleParameters:t=null,uniforms:i={},parameters:n={}}=e;this._updateAttributeTransition();const o=this.props,a=this.context;this.props=this.internalState.propsInTransition||o;const s=this.props.opacity;i.opacity=Math.pow(s,1/2.2);try{t&&this.setModuleParameters(t);const{getPolygonOffset:g}=this.props,y=g&&g(i)||[0,0];TA(a.gl,{polygonOffset:y}),nh(a.gl,n,()=>{const T={moduleParameters:t,uniforms:i,parameters:n,context:a};for(const I of this.props.extensions)I.draw.call(this,T,I);this.draw(T)})}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const n in e)if(e[n]){let o=!1;switch(n){case"dataChanged":const a=e[n],s=t[n];a&&Array.isArray(s)&&(t.dataChanged=Array.isArray(a)?s.concat(a):a,o=!0);default:t[n]||(t[n]=e[n],o=!0)}o&&Ml(vZ,this,n,e)}const i=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const i=jX(e,t);if(i.updateTriggersChanged)for(const o in i.updateTriggersChanged)i.updateTriggersChanged[o]&&this.invalidateAttribute(o);if(i.transitionsChanged)for(const o in i.transitionsChanged){var n;this.internalState.uniformTransitions.add(o,t[o],e[o],(n=e.transitions)===null||n===void 0?void 0:n[o])}return this.setChangeFlags(i)}validateProps(){GX(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(t.pickingHighlightColor=i(e)),this.setModuleParameters(t),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new UX(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:i,oldProps:n}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:o}=this.state;o==null||o.setInstanceCount(this.getNumInstances());const{autoHighlight:a,highlightedObjectIndex:s,highlightColor:g}=i;if(t||n.autoHighlight!==a||n.highlightedObjectIndex!==s||n.highlightColor!==g){const y={};a||(y.pickingSelectedColor=null),Array.isArray(g)&&(y.pickingHighlightColor=g),(t||s!==n.highlightedObjectIndex)&&(y.pickingSelectedColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setModuleParameters(y)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),n=i?i.getNeedsRedraw(e):!1;if(t=t||n,t)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}ye(vg,"defaultProps",SZ),ye(vg,"layerName","Layer");const TZ="compositeLayer.renderLayers";class RP extends vg{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo(e){let{info:t}=e;const{object:i}=t;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(t.object=i.__source.object,t.index=i.__source.index),t}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(i,n)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,n)}return e}getSubLayerProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};var t;const{opacity:i,pickable:n,visible:o,parameters:a,getPolygonOffset:s,highlightedObjectIndex:g,autoHighlight:y,highlightColor:T,coordinateSystem:I,coordinateOrigin:R,wrapLongitude:U,positionFormat:Z,modelMatrix:Y,extensions:he,fetch:ce,operation:pe,_subLayerProps:be}=this.props,Te={id:"",updateTriggers:{},opacity:i,pickable:n,visible:o,parameters:a,getPolygonOffset:s,highlightedObjectIndex:g,autoHighlight:y,highlightColor:T,coordinateSystem:I,coordinateOrigin:R,wrapLongitude:U,positionFormat:Z,modelMatrix:Y,extensions:he,fetch:ce,operation:pe},qe=be&&e.id&&be[e.id],je=qe&&qe.updateTriggers,We=e.id||"sublayer";if(qe){const Ne=this.props[gd],at=e.type?e.type._propTypes:{};for(const nt in qe){const ke=at[nt]||Ne[nt];ke&&ke.type==="accessor"&&(qe[nt]=this.getSubLayerAccessor(qe[nt]))}}Object.assign(Te,e,qe),Te.id="".concat(this.props.id,"-").concat(We),Te.updateTriggers={all:(t=this.props.updateTriggers)===null||t===void 0?void 0:t.all,...e.updateTriggers,...je};for(const Ne of he){const at=Ne.getSubLayerProps.call(this,Ne);at&&Object.assign(Te,at,{updateTriggers:Object.assign(Te.updateTriggers,at.updateTriggers)})}return Te}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let i=this.internalState.subLayers;const n=!i||this.needsUpdate();if(n){const o=this.renderLayers();i=O1(o,Boolean),this.internalState.subLayers=i}Ml(TZ,this,n,i);for(const o of i)o.parent=this}}ye(RP,"layerName","CompositeLayer");const UB=512,IZ=Math.PI/180;function LZ(r){let{map:e,gl:t,deck:i}=r;if(e.__deck)return e.__deck;const n=i==null?void 0:i.props._customRender,o=i==null?void 0:i.props.onLoad,a=PZ({...i==null?void 0:i.props,_customRender:()=>{e.triggerRepaint(),n==null||n("")}});let s;return(!i||i.props.gl===t)&&(Object.assign(a,{gl:t,width:null,height:null,touchAction:"unset",viewState:NB(e)}),i!=null&&i.isInitialized?kP(i,e):a.onLoad=()=>{o==null||o(),kP(s,e)}),i?(s=i,i.setProps(a),i.userData.isExternal=!0):(s=new SB(a),e.on("remove",()=>{MZ(e)})),s.userData.mapboxLayers=new Set,e.__deck=s,e.on("render",()=>{s.isInitialized&&UZ(s,e)}),s}function kP(r,e){const t=()=>{r.isInitialized?NZ(r,e):e.off("move",t)};e.on("move",t)}function MZ(r){var e;(e=r.__deck)===null||e===void 0||e.finalize(),r.__deck=null}function PZ(r){return{...r,parameters:{depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthFunc:515,blendEquation:32774,...r.parameters},views:r.views||[new vB({id:"mapbox"})]}}function FZ(r,e){r.userData.mapboxLayers.add(e),zB(r)}function DZ(r,e){r.userData.mapboxLayers.delete(e),zB(r)}function RZ(r,e){zB(r)}function kZ(r,e,t){let{currentViewport:i}=r.userData,n=!1;i||(i=OP(r,e,!0),r.userData.currentViewport=i,n=!0),r.isInitialized&&r._drawLayers("mapbox-repaint",{viewports:[i],layerFilter:o=>{let{layer:a}=o;return t.id===a.id||a.props.operation.includes("terrain")},clearStack:n,clearCanvas:!1})}function NB(r){var e;const{lng:t,lat:i}=r.getCenter(),n={longitude:(t+540)%360-180,latitude:i,zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch(),padding:r.getPadding(),repeat:r.getRenderWorldCopies()};return(e=r.getTerrain)!==null&&e!==void 0&&e.call(r)&&OZ(r,n),n}function OZ(r,e){if(r.getFreeCameraOptions){const{position:t}=r.getFreeCameraOptions();if(!t||t.z===void 0)return;const i=r.transform.height,{longitude:n,latitude:o,pitch:a}=e,s=t.x*UB,g=(1-t.y)*UB,y=t.z*UB,T=Ly([n,o]),I=s-T[0],R=g-T[1],U=Math.sqrt(I*I+R*R),Z=a*IZ,Y=1.5*i,he=Z<.001?Y*Math.cos(Z)/y:Y*Math.sin(Z)/U;e.zoom=Math.log2(he);const ce=Y*Math.cos(Z)/he,pe=y-ce;e.position=[0,0,pe/D1(o)]}else typeof r.transform.elevation=="number"&&(e.position=[0,0,r.transform.elevation])}function OP(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return new If({id:"mapbox",x:0,y:0,width:r.width,height:r.height,...NB(e),nearZMultiplier:t?.02:.1,nearZ:e.transform._nearZ/e.transform.height,farZ:e.transform._farZ/e.transform.height})}function UZ(r,e){const{mapboxLayers:t,isExternal:i}=r.userData;if(i){const n=Array.from(t,T=>T.id),a=O1(r.props.layers,Boolean).some(T=>T&&!n.includes(T.id));let s=r.getViewports();const g=s.findIndex(T=>T.id==="mapbox"),y=s.length>1||g<0;(a||y)&&(g>=0&&(s=s.slice(),s[g]=OP(r,e,!1)),r._drawLayers("mapbox-repaint",{viewports:s,layerFilter:T=>(!r.props.layerFilter||r.props.layerFilter(T))&&(T.viewport.id!=="mapbox"||!n.includes(T.layer.id)),clearCanvas:!1}))}r.userData.currentViewport=null}function NZ(r,e){r.setProps({viewState:NB(e)}),r.needsRedraw({clearRedrawFlags:!0})}function zB(r){if(r.userData.isExternal)return;const e=[];r.userData.mapboxLayers.forEach(t=>{const i=t.props.type,n=new i(t.props);e.push(n)}),r.setProps({layers:e})}class zZ{constructor(e){if(ye(this,"id",void 0),ye(this,"type",void 0),ye(this,"renderingMode",void 0),ye(this,"map",void 0),ye(this,"deck",void 0),ye(this,"props",void 0),!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=LZ({map:e,gl:t,deck:this.props.deck}),FZ(this.deck,this)}onRemove(){this.deck&&DZ(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&RZ(this.deck)}render(){kZ(this.deck,this.map,this)}}const QZ=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,VZ=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,UP=[0,0,0,255],NP=[0,0,1],HZ={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:r=>r.position},getNormal:{type:"accessor",value:NP},getColor:{type:"accessor",value:UP},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function GZ(r){const{header:e,attributes:t}=r;!e||!t||(r.length=e.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0&&(t.instanceColors=t.COLOR_0))}class QB extends vg{getShaders(){return super.getShaders({vs:QZ,fs:VZ,modules:[mB,m$,yB]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:NP},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:UP}})}updateState(e){const{changeFlags:t,props:i}=e;if(super.updateState(e),t.extensionsChanged){var n;const{gl:o}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(o),this.getAttributeManager().invalidateAll()}t.dataChanged&&GZ(i.data)}draw(e){let{uniforms:t}=e;const{pointSize:i,sizeUnits:n}=this.props;this.state.model.setUniforms(t).setUniforms({sizeUnits:d2[n],radiusPixels:i}).draw()}_getModel(e){const t=[];for(let i=0;i<3;i++){const n=i/3*Math.PI*2;t.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new ug(e,{...this.getShaders(),id:this.props.id,geometry:new Ty({drawMode:4,attributes:{positions:new Float32Array(t)}}),isInstanced:!0})}}ye(QB,"layerName","PointCloudLayer"),ye(QB,"defaultProps",HZ);const au={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new Ut,new Ut;const Oy=new Ut,zP=new Ut;class Uy{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;ye(this,"center",void 0),ye(this,"radius",void 0),this.radius=-0,this.center=new Ut,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=Oy.from(t),this.center=new Ut().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new Uy(this.center,this.radius)}union(e){const t=this.center,i=this.radius,n=e.center,o=e.radius,a=Oy.copy(n).subtract(t),s=a.magnitude();if(i>=s+o)return this.clone();if(o>=s+i)return e.clone();const g=(i+s+o)*.5;return zP.copy(a).scale((-i+g)/s).add(t),this.center.copy(zP),this.radius=g,this}expand(e){const i=Oy.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);const t=Sq(Oy,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){const t=this.distanceTo(e);return t*t}distanceTo(e){const i=Oy.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){const t=this.center,i=this.radius,o=e.normal.dot(t)+e.distance;return o<-i?au.OUTSIDE:o<i?au.INTERSECTING:au.INSIDE}}const jZ=new Ut,qZ=new Ut,G1=new Ut,j1=new Ut,q1=new Ut,$Z=new Ut,KZ=new Ut,RA={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Ny{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0,0,0,0,0,0,0];ye(this,"center",void 0),ye(this,"halfAxes",void 0),this.center=new Ut().from(e),this.halfAxes=new Co(t)}get halfSize(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new Ut(e).len(),new Ut(t).len(),new Ut(i).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),n=new Ut(e).normalize(),o=new Ut(t).normalize(),a=new Ut(i).normalize();return new Cy().fromMatrix3(new Co([...n,...o,...a]))}fromCenterHalfSizeQuaternion(e,t,i){const n=new Cy(i),o=new Co().fromQuaternion(n);return o[0]=o[0]*t[0],o[1]=o[1]*t[0],o[2]=o[2]*t[0],o[3]=o[3]*t[1],o[4]=o[4]*t[1],o[5]=o[5]*t[1],o[6]=o[6]*t[2],o[7]=o[7]*t[2],o[8]=o[8]*t[2],this.center=new Ut().from(e),this.halfAxes=o,this}clone(){return new Ny(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Uy;const t=this.halfAxes,i=t.getColumn(0,G1),n=t.getColumn(1,j1),o=t.getColumn(2,q1),a=jZ.copy(i).add(n).add(o);return e.center.copy(this.center),e.radius=a.magnitude(),e}intersectPlane(e){const t=this.center,i=e.normal,n=this.halfAxes,o=i.x,a=i.y,s=i.z,g=Math.abs(o*n[RA.COLUMN0ROW0]+a*n[RA.COLUMN0ROW1]+s*n[RA.COLUMN0ROW2])+Math.abs(o*n[RA.COLUMN1ROW0]+a*n[RA.COLUMN1ROW1]+s*n[RA.COLUMN1ROW2])+Math.abs(o*n[RA.COLUMN2ROW0]+a*n[RA.COLUMN2ROW1]+s*n[RA.COLUMN2ROW2]),y=i.dot(t)+e.distance;return y<=-g?au.OUTSIDE:y>=g?au.INSIDE:au.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const t=qZ.from(e).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,G1),o=i.getColumn(1,j1),a=i.getColumn(2,q1),s=n.magnitude(),g=o.magnitude(),y=a.magnitude();n.normalize(),o.normalize(),a.normalize();let T=0,I;return I=Math.abs(t.dot(n))-s,I>0&&(T+=I*I),I=Math.abs(t.dot(o))-g,I>0&&(T+=I*I),I=Math.abs(t.dot(a))-y,I>0&&(T+=I*I),T}computePlaneDistances(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[-0,-0],n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;const a=this.center,s=this.halfAxes,g=s.getColumn(0,G1),y=s.getColumn(1,j1),T=s.getColumn(2,q1),I=$Z.copy(g).add(y).add(T).add(a),R=KZ.copy(I).subtract(e);let U=t.dot(R);return n=Math.min(U,n),o=Math.max(U,o),I.copy(a).add(g).add(y).subtract(T),R.copy(I).subtract(e),U=t.dot(R),n=Math.min(U,n),o=Math.max(U,o),I.copy(a).add(g).subtract(y).add(T),R.copy(I).subtract(e),U=t.dot(R),n=Math.min(U,n),o=Math.max(U,o),I.copy(a).add(g).subtract(y).subtract(T),R.copy(I).subtract(e),U=t.dot(R),n=Math.min(U,n),o=Math.max(U,o),a.copy(I).subtract(g).add(y).add(T),R.copy(I).subtract(e),U=t.dot(R),n=Math.min(U,n),o=Math.max(U,o),a.copy(I).subtract(g).add(y).subtract(T),R.copy(I).subtract(e),U=t.dot(R),n=Math.min(U,n),o=Math.max(U,o),a.copy(I).subtract(g).subtract(y).add(T),R.copy(I).subtract(e),U=t.dot(R),n=Math.min(U,n),o=Math.max(U,o),a.copy(I).subtract(g).subtract(y).subtract(T),R.copy(I).subtract(e),U=t.dot(R),n=Math.min(U,n),o=Math.max(U,o),i[0]=n,i[1]=o,i}transform(e){this.center.transformAsPoint(e);const t=this.halfAxes.getColumn(0,G1);t.transformAsPoint(e);const i=this.halfAxes.getColumn(1,j1);i.transformAsPoint(e);const n=this.halfAxes.getColumn(2,q1);return n.transformAsPoint(e),this.halfAxes=new Co([...t,...i,...n]),this}getTransform(){throw new Error("not implemented")}}const QP=new Ut,VP=new Ut;class ch{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,1],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;ye(this,"normal",void 0),ye(this,"distance",void 0),this.normal=new Ut,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return sh(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=QP.from(e),this.normal.from(t).normalize();const i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,t,i,n){return this.normal.set(e,t,i),sh(oh(this.normal.len(),1)),this.distance=n,this}clone(){return new ch(this.normal,this.distance)}equals(e){return oh(this.distance,e.distance)&&oh(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const t=VP.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,t)}projectPointOntoPlane(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];e=QP.from(e);const i=this.getPointDistance(e),n=VP.copy(this.normal).scale(i);return e.subtract(n).to(t)}}const HP=[new Ut([1,0,0]),new Ut([0,1,0]),new Ut([0,0,1])],GP=new Ut,WZ=new Ut;new ch(new Ut(1,0,0),0);class Mu{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];ye(this,"planes",void 0),this.planes=e}fromBoundingSphere(e){this.planes.length=2*HP.length;const t=e.center,i=e.radius;let n=0;for(const o of HP){let a=this.planes[n],s=this.planes[n+1];a||(a=this.planes[n]=new ch),s||(s=this.planes[n+1]=new ch);const g=GP.copy(o).scale(-i).add(t);-o.dot(g),a.fromPointNormal(g,o);const y=GP.copy(o).scale(i).add(t),T=WZ.copy(o).negate();-T.dot(y),s.fromPointNormal(y,T),n+=2}return this}computeVisibility(e){let t=au.INSIDE;for(const i of this.planes)switch(e.intersectPlane(i)){case au.OUTSIDE:return au.OUTSIDE;case au.INTERSECTING:t=au.INTERSECTING;break}return t}computeVisibilityWithPlaneMask(e,t){if(sh(Number.isFinite(t),"parentPlaneMask is required."),t===Mu.MASK_OUTSIDE||t===Mu.MASK_INSIDE)return t;let i=Mu.MASK_INSIDE;const n=this.planes;for(let o=0;o<this.planes.length;++o){const a=o<31?1<<o:0;if(o<31&&!(t&a))continue;const s=n[o],g=e.intersectPlane(s);if(g===au.OUTSIDE)return Mu.MASK_OUTSIDE;g===au.INTERSECTING&&(i|=a)}return i}}ye(Mu,"MASK_OUTSIDE",4294967295),ye(Mu,"MASK_INSIDE",0),ye(Mu,"MASK_INDETERMINATE",2147483647),new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut,new Ut;const $h=new Co,XZ=new Co,ZZ=new Co,$1=new Co,jP=new Co;function JZ(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=Ey.EPSILON20,i=10;let n=0,o=0;const a=XZ,s=ZZ;a.identity(),s.copy(r);const g=t*YZ(s);for(;o<i&&eJ(s)>g;)tJ(s,$1),jP.copy($1).transpose(),s.multiplyRight($1),s.multiplyLeft(jP),a.multiplyRight($1),++n>2&&(++o,n=0);return e.unitary=a.toTarget(e.unitary),e.diagonal=s.toTarget(e.diagonal),e}function YZ(r){let e=0;for(let t=0;t<9;++t){const i=r[t];e+=i*i}return Math.sqrt(e)}const VB=[1,0,0],HB=[2,2,1];function eJ(r){let e=0;for(let t=0;t<3;++t){const i=r[$h.getElementIndex(HB[t],VB[t])];e+=2*i*i}return Math.sqrt(e)}function tJ(r,e){const t=Ey.EPSILON15;let i=0,n=1;for(let y=0;y<3;++y){const T=Math.abs(r[$h.getElementIndex(HB[y],VB[y])]);T>i&&(n=y,i=T)}const o=VB[n],a=HB[n];let s=1,g=0;if(Math.abs(r[$h.getElementIndex(a,o)])>t){const y=r[$h.getElementIndex(a,a)],T=r[$h.getElementIndex(o,o)],I=r[$h.getElementIndex(a,o)],R=(y-T)/2/I;let U;R<0?U=-1/(-R+Math.sqrt(1+R*R)):U=1/(R+Math.sqrt(1+R*R)),s=1/Math.sqrt(1+U*U),g=U*s}return Co.IDENTITY.to(e),e[$h.getElementIndex(o,o)]=e[$h.getElementIndex(a,a)]=s,e[$h.getElementIndex(a,o)]=g,e[$h.getElementIndex(o,a)]=-g,e}const bd=new Ut,rJ=new Ut,iJ=new Ut,nJ=new Ut,sJ=new Ut,oJ=new Co,aJ={diagonal:new Co,unitary:new Co};function lJ(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Ny;if(!r||r.length===0)return e.halfAxes=new Co([0,0,0,0,0,0,0,0,0]),e.center=new Ut,e;const t=r.length,i=new Ut(0,0,0);for(const at of r)i.add(at);const n=1/t;i.multiplyByScalar(n);let o=0,a=0,s=0,g=0,y=0,T=0;for(const at of r){const nt=bd.copy(at).subtract(i);o+=nt.x*nt.x,a+=nt.x*nt.y,s+=nt.x*nt.z,g+=nt.y*nt.y,y+=nt.y*nt.z,T+=nt.z*nt.z}o*=n,a*=n,s*=n,g*=n,y*=n,T*=n;const I=oJ;I[0]=o,I[1]=a,I[2]=s,I[3]=a,I[4]=g,I[5]=y,I[6]=s,I[7]=y,I[8]=T;const{unitary:R}=JZ(I,aJ),U=e.halfAxes.copy(R);let Z=U.getColumn(0,iJ),Y=U.getColumn(1,nJ),he=U.getColumn(2,sJ),ce=-Number.MAX_VALUE,pe=-Number.MAX_VALUE,be=-Number.MAX_VALUE,Te=Number.MAX_VALUE,qe=Number.MAX_VALUE,je=Number.MAX_VALUE;for(const at of r)bd.copy(at),ce=Math.max(bd.dot(Z),ce),pe=Math.max(bd.dot(Y),pe),be=Math.max(bd.dot(he),be),Te=Math.min(bd.dot(Z),Te),qe=Math.min(bd.dot(Y),qe),je=Math.min(bd.dot(he),je);Z=Z.multiplyByScalar(.5*(Te+ce)),Y=Y.multiplyByScalar(.5*(qe+pe)),he=he.multiplyByScalar(.5*(je+be)),e.center.copy(Z).add(Y).add(he);const We=rJ.set(ce-Te,pe-qe,be-je).multiplyByScalar(.5),Ne=new Co([We[0],0,0,0,We[1],0,0,0,We[2]]);return e.halfAxes.multiplyRight(Ne),e}const GB=Math.PI/180,K1=new Float32Array(16),qP=new Float32Array(12);function $P(r,e,t){const i=e[0]*GB,n=e[1]*GB,o=e[2]*GB,a=Math.sin(o),s=Math.sin(i),g=Math.sin(n),y=Math.cos(o),T=Math.cos(i),I=Math.cos(n),R=t[0],U=t[1],Z=t[2];r[0]=R*I*T,r[1]=R*g*T,r[2]=R*-s,r[3]=U*(-g*y+I*s*a),r[4]=U*(I*y+g*s*a),r[5]=U*T*a,r[6]=Z*(g*a+I*s*y),r[7]=Z*(-I*a+g*s*y),r[8]=Z*T*y}function KP(r){return r[0]=r[0],r[1]=r[1],r[2]=r[2],r[3]=r[4],r[4]=r[5],r[5]=r[6],r[6]=r[8],r[7]=r[9],r[8]=r[10],r[9]=r[12],r[10]=r[13],r[11]=r[14],r.subarray(0,12)}const WP={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(r,e){let{startRow:t,endRow:i}=e;const{data:n,getOrientation:o,getScale:a,getTranslation:s,getTransformMatrix:g}=this.props,y=Array.isArray(g),T=y&&g.length===16,I=Array.isArray(a),R=Array.isArray(o),U=Array.isArray(s),Z=T||!y&&!!g(n[0]);Z?r.constant=T:r.constant=R&&I&&U;const Y=r.value;if(r.constant){let he;Z?(K1.set(g),he=KP(K1)):(he=qP,$P(he,o,a),he.set(s,9)),r.value=new Float32Array(he)}else{let he=t*r.size;const{iterable:ce,objectInfo:pe}=vP(n,t,i);for(const be of ce){pe.index++;let Te;if(Z)K1.set(T?g:g(be,pe)),Te=KP(K1);else{Te=qP;const qe=R?o:o(be,pe),je=I?a:a(be,pe);$P(Te,qe,je),Te.set(U?s:s(be,pe),9)}Y[he++]=Te[0],Y[he++]=Te[1],Y[he++]=Te[2],Y[he++]=Te[3],Y[he++]=Te[4],Y[he++]=Te[5],Y[he++]=Te[6],Y[he++]=Te[7],Y[he++]=Te[8],Y[he++]=Te[9],Y[he++]=Te[10],Y[he++]=Te[11]}}}};function XP(r,e){return e===Mn.CARTESIAN||e===Mn.METER_OFFSETS||e===Mn.DEFAULT&&!r.isGeospatial}const cJ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;

  vTexCoord = texCoords;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;

  if (composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    normals_commonspace = project_normal(instanceModelMatrix * normals);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
    geometry.position = position_commonspace;
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
    geometry.position = position_commonspace;
    normals_commonspace = project_normal(instanceModelMatrix * normals);
  }

  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,uJ=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);

  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);
}
`;function ZP(r){let e=1/0,t=1/0,i=1/0,n=-1/0,o=-1/0,a=-1/0;const s=r.POSITION?r.POSITION.value:[],g=s&&s.length;for(let y=0;y<g;y+=3){const T=s[y],I=s[y+1],R=s[y+2];e=T<e?T:e,t=I<t?I:t,i=R<i?R:i,n=T>n?T:n,o=I>o?I:o,a=R>a?R:a}return[[e,t,i],[n,o,a]]}function hJ(r,e){if(!r)throw new Error(e||"loader assertion failed.")}class bg{constructor(e,t){ye(this,"fields",void 0),ye(this,"metadata",void 0),hJ(Array.isArray(e)),AJ(e),this.fields=e,this.metadata=t||new Map}compareTo(e){if(this.metadata!==e.metadata||this.fields.length!==e.fields.length)return!1;for(let t=0;t<this.fields.length;++t)if(!this.fields[t].compareTo(e.fields[t]))return!1;return!0}select(){const e=Object.create(null);for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];for(const a of i)e[a]=!0;const o=this.fields.filter(a=>e[a.name]);return new bg(o,this.metadata)}selectAt(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const n=t.map(o=>this.fields[o]).filter(Boolean);return new bg(n,this.metadata)}assign(e){let t,i=this.metadata;if(e instanceof bg){const a=e;t=a.fields,i=JP(JP(new Map,this.metadata),a.metadata)}else t=e;const n=Object.create(null);for(const a of this.fields)n[a.name]=a;for(const a of t)n[a.name]=a;const o=Object.values(n);return new bg(o,i)}}function AJ(r){const e={};for(const t of r)e[t.name]&&console.warn("Schema: duplicated field name",t.name,t),e[t.name]=!0}function JP(r,e){return new Map([...r||new Map,...e||new Map])}class W1{constructor(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:new Map;ye(this,"name",void 0),ye(this,"type",void 0),ye(this,"nullable",void 0),ye(this,"metadata",void 0),this.name=e,this.type=t,this.nullable=i,this.metadata=n}get typeId(){return this.type&&this.type.typeId}clone(){return new W1(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let Eo=function(r){return r[r.NONE=0]="NONE",r[r.Null=1]="Null",r[r.Int=2]="Int",r[r.Float=3]="Float",r[r.Binary=4]="Binary",r[r.Utf8=5]="Utf8",r[r.Bool=6]="Bool",r[r.Decimal=7]="Decimal",r[r.Date=8]="Date",r[r.Time=9]="Time",r[r.Timestamp=10]="Timestamp",r[r.Interval=11]="Interval",r[r.List=12]="List",r[r.Struct=13]="Struct",r[r.Union=14]="Union",r[r.FixedSizeBinary=15]="FixedSizeBinary",r[r.FixedSizeList=16]="FixedSizeList",r[r.Map=17]="Map",r[r.Dictionary=-1]="Dictionary",r[r.Int8=-2]="Int8",r[r.Int16=-3]="Int16",r[r.Int32=-4]="Int32",r[r.Int64=-5]="Int64",r[r.Uint8=-6]="Uint8",r[r.Uint16=-7]="Uint16",r[r.Uint32=-8]="Uint32",r[r.Uint64=-9]="Uint64",r[r.Float16=-10]="Float16",r[r.Float32=-11]="Float32",r[r.Float64=-12]="Float64",r[r.DateDay=-13]="DateDay",r[r.DateMillisecond=-14]="DateMillisecond",r[r.TimestampSecond=-15]="TimestampSecond",r[r.TimestampMillisecond=-16]="TimestampMillisecond",r[r.TimestampMicrosecond=-17]="TimestampMicrosecond",r[r.TimestampNanosecond=-18]="TimestampNanosecond",r[r.TimeSecond=-19]="TimeSecond",r[r.TimeMillisecond=-20]="TimeMillisecond",r[r.TimeMicrosecond=-21]="TimeMicrosecond",r[r.TimeNanosecond=-22]="TimeNanosecond",r[r.DenseUnion=-23]="DenseUnion",r[r.SparseUnion=-24]="SparseUnion",r[r.IntervalDayTime=-25]="IntervalDayTime",r[r.IntervalYearMonth=-26]="IntervalYearMonth",r}({}),YP,eF,tF;class jB{static isNull(e){return e&&e.typeId===Eo.Null}static isInt(e){return e&&e.typeId===Eo.Int}static isFloat(e){return e&&e.typeId===Eo.Float}static isBinary(e){return e&&e.typeId===Eo.Binary}static isUtf8(e){return e&&e.typeId===Eo.Utf8}static isBool(e){return e&&e.typeId===Eo.Bool}static isDecimal(e){return e&&e.typeId===Eo.Decimal}static isDate(e){return e&&e.typeId===Eo.Date}static isTime(e){return e&&e.typeId===Eo.Time}static isTimestamp(e){return e&&e.typeId===Eo.Timestamp}static isInterval(e){return e&&e.typeId===Eo.Interval}static isList(e){return e&&e.typeId===Eo.List}static isStruct(e){return e&&e.typeId===Eo.Struct}static isUnion(e){return e&&e.typeId===Eo.Union}static isFixedSizeBinary(e){return e&&e.typeId===Eo.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===Eo.FixedSizeList}static isMap(e){return e&&e.typeId===Eo.Map}static isDictionary(e){return e&&e.typeId===Eo.Dictionary}get typeId(){return Eo.NONE}compareTo(e){return this===e}}YP=Symbol.toStringTag;class xg extends jB{constructor(e,t){super(),ye(this,"isSigned",void 0),ye(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=t}get typeId(){return Eo.Int}get[YP](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class dJ extends xg{constructor(){super(!0,8)}}class fJ extends xg{constructor(){super(!0,16)}}class pJ extends xg{constructor(){super(!0,32)}}class gJ extends xg{constructor(){super(!1,8)}}class mJ extends xg{constructor(){super(!1,16)}}class yJ extends xg{constructor(){super(!1,32)}}const rF={HALF:16,SINGLE:32,DOUBLE:64};eF=Symbol.toStringTag;class iF extends jB{constructor(e){super(),ye(this,"precision",void 0),this.precision=e}get typeId(){return Eo.Float}get[eF](){return"Float"}toString(){return"Float".concat(this.precision)}}class _J extends iF{constructor(){super(rF.SINGLE)}}class vJ extends iF{constructor(){super(rF.DOUBLE)}}tF=Symbol.toStringTag;class bJ extends jB{constructor(e,t){super(),ye(this,"listSize",void 0),ye(this,"children",void 0),this.listSize=e,this.children=[t]}get typeId(){return Eo.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[tF](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function xJ(r){switch(r.constructor){case Int8Array:return new dJ;case Uint8Array:return new gJ;case Int16Array:return new fJ;case Uint16Array:return new mJ;case Int32Array:return new pJ;case Uint32Array:return new yJ;case Float32Array:return new _J;case Float64Array:return new vJ;default:throw new Error("array type not supported")}}function wJ(r,e,t){const i=xJ(e.value),n=t||BJ(e);return new W1(r,new bJ(e.size,new W1("value",i)),!1,n)}function BJ(r){const e=new Map;return"byteOffset"in r&&e.set("byteOffset",r.byteOffset.toString(10)),"byteStride"in r&&e.set("byteStride",r.byteStride.toString(10)),"normalized"in r&&e.set("normalized",r.normalized.toString()),e}function nF(r,e){(r.COLOR_0||r.colors)&&e||(r.colors={constant:!0,value:new Float32Array([1,1,1])}),On.assert(r.positions||r.POSITION,'no "postions" or "POSITION" attribute in mesh')}function sF(r,e){if(r.attributes)return nF(r.attributes,e),r instanceof Ty?r:new Ty(r);if(r.positions||r.POSITION)return nF(r,e),new Ty({attributes:r});throw Error("Invalid mesh")}const CJ={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class qB extends vg{constructor(){super(...arguments),ye(this,"state",void 0)}getShaders(){const e=!dn(this.context.gl),t={};return S2(this.context.gl,Hs.GLSL_DERIVATIVES)&&(t.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:cJ,fs:uJ,modules:[mB,y$,yB],transpileToGLSL100:e,defines:t})}getBounds(){var e;if(this.props._instanced)return super.getBounds();let t=this.state.positionBounds;if(t)return t;const{mesh:i}=this.props;if(!i)return null;if(t=(e=i.header)===null||e===void 0?void 0:e.boundingBox,!t){const{attributes:n}=sF(i,this.props._useMeshColors);n.POSITION=n.POSITION||n.positions,t=ZP(n)}return this.state.positionBounds=t,t}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:WP}),this.setState({emptyTexture:new iu(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:t,oldProps:i,changeFlags:n}=e;if(t.mesh!==i.mesh||n.extensionsChanged){var o;if(this.state.positionBounds=null,(o=this.state.model)===null||o===void 0||o.delete(),t.mesh){this.state.model=this.getModel(t.mesh);const a=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(a.NORMAL||a.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==i.texture&&this.setTexture(t.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw(e){let{uniforms:t}=e;if(!this.state.model)return;const{viewport:i}=this.context,{sizeScale:n,coordinateSystem:o,_instanced:a}=this.props;this.state.model.setUniforms(t).setUniforms({sizeScale:n,composeModelMatrix:!a||XP(i,o),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var e;return((e=this.state)===null||e===void 0?void 0:e.model)&&super.isLoaded}getModel(e){const t=new ug(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:sF(e,this.props._useMeshColors),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:n}=this.state;return t.setUniforms({sampler:i||n,hasTexture:!!i}),t}setTexture(e){const{emptyTexture:t,model:i}=this.state;i&&i.setUniforms({sampler:e||t,hasTexture:!!e})}}ye(qB,"defaultProps",CJ),ye(qB,"layerName","SimpleMeshLayer");class wg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:t}=e;this.id=t||IA(this.constructor.name),this.display=!0,this.position=new Ut,this.rotation=new Ut,this.scale=new Ut(1,1,1),this.matrix=new Sn,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return"{type: ScenegraphNode, id: ".concat(this.id,")}")}getBounds(){return null}setPosition(e){return Jr(e.length===3,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return Jr(e.length===3,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return Jr(e.length===3,"setScale requires vector argument"),this.scale=e,this}setMatrix(e){(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0)?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:t,rotation:i,scale:n,update:o=!0}=e;return t&&this.setPosition(t),i&&this.setRotation(i),n&&this.setScale(n),o&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(i),this}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{position:t,rotation:i,scale:n}=e;return t&&this.setPosition(t),i&&this.setRotation(i),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(e,t){Jr(e),t=t||this.matrix;const i=new Sn(e).multiplyRight(t),n=i.invert(),o=n.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:i,worldInverseMatrix:n,worldInverseTransposeMatrix:o}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class zy extends wg{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e=Array.isArray(e)?{children:e}:e;const{children:t=[]}=e;Ai.assert(t.every(i=>i instanceof wg),"every child must an instance of ScenegraphNode"),super(e),this.children=t}add(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(const n of t)Array.isArray(n)?this.add(...n):this.children.push(n);return this}remove(e){const t=this.children,i=t.indexOf(e);return i>-1&&t.splice(i,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}getBounds(){const e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((t,i)=>{let{worldMatrix:n}=i;const o=t.getBounds();if(!o)return;const[a,s]=o,g=new Ut(a).add(s).divide([2,2,2]);n.transformAsPoint(g,g);const y=new Ut(s).subtract(a).divide([2,2,2]);n.transformAsVector(y,y);for(let T=0;T<8;T++){const I=new Ut(T&1?-1:1,T&2?-1:1,T&4?-1:1).multiply(y).add(g);for(let R=0;R<3;R++)e[0][R]=Math.min(e[0][R],I[R]),e[1][R]=Math.max(e[1][R],I[R])}}),Number.isFinite(e[0][0])?e:null}traverse(e){let{worldMatrix:t=new Sn}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new Sn(t).multiplyRight(this.matrix);for(const n of this.children)n instanceof zy?n.traverse(e,{worldMatrix:i}):e(n,{worldMatrix:i})}}const EJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},SJ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function oF(r){if(!r._animation){const e=SJ[r.componentType],t=EJ[r.type],i=t*r.count,{buffer:n,byteOffset:o}=r.bufferView.data,a=new e(n,o+(r.byteOffset||0),i);if(t===1)r._animation=Array.from(a);else{const s=[];for(let g=0;g<a.length;g+=t)s.push(Array.from(a.slice(g,g+t)));r._animation=s}}return r._animation}const TJ=new Sn;function IJ(r,e){if(e.matrix.identity(),r.translation&&e.matrix.translate(r.translation),r.rotation){const t=TJ.fromQuaternion(r.rotation);e.matrix.multiplyRight(t)}r.scale&&e.matrix.scale(r.scale)}const $B=new Cy;function LJ(r,e,t,i,n){if(e==="rotation"){$B.slerp({start:t,target:i,ratio:n});for(let o=0;o<$B.length;o++)r[e][o]=$B[o]}else for(let o=0;o<t.length;o++)r[e][o]=n*i[o]+(1-n)*t[o]}function MJ(r,e,t){let{p0:i,outTangent0:n,inTangent1:o,p1:a,tDiff:s,ratio:g}=t;for(let y=0;y<r[e].length;y++){const T=n[y]*s,I=o[y]*s;r[e][y]=(2*Math.pow(g,3)-3*Math.pow(g,2)+1)*i[y]+(Math.pow(g,3)-2*Math.pow(g,2)+g)*T+(-2*Math.pow(g,3)+3*Math.pow(g,2))*a[y]+(Math.pow(g,3)-Math.pow(g,2))*I}}function PJ(r,e,t){for(let i=0;i<t.length;i++)r[e][i]=t[i]}function FJ(r,e,t,i){let{input:n,interpolation:o,output:a}=e;const s=n[n.length-1],g=r%s,y=n.findIndex(U=>U>=g),T=Math.max(0,y-1);if(!Array.isArray(t[i]))switch(i){case"translation":t[i]=[0,0,0];break;case"rotation":t[i]=[0,0,0,1];break;case"scale":t[i]=[1,1,1];break;default:Ai.warn("Bad animation path ".concat(i))()}Jr(t[i].length===a[T].length);const I=n[T],R=n[y];switch(o){case"STEP":PJ(t,i,a[T]);break;case"LINEAR":if(R>I){const U=(g-I)/(R-I);LJ(t,i,a[T],a[y],U)}break;case"CUBICSPLINE":if(R>I){const U=(g-I)/(R-I),Z=R-I,Y=a[3*T+1],he=a[3*T+2],ce=a[3*y+0],pe=a[3*y+1];MJ(t,i,{p0:Y,outTangent0:he,inTangent1:ce,p1:pe,tDiff:Z,ratio:U})}break;default:Ai.warn("Interpolation ".concat(o," not supported"))();break}}class DJ{constructor(e){this.startTime=0,this.playing=!0,this.speed=1,this.channels=[],Object.assign(this,e)}animate(e){if(!this.playing)return;const i=(e/1e3-this.startTime)*this.speed;this.channels.forEach(n=>{let{sampler:o,target:a,path:s}=n;FJ(i,o,a,s),IJ(a,a._node)})}}class RJ{constructor(e){this.animations=e.animations.map((t,i)=>{const n=t.name||"Animation-".concat(i),o=t.samplers.map(s=>{let{input:g,interpolation:y="LINEAR",output:T}=s;return{input:oF(e.accessors[g]),interpolation:y,output:oF(e.accessors[T])}}),a=t.channels.map(s=>{let{sampler:g,target:y}=s;return{sampler:o[g],target:e.nodes[y.node],path:y.path}});return new DJ({name:n,channels:a})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}class kJ extends wg{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t),this.onBeforeRender=null,this.AfterRender=null,e instanceof ug?(this.model=e,this._setModelNodeProps(t)):this.model=new ug(e,t),this.bounds=null,this.managedResources=t.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}getBounds(){return this.bounds}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(){return this.model.draw(...arguments)}setUniforms(){return this.model.setUniforms(...arguments),this}setAttributes(){return this.model.setAttributes(...arguments),this}updateModuleSettings(){return this.model.updateModuleSettings(...arguments),this}_setModelNodeProps(e){this.model.setProps(e)}}class aF{constructor(e,t){let{attributes:i,material:n,pbrDebug:o,imageBasedLightingEnvironment:a,lights:s,useTangents:g}=t;this.gl=e,this.defines={MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},S2(e,Hs.GLSL_TEXTURE_LOD)&&(this.defines.USE_TEX_LOD=1),this.uniforms={u_Camera:[0,0,0],u_MetallicRoughnessValues:[1,1]},this.parameters={},this.generatedTextures=[],a&&(this.uniforms.u_DiffuseEnvSampler=a.getDiffuseEnvSampler(),this.uniforms.u_SpecularEnvSampler=a.getSpecularEnvSampler(),this.uniforms.u_brdfLUT=a.getBrdfTexture(),this.uniforms.u_ScaleIBLAmbient=[1,1]),o&&(this.uniforms.u_ScaleDiffBaseMR=[0,0,0,0],this.uniforms.u_ScaleFGDSpec=[0,0,0,0]),this.defineIfPresent(i.NORMAL,"HAS_NORMALS"),this.defineIfPresent(i.TANGENT&&g,"HAS_TANGENTS"),this.defineIfPresent(i.TEXCOORD_0,"HAS_UV"),this.defineIfPresent(a,"USE_IBL"),this.defineIfPresent(s,"USE_LIGHTS"),this.defineIfPresent(o,"PBR_DEBUG"),n&&this.parseMaterial(n)}defineIfPresent(e,t){e&&(this.defines[t]=1)}parseTexture(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;const n=e.texture&&e.texture.sampler&&e.texture.sampler.parameters||{},o=e.texture.source.image;let a,s={};o.compressed?(a=o,s={[this.gl.TEXTURE_MIN_FILTER]:o.data.length>1?this.gl.LINEAR_MIPMAP_NEAREST:this.gl.LINEAR}):a={data:o};const g=new iu(this.gl,{id:e.name||e.id,parameters:{...n,...s},pixelStore:{[this.gl.UNPACK_FLIP_Y_WEBGL]:!1},...a});this.uniforms[t]=g,this.defineIfPresent(i,i),this.generatedTextures.push(g)}parsePbrMetallicRoughness(e){e.baseColorTexture&&this.parseTexture(e.baseColorTexture,"u_BaseColorSampler","HAS_BASECOLORMAP"),this.uniforms.u_BaseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&this.parseTexture(e.metallicRoughnessTexture,"u_MetallicRoughnessSampler","HAS_METALROUGHNESSMAP");const{metallicFactor:t=1,roughnessFactor:i=1}=e;this.uniforms.u_MetallicRoughnessValues=[t,i]}parseMaterial(e){if(this.uniforms.pbr_uUnlit=!!e.unlit,e.pbrMetallicRoughness&&this.parsePbrMetallicRoughness(e.pbrMetallicRoughness),e.normalTexture){this.parseTexture(e.normalTexture,"u_NormalSampler","HAS_NORMALMAP");const{scale:t=1}=e.normalTexture;this.uniforms.u_NormalScale=t}if(e.occlusionTexture){this.parseTexture(e.occlusionTexture,"u_OcclusionSampler","HAS_OCCLUSIONMAP");const{strength:t=1}=e.occlusionTexture;this.uniforms.u_OcclusionStrength=t}if(e.emissiveTexture&&(this.parseTexture(e.emissiveTexture,"u_EmissiveSampler","HAS_EMISSIVEMAP"),this.uniforms.u_EmissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode==="MASK"){const{alphaCutoff:t=.5}=e;this.defines.ALPHA_CUTOFF=1,this.uniforms.u_AlphaCutoff=t}else e.alphaMode==="BLEND"&&(Ai.warn("BLEND alphaMode might not work well because it requires mesh sorting")(),Object.assign(this.parameters,{blend:!0,blendEquation:this.gl.FUNC_ADD,blendFunc:[this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA]}))}delete(){this.generatedTextures.forEach(e=>e.delete())}}const OJ=`
#if (__VERSION__ < 300)
  #define _attr attribute
#else
  #define _attr in
#endif

  _attr vec4 POSITION;

  #ifdef HAS_NORMALS
    _attr vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    _attr vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    _attr vec2 TEXCOORD_0;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = NORMAL;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = TEXCOORD_0;
    #endif

    pbr_setPositionNormalTangentUV(POSITION, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * POSITION;
  }
`,UJ=`
#if (__VERSION__ < 300)
  #define fragmentColor gl_FragColor
#else
  out vec4 fragmentColor;
#endif

  void main(void) {
    fragmentColor = pbr_filterColor(vec4(0));
  }
`;function lF(r,e){return dn(r)?`#version 300 es
`.concat(e):e}function NJ(r,e){const{id:t,drawMode:i,vertexCount:n,attributes:o,modelOptions:a}=e,s=new aF(r,e);Ai.info(4,"createGLTFModel defines: ",s.defines)();const g=[];g.push(...s.generatedTextures),g.push(...Object.values(o).map(T=>T.buffer));const y=new kJ(r,{id:t,drawMode:i,vertexCount:n,modules:[iB],parameters:s.parameters,vs:lF(r,OJ),fs:lF(r,UJ),managedResources:g,...a,defines:{...s.defines,...a.defines}});return y.setProps({attributes:o}),y.setUniforms(s.uniforms),y}const zJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},QJ={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class VJ{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.options=Object.assign({},QJ,t)}instantiate(e){return this.gltf=e,(e.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new RJ(this.gltf):null}createScene(e){const i=(e.nodes||[]).map(o=>this.createNode(o));return new zy({id:e.name||e.id,children:i})}createNode(e){if(!e._node){const i=(e.children||[]).map(o=>this.createNode(o));e.mesh&&i.push(this.createMesh(e.mesh));const n=new zy({id:e.name||e.id,children:i});if(e.matrix)n.setMatrix(e.matrix);else{if(n.matrix.identity(),e.translation&&n.matrix.translate(e.translation),e.rotation){const o=new Sn().fromQuaternion(e.rotation);n.matrix.multiplyRight(o)}e.scale&&n.matrix.scale(e.scale)}e._node=n}return e._node}createMesh(e){if(!e._mesh){const i=(e.primitives||[]).map((o,a)=>this.createPrimitive(o,a,e)),n=new zy({id:e.name||e.id,children:i});e._mesh=n}return e._mesh}getVertexCount(e){Ai.warn("getVertexCount() not found")()}createPrimitive(e,t,i){const n=NJ(this.gl,Object.assign({id:e.name||"".concat(i.name||i.id,"-primitive-").concat(t),drawMode:e.mode||4,vertexCount:e.indices?e.indices.count:this.getVertexCount(e.attributes),attributes:this.createAttributes(e.attributes,e.indices),material:e.material},this.options));return n.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],n}createAttributes(e,t){const i={};return Object.keys(e).forEach(n=>{i[n]=this.createAccessor(e[n],this.createBuffer(e[n],this.gl.ARRAY_BUFFER))}),t&&(i.indices=this.createAccessor(t,this.createBuffer(t,this.gl.ELEMENT_ARRAY_BUFFER))),Ai.info(4,"glTF Attributes",{attributes:e,indices:t,generated:i})(),i}createBuffer(e,t){e.bufferView||(e.bufferView={});const{bufferView:i}=e;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[t]||(i.lumaBuffers[t]=new ws(this.gl,{id:"from-".concat(i.id),data:i.data||e.value,target:t})),i.lumaBuffers[t]}createAccessor(e,t){return new Dc({buffer:t,offset:e.byteOffset||0,stride:e.bufferView.byteStride||0,type:e.componentType,size:zJ[e.type]})}createSampler(e){return e}needsPOT(){return!1}}function HJ(r,e,t){const i=new VJ(r,t),n=i.instantiate(e),o=i.createAnimator();return{scenes:n,animator:o}}const GJ="3.4.14",jJ="3.4.14",cF="3.4.14",qJ="https://unpkg.com/@loaders.gl/textures@".concat(cF,"/dist/libs/basis_encoder.wasm"),$J="https://unpkg.com/@loaders.gl/textures@".concat(cF,"/dist/libs/basis_encoder.js");let KB;async function uF(r){const e=r.modules||{};return e.basis?e.basis:(KB=KB||KJ(r),await KB)}async function KJ(r){let e=null,t=null;return[e,t]=await Promise.all([await bf("basis_transcoder.js","textures",r),await bf("basis_transcoder.wasm","textures",r)]),e=e||globalThis.BASIS,await WJ(e,t)}function WJ(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(i=>{r(t).then(n=>{const{BasisFile:o,initializeBasis:a}=n;a(),i({BasisFile:o})})})}let WB;async function hF(r){const e=r.modules||{};return e.basisEncoder?e.basisEncoder:(WB=WB||XJ(r),await WB)}async function XJ(r){let e=null,t=null;return[e,t]=await Promise.all([await bf($J,"textures",r),await bf(qJ,"textures",r)]),e=e||globalThis.BASIS,await ZJ(e,t)}function ZJ(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(i=>{r(t).then(n=>{const{BasisFile:o,KTX2File:a,initializeBasis:s,BasisEncoder:g}=n;s(),i({BasisFile:o,KTX2File:a,BasisEncoder:g})})})}const Bg={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},JJ=["","WEBKIT_","MOZ_"],AF={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let X1=null;function YJ(r){if(!X1){r=r||eY()||void 0,X1=new Set;for(const e of JJ)for(const t in AF)if(r&&r.getExtension("".concat(e).concat(t))){const i=AF[t];X1.add(i)}}return X1}function eY(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var dF,fF,pF,gF,mF,yF,_F,vF;(function(r){r[r.NONE=0]="NONE",r[r.BASISLZ=1]="BASISLZ",r[r.ZSTD=2]="ZSTD",r[r.ZLIB=3]="ZLIB"})(dF||(dF={})),function(r){r[r.BASICFORMAT=0]="BASICFORMAT"}(fF||(fF={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.ETC1S=163]="ETC1S",r[r.UASTC=166]="UASTC"}(pF||(pF={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.SRGB=1]="SRGB"}(gF||(gF={})),function(r){r[r.UNSPECIFIED=0]="UNSPECIFIED",r[r.LINEAR=1]="LINEAR",r[r.SRGB=2]="SRGB",r[r.ITU=3]="ITU",r[r.NTSC=4]="NTSC",r[r.SLOG=5]="SLOG",r[r.SLOG2=6]="SLOG2"}(mF||(mF={})),function(r){r[r.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",r[r.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(yF||(yF={})),function(r){r[r.RGB=0]="RGB",r[r.RRR=3]="RRR",r[r.GGG=4]="GGG",r[r.AAA=15]="AAA"}(_F||(_F={})),function(r){r[r.RGB=0]="RGB",r[r.RGBA=3]="RGBA",r[r.RRR=4]="RRR",r[r.RRRG=5]="RRRG"}(vF||(vF={}));const lu=[171,75,84,88,32,50,48,187,13,10,26,10];function tY(r){const e=new Uint8Array(r);return!(e.byteLength<lu.length||e[0]!==lu[0]||e[1]!==lu[1]||e[2]!==lu[2]||e[3]!==lu[3]||e[4]!==lu[4]||e[5]!==lu[5]||e[6]!==lu[6]||e[7]!==lu[7]||e[8]!==lu[8]||e[9]!==lu[9]||e[10]!==lu[10]||e[11]!==lu[11])}const rY={etc1:{basisFormat:0,compressed:!0,format:Bg.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Bg.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Bg.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Bg.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Bg.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Bg.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function iY(r,e){if(e.basis.containerFormat==="auto"){if(tY(r)){const i=await hF(e);return bF(i.KTX2File,r,e)}const{BasisFile:t}=await uF(e);return XB(t,r,e)}switch(e.basis.module){case"encoder":const t=await hF(e);switch(e.basis.containerFormat){case"ktx2":return bF(t.KTX2File,r,e);case"basis":default:return XB(t.BasisFile,r,e)}case"transcoder":default:const{BasisFile:i}=await uF(e);return XB(i,r,e)}}function XB(r,e,t){const i=new r(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const n=i.getNumImages(),o=[];for(let a=0;a<n;a++){const s=i.getNumLevels(a),g=[];for(let y=0;y<s;y++)g.push(nY(i,a,y,t));o.push(g)}return o}finally{i.close(),i.delete()}}function nY(r,e,t,i){const n=r.getImageWidth(e,t),o=r.getImageHeight(e,t),a=r.getHasAlpha(),{compressed:s,format:g,basisFormat:y}=xF(i,a),T=r.getImageTranscodedSizeInBytes(e,t,y),I=new Uint8Array(T);if(!r.transcodeImage(I,e,t,y,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:o,data:I,compressed:s,format:g,hasAlpha:a}}function bF(r,e,t){const i=new r(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const n=i.getLevels(),o=[];for(let a=0;a<n;a++){o.push(sY(i,a,t));break}return[o]}finally{i.close(),i.delete()}}function sY(r,e,t){const{alphaFlag:i,height:n,width:o}=r.getImageLevelInfo(e,0,0),{compressed:a,format:s,basisFormat:g}=xF(t,i),y=r.getImageTranscodedSizeInBytes(e,0,0,g),T=new Uint8Array(y);if(!r.transcodeImage(T,e,0,0,g,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:n,data:T,compressed:a,levelSize:y,hasAlpha:i,format:s}}function xF(r,e){let t=r&&r.basis&&r.basis.format;return t==="auto"&&(t=wF()),typeof t=="object"&&(t=e?t.alpha:t.noAlpha),t=t.toLowerCase(),rY[t]}function wF(){const r=YJ();return r.has("astc")?"astc-4x4":r.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:r.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:r.has("etc1")?"etc1":r.has("etc2")?"etc2":"rgb565"}const oY={...{name:"Basis",id:CA?"basis":"basis-nodejs",module:"textures",version:jJ,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:iY};function cu(r,e){if(!r)throw new Error(e||"assert failed: gltf")}function BF(r,e){if(r.startsWith("data:")||r.startsWith("http:")||r.startsWith("https:"))return r;const i=e.baseUri||e.uri;if(!i)throw new Error("'baseUri' must be provided to resolve relative url ".concat(r));return i.substr(0,i.lastIndexOf("/")+1)+r}function aY(r,e,t){const i=r.bufferViews[t];cu(i);const n=i.buffer,o=e[n];cu(o);const a=(i.byteOffset||0)+o.byteOffset;return new Uint8Array(o.arrayBuffer,a,i.byteLength)}const CF=["SCALAR","VEC2","VEC3","VEC4"],lY=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],cY=new Map(lY),uY={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hY={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},AY={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function EF(r){return CF[r-1]||CF[0]}function SF(r){const e=cY.get(r.constructor);if(!e)throw new Error("Illegal typed array");return e}function ZB(r,e){const t=AY[r.componentType],i=uY[r.type],n=hY[r.componentType],o=r.count*i,a=r.count*i*n;return cu(a>=0&&a<=e.byteLength),{ArrayType:t,length:o,byteLength:a}}function TF(r){let{images:e,bufferViews:t}=r;e=e||[],t=t||[];const i=e.map(a=>a.bufferView);t=t.filter(a=>!i.includes(a));const n=t.reduce((a,s)=>a+s.byteLength,0),o=e.reduce((a,s)=>{const{width:g,height:y}=s.image;return a+g*y},0);return n+Math.ceil(4*o*1.33)}const dY={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class Rc{constructor(e){ye(this,"gltf",void 0),ye(this,"sourceBuffers",void 0),ye(this,"byteLength",void 0),this.gltf=e||{json:{...dY},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const t=this.getUsedExtensions().find(n=>n===e),i=this.json.extensions||{};return t?i[e]||!0:null}getRequiredExtension(e){return this.getRequiredExtensions().find(i=>i===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const i=this.json[e]&&this.json[e][t];if(!i)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,i=this.gltf.buffers[t];cu(i);const n=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,{ArrayType:o,length:a}=ZB(e,t),s=t.byteOffset+e.byteOffset;return new o(n,s,a)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,o=t.byteOffset||0;return new Uint8Array(n,o,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,i){return e.extensions=e.extensions||{},e.extensions[t]=i,this.registerUsedExtension(t),this}setObjectExtension(e,t,i){const n=e.extensions||{};n[t]=i}removeObjectExtension(e,t){const i=e.extensions||{},n=i[t];return delete i[t],n}addExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return cu(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return cu(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(!this.getExtension(e))return;this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e],Array.isArray(this.json.extensionsRemoved)||(this.json.extensionsRemoved=[]);const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:i}=e;this.json.nodes=this.json.nodes||[];const n={mesh:t};return i&&(n.matrix=i),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:i,material:n,mode:o=4}=e,s={primitives:[{attributes:this._addAttributes(t),mode:o}]};if(i){const g=this._addIndices(i);s.primitives[0].indices=g}return Number.isFinite(n)&&(s.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){const i={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(e,t){const i=s2(e),n=t||(i==null?void 0:i.mimeType),a={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(a),this.json.images.length-1}addBufferView(e){const t=e.byteLength;cu(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const i={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=iy(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(e,t){const i={bufferView:e,type:EF(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const i=this.addBufferView(e);let n={min:t.min,max:t.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,t.size));const o={size:t.size,componentType:SF(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(i,Object.assign(o,t))}addTexture(e){const{imageIndex:t}=e,i={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];const i=this.byteLength,n=new ArrayBuffer(i),o=new Uint8Array(n);let a=0;for(const s of this.sourceBuffers||[])a=UQ(s,o,a);(e=this.json)!==null&&e!==void 0&&(t=e.buffers)!==null&&t!==void 0&&t[0]?this.json.buffers[0].byteLength=i:this.json.buffers=[{byteLength:i}],this.gltf.binary=n,this.sourceBuffers=[n]}_removeStringFromArray(e,t){let i=!0;for(;i;){const n=e.indexOf(t);n>-1?e.splice(n,1):i=!1}}_addAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={};for(const i in e){const n=e[i],o=this._getGltfAttributeName(i),a=this.addBinaryBuffer(n.value,n);t[o]=a}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const i={min:null,max:null};if(e.length<t)return i;i.min=[],i.max=[];const n=e.subarray(0,t);for(const o of n)i.min.push(o),i.max.push(o);for(let o=t;o<e.length;o+=t)for(let a=0;a<t;a++)i.min[0+a]=Math.min(i.min[0+a],e[o+a]),i.max[0+a]=Math.max(i.max[0+a],e[o+a]);return i}}const fY="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",pY="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",gY=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),mY=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),yY={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},_Y={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function vY(r,e,t,i,n){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const a=await bY();BY(a,a.exports[_Y[n]],r,e,t,i,a.exports[yY[o||"NONE"]])}let JB;async function bY(){return JB||(JB=xY()),JB}async function xY(){let r=fY;WebAssembly.validate(gY)&&(r=pY,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const e=await WebAssembly.instantiate(wY(r),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function wY(r){const e=new Uint8Array(r.length);for(let i=0;i<r.length;++i){const n=r.charCodeAt(i);e[i]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let t=0;for(let i=0;i<r.length;++i)e[t++]=e[i]<60?mY[e[i]]:(e[i]-60)*64+e[++i];return e.buffer.slice(0,t)}function BY(r,e,t,i,n,o,a){const s=r.exports.sbrk,g=i+3&-4,y=s(g*n),T=s(o.length),I=new Uint8Array(r.exports.memory.buffer);I.set(o,T);const R=e(y,i,n,T,o.length);if(R===0&&a&&a(y,g,n),t.set(I.subarray(y,y+i*n)),s(y-s(0)),R!==0)throw new Error("Malformed buffer data: ".concat(R))}const YB="EXT_meshopt_compression",CY=YB;async function EY(r,e){var t;const i=new Rc(r);if(!(e!=null&&(t=e.gltf)!==null&&t!==void 0&&t.decompressMeshes))return;const n=[];for(const o of r.json.bufferViews||[])n.push(SY(i,o));await Promise.all(n),i.removeExtension(YB)}async function SY(r,e){const t=r.getObjectExtension(e,YB);if(t){const{byteOffset:i=0,byteLength:n=0,byteStride:o,count:a,mode:s,filter:g="NONE",buffer:y}=t,T=r.gltf.buffers[y],I=new Uint8Array(T.arrayBuffer,T.byteOffset+i,n),R=new Uint8Array(r.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);return await vY(R,a,o,I,s,g),R}return null}const TY=Object.freeze(Object.defineProperty({__proto__:null,decode:EY,name:CY},Symbol.toStringTag,{value:"Module"})),Cg="EXT_texture_webp",IY=Cg;function LY(r,e){const t=new Rc(r);if(!DH("image/webp")){if(t.getRequiredExtensions().includes(Cg))throw new Error("gltf: Required extension ".concat(Cg," not supported by browser"));return}const{json:i}=t;for(const n of i.textures||[]){const o=t.getObjectExtension(n,Cg);o&&(n.source=o.source),t.removeObjectExtension(n,Cg)}t.removeExtension(Cg)}const MY=Object.freeze(Object.defineProperty({__proto__:null,name:IY,preprocess:LY},Symbol.toStringTag,{value:"Module"})),Z1="KHR_texture_basisu",PY=Z1;function FY(r,e){const t=new Rc(r),{json:i}=t;for(const n of i.textures||[]){const o=t.getObjectExtension(n,Z1);o&&(n.source=o.source),t.removeObjectExtension(n,Z1)}t.removeExtension(Z1)}const DY=Object.freeze(Object.defineProperty({__proto__:null,name:PY,preprocess:FY},Symbol.toStringTag,{value:"Module"})),RY={name:"Draco",id:CA?"draco":"draco-nodejs",module:"draco",shapes:["mesh"],version:"3.4.14",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function kY(r,e,t){const i=LF(e.metadata),n=[],o=OY(e.attributes);for(const a in r){const s=r[a],g=IF(a,s,o[a]);n.push(g)}if(t){const a=IF("indices",t);n.push(a)}return new bg(n,i)}function OY(r){const e={};for(const t in r){const i=r[t];e[i.name||"undefined"]=i}return e}function IF(r,e,t){const i=t?LF(t.metadata):void 0;return wJ(r,e,i)}function LF(r){const e=new Map;for(const t in r)e.set("".concat(t,".string"),JSON.stringify(r[t]));return e}const MF={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},UY={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},NY=4;class zY{constructor(e){ye(this,"draco",void 0),ye(this,"decoder",void 0),ye(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const n=this.decoder.GetEncodedGeometryType(i),o=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let a;switch(n){case this.draco.TRIANGULAR_MESH:a=this.decoder.DecodeBufferToMesh(i,o);break;case this.draco.POINT_CLOUD:a=this.decoder.DecodeBufferToPointCloud(i,o);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!a.ok()||!o.ptr){const R="DRACO decompression failed: ".concat(a.error_msg());throw new Error(R)}const s=this._getDracoLoaderData(o,n,t),g=this._getMeshData(o,s,t),y=ZP(g.attributes),T=kY(g.attributes,s,g.indices);return{loader:"draco",loaderData:s,header:{vertexCount:o.num_points(),boundingBox:y},...g,schema:T}}finally{this.draco.destroy(i),o&&this.draco.destroy(o)}}_getDracoLoaderData(e,t,i){const n=this._getTopLevelMetadata(e),o=this._getDracoAttributes(e,i);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:o}}_getDracoAttributes(e,t){const i={};for(let n=0;n<e.num_attributes();n++){const o=this.decoder.GetAttribute(e,n),a=this._getAttributeMetadata(e,n);i[o.unique_id()]={unique_id:o.unique_id(),attribute_type:o.attribute_type(),data_type:o.data_type(),num_components:o.num_components(),byte_offset:o.byte_offset(),byte_stride:o.byte_stride(),normalized:o.normalized(),attribute_index:n,metadata:a};const s=this._getQuantizationTransform(o,t);s&&(i[o.unique_id()].quantization_transform=s);const g=this._getOctahedronTransform(o,t);g&&(i[o.unique_id()].octahedron_transform=g)}return i}_getMeshData(e,t,i){const n=this._getMeshAttributes(t,e,i);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,t,i){const n={};for(const o of Object.values(e.attributes)){const a=this._deduceAttributeName(o,i);o.name=a;const{value:s,size:g}=this._getAttributeValues(t,o);n[a]={value:s,size:g,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}return n}_getTriangleListIndices(e){const i=e.num_faces()*3,n=i*NY,o=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,o),new Uint32Array(this.draco.HEAPF32.buffer,o,i).slice()}finally{this.draco._free(o)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),HY(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const i=UY[t.data_type],n=t.num_components,a=e.num_points()*n,s=a*i.BYTES_PER_ELEMENT,g=QY(this.draco,i);let y;const T=this.draco._malloc(s);try{const I=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,I,g,s,T),y=new i(this.draco.HEAPF32.buffer,T,a).slice()}finally{this.draco._free(T)}return{value:y,size:n}}_deduceAttributeName(e,t){const i=e.unique_id;for(const[a,s]of Object.entries(t.extraAttributes||{}))if(s===i)return a;const n=e.attribute_type;for(const a in MF)if(this.draco[a]===n)return MF[a];const o=t.attributeNameEntry||"name";return e.metadata[o]?e.metadata[o].string:"CUSTOM_ATTRIBUTE_".concat(i)}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const i=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},i=this.metadataQuerier.NumEntries(e);for(let n=0;n<i;n++){const o=this.metadataQuerier.GetEntryName(e,n);t[o]=this._getDracoMetadataField(e,o)}return t}_getDracoMetadataField(e,t){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,i);const n=VY(i);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:n}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:i=[]}=e,n=[...t,...i];for(const o of n)this.decoder.SkipAttributeTransform(this.draco[o])}_getQuantizationTransform(e,t){const{quantizedAttributes:i=[]}=t,n=e.attribute_type();if(i.map(a=>this.decoder[a]).includes(n)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map(s=>a.min_value(s))}}finally{this.draco.destroy(a)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:i=[]}=t,n=e.attribute_type();if(i.map(a=>this.decoder[a]).includes(n)){const a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}}function QY(r,e){switch(e){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32;default:return r.DT_INVALID}}function VY(r){const e=r.size(),t=new Int32Array(e);for(let i=0;i<e;i++)t[i]=r.GetValue(i);return t}function HY(r){const e=r.size(),t=new Int32Array(e);for(let i=0;i<e;i++)t[i]=r.GetValue(i);return t}const eC="https://www.gstatic.com/draco/versioned/decoders/".concat("1.5.5"),GY="".concat(eC,"/draco_decoder.js"),jY="".concat(eC,"/draco_wasm_wrapper.js"),qY="".concat(eC,"/draco_decoder.wasm");let Qy;async function $Y(r){const e=r.modules||{};return e.draco3d?Qy=Qy||e.draco3d.createDecoderModule({}).then(t=>({draco:t})):Qy=Qy||KY(r),await Qy}async function KY(r){let e,t;switch(r.draco&&r.draco.decoderType){case"js":e=await bf(GY,"draco",r);break;case"wasm":default:[e,t]=await Promise.all([await bf(jY,"draco",r),await bf(qY,"draco",r)])}return e=e||globalThis.DracoDecoderModule,await WY(e,t)}function WY(r,e){const t={};return e&&(t.wasmBinary=e),new Promise(i=>{r({...t,onModuleLoaded:n=>i({draco:n})})})}const PF={...RY,parse:XY};async function XY(r,e){const{draco:t}=await $Y(e),i=new zY(t);try{return i.parseSync(r,e==null?void 0:e.draco)}finally{i.destroy()}}function ZY(r){const e={};for(const t in r){const i=r[t];if(t!=="indices"){const n=FF(i);e[t]=n}}return e}function FF(r){const{buffer:e,size:t,count:i}=JY(r);return{value:e,size:t,byteOffset:0,count:i,type:EF(t),componentType:SF(e)}}function JY(r){let e=r,t=1,i=0;return r&&r.value&&(e=r.value,t=r.size||1),e&&(ArrayBuffer.isView(e)||(e=YY(e,Float32Array)),i=e.length/t),{buffer:e,size:t,count:i}}function YY(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return r?Array.isArray(r)?new e(r):t&&!(r instanceof e)?new e(r):r:null}const Ff="KHR_draco_mesh_compression",eee=Ff;function tee(r,e,t){const i=new Rc(r);for(const n of DF(i))i.getObjectExtension(n,Ff)}async function ree(r,e,t){var i;if(!(e!=null&&(i=e.gltf)!==null&&i!==void 0&&i.decompressMeshes))return;const n=new Rc(r),o=[];for(const a of DF(n))n.getObjectExtension(a,Ff)&&o.push(nee(n,a,e,t));await Promise.all(o),n.removeExtension(Ff)}function iee(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=new Rc(r);for(const i of t.json.meshes||[])see(i,e),t.addRequiredExtension(Ff)}async function nee(r,e,t,i){const n=r.getObjectExtension(e,Ff);if(!n)return;const o=r.getTypedArrayForBufferView(n.bufferView),a=Gw(o.buffer,o.byteOffset),{parse:s}=i,g={...t};delete g["3d-tiles"];const y=await s(a,PF,g,i),T=ZY(y.attributes);for(const[I,R]of Object.entries(T))if(I in e.attributes){const U=e.attributes[I],Z=r.getAccessor(U);Z!=null&&Z.min&&Z!==null&&Z!==void 0&&Z.max&&(R.min=Z.min,R.max=Z.max)}e.attributes=T,y.indices&&(e.indices=FF(y.indices)),oee(e)}function see(r,e){var t;let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,n=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const a=n.DracoWriter.encodeSync({attributes:r}),s=o==null||(t=o.parseSync)===null||t===void 0?void 0:t.call(o,{attributes:r}),g=n._addFauxAttributes(s.attributes),y=n.addBufferView(a);return{primitives:[{attributes:g,mode:i,extensions:{[Ff]:{bufferView:y,attributes:g}}}]}}function oee(r){if(!r.attributes&&Object.keys(r.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*DF(r){for(const e of r.json.meshes||[])for(const t of e.primitives)yield t}const aee=Object.freeze(Object.defineProperty({__proto__:null,decode:ree,encode:iee,name:eee,preprocess:tee},Symbol.toStringTag,{value:"Module"})),lee={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},cee={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},tC="KHR_texture_transform",uee=tC,J1=new Ut,hee=new Co,Aee=new Co;async function dee(r,e){if(!new Rc(r).getExtension(tC))return;const n=r.json.materials||[];for(let o=0;o<n.length;o++)fee(o,r)}function fee(r,e){var t,i,n;const o=[],a=(t=e.json.materials)===null||t===void 0?void 0:t[r],s=a==null||(i=a.pbrMetallicRoughness)===null||i===void 0?void 0:i.baseColorTexture;s&&Vy(e,r,s,o);const g=a==null?void 0:a.emissiveTexture;g&&Vy(e,r,g,o);const y=a==null?void 0:a.normalTexture;y&&Vy(e,r,y,o);const T=a==null?void 0:a.occlusionTexture;T&&Vy(e,r,T,o);const I=a==null||(n=a.pbrMetallicRoughness)===null||n===void 0?void 0:n.metallicRoughnessTexture;I&&Vy(e,r,I,o)}function Vy(r,e,t,i){const n=pee(t,i);if(!n)return;const o=r.json.meshes||[];for(const a of o)for(const s of a.primitives){const g=s.material;Number.isFinite(g)&&e===g&&gee(r,s,n)}}function pee(r,e){var t;const i=(t=r.extensions)===null||t===void 0?void 0:t[tC],{texCoord:n=0}=r,{texCoord:o=n}=i;if(!(e.findIndex(s=>{let[g,y]=s;return g===n&&y===o})!==-1)){const s=_ee(i);return n!==o&&(r.texCoord=o),e.push([n,o]),{originalTexCoord:n,texCoord:o,matrix:s}}return null}function gee(r,e,t){const{originalTexCoord:i,texCoord:n,matrix:o}=t,a=e.attributes["TEXCOORD_".concat(i)];if(Number.isFinite(a)){var s;const y=(s=r.json.accessors)===null||s===void 0?void 0:s[a];if(y&&y.bufferView){var g;const T=(g=r.json.bufferViews)===null||g===void 0?void 0:g[y.bufferView];if(T){const{arrayBuffer:I,byteOffset:R}=r.buffers[T.buffer],U=(R||0)+(y.byteOffset||0)+(T.byteOffset||0),{ArrayType:Z,length:Y}=ZB(y,T),he=cee[y.componentType],ce=lee[y.type],pe=T.byteStride||he*ce,be=new Float32Array(Y);for(let Te=0;Te<y.count;Te++){const qe=new Z(I,U+Te*pe,2);J1.set(qe[0],qe[1],1),J1.transformByMatrix3(o),be.set([J1[0],J1[1]],Te*ce)}i===n?mee(y,T,r.buffers,be):yee(n,y,e,r,be)}}}}function mee(r,e,t,i){r.componentType=5126,t.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),e.buffer=t.length-1,e.byteLength=i.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function yee(r,e,t,i,n){i.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});const o=i.json.bufferViews;if(!o)return;o.push({buffer:i.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});const a=i.json.accessors;a&&(a.push({bufferView:(o==null?void 0:o.length)-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),t.attributes["TEXCOORD_".concat(r)]=a.length-1)}function _ee(r){const{offset:e=[0,0],rotation:t=0,scale:i=[1,1]}=r,n=new Co().set(1,0,0,0,1,0,e[0],e[1],1),o=hee.set(Math.cos(t),Math.sin(t),0,-Math.sin(t),Math.cos(t),0,0,0,1),a=Aee.set(i[0],0,0,0,i[1],0,0,0,1);return n.multiplyRight(o).multiplyRight(a)}const vee=Object.freeze(Object.defineProperty({__proto__:null,decode:dee,name:uee},Symbol.toStringTag,{value:"Module"})),Df="KHR_lights_punctual",bee=Df;async function xee(r){const e=new Rc(r),{json:t}=e,i=e.getExtension(Df);i&&(e.json.lights=i.lights,e.removeExtension(Df));for(const n of t.nodes||[]){const o=e.getObjectExtension(n,Df);o&&(n.light=o.light),e.removeObjectExtension(n,Df)}}async function wee(r){const e=new Rc(r),{json:t}=e;if(t.lights){const i=e.addExtension(Df);cu(!i.lights),i.lights=t.lights,delete t.lights}if(e.json.lights){for(const i of e.json.lights){const n=i.node;e.addObjectExtension(n,Df,i)}delete e.json.lights}}const Bee=Object.freeze(Object.defineProperty({__proto__:null,decode:xee,encode:wee,name:bee},Symbol.toStringTag,{value:"Module"})),Hy="KHR_materials_unlit",Cee=Hy;async function Eee(r){const e=new Rc(r),{json:t}=e;for(const i of t.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),e.removeObjectExtension(i,Hy);e.removeExtension(Hy)}function See(r){const e=new Rc(r),{json:t}=e;if(e.materials)for(const i of t.materials||[])i.unlit&&(delete i.unlit,e.addObjectExtension(i,Hy,{}),e.addExtension(Hy))}const Tee=Object.freeze(Object.defineProperty({__proto__:null,decode:Eee,encode:See,name:Cee},Symbol.toStringTag,{value:"Module"})),Gy="KHR_techniques_webgl",Iee=Gy;async function Lee(r){const e=new Rc(r),{json:t}=e,i=e.getExtension(Gy);if(i){const n=Pee(i,e);for(const o of t.materials||[]){const a=e.getObjectExtension(o,Gy);a&&(o.technique=Object.assign({},a,n[a.technique]),o.technique.values=Fee(o.technique,e)),e.removeObjectExtension(o,Gy)}e.removeExtension(Gy)}}async function Mee(r,e){}function Pee(r,e){const{programs:t=[],shaders:i=[],techniques:n=[]}=r,o=new TextDecoder;return i.forEach(a=>{if(Number.isFinite(a.bufferView))a.code=o.decode(e.getTypedArrayForBufferView(a.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),t.forEach(a=>{a.fragmentShader=i[a.fragmentShader],a.vertexShader=i[a.vertexShader]}),n.forEach(a=>{a.program=t[a.program]}),n}function Fee(r,e){const t=Object.assign({},r.values);return Object.keys(r.uniforms||{}).forEach(i=>{r.uniforms[i].value&&!(i in t)&&(t[i]=r.uniforms[i].value)}),Object.keys(t).forEach(i=>{typeof t[i]=="object"&&t[i].index!==void 0&&(t[i].texture=e.getTexture(t[i].index))}),t}const Dee=Object.freeze(Object.defineProperty({__proto__:null,decode:Lee,encode:Mee,name:Iee},Symbol.toStringTag,{value:"Module"})),RF="EXT_feature_metadata",Ree=RF;async function kee(r){const e=new Rc(r);Oee(e)}function Oee(r){var e;const t=r.getExtension(RF),i=t==null||(e=t.schema)===null||e===void 0?void 0:e.classes,n=t==null?void 0:t.featureTables;if((t==null?void 0:t.featureTextures)&&console.warn('featureTextures is not yet supported in the "EXT_feature_metadata" extension.'),i&&n)for(const a in i){const s=i[a],g=zee(n,a);g&&Uee(r,g,s)}}function Uee(r,e,t){for(const n in t.properties){var i;const o=t.properties[n],a=e==null||(i=e.properties)===null||i===void 0?void 0:i[n],s=e.count;if(a){const g=Nee(r,o,s,a);a.data=g}}}function Nee(r,e,t,i){const n=i.bufferView;let o=r.getTypedArrayForBufferView(n);switch(e.type){case"STRING":{const a=i.stringOffsetBufferView,s=r.getTypedArrayForBufferView(a);o=Qee(o,s,t);break}}return o}function zee(r,e){for(const t in r){const i=r[t];if(i.class===e)return i}return null}function Qee(r,e,t){const i=[],n=new TextDecoder("utf8");let o=0;const a=4;for(let s=0;s<t;s++){const g=e[(s+1)*a]-e[s*a],y=r.subarray(o,g+o),T=n.decode(y);i.push(T),o+=g}return i}const kF=[TY,MY,DY,aee,Bee,Tee,Dee,vee,Object.freeze(Object.defineProperty({__proto__:null,decode:kee,name:Ree},Symbol.toStringTag,{value:"Module"}))];function Vee(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const i=kF.filter(o=>OF(o.name,e));for(const o of i){var n;(n=o.preprocess)===null||n===void 0||n.call(o,r,e,t)}}async function Hee(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;const i=kF.filter(o=>OF(o.name,e));for(const o of i){var n;await((n=o.decode)===null||n===void 0?void 0:n.call(o,r,e,t))}}function OF(r,e){var t;const i=(e==null||(t=e.gltf)===null||t===void 0?void 0:t.excludeExtensions)||{};return!(r in i&&!i[r])}const rC="KHR_binary_glTF";function Gee(r){const e=new Rc(r),{json:t}=e;for(const i of t.images||[]){const n=e.getObjectExtension(i,rC);n&&Object.assign(i,n),e.removeObjectExtension(i,rC)}t.buffers&&t.buffers[0]&&delete t.buffers[0].uri,e.removeExtension(rC)}const UF={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},jee={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class qee{constructor(){ye(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),ye(this,"json",void 0)}normalize(e,t){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn("glTF: Unknown version ".concat(i.asset.version));return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),Gee(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in UF)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const i=e[t];if(!(!i||Array.isArray(i))){e[t]=[];for(const n in i){const o=i[n];o.id=o.id||n;const a=e[t].length;e[t].push(o),this.idToIndexMap[t][n]=a}}}_convertObjectIdsToArrayIndices(e){for(const t in UF)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:i,indices:n,material:o}=t;for(const a in i)i[a]=this._convertIdToIndex(i[a],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),o&&(t.material=this._convertIdToIndex(o,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn("gltf v1: json doesn't contain attribute ".concat(t)),e[t]=[]);for(const i of e[t])for(const n in i){const o=i[n],a=this._convertIdToIndex(o,n);i[n]=a}}_convertIdToIndex(e,t){const i=jee[t];if(i in this.idToIndexMap){const n=this.idToIndexMap[i][e];if(!Number.isFinite(n))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return n}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const o of e.materials){var t,i,n;o.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const a=((t=o.values)===null||t===void 0?void 0:t.tex)||((i=o.values)===null||i===void 0?void 0:i.texture2d_0)||((n=o.values)===null||n===void 0?void 0:n.diffuseTex),s=e.textures.findIndex(g=>g.id===a);s!==-1&&(o.pbrMetallicRoughness.baseColorTexture={index:s})}}}function $ee(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new qee().normalize(r,e)}const Kee={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Wee={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Pu={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Xee={magFilter:Pu.TEXTURE_MAG_FILTER,minFilter:Pu.TEXTURE_MIN_FILTER,wrapS:Pu.TEXTURE_WRAP_S,wrapT:Pu.TEXTURE_WRAP_T},Zee={[Pu.TEXTURE_MAG_FILTER]:Pu.LINEAR,[Pu.TEXTURE_MIN_FILTER]:Pu.NEAREST_MIPMAP_LINEAR,[Pu.TEXTURE_WRAP_S]:Pu.REPEAT,[Pu.TEXTURE_WRAP_T]:Pu.REPEAT};function Jee(r){return Wee[r]}function Yee(r){return Kee[r]}class ete{constructor(){ye(this,"baseUri",""),ye(this,"json",{}),ye(this,"buffers",[]),ye(this,"images",[])}postProcess(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:i,buffers:n=[],images:o=[],baseUri:a=""}=e;return cu(i),this.baseUri=a,this.json=i,this.buffers=n,this.images=o,this._resolveTree(this.json,t),this.json}_resolveTree(e){e.bufferViews&&(e.bufferViews=e.bufferViews.map((t,i)=>this._resolveBufferView(t,i))),e.images&&(e.images=e.images.map((t,i)=>this._resolveImage(t,i))),e.samplers&&(e.samplers=e.samplers.map((t,i)=>this._resolveSampler(t,i))),e.textures&&(e.textures=e.textures.map((t,i)=>this._resolveTexture(t,i))),e.accessors&&(e.accessors=e.accessors.map((t,i)=>this._resolveAccessor(t,i))),e.materials&&(e.materials=e.materials.map((t,i)=>this._resolveMaterial(t,i))),e.meshes&&(e.meshes=e.meshes.map((t,i)=>this._resolveMesh(t,i))),e.nodes&&(e.nodes=e.nodes.map((t,i)=>this._resolveNode(t,i))),e.skins&&(e.skins=e.skins.map((t,i)=>this._resolveSkin(t,i))),e.scenes&&(e.scenes=e.scenes.map((t,i)=>this._resolveScene(t,i))),e.scene!==void 0&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){if(typeof t=="object")return t;const i=this.json[e]&&this.json[e][t];return i||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),i}_resolveScene(e,t){return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map(i=>this.getNode(i)),e}_resolveNode(e,t){return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map(i=>this.getNode(i))),e.mesh!==void 0?e.mesh=this.getMesh(e.mesh):e.meshes!==void 0&&e.meshes.length&&(e.mesh=e.meshes.reduce((i,n)=>{const o=this.getMesh(n);return i.id=o.id,i.primitives=i.primitives.concat(o.primitives),i},{primitives:[]})),e.camera!==void 0&&(e.camera=this.getCamera(e.camera)),e.skin!==void 0&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map(i=>{i={...i};const n=i.attributes;i.attributes={};for(const o in n)i.attributes[o]=this.getAccessor(n[o]);return i.indices!==void 0&&(i.indices=this.getAccessor(i.indices)),i.material!==void 0&&(i.material=this.getMaterial(i.material)),i})),e}_resolveMaterial(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const i=e.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture={...i.baseColorTexture},i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture={...i.metallicRoughnessTexture},i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){if(e.id=e.id||"accessor-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=Jee(e.componentType),e.components=Yee(e.type),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const i=e.bufferView.buffer,{ArrayType:n,byteLength:o}=ZB(e,e.bufferView),a=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+i.byteOffset;let s=i.arrayBuffer.slice(a,a+o);e.bufferView.byteStride&&(s=this._getValueFromInterleavedBuffer(i,a,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new n(s)}return e}_getValueFromInterleavedBuffer(e,t,i,n,o){const a=new Uint8Array(o*n);for(let s=0;s<o;s++){const g=t+s*i;a.set(new Uint8Array(e.arrayBuffer.slice(g,g+n)),s*n)}return a.buffer}_resolveTexture(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):Zee,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||"sampler-".concat(t),e.parameters={};for(const i in e){const n=this._enumSamplerParameter(i);n!==void 0&&(e.parameters[n]=e[i])}return e}_enumSamplerParameter(e){return Xee[e]}_resolveImage(e,t){e.id=e.id||"image-".concat(t),e.bufferView!==void 0&&(e.bufferView=this.getBufferView(e.bufferView));const i=this.images[t];return i&&(e.image=i),e}_resolveBufferView(e,t){const i=e.buffer,n={id:"bufferView-".concat(t),...e,buffer:this.buffers[i]},o=this.buffers[i].arrayBuffer;let a=this.buffers[i].byteOffset||0;return"byteOffset"in e&&(a+=e.byteOffset),n.data=new Uint8Array(o,a,e.byteLength),n}_resolveCamera(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}function tte(r,e){return new ete().postProcess(r,e)}const NF=1735152710,iC=12,Y1=8,rte=1313821514,ite=5130562,nte=0,ste=1,ote=0,Eg=!0;function ate(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return"".concat(String.fromCharCode(r.getUint8(e+0))).concat(String.fromCharCode(r.getUint8(e+1))).concat(String.fromCharCode(r.getUint8(e+2))).concat(String.fromCharCode(r.getUint8(e+3)))}function lte(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=new DataView(r),{magic:n=NF}=t,o=i.getUint32(e,!1);return o===n||o===NF}function cte(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=new DataView(e),n=ate(i,t+0),o=i.getUint32(t+4,Eg),a=i.getUint32(t+8,Eg);switch(Object.assign(r,{header:{byteOffset:t,byteLength:a,hasBinChunk:!1},type:n,version:o,json:{},binChunks:[]}),t+=iC,r.version){case 1:return ute(r,i,t);case 2:return hte(r,i,t,{});default:throw new Error("Invalid GLB version ".concat(r.version,". Only supports v1 and v2."))}}function ute(r,e,t){Ls(r.header.byteLength>iC+Y1);const i=e.getUint32(t+0,Eg),n=e.getUint32(t+4,Eg);return t+=Y1,Ls(n===ote),nC(r,e,t,i),t+=i,t+=sC(r,e,t,r.header.byteLength),t}function hte(r,e,t,i){return Ls(r.header.byteLength>iC+Y1),Ate(r,e,t,i),t+r.header.byteLength}function Ate(r,e,t,i){for(;t+8<=r.header.byteLength;){const n=e.getUint32(t+0,Eg),o=e.getUint32(t+4,Eg);switch(t+=Y1,o){case rte:nC(r,e,t,n);break;case ite:sC(r,e,t,n);break;case nte:i.strict||nC(r,e,t,n);break;case ste:i.strict||sC(r,e,t,n);break}t+=iy(n,4)}return t}function nC(r,e,t,i){const n=new Uint8Array(e.buffer,t,i),a=new TextDecoder("utf8").decode(n);return r.json=JSON.parse(a),iy(i,4)}function sC(r,e,t,i){return r.header.hasBinChunk=!0,r.binChunks.push({byteOffset:t,byteLength:i,arrayBuffer:e.buffer}),iy(i,4)}async function dte(r,e){var t,i,n,o;let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,g=arguments.length>4?arguments[4]:void 0;fte(r,e,a,s),$ee(r,{normalize:s==null||(t=s.gltf)===null||t===void 0?void 0:t.normalize}),Vee(r,s,g);const y=[];if(s!=null&&(i=s.gltf)!==null&&i!==void 0&&i.loadBuffers&&r.json.buffers&&await pte(r,s,g),s!=null&&(n=s.gltf)!==null&&n!==void 0&&n.loadImages){const I=gte(r,s,g);y.push(I)}const T=Hee(r,s,g);return y.push(T),await Promise.all(y),s!=null&&(o=s.gltf)!==null&&o!==void 0&&o.postProcess?tte(r,s):r}function fte(r,e,t,i){if(i.uri&&(r.baseUri=i.uri),e instanceof ArrayBuffer&&!lte(e,t,i)&&(e=new TextDecoder().decode(e)),typeof e=="string")r.json=RQ(e);else if(e instanceof ArrayBuffer){const a={};t=cte(a,e,t,i.glb),cu(a.type==="glTF","Invalid GLB magic string ".concat(a.type)),r._glb=a,r.json=a.json}else cu(!1,"GLTF: must be ArrayBuffer or string");const n=r.json.buffers||[];if(r.buffers=new Array(n.length).fill(null),r._glb&&r._glb.header.hasBinChunk){const{binChunks:a}=r._glb;r.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}const o=r.json.images||[];r.images=new Array(o.length).fill({})}async function pte(r,e,t){const i=r.json.buffers||[];for(let a=0;a<i.length;++a){const s=i[a];if(s.uri){var n,o;const{fetch:g}=t;cu(g);const y=BF(s.uri,e),T=await(t==null||(n=t.fetch)===null||n===void 0?void 0:n.call(t,y)),I=await(T==null||(o=T.arrayBuffer)===null||o===void 0?void 0:o.call(T));r.buffers[a]={arrayBuffer:I,byteOffset:0,byteLength:I.byteLength},delete s.uri}else r.buffers[a]===null&&(r.buffers[a]={arrayBuffer:new ArrayBuffer(s.byteLength),byteOffset:0,byteLength:s.byteLength})}}async function gte(r,e,t){const i=mte(r),n=r.json.images||[],o=[];for(const a of i)o.push(yte(r,n[a],a,e,t));return await Promise.all(o)}function mte(r){const e=new Set,t=r.json.textures||[];for(const i of t)i.source!==void 0&&e.add(i.source);return Array.from(e).sort()}async function yte(r,e,t,i,n){const{fetch:o,parse:a}=n;let s;if(e.uri&&!e.hasOwnProperty("bufferView")){const y=BF(e.uri,i);s=await(await o(y)).arrayBuffer(),e.bufferView={data:s}}if(Number.isFinite(e.bufferView)){const y=aY(r.json,r.buffers,e.bufferView);s=Gw(y.buffer,y.byteOffset,y.byteLength)}cu(s,"glTF image has no data");let g=await a(s,[B3,oY],{mimeType:e.mimeType,basis:i.basis||{format:wF()}},n);g&&g[0]&&(g={compressed:!0,mipmaps:!1,width:g[0].width,height:g[0].height,data:g[0]}),r.images=r.images||[],r.images[t]=g}const jy={name:"glTF",id:"gltf",module:"gltf",version:GJ,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:_te,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};async function _te(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2?arguments[2]:void 0;e={...jy.options,...e},e.gltf={...jy.options.gltf,...e.gltf};const{byteOffset:i=0}=e;return await dte({},r,i,e,t)}async function vte(r){const e=[];return r.scenes.forEach(t=>{t.traverse(i=>{Object.values(i.model.getUniforms()).forEach(n=>{n.loaded===!1&&e.push(n)})})}),await bte(()=>e.some(t=>!t.loaded))}async function bte(r){for(;r();)await new Promise(e=>requestAnimationFrame(e))}const xte=`#version 300 es
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
in vec3 instanceTranslation;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform mat4 sceneModelMatrix;
uniform bool composeModelMatrix;
in vec4 POSITION;

#ifdef HAS_UV
  in vec2 TEXCOORD_0;
#endif

#ifdef MODULE_PBR
  #ifdef HAS_NORMALS
    in vec4 NORMAL;
  #endif
#endif
out vec4 vColor;
#ifndef MODULE_PBR
  #ifdef HAS_UV
    out vec2 vTEXCOORD_0;
  #endif
#endif
void main(void) {
  #if defined(HAS_UV) && !defined(MODULE_PBR)
    vTEXCOORD_0 = TEXCOORD_0;
    geometry.uv = vTEXCOORD_0;
  #endif

  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;

  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef MODULE_PBR
    #ifdef HAS_NORMALS
      normal = instanceModelMatrix * (sceneModelMatrix * vec4(NORMAL.xyz, 0.0)).xyz;
    #endif
  #endif

  float originalSize = project_size_to_pixel(sizeScale);
  float clampedSize = clamp(originalSize, sizeMinPixels, sizeMaxPixels);

  vec3 pos = (instanceModelMatrix * (sceneModelMatrix * POSITION).xyz) * sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(composeModelMatrix) {
    DECKGL_FILTER_SIZE(pos, geometry);
    geometry.normal = project_normal(normal);
    geometry.worldPosition += pos;
    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
    pos = project_size(pos);
    DECKGL_FILTER_SIZE(pos, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
    geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = TEXCOORD_0;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,wte=`#version 300 es
uniform float opacity;
in vec4 vColor;

out vec4 fragmentColor;
#ifndef MODULE_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
    in vec2 vTEXCOORD_0;
    uniform sampler2D u_BaseColorSampler;
  #endif
#endif

void main(void) {
  #ifdef MODULE_PBR
    fragmentColor = vColor * pbr_filterColor(vec4(0));
    geometry.uv = pbr_vUV;
  #else
    #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
      fragmentColor = vColor * texture2D(u_BaseColorSampler, vTEXCOORD_0);
      geometry.uv = vTEXCOORD_0;
    #else
      fragmentColor = vColor;
    #endif
  #endif

  fragmentColor.a *= opacity;
  DECKGL_FILTER_COLOR(fragmentColor, geometry);
}
`,zF=[255,255,255,255],Bte={scenegraph:{type:"object",value:null,async:!0},getScene:r=>r&&r.scenes?typeof r.scene=="object"?r.scene:r.scenes[r.scene||0]:r,getAnimator:r=>r&&r.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:r=>r.position},getColor:{type:"accessor",value:zF},_lighting:"flat",_imageBasedLightingEnvironment:null,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[jy]};class oC extends vg{constructor(){super(...arguments),ye(this,"state",void 0)}getShaders(){const e=[mB,yB];return this.props._lighting==="pbr"&&e.push(iB),super.getShaders({vs:xte,fs:wte,modules:e})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:5121,size:this.props.colorFormat.length,accessor:"getColor",normalized:!0,defaultValue:zF,transition:!0},instanceModelMatrix:WP})}updateState(e){super.updateState(e);const{props:t,oldProps:i}=e;t.scenegraph!==i.scenegraph?this._updateScenegraph():t._animations!==i._animations&&this._applyAnimationsProp(this.state.scenegraph,this.state.animator,t._animations)}finalizeState(e){super.finalizeState(e),this._deleteScenegraph()}get isLoaded(){var e;return((e=this.state)===null||e===void 0?void 0:e.scenegraph)&&super.isLoaded}_updateScenegraph(){const e=this.props,{gl:t}=this.context;let i=null;if(e.scenegraph instanceof wg)i={scenes:[e.scenegraph]};else if(e.scenegraph&&!e.scenegraph.gltf){const s=e.scenegraph,g=HJ(t,s,this._getModelOptions());i={gltf:s,...g},vte(g).then(()=>this.setNeedsRedraw())}else e.scenegraph&&(On.deprecated("ScenegraphLayer.props.scenegraph","Use GLTFLoader instead of GLTFScenegraphLoader")(),i=e.scenegraph);const n={layer:this,gl:t},o=e.getScene(i,n),a=e.getAnimator(i,n);o instanceof wg?(this._deleteScenegraph(),this._applyAllAttributes(o),this._applyAnimationsProp(o,a,e._animations),this.setState({scenegraph:o,animator:a})):o!==null&&On.warn("invalid scenegraph:",o)()}_applyAllAttributes(e){if(this.state.attributesAvailable){const t=this.getAttributeManager().getAttributes();e.traverse(i=>{this._setModelAttributes(i.model,t)})}}_applyAnimationsProp(e,t,i){if(!e||!t||!i)return;const n=t.getAnimations();Object.keys(i).sort().forEach(o=>{const a=i[o];if(o==="*")n.forEach(s=>{Object.assign(s,a)});else if(Number.isFinite(Number(o))){const s=Number(o);s>=0&&s<n.length?Object.assign(n[s],a):On.warn("animation ".concat(o," not found"))()}else{const s=n.find(g=>{let{name:y}=g;return y===o});s?Object.assign(s,a):On.warn("animation ".concat(o," not found"))()}})}_deleteScenegraph(){const{scenegraph:e}=this.state;e instanceof wg&&e.delete()}_getModelOptions(){const{_imageBasedLightingEnvironment:e}=this.props;let t=null;return e&&(typeof e=="function"?t=e({gl:this.context.gl,layer:this}):t=e),{gl:this.context.gl,waitForFullLoad:!0,imageBasedLightingEnvironment:t,modelOptions:{isInstanced:!0,transpileToGLSL100:!dn(this.context.gl),...this.getShaders()},useTangents:!1}}updateAttributes(e){this.setState({attributesAvailable:!0}),this.state.scenegraph&&this.state.scenegraph.traverse(t=>{this._setModelAttributes(t.model,e)})}draw(e){let{moduleParameters:t=null,parameters:i={},context:n}=e;if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(n.timeline.getTime()),this.setNeedsRedraw());const{viewport:o}=this.context,{sizeScale:a,sizeMinPixels:s,sizeMaxPixels:g,opacity:y,coordinateSystem:T}=this.props,I=this.getNumInstances();this.state.scenegraph.traverse((R,U)=>{let{worldMatrix:Z}=U;R.model.setInstanceCount(I),R.updateModuleSettings(t),R.draw({parameters:i,uniforms:{sizeScale:a,opacity:y,sizeMinPixels:s,sizeMaxPixels:g,composeModelMatrix:XP(o,T),sceneModelMatrix:Z,u_Camera:R.model.getUniforms().project_uCameraPosition}})})}}ye(oC,"defaultProps",Bte),ye(oC,"layerName","ScenegraphLayer");const Cte=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
uniform float sizeScale;
uniform bool composeModelMatrix;
uniform bool pickFeatureIds;
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in mat3 instanceModelMatrix;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;

vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
    return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
    return uv;
  #endif
}

void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;

  if (pickFeatureIds) {
    geometry.pickingColor = featureIdsPickingColors;
  } else {
    geometry.pickingColor = instancePickingColors;
  }

  vTexCoord = uv;
  cameraPosition = project_uCameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);

  vec3 pos = (instanceModelMatrix * positions) * sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);

  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  #ifdef MODULE_PBR
    pbr_vPosition = geometry.position.xyz;
    #ifdef HAS_NORMALS
      pbr_vNormal = geometry.normal;
    #endif

    #ifdef HAS_UV
      pbr_vUV = uv;
    #else
      pbr_vUV = vec2(0., 0.);
    #endif
    geometry.uv = pbr_vUV;
  #endif

  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Ete=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs

precision highp float;

uniform bool hasTexture;
uniform sampler2D sampler;
uniform bool flatShading;
uniform float opacity;

in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;

out vec4 fragColor;

void main(void) {
  
#ifdef MODULE_PBR

  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= opacity;

#else

  geometry.uv = vTexCoord;

  vec3 normal;
  if (flatShading) {
#ifdef DERIVATIVES_AVAILABLE
    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
#else
    normal = vec3(0.0, 0.0, 1.0);
#endif
  } else {
    normal = normals_commonspace;
  }

  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * opacity);

#endif

  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function Ste(r){r.COLOR_0||r.colors||(r.colors={constant:!0,value:new Float32Array([1,1,1])})}const Tte={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class aC extends qB{getShaders(){const e=super.getShaders();return e.modules.push(iB),{...e,vs:Cte,fs:Ete}}initializeState(){const{featureIds:e}=this.props;super.initializeState();const t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);const{props:t,oldProps:i}=e;t.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){const{featureIds:t}=this.props;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,pickFeatureIds:!!t}),super.draw(e))}getModel(e){const{id:t,pbrMaterial:i}=this.props,n=this.parseMaterial(i,e);this.setState({materialParser:n});const o=this.getShaders();return Ste(e.attributes),new ug(this.context.gl,{...this.getShaders(),id:t,geometry:e,defines:{...o.defines,...n==null?void 0:n.defines,HAS_UV_REGIONS:e.attributes.uvRegions},parameters:n==null?void 0:n.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){const{model:t}=this.state;if(t){const{mesh:i}=this.props,n=this.parseMaterial(e,i);this.setState({materialParser:n}),t.setUniforms(n.uniforms)}}parseMaterial(e,t){var i;const n=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return(i=this.state.materialParser)===null||i===void 0||i.delete(),new aF(this.context.gl,{attributes:{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},material:{unlit:n,...e},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){const t=this.props.featureIds,i=new Uint8ClampedArray(t.length*e.size),n=[];for(let o=0;o<t.length;o++)this.encodePickingColor(t[o],n),i[o*3]=n[0],i[o*3+1]=n[1],i[o*3+2]=n[2];e.value=i}finalizeState(e){var t;super.finalizeState(e),(t=this.state.materialParser)===null||t===void 0||t.delete(),this.setState({materialParser:null})}}ye(aC,"layerName","MeshLayer"),ye(aC,"defaultProps",Tte);const Ite=6378137,Lte=6378137,Mte=6356752314245179e-9;function ev(r){return r}new Ut;function Pte(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ev;return"longitude"in r?(e[0]=t(r.longitude),e[1]=t(r.latitude),e[2]=r.height):"x"in r?(e[0]=t(r.x),e[1]=t(r.y),e[2]=r.z):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function Fte(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Pte(r,e,Ea._cartographicRadians?ev:Gj)}function Dte(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ev;return"longitude"in e?(e.longitude=t(r[0]),e.latitude=t(r[1]),e.height=r[2]):"x"in e?(e.x=t(r[0]),e.y=t(r[1]),e.z=r[2]):(e[0]=t(r[0]),e[1]=t(r[1]),e[2]=r[2]),e}function Rte(r,e){return Dte(r,e,Ea._cartographicRadians?ev:jj)}const Sg=new Ut,kte=new Ut,Ote=new Ut;function Ute(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];const{oneOverRadii:i,oneOverRadiiSquared:n,centerToleranceSquared:o}=e;Sg.from(r);const a=Sg.x,s=Sg.y,g=Sg.z,y=i.x,T=i.y,I=i.z,R=a*a*y*y,U=s*s*T*T,Z=g*g*I*I,Y=R+U+Z,he=Math.sqrt(1/Y);if(!Number.isFinite(he))return;const ce=kte;if(ce.copy(r).scale(he),Y<o)return ce.to(t);const pe=n.x,be=n.y,Te=n.z,qe=Ote;qe.set(ce.x*pe*2,ce.y*be*2,ce.z*Te*2);let je=(1-he)*Sg.len()/(.5*qe.len()),We=0,Ne,at,nt,ke;do{je-=We,Ne=1/(1+je*pe),at=1/(1+je*be),nt=1/(1+je*Te);const De=Ne*Ne,Ye=at*at,Xe=nt*nt,Ct=De*Ne,Et=Ye*at,Pt=Xe*nt;ke=R*De+U*Ye+Z*Xe-1;const Rt=-2*(R*Ct*pe+U*Et*be+Z*Pt*Te);We=ke/Rt}while(Math.abs(ke)>Ey.EPSILON12);return Sg.scale([Ne,at,nt]).to(t)}const QF=1e-14,Nte=new Ut,VF={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},lC={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},qy={east:new Ut,north:new Ut,up:new Ut,west:new Ut,south:new Ut,down:new Ut},zte=new Ut,Qte=new Ut,Vte=new Ut;function HF(r,e,t,i,n,o){const a=VF[e]&&VF[e][t];sh(a&&(!i||i===a));let s,g,y;const T=Nte.copy(n);if(oh(T.x,0,QF)&&oh(T.y,0,QF)){const R=Math.sign(T.z);s=zte.fromArray(lC[e]),e!=="east"&&e!=="west"&&s.scale(R),g=Qte.fromArray(lC[t]),t!=="east"&&t!=="west"&&g.scale(R),y=Vte.fromArray(lC[i]),i!=="east"&&i!=="west"&&y.scale(R)}else{const{up:R,east:U,north:Z}=qy;U.set(-T.y,T.x,0).normalize(),r.geodeticSurfaceNormal(T,R),Z.copy(R).cross(U);const{down:Y,west:he,south:ce}=qy;Y.copy(R).scale(-1),he.copy(U).scale(-1),ce.copy(Z).scale(-1),s=qy[e],g=qy[t],y=qy[i]}return o[0]=s.x,o[1]=s.y,o[2]=s.z,o[3]=0,o[4]=g.x,o[5]=g.y,o[6]=g.z,o[7]=0,o[8]=y.x,o[9]=y.y,o[10]=y.z,o[11]=0,o[12]=T.x,o[13]=T.y,o[14]=T.z,o[15]=1,o}const tv=new Ut,GF=new Ut,Hte=new Ut,uh=new Ut,Gte=new Ut,rv=new Ut;class go{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;ye(this,"radii",void 0),ye(this,"radiiSquared",void 0),ye(this,"radiiToTheFourth",void 0),ye(this,"oneOverRadii",void 0),ye(this,"oneOverRadiiSquared",void 0),ye(this,"minimumRadius",void 0),ye(this,"maximumRadius",void 0),ye(this,"centerToleranceSquared",Ey.EPSILON1),ye(this,"squaredXOverSquaredZ",void 0),sh(e>=0),sh(t>=0),sh(i>=0),this.radii=new Ut(e,t,i),this.radiiSquared=new Ut(e*e,t*t,i*i),this.radiiToTheFourth=new Ut(e*e*e*e,t*t*t*t,i*i*i*i),this.oneOverRadii=new Ut(e===0?0:1/e,t===0?0:1/t,i===0?0:1/i),this.oneOverRadiiSquared=new Ut(e===0?0:1/(e*e),t===0?0:1/(t*t),i===0?0:1/(i*i)),this.minimumRadius=Math.min(e,t,i),this.maximumRadius=Math.max(e,t,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const i=GF,n=Hte,[,,o]=e;this.geodeticSurfaceNormalCartographic(e,i),n.copy(this.radiiSquared).scale(i);const a=Math.sqrt(i.dot(n));return n.scale(1/a),i.scale(o),n.add(i),n.to(t)}cartesianToCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];rv.from(e);const i=this.scaleToGeodeticSurface(rv,uh);if(!i)return;const n=this.geodeticSurfaceNormal(i,GF),o=Gte;o.copy(rv).subtract(i);const a=Math.atan2(n.y,n.x),s=Math.asin(n.z),g=Math.sign(j2(o,rv))*rM(o);return Rte([a,s,g],t)}eastNorthUpToFixedFrame(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Sn;return HF(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,i,n){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Sn;return HF(this,e,t,i,n,o)}geocentricSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return tv.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const i=Fte(e),n=i[0],o=i[1],a=Math.cos(o);return tv.set(a*Math.cos(n),a*Math.sin(n),Math.sin(o)).normalize(),tv.to(t)}geodeticSurfaceNormal(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return tv.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return Ute(e,this,t)}scaleToGeocentricSurface(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];uh.from(e);const i=uh.x,n=uh.y,o=uh.z,a=this.oneOverRadiiSquared,s=1/Math.sqrt(i*i*a.x+n*n*a.y+o*o*a.z);return uh.multiplyScalar(s).to(t)}transformPositionToScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return uh.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];return uh.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[0,0,0];sh(oh(this.radii.x,this.radii.y,Ey.EPSILON15)),sh(this.radii.z>0),uh.from(e);const n=uh.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-t))return uh.set(0,0,n).to(i)}}ye(go,"WGS84",new go(Ite,Lte,Mte));function jF(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}class qF{constructor(e,t){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=jF(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(jF()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class jte{constructor(e){this.id=void 0,this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let n=this.stats[t];return n||(e instanceof qF?n=e:n=new qF(t,i),this.stats[t]=n),n}}class qte{constructor(e,t,i){ye(this,"item",void 0),ye(this,"previous",void 0),ye(this,"next",void 0),this.item=e,this.previous=t,this.next=i}}class $te{constructor(){ye(this,"head",null),ye(this,"tail",null),ye(this,"_length",0)}get length(){return this._length}add(e){const t=new qte(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const i=e.next;e.next=t,this.tail===e?this.tail=t:i.previous=t,t.next=i,t.previous=e,++this._length}}class Kte{constructor(){ye(this,"_list",void 0),ye(this,"_sentinel",void 0),ye(this,"_trimTiles",void 0),this._list=new $te,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,i){t._cacheNode||(t._cacheNode=this._list.add(t),i&&i(e,t))}unloadTile(e,t,i){const n=t._cacheNode;n&&(this._list.remove(n),t._cacheNode=null,i&&i(e,t))}unloadTiles(e,t){const i=this._trimTiles;this._trimTiles=!1;const n=this._list,o=e.maximumMemoryUsage*1024*1024,a=this._sentinel;let s=n.head;for(;s!==a&&(e.gpuMemoryUsageInBytes>o||i);){const g=s.item;s=s.next,this.unloadTile(e,g,t)}}trim(){this._trimTiles=!0}}function Wte(r,e){Ls(r),Ls(e);const{rtcCenter:t,gltfUpAxis:i}=e,{computedTransform:n,boundingVolume:{center:o}}=r;let a=new Sn(n);switch(t&&a.translate(t),i){case"Z":break;case"Y":const I=new Sn().rotateX(Math.PI/2);a=a.multiplyRight(I);break;case"X":const R=new Sn().rotateY(-Math.PI/2);a=a.multiplyRight(R);break}e.isQuantized&&a.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);const s=new Ut(o);e.cartesianModelMatrix=a,e.cartesianOrigin=s;const g=go.WGS84.cartesianToCartographic(s,new Ut),T=go.WGS84.eastNorthUpToFixedFrame(s).invert();e.cartographicModelMatrix=T.multiplyRight(a),e.cartographicOrigin=g,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}const $F=new Ut,cC=new Ut,uC=new Mu([new ch,new ch,new ch,new ch,new ch,new ch]);function Xte(r,e){const{cameraDirection:t,cameraUp:i,height:n}=r,{metersPerUnit:o}=r.distanceScales,a=iv(r,r.center),s=go.WGS84.eastNorthUpToFixedFrame(a),g=r.unprojectPosition(r.cameraPosition),y=go.WGS84.cartographicToCartesian(g,new Ut),T=new Ut(s.transformAsVector(new Ut(t).scale(o))).normalize(),I=new Ut(s.transformAsVector(new Ut(i).scale(o))).normalize();Jte(r);const R=r.constructor,{longitude:U,latitude:Z,width:Y,bearing:he,zoom:ce}=r,pe=new R({longitude:U,latitude:Z,height:n,width:Y,bearing:he,zoom:ce,pitch:0});return{camera:{position:y,direction:T,up:I},viewport:r,topDownViewport:pe,height:n,cullingVolume:uC,frameNumber:e,sseDenominator:1.15}}function Zte(r,e,t){if(t===0||r.length<=t)return[r,[]];const i=[],{longitude:n,latitude:o}=e.viewport;for(const[y,T]of r.entries()){const[I,R]=T.header.mbs,U=Math.abs(n-I),Z=Math.abs(o-R),Y=Math.sqrt(Z*Z+U*U);i.push([y,Y])}const a=i.sort((y,T)=>y[1]-T[1]),s=[];for(let y=0;y<t;y++)s.push(r[a[y][0]]);const g=[];for(let y=t;y<a.length;y++)g.push(r[a[y][0]]);return[s,g]}function Jte(r){const e=r.getFrustumPlanes(),t=KF(e.near,r.cameraPosition),i=iv(r,t),n=iv(r,r.cameraPosition,cC);let o=0;uC.planes[o++].fromPointNormal(i,$F.copy(i).subtract(n));for(const a in e){if(a==="near")continue;const s=e[a],g=KF(s,t,cC),y=iv(r,g,cC);uC.planes[o++].fromPointNormal(y,$F.copy(i).subtract(y))}}function KF(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Ut;const i=r.normal.dot(e);return t.copy(r.normal).scale(r.distance-i).add(e),t}function iv(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Ut;const i=r.unprojectPosition(e);return go.WGS84.cartographicToCartesian(i,t)}const Yte=6378137,ere=6378137,hC=6356752314245179e-9,WF=new Ut;function tre(r,e){if(r instanceof Ny){const{halfAxes:t}=r,i=ire(t);return Math.log2(hC/(i+e[2]))}else if(r instanceof Uy){const{radius:t}=r;return Math.log2(hC/(t+e[2]))}else if(r.width&&r.height){const{width:t,height:i}=r,n=Math.log2(Yte/t),o=Math.log2(ere/i);return(n+o)/2}return 1}function XF(r,e,t){const i=go.WGS84.cartographicToCartesian([r.xmax,r.ymax,r.zmax],new Ut),n=Math.sqrt(Math.pow(i[0]-t[0],2)+Math.pow(i[1]-t[1],2)+Math.pow(i[2]-t[2],2));return Math.log2(hC/(n+e[2]))}function rre(r,e,t){const[i,n,o,a]=r;return XF({xmin:i,xmax:o,ymin:n,ymax:a,zmin:0,zmax:0},e,t)}function ire(r){r.getColumn(0,WF);const e=r.getColumn(1),t=r.getColumn(2);return WF.add(e).add(t).len()}const uu={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},kA={ADD:1,REPLACE:2},Tg={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},Fu={I3S:"I3S",TILES3D:"TILES3D"},nv={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},nre={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function ZF(r){return r!=null}const Fl=new Ut,sv=new Ut,sre=new Ut,ore=new Ut;function AC(r,e,t){if(Ls(r,"3D Tile: boundingVolume must be defined"),r.box)return lre(r.box,e,t);if(r.region){const[i,n,o,a,s,g]=r.region,y=go.WGS84.cartographicToCartesian([PA(i),PA(a),s],sre),T=go.WGS84.cartographicToCartesian([PA(o),PA(n),g],ore),I=new Ut().addVectors(y,T).multiplyScalar(.5),R=new Ut().subVectors(y,T).len()/2;return JF([I[0],I[1],I[2],R],new Sn)}if(r.sphere)return JF(r.sphere,e,t);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function are(r,e){if(r.box)return cre(e);if(r.region){const[t,i,n,o,a,s]=r.region;return[[PA(t),PA(i),a],[PA(n),PA(o),s]]}if(r.sphere)return ure(e);throw new Error("Unkown boundingVolume type")}function lre(r,e,t){const i=new Ut(r[0],r[1],r[2]);e.transform(i,i);let n=[];if(r.length===10){const y=r.slice(3,6),T=new Cy;T.fromArray(r,6);const I=new Ut([1,0,0]),R=new Ut([0,1,0]),U=new Ut([0,0,1]);I.transformByQuaternion(T),I.scale(y[0]),R.transformByQuaternion(T),R.scale(y[1]),U.transformByQuaternion(T),U.scale(y[2]),n=[...I.toArray(),...R.toArray(),...U.toArray()]}else n=[...r.slice(3,6),...r.slice(6,9),...r.slice(9,12)];const o=e.transformAsVector(n.slice(0,3)),a=e.transformAsVector(n.slice(3,6)),s=e.transformAsVector(n.slice(6,9)),g=new Co([o[0],o[1],o[2],a[0],a[1],a[2],s[0],s[1],s[2]]);return ZF(t)?(t.center=i,t.halfAxes=g,t):new Ny(i,g)}function JF(r,e,t){const i=new Ut(r[0],r[1],r[2]);e.transform(i,i);const n=e.getScale(sv),o=Math.max(Math.max(n[0],n[1]),n[2]),a=r[3]*o;return ZF(t)?(t.center=i,t.radius=a,t):new Uy(i,a)}function cre(r){const e=YF(),{halfAxes:t}=r,i=new Ut(t.getColumn(0)),n=new Ut(t.getColumn(1)),o=new Ut(t.getColumn(2));for(let a=0;a<2;a++){for(let s=0;s<2;s++){for(let g=0;g<2;g++)Fl.copy(r.center),Fl.add(i),Fl.add(n),Fl.add(o),e4(e,Fl),o.negate();n.negate()}i.negate()}return e}function ure(r){const e=YF(),{center:t,radius:i}=r,n=go.WGS84.scaleToGeodeticSurface(t,Fl);let o;n?o=go.WGS84.geodeticSurfaceNormal(n):o=new Ut(0,0,1);let a=new Ut(o[2],-o[1],0);a.len()>0?a.normalize():a=new Ut(0,1,0);const s=a.clone().cross(o);for(const g of[a,s,o]){sv.copy(g).scale(i);for(let y=0;y<2;y++)Fl.copy(t),Fl.add(sv),e4(e,Fl),sv.negate()}return e}function YF(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function e4(r,e){go.WGS84.cartesianToCartographic(e,Fl),r[0][0]=Math.min(r[0][0],Fl[0]),r[0][1]=Math.min(r[0][1],Fl[1]),r[0][2]=Math.min(r[0][2],Fl[2]),r[1][0]=Math.max(r[1][0],Fl[0]),r[1][1]=Math.max(r[1][1],Fl[1]),r[1][2]=Math.max(r[1][2],Fl[2])}new Ut,new Ut,new Sn,new Ut,new Ut,new Ut;function hre(r,e){const t=r*e;return 1-Math.exp(-(t*t))}function Are(r,e){if(r.dynamicScreenSpaceError&&r.dynamicScreenSpaceErrorComputedDensity){const t=r.dynamicScreenSpaceErrorComputedDensity,i=r.dynamicScreenSpaceErrorFactor;return hre(e,t)*i}return 0}function dre(r,e,t){const i=r.tileset,n=r.parent&&r.parent.lodMetricValue||r.lodMetricValue,o=t?n:r.lodMetricValue;if(o===0)return 0;const a=Math.max(r._distanceToCamera,1e-7),{height:s,sseDenominator:g}=e,{viewDistanceScale:y}=i.options;let T=o*s*(y||1)/(a*g);return T-=Are(i,a),T}const dC=new Ut,t4=new Ut,xd=new Ut,r4=new Ut,fre=new Ut,fC=new Sn,i4=new Sn;function pre(r,e){if(r.lodMetricValue===0||isNaN(r.lodMetricValue))return"DIG";const t=2*n4(r,e);return t<2?"OUT":!r.header.children||t<=r.lodMetricValue?"DRAW":r.header.children?"DIG":"OUT"}function n4(r,e){const{topDownViewport:t}=e,i=r.header.mbs[1],n=r.header.mbs[0],o=r.header.mbs[2],a=r.header.mbs[3],s=[...r.boundingVolume.center],g=t.unprojectPosition(t.cameraPosition);go.WGS84.cartographicToCartesian(g,dC),t4.copy(dC).subtract(s).normalize(),go.WGS84.eastNorthUpToFixedFrame(s,fC),i4.copy(fC).invert(),xd.copy(dC).transform(i4);const y=Math.sqrt(xd[0]*xd[0]+xd[1]*xd[1]),T=y*y/xd[2];r4.copy([xd[0],xd[1],T]);const R=r4.transform(fC).subtract(s).normalize(),Z=t4.cross(R).normalize().scale(a).add(s),Y=go.WGS84.cartesianToCartographic(Z),he=t.project([n,i,o]),ce=t.project(Y);return fre.copy(he).subtract(ce).magnitude()}function gre(r){return{assetGltfUpAxis:r.asset&&r.asset.gltfUpAxis||"Y"}}class s4{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;ye(this,"_map",new Map),ye(this,"_array",void 0),ye(this,"_length",void 0),this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Ls(e<this._array.length),this._array[e]}set(e,t){Ls(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Ls(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Ls(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const mre={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class ov{traversalFinished(e){return!0}constructor(e){ye(this,"options",void 0),ye(this,"root",null),ye(this,"selectedTiles",{}),ye(this,"requestedTiles",{}),ye(this,"emptyTiles",{}),ye(this,"lastUpdate",new Date().getTime()),ye(this,"updateDebounceTime",1e3),ye(this,"_traversalStack",new s4),ye(this,"_emptyTraversalStack",new s4),ye(this,"_frameNumber",null),this.options={...mre,...e}}traverse(e,t,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){const o=i.pop();let a=!1;this.canTraverse(o,t)&&(this.updateChildTiles(o,t),a=this.updateAndPushChildren(o,t,i,o.hasRenderContent?o._selectionDepth+1:o._selectionDepth));const s=o.parent,g=!!(!s||s._shouldRefine),y=!a;o.hasRenderContent?o.refine===kA.ADD?(this.loadTile(o,t),this.selectTile(o,t)):o.refine===kA.REPLACE&&(this.loadTile(o,t),y&&this.selectTile(o,t)):(this.emptyTiles[o.id]=o,this.loadTile(o,t),y&&this.selectTile(o,t)),this.touchTile(o,t),o._shouldRefine=a&&g}const n=new Date().getTime();(this.traversalFinished(t)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const i=e.children;for(const n of i)this.updateTile(n,t)}updateAndPushChildren(e,t,i,n){const{loadSiblings:o,skipLevelOfDetail:a}=this.options,s=e.children;s.sort(this.compareDistanceToCamera.bind(this));const g=e.refine===kA.REPLACE&&e.hasRenderContent&&!a;let y=!1,T=!0;for(const I of s)if(I._selectionDepth=n,I.isVisibleAndInRequestVolume?(i.find(I)&&i.delete(I),i.push(I),y=!0):(g||o)&&(this.loadTile(I,t),this.touchTile(I,t)),g){let R;if(I._inRequestVolume?I.hasRenderContent?R=I.contentAvailable:R=this.executeEmptyTraversal(I,t):R=!1,T=T&&R,!T)return!1}return y||(T=!1),T}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return e.hasChildren?e.hasTilesetContent?!e.contentExpired:!n&&!e.isVisibleAndInRequestVolume?!1:this.shouldRefine(e,t,i):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=e._screenSpaceError;return i&&(n=e.getScreenSpaceError(t,!0)),n>this.options.maximumScreenSpaceError}updateTileVisibility(e,t){const i=[];if(this.options.viewportTraversersMap)for(const n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===t.viewport.id&&i.push(n);else i.push(t.viewport.id);e.updateVisibility(t,i)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let i=!1;for(const n of e.children)n.updateVisibility(t),i=i||n.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,t){let i=!0;const n=this._emptyTraversalStack;for(n.push(e);n.length>0&&i;){const o=n.pop();if(this.updateTile(o,t),o.isVisibleAndInRequestVolume||this.loadTile(o,t),this.touchTile(o,t),!o.hasRenderContent&&this.canTraverse(o,t,!1,!0)){const s=o.children;for(const g of s)n.find(g)&&n.delete(g),n.push(g)}else!o.contentAvailable&&!o.hasEmptyContent&&(i=!1)}return i}}const o4=new Ut;function yre(r){return r!=null}class pC{constructor(e,t,i){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";ye(this,"tileset",void 0),ye(this,"header",void 0),ye(this,"id",void 0),ye(this,"url",void 0),ye(this,"parent",void 0),ye(this,"refine",void 0),ye(this,"type",void 0),ye(this,"contentUrl",void 0),ye(this,"lodMetricType","geometricError"),ye(this,"lodMetricValue",0),ye(this,"boundingVolume",null),ye(this,"content",null),ye(this,"contentState",uu.UNLOADED),ye(this,"gpuMemoryUsageInBytes",0),ye(this,"children",[]),ye(this,"depth",0),ye(this,"viewportIds",[]),ye(this,"transform",new Sn),ye(this,"extensions",null),ye(this,"implicitTiling",null),ye(this,"userData",{}),ye(this,"computedTransform",void 0),ye(this,"hasEmptyContent",!1),ye(this,"hasTilesetContent",!1),ye(this,"traverser",new ov({})),ye(this,"_cacheNode",null),ye(this,"_frameNumber",null),ye(this,"_expireDate",null),ye(this,"_expiredContent",null),ye(this,"_boundingBox",void 0),ye(this,"_distanceToCamera",0),ye(this,"_screenSpaceError",0),ye(this,"_visibilityPlaneMask",void 0),ye(this,"_visible",void 0),ye(this,"_contentBoundingVolume",void 0),ye(this,"_viewerRequestVolume",void 0),ye(this,"_initialTransform",new Sn),ye(this,"_priority",0),ye(this,"_selectedFrame",0),ye(this,"_requestedFrame",0),ye(this,"_selectionDepth",0),ye(this,"_touchedFrame",0),ye(this,"_centerZDepth",0),ye(this,"_shouldRefine",!1),ye(this,"_stackLength",0),ye(this,"_visitedFrame",0),ye(this,"_inRequestVolume",!1),ye(this,"_lodJudge",null),this.header=t,this.tileset=e,this.id=n||t.id,this.url=t.url,this.parent=i,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===uu.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===uu.UNLOADED}get contentExpired(){return this.contentState===uu.EXPIRED}get contentFailed(){return this.contentState===uu.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=are(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case Fu.I3S:return n4(this,e);case Fu.TILES3D:return dre(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,i=this.refine===kA.ADD||t;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===uu.UNLOADED)return-1;const n=this.parent,a=n&&(!i||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,s=e.root?e.root._screenSpaceError:0;return Math.max(s-a,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=uu.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=uu.UNLOADED,!1;try{const i=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,o={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(n.id)}};return this.content=await ud(i,n,o),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=uu.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=uu.FAILED,i}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=uu.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const i=this.parent,n=i?i._visibilityPlaneMask:Mu.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const o=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(o)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==Mu.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:i}=e,{boundingVolume:n}=this;return i.computeVisibilityWithPlaneMask(n,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth(e){let{camera:t}=e;const i=this.boundingVolume;return o4.subVectors(i.center,t.position),t.direction.dot(o4)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(yre(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=uu.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Sn(e.transform):new Sn;const t=this.parent,i=this.tileset,n=t&&t.computedTransform?t.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new Sn(n).multiplyRight(this.transform);const o=t&&t._initialTransform?t._initialTransform.clone():new Sn;this._initialTransform=new Sn(o).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=uu.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Mu.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||kA.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=AC(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=AC(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=AC(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Sn).clone().multiplyRight(this.transform);t.equals(this.computedTransform)||(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return gre(this.tileset.tileset)}}}class _re extends ov{compareDistanceToCamera(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const i=e.children.length>0;if(e.hasTilesetContent&&i){const a=e.children[0];this.updateTileVisibility(a,t),e._visible=a._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}const n=e.refine===kA.REPLACE,o=e._optimChildrenWithinParent===nre.USE_OPTIMIZATION;if(n&&o&&i&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){const{parent:i}=e;return!i||i.hasTilesetContent||i.refine!==kA.ADD?!1:!this.shouldRefine(e,t,!0)}}class vre{constructor(){ye(this,"frameNumberMap",new Map)}register(e,t){const i=this.frameNumberMap.get(e)||new Map,n=i.get(t)||0;i.set(t,n+1),this.frameNumberMap.set(e,i)}deregister(e,t){const i=this.frameNumberMap.get(e);if(!i)return;const n=i.get(t)||1;i.set(t,n-1)}isZero(e,t){var i;return(((i=this.frameNumberMap.get(e))===null||i===void 0?void 0:i.get(t))||0)===0}}const gC={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class bre{constructor(){ye(this,"_statusMap",void 0),ye(this,"pendingTilesRegister",new vre),this._statusMap={}}add(e,t,i,n){if(!this._statusMap[t]){const{frameNumber:o,viewport:{id:a}}=n;this._statusMap[t]={request:e,callback:i,key:t,frameState:n,status:gC.REQUESTED},this.pendingTilesRegister.register(a,o),e().then(s=>{this._statusMap[t].status=gC.COMPLETED;const{frameNumber:g,viewport:{id:y}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(y,g),this._statusMap[t].callback(s,n)}).catch(s=>{this._statusMap[t].status=gC.ERROR;const{frameNumber:g,viewport:{id:y}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(y,g),i(s)})}}update(e,t){if(this._statusMap[e]){const{frameNumber:i,viewport:{id:n}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(n,i);const{frameNumber:o,viewport:{id:a}}=t;this.pendingTilesRegister.register(a,o),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class xre extends ov{constructor(e){super(e),ye(this,"_tileManager",void 0),this._tileManager=new bre}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=pre(e,t),e._lodJudge==="DIG"}updateChildTiles(e,t){const i=e.header.children||[],n=e.children,o=e.tileset;for(const a of i){const s="".concat(a.id,"-").concat(t.viewport.id),g=n&&n.find(y=>y.id===s);if(g)g&&this.updateTile(g,t);else{let y=()=>this._loadTile(a.id,o);this._tileManager.find(s)?this._tileManager.update(s,t):(o.tileset.nodePages&&(y=()=>o.tileset.nodePagesTile.formTileFromNodePages(a.id)),this._tileManager.add(y,s,I=>this._onTileLoad(I,e,s),t))}}return!1}async _loadTile(e,t){const{loader:i}=t,n=t.getTileUrl("".concat(t.url,"/nodes/").concat(e)),o={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await ud(n,i,o)}_onTileLoad(e,t,i){const n=new pC(t.tileset,e,t,i);t.children.push(n);const o=this._tileManager.find(n.id).frameState;this.updateTile(n,o),this._frameNumber===o.frameNumber&&(this.traversalFinished(o)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,o)}}const wre={description:"",ellipsoid:go.WGS84,modelMatrix:new Sn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:r=>r,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},av="Tiles In Tileset(s)",mC="Tiles In Memory",a4="Tiles In View",l4="Tiles To Render",c4="Tiles Loaded",yC="Tiles Loading",u4="Tiles Unloaded",h4="Failed Tile Loads",A4="Points/Vertices",_C="Tile Memory Use";class Bre{constructor(e,t){ye(this,"options",void 0),ye(this,"loadOptions",void 0),ye(this,"type",void 0),ye(this,"tileset",void 0),ye(this,"loader",void 0),ye(this,"url",void 0),ye(this,"basePath",void 0),ye(this,"modelMatrix",void 0),ye(this,"ellipsoid",void 0),ye(this,"lodMetricType",void 0),ye(this,"lodMetricValue",void 0),ye(this,"refine",void 0),ye(this,"root",null),ye(this,"roots",{}),ye(this,"asset",{}),ye(this,"description",""),ye(this,"properties",void 0),ye(this,"extras",null),ye(this,"attributions",{}),ye(this,"credits",{}),ye(this,"stats",void 0),ye(this,"contentFormats",{draco:!1,meshopt:!1,dds:!1,ktx2:!1}),ye(this,"cartographicCenter",null),ye(this,"cartesianCenter",null),ye(this,"zoom",1),ye(this,"boundingVolume",null),ye(this,"dynamicScreenSpaceErrorComputedDensity",0),ye(this,"maximumMemoryUsage",32),ye(this,"gpuMemoryUsageInBytes",0),ye(this,"_frameNumber",0),ye(this,"_queryParams",{}),ye(this,"_extensionsUsed",[]),ye(this,"_tiles",{}),ye(this,"_pendingCount",0),ye(this,"selectedTiles",[]),ye(this,"traverseCounter",0),ye(this,"geometricError",0),ye(this,"lastUpdatedVieports",null),ye(this,"_requestedTiles",[]),ye(this,"_emptyTiles",[]),ye(this,"frameStateData",{}),ye(this,"_traverser",void 0),ye(this,"_cache",new Kte),ye(this,"_requestScheduler",void 0),ye(this,"updatePromise",null),ye(this,"tilesetInitializationPromise",void 0),this.options={...wre,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||jw(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new $Q({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.stats=new jte({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}setOptions(e){this.options={...this.options,...e}}getTileUrl(e){return e.startsWith("data:")?e:"".concat(e).concat(e.includes("?")?"&":"?").concat(this.queryParams)}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(t=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),t(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const i=[];for(const n of t){const o=n.id;this._needTraverse(o)?i.push(o):this.traverseCounter--}for(const n of t){const o=n.id;if(this.roots[o]||(this.roots[o]=this._initializeTileHeaders(this.tileset,null)),!i.includes(o))continue;const a=Xte(n,this._frameNumber);this._traverser.traverse(this.roots[o],a,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[t],n=Object.values(this._traverser.selectedTiles),[o,a]=Zte(n,e,this.options.maximumTilesSelected);i.selectedTiles=o;for(const s of a)s.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const i=new Set(e.map(a=>a.id)),n=new Set(t.map(a=>a.id));let o=e.filter(a=>!n.has(a.id)).length>0;return o=o||t.filter(a=>!i.has(a.id)).length>0,o}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(const i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?t+=i.content.pointCount:t+=i.content.vertexCount);this.stats.get(a4).count=this.selectedTiles.length,this.stats.get(l4).count=e,this.stats.get(A4).count=t}async _initializeTileSet(e){this.type===Fu.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===Fu.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===Fu.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var e;const t=this.tileset.fullExtent;if(t){const{xmin:n,xmax:o,ymin:a,ymax:s,zmin:g,zmax:y}=t;this.cartographicCenter=new Ut(n+(o-n)/2,a+(s-a)/2,g+(y-g)/2),this.cartesianCenter=go.WGS84.cartographicToCartesian(this.cartographicCenter,new Ut),this.zoom=XF(t,this.cartographicCenter,this.cartesianCenter);return}const i=(e=this.tileset.store)===null||e===void 0?void 0:e.extent;if(i){const[n,o,a,s]=i;this.cartographicCenter=new Ut(n+(a-n)/2,o+(s-o)/2,0),this.cartesianCenter=go.WGS84.cartographicToCartesian(this.cartographicCenter,new Ut),this.zoom=rre(i,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new Ut,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Ut,this.zoom=1;return}t[0]!==0||t[1]!==0||t[2]!==0?this.cartographicCenter=go.WGS84.cartesianToCartographic(t,new Ut):this.cartographicCenter=new Ut(0,0,-go.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=tre(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(av),this.stats.get(yC),this.stats.get(mC),this.stats.get(a4),this.stats.get(l4),this.stats.get(c4),this.stats.get(u4),this.stats.get(h4),this.stats.get(A4),this.stats.get(_C,"memory")}_initializeTileHeaders(e,t){const i=new pC(this,e.root,t);if(t&&(t.children.push(i),i.depth=t.depth+1),this.type===Fu.TILES3D){const o=[];for(o.push(i);o.length>0;){const a=o.pop();this.stats.get(av).incrementCount();const s=a.header.children||[];for(const g of s){var n;const y=new pC(this,g,a);if((n=y.contentUrl)!==null&&n!==void 0&&n.includes("?session=")){const I=new URL(y.contentUrl).searchParams.get("session");I&&(this._queryParams.session=I)}a.children.push(y),y.depth=a.depth+1,o.push(y)}}}return i}_initializeTraverser(){let e;switch(this.type){case Fu.TILES3D:e=_re;break;case Fu.I3S:e=xre;break;default:e=ov}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(i){this._onTileLoadError(e,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(h4).incrementCount();const i=t.message||t.toString(),n=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(i)),this.options.onTileError(e,i,n)}_onTileLoad(e,t){if(t){if(this.type===Fu.I3S){var i,n;const o=((i=this.tileset)===null||i===void 0||(n=i.nodePagesTile)===null||n===void 0?void 0:n.nodesInNodePages)||0;this.stats.get(av).reset(),this.stats.get(av).addCount(o)}e&&e.content&&Wte(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===Fu.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===Fu.TILES3D){var t;const{extensionsRemoved:i=[]}=((t=e.content)===null||t===void 0?void 0:t.gltf)||{};i.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),i.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),i.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(yC).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(yC).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(c4).incrementCount(),this.stats.get(mC).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(_C).count=this.gpuMemoryUsageInBytes}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(mC).decrementCount(),this.stats.get(u4).incrementCount(),this.stats.get(_C).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const i of t.children)e.push(i);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,i=[];for(i.push(t);i.length>0;){e=i.pop();for(const n of e.children)i.push(n);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),i=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0")throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const d4="3.4.14",$y={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function f4(r,e,t){Ls(r instanceof ArrayBuffer);const i=new TextDecoder("utf8"),n=new Uint8Array(r,e,t);return i.decode(n)}function Cre(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const t=new DataView(r);return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}const Ere={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},la={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},Hn={...Ere,...la},vC={[la.DOUBLE]:Float64Array,[la.FLOAT]:Float32Array,[la.UNSIGNED_SHORT]:Uint16Array,[la.UNSIGNED_INT]:Uint32Array,[la.UNSIGNED_BYTE]:Uint8Array,[la.BYTE]:Int8Array,[la.SHORT]:Int16Array,[la.INT]:Int32Array},Sre={DOUBLE:la.DOUBLE,FLOAT:la.FLOAT,UNSIGNED_SHORT:la.UNSIGNED_SHORT,UNSIGNED_INT:la.UNSIGNED_INT,UNSIGNED_BYTE:la.UNSIGNED_BYTE,BYTE:la.BYTE,SHORT:la.SHORT,INT:la.INT},bC="Failed to convert GL type";class Kh{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in vC)if(vC[t]===e)return t;throw new Error(bC)}static fromName(e){const t=Sre[e];if(!t)throw new Error(bC);return t}static getArrayType(e){switch(e){case la.UNSIGNED_SHORT_5_6_5:case la.UNSIGNED_SHORT_4_4_4_4:case la.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=vC[e];if(!t)throw new Error(bC);return t}}static getByteSize(e){return Kh.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!Kh.getArrayType(e)}static createTypedArray(e,t){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;n===void 0&&(n=(t.byteLength-i)/Kh.getByteSize(e));const o=Kh.getArrayType(e);return new o(t,i,n)}}function Tre(r,e){if(!r)throw new Error("math.gl assertion failed. ".concat(e))}function Ire(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const t=r>>11&31,i=r>>5&63,n=r&31;return e[0]=t<<3,e[1]=i<<2,e[2]=n<<3,e}new G2,new Ut,new G2,new G2;function p4(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return FA(r,0,e)/e*2-1}function g4(r){return r<0?-1:1}function Lre(r,e,t,i){if(Tre(i),r<0||r>t||e<0||e>t)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(t));if(i.x=p4(r,t),i.y=p4(e,t),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const n=i.x;i.x=(1-Math.abs(i.y))*g4(n),i.y=(1-Math.abs(n))*g4(i.y)}return i.normalize()}function Mre(r,e,t){return Lre(r,e,255,t)}class xC{constructor(e,t){ye(this,"json",void 0),ye(this,"buffer",void 0),ye(this,"featuresLength",0),ye(this,"_cachedTypedArrays",{}),this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Hn.UNSIGNED_INT,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,t,i,1,n.byteOffset):n}getPropertyArray(e,t,i){const n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(t=Kh.fromName(n.componentType)),this._getTypedArrayFromBinary(e,t,i,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,t,n)}getProperty(e,t,i,n,o){const a=this.json[e];if(!a)return a;const s=this.getPropertyArray(e,t,i);if(i===1)return s[n];for(let g=0;g<i;++g)o[g]=s[i*n+g];return o}_getTypedArrayFromBinary(e,t,i,n,o){const a=this._cachedTypedArrays;let s=a[e];return s||(s=Kh.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+o,n*i),a[e]=s),s}_getTypedArrayFromArray(e,t,i){const n=this._cachedTypedArrays;let o=n[e];return o||(o=Kh.createTypedArray(t,i),n[e]=o),o}}const Pre={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Fre={SCALAR:(r,e)=>r[e],VEC2:(r,e)=>[r[2*e+0],r[2*e+1]],VEC3:(r,e)=>[r[3*e+0],r[3*e+1],r[3*e+2]],VEC4:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT2:(r,e)=>[r[4*e+0],r[4*e+1],r[4*e+2],r[4*e+3]],MAT3:(r,e)=>[r[9*e+0],r[9*e+1],r[9*e+2],r[9*e+3],r[9*e+4],r[9*e+5],r[9*e+6],r[9*e+7],r[9*e+8]],MAT4:(r,e)=>[r[16*e+0],r[16*e+1],r[16*e+2],r[16*e+3],r[16*e+4],r[16*e+5],r[16*e+6],r[16*e+7],r[16*e+8],r[16*e+9],r[16*e+10],r[16*e+11],r[16*e+12],r[16*e+13],r[16*e+14],r[16*e+15]]},Dre={SCALAR:(r,e,t)=>{e[t]=r},VEC2:(r,e,t)=>{e[2*t+0]=r[0],e[2*t+1]=r[1]},VEC3:(r,e,t)=>{e[3*t+0]=r[0],e[3*t+1]=r[1],e[3*t+2]=r[2]},VEC4:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT2:(r,e,t)=>{e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},MAT3:(r,e,t)=>{e[9*t+0]=r[0],e[9*t+1]=r[1],e[9*t+2]=r[2],e[9*t+3]=r[3],e[9*t+4]=r[4],e[9*t+5]=r[5],e[9*t+6]=r[6],e[9*t+7]=r[7],e[9*t+8]=r[8],e[9*t+9]=r[9]},MAT4:(r,e,t)=>{e[16*t+0]=r[0],e[16*t+1]=r[1],e[16*t+2]=r[2],e[16*t+3]=r[3],e[16*t+4]=r[4],e[16*t+5]=r[5],e[16*t+6]=r[6],e[16*t+7]=r[7],e[16*t+8]=r[8],e[16*t+9]=r[9],e[16*t+10]=r[10],e[16*t+11]=r[11],e[16*t+12]=r[12],e[16*t+13]=r[13],e[16*t+14]=r[14],e[16*t+15]=r[15]}};function Rre(r,e,t,i){const{componentType:n}=r;Ls(r.componentType);const o=typeof n=="string"?Kh.fromName(n):n,a=Pre[r.type],s=Fre[r.type],g=Dre[r.type];return t+=r.byteOffset,{values:Kh.createTypedArray(o,e,t,a*i),type:o,size:a,unpacker:s,packer:g}}const Wh=r=>r!==void 0;function kre(r,e,t){if(!e)return null;let i=r.getExtension("3DTILES_batch_table_hierarchy");const n=e.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=n,i=n),i?Ore(i,t):null}function Ore(r,e){let t,i,n;const o=r.instancesLength,a=r.classes;let s=r.classIds,g=r.parentCounts,y=r.parentIds,T=o;Wh(s.byteOffset)&&(s.componentType=defaultValue(s.componentType,GL.UNSIGNED_SHORT),s.type=AttributeType.SCALAR,n=getBinaryAccessor(s),s=n.createArrayBufferView(e.buffer,e.byteOffset+s.byteOffset,o));let I;if(Wh(g))for(Wh(g.byteOffset)&&(g.componentType=defaultValue(g.componentType,GL.UNSIGNED_SHORT),g.type=AttributeType.SCALAR,n=getBinaryAccessor(g),g=n.createArrayBufferView(e.buffer,e.byteOffset+g.byteOffset,o)),I=new Uint16Array(o),T=0,t=0;t<o;++t)I[t]=T,T+=g[t];Wh(y)&&Wh(y.byteOffset)&&(y.componentType=defaultValue(y.componentType,GL.UNSIGNED_SHORT),y.type=AttributeType.SCALAR,n=getBinaryAccessor(y),y=n.createArrayBufferView(e.buffer,e.byteOffset+y.byteOffset,T));const R=a.length;for(t=0;t<R;++t){const he=a[t].length,ce=a[t].instances,pe=getBinaryProperties(he,ce,e);a[t].instances=combine(pe,ce)}const U=new Array(R).fill(0),Z=new Uint16Array(o);for(t=0;t<o;++t)i=s[t],Z[t]=U[i],++U[i];const Y={classes:a,classIds:s,classIndexes:Z,parentCounts:g,parentIndexes:I,parentIds:y};return zre(Y),Y}function Ky(r,e,t){if(!r)return;const i=r.parentCounts;return r.parentIds?t(r,e):i>0?Ure(r,e,t):Nre(r,e,t)}function Ure(r,e,t){const i=r.classIds,n=r.parentCounts,o=r.parentIds,a=r.parentIndexes,s=i.length,g=scratchVisited;g.length=Math.max(g.length,s);const y=++marker,T=scratchStack;for(T.length=0,T.push(e);T.length>0;){if(e=T.pop(),g[e]===y)continue;g[e]=y;const I=t(r,e);if(Wh(I))return I;const R=n[e],U=a[e];for(let Z=0;Z<R;++Z){const Y=o[U+Z];Y!==e&&T.push(Y)}}return null}function Nre(r,e,t){let i=!0;for(;i;){const n=t(r,e);if(Wh(n))return n;const o=r.parentIds[e];i=o!==e,e=o}throw new Error("traverseHierarchySingleParent")}function zre(r){const t=r.classIds.length;for(let i=0;i<t;++i)m4(r,i,stack)}function m4(r,e,t){const i=r.parentCounts,n=r.parentIds,o=r.parentIndexes,s=r.classIds.length;if(!Wh(n))return;assert(e<s,"Parent index ".concat(e," exceeds the total number of instances: ").concat(s)),assert(t.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),t.push(e);const g=Wh(i)?i[e]:1,y=Wh(i)?o[e]:e;for(let T=0;T<g;++T){const I=n[y+T];I!==e&&m4(r,I,t)}t.pop(e)}function kc(r){return r!=null}const lv=(r,e)=>r,Qre={HIERARCHY:!0,extensions:!0,extras:!0};class y4{constructor(e,t,i){var n;let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};ye(this,"json",void 0),ye(this,"binary",void 0),ye(this,"featureCount",void 0),ye(this,"_extensions",void 0),ye(this,"_properties",void 0),ye(this,"_binaryProperties",void 0),ye(this,"_hierarchy",void 0),Ls(i>=0),this.json=e||{},this.binary=t,this.featureCount=i,this._extensions=((n=this.json)===null||n===void 0?void 0:n.extensions)||{},this._properties={};for(const a in this.json)Qre[a]||(this._properties[a]=this.json[a]);this._binaryProperties=this._initializeBinaryProperties(),o["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=kre(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),Ls(typeof t=="string",t),this._hierarchy){const i=Ky(this._hierarchy,e,(n,o)=>{const a=n.classIds[o];return n.classes[a].name===t});return kc(i)}return!1}isExactClass(e,t){return Ls(typeof t=="string",t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),Ls(typeof t=="string",t),kc(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),t=kc(t)?t:[],t.length=0;const i=Object.keys(this._properties);return t.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),Ls(typeof t=="string",t),this._binaryProperties){const n=this._binaryProperties[t];if(kc(n))return this._getBinaryProperty(n,e)}const i=this._properties[t];if(kc(i))return lv(i[e]);if(this._hierarchy){const n=this._getHierarchyProperty(e,t);if(kc(n))return n}}setProperty(e,t,i){const n=this.featureCount;if(this._checkBatchId(e),Ls(typeof t=="string",t),this._binaryProperties){const a=this._binaryProperties[t];if(a){this._setBinaryProperty(a,e,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,i))return;let o=this._properties[t];kc(o)||(this._properties[t]=new Array(n),o=this._properties[t]),o[e]=lv(i)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,i){e.pack(i,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const i=this._properties[t],n=this._initializeBinaryProperty(t,i);n&&(e=e||{},e[t]=n)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const i=t;Ls(this.binary,"Property ".concat(e," requires a batch table binary.")),Ls(i.type,"Property ".concat(e," requires a type."));const n=Rre(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const i=Ky(this._hierarchy,e,(n,o)=>{const a=n.classIds[o],s=n.classes[a].instances;return kc(s[t])});return kc(i)}_getPropertyNamesInHierarchy(e,t){Ky(this._hierarchy,e,(i,n)=>{const o=i.classIds[n],a=i.classes[o].instances;for(const s in a)a.hasOwnProperty(s)&&t.indexOf(s)===-1&&t.push(s)})}_getHierarchyProperty(e,t){return Ky(this._hierarchy,e,(i,n)=>{const o=i.classIds[n],a=i.classes[o],s=i.classIndexes[n],g=a.instances[t];return kc(g)?kc(g.typedArray)?this._getBinaryProperty(g,s):lv(g[s]):null})}_setHierarchyProperty(e,t,i,n){const o=Ky(this._hierarchy,t,(a,s)=>{const g=a.classIds[s],y=a.classes[g],T=a.classIndexes[s],I=y.instances[i];return kc(I)?(Ls(s===t,'Inherited property "'.concat(i,'" is read-only.')),kc(I.typedArray)?this._setBinaryProperty(I,T,n):I[T]=lv(n),!0):!1});return kc(o)}}const wC=4;function cv(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=new DataView(e);if(r.magic=i.getUint32(t,!0),t+=wC,r.version=i.getUint32(t,!0),t+=wC,r.byteLength=i.getUint32(t,!0),t+=wC,r.version!==1)throw new Error("3D Tile Version ".concat(r.version," not supported"));return t}const Ig=4,_4="b3dm tile in legacy format.";function BC(r,e,t){const i=new DataView(e);let n;r.header=r.header||{};let o=i.getUint32(t,!0);t+=Ig;let a=i.getUint32(t,!0);t+=Ig;let s=i.getUint32(t,!0);t+=Ig;let g=i.getUint32(t,!0);return t+=Ig,s>=570425344?(t-=Ig*2,n=o,s=a,g=0,o=0,a=0,console.warn(_4)):g>=570425344&&(t-=Ig,n=s,s=o,g=a,o=0,a=0,console.warn(_4)),r.header.featureTableJsonByteLength=o,r.header.featureTableBinaryByteLength=a,r.header.batchTableJsonByteLength=s,r.header.batchTableBinaryByteLength=g,r.header.batchLength=n,t}function CC(r,e,t,i){return t=Vre(r,e,t),t=Hre(r,e,t),t}function Vre(r,e,t,i){const{featureTableJsonByteLength:n,featureTableBinaryByteLength:o,batchLength:a}=r.header;if(r.featureTableJson={BATCH_LENGTH:a||0},n>0){const s=f4(e,t,n);r.featureTableJson=JSON.parse(s)}return t+=n,r.featureTableBinary=new Uint8Array(e,t,o),t+=o,t}function Hre(r,e,t,i){const{batchTableJsonByteLength:n,batchTableBinaryByteLength:o}=r.header;if(n>0){const a=f4(e,t,n);r.batchTableJson=JSON.parse(a),t+=n,o>0&&(r.batchTableBinary=new Uint8Array(e,t,o),r.batchTableBinary=new Uint8Array(r.batchTableBinary),t+=o)}return t}function v4(r,e,t){if(!e&&(!r||!r.batchIds||!t))return null;const{batchIds:i,isRGB565:n,pointCount:o}=r;if(i&&t){const a=new Uint8ClampedArray(o*3);for(let s=0;s<o;s++){const g=i[s],T=t.getProperty(g,"dimensions").map(I=>I*255);a[s*3]=T[0],a[s*3+1]=T[1],a[s*3+2]=T[2]}return{type:Hn.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}if(n){const a=new Uint8ClampedArray(o*3);for(let s=0;s<o;s++){const g=Ire(e[s]);a[s*3]=g[0],a[s*3+1]=g[1],a[s*3+2]=g[2]}return{type:Hn.UNSIGNED_BYTE,value:a,size:3,normalized:!0}}return e&&e.length===o*3?{type:Hn.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:Hn.UNSIGNED_BYTE,value:e,size:4,normalized:!0}}const b4=new Ut;function Gre(r,e){if(!e)return null;if(r.isOctEncoded16P){const t=new Float32Array(r.pointsLength*3);for(let i=0;i<r.pointsLength;i++)Mre(e[i*2],e[i*2+1],b4),b4.toArray(t,i*3);return{type:Hn.FLOAT,size:2,value:t}}return{type:Hn.FLOAT,size:2,value:e}}function jre(r,e,t){return r.isQuantized?t["3d-tiles"]&&t["3d-tiles"].decodeQuantizedPositions?(r.isQuantized=!1,qre(r,e)):{type:Hn.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function qre(r,e){const t=new Ut,i=new Float32Array(r.pointCount*3);for(let n=0;n<r.pointCount;n++)t.set(e[n*3],e[n*3+1],e[n*3+2]).scale(1/r.quantizedRange).multiply(r.quantizedVolumeScale).add(r.quantizedVolumeOffset).toArray(i,n*3);return i}async function $re(r,e,t,i,n){t=cv(r,e,t),t=BC(r,e,t),t=CC(r,e,t),Kre(r);const{featureTable:o,batchTable:a}=Wre(r);return await eie(r,o,a,i,n),Xre(r,o,i),Zre(r,o,a),Jre(r,o),t}function Kre(r){r.attributes={positions:null,colors:null,normals:null,batchIds:null},r.isQuantized=!1,r.isTranslucent=!1,r.isRGB565=!1,r.isOctEncoded16P=!1}function Wre(r){const e=new xC(r.featureTableJson,r.featureTableBinary),t=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(t))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=t,r.featuresLength=t,r.pointsLength=t,r.pointCount=t,r.rtcCenter=e.getGlobalProperty("RTC_CENTER",Hn.FLOAT,3);const i=Yre(r,e);return{featureTable:e,batchTable:i}}function Xre(r,e,t){if(!r.attributes.positions){if(e.hasProperty("POSITION"))r.attributes.positions=e.getPropertyArray("POSITION",Hn.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){const i=e.getPropertyArray("POSITION_QUANTIZED",Hn.UNSIGNED_SHORT,3);if(r.isQuantized=!0,r.quantizedRange=65535,r.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Hn.FLOAT,3),!r.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(r.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Hn.FLOAT,3),!r.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");r.attributes.positions=jre(r,i,t)}}if(!r.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Zre(r,e,t){if(!r.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",Hn.UNSIGNED_BYTE,4),r.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",Hn.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",Hn.UNSIGNED_SHORT,1),r.isRGB565=!0),r.attributes.colors=v4(r,i,t)}e.hasProperty("CONSTANT_RGBA")&&(r.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",Hn.UNSIGNED_BYTE,4))}function Jre(r,e){if(!r.attributes.normals){let t=null;e.hasProperty("NORMAL")?t=e.getPropertyArray("NORMAL",Hn.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(t=e.getPropertyArray("NORMAL_OCT16P",Hn.UNSIGNED_BYTE,2),r.isOctEncoded16P=!0),r.attributes.normals=Gre(r,t)}}function Yre(r,e){let t=null;if(!r.batchIds&&e.hasProperty("BATCH_ID")&&(r.batchIds=e.getPropertyArray("BATCH_ID",Hn.UNSIGNED_SHORT,1),r.batchIds)){const i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:n,batchTableBinary:o}=r;t=new y4(n,o,i)}return t}async function eie(r,e,t,i,n){let o,a,s;const g=r.batchTableJson&&r.batchTableJson.extensions&&r.batchTableJson.extensions["3DTILES_draco_point_compression"];g&&(s=g.properties);const y=e.getExtension("3DTILES_draco_point_compression");if(y){a=y.properties;const I=y.byteOffset,R=y.byteLength;if(!a||!Number.isFinite(I)||!R)throw new Error("Draco properties, byteOffset, and byteLength must be defined");o=r.featureTableBinary.slice(I,I+R),r.hasPositions=Number.isFinite(a.POSITION),r.hasColors=Number.isFinite(a.RGB)||Number.isFinite(a.RGBA),r.hasNormals=Number.isFinite(a.NORMAL),r.hasBatchIds=Number.isFinite(a.BATCH_ID),r.isTranslucent=Number.isFinite(a.RGBA)}if(!o)return!0;const T={buffer:o,properties:{...a,...s},featureTableProperties:a,batchTableProperties:s,dequantizeInShader:!1};return await tie(r,T,i,n)}async function tie(r,e,t,i){const{parse:n}=i,o={...t,draco:{...t.draco,extraAttributes:e.batchTableProperties||{}}};delete o["3d-tiles"];const a=await n(e.buffer,PF,o),s=a.attributes.POSITION&&a.attributes.POSITION.value,g=a.attributes.COLOR_0&&a.attributes.COLOR_0.value,y=a.attributes.NORMAL&&a.attributes.NORMAL.value,T=a.attributes.BATCH_ID&&a.attributes.BATCH_ID.value,I=s&&a.attributes.POSITION.value.quantization,R=y&&a.attributes.NORMAL.value.quantization;if(I){const Z=a.POSITION.data.quantization,Y=Z.range;r.quantizedVolumeScale=new Ut(Y,Y,Y),r.quantizedVolumeOffset=new Ut(Z.minValues),r.quantizedRange=(1<<Z.quantizationBits)-1,r.isQuantizedDraco=!0}R&&(r.octEncodedRange=(1<<a.NORMAL.data.quantization.quantizationBits)-1,r.isOctEncodedDraco=!0);const U={};if(e.batchTableProperties)for(const Z of Object.keys(e.batchTableProperties))a.attributes[Z]&&a.attributes[Z].value&&(U[Z.toLowerCase()]=a.attributes[Z].value);r.attributes={positions:s,colors:v4(r,g,void 0),normals:y,batchIds:T,...U}}const EC={URI:0,EMBEDDED:1};function x4(r,e,t,i){r.rotateYtoZ=!0;const n=r.byteOffset+r.byteLength-t;if(n===0)throw new Error("glTF byte length must be greater than 0.");return r.gltfUpAxis=i["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",r.gltfArrayBuffer=Gw(e,t,n),r.gltfByteOffset=0,r.gltfByteLength=n,t%4===0||console.warn("".concat(r.type,": embedded glb is not aligned to a 4-byte boundary.")),r.byteOffset+r.byteLength}async function w4(r,e,t,i){const n=t["3d-tiles"]||{};if(rie(r,e),n.loadGLTF){const{parse:o,fetch:a}=i;r.gltfUrl&&(r.gltfArrayBuffer=await a(r.gltfUrl,t),r.gltfByteOffset=0),r.gltfArrayBuffer&&(r.gltf=await o(r.gltfArrayBuffer,jy,t,i),r.gpuMemoryUsageInBytes=TF(r.gltf),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength)}}function rie(r,e,t){switch(e){case EC.URI:const i=new Uint8Array(r.gltfArrayBuffer,r.gltfByteOffset),o=new TextDecoder().decode(i);r.gltfUrl=o.replace(/[\s\0]+$/,""),delete r.gltfArrayBuffer,delete r.gltfByteOffset,delete r.gltfByteLength;break;case EC.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function iie(r,e,t,i,n){var o;t=nie(r,e,t,i),await w4(r,EC.EMBEDDED,i,n);const a=r==null||(o=r.gltf)===null||o===void 0?void 0:o.extensions;return a&&a.CESIUM_RTC&&(r.rtcCenter=a.CESIUM_RTC.center),t}function nie(r,e,t,i,n){t=cv(r,e,t),t=BC(r,e,t),t=CC(r,e,t),t=x4(r,e,t,i);const o=new xC(r.featureTableJson,r.featureTableBinary);return r.rtcCenter=o.getGlobalProperty("RTC_CENTER",Hn.FLOAT,3),t}async function sie(r,e,t,i,n){return t=oie(r,e,t,i),await w4(r,r.gltfFormat,i,n),t}function oie(r,e,t,i,n){if(t=cv(r,e,t),r.version!==1)throw new Error("Instanced 3D Model version ".concat(r.version," is not supported"));t=BC(r,e,t);const o=new DataView(e);if(r.gltfFormat=o.getUint32(t,!0),t+=4,t=CC(r,e,t),t=x4(r,e,t,i),r.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new xC(r.featureTableJson,r.featureTableBinary),s=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");r.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),r.rtcCenter=a.getGlobalProperty("RTC_CENTER",Hn.FLOAT,3);const g=new y4(r.batchTableJson,r.batchTableBinary,s);return aie(r,a,g,s),t}function aie(r,e,t,i){const o={instances:new Array(i),batchTable:r._batchTable,cull:!1,url:void 0,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,forwardAxis:[1,0,0]}.instances,a=new Ut;new Ut,new Ut,new Ut;const s=new Co,g=new Cy,y=new Ut,T={},I=new Sn,R=[],U=[],Z=new Ut,Y=new Ut;for(let he=0;he<i;he++){let ce;if(e.hasProperty("POSITION"))ce=e.getProperty("POSITION",Hn.FLOAT,3,he,a);else if(e.hasProperty("POSITION_QUANTIZED")){ce=e.getProperty("POSITION_QUANTIZED",Hn.UNSIGNED_SHORT,3,he,a);const We=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",Hn.FLOAT,3,Z);if(!We)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const Ne=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",Hn.FLOAT,3,Y);if(!Ne)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const at=65535;for(let nt=0;nt<3;nt++)ce[nt]=ce[nt]/at*Ne[nt]+We[nt]}if(!ce)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(a.copy(ce),T.translation=a,r.normalUp=e.getProperty("NORMAL_UP",Hn.FLOAT,3,he,R),r.normalRight=e.getProperty("NORMAL_RIGHT",Hn.FLOAT,3,he,U),r.normalUp){if(!r.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");r.hasCustomOrientation=!0}else{if(r.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",Hn.UNSIGNED_SHORT,2,R),r.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",Hn.UNSIGNED_SHORT,2,U),r.octNormalUp)throw r.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");r.eastNorthUp?(go.WGS84.eastNorthUpToFixedFrame(a,I),I.getRotationMatrix3(s)):s.identity()}g.fromMatrix3(s),T.rotation=g,y.set(1,1,1);const pe=e.getProperty("SCALE",Hn.FLOAT,1,he);Number.isFinite(pe)&&y.multiplyByScalar(pe);const be=e.getProperty("SCALE_NON_UNIFORM",Hn.FLOAT,3,he,R);be&&y.scale(be),T.scale=y;let Te=e.getProperty("BATCH_ID",Hn.UNSIGNED_SHORT,1,he);Te===void 0&&(Te=he);const qe=new Sn().fromQuaternion(T.rotation);I.identity(),I.translate(T.translation),I.multiplyRight(qe),I.scale(T.scale);const je=I.clone();o[he]={modelMatrix:je,batchId:Te}}r.instances=o}async function lie(r,e,t,i,n,o){t=cv(r,e,t);const a=new DataView(e);for(r.tilesLength=a.getUint32(t,!0),t+=4,r.tiles=[];r.tiles.length<r.tilesLength&&r.byteLength-t>12;){const s={};r.tiles.push(s),t=await o(e,t,i,n,s)}return t}async function cie(r,e,t,i){r.rotateYtoZ=!0,r.gltfUpAxis=t["3d-tiles"]&&t["3d-tiles"].assetGltfUpAxis?t["3d-tiles"].assetGltfUpAxis:"Y";const{parse:n}=i;r.gltf=await n(e,jy,t,i),r.gpuMemoryUsageInBytes=TF(r.gltf)}async function B4(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,n=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};switch(n.byteOffset=e,n.type=Cre(r,e),n.type){case $y.COMPOSITE:return await lie(n,r,e,t,i,B4);case $y.BATCHED_3D_MODEL:return await iie(n,r,e,t,i);case $y.GLTF:return await cie(n,r,t,i);case $y.INSTANCED_3D_MODEL:return await sie(n,r,e,t,i);case $y.POINT_CLOUD:return await $re(n,r,e,t,i);default:throw new Error("3DTileLoader: unknown type ".concat(n.type))}}const uie=1952609651,hie=1;async function Aie(r,e,t){if(new Uint32Array(r.slice(0,4))[0]!==uie)throw new Error("Wrong subtree file magic number");if(new Uint32Array(r.slice(4,8))[0]!==hie)throw new Error("Wrong subtree file verson, must be 1");const o=C4(r.slice(8,16)),a=new Uint8Array(r,24,o),g=new TextDecoder("utf8").decode(a),y=JSON.parse(g),T=C4(r.slice(16,24));let I=new ArrayBuffer(0);return T&&(I=r.slice(24+o)),"bufferView"in y.tileAvailability&&(y.tileAvailability.explicitBitstream=await SC(y,"tileAvailability",I,t)),"bufferView"in y.contentAvailability&&(y.contentAvailability.explicitBitstream=await SC(y,"contentAvailability",I,t)),"bufferView"in y.childSubtreeAvailability&&(y.childSubtreeAvailability.explicitBitstream=await SC(y,"childSubtreeAvailability",I,t)),y}function die(r,e){if(e.startsWith("http")){const o=new URL(r,e);return decodeURI(o.toString())}const i="http://".concat(e),n=new URL(r,i);return"/".concat(n.host).concat(n.pathname)}async function SC(r,e,t,i){const n=r[e].bufferView,o=r.bufferViews[n],a=r.buffers[o.buffer];if(!(i!=null&&i.url)||!i.fetch)throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(a.uri){const s=die(a.uri,i==null?void 0:i.url),y=await(await i.fetch(s)).arrayBuffer();return new Uint8Array(y,o.byteOffset,o.byteLength)}return new Uint8Array(t,o.byteOffset,o.byteLength)}function C4(r){const e=new DataView(r),t=e.getUint32(0,!0),i=e.getUint32(4,!0);return t+2**32*i}const E4={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:d4,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:Aie,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Du=null;try{Du=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ms(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}ms.prototype.__isLong__,Object.defineProperty(ms.prototype,"__isLong__",{value:!0});function Dl(r){return(r&&r.__isLong__)===!0}function S4(r){var e=Math.clz32(r&-r);return r?31-e:e}ms.isLong=Dl;var T4={},I4={};function Rf(r,e){var t,i,n;return e?(r>>>=0,(n=0<=r&&r<256)&&(i=I4[r],i)?i:(t=es(r,0,!0),n&&(I4[r]=t),t)):(r|=0,(n=-128<=r&&r<128)&&(i=T4[r],i)?i:(t=es(r,r<0?-1:0,!1),n&&(T4[r]=t),t))}ms.fromInt=Rf;function Ru(r,e){if(isNaN(r))return e?OA:Ah;if(e){if(r<0)return OA;if(r>=M4)return k4}else{if(r<=-P4)return Oc;if(r+1>=P4)return R4}return r<0?Ru(-r,e).neg():es(r%Lg|0,r/Lg|0,e)}ms.fromNumber=Ru;function es(r,e,t){return new ms(r,e,t)}ms.fromBits=es;var uv=Math.pow;function TC(r,e,t){if(r.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return e?OA:Ah;if(t=t||10,t<2||36<t)throw RangeError("radix");var i;if((i=r.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return TC(r.substring(1),e,t).neg();for(var n=Ru(uv(t,8)),o=Ah,a=0;a<r.length;a+=8){var s=Math.min(8,r.length-a),g=parseInt(r.substring(a,a+s),t);if(s<8){var y=Ru(uv(t,s));o=o.mul(y).add(Ru(g))}else o=o.mul(n),o=o.add(Ru(g))}return o.unsigned=e,o}ms.fromString=TC;function hh(r,e){return typeof r=="number"?Ru(r,e):typeof r=="string"?TC(r,e):es(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}ms.fromValue=hh;var L4=65536,fie=1<<24,Lg=L4*L4,M4=Lg*Lg,P4=M4/2,F4=Rf(fie),Ah=Rf(0);ms.ZERO=Ah;var OA=Rf(0,!0);ms.UZERO=OA;var Mg=Rf(1);ms.ONE=Mg;var D4=Rf(1,!0);ms.UONE=D4;var IC=Rf(-1);ms.NEG_ONE=IC;var R4=es(-1,2147483647,!1);ms.MAX_VALUE=R4;var k4=es(-1,-1,!0);ms.MAX_UNSIGNED_VALUE=k4;var Oc=es(0,-2147483648,!1);ms.MIN_VALUE=Oc;var Or=ms.prototype;Or.toInt=function(){return this.unsigned?this.low>>>0:this.low},Or.toNumber=function(){return this.unsigned?(this.high>>>0)*Lg+(this.low>>>0):this.high*Lg+(this.low>>>0)},Or.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Oc)){var t=Ru(e),i=this.div(t),n=i.mul(t).sub(this);return i.toString(e)+n.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=Ru(uv(e,6),this.unsigned),a=this,s="";;){var g=a.div(o),y=a.sub(g.mul(o)).toInt()>>>0,T=y.toString(e);if(a=g,a.isZero())return T+s;for(;T.length<6;)T="0"+T;s=""+T+s}},Or.getHighBits=function(){return this.high},Or.getHighBitsUnsigned=function(){return this.high>>>0},Or.getLowBits=function(){return this.low},Or.getLowBitsUnsigned=function(){return this.low>>>0},Or.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Oc)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1},Or.isZero=function(){return this.high===0&&this.low===0},Or.eqz=Or.isZero,Or.isNegative=function(){return!this.unsigned&&this.high<0},Or.isPositive=function(){return this.unsigned||this.high>=0},Or.isOdd=function(){return(this.low&1)===1},Or.isEven=function(){return(this.low&1)===0},Or.equals=function(e){return Dl(e)||(e=hh(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},Or.eq=Or.equals,Or.notEquals=function(e){return!this.eq(e)},Or.neq=Or.notEquals,Or.ne=Or.notEquals,Or.lessThan=function(e){return this.comp(e)<0},Or.lt=Or.lessThan,Or.lessThanOrEqual=function(e){return this.comp(e)<=0},Or.lte=Or.lessThanOrEqual,Or.le=Or.lessThanOrEqual,Or.greaterThan=function(e){return this.comp(e)>0},Or.gt=Or.greaterThan,Or.greaterThanOrEqual=function(e){return this.comp(e)>=0},Or.gte=Or.greaterThanOrEqual,Or.ge=Or.greaterThanOrEqual,Or.compare=function(e){if(Dl(e)||(e=hh(e)),this.eq(e))return 0;var t=this.isNegative(),i=e.isNegative();return t&&!i?-1:!t&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},Or.comp=Or.compare,Or.negate=function(){return!this.unsigned&&this.eq(Oc)?Oc:this.not().add(Mg)},Or.neg=Or.negate,Or.add=function(e){Dl(e)||(e=hh(e));var t=this.high>>>16,i=this.high&65535,n=this.low>>>16,o=this.low&65535,a=e.high>>>16,s=e.high&65535,g=e.low>>>16,y=e.low&65535,T=0,I=0,R=0,U=0;return U+=o+y,R+=U>>>16,U&=65535,R+=n+g,I+=R>>>16,R&=65535,I+=i+s,T+=I>>>16,I&=65535,T+=t+a,T&=65535,es(R<<16|U,T<<16|I,this.unsigned)},Or.subtract=function(e){return Dl(e)||(e=hh(e)),this.add(e.neg())},Or.sub=Or.subtract,Or.multiply=function(e){if(this.isZero())return this;if(Dl(e)||(e=hh(e)),Du){var t=Du.mul(this.low,this.high,e.low,e.high);return es(t,Du.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?OA:Ah;if(this.eq(Oc))return e.isOdd()?Oc:Ah;if(e.eq(Oc))return this.isOdd()?Oc:Ah;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(F4)&&e.lt(F4))return Ru(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,n=this.high&65535,o=this.low>>>16,a=this.low&65535,s=e.high>>>16,g=e.high&65535,y=e.low>>>16,T=e.low&65535,I=0,R=0,U=0,Z=0;return Z+=a*T,U+=Z>>>16,Z&=65535,U+=o*T,R+=U>>>16,U&=65535,U+=a*y,R+=U>>>16,U&=65535,R+=n*T,I+=R>>>16,R&=65535,R+=o*y,I+=R>>>16,R&=65535,R+=a*g,I+=R>>>16,R&=65535,I+=i*T+n*y+o*g+a*s,I&=65535,es(U<<16|Z,I<<16|R,this.unsigned)},Or.mul=Or.multiply,Or.divide=function(e){if(Dl(e)||(e=hh(e)),e.isZero())throw Error("division by zero");if(Du){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Du.div_u:Du.div_s)(this.low,this.high,e.low,e.high);return es(t,Du.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?OA:Ah;var i,n,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return OA;if(e.gt(this.shru(1)))return D4;o=OA}else{if(this.eq(Oc)){if(e.eq(Mg)||e.eq(IC))return Oc;if(e.eq(Oc))return Mg;var a=this.shr(1);return i=a.div(e).shl(1),i.eq(Ah)?e.isNegative()?Mg:IC:(n=this.sub(e.mul(i)),o=i.add(n.div(e)),o)}else if(e.eq(Oc))return this.unsigned?OA:Ah;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=Ah}for(n=this;n.gte(e);){i=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(i)/Math.LN2),g=s<=48?1:uv(2,s-48),y=Ru(i),T=y.mul(e);T.isNegative()||T.gt(n);)i-=g,y=Ru(i,this.unsigned),T=y.mul(e);y.isZero()&&(y=Mg),o=o.add(y),n=n.sub(T)}return o},Or.div=Or.divide,Or.modulo=function(e){if(Dl(e)||(e=hh(e)),Du){var t=(this.unsigned?Du.rem_u:Du.rem_s)(this.low,this.high,e.low,e.high);return es(t,Du.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},Or.mod=Or.modulo,Or.rem=Or.modulo,Or.not=function(){return es(~this.low,~this.high,this.unsigned)},Or.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},Or.clz=Or.countLeadingZeros,Or.countTrailingZeros=function(){return this.low?S4(this.low):S4(this.high)+32},Or.ctz=Or.countTrailingZeros,Or.and=function(e){return Dl(e)||(e=hh(e)),es(this.low&e.low,this.high&e.high,this.unsigned)},Or.or=function(e){return Dl(e)||(e=hh(e)),es(this.low|e.low,this.high|e.high,this.unsigned)},Or.xor=function(e){return Dl(e)||(e=hh(e)),es(this.low^e.low,this.high^e.high,this.unsigned)},Or.shiftLeft=function(e){return Dl(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?es(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):es(0,this.low<<e-32,this.unsigned)},Or.shl=Or.shiftLeft,Or.shiftRight=function(e){return Dl(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?es(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):es(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},Or.shr=Or.shiftRight,Or.shiftRightUnsigned=function(e){return Dl(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?es(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?es(this.high,0,this.unsigned):es(this.high>>>e-32,0,this.unsigned)},Or.shru=Or.shiftRightUnsigned,Or.shr_u=Or.shiftRightUnsigned,Or.rotateLeft=function(e){var t;return Dl(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?es(this.high,this.low,this.unsigned):e<32?(t=32-e,es(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,es(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},Or.rotl=Or.rotateLeft,Or.rotateRight=function(e){var t;return Dl(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?es(this.high,this.low,this.unsigned):e<32?(t=32-e,es(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,es(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},Or.rotr=Or.rotateRight,Or.toSigned=function(){return this.unsigned?es(this.low,this.high,!1):this},Or.toUnsigned=function(){return this.unsigned?this:es(this.low,this.high,!0)},Or.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},Or.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},Or.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},ms.fromBytes=function(e,t,i){return i?ms.fromBytesLE(e,t):ms.fromBytesBE(e,t)},ms.fromBytesLE=function(e,t){return new ms(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},ms.fromBytesBE=function(e,t){return new ms(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const pie=16;function O4(r){r==="X"&&(r="");const e=r.padEnd(pie,"0");return ms.fromString(e,!0,16)}function gie(r){if(r.isZero())return"X";let e=r.countTrailingZeros();const t=e%4;e=(e-t)/4;const i=e;e*=4;const o=r.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-i-o.length).join("0")+o}function mie(r,e){const t=yie(r).shiftRightUnsigned(2);return r.add(ms.fromNumber(2*e+1-4).multiply(t))}function yie(r){return r.and(r.not().add(1))}const _ie=3,vie=2*30+1,U4=180/Math.PI;function bie(r){if(r.length===0)throw new Error("Invalid Hilbert quad key ".concat(r));const e=r.split("/"),t=parseInt(e[0],10),i=e[1],n=i.length;let o=0;const a=[0,0];for(let s=n-1;s>=0;s--){o=n-s;const g=i[s];let y=0,T=0;g==="1"?T=1:g==="2"?(y=1,T=1):g==="3"&&(y=1);const I=Math.pow(2,o-1);wie(I,a,y,T),a[0]+=I*y,a[1]+=I*T}if(t%2===1){const s=a[0];a[0]=a[1],a[1]=s}return{face:t,ij:a,level:o}}function xie(r){if(r.isZero())return"";let e=r.toString(2);for(;e.length<_ie+vie;)e="0"+e;const t=e.lastIndexOf("1"),i=e.substring(0,3),n=e.substring(3,t),o=n.length/2,a=ms.fromString(i,!0,2).toString(10);let s="";if(o!==0)for(s=ms.fromString(n,!0,2).toString(4);s.length<o;)s="0"+s;return"".concat(a,"/").concat(s)}function N4(r,e,t){const i=1<<e;return[(r[0]+t[0])/i,(r[1]+t[1])/i]}function z4(r){return r>=.5?1/3*(4*r*r-1):1/3*(1-4*(1-r)*(1-r))}function Q4(r){return[z4(r[0]),z4(r[1])]}function V4(r,e){let[t,i]=e;switch(r){case 0:return[1,t,i];case 1:return[-t,1,i];case 2:return[-t,-i,1];case 3:return[-1,-i,-t];case 4:return[i,-1,-t];case 5:return[i,t,-1];default:throw new Error("Invalid face")}}function H4(r){let[e,t,i]=r;const n=Math.atan2(i,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*U4,n*U4]}function wie(r,e,t,i){if(i===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const n=e[0];e[0]=e[1],e[1]=n}}function Bie(r){const e=N4(r.ij,r.level,[.5,.5]),t=Q4(e),i=V4(r.face,t);return H4(i)}const Cie=100;function G4(r){const{face:e,ij:t,level:i}=r,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],o=Math.max(1,Math.ceil(Cie*Math.pow(2,-i))),a=new Float64Array(4*o*2+2);let s=0,g=0;for(let y=0;y<4;y++){const T=n[y].slice(0),I=n[y+1],R=(I[0]-T[0])/o,U=(I[1]-T[1])/o;for(let Z=0;Z<o;Z++){T[0]+=R,T[1]+=U;const Y=N4(t,i,T),he=Q4(Y),ce=V4(e,he),pe=H4(ce);Math.abs(pe[1])>89.999&&(pe[0]=g);const be=pe[0]-g;pe[0]+=be>180?-360:be<-180?360:0,a[s++]=pe[0],a[s++]=pe[1],g=pe[0]}}return a[s++]=a[0],a[s++]=a[1],a}function LC(r){const e=Eie(r);return bie(e)}function Eie(r){if(r.indexOf("/")>0)return r;const e=O4(r);return xie(e)}function Sie(r){const e=LC(r);return Bie(e)}function Tie(r){let e;if(r.face===2||r.face===5){let t=null,i=0;for(let n=0;n<4;n++){const o="".concat(r.face,"/").concat(n),a=LC(o),s=G4(a);(typeof t>"u"||t===null)&&(t=new Float64Array(4*s.length)),t.set(s,i),i+=s.length}e=j4(t)}else{const t=G4(r);e=j4(t)}return e}function j4(r){if(r.length%2!==0)throw new Error("Invalid corners");const e=[],t=[];for(let i=0;i<r.length;i+=2)e.push(r[i]),t.push(r[i+1]);return e.sort((i,n)=>i-n),t.sort((i,n)=>i-n),{west:e[0],east:e[e.length-1],north:t[t.length-1],south:t[0]}}function Iie(r,e){const t=(e==null?void 0:e.minimumHeight)||0,i=(e==null?void 0:e.maximumHeight)||0,n=LC(r),o=Tie(n),a=o.west,s=o.south,g=o.east,y=o.north,T=[];return T.push(new Ut(a,y,t)),T.push(new Ut(g,y,t)),T.push(new Ut(g,s,t)),T.push(new Ut(a,s,t)),T.push(new Ut(a,y,i)),T.push(new Ut(g,y,i)),T.push(new Ut(g,s,i)),T.push(new Ut(a,s,i)),T}function q4(r){const e=r.token,t={minimumHeight:r.minimumHeight,maximumHeight:r.maximumHeight},i=Iie(e,t),n=Sie(e),o=n[0],a=n[1],s=go.WGS84.cartographicToCartesian([o,a,t.maximumHeight]),g=new Ut(s[0],s[1],s[2]);i.push(g);const y=lJ(i);return[...y.center,...y.halfAxes]}const Lie={QUADTREE:4,OCTREE:8};function Mie(r,e,t){if(r!=null&&r.box){const i=O4(r.s2VolumeInfo.token),n=mie(i,e),o=gie(n),a={...r.s2VolumeInfo};switch(a.token=o,t){case"OCTREE":const y=r.s2VolumeInfo,T=y.maximumHeight-y.minimumHeight,I=T/2,R=y.minimumHeight+T/2;y.minimumHeight=R-I,y.maximumHeight=R+I;break}return{box:q4(a),s2VolumeInfo:a}}}async function $4(r){const{options:e,parentData:t={mortonIndex:0,x:0,y:0,z:0},childIndex:i=0,globalData:n={level:0,mortonIndex:0,x:0,y:0,z:0},s2VolumeBox:o}=r;let{subtree:a,level:s=0}=r;const{subdivisionScheme:g,subtreeLevels:y,maximumLevel:T,contentUrlTemplate:I,subtreesUriTemplate:R,basePath:U}=e,Z={children:[],lodMetricValue:0,contentUrl:""},Y=Lie[g],he=i&1,ce=i>>1&1,pe=i>>2&1,be=(Y**s-1)/(Y-1);let Te=kf(t.mortonIndex,i),qe=be+Te,je=kf(t.x,he),We=kf(t.y,ce),Ne=kf(t.z,pe),at=!1;s+1>y&&(at=MC(a.childSubtreeAvailability,Te));const nt=kf(n.x,je),ke=kf(n.y,We),De=kf(n.z,Ne),Ye=s+n.level;if(at){const bt="".concat(U,"/").concat(R),Rt=PC(bt,Ye,nt,ke,De);a=await ud(Rt,E4),n.mortonIndex=Te,n.x=je,n.y=We,n.z=Ne,n.level=s,Te=0,qe=0,je=0,We=0,Ne=0,s=0}if(!MC(a.tileAvailability,qe)||s>T)return Z;MC(a.contentAvailability,qe)&&(Z.contentUrl=PC(I,Ye,nt,ke,De));const Et=s+1,Pt={mortonIndex:Te,x:je,y:We,z:Ne};for(let bt=0;bt<Y;bt++){const Rt=Mie(o,bt,g),Ft=await $4({subtree:a,options:e,parentData:Pt,childIndex:bt,level:Et,globalData:n,s2VolumeBox:Rt});if(Ft.contentUrl||Ft.children.length){const Zt=Ye+1,Ze=Pie(Ft,Zt,{childTileX:je,childTileY:We,childTileZ:Ne},e,o);Z.children.push(Ze)}}return Z}function MC(r,e){return"constant"in r?!!r.constant:r.explicitBitstream?Rie(e,r.explicitBitstream):!1}function Pie(r,e,t,i,n){const{basePath:o,refine:a,getRefine:s,lodMetricType:g,getTileType:y,rootLodMetricValue:T,rootBoundingVolume:I}=i,R=r.contentUrl&&r.contentUrl.replace("".concat(o,"/"),""),U=T/2**e,Z=n!=null&&n.box?{box:n.box}:I,Y=Fie(e,Z,t);return{children:r.children,contentUrl:r.contentUrl,content:{uri:R},id:r.contentUrl,refine:s(a),type:y(r),lodMetricType:g,lodMetricValue:U,geometricError:U,transform:r.transform,boundingVolume:Y}}function Fie(r,e,t){if(e.region){const{childTileX:i,childTileY:n,childTileZ:o}=t,[a,s,g,y,T,I]=e.region,R=2**r,U=(g-a)/R,Z=(y-s)/R,Y=(I-T)/R,[he,ce]=[a+U*i,a+U*(i+1)],[pe,be]=[s+Z*n,s+Z*(n+1)],[Te,qe]=[T+Y*o,T+Y*(o+1)];return{region:[he,pe,ce,be,Te,qe]}}if(e.box)return e;throw new Error("Unsupported bounding volume type ".concat(e))}function kf(r,e){return parseInt(r.toString(2)+e.toString(2),2)}function PC(r,e,t,i,n){const o=Die({level:e,x:t,y:i,z:n});return r.replace(/{level}|{x}|{y}|{z}/gi,a=>o[a])}function Die(r){const e={};for(const t in r)e["{".concat(t,"}")]=r[t];return e}function Rie(r,e){const t=Math.floor(r/8),i=r%8;return(e[t]>>i&1)===1}function FC(r){if(!r.contentUrl)return Tg.EMPTY;const t=r.contentUrl.split("?")[0].split(".").pop();switch(t){case"pnts":return Tg.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Tg.SCENEGRAPH;default:return t}}function DC(r){switch(r){case"REPLACE":case"replace":return kA.REPLACE;case"ADD":case"add":return kA.ADD;default:return r}}function RC(r,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){const i=new URL(r,"".concat(e,"/"));return decodeURI(i.toString())}else if(r.startsWith("/"))return r;return"".concat(e,"/").concat(r)}function K4(r,e){if(!r)return null;if(r.content){const t=r.content.uri||r.content.url;r.contentUrl=RC(t,e.basePath)}return r.id=r.contentUrl,r.lodMetricType=nv.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform,r.type=FC(r),r.refine=DC(r.refine),r}async function kie(r,e){const t=r.basePath;let i;const n=X4(r==null?void 0:r.root);n&&r.root?i=await W4(r.root,r,n,e):i=K4(r.root,r);const o=[];for(o.push(i);o.length>0;){const s=(o.pop()||{}).children||[];for(let g of s){const y=X4(g);y?g=await W4(g,r,y,e):K4(g,{basePath:t}),o.push(g)}}return i}async function W4(r,e,t,i){var n,o;const a=e.basePath,{subdivisionScheme:s,maximumLevel:g,subtreeLevels:y,subtrees:{uri:T}}=t,I=PC(T,0,0,0,0),R=RC(I,a),U=await ud(R,E4,i),Z=RC(r.content.uri,a),Y=e==null||(n=e.root)===null||n===void 0?void 0:n.refine,he=r.geometricError,ce=(o=r.boundingVolume.extensions)===null||o===void 0?void 0:o["3DTILES_bounding_volume_S2"];if(ce){const qe={box:q4(ce),s2VolumeInfo:ce};r.boundingVolume=qe}const pe=r.boundingVolume,be={contentUrlTemplate:Z,subtreesUriTemplate:T,subdivisionScheme:s,subtreeLevels:y,maximumLevel:g,refine:Y,basePath:a,lodMetricType:nv.GEOMETRIC_ERROR,rootLodMetricValue:he,rootBoundingVolume:pe,getTileType:FC,getRefine:DC};return await Oie(r,U,be)}async function Oie(r,e,t){if(!r)return null;r.lodMetricType=nv.GEOMETRIC_ERROR,r.lodMetricValue=r.geometricError,r.transformMatrix=r.transform;const{children:i,contentUrl:n}=await $4({subtree:e,options:t,s2VolumeBox:r});return n&&(r.contentUrl=n,r.content={uri:n.replace("".concat(t.basePath,"/"),"")}),r.refine=DC(r.refine),r.type=FC(r),r.children=i,r.id=r.contentUrl,r}function X4(r){var e;return(r==null||(e=r.extensions)===null||e===void 0?void 0:e["3DTILES_implicit_tiling"])||(r==null?void 0:r.implicitTiling)}const kC={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:d4,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Qie,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function Uie(r){return jw(r.url)}async function Nie(r,e,t){const i={content:{featureIds:null}};return await B4(r,0,e,t,i.content),i.content}async function zie(r,e,t){var i;const n=JSON.parse(new TextDecoder().decode(r));return n.loader=e.loader||kC,n.url=t.url,n.queryString=t.queryString,n.basePath=Uie(n),n.root=await kie(n,e),n.type=Fu.TILES3D,n.lodMetricType=nv.GEOMETRIC_ERROR,n.lodMetricValue=((i=n.root)===null||i===void 0?void 0:i.lodMetricValue)||0,n}async function Qie(r,e,t){const i=e["3d-tiles"]||{};let n;return i.isTileset==="auto"?n=t.url&&t.url.indexOf(".json")!==-1:n=i.isTileset,n?r=await zie(r,e,t):r=await Nie(r,e,t),r}const Z4=[0],Vie={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:kC,onTilesetLoad:{type:"function",value:r=>{}},onTileLoad:{type:"function",value:r=>{}},onTileUnload:{type:"function",value:r=>{}},onTileError:{type:"function",value:(r,e,t)=>{}},_getMeshColor:{type:"function",value:r=>[255,255,255]}};class OC extends RP{constructor(){super(...arguments),ye(this,"state",void 0)}initializeState(){"onTileLoadFail"in this.props&&On.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){var e,t;return!!(!((e=this.state)===null||e===void 0||(t=e.tileset3d)===null||t===void 0)&&t.isLoaded()&&super.isLoaded)}shouldUpdateState(e){let{changeFlags:t}=e;return t.somethingChanged}updateState(e){let{props:t,oldProps:i,changeFlags:n}=e;if(t.data&&t.data!==i.data&&this._loadTileset(t.data),n.viewportChanged){const{activeViewports:o}=this.state;Object.keys(o).length&&(this._updateTileset(o),this.state.lastUpdatedViewports=o,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:o}=this.state;for(const a in o)o[a].needsUpdate=!0}}activateViewport(e){const{activeViewports:t,lastUpdatedViewports:i}=this.state;this.internalState.viewport=e,t[e.id]=e;const n=i==null?void 0:i[e.id];(!n||!e.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo(e){let{info:t,sourceLayer:i}=e;const n=i&&i.props.tile;return t.picked&&(t.object=n),t.sourceTile=n,t}filterSubLayer(e){let{layer:t,viewport:i}=e;const{tile:n}=t.props,{id:o}=i;return n.selected&&n.viewportIds.includes(o)}_updateAutoHighlight(e){const t=e.sourceTile,i=this.state.layerMap[t==null?void 0:t.id];i&&i.layer&&i.layer.updateAutoHighlight(e)}async _loadTileset(e){const{loadOptions:t={}}=this.props;let i=this.props.loader||this.props.loaders;Array.isArray(i)&&(i=i[0]);const n={loadOptions:{...t}};let o=e;if(i.preload){const g=await i.preload(e,t);g.url&&(o=g.url),g.headers&&(n.loadOptions.fetch={...n.loadOptions.fetch,headers:g.headers}),Object.assign(n,g)}const a=await ud(o,i,n.loadOptions),s=new Bre(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...n});this.setState({tileset3d:s,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(s)}_onTileLoad(e){const{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;const{tileset3d:t}=this.state,{timeline:i}=this.context,n=Object.keys(e).length;!i||!n||!t||t.selectTiles(Object.values(e)).then(o=>{this.state.frameNumber!==o&&this.setState({frameNumber:o})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case Tg.POINTCLOUD:return this._makePointCloudLayer(e,t);case Tg.SCENEGRAPH:return this._make3DModelLayer(e);case Tg.MESH:return this._makeSimpleMeshLayer(e,t);default:throw new Error("Tile3DLayer: Failed to render layer of type ".concat(e.content.type))}}_makePointCloudLayer(e,t){const{attributes:i,pointCount:n,constantRGBA:o,cartographicOrigin:a,modelMatrix:s}=e.content,{positions:g,normals:y,colors:T}=i;if(!g)return null;const I=t&&t.props.data||{header:{vertexCount:n},attributes:{POSITION:g,NORMAL:y,COLOR_0:T}},{pointSize:R,getPointColor:U}=this.props,Z=this.getSubLayerClass("pointcloud",QB);return new Z({pointSize:R},this.getSubLayerProps({id:"pointcloud"}),{id:"".concat(this.id,"-pointcloud-").concat(e.id),tile:e,data:I,coordinateSystem:Mn.METER_OFFSETS,coordinateOrigin:a,modelMatrix:s,getColor:o||U,_offset:0})}_make3DModelLayer(e){const{gltf:t,instances:i,cartographicOrigin:n,modelMatrix:o}=e.content,a=this.getSubLayerClass("scenegraph",oC);return new a({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:"".concat(this.id,"-scenegraph-").concat(e.id),tile:e,data:i||Z4,scenegraph:t,coordinateSystem:Mn.METER_OFFSETS,coordinateOrigin:n,modelMatrix:o,getTransformMatrix:s=>s.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){const i=e.content,{attributes:n,indices:o,modelMatrix:a,cartographicOrigin:s,coordinateSystem:g=Mn.METER_OFFSETS,material:y,featureIds:T}=i,{_getMeshColor:I}=this.props,R=t&&t.props.mesh||new Ty({drawMode:4,attributes:Hie(n),indices:o}),U=this.getSubLayerClass("mesh",aC);return new U(this.getSubLayerProps({id:"mesh"}),{id:"".concat(this.id,"-mesh-").concat(e.id),tile:e,mesh:R,data:Z4,getColor:I(e),pbrMaterial:y,modelMatrix:a,coordinateOrigin:s,coordinateSystem:g,featureIds:T,_offset:0})}renderLayers(){const{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(i=>{const n=t[i.id]=t[i.id]||{tile:i};let{layer:o}=n;return i.selected&&(o?n.needsUpdate&&(o=this._getSubLayer(i,o),n.needsUpdate=!1):o=this._getSubLayer(i)),n.layer=o,o}).filter(Boolean):null}}ye(OC,"defaultProps",Vie),ye(OC,"layerName","Tile3DLayer");function Hie(r){const e={};return e.positions={...r.positions,value:new Float32Array(r.positions.value)},r.normals&&(e.normals=r.normals),r.texCoords&&(e.texCoords=r.texCoords),r.colors&&(e.colors=r.colors),r.uvRegions&&(e.uvRegions=r.uvRegions),e}var J4={exports:{}};(function(r,e){(function(t,i){r.exports=i()})(mf,function(){var t,i,n;function o(s,g){if(!t)t=g;else if(!i)i=g;else{var y="var sharedChunk = {}; ("+t+")(sharedChunk); ("+i+")(sharedChunk);",T={};t(T),n=g(T),typeof window<"u"&&(n.workerUrl=window.URL.createObjectURL(new Blob([y],{type:"text/javascript"})))}}o(["exports"],function(s){function g(h,c,d,v){return new(d||(d=Promise))(function(S,P){function k(ee){try{W(v.next(ee))}catch(ae){P(ae)}}function G(ee){try{W(v.throw(ee))}catch(ae){P(ae)}}function W(ee){var ae;ee.done?S(ee.value):(ae=ee.value,ae instanceof d?ae:new d(function(fe){fe(ae)})).then(k,G)}W((v=v.apply(h,c||[])).next())})}function y(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}typeof SuppressedError=="function"&&SuppressedError;var T=I;function I(h,c){this.x=h,this.y=c}I.prototype={clone:function(){return new I(this.x,this.y)},add:function(h){return this.clone()._add(h)},sub:function(h){return this.clone()._sub(h)},multByPoint:function(h){return this.clone()._multByPoint(h)},divByPoint:function(h){return this.clone()._divByPoint(h)},mult:function(h){return this.clone()._mult(h)},div:function(h){return this.clone()._div(h)},rotate:function(h){return this.clone()._rotate(h)},rotateAround:function(h,c){return this.clone()._rotateAround(h,c)},matMult:function(h){return this.clone()._matMult(h)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(h){return this.x===h.x&&this.y===h.y},dist:function(h){return Math.sqrt(this.distSqr(h))},distSqr:function(h){var c=h.x-this.x,d=h.y-this.y;return c*c+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith:function(h){return this.angleWithSep(h.x,h.y)},angleWithSep:function(h,c){return Math.atan2(this.x*c-this.y*h,this.x*h+this.y*c)},_matMult:function(h){var c=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=c,this},_add:function(h){return this.x+=h.x,this.y+=h.y,this},_sub:function(h){return this.x-=h.x,this.y-=h.y,this},_mult:function(h){return this.x*=h,this.y*=h,this},_div:function(h){return this.x/=h,this.y/=h,this},_multByPoint:function(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint:function(h){return this.x/=h.x,this.y/=h.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var h=this.y;return this.y=this.x,this.x=-h,this},_rotate:function(h){var c=Math.cos(h),d=Math.sin(h),v=d*this.x+c*this.y;return this.x=c*this.x-d*this.y,this.y=v,this},_rotateAround:function(h,c){var d=Math.cos(h),v=Math.sin(h),S=c.y+v*(this.x-c.x)+d*(this.y-c.y);return this.x=c.x+d*(this.x-c.x)-v*(this.y-c.y),this.y=S,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},I.convert=function(h){return h instanceof I?h:Array.isArray(h)?new I(h[0],h[1]):h};var R=y(T),U=Z;function Z(h,c,d,v){this.cx=3*h,this.bx=3*(d-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(v-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=c,this.p2x=d,this.p2y=v}Z.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,c){if(c===void 0&&(c=1e-6),h<0)return 0;if(h>1)return 1;for(var d=h,v=0;v<8;v++){var S=this.sampleCurveX(d)-h;if(Math.abs(S)<c)return d;var P=this.sampleCurveDerivativeX(d);if(Math.abs(P)<1e-6)break;d-=S/P}var k=0,G=1;for(d=h,v=0;v<20&&(S=this.sampleCurveX(d),!(Math.abs(S-h)<c));v++)h>S?k=d:G=d,d=.5*(G-k)+k;return d},solve:function(h,c){return this.sampleCurveY(this.solveCurveX(h,c))}};var Y=y(U);let he,ce;function pe(){return he==null&&(he=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),he}function be(){if(ce==null&&(ce=!1,pe())){const c=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(c){for(let v=0;v<5*5;v++){const S=4*v;c.fillStyle=`rgb(${S},${S+1},${S+2})`,c.fillRect(v%5,Math.floor(v/5),1,1)}const d=c.getImageData(0,0,5,5).data;for(let v=0;v<5*5*4;v++)if(v%4!=3&&d[v]!==v){ce=!0;break}}}return ce||!1}function Te(h,c,d,v){const S=new Y(h,c,d,v);return function(P){return S.solve(P)}}const qe=Te(.25,.1,.25,1);function je(h,c,d){return Math.min(d,Math.max(c,h))}function We(h,c,d){const v=d-c,S=((h-c)%v+v)%v+c;return S===c?d:S}function Ne(h){for(var c=arguments.length,d=new Array(c>1?c-1:0),v=1;v<c;v++)d[v-1]=arguments[v];for(const S of d)for(const P in S)h[P]=S[P];return h}let at=1;function nt(h,c,d){const v={};for(const S in h)v[S]=c.call(d||this,h[S],S,h);return v}function ke(h,c,d){const v={};for(const S in h)c.call(d||this,h[S],S,h)&&(v[S]=h[S]);return v}function De(h){return Array.isArray(h)?h.map(De):typeof h=="object"&&h?nt(h,De):h}const Ye={};function Xe(h){Ye[h]||(typeof console<"u"&&console.warn(h),Ye[h]=!0)}function Ct(h,c,d){return(d.y-h.y)*(c.x-h.x)>(c.y-h.y)*(d.x-h.x)}function Et(h){let c=0;for(let d,v,S=0,P=h.length,k=P-1;S<P;k=S++)d=h[S],v=h[k],c+=(v.x-d.x)*(d.y+v.y);return c}function Pt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let bt=null;function Rt(h){return typeof ImageBitmap<"u"&&h instanceof ImageBitmap}const Ft="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Zt(h,c,d,v,S){return g(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const P=new VideoFrame(h,{timestamp:0});try{const k=P==null?void 0:P.format;if(!k||!k.startsWith("BGR")&&!k.startsWith("RGB"))throw new Error(`Unrecognized format ${k}`);const G=k.startsWith("BGR"),W=new Uint8ClampedArray(v*S*4);if(yield P.copyTo(W,function(ee,ae,fe,me,Ce){const Me=4*Math.max(-ae,0),Ue=(Math.max(0,fe)-fe)*me*4+Me,$e=4*me,Ke=Math.max(0,ae),ut=Math.max(0,fe);return{rect:{x:Ke,y:ut,width:Math.min(ee.width,ae+me)-Ke,height:Math.min(ee.height,fe+Ce)-ut},layout:[{offset:Ue,stride:$e}]}}(h,c,d,v,S)),G)for(let ee=0;ee<W.length;ee+=4){const ae=W[ee];W[ee]=W[ee+2],W[ee+2]=ae}return W}finally{P.close()}})}let Le,Ze,rt,pt;const mt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(h){const c=requestAnimationFrame(h);return{cancel:()=>cancelAnimationFrame(c)}},getImageData(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return this.getImageCanvasContext(h).getImageData(-c,-c,h.width+2*c,h.height+2*c)},getImageCanvasContext(h){const c=window.document.createElement("canvas"),d=c.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return c.width=h.width,c.height=h.height,d.drawImage(h,0,0,h.width,h.height),d},resolveURL:h=>(rt||(rt=document.createElement("a")),rt.href=h,rt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(pt==null&&(pt=matchMedia("(prefers-reduced-motion: reduce)")),pt.matches)}},Bt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Dt extends Error{constructor(c,d,v,S){super(`AJAXError: ${d} (${c}): ${v}`),this.status=c,this.statusText=d,this.url=v,this.body=S}}const Mt=Pt()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,qt=h=>Bt.REGISTERED_PROTOCOLS[h.substring(0,h.indexOf("://"))];function nr(h,c){const d=new AbortController,v=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,cache:h.cache,referrer:Mt(),signal:d.signal});let S=!1,P=!1;return h.type==="json"&&v.headers.set("Accept","application/json"),P||fetch(v).then(k=>k.ok?(G=>{(h.type==="arrayBuffer"||h.type==="image"?G.arrayBuffer():h.type==="json"?G.json():G.text()).then(W=>{P||(S=!0,c(null,W,G.headers.get("Cache-Control"),G.headers.get("Expires")))}).catch(W=>{P||c(new Error(W.message))})})(k):k.blob().then(G=>c(new Dt(k.status,k.statusText,h.url,G)))).catch(k=>{k.code!==20&&c(new Error(k.message))}),{cancel:()=>{P=!0,S||d.abort()}}}const vr=function(h,c){if(/:\/\//.test(h.url)&&!/^https?:|^file:/.test(h.url)){if(Pt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",h,c);if(!Pt())return(qt(h.url)||nr)(h,c)}if(!(/^file:/.test(d=h.url)||/^file:/.test(Mt())&&!/^\w+:/.test(d))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return nr(h,c);if(Pt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",h,c,void 0,!0)}var d;return function(v,S){const P=new XMLHttpRequest;P.open(v.method||"GET",v.url,!0),v.type!=="arrayBuffer"&&v.type!=="image"||(P.responseType="arraybuffer");for(const k in v.headers)P.setRequestHeader(k,v.headers[k]);return v.type==="json"&&(P.responseType="text",P.setRequestHeader("Accept","application/json")),P.withCredentials=v.credentials==="include",P.onerror=()=>{S(new Error(P.statusText))},P.onload=()=>{if((P.status>=200&&P.status<300||P.status===0)&&P.response!==null){let k=P.response;if(v.type==="json")try{k=JSON.parse(P.response)}catch(G){return S(G)}S(null,k,P.getResponseHeader("Cache-Control"),P.getResponseHeader("Expires"))}else{const k=new Blob([P.response],{type:P.getResponseHeader("Content-Type")});S(new Dt(P.status,P.statusText,v.url,k))}},P.send(v.body),{cancel:()=>P.abort()}}(h,c)},br=function(h,c){return vr(Ne(h,{type:"arrayBuffer"}),c)};function Fr(h){if(!h||h.indexOf("://")<=0||h.indexOf("data:image/")===0||h.indexOf("blob:")===0)return!0;const c=new URL(h),d=window.location;return c.protocol===d.protocol&&c.host===d.host}function kt(h,c,d){d[h]&&d[h].indexOf(c)!==-1||(d[h]=d[h]||[],d[h].push(c))}function lt(h,c,d){if(d&&d[h]){const v=d[h].indexOf(c);v!==-1&&d[h].splice(v,1)}}class wt{constructor(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Ne(this,d),this.type=c}}class Ur extends wt{constructor(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super("error",Ne({error:c},d))}}class tr{on(c,d){return this._listeners=this._listeners||{},kt(c,d,this._listeners),this}off(c,d){return lt(c,d,this._listeners),lt(c,d,this._oneTimeListeners),this}once(c,d){return d?(this._oneTimeListeners=this._oneTimeListeners||{},kt(c,d,this._oneTimeListeners),this):new Promise(v=>this.once(c,v))}fire(c,d){typeof c=="string"&&(c=new wt(c,d||{}));const v=c.type;if(this.listens(v)){c.target=this;const S=this._listeners&&this._listeners[v]?this._listeners[v].slice():[];for(const G of S)G.call(this,c);const P=this._oneTimeListeners&&this._oneTimeListeners[v]?this._oneTimeListeners[v].slice():[];for(const G of P)lt(v,G,this._oneTimeListeners),G.call(this,c);const k=this._eventedParent;k&&(Ne(c,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(c))}else c instanceof Ur&&console.error(c.error);return this}listens(c){return this._listeners&&this._listeners[c]&&this._listeners[c].length>0||this._oneTimeListeners&&this._oneTimeListeners[c]&&this._oneTimeListeners[c].length>0||this._eventedParent&&this._eventedParent.listens(c)}setEventedParent(c,d){return this._eventedParent=c,this._eventedParentData=d,this}}var ht={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const $t=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function or(h,c){const d={};for(const v in h)v!=="ref"&&(d[v]=h[v]);return $t.forEach(v=>{v in c&&(d[v]=c[v])}),d}function mr(h,c){if(Array.isArray(h)){if(!Array.isArray(c)||h.length!==c.length)return!1;for(let d=0;d<h.length;d++)if(!mr(h[d],c[d]))return!1;return!0}if(typeof h=="object"&&h!==null&&c!==null){if(typeof c!="object"||Object.keys(h).length!==Object.keys(c).length)return!1;for(const d in h)if(!mr(h[d],c[d]))return!1;return!0}return h===c}const ur={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Wr(h,c,d){d.push({command:ur.addSource,args:[h,c[h]]})}function ri(h,c,d){c.push({command:ur.removeSource,args:[h]}),d[h]=!0}function gi(h,c,d,v){ri(h,d,v),Wr(h,c,d)}function Pi(h,c,d){let v;for(v in h[d])if(Object.prototype.hasOwnProperty.call(h[d],v)&&v!=="data"&&!mr(h[d][v],c[d][v]))return!1;for(v in c[d])if(Object.prototype.hasOwnProperty.call(c[d],v)&&v!=="data"&&!mr(h[d][v],c[d][v]))return!1;return!0}function zt(h,c,d,v,S,P){let k;for(k in c=c||{},h=h||{})Object.prototype.hasOwnProperty.call(h,k)&&(mr(h[k],c[k])||d.push({command:P,args:[v,k,c[k],S]}));for(k in c)Object.prototype.hasOwnProperty.call(c,k)&&!Object.prototype.hasOwnProperty.call(h,k)&&(mr(h[k],c[k])||d.push({command:P,args:[v,k,c[k],S]}))}function Xr(h){return h.id}function Ar(h,c){return h[c.id]=c,h}class Wt{constructor(c,d,v,S){this.message=(c?`${c}: `:"")+v,S&&(this.identifier=S),d!=null&&d.__line__&&(this.line=d.__line__)}}function di(h){for(var c=arguments.length,d=new Array(c>1?c-1:0),v=1;v<c;v++)d[v-1]=arguments[v];for(const S of d)for(const P in S)h[P]=S[P];return h}class Qt extends Error{constructor(c,d){super(d),this.message=d,this.key=c}}class Tr{constructor(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.parent=c,this.bindings={};for(const[v,S]of d)this.bindings[v]=S}concat(c){return new Tr(this,c)}get(c){if(this.bindings[c])return this.bindings[c];if(this.parent)return this.parent.get(c);throw new Error(`${c} not found in scope.`)}has(c){return!!this.bindings[c]||!!this.parent&&this.parent.has(c)}}const Lr={kind:"null"},Xt={kind:"number"},xr={kind:"string"},er={kind:"boolean"},vi={kind:"color"},Zi={kind:"object"},Qe={kind:"value"},Be={kind:"collator"},ue={kind:"formatted"},re={kind:"padding"},Ae={kind:"resolvedImage"},ge={kind:"variableAnchorOffsetCollection"};function xe(h,c){return{kind:"array",itemType:h,N:c}}function Ee(h){if(h.kind==="array"){const c=Ee(h.itemType);return typeof h.N=="number"?`array<${c}, ${h.N}>`:h.itemType.kind==="value"?"array":`array<${c}>`}return h.kind}const we=[Lr,Xt,xr,er,vi,ue,Zi,xe(Qe),re,Ae,ge];function Fe(h,c){if(c.kind==="error")return null;if(h.kind==="array"){if(c.kind==="array"&&(c.N===0&&c.itemType.kind==="value"||!Fe(h.itemType,c.itemType))&&(typeof h.N!="number"||h.N===c.N))return null}else{if(h.kind===c.kind)return null;if(h.kind==="value"){for(const d of we)if(!Fe(d,c))return null}}return`Expected ${Ee(h)} but found ${Ee(c)} instead.`}function ze(h,c){return c.some(d=>d.kind===h.kind)}function Ge(h,c){return c.some(d=>d==="null"?h===null:d==="array"?Array.isArray(h):d==="object"?h&&!Array.isArray(h)&&typeof h=="object":d===typeof h)}function st(h,c){return h.kind==="array"&&c.kind==="array"?h.itemType.kind===c.itemType.kind&&typeof h.N=="number":h.kind===c.kind}const vt=.96422,Tt=.82521,Kt=4/29,rr=6/29,Gt=3*rr*rr,dr=rr*rr*rr,Cr=Math.PI/180,Gr=180/Math.PI;function Er(h){return(h%=360)<0&&(h+=360),h}function zr(h){let[c,d,v,S]=h,P,k;const G=ir((.2225045*(c=ot(c))+.7168786*(d=ot(d))+.0606169*(v=ot(v)))/1);c===d&&d===v?P=k=G:(P=ir((.4360747*c+.3850649*d+.1430804*v)/vt),k=ir((.0139322*c+.0971045*d+.7141733*v)/Tt));const W=116*G-16;return[W<0?0:W,500*(P-G),200*(G-k),S]}function ot(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function ir(h){return h>dr?Math.pow(h,1/3):h/Gt+Kt}function Vt(h){let[c,d,v,S]=h,P=(c+16)/116,k=isNaN(d)?P:P+d/500,G=isNaN(v)?P:P-v/200;return P=1*ci(P),k=vt*ci(k),G=Tt*ci(G),[Hr(3.1338561*k-1.6168667*P-.4906146*G),Hr(-.9787684*k+1.9161415*P+.033454*G),Hr(.0719453*k-.2289914*P+1.4052427*G),S]}function Hr(h){return(h=h<=.00304?12.92*h:1.055*Math.pow(h,1/2.4)-.055)<0?0:h>1?1:h}function ci(h){return h>rr?h*h*h:Gt*(h-Kt)}function un(h){return parseInt(h.padEnd(2,h),16)/255}function wn(h,c){return mi(c?h/100:h,0,1)}function mi(h,c,d){return Math.min(Math.max(c,h),d)}function mn(h){return!h.some(Number.isNaN)}const yn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class fi{constructor(c,d,v){let S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,P=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.r=c,this.g=d,this.b=v,this.a=S,P||(this.r*=S,this.g*=S,this.b*=S,S||this.overwriteGetter("rgb",[c,d,v,S]))}static parse(c){if(c instanceof fi)return c;if(typeof c!="string")return;const d=function(v){if((v=v.toLowerCase().trim())==="transparent")return[0,0,0,0];const S=yn[v];if(S){const[k,G,W]=S;return[k/255,G/255,W/255,1]}if(v.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(v)){const k=v.length<6?1:2;let G=1;return[un(v.slice(G,G+=k)),un(v.slice(G,G+=k)),un(v.slice(G,G+=k)),un(v.slice(G,G+k)||"ff")]}if(v.startsWith("rgb")){const k=v.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(k){const[G,W,ee,ae,fe,me,Ce,Me,Ue,$e,Ke,ut]=k,tt=[ae||" ",Ce||" ",$e].join("");if(tt==="  "||tt==="  /"||tt===",,"||tt===",,,"){const it=[ee,me,Ue].join(""),yt=it==="%%%"?100:it===""?255:0;if(yt){const St=[mi(+W/yt,0,1),mi(+fe/yt,0,1),mi(+Me/yt,0,1),Ke?wn(+Ke,ut):1];if(mn(St))return St}}return}}const P=v.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(P){const[k,G,W,ee,ae,fe,me,Ce,Me]=P,Ue=[W||" ",ae||" ",me].join("");if(Ue==="  "||Ue==="  /"||Ue===",,"||Ue===",,,"){const $e=[+G,mi(+ee,0,100),mi(+fe,0,100),Ce?wn(+Ce,Me):1];if(mn($e))return function(Ke){let[ut,tt,it,yt]=Ke;function St(Jt){const Br=(Jt+ut/30)%12,ar=tt*Math.min(it,1-it);return it-ar*Math.max(-1,Math.min(Br-3,9-Br,1))}return ut=Er(ut),tt/=100,it/=100,[St(0),St(8),St(4),yt]}($e)}}}(c);return d?new fi(...d,!1):void 0}get rgb(){const{r:c,g:d,b:v,a:S}=this,P=S||1/0;return this.overwriteGetter("rgb",[c/P,d/P,v/P,S])}get hcl(){return this.overwriteGetter("hcl",function(c){const[d,v,S,P]=zr(c),k=Math.sqrt(v*v+S*S);return[Math.round(1e4*k)?Er(Math.atan2(S,v)*Gr):NaN,k,d,P]}(this.rgb))}get lab(){return this.overwriteGetter("lab",zr(this.rgb))}overwriteGetter(c,d){return Object.defineProperty(this,c,{value:d}),d}toString(){const[c,d,v,S]=this.rgb;return`rgba(${[c,d,v].map(P=>Math.round(255*P)).join(",")},${S})`}}fi.black=new fi(0,0,0,1),fi.white=new fi(1,1,1,1),fi.transparent=new fi(0,0,0,0),fi.red=new fi(1,0,0,1);class jn{constructor(c,d,v){this.sensitivity=c?d?"variant":"case":d?"accent":"base",this.locale=v,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(c,d){return this.collator.compare(c,d)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class qs{constructor(c,d,v,S,P){this.text=c,this.image=d,this.scale=v,this.fontStack=S,this.textColor=P}}class Ui{constructor(c){this.sections=c}static fromString(c){return new Ui([new qs(c,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(c=>c.text.length!==0||c.image&&c.image.name.length!==0)}static factory(c){return c instanceof Ui?c:Ui.fromString(c)}toString(){return this.sections.length===0?"":this.sections.map(c=>c.text).join("")}}class Bn{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Bn)return c;if(typeof c=="number")return new Bn([c,c,c,c]);if(Array.isArray(c)&&!(c.length<1||c.length>4)){for(const d of c)if(typeof d!="number")return;switch(c.length){case 1:c=[c[0],c[0],c[0],c[0]];break;case 2:c=[c[0],c[1],c[0],c[1]];break;case 3:c=[c[0],c[1],c[2],c[1]]}return new Bn(c)}}toString(){return JSON.stringify(this.values)}}const Xa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Nn{constructor(c){this.values=c.slice()}static parse(c){if(c instanceof Nn)return c;if(Array.isArray(c)&&!(c.length<1)&&c.length%2==0){for(let d=0;d<c.length;d+=2){const v=c[d],S=c[d+1];if(typeof v!="string"||!Xa.has(v)||!Array.isArray(S)||S.length!==2||typeof S[0]!="number"||typeof S[1]!="number")return}return new Nn(c)}}toString(){return JSON.stringify(this.values)}}class Zr{constructor(c){this.name=c.name,this.available=c.available}toString(){return this.name}static fromString(c){return c?new Zr({name:c,available:!1}):null}}function co(h,c,d,v){return typeof h=="number"&&h>=0&&h<=255&&typeof c=="number"&&c>=0&&c<=255&&typeof d=="number"&&d>=0&&d<=255?v===void 0||typeof v=="number"&&v>=0&&v<=1?null:`Invalid rgba value [${[h,c,d,v].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof v=="number"?[h,c,d,v]:[h,c,d]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Fs(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof fi||h instanceof jn||h instanceof Ui||h instanceof Bn||h instanceof Nn||h instanceof Zr)return!0;if(Array.isArray(h)){for(const c of h)if(!Fs(c))return!1;return!0}if(typeof h=="object"){for(const c in h)if(!Fs(h[c]))return!1;return!0}return!1}function bi(h){if(h===null)return Lr;if(typeof h=="string")return xr;if(typeof h=="boolean")return er;if(typeof h=="number")return Xt;if(h instanceof fi)return vi;if(h instanceof jn)return Be;if(h instanceof Ui)return ue;if(h instanceof Bn)return re;if(h instanceof Nn)return ge;if(h instanceof Zr)return Ae;if(Array.isArray(h)){const c=h.length;let d;for(const v of h){const S=bi(v);if(d){if(d===S)continue;d=Qe;break}d=S}return xe(d||Qe,c)}return Zi}function Ii(h){const c=typeof h;return h===null?"":c==="string"||c==="number"||c==="boolean"?String(h):h instanceof fi||h instanceof Ui||h instanceof Bn||h instanceof Nn||h instanceof Zr?h.toString():JSON.stringify(h)}class ss{constructor(c,d){this.type=c,this.value=d}static parse(c,d){if(c.length!==2)return d.error(`'literal' expression requires exactly one argument, but found ${c.length-1} instead.`);if(!Fs(c[1]))return d.error("invalid value");const v=c[1];let S=bi(v);const P=d.expectedType;return S.kind!=="array"||S.N!==0||!P||P.kind!=="array"||typeof P.N=="number"&&P.N!==0||(S=P),new ss(S,v)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ji{constructor(c){this.name="ExpressionEvaluationError",this.message=c}toJSON(){return this.message}}const Tn={string:xr,number:Xt,boolean:er,object:Zi};class Cn{constructor(c,d){this.type=c,this.args=d}static parse(c,d){if(c.length<2)return d.error("Expected at least one argument.");let v,S=1;const P=c[0];if(P==="array"){let G,W;if(c.length>2){const ee=c[1];if(typeof ee!="string"||!(ee in Tn)||ee==="object")return d.error('The item type argument of "array" must be one of string, number, boolean',1);G=Tn[ee],S++}else G=Qe;if(c.length>3){if(c[2]!==null&&(typeof c[2]!="number"||c[2]<0||c[2]!==Math.floor(c[2])))return d.error('The length argument to "array" must be a positive integer literal',2);W=c[2],S++}v=xe(G,W)}else{if(!Tn[P])throw new Error(`Types doesn't contain name = ${P}`);v=Tn[P]}const k=[];for(;S<c.length;S++){const G=d.parse(c[S],S,Qe);if(!G)return null;k.push(G)}return new Cn(v,k)}evaluate(c){for(let d=0;d<this.args.length;d++){const v=this.args[d].evaluate(c);if(!Fe(this.type,bi(v)))return v;if(d===this.args.length-1)throw new ji(`Expected value to be of type ${Ee(this.type)}, but found ${Ee(bi(v))} instead.`)}throw new Error}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const mo={"to-boolean":er,"to-color":vi,"to-number":Xt,"to-string":xr};class Mi{constructor(c,d){this.type=c,this.args=d}static parse(c,d){if(c.length<2)return d.error("Expected at least one argument.");const v=c[0];if(!mo[v])throw new Error(`Can't parse ${v} as it is not part of the known types`);if((v==="to-boolean"||v==="to-string")&&c.length!==2)return d.error("Expected one argument.");const S=mo[v],P=[];for(let k=1;k<c.length;k++){const G=d.parse(c[k],k,Qe);if(!G)return null;P.push(G)}return new Mi(S,P)}evaluate(c){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(c);case"color":{let d,v;for(const S of this.args){if(d=S.evaluate(c),v=null,d instanceof fi)return d;if(typeof d=="string"){const P=c.parseColor(d);if(P)return P}else if(Array.isArray(d)&&(v=d.length<3||d.length>4?`Invalid rbga value ${JSON.stringify(d)}: expected an array containing either three or four numeric values.`:co(d[0],d[1],d[2],d[3]),!v))return new fi(d[0]/255,d[1]/255,d[2]/255,d[3])}throw new ji(v||`Could not parse color from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"padding":{let d;for(const v of this.args){d=v.evaluate(c);const S=Bn.parse(d);if(S)return S}throw new ji(`Could not parse padding from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"variableAnchorOffsetCollection":{let d;for(const v of this.args){d=v.evaluate(c);const S=Nn.parse(d);if(S)return S}throw new ji(`Could not parse variableAnchorOffsetCollection from value '${typeof d=="string"?d:JSON.stringify(d)}'`)}case"number":{let d=null;for(const v of this.args){if(d=v.evaluate(c),d===null)return 0;const S=Number(d);if(!isNaN(S))return S}throw new ji(`Could not convert ${JSON.stringify(d)} to number.`)}case"formatted":return Ui.fromString(Ii(this.args[0].evaluate(c)));case"resolvedImage":return Zr.fromString(Ii(this.args[0].evaluate(c)));default:return Ii(this.args[0].evaluate(c))}}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}const Za=["Unknown","Point","LineString","Polygon"];class Ys{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Za[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(c){let d=this._parseColorCache[c];return d||(d=this._parseColorCache[c]=fi.parse(c)),d}}class Ja{constructor(c,d){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],S=arguments.length>3?arguments[3]:void 0,P=arguments.length>4&&arguments[4]!==void 0?arguments[4]:new Tr,k=arguments.length>5&&arguments[5]!==void 0?arguments[5]:[];this.registry=c,this.path=v,this.key=v.map(G=>`[${G}]`).join(""),this.scope=P,this.errors=k,this.expectedType=S,this._isConstant=d}parse(c,d,v,S){let P=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return d?this.concat(d,v,S)._parse(c,P):this._parse(c,P)}_parse(c,d){function v(S,P,k){return k==="assert"?new Cn(P,[S]):k==="coerce"?new Mi(P,[S]):S}if(c!==null&&typeof c!="string"&&typeof c!="boolean"&&typeof c!="number"||(c=["literal",c]),Array.isArray(c)){if(c.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const S=c[0];if(typeof S!="string")return this.error(`Expression name must be a string, but found ${typeof S} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const P=this.registry[S];if(P){let k=P.parse(c,this);if(!k)return null;if(this.expectedType){const G=this.expectedType,W=k.type;if(G.kind!=="string"&&G.kind!=="number"&&G.kind!=="boolean"&&G.kind!=="object"&&G.kind!=="array"||W.kind!=="value")if(G.kind!=="color"&&G.kind!=="formatted"&&G.kind!=="resolvedImage"||W.kind!=="value"&&W.kind!=="string")if(G.kind!=="padding"||W.kind!=="value"&&W.kind!=="number"&&W.kind!=="array")if(G.kind!=="variableAnchorOffsetCollection"||W.kind!=="value"&&W.kind!=="array"){if(this.checkSubtype(G,W))return null}else k=v(k,G,d.typeAnnotation||"coerce");else k=v(k,G,d.typeAnnotation||"coerce");else k=v(k,G,d.typeAnnotation||"coerce");else k=v(k,G,d.typeAnnotation||"assert")}if(!(k instanceof ss)&&k.type.kind!=="resolvedImage"&&this._isConstant(k)){const G=new Ys;try{k=new ss(k.type,k.evaluate(G))}catch(W){return this.error(W.message),null}}return k}return this.error(`Unknown expression "${S}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(c===void 0?"'undefined' value invalid. Use null instead.":typeof c=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof c} instead.`)}concat(c,d,v){const S=typeof c=="number"?this.path.concat(c):this.path,P=v?this.scope.concat(v):this.scope;return new Ja(this.registry,this._isConstant,S,d||null,P,this.errors)}error(c){for(var d=arguments.length,v=new Array(d>1?d-1:0),S=1;S<d;S++)v[S-1]=arguments[S];const P=`${this.key}${v.map(k=>`[${k}]`).join("")}`;this.errors.push(new Qt(P,c))}checkSubtype(c,d){const v=Fe(c,d);return v&&this.error(v),v}}class He{constructor(c,d,v){this.type=Be,this.locale=v,this.caseSensitive=c,this.diacriticSensitive=d}static parse(c,d){if(c.length!==2)return d.error("Expected one argument.");const v=c[1];if(typeof v!="object"||Array.isArray(v))return d.error("Collator options argument must be an object.");const S=d.parse(v["case-sensitive"]!==void 0&&v["case-sensitive"],1,er);if(!S)return null;const P=d.parse(v["diacritic-sensitive"]!==void 0&&v["diacritic-sensitive"],1,er);if(!P)return null;let k=null;return v.locale&&(k=d.parse(v.locale,1,xr),!k)?null:new He(S,P,k)}evaluate(c){return new jn(this.caseSensitive.evaluate(c),this.diacriticSensitive.evaluate(c),this.locale?this.locale.evaluate(c):null)}eachChild(c){c(this.caseSensitive),c(this.diacriticSensitive),this.locale&&c(this.locale)}outputDefined(){return!1}}const Je=8192;function gt(h,c){h[0]=Math.min(h[0],c[0]),h[1]=Math.min(h[1],c[1]),h[2]=Math.max(h[2],c[0]),h[3]=Math.max(h[3],c[1])}function Ot(h,c){return!(h[0]<=c[0]||h[2]>=c[2]||h[1]<=c[1]||h[3]>=c[3])}function fr(h,c){const d=(180+h[0])/360,v=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,S=Math.pow(2,c.z);return[Math.round(d*S*Je),Math.round(v*S*Je)]}function qr(h,c,d){const v=h[0]-c[0],S=h[1]-c[1],P=h[0]-d[0],k=h[1]-d[1];return v*k-P*S==0&&v*P<=0&&S*k<=0}function Ci(h,c){let d=!1;for(let k=0,G=c.length;k<G;k++){const W=c[k];for(let ee=0,ae=W.length;ee<ae-1;ee++){if(qr(h,W[ee],W[ee+1]))return!1;(S=W[ee])[1]>(v=h)[1]!=(P=W[ee+1])[1]>v[1]&&v[0]<(P[0]-S[0])*(v[1]-S[1])/(P[1]-S[1])+S[0]&&(d=!d)}}var v,S,P;return d}function In(h,c){for(let d=0;d<c.length;d++)if(Ci(h,c[d]))return!0;return!1}function qn(h,c,d,v){const S=v[0]-d[0],P=v[1]-d[1],k=(h[0]-d[0])*P-S*(h[1]-d[1]),G=(c[0]-d[0])*P-S*(c[1]-d[1]);return k>0&&G<0||k<0&&G>0}function os(h,c,d){for(const ee of d)for(let ae=0;ae<ee.length-1;++ae)if((G=[(k=ee[ae+1])[0]-(P=ee[ae])[0],k[1]-P[1]])[0]*(W=[(S=c)[0]-(v=h)[0],S[1]-v[1]])[1]-G[1]*W[0]!=0&&qn(v,S,P,k)&&qn(P,k,v,S))return!0;var v,S,P,k,G,W;return!1}function _n(h,c){for(let d=0;d<h.length;++d)if(!Ci(h[d],c))return!1;for(let d=0;d<h.length-1;++d)if(os(h[d],h[d+1],c))return!1;return!0}function fu(h,c){for(let d=0;d<c.length;d++)if(_n(h,c[d]))return!0;return!1}function Hl(h,c,d){const v=[];for(let S=0;S<h.length;S++){const P=[];for(let k=0;k<h[S].length;k++){const G=fr(h[S][k],d);gt(c,G),P.push(G)}v.push(P)}return v}function Ei(h,c,d){const v=[];for(let S=0;S<h.length;S++){const P=Hl(h[S],c,d);v.push(P)}return v}function Ya(h,c,d,v){if(h[0]<d[0]||h[0]>d[2]){const S=.5*v;let P=h[0]-d[0]>S?-v:d[0]-h[0]>S?v:0;P===0&&(P=h[0]-d[2]>S?-v:d[2]-h[0]>S?v:0),h[0]+=P}gt(c,h)}function Gl(h,c,d,v){const S=Math.pow(2,v.z)*Je,P=[v.x*Je,v.y*Je],k=[];for(const G of h)for(const W of G){const ee=[W.x+P[0],W.y+P[1]];Ya(ee,c,d,S),k.push(ee)}return k}function as(h,c,d,v){const S=Math.pow(2,v.z)*Je,P=[v.x*Je,v.y*Je],k=[];for(const W of h){const ee=[];for(const ae of W){const fe=[ae.x+P[0],ae.y+P[1]];gt(c,fe),ee.push(fe)}k.push(ee)}if(c[2]-c[0]<=S/2){(G=c)[0]=G[1]=1/0,G[2]=G[3]=-1/0;for(const W of k)for(const ee of W)Ya(ee,c,d,S)}var G;return k}class Lo{constructor(c,d){this.type=er,this.geojson=c,this.geometries=d}static parse(c,d){if(c.length!==2)return d.error(`'within' expression requires exactly one argument, but found ${c.length-1} instead.`);if(Fs(c[1])){const v=c[1];if(v.type==="FeatureCollection")for(let S=0;S<v.features.length;++S){const P=v.features[S].geometry.type;if(P==="Polygon"||P==="MultiPolygon")return new Lo(v,v.features[S].geometry)}else if(v.type==="Feature"){const S=v.geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new Lo(v,v.geometry)}else if(v.type==="Polygon"||v.type==="MultiPolygon")return new Lo(v,v)}return d.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(c){if(c.geometry()!=null&&c.canonicalID()!=null){if(c.geometryType()==="Point")return function(d,v){const S=[1/0,1/0,-1/0,-1/0],P=[1/0,1/0,-1/0,-1/0],k=d.canonicalID();if(v.type==="Polygon"){const G=Hl(v.coordinates,P,k),W=Gl(d.geometry(),S,P,k);if(!Ot(S,P))return!1;for(const ee of W)if(!Ci(ee,G))return!1}if(v.type==="MultiPolygon"){const G=Ei(v.coordinates,P,k),W=Gl(d.geometry(),S,P,k);if(!Ot(S,P))return!1;for(const ee of W)if(!In(ee,G))return!1}return!0}(c,this.geometries);if(c.geometryType()==="LineString")return function(d,v){const S=[1/0,1/0,-1/0,-1/0],P=[1/0,1/0,-1/0,-1/0],k=d.canonicalID();if(v.type==="Polygon"){const G=Hl(v.coordinates,P,k),W=as(d.geometry(),S,P,k);if(!Ot(S,P))return!1;for(const ee of W)if(!_n(ee,G))return!1}if(v.type==="MultiPolygon"){const G=Ei(v.coordinates,P,k),W=as(d.geometry(),S,P,k);if(!Ot(S,P))return!1;for(const ee of W)if(!fu(ee,G))return!1}return!0}(c,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ia{constructor(c,d){this.type=d.type,this.name=c,this.boundExpression=d}static parse(c,d){if(c.length!==2||typeof c[1]!="string")return d.error("'var' expression requires exactly one string literal argument.");const v=c[1];return d.scope.has(v)?new Ia(v,d.scope.get(v)):d.error(`Unknown variable "${v}". Make sure "${v}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(c){return this.boundExpression.evaluate(c)}eachChild(){}outputDefined(){return!1}}class ys{constructor(c,d,v,S){this.name=c,this.type=d,this._evaluate=v,this.args=S}evaluate(c){return this._evaluate(c,this.args)}eachChild(c){this.args.forEach(c)}outputDefined(){return!1}static parse(c,d){const v=c[0],S=ys.definitions[v];if(!S)return d.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0);const P=Array.isArray(S)?S[0]:S.type,k=Array.isArray(S)?[[S[1],S[2]]]:S.overloads,G=k.filter(ee=>{let[ae]=ee;return!Array.isArray(ae)||ae.length===c.length-1});let W=null;for(const[ee,ae]of G){W=new Ja(d.registry,La,d.path,null,d.scope);const fe=[];let me=!1;for(let Ce=1;Ce<c.length;Ce++){const Me=c[Ce],Ue=Array.isArray(ee)?ee[Ce-1]:ee.type,$e=W.parse(Me,1+fe.length,Ue);if(!$e){me=!0;break}fe.push($e)}if(!me)if(Array.isArray(ee)&&ee.length!==fe.length)W.error(`Expected ${ee.length} arguments, but found ${fe.length} instead.`);else{for(let Ce=0;Ce<fe.length;Ce++){const Me=Array.isArray(ee)?ee[Ce]:ee.type,Ue=fe[Ce];W.concat(Ce+1).checkSubtype(Me,Ue.type)}if(W.errors.length===0)return new ys(v,P,ae,fe)}}if(G.length===1)d.errors.push(...W.errors);else{const ee=(G.length?G:k).map(fe=>{let[me]=fe;return Ce=me,Array.isArray(Ce)?`(${Ce.map(Ee).join(", ")})`:`(${Ee(Ce.type)}...)`;var Ce}).join(" | "),ae=[];for(let fe=1;fe<c.length;fe++){const me=d.parse(c[fe],1+ae.length);if(!me)return null;ae.push(Ee(me.type))}d.error(`Expected arguments of type ${ee}, but found (${ae.join(", ")}) instead.`)}return null}static register(c,d){ys.definitions=d;for(const v in d)c[v]=ys}}function La(h){if(h instanceof Ia)return La(h.boundExpression);if(h instanceof ys&&h.name==="error"||h instanceof He||h instanceof Lo)return!1;const c=h instanceof Mi||h instanceof Cn;let d=!0;return h.eachChild(v=>{d=c?d&&La(v):d&&v instanceof ss}),!!d&&el(h)&&Vc(h,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function el(h){if(h instanceof ys&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof Lo)return!1;let c=!0;return h.eachChild(d=>{c&&!el(d)&&(c=!1)}),c}function Aa(h){if(h instanceof ys&&h.name==="feature-state")return!1;let c=!0;return h.eachChild(d=>{c&&!Aa(d)&&(c=!1)}),c}function Vc(h,c){if(h instanceof ys&&c.indexOf(h.name)>=0)return!1;let d=!0;return h.eachChild(v=>{d&&!Vc(v,c)&&(d=!1)}),d}function tl(h,c){const d=h.length-1;let v,S,P=0,k=d,G=0;for(;P<=k;)if(G=Math.floor((P+k)/2),v=h[G],S=h[G+1],v<=c){if(G===d||c<S)return G;P=G+1}else{if(!(v>c))throw new ji("Input is not a number.");k=G-1}return 0}class yo{constructor(c,d,v){this.type=c,this.input=d,this.labels=[],this.outputs=[];for(const[S,P]of v)this.labels.push(S),this.outputs.push(P)}static parse(c,d){if(c.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return d.error("Expected an even number of arguments.");const v=d.parse(c[1],1,Xt);if(!v)return null;const S=[];let P=null;d.expectedType&&d.expectedType.kind!=="value"&&(P=d.expectedType);for(let k=1;k<c.length;k+=2){const G=k===1?-1/0:c[k],W=c[k+1],ee=k,ae=k+1;if(typeof G!="number")return d.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ee);if(S.length&&S[S.length-1][0]>=G)return d.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ee);const fe=d.parse(W,ae,P);if(!fe)return null;P=P||fe.type,S.push([G,fe])}return new yo(P,v,S)}evaluate(c){const d=this.labels,v=this.outputs;if(d.length===1)return v[0].evaluate(c);const S=this.input.evaluate(c);if(S<=d[0])return v[0].evaluate(c);const P=d.length;return S>=d[P-1]?v[P-1].evaluate(c):v[tl(d,S)].evaluate(c)}eachChild(c){c(this.input);for(const d of this.outputs)c(d)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function Fi(h,c,d){return h+d*(c-h)}function da(h,c,d){return h.map((v,S)=>Fi(v,c[S],d))}const As={number:Fi,color:function(h,c,d){switch(arguments.length>3&&arguments[3]!==void 0?arguments[3]:"rgb"){case"rgb":{const[S,P,k,G]=da(h.rgb,c.rgb,d);return new fi(S,P,k,G,!1)}case"hcl":{const[S,P,k,G]=h.hcl,[W,ee,ae,fe]=c.hcl;let me,Ce;if(isNaN(S)||isNaN(W))isNaN(S)?isNaN(W)?me=NaN:(me=W,k!==1&&k!==0||(Ce=ee)):(me=S,ae!==1&&ae!==0||(Ce=P));else{let ut=W-S;W>S&&ut>180?ut-=360:W<S&&S-W>180&&(ut+=360),me=S+d*ut}const[Me,Ue,$e,Ke]=function(ut){let[tt,it,yt,St]=ut;return tt=isNaN(tt)?0:tt*Cr,Vt([yt,Math.cos(tt)*it,Math.sin(tt)*it,St])}([me,Ce??Fi(P,ee,d),Fi(k,ae,d),Fi(G,fe,d)]);return new fi(Me,Ue,$e,Ke,!1)}case"lab":{const[S,P,k,G]=Vt(da(h.lab,c.lab,d));return new fi(S,P,k,G,!1)}}},array:da,padding:function(h,c,d){return new Bn(da(h.values,c.values,d))},variableAnchorOffsetCollection:function(h,c,d){const v=h.values,S=c.values;if(v.length!==S.length)throw new ji(`Cannot interpolate values of different length. from: ${h.toString()}, to: ${c.toString()}`);const P=[];for(let k=0;k<v.length;k+=2){if(v[k]!==S[k])throw new ji(`Cannot interpolate values containing mismatched anchors. from[${k}]: ${v[k]}, to[${k}]: ${S[k]}`);P.push(v[k]);const[G,W]=v[k+1],[ee,ae]=S[k+1];P.push([Fi(G,ee,d),Fi(W,ae,d)])}return new Nn(P)}};class En{constructor(c,d,v,S,P){this.type=c,this.operator=d,this.interpolation=v,this.input=S,this.labels=[],this.outputs=[];for(const[k,G]of P)this.labels.push(k),this.outputs.push(G)}static interpolationFactor(c,d,v,S){let P=0;if(c.name==="exponential")P=ds(d,c.base,v,S);else if(c.name==="linear")P=ds(d,1,v,S);else if(c.name==="cubic-bezier"){const k=c.controlPoints;P=new Y(k[0],k[1],k[2],k[3]).solve(ds(d,1,v,S))}return P}static parse(c,d){let[v,S,P,...k]=c;if(!Array.isArray(S)||S.length===0)return d.error("Expected an interpolation type expression.",1);if(S[0]==="linear")S={name:"linear"};else if(S[0]==="exponential"){const ee=S[1];if(typeof ee!="number")return d.error("Exponential interpolation requires a numeric base.",1,1);S={name:"exponential",base:ee}}else{if(S[0]!=="cubic-bezier")return d.error(`Unknown interpolation type ${String(S[0])}`,1,0);{const ee=S.slice(1);if(ee.length!==4||ee.some(ae=>typeof ae!="number"||ae<0||ae>1))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);S={name:"cubic-bezier",controlPoints:ee}}}if(c.length-1<4)return d.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if((c.length-1)%2!=0)return d.error("Expected an even number of arguments.");if(P=d.parse(P,2,Xt),!P)return null;const G=[];let W=null;v==="interpolate-hcl"||v==="interpolate-lab"?W=vi:d.expectedType&&d.expectedType.kind!=="value"&&(W=d.expectedType);for(let ee=0;ee<k.length;ee+=2){const ae=k[ee],fe=k[ee+1],me=ee+3,Ce=ee+4;if(typeof ae!="number")return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',me);if(G.length&&G[G.length-1][0]>=ae)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',me);const Me=d.parse(fe,Ce,W);if(!Me)return null;W=W||Me.type,G.push([ae,Me])}return st(W,Xt)||st(W,vi)||st(W,re)||st(W,ge)||st(W,xe(Xt))?new En(W,v,S,P,G):d.error(`Type ${Ee(W)} is not interpolatable.`)}evaluate(c){const d=this.labels,v=this.outputs;if(d.length===1)return v[0].evaluate(c);const S=this.input.evaluate(c);if(S<=d[0])return v[0].evaluate(c);const P=d.length;if(S>=d[P-1])return v[P-1].evaluate(c);const k=tl(d,S),G=En.interpolationFactor(this.interpolation,S,d[k],d[k+1]),W=v[k].evaluate(c),ee=v[k+1].evaluate(c);switch(this.operator){case"interpolate":return As[this.type.kind](W,ee,G);case"interpolate-hcl":return As.color(W,ee,G,"hcl");case"interpolate-lab":return As.color(W,ee,G,"lab")}}eachChild(c){c(this.input);for(const d of this.outputs)c(d)}outputDefined(){return this.outputs.every(c=>c.outputDefined())}}function ds(h,c,d,v){const S=v-d,P=h-d;return S===0?0:c===1?P/S:(Math.pow(c,P)-1)/(Math.pow(c,S)-1)}class fa{constructor(c,d){this.type=c,this.args=d}static parse(c,d){if(c.length<2)return d.error("Expectected at least one argument.");let v=null;const S=d.expectedType;S&&S.kind!=="value"&&(v=S);const P=[];for(const G of c.slice(1)){const W=d.parse(G,1+P.length,v,void 0,{typeAnnotation:"omit"});if(!W)return null;v=v||W.type,P.push(W)}if(!v)throw new Error("No output type");const k=S&&P.some(G=>Fe(S,G.type));return new fa(k?Qe:v,P)}evaluate(c){let d,v=null,S=0;for(const P of this.args)if(S++,v=P.evaluate(c),v&&v instanceof Zr&&!v.available&&(d||(d=v.name),v=null,S===this.args.length&&(v=d)),v!==null)break;return v}eachChild(c){this.args.forEach(c)}outputDefined(){return this.args.every(c=>c.outputDefined())}}class qi{constructor(c,d){this.type=d.type,this.bindings=[].concat(c),this.result=d}evaluate(c){return this.result.evaluate(c)}eachChild(c){for(const d of this.bindings)c(d[1]);c(this.result)}static parse(c,d){if(c.length<4)return d.error(`Expected at least 3 arguments, but found ${c.length-1} instead.`);const v=[];for(let P=1;P<c.length-1;P+=2){const k=c[P];if(typeof k!="string")return d.error(`Expected string, but found ${typeof k} instead.`,P);if(/[^a-zA-Z0-9_]/.test(k))return d.error("Variable names must contain only alphanumeric characters or '_'.",P);const G=d.parse(c[P+1],P+1);if(!G)return null;v.push([k,G])}const S=d.parse(c[c.length-1],c.length-1,d.expectedType,v);return S?new qi(v,S):null}outputDefined(){return this.result.outputDefined()}}class dl{constructor(c,d,v){this.type=c,this.index=d,this.input=v}static parse(c,d){if(c.length!==3)return d.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const v=d.parse(c[1],1,Xt),S=d.parse(c[2],2,xe(d.expectedType||Qe));return v&&S?new dl(S.type.itemType,v,S):null}evaluate(c){const d=this.index.evaluate(c),v=this.input.evaluate(c);if(d<0)throw new ji(`Array index out of bounds: ${d} < 0.`);if(d>=v.length)throw new ji(`Array index out of bounds: ${d} > ${v.length-1}.`);if(d!==Math.floor(d))throw new ji(`Array index must be an integer, but found ${d} instead.`);return v[d]}eachChild(c){c(this.index),c(this.input)}outputDefined(){return!1}}class jl{constructor(c,d){this.type=er,this.needle=c,this.haystack=d}static parse(c,d){if(c.length!==3)return d.error(`Expected 2 arguments, but found ${c.length-1} instead.`);const v=d.parse(c[1],1,Qe),S=d.parse(c[2],2,Qe);return v&&S?ze(v.type,[er,xr,Xt,Lr,Qe])?new jl(v,S):d.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(v.type)} instead`):null}evaluate(c){const d=this.needle.evaluate(c),v=this.haystack.evaluate(c);if(!v)return!1;if(!Ge(d,["boolean","string","number","null"]))throw new ji(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(bi(d))} instead.`);if(!Ge(v,["string","array"]))throw new ji(`Expected second argument to be of type array or string, but found ${Ee(bi(v))} instead.`);return v.indexOf(d)>=0}eachChild(c){c(this.needle),c(this.haystack)}outputDefined(){return!0}}class Mo{constructor(c,d,v){this.type=Xt,this.needle=c,this.haystack=d,this.fromIndex=v}static parse(c,d){if(c.length<=2||c.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const v=d.parse(c[1],1,Qe),S=d.parse(c[2],2,Qe);if(!v||!S)return null;if(!ze(v.type,[er,xr,Xt,Lr,Qe]))return d.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(v.type)} instead`);if(c.length===4){const P=d.parse(c[3],3,Xt);return P?new Mo(v,S,P):null}return new Mo(v,S)}evaluate(c){const d=this.needle.evaluate(c),v=this.haystack.evaluate(c);if(!Ge(d,["boolean","string","number","null"]))throw new ji(`Expected first argument to be of type boolean, string, number or null, but found ${Ee(bi(d))} instead.`);if(!Ge(v,["string","array"]))throw new ji(`Expected second argument to be of type array or string, but found ${Ee(bi(v))} instead.`);if(this.fromIndex){const S=this.fromIndex.evaluate(c);return v.indexOf(d,S)}return v.indexOf(d)}eachChild(c){c(this.needle),c(this.haystack),this.fromIndex&&c(this.fromIndex)}outputDefined(){return!1}}class Zo{constructor(c,d,v,S,P,k){this.inputType=c,this.type=d,this.input=v,this.cases=S,this.outputs=P,this.otherwise=k}static parse(c,d){if(c.length<5)return d.error(`Expected at least 4 arguments, but found only ${c.length-1}.`);if(c.length%2!=1)return d.error("Expected an even number of arguments.");let v,S;d.expectedType&&d.expectedType.kind!=="value"&&(S=d.expectedType);const P={},k=[];for(let ee=2;ee<c.length-1;ee+=2){let ae=c[ee];const fe=c[ee+1];Array.isArray(ae)||(ae=[ae]);const me=d.concat(ee);if(ae.length===0)return me.error("Expected at least one branch label.");for(const Me of ae){if(typeof Me!="number"&&typeof Me!="string")return me.error("Branch labels must be numbers or strings.");if(typeof Me=="number"&&Math.abs(Me)>Number.MAX_SAFE_INTEGER)return me.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Me=="number"&&Math.floor(Me)!==Me)return me.error("Numeric branch labels must be integer values.");if(v){if(me.checkSubtype(v,bi(Me)))return null}else v=bi(Me);if(P[String(Me)]!==void 0)return me.error("Branch labels must be unique.");P[String(Me)]=k.length}const Ce=d.parse(fe,ee,S);if(!Ce)return null;S=S||Ce.type,k.push(Ce)}const G=d.parse(c[1],1,Qe);if(!G)return null;const W=d.parse(c[c.length-1],c.length-1,S);return W?G.type.kind!=="value"&&d.concat(1).checkSubtype(v,G.type)?null:new Zo(v,S,G,P,k,W):null}evaluate(c){const d=this.input.evaluate(c);return(bi(d)===this.inputType&&this.outputs[this.cases[d]]||this.otherwise).evaluate(c)}eachChild(c){c(this.input),this.outputs.forEach(c),c(this.otherwise)}outputDefined(){return this.outputs.every(c=>c.outputDefined())&&this.otherwise.outputDefined()}}class bc{constructor(c,d,v){this.type=c,this.branches=d,this.otherwise=v}static parse(c,d){if(c.length<4)return d.error(`Expected at least 3 arguments, but found only ${c.length-1}.`);if(c.length%2!=0)return d.error("Expected an odd number of arguments.");let v;d.expectedType&&d.expectedType.kind!=="value"&&(v=d.expectedType);const S=[];for(let k=1;k<c.length-1;k+=2){const G=d.parse(c[k],k,er);if(!G)return null;const W=d.parse(c[k+1],k+1,v);if(!W)return null;S.push([G,W]),v=v||W.type}const P=d.parse(c[c.length-1],c.length-1,v);if(!P)return null;if(!v)throw new Error("Can't infer output type");return new bc(v,S,P)}evaluate(c){for(const[d,v]of this.branches)if(d.evaluate(c))return v.evaluate(c);return this.otherwise.evaluate(c)}eachChild(c){for(const[d,v]of this.branches)c(d),c(v);c(this.otherwise)}outputDefined(){return this.branches.every(c=>{let[d,v]=c;return v.outputDefined()})&&this.otherwise.outputDefined()}}class Jo{constructor(c,d,v,S){this.type=c,this.input=d,this.beginIndex=v,this.endIndex=S}static parse(c,d){if(c.length<=2||c.length>=5)return d.error(`Expected 3 or 4 arguments, but found ${c.length-1} instead.`);const v=d.parse(c[1],1,Qe),S=d.parse(c[2],2,Xt);if(!v||!S)return null;if(!ze(v.type,[xe(Qe),xr,Qe]))return d.error(`Expected first argument to be of type array or string, but found ${Ee(v.type)} instead`);if(c.length===4){const P=d.parse(c[3],3,Xt);return P?new Jo(v.type,v,S,P):null}return new Jo(v.type,v,S)}evaluate(c){const d=this.input.evaluate(c),v=this.beginIndex.evaluate(c);if(!Ge(d,["string","array"]))throw new ji(`Expected first argument to be of type array or string, but found ${Ee(bi(d))} instead.`);if(this.endIndex){const S=this.endIndex.evaluate(c);return d.slice(v,S)}return d.slice(v)}eachChild(c){c(this.input),c(this.beginIndex),this.endIndex&&c(this.endIndex)}outputDefined(){return!1}}function _o(h,c){return h==="=="||h==="!="?c.kind==="boolean"||c.kind==="string"||c.kind==="number"||c.kind==="null"||c.kind==="value":c.kind==="string"||c.kind==="number"||c.kind==="value"}function xc(h,c,d,v){return v.compare(c,d)===0}function Yo(h,c,d){const v=h!=="=="&&h!=="!=";return class Dz{constructor(P,k,G){this.type=er,this.lhs=P,this.rhs=k,this.collator=G,this.hasUntypedArgument=P.type.kind==="value"||k.type.kind==="value"}static parse(P,k){if(P.length!==3&&P.length!==4)return k.error("Expected two or three arguments.");const G=P[0];let W=k.parse(P[1],1,Qe);if(!W)return null;if(!_o(G,W.type))return k.concat(1).error(`"${G}" comparisons are not supported for type '${Ee(W.type)}'.`);let ee=k.parse(P[2],2,Qe);if(!ee)return null;if(!_o(G,ee.type))return k.concat(2).error(`"${G}" comparisons are not supported for type '${Ee(ee.type)}'.`);if(W.type.kind!==ee.type.kind&&W.type.kind!=="value"&&ee.type.kind!=="value")return k.error(`Cannot compare types '${Ee(W.type)}' and '${Ee(ee.type)}'.`);v&&(W.type.kind==="value"&&ee.type.kind!=="value"?W=new Cn(ee.type,[W]):W.type.kind!=="value"&&ee.type.kind==="value"&&(ee=new Cn(W.type,[ee])));let ae=null;if(P.length===4){if(W.type.kind!=="string"&&ee.type.kind!=="string"&&W.type.kind!=="value"&&ee.type.kind!=="value")return k.error("Cannot use collator to compare non-string types.");if(ae=k.parse(P[3],3,Be),!ae)return null}return new Dz(W,ee,ae)}evaluate(P){const k=this.lhs.evaluate(P),G=this.rhs.evaluate(P);if(v&&this.hasUntypedArgument){const W=bi(k),ee=bi(G);if(W.kind!==ee.kind||W.kind!=="string"&&W.kind!=="number")throw new ji(`Expected arguments for "${h}" to be (string, string) or (number, number), but found (${W.kind}, ${ee.kind}) instead.`)}if(this.collator&&!v&&this.hasUntypedArgument){const W=bi(k),ee=bi(G);if(W.kind!=="string"||ee.kind!=="string")return c(P,k,G)}return this.collator?d(P,k,G,this.collator.evaluate(P)):c(P,k,G)}eachChild(P){P(this.lhs),P(this.rhs),this.collator&&P(this.collator)}outputDefined(){return!0}}}const ql=Yo("==",function(h,c,d){return c===d},xc),Hc=Yo("!=",function(h,c,d){return c!==d},function(h,c,d,v){return!xc(0,c,d,v)}),Eh=Yo("<",function(h,c,d){return c<d},function(h,c,d,v){return v.compare(c,d)<0}),pu=Yo(">",function(h,c,d){return c>d},function(h,c,d,v){return v.compare(c,d)>0}),gu=Yo("<=",function(h,c,d){return c<=d},function(h,c,d,v){return v.compare(c,d)<=0}),Vu=Yo(">=",function(h,c,d){return c>=d},function(h,c,d,v){return v.compare(c,d)>=0});class $l{constructor(c,d,v,S,P){this.type=xr,this.number=c,this.locale=d,this.currency=v,this.minFractionDigits=S,this.maxFractionDigits=P}static parse(c,d){if(c.length!==3)return d.error("Expected two arguments.");const v=d.parse(c[1],1,Xt);if(!v)return null;const S=c[2];if(typeof S!="object"||Array.isArray(S))return d.error("NumberFormat options argument must be an object.");let P=null;if(S.locale&&(P=d.parse(S.locale,1,xr),!P))return null;let k=null;if(S.currency&&(k=d.parse(S.currency,1,xr),!k))return null;let G=null;if(S["min-fraction-digits"]&&(G=d.parse(S["min-fraction-digits"],1,Xt),!G))return null;let W=null;return S["max-fraction-digits"]&&(W=d.parse(S["max-fraction-digits"],1,Xt),!W)?null:new $l(v,P,k,G,W)}evaluate(c){return new Intl.NumberFormat(this.locale?this.locale.evaluate(c):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(c):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(c):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(c):void 0}).format(this.number.evaluate(c))}eachChild(c){c(this.number),this.locale&&c(this.locale),this.currency&&c(this.currency),this.minFractionDigits&&c(this.minFractionDigits),this.maxFractionDigits&&c(this.maxFractionDigits)}outputDefined(){return!1}}class rl{constructor(c){this.type=ue,this.sections=c}static parse(c,d){if(c.length<2)return d.error("Expected at least one argument.");const v=c[1];if(!Array.isArray(v)&&typeof v=="object")return d.error("First argument must be an image or text section.");const S=[];let P=!1;for(let k=1;k<=c.length-1;++k){const G=c[k];if(P&&typeof G=="object"&&!Array.isArray(G)){P=!1;let W=null;if(G["font-scale"]&&(W=d.parse(G["font-scale"],1,Xt),!W))return null;let ee=null;if(G["text-font"]&&(ee=d.parse(G["text-font"],1,xe(xr)),!ee))return null;let ae=null;if(G["text-color"]&&(ae=d.parse(G["text-color"],1,vi),!ae))return null;const fe=S[S.length-1];fe.scale=W,fe.font=ee,fe.textColor=ae}else{const W=d.parse(c[k],1,Qe);if(!W)return null;const ee=W.type.kind;if(ee!=="string"&&ee!=="value"&&ee!=="null"&&ee!=="resolvedImage")return d.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");P=!0,S.push({content:W,scale:null,font:null,textColor:null})}}return new rl(S)}evaluate(c){return new Ui(this.sections.map(d=>{const v=d.content.evaluate(c);return bi(v)===Ae?new qs("",v,null,null,null):new qs(Ii(v),null,d.scale?d.scale.evaluate(c):null,d.font?d.font.evaluate(c).join(","):null,d.textColor?d.textColor.evaluate(c):null)}))}eachChild(c){for(const d of this.sections)c(d.content),d.scale&&c(d.scale),d.font&&c(d.font),d.textColor&&c(d.textColor)}outputDefined(){return!1}}class il{constructor(c){this.type=Ae,this.input=c}static parse(c,d){if(c.length!==2)return d.error("Expected two arguments.");const v=d.parse(c[1],1,xr);return v?new il(v):d.error("No image name provided.")}evaluate(c){const d=this.input.evaluate(c),v=Zr.fromString(d);return v&&c.availableImages&&(v.available=c.availableImages.indexOf(d)>-1),v}eachChild(c){c(this.input)}outputDefined(){return!1}}class Kl{constructor(c){this.type=Xt,this.input=c}static parse(c,d){if(c.length!==2)return d.error(`Expected 1 argument, but found ${c.length-1} instead.`);const v=d.parse(c[1],1);return v?v.type.kind!=="array"&&v.type.kind!=="string"&&v.type.kind!=="value"?d.error(`Expected argument of type string or array, but found ${Ee(v.type)} instead.`):new Kl(v):null}evaluate(c){const d=this.input.evaluate(c);if(typeof d=="string"||Array.isArray(d))return d.length;throw new ji(`Expected value to be of type string or array, but found ${Ee(bi(d))} instead.`)}eachChild(c){c(this.input)}outputDefined(){return!1}}const nl={"==":ql,"!=":Hc,">":pu,"<":Eh,">=":Vu,"<=":gu,array:Cn,at:dl,boolean:Cn,case:bc,coalesce:fa,collator:He,format:rl,image:il,in:jl,"index-of":Mo,interpolate:En,"interpolate-hcl":En,"interpolate-lab":En,length:Kl,let:qi,literal:ss,match:Zo,number:Cn,"number-format":$l,object:Cn,slice:Jo,step:yo,string:Cn,"to-boolean":Mi,"to-color":Mi,"to-number":Mi,"to-string":Mi,var:Ia,within:Lo};function pa(h,c){let[d,v,S,P]=c;d=d.evaluate(h),v=v.evaluate(h),S=S.evaluate(h);const k=P?P.evaluate(h):1,G=co(d,v,S,k);if(G)throw new ji(G);return new fi(d/255,v/255,S/255,k,!1)}function fl(h,c){return h in c}function Wl(h,c){const d=c[h];return d===void 0?null:d}function uo(h){return{type:h}}function ga(h){return{result:"success",value:h}}function ne(h){return{result:"error",value:h}}function Pe(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function ct(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function _t(h){return!!h.expression&&h.expression.interpolated}function xt(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function Lt(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)}function gr(h){return h}function sr(h,c){const d=c.type==="color",v=h.stops&&typeof h.stops[0][0]=="object",S=v||!(v||h.property!==void 0),P=h.type||(_t(c)?"exponential":"interval");if(d||c.type==="padding"){const ae=d?fi.parse:Bn.parse;(h=di({},h)).stops&&(h.stops=h.stops.map(fe=>[fe[0],ae(fe[1])])),h.default=ae(h.default?h.default:c.default)}if(h.colorSpace&&(k=h.colorSpace)!=="rgb"&&k!=="hcl"&&k!=="lab")throw new Error(`Unknown color space: "${h.colorSpace}"`);var k;let G,W,ee;if(P==="exponential")G=ui;else if(P==="interval")G=ei;else if(P==="categorical"){G=$r,W=Object.create(null);for(const ae of h.stops)W[ae[0]]=ae[1];ee=typeof h.stops[0][0]}else{if(P!=="identity")throw new Error(`Unknown function type "${P}"`);G=$n}if(v){const ae={},fe=[];for(let Me=0;Me<h.stops.length;Me++){const Ue=h.stops[Me],$e=Ue[0].zoom;ae[$e]===void 0&&(ae[$e]={zoom:$e,type:h.type,property:h.property,default:h.default,stops:[]},fe.push($e)),ae[$e].stops.push([Ue[0].value,Ue[1]])}const me=[];for(const Me of fe)me.push([ae[Me].zoom,sr(ae[Me],c)]);const Ce={name:"linear"};return{kind:"composite",interpolationType:Ce,interpolationFactor:En.interpolationFactor.bind(void 0,Ce),zoomStops:me.map(Me=>Me[0]),evaluate:(Me,Ue)=>{let{zoom:$e}=Me;return ui({stops:me,base:h.base},c,$e).evaluate($e,Ue)}}}if(S){const ae=P==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:ae,interpolationFactor:En.interpolationFactor.bind(void 0,ae),zoomStops:h.stops.map(fe=>fe[0]),evaluate:fe=>{let{zoom:me}=fe;return G(h,c,me,W,ee)}}}return{kind:"source",evaluate(ae,fe){const me=fe&&fe.properties?fe.properties[h.property]:void 0;return me===void 0?si(h.default,c.default):G(h,c,me,W,ee)}}}function si(h,c,d){return h!==void 0?h:c!==void 0?c:d!==void 0?d:void 0}function $r(h,c,d,v,S){return si(typeof d===S?v[d]:void 0,h.default,c.default)}function ei(h,c,d){if(xt(d)!=="number")return si(h.default,c.default);const v=h.stops.length;if(v===1||d<=h.stops[0][0])return h.stops[0][1];if(d>=h.stops[v-1][0])return h.stops[v-1][1];const S=tl(h.stops.map(P=>P[0]),d);return h.stops[S][1]}function ui(h,c,d){const v=h.base!==void 0?h.base:1;if(xt(d)!=="number")return si(h.default,c.default);const S=h.stops.length;if(S===1||d<=h.stops[0][0])return h.stops[0][1];if(d>=h.stops[S-1][0])return h.stops[S-1][1];const P=tl(h.stops.map(ae=>ae[0]),d),k=function(ae,fe,me,Ce){const Me=Ce-me,Ue=ae-me;return Me===0?0:fe===1?Ue/Me:(Math.pow(fe,Ue)-1)/(Math.pow(fe,Me)-1)}(d,v,h.stops[P][0],h.stops[P+1][0]),G=h.stops[P][1],W=h.stops[P+1][1],ee=As[c.type]||gr;return typeof G.evaluate=="function"?{evaluate(){for(var ae=arguments.length,fe=new Array(ae),me=0;me<ae;me++)fe[me]=arguments[me];const Ce=G.evaluate.apply(void 0,fe),Me=W.evaluate.apply(void 0,fe);if(Ce!==void 0&&Me!==void 0)return ee(Ce,Me,k,h.colorSpace)}}:ee(G,W,k,h.colorSpace)}function $n(h,c,d){switch(c.type){case"color":d=fi.parse(d);break;case"formatted":d=Ui.fromString(d.toString());break;case"resolvedImage":d=Zr.fromString(d.toString());break;case"padding":d=Bn.parse(d);break;default:xt(d)===c.type||c.type==="enum"&&c.values[d]||(d=void 0)}return si(d,h.default,c.default)}ys.register(nl,{error:[{kind:"error"},[xr],(h,c)=>{let[d]=c;throw new ji(d.evaluate(h))}],typeof:[xr,[Qe],(h,c)=>{let[d]=c;return Ee(bi(d.evaluate(h)))}],"to-rgba":[xe(Xt,4),[vi],(h,c)=>{let[d]=c;const[v,S,P,k]=d.evaluate(h).rgb;return[255*v,255*S,255*P,k]}],rgb:[vi,[Xt,Xt,Xt],pa],rgba:[vi,[Xt,Xt,Xt,Xt],pa],has:{type:er,overloads:[[[xr],(h,c)=>{let[d]=c;return fl(d.evaluate(h),h.properties())}],[[xr,Zi],(h,c)=>{let[d,v]=c;return fl(d.evaluate(h),v.evaluate(h))}]]},get:{type:Qe,overloads:[[[xr],(h,c)=>{let[d]=c;return Wl(d.evaluate(h),h.properties())}],[[xr,Zi],(h,c)=>{let[d,v]=c;return Wl(d.evaluate(h),v.evaluate(h))}]]},"feature-state":[Qe,[xr],(h,c)=>{let[d]=c;return Wl(d.evaluate(h),h.featureState||{})}],properties:[Zi,[],h=>h.properties()],"geometry-type":[xr,[],h=>h.geometryType()],id:[Qe,[],h=>h.id()],zoom:[Xt,[],h=>h.globals.zoom],"heatmap-density":[Xt,[],h=>h.globals.heatmapDensity||0],"line-progress":[Xt,[],h=>h.globals.lineProgress||0],accumulated:[Qe,[],h=>h.globals.accumulated===void 0?null:h.globals.accumulated],"+":[Xt,uo(Xt),(h,c)=>{let d=0;for(const v of c)d+=v.evaluate(h);return d}],"*":[Xt,uo(Xt),(h,c)=>{let d=1;for(const v of c)d*=v.evaluate(h);return d}],"-":{type:Xt,overloads:[[[Xt,Xt],(h,c)=>{let[d,v]=c;return d.evaluate(h)-v.evaluate(h)}],[[Xt],(h,c)=>{let[d]=c;return-d.evaluate(h)}]]},"/":[Xt,[Xt,Xt],(h,c)=>{let[d,v]=c;return d.evaluate(h)/v.evaluate(h)}],"%":[Xt,[Xt,Xt],(h,c)=>{let[d,v]=c;return d.evaluate(h)%v.evaluate(h)}],ln2:[Xt,[],()=>Math.LN2],pi:[Xt,[],()=>Math.PI],e:[Xt,[],()=>Math.E],"^":[Xt,[Xt,Xt],(h,c)=>{let[d,v]=c;return Math.pow(d.evaluate(h),v.evaluate(h))}],sqrt:[Xt,[Xt],(h,c)=>{let[d]=c;return Math.sqrt(d.evaluate(h))}],log10:[Xt,[Xt],(h,c)=>{let[d]=c;return Math.log(d.evaluate(h))/Math.LN10}],ln:[Xt,[Xt],(h,c)=>{let[d]=c;return Math.log(d.evaluate(h))}],log2:[Xt,[Xt],(h,c)=>{let[d]=c;return Math.log(d.evaluate(h))/Math.LN2}],sin:[Xt,[Xt],(h,c)=>{let[d]=c;return Math.sin(d.evaluate(h))}],cos:[Xt,[Xt],(h,c)=>{let[d]=c;return Math.cos(d.evaluate(h))}],tan:[Xt,[Xt],(h,c)=>{let[d]=c;return Math.tan(d.evaluate(h))}],asin:[Xt,[Xt],(h,c)=>{let[d]=c;return Math.asin(d.evaluate(h))}],acos:[Xt,[Xt],(h,c)=>{let[d]=c;return Math.acos(d.evaluate(h))}],atan:[Xt,[Xt],(h,c)=>{let[d]=c;return Math.atan(d.evaluate(h))}],min:[Xt,uo(Xt),(h,c)=>Math.min(...c.map(d=>d.evaluate(h)))],max:[Xt,uo(Xt),(h,c)=>Math.max(...c.map(d=>d.evaluate(h)))],abs:[Xt,[Xt],(h,c)=>{let[d]=c;return Math.abs(d.evaluate(h))}],round:[Xt,[Xt],(h,c)=>{let[d]=c;const v=d.evaluate(h);return v<0?-Math.round(-v):Math.round(v)}],floor:[Xt,[Xt],(h,c)=>{let[d]=c;return Math.floor(d.evaluate(h))}],ceil:[Xt,[Xt],(h,c)=>{let[d]=c;return Math.ceil(d.evaluate(h))}],"filter-==":[er,[xr,Qe],(h,c)=>{let[d,v]=c;return h.properties()[d.value]===v.value}],"filter-id-==":[er,[Qe],(h,c)=>{let[d]=c;return h.id()===d.value}],"filter-type-==":[er,[xr],(h,c)=>{let[d]=c;return h.geometryType()===d.value}],"filter-<":[er,[xr,Qe],(h,c)=>{let[d,v]=c;const S=h.properties()[d.value],P=v.value;return typeof S==typeof P&&S<P}],"filter-id-<":[er,[Qe],(h,c)=>{let[d]=c;const v=h.id(),S=d.value;return typeof v==typeof S&&v<S}],"filter->":[er,[xr,Qe],(h,c)=>{let[d,v]=c;const S=h.properties()[d.value],P=v.value;return typeof S==typeof P&&S>P}],"filter-id->":[er,[Qe],(h,c)=>{let[d]=c;const v=h.id(),S=d.value;return typeof v==typeof S&&v>S}],"filter-<=":[er,[xr,Qe],(h,c)=>{let[d,v]=c;const S=h.properties()[d.value],P=v.value;return typeof S==typeof P&&S<=P}],"filter-id-<=":[er,[Qe],(h,c)=>{let[d]=c;const v=h.id(),S=d.value;return typeof v==typeof S&&v<=S}],"filter->=":[er,[xr,Qe],(h,c)=>{let[d,v]=c;const S=h.properties()[d.value],P=v.value;return typeof S==typeof P&&S>=P}],"filter-id->=":[er,[Qe],(h,c)=>{let[d]=c;const v=h.id(),S=d.value;return typeof v==typeof S&&v>=S}],"filter-has":[er,[Qe],(h,c)=>{let[d]=c;return d.value in h.properties()}],"filter-has-id":[er,[],h=>h.id()!==null&&h.id()!==void 0],"filter-type-in":[er,[xe(xr)],(h,c)=>{let[d]=c;return d.value.indexOf(h.geometryType())>=0}],"filter-id-in":[er,[xe(Qe)],(h,c)=>{let[d]=c;return d.value.indexOf(h.id())>=0}],"filter-in-small":[er,[xr,xe(Qe)],(h,c)=>{let[d,v]=c;return v.value.indexOf(h.properties()[d.value])>=0}],"filter-in-large":[er,[xr,xe(Qe)],(h,c)=>{let[d,v]=c;return function(S,P,k,G){for(;k<=G;){const W=k+G>>1;if(P[W]===S)return!0;P[W]>S?G=W-1:k=W+1}return!1}(h.properties()[d.value],v.value,0,v.value.length-1)}],all:{type:er,overloads:[[[er,er],(h,c)=>{let[d,v]=c;return d.evaluate(h)&&v.evaluate(h)}],[uo(er),(h,c)=>{for(const d of c)if(!d.evaluate(h))return!1;return!0}]]},any:{type:er,overloads:[[[er,er],(h,c)=>{let[d,v]=c;return d.evaluate(h)||v.evaluate(h)}],[uo(er),(h,c)=>{for(const d of c)if(d.evaluate(h))return!0;return!1}]]},"!":[er,[er],(h,c)=>{let[d]=c;return!d.evaluate(h)}],"is-supported-script":[er,[xr],(h,c)=>{let[d]=c;const v=h.globals&&h.globals.isSupportedScript;return!v||v(d.evaluate(h))}],upcase:[xr,[xr],(h,c)=>{let[d]=c;return d.evaluate(h).toUpperCase()}],downcase:[xr,[xr],(h,c)=>{let[d]=c;return d.evaluate(h).toLowerCase()}],concat:[xr,uo(Qe),(h,c)=>c.map(d=>Ii(d.evaluate(h))).join("")],"resolved-locale":[xr,[Be],(h,c)=>{let[d]=c;return d.evaluate(h).resolvedLocale()}]});class ai{constructor(c,d){var v;this.expression=c,this._warningHistory={},this._evaluator=new Ys,this._defaultValue=d?(v=d).type==="color"&&Lt(v.default)?new fi(0,0,0,0):v.type==="color"?fi.parse(v.default)||null:v.type==="padding"?Bn.parse(v.default)||null:v.type==="variableAnchorOffsetCollection"?Nn.parse(v.default)||null:v.default===void 0?null:v.default:null,this._enumValues=d&&d.type==="enum"?d.values:null}evaluateWithoutErrorHandling(c,d,v,S,P,k){return this._evaluator.globals=c,this._evaluator.feature=d,this._evaluator.featureState=v,this._evaluator.canonical=S,this._evaluator.availableImages=P||null,this._evaluator.formattedSection=k,this.expression.evaluate(this._evaluator)}evaluate(c,d,v,S,P,k){this._evaluator.globals=c,this._evaluator.feature=d||null,this._evaluator.featureState=v||null,this._evaluator.canonical=S,this._evaluator.availableImages=P||null,this._evaluator.formattedSection=k||null;try{const G=this.expression.evaluate(this._evaluator);if(G==null||typeof G=="number"&&G!=G)return this._defaultValue;if(this._enumValues&&!(G in this._enumValues))throw new ji(`Expected value to be one of ${Object.keys(this._enumValues).map(W=>JSON.stringify(W)).join(", ")}, but found ${JSON.stringify(G)} instead.`);return G}catch(G){return this._warningHistory[G.message]||(this._warningHistory[G.message]=!0,typeof console<"u"&&console.warn(G.message)),this._defaultValue}}}function Pn(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in nl}function Di(h,c){const d=new Ja(nl,La,[],c?function(S){const P={color:vi,string:xr,number:Xt,enum:xr,boolean:er,formatted:ue,padding:re,resolvedImage:Ae,variableAnchorOffsetCollection:ge};return S.type==="array"?xe(P[S.value]||Qe,S.length):P[S.type]}(c):void 0),v=d.parse(h,void 0,void 0,void 0,c&&c.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?ga(new ai(v,c)):ne(d.errors)}class Li{constructor(c,d){this.kind=c,this._styleExpression=d,this.isStateDependent=c!=="constant"&&!Aa(d.expression)}evaluateWithoutErrorHandling(c,d,v,S,P,k){return this._styleExpression.evaluateWithoutErrorHandling(c,d,v,S,P,k)}evaluate(c,d,v,S,P,k){return this._styleExpression.evaluate(c,d,v,S,P,k)}}class Ds{constructor(c,d,v,S){this.kind=c,this.zoomStops=v,this._styleExpression=d,this.isStateDependent=c!=="camera"&&!Aa(d.expression),this.interpolationType=S}evaluateWithoutErrorHandling(c,d,v,S,P,k){return this._styleExpression.evaluateWithoutErrorHandling(c,d,v,S,P,k)}evaluate(c,d,v,S,P,k){return this._styleExpression.evaluate(c,d,v,S,P,k)}interpolationFactor(c,d,v){return this.interpolationType?En.interpolationFactor(this.interpolationType,c,d,v):0}}function eo(h,c){const d=Di(h,c);if(d.result==="error")return d;const v=d.value.expression,S=el(v);if(!S&&!Pe(c))return ne([new Qt("","data expressions not supported")]);const P=Vc(v,["zoom"]);if(!P&&!ct(c))return ne([new Qt("","zoom expressions not supported")]);const k=Ma(v);return k||P?k instanceof Qt?ne([k]):k instanceof En&&!_t(c)?ne([new Qt("",'"interpolate" expressions cannot be used with this property')]):ga(k?new Ds(S?"camera":"composite",d.value,k.labels,k instanceof En?k.interpolation:void 0):new Li(S?"constant":"source",d.value)):ne([new Qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Po{constructor(c,d){this._parameters=c,this._specification=d,di(this,sr(this._parameters,this._specification))}static deserialize(c){return new Po(c._parameters,c._specification)}static serialize(c){return{_parameters:c._parameters,_specification:c._specification}}}function Ma(h){let c=null;if(h instanceof qi)c=Ma(h.result);else if(h instanceof fa){for(const d of h.args)if(c=Ma(d),c)break}else(h instanceof yo||h instanceof En)&&h.input instanceof ys&&h.input.name==="zoom"&&(c=h);return c instanceof Qt||h.eachChild(d=>{const v=Ma(d);v instanceof Qt?c=v:!c&&v?c=new Qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):c&&v&&c!==v&&(c=new Qt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),c}function ma(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(const c of h.slice(1))if(!ma(c)&&typeof c!="boolean")return!1;return!0;default:return!0}}const wc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function pl(h){if(h==null)return{filter:()=>!0,needGeometry:!1};ma(h)||(h=Pa(h));const c=Di(h,wc);if(c.result==="error")throw new Error(c.value.map(d=>`${d.key}: ${d.message}`).join(", "));return{filter:(d,v,S)=>c.value.evaluate(d,v,{},S),needGeometry:Bc(h)}}function Xl(h,c){return h<c?-1:h>c?1:0}function Bc(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(let c=1;c<h.length;c++)if(Bc(h[c]))return!0;return!1}function Pa(h){if(!h)return!0;const c=h[0];return h.length<=1?c!=="any":c==="=="?_s(h[1],h[2],"=="):c==="!="?Fa(_s(h[1],h[2],"==")):c==="<"||c===">"||c==="<="||c===">="?_s(h[1],h[2],c):c==="any"?(d=h.slice(1),["any"].concat(d.map(Pa))):c==="all"?["all"].concat(h.slice(1).map(Pa)):c==="none"?["all"].concat(h.slice(1).map(Pa).map(Fa)):c==="in"?gl(h[1],h.slice(2)):c==="!in"?Fa(gl(h[1],h.slice(2))):c==="has"?Zl(h[1]):c==="!has"?Fa(Zl(h[1])):c!=="within"||h;var d}function _s(h,c,d){switch(h){case"$type":return[`filter-type-${d}`,c];case"$id":return[`filter-id-${d}`,c];default:return[`filter-${d}`,h,c]}}function gl(h,c){if(c.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",c]];case"$id":return["filter-id-in",["literal",c]];default:return c.length>200&&!c.some(d=>typeof d!=typeof c[0])?["filter-in-large",h,["literal",c.sort(Xl)]]:["filter-in-small",h,["literal",c]]}}function Zl(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function Fa(h){return["!",h]}function Da(h){const c=typeof h;if(c==="number"||c==="boolean"||c==="string"||h==null)return JSON.stringify(h);if(Array.isArray(h)){let S="[";for(const P of h)S+=`${Da(P)},`;return`${S}]`}const d=Object.keys(h).sort();let v="{";for(let S=0;S<d.length;S++)v+=`${JSON.stringify(d[S])}:${Da(h[d[S]])},`;return`${v}}`}function Rs(h){let c="";for(const d of $t)c+=`/${Da(h[d])}`;return c}function Hu(h){const c=h.value;return c?[new Wt(h.key,c,"constants have been deprecated as of v8")]:[]}function Ln(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function fn(h){if(Array.isArray(h))return h.map(fn);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){const c={};for(const d in h)c[d]=fn(h[d]);return c}return Ln(h)}function pn(h){const c=h.key,d=h.value,v=h.valueSpec||{},S=h.objectElementValidators||{},P=h.style,k=h.styleSpec,G=h.validateSpec;let W=[];const ee=xt(d);if(ee!=="object")return[new Wt(c,d,`object expected, ${ee} found`)];for(const ae in d){const fe=ae.split(".")[0],me=v[fe]||v["*"];let Ce;if(S[fe])Ce=S[fe];else if(v[fe])Ce=G;else if(S["*"])Ce=S["*"];else{if(!v["*"]){W.push(new Wt(c,d[ae],`unknown property "${ae}"`));continue}Ce=G}W=W.concat(Ce({key:(c&&`${c}.`)+ae,value:d[ae],valueSpec:me,style:P,styleSpec:k,object:d,objectKey:ae,validateSpec:G},d))}for(const ae in v)S[ae]||v[ae].required&&v[ae].default===void 0&&d[ae]===void 0&&W.push(new Wt(c,d,`missing required property "${ae}"`));return W}function fs(h){const c=h.value,d=h.valueSpec,v=h.style,S=h.styleSpec,P=h.key,k=h.arrayElementValidator||h.validateSpec;if(xt(c)!=="array")return[new Wt(P,c,`array expected, ${xt(c)} found`)];if(d.length&&c.length!==d.length)return[new Wt(P,c,`array length ${d.length} expected, length ${c.length} found`)];if(d["min-length"]&&c.length<d["min-length"])return[new Wt(P,c,`array length at least ${d["min-length"]} expected, length ${c.length} found`)];let G={type:d.value,values:d.values};S.$version<7&&(G.function=d.function),xt(d.value)==="object"&&(G=d.value);let W=[];for(let ee=0;ee<c.length;ee++)W=W.concat(k({array:c,arrayIndex:ee,value:c[ee],valueSpec:G,validateSpec:h.validateSpec,style:v,styleSpec:S,key:`${P}[${ee}]`}));return W}function ya(h){const c=h.key,d=h.value,v=h.valueSpec;let S=xt(d);return S==="number"&&d!=d&&(S="NaN"),S!=="number"?[new Wt(c,d,`number expected, ${S} found`)]:"minimum"in v&&d<v.minimum?[new Wt(c,d,`${d} is less than the minimum value ${v.minimum}`)]:"maximum"in v&&d>v.maximum?[new Wt(c,d,`${d} is greater than the maximum value ${v.maximum}`)]:[]}function Jl(h){const c=h.valueSpec,d=Ln(h.value.type);let v,S,P,k={};const G=d!=="categorical"&&h.value.property===void 0,W=!G,ee=xt(h.value.stops)==="array"&&xt(h.value.stops[0])==="array"&&xt(h.value.stops[0][0])==="object",ae=pn({key:h.key,value:h.value,valueSpec:h.styleSpec.function,validateSpec:h.validateSpec,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(Ce){if(d==="identity")return[new Wt(Ce.key,Ce.value,'identity function may not have a "stops" property')];let Me=[];const Ue=Ce.value;return Me=Me.concat(fs({key:Ce.key,value:Ue,valueSpec:Ce.valueSpec,validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec,arrayElementValidator:fe})),xt(Ue)==="array"&&Ue.length===0&&Me.push(new Wt(Ce.key,Ue,"array must have at least one stop")),Me},default:function(Ce){return Ce.validateSpec({key:Ce.key,value:Ce.value,valueSpec:c,validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec})}}});return d==="identity"&&G&&ae.push(new Wt(h.key,h.value,'missing required property "property"')),d==="identity"||h.value.stops||ae.push(new Wt(h.key,h.value,'missing required property "stops"')),d==="exponential"&&h.valueSpec.expression&&!_t(h.valueSpec)&&ae.push(new Wt(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(W&&!Pe(h.valueSpec)?ae.push(new Wt(h.key,h.value,"property functions not supported")):G&&!ct(h.valueSpec)&&ae.push(new Wt(h.key,h.value,"zoom functions not supported"))),d!=="categorical"&&!ee||h.value.property!==void 0||ae.push(new Wt(h.key,h.value,'"property" property is required')),ae;function fe(Ce){let Me=[];const Ue=Ce.value,$e=Ce.key;if(xt(Ue)!=="array")return[new Wt($e,Ue,`array expected, ${xt(Ue)} found`)];if(Ue.length!==2)return[new Wt($e,Ue,`array length 2 expected, length ${Ue.length} found`)];if(ee){if(xt(Ue[0])!=="object")return[new Wt($e,Ue,`object expected, ${xt(Ue[0])} found`)];if(Ue[0].zoom===void 0)return[new Wt($e,Ue,"object stop key must have zoom")];if(Ue[0].value===void 0)return[new Wt($e,Ue,"object stop key must have value")];if(P&&P>Ln(Ue[0].zoom))return[new Wt($e,Ue[0].zoom,"stop zoom values must appear in ascending order")];Ln(Ue[0].zoom)!==P&&(P=Ln(Ue[0].zoom),S=void 0,k={}),Me=Me.concat(pn({key:`${$e}[0]`,value:Ue[0],valueSpec:{zoom:{}},validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec,objectElementValidators:{zoom:ya,value:me}}))}else Me=Me.concat(me({key:`${$e}[0]`,value:Ue[0],valueSpec:{},validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec},Ue));return Pn(fn(Ue[1]))?Me.concat([new Wt(`${$e}[1]`,Ue[1],"expressions are not allowed in function stops.")]):Me.concat(Ce.validateSpec({key:`${$e}[1]`,value:Ue[1],valueSpec:c,validateSpec:Ce.validateSpec,style:Ce.style,styleSpec:Ce.styleSpec}))}function me(Ce,Me){const Ue=xt(Ce.value),$e=Ln(Ce.value),Ke=Ce.value!==null?Ce.value:Me;if(v){if(Ue!==v)return[new Wt(Ce.key,Ke,`${Ue} stop domain type must match previous stop domain type ${v}`)]}else v=Ue;if(Ue!=="number"&&Ue!=="string"&&Ue!=="boolean")return[new Wt(Ce.key,Ke,"stop domain value must be a number, string, or boolean")];if(Ue!=="number"&&d!=="categorical"){let ut=`number expected, ${Ue} found`;return Pe(c)&&d===void 0&&(ut+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Wt(Ce.key,Ke,ut)]}return d!=="categorical"||Ue!=="number"||isFinite($e)&&Math.floor($e)===$e?d!=="categorical"&&Ue==="number"&&S!==void 0&&$e<S?[new Wt(Ce.key,Ke,"stop domain values must appear in ascending order")]:(S=$e,d==="categorical"&&$e in k?[new Wt(Ce.key,Ke,"stop domain values must be unique")]:(k[$e]=!0,[])):[new Wt(Ce.key,Ke,`integer expected, found ${$e}`)]}}function ho(h){const c=(h.expressionContext==="property"?eo:Di)(fn(h.value),h.valueSpec);if(c.result==="error")return c.value.map(v=>new Wt(`${h.key}${v.key}`,h.value,v.message));const d=c.value.expression||c.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!d.outputDefined())return[new Wt(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!Aa(d))return[new Wt(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!Aa(d))return[new Wt(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!Vc(d,["zoom","feature-state"]))return[new Wt(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!el(d))return[new Wt(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vs(h){const c=h.key,d=h.value,v=h.valueSpec,S=[];return Array.isArray(v.values)?v.values.indexOf(Ln(d))===-1&&S.push(new Wt(c,d,`expected one of [${v.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(v.values).indexOf(Ln(d))===-1&&S.push(new Wt(c,d,`expected one of [${Object.keys(v.values).join(", ")}], ${JSON.stringify(d)} found`)),S}function ps(h){return ma(fn(h.value))?ho(di({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Fo(h)}function Fo(h){const c=h.value,d=h.key;if(xt(c)!=="array")return[new Wt(d,c,`array expected, ${xt(c)} found`)];const v=h.styleSpec;let S,P=[];if(c.length<1)return[new Wt(d,c,"filter array must have at least 1 element")];switch(P=P.concat(vs({key:`${d}[0]`,value:c[0],valueSpec:v.filter_operator,style:h.style,styleSpec:h.styleSpec})),Ln(c[0])){case"<":case"<=":case">":case">=":c.length>=2&&Ln(c[1])==="$type"&&P.push(new Wt(d,c,`"$type" cannot be use with operator "${c[0]}"`));case"==":case"!=":c.length!==3&&P.push(new Wt(d,c,`filter array for operator "${c[0]}" must have 3 elements`));case"in":case"!in":c.length>=2&&(S=xt(c[1]),S!=="string"&&P.push(new Wt(`${d}[1]`,c[1],`string expected, ${S} found`)));for(let k=2;k<c.length;k++)S=xt(c[k]),Ln(c[1])==="$type"?P=P.concat(vs({key:`${d}[${k}]`,value:c[k],valueSpec:v.geometry_type,style:h.style,styleSpec:h.styleSpec})):S!=="string"&&S!=="number"&&S!=="boolean"&&P.push(new Wt(`${d}[${k}]`,c[k],`string, number, or boolean expected, ${S} found`));break;case"any":case"all":case"none":for(let k=1;k<c.length;k++)P=P.concat(Fo({key:`${d}[${k}]`,value:c[k],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":S=xt(c[1]),c.length!==2?P.push(new Wt(d,c,`filter array for "${c[0]}" operator must have 2 elements`)):S!=="string"&&P.push(new Wt(`${d}[1]`,c[1],`string expected, ${S} found`));break;case"within":S=xt(c[1]),c.length!==2?P.push(new Wt(d,c,`filter array for "${c[0]}" operator must have 2 elements`)):S!=="object"&&P.push(new Wt(`${d}[1]`,c[1],`object expected, ${S} found`))}return P}function vo(h,c){const d=h.key,v=h.validateSpec,S=h.style,P=h.styleSpec,k=h.value,G=h.objectKey,W=P[`${c}_${h.layerType}`];if(!W)return[];const ee=G.match(/^(.*)-transition$/);if(c==="paint"&&ee&&W[ee[1]]&&W[ee[1]].transition)return v({key:d,value:k,valueSpec:P.transition,style:S,styleSpec:P});const ae=h.valueSpec||W[G];if(!ae)return[new Wt(d,k,`unknown property "${G}"`)];let fe;if(xt(k)==="string"&&Pe(ae)&&!ae.tokens&&(fe=/^{([^}]+)}$/.exec(k)))return[new Wt(d,k,`"${G}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(fe[1])} }\`.`)];const me=[];return h.layerType==="symbol"&&(G==="text-field"&&S&&!S.glyphs&&me.push(new Wt(d,k,'use of "text-field" requires a style "glyphs" property')),G==="text-font"&&Lt(fn(k))&&Ln(k.type)==="identity"&&me.push(new Wt(d,k,'"text-font" does not support identity functions'))),me.concat(v({key:h.key,value:k,valueSpec:ae,style:S,styleSpec:P,expressionContext:"property",propertyType:c,propertyKey:G}))}function _a(h){return vo(h,"paint")}function sl(h){return vo(h,"layout")}function Do(h){let c=[];const d=h.value,v=h.key,S=h.style,P=h.styleSpec;d.type||d.ref||c.push(new Wt(v,d,'either "type" or "ref" is required'));let k=Ln(d.type);const G=Ln(d.ref);if(d.id){const W=Ln(d.id);for(let ee=0;ee<h.arrayIndex;ee++){const ae=S.layers[ee];Ln(ae.id)===W&&c.push(new Wt(v,d.id,`duplicate layer id "${d.id}", previously used at line ${ae.id.__line__}`))}}if("ref"in d){let W;["type","source","source-layer","filter","layout"].forEach(ee=>{ee in d&&c.push(new Wt(v,d[ee],`"${ee}" is prohibited for ref layers`))}),S.layers.forEach(ee=>{Ln(ee.id)===G&&(W=ee)}),W?W.ref?c.push(new Wt(v,d.ref,"ref cannot reference another ref layer")):k=Ln(W.type):c.push(new Wt(v,d.ref,`ref layer "${G}" not found`))}else if(k!=="background")if(d.source){const W=S.sources&&S.sources[d.source],ee=W&&Ln(W.type);W?ee==="vector"&&k==="raster"?c.push(new Wt(v,d.source,`layer "${d.id}" requires a raster source`)):ee!=="raster-dem"&&k==="hillshade"?c.push(new Wt(v,d.source,`layer "${d.id}" requires a raster-dem source`)):ee==="raster"&&k!=="raster"?c.push(new Wt(v,d.source,`layer "${d.id}" requires a vector source`)):ee!=="vector"||d["source-layer"]?ee==="raster-dem"&&k!=="hillshade"?c.push(new Wt(v,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="line"||!d.paint||!d.paint["line-gradient"]||ee==="geojson"&&W.lineMetrics||c.push(new Wt(v,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):c.push(new Wt(v,d,`layer "${d.id}" must specify a "source-layer"`)):c.push(new Wt(v,d.source,`source "${d.source}" not found`))}else c.push(new Wt(v,d,'missing required property "source"'));return c=c.concat(pn({key:v,value:d,valueSpec:P.layer,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,objectElementValidators:{"*":()=>[],type:()=>h.validateSpec({key:`${v}.type`,value:d.type,valueSpec:P.layer.type,style:h.style,styleSpec:h.styleSpec,validateSpec:h.validateSpec,object:d,objectKey:"type"}),filter:ps,layout:W=>pn({layer:d,key:W.key,value:W.value,style:W.style,styleSpec:W.styleSpec,validateSpec:W.validateSpec,objectElementValidators:{"*":ee=>sl(di({layerType:k},ee))}}),paint:W=>pn({layer:d,key:W.key,value:W.value,style:W.style,styleSpec:W.styleSpec,validateSpec:W.validateSpec,objectElementValidators:{"*":ee=>_a(di({layerType:k},ee))}})}})),c}function to(h){const c=h.value,d=h.key,v=xt(c);return v!=="string"?[new Wt(d,c,`string expected, ${v} found`)]:[]}const $s={promoteId:function(h){let{key:c,value:d}=h;if(xt(d)==="string")return to({key:c,value:d});{const v=[];for(const S in d)v.push(...to({key:`${c}.${S}`,value:d[S]}));return v}}};function bs(h){const c=h.value,d=h.key,v=h.styleSpec,S=h.style,P=h.validateSpec;if(!c.type)return[new Wt(d,c,'"type" is required')];const k=Ln(c.type);let G;switch(k){case"vector":case"raster":return G=pn({key:d,value:c,valueSpec:v[`source_${k.replace("-","_")}`],style:h.style,styleSpec:v,objectElementValidators:$s,validateSpec:P}),G;case"raster-dem":return G=function(W){var ee;const ae=(ee=W.sourceName)!==null&&ee!==void 0?ee:"",fe=W.value,me=W.styleSpec,Ce=me.source_raster_dem,Me=W.style;let Ue=[];const $e=xt(fe);if(fe===void 0)return Ue;if($e!=="object")return Ue.push(new Wt("source_raster_dem",fe,`object expected, ${$e} found`)),Ue;const Ke=Ln(fe.encoding)==="custom",ut=["redFactor","greenFactor","blueFactor","baseShift"],tt=W.value.encoding?`"${W.value.encoding}"`:"Default";for(const it in fe)!Ke&&ut.includes(it)?Ue.push(new Wt(it,fe[it],`In "${ae}": "${it}" is only valid when "encoding" is set to "custom". ${tt} encoding found`)):Ce[it]?Ue=Ue.concat(W.validateSpec({key:it,value:fe[it],valueSpec:Ce[it],validateSpec:W.validateSpec,style:Me,styleSpec:me})):Ue.push(new Wt(it,fe[it],`unknown property "${it}"`));return Ue}({sourceName:d,value:c,style:h.style,styleSpec:v,validateSpec:P}),G;case"geojson":if(G=pn({key:d,value:c,valueSpec:v.source_geojson,style:S,styleSpec:v,validateSpec:P,objectElementValidators:$s}),c.cluster)for(const W in c.clusterProperties){const[ee,ae]=c.clusterProperties[W],fe=typeof ee=="string"?[ee,["accumulated"],["get",W]]:ee;G.push(...ho({key:`${d}.${W}.map`,value:ae,validateSpec:P,expressionContext:"cluster-map"})),G.push(...ho({key:`${d}.${W}.reduce`,value:fe,validateSpec:P,expressionContext:"cluster-reduce"}))}return G;case"video":return pn({key:d,value:c,valueSpec:v.source_video,style:S,validateSpec:P,styleSpec:v});case"image":return pn({key:d,value:c,valueSpec:v.source_image,style:S,validateSpec:P,styleSpec:v});case"canvas":return[new Wt(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vs({key:`${d}.type`,value:c.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:S,validateSpec:P,styleSpec:v})}}function Ao(h){const c=h.value,d=h.styleSpec,v=d.light,S=h.style;let P=[];const k=xt(c);if(c===void 0)return P;if(k!=="object")return P=P.concat([new Wt("light",c,`object expected, ${k} found`)]),P;for(const G in c){const W=G.match(/^(.*)-transition$/);P=P.concat(W&&v[W[1]]&&v[W[1]].transition?h.validateSpec({key:G,value:c[G],valueSpec:d.transition,validateSpec:h.validateSpec,style:S,styleSpec:d}):v[G]?h.validateSpec({key:G,value:c[G],valueSpec:v[G],validateSpec:h.validateSpec,style:S,styleSpec:d}):[new Wt(G,c[G],`unknown property "${G}"`)])}return P}function Ra(h){const c=h.value,d=h.styleSpec,v=d.terrain,S=h.style;let P=[];const k=xt(c);if(c===void 0)return P;if(k!=="object")return P=P.concat([new Wt("terrain",c,`object expected, ${k} found`)]),P;for(const G in c)P=P.concat(v[G]?h.validateSpec({key:G,value:c[G],valueSpec:v[G],validateSpec:h.validateSpec,style:S,styleSpec:d}):[new Wt(G,c[G],`unknown property "${G}"`)]);return P}function ml(h){let c=[];const d=h.value,v=h.key;if(Array.isArray(d)){const S=[],P=[];for(const k in d)d[k].id&&S.includes(d[k].id)&&c.push(new Wt(v,d,`all the sprites' ids must be unique, but ${d[k].id} is duplicated`)),S.push(d[k].id),d[k].url&&P.includes(d[k].url)&&c.push(new Wt(v,d,`all the sprites' URLs must be unique, but ${d[k].url} is duplicated`)),P.push(d[k].url),c=c.concat(pn({key:`${v}[${k}]`,value:d[k],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:h.validateSpec}));return c}return to({key:v,value:d})}const Yl={"*":()=>[],array:fs,boolean:function(h){const c=h.value,d=h.key,v=xt(c);return v!=="boolean"?[new Wt(d,c,`boolean expected, ${v} found`)]:[]},number:ya,color:function(h){const c=h.key,d=h.value,v=xt(d);return v!=="string"?[new Wt(c,d,`color expected, ${v} found`)]:fi.parse(String(d))?[]:[new Wt(c,d,`color expected, "${d}" found`)]},constants:Hu,enum:vs,filter:ps,function:Jl,layer:Do,object:pn,source:bs,light:Ao,terrain:Ra,string:to,formatted:function(h){return to(h).length===0?[]:ho(h)},resolvedImage:function(h){return to(h).length===0?[]:ho(h)},padding:function(h){const c=h.key,d=h.value;if(xt(d)==="array"){if(d.length<1||d.length>4)return[new Wt(c,d,`padding requires 1 to 4 values; ${d.length} values found`)];const v={type:"number"};let S=[];for(let P=0;P<d.length;P++)S=S.concat(h.validateSpec({key:`${c}[${P}]`,value:d[P],validateSpec:h.validateSpec,valueSpec:v}));return S}return ya({key:c,value:d,valueSpec:{}})},variableAnchorOffsetCollection:function(h){const c=h.key,d=h.value,v=xt(d),S=h.styleSpec;if(v!=="array"||d.length<1||d.length%2!=0)return[new Wt(c,d,"variableAnchorOffsetCollection requires a non-empty array of even length")];let P=[];for(let k=0;k<d.length;k+=2)P=P.concat(vs({key:`${c}[${k}]`,value:d[k],valueSpec:S.layout_symbol["text-anchor"]})),P=P.concat(fs({key:`${c}[${k+1}]`,value:d[k+1],valueSpec:{length:2,value:"number"},validateSpec:h.validateSpec,style:h.style,styleSpec:S}));return P},sprite:ml};function ks(h){const c=h.value,d=h.valueSpec,v=h.styleSpec;return h.validateSpec=ks,d.expression&&Lt(Ln(c))?Jl(h):d.expression&&Pn(fn(c))?ho(h):d.type&&Yl[d.type]?Yl[d.type](h):pn(di({},h,{valueSpec:d.type?v[d.type]:d}))}function ea(h){const c=h.value,d=h.key,v=to(h);return v.length||(c.indexOf("{fontstack}")===-1&&v.push(new Wt(d,c,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&v.push(new Wt(d,c,'"glyphs" url must include a "{range}" token'))),v}function ln(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ht,d=[];return d=d.concat(ks({key:"",value:h,valueSpec:c.$root,styleSpec:c,style:h,validateSpec:ks,objectElementValidators:{glyphs:ea,"*":()=>[]}})),h.constants&&(d=d.concat(Hu({key:"constants",value:h.constants,style:h,styleSpec:c,validateSpec:ks}))),ls(d)}function Kn(h){return function(c){return h({...c,validateSpec:ks})}}function ls(h){return[].concat(h).sort((c,d)=>c.line-d.line)}function Ni(h){return function(){for(var c=arguments.length,d=new Array(c),v=0;v<c;v++)d[v]=arguments[v];return ls(h.apply(this,d))}}ln.source=Ni(Kn(bs)),ln.sprite=Ni(Kn(ml)),ln.glyphs=Ni(Kn(ea)),ln.light=Ni(Kn(Ao)),ln.terrain=Ni(Kn(Ra)),ln.layer=Ni(Kn(Do)),ln.filter=Ni(Kn(ps)),ln.paintProperty=Ni(Kn(_a)),ln.layoutProperty=Ni(Kn(sl));const tn=ln,nn=tn.light,zn=tn.paintProperty,va=tn.layoutProperty;function ka(h,c){let d=!1;if(c&&c.length)for(const v of c)h.fire(new Ur(new Error(v.message))),d=!0;return d}class ta{constructor(c,d,v){const S=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;const k=new Int32Array(this.arrayBuffer);c=k[0],this.d=(d=k[1])+2*(v=k[2]);for(let W=0;W<this.d*this.d;W++){const ee=k[3+W],ae=k[3+W+1];S.push(ee===ae?null:k.subarray(ee,ae))}const G=k[3+S.length+1];this.keys=k.subarray(k[3+S.length],G),this.bboxes=k.subarray(G),this.insert=this._insertReadonly}else{this.d=d+2*v;for(let k=0;k<this.d*this.d;k++)S.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=c,this.padding=v,this.scale=d/c,this.uid=0;const P=v/d*c;this.min=-P,this.max=c+P}insert(c,d,v,S,P){this._forEachCell(d,v,S,P,this._insertCell,this.uid++,void 0,void 0),this.keys.push(c),this.bboxes.push(d),this.bboxes.push(v),this.bboxes.push(S),this.bboxes.push(P)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(c,d,v,S,P,k){this.cells[P].push(k)}query(c,d,v,S,P){const k=this.min,G=this.max;if(c<=k&&d<=k&&G<=v&&G<=S&&!P)return Array.prototype.slice.call(this.keys);{const W=[];return this._forEachCell(c,d,v,S,this._queryCell,W,{},P),W}}_queryCell(c,d,v,S,P,k,G,W){const ee=this.cells[P];if(ee!==null){const ae=this.keys,fe=this.bboxes;for(let me=0;me<ee.length;me++){const Ce=ee[me];if(G[Ce]===void 0){const Me=4*Ce;(W?W(fe[Me+0],fe[Me+1],fe[Me+2],fe[Me+3]):c<=fe[Me+2]&&d<=fe[Me+3]&&v>=fe[Me+0]&&S>=fe[Me+1])?(G[Ce]=!0,k.push(ae[Ce])):G[Ce]=!1}}}}_forEachCell(c,d,v,S,P,k,G,W){const ee=this._convertToCellCoord(c),ae=this._convertToCellCoord(d),fe=this._convertToCellCoord(v),me=this._convertToCellCoord(S);for(let Ce=ee;Ce<=fe;Ce++)for(let Me=ae;Me<=me;Me++){const Ue=this.d*Me+Ce;if((!W||W(this._convertFromCellCoord(Ce),this._convertFromCellCoord(Me),this._convertFromCellCoord(Ce+1),this._convertFromCellCoord(Me+1)))&&P.call(this,c,d,v,S,Ue,k,G,W))return}}_convertFromCellCoord(c){return(c-this.padding)/this.scale}_convertToCellCoord(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const c=this.cells,d=3+this.cells.length+1+1;let v=0;for(let k=0;k<this.cells.length;k++)v+=this.cells[k].length;const S=new Int32Array(d+v+this.keys.length+this.bboxes.length);S[0]=this.extent,S[1]=this.n,S[2]=this.padding;let P=d;for(let k=0;k<c.length;k++){const G=c[k];S[3+k]=P,S.set(G,P),P+=G.length}return S[3+c.length]=P,S.set(this.keys,P),P+=this.keys.length,S[3+c.length+1]=P,S.set(this.bboxes,P),P+=this.bboxes.length,S.buffer}static serialize(c,d){const v=c.toArrayBuffer();return d&&d.push(v),{buffer:v}}static deserialize(c){return new ta(c.buffer)}}const ra={};function Nr(h,c){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(ra[h])throw new Error(`${h} is already registered.`);Object.defineProperty(c,"_classRegistryKey",{value:h,writeable:!1}),ra[h]={klass:c,omit:d.omit||[],shallow:d.shallow||[]}}Nr("Object",Object),Nr("TransferableGridIndex",ta),Nr("Color",fi),Nr("Error",Error),Nr("AJAXError",Dt),Nr("ResolvedImage",Zr),Nr("StylePropertyFunction",Po),Nr("StyleExpression",ai,{omit:["_evaluator"]}),Nr("ZoomDependentExpression",Ds),Nr("ZoomConstantExpression",Li),Nr("CompoundExpression",ys,{omit:["_evaluate"]});for(const h in nl)nl[h]._classRegistryKey||Nr(`Expression_${h}`,nl[h]);function ba(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function Rr(h,c){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob)return h;if(ba(h)||Rt(h))return c&&c.push(h),h;if(ArrayBuffer.isView(h)){const d=h;return c&&c.push(d.buffer),d}if(h instanceof ImageData)return c&&c.push(h.data.buffer),h;if(Array.isArray(h)){const d=[];for(const v of h)d.push(Rr(v,c));return d}if(typeof h=="object"){const d=h.constructor,v=d._classRegistryKey;if(!v)throw new Error("can't serialize object of unregistered class");if(!ra[v])throw new Error(`${v} is not registered.`);const S=d.serialize?d.serialize(h,c):{};if(d.serialize){if(c&&S===c[c.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const P in h){if(!h.hasOwnProperty(P)||ra[v].omit.indexOf(P)>=0)continue;const k=h[P];S[P]=ra[v].shallow.indexOf(P)>=0?k:Rr(k,c)}h instanceof Error&&(S.message=h.message)}if(S.$name)throw new Error("$name property is reserved for worker serialization logic.");return v!=="Object"&&(S.$name=v),S}throw new Error("can't serialize object of type "+typeof h)}function yl(h){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||h instanceof Blob||ba(h)||Rt(h)||ArrayBuffer.isView(h)||h instanceof ImageData)return h;if(Array.isArray(h))return h.map(yl);if(typeof h=="object"){const c=h.$name||"Object";if(!ra[c])throw new Error(`can't deserialize unregistered class ${c}`);const{klass:d}=ra[c];if(!d)throw new Error(`can't deserialize unregistered class ${c}`);if(d.deserialize)return d.deserialize(h);const v=Object.create(d.prototype);for(const S of Object.keys(h)){if(S==="$name")continue;const P=h[S];v[S]=ra[c].shallow.indexOf(S)>=0?P:yl(P)}return v}throw new Error("can't deserialize object of type "+typeof h)}class _l{constructor(){this.first=!0}update(c,d){const v=Math.floor(c);return this.first?(this.first=!1,this.lastIntegerZoom=v,this.lastIntegerZoomTime=0,this.lastZoom=c,this.lastFloorZoom=v,!0):(this.lastFloorZoom>v?(this.lastIntegerZoom=v+1,this.lastIntegerZoomTime=d):this.lastFloorZoom<v&&(this.lastIntegerZoom=v,this.lastIntegerZoomTime=d),c!==this.lastZoom&&(this.lastZoom=c,this.lastFloorZoom=v,!0))}}const Mr={"Latin-1 Supplement":h=>h>=128&&h<=255,Arabic:h=>h>=1536&&h<=1791,"Arabic Supplement":h=>h>=1872&&h<=1919,"Arabic Extended-A":h=>h>=2208&&h<=2303,"Hangul Jamo":h=>h>=4352&&h<=4607,"Unified Canadian Aboriginal Syllabics":h=>h>=5120&&h<=5759,Khmer:h=>h>=6016&&h<=6143,"Unified Canadian Aboriginal Syllabics Extended":h=>h>=6320&&h<=6399,"General Punctuation":h=>h>=8192&&h<=8303,"Letterlike Symbols":h=>h>=8448&&h<=8527,"Number Forms":h=>h>=8528&&h<=8591,"Miscellaneous Technical":h=>h>=8960&&h<=9215,"Control Pictures":h=>h>=9216&&h<=9279,"Optical Character Recognition":h=>h>=9280&&h<=9311,"Enclosed Alphanumerics":h=>h>=9312&&h<=9471,"Geometric Shapes":h=>h>=9632&&h<=9727,"Miscellaneous Symbols":h=>h>=9728&&h<=9983,"Miscellaneous Symbols and Arrows":h=>h>=11008&&h<=11263,"CJK Radicals Supplement":h=>h>=11904&&h<=12031,"Kangxi Radicals":h=>h>=12032&&h<=12255,"Ideographic Description Characters":h=>h>=12272&&h<=12287,"CJK Symbols and Punctuation":h=>h>=12288&&h<=12351,Hiragana:h=>h>=12352&&h<=12447,Katakana:h=>h>=12448&&h<=12543,Bopomofo:h=>h>=12544&&h<=12591,"Hangul Compatibility Jamo":h=>h>=12592&&h<=12687,Kanbun:h=>h>=12688&&h<=12703,"Bopomofo Extended":h=>h>=12704&&h<=12735,"CJK Strokes":h=>h>=12736&&h<=12783,"Katakana Phonetic Extensions":h=>h>=12784&&h<=12799,"Enclosed CJK Letters and Months":h=>h>=12800&&h<=13055,"CJK Compatibility":h=>h>=13056&&h<=13311,"CJK Unified Ideographs Extension A":h=>h>=13312&&h<=19903,"Yijing Hexagram Symbols":h=>h>=19904&&h<=19967,"CJK Unified Ideographs":h=>h>=19968&&h<=40959,"Yi Syllables":h=>h>=40960&&h<=42127,"Yi Radicals":h=>h>=42128&&h<=42191,"Hangul Jamo Extended-A":h=>h>=43360&&h<=43391,"Hangul Syllables":h=>h>=44032&&h<=55215,"Hangul Jamo Extended-B":h=>h>=55216&&h<=55295,"Private Use Area":h=>h>=57344&&h<=63743,"CJK Compatibility Ideographs":h=>h>=63744&&h<=64255,"Arabic Presentation Forms-A":h=>h>=64336&&h<=65023,"Vertical Forms":h=>h>=65040&&h<=65055,"CJK Compatibility Forms":h=>h>=65072&&h<=65103,"Small Form Variants":h=>h>=65104&&h<=65135,"Arabic Presentation Forms-B":h=>h>=65136&&h<=65279,"Halfwidth and Fullwidth Forms":h=>h>=65280&&h<=65519};function Cc(h){for(const c of h)if(io(c.charCodeAt(0)))return!0;return!1}function Dr(h){for(const c of h)if(!ro(c.charCodeAt(0)))return!1;return!0}function ro(h){return!(Mr.Arabic(h)||Mr["Arabic Supplement"](h)||Mr["Arabic Extended-A"](h)||Mr["Arabic Presentation Forms-A"](h)||Mr["Arabic Presentation Forms-B"](h))}function io(h){return!(h!==746&&h!==747&&(h<4352||!(Mr["Bopomofo Extended"](h)||Mr.Bopomofo(h)||Mr["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||Mr["CJK Compatibility Ideographs"](h)||Mr["CJK Compatibility"](h)||Mr["CJK Radicals Supplement"](h)||Mr["CJK Strokes"](h)||!(!Mr["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||Mr["CJK Unified Ideographs Extension A"](h)||Mr["CJK Unified Ideographs"](h)||Mr["Enclosed CJK Letters and Months"](h)||Mr["Hangul Compatibility Jamo"](h)||Mr["Hangul Jamo Extended-A"](h)||Mr["Hangul Jamo Extended-B"](h)||Mr["Hangul Jamo"](h)||Mr["Hangul Syllables"](h)||Mr.Hiragana(h)||Mr["Ideographic Description Characters"](h)||Mr.Kanbun(h)||Mr["Kangxi Radicals"](h)||Mr["Katakana Phonetic Extensions"](h)||Mr.Katakana(h)&&h!==12540||!(!Mr["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!Mr["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||Mr["Unified Canadian Aboriginal Syllabics"](h)||Mr["Unified Canadian Aboriginal Syllabics Extended"](h)||Mr["Vertical Forms"](h)||Mr["Yijing Hexagram Symbols"](h)||Mr["Yi Syllables"](h)||Mr["Yi Radicals"](h))))}function Gc(h){return!(io(h)||function(c){return!!(Mr["Latin-1 Supplement"](c)&&(c===167||c===169||c===174||c===177||c===188||c===189||c===190||c===215||c===247)||Mr["General Punctuation"](c)&&(c===8214||c===8224||c===8225||c===8240||c===8241||c===8251||c===8252||c===8258||c===8263||c===8264||c===8265||c===8273)||Mr["Letterlike Symbols"](c)||Mr["Number Forms"](c)||Mr["Miscellaneous Technical"](c)&&(c>=8960&&c<=8967||c>=8972&&c<=8991||c>=8996&&c<=9e3||c===9003||c>=9085&&c<=9114||c>=9150&&c<=9165||c===9167||c>=9169&&c<=9179||c>=9186&&c<=9215)||Mr["Control Pictures"](c)&&c!==9251||Mr["Optical Character Recognition"](c)||Mr["Enclosed Alphanumerics"](c)||Mr["Geometric Shapes"](c)||Mr["Miscellaneous Symbols"](c)&&!(c>=9754&&c<=9759)||Mr["Miscellaneous Symbols and Arrows"](c)&&(c>=11026&&c<=11055||c>=11088&&c<=11097||c>=11192&&c<=11243)||Mr["CJK Symbols and Punctuation"](c)||Mr.Katakana(c)||Mr["Private Use Area"](c)||Mr["CJK Compatibility Forms"](c)||Mr["Small Form Variants"](c)||Mr["Halfwidth and Fullwidth Forms"](c)||c===8734||c===8756||c===8757||c>=9984&&c<=10087||c>=10102&&c<=10131||c===65532||c===65533)}(h))}function ec(h){return h>=1424&&h<=2303||Mr["Arabic Presentation Forms-A"](h)||Mr["Arabic Presentation Forms-B"](h)}function mu(h,c){return!(!c&&ec(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||Mr.Khmer(h))}function jc(h){for(const c of h)if(ec(c.charCodeAt(0)))return!0;return!1}const tc="deferred",qc="loading",ol="loaded";let vn=null,Os="unavailable",Ro=null;const vl=function(h){h&&typeof h=="string"&&h.indexOf("NetworkError")>-1&&(Os="error"),vn&&vn(h)};function yu(){$c.fire(new wt("pluginStateChange",{pluginStatus:Os,pluginURL:Ro}))}const $c=new tr,Gu=function(){return Os},xa=function(){if(Os!==tc||!Ro)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Os=qc,yu(),Ro&&br({url:Ro},h=>{h?vl(h):(Os=ol,yu())})},no={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Os===ol||no.applyArabicShaping!=null,isLoading:()=>Os===qc,setState(h){if(!Pt())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Os=h.pluginStatus,Ro=h.pluginURL},isParsed(){if(!Pt())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return no.applyArabicShaping!=null&&no.processBidirectionalText!=null&&no.processStyledBidirectionalText!=null},getPluginURL(){if(!Pt())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Ro}};class Sr{constructor(c,d){this.zoom=c,d?(this.now=d.now,this.fadeDuration=d.fadeDuration,this.zoomHistory=d.zoomHistory,this.transition=d.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _l,this.transition={})}isSupportedScript(c){return function(d,v){for(const S of d)if(!mu(S.charCodeAt(0),v))return!1;return!0}(c,no.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const c=this.zoom,d=c-Math.floor(c),v=this.crossFadingFactor();return c>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:d+(1-d)*v}:{fromScale:.5,toScale:1,t:1-(1-v)*d}}}class oi{constructor(c,d){this.property=c,this.value=d,this.expression=function(v,S){if(Lt(v))return new Po(v,S);if(Pn(v)){const P=eo(v,S);if(P.result==="error")throw new Error(P.value.map(k=>`${k.key}: ${k.message}`).join(", "));return P.value}{let P=v;return S.type==="color"&&typeof v=="string"?P=fi.parse(v):S.type!=="padding"||typeof v!="number"&&!Array.isArray(v)?S.type==="variableAnchorOffsetCollection"&&Array.isArray(v)&&(P=Nn.parse(v)):P=Bn.parse(v),{kind:"constant",evaluate:()=>P}}}(d===void 0?c.specification.default:d,c.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(c,d,v){return this.property.possiblyEvaluate(this,c,d,v)}}class bl{constructor(c){this.property=c,this.value=new oi(c,void 0)}transitioned(c,d){return new rc(this.property,this.value,d,Ne({},c.transition,this.transition),c.now)}untransitioned(){return new rc(this.property,this.value,null,{},0)}}class Kc{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitionablePropertyValues)}getValue(c){return De(this._values[c].value.value)}setValue(c,d){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new bl(this._values[c].property)),this._values[c].value=new oi(this._values[c].property,d===null?void 0:De(d))}getTransition(c){return De(this._values[c].transition)}setTransition(c,d){Object.prototype.hasOwnProperty.call(this._values,c)||(this._values[c]=new bl(this._values[c].property)),this._values[c].transition=De(d)||void 0}serialize(){const c={};for(const d of Object.keys(this._values)){const v=this.getValue(d);v!==void 0&&(c[d]=v);const S=this.getTransition(d);S!==void 0&&(c[`${d}-transition`]=S)}return c}transitioned(c,d){const v=new Us(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].transitioned(c,d._values[S]);return v}untransitioned(){const c=new Us(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].untransitioned();return c}}class rc{constructor(c,d,v,S,P){this.property=c,this.value=d,this.begin=P+S.delay||0,this.end=this.begin+S.duration||0,c.specification.transition&&(S.delay||S.duration)&&(this.prior=v)}possiblyEvaluate(c,d,v){const S=c.now||0,P=this.value.possiblyEvaluate(c,d,v),k=this.prior;if(k){if(S>this.end)return this.prior=null,P;if(this.value.isDataDriven())return this.prior=null,P;if(S<this.begin)return k.possiblyEvaluate(c,d,v);{const G=(S-this.begin)/(this.end-this.begin);return this.property.interpolate(k.possiblyEvaluate(c,d,v),P,function(W){if(W<=0)return 0;if(W>=1)return 1;const ee=W*W,ae=ee*W;return 4*(W<.5?ae:3*(W-ee)+ae-.75)}(G))}}return P}}class Us{constructor(c){this._properties=c,this._values=Object.create(c.defaultTransitioningPropertyValues)}possiblyEvaluate(c,d,v){const S=new Wc(this._properties);for(const P of Object.keys(this._values))S._values[P]=this._values[P].possiblyEvaluate(c,d,v);return S}hasTransition(){for(const c of Object.keys(this._values))if(this._values[c].prior)return!0;return!1}}class uA{constructor(c){this._properties=c,this._values=Object.create(c.defaultPropertyValues)}hasValue(c){return this._values[c].value!==void 0}getValue(c){return De(this._values[c].value)}setValue(c,d){this._values[c]=new oi(this._values[c].property,d===null?void 0:De(d))}serialize(){const c={};for(const d of Object.keys(this._values)){const v=this.getValue(d);v!==void 0&&(c[d]=v)}return c}possiblyEvaluate(c,d,v){const S=new Wc(this._properties);for(const P of Object.keys(this._values))S._values[P]=this._values[P].possiblyEvaluate(c,d,v);return S}}class Wn{constructor(c,d,v){this.property=c,this.value=d,this.parameters=v}isConstant(){return this.value.kind==="constant"}constantOr(c){return this.value.kind==="constant"?this.value.value:c}evaluate(c,d,v,S){return this.property.evaluate(this.value,this.parameters,c,d,v,S)}}class Wc{constructor(c){this._properties=c,this._values=Object.create(c.defaultPossiblyEvaluatedValues)}get(c){return this._values[c]}}class Kr{constructor(c){this.specification=c}possiblyEvaluate(c,d){if(c.isDataDriven())throw new Error("Value should not be data driven");return c.expression.evaluate(d)}interpolate(c,d,v){const S=As[this.specification.type];return S?S(c,d,v):c}}class Qr{constructor(c,d){this.specification=c,this.overrides=d}possiblyEvaluate(c,d,v,S){return new Wn(this,c.expression.kind==="constant"||c.expression.kind==="camera"?{kind:"constant",value:c.expression.evaluate(d,null,{},v,S)}:c.expression,d)}interpolate(c,d,v){if(c.value.kind!=="constant"||d.value.kind!=="constant")return c;if(c.value.value===void 0||d.value.value===void 0)return new Wn(this,{kind:"constant",value:void 0},c.parameters);const S=As[this.specification.type];if(S){const P=S(c.value.value,d.value.value,v);return new Wn(this,{kind:"constant",value:P},c.parameters)}return c}evaluate(c,d,v,S,P,k){return c.kind==="constant"?c.value:c.evaluate(d,v,S,P,k)}}class Xn extends Qr{possiblyEvaluate(c,d,v,S){if(c.value===void 0)return new Wn(this,{kind:"constant",value:void 0},d);if(c.expression.kind==="constant"){const P=c.expression.evaluate(d,null,{},v,S),k=c.property.specification.type==="resolvedImage"&&typeof P!="string"?P.name:P,G=this._calculate(k,k,k,d);return new Wn(this,{kind:"constant",value:G},d)}if(c.expression.kind==="camera"){const P=this._calculate(c.expression.evaluate({zoom:d.zoom-1}),c.expression.evaluate({zoom:d.zoom}),c.expression.evaluate({zoom:d.zoom+1}),d);return new Wn(this,{kind:"constant",value:P},d)}return new Wn(this,c.expression,d)}evaluate(c,d,v,S,P,k){if(c.kind==="source"){const G=c.evaluate(d,v,S,P,k);return this._calculate(G,G,G,d)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(d.zoom)-1},v,S),c.evaluate({zoom:Math.floor(d.zoom)},v,S),c.evaluate({zoom:Math.floor(d.zoom)+1},v,S),d):c.value}_calculate(c,d,v,S){return S.zoom>S.zoomHistory.lastIntegerZoom?{from:c,to:d}:{from:v,to:d}}interpolate(c){return c}}class ju{constructor(c){this.specification=c}possiblyEvaluate(c,d,v,S){if(c.value!==void 0){if(c.expression.kind==="constant"){const P=c.expression.evaluate(d,null,{},v,S);return this._calculate(P,P,P,d)}return this._calculate(c.expression.evaluate(new Sr(Math.floor(d.zoom-1),d)),c.expression.evaluate(new Sr(Math.floor(d.zoom),d)),c.expression.evaluate(new Sr(Math.floor(d.zoom+1),d)),d)}}_calculate(c,d,v,S){return S.zoom>S.zoomHistory.lastIntegerZoom?{from:c,to:d}:{from:v,to:d}}interpolate(c){return c}}class ko{constructor(c){this.specification=c}possiblyEvaluate(c,d,v,S){return!!c.expression.evaluate(d,null,{},v,S)}interpolate(){return!1}}class sn{constructor(c){this.properties=c,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const d in c){const v=c[d];v.specification.overridable&&this.overridableProperties.push(d);const S=this.defaultPropertyValues[d]=new oi(v,void 0),P=this.defaultTransitionablePropertyValues[d]=new bl(v);this.defaultTransitioningPropertyValues[d]=P.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=S.possiblyEvaluate({})}}}Nr("DataDrivenProperty",Qr),Nr("DataConstantProperty",Kr),Nr("CrossFadedDataDrivenProperty",Xn),Nr("CrossFadedProperty",ju),Nr("ColorRampProperty",ko);const Ks="-transition";class Oo extends tr{constructor(c,d){if(super(),this.id=c.id,this.type=c.type,this._featureFilter={filter:()=>!0,needGeometry:!1},c.type!=="custom"&&(this.metadata=c.metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),d.layout&&(this._unevaluatedLayout=new uA(d.layout)),d.paint)){this._transitionablePaint=new Kc(d.paint);for(const v in c.paint)this.setPaintProperty(v,c.paint[v],{validate:!1});for(const v in c.layout)this.setLayoutProperty(v,c.layout[v],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Wc(d.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)}setLayoutProperty(c,d){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};d!=null&&this._validate(va,`layers.${this.id}.layout.${c}`,c,d,v)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,d):this.visibility=d)}getPaintProperty(c){return c.endsWith(Ks)?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)}setPaintProperty(c,d){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(d!=null&&this._validate(zn,`layers.${this.id}.paint.${c}`,c,d,v))return!1;if(c.endsWith(Ks))return this._transitionablePaint.setTransition(c.slice(0,-11),d||void 0),!1;{const S=this._transitionablePaint._values[c],P=S.property.specification["property-type"]==="cross-faded-data-driven",k=S.value.isDataDriven(),G=S.value;this._transitionablePaint.setValue(c,d),this._handleSpecialPaintPropertyUpdate(c);const W=this._transitionablePaint._values[c].value;return W.isDataDriven()||k||P||this._handleOverridablePaintPropertyUpdate(c,G,W)}}_handleSpecialPaintPropertyUpdate(c){}_handleOverridablePaintPropertyUpdate(c,d,v){return!1}isHidden(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"}updateTransitions(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(c,d){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,d)}serialize(){const c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),ke(c,(d,v)=>!(d===void 0||v==="layout"&&!Object.keys(d).length||v==="paint"&&!Object.keys(d).length))}_validate(c,d,v,S){let P=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!P||P.validate!==!1)&&ka(this,c.call(tn,{key:d,layerType:this.type,objectKey:v,value:S,styleSpec:ht,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const c in this.paint._values){const d=this.paint.get(c);if(d instanceof Wn&&Pe(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1}}const _u={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ws{constructor(c,d){this._structArray=c,this._pos1=d*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Yi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(c,d){return c._trim(),d&&(c.isTransferred=!0,d.push(c.arrayBuffer)),{length:c.length,arrayBuffer:c.arrayBuffer}}static deserialize(c){const d=Object.create(this.prototype);return d.arrayBuffer=c.arrayBuffer,d.length=c.length,d.capacity=c.arrayBuffer.byteLength/d.bytesPerElement,d._refreshViews(),d}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(c){this.reserve(c),this.length=c}reserve(c){if(c>this.capacity){this.capacity=Math.max(c,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const d=this.uint8;this._refreshViews(),d&&this.uint8.set(d)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Fn(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,d=0,v=0;return{members:h.map(S=>{const P=_u[S.type].BYTES_PER_ELEMENT,k=d=ic(d,Math.max(c,P)),G=S.components||1;return v=Math.max(v,P),d+=P*G,{name:S.name,type:S.type,components:G,offset:k}}),size:ic(d,Math.max(v,c)),alignment:c}}function ic(h,c){return Math.ceil(h/c)*c}class nc extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d){const v=this.length;return this.resize(v+1),this.emplace(v,c,d)}emplace(c,d,v){const S=2*c;return this.int16[S+0]=d,this.int16[S+1]=v,c}}nc.prototype.bytesPerElement=4,Nr("StructArrayLayout2i4",nc);class Uo extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,v){const S=this.length;return this.resize(S+1),this.emplace(S,c,d,v)}emplace(c,d,v,S){const P=3*c;return this.int16[P+0]=d,this.int16[P+1]=v,this.int16[P+2]=S,c}}Uo.prototype.bytesPerElement=6,Nr("StructArrayLayout3i6",Uo);class Oa extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,v,S){const P=this.length;return this.resize(P+1),this.emplace(P,c,d,v,S)}emplace(c,d,v,S,P){const k=4*c;return this.int16[k+0]=d,this.int16[k+1]=v,this.int16[k+2]=S,this.int16[k+3]=P,c}}Oa.prototype.bytesPerElement=8,Nr("StructArrayLayout4i8",Oa);class sc extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,v,S,P,k){const G=this.length;return this.resize(G+1),this.emplace(G,c,d,v,S,P,k)}emplace(c,d,v,S,P,k,G){const W=6*c;return this.int16[W+0]=d,this.int16[W+1]=v,this.int16[W+2]=S,this.int16[W+3]=P,this.int16[W+4]=k,this.int16[W+5]=G,c}}sc.prototype.bytesPerElement=12,Nr("StructArrayLayout2i4i12",sc);class Xc extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,v,S,P,k){const G=this.length;return this.resize(G+1),this.emplace(G,c,d,v,S,P,k)}emplace(c,d,v,S,P,k,G){const W=4*c,ee=8*c;return this.int16[W+0]=d,this.int16[W+1]=v,this.uint8[ee+4]=S,this.uint8[ee+5]=P,this.uint8[ee+6]=k,this.uint8[ee+7]=G,c}}Xc.prototype.bytesPerElement=8,Nr("StructArrayLayout2i4ub8",Xc);class No extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d){const v=this.length;return this.resize(v+1),this.emplace(v,c,d)}emplace(c,d,v){const S=2*c;return this.float32[S+0]=d,this.float32[S+1]=v,c}}No.prototype.bytesPerElement=8,Nr("StructArrayLayout2f8",No);class oc extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,v,S,P,k,G,W,ee,ae){const fe=this.length;return this.resize(fe+1),this.emplace(fe,c,d,v,S,P,k,G,W,ee,ae)}emplace(c,d,v,S,P,k,G,W,ee,ae,fe){const me=10*c;return this.uint16[me+0]=d,this.uint16[me+1]=v,this.uint16[me+2]=S,this.uint16[me+3]=P,this.uint16[me+4]=k,this.uint16[me+5]=G,this.uint16[me+6]=W,this.uint16[me+7]=ee,this.uint16[me+8]=ae,this.uint16[me+9]=fe,c}}oc.prototype.bytesPerElement=20,Nr("StructArrayLayout10ui20",oc);class wa extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,v,S,P,k,G,W,ee,ae,fe,me){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,c,d,v,S,P,k,G,W,ee,ae,fe,me)}emplace(c,d,v,S,P,k,G,W,ee,ae,fe,me,Ce){const Me=12*c;return this.int16[Me+0]=d,this.int16[Me+1]=v,this.int16[Me+2]=S,this.int16[Me+3]=P,this.uint16[Me+4]=k,this.uint16[Me+5]=G,this.uint16[Me+6]=W,this.uint16[Me+7]=ee,this.int16[Me+8]=ae,this.int16[Me+9]=fe,this.int16[Me+10]=me,this.int16[Me+11]=Ce,c}}wa.prototype.bytesPerElement=24,Nr("StructArrayLayout4i4ui4i24",wa);class Qi extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,v){const S=this.length;return this.resize(S+1),this.emplace(S,c,d,v)}emplace(c,d,v,S){const P=3*c;return this.float32[P+0]=d,this.float32[P+1]=v,this.float32[P+2]=S,c}}Qi.prototype.bytesPerElement=12,Nr("StructArrayLayout3f12",Qi);class N extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(c){const d=this.length;return this.resize(d+1),this.emplace(d,c)}emplace(c,d){return this.uint32[1*c+0]=d,c}}N.prototype.bytesPerElement=4,Nr("StructArrayLayout1ul4",N);class A extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,v,S,P,k,G,W,ee){const ae=this.length;return this.resize(ae+1),this.emplace(ae,c,d,v,S,P,k,G,W,ee)}emplace(c,d,v,S,P,k,G,W,ee,ae){const fe=10*c,me=5*c;return this.int16[fe+0]=d,this.int16[fe+1]=v,this.int16[fe+2]=S,this.int16[fe+3]=P,this.int16[fe+4]=k,this.int16[fe+5]=G,this.uint32[me+3]=W,this.uint16[fe+8]=ee,this.uint16[fe+9]=ae,c}}A.prototype.bytesPerElement=20,Nr("StructArrayLayout6i1ul2ui20",A);class b extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,v,S,P,k){const G=this.length;return this.resize(G+1),this.emplace(G,c,d,v,S,P,k)}emplace(c,d,v,S,P,k,G){const W=6*c;return this.int16[W+0]=d,this.int16[W+1]=v,this.int16[W+2]=S,this.int16[W+3]=P,this.int16[W+4]=k,this.int16[W+5]=G,c}}b.prototype.bytesPerElement=12,Nr("StructArrayLayout2i2i2i12",b);class M extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(c,d,v,S,P){const k=this.length;return this.resize(k+1),this.emplace(k,c,d,v,S,P)}emplace(c,d,v,S,P,k){const G=4*c,W=8*c;return this.float32[G+0]=d,this.float32[G+1]=v,this.float32[G+2]=S,this.int16[W+6]=P,this.int16[W+7]=k,c}}M.prototype.bytesPerElement=16,Nr("StructArrayLayout2f1f2i16",M);class O extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,v,S){const P=this.length;return this.resize(P+1),this.emplace(P,c,d,v,S)}emplace(c,d,v,S,P){const k=12*c,G=3*c;return this.uint8[k+0]=d,this.uint8[k+1]=v,this.float32[G+1]=S,this.float32[G+2]=P,c}}O.prototype.bytesPerElement=12,Nr("StructArrayLayout2ub2f12",O);class z extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,v){const S=this.length;return this.resize(S+1),this.emplace(S,c,d,v)}emplace(c,d,v,S){const P=3*c;return this.uint16[P+0]=d,this.uint16[P+1]=v,this.uint16[P+2]=S,c}}z.prototype.bytesPerElement=6,Nr("StructArrayLayout3ui6",z);class J extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,v,S,P,k,G,W,ee,ae,fe,me,Ce,Me,Ue,$e,Ke){const ut=this.length;return this.resize(ut+1),this.emplace(ut,c,d,v,S,P,k,G,W,ee,ae,fe,me,Ce,Me,Ue,$e,Ke)}emplace(c,d,v,S,P,k,G,W,ee,ae,fe,me,Ce,Me,Ue,$e,Ke,ut){const tt=24*c,it=12*c,yt=48*c;return this.int16[tt+0]=d,this.int16[tt+1]=v,this.uint16[tt+2]=S,this.uint16[tt+3]=P,this.uint32[it+2]=k,this.uint32[it+3]=G,this.uint32[it+4]=W,this.uint16[tt+10]=ee,this.uint16[tt+11]=ae,this.uint16[tt+12]=fe,this.float32[it+7]=me,this.float32[it+8]=Ce,this.uint8[yt+36]=Me,this.uint8[yt+37]=Ue,this.uint8[yt+38]=$e,this.uint32[it+10]=Ke,this.int16[tt+22]=ut,c}}J.prototype.bytesPerElement=48,Nr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",J);class w extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,v,S,P,k,G,W,ee,ae,fe,me,Ce,Me,Ue,$e,Ke,ut,tt,it,yt,St,Jt,Br,ar,pr,_r,kr){const lr=this.length;return this.resize(lr+1),this.emplace(lr,c,d,v,S,P,k,G,W,ee,ae,fe,me,Ce,Me,Ue,$e,Ke,ut,tt,it,yt,St,Jt,Br,ar,pr,_r,kr)}emplace(c,d,v,S,P,k,G,W,ee,ae,fe,me,Ce,Me,Ue,$e,Ke,ut,tt,it,yt,St,Jt,Br,ar,pr,_r,kr,lr){const Yt=32*c,jr=16*c;return this.int16[Yt+0]=d,this.int16[Yt+1]=v,this.int16[Yt+2]=S,this.int16[Yt+3]=P,this.int16[Yt+4]=k,this.int16[Yt+5]=G,this.int16[Yt+6]=W,this.int16[Yt+7]=ee,this.uint16[Yt+8]=ae,this.uint16[Yt+9]=fe,this.uint16[Yt+10]=me,this.uint16[Yt+11]=Ce,this.uint16[Yt+12]=Me,this.uint16[Yt+13]=Ue,this.uint16[Yt+14]=$e,this.uint16[Yt+15]=Ke,this.uint16[Yt+16]=ut,this.uint16[Yt+17]=tt,this.uint16[Yt+18]=it,this.uint16[Yt+19]=yt,this.uint16[Yt+20]=St,this.uint16[Yt+21]=Jt,this.uint16[Yt+22]=Br,this.uint32[jr+12]=ar,this.float32[jr+13]=pr,this.float32[jr+14]=_r,this.uint16[Yt+30]=kr,this.uint16[Yt+31]=lr,c}}w.prototype.bytesPerElement=64,Nr("StructArrayLayout8i15ui1ul2f2ui64",w);class l extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c){const d=this.length;return this.resize(d+1),this.emplace(d,c)}emplace(c,d){return this.float32[1*c+0]=d,c}}l.prototype.bytesPerElement=4,Nr("StructArrayLayout1f4",l);class p extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,v){const S=this.length;return this.resize(S+1),this.emplace(S,c,d,v)}emplace(c,d,v,S){const P=3*c;return this.uint16[6*c+0]=d,this.float32[P+1]=v,this.float32[P+2]=S,c}}p.prototype.bytesPerElement=12,Nr("StructArrayLayout1ui2f12",p);class x extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d,v){const S=this.length;return this.resize(S+1),this.emplace(S,c,d,v)}emplace(c,d,v,S){const P=4*c;return this.uint32[2*c+0]=d,this.uint16[P+2]=v,this.uint16[P+3]=S,c}}x.prototype.bytesPerElement=8,Nr("StructArrayLayout1ul2ui8",x);class B extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c,d){const v=this.length;return this.resize(v+1),this.emplace(v,c,d)}emplace(c,d,v){const S=2*c;return this.uint16[S+0]=d,this.uint16[S+1]=v,c}}B.prototype.bytesPerElement=4,Nr("StructArrayLayout2ui4",B);class L extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(c){const d=this.length;return this.resize(d+1),this.emplace(d,c)}emplace(c,d){return this.uint16[1*c+0]=d,c}}L.prototype.bytesPerElement=2,Nr("StructArrayLayout1ui2",L);class j extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(c,d,v,S){const P=this.length;return this.resize(P+1),this.emplace(P,c,d,v,S)}emplace(c,d,v,S,P){const k=4*c;return this.float32[k+0]=d,this.float32[k+1]=v,this.float32[k+2]=S,this.float32[k+3]=P,c}}j.prototype.bytesPerElement=16,Nr("StructArrayLayout4f16",j);class _ extends Ws{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new R(this.anchorPointX,this.anchorPointY)}}_.prototype.size=20;class E extends A{get(c){return new _(this,c)}}Nr("CollisionBoxArray",E);class F extends Ws{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(c){this._structArray.uint8[this._pos1+37]=c}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(c){this._structArray.uint8[this._pos1+38]=c}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(c){this._structArray.uint32[this._pos4+10]=c}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}F.prototype.size=48;class V extends J{get(c){return new F(this,c)}}Nr("PlacedSymbolArray",V);class q extends Ws{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(c){this._structArray.uint32[this._pos4+12]=c}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}q.prototype.size=64;class K extends w{get(c){return new q(this,c)}}Nr("SymbolInstanceArray",K);class te extends l{getoffsetX(c){return this.float32[1*c+0]}}Nr("GlyphOffsetArray",te);class se extends Uo{getx(c){return this.int16[3*c+0]}gety(c){return this.int16[3*c+1]}gettileUnitDistanceFromAnchor(c){return this.int16[3*c+2]}}Nr("SymbolLineVertexArray",se);class oe extends Ws{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}oe.prototype.size=12;class le extends p{get(c){return new oe(this,c)}}Nr("TextAnchorOffsetArray",le);class _e extends Ws{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}_e.prototype.size=8;class Ie extends x{get(c){return new _e(this,c)}}Nr("FeatureIndexArray",Ie);class ve extends nc{}class Se extends nc{}class et extends nc{}class Oe extends sc{}class Re extends Xc{}class Ve extends No{}class At extends oc{}class dt extends wa{}class ft extends Qi{}class Nt extends N{}class It extends b{}class jt extends O{}class Ht extends z{}class Pr extends B{}const yr=Fn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ir}=yr;class hr{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.segments=c}prepareSegment(c,d,v,S){let P=this.segments[this.segments.length-1];return c>hr.MAX_VERTEX_ARRAY_LENGTH&&Xe(`Max vertices per segment is ${hr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${c}`),(!P||P.vertexLength+c>hr.MAX_VERTEX_ARRAY_LENGTH||P.sortKey!==S)&&(P={vertexOffset:d.length,primitiveOffset:v.length,vertexLength:0,primitiveLength:0},S!==void 0&&(P.sortKey=S),this.segments.push(P)),P}get(){return this.segments}destroy(){for(const c of this.segments)for(const d in c.vaos)c.vaos[d].destroy()}static simpleSegment(c,d,v,S){return new hr([{vertexOffset:c,primitiveOffset:d,vertexLength:v,primitiveLength:S,vaos:{},sortKey:0}])}}function li(h,c){return 256*(h=je(Math.floor(h),0,255))+je(Math.floor(c),0,255)}hr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Nr("SegmentVector",hr);const ti=Fn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ii={exports:{}},Ri={exports:{}};Ri.exports=function(h,c){var d,v,S,P,k,G,W,ee;for(v=h.length-(d=3&h.length),S=c,k=3432918353,G=461845907,ee=0;ee<v;)W=255&h.charCodeAt(ee)|(255&h.charCodeAt(++ee))<<8|(255&h.charCodeAt(++ee))<<16|(255&h.charCodeAt(++ee))<<24,++ee,S=27492+(65535&(P=5*(65535&(S=(S^=W=(65535&(W=(W=(65535&W)*k+(((W>>>16)*k&65535)<<16)&4294967295)<<15|W>>>17))*G+(((W>>>16)*G&65535)<<16)&4294967295)<<13|S>>>19))+((5*(S>>>16)&65535)<<16)&4294967295))+((58964+(P>>>16)&65535)<<16);switch(W=0,d){case 3:W^=(255&h.charCodeAt(ee+2))<<16;case 2:W^=(255&h.charCodeAt(ee+1))<<8;case 1:S^=W=(65535&(W=(W=(65535&(W^=255&h.charCodeAt(ee)))*k+(((W>>>16)*k&65535)<<16)&4294967295)<<15|W>>>17))*G+(((W>>>16)*G&65535)<<16)&4294967295}return S^=h.length,S=2246822507*(65535&(S^=S>>>16))+((2246822507*(S>>>16)&65535)<<16)&4294967295,S=3266489909*(65535&(S^=S>>>13))+((3266489909*(S>>>16)&65535)<<16)&4294967295,(S^=S>>>16)>>>0};var ki=Ri.exports,wi={exports:{}};wi.exports=function(h,c){for(var d,v=h.length,S=c^v,P=0;v>=4;)d=1540483477*(65535&(d=255&h.charCodeAt(P)|(255&h.charCodeAt(++P))<<8|(255&h.charCodeAt(++P))<<16|(255&h.charCodeAt(++P))<<24))+((1540483477*(d>>>16)&65535)<<16),S=1540483477*(65535&S)+((1540483477*(S>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),v-=4,++P;switch(v){case 3:S^=(255&h.charCodeAt(P+2))<<16;case 2:S^=(255&h.charCodeAt(P+1))<<8;case 1:S=1540483477*(65535&(S^=255&h.charCodeAt(P)))+((1540483477*(S>>>16)&65535)<<16)}return S=1540483477*(65535&(S^=S>>>13))+((1540483477*(S>>>16)&65535)<<16),(S^=S>>>15)>>>0};var Ki=ki,xi=wi.exports;ii.exports=Ki,ii.exports.murmur3=Ki,ii.exports.murmur2=xi;var Zn=y(ii.exports);class Wi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(c,d,v,S){this.ids.push(Oi(c)),this.positions.push(d,v,S)}getPositions(c){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const d=Oi(c);let v=0,S=this.ids.length-1;for(;v<S;){const k=v+S>>1;this.ids[k]>=d?S=k:v=k+1}const P=[];for(;this.ids[v]===d;)P.push({index:this.positions[3*v],start:this.positions[3*v+1],end:this.positions[3*v+2]}),v++;return P}static serialize(c,d){const v=new Float64Array(c.ids),S=new Uint32Array(c.positions);return Xi(v,S,0,v.length-1),d&&d.push(v.buffer,S.buffer),{ids:v,positions:S}}static deserialize(c){const d=new Wi;return d.ids=c.ids,d.positions=c.positions,d.indexed=!0,d}}function Oi(h){const c=+h;return!isNaN(c)&&c<=Number.MAX_SAFE_INTEGER?c:Zn(String(h))}function Xi(h,c,d,v){for(;d<v;){const S=h[d+v>>1];let P=d-1,k=v+1;for(;;){do P++;while(h[P]<S);do k--;while(h[k]>S);if(P>=k)break;hi(h,P,k),hi(c,3*P,3*k),hi(c,3*P+1,3*k+1),hi(c,3*P+2,3*k+2)}k-d<v-k?(Xi(h,c,d,k),d=k+1):(Xi(h,c,k+1,v),v=k)}}function hi(h,c,d){const v=h[c];h[c]=h[d],h[d]=v}Nr("FeaturePositionMap",Wi);class zi{constructor(c,d){this.gl=c.gl,this.location=d}}class on extends zi{constructor(c,d){super(c,d),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class rs extends zi{constructor(c,d){super(c,d),this.current=[0,0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))}}class an extends zi{constructor(c,d){super(c,d),this.current=fi.transparent}set(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))}}const is=new Float32Array(16);function Es(h){return[li(255*h.r,255*h.g),li(255*h.b,255*h.a)]}class yi{constructor(c,d,v){this.value=c,this.uniformNames=d.map(S=>`u_${S}`),this.type=v}setUniform(c,d,v){c.set(v.constantOr(this.value))}getBinding(c,d,v){return this.type==="color"?new an(c,d):new on(c,d)}}class bn{constructor(c,d){this.uniformNames=d.map(v=>`u_${v}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(c,d){this.pixelRatioFrom=d.pixelRatio,this.pixelRatioTo=c.pixelRatio,this.patternFrom=d.tlbr,this.patternTo=c.tlbr}setUniform(c,d,v,S){const P=S==="u_pattern_to"?this.patternTo:S==="u_pattern_from"?this.patternFrom:S==="u_pixel_ratio_to"?this.pixelRatioTo:S==="u_pixel_ratio_from"?this.pixelRatioFrom:null;P&&c.set(P)}getBinding(c,d,v){return v.substr(0,9)==="u_pattern"?new rs(c,d):new on(c,d)}}class ia{constructor(c,d,v,S){this.expression=c,this.type=v,this.maxValue=0,this.paintVertexAttributes=d.map(P=>({name:`a_${P}`,type:"Float32",components:v==="color"?2:1,offset:0})),this.paintVertexArray=new S}populatePaintArray(c,d,v,S,P){const k=this.paintVertexArray.length,G=this.expression.evaluate(new Sr(0),d,{},S,[],P);this.paintVertexArray.resize(c),this._setPaintValue(k,c,G)}updatePaintArray(c,d,v,S){const P=this.expression.evaluate({zoom:0},v,S);this._setPaintValue(c,d,P)}_setPaintValue(c,d,v){if(this.type==="color"){const S=Es(v);for(let P=c;P<d;P++)this.paintVertexArray.emplace(P,S[0],S[1])}else{for(let S=c;S<d;S++)this.paintVertexArray.emplace(S,v);this.maxValue=Math.max(this.maxValue,Math.abs(v))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ns{constructor(c,d,v,S,P,k){this.expression=c,this.uniformNames=d.map(G=>`u_${G}_t`),this.type=v,this.useIntegerZoom=S,this.zoom=P,this.maxValue=0,this.paintVertexAttributes=d.map(G=>({name:`a_${G}`,type:"Float32",components:v==="color"?4:2,offset:0})),this.paintVertexArray=new k}populatePaintArray(c,d,v,S,P){const k=this.expression.evaluate(new Sr(this.zoom),d,{},S,[],P),G=this.expression.evaluate(new Sr(this.zoom+1),d,{},S,[],P),W=this.paintVertexArray.length;this.paintVertexArray.resize(c),this._setPaintValue(W,c,k,G)}updatePaintArray(c,d,v,S){const P=this.expression.evaluate({zoom:this.zoom},v,S),k=this.expression.evaluate({zoom:this.zoom+1},v,S);this._setPaintValue(c,d,P,k)}_setPaintValue(c,d,v,S){if(this.type==="color"){const P=Es(v),k=Es(S);for(let G=c;G<d;G++)this.paintVertexArray.emplace(G,P[0],P[1],k[0],k[1])}else{for(let P=c;P<d;P++)this.paintVertexArray.emplace(P,v,S);this.maxValue=Math.max(this.maxValue,Math.abs(v),Math.abs(S))}}upload(c){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=c.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(c,d){const v=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,S=je(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);c.set(S)}getBinding(c,d,v){return new on(c,d)}}class so{constructor(c,d,v,S,P,k){this.expression=c,this.type=d,this.useIntegerZoom=v,this.zoom=S,this.layerId=k,this.zoomInPaintVertexArray=new P,this.zoomOutPaintVertexArray=new P}populatePaintArray(c,d,v){const S=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(c),this.zoomOutPaintVertexArray.resize(c),this._setPaintValues(S,c,d.patterns&&d.patterns[this.layerId],v)}updatePaintArray(c,d,v,S,P){this._setPaintValues(c,d,v.patterns&&v.patterns[this.layerId],P)}_setPaintValues(c,d,v,S){if(!S||!v)return;const{min:P,mid:k,max:G}=v,W=S[P],ee=S[k],ae=S[G];if(W&&ee&&ae)for(let fe=c;fe<d;fe++)this.zoomInPaintVertexArray.emplace(fe,ee.tl[0],ee.tl[1],ee.br[0],ee.br[1],W.tl[0],W.tl[1],W.br[0],W.br[1],ee.pixelRatio,W.pixelRatio),this.zoomOutPaintVertexArray.emplace(fe,ee.tl[0],ee.tl[1],ee.br[0],ee.br[1],ae.tl[0],ae.tl[1],ae.br[0],ae.br[1],ee.pixelRatio,ae.pixelRatio)}upload(c){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=c.createVertexBuffer(this.zoomInPaintVertexArray,ti.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=c.createVertexBuffer(this.zoomOutPaintVertexArray,ti.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class xl{constructor(c,d,v){this.binders={},this._buffers=[];const S=[];for(const P in c.paint._values){if(!v(P))continue;const k=c.paint.get(P);if(!(k instanceof Wn&&Pe(k.property.specification)))continue;const G=ac(P,c.type),W=k.value,ee=k.property.specification.type,ae=k.property.useIntegerZoom,fe=k.property.specification["property-type"],me=fe==="cross-faded"||fe==="cross-faded-data-driven";if(W.kind==="constant")this.binders[P]=me?new bn(W.value,G):new yi(W.value,G,ee),S.push(`/u_${P}`);else if(W.kind==="source"||me){const Ce=Ua(P,ee,"source");this.binders[P]=me?new so(W,ee,ae,d,Ce,c.id):new ia(W,G,ee,Ce),S.push(`/a_${P}`)}else{const Ce=Ua(P,ee,"composite");this.binders[P]=new Ns(W,G,ee,ae,d,Ce),S.push(`/z_${P}`)}}this.cacheKey=S.sort().join("")}getMaxValue(c){const d=this.binders[c];return d instanceof ia||d instanceof Ns?d.maxValue:0}populatePaintArrays(c,d,v,S,P){for(const k in this.binders){const G=this.binders[k];(G instanceof ia||G instanceof Ns||G instanceof so)&&G.populatePaintArray(c,d,v,S,P)}}setConstantPatternPositions(c,d){for(const v in this.binders){const S=this.binders[v];S instanceof bn&&S.setConstantPatternPositions(c,d)}}updatePaintArrays(c,d,v,S,P){let k=!1;for(const G in c){const W=d.getPositions(G);for(const ee of W){const ae=v.feature(ee.index);for(const fe in this.binders){const me=this.binders[fe];if((me instanceof ia||me instanceof Ns||me instanceof so)&&me.expression.isStateDependent===!0){const Ce=S.paint.get(fe);me.expression=Ce.value,me.updatePaintArray(ee.start,ee.end,ae,c[G],P),k=!0}}}}return k}defines(){const c=[];for(const d in this.binders){const v=this.binders[d];(v instanceof yi||v instanceof bn)&&c.push(...v.uniformNames.map(S=>`#define HAS_UNIFORM_${S}`))}return c}getBinderAttributes(){const c=[];for(const d in this.binders){const v=this.binders[d];if(v instanceof ia||v instanceof Ns)for(let S=0;S<v.paintVertexAttributes.length;S++)c.push(v.paintVertexAttributes[S].name);else if(v instanceof so)for(let S=0;S<ti.members.length;S++)c.push(ti.members[S].name)}return c}getBinderUniforms(){const c=[];for(const d in this.binders){const v=this.binders[d];if(v instanceof yi||v instanceof bn||v instanceof Ns)for(const S of v.uniformNames)c.push(S)}return c}getPaintVertexBuffers(){return this._buffers}getUniforms(c,d){const v=[];for(const S in this.binders){const P=this.binders[S];if(P instanceof yi||P instanceof bn||P instanceof Ns){for(const k of P.uniformNames)if(d[k]){const G=P.getBinding(c,d[k],k);v.push({name:k,property:S,binding:G})}}}return v}setUniforms(c,d,v,S){for(const{name:P,property:k,binding:G}of d)this.binders[k].setUniform(G,S,v.get(k),P)}updatePaintBuffers(c){this._buffers=[];for(const d in this.binders){const v=this.binders[d];if(c&&v instanceof so){const S=c.fromScale===2?v.zoomInPaintVertexBuffer:v.zoomOutPaintVertexBuffer;S&&this._buffers.push(S)}else(v instanceof ia||v instanceof Ns)&&v.paintVertexBuffer&&this._buffers.push(v.paintVertexBuffer)}}upload(c){for(const d in this.binders){const v=this.binders[d];(v instanceof ia||v instanceof Ns||v instanceof so)&&v.upload(c)}this.updatePaintBuffers()}destroy(){for(const c in this.binders){const d=this.binders[c];(d instanceof ia||d instanceof Ns||d instanceof so)&&d.destroy()}}}class bo{constructor(c,d){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:()=>!0;this.programConfigurations={};for(const S of c)this.programConfigurations[S.id]=new xl(S,d,v);this.needsUpload=!1,this._featureMap=new Wi,this._bufferOffset=0}populatePaintArrays(c,d,v,S,P,k){for(const G in this.programConfigurations)this.programConfigurations[G].populatePaintArrays(c,d,S,P,k);d.id!==void 0&&this._featureMap.add(d.id,v,this._bufferOffset,c),this._bufferOffset=c,this.needsUpload=!0}updatePaintArrays(c,d,v,S){for(const P of v)this.needsUpload=this.programConfigurations[P.id].updatePaintArrays(c,this._featureMap,d,P,S)||this.needsUpload}get(c){return this.programConfigurations[c]}upload(c){if(this.needsUpload){for(const d in this.programConfigurations)this.programConfigurations[d].upload(c);this.needsUpload=!1}}destroy(){for(const c in this.programConfigurations)this.programConfigurations[c].destroy()}}function ac(h,c){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(`${c}-`,"").replace(/-/g,"_")]}function Ua(h,c,d){const v={color:{source:No,composite:j},number:{source:l,composite:No}},S=function(P){return{"line-pattern":{source:At,composite:At},"fill-pattern":{source:At,composite:At},"fill-extrusion-pattern":{source:At,composite:At}}[P]}(h);return S&&S[d]||v[c][d]}Nr("ConstantBinder",yi),Nr("CrossFadedConstantBinder",bn),Nr("SourceExpressionBinder",ia),Nr("CrossFadedCompositeBinder",so),Nr("CompositeExpressionBinder",Ns),Nr("ProgramConfiguration",xl,{omit:["_buffers"]}),Nr("ProgramConfigurationSet",bo);const Dn=8192,Ec=Math.pow(2,14)-1,vu=-Ec-1;function wl(h){const c=Dn/h.extent,d=h.loadGeometry();for(let v=0;v<d.length;v++){const S=d[v];for(let P=0;P<S.length;P++){const k=S[P],G=Math.round(k.x*c),W=Math.round(k.y*c);k.x=je(G,vu,Ec),k.y=je(W,vu,Ec),(G<k.x||G>k.x+1||W<k.y||W>k.y+1)&&Xe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return d}function al(h,c){return{type:h.type,id:h.id,properties:h.properties,geometry:c?wl(h):[]}}function qu(h,c,d,v,S){h.emplaceBack(2*c+(v+1)/2,2*d+(S+1)/2)}class hA{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new Se,this.indexArray=new Ht,this.segments=new hr,this.programConfigurations=new bo(c.layers,c.zoom),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,v){const S=this.layers[0],P=[];let k=null,G=!1;S.type==="circle"&&(k=S.layout.get("circle-sort-key"),G=!k.isConstant());for(const{feature:W,id:ee,index:ae,sourceLayerIndex:fe}of c){const me=this.layers[0]._featureFilter.needGeometry,Ce=al(W,me);if(!this.layers[0]._featureFilter.filter(new Sr(this.zoom),Ce,v))continue;const Me=G?k.evaluate(Ce,{},v):void 0,Ue={id:ee,properties:W.properties,type:W.type,sourceLayerIndex:fe,index:ae,geometry:me?Ce.geometry:wl(W),patterns:{},sortKey:Me};P.push(Ue)}G&&P.sort((W,ee)=>W.sortKey-ee.sortKey);for(const W of P){const{geometry:ee,index:ae,sourceLayerIndex:fe}=W,me=c[ae].feature;this.addFeature(W,ee,ae,v),d.featureIndex.insert(me,ee,ae,fe,this.index)}}update(c,d,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Ir),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(c,d,v,S){for(const P of d)for(const k of P){const G=k.x,W=k.y;if(G<0||G>=Dn||W<0||W>=Dn)continue;const ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,c.sortKey),ae=ee.vertexLength;qu(this.layoutVertexArray,G,W,-1,-1),qu(this.layoutVertexArray,G,W,1,-1),qu(this.layoutVertexArray,G,W,1,1),qu(this.layoutVertexArray,G,W,-1,1),this.indexArray.emplaceBack(ae,ae+1,ae+2),this.indexArray.emplaceBack(ae,ae+3,ae+2),ee.vertexLength+=4,ee.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,{},S)}}function Zc(h,c){for(let d=0;d<h.length;d++)if(lc(c,h[d]))return!0;for(let d=0;d<c.length;d++)if(lc(h,c[d]))return!0;return!!$u(h,c)}function JA(h,c,d){return!!lc(h,c)||!!jd(c,h,d)}function AA(h,c){if(h.length===1)return na(c,h[0]);for(let d=0;d<c.length;d++){const v=c[d];for(let S=0;S<v.length;S++)if(lc(h,v[S]))return!0}for(let d=0;d<h.length;d++)if(na(c,h[d]))return!0;for(let d=0;d<c.length;d++)if($u(h,c[d]))return!0;return!1}function Gd(h,c,d){if(h.length>1){if($u(h,c))return!0;for(let v=0;v<c.length;v++)if(jd(c[v],h,d))return!0}for(let v=0;v<h.length;v++)if(jd(h[v],c,d))return!0;return!1}function $u(h,c){if(h.length===0||c.length===0)return!1;for(let d=0;d<h.length-1;d++){const v=h[d],S=h[d+1];for(let P=0;P<c.length-1;P++)if(bu(v,S,c[P],c[P+1]))return!0}return!1}function bu(h,c,d,v){return Ct(h,d,v)!==Ct(c,d,v)&&Ct(h,c,d)!==Ct(h,c,v)}function jd(h,c,d){const v=d*d;if(c.length===1)return h.distSqr(c[0])<v;for(let S=1;S<c.length;S++)if(wm(h,c[S-1],c[S])<v)return!0;return!1}function wm(h,c,d){const v=c.distSqr(d);if(v===0)return h.distSqr(c);const S=((h.x-c.x)*(d.x-c.x)+(h.y-c.y)*(d.y-c.y))/v;return h.distSqr(S<0?c:S>1?d:d.sub(c)._mult(S)._add(c))}function na(h,c){let d,v,S,P=!1;for(let k=0;k<h.length;k++){d=h[k];for(let G=0,W=d.length-1;G<d.length;W=G++)v=d[G],S=d[W],v.y>c.y!=S.y>c.y&&c.x<(S.x-v.x)*(c.y-v.y)/(S.y-v.y)+v.x&&(P=!P)}return P}function lc(h,c){let d=!1;for(let v=0,S=h.length-1;v<h.length;S=v++){const P=h[v],k=h[S];P.y>c.y!=k.y>c.y&&c.x<(k.x-P.x)*(c.y-P.y)/(k.y-P.y)+P.x&&(d=!d)}return d}function dA(h,c,d){const v=d[0],S=d[2];if(h.x<v.x&&c.x<v.x||h.x>S.x&&c.x>S.x||h.y<v.y&&c.y<v.y||h.y>S.y&&c.y>S.y)return!1;const P=Ct(h,c,d[0]);return P!==Ct(h,c,d[1])||P!==Ct(h,c,d[2])||P!==Ct(h,c,d[3])}function Sh(h,c,d){const v=c.paint.get(h).value;return v.kind==="constant"?v.value:d.programConfigurations.get(c.id).getMaxValue(h)}function xu(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function Th(h,c,d,v,S){if(!c[0]&&!c[1])return h;const P=R.convert(c)._mult(S);d==="viewport"&&P._rotate(-v);const k=[];for(let G=0;G<h.length;G++)k.push(h[G].sub(P));return k}let Ih,fA;Nr("CircleBucket",hA,{omit:["layers"]});var cp={get paint(){return fA=fA||new sn({"circle-radius":new Qr(ht.paint_circle["circle-radius"]),"circle-color":new Qr(ht.paint_circle["circle-color"]),"circle-blur":new Qr(ht.paint_circle["circle-blur"]),"circle-opacity":new Qr(ht.paint_circle["circle-opacity"]),"circle-translate":new Kr(ht.paint_circle["circle-translate"]),"circle-translate-anchor":new Kr(ht.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Kr(ht.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Kr(ht.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Qr(ht.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Qr(ht.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Qr(ht.paint_circle["circle-stroke-opacity"])})},get layout(){return Ih=Ih||new sn({"circle-sort-key":new Qr(ht.layout_circle["circle-sort-key"])})}},sa=1e-6,Jc=typeof Float32Array<"u"?Float32Array:Array;function qd(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function pA(h,c,d){var v=c[0],S=c[1],P=c[2],k=c[3],G=c[4],W=c[5],ee=c[6],ae=c[7],fe=c[8],me=c[9],Ce=c[10],Me=c[11],Ue=c[12],$e=c[13],Ke=c[14],ut=c[15],tt=d[0],it=d[1],yt=d[2],St=d[3];return h[0]=tt*v+it*G+yt*fe+St*Ue,h[1]=tt*S+it*W+yt*me+St*$e,h[2]=tt*P+it*ee+yt*Ce+St*Ke,h[3]=tt*k+it*ae+yt*Me+St*ut,h[4]=(tt=d[4])*v+(it=d[5])*G+(yt=d[6])*fe+(St=d[7])*Ue,h[5]=tt*S+it*W+yt*me+St*$e,h[6]=tt*P+it*ee+yt*Ce+St*Ke,h[7]=tt*k+it*ae+yt*Me+St*ut,h[8]=(tt=d[8])*v+(it=d[9])*G+(yt=d[10])*fe+(St=d[11])*Ue,h[9]=tt*S+it*W+yt*me+St*$e,h[10]=tt*P+it*ee+yt*Ce+St*Ke,h[11]=tt*k+it*ae+yt*Me+St*ut,h[12]=(tt=d[12])*v+(it=d[13])*G+(yt=d[14])*fe+(St=d[15])*Ue,h[13]=tt*S+it*W+yt*me+St*$e,h[14]=tt*P+it*ee+yt*Ce+St*Ke,h[15]=tt*k+it*ae+yt*Me+St*ut,h}Math.hypot||(Math.hypot=function(){for(var h=0,c=arguments.length;c--;)h+=arguments[c]*arguments[c];return Math.sqrt(h)});var Bl,$d=pA;function wu(h,c,d){var v=c[0],S=c[1],P=c[2],k=c[3];return h[0]=d[0]*v+d[4]*S+d[8]*P+d[12]*k,h[1]=d[1]*v+d[5]*S+d[9]*P+d[13]*k,h[2]=d[2]*v+d[6]*S+d[10]*P+d[14]*k,h[3]=d[3]*v+d[7]*S+d[11]*P+d[15]*k,h}Bl=new Jc(4),Jc!=Float32Array&&(Bl[0]=0,Bl[1]=0,Bl[2]=0,Bl[3]=0);class Cl extends Oo{constructor(c){super(c,cp)}createBucket(c){return new hA(c)}queryRadius(c){const d=c;return Sh("circle-radius",this,d)+Sh("circle-stroke-width",this,d)+xu(this.paint.get("circle-translate"))}queryIntersectsFeature(c,d,v,S,P,k,G,W){const ee=Th(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),k.angle,G),ae=this.paint.get("circle-radius").evaluate(d,v)+this.paint.get("circle-stroke-width").evaluate(d,v),fe=this.paint.get("circle-pitch-alignment")==="map",me=fe?ee:function(Me,Ue){return Me.map($e=>Kd($e,Ue))}(ee,W),Ce=fe?ae*G:ae;for(const Me of S)for(const Ue of Me){const $e=fe?Ue:Kd(Ue,W);let Ke=Ce;const ut=wu([],[Ue.x,Ue.y,0,1],W);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ke*=ut[3]/k.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ke*=k.cameraToCenterDistance/ut[3]),JA(me,$e,Ke))return!0}return!1}}function Kd(h,c){const d=wu([],[h.x,h.y,0,1],c);return new R(d[0]/d[3],d[1]/d[3])}class Lh extends hA{}let up;Nr("HeatmapBucket",Lh,{omit:["layers"]});var Bm={get paint(){return up=up||new sn({"heatmap-radius":new Qr(ht.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Qr(ht.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Kr(ht.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ko(ht.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Kr(ht.paint_heatmap["heatmap-opacity"])})}};function hp(h,c,d,v){let{width:S,height:P}=c;if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==S*P*d)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${S*P*d}`)}else v=new Uint8Array(S*P*d);return h.width=S,h.height=P,h.data=v,h}function Ap(h,c,d){let{width:v,height:S}=c;if(v===h.width&&S===h.height)return;const P=hp({},{width:v,height:S},d);dp(h,P,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,v),height:Math.min(h.height,S)},d),h.width=v,h.height=S,h.data=P.data}function dp(h,c,d,v,S,P){if(S.width===0||S.height===0)return c;if(S.width>h.width||S.height>h.height||d.x>h.width-S.width||d.y>h.height-S.height)throw new RangeError("out of range source coordinates for image copy");if(S.width>c.width||S.height>c.height||v.x>c.width-S.width||v.y>c.height-S.height)throw new RangeError("out of range destination coordinates for image copy");const k=h.data,G=c.data;if(k===G)throw new Error("srcData equals dstData, so image is already copied");for(let W=0;W<S.height;W++){const ee=((d.y+W)*h.width+d.x)*P,ae=((v.y+W)*c.width+v.x)*P;for(let fe=0;fe<S.width*P;fe++)G[ae+fe]=k[ee+fe]}return c}class Sc{constructor(c,d){hp(this,c,1,d)}resize(c){Ap(this,c,1)}clone(){return new Sc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,d,v,S,P){dp(c,d,v,S,P,1)}}class zo{constructor(c,d){hp(this,c,4,d)}resize(c){Ap(this,c,4)}replace(c,d){d?this.data.set(c):this.data=c instanceof Uint8ClampedArray?new Uint8Array(c.buffer):c}clone(){return new zo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(c,d,v,S,P){dp(c,d,v,S,P,4)}}function gA(h){const c={},d=h.resolution||256,v=h.clips?h.clips.length:1,S=h.image||new zo({width:d,height:v});if(Math.log(d)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${d}`);const P=(k,G,W)=>{c[h.evaluationKey]=W;const ee=h.expression.evaluate(c);S.data[k+G+0]=Math.floor(255*ee.r/ee.a),S.data[k+G+1]=Math.floor(255*ee.g/ee.a),S.data[k+G+2]=Math.floor(255*ee.b/ee.a),S.data[k+G+3]=Math.floor(255*ee.a)};if(h.clips)for(let k=0,G=0;k<v;++k,G+=4*d)for(let W=0,ee=0;W<d;W++,ee+=4){const ae=W/(d-1),{start:fe,end:me}=h.clips[k];P(G,ee,fe*(1-ae)+me*ae)}else for(let k=0,G=0;k<d;k++,G+=4)P(0,G,k/(d-1));return S}Nr("AlphaImage",Sc),Nr("RGBAImage",zo);class Na extends Oo{createBucket(c){return new Lh(c)}constructor(c){super(c,Bm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=gA({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let El;var Ku={get paint(){return El=El||new sn({"hillshade-illumination-direction":new Kr(ht.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Kr(ht.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Kr(ht.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Kr(ht.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Kr(ht.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Kr(ht.paint_hillshade["hillshade-accent-color"])})}};class Wd extends Oo{constructor(c){super(c,Ku)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const fp=Fn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Cm}=fp;var pp={exports:{}};function mA(h,c,d){d=d||2;var v,S,P,k,G,W,ee,ae=c&&c.length,fe=ae?c[0]*d:h.length,me=Xd(h,0,fe,d,!0),Ce=[];if(!me||me.next===me.prev)return Ce;if(ae&&(me=function(Ue,$e,Ke,ut){var tt,it,yt,St=[];for(tt=0,it=$e.length;tt<it;tt++)(yt=Xd(Ue,$e[tt]*ut,tt<it-1?$e[tt+1]*ut:Ue.length,ut,!1))===yt.next&&(yt.steiner=!0),St.push(Mx(yt));for(St.sort(Lx),tt=0;tt<St.length;tt++)Ke=Sm(St[tt],Ke);return Ke}(h,c,me,d)),h.length>80*d){v=P=h[0],S=k=h[1];for(var Me=d;Me<fe;Me+=d)(G=h[Me])<v&&(v=G),(W=h[Me+1])<S&&(S=W),G>P&&(P=G),W>k&&(k=W);ee=(ee=Math.max(P-v,k-S))!==0?32767/ee:0}return gp(me,Ce,d,v,S,ee,0),Ce}function Xd(h,c,d,v,S){var P,k;if(S===bp(h,c,d,v)>0)for(P=c;P<d;P+=v)k=Lm(P,h[P],h[P+1],k);else for(P=d-v;P>=c;P-=v)k=Lm(P,h[P],h[P+1],k);return k&&Jd(k,k.next)&&(_p(k),k=k.next),k}function Mh(h,c){if(!h)return h;c||(c=h);var d,v=h;do if(d=!1,v.steiner||!Jd(v,v.next)&&zs(v.prev,v,v.next)!==0)v=v.next;else{if(_p(v),(v=c=v.prev)===v.next)break;d=!0}while(d||v!==c);return c}function gp(h,c,d,v,S,P,k){if(h){!k&&P&&function(ae,fe,me,Ce){var Me=ae;do Me.z===0&&(Me.z=YA(Me.x,Me.y,fe,me,Ce)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==ae);Me.prevZ.nextZ=null,Me.prevZ=null,function(Ue){var $e,Ke,ut,tt,it,yt,St,Jt,Br=1;do{for(Ke=Ue,Ue=null,it=null,yt=0;Ke;){for(yt++,ut=Ke,St=0,$e=0;$e<Br&&(St++,ut=ut.nextZ);$e++);for(Jt=Br;St>0||Jt>0&&ut;)St!==0&&(Jt===0||!ut||Ke.z<=ut.z)?(tt=Ke,Ke=Ke.nextZ,St--):(tt=ut,ut=ut.nextZ,Jt--),it?it.nextZ=tt:Ue=tt,tt.prevZ=it,it=tt;Ke=ut}it.nextZ=null,Br*=2}while(yt>1)}(Me)}(h,v,S,P);for(var G,W,ee=h;h.prev!==h.next;)if(G=h.prev,W=h.next,P?YI(h,v,S,P):Zd(h))c.push(G.i/d|0),c.push(h.i/d|0),c.push(W.i/d|0),_p(h),h=W.next,ee=W.next;else if((h=W)===ee){k?k===1?gp(h=oo(Mh(h),c,d),c,d,v,S,P,2):k===2&&Em(h,c,d,v,S,P):gp(Mh(h),c,d,v,S,P,1);break}}}function Zd(h){var c=h.prev,d=h,v=h.next;if(zs(c,d,v)>=0)return!1;for(var S=c.x,P=d.x,k=v.x,G=c.y,W=d.y,ee=v.y,ae=S<P?S<k?S:k:P<k?P:k,fe=G<W?G<ee?G:ee:W<ee?W:ee,me=S>P?S>k?S:k:P>k?P:k,Ce=G>W?G>ee?G:ee:W>ee?W:ee,Me=v.next;Me!==c;){if(Me.x>=ae&&Me.x<=me&&Me.y>=fe&&Me.y<=Ce&&ed(S,G,P,W,k,ee,Me.x,Me.y)&&zs(Me.prev,Me,Me.next)>=0)return!1;Me=Me.next}return!0}function YI(h,c,d,v){var S=h.prev,P=h,k=h.next;if(zs(S,P,k)>=0)return!1;for(var G=S.x,W=P.x,ee=k.x,ae=S.y,fe=P.y,me=k.y,Ce=G<W?G<ee?G:ee:W<ee?W:ee,Me=ae<fe?ae<me?ae:me:fe<me?fe:me,Ue=G>W?G>ee?G:ee:W>ee?W:ee,$e=ae>fe?ae>me?ae:me:fe>me?fe:me,Ke=YA(Ce,Me,c,d,v),ut=YA(Ue,$e,c,d,v),tt=h.prevZ,it=h.nextZ;tt&&tt.z>=Ke&&it&&it.z<=ut;){if(tt.x>=Ce&&tt.x<=Ue&&tt.y>=Me&&tt.y<=$e&&tt!==S&&tt!==k&&ed(G,ae,W,fe,ee,me,tt.x,tt.y)&&zs(tt.prev,tt,tt.next)>=0||(tt=tt.prevZ,it.x>=Ce&&it.x<=Ue&&it.y>=Me&&it.y<=$e&&it!==S&&it!==k&&ed(G,ae,W,fe,ee,me,it.x,it.y)&&zs(it.prev,it,it.next)>=0))return!1;it=it.nextZ}for(;tt&&tt.z>=Ke;){if(tt.x>=Ce&&tt.x<=Ue&&tt.y>=Me&&tt.y<=$e&&tt!==S&&tt!==k&&ed(G,ae,W,fe,ee,me,tt.x,tt.y)&&zs(tt.prev,tt,tt.next)>=0)return!1;tt=tt.prevZ}for(;it&&it.z<=ut;){if(it.x>=Ce&&it.x<=Ue&&it.y>=Me&&it.y<=$e&&it!==S&&it!==k&&ed(G,ae,W,fe,ee,me,it.x,it.y)&&zs(it.prev,it,it.next)>=0)return!1;it=it.nextZ}return!0}function oo(h,c,d){var v=h;do{var S=v.prev,P=v.next.next;!Jd(S,P)&&e_(S,v,v.next,P)&&Ph(S,P)&&Ph(P,S)&&(c.push(S.i/d|0),c.push(v.i/d|0),c.push(P.i/d|0),_p(v),_p(v.next),v=h=P),v=v.next}while(v!==h);return Mh(v)}function Em(h,c,d,v,S,P){var k=h;do{for(var G=k.next.next;G!==k.prev;){if(k.i!==G.i&&mp(k,G)){var W=Px(k,G);return k=Mh(k,k.next),W=Mh(W,W.next),gp(k,c,d,v,S,P,0),void gp(W,c,d,v,S,P,0)}G=G.next}k=k.next}while(k!==h)}function Lx(h,c){return h.x-c.x}function Sm(h,c){var d=function(S,P){var k,G=P,W=S.x,ee=S.y,ae=-1/0;do{if(ee<=G.y&&ee>=G.next.y&&G.next.y!==G.y){var fe=G.x+(ee-G.y)*(G.next.x-G.x)/(G.next.y-G.y);if(fe<=W&&fe>ae&&(ae=fe,k=G.x<G.next.x?G:G.next,fe===W))return k}G=G.next}while(G!==P);if(!k)return null;var me,Ce=k,Me=k.x,Ue=k.y,$e=1/0;G=k;do W>=G.x&&G.x>=Me&&W!==G.x&&ed(ee<Ue?W:ae,ee,Me,Ue,ee<Ue?ae:W,ee,G.x,G.y)&&(me=Math.abs(ee-G.y)/(W-G.x),Ph(G,S)&&(me<$e||me===$e&&(G.x>k.x||G.x===k.x&&Tm(k,G)))&&(k=G,$e=me)),G=G.next;while(G!==Ce);return k}(h,c);if(!d)return c;var v=Px(d,h);return Mh(v,v.next),Mh(d,d.next)}function Tm(h,c){return zs(h.prev,h,c.prev)<0&&zs(c.next,h,h.next)<0}function YA(h,c,d,v,S){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-d)*S|0)|h<<8))|h<<4))|h<<2))|h<<1))|(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-v)*S|0)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function Mx(h){var c=h,d=h;do(c.x<d.x||c.x===d.x&&c.y<d.y)&&(d=c),c=c.next;while(c!==h);return d}function ed(h,c,d,v,S,P,k,G){return(S-k)*(c-G)>=(h-k)*(P-G)&&(h-k)*(v-G)>=(d-k)*(c-G)&&(d-k)*(P-G)>=(S-k)*(v-G)}function mp(h,c){return h.next.i!==c.i&&h.prev.i!==c.i&&!function(d,v){var S=d;do{if(S.i!==d.i&&S.next.i!==d.i&&S.i!==v.i&&S.next.i!==v.i&&e_(S,S.next,d,v))return!0;S=S.next}while(S!==d);return!1}(h,c)&&(Ph(h,c)&&Ph(c,h)&&function(d,v){var S=d,P=!1,k=(d.x+v.x)/2,G=(d.y+v.y)/2;do S.y>G!=S.next.y>G&&S.next.y!==S.y&&k<(S.next.x-S.x)*(G-S.y)/(S.next.y-S.y)+S.x&&(P=!P),S=S.next;while(S!==d);return P}(h,c)&&(zs(h.prev,h,c.prev)||zs(h,c.prev,c))||Jd(h,c)&&zs(h.prev,h,h.next)>0&&zs(c.prev,c,c.next)>0)}function zs(h,c,d){return(c.y-h.y)*(d.x-c.x)-(c.x-h.x)*(d.y-c.y)}function Jd(h,c){return h.x===c.x&&h.y===c.y}function e_(h,c,d,v){var S=yp(zs(h,c,d)),P=yp(zs(h,c,v)),k=yp(zs(d,v,h)),G=yp(zs(d,v,c));return S!==P&&k!==G||!(S!==0||!Im(h,d,c))||!(P!==0||!Im(h,v,c))||!(k!==0||!Im(d,h,v))||!(G!==0||!Im(d,c,v))}function Im(h,c,d){return c.x<=Math.max(h.x,d.x)&&c.x>=Math.min(h.x,d.x)&&c.y<=Math.max(h.y,d.y)&&c.y>=Math.min(h.y,d.y)}function yp(h){return h>0?1:h<0?-1:0}function Ph(h,c){return zs(h.prev,h,h.next)<0?zs(h,c,h.next)>=0&&zs(h,h.prev,c)>=0:zs(h,c,h.prev)<0||zs(h,h.next,c)<0}function Px(h,c){var d=new vp(h.i,h.x,h.y),v=new vp(c.i,c.x,c.y),S=h.next,P=c.prev;return h.next=c,c.prev=h,d.next=S,S.prev=d,v.next=d,d.prev=v,P.next=v,v.prev=P,v}function Lm(h,c,d,v){var S=new vp(h,c,d);return v?(S.next=v.next,S.prev=v,v.next.prev=S,v.next=S):(S.prev=S,S.next=S),S}function _p(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function vp(h,c,d){this.i=h,this.x=c,this.y=d,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function bp(h,c,d,v){for(var S=0,P=c,k=d-v;P<d;P+=v)S+=(h[k]-h[P])*(h[P+1]+h[k+1]),k=P;return S}pp.exports=mA,pp.exports.default=mA,mA.deviation=function(h,c,d,v){var S=c&&c.length,P=Math.abs(bp(h,0,S?c[0]*d:h.length,d));if(S)for(var k=0,G=c.length;k<G;k++)P-=Math.abs(bp(h,c[k]*d,k<G-1?c[k+1]*d:h.length,d));var W=0;for(k=0;k<v.length;k+=3){var ee=v[k]*d,ae=v[k+1]*d,fe=v[k+2]*d;W+=Math.abs((h[ee]-h[fe])*(h[ae+1]-h[ee+1])-(h[ee]-h[ae])*(h[fe+1]-h[ee+1]))}return P===0&&W===0?0:Math.abs((W-P)/P)},mA.flatten=function(h){for(var c=h[0][0].length,d={vertices:[],holes:[],dimensions:c},v=0,S=0;S<h.length;S++){for(var P=0;P<h[S].length;P++)for(var k=0;k<c;k++)d.vertices.push(h[S][P][k]);S>0&&d.holes.push(v+=h[S-1].length)}return d};var Mm=y(pp.exports);function Fx(h,c,d,v,S){t_(h,c,d||0,v||h.length-1,S||e5)}function t_(h,c,d,v,S){for(;v>d;){if(v-d>600){var P=v-d+1,k=c-d+1,G=Math.log(P),W=.5*Math.exp(2*G/3),ee=.5*Math.sqrt(G*W*(P-W)/P)*(k-P/2<0?-1:1);t_(h,c,Math.max(d,Math.floor(c-k*W/P+ee)),Math.min(v,Math.floor(c+(P-k)*W/P+ee)),S)}var ae=h[c],fe=d,me=v;for(xp(h,d,c),S(h[v],ae)>0&&xp(h,d,v);fe<me;){for(xp(h,fe,me),fe++,me--;S(h[fe],ae)<0;)fe++;for(;S(h[me],ae)>0;)me--}S(h[d],ae)===0?xp(h,d,me):xp(h,++me,v),me<=c&&(d=me+1),c<=me&&(v=me-1)}}function xp(h,c,d){var v=h[c];h[c]=h[d],h[d]=v}function e5(h,c){return h<c?-1:h>c?1:0}function r_(h,c){const d=h.length;if(d<=1)return[h];const v=[];let S,P;for(let k=0;k<d;k++){const G=Et(h[k]);G!==0&&(h[k].area=Math.abs(G),P===void 0&&(P=G<0),P===G<0?(S&&v.push(S),S=[h[k]]):S.push(h[k]))}if(S&&v.push(S),c>1)for(let k=0;k<v.length;k++)v[k].length<=c||(Fx(v[k],c,1,v[k].length-1,t5),v[k]=v[k].slice(0,c));return v}function t5(h,c){return c.area-h.area}function i_(h,c,d){const v=d.patternDependencies;let S=!1;for(const P of c){const k=P.paint.get(`${h}-pattern`);k.isConstant()||(S=!0);const G=k.constantOr(null);G&&(S=!0,v[G.to]=!0,v[G.from]=!0)}return S}function Wu(h,c,d,v,S){const P=S.patternDependencies;for(const k of c){const G=k.paint.get(`${h}-pattern`).value;if(G.kind!=="constant"){let W=G.evaluate({zoom:v-1},d,{},S.availableImages),ee=G.evaluate({zoom:v},d,{},S.availableImages),ae=G.evaluate({zoom:v+1},d,{},S.availableImages);W=W&&W.name?W.name:W,ee=ee&&ee.name?ee.name:ee,ae=ae&&ae.name?ae.name:ae,P[W]=!0,P[ee]=!0,P[ae]=!0,d.patterns[k.id]={min:W,mid:ee,max:ae}}}return d}class n_{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new et,this.indexArray=new Ht,this.indexArray2=new Pr,this.programConfigurations=new bo(c.layers,c.zoom),this.segments=new hr,this.segments2=new hr,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,v){this.hasPattern=i_("fill",this.layers,d);const S=this.layers[0].layout.get("fill-sort-key"),P=!S.isConstant(),k=[];for(const{feature:G,id:W,index:ee,sourceLayerIndex:ae}of c){const fe=this.layers[0]._featureFilter.needGeometry,me=al(G,fe);if(!this.layers[0]._featureFilter.filter(new Sr(this.zoom),me,v))continue;const Ce=P?S.evaluate(me,{},v,d.availableImages):void 0,Me={id:W,properties:G.properties,type:G.type,sourceLayerIndex:ae,index:ee,geometry:fe?me.geometry:wl(G),patterns:{},sortKey:Ce};k.push(Me)}P&&k.sort((G,W)=>G.sortKey-W.sortKey);for(const G of k){const{geometry:W,index:ee,sourceLayerIndex:ae}=G;if(this.hasPattern){const fe=Wu("fill",this.layers,G,this.zoom,d);this.patternFeatures.push(fe)}else this.addFeature(G,W,ee,v,{});d.featureIndex.insert(c[ee].feature,W,ee,ae,this.index)}}update(c,d,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,v)}addFeatures(c,d,v){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,d,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Cm),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.indexBuffer2=c.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(c,d,v,S,P){for(const k of r_(d,500)){let G=0;for(const Ce of k)G+=Ce.length;const W=this.segments.prepareSegment(G,this.layoutVertexArray,this.indexArray),ee=W.vertexLength,ae=[],fe=[];for(const Ce of k){if(Ce.length===0)continue;Ce!==k[0]&&fe.push(ae.length/2);const Me=this.segments2.prepareSegment(Ce.length,this.layoutVertexArray,this.indexArray2),Ue=Me.vertexLength;this.layoutVertexArray.emplaceBack(Ce[0].x,Ce[0].y),this.indexArray2.emplaceBack(Ue+Ce.length-1,Ue),ae.push(Ce[0].x),ae.push(Ce[0].y);for(let $e=1;$e<Ce.length;$e++)this.layoutVertexArray.emplaceBack(Ce[$e].x,Ce[$e].y),this.indexArray2.emplaceBack(Ue+$e-1,Ue+$e),ae.push(Ce[$e].x),ae.push(Ce[$e].y);Me.vertexLength+=Ce.length,Me.primitiveLength+=Ce.length}const me=Mm(ae,fe);for(let Ce=0;Ce<me.length;Ce+=3)this.indexArray.emplaceBack(ee+me[Ce],ee+me[Ce+1],ee+me[Ce+2]);W.vertexLength+=G,W.primitiveLength+=me.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,P,S)}}let s_,td;Nr("FillBucket",n_,{omit:["layers","patternFeatures"]});var r5={get paint(){return td=td||new sn({"fill-antialias":new Kr(ht.paint_fill["fill-antialias"]),"fill-opacity":new Qr(ht.paint_fill["fill-opacity"]),"fill-color":new Qr(ht.paint_fill["fill-color"]),"fill-outline-color":new Qr(ht.paint_fill["fill-outline-color"]),"fill-translate":new Kr(ht.paint_fill["fill-translate"]),"fill-translate-anchor":new Kr(ht.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xn(ht.paint_fill["fill-pattern"])})},get layout(){return s_=s_||new sn({"fill-sort-key":new Qr(ht.layout_fill["fill-sort-key"])})}};class i5 extends Oo{constructor(c){super(c,r5)}recalculate(c,d){super.recalculate(c,d);const v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new n_(c)}queryRadius(){return xu(this.paint.get("fill-translate"))}queryIntersectsFeature(c,d,v,S,P,k,G){return AA(Th(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),k.angle,G),S)}isTileClipped(){return!0}}const n5=Fn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Dx=Fn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Rx}=n5;var yA={},s5=T,kx=Yd;function Yd(h,c,d,v,S){this.properties={},this.extent=d,this.type=0,this._pbf=h,this._geometry=-1,this._keys=v,this._values=S,h.readFields(o_,this,c)}function o_(h,c,d){h==1?c.id=d.readVarint():h==2?function(v,S){for(var P=v.readVarint()+v.pos;v.pos<P;){var k=S._keys[v.readVarint()],G=S._values[v.readVarint()];S.properties[k]=G}}(d,c):h==3?c.type=d.readVarint():h==4&&(c._geometry=d.pos)}function wp(h){for(var c,d,v=0,S=0,P=h.length,k=P-1;S<P;k=S++)v+=((d=h[k]).x-(c=h[S]).x)*(c.y+d.y);return v}Yd.types=["Unknown","Point","LineString","Polygon"],Yd.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var c,d=h.readVarint()+h.pos,v=1,S=0,P=0,k=0,G=[];h.pos<d;){if(S<=0){var W=h.readVarint();v=7&W,S=W>>3}if(S--,v===1||v===2)P+=h.readSVarint(),k+=h.readSVarint(),v===1&&(c&&G.push(c),c=[]),c.push(new s5(P,k));else{if(v!==7)throw new Error("unknown command "+v);c&&c.push(c[0].clone())}}return c&&G.push(c),G},Yd.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var c=h.readVarint()+h.pos,d=1,v=0,S=0,P=0,k=1/0,G=-1/0,W=1/0,ee=-1/0;h.pos<c;){if(v<=0){var ae=h.readVarint();d=7&ae,v=ae>>3}if(v--,d===1||d===2)(S+=h.readSVarint())<k&&(k=S),S>G&&(G=S),(P+=h.readSVarint())<W&&(W=P),P>ee&&(ee=P);else if(d!==7)throw new Error("unknown command "+d)}return[k,W,G,ee]},Yd.prototype.toGeoJSON=function(h,c,d){var v,S,P=this.extent*Math.pow(2,d),k=this.extent*h,G=this.extent*c,W=this.loadGeometry(),ee=Yd.types[this.type];function ae(Ce){for(var Me=0;Me<Ce.length;Me++){var Ue=Ce[Me];Ce[Me]=[360*(Ue.x+k)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ue.y+G)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var fe=[];for(v=0;v<W.length;v++)fe[v]=W[v][0];ae(W=fe);break;case 2:for(v=0;v<W.length;v++)ae(W[v]);break;case 3:for(W=function(Ce){var Me=Ce.length;if(Me<=1)return[Ce];for(var Ue,$e,Ke=[],ut=0;ut<Me;ut++){var tt=wp(Ce[ut]);tt!==0&&($e===void 0&&($e=tt<0),$e===tt<0?(Ue&&Ke.push(Ue),Ue=[Ce[ut]]):Ue.push(Ce[ut]))}return Ue&&Ke.push(Ue),Ke}(W),v=0;v<W.length;v++)for(S=0;S<W[v].length;S++)ae(W[v][S])}W.length===1?W=W[0]:ee="Multi"+ee;var me={type:"Feature",geometry:{type:ee,coordinates:W},properties:this.properties};return"id"in this&&(me.id=this.id),me};var a_=kx,Ox=Ux;function Ux(h,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(Nx,this,c),this.length=this._features.length}function Nx(h,c,d){h===15?c.version=d.readVarint():h===1?c.name=d.readString():h===5?c.extent=d.readVarint():h===2?c._features.push(d.pos):h===3?c._keys.push(d.readString()):h===4&&c._values.push(function(v){for(var S=null,P=v.readVarint()+v.pos;v.pos<P;){var k=v.readVarint()>>3;S=k===1?v.readString():k===2?v.readFloat():k===3?v.readDouble():k===4?v.readVarint64():k===5?v.readVarint():k===6?v.readSVarint():k===7?v.readBoolean():null}return S}(d))}Ux.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var c=this._pbf.readVarint()+this._pbf.pos;return new a_(this._pbf,c,this.extent,this._keys,this._values)};var o5=Ox;function a5(h,c,d){if(h===3){var v=new o5(d,d.readVarint()+d.pos);v.length&&(c[v.name]=v)}}yA.VectorTile=function(h,c){this.layers=h.readFields(a5,{},c)},yA.VectorTileFeature=kx,yA.VectorTileLayer=Ox;const Bp=yA.VectorTileFeature.types,Pm=Math.pow(2,13);function Cp(h,c,d,v,S,P,k,G){h.emplaceBack(c,d,2*Math.floor(v*Pm)+k,S*Pm*2,P*Pm*2,Math.round(G))}class l_{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.layoutVertexArray=new Oe,this.centroidVertexArray=new ve,this.indexArray=new Ht,this.programConfigurations=new bo(c.layers,c.zoom),this.segments=new hr,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,v){this.features=[],this.hasPattern=i_("fill-extrusion",this.layers,d);for(const{feature:S,id:P,index:k,sourceLayerIndex:G}of c){const W=this.layers[0]._featureFilter.needGeometry,ee=al(S,W);if(!this.layers[0]._featureFilter.filter(new Sr(this.zoom),ee,v))continue;const ae={id:P,sourceLayerIndex:G,index:k,geometry:W?ee.geometry:wl(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Wu("fill-extrusion",this.layers,ae,this.zoom,d)):this.addFeature(ae,ae.geometry,k,v,{}),d.featureIndex.insert(S,ae.geometry,k,G,this.index,!0)}}addFeatures(c,d,v){for(const S of this.features){const{geometry:P}=S;this.addFeature(S,P,S.index,d,v)}}update(c,d,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,v)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Rx),this.centroidVertexBuffer=c.createVertexBuffer(this.centroidVertexArray,Dx.members,!0),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(c,d,v,S,P){const k={x:0,y:0,vertexCount:0};for(const G of r_(d,500)){let W=0;for(const Me of G)W+=Me.length;let ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Me of G){if(Me.length===0||c5(Me))continue;let Ue=0;for(let $e=0;$e<Me.length;$e++){const Ke=Me[$e];if($e>=1){const ut=Me[$e-1];if(!l5(Ke,ut)){ee.vertexLength+4>hr.MAX_VERTEX_ARRAY_LENGTH&&(ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const tt=Ke.sub(ut)._perp()._unit(),it=ut.dist(Ke);Ue+it>32768&&(Ue=0),Cp(this.layoutVertexArray,Ke.x,Ke.y,tt.x,tt.y,0,0,Ue),Cp(this.layoutVertexArray,Ke.x,Ke.y,tt.x,tt.y,0,1,Ue),k.x+=2*Ke.x,k.y+=2*Ke.y,k.vertexCount+=2,Ue+=it,Cp(this.layoutVertexArray,ut.x,ut.y,tt.x,tt.y,0,0,Ue),Cp(this.layoutVertexArray,ut.x,ut.y,tt.x,tt.y,0,1,Ue),k.x+=2*ut.x,k.y+=2*ut.y,k.vertexCount+=2;const yt=ee.vertexLength;this.indexArray.emplaceBack(yt,yt+2,yt+1),this.indexArray.emplaceBack(yt+1,yt+2,yt+3),ee.vertexLength+=4,ee.primitiveLength+=2}}}}if(ee.vertexLength+W>hr.MAX_VERTEX_ARRAY_LENGTH&&(ee=this.segments.prepareSegment(W,this.layoutVertexArray,this.indexArray)),Bp[c.type]!=="Polygon")continue;const ae=[],fe=[],me=ee.vertexLength;for(const Me of G)if(Me.length!==0){Me!==G[0]&&fe.push(ae.length/2);for(let Ue=0;Ue<Me.length;Ue++){const $e=Me[Ue];Cp(this.layoutVertexArray,$e.x,$e.y,0,0,1,1,0),k.x+=$e.x,k.y+=$e.y,k.vertexCount+=1,ae.push($e.x),ae.push($e.y)}}const Ce=Mm(ae,fe);for(let Me=0;Me<Ce.length;Me+=3)this.indexArray.emplaceBack(me+Ce[Me],me+Ce[Me+2],me+Ce[Me+1]);ee.primitiveLength+=Ce.length/3,ee.vertexLength+=W}for(let G=0;G<k.vertexCount;G++)this.centroidVertexArray.emplaceBack(Math.floor(k.x/k.vertexCount),Math.floor(k.y/k.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,P,S)}}function l5(h,c){return h.x===c.x&&(h.x<0||h.x>Dn)||h.y===c.y&&(h.y<0||h.y>Dn)}function c5(h){return h.every(c=>c.x<0)||h.every(c=>c.x>Dn)||h.every(c=>c.y<0)||h.every(c=>c.y>Dn)}let zx;Nr("FillExtrusionBucket",l_,{omit:["layers","features"]});var u5={get paint(){return zx=zx||new sn({"fill-extrusion-opacity":new Kr(ht["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Qr(ht["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Kr(ht["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Kr(ht["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xn(ht["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Qr(ht["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Qr(ht["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Kr(ht["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Qx extends Oo{constructor(c){super(c,u5)}createBucket(c){return new l_(c)}queryRadius(){return xu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(c,d,v,S,P,k,G,W){const ee=Th(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),k.angle,G),ae=this.paint.get("fill-extrusion-height").evaluate(d,v),fe=this.paint.get("fill-extrusion-base").evaluate(d,v),me=function(Me,Ue,$e,Ke){const ut=[];for(const tt of Me){const it=[tt.x,tt.y,0,1];wu(it,it,Ue),ut.push(new R(it[0]/it[3],it[1]/it[3]))}return ut}(ee,W),Ce=function(Me,Ue,$e,Ke){const ut=[],tt=[],it=Ke[8]*Ue,yt=Ke[9]*Ue,St=Ke[10]*Ue,Jt=Ke[11]*Ue,Br=Ke[8]*$e,ar=Ke[9]*$e,pr=Ke[10]*$e,_r=Ke[11]*$e;for(const kr of Me){const lr=[],Yt=[];for(const jr of kr){const Vr=jr.x,_i=jr.y,Vi=Ke[0]*Vr+Ke[4]*_i+Ke[12],$i=Ke[1]*Vr+Ke[5]*_i+Ke[13],gn=Ke[2]*Vr+Ke[6]*_i+Ke[14],cs=Ke[3]*Vr+Ke[7]*_i+Ke[15],Qn=gn+St,xn=cs+Jt,Rn=Vi+Br,hn=$i+ar,Bi=gn+pr,Vn=cs+_r,An=new R((Vi+it)/xn,($i+yt)/xn);An.z=Qn/xn,lr.push(An);const rn=new R(Rn/Vn,hn/Vn);rn.z=Bi/Vn,Yt.push(rn)}ut.push(lr),tt.push(Yt)}return[ut,tt]}(S,fe,ae,W);return function(Me,Ue,$e){let Ke=1/0;AA($e,Ue)&&(Ke=c_($e,Ue[0]));for(let ut=0;ut<Ue.length;ut++){const tt=Ue[ut],it=Me[ut];for(let yt=0;yt<tt.length-1;yt++){const St=tt[yt],Jt=[St,tt[yt+1],it[yt+1],it[yt],St];Zc($e,Jt)&&(Ke=Math.min(Ke,c_($e,Jt)))}}return Ke!==1/0&&Ke}(Ce[0],Ce[1],me)}}function rd(h,c){return h.x*c.x+h.y*c.y}function c_(h,c){if(h.length===1){let d=0;const v=c[d++];let S;for(;!S||v.equals(S);)if(S=c[d++],!S)return 1/0;for(;d<c.length;d++){const P=c[d],k=h[0],G=S.sub(v),W=P.sub(v),ee=k.sub(v),ae=rd(G,G),fe=rd(G,W),me=rd(W,W),Ce=rd(ee,G),Me=rd(ee,W),Ue=ae*me-fe*fe,$e=(me*Ce-fe*Me)/Ue,Ke=(ae*Me-fe*Ce)/Ue,ut=v.z*(1-$e-Ke)+S.z*$e+P.z*Ke;if(isFinite(ut))return ut}return 1/0}{let d=1/0;for(const v of c)d=Math.min(d,v.z);return d}}const Vx=Fn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Hx}=Vx,h5=Fn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Fm}=h5,A5=yA.VectorTileFeature.types,Gx=Math.cos(Math.PI/180*37.5),jx=Math.pow(2,14)/.5;class u_{constructor(c){this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(d=>d.id),this.index=c.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(d=>{this.gradients[d.id]={}}),this.layoutVertexArray=new Re,this.layoutVertexArray2=new Ve,this.indexArray=new Ht,this.programConfigurations=new bo(c.layers,c.zoom),this.segments=new hr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id)}populate(c,d,v){this.hasPattern=i_("line",this.layers,d);const S=this.layers[0].layout.get("line-sort-key"),P=!S.isConstant(),k=[];for(const{feature:G,id:W,index:ee,sourceLayerIndex:ae}of c){const fe=this.layers[0]._featureFilter.needGeometry,me=al(G,fe);if(!this.layers[0]._featureFilter.filter(new Sr(this.zoom),me,v))continue;const Ce=P?S.evaluate(me,{},v):void 0,Me={id:W,properties:G.properties,type:G.type,sourceLayerIndex:ae,index:ee,geometry:fe?me.geometry:wl(G),patterns:{},sortKey:Ce};k.push(Me)}P&&k.sort((G,W)=>G.sortKey-W.sortKey);for(const G of k){const{geometry:W,index:ee,sourceLayerIndex:ae}=G;if(this.hasPattern){const fe=Wu("line",this.layers,G,this.zoom,d);this.patternFeatures.push(fe)}else this.addFeature(G,W,ee,v,{});d.featureIndex.insert(c[ee].feature,W,ee,ae,this.index)}}update(c,d,v){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(c,d,this.stateDependentLayers,v)}addFeatures(c,d,v){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,d,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(c){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=c.createVertexBuffer(this.layoutVertexArray2,Fm)),this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Hx),this.indexBuffer=c.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(c),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(c){if(c.properties&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(c.properties,"mapbox_clip_end"))return{start:+c.properties.mapbox_clip_start,end:+c.properties.mapbox_clip_end}}addFeature(c,d,v,S,P){const k=this.layers[0].layout,G=k.get("line-join").evaluate(c,{}),W=k.get("line-cap"),ee=k.get("line-miter-limit"),ae=k.get("line-round-limit");this.lineClips=this.lineFeatureClips(c);for(const fe of d)this.addLine(fe,c,G,W,ee,ae);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,v,P,S)}addLine(c,d,v,S,P,k){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ke=0;Ke<c.length-1;Ke++)this.totalDistance+=c[Ke].dist(c[Ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const G=A5[d.type]==="Polygon";let W=c.length;for(;W>=2&&c[W-1].equals(c[W-2]);)W--;let ee=0;for(;ee<W-1&&c[ee].equals(c[ee+1]);)ee++;if(W<(G?3:2))return;v==="bevel"&&(P=1.05);const ae=this.overscaling<=16?15*Dn/(512*this.overscaling):0,fe=this.segments.prepareSegment(10*W,this.layoutVertexArray,this.indexArray);let me,Ce,Me,Ue,$e;this.e1=this.e2=-1,G&&(me=c[W-2],$e=c[ee].sub(me)._unit()._perp());for(let Ke=ee;Ke<W;Ke++){if(Me=Ke===W-1?G?c[ee+1]:void 0:c[Ke+1],Me&&c[Ke].equals(Me))continue;$e&&(Ue=$e),me&&(Ce=me),me=c[Ke],$e=Me?Me.sub(me)._unit()._perp():Ue,Ue=Ue||$e;let ut=Ue.add($e);ut.x===0&&ut.y===0||ut._unit();const tt=Ue.x*$e.x+Ue.y*$e.y,it=ut.x*$e.x+ut.y*$e.y,yt=it!==0?1/it:1/0,St=2*Math.sqrt(2-2*it),Jt=it<Gx&&Ce&&Me,Br=Ue.x*$e.y-Ue.y*$e.x>0;if(Jt&&Ke>ee){const _r=me.dist(Ce);if(_r>2*ae){const kr=me.sub(me.sub(Ce)._mult(ae/_r)._round());this.updateDistance(Ce,kr),this.addCurrentVertex(kr,Ue,0,0,fe),Ce=kr}}const ar=Ce&&Me;let pr=ar?v:G?"butt":S;if(ar&&pr==="round"&&(yt<k?pr="miter":yt<=2&&(pr="fakeround")),pr==="miter"&&yt>P&&(pr="bevel"),pr==="bevel"&&(yt>2&&(pr="flipbevel"),yt<P&&(pr="miter")),Ce&&this.updateDistance(Ce,me),pr==="miter")ut._mult(yt),this.addCurrentVertex(me,ut,0,0,fe);else if(pr==="flipbevel"){if(yt>100)ut=$e.mult(-1);else{const _r=yt*Ue.add($e).mag()/Ue.sub($e).mag();ut._perp()._mult(_r*(Br?-1:1))}this.addCurrentVertex(me,ut,0,0,fe),this.addCurrentVertex(me,ut.mult(-1),0,0,fe)}else if(pr==="bevel"||pr==="fakeround"){const _r=-Math.sqrt(yt*yt-1),kr=Br?_r:0,lr=Br?0:_r;if(Ce&&this.addCurrentVertex(me,Ue,kr,lr,fe),pr==="fakeround"){const Yt=Math.round(180*St/Math.PI/20);for(let jr=1;jr<Yt;jr++){let Vr=jr/Yt;if(Vr!==.5){const Vi=Vr-.5;Vr+=Vr*Vi*(Vr-1)*((1.0904+tt*(tt*(3.55645-1.43519*tt)-3.2452))*Vi*Vi+(.848013+tt*(.215638*tt-1.06021)))}const _i=$e.sub(Ue)._mult(Vr)._add(Ue)._unit()._mult(Br?-1:1);this.addHalfVertex(me,_i.x,_i.y,!1,Br,0,fe)}}Me&&this.addCurrentVertex(me,$e,-kr,-lr,fe)}else if(pr==="butt")this.addCurrentVertex(me,ut,0,0,fe);else if(pr==="square"){const _r=Ce?1:-1;this.addCurrentVertex(me,ut,_r,_r,fe)}else pr==="round"&&(Ce&&(this.addCurrentVertex(me,Ue,0,0,fe),this.addCurrentVertex(me,Ue,1,1,fe,!0)),Me&&(this.addCurrentVertex(me,$e,-1,-1,fe,!0),this.addCurrentVertex(me,$e,0,0,fe)));if(Jt&&Ke<W-1){const _r=me.dist(Me);if(_r>2*ae){const kr=me.add(Me.sub(me)._mult(ae/_r)._round());this.updateDistance(me,kr),this.addCurrentVertex(kr,$e,0,0,fe),me=kr}}}}addCurrentVertex(c,d,v,S,P){let k=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1;const G=d.y*S-d.x,W=-d.y-d.x*S;this.addHalfVertex(c,d.x+d.y*v,d.y-d.x*v,k,!1,v,P),this.addHalfVertex(c,G,W,k,!0,-S,P),this.distance>jx/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(c,d,v,S,P,k))}addHalfVertex(c,d,v,S,P,k,G){let{x:W,y:ee}=c;const ae=.5*(this.lineClips?this.scaledDistance*(jx-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((W<<1)+(S?1:0),(ee<<1)+(P?1:0),Math.round(63*d)+128,Math.round(63*v)+128,1+(k===0?0:k<0?-1:1)|(63&ae)<<2,ae>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const fe=G.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,fe),G.primitiveLength++),P?this.e2=fe:this.e1=fe}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(c,d){this.distance+=c.dist(d),this.updateScaledDistance()}}let qx,h_;Nr("LineBucket",u_,{omit:["layers","patternFeatures"]});var $x={get paint(){return h_=h_||new sn({"line-opacity":new Qr(ht.paint_line["line-opacity"]),"line-color":new Qr(ht.paint_line["line-color"]),"line-translate":new Kr(ht.paint_line["line-translate"]),"line-translate-anchor":new Kr(ht.paint_line["line-translate-anchor"]),"line-width":new Qr(ht.paint_line["line-width"]),"line-gap-width":new Qr(ht.paint_line["line-gap-width"]),"line-offset":new Qr(ht.paint_line["line-offset"]),"line-blur":new Qr(ht.paint_line["line-blur"]),"line-dasharray":new ju(ht.paint_line["line-dasharray"]),"line-pattern":new Xn(ht.paint_line["line-pattern"]),"line-gradient":new ko(ht.paint_line["line-gradient"])})},get layout(){return qx=qx||new sn({"line-cap":new Kr(ht.layout_line["line-cap"]),"line-join":new Qr(ht.layout_line["line-join"]),"line-miter-limit":new Kr(ht.layout_line["line-miter-limit"]),"line-round-limit":new Kr(ht.layout_line["line-round-limit"]),"line-sort-key":new Qr(ht.layout_line["line-sort-key"])})}};class d5 extends Qr{possiblyEvaluate(c,d){return d=new Sr(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),super.possiblyEvaluate(c,d)}evaluate(c,d,v,S){return d=Ne({},d,{zoom:Math.floor(d.zoom)}),super.evaluate(c,d,v,S)}}let _A;class xo extends Oo{constructor(c){super(c,$x),this.gradientVersion=0,_A||(_A=new d5($x.paint.properties["line-width"].specification),_A.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const d=this.gradientExpression();this.stepInterpolant=!!function(v){return v._styleExpression!==void 0}(d)&&d._styleExpression.expression instanceof yo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(c,d){super.recalculate(c,d),this.paint._values["line-floorwidth"]=_A.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new u_(c)}queryRadius(c){const d=c,v=A_(Sh("line-width",this,d),Sh("line-gap-width",this,d)),S=Sh("line-offset",this,d);return v/2+Math.abs(S)+xu(this.paint.get("line-translate"))}queryIntersectsFeature(c,d,v,S,P,k,G){const W=Th(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),k.angle,G),ee=G/2*A_(this.paint.get("line-width").evaluate(d,v),this.paint.get("line-gap-width").evaluate(d,v)),ae=this.paint.get("line-offset").evaluate(d,v);return ae&&(S=function(fe,me){const Ce=[];for(let Me=0;Me<fe.length;Me++){const Ue=fe[Me],$e=[];for(let Ke=0;Ke<Ue.length;Ke++){const ut=Ue[Ke-1],tt=Ue[Ke],it=Ue[Ke+1],yt=Ke===0?new R(0,0):tt.sub(ut)._unit()._perp(),St=Ke===Ue.length-1?new R(0,0):it.sub(tt)._unit()._perp(),Jt=yt._add(St)._unit(),Br=Jt.x*St.x+Jt.y*St.y;Br!==0&&Jt._mult(1/Br),$e.push(Jt._mult(me)._add(tt))}Ce.push($e)}return Ce}(S,ae*G)),function(fe,me,Ce){for(let Me=0;Me<me.length;Me++){const Ue=me[Me];if(fe.length>=3){for(let $e=0;$e<Ue.length;$e++)if(lc(fe,Ue[$e]))return!0}if(Gd(fe,Ue,Ce))return!0}return!1}(W,S,ee)}isTileClipped(){return!0}}function A_(h,c){return c>0?c+2*h:h}const Kx=Fn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Wx=Fn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Fn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jn=Fn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Fn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Dm=Fn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xx=Fn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Zx(h,c,d){return h.sections.forEach(v=>{v.text=function(S,P,k){const G=P.layout.get("text-transform").evaluate(k,{});return G==="uppercase"?S=S.toLocaleUpperCase():G==="lowercase"&&(S=S.toLocaleLowerCase()),no.applyArabicShaping&&(S=no.applyArabicShaping(S)),S}(v.text,c,d)}),h}Fn([{name:"triangle",components:3,type:"Uint16"}]),Fn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Fn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Fn([{type:"Float32",name:"offsetX"}]),Fn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Fn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Tc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Ss=24,d_=Yn,Jx=function(h,c,d,v,S){var P,k,G=8*S-v-1,W=(1<<G)-1,ee=W>>1,ae=-7,fe=d?S-1:0,me=d?-1:1,Ce=h[c+fe];for(fe+=me,P=Ce&(1<<-ae)-1,Ce>>=-ae,ae+=G;ae>0;P=256*P+h[c+fe],fe+=me,ae-=8);for(k=P&(1<<-ae)-1,P>>=-ae,ae+=v;ae>0;k=256*k+h[c+fe],fe+=me,ae-=8);if(P===0)P=1-ee;else{if(P===W)return k?NaN:1/0*(Ce?-1:1);k+=Math.pow(2,v),P-=ee}return(Ce?-1:1)*k*Math.pow(2,P-v)},Yx=function(h,c,d,v,S,P){var k,G,W,ee=8*P-S-1,ae=(1<<ee)-1,fe=ae>>1,me=S===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ce=v?0:P-1,Me=v?1:-1,Ue=c<0||c===0&&1/c<0?1:0;for(c=Math.abs(c),isNaN(c)||c===1/0?(G=isNaN(c)?1:0,k=ae):(k=Math.floor(Math.log(c)/Math.LN2),c*(W=Math.pow(2,-k))<1&&(k--,W*=2),(c+=k+fe>=1?me/W:me*Math.pow(2,1-fe))*W>=2&&(k++,W/=2),k+fe>=ae?(G=0,k=ae):k+fe>=1?(G=(c*W-1)*Math.pow(2,S),k+=fe):(G=c*Math.pow(2,fe-1)*Math.pow(2,S),k=0));S>=8;h[d+Ce]=255&G,Ce+=Me,G/=256,S-=8);for(k=k<<S|G,ee+=S;ee>0;h[d+Ce]=255&k,Ce+=Me,k/=256,ee-=8);h[d+Ce-Me]|=128*Ue};function Yn(h){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(h)?h:new Uint8Array(h||0),this.pos=0,this.type=0,this.length=this.buf.length}Yn.Varint=0,Yn.Fixed64=1,Yn.Bytes=2,Yn.Fixed32=5;var f_=4294967296,ew=1/f_,tw=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Fh(h){return h.type===Yn.Bytes?h.readVarint()+h.pos:h.pos+1}function ef(h,c,d){return d?4294967296*c+(h>>>0):4294967296*(c>>>0)+(h>>>0)}function rw(h,c,d){var v=c<=16383?1:c<=2097151?2:c<=268435455?3:Math.floor(Math.log(c)/(7*Math.LN2));d.realloc(v);for(var S=d.pos-1;S>=h;S--)d.buf[S+v]=d.buf[S]}function Rm(h,c){for(var d=0;d<h.length;d++)c.writeVarint(h[d])}function tf(h,c){for(var d=0;d<h.length;d++)c.writeSVarint(h[d])}function iw(h,c){for(var d=0;d<h.length;d++)c.writeFloat(h[d])}function p_(h,c){for(var d=0;d<h.length;d++)c.writeDouble(h[d])}function g_(h,c){for(var d=0;d<h.length;d++)c.writeBoolean(h[d])}function f5(h,c){for(var d=0;d<h.length;d++)c.writeFixed32(h[d])}function p5(h,c){for(var d=0;d<h.length;d++)c.writeSFixed32(h[d])}function g5(h,c){for(var d=0;d<h.length;d++)c.writeFixed64(h[d])}function nw(h,c){for(var d=0;d<h.length;d++)c.writeSFixed64(h[d])}function Ep(h,c){return(h[c]|h[c+1]<<8|h[c+2]<<16)+16777216*h[c+3]}function Qo(h,c,d){h[d]=c,h[d+1]=c>>>8,h[d+2]=c>>>16,h[d+3]=c>>>24}function km(h,c){return(h[c]|h[c+1]<<8|h[c+2]<<16)+(h[c+3]<<24)}Yn.prototype={destroy:function(){this.buf=null},readFields:function(h,c,d){for(d=d||this.length;this.pos<d;){var v=this.readVarint(),S=v>>3,P=this.pos;this.type=7&v,h(S,c,this),this.pos===P&&this.skip(v)}return c},readMessage:function(h,c){return this.readFields(h,c,this.readVarint()+this.pos)},readFixed32:function(){var h=Ep(this.buf,this.pos);return this.pos+=4,h},readSFixed32:function(){var h=km(this.buf,this.pos);return this.pos+=4,h},readFixed64:function(){var h=Ep(this.buf,this.pos)+Ep(this.buf,this.pos+4)*f_;return this.pos+=8,h},readSFixed64:function(){var h=Ep(this.buf,this.pos)+km(this.buf,this.pos+4)*f_;return this.pos+=8,h},readFloat:function(){var h=Jx(this.buf,this.pos,!0,23,4);return this.pos+=4,h},readDouble:function(){var h=Jx(this.buf,this.pos,!0,52,8);return this.pos+=8,h},readVarint:function(h){var c,d,v=this.buf;return c=127&(d=v[this.pos++]),d<128?c:(c|=(127&(d=v[this.pos++]))<<7,d<128?c:(c|=(127&(d=v[this.pos++]))<<14,d<128?c:(c|=(127&(d=v[this.pos++]))<<21,d<128?c:function(S,P,k){var G,W,ee=k.buf;if(G=(112&(W=ee[k.pos++]))>>4,W<128||(G|=(127&(W=ee[k.pos++]))<<3,W<128)||(G|=(127&(W=ee[k.pos++]))<<10,W<128)||(G|=(127&(W=ee[k.pos++]))<<17,W<128)||(G|=(127&(W=ee[k.pos++]))<<24,W<128)||(G|=(1&(W=ee[k.pos++]))<<31,W<128))return ef(S,G,P);throw new Error("Expected varint not more than 10 bytes")}(c|=(15&(d=v[this.pos]))<<28,h,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var h=this.readVarint();return h%2==1?(h+1)/-2:h/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var h=this.readVarint()+this.pos,c=this.pos;return this.pos=h,h-c>=12&&tw?function(d,v,S){return tw.decode(d.subarray(v,S))}(this.buf,c,h):function(d,v,S){for(var P="",k=v;k<S;){var G,W,ee,ae=d[k],fe=null,me=ae>239?4:ae>223?3:ae>191?2:1;if(k+me>S)break;me===1?ae<128&&(fe=ae):me===2?(192&(G=d[k+1]))==128&&(fe=(31&ae)<<6|63&G)<=127&&(fe=null):me===3?(W=d[k+2],(192&(G=d[k+1]))==128&&(192&W)==128&&((fe=(15&ae)<<12|(63&G)<<6|63&W)<=2047||fe>=55296&&fe<=57343)&&(fe=null)):me===4&&(W=d[k+2],ee=d[k+3],(192&(G=d[k+1]))==128&&(192&W)==128&&(192&ee)==128&&((fe=(15&ae)<<18|(63&G)<<12|(63&W)<<6|63&ee)<=65535||fe>=1114112)&&(fe=null)),fe===null?(fe=65533,me=1):fe>65535&&(fe-=65536,P+=String.fromCharCode(fe>>>10&1023|55296),fe=56320|1023&fe),P+=String.fromCharCode(fe),k+=me}return P}(this.buf,c,h)},readBytes:function(){var h=this.readVarint()+this.pos,c=this.buf.subarray(this.pos,h);return this.pos=h,c},readPackedVarint:function(h,c){if(this.type!==Yn.Bytes)return h.push(this.readVarint(c));var d=Fh(this);for(h=h||[];this.pos<d;)h.push(this.readVarint(c));return h},readPackedSVarint:function(h){if(this.type!==Yn.Bytes)return h.push(this.readSVarint());var c=Fh(this);for(h=h||[];this.pos<c;)h.push(this.readSVarint());return h},readPackedBoolean:function(h){if(this.type!==Yn.Bytes)return h.push(this.readBoolean());var c=Fh(this);for(h=h||[];this.pos<c;)h.push(this.readBoolean());return h},readPackedFloat:function(h){if(this.type!==Yn.Bytes)return h.push(this.readFloat());var c=Fh(this);for(h=h||[];this.pos<c;)h.push(this.readFloat());return h},readPackedDouble:function(h){if(this.type!==Yn.Bytes)return h.push(this.readDouble());var c=Fh(this);for(h=h||[];this.pos<c;)h.push(this.readDouble());return h},readPackedFixed32:function(h){if(this.type!==Yn.Bytes)return h.push(this.readFixed32());var c=Fh(this);for(h=h||[];this.pos<c;)h.push(this.readFixed32());return h},readPackedSFixed32:function(h){if(this.type!==Yn.Bytes)return h.push(this.readSFixed32());var c=Fh(this);for(h=h||[];this.pos<c;)h.push(this.readSFixed32());return h},readPackedFixed64:function(h){if(this.type!==Yn.Bytes)return h.push(this.readFixed64());var c=Fh(this);for(h=h||[];this.pos<c;)h.push(this.readFixed64());return h},readPackedSFixed64:function(h){if(this.type!==Yn.Bytes)return h.push(this.readSFixed64());var c=Fh(this);for(h=h||[];this.pos<c;)h.push(this.readSFixed64());return h},skip:function(h){var c=7&h;if(c===Yn.Varint)for(;this.buf[this.pos++]>127;);else if(c===Yn.Bytes)this.pos=this.readVarint()+this.pos;else if(c===Yn.Fixed32)this.pos+=4;else{if(c!==Yn.Fixed64)throw new Error("Unimplemented type: "+c);this.pos+=8}},writeTag:function(h,c){this.writeVarint(h<<3|c)},realloc:function(h){for(var c=this.length||16;c<this.pos+h;)c*=2;if(c!==this.length){var d=new Uint8Array(c);d.set(this.buf),this.buf=d,this.length=c}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(h){this.realloc(4),Qo(this.buf,h,this.pos),this.pos+=4},writeSFixed32:function(h){this.realloc(4),Qo(this.buf,h,this.pos),this.pos+=4},writeFixed64:function(h){this.realloc(8),Qo(this.buf,-1&h,this.pos),Qo(this.buf,Math.floor(h*ew),this.pos+4),this.pos+=8},writeSFixed64:function(h){this.realloc(8),Qo(this.buf,-1&h,this.pos),Qo(this.buf,Math.floor(h*ew),this.pos+4),this.pos+=8},writeVarint:function(h){(h=+h||0)>268435455||h<0?function(c,d){var v,S;if(c>=0?(v=c%4294967296|0,S=c/4294967296|0):(S=~(-c/4294967296),4294967295^(v=~(-c%4294967296))?v=v+1|0:(v=0,S=S+1|0)),c>=18446744073709552e3||c<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");d.realloc(10),function(P,k,G){G.buf[G.pos++]=127&P|128,P>>>=7,G.buf[G.pos++]=127&P|128,P>>>=7,G.buf[G.pos++]=127&P|128,P>>>=7,G.buf[G.pos++]=127&P|128,G.buf[G.pos]=127&(P>>>=7)}(v,0,d),function(P,k){var G=(7&P)<<4;k.buf[k.pos++]|=G|((P>>>=3)?128:0),P&&(k.buf[k.pos++]=127&P|((P>>>=7)?128:0),P&&(k.buf[k.pos++]=127&P|((P>>>=7)?128:0),P&&(k.buf[k.pos++]=127&P|((P>>>=7)?128:0),P&&(k.buf[k.pos++]=127&P|((P>>>=7)?128:0),P&&(k.buf[k.pos++]=127&P)))))}(S,d)}(h,this):(this.realloc(4),this.buf[this.pos++]=127&h|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=h>>>7&127))))},writeSVarint:function(h){this.writeVarint(h<0?2*-h-1:2*h)},writeBoolean:function(h){this.writeVarint(!!h)},writeString:function(h){h=String(h),this.realloc(4*h.length),this.pos++;var c=this.pos;this.pos=function(v,S,P){for(var k,G,W=0;W<S.length;W++){if((k=S.charCodeAt(W))>55295&&k<57344){if(!G){k>56319||W+1===S.length?(v[P++]=239,v[P++]=191,v[P++]=189):G=k;continue}if(k<56320){v[P++]=239,v[P++]=191,v[P++]=189,G=k;continue}k=G-55296<<10|k-56320|65536,G=null}else G&&(v[P++]=239,v[P++]=191,v[P++]=189,G=null);k<128?v[P++]=k:(k<2048?v[P++]=k>>6|192:(k<65536?v[P++]=k>>12|224:(v[P++]=k>>18|240,v[P++]=k>>12&63|128),v[P++]=k>>6&63|128),v[P++]=63&k|128)}return P}(this.buf,h,this.pos);var d=this.pos-c;d>=128&&rw(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeFloat:function(h){this.realloc(4),Yx(this.buf,h,this.pos,!0,23,4),this.pos+=4},writeDouble:function(h){this.realloc(8),Yx(this.buf,h,this.pos,!0,52,8),this.pos+=8},writeBytes:function(h){var c=h.length;this.writeVarint(c),this.realloc(c);for(var d=0;d<c;d++)this.buf[this.pos++]=h[d]},writeRawMessage:function(h,c){this.pos++;var d=this.pos;h(c,this);var v=this.pos-d;v>=128&&rw(d,v,this),this.pos=d-1,this.writeVarint(v),this.pos+=v},writeMessage:function(h,c,d){this.writeTag(h,Yn.Bytes),this.writeRawMessage(c,d)},writePackedVarint:function(h,c){c.length&&this.writeMessage(h,Rm,c)},writePackedSVarint:function(h,c){c.length&&this.writeMessage(h,tf,c)},writePackedBoolean:function(h,c){c.length&&this.writeMessage(h,g_,c)},writePackedFloat:function(h,c){c.length&&this.writeMessage(h,iw,c)},writePackedDouble:function(h,c){c.length&&this.writeMessage(h,p_,c)},writePackedFixed32:function(h,c){c.length&&this.writeMessage(h,f5,c)},writePackedSFixed32:function(h,c){c.length&&this.writeMessage(h,p5,c)},writePackedFixed64:function(h,c){c.length&&this.writeMessage(h,g5,c)},writePackedSFixed64:function(h,c){c.length&&this.writeMessage(h,nw,c)},writeBytesField:function(h,c){this.writeTag(h,Yn.Bytes),this.writeBytes(c)},writeFixed32Field:function(h,c){this.writeTag(h,Yn.Fixed32),this.writeFixed32(c)},writeSFixed32Field:function(h,c){this.writeTag(h,Yn.Fixed32),this.writeSFixed32(c)},writeFixed64Field:function(h,c){this.writeTag(h,Yn.Fixed64),this.writeFixed64(c)},writeSFixed64Field:function(h,c){this.writeTag(h,Yn.Fixed64),this.writeSFixed64(c)},writeVarintField:function(h,c){this.writeTag(h,Yn.Varint),this.writeVarint(c)},writeSVarintField:function(h,c){this.writeTag(h,Yn.Varint),this.writeSVarint(c)},writeStringField:function(h,c){this.writeTag(h,Yn.Bytes),this.writeString(c)},writeFloatField:function(h,c){this.writeTag(h,Yn.Fixed32),this.writeFloat(c)},writeDoubleField:function(h,c){this.writeTag(h,Yn.Fixed64),this.writeDouble(c)},writeBooleanField:function(h,c){this.writeVarintField(h,!!c)}};var Om=y(d_);const Xu=3;function Sp(h,c,d){h===1&&d.readMessage(Tp,c)}function Tp(h,c,d){if(h===3){const{id:v,bitmap:S,width:P,height:k,left:G,top:W,advance:ee}=d.readMessage(rf,{});c.push({id:v,bitmap:new Sc({width:P+2*Xu,height:k+2*Xu},S),metrics:{width:P,height:k,left:G,top:W,advance:ee}})}}function rf(h,c,d){h===1?c.id=d.readVarint():h===2?c.bitmap=d.readBytes():h===3?c.width=d.readVarint():h===4?c.height=d.readVarint():h===5?c.left=d.readSVarint():h===6?c.top=d.readSVarint():h===7&&(c.advance=d.readVarint())}const Ip=Xu;function Lp(h){let c=0,d=0;for(const k of h)c+=k.w*k.h,d=Math.max(d,k.w);h.sort((k,G)=>G.h-k.h);const v=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(c/.95)),d),h:1/0}];let S=0,P=0;for(const k of h)for(let G=v.length-1;G>=0;G--){const W=v[G];if(!(k.w>W.w||k.h>W.h)){if(k.x=W.x,k.y=W.y,P=Math.max(P,k.y+k.h),S=Math.max(S,k.x+k.w),k.w===W.w&&k.h===W.h){const ee=v.pop();G<v.length&&(v[G]=ee)}else k.h===W.h?(W.x+=k.w,W.w-=k.w):k.w===W.w?(W.y+=k.h,W.h-=k.h):(v.push({x:W.x+k.w,y:W.y,w:W.w-k.w,h:k.h}),W.y+=k.h,W.h-=k.h);break}}return{w:S,h:P,fill:c/(S*P)||0}}const Sl=1;class Um{constructor(c,d){let{pixelRatio:v,version:S,stretchX:P,stretchY:k,content:G}=d;this.paddedRect=c,this.pixelRatio=v,this.stretchX=P,this.stretchY=k,this.content=G,this.version=S}get tl(){return[this.paddedRect.x+Sl,this.paddedRect.y+Sl]}get br(){return[this.paddedRect.x+this.paddedRect.w-Sl,this.paddedRect.y+this.paddedRect.h-Sl]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Sl)/this.pixelRatio,(this.paddedRect.h-2*Sl)/this.pixelRatio]}}class m_{constructor(c,d){const v={},S={};this.haveRenderCallbacks=[];const P=[];this.addImages(c,v,P),this.addImages(d,S,P);const{w:k,h:G}=Lp(P),W=new zo({width:k||1,height:G||1});for(const ee in c){const ae=c[ee],fe=v[ee].paddedRect;zo.copy(ae.data,W,{x:0,y:0},{x:fe.x+Sl,y:fe.y+Sl},ae.data)}for(const ee in d){const ae=d[ee],fe=S[ee].paddedRect,me=fe.x+Sl,Ce=fe.y+Sl,Me=ae.data.width,Ue=ae.data.height;zo.copy(ae.data,W,{x:0,y:0},{x:me,y:Ce},ae.data),zo.copy(ae.data,W,{x:0,y:Ue-1},{x:me,y:Ce-1},{width:Me,height:1}),zo.copy(ae.data,W,{x:0,y:0},{x:me,y:Ce+Ue},{width:Me,height:1}),zo.copy(ae.data,W,{x:Me-1,y:0},{x:me-1,y:Ce},{width:1,height:Ue}),zo.copy(ae.data,W,{x:0,y:0},{x:me+Me,y:Ce},{width:1,height:Ue})}this.image=W,this.iconPositions=v,this.patternPositions=S}addImages(c,d,v){for(const S in c){const P=c[S],k={x:0,y:0,w:P.data.width+2*Sl,h:P.data.height+2*Sl};v.push(k),d[S]=new Um(k,P),P.hasRenderCallback&&this.haveRenderCallbacks.push(S)}}patchUpdatedImages(c,d){c.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const v in c.updatedImages)this.patchUpdatedImage(this.iconPositions[v],c.getImage(v),d),this.patchUpdatedImage(this.patternPositions[v],c.getImage(v),d)}patchUpdatedImage(c,d,v){if(!c||!d||c.version===d.version)return;c.version=d.version;const[S,P]=c.tl;v.update(d.data,void 0,{x:S,y:P})}}var vA;Nr("ImagePosition",Um),Nr("ImageAtlas",m_),s.ai=void 0,(vA=s.ai||(s.ai={}))[vA.none=0]="none",vA[vA.horizontal=1]="horizontal",vA[vA.vertical=2]="vertical",vA[vA.horizontalOnly=3]="horizontalOnly";const nf=-17;class sf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(c,d){const v=new sf;return v.scale=c||1,v.fontStack=d,v}static forImage(c){const d=new sf;return d.imageName=c,d}}class bA{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(c,d){const v=new bA;for(let S=0;S<c.sections.length;S++){const P=c.sections[S];P.image?v.addImageSection(P):v.addTextSection(P,d)}return v}length(){return this.text.length}getSection(c){return this.sections[this.sectionIndex[c]]}getSectionIndex(c){return this.sectionIndex[c]}getCharCode(c){return this.text.charCodeAt(c)}verticalizePunctuation(){this.text=function(c){let d="";for(let v=0;v<c.length;v++){const S=c.charCodeAt(v+1)||null,P=c.charCodeAt(v-1)||null;d+=S&&Gc(S)&&!Tc[c[v+1]]||P&&Gc(P)&&!Tc[c[v-1]]||!Tc[c[v]]?c[v]:Tc[c[v]]}return d}(this.text)}trim(){let c=0;for(let v=0;v<this.text.length&&Nm[this.text.charCodeAt(v)];v++)c++;let d=this.text.length;for(let v=this.text.length-1;v>=0&&v>=c&&Nm[this.text.charCodeAt(v)];v--)d--;this.text=this.text.substring(c,d),this.sectionIndex=this.sectionIndex.slice(c,d)}substring(c,d){const v=new bA;return v.text=this.text.substring(c,d),v.sectionIndex=this.sectionIndex.slice(c,d),v.sections=this.sections,v}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((c,d)=>Math.max(c,this.sections[d].scale),0)}addTextSection(c,d){this.text+=c.text,this.sections.push(sf.forText(c.scale,c.fontStack||d));const v=this.sections.length-1;for(let S=0;S<c.text.length;++S)this.sectionIndex.push(v)}addImageSection(c){const d=c.image?c.image.name:"";if(d.length===0)return void Xe("Can't add FormattedSection with an empty image.");const v=this.getNextImageSectionCharCode();v?(this.text+=String.fromCharCode(v),this.sections.push(sf.forImage(d)),this.sectionIndex.push(this.sections.length-1)):Xe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function of(h,c,d,v,S,P,k,G,W,ee,ae,fe,me,Ce,Me,Ue){const $e=bA.fromFeature(h,S);let Ke;fe===s.ai.vertical&&$e.verticalizePunctuation();const{processBidirectionalText:ut,processStyledBidirectionalText:tt}=no;if(ut&&$e.sections.length===1){Ke=[];const St=ut($e.toString(),Mp($e,ee,P,c,v,Ce,Me));for(const Jt of St){const Br=new bA;Br.text=Jt,Br.sections=$e.sections;for(let ar=0;ar<Jt.length;ar++)Br.sectionIndex.push(0);Ke.push(Br)}}else if(tt){Ke=[];const St=tt($e.text,$e.sectionIndex,Mp($e,ee,P,c,v,Ce,Me));for(const Jt of St){const Br=new bA;Br.text=Jt[0],Br.sectionIndex=Jt[1],Br.sections=$e.sections,Ke.push(Br)}}else Ke=function(St,Jt){const Br=[],ar=St.text;let pr=0;for(const _r of Jt)Br.push(St.substring(pr,_r)),pr=_r;return pr<ar.length&&Br.push(St.substring(pr,ar.length)),Br}($e,Mp($e,ee,P,c,v,Ce,Me));const it=[],yt={positionedLines:it,text:$e.toString(),top:ae[1],bottom:ae[1],left:ae[0],right:ae[0],writingMode:fe,iconsInText:!1,verticalizable:!1};return function(St,Jt,Br,ar,pr,_r,kr,lr,Yt,jr,Vr,_i){let Vi=0,$i=nf,gn=0,cs=0;const Qn=lr==="right"?1:lr==="left"?0:.5;let xn=0;for(const An of pr){An.trim();const rn=An.getMaxScale(),gs=(rn-1)*Ss,Ts={positionedGlyphs:[],lineOffset:0};St.positionedLines[xn]=Ts;const xs=Ts.positionedGlyphs;let ao=0;if(!An.length()){$i+=_r,++xn;continue}for(let kn=0;kn<An.length();kn++){const Si=An.getSection(kn),Qs=An.getSectionIndex(kn),fo=An.getCharCode(kn);let po=0,uc=null,Ic=null,aa=null,th=Ss;const Lc=!(Yt===s.ai.horizontal||!Vr&&!io(fo)||Vr&&(Nm[fo]||(Rn=fo,Mr.Arabic(Rn)||Mr["Arabic Supplement"](Rn)||Mr["Arabic Extended-A"](Rn)||Mr["Arabic Presentation Forms-A"](Rn)||Mr["Arabic Presentation Forms-B"](Rn))));if(Si.imageName){const Mc=ar[Si.imageName];if(!Mc)continue;aa=Si.imageName,St.iconsInText=St.iconsInText||!0,Ic=Mc.paddedRect;const Tl=Mc.displaySize;Si.scale=Si.scale*Ss/_i,uc={width:Tl[0],height:Tl[1],left:Sl,top:-Ip,advance:Lc?Tl[1]:Tl[0]},po=gs+(Ss-Tl[1]*Si.scale),th=uc.advance;const Oh=Lc?Tl[0]*Si.scale-Ss*rn:Tl[1]*Si.scale-Ss*rn;Oh>0&&Oh>ao&&(ao=Oh)}else{const Mc=Br[Si.fontStack],Tl=Mc&&Mc[fo];if(Tl&&Tl.rect)Ic=Tl.rect,uc=Tl.metrics;else{const Oh=Jt[Si.fontStack],qp=Oh&&Oh[fo];if(!qp)continue;uc=qp.metrics}po=(rn-Si.scale)*Ss}Lc?(St.verticalizable=!0,xs.push({glyph:fo,imageName:aa,x:Vi,y:$i+po,vertical:Lc,scale:Si.scale,fontStack:Si.fontStack,sectionIndex:Qs,metrics:uc,rect:Ic}),Vi+=th*Si.scale+jr):(xs.push({glyph:fo,imageName:aa,x:Vi,y:$i+po,vertical:Lc,scale:Si.scale,fontStack:Si.fontStack,sectionIndex:Qs,metrics:uc,rect:Ic}),Vi+=uc.advance*Si.scale+jr)}xs.length!==0&&(gn=Math.max(Vi-jr,gn),y5(xs,0,xs.length-1,Qn,ao)),Vi=0;const Is=_r*rn+ao;Ts.lineOffset=Math.max(ao,gs),$i+=Is,cs=Math.max(Is,cs),++xn}var Rn;const hn=$i-nf,{horizontalAlign:Bi,verticalAlign:Vn}=v_(kr);(function(An,rn,gs,Ts,xs,ao,Is,kn,Si){const Qs=(rn-gs)*xs;let fo=0;fo=ao!==Is?-kn*Ts-nf:(-Ts*Si+.5)*Is;for(const po of An)for(const uc of po.positionedGlyphs)uc.x+=Qs,uc.y+=fo})(St.positionedLines,Qn,Bi,Vn,gn,cs,_r,hn,pr.length),St.top+=-Vn*hn,St.bottom=St.top+hn,St.left+=-Bi*gn,St.right=St.left+gn}(yt,c,d,v,Ke,k,G,W,fe,ee,me,Ue),!function(St){for(const Jt of St)if(Jt.positionedGlyphs.length!==0)return!1;return!0}(it)&&yt}const Nm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},m5={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function y_(h,c,d,v,S,P){if(c.imageName){const k=v[c.imageName];return k?k.displaySize[0]*c.scale*Ss/P+S:0}{const k=d[c.fontStack],G=k&&k[h];return G?G.metrics.advance*c.scale+S:0}}function af(h,c,d,v){const S=Math.pow(h-c,2);return v?h<c?S/2:2*S:S+Math.abs(d)*d}function Zu(h,c,d){let v=0;return h===10&&(v-=1e4),d&&(v+=150),h!==40&&h!==65288||(v+=50),c!==41&&c!==65289||(v+=50),v}function Dh(h,c,d,v,S,P){let k=null,G=af(c,d,S,P);for(const W of v){const ee=af(c-W.x,d,S,P)+W.badness;ee<=G&&(k=W,G=ee)}return{index:h,x:c,priorBreak:k,badness:G}}function __(h){return h?__(h.priorBreak).concat(h.index):[]}function Mp(h,c,d,v,S,P,k){if(P!=="point")return[];if(!h)return[];const G=[],W=function(me,Ce,Me,Ue,$e,Ke){let ut=0;for(let tt=0;tt<me.length();tt++){const it=me.getSection(tt);ut+=y_(me.getCharCode(tt),it,Ue,$e,Ce,Ke)}return ut/Math.max(1,Math.ceil(ut/Me))}(h,c,d,v,S,k),ee=h.text.indexOf("")>=0;let ae=0;for(let me=0;me<h.length();me++){const Ce=h.getSection(me),Me=h.getCharCode(me);if(Nm[Me]||(ae+=y_(Me,Ce,v,S,c,k)),me<h.length()-1){const Ue=!((fe=Me)<11904||!(Mr["Bopomofo Extended"](fe)||Mr.Bopomofo(fe)||Mr["CJK Compatibility Forms"](fe)||Mr["CJK Compatibility Ideographs"](fe)||Mr["CJK Compatibility"](fe)||Mr["CJK Radicals Supplement"](fe)||Mr["CJK Strokes"](fe)||Mr["CJK Symbols and Punctuation"](fe)||Mr["CJK Unified Ideographs Extension A"](fe)||Mr["CJK Unified Ideographs"](fe)||Mr["Enclosed CJK Letters and Months"](fe)||Mr["Halfwidth and Fullwidth Forms"](fe)||Mr.Hiragana(fe)||Mr["Ideographic Description Characters"](fe)||Mr["Kangxi Radicals"](fe)||Mr["Katakana Phonetic Extensions"](fe)||Mr.Katakana(fe)||Mr["Vertical Forms"](fe)||Mr["Yi Radicals"](fe)||Mr["Yi Syllables"](fe)));(m5[Me]||Ue||Ce.imageName)&&G.push(Dh(me+1,ae,W,G,Zu(Me,h.getCharCode(me+1),Ue&&ee),!1))}}var fe;return __(Dh(h.length(),ae,W,G,0,!0))}function v_(h){let c=.5,d=.5;switch(h){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":d=1;break;case"top":case"top-right":case"top-left":d=0}return{horizontalAlign:c,verticalAlign:d}}function y5(h,c,d,v,S){if(!v&&!S)return;const P=h[d],k=(h[d].x+P.metrics.advance*P.scale)*v;for(let G=c;G<=d;G++)h[G].x-=k,h[G].y+=S}function zm(h,c,d){const{horizontalAlign:v,verticalAlign:S}=v_(d),P=c[0]-h.displaySize[0]*v,k=c[1]-h.displaySize[1]*S;return{image:h,top:k,bottom:k+h.displaySize[1],left:P,right:P+h.displaySize[0]}}function Qm(h,c,d,v,S,P){const k=h.image;let G;if(k.content){const $e=k.content,Ke=k.pixelRatio||1;G=[$e[0]/Ke,$e[1]/Ke,k.displaySize[0]-$e[2]/Ke,k.displaySize[1]-$e[3]/Ke]}const W=c.left*P,ee=c.right*P;let ae,fe,me,Ce;d==="width"||d==="both"?(Ce=S[0]+W-v[3],fe=S[0]+ee+v[1]):(Ce=S[0]+(W+ee-k.displaySize[0])/2,fe=Ce+k.displaySize[0]);const Me=c.top*P,Ue=c.bottom*P;return d==="height"||d==="both"?(ae=S[1]+Me-v[0],me=S[1]+Ue+v[2]):(ae=S[1]+(Me+Ue-k.displaySize[1])/2,me=ae+k.displaySize[1]),{image:k,top:ae,right:fe,bottom:me,left:Ce,collisionPadding:G}}const Pp=255,Yc=128,Ju=Pp*Yc;function id(h,c){const{expression:d}=c;if(d.kind==="constant")return{kind:"constant",layoutSize:d.evaluate(new Sr(h+1))};if(d.kind==="source")return{kind:"source"};{const{zoomStops:v,interpolationType:S}=d;let P=0;for(;P<v.length&&v[P]<=h;)P++;P=Math.max(0,P-1);let k=P;for(;k<v.length&&v[k]<h+1;)k++;k=Math.min(v.length-1,k);const G=v[P],W=v[k];return d.kind==="composite"?{kind:"composite",minZoom:G,maxZoom:W,interpolationType:S}:{kind:"camera",minZoom:G,maxZoom:W,minSize:d.evaluate(new Sr(G)),maxSize:d.evaluate(new Sr(W)),interpolationType:S}}}function Vm(h,c,d){let v="never";const S=h.get(c);return S?v=S:h.get(d)&&(v="always"),v}const sw=yA.VectorTileFeature.types,b_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Fp(h,c,d,v,S,P,k,G,W,ee,ae,fe,me){const Ce=G?Math.min(Ju,Math.round(G[0])):0,Me=G?Math.min(Ju,Math.round(G[1])):0;h.emplaceBack(c,d,Math.round(32*v),Math.round(32*S),P,k,(Ce<<1)+(W?1:0),Me,16*ee,16*ae,256*fe,256*me)}function lf(h,c,d){h.emplaceBack(c.x,c.y,d),h.emplaceBack(c.x,c.y,d),h.emplaceBack(c.x,c.y,d),h.emplaceBack(c.x,c.y,d)}function ow(h){for(const c of h.sections)if(jc(c.text))return!0;return!1}class x_{constructor(c){this.layoutVertexArray=new dt,this.indexArray=new Ht,this.programConfigurations=c,this.segments=new hr,this.dynamicLayoutVertexArray=new ft,this.opacityVertexArray=new Nt,this.hasVisibleVertices=!1,this.placedSymbolArray=new V}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(c,d,v,S){this.isEmpty()||(v&&(this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,Kx.members),this.indexBuffer=c.createIndexBuffer(this.indexArray,d),this.dynamicLayoutVertexBuffer=c.createVertexBuffer(this.dynamicLayoutVertexArray,Wx.members,!0),this.opacityVertexBuffer=c.createVertexBuffer(this.opacityVertexArray,b_,!0),this.opacityVertexBuffer.itemSize=1),(v||S)&&this.programConfigurations.upload(c))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Nr("SymbolBuffers",x_);class w_{constructor(c,d,v){this.layoutVertexArray=new c,this.layoutAttributes=d,this.indexArray=new v,this.segments=new hr,this.collisionVertexArray=new jt}upload(c){this.layoutVertexBuffer=c.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=c.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=c.createVertexBuffer(this.collisionVertexArray,Jn.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Nr("CollisionBuffers",w_);class nd{constructor(c){this.collisionBoxArray=c.collisionBoxArray,this.zoom=c.zoom,this.overscaling=c.overscaling,this.layers=c.layers,this.layerIds=this.layers.map(k=>k.id),this.index=c.index,this.pixelRatio=c.pixelRatio,this.sourceLayerIndex=c.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=qd([]),this.placementViewportMatrix=qd([]);const d=this.layers[0]._unevaluatedLayout._values;this.textSizeData=id(this.zoom,d["text-size"]),this.iconSizeData=id(this.zoom,d["icon-size"]);const v=this.layers[0].layout,S=v.get("symbol-sort-key"),P=v.get("symbol-z-order");this.canOverlap=Vm(v,"text-overlap","text-allow-overlap")!=="never"||Vm(v,"icon-overlap","icon-allow-overlap")!=="never"||v.get("text-ignore-placement")||v.get("icon-ignore-placement"),this.sortFeaturesByKey=P!=="viewport-y"&&!S.isConstant(),this.sortFeaturesByY=(P==="viewport-y"||P==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,v.get("symbol-placement")==="point"&&(this.writingModes=v.get("text-writing-mode").map(k=>s.ai[k])),this.stateDependentLayerIds=this.layers.filter(k=>k.isStateDependent()).map(k=>k.id),this.sourceID=c.sourceID}createArrays(){this.text=new x_(new bo(this.layers,this.zoom,c=>/^text/.test(c))),this.icon=new x_(new bo(this.layers,this.zoom,c=>/^icon/.test(c))),this.glyphOffsetArray=new te,this.lineVertexArray=new se,this.symbolInstances=new K,this.textAnchorOffsets=new le}calculateGlyphDependencies(c,d,v,S,P){for(let k=0;k<c.length;k++)if(d[c.charCodeAt(k)]=!0,(v||S)&&P){const G=Tc[c.charAt(k)];G&&(d[G.charCodeAt(0)]=!0)}}populate(c,d,v){const S=this.layers[0],P=S.layout,k=P.get("text-font"),G=P.get("text-field"),W=P.get("icon-image"),ee=(G.value.kind!=="constant"||G.value.value instanceof Ui&&!G.value.value.isEmpty()||G.value.value.toString().length>0)&&(k.value.kind!=="constant"||k.value.value.length>0),ae=W.value.kind!=="constant"||!!W.value.value||Object.keys(W.parameters).length>0,fe=P.get("symbol-sort-key");if(this.features=[],!ee&&!ae)return;const me=d.iconDependencies,Ce=d.glyphDependencies,Me=d.availableImages,Ue=new Sr(this.zoom);for(const{feature:$e,id:Ke,index:ut,sourceLayerIndex:tt}of c){const it=S._featureFilter.needGeometry,yt=al($e,it);if(!S._featureFilter.filter(Ue,yt,v))continue;let St,Jt;if(it||(yt.geometry=wl($e)),ee){const ar=S.getValueAndResolveTokens("text-field",yt,v,Me),pr=Ui.factory(ar);ow(pr)&&(this.hasRTLText=!0),(!this.hasRTLText||Gu()==="unavailable"||this.hasRTLText&&no.isParsed())&&(St=Zx(pr,S,yt))}if(ae){const ar=S.getValueAndResolveTokens("icon-image",yt,v,Me);Jt=ar instanceof Zr?ar:Zr.fromString(ar)}if(!St&&!Jt)continue;const Br=this.sortFeaturesByKey?fe.evaluate(yt,{},v):void 0;if(this.features.push({id:Ke,text:St,icon:Jt,index:ut,sourceLayerIndex:tt,geometry:yt.geometry,properties:$e.properties,type:sw[$e.type],sortKey:Br}),Jt&&(me[Jt.name]=!0),St){const ar=k.evaluate(yt,{},v).join(","),pr=P.get("text-rotation-alignment")!=="viewport"&&P.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(s.ai.vertical)>=0;for(const _r of St.sections)if(_r.image)me[_r.image.name]=!0;else{const kr=Cc(St.toString()),lr=_r.fontStack||ar,Yt=Ce[lr]=Ce[lr]||{};this.calculateGlyphDependencies(_r.text,Yt,pr,this.allowVerticalPlacement,kr)}}}P.get("symbol-placement")==="line"&&(this.features=function($e){const Ke={},ut={},tt=[];let it=0;function yt(ar){tt.push($e[ar]),it++}function St(ar,pr,_r){const kr=ut[ar];return delete ut[ar],ut[pr]=kr,tt[kr].geometry[0].pop(),tt[kr].geometry[0]=tt[kr].geometry[0].concat(_r[0]),kr}function Jt(ar,pr,_r){const kr=Ke[pr];return delete Ke[pr],Ke[ar]=kr,tt[kr].geometry[0].shift(),tt[kr].geometry[0]=_r[0].concat(tt[kr].geometry[0]),kr}function Br(ar,pr,_r){const kr=_r?pr[0][pr[0].length-1]:pr[0][0];return`${ar}:${kr.x}:${kr.y}`}for(let ar=0;ar<$e.length;ar++){const pr=$e[ar],_r=pr.geometry,kr=pr.text?pr.text.toString():null;if(!kr){yt(ar);continue}const lr=Br(kr,_r),Yt=Br(kr,_r,!0);if(lr in ut&&Yt in Ke&&ut[lr]!==Ke[Yt]){const jr=Jt(lr,Yt,_r),Vr=St(lr,Yt,tt[jr].geometry);delete Ke[lr],delete ut[Yt],ut[Br(kr,tt[Vr].geometry,!0)]=Vr,tt[jr].geometry=null}else lr in ut?St(lr,Yt,_r):Yt in Ke?Jt(lr,Yt,_r):(yt(ar),Ke[lr]=it-1,ut[Yt]=it-1)}return tt.filter(ar=>ar.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort(($e,Ke)=>$e.sortKey-Ke.sortKey)}update(c,d,v){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(c,d,this.layers,v),this.icon.programConfigurations.updatePaintArrays(c,d,this.layers,v))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(c){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(c),this.iconCollisionBox.upload(c)),this.text.upload(c,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(c,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(c,d){const v=this.lineVertexArray.length;if(c.segment!==void 0){let S=c.dist(d[c.segment+1]),P=c.dist(d[c.segment]);const k={};for(let G=c.segment+1;G<d.length;G++)k[G]={x:d[G].x,y:d[G].y,tileUnitDistanceFromAnchor:S},G<d.length-1&&(S+=d[G+1].dist(d[G]));for(let G=c.segment||0;G>=0;G--)k[G]={x:d[G].x,y:d[G].y,tileUnitDistanceFromAnchor:P},G>0&&(P+=d[G-1].dist(d[G]));for(let G=0;G<d.length;G++){const W=k[G];this.lineVertexArray.emplaceBack(W.x,W.y,W.tileUnitDistanceFromAnchor)}}return{lineStartIndex:v,lineLength:this.lineVertexArray.length-v}}addSymbols(c,d,v,S,P,k,G,W,ee,ae,fe,me){const Ce=c.indexArray,Me=c.layoutVertexArray,Ue=c.segments.prepareSegment(4*d.length,Me,Ce,this.canOverlap?k.sortKey:void 0),$e=this.glyphOffsetArray.length,Ke=Ue.vertexLength,ut=this.allowVerticalPlacement&&G===s.ai.vertical?Math.PI/2:0,tt=k.text&&k.text.sections;for(let it=0;it<d.length;it++){const{tl:yt,tr:St,bl:Jt,br:Br,tex:ar,pixelOffsetTL:pr,pixelOffsetBR:_r,minFontScaleX:kr,minFontScaleY:lr,glyphOffset:Yt,isSDF:jr,sectionIndex:Vr}=d[it],_i=Ue.vertexLength,Vi=Yt[1];Fp(Me,W.x,W.y,yt.x,Vi+yt.y,ar.x,ar.y,v,jr,pr.x,pr.y,kr,lr),Fp(Me,W.x,W.y,St.x,Vi+St.y,ar.x+ar.w,ar.y,v,jr,_r.x,pr.y,kr,lr),Fp(Me,W.x,W.y,Jt.x,Vi+Jt.y,ar.x,ar.y+ar.h,v,jr,pr.x,_r.y,kr,lr),Fp(Me,W.x,W.y,Br.x,Vi+Br.y,ar.x+ar.w,ar.y+ar.h,v,jr,_r.x,_r.y,kr,lr),lf(c.dynamicLayoutVertexArray,W,ut),Ce.emplaceBack(_i,_i+1,_i+2),Ce.emplaceBack(_i+1,_i+2,_i+3),Ue.vertexLength+=4,Ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Yt[0]),it!==d.length-1&&Vr===d[it+1].sectionIndex||c.programConfigurations.populatePaintArrays(Me.length,k,k.index,{},me,tt&&tt[Vr])}c.placedSymbolArray.emplaceBack(W.x,W.y,$e,this.glyphOffsetArray.length-$e,Ke,ee,ae,W.segment,v?v[0]:0,v?v[1]:0,S[0],S[1],G,0,!1,0,fe)}_addCollisionDebugVertex(c,d,v,S,P,k){return d.emplaceBack(0,0),c.emplaceBack(v.x,v.y,S,P,Math.round(k.x),Math.round(k.y))}addCollisionDebugVertices(c,d,v,S,P,k,G){const W=P.segments.prepareSegment(4,P.layoutVertexArray,P.indexArray),ee=W.vertexLength,ae=P.layoutVertexArray,fe=P.collisionVertexArray,me=G.anchorX,Ce=G.anchorY;this._addCollisionDebugVertex(ae,fe,k,me,Ce,new R(c,d)),this._addCollisionDebugVertex(ae,fe,k,me,Ce,new R(v,d)),this._addCollisionDebugVertex(ae,fe,k,me,Ce,new R(v,S)),this._addCollisionDebugVertex(ae,fe,k,me,Ce,new R(c,S)),W.vertexLength+=4;const Me=P.indexArray;Me.emplaceBack(ee,ee+1),Me.emplaceBack(ee+1,ee+2),Me.emplaceBack(ee+2,ee+3),Me.emplaceBack(ee+3,ee),W.primitiveLength+=4}addDebugCollisionBoxes(c,d,v,S){for(let P=c;P<d;P++){const k=this.collisionBoxArray.get(P);this.addCollisionDebugVertices(k.x1,k.y1,k.x2,k.y2,S?this.textCollisionBox:this.iconCollisionBox,k.anchorPoint,v)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new w_(It,Dm.members,Pr),this.iconCollisionBox=new w_(It,Dm.members,Pr);for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this.addDebugCollisionBoxes(d.textBoxStartIndex,d.textBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d,!0),this.addDebugCollisionBoxes(d.iconBoxStartIndex,d.iconBoxEndIndex,d,!1),this.addDebugCollisionBoxes(d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d,!1)}}_deserializeCollisionBoxesForSymbol(c,d,v,S,P,k,G,W,ee){const ae={};for(let fe=d;fe<v;fe++){const me=c.get(fe);ae.textBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},ae.textFeatureIndex=me.featureIndex;break}for(let fe=S;fe<P;fe++){const me=c.get(fe);ae.verticalTextBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},ae.verticalTextFeatureIndex=me.featureIndex;break}for(let fe=k;fe<G;fe++){const me=c.get(fe);ae.iconBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},ae.iconFeatureIndex=me.featureIndex;break}for(let fe=W;fe<ee;fe++){const me=c.get(fe);ae.verticalIconBox={x1:me.x1,y1:me.y1,x2:me.x2,y2:me.y2,anchorPointX:me.anchorPointX,anchorPointY:me.anchorPointY},ae.verticalIconFeatureIndex=me.featureIndex;break}return ae}deserializeCollisionBoxes(c){this.collisionArrays=[];for(let d=0;d<this.symbolInstances.length;d++){const v=this.symbolInstances.get(d);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(c,v.textBoxStartIndex,v.textBoxEndIndex,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v.iconBoxStartIndex,v.iconBoxEndIndex,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(c,d){const v=c.placedSymbolArray.get(d),S=v.vertexStartIndex+4*v.numGlyphs;for(let P=v.vertexStartIndex;P<S;P+=4)c.indexArray.emplaceBack(P,P+1,P+2),c.indexArray.emplaceBack(P+1,P+2,P+3)}getSortedSymbolIndexes(c){if(this.sortedAngle===c&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const d=Math.sin(c),v=Math.cos(c),S=[],P=[],k=[];for(let G=0;G<this.symbolInstances.length;++G){k.push(G);const W=this.symbolInstances.get(G);S.push(0|Math.round(d*W.anchorX+v*W.anchorY)),P.push(W.featureIndex)}return k.sort((G,W)=>S[G]-S[W]||P[W]-P[G]),k}addToSortKeyRanges(c,d){const v=this.sortKeyRanges[this.sortKeyRanges.length-1];v&&v.sortKey===d?v.symbolInstanceEnd=c+1:this.sortKeyRanges.push({sortKey:d,symbolInstanceStart:c,symbolInstanceEnd:c+1})}sortFeatures(c){if(this.sortFeaturesByY&&this.sortedAngle!==c&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(c),this.sortedAngle=c,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const d of this.symbolInstanceIndexes){const v=this.symbolInstances.get(d);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach((S,P,k)=>{S>=0&&k.indexOf(S)===P&&this.addIndicesForPlacedSymbol(this.text,S)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let aw,lw;Nr("SymbolBucket",nd,{omit:["layers","collisionBoxArray","features","compareText"]}),nd.MAX_GLYPHS=65535,nd.addDynamicAttributes=lf;var B_={get paint(){return lw=lw||new sn({"icon-opacity":new Qr(ht.paint_symbol["icon-opacity"]),"icon-color":new Qr(ht.paint_symbol["icon-color"]),"icon-halo-color":new Qr(ht.paint_symbol["icon-halo-color"]),"icon-halo-width":new Qr(ht.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Qr(ht.paint_symbol["icon-halo-blur"]),"icon-translate":new Kr(ht.paint_symbol["icon-translate"]),"icon-translate-anchor":new Kr(ht.paint_symbol["icon-translate-anchor"]),"text-opacity":new Qr(ht.paint_symbol["text-opacity"]),"text-color":new Qr(ht.paint_symbol["text-color"],{runtimeType:vi,getOverride:h=>h.textColor,hasOverride:h=>!!h.textColor}),"text-halo-color":new Qr(ht.paint_symbol["text-halo-color"]),"text-halo-width":new Qr(ht.paint_symbol["text-halo-width"]),"text-halo-blur":new Qr(ht.paint_symbol["text-halo-blur"]),"text-translate":new Kr(ht.paint_symbol["text-translate"]),"text-translate-anchor":new Kr(ht.paint_symbol["text-translate-anchor"])})},get layout(){return aw=aw||new sn({"symbol-placement":new Kr(ht.layout_symbol["symbol-placement"]),"symbol-spacing":new Kr(ht.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Kr(ht.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Qr(ht.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Kr(ht.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Kr(ht.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Kr(ht.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Kr(ht.layout_symbol["icon-ignore-placement"]),"icon-optional":new Kr(ht.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Kr(ht.layout_symbol["icon-rotation-alignment"]),"icon-size":new Qr(ht.layout_symbol["icon-size"]),"icon-text-fit":new Kr(ht.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Kr(ht.layout_symbol["icon-text-fit-padding"]),"icon-image":new Qr(ht.layout_symbol["icon-image"]),"icon-rotate":new Qr(ht.layout_symbol["icon-rotate"]),"icon-padding":new Qr(ht.layout_symbol["icon-padding"]),"icon-keep-upright":new Kr(ht.layout_symbol["icon-keep-upright"]),"icon-offset":new Qr(ht.layout_symbol["icon-offset"]),"icon-anchor":new Qr(ht.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Kr(ht.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Kr(ht.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Kr(ht.layout_symbol["text-rotation-alignment"]),"text-field":new Qr(ht.layout_symbol["text-field"]),"text-font":new Qr(ht.layout_symbol["text-font"]),"text-size":new Qr(ht.layout_symbol["text-size"]),"text-max-width":new Qr(ht.layout_symbol["text-max-width"]),"text-line-height":new Kr(ht.layout_symbol["text-line-height"]),"text-letter-spacing":new Qr(ht.layout_symbol["text-letter-spacing"]),"text-justify":new Qr(ht.layout_symbol["text-justify"]),"text-radial-offset":new Qr(ht.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Kr(ht.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Qr(ht.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Qr(ht.layout_symbol["text-anchor"]),"text-max-angle":new Kr(ht.layout_symbol["text-max-angle"]),"text-writing-mode":new Kr(ht.layout_symbol["text-writing-mode"]),"text-rotate":new Qr(ht.layout_symbol["text-rotate"]),"text-padding":new Kr(ht.layout_symbol["text-padding"]),"text-keep-upright":new Kr(ht.layout_symbol["text-keep-upright"]),"text-transform":new Qr(ht.layout_symbol["text-transform"]),"text-offset":new Qr(ht.layout_symbol["text-offset"]),"text-allow-overlap":new Kr(ht.layout_symbol["text-allow-overlap"]),"text-overlap":new Kr(ht.layout_symbol["text-overlap"]),"text-ignore-placement":new Kr(ht.layout_symbol["text-ignore-placement"]),"text-optional":new Kr(ht.layout_symbol["text-optional"])})}};class cw{constructor(c){if(c.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=c.property.overrides?c.property.overrides.runtimeType:Lr,this.defaultValue=c}evaluate(c){if(c.formattedSection){const d=this.defaultValue.property.overrides;if(d&&d.hasOverride(c.formattedSection))return d.getOverride(c.formattedSection)}return c.feature&&c.featureState?this.defaultValue.evaluate(c.feature,c.featureState):this.defaultValue.property.specification.default}eachChild(c){this.defaultValue.isConstant()||c(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Nr("FormatSectionOverride",cw,{omit:["defaultValue"]});class cf extends Oo{constructor(c){super(c,B_)}recalculate(c,d){if(super.recalculate(c,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const v=this.layout.get("text-writing-mode");if(v){const S=[];for(const P of v)S.indexOf(P)<0&&S.push(P);this.layout._values["text-writing-mode"]=S}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(c,d,v,S){const P=this.layout.get(c).evaluate(d,{},v,S),k=this._unevaluatedLayout._values[c];return k.isDataDriven()||Pn(k.value)||!P?P:function(G,W){return W.replace(/{([^{}]+)}/g,(ee,ae)=>G&&ae in G?String(G[ae]):"")}(d.properties,P)}createBucket(c){return new nd(c)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const c of B_.paint.overridableProperties){if(!cf.hasPaintOverride(this.layout,c))continue;const d=this.paint.get(c),v=new cw(d),S=new ai(v,d.property.specification);let P=null;P=d.value.kind==="constant"||d.value.kind==="source"?new Li("source",S):new Ds("composite",S,d.value.zoomStops),this.paint._values[c]=new Wn(d.property,P,d.parameters)}}_handleOverridablePaintPropertyUpdate(c,d,v){return!(!this.layout||d.isDataDriven()||v.isDataDriven())&&cf.hasPaintOverride(this.layout,c)}static hasPaintOverride(c,d){const v=c.get("text-field"),S=B_.paint.properties[d];let P=!1;const k=G=>{for(const W of G)if(S.overrides&&S.overrides.hasOverride(W))return void(P=!0)};if(v.value.kind==="constant"&&v.value.value instanceof Ui)k(v.value.value.sections);else if(v.value.kind==="source"){const G=ee=>{P||(ee instanceof ss&&bi(ee.value)===ue?k(ee.value.sections):ee instanceof rl?k(ee.sections):ee.eachChild(G))},W=v.value;W._styleExpression&&G(W._styleExpression.expression)}return P}}let Rh;var uw={get paint(){return Rh=Rh||new sn({"background-color":new Kr(ht.paint_background["background-color"]),"background-pattern":new ju(ht.paint_background["background-pattern"]),"background-opacity":new Kr(ht.paint_background["background-opacity"])})}};class hw extends Oo{constructor(c){super(c,uw)}}let C_;var Aw={get paint(){return C_=C_||new sn({"raster-opacity":new Kr(ht.paint_raster["raster-opacity"]),"raster-hue-rotate":new Kr(ht.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Kr(ht.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Kr(ht.paint_raster["raster-brightness-max"]),"raster-saturation":new Kr(ht.paint_raster["raster-saturation"]),"raster-contrast":new Kr(ht.paint_raster["raster-contrast"]),"raster-resampling":new Kr(ht.paint_raster["raster-resampling"]),"raster-fade-duration":new Kr(ht.paint_raster["raster-fade-duration"])})}};class dw extends Oo{constructor(c){super(c,Aw)}}class E_ extends Oo{constructor(c){super(c,{}),this.onAdd=d=>{this.implementation.onAdd&&this.implementation.onAdd(d,d.painter.context.gl)},this.onRemove=d=>{this.implementation.onRemove&&this.implementation.onRemove(d,d.painter.context.gl)},this.implementation=c}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Hm{constructor(c){this._callback=c,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Gm=63710088e-1;class Yu{constructor(c,d){if(isNaN(c)||isNaN(d))throw new Error(`Invalid LngLat object: (${c}, ${d})`);if(this.lng=+c,this.lat=+d,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Yu(We(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(c){const d=Math.PI/180,v=this.lat*d,S=c.lat*d,P=Math.sin(v)*Math.sin(S)+Math.cos(v)*Math.cos(S)*Math.cos((c.lng-this.lng)*d);return Gm*Math.acos(Math.min(P,1))}static convert(c){if(c instanceof Yu)return c;if(Array.isArray(c)&&(c.length===2||c.length===3))return new Yu(Number(c[0]),Number(c[1]));if(!Array.isArray(c)&&typeof c=="object"&&c!==null)return new Yu(Number("lng"in c?c.lng:c.lon),Number(c.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const S_=2*Math.PI*Gm;function cc(h){return S_*Math.cos(h*Math.PI/180)}function uf(h){return(180+h)/360}function T_(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function I_(h,c){return h/cc(c)}function L_(h){return 360*h-180}function jm(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}class Dp{constructor(c,d){let v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;this.x=+c,this.y=+d,this.z=+v}static fromLngLat(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const v=Yu.convert(c);return new Dp(uf(v.lng),T_(v.lat),I_(d,v.lat))}toLngLat(){return new Yu(L_(this.x),jm(this.y))}toAltitude(){return this.z*cc(jm(this.y))}meterInMercatorCoordinateUnits(){return 1/S_*(c=jm(this.y),1/Math.cos(c*Math.PI/180));var c}}function M_(h,c,d){var v=2*Math.PI*6378137/256/Math.pow(2,d);return[h*v-2*Math.PI*6378137/2,c*v-2*Math.PI*6378137/2]}class P_{constructor(c,d,v){if(c<0||c>25||v<0||v>=Math.pow(2,c)||d<0||d>=Math.pow(2,c))throw new Error(`x=${d}, y=${v}, z=${c} outside of bounds. 0<=x<${Math.pow(2,c)}, 0<=y<${Math.pow(2,c)} 0<=z<=25 `);this.z=c,this.x=d,this.y=v,this.key=hf(0,c,c,d,v)}equals(c){return this.z===c.z&&this.x===c.x&&this.y===c.y}url(c,d,v){const S=(k=this.y,G=this.z,W=M_(256*(P=this.x),256*(k=Math.pow(2,G)-k-1),G),ee=M_(256*(P+1),256*(k+1),G),W[0]+","+W[1]+","+ee[0]+","+ee[1]);var P,k,G,W,ee;const ae=function(fe,me,Ce){let Me,Ue="";for(let $e=fe;$e>0;$e--)Me=1<<$e-1,Ue+=(me&Me?1:0)+(Ce&Me?2:0);return Ue}(this.z,this.x,this.y);return c[(this.x+this.y)%c.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(v==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,d>1?"@2x":"").replace(/{quadkey}/g,ae).replace(/{bbox-epsg-3857}/g,S)}isChildOf(c){const d=this.z-c.z;return d>0&&c.x===this.x>>d&&c.y===this.y>>d}getTilePoint(c){const d=Math.pow(2,this.z);return new R((c.x*d-this.x)*Dn,(c.y*d-this.y)*Dn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class F_{constructor(c,d){this.wrap=c,this.canonical=d,this.key=hf(c,d.z,d.z,d.x,d.y)}}class Vo{constructor(c,d,v,S,P){if(c<v)throw new Error(`overscaledZ should be >= z; overscaledZ = ${c}; z = ${v}`);this.overscaledZ=c,this.wrap=d,this.canonical=new P_(v,+S,+P),this.key=hf(d,c,v,S,P)}clone(){return new Vo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)}scaledTo(c){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-c;return c>this.canonical.z?new Vo(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vo(c,this.wrap,c,this.canonical.x>>d,this.canonical.y>>d)}calculateScaledKey(c,d){if(c>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${c}; overscaledZ = ${this.overscaledZ}`);const v=this.canonical.z-c;return c>this.canonical.z?hf(this.wrap*+d,c,this.canonical.z,this.canonical.x,this.canonical.y):hf(this.wrap*+d,c,c,this.canonical.x>>v,this.canonical.y>>v)}isChildOf(c){if(c.wrap!==this.wrap)return!1;const d=this.canonical.z-c.canonical.z;return c.overscaledZ===0||c.overscaledZ<this.overscaledZ&&c.canonical.x===this.canonical.x>>d&&c.canonical.y===this.canonical.y>>d}children(c){if(this.overscaledZ>=c)return[new Vo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const d=this.canonical.z+1,v=2*this.canonical.x,S=2*this.canonical.y;return[new Vo(d,this.wrap,d,v,S),new Vo(d,this.wrap,d,v+1,S),new Vo(d,this.wrap,d,v,S+1),new Vo(d,this.wrap,d,v+1,S+1)]}isLessThan(c){return this.wrap<c.wrap||!(this.wrap>c.wrap)&&(this.overscaledZ<c.overscaledZ||!(this.overscaledZ>c.overscaledZ)&&(this.canonical.x<c.canonical.x||!(this.canonical.x>c.canonical.x)&&this.canonical.y<c.canonical.y))}wrapped(){return new Vo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(c){return new Vo(this.overscaledZ,c,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new F_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(c){return this.canonical.getTilePoint(new Dp(c.x-this.wrap,c.y))}}function hf(h,c,d,v,S){(h*=2)<0&&(h=-1*h-1);const P=1<<d;return(P*P*h+P*S+v).toString(36)+d.toString(36)+c.toString(36)}Nr("CanonicalTileID",P_),Nr("OverscaledTileID",Vo,{omit:["posMatrix"]});class D_{constructor(c,d,v){let S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1,P=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1,k=arguments.length>5&&arguments[5]!==void 0?arguments[5]:1,G=arguments.length>6&&arguments[6]!==void 0?arguments[6]:0;if(this.uid=c,d.height!==d.width)throw new RangeError("DEM tiles must be square");if(v&&!["mapbox","terrarium","custom"].includes(v))return void Xe(`"${v}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=d.height;const W=this.dim=d.height-2;switch(this.data=new Uint32Array(d.data.buffer),v){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=S,this.greenFactor=P,this.blueFactor=k,this.baseShift=G;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let ee=0;ee<W;ee++)this.data[this._idx(-1,ee)]=this.data[this._idx(0,ee)],this.data[this._idx(W,ee)]=this.data[this._idx(W-1,ee)],this.data[this._idx(ee,-1)]=this.data[this._idx(ee,0)],this.data[this._idx(ee,W)]=this.data[this._idx(ee,W-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(W,-1)]=this.data[this._idx(W-1,0)],this.data[this._idx(-1,W)]=this.data[this._idx(0,W-1)],this.data[this._idx(W,W)]=this.data[this._idx(W-1,W-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let ee=0;ee<W;ee++)for(let ae=0;ae<W;ae++){const fe=this.get(ee,ae);fe>this.max&&(this.max=fe),fe<this.min&&(this.min=fe)}}get(c,d){const v=new Uint8Array(this.data.buffer),S=4*this._idx(c,d);return this.unpack(v[S],v[S+1],v[S+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(c,d){if(c<-1||c>=this.dim+1||d<-1||d>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(d+1)*this.stride+(c+1)}unpack(c,d,v){return c*this.redFactor+d*this.greenFactor+v*this.blueFactor-this.baseShift}getPixels(){return new zo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(c,d,v){if(this.dim!==c.dim)throw new Error("dem dimension mismatch");let S=d*this.dim,P=d*this.dim+this.dim,k=v*this.dim,G=v*this.dim+this.dim;switch(d){case-1:S=P-1;break;case 1:P=S+1}switch(v){case-1:k=G-1;break;case 1:G=k+1}const W=-d*this.dim,ee=-v*this.dim;for(let ae=k;ae<G;ae++)for(let fe=S;fe<P;fe++)this.data[this._idx(fe,ae)]=c.data[this._idx(fe+W,ae+ee)]}}Nr("DEMData",D_);class R_{constructor(c){this._stringToNumber={},this._numberToString=[];for(let d=0;d<c.length;d++){const v=c[d];this._stringToNumber[v]=d,this._numberToString[d]=v}}encode(c){return this._stringToNumber[c]}decode(c){if(c>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${c} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[c]}}class k_{constructor(c,d,v,S,P){this.type="Feature",this._vectorTileFeature=c,c._z=d,c._x=v,c._y=S,this.properties=c.properties,this.id=P}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(c){this._geometry=c}toJSON(){const c={geometry:this.geometry};for(const d in this)d!=="_geometry"&&d!=="_vectorTileFeature"&&(c[d]=this[d]);return c}}class fw{constructor(c,d){this.tileID=c,this.x=c.canonical.x,this.y=c.canonical.y,this.z=c.canonical.z,this.grid=new ta(Dn,16,0),this.grid3D=new ta(Dn,16,0),this.featureIndexArray=new Ie,this.promoteId=d}insert(c,d,v,S,P,k){const G=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(v,S,P);const W=k?this.grid3D:this.grid;for(let ee=0;ee<d.length;ee++){const ae=d[ee],fe=[1/0,1/0,-1/0,-1/0];for(let me=0;me<ae.length;me++){const Ce=ae[me];fe[0]=Math.min(fe[0],Ce.x),fe[1]=Math.min(fe[1],Ce.y),fe[2]=Math.max(fe[2],Ce.x),fe[3]=Math.max(fe[3],Ce.y)}fe[0]<Dn&&fe[1]<Dn&&fe[2]>=0&&fe[3]>=0&&W.insert(G,fe[0],fe[1],fe[2],fe[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new yA.VectorTile(new Om(this.rawTileData)).layers,this.sourceLayerCoder=new R_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(c,d,v,S){this.loadVTLayers();const P=c.params||{},k=Dn/c.tileSize/c.scale,G=pl(P.filter),W=c.queryGeometry,ee=c.queryPadding*k,ae=O_(W),fe=this.grid.query(ae.minX-ee,ae.minY-ee,ae.maxX+ee,ae.maxY+ee),me=O_(c.cameraQueryGeometry),Ce=this.grid3D.query(me.minX-ee,me.minY-ee,me.maxX+ee,me.maxY+ee,($e,Ke,ut,tt)=>function(it,yt,St,Jt,Br){for(const pr of it)if(yt<=pr.x&&St<=pr.y&&Jt>=pr.x&&Br>=pr.y)return!0;const ar=[new R(yt,St),new R(yt,Br),new R(Jt,Br),new R(Jt,St)];if(it.length>2){for(const pr of ar)if(lc(it,pr))return!0}for(let pr=0;pr<it.length-1;pr++)if(dA(it[pr],it[pr+1],ar))return!0;return!1}(c.cameraQueryGeometry,$e-ee,Ke-ee,ut+ee,tt+ee));for(const $e of Ce)fe.push($e);fe.sort(Af);const Me={};let Ue;for(let $e=0;$e<fe.length;$e++){const Ke=fe[$e];if(Ke===Ue)continue;Ue=Ke;const ut=this.featureIndexArray.get(Ke);let tt=null;this.loadMatchingFeature(Me,ut.bucketIndex,ut.sourceLayerIndex,ut.featureIndex,G,P.layers,P.availableImages,d,v,S,(it,yt,St)=>(tt||(tt=wl(it)),yt.queryIntersectsFeature(W,it,St,tt,this.z,c.transform,k,c.pixelPosMatrix)))}return Me}loadMatchingFeature(c,d,v,S,P,k,G,W,ee,ae,fe){const me=this.bucketLayerIDs[d];if(k&&!function($e,Ke){for(let ut=0;ut<$e.length;ut++)if(Ke.indexOf($e[ut])>=0)return!0;return!1}(k,me))return;const Ce=this.sourceLayerCoder.decode(v),Me=this.vtLayers[Ce].feature(S);if(P.needGeometry){const $e=al(Me,!0);if(!P.filter(new Sr(this.tileID.overscaledZ),$e,this.tileID.canonical))return}else if(!P.filter(new Sr(this.tileID.overscaledZ),Me))return;const Ue=this.getId(Me,Ce);for(let $e=0;$e<me.length;$e++){const Ke=me[$e];if(k&&k.indexOf(Ke)<0)continue;const ut=W[Ke];if(!ut)continue;let tt={};Ue&&ae&&(tt=ae.getState(ut.sourceLayer||"_geojsonTileLayer",Ue));const it=Ne({},ee[Ke]);it.paint=pw(it.paint,ut.paint,Me,tt,G),it.layout=pw(it.layout,ut.layout,Me,tt,G);const yt=!fe||fe(Me,ut,tt);if(!yt)continue;const St=new k_(Me,this.z,this.x,this.y,Ue);St.layer=it;let Jt=c[Ke];Jt===void 0&&(Jt=c[Ke]=[]),Jt.push({featureIndex:S,feature:St,intersectionZ:yt})}}lookupSymbolFeatures(c,d,v,S,P,k,G,W){const ee={};this.loadVTLayers();const ae=pl(P);for(const fe of c)this.loadMatchingFeature(ee,v,S,fe,ae,k,G,W,d);return ee}hasLayer(c){for(const d of this.bucketLayerIDs)for(const v of d)if(c===v)return!0;return!1}getId(c,d){let v=c.id;return this.promoteId&&(v=c.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[d]],typeof v=="boolean"&&(v=Number(v))),v}}function pw(h,c,d,v,S){return nt(h,(P,k)=>{const G=c instanceof Wc?c.get(k):null;return G&&G.evaluate?G.evaluate(d,v,S):G})}function O_(h){let c=1/0,d=1/0,v=-1/0,S=-1/0;for(const P of h)c=Math.min(c,P.x),d=Math.min(d,P.y),v=Math.max(v,P.x),S=Math.max(S,P.y);return{minX:c,minY:d,maxX:v,maxY:S}}function Af(h,c){return c-h}function U_(h,c,d,v,S){const P=[];for(let k=0;k<h.length;k++){const G=h[k];let W;for(let ee=0;ee<G.length-1;ee++){let ae=G[ee],fe=G[ee+1];ae.x<c&&fe.x<c||(ae.x<c?ae=new R(c,ae.y+(c-ae.x)/(fe.x-ae.x)*(fe.y-ae.y))._round():fe.x<c&&(fe=new R(c,ae.y+(c-ae.x)/(fe.x-ae.x)*(fe.y-ae.y))._round()),ae.y<d&&fe.y<d||(ae.y<d?ae=new R(ae.x+(d-ae.y)/(fe.y-ae.y)*(fe.x-ae.x),d)._round():fe.y<d&&(fe=new R(ae.x+(d-ae.y)/(fe.y-ae.y)*(fe.x-ae.x),d)._round()),ae.x>=v&&fe.x>=v||(ae.x>=v?ae=new R(v,ae.y+(v-ae.x)/(fe.x-ae.x)*(fe.y-ae.y))._round():fe.x>=v&&(fe=new R(v,ae.y+(v-ae.x)/(fe.x-ae.x)*(fe.y-ae.y))._round()),ae.y>=S&&fe.y>=S||(ae.y>=S?ae=new R(ae.x+(S-ae.y)/(fe.y-ae.y)*(fe.x-ae.x),S)._round():fe.y>=S&&(fe=new R(ae.x+(S-ae.y)/(fe.y-ae.y)*(fe.x-ae.x),S)._round()),W&&ae.equals(W[W.length-1])||(W=[ae],P.push(W)),W.push(fe)))))}}return P}Nr("FeatureIndex",fw,{omit:["rawTileData","sourceLayerCoder"]});class Bu extends R{constructor(c,d,v,S){super(c,d),this.angle=v,S!==void 0&&(this.segment=S)}clone(){return new Bu(this.x,this.y,this.angle,this.segment)}}function N_(h,c,d,v,S){if(c.segment===void 0||d===0)return!0;let P=c,k=c.segment+1,G=0;for(;G>-d/2;){if(k--,k<0)return!1;G-=h[k].dist(P),P=h[k]}G+=h[k].dist(h[k+1]),k++;const W=[];let ee=0;for(;G<d/2;){const ae=h[k],fe=h[k+1];if(!fe)return!1;let me=h[k-1].angleTo(ae)-ae.angleTo(fe);for(me=Math.abs((me+3*Math.PI)%(2*Math.PI)-Math.PI),W.push({distance:G,angleDelta:me}),ee+=me;G-W[0].distance>v;)ee-=W.shift().angleDelta;if(ee>S)return!1;k++,G+=ae.dist(fe)}return!0}function Rp(h){let c=0;for(let d=0;d<h.length-1;d++)c+=h[d].dist(h[d+1]);return c}function kp(h,c,d){return h?.6*c*d:0}function Op(h,c){return Math.max(h?h.right-h.left:0,c?c.right-c.left:0)}function _5(h,c,d,v,S,P){const k=kp(d,S,P),G=Op(d,v)*P;let W=0;const ee=Rp(h)/2;for(let ae=0;ae<h.length-1;ae++){const fe=h[ae],me=h[ae+1],Ce=fe.dist(me);if(W+Ce>ee){const Me=(ee-W)/Ce,Ue=As.number(fe.x,me.x,Me),$e=As.number(fe.y,me.y,Me),Ke=new Bu(Ue,$e,me.angleTo(fe),ae);return Ke._round(),!k||N_(h,Ke,G,k,c)?Ke:void 0}W+=Ce}}function v5(h,c,d,v,S,P,k,G,W){const ee=kp(v,P,k),ae=Op(v,S),fe=ae*k,me=h[0].x===0||h[0].x===W||h[0].y===0||h[0].y===W;return c-fe<c/4&&(c=fe+c/4),gw(h,me?c/2*G%c:(ae/2+2*P)*k*G%c,c,ee,d,fe,me,!1,W)}function gw(h,c,d,v,S,P,k,G,W){const ee=P/2,ae=Rp(h);let fe=0,me=c-d,Ce=[];for(let Me=0;Me<h.length-1;Me++){const Ue=h[Me],$e=h[Me+1],Ke=Ue.dist($e),ut=$e.angleTo(Ue);for(;me+d<fe+Ke;){me+=d;const tt=(me-fe)/Ke,it=As.number(Ue.x,$e.x,tt),yt=As.number(Ue.y,$e.y,tt);if(it>=0&&it<W&&yt>=0&&yt<W&&me-ee>=0&&me+ee<=ae){const St=new Bu(it,yt,ut,Me);St._round(),v&&!N_(h,St,P,v,S)||Ce.push(St)}}fe+=Ke}return G||Ce.length||k||(Ce=gw(h,fe/2,d,v,S,P,k,!0,W)),Ce}Nr("Anchor",Bu);const df=Sl;function sd(h,c,d,v){const S=[],P=h.image,k=P.pixelRatio,G=P.paddedRect.w-2*df,W=P.paddedRect.h-2*df,ee=h.right-h.left,ae=h.bottom-h.top,fe=P.stretchX||[[0,G]],me=P.stretchY||[[0,W]],Ce=(_r,kr)=>_r+kr[1]-kr[0],Me=fe.reduce(Ce,0),Ue=me.reduce(Ce,0),$e=G-Me,Ke=W-Ue;let ut=0,tt=Me,it=0,yt=Ue,St=0,Jt=$e,Br=0,ar=Ke;if(P.content&&v){const _r=P.content;ut=wo(fe,0,_r[0]),it=wo(me,0,_r[1]),tt=wo(fe,_r[0],_r[2]),yt=wo(me,_r[1],_r[3]),St=_r[0]-ut,Br=_r[1]-it,Jt=_r[2]-_r[0]-tt,ar=_r[3]-_r[1]-yt}const pr=(_r,kr,lr,Yt)=>{const jr=ff(_r.stretch-ut,tt,ee,h.left),Vr=Up(_r.fixed-St,Jt,_r.stretch,Me),_i=ff(kr.stretch-it,yt,ae,h.top),Vi=Up(kr.fixed-Br,ar,kr.stretch,Ue),$i=ff(lr.stretch-ut,tt,ee,h.left),gn=Up(lr.fixed-St,Jt,lr.stretch,Me),cs=ff(Yt.stretch-it,yt,ae,h.top),Qn=Up(Yt.fixed-Br,ar,Yt.stretch,Ue),xn=new R(jr,_i),Rn=new R($i,_i),hn=new R($i,cs),Bi=new R(jr,cs),Vn=new R(Vr/k,Vi/k),An=new R(gn/k,Qn/k),rn=c*Math.PI/180;if(rn){const xs=Math.sin(rn),ao=Math.cos(rn),Is=[ao,-xs,xs,ao];xn._matMult(Is),Rn._matMult(Is),Bi._matMult(Is),hn._matMult(Is)}const gs=_r.stretch+_r.fixed,Ts=kr.stretch+kr.fixed;return{tl:xn,tr:Rn,bl:Bi,br:hn,tex:{x:P.paddedRect.x+df+gs,y:P.paddedRect.y+df+Ts,w:lr.stretch+lr.fixed-gs,h:Yt.stretch+Yt.fixed-Ts},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vn,pixelOffsetBR:An,minFontScaleX:Jt/k/ee,minFontScaleY:ar/k/ae,isSDF:d}};if(v&&(P.stretchX||P.stretchY)){const _r=kh(fe,$e,Me),kr=kh(me,Ke,Ue);for(let lr=0;lr<_r.length-1;lr++){const Yt=_r[lr],jr=_r[lr+1];for(let Vr=0;Vr<kr.length-1;Vr++)S.push(pr(Yt,kr[Vr],jr,kr[Vr+1]))}}else S.push(pr({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:G+1},{fixed:0,stretch:W+1}));return S}function wo(h,c,d){let v=0;for(const S of h)v+=Math.max(c,Math.min(d,S[1]))-Math.max(c,Math.min(d,S[0]));return v}function kh(h,c,d){const v=[{fixed:-df,stretch:0}];for(const[S,P]of h){const k=v[v.length-1];v.push({fixed:S-k.stretch,stretch:k.stretch}),v.push({fixed:S-k.stretch,stretch:k.stretch+(P-S)})}return v.push({fixed:c+df,stretch:d}),v}function ff(h,c,d,v){return h/c*d+v}function Up(h,c,d,v){return h-c*d/v}class Np{constructor(c,d,v,S,P,k,G,W,ee,ae){if(this.boxStartIndex=c.length,ee){let fe=k.top,me=k.bottom;const Ce=k.collisionPadding;Ce&&(fe-=Ce[1],me+=Ce[3]);let Me=me-fe;Me>0&&(Me=Math.max(10,Me),this.circleDiameter=Me)}else{let fe=k.top*G-W[0],me=k.bottom*G+W[2],Ce=k.left*G-W[3],Me=k.right*G+W[1];const Ue=k.collisionPadding;if(Ue&&(Ce-=Ue[0]*G,fe-=Ue[1]*G,Me+=Ue[2]*G,me+=Ue[3]*G),ae){const $e=new R(Ce,fe),Ke=new R(Me,fe),ut=new R(Ce,me),tt=new R(Me,me),it=ae*Math.PI/180;$e._rotate(it),Ke._rotate(it),ut._rotate(it),tt._rotate(it),Ce=Math.min($e.x,Ke.x,ut.x,tt.x),Me=Math.max($e.x,Ke.x,ut.x,tt.x),fe=Math.min($e.y,Ke.y,ut.y,tt.y),me=Math.max($e.y,Ke.y,ut.y,tt.y)}c.emplaceBack(d.x,d.y,Ce,fe,Me,me,v,S,P)}this.boxEndIndex=c.length}}class z_{constructor(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:b5;if(this.data=c,this.length=this.data.length,this.compare=d,this.length>0)for(let v=(this.length>>1)-1;v>=0;v--)this._down(v)}push(c){this.data.push(c),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const c=this.data[0],d=this.data.pop();return this.length--,this.length>0&&(this.data[0]=d,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:d,compare:v}=this,S=d[c];for(;c>0;){const P=c-1>>1,k=d[P];if(v(S,k)>=0)break;d[c]=k,c=P}d[c]=S}_down(c){const{data:d,compare:v}=this,S=this.length>>1,P=d[c];for(;c<S;){let k=1+(c<<1),G=d[k];const W=k+1;if(W<this.length&&v(d[W],G)<0&&(k=W,G=d[W]),v(G,P)>=0)break;d[c]=G,c=k}d[c]=P}}function b5(h,c){return h<c?-1:h>c?1:0}function mw(h){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,v=1/0,S=1/0,P=-1/0,k=-1/0;const G=h[0];for(let Ce=0;Ce<G.length;Ce++){const Me=G[Ce];(!Ce||Me.x<v)&&(v=Me.x),(!Ce||Me.y<S)&&(S=Me.y),(!Ce||Me.x>P)&&(P=Me.x),(!Ce||Me.y>k)&&(k=Me.y)}const W=Math.min(P-v,k-S);let ee=W/2;const ae=new z_([],yw);if(W===0)return new R(v,S);for(let Ce=v;Ce<P;Ce+=W)for(let Me=S;Me<k;Me+=W)ae.push(new pf(Ce+ee,Me+ee,ee,h));let fe=function(Ce){let Me=0,Ue=0,$e=0;const Ke=Ce[0];for(let ut=0,tt=Ke.length,it=tt-1;ut<tt;it=ut++){const yt=Ke[ut],St=Ke[it],Jt=yt.x*St.y-St.x*yt.y;Ue+=(yt.x+St.x)*Jt,$e+=(yt.y+St.y)*Jt,Me+=3*Jt}return new pf(Ue/Me,$e/Me,0,Ce)}(h),me=ae.length;for(;ae.length;){const Ce=ae.pop();(Ce.d>fe.d||!fe.d)&&(fe=Ce,d&&console.log("found best %d after %d probes",Math.round(1e4*Ce.d)/1e4,me)),Ce.max-fe.d<=c||(ee=Ce.h/2,ae.push(new pf(Ce.p.x-ee,Ce.p.y-ee,ee,h)),ae.push(new pf(Ce.p.x+ee,Ce.p.y-ee,ee,h)),ae.push(new pf(Ce.p.x-ee,Ce.p.y+ee,ee,h)),ae.push(new pf(Ce.p.x+ee,Ce.p.y+ee,ee,h)),me+=4)}return d&&(console.log(`num probes: ${me}`),console.log(`best distance: ${fe.d}`)),fe.p}function yw(h,c){return c.max-h.max}function pf(h,c,d,v){this.p=new R(h,c),this.h=d,this.d=function(S,P){let k=!1,G=1/0;for(let W=0;W<P.length;W++){const ee=P[W];for(let ae=0,fe=ee.length,me=fe-1;ae<fe;me=ae++){const Ce=ee[ae],Me=ee[me];Ce.y>S.y!=Me.y>S.y&&S.x<(Me.x-Ce.x)*(S.y-Ce.y)/(Me.y-Ce.y)+Ce.x&&(k=!k),G=Math.min(G,wm(S,Ce,Me))}}return(k?1:-1)*Math.sqrt(G)}(this.p,v),this.max=this.d+this.h*Math.SQRT2}var oa;s.aq=void 0,(oa=s.aq||(s.aq={}))[oa.center=1]="center",oa[oa.left=2]="left",oa[oa.right=3]="right",oa[oa.top=4]="top",oa[oa.bottom=5]="bottom",oa[oa["top-left"]=6]="top-left",oa[oa["top-right"]=7]="top-right",oa[oa["bottom-left"]=8]="bottom-left",oa[oa["bottom-right"]=9]="bottom-right";const eh=7,zp=Number.POSITIVE_INFINITY;function Q_(h,c){return c[1]!==zp?function(d,v,S){let P=0,k=0;switch(v=Math.abs(v),S=Math.abs(S),d){case"top-right":case"top-left":case"top":k=S-eh;break;case"bottom-right":case"bottom-left":case"bottom":k=-S+eh}switch(d){case"top-right":case"bottom-right":case"right":P=-v;break;case"top-left":case"bottom-left":case"left":P=v}return[P,k]}(h,c[0],c[1]):function(d,v){let S=0,P=0;v<0&&(v=0);const k=v/Math.SQRT2;switch(d){case"top-right":case"top-left":P=k-eh;break;case"bottom-right":case"bottom-left":P=-k+eh;break;case"bottom":P=-v+eh;break;case"top":P=v-eh}switch(d){case"top-right":case"bottom-right":S=-k;break;case"top-left":case"bottom-left":S=k;break;case"left":S=v;break;case"right":S=-v}return[S,P]}(h,c[0])}function gf(h,c,d){var v;const S=h.layout,P=(v=S.get("text-variable-anchor-offset"))===null||v===void 0?void 0:v.evaluate(c,{},d);if(P){const G=P.values,W=[];for(let ee=0;ee<G.length;ee+=2){const ae=W[ee]=G[ee],fe=G[ee+1].map(me=>me*Ss);ae.startsWith("top")?fe[1]-=eh:ae.startsWith("bottom")&&(fe[1]+=eh),W[ee+1]=fe}return new Nn(W)}const k=S.get("text-variable-anchor");if(k){let G;G=h._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[S.get("text-radial-offset").evaluate(c,{},d)*Ss,zp]:S.get("text-offset").evaluate(c,{},d).map(ee=>ee*Ss);const W=[];for(const ee of k)W.push(ee,Q_(ee,G));return new Nn(W)}return null}function Qp(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function _w(h,c,d,v,S,P,k,G,W,ee,ae){let fe=P.textMaxSize.evaluate(c,{});fe===void 0&&(fe=k);const me=h.layers[0].layout,Ce=me.get("icon-offset").evaluate(c,{},ae),Me=Vp(d.horizontal),Ue=k/24,$e=h.tilePixelRatio*Ue,Ke=h.tilePixelRatio*fe/24,ut=h.tilePixelRatio*G,tt=h.tilePixelRatio*me.get("symbol-spacing"),it=me.get("text-padding")*h.tilePixelRatio,yt=function(Yt,jr,Vr){let _i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const Vi=Yt.get("icon-padding").evaluate(jr,{},Vr),$i=Vi&&Vi.values;return[$i[0]*_i,$i[1]*_i,$i[2]*_i,$i[3]*_i]}(me,c,ae,h.tilePixelRatio),St=me.get("text-max-angle")/180*Math.PI,Jt=me.get("text-rotation-alignment")!=="viewport"&&me.get("symbol-placement")!=="point",Br=me.get("icon-rotation-alignment")==="map"&&me.get("symbol-placement")!=="point",ar=me.get("symbol-placement"),pr=tt/2,_r=me.get("icon-text-fit");let kr;v&&_r!=="none"&&(h.allowVerticalPlacement&&d.vertical&&(kr=Qm(v,d.vertical,_r,me.get("icon-text-fit-padding"),Ce,Ue)),Me&&(v=Qm(v,Me,_r,me.get("icon-text-fit-padding"),Ce,Ue)));const lr=(Yt,jr)=>{jr.x<0||jr.x>=Dn||jr.y<0||jr.y>=Dn||function(Vr,_i,Vi,$i,gn,cs,Qn,xn,Rn,hn,Bi,Vn,An,rn,gs,Ts,xs,ao,Is,kn,Si,Qs,fo,po,uc){const Ic=Vr.addToLineVertexArray(_i,Vi);let aa,th,Lc,Mc,Tl=0,Oh=0,qp=0,bw=0,V_=-1,H_=-1;const Uh={};let eu=Zn("");if(Vr.allowVerticalPlacement&&$i.vertical){const Il=xn.layout.get("text-rotate").evaluate(Si,{},po)+90;Lc=new Np(Rn,_i,hn,Bi,Vn,$i.vertical,An,rn,gs,Il),Qn&&(Mc=new Np(Rn,_i,hn,Bi,Vn,Qn,xs,ao,gs,Il))}if(gn){const Il=xn.layout.get("icon-rotate").evaluate(Si,{}),Eu=xn.layout.get("icon-text-fit")!=="none",Kp=sd(gn,Il,fo,Eu),Nh=Qn?sd(Qn,Il,fo,Eu):void 0;th=new Np(Rn,_i,hn,Bi,Vn,gn,xs,ao,!1,Il),Tl=4*Kp.length;const Wp=Vr.iconSizeData;let xA=null;Wp.kind==="source"?(xA=[Yc*xn.layout.get("icon-size").evaluate(Si,{})],xA[0]>Ju&&Xe(`${Vr.layerIds[0]}: Value for "icon-size" is >= ${Pp}. Reduce your "icon-size".`)):Wp.kind==="composite"&&(xA=[Yc*Qs.compositeIconSizes[0].evaluate(Si,{},po),Yc*Qs.compositeIconSizes[1].evaluate(Si,{},po)],(xA[0]>Ju||xA[1]>Ju)&&Xe(`${Vr.layerIds[0]}: Value for "icon-size" is >= ${Pp}. Reduce your "icon-size".`)),Vr.addSymbols(Vr.icon,Kp,xA,kn,Is,Si,s.ai.none,_i,Ic.lineStartIndex,Ic.lineLength,-1,po),V_=Vr.icon.placedSymbolArray.length-1,Nh&&(Oh=4*Nh.length,Vr.addSymbols(Vr.icon,Nh,xA,kn,Is,Si,s.ai.vertical,_i,Ic.lineStartIndex,Ic.lineLength,-1,po),H_=Vr.icon.placedSymbolArray.length-1)}const $p=Object.keys($i.horizontal);for(const Il of $p){const Eu=$i.horizontal[Il];if(!aa){eu=Zn(Eu.text);const Nh=xn.layout.get("text-rotate").evaluate(Si,{},po);aa=new Np(Rn,_i,hn,Bi,Vn,Eu,An,rn,gs,Nh)}const Kp=Eu.positionedLines.length===1;if(qp+=qm(Vr,_i,Eu,cs,xn,gs,Si,Ts,Ic,$i.vertical?s.ai.horizontal:s.ai.horizontalOnly,Kp?$p:[Il],Uh,V_,Qs,po),Kp)break}$i.vertical&&(bw+=qm(Vr,_i,$i.vertical,cs,xn,gs,Si,Ts,Ic,s.ai.vertical,["vertical"],Uh,H_,Qs,po));const xw=aa?aa.boxStartIndex:Vr.collisionBoxArray.length,x5=aa?aa.boxEndIndex:Vr.collisionBoxArray.length,w5=Lc?Lc.boxStartIndex:Vr.collisionBoxArray.length,B5=Lc?Lc.boxEndIndex:Vr.collisionBoxArray.length,za=th?th.boxStartIndex:Vr.collisionBoxArray.length,Pc=th?th.boxEndIndex:Vr.collisionBoxArray.length,od=Mc?Mc.boxStartIndex:Vr.collisionBoxArray.length,Cu=Mc?Mc.boxEndIndex:Vr.collisionBoxArray.length;let Qa=-1;const Fc=(Il,Eu)=>Il&&Il.circleDiameter?Math.max(Il.circleDiameter,Eu):Eu;Qa=Fc(aa,Qa),Qa=Fc(Lc,Qa),Qa=Fc(th,Qa),Qa=Fc(Mc,Qa);const Pz=Qa>-1?1:0;Pz&&(Qa*=uc/Ss),Vr.glyphOffsetArray.length>=nd.MAX_GLYPHS&&Xe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Si.sortKey!==void 0&&Vr.addToSortKeyRanges(Vr.symbolInstances.length,Si.sortKey);const pwe=gf(xn,Si,po),[gwe,mwe]=function(Il,Eu){const Kp=Il.length,Nh=Eu==null?void 0:Eu.values;if((Nh==null?void 0:Nh.length)>0)for(let Wp=0;Wp<Nh.length;Wp+=2){const xA=Nh[Wp+1];Il.emplaceBack(s.aq[Nh[Wp]],xA[0],xA[1])}return[Kp,Il.length]}(Vr.textAnchorOffsets,pwe);Vr.symbolInstances.emplaceBack(_i.x,_i.y,Uh.right>=0?Uh.right:-1,Uh.center>=0?Uh.center:-1,Uh.left>=0?Uh.left:-1,Uh.vertical||-1,V_,H_,eu,xw,x5,w5,B5,za,Pc,od,Cu,hn,qp,bw,Tl,Oh,Pz,0,An,Qa,gwe,mwe)}(h,jr,Yt,d,v,S,kr,h.layers[0],h.collisionBoxArray,c.index,c.sourceLayerIndex,h.index,$e,[it,it,it,it],Jt,W,ut,yt,Br,Ce,c,P,ee,ae,k)};if(ar==="line")for(const Yt of U_(c.geometry,0,0,Dn,Dn)){const jr=v5(Yt,tt,St,d.vertical||Me,v,24,Ke,h.overscaling,Dn);for(const Vr of jr)Me&&Hp(h,Me.text,pr,Vr)||lr(Yt,Vr)}else if(ar==="line-center"){for(const Yt of c.geometry)if(Yt.length>1){const jr=_5(Yt,St,d.vertical||Me,v,24,Ke);jr&&lr(Yt,jr)}}else if(c.type==="Polygon")for(const Yt of r_(c.geometry,0)){const jr=mw(Yt,16);lr(Yt[0],new Bu(jr.x,jr.y,0))}else if(c.type==="LineString")for(const Yt of c.geometry)lr(Yt,new Bu(Yt[0].x,Yt[0].y,0));else if(c.type==="Point")for(const Yt of c.geometry)for(const jr of Yt)lr([jr],new Bu(jr.x,jr.y,0))}function qm(h,c,d,v,S,P,k,G,W,ee,ae,fe,me,Ce,Me){const Ue=function(ut,tt,it,yt,St,Jt,Br,ar){const pr=yt.layout.get("text-rotate").evaluate(Jt,{})*Math.PI/180,_r=[];for(const kr of tt.positionedLines)for(const lr of kr.positionedGlyphs){if(!lr.rect)continue;const Yt=lr.rect||{};let jr=Ip+1,Vr=!0,_i=1,Vi=0;const $i=(St||ar)&&lr.vertical,gn=lr.metrics.advance*lr.scale/2;if(ar&&tt.verticalizable&&(Vi=kr.lineOffset/2-(lr.imageName?-(Ss-lr.metrics.width*lr.scale)/2:(lr.scale-1)*Ss)),lr.imageName){const kn=Br[lr.imageName];Vr=kn.sdf,_i=kn.pixelRatio,jr=Sl/_i}const cs=St?[lr.x+gn,lr.y]:[0,0];let Qn=St?[0,0]:[lr.x+gn+it[0],lr.y+it[1]-Vi],xn=[0,0];$i&&(xn=Qn,Qn=[0,0]);const Rn=lr.metrics.isDoubleResolution?2:1,hn=(lr.metrics.left-jr)*lr.scale-gn+Qn[0],Bi=(-lr.metrics.top-jr)*lr.scale+Qn[1],Vn=hn+Yt.w/Rn*lr.scale/_i,An=Bi+Yt.h/Rn*lr.scale/_i,rn=new R(hn,Bi),gs=new R(Vn,Bi),Ts=new R(hn,An),xs=new R(Vn,An);if($i){const kn=new R(-gn,gn-nf),Si=-Math.PI/2,Qs=Ss/2-gn,fo=new R(5-nf-Qs,-(lr.imageName?Qs:0)),po=new R(...xn);rn._rotateAround(Si,kn)._add(fo)._add(po),gs._rotateAround(Si,kn)._add(fo)._add(po),Ts._rotateAround(Si,kn)._add(fo)._add(po),xs._rotateAround(Si,kn)._add(fo)._add(po)}if(pr){const kn=Math.sin(pr),Si=Math.cos(pr),Qs=[Si,-kn,kn,Si];rn._matMult(Qs),gs._matMult(Qs),Ts._matMult(Qs),xs._matMult(Qs)}const ao=new R(0,0),Is=new R(0,0);_r.push({tl:rn,tr:gs,bl:Ts,br:xs,tex:Yt,writingMode:tt.writingMode,glyphOffset:cs,sectionIndex:lr.sectionIndex,isSDF:Vr,pixelOffsetTL:ao,pixelOffsetBR:Is,minFontScaleX:0,minFontScaleY:0})}return _r}(0,d,G,S,P,k,v,h.allowVerticalPlacement),$e=h.textSizeData;let Ke=null;$e.kind==="source"?(Ke=[Yc*S.layout.get("text-size").evaluate(k,{})],Ke[0]>Ju&&Xe(`${h.layerIds[0]}: Value for "text-size" is >= ${Pp}. Reduce your "text-size".`)):$e.kind==="composite"&&(Ke=[Yc*Ce.compositeTextSizes[0].evaluate(k,{},Me),Yc*Ce.compositeTextSizes[1].evaluate(k,{},Me)],(Ke[0]>Ju||Ke[1]>Ju)&&Xe(`${h.layerIds[0]}: Value for "text-size" is >= ${Pp}. Reduce your "text-size".`)),h.addSymbols(h.text,Ue,Ke,G,P,k,ee,c,W.lineStartIndex,W.lineLength,me,Me);for(const ut of ae)fe[ut]=h.text.placedSymbolArray.length-1;return 4*Ue.length}function Vp(h){for(const c in h)return h[c];return null}function Hp(h,c,d,v){const S=h.compareText;if(c in S){const P=S[c];for(let k=P.length-1;k>=0;k--)if(v.dist(P[k])<d)return!0}else S[c]=[];return S[c].push(v),!1}const $m=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Gp{static from(c){if(!(c instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[d,v]=new Uint8Array(c,0,2);if(d!==219)throw new Error("Data does not appear to be in a KDBush format.");const S=v>>4;if(S!==1)throw new Error(`Got v${S} data when expected v1.`);const P=$m[15&v];if(!P)throw new Error("Unrecognized array type.");const[k]=new Uint16Array(c,2,1),[G]=new Uint32Array(c,4,1);return new Gp(G,k,P,c)}constructor(c){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,S=arguments.length>3?arguments[3]:void 0;if(isNaN(c)||c<0)throw new Error(`Unpexpected numItems value: ${c}.`);this.numItems=+c,this.nodeSize=Math.min(Math.max(+d,2),65535),this.ArrayType=v,this.IndexArrayType=c<65536?Uint16Array:Uint32Array;const P=$m.indexOf(this.ArrayType),k=2*c*this.ArrayType.BYTES_PER_ELEMENT,G=c*this.IndexArrayType.BYTES_PER_ELEMENT,W=(8-G%8)%8;if(P<0)throw new Error(`Unexpected typed array class: ${v}.`);S&&S instanceof ArrayBuffer?(this.data=S,this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+G+W,2*c),this._pos=2*c,this._finished=!0):(this.data=new ArrayBuffer(8+k+G+W),this.ids=new this.IndexArrayType(this.data,8,c),this.coords=new this.ArrayType(this.data,8+G+W,2*c),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+P]),new Uint16Array(this.data,2,1)[0]=d,new Uint32Array(this.data,4,1)[0]=c)}add(c,d){const v=this._pos>>1;return this.ids[v]=v,this.coords[this._pos++]=c,this.coords[this._pos++]=d,v}finish(){const c=this._pos>>1;if(c!==this.numItems)throw new Error(`Added ${c} items when expected ${this.numItems}.`);return jp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(c,d,v,S){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:P,coords:k,nodeSize:G}=this,W=[0,P.length-1,0],ee=[];for(;W.length;){const ae=W.pop()||0,fe=W.pop()||0,me=W.pop()||0;if(fe-me<=G){for(let $e=me;$e<=fe;$e++){const Ke=k[2*$e],ut=k[2*$e+1];Ke>=c&&Ke<=v&&ut>=d&&ut<=S&&ee.push(P[$e])}continue}const Ce=me+fe>>1,Me=k[2*Ce],Ue=k[2*Ce+1];Me>=c&&Me<=v&&Ue>=d&&Ue<=S&&ee.push(P[Ce]),(ae===0?c<=Me:d<=Ue)&&(W.push(me),W.push(Ce-1),W.push(1-ae)),(ae===0?v>=Me:S>=Ue)&&(W.push(Ce+1),W.push(fe),W.push(1-ae))}return ee}within(c,d,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:P,nodeSize:k}=this,G=[0,S.length-1,0],W=[],ee=v*v;for(;G.length;){const ae=G.pop()||0,fe=G.pop()||0,me=G.pop()||0;if(fe-me<=k){for(let $e=me;$e<=fe;$e++)m(P[2*$e],P[2*$e+1],c,d)<=ee&&W.push(S[$e]);continue}const Ce=me+fe>>1,Me=P[2*Ce],Ue=P[2*Ce+1];m(Me,Ue,c,d)<=ee&&W.push(S[Ce]),(ae===0?c-v<=Me:d-v<=Ue)&&(G.push(me),G.push(Ce-1),G.push(1-ae)),(ae===0?c+v>=Me:d+v>=Ue)&&(G.push(Ce+1),G.push(fe),G.push(1-ae))}return W}}function jp(h,c,d,v,S,P){if(S-v<=d)return;const k=v+S>>1;vw(h,c,k,v,S,P),jp(h,c,d,v,k-1,1-P),jp(h,c,d,k+1,S,1-P)}function vw(h,c,d,v,S,P){for(;S>v;){if(S-v>600){const ee=S-v+1,ae=d-v+1,fe=Math.log(ee),me=.5*Math.exp(2*fe/3),Ce=.5*Math.sqrt(fe*me*(ee-me)/ee)*(ae-ee/2<0?-1:1);vw(h,c,d,Math.max(v,Math.floor(d-ae*me/ee+Ce)),Math.min(S,Math.floor(d+(ee-ae)*me/ee+Ce)),P)}const k=c[2*d+P];let G=v,W=S;for(f(h,c,v,d),c[2*S+P]>k&&f(h,c,v,S);G<W;){for(f(h,c,G,W),G++,W--;c[2*G+P]<k;)G++;for(;c[2*W+P]>k;)W--}c[2*v+P]===k?f(h,c,v,W):(W++,f(h,c,W,S)),W<=d&&(v=W+1),d<=W&&(S=W-1)}}function f(h,c,d,v){u(h,d,v),u(c,2*d,2*v),u(c,2*d+1,2*v+1)}function u(h,c,d){const v=h[c];h[c]=h[d],h[d]=v}function m(h,c,d,v){const S=h-d,P=c-v;return S*S+P*P}var C;s.bh=void 0,(C=s.bh||(s.bh={})).create="create",C.load="load",C.fullLoad="fullLoad";let D=null,Q=[];const H=1e3/60,X="loadTime",ie="fullLoadTime",de={mark(h){performance.mark(h)},frame(h){const c=h;D!=null&&Q.push(c-D),D=c},clearMetrics(){D=null,Q=[],performance.clearMeasures(X),performance.clearMeasures(ie);for(const h in s.bh)performance.clearMarks(s.bh[h])},getPerformanceMetrics(){performance.measure(X,s.bh.create,s.bh.load),performance.measure(ie,s.bh.create,s.bh.fullLoad);const h=performance.getEntriesByName(X)[0].duration,c=performance.getEntriesByName(ie)[0].duration,d=Q.length,v=1/(Q.reduce((P,k)=>P+k,0)/d/1e3),S=Q.filter(P=>P>H).reduce((P,k)=>P+(k-H)/H,0);return{loadTime:h,fullLoadTime:c,fps:v,percentDroppedFrames:S/(d+S)*100,totalFrames:d}}};s.$=function(h,c,d){var v,S,P,k,G,W,ee,ae,fe,me,Ce,Me,Ue=d[0],$e=d[1],Ke=d[2];return c===h?(h[12]=c[0]*Ue+c[4]*$e+c[8]*Ke+c[12],h[13]=c[1]*Ue+c[5]*$e+c[9]*Ke+c[13],h[14]=c[2]*Ue+c[6]*$e+c[10]*Ke+c[14],h[15]=c[3]*Ue+c[7]*$e+c[11]*Ke+c[15]):(S=c[1],P=c[2],k=c[3],G=c[4],W=c[5],ee=c[6],ae=c[7],fe=c[8],me=c[9],Ce=c[10],Me=c[11],h[0]=v=c[0],h[1]=S,h[2]=P,h[3]=k,h[4]=G,h[5]=W,h[6]=ee,h[7]=ae,h[8]=fe,h[9]=me,h[10]=Ce,h[11]=Me,h[12]=v*Ue+G*$e+fe*Ke+c[12],h[13]=S*Ue+W*$e+me*Ke+c[13],h[14]=P*Ue+ee*$e+Ce*Ke+c[14],h[15]=k*Ue+ae*$e+Me*Ke+c[15]),h},s.A=Jc,s.B=As,s.C=class{constructor(h,c,d){this.receive=v=>{const S=v.data,P=S.id;if(P&&(!S.targetMapId||this.mapId===S.targetMapId))if(S.type==="<cancel>"){delete this.tasks[P];const k=this.cancelCallbacks[P];delete this.cancelCallbacks[P],k&&k()}else Pt()||S.mustQueue?(this.tasks[P]=S,this.taskQueue.push(P),this.invoker.trigger()):this.processTask(P,S)},this.process=()=>{if(!this.taskQueue.length)return;const v=this.taskQueue.shift(),S=this.tasks[v];delete this.tasks[v],this.taskQueue.length&&this.invoker.trigger(),S&&this.processTask(v,S)},this.target=h,this.parent=c,this.mapId=d,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new Hm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Pt()?h:window}send(h,c,d,v){let S=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;const P=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(this.callbacks[P]=d);const k=[],G={id:P,type:h,hasCallback:!!d,targetMapId:v,mustQueue:S,sourceMapId:this.mapId,data:Rr(c,k)};return this.target.postMessage(G,{transfer:k}),{cancel:()=>{d&&delete this.callbacks[P],this.target.postMessage({id:P,type:"<cancel>",targetMapId:v,sourceMapId:this.mapId})}}}processTask(h,c){if(c.type==="<response>"){const d=this.callbacks[h];delete this.callbacks[h],d&&(c.error?d(yl(c.error)):d(null,yl(c.data)))}else{let d=!1;const v=[],S=c.hasCallback?(G,W)=>{d=!0,delete this.cancelCallbacks[h];const ee={id:h,type:"<response>",sourceMapId:this.mapId,error:G?Rr(G):null,data:Rr(W,v)};this.target.postMessage(ee,{transfer:v})}:G=>{d=!0};let P=null;const k=yl(c.data);if(this.parent[c.type])P=this.parent[c.type](c.sourceMapId,k,S);else if("getWorkerSource"in this.parent){const G=c.type.split(".");P=this.parent.getWorkerSource(c.sourceMapId,G[0],k.source)[G[1]](k,S)}else S(new Error(`Could not find function ${c.type}`));!d&&P&&P.cancel&&(this.cancelCallbacks[h]=P.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.D=Kr,s.E=tr,s.F=function(h,c){const d={};for(let v=0;v<c.length;v++){const S=c[v];S in h&&(d[S]=h[S])}return d},s.G=uf,s.H=T_,s.I=Um,s.J=pe,s.K=be,s.L=Yu,s.M=Zt,s.N=Dn,s.O=Vo,s.P=R,s.Q=Fn,s.R=zo,s.S=hr,s.T=Kc,s.U=Dp,s.V=class extends Oa{},s.W=P_,s.X=function(h,c){const d=window.document.createElement("video");d.muted=!0,d.onloadstart=function(){c(null,d)};for(let v=0;v<h.length;v++){const S=window.document.createElement("source");Fr(h[v])||(d.crossOrigin="Anonymous"),S.src=h[v],d.appendChild(S)}return{cancel:()=>{}}},s.Y=Wt,s.Z=function(){var h=new Jc(16);return Jc!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},s._=g,s.a=Rt,s.a$=class extends L{},s.a0=function(h,c,d){var v=d[0],S=d[1],P=d[2];return h[0]=c[0]*v,h[1]=c[1]*v,h[2]=c[2]*v,h[3]=c[3]*v,h[4]=c[4]*S,h[5]=c[5]*S,h[6]=c[6]*S,h[7]=c[7]*S,h[8]=c[8]*P,h[9]=c[9]*P,h[10]=c[10]*P,h[11]=c[11]*P,h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15],h},s.a1=pA,s.a2=function(){return at++},s.a3=E,s.a4=nd,s.a5=function(){no.isLoading()||no.isLoaded()||Gu()!=="deferred"||xa()},s.a6=pl,s.a7=al,s.a8=Sr,s.a9=k_,s.aA=vl,s.aB=function(h){h=h.slice();const c=Object.create(null);for(let d=0;d<h.length;d++)c[h[d].id]=h[d];for(let d=0;d<h.length;d++)"ref"in h[d]&&(h[d]=or(h[d],c[h[d].ref]));return h},s.aC=function(h){if(h.type==="custom")return new E_(h);switch(h.type){case"background":return new hw(h);case"circle":return new Cl(h);case"fill":return new i5(h);case"fill-extrusion":return new Qx(h);case"heatmap":return new Na(h);case"hillshade":return new Wd(h);case"line":return new xo(h);case"raster":return new dw(h);case"symbol":return new cf(h)}},s.aD=De,s.aE=function(h,c){if(!h)return[{command:ur.setStyle,args:[c]}];let d=[];try{if(!mr(h.version,c.version))return[{command:ur.setStyle,args:[c]}];mr(h.center,c.center)||d.push({command:ur.setCenter,args:[c.center]}),mr(h.zoom,c.zoom)||d.push({command:ur.setZoom,args:[c.zoom]}),mr(h.bearing,c.bearing)||d.push({command:ur.setBearing,args:[c.bearing]}),mr(h.pitch,c.pitch)||d.push({command:ur.setPitch,args:[c.pitch]}),mr(h.sprite,c.sprite)||d.push({command:ur.setSprite,args:[c.sprite]}),mr(h.glyphs,c.glyphs)||d.push({command:ur.setGlyphs,args:[c.glyphs]}),mr(h.transition,c.transition)||d.push({command:ur.setTransition,args:[c.transition]}),mr(h.light,c.light)||d.push({command:ur.setLight,args:[c.light]});const v={},S=[];(function(k,G,W,ee){let ae;for(ae in G=G||{},k=k||{})Object.prototype.hasOwnProperty.call(k,ae)&&(Object.prototype.hasOwnProperty.call(G,ae)||ri(ae,W,ee));for(ae in G)Object.prototype.hasOwnProperty.call(G,ae)&&(Object.prototype.hasOwnProperty.call(k,ae)?mr(k[ae],G[ae])||(k[ae].type==="geojson"&&G[ae].type==="geojson"&&Pi(k,G,ae)?W.push({command:ur.setGeoJSONSourceData,args:[ae,G[ae].data]}):gi(ae,G,W,ee)):Wr(ae,G,W))})(h.sources,c.sources,S,v);const P=[];h.layers&&h.layers.forEach(k=>{v[k.source]?d.push({command:ur.removeLayer,args:[k.id]}):P.push(k)}),d=d.concat(S),function(k,G,W){G=G||[];const ee=(k=k||[]).map(Xr),ae=G.map(Xr),fe=k.reduce(Ar,{}),me=G.reduce(Ar,{}),Ce=ee.slice(),Me=Object.create(null);let Ue,$e,Ke,ut,tt,it,yt;for(Ue=0,$e=0;Ue<ee.length;Ue++)Ke=ee[Ue],Object.prototype.hasOwnProperty.call(me,Ke)?$e++:(W.push({command:ur.removeLayer,args:[Ke]}),Ce.splice(Ce.indexOf(Ke,$e),1));for(Ue=0,$e=0;Ue<ae.length;Ue++)Ke=ae[ae.length-1-Ue],Ce[Ce.length-1-Ue]!==Ke&&(Object.prototype.hasOwnProperty.call(fe,Ke)?(W.push({command:ur.removeLayer,args:[Ke]}),Ce.splice(Ce.lastIndexOf(Ke,Ce.length-$e),1)):$e++,it=Ce[Ce.length-Ue],W.push({command:ur.addLayer,args:[me[Ke],it]}),Ce.splice(Ce.length-Ue,0,Ke),Me[Ke]=!0);for(Ue=0;Ue<ae.length;Ue++)if(Ke=ae[Ue],ut=fe[Ke],tt=me[Ke],!Me[Ke]&&!mr(ut,tt))if(mr(ut.source,tt.source)&&mr(ut["source-layer"],tt["source-layer"])&&mr(ut.type,tt.type)){for(yt in zt(ut.layout,tt.layout,W,Ke,null,ur.setLayoutProperty),zt(ut.paint,tt.paint,W,Ke,null,ur.setPaintProperty),mr(ut.filter,tt.filter)||W.push({command:ur.setFilter,args:[Ke,tt.filter]}),mr(ut.minzoom,tt.minzoom)&&mr(ut.maxzoom,tt.maxzoom)||W.push({command:ur.setLayerZoomRange,args:[Ke,tt.minzoom,tt.maxzoom]}),ut)Object.prototype.hasOwnProperty.call(ut,yt)&&yt!=="layout"&&yt!=="paint"&&yt!=="filter"&&yt!=="metadata"&&yt!=="minzoom"&&yt!=="maxzoom"&&(yt.indexOf("paint.")===0?zt(ut[yt],tt[yt],W,Ke,yt.slice(6),ur.setPaintProperty):mr(ut[yt],tt[yt])||W.push({command:ur.setLayerProperty,args:[Ke,yt,tt[yt]]}));for(yt in tt)Object.prototype.hasOwnProperty.call(tt,yt)&&!Object.prototype.hasOwnProperty.call(ut,yt)&&yt!=="layout"&&yt!=="paint"&&yt!=="filter"&&yt!=="metadata"&&yt!=="minzoom"&&yt!=="maxzoom"&&(yt.indexOf("paint.")===0?zt(ut[yt],tt[yt],W,Ke,yt.slice(6),ur.setPaintProperty):mr(ut[yt],tt[yt])||W.push({command:ur.setLayerProperty,args:[Ke,yt,tt[yt]]}))}else W.push({command:ur.removeLayer,args:[Ke]}),it=Ce[Ce.lastIndexOf(Ke)+1],W.push({command:ur.addLayer,args:[tt,it]})}(P,c.layers,d)}catch(v){console.warn("Unable to compute style diff:",v),d=[{command:ur.setStyle,args:[c]}]}return d},s.aF=function(h){const c=[],d=h.id;return d===void 0&&c.push({message:`layers.${d}: missing required property "id"`}),h.render===void 0&&c.push({message:`layers.${d}: missing required method "render"`}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&c.push({message:`layers.${d}: property "renderingMode" must be either "2d" or "3d"`}),c},s.aG=function h(c,d){if(Array.isArray(c)){if(!Array.isArray(d)||c.length!==d.length)return!1;for(let v=0;v<c.length;v++)if(!h(c[v],d[v]))return!1;return!0}if(typeof c=="object"&&c!==null&&d!==null){if(typeof d!="object"||Object.keys(c).length!==Object.keys(d).length)return!1;for(const v in c)if(!h(c[v],d[v]))return!1;return!0}return c===d},s.aH=nt,s.aI=ke,s.aJ=$c,s.aK=function(h){return h({pluginStatus:Os,pluginURL:Ro}),$c.on("pluginStateChange",h),h},s.aL=class extends zi{constructor(h,c){super(h,c),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}},s.aM=on,s.aN=class extends zi{constructor(h,c){super(h,c),this.current=is}set(h){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let c=1;c<16;c++)if(h[c]!==this.current[c]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}},s.aO=rs,s.aP=class extends zi{constructor(h,c){super(h,c),this.current=[0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2]))}},s.aQ=class extends zi{constructor(h,c){super(h,c),this.current=[0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1]))}},s.aR=an,s.aS=function(h,c,d,v,S,P,k){var G=1/(c-d),W=1/(v-S),ee=1/(P-k);return h[0]=-2*G,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*W,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*ee,h[11]=0,h[12]=(c+d)*G,h[13]=(S+v)*W,h[14]=(k+P)*ee,h[15]=1,h},s.aT=fi,s.aU=$d,s.aV=class extends M{},s.aW=Xx,s.aX=class extends z{},s.aY=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},s.aZ=gA,s.a_=ve,s.aa=function(h){const c={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(d,v,S,P)=>{const k=S||P;return c[v]=!k||k.toLowerCase(),""}),c["max-age"]){const d=parseInt(c["max-age"],10);isNaN(d)?delete c["max-age"]:c["max-age"]=d}return c},s.ab=function(h,c){const d=[];for(const v in h)v in c||d.push(v);return d},s.ac=function(h){if(bt==null){const c=h.navigator?h.navigator.userAgent:null;bt=!!h.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return bt},s.ad=je,s.ae=function(h,c,d){var v=Math.sin(d),S=Math.cos(d),P=c[0],k=c[1],G=c[2],W=c[3],ee=c[4],ae=c[5],fe=c[6],me=c[7];return c!==h&&(h[8]=c[8],h[9]=c[9],h[10]=c[10],h[11]=c[11],h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15]),h[0]=P*S+ee*v,h[1]=k*S+ae*v,h[2]=G*S+fe*v,h[3]=W*S+me*v,h[4]=ee*S-P*v,h[5]=ae*S-k*v,h[6]=fe*S-G*v,h[7]=me*S-W*v,h},s.af=function(h){var c=new Jc(16);return c[0]=h[0],c[1]=h[1],c[2]=h[2],c[3]=h[3],c[4]=h[4],c[5]=h[5],c[6]=h[6],c[7]=h[7],c[8]=h[8],c[9]=h[9],c[10]=h[10],c[11]=h[11],c[12]=h[12],c[13]=h[13],c[14]=h[14],c[15]=h[15],c},s.ag=wu,s.ah=function(h,c){let d=0,v=0;if(h.kind==="constant")v=h.layoutSize;else if(h.kind!=="source"){const{interpolationType:S,minZoom:P,maxZoom:k}=h,G=S?je(En.interpolationFactor(S,c,P,k),0,1):0;h.kind==="camera"?v=As.number(h.minSize,h.maxSize,G):d=G}return{uSizeT:d,uSize:v}},s.aj=function(h,c,d){let{uSize:v,uSizeT:S}=c,{lowerSize:P,upperSize:k}=d;return h.kind==="source"?P/Yc:h.kind==="composite"?As.number(P/Yc,k/Yc,S):v},s.ak=lf,s.al=function(h,c,d,v){const S=c.y-h.y,P=c.x-h.x,k=v.y-d.y,G=v.x-d.x,W=k*P-G*S;if(W===0)return null;const ee=(G*(h.y-d.y)-k*(h.x-d.x))/W;return new R(h.x+ee*P,h.y+ee*S)},s.am=U_,s.an=Zc,s.ao=qd,s.ap=Ss,s.ar=Vm,s.as=function(h,c){var d=c[0],v=c[1],S=c[2],P=c[3],k=c[4],G=c[5],W=c[6],ee=c[7],ae=c[8],fe=c[9],me=c[10],Ce=c[11],Me=c[12],Ue=c[13],$e=c[14],Ke=c[15],ut=d*G-v*k,tt=d*W-S*k,it=d*ee-P*k,yt=v*W-S*G,St=v*ee-P*G,Jt=S*ee-P*W,Br=ae*Ue-fe*Me,ar=ae*$e-me*Me,pr=ae*Ke-Ce*Me,_r=fe*$e-me*Ue,kr=fe*Ke-Ce*Ue,lr=me*Ke-Ce*$e,Yt=ut*lr-tt*kr+it*_r+yt*pr-St*ar+Jt*Br;return Yt?(h[0]=(G*lr-W*kr+ee*_r)*(Yt=1/Yt),h[1]=(S*kr-v*lr-P*_r)*Yt,h[2]=(Ue*Jt-$e*St+Ke*yt)*Yt,h[3]=(me*St-fe*Jt-Ce*yt)*Yt,h[4]=(W*pr-k*lr-ee*ar)*Yt,h[5]=(d*lr-S*pr+P*ar)*Yt,h[6]=($e*it-Me*Jt-Ke*tt)*Yt,h[7]=(ae*Jt-me*it+Ce*tt)*Yt,h[8]=(k*kr-G*pr+ee*Br)*Yt,h[9]=(v*pr-d*kr-P*Br)*Yt,h[10]=(Me*St-Ue*it+Ke*ut)*Yt,h[11]=(fe*it-ae*St-Ce*ut)*Yt,h[12]=(G*ar-k*_r-W*Br)*Yt,h[13]=(d*_r-v*ar+S*Br)*Yt,h[14]=(Ue*tt-Me*yt-$e*ut)*Yt,h[15]=(ae*yt-fe*tt+me*ut)*Yt,h):null},s.at=Qp,s.au=v_,s.av=Gp,s.aw=function(){const h={},c=ht.$version;for(const d in ht.$root){const v=ht.$root[d];if(v.required){let S=null;S=d==="version"?c:v.type==="array"?[]:{},S!=null&&(h[d]=S)}}return h},s.ax=ur,s.ay=_l,s.az=Mt,s.b=function(h,c){const d=new Blob([new Uint8Array(h)],{type:"image/png"});createImageBitmap(d).then(v=>{c(null,v)}).catch(v=>{c(new Error(`Could not load image because of ${v.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},s.b0=Ht,s.b1=function(h,c){var d=h[0],v=h[1],S=h[2],P=h[3],k=h[4],G=h[5],W=h[6],ee=h[7],ae=h[8],fe=h[9],me=h[10],Ce=h[11],Me=h[12],Ue=h[13],$e=h[14],Ke=h[15],ut=c[0],tt=c[1],it=c[2],yt=c[3],St=c[4],Jt=c[5],Br=c[6],ar=c[7],pr=c[8],_r=c[9],kr=c[10],lr=c[11],Yt=c[12],jr=c[13],Vr=c[14],_i=c[15];return Math.abs(d-ut)<=sa*Math.max(1,Math.abs(d),Math.abs(ut))&&Math.abs(v-tt)<=sa*Math.max(1,Math.abs(v),Math.abs(tt))&&Math.abs(S-it)<=sa*Math.max(1,Math.abs(S),Math.abs(it))&&Math.abs(P-yt)<=sa*Math.max(1,Math.abs(P),Math.abs(yt))&&Math.abs(k-St)<=sa*Math.max(1,Math.abs(k),Math.abs(St))&&Math.abs(G-Jt)<=sa*Math.max(1,Math.abs(G),Math.abs(Jt))&&Math.abs(W-Br)<=sa*Math.max(1,Math.abs(W),Math.abs(Br))&&Math.abs(ee-ar)<=sa*Math.max(1,Math.abs(ee),Math.abs(ar))&&Math.abs(ae-pr)<=sa*Math.max(1,Math.abs(ae),Math.abs(pr))&&Math.abs(fe-_r)<=sa*Math.max(1,Math.abs(fe),Math.abs(_r))&&Math.abs(me-kr)<=sa*Math.max(1,Math.abs(me),Math.abs(kr))&&Math.abs(Ce-lr)<=sa*Math.max(1,Math.abs(Ce),Math.abs(lr))&&Math.abs(Me-Yt)<=sa*Math.max(1,Math.abs(Me),Math.abs(Yt))&&Math.abs(Ue-jr)<=sa*Math.max(1,Math.abs(Ue),Math.abs(jr))&&Math.abs($e-Vr)<=sa*Math.max(1,Math.abs($e),Math.abs(Vr))&&Math.abs(Ke-_i)<=sa*Math.max(1,Math.abs(Ke),Math.abs(_i))},s.b2=function(h,c){return h[0]=c[0],h[1]=c[1],h[2]=c[2],h[3]=c[3],h[4]=c[4],h[5]=c[5],h[6]=c[6],h[7]=c[7],h[8]=c[8],h[9]=c[9],h[10]=c[10],h[11]=c[11],h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15],h},s.b3=function(h,c,d){return h[0]=c[0]*d[0],h[1]=c[1]*d[1],h[2]=c[2]*d[2],h[3]=c[3]*d[3],h},s.b4=function(h,c){return h[0]*c[0]+h[1]*c[1]+h[2]*c[2]+h[3]*c[3]},s.b5=We,s.b6=F_,s.b7=I_,s.b8=function(h,c,d,v,S){var P,k=1/Math.tan(c/2);return h[0]=k/d,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=k,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,S!=null&&S!==1/0?(h[10]=(S+v)*(P=1/(v-S)),h[14]=2*S*v*P):(h[10]=-1,h[14]=-2*v),h},s.b9=function(h,c,d){var v=Math.sin(d),S=Math.cos(d),P=c[4],k=c[5],G=c[6],W=c[7],ee=c[8],ae=c[9],fe=c[10],me=c[11];return c!==h&&(h[0]=c[0],h[1]=c[1],h[2]=c[2],h[3]=c[3],h[12]=c[12],h[13]=c[13],h[14]=c[14],h[15]=c[15]),h[4]=P*S+ee*v,h[5]=k*S+ae*v,h[6]=G*S+fe*v,h[7]=W*S+me*v,h[8]=ee*S-P*v,h[9]=ae*S-k*v,h[10]=fe*S-G*v,h[11]=me*S-W*v,h},s.bA=T,s.bB=d_,s.bC=Di,s.bD=no,s.ba=Te,s.bb=qe,s.bc=function(h,c){return h[0]=c[0],h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=c[1],h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=c[2],h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h},s.bd=class extends Uo{},s.be=Gm,s.bf=L_,s.bg=de,s.bi=Dt,s.bj=function(h,c){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(Os===tc||Os===qc||Os===ol)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ro=mt.resolveURL(h),Os=tc,vn=c,yu(),d||xa()},s.bk=Gu,s.bl=function(h,c){const d={};for(let S=0;S<h.length;S++){const P=c&&c[h[S].id]||Rs(h[S]);c&&(c[h[S].id]=P);let k=d[P];k||(k=d[P]=[]),k.push(h[S])}const v=[];for(const S in d)v.push(d[S]);return v},s.bm=Nr,s.bn=R_,s.bo=fw,s.bp=m_,s.bq=function(h){h.bucket.createArrays(),h.bucket.tilePixelRatio=Dn/(512*h.bucket.overscaling),h.bucket.compareText={},h.bucket.iconsNeedLinear=!1;const c=h.bucket.layers[0],d=c.layout,v=c._unevaluatedLayout._values,S={layoutIconSize:v["icon-size"].possiblyEvaluate(new Sr(h.bucket.zoom+1),h.canonical),layoutTextSize:v["text-size"].possiblyEvaluate(new Sr(h.bucket.zoom+1),h.canonical),textMaxSize:v["text-size"].possiblyEvaluate(new Sr(18))};if(h.bucket.textSizeData.kind==="composite"){const{minZoom:ee,maxZoom:ae}=h.bucket.textSizeData;S.compositeTextSizes=[v["text-size"].possiblyEvaluate(new Sr(ee),h.canonical),v["text-size"].possiblyEvaluate(new Sr(ae),h.canonical)]}if(h.bucket.iconSizeData.kind==="composite"){const{minZoom:ee,maxZoom:ae}=h.bucket.iconSizeData;S.compositeIconSizes=[v["icon-size"].possiblyEvaluate(new Sr(ee),h.canonical),v["icon-size"].possiblyEvaluate(new Sr(ae),h.canonical)]}const P=d.get("text-line-height")*Ss,k=d.get("text-rotation-alignment")!=="viewport"&&d.get("symbol-placement")!=="point",G=d.get("text-keep-upright"),W=d.get("text-size");for(const ee of h.bucket.features){const ae=d.get("text-font").evaluate(ee,{},h.canonical).join(","),fe=W.evaluate(ee,{},h.canonical),me=S.layoutTextSize.evaluate(ee,{},h.canonical),Ce=S.layoutIconSize.evaluate(ee,{},h.canonical),Me={horizontal:{},vertical:void 0},Ue=ee.text;let $e,Ke=[0,0];if(Ue){const it=Ue.toString(),yt=d.get("text-letter-spacing").evaluate(ee,{},h.canonical)*Ss,St=Dr(it)?yt:0,Jt=d.get("text-anchor").evaluate(ee,{},h.canonical),Br=gf(c,ee,h.canonical);if(!Br){const lr=d.get("text-radial-offset").evaluate(ee,{},h.canonical);Ke=lr?Q_(Jt,[lr*Ss,zp]):d.get("text-offset").evaluate(ee,{},h.canonical).map(Yt=>Yt*Ss)}let ar=k?"center":d.get("text-justify").evaluate(ee,{},h.canonical);const pr=d.get("symbol-placement"),_r=pr==="point"?d.get("text-max-width").evaluate(ee,{},h.canonical)*Ss:0,kr=()=>{h.bucket.allowVerticalPlacement&&Cc(it)&&(Me.vertical=of(Ue,h.glyphMap,h.glyphPositions,h.imagePositions,ae,_r,P,Jt,"left",St,Ke,s.ai.vertical,!0,pr,me,fe))};if(!k&&Br){const lr=new Set;if(ar==="auto")for(let jr=0;jr<Br.values.length;jr+=2)lr.add(Qp(Br.values[jr]));else lr.add(ar);let Yt=!1;for(const jr of lr)if(!Me.horizontal[jr])if(Yt)Me.horizontal[jr]=Me.horizontal[0];else{const Vr=of(Ue,h.glyphMap,h.glyphPositions,h.imagePositions,ae,_r,P,"center",jr,St,Ke,s.ai.horizontal,!1,pr,me,fe);Vr&&(Me.horizontal[jr]=Vr,Yt=Vr.positionedLines.length===1)}kr()}else{ar==="auto"&&(ar=Qp(Jt));const lr=of(Ue,h.glyphMap,h.glyphPositions,h.imagePositions,ae,_r,P,Jt,ar,St,Ke,s.ai.horizontal,!1,pr,me,fe);lr&&(Me.horizontal[ar]=lr),kr(),Cc(it)&&k&&G&&(Me.vertical=of(Ue,h.glyphMap,h.glyphPositions,h.imagePositions,ae,_r,P,Jt,ar,St,Ke,s.ai.vertical,!1,pr,me,fe))}}let ut=!1;if(ee.icon&&ee.icon.name){const it=h.imageMap[ee.icon.name];it&&($e=zm(h.imagePositions[ee.icon.name],d.get("icon-offset").evaluate(ee,{},h.canonical),d.get("icon-anchor").evaluate(ee,{},h.canonical)),ut=!!it.sdf,h.bucket.sdfIcons===void 0?h.bucket.sdfIcons=ut:h.bucket.sdfIcons!==ut&&Xe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(it.pixelRatio!==h.bucket.pixelRatio||d.get("icon-rotate").constantOr(1)!==0)&&(h.bucket.iconsNeedLinear=!0))}const tt=Vp(Me.horizontal)||Me.vertical;h.bucket.iconsInText=!!tt&&tt.iconsInText,(tt||$e)&&_w(h.bucket,ee,Me,$e,h.imageMap,S,me,Ce,Ke,ut,h.canonical)}h.showCollisionBoxes&&h.bucket.generateCollisionDebugBuffers()},s.br=u_,s.bs=n_,s.bt=l_,s.bu=class{constructor(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let h=performance.getEntriesByName(this._marks.measure);return h.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),h=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),h}},s.bv=Om,s.bw=yA,s.bx=function(h,c,d,v,S){return g(this,void 0,void 0,function*(){if(be())try{return yield Zt(h,c,d,v,S)}catch{}return function(P,k,G,W,ee){const ae=P.width,fe=P.height;Le&&Ze||(Le=new OffscreenCanvas(ae,fe),Ze=Le.getContext("2d",{willReadFrequently:!0})),Le.width=ae,Le.height=fe,Ze.drawImage(P,0,0,ae,fe);const me=Ze.getImageData(k,G,W,ee);return Ze.clearRect(0,0,ae,fe),me.data}(h,c,d,v,S)})},s.by=D_,s.bz=y,s.c=Bt,s.d=function(h,c){const d=new Image;d.onload=()=>{c(null,d),URL.revokeObjectURL(d.src),d.onload=null,window.requestAnimationFrame(()=>{d.src=Ft})},d.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(h)],{type:"image/png"});d.src=h.byteLength?URL.createObjectURL(v):Ft},s.e=Ne,s.f=function(h,c){return vr(Ne(h,{type:"json"}),c)},s.g=qt,s.h=mt,s.i=Pt,s.j=Ur,s.k=wt,s.l=br,s.m=vr,s.n=function(h){return new Om(h).readFields(Sp,[])},s.o=function(h,c,d){if(!h.length)return d(null,[]);let v=h.length;const S=new Array(h.length);let P=null;h.forEach((k,G)=>{c(k,(W,ee)=>{W&&(P=W),S[G]=ee,--v==0&&d(P,S)})})},s.p=Lp,s.q=Sc,s.r=sn,s.s=Fr,s.t=nn,s.u=Mr,s.v=ht,s.w=Xe,s.x=ka,s.y=tn,s.z=function(h){let[c,d,v]=h;return d+=90,d*=Math.PI/180,v*=Math.PI/180,{x:c*Math.cos(d)*Math.sin(v),y:c*Math.sin(d)*Math.sin(v),z:c*Math.cos(v)}}}),o(["./shared"],function(s){class g{constructor(re){this.keyCache={},re&&this.replace(re)}replace(re){this._layerConfigs={},this._layers={},this.update(re,[])}update(re,Ae){for(const xe of re){this._layerConfigs[xe.id]=xe;const Ee=this._layers[xe.id]=s.aC(xe);Ee._featureFilter=s.a6(Ee.filter),this.keyCache[xe.id]&&delete this.keyCache[xe.id]}for(const xe of Ae)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const ge=s.bl(Object.values(this._layerConfigs),this.keyCache);for(const xe of ge){const Ee=xe.map(vt=>this._layers[vt.id]),we=Ee[0];if(we.visibility==="none")continue;const Fe=we.source||"";let ze=this.familiesBySource[Fe];ze||(ze=this.familiesBySource[Fe]={});const Ge=we.sourceLayer||"_geojsonTileLayer";let st=ze[Ge];st||(st=ze[Ge]=[]),st.push(Ee)}}}class y{constructor(re){const Ae={},ge=[];for(const Fe in re){const ze=re[Fe],Ge=Ae[Fe]={};for(const st in ze){const vt=ze[+st];if(!vt||vt.bitmap.width===0||vt.bitmap.height===0)continue;const Tt={x:0,y:0,w:vt.bitmap.width+2,h:vt.bitmap.height+2};ge.push(Tt),Ge[st]={rect:Tt,metrics:vt.metrics}}}const{w:xe,h:Ee}=s.p(ge),we=new s.q({width:xe||1,height:Ee||1});for(const Fe in re){const ze=re[Fe];for(const Ge in ze){const st=ze[+Ge];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const vt=Ae[Fe][Ge].rect;s.q.copy(st.bitmap,we,{x:0,y:0},{x:vt.x+1,y:vt.y+1},st.bitmap)}}this.image=we,this.positions=Ae}}s.bm("GlyphAtlas",y);class T{constructor(re){this.tileID=new s.O(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.uid=re.uid,this.zoom=re.zoom,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=re.showCollisionBoxes,this.collectResourceTiming=!!re.collectResourceTiming,this.returnDependencies=!!re.returnDependencies,this.promoteId=re.promoteId,this.inFlightDependencies=[],this.dependencySentinel=-1}parse(re,Ae,ge,xe,Ee){this.status="parsing",this.data=re,this.collisionBoxArray=new s.a3;const we=new s.bn(Object.keys(re.layers).sort()),Fe=new s.bo(this.tileID,this.promoteId);Fe.bucketLayerIDs=[];const ze={},Ge={featureIndex:Fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ge},st=Ae.familiesBySource[this.source];for(const zr in st){const ot=re.layers[zr];if(!ot)continue;ot.version===1&&s.w(`Vector tile source "${this.source}" layer "${zr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ir=we.encode(zr),Vt=[];for(let Hr=0;Hr<ot.length;Hr++){const ci=ot.feature(Hr),un=Fe.getId(ci,zr);Vt.push({feature:ci,id:un,index:Hr,sourceLayerIndex:ir})}for(const Hr of st[zr]){const ci=Hr[0];ci.source!==this.source&&s.w(`layer.source = ${ci.source} does not equal this.source = ${this.source}`),ci.minzoom&&this.zoom<Math.floor(ci.minzoom)||ci.maxzoom&&this.zoom>=ci.maxzoom||ci.visibility!=="none"&&(I(Hr,this.zoom,ge),(ze[ci.id]=ci.createBucket({index:Fe.bucketLayerIDs.length,layers:Hr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ir,sourceID:this.source})).populate(Vt,Ge,this.tileID.canonical),Fe.bucketLayerIDs.push(Hr.map(un=>un.id)))}}let vt,Tt,Kt,rr;const Gt=s.aH(Ge.glyphDependencies,zr=>Object.keys(zr).map(Number));this.inFlightDependencies.forEach(zr=>zr==null?void 0:zr.cancel()),this.inFlightDependencies=[];const dr=++this.dependencySentinel;Object.keys(Gt).length?this.inFlightDependencies.push(xe.send("getGlyphs",{uid:this.uid,stacks:Gt,source:this.source,tileID:this.tileID,type:"glyphs"},(zr,ot)=>{dr===this.dependencySentinel&&(vt||(vt=zr,Tt=ot,Er.call(this)))})):Tt={};const Cr=Object.keys(Ge.iconDependencies);Cr.length?this.inFlightDependencies.push(xe.send("getImages",{icons:Cr,source:this.source,tileID:this.tileID,type:"icons"},(zr,ot)=>{dr===this.dependencySentinel&&(vt||(vt=zr,Kt=ot,Er.call(this)))})):Kt={};const Gr=Object.keys(Ge.patternDependencies);function Er(){if(vt)return Ee(vt);if(Tt&&Kt&&rr){const zr=new y(Tt),ot=new s.bp(Kt,rr);for(const ir in ze){const Vt=ze[ir];Vt instanceof s.a4?(I(Vt.layers,this.zoom,ge),s.bq({bucket:Vt,glyphMap:Tt,glyphPositions:zr.positions,imageMap:Kt,imagePositions:ot.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Vt.hasPattern&&(Vt instanceof s.br||Vt instanceof s.bs||Vt instanceof s.bt)&&(I(Vt.layers,this.zoom,ge),Vt.addFeatures(Ge,this.tileID.canonical,ot.patternPositions))}this.status="done",Ee(null,{buckets:Object.values(ze).filter(ir=>!ir.isEmpty()),featureIndex:Fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:zr.image,imageAtlas:ot,glyphMap:this.returnDependencies?Tt:null,iconMap:this.returnDependencies?Kt:null,glyphPositions:this.returnDependencies?zr.positions:null})}}Gr.length?this.inFlightDependencies.push(xe.send("getImages",{icons:Gr,source:this.source,tileID:this.tileID,type:"patterns"},(zr,ot)=>{dr===this.dependencySentinel&&(vt||(vt=zr,rr=ot,Er.call(this)))})):rr={},Er.call(this)}}function I(ue,re,Ae){const ge=new s.a8(re);for(const xe of ue)xe.recalculate(ge,Ae)}function R(ue,re){const Ae=s.l(ue.request,(ge,xe,Ee,we)=>{if(ge)re(ge);else if(xe)try{const Fe=new s.bw.VectorTile(new s.bv(xe));re(null,{vectorTile:Fe,rawData:xe,cacheControl:Ee,expires:we})}catch(Fe){const ze=new Uint8Array(xe);let Ge=`Unable to parse the tile at ${ue.request.url}, `;Ge+=ze[0]===31&&ze[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Fe.messge}`,re(new Error(Ge))}});return()=>{Ae.cancel(),re()}}class U{constructor(re,Ae,ge,xe){this.actor=re,this.layerIndex=Ae,this.availableImages=ge,this.loadVectorData=xe||R,this.fetching={},this.loading={},this.loaded={}}loadTile(re,Ae){const ge=re.uid;this.loading||(this.loading={});const xe=!!(re&&re.request&&re.request.collectResourceTiming)&&new s.bu(re.request),Ee=this.loading[ge]=new T(re);Ee.abort=this.loadVectorData(re,(we,Fe)=>{if(delete this.loading[ge],we||!Fe)return Ee.status="done",this.loaded[ge]=Ee,Ae(we);const ze=Fe.rawData,Ge={};Fe.expires&&(Ge.expires=Fe.expires),Fe.cacheControl&&(Ge.cacheControl=Fe.cacheControl);const st={};if(xe){const vt=xe.finish();vt&&(st.resourceTiming=JSON.parse(JSON.stringify(vt)))}Ee.vectorTile=Fe.vectorTile,Ee.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.actor,(vt,Tt)=>{if(delete this.fetching[ge],vt||!Tt)return Ae(vt);Ae(null,s.e({rawTileData:ze.slice(0)},Tt,Ge,st))}),this.loaded=this.loaded||{},this.loaded[ge]=Ee,this.fetching[ge]={rawTileData:ze,cacheControl:Ge,resourceTiming:st}})}reloadTile(re,Ae){const ge=this.loaded,xe=re.uid;if(ge&&ge[xe]){const Ee=ge[xe];Ee.showCollisionBoxes=re.showCollisionBoxes,Ee.status==="parsing"?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,(we,Fe)=>{if(we||!Fe)return Ae(we,Fe);let ze;if(this.fetching[xe]){const{rawTileData:Ge,cacheControl:st,resourceTiming:vt}=this.fetching[xe];delete this.fetching[xe],ze=s.e({rawTileData:Ge.slice(0)},Fe,st,vt)}else ze=Fe;Ae(null,ze)}):Ee.status==="done"&&(Ee.vectorTile?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,Ae):Ae())}}abortTile(re,Ae){const ge=this.loading,xe=re.uid;ge&&ge[xe]&&ge[xe].abort&&(ge[xe].abort(),delete ge[xe]),Ae()}removeTile(re,Ae){const ge=this.loaded,xe=re.uid;ge&&ge[xe]&&delete ge[xe],Ae()}}class Z{constructor(){this.loaded={}}loadTile(re,Ae){return s._(this,void 0,void 0,function*(){const{uid:ge,encoding:xe,rawImageData:Ee,redFactor:we,greenFactor:Fe,blueFactor:ze,baseShift:Ge}=re,st=Ee.width+2,vt=Ee.height+2,Tt=s.a(Ee)?new s.R({width:st,height:vt},yield s.bx(Ee,-1,-1,st,vt)):Ee,Kt=new s.by(ge,Tt,xe,we,Fe,ze,Ge);this.loaded=this.loaded||{},this.loaded[ge]=Kt,Ae(null,Kt)})}removeTile(re){const Ae=this.loaded,ge=re.uid;Ae&&Ae[ge]&&delete Ae[ge]}}function Y(ue,re){if(ue.length!==0){he(ue[0],re);for(var Ae=1;Ae<ue.length;Ae++)he(ue[Ae],!re)}}function he(ue,re){for(var Ae=0,ge=0,xe=0,Ee=ue.length,we=Ee-1;xe<Ee;we=xe++){var Fe=(ue[xe][0]-ue[we][0])*(ue[we][1]+ue[xe][1]),ze=Ae+Fe;ge+=Math.abs(Ae)>=Math.abs(Fe)?Ae-ze+Fe:Fe-ze+Ae,Ae=ze}Ae+ge>=0!=!!re&&ue.reverse()}var ce=s.bz(function ue(re,Ae){var ge,xe=re&&re.type;if(xe==="FeatureCollection")for(ge=0;ge<re.features.length;ge++)ue(re.features[ge],Ae);else if(xe==="GeometryCollection")for(ge=0;ge<re.geometries.length;ge++)ue(re.geometries[ge],Ae);else if(xe==="Feature")ue(re.geometry,Ae);else if(xe==="Polygon")Y(re.coordinates,Ae);else if(xe==="MultiPolygon")for(ge=0;ge<re.coordinates.length;ge++)Y(re.coordinates[ge],Ae);return re});const pe=s.bw.VectorTileFeature.prototype.toGeoJSON;var be={exports:{}},Te=s.bA,qe=s.bw.VectorTileFeature,je=We;function We(ue,re){this.options=re||{},this.features=ue,this.length=ue.length}function Ne(ue,re){this.id=typeof ue.id=="number"?ue.id:void 0,this.type=ue.type,this.rawGeometry=ue.type===1?[ue.geometry]:ue.geometry,this.properties=ue.tags,this.extent=re||4096}We.prototype.feature=function(ue){return new Ne(this.features[ue],this.options.extent)},Ne.prototype.loadGeometry=function(){var ue=this.rawGeometry;this.geometry=[];for(var re=0;re<ue.length;re++){for(var Ae=ue[re],ge=[],xe=0;xe<Ae.length;xe++)ge.push(new Te(Ae[xe][0],Ae[xe][1]));this.geometry.push(ge)}return this.geometry},Ne.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ue=this.geometry,re=1/0,Ae=-1/0,ge=1/0,xe=-1/0,Ee=0;Ee<ue.length;Ee++)for(var we=ue[Ee],Fe=0;Fe<we.length;Fe++){var ze=we[Fe];re=Math.min(re,ze.x),Ae=Math.max(Ae,ze.x),ge=Math.min(ge,ze.y),xe=Math.max(xe,ze.y)}return[re,ge,Ae,xe]},Ne.prototype.toGeoJSON=qe.prototype.toGeoJSON;var at=s.bB,nt=je;function ke(ue){var re=new at;return function(Ae,ge){for(var xe in Ae.layers)ge.writeMessage(3,De,Ae.layers[xe])}(ue,re),re.finish()}function De(ue,re){var Ae;re.writeVarintField(15,ue.version||1),re.writeStringField(1,ue.name||""),re.writeVarintField(5,ue.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(Ae=0;Ae<ue.length;Ae++)ge.feature=ue.feature(Ae),re.writeMessage(2,Ye,ge);var xe=ge.keys;for(Ae=0;Ae<xe.length;Ae++)re.writeStringField(3,xe[Ae]);var Ee=ge.values;for(Ae=0;Ae<Ee.length;Ae++)re.writeMessage(4,bt,Ee[Ae])}function Ye(ue,re){var Ae=ue.feature;Ae.id!==void 0&&re.writeVarintField(1,Ae.id),re.writeMessage(2,Xe,ue),re.writeVarintField(3,Ae.type),re.writeMessage(4,Pt,Ae)}function Xe(ue,re){var Ae=ue.feature,ge=ue.keys,xe=ue.values,Ee=ue.keycache,we=ue.valuecache;for(var Fe in Ae.properties){var ze=Ae.properties[Fe],Ge=Ee[Fe];if(ze!==null){Ge===void 0&&(ge.push(Fe),Ee[Fe]=Ge=ge.length-1),re.writeVarint(Ge);var st=typeof ze;st!=="string"&&st!=="boolean"&&st!=="number"&&(ze=JSON.stringify(ze));var vt=st+":"+ze,Tt=we[vt];Tt===void 0&&(xe.push(ze),we[vt]=Tt=xe.length-1),re.writeVarint(Tt)}}}function Ct(ue,re){return(re<<3)+(7&ue)}function Et(ue){return ue<<1^ue>>31}function Pt(ue,re){for(var Ae=ue.loadGeometry(),ge=ue.type,xe=0,Ee=0,we=Ae.length,Fe=0;Fe<we;Fe++){var ze=Ae[Fe],Ge=1;ge===1&&(Ge=ze.length),re.writeVarint(Ct(1,Ge));for(var st=ge===3?ze.length-1:ze.length,vt=0;vt<st;vt++){vt===1&&ge!==1&&re.writeVarint(Ct(2,st-1));var Tt=ze[vt].x-xe,Kt=ze[vt].y-Ee;re.writeVarint(Et(Tt)),re.writeVarint(Et(Kt)),xe+=Tt,Ee+=Kt}ge===3&&re.writeVarint(Ct(7,1))}}function bt(ue,re){var Ae=typeof ue;Ae==="string"?re.writeStringField(1,ue):Ae==="boolean"?re.writeBooleanField(7,ue):Ae==="number"&&(ue%1!=0?re.writeDoubleField(3,ue):ue<0?re.writeSVarintField(6,ue):re.writeVarintField(5,ue))}be.exports=ke,be.exports.fromVectorTileJs=ke,be.exports.fromGeojsonVt=function(ue,re){re=re||{};var Ae={};for(var ge in ue)Ae[ge]=new nt(ue[ge].features,re),Ae[ge].name=ge,Ae[ge].version=re.version,Ae[ge].extent=re.extent;return ke({layers:Ae})},be.exports.GeoJSONWrapper=nt;var Rt=s.bz(be.exports);const Ft={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ue=>ue},Zt=Math.fround||(Le=new Float32Array(1),ue=>(Le[0]=+ue,Le[0]));var Le;const Ze=3,rt=5,pt=6;class mt{constructor(re){this.options=Object.assign(Object.create(Ft),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:Ae,minZoom:ge,maxZoom:xe}=this.options;Ae&&console.time("total time");const Ee=`prepare ${re.length} points`;Ae&&console.time(Ee),this.points=re;const we=[];for(let ze=0;ze<re.length;ze++){const Ge=re[ze];if(!Ge.geometry)continue;const[st,vt]=Ge.geometry.coordinates,Tt=Zt(Mt(st)),Kt=Zt(qt(vt));we.push(Tt,Kt,1/0,ze,-1,1),this.options.reduce&&we.push(0)}let Fe=this.trees[xe+1]=this._createTree(we);Ae&&console.timeEnd(Ee);for(let ze=xe;ze>=ge;ze--){const Ge=+Date.now();Fe=this.trees[ze]=this._createTree(this._cluster(Fe,ze)),Ae&&console.log("z%d: %d clusters in %dms",ze,Fe.numItems,+Date.now()-Ge)}return Ae&&console.timeEnd("total time"),this}getClusters(re,Ae){let ge=((re[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,re[1]));let Ee=re[2]===180?180:((re[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)ge=-180,Ee=180;else if(ge>Ee){const vt=this.getClusters([ge,xe,180,we],Ae),Tt=this.getClusters([-180,xe,Ee,we],Ae);return vt.concat(Tt)}const Fe=this.trees[this._limitZoom(Ae)],ze=Fe.range(Mt(ge),qt(we),Mt(Ee),qt(xe)),Ge=Fe.data,st=[];for(const vt of ze){const Tt=this.stride*vt;st.push(Ge[Tt+rt]>1?Bt(Ge,Tt,this.clusterProps):this.points[Ge[Tt+Ze]])}return st}getChildren(re){const Ae=this._getOriginId(re),ge=this._getOriginZoom(re),xe="No cluster with the specified id.",Ee=this.trees[ge];if(!Ee)throw new Error(xe);const we=Ee.data;if(Ae*this.stride>=we.length)throw new Error(xe);const Fe=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),ze=Ee.within(we[Ae*this.stride],we[Ae*this.stride+1],Fe),Ge=[];for(const st of ze){const vt=st*this.stride;we[vt+4]===re&&Ge.push(we[vt+rt]>1?Bt(we,vt,this.clusterProps):this.points[we[vt+Ze]])}if(Ge.length===0)throw new Error(xe);return Ge}getLeaves(re,Ae,ge){const xe=[];return this._appendLeaves(xe,re,Ae=Ae||10,ge=ge||0,0),xe}getTile(re,Ae,ge){const xe=this.trees[this._limitZoom(re)],Ee=Math.pow(2,re),{extent:we,radius:Fe}=this.options,ze=Fe/we,Ge=(ge-ze)/Ee,st=(ge+1+ze)/Ee,vt={features:[]};return this._addTileFeatures(xe.range((Ae-ze)/Ee,Ge,(Ae+1+ze)/Ee,st),xe.data,Ae,ge,Ee,vt),Ae===0&&this._addTileFeatures(xe.range(1-ze/Ee,Ge,1,st),xe.data,Ee,ge,Ee,vt),Ae===Ee-1&&this._addTileFeatures(xe.range(0,Ge,ze/Ee,st),xe.data,-1,ge,Ee,vt),vt.features.length?vt:null}getClusterExpansionZoom(re){let Ae=this._getOriginZoom(re)-1;for(;Ae<=this.options.maxZoom;){const ge=this.getChildren(re);if(Ae++,ge.length!==1)break;re=ge[0].properties.cluster_id}return Ae}_appendLeaves(re,Ae,ge,xe,Ee){const we=this.getChildren(Ae);for(const Fe of we){const ze=Fe.properties;if(ze&&ze.cluster?Ee+ze.point_count<=xe?Ee+=ze.point_count:Ee=this._appendLeaves(re,ze.cluster_id,ge,xe,Ee):Ee<xe?Ee++:re.push(Fe),re.length===ge)break}return Ee}_createTree(re){const Ae=new s.av(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<re.length;ge+=this.stride)Ae.add(re[ge],re[ge+1]);return Ae.finish(),Ae.data=re,Ae}_addTileFeatures(re,Ae,ge,xe,Ee,we){for(const Fe of re){const ze=Fe*this.stride,Ge=Ae[ze+rt]>1;let st,vt,Tt;if(Ge)st=Dt(Ae,ze,this.clusterProps),vt=Ae[ze],Tt=Ae[ze+1];else{const Gt=this.points[Ae[ze+Ze]];st=Gt.properties;const[dr,Cr]=Gt.geometry.coordinates;vt=Mt(dr),Tt=qt(Cr)}const Kt={type:1,geometry:[[Math.round(this.options.extent*(vt*Ee-ge)),Math.round(this.options.extent*(Tt*Ee-xe))]],tags:st};let rr;rr=Ge||this.options.generateId?Ae[ze+Ze]:this.points[Ae[ze+Ze]].id,rr!==void 0&&(Kt.id=rr),we.features.push(Kt)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,Ae){const{radius:ge,extent:xe,reduce:Ee,minPoints:we}=this.options,Fe=ge/(xe*Math.pow(2,Ae)),ze=re.data,Ge=[],st=this.stride;for(let vt=0;vt<ze.length;vt+=st){if(ze[vt+2]<=Ae)continue;ze[vt+2]=Ae;const Tt=ze[vt],Kt=ze[vt+1],rr=re.within(ze[vt],ze[vt+1],Fe),Gt=ze[vt+rt];let dr=Gt;for(const Cr of rr){const Gr=Cr*st;ze[Gr+2]>Ae&&(dr+=ze[Gr+rt])}if(dr>Gt&&dr>=we){let Cr,Gr=Tt*Gt,Er=Kt*Gt,zr=-1;const ot=((vt/st|0)<<5)+(Ae+1)+this.points.length;for(const ir of rr){const Vt=ir*st;if(ze[Vt+2]<=Ae)continue;ze[Vt+2]=Ae;const Hr=ze[Vt+rt];Gr+=ze[Vt]*Hr,Er+=ze[Vt+1]*Hr,ze[Vt+4]=ot,Ee&&(Cr||(Cr=this._map(ze,vt,!0),zr=this.clusterProps.length,this.clusterProps.push(Cr)),Ee(Cr,this._map(ze,Vt)))}ze[vt+4]=ot,Ge.push(Gr/dr,Er/dr,1/0,ot,-1,dr),Ee&&Ge.push(zr)}else{for(let Cr=0;Cr<st;Cr++)Ge.push(ze[vt+Cr]);if(dr>1)for(const Cr of rr){const Gr=Cr*st;if(!(ze[Gr+2]<=Ae)){ze[Gr+2]=Ae;for(let Er=0;Er<st;Er++)Ge.push(ze[Gr+Er])}}}}return Ge}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,Ae,ge){if(re[Ae+rt]>1){const we=this.clusterProps[re[Ae+pt]];return ge?Object.assign({},we):we}const xe=this.points[re[Ae+Ze]].properties,Ee=this.options.map(xe);return ge&&Ee===xe?Object.assign({},Ee):Ee}}function Bt(ue,re,Ae){return{type:"Feature",id:ue[re+Ze],properties:Dt(ue,re,Ae),geometry:{type:"Point",coordinates:[(ge=ue[re],360*(ge-.5)),nr(ue[re+1])]}};var ge}function Dt(ue,re,Ae){const ge=ue[re+rt],xe=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Ee=ue[re+pt],we=Ee===-1?{}:Object.assign({},Ae[Ee]);return Object.assign(we,{cluster:!0,cluster_id:ue[re+Ze],point_count:ge,point_count_abbreviated:xe})}function Mt(ue){return ue/360+.5}function qt(ue){const re=Math.sin(ue*Math.PI/180),Ae=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return Ae<0?0:Ae>1?1:Ae}function nr(ue){const re=(180-360*ue)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}function vr(ue,re,Ae,ge){for(var xe,Ee=ge,we=Ae-re>>1,Fe=Ae-re,ze=ue[re],Ge=ue[re+1],st=ue[Ae],vt=ue[Ae+1],Tt=re+3;Tt<Ae;Tt+=3){var Kt=br(ue[Tt],ue[Tt+1],ze,Ge,st,vt);if(Kt>Ee)xe=Tt,Ee=Kt;else if(Kt===Ee){var rr=Math.abs(Tt-we);rr<Fe&&(xe=Tt,Fe=rr)}}Ee>ge&&(xe-re>3&&vr(ue,re,xe,ge),ue[xe+2]=Ee,Ae-xe>3&&vr(ue,xe,Ae,ge))}function br(ue,re,Ae,ge,xe,Ee){var we=xe-Ae,Fe=Ee-ge;if(we!==0||Fe!==0){var ze=((ue-Ae)*we+(re-ge)*Fe)/(we*we+Fe*Fe);ze>1?(Ae=xe,ge=Ee):ze>0&&(Ae+=we*ze,ge+=Fe*ze)}return(we=ue-Ae)*we+(Fe=re-ge)*Fe}function Fr(ue,re,Ae,ge){var xe={id:ue===void 0?null:ue,type:re,geometry:Ae,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ee){var we=Ee.geometry,Fe=Ee.type;if(Fe==="Point"||Fe==="MultiPoint"||Fe==="LineString")kt(Ee,we);else if(Fe==="Polygon"||Fe==="MultiLineString")for(var ze=0;ze<we.length;ze++)kt(Ee,we[ze]);else if(Fe==="MultiPolygon")for(ze=0;ze<we.length;ze++)for(var Ge=0;Ge<we[ze].length;Ge++)kt(Ee,we[ze][Ge])}(xe),xe}function kt(ue,re){for(var Ae=0;Ae<re.length;Ae+=3)ue.minX=Math.min(ue.minX,re[Ae]),ue.minY=Math.min(ue.minY,re[Ae+1]),ue.maxX=Math.max(ue.maxX,re[Ae]),ue.maxY=Math.max(ue.maxY,re[Ae+1])}function lt(ue,re,Ae,ge){if(re.geometry){var xe=re.geometry.coordinates,Ee=re.geometry.type,we=Math.pow(Ae.tolerance/((1<<Ae.maxZoom)*Ae.extent),2),Fe=[],ze=re.id;if(Ae.promoteId?ze=re.properties[Ae.promoteId]:Ae.generateId&&(ze=ge||0),Ee==="Point")wt(xe,Fe);else if(Ee==="MultiPoint")for(var Ge=0;Ge<xe.length;Ge++)wt(xe[Ge],Fe);else if(Ee==="LineString")Ur(xe,Fe,we,!1);else if(Ee==="MultiLineString"){if(Ae.lineMetrics){for(Ge=0;Ge<xe.length;Ge++)Ur(xe[Ge],Fe=[],we,!1),ue.push(Fr(ze,"LineString",Fe,re.properties));return}tr(xe,Fe,we,!1)}else if(Ee==="Polygon")tr(xe,Fe,we,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(Ge=0;Ge<re.geometry.geometries.length;Ge++)lt(ue,{id:ze,geometry:re.geometry.geometries[Ge],properties:re.properties},Ae,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ge=0;Ge<xe.length;Ge++){var st=[];tr(xe[Ge],st,we,!0),Fe.push(st)}}ue.push(Fr(ze,Ee,Fe,re.properties))}}function wt(ue,re){re.push(ht(ue[0])),re.push($t(ue[1])),re.push(0)}function Ur(ue,re,Ae,ge){for(var xe,Ee,we=0,Fe=0;Fe<ue.length;Fe++){var ze=ht(ue[Fe][0]),Ge=$t(ue[Fe][1]);re.push(ze),re.push(Ge),re.push(0),Fe>0&&(we+=ge?(xe*Ge-ze*Ee)/2:Math.sqrt(Math.pow(ze-xe,2)+Math.pow(Ge-Ee,2))),xe=ze,Ee=Ge}var st=re.length-3;re[2]=1,vr(re,0,st,Ae),re[st+2]=1,re.size=Math.abs(we),re.start=0,re.end=re.size}function tr(ue,re,Ae,ge){for(var xe=0;xe<ue.length;xe++){var Ee=[];Ur(ue[xe],Ee,Ae,ge),re.push(Ee)}}function ht(ue){return ue/360+.5}function $t(ue){var re=Math.sin(ue*Math.PI/180),Ae=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return Ae<0?0:Ae>1?1:Ae}function or(ue,re,Ae,ge,xe,Ee,we,Fe){if(ge/=re,Ee>=(Ae/=re)&&we<ge)return ue;if(we<Ae||Ee>=ge)return null;for(var ze=[],Ge=0;Ge<ue.length;Ge++){var st=ue[Ge],vt=st.geometry,Tt=st.type,Kt=xe===0?st.minX:st.minY,rr=xe===0?st.maxX:st.maxY;if(Kt>=Ae&&rr<ge)ze.push(st);else if(!(rr<Ae||Kt>=ge)){var Gt=[];if(Tt==="Point"||Tt==="MultiPoint")mr(vt,Gt,Ae,ge,xe);else if(Tt==="LineString")ur(vt,Gt,Ae,ge,xe,!1,Fe.lineMetrics);else if(Tt==="MultiLineString")ri(vt,Gt,Ae,ge,xe,!1);else if(Tt==="Polygon")ri(vt,Gt,Ae,ge,xe,!0);else if(Tt==="MultiPolygon")for(var dr=0;dr<vt.length;dr++){var Cr=[];ri(vt[dr],Cr,Ae,ge,xe,!0),Cr.length&&Gt.push(Cr)}if(Gt.length){if(Fe.lineMetrics&&Tt==="LineString"){for(dr=0;dr<Gt.length;dr++)ze.push(Fr(st.id,Tt,Gt[dr],st.tags));continue}Tt!=="LineString"&&Tt!=="MultiLineString"||(Gt.length===1?(Tt="LineString",Gt=Gt[0]):Tt="MultiLineString"),Tt!=="Point"&&Tt!=="MultiPoint"||(Tt=Gt.length===3?"Point":"MultiPoint"),ze.push(Fr(st.id,Tt,Gt,st.tags))}}}return ze.length?ze:null}function mr(ue,re,Ae,ge,xe){for(var Ee=0;Ee<ue.length;Ee+=3){var we=ue[Ee+xe];we>=Ae&&we<=ge&&(re.push(ue[Ee]),re.push(ue[Ee+1]),re.push(ue[Ee+2]))}}function ur(ue,re,Ae,ge,xe,Ee,we){for(var Fe,ze,Ge=Wr(ue),st=xe===0?Pi:zt,vt=ue.start,Tt=0;Tt<ue.length-3;Tt+=3){var Kt=ue[Tt],rr=ue[Tt+1],Gt=ue[Tt+2],dr=ue[Tt+3],Cr=ue[Tt+4],Gr=xe===0?Kt:rr,Er=xe===0?dr:Cr,zr=!1;we&&(Fe=Math.sqrt(Math.pow(Kt-dr,2)+Math.pow(rr-Cr,2))),Gr<Ae?Er>Ae&&(ze=st(Ge,Kt,rr,dr,Cr,Ae),we&&(Ge.start=vt+Fe*ze)):Gr>ge?Er<ge&&(ze=st(Ge,Kt,rr,dr,Cr,ge),we&&(Ge.start=vt+Fe*ze)):gi(Ge,Kt,rr,Gt),Er<Ae&&Gr>=Ae&&(ze=st(Ge,Kt,rr,dr,Cr,Ae),zr=!0),Er>ge&&Gr<=ge&&(ze=st(Ge,Kt,rr,dr,Cr,ge),zr=!0),!Ee&&zr&&(we&&(Ge.end=vt+Fe*ze),re.push(Ge),Ge=Wr(ue)),we&&(vt+=Fe)}var ot=ue.length-3;Kt=ue[ot],rr=ue[ot+1],Gt=ue[ot+2],(Gr=xe===0?Kt:rr)>=Ae&&Gr<=ge&&gi(Ge,Kt,rr,Gt),ot=Ge.length-3,Ee&&ot>=3&&(Ge[ot]!==Ge[0]||Ge[ot+1]!==Ge[1])&&gi(Ge,Ge[0],Ge[1],Ge[2]),Ge.length&&re.push(Ge)}function Wr(ue){var re=[];return re.size=ue.size,re.start=ue.start,re.end=ue.end,re}function ri(ue,re,Ae,ge,xe,Ee){for(var we=0;we<ue.length;we++)ur(ue[we],re,Ae,ge,xe,Ee,!1)}function gi(ue,re,Ae,ge){ue.push(re),ue.push(Ae),ue.push(ge)}function Pi(ue,re,Ae,ge,xe,Ee){var we=(Ee-re)/(ge-re);return ue.push(Ee),ue.push(Ae+(xe-Ae)*we),ue.push(1),we}function zt(ue,re,Ae,ge,xe,Ee){var we=(Ee-Ae)/(xe-Ae);return ue.push(re+(ge-re)*we),ue.push(Ee),ue.push(1),we}function Xr(ue,re){for(var Ae=[],ge=0;ge<ue.length;ge++){var xe,Ee=ue[ge],we=Ee.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")xe=Ar(Ee.geometry,re);else if(we==="MultiLineString"||we==="Polygon"){xe=[];for(var Fe=0;Fe<Ee.geometry.length;Fe++)xe.push(Ar(Ee.geometry[Fe],re))}else if(we==="MultiPolygon")for(xe=[],Fe=0;Fe<Ee.geometry.length;Fe++){for(var ze=[],Ge=0;Ge<Ee.geometry[Fe].length;Ge++)ze.push(Ar(Ee.geometry[Fe][Ge],re));xe.push(ze)}Ae.push(Fr(Ee.id,we,xe,Ee.tags))}return Ae}function Ar(ue,re){var Ae=[];Ae.size=ue.size,ue.start!==void 0&&(Ae.start=ue.start,Ae.end=ue.end);for(var ge=0;ge<ue.length;ge+=3)Ae.push(ue[ge]+re,ue[ge+1],ue[ge+2]);return Ae}function Wt(ue,re){if(ue.transformed)return ue;var Ae,ge,xe,Ee=1<<ue.z,we=ue.x,Fe=ue.y;for(Ae=0;Ae<ue.features.length;Ae++){var ze=ue.features[Ae],Ge=ze.geometry,st=ze.type;if(ze.geometry=[],st===1)for(ge=0;ge<Ge.length;ge+=2)ze.geometry.push(di(Ge[ge],Ge[ge+1],re,Ee,we,Fe));else for(ge=0;ge<Ge.length;ge++){var vt=[];for(xe=0;xe<Ge[ge].length;xe+=2)vt.push(di(Ge[ge][xe],Ge[ge][xe+1],re,Ee,we,Fe));ze.geometry.push(vt)}}return ue.transformed=!0,ue}function di(ue,re,Ae,ge,xe,Ee){return[Math.round(Ae*(ue*ge-xe)),Math.round(Ae*(re*ge-Ee))]}function Qt(ue,re,Ae,ge,xe){for(var Ee=re===xe.maxZoom?0:xe.tolerance/((1<<re)*xe.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ae,y:ge,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Fe=0;Fe<ue.length;Fe++){we.numFeatures++,Tr(we,ue[Fe],Ee,xe);var ze=ue[Fe].minX,Ge=ue[Fe].minY,st=ue[Fe].maxX,vt=ue[Fe].maxY;ze<we.minX&&(we.minX=ze),Ge<we.minY&&(we.minY=Ge),st>we.maxX&&(we.maxX=st),vt>we.maxY&&(we.maxY=vt)}return we}function Tr(ue,re,Ae,ge){var xe=re.geometry,Ee=re.type,we=[];if(Ee==="Point"||Ee==="MultiPoint")for(var Fe=0;Fe<xe.length;Fe+=3)we.push(xe[Fe]),we.push(xe[Fe+1]),ue.numPoints++,ue.numSimplified++;else if(Ee==="LineString")Lr(we,xe,ue,Ae,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(Fe=0;Fe<xe.length;Fe++)Lr(we,xe[Fe],ue,Ae,Ee==="Polygon",Fe===0);else if(Ee==="MultiPolygon")for(var ze=0;ze<xe.length;ze++){var Ge=xe[ze];for(Fe=0;Fe<Ge.length;Fe++)Lr(we,Ge[Fe],ue,Ae,!0,Fe===0)}if(we.length){var st=re.tags||null;if(Ee==="LineString"&&ge.lineMetrics){for(var vt in st={},re.tags)st[vt]=re.tags[vt];st.mapbox_clip_start=xe.start/xe.size,st.mapbox_clip_end=xe.end/xe.size}var Tt={geometry:we,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:st};re.id!==null&&(Tt.id=re.id),ue.features.push(Tt)}}function Lr(ue,re,Ae,ge,xe,Ee){var we=ge*ge;if(ge>0&&re.size<(xe?we:ge))Ae.numPoints+=re.length/3;else{for(var Fe=[],ze=0;ze<re.length;ze+=3)(ge===0||re[ze+2]>we)&&(Ae.numSimplified++,Fe.push(re[ze]),Fe.push(re[ze+1])),Ae.numPoints++;xe&&function(Ge,st){for(var vt=0,Tt=0,Kt=Ge.length,rr=Kt-2;Tt<Kt;rr=Tt,Tt+=2)vt+=(Ge[Tt]-Ge[rr])*(Ge[Tt+1]+Ge[rr+1]);if(vt>0===st)for(Tt=0,Kt=Ge.length;Tt<Kt/2;Tt+=2){var Gt=Ge[Tt],dr=Ge[Tt+1];Ge[Tt]=Ge[Kt-2-Tt],Ge[Tt+1]=Ge[Kt-1-Tt],Ge[Kt-2-Tt]=Gt,Ge[Kt-1-Tt]=dr}}(Fe,Ee),ue.push(Fe)}}function Xt(ue,re){var Ae=(re=this.options=function(xe,Ee){for(var we in Ee)xe[we]=Ee[we];return xe}(Object.create(this.options),re)).debug;if(Ae&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(xe,Ee){var we=[];if(xe.type==="FeatureCollection")for(var Fe=0;Fe<xe.features.length;Fe++)lt(we,xe.features[Fe],Ee,Fe);else lt(we,xe.type==="Feature"?xe:{geometry:xe},Ee);return we}(ue,re);this.tiles={},this.tileCoords=[],Ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ge=function(xe,Ee){var we=Ee.buffer/Ee.extent,Fe=xe,ze=or(xe,1,-1-we,we,0,-1,2,Ee),Ge=or(xe,1,1-we,2+we,0,-1,2,Ee);return(ze||Ge)&&(Fe=or(xe,1,-we,1+we,0,-1,2,Ee)||[],ze&&(Fe=Xr(ze,1).concat(Fe)),Ge&&(Fe=Fe.concat(Xr(Ge,-1)))),Fe}(ge,re),ge.length&&this.splitTile(ge,0,0,0),Ae&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function xr(ue,re,Ae){return 32*((1<<ue)*Ae+re)+ue}function er(ue,re){return re?ue.properties[re]:ue.id}function vi(ue,re){if(ue==null)return!0;if(ue.type==="Feature")return er(ue,re)!=null;if(ue.type==="FeatureCollection"){const Ae=new Set;for(const ge of ue.features){const xe=er(ge,re);if(xe==null||Ae.has(xe))return!1;Ae.add(xe)}return!0}return!1}function Zi(ue,re){const Ae=new Map;if(ue!=null)if(ue.type==="Feature")Ae.set(er(ue,re),ue);else for(const ge of ue.features)Ae.set(er(ge,re),ge);return Ae}Xt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Xt.prototype.splitTile=function(ue,re,Ae,ge,xe,Ee,we){for(var Fe=[ue,re,Ae,ge],ze=this.options,Ge=ze.debug;Fe.length;){ge=Fe.pop(),Ae=Fe.pop(),re=Fe.pop(),ue=Fe.pop();var st=1<<re,vt=xr(re,Ae,ge),Tt=this.tiles[vt];if(!Tt&&(Ge>1&&console.time("creation"),Tt=this.tiles[vt]=Qt(ue,re,Ae,ge,ze),this.tileCoords.push({z:re,x:Ae,y:ge}),Ge)){Ge>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,Ae,ge,Tt.numFeatures,Tt.numPoints,Tt.numSimplified),console.timeEnd("creation"));var Kt="z"+re;this.stats[Kt]=(this.stats[Kt]||0)+1,this.total++}if(Tt.source=ue,xe){if(re===ze.maxZoom||re===xe)continue;var rr=1<<xe-re;if(Ae!==Math.floor(Ee/rr)||ge!==Math.floor(we/rr))continue}else if(re===ze.indexMaxZoom||Tt.numPoints<=ze.indexMaxPoints)continue;if(Tt.source=null,ue.length!==0){Ge>1&&console.time("clipping");var Gt,dr,Cr,Gr,Er,zr,ot=.5*ze.buffer/ze.extent,ir=.5-ot,Vt=.5+ot,Hr=1+ot;Gt=dr=Cr=Gr=null,Er=or(ue,st,Ae-ot,Ae+Vt,0,Tt.minX,Tt.maxX,ze),zr=or(ue,st,Ae+ir,Ae+Hr,0,Tt.minX,Tt.maxX,ze),ue=null,Er&&(Gt=or(Er,st,ge-ot,ge+Vt,1,Tt.minY,Tt.maxY,ze),dr=or(Er,st,ge+ir,ge+Hr,1,Tt.minY,Tt.maxY,ze),Er=null),zr&&(Cr=or(zr,st,ge-ot,ge+Vt,1,Tt.minY,Tt.maxY,ze),Gr=or(zr,st,ge+ir,ge+Hr,1,Tt.minY,Tt.maxY,ze),zr=null),Ge>1&&console.timeEnd("clipping"),Fe.push(Gt||[],re+1,2*Ae,2*ge),Fe.push(dr||[],re+1,2*Ae,2*ge+1),Fe.push(Cr||[],re+1,2*Ae+1,2*ge),Fe.push(Gr||[],re+1,2*Ae+1,2*ge+1)}}},Xt.prototype.getTile=function(ue,re,Ae){var ge=this.options,xe=ge.extent,Ee=ge.debug;if(ue<0||ue>24)return null;var we=1<<ue,Fe=xr(ue,re=(re%we+we)%we,Ae);if(this.tiles[Fe])return Wt(this.tiles[Fe],xe);Ee>1&&console.log("drilling down to z%d-%d-%d",ue,re,Ae);for(var ze,Ge=ue,st=re,vt=Ae;!ze&&Ge>0;)Ge--,st=Math.floor(st/2),vt=Math.floor(vt/2),ze=this.tiles[xr(Ge,st,vt)];return ze&&ze.source?(Ee>1&&console.log("found parent tile z%d-%d-%d",Ge,st,vt),Ee>1&&console.time("drilling down"),this.splitTile(ze.source,Ge,st,vt,ue,re,Ae),Ee>1&&console.timeEnd("drilling down"),this.tiles[Fe]?Wt(this.tiles[Fe],xe):null):null};class Qe extends U{constructor(re,Ae,ge,xe){super(re,Ae,ge),this._dataUpdateable=new Map,this.loadGeoJSON=(Ee,we)=>{const{promoteId:Fe}=Ee;if(Ee.request)return s.f(Ee.request,(ze,Ge,st,vt)=>{this._dataUpdateable=vi(Ge,Fe)?Zi(Ge,Fe):void 0,we(ze,Ge,st,vt)});if(typeof Ee.data=="string")try{const ze=JSON.parse(Ee.data);this._dataUpdateable=vi(ze,Fe)?Zi(ze,Fe):void 0,we(null,ze)}catch{we(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`))}else Ee.dataDiff?this._dataUpdateable?(function(ze,Ge,st){var vt,Tt,Kt,rr;if(Ge.removeAll&&ze.clear(),Ge.remove)for(const Gt of Ge.remove)ze.delete(Gt);if(Ge.add)for(const Gt of Ge.add){const dr=er(Gt,st);dr!=null&&ze.set(dr,Gt)}if(Ge.update)for(const Gt of Ge.update){let dr=ze.get(Gt.id);if(dr==null)continue;const Cr=!Gt.removeAllProperties&&(((vt=Gt.removeProperties)===null||vt===void 0?void 0:vt.length)>0||((Tt=Gt.addOrUpdateProperties)===null||Tt===void 0?void 0:Tt.length)>0);if((Gt.newGeometry||Gt.removeAllProperties||Cr)&&(dr=Object.assign({},dr),ze.set(Gt.id,dr),Cr&&(dr.properties=Object.assign({},dr.properties))),Gt.newGeometry&&(dr.geometry=Gt.newGeometry),Gt.removeAllProperties)dr.properties={};else if(((Kt=Gt.removeProperties)===null||Kt===void 0?void 0:Kt.length)>0)for(const Gr of Gt.removeProperties)Object.prototype.hasOwnProperty.call(dr.properties,Gr)&&delete dr.properties[Gr];if(((rr=Gt.addOrUpdateProperties)===null||rr===void 0?void 0:rr.length)>0)for(const{key:Gr,value:Er}of Gt.addOrUpdateProperties)dr.properties[Gr]=Er}}(this._dataUpdateable,Ee.dataDiff,Fe),we(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):we(new Error(`Cannot update existing geojson data in ${Ee.source}`)):we(new Error(`Input data given to '${Ee.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},this.loadVectorData=this.loadGeoJSONTile,xe&&(this.loadGeoJSON=xe)}loadGeoJSONTile(re,Ae){const ge=re.tileID.canonical;if(!this._geoJSONIndex)return Ae(null,null);const xe=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);if(!xe)return Ae(null,null);const Ee=new class{constructor(Fe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.N,this.length=Fe.length,this._features=Fe}feature(Fe){return new class{constructor(ze){this._feature=ze,this.extent=s.N,this.type=ze.type,this.properties=ze.tags,"id"in ze&&!isNaN(ze.id)&&(this.id=parseInt(ze.id,10))}loadGeometry(){if(this._feature.type===1){const ze=[];for(const Ge of this._feature.geometry)ze.push([new s.P(Ge[0],Ge[1])]);return ze}{const ze=[];for(const Ge of this._feature.geometry){const st=[];for(const vt of Ge)st.push(new s.P(vt[0],vt[1]));ze.push(st)}return ze}}toGeoJSON(ze,Ge,st){return pe.call(this,ze,Ge,st)}}(this._features[Fe])}}(xe.features);let we=Rt(Ee);we.byteOffset===0&&we.byteLength===we.buffer.byteLength||(we=new Uint8Array(we)),Ae(null,{vectorTile:Ee,rawData:we.buffer})}loadData(re,Ae){var ge;(ge=this._pendingRequest)===null||ge===void 0||ge.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const xe=!!(re&&re.request&&re.request.collectResourceTiming)&&new s.bu(re.request);this._pendingCallback=Ae,this._pendingRequest=this.loadGeoJSON(re,(Ee,we)=>{if(delete this._pendingCallback,delete this._pendingRequest,Ee||!we)return Ae(Ee);if(typeof we!="object")return Ae(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));{ce(we,!0);try{if(re.filter){const ze=s.bC(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(st=>`${st.key}: ${st.message}`).join(", "));we={type:"FeatureCollection",features:we.features.filter(st=>ze.value.evaluate({zoom:0},st))}}this._geoJSONIndex=re.cluster?new mt(function(ze){let{superclusterOptions:Ge,clusterProperties:st}=ze;if(!st||!Ge)return Ge;const vt={},Tt={},Kt={accumulated:null,zoom:0},rr={properties:null},Gt=Object.keys(st);for(const dr of Gt){const[Cr,Gr]=st[dr],Er=s.bC(Gr),zr=s.bC(typeof Cr=="string"?[Cr,["accumulated"],["get",dr]]:Cr);vt[dr]=Er.value,Tt[dr]=zr.value}return Ge.map=dr=>{rr.properties=dr;const Cr={};for(const Gr of Gt)Cr[Gr]=vt[Gr].evaluate(Kt,rr);return Cr},Ge.reduce=(dr,Cr)=>{rr.properties=Cr;for(const Gr of Gt)Kt.accumulated=dr[Gr],dr[Gr]=Tt[Gr].evaluate(Kt,rr)},Ge}(re)).load(we.features):function(ze,Ge){return new Xt(ze,Ge)}(we,re.geojsonVtOptions)}catch(ze){return Ae(ze)}this.loaded={};const Fe={};if(xe){const ze=xe.finish();ze&&(Fe.resourceTiming={},Fe.resourceTiming[re.source]=JSON.parse(JSON.stringify(ze)))}Ae(null,Fe)}})}reloadTile(re,Ae){const ge=this.loaded;return ge&&ge[re.uid]?super.reloadTile(re,Ae):this.loadTile(re,Ae)}removeSource(re,Ae){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Ae()}getClusterExpansionZoom(re,Ae){try{Ae(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(ge){Ae(ge)}}getClusterChildren(re,Ae){try{Ae(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(ge){Ae(ge)}}getClusterLeaves(re,Ae){try{Ae(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(ge){Ae(ge)}}}class Be{constructor(re){this.self=re,this.actor=new s.C(re,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:U,geojson:Qe},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Ae,ge)=>{if(this.workerSourceTypes[Ae])throw new Error(`Worker source with name "${Ae}" already registered.`);this.workerSourceTypes[Ae]=ge},this.self.registerRTLTextPlugin=Ae=>{if(s.bD.isParsed())throw new Error("RTL text plugin already registered.");s.bD.applyArabicShaping=Ae.applyArabicShaping,s.bD.processBidirectionalText=Ae.processBidirectionalText,s.bD.processStyledBidirectionalText=Ae.processStyledBidirectionalText}}setReferrer(re,Ae){this.referrer=Ae}setImages(re,Ae,ge){this.availableImages[re]=Ae;for(const xe in this.workerSources[re]){const Ee=this.workerSources[re][xe];for(const we in Ee)Ee[we].availableImages=Ae}ge()}setLayers(re,Ae,ge){this.getLayerIndex(re).replace(Ae),ge()}updateLayers(re,Ae,ge){this.getLayerIndex(re).update(Ae.layers,Ae.removedIds),ge()}loadTile(re,Ae,ge){this.getWorkerSource(re,Ae.type,Ae.source).loadTile(Ae,ge)}loadDEMTile(re,Ae,ge){this.getDEMWorkerSource(re,Ae.source).loadTile(Ae,ge)}reloadTile(re,Ae,ge){this.getWorkerSource(re,Ae.type,Ae.source).reloadTile(Ae,ge)}abortTile(re,Ae,ge){this.getWorkerSource(re,Ae.type,Ae.source).abortTile(Ae,ge)}removeTile(re,Ae,ge){this.getWorkerSource(re,Ae.type,Ae.source).removeTile(Ae,ge)}removeDEMTile(re,Ae){this.getDEMWorkerSource(re,Ae.source).removeTile(Ae)}removeSource(re,Ae,ge){if(!this.workerSources[re]||!this.workerSources[re][Ae.type]||!this.workerSources[re][Ae.type][Ae.source])return;const xe=this.workerSources[re][Ae.type][Ae.source];delete this.workerSources[re][Ae.type][Ae.source],xe.removeSource!==void 0?xe.removeSource(Ae,ge):ge()}loadWorkerSource(re,Ae,ge){try{this.self.importScripts(Ae.url),ge()}catch(xe){ge(xe.toString())}}syncRTLPluginState(re,Ae,ge){try{s.bD.setState(Ae);const xe=s.bD.getPluginURL();if(s.bD.isLoaded()&&!s.bD.isParsed()&&xe!=null){this.self.importScripts(xe);const Ee=s.bD.isParsed();ge(Ee?void 0:new Error(`RTL Text Plugin failed to import scripts from ${xe}`),Ee)}}catch(xe){ge(xe.toString())}}getAvailableImages(re){let Ae=this.availableImages[re];return Ae||(Ae=[]),Ae}getLayerIndex(re){let Ae=this.layerIndexes[re];return Ae||(Ae=this.layerIndexes[re]=new g),Ae}getWorkerSource(re,Ae,ge){return this.workerSources[re]||(this.workerSources[re]={}),this.workerSources[re][Ae]||(this.workerSources[re][Ae]={}),this.workerSources[re][Ae][ge]||(this.workerSources[re][Ae][ge]=new this.workerSourceTypes[Ae]({send:(xe,Ee,we)=>{this.actor.send(xe,Ee,we,re)}},this.getLayerIndex(re),this.getAvailableImages(re))),this.workerSources[re][Ae][ge]}getDEMWorkerSource(re,Ae){return this.demWorkerSources[re]||(this.demWorkerSources[re]={}),this.demWorkerSources[re][Ae]||(this.demWorkerSources[re][Ae]=new Z),this.demWorkerSources[re][Ae]}}return s.i()&&(self.worker=new Be(self)),Be}),o(["./shared"],function(s){var g="3.6.2";class y{static testProp(A){if(!y.docStyle)return A[0];for(let b=0;b<A.length;b++)if(A[b]in y.docStyle)return A[b];return A[0]}static create(A,b,M){const O=window.document.createElement(A);return b!==void 0&&(O.className=b),M&&M.appendChild(O),O}static createNS(A,b){return window.document.createElementNS(A,b)}static disableDrag(){y.docStyle&&y.selectProp&&(y.userSelect=y.docStyle[y.selectProp],y.docStyle[y.selectProp]="none")}static enableDrag(){y.docStyle&&y.selectProp&&(y.docStyle[y.selectProp]=y.userSelect)}static setTransform(A,b){A.style[y.transformProp]=b}static addEventListener(A,b,M){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};A.addEventListener(b,M,"passive"in O?O:O.capture)}static removeEventListener(A,b,M){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};A.removeEventListener(b,M,"passive"in O?O:O.capture)}static suppressClickInternal(A){A.preventDefault(),A.stopPropagation(),window.removeEventListener("click",y.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",y.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",y.suppressClickInternal,!0)},0)}static mousePos(A,b){const M=A.getBoundingClientRect();return new s.P(b.clientX-M.left-A.clientLeft,b.clientY-M.top-A.clientTop)}static touchPos(A,b){const M=A.getBoundingClientRect(),O=[];for(let z=0;z<b.length;z++)O.push(new s.P(b[z].clientX-M.left-A.clientLeft,b[z].clientY-M.top-A.clientTop));return O}static mouseButton(A){return A.button}static remove(A){A.parentNode&&A.parentNode.removeChild(A)}}y.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,y.selectProp=y.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),y.transformProp=y.testProp(["transform","WebkitTransform"]);const T={supported:!1,testSupport:function(N){!U&&R&&(Z?Y(N):I=N)}};let I,R,U=!1,Z=!1;function Y(N){const A=N.createTexture();N.bindTexture(N.TEXTURE_2D,A);try{if(N.texImage2D(N.TEXTURE_2D,0,N.RGBA,N.RGBA,N.UNSIGNED_BYTE,R),N.isContextLost())return;T.supported=!0}catch{}N.deleteTexture(A),U=!0}var he,ce;typeof document<"u"&&(R=document.createElement("img"),R.onload=function(){I&&Y(I),I=null,Z=!0},R.onerror=function(){U=!0,I=null},R.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(N){let A,b,M,O;N.resetRequestQueue=()=>{A=[],b=0,M=0,O={}},N.addThrottleControl=p=>{const x=M++;return O[x]=p,x},N.removeThrottleControl=p=>{delete O[p],w()},N.getImage=function(p,x){let B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;T.supported&&(p.headers||(p.headers={}),p.headers.accept="image/webp,*/*");const L={requestParameters:p,supportImageRefresh:B,callback:x,cancelled:!1,completed:!1,cancel:()=>{L.completed||L.cancelled||(L.cancelled=!0,L.innerRequest&&(L.innerRequest.cancel(),b--),w())}};return A.push(L),w(),L};const z=p=>{const{requestParameters:x,supportImageRefresh:B,callback:L}=p;return s.e(x,{type:"image"}),(B!==!1||s.i()||s.g(x.url)||x.headers&&!Object.keys(x.headers).reduce((j,_)=>j&&_==="accept",!0)?s.m:l)(x,(j,_,E,F)=>{J(p,L,j,_,E,F)})},J=(p,x,B,L,j,_)=>{B?x(B):L instanceof HTMLImageElement||s.a(L)?x(null,L):L&&((E,F)=>{typeof createImageBitmap=="function"?s.b(E,F):s.d(E,F)})(L,(E,F)=>{E!=null?x(E):F!=null&&x(null,F,{cacheControl:j,expires:_})}),p.cancelled||(p.completed=!0,b--,w())},w=()=>{const p=(()=>{const x=Object.keys(O);let B=!1;if(x.length>0){for(const L of x)if(B=O[L](),B)break}return B})()?s.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let x=b;x<p&&A.length>0;x++){const B=A.shift();if(B.cancelled){x--;continue}const L=z(B);b++,B.innerRequest=L}},l=(p,x)=>{const B=new Image,L=p.url;let j=!1;const _=p.credentials;return _&&_==="include"?B.crossOrigin="use-credentials":(_&&_==="same-origin"||!s.s(L))&&(B.crossOrigin="anonymous"),B.fetchPriority="high",B.onload=()=>{x(null,B),B.onerror=B.onload=null},B.onerror=()=>{j||x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),B.onerror=B.onload=null},B.src=L,{cancel:()=>{j=!0,B.src=""}}}}(he||(he={})),he.resetRequestQueue(),function(N){N.Glyphs="Glyphs",N.Image="Image",N.Source="Source",N.SpriteImage="SpriteImage",N.SpriteJSON="SpriteJSON",N.Style="Style",N.Tile="Tile",N.Unknown="Unknown"}(ce||(ce={}));class pe{constructor(A){this._transformRequestFn=A}transformRequest(A,b){return this._transformRequestFn&&this._transformRequestFn(A,b)||{url:A}}normalizeSpriteURL(A,b,M){const O=function(z){const J=z.match(be);if(!J)throw new Error(`Unable to parse URL "${z}"`);return{protocol:J[1],authority:J[2],path:J[3]||"/",params:J[4]?J[4].split("&"):[]}}(A);return O.path+=`${b}${M}`,function(z){const J=z.params.length?`?${z.params.join("&")}`:"";return`${z.protocol}://${z.authority}${z.path}${J}`}(O)}setTransformRequest(A){this._transformRequestFn=A}}const be=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Te(N){var A=new s.A(3);return A[0]=N[0],A[1]=N[1],A[2]=N[2],A}var qe,je=function(N,A,b){return N[0]=A[0]-b[0],N[1]=A[1]-b[1],N[2]=A[2]-b[2],N};qe=new s.A(3),s.A!=Float32Array&&(qe[0]=0,qe[1]=0,qe[2]=0);var We=function(N){var A=N[0],b=N[1];return A*A+b*b};function Ne(N){const A=[];if(typeof N=="string")A.push({id:"default",url:N});else if(N&&N.length>0){const b=[];for(const{id:M,url:O}of N){const z=`${M}${O}`;b.indexOf(z)===-1&&(b.push(z),A.push({id:M,url:O}))}}return A}function at(N,A,b,M,O){if(M)return void N(M);if(O!==Object.values(A).length||O!==Object.values(b).length)return;const z={};for(const J in A){z[J]={};const w=s.h.getImageCanvasContext(b[J]),l=A[J];for(const p in l){const{width:x,height:B,x:L,y:j,sdf:_,pixelRatio:E,stretchX:F,stretchY:V,content:q}=l[p];z[J][p]={data:null,pixelRatio:E,sdf:_,stretchX:F,stretchY:V,content:q,spriteData:{width:x,height:B,x:L,y:j,context:w}}}}N(null,z)}(function(){var N=new s.A(2);s.A!=Float32Array&&(N[0]=0,N[1]=0)})();class nt{constructor(A,b,M,O){this.context=A,this.format=M,this.texture=A.gl.createTexture(),this.update(b,O)}update(A,b,M){const{width:O,height:z}=A,J=!(this.size&&this.size[0]===O&&this.size[1]===z||M),{context:w}=this,{gl:l}=w;if(this.useMipmap=!!(b&&b.useMipmap),l.bindTexture(l.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===l.RGBA&&(!b||b.premultiply!==!1)),J)this.size=[O,z],A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof HTMLVideoElement||A instanceof ImageData||s.a(A)?l.texImage2D(l.TEXTURE_2D,0,this.format,this.format,l.UNSIGNED_BYTE,A):l.texImage2D(l.TEXTURE_2D,0,this.format,O,z,0,this.format,l.UNSIGNED_BYTE,A.data);else{const{x:p,y:x}=M||{x:0,y:0};A instanceof HTMLImageElement||A instanceof HTMLCanvasElement||A instanceof HTMLVideoElement||A instanceof ImageData||s.a(A)?l.texSubImage2D(l.TEXTURE_2D,0,p,x,l.RGBA,l.UNSIGNED_BYTE,A):l.texSubImage2D(l.TEXTURE_2D,0,p,x,O,z,l.RGBA,l.UNSIGNED_BYTE,A.data)}this.useMipmap&&this.isSizePowerOfTwo()&&l.generateMipmap(l.TEXTURE_2D)}bind(A,b,M){const{context:O}=this,{gl:z}=O;z.bindTexture(z.TEXTURE_2D,this.texture),M!==z.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(M=z.LINEAR),A!==this.filter&&(z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,A),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,M||A),this.filter=A),b!==this.wrap&&(z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,b),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,b),this.wrap=b)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:A}=this.context;A.deleteTexture(this.texture),this.texture=null}}function ke(N){const{userImage:A}=N;return!!(A&&A.render&&A.render())&&(N.data.replace(new Uint8Array(A.data.buffer)),!0)}class De extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(A){if(this.loaded!==A&&(this.loaded=A,A)){for(const{ids:b,callback:M}of this.requestors)this._notify(b,M);this.requestors=[]}}getImage(A){const b=this.images[A];if(b&&!b.data&&b.spriteData){const M=b.spriteData;b.data=new s.R({width:M.width,height:M.height},M.context.getImageData(M.x,M.y,M.width,M.height).data),b.spriteData=null}return b}addImage(A,b){if(this.images[A])throw new Error(`Image id ${A} already exist, use updateImage instead`);this._validate(A,b)&&(this.images[A]=b)}_validate(A,b){let M=!0;const O=b.data||b.spriteData;return this._validateStretch(b.stretchX,O&&O.width)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "stretchX" value`))),M=!1),this._validateStretch(b.stretchY,O&&O.height)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "stretchY" value`))),M=!1),this._validateContent(b.content,b)||(this.fire(new s.j(new Error(`Image "${A}" has invalid "content" value`))),M=!1),M}_validateStretch(A,b){if(!A)return!0;let M=0;for(const O of A){if(O[0]<M||O[1]<O[0]||b<O[1])return!1;M=O[1]}return!0}_validateContent(A,b){if(!A)return!0;if(A.length!==4)return!1;const M=b.spriteData,O=M&&M.width||b.data.width,z=M&&M.height||b.data.height;return!(A[0]<0||O<A[0]||A[1]<0||z<A[1]||A[2]<0||O<A[2]||A[3]<0||z<A[3]||A[2]<A[0]||A[3]<A[1])}updateImage(A,b){let M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const O=this.getImage(A);if(M&&(O.data.width!==b.data.width||O.data.height!==b.data.height))throw new Error(`size mismatch between old image (${O.data.width}x${O.data.height}) and new image (${b.data.width}x${b.data.height}).`);b.version=O.version+1,this.images[A]=b,this.updatedImages[A]=!0}removeImage(A){const b=this.images[A];delete this.images[A],delete this.patterns[A],b.userImage&&b.userImage.onRemove&&b.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(A,b){let M=!0;if(!this.isLoaded())for(const O of A)this.images[O]||(M=!1);this.isLoaded()||M?this._notify(A,b):this.requestors.push({ids:A,callback:b})}_notify(A,b){const M={};for(const O of A){let z=this.getImage(O);z||(this.fire(new s.k("styleimagemissing",{id:O})),z=this.getImage(O)),z?M[O]={data:z.data.clone(),pixelRatio:z.pixelRatio,sdf:z.sdf,version:z.version,stretchX:z.stretchX,stretchY:z.stretchY,content:z.content,hasRenderCallback:!!(z.userImage&&z.userImage.render)}:s.w(`Image "${O}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}b(null,M)}getPixelSize(){const{width:A,height:b}=this.atlasImage;return{width:A,height:b}}getPattern(A){const b=this.patterns[A],M=this.getImage(A);if(!M)return null;if(b&&b.position.version===M.version)return b.position;if(b)b.position.version=M.version;else{const O={w:M.data.width+2,h:M.data.height+2,x:0,y:0},z=new s.I(O,M);this.patterns[A]={bin:O,position:z}}return this._updatePatternAtlas(),this.patterns[A].position}bind(A){const b=A.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new nt(A,this.atlasImage,b.RGBA),this.atlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE)}_updatePatternAtlas(){const A=[];for(const z in this.patterns)A.push(this.patterns[z].bin);const{w:b,h:M}=s.p(A),O=this.atlasImage;O.resize({width:b||1,height:M||1});for(const z in this.patterns){const{bin:J}=this.patterns[z],w=J.x+1,l=J.y+1,p=this.getImage(z).data,x=p.width,B=p.height;s.R.copy(p,O,{x:0,y:0},{x:w,y:l},{width:x,height:B}),s.R.copy(p,O,{x:0,y:B-1},{x:w,y:l-1},{width:x,height:1}),s.R.copy(p,O,{x:0,y:0},{x:w,y:l+B},{width:x,height:1}),s.R.copy(p,O,{x:x-1,y:0},{x:w-1,y:l},{width:1,height:B}),s.R.copy(p,O,{x:0,y:0},{x:w+x,y:l},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(A){for(const b of A){if(this.callbackDispatchedThisFrame[b])continue;this.callbackDispatchedThisFrame[b]=!0;const M=this.getImage(b);M||s.w(`Image with ID: "${b}" was not found`),ke(M)&&this.updateImage(b,M)}}}const Ye=1e20;function Xe(N,A,b,M,O,z,J,w,l){for(let p=A;p<A+M;p++)Ct(N,b*z+p,z,O,J,w,l);for(let p=b;p<b+O;p++)Ct(N,p*z+A,1,M,J,w,l)}function Ct(N,A,b,M,O,z,J){z[0]=0,J[0]=-Ye,J[1]=Ye,O[0]=N[A];for(let w=1,l=0,p=0;w<M;w++){O[w]=N[A+w*b];const x=w*w;do{const B=z[l];p=(O[w]-O[B]+x-B*B)/(w-B)/2}while(p<=J[l]&&--l>-1);l++,z[l]=w,J[l]=p,J[l+1]=Ye}for(let w=0,l=0;w<M;w++){for(;J[l+1]<w;)l++;const p=z[l],x=w-p;N[A+w*b]=O[p]+x*x}}class Et{constructor(A,b){this.requestManager=A,this.localIdeographFontFamily=b,this.entries={}}setURL(A){this.url=A}getGlyphs(A,b){const M=[];for(const O in A)for(const z of A[O])M.push({stack:O,id:z});s.o(M,(O,z)=>{let{stack:J,id:w}=O,l=this.entries[J];l||(l=this.entries[J]={glyphs:{},requests:{},ranges:{}});let p=l.glyphs[w];if(p!==void 0)return void z(null,{stack:J,id:w,glyph:p});if(p=this._tinySDF(l,J,w),p)return l.glyphs[w]=p,void z(null,{stack:J,id:w,glyph:p});const x=Math.floor(w/256);if(256*x>65535)return void z(new Error("glyphs > 65535 not supported"));if(l.ranges[x])return void z(null,{stack:J,id:w,glyph:p});if(!this.url)return void z(new Error("glyphsUrl is not set"));let B=l.requests[x];B||(B=l.requests[x]=[],Et.loadGlyphRange(J,x,this.url,this.requestManager,(L,j)=>{if(j){for(const _ in j)this._doesCharSupportLocalGlyph(+_)||(l.glyphs[+_]=j[+_]);l.ranges[x]=!0}for(const _ of B)_(L,j);delete l.requests[x]})),B.push((L,j)=>{L?z(L):j&&z(null,{stack:J,id:w,glyph:j[w]||null})})},(O,z)=>{if(O)b(O);else if(z){const J={};for(const{stack:w,id:l,glyph:p}of z)(J[w]||(J[w]={}))[l]=p&&{id:p.id,bitmap:p.bitmap.clone(),metrics:p.metrics};b(null,J)}})}_doesCharSupportLocalGlyph(A){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](A)||s.u["Hangul Syllables"](A)||s.u.Hiragana(A)||s.u.Katakana(A))}_tinySDF(A,b,M){const O=this.localIdeographFontFamily;if(!O||!this._doesCharSupportLocalGlyph(M))return;let z=A.tinySDF;if(!z){let w="400";/bold/i.test(b)?w="900":/medium/i.test(b)?w="500":/light/i.test(b)&&(w="200"),z=A.tinySDF=new Et.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:O,fontWeight:w})}const J=z.draw(String.fromCharCode(M));return{id:M,bitmap:new s.q({width:J.width||60,height:J.height||60},J.data),metrics:{width:J.glyphWidth/2||24,height:J.glyphHeight/2||24,left:J.glyphLeft/2+.5||0,top:J.glyphTop/2-27.5||-8,advance:J.glyphAdvance/2||24,isDoubleResolution:!0}}}}Et.loadGlyphRange=function(N,A,b,M,O){const z=256*A,J=z+255,w=M.transformRequest(b.replace("{fontstack}",N).replace("{range}",`${z}-${J}`),ce.Glyphs);s.l(w,(l,p)=>{if(l)O(l);else if(p){const x={};for(const B of s.n(p))x[B.id]=B;O(null,x)}})},Et.TinySDF=class{constructor(){let{fontSize:N=24,buffer:A=3,radius:b=8,cutoff:M=.25,fontFamily:O="sans-serif",fontWeight:z="normal",fontStyle:J="normal"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.buffer=A,this.cutoff=M,this.radius=b;const w=this.size=N+4*A,l=this._createCanvas(w),p=this.ctx=l.getContext("2d",{willReadFrequently:!0});p.font=`${J} ${z} ${N}px ${O}`,p.textBaseline="alphabetic",p.textAlign="left",p.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(N){const A=document.createElement("canvas");return A.width=A.height=N,A}draw(N){const{width:A,actualBoundingBoxAscent:b,actualBoundingBoxDescent:M,actualBoundingBoxLeft:O,actualBoundingBoxRight:z}=this.ctx.measureText(N),J=Math.ceil(b),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(z-O))),l=Math.min(this.size-this.buffer,J+Math.ceil(M)),p=w+2*this.buffer,x=l+2*this.buffer,B=Math.max(p*x,0),L=new Uint8ClampedArray(B),j={data:L,width:p,height:x,glyphWidth:w,glyphHeight:l,glyphTop:J,glyphLeft:0,glyphAdvance:A};if(w===0||l===0)return j;const{ctx:_,buffer:E,gridInner:F,gridOuter:V}=this;_.clearRect(E,E,w,l),_.fillText(N,E,E+J);const q=_.getImageData(E,E,w,l);V.fill(Ye,0,B),F.fill(0,0,B);for(let K=0;K<l;K++)for(let te=0;te<w;te++){const se=q.data[4*(K*w+te)+3]/255;if(se===0)continue;const oe=(K+E)*p+te+E;if(se===1)V[oe]=0,F[oe]=Ye;else{const le=.5-se;V[oe]=le>0?le*le:0,F[oe]=le<0?le*le:0}}Xe(V,0,0,p,x,p,this.f,this.v,this.z),Xe(F,E,E,w,l,p,this.f,this.v,this.z);for(let K=0;K<B;K++){const te=Math.sqrt(V[K])-Math.sqrt(F[K]);L[K]=Math.round(255-255*(te/this.radius+this.cutoff))}return j}};class Pt{constructor(){this.specification=s.v.light.position}possiblyEvaluate(A,b){return s.z(A.expression.evaluate(b))}interpolate(A,b,M){return{x:s.B.number(A.x,b.x,M),y:s.B.number(A.y,b.y,M),z:s.B.number(A.z,b.z,M)}}}let bt;class Rt extends s.E{constructor(A){super(),bt=bt||new s.r({anchor:new s.D(s.v.light.anchor),position:new Pt,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(bt),this.setLight(A),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this._validate(s.t,A,b))for(const M in A){const O=A[M];M.endsWith("-transition")?this._transitionable.setTransition(M.slice(0,-11),O):this._transitionable.setValue(M,O)}}updateTransitions(A){this._transitioning=this._transitionable.transitioned(A,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(A){this.properties=this._transitioning.possiblyEvaluate(A)}_validate(A,b,M){return(!M||M.validate!==!1)&&s.x(this,A.call(s.y,s.e({value:b,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}}class Ft{constructor(A,b){this.width=A,this.height=b,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(A,b){const M=A.join(",")+String(b);return this.dashEntry[M]||(this.dashEntry[M]=this.addDash(A,b)),this.dashEntry[M]}getDashRanges(A,b,M){const O=[];let z=A.length%2==1?-A[A.length-1]*M:0,J=A[0]*M,w=!0;O.push({left:z,right:J,isDash:w,zeroLength:A[0]===0});let l=A[0];for(let p=1;p<A.length;p++){w=!w;const x=A[p];z=l*M,l+=x,J=l*M,O.push({left:z,right:J,isDash:w,zeroLength:x===0})}return O}addRoundDash(A,b,M){const O=b/2;for(let z=-M;z<=M;z++){const J=this.width*(this.nextRow+M+z);let w=0,l=A[w];for(let p=0;p<this.width;p++){p/l.right>1&&(l=A[++w]);const x=Math.abs(p-l.left),B=Math.abs(p-l.right),L=Math.min(x,B);let j;const _=z/M*(O+1);if(l.isDash){const E=O-Math.abs(_);j=Math.sqrt(L*L+E*E)}else j=O-Math.sqrt(L*L+_*_);this.data[J+p]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(A){for(let w=A.length-1;w>=0;--w){const l=A[w],p=A[w+1];l.zeroLength?A.splice(w,1):p&&p.isDash===l.isDash&&(p.left=l.left,A.splice(w,1))}const b=A[0],M=A[A.length-1];b.isDash===M.isDash&&(b.left=M.left-this.width,M.right=b.right+this.width);const O=this.width*this.nextRow;let z=0,J=A[z];for(let w=0;w<this.width;w++){w/J.right>1&&(J=A[++z]);const l=Math.abs(w-J.left),p=Math.abs(w-J.right),x=Math.min(l,p);this.data[O+w]=Math.max(0,Math.min(255,(J.isDash?x:-x)+128))}}addDash(A,b){const M=b?7:0,O=2*M+1;if(this.nextRow+O>this.height)return s.w("LineAtlas out of space"),null;let z=0;for(let w=0;w<A.length;w++)z+=A[w];if(z!==0){const w=this.width/z,l=this.getDashRanges(A,this.width,w);b?this.addRoundDash(l,w,M):this.addRegularDash(l)}const J={y:(this.nextRow+M+.5)/this.height,height:2*M/this.height,width:z};return this.nextRow+=O,this.dirty=!0,J}bind(A){const b=A.gl;this.texture?(b.bindTexture(b.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,b.texSubImage2D(b.TEXTURE_2D,0,0,0,this.width,this.height,b.ALPHA,b.UNSIGNED_BYTE,this.data))):(this.texture=b.createTexture(),b.bindTexture(b.TEXTURE_2D,this.texture),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texImage2D(b.TEXTURE_2D,0,b.ALPHA,this.width,this.height,0,b.ALPHA,b.UNSIGNED_BYTE,this.data))}}class Zt{constructor(A,b,M){this.workerPool=A,this.actors=[],this.currentActor=0,this.id=M;const O=this.workerPool.acquire(M);for(let z=0;z<O.length;z++){const J=new s.C(O[z],b,M);J.name=`Worker ${z}`,this.actors.push(J)}if(!this.actors.length)throw new Error("No actors found")}broadcast(A,b,M){s.o(this.actors,(O,z)=>{O.send(A,b,z)},M=M||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.actors.forEach(b=>{b.remove()}),this.actors=[],A&&this.workerPool.release(this.id)}}function Le(N,A,b){const M=function(O,z){if(O)return b(O);if(z){const J=s.F(s.e(z,N),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);z.vector_layers&&(J.vectorLayers=z.vector_layers,J.vectorLayerIds=J.vectorLayers.map(w=>w.id)),b(null,J)}};return N.url?s.f(A.transformRequest(N.url,ce.Source),M):s.h.frame(()=>M(null,N))}class Ze{constructor(A,b){A&&(b?this.setSouthWest(A).setNorthEast(b):Array.isArray(A)&&(A.length===4?this.setSouthWest([A[0],A[1]]).setNorthEast([A[2],A[3]]):this.setSouthWest(A[0]).setNorthEast(A[1])))}setNorthEast(A){return this._ne=A instanceof s.L?new s.L(A.lng,A.lat):s.L.convert(A),this}setSouthWest(A){return this._sw=A instanceof s.L?new s.L(A.lng,A.lat):s.L.convert(A),this}extend(A){const b=this._sw,M=this._ne;let O,z;if(A instanceof s.L)O=A,z=A;else{if(!(A instanceof Ze))return Array.isArray(A)?A.length===4||A.every(Array.isArray)?this.extend(Ze.convert(A)):this.extend(s.L.convert(A)):A&&("lng"in A||"lon"in A)&&"lat"in A?this.extend(s.L.convert(A)):this;if(O=A._sw,z=A._ne,!O||!z)return this}return b||M?(b.lng=Math.min(O.lng,b.lng),b.lat=Math.min(O.lat,b.lat),M.lng=Math.max(z.lng,M.lng),M.lat=Math.max(z.lat,M.lat)):(this._sw=new s.L(O.lng,O.lat),this._ne=new s.L(z.lng,z.lat)),this}getCenter(){return new s.L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.L(this.getWest(),this.getNorth())}getSouthEast(){return new s.L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(A){const{lng:b,lat:M}=s.L.convert(A);let O=this._sw.lng<=b&&b<=this._ne.lng;return this._sw.lng>this._ne.lng&&(O=this._sw.lng>=b&&b>=this._ne.lng),this._sw.lat<=M&&M<=this._ne.lat&&O}static convert(A){return A instanceof Ze?A:A&&new Ze(A)}static fromLngLat(A){const M=360*(arguments.length>1&&arguments[1]!==void 0?arguments[1]:0)/40075017,O=M/Math.cos(Math.PI/180*A.lat);return new Ze(new s.L(A.lng-O,A.lat-M),new s.L(A.lng+O,A.lat+M))}}class rt{constructor(A,b,M){this.bounds=Ze.convert(this.validateBounds(A)),this.minzoom=b||0,this.maxzoom=M||24}validateBounds(A){return Array.isArray(A)&&A.length===4?[Math.max(-180,A[0]),Math.max(-90,A[1]),Math.min(180,A[2]),Math.min(90,A[3])]:[-180,-90,180,90]}contains(A){const b=Math.pow(2,A.z),M=Math.floor(s.G(this.bounds.getWest())*b),O=Math.floor(s.H(this.bounds.getNorth())*b),z=Math.ceil(s.G(this.bounds.getEast())*b),J=Math.ceil(s.H(this.bounds.getSouth())*b);return A.x>=M&&A.x<z&&A.y>=O&&A.y<J}}class pt extends s.E{constructor(A,b,M,O){if(super(),this.load=()=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Le(this._options,this.map._requestManager,(z,J)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),z?this.fire(new s.j(z)):J&&(s.e(this,J),J.bounds&&(this.tileBounds=new rt(J.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>s.e({},this._options),this.id=A,this.dispatcher=M,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.F(b,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},b),this._collectResourceTiming=b.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(O)}loaded(){return this._loaded}hasTile(A){return!this.tileBounds||this.tileBounds.contains(A.canonical)}onAdd(A){this.map=A,this.load()}setSourceProperty(A){this._tileJSONRequest&&this._tileJSONRequest.cancel(),A(),this.load()}setTiles(A){return this.setSourceProperty(()=>{this._options.tiles=A}),this}setUrl(A){return this.setSourceProperty(()=>{this.url=A,this._options.url=A}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(A,b){const M=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),O={request:this.map._requestManager.transformRequest(M,ce.Tile),uid:A.uid,tileID:A.tileID,zoom:A.tileID.overscaledZ,tileSize:this.tileSize*A.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function z(J,w){return delete A.request,A.aborted?b(null):J&&J.status!==404?b(J):(w&&w.resourceTiming&&(A.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&A.setExpiryData(w),A.loadVectorData(w,this.map.painter),b(null),void(A.reloadCallback&&(this.loadTile(A,A.reloadCallback),A.reloadCallback=null)))}O.request.collectResourceTiming=this._collectResourceTiming,A.actor&&A.state!=="expired"?A.state==="loading"?A.reloadCallback=b:A.request=A.actor.send("reloadTile",O,z.bind(this)):(A.actor=this.dispatcher.getActor(),A.request=A.actor.send("loadTile",O,z.bind(this)))}abortTile(A){A.request&&(A.request.cancel(),delete A.request),A.actor&&A.actor.send("abortTile",{uid:A.uid,type:this.type,source:this.id},void 0)}unloadTile(A){A.unloadVectorData(),A.actor&&A.actor.send("removeTile",{uid:A.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class mt extends s.E{constructor(A,b,M,O){super(),this.id=A,this.dispatcher=M,this.setEventedParent(O),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},b),s.e(this,s.F(b,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=Le(this._options,this.map._requestManager,(A,b)=>{this._tileJSONRequest=null,this._loaded=!0,A?this.fire(new s.j(A)):b&&(s.e(this,b),b.bounds&&(this.tileBounds=new rt(b.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(A){this.map=A,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}setSourceProperty(A){this._tileJSONRequest&&this._tileJSONRequest.cancel(),A(),this.load()}setTiles(A){return this.setSourceProperty(()=>{this._options.tiles=A}),this}serialize(){return s.e({},this._options)}hasTile(A){return!this.tileBounds||this.tileBounds.contains(A.canonical)}loadTile(A,b){const M=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);A.request=he.getImage(this.map._requestManager.transformRequest(M,ce.Tile),(O,z,J)=>{if(delete A.request,A.aborted)A.state="unloaded",b(null);else if(O)A.state="errored",b(O);else if(z){this.map._refreshExpiredTiles&&J&&A.setExpiryData(J);const w=this.map.painter.context,l=w.gl;A.texture=this.map.painter.getTileTexture(z.width),A.texture?A.texture.update(z,{useMipmap:!0}):(A.texture=new nt(w,z,l.RGBA,{useMipmap:!0}),A.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE,l.LINEAR_MIPMAP_NEAREST),w.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,w.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,w.extTextureFilterAnisotropicMax)),A.state="loaded",b(null)}},this.map._refreshExpiredTiles)}abortTile(A,b){A.request&&(A.request.cancel(),delete A.request),b()}unloadTile(A,b){A.texture&&this.map.painter.saveTileTexture(A.texture),b()}hasTransition(){return!1}}class Bt extends mt{constructor(A,b,M,O){super(A,b,M,O),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},b),this.encoding=b.encoding||"mapbox",this.redFactor=b.redFactor,this.greenFactor=b.greenFactor,this.blueFactor=b.blueFactor,this.baseShift=b.baseShift}loadTile(A,b){const M=A.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),O=this.map._requestManager.transformRequest(M,ce.Tile);function z(J,w){J&&(A.state="errored",b(J)),w&&(A.dem=w,A.needsHillshadePrepare=!0,A.needsTerrainPrepare=!0,A.state="loaded",b(null))}A.neighboringTiles=this._getNeighboringTiles(A.tileID),A.request=he.getImage(O,(J,w,l)=>s._(this,void 0,void 0,function*(){if(delete A.request,A.aborted)A.state="unloaded",b(null);else if(J)A.state="errored",b(J);else if(w){this.map._refreshExpiredTiles&&A.setExpiryData(l);const p=s.a(w)&&s.J()?w:yield function(B){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.K()){const L=B.width+2,j=B.height+2;try{return new s.R({width:L,height:j},yield s.M(B,-1,-1,L,j))}catch{}}return s.h.getImageData(B,1)})}(w),x={uid:A.uid,coord:A.tileID,source:this.id,rawImageData:p,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};A.actor&&A.state!=="expired"||(A.actor=this.dispatcher.getActor(),A.actor.send("loadDEMTile",x,z))}}),this.map._refreshExpiredTiles)}_getNeighboringTiles(A){const b=A.canonical,M=Math.pow(2,b.z),O=(b.x-1+M)%M,z=b.x===0?A.wrap-1:A.wrap,J=(b.x+1+M)%M,w=b.x+1===M?A.wrap+1:A.wrap,l={};return l[new s.O(A.overscaledZ,z,b.z,O,b.y).key]={backfilled:!1},l[new s.O(A.overscaledZ,w,b.z,J,b.y).key]={backfilled:!1},b.y>0&&(l[new s.O(A.overscaledZ,z,b.z,O,b.y-1).key]={backfilled:!1},l[new s.O(A.overscaledZ,A.wrap,b.z,b.x,b.y-1).key]={backfilled:!1},l[new s.O(A.overscaledZ,w,b.z,J,b.y-1).key]={backfilled:!1}),b.y+1<M&&(l[new s.O(A.overscaledZ,z,b.z,O,b.y+1).key]={backfilled:!1},l[new s.O(A.overscaledZ,A.wrap,b.z,b.x,b.y+1).key]={backfilled:!1},l[new s.O(A.overscaledZ,w,b.z,J,b.y+1).key]={backfilled:!1}),l}unloadTile(A){A.demTexture&&this.map.painter.saveTileTexture(A.demTexture),A.fbo&&(A.fbo.destroy(),delete A.fbo),A.dem&&delete A.dem,delete A.neighboringTiles,A.state="unloaded",A.actor&&A.actor.send("removeDEMTile",{uid:A.uid,source:this.id})}}class Dt extends s.E{constructor(A,b,M,O){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>s.e({},this._options,{type:this.type,data:this._data}),this.id=A,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=M.getActor(),this.setEventedParent(O),this._data=b.data,this._options=s.e({},b),this._collectResourceTiming=b.collectResourceTiming,b.maxzoom!==void 0&&(this.maxzoom=b.maxzoom),b.type&&(this.type=b.type),b.attribution&&(this.attribution=b.attribution),this.promoteId=b.promoteId;const z=s.N/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:b.cluster||!1,geojsonVtOptions:{buffer:(b.buffer!==void 0?b.buffer:128)*z,tolerance:(b.tolerance!==void 0?b.tolerance:.375)*z,extent:s.N,maxZoom:this.maxzoom,lineMetrics:b.lineMetrics||!1,generateId:b.generateId||!1},superclusterOptions:{maxZoom:b.clusterMaxZoom!==void 0?b.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,b.clusterMinPoints||2),extent:s.N,radius:(b.clusterRadius||50)*z,log:!1,generateId:b.generateId||!1},clusterProperties:b.clusterProperties,filter:b.filter},b.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(A){this.map=A,this.load()}setData(A){return this._data=A,this._updateWorkerData(),this}updateData(A){return this._updateWorkerData(A),this}setClusterOptions(A){return this.workerOptions.cluster=A.cluster,A&&(A.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=A.clusterRadius),A.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=A.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(A,b){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:A,source:this.id},b),this}getClusterChildren(A,b){return this.actor.send("geojson.getClusterChildren",{clusterId:A,source:this.id},b),this}getClusterLeaves(A,b,M,O){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:A,limit:b,offset:M},O),this}_updateWorkerData(A){const b=s.e({},this.workerOptions);A?b.dataDiff=A:typeof this._data=="string"?(b.request=this.map._requestManager.transformRequest(s.h.resolveURL(this._data),ce.Source),b.request.collectResourceTiming=this._collectResourceTiming):b.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,b,(M,O)=>{if(this._pendingLoads--,this._removed||O&&O.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let z=null;if(O&&O.resourceTiming&&O.resourceTiming[this.id]&&(z=O.resourceTiming[this.id].slice(0)),M)return void this.fire(new s.j(M));const J={dataType:"source"};this._collectResourceTiming&&z&&z.length>0&&s.e(J,{resourceTiming:z}),this.fire(new s.k("data",Object.assign(Object.assign({},J),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},J),{sourceDataType:"content"})))})}loaded(){return this._pendingLoads===0}loadTile(A,b){const M=A.actor?"reloadTile":"loadTile";A.actor=this.actor;const O={type:this.type,uid:A.uid,tileID:A.tileID,zoom:A.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};A.request=this.actor.send(M,O,(z,J)=>(delete A.request,A.unloadVectorData(),A.aborted?b(null):z?b(z):(A.loadVectorData(J,this.map.painter,M==="reloadTile"),b(null))))}abortTile(A){A.request&&(A.request.cancel(),delete A.request),A.aborted=!0}unloadTile(A){A.unloadVectorData(),this.actor.send("removeTile",{uid:A.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Mt=s.Q([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class qt extends s.E{constructor(A,b,M,O){super(),this.load=(z,J)=>{this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=he.getImage(this.map._requestManager.transformRequest(this.url,ce.Image),(w,l)=>{this._request=null,this._loaded=!0,w?this.fire(new s.j(w)):l&&(this.image=l,z&&(this.coordinates=z),J&&J(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const z=this.map.painter.context,J=z.gl;this.boundsBuffer||(this.boundsBuffer=z.createVertexBuffer(this._boundsArray,Mt.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture||(this.texture=new nt(z,this.image,J.RGBA),this.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE));let w=!1;for(const l in this.tiles){const p=this.tiles[l];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,w=!0)}w&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=A,this.dispatcher=M,this.coordinates=b.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(O),this.options=b}loaded(){return this._loaded}updateImage(A){return A.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=A.url,this.load(A.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(A){this.map=A,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(A){this.coordinates=A;const b=A.map(s.U.fromLngLat);this.tileID=function(O){let z=1/0,J=1/0,w=-1/0,l=-1/0;for(const L of O)z=Math.min(z,L.x),J=Math.min(J,L.y),w=Math.max(w,L.x),l=Math.max(l,L.y);const p=Math.max(w-z,l-J),x=Math.max(0,Math.floor(-Math.log(p)/Math.LN2)),B=Math.pow(2,x);return new s.W(x,Math.floor((z+w)/2*B),Math.floor((J+l)/2*B))}(b),this.minzoom=this.maxzoom=this.tileID.z;const M=b.map(O=>this.tileID.getTilePoint(O)._round());return this._boundsArray=new s.V,this._boundsArray.emplaceBack(M[0].x,M[0].y,0,0),this._boundsArray.emplaceBack(M[1].x,M[1].y,s.N,0),this._boundsArray.emplaceBack(M[3].x,M[3].y,0,s.N),this._boundsArray.emplaceBack(M[2].x,M[2].y,s.N,s.N),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(A,b){this.tileID&&this.tileID.equals(A.tileID.canonical)?(this.tiles[String(A.tileID.wrap)]=A,A.buckets={},b(null)):(A.state="errored",b(null))}hasTransition(){return!1}}class nr extends qt{constructor(A,b,M,O){super(A,b,M,O),this.load=()=>{this._loaded=!1;const z=this.options;this.urls=[];for(const J of z.urls)this.urls.push(this.map._requestManager.transformRequest(J,ce.Source).url);s.X(this.urls,(J,w)=>{this._loaded=!0,J?this.fire(new s.j(J)):w&&(this.video=w,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const z=this.map.painter.context,J=z.gl;this.boundsBuffer||(this.boundsBuffer=z.createVertexBuffer(this._boundsArray,Mt.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE),J.texSubImage2D(J.TEXTURE_2D,0,0,0,J.RGBA,J.UNSIGNED_BYTE,this.video)):(this.texture=new nt(z,this.video,J.RGBA),this.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE));let w=!1;for(const l in this.tiles){const p=this.tiles[l];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,w=!0)}w&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=b}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(A){if(this.video){const b=this.video.seekable;A<b.start(0)||A>b.end(0)?this.fire(new s.j(new s.Y(`sources.${this.id}`,null,`Playback for this video can be set only between the ${b.start(0)} and ${b.end(0)}-second mark.`))):this.video.currentTime=A}}getVideo(){return this.video}onAdd(A){this.map||(this.map=A,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class vr extends qt{constructor(A,b,M,O){super(A,b,M,O),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let z=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,z=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,z=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const J=this.map.painter.context,w=J.gl;this.boundsBuffer||(this.boundsBuffer=J.createVertexBuffer(this._boundsArray,Mt.members)),this.boundsSegments||(this.boundsSegments=s.S.simpleSegment(0,0,4,2)),this.texture?(z||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new nt(J,this.canvas,w.RGBA,{premultiply:!0});let l=!1;for(const p in this.tiles){const x=this.tiles[p];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,l=!0)}l&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),b.coordinates?Array.isArray(b.coordinates)&&b.coordinates.length===4&&!b.coordinates.some(z=>!Array.isArray(z)||z.length!==2||z.some(J=>typeof J!="number"))||this.fire(new s.j(new s.Y(`sources.${A}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.Y(`sources.${A}`,null,'missing required property "coordinates"'))),b.animate&&typeof b.animate!="boolean"&&this.fire(new s.j(new s.Y(`sources.${A}`,null,'optional "animate" property must be a boolean value'))),b.canvas?typeof b.canvas=="string"||b.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.Y(`sources.${A}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.Y(`sources.${A}`,null,'missing required property "canvas"'))),this.options=b,this.animate=b.animate===void 0||b.animate}getCanvas(){return this.canvas}onAdd(A){this.map=A,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const A of[this.canvas.width,this.canvas.height])if(isNaN(A)||A<=0)return!0;return!1}}const br={},Fr=N=>{switch(N){case"geojson":return Dt;case"image":return qt;case"raster":return mt;case"raster-dem":return Bt;case"vector":return pt;case"video":return nr;case"canvas":return vr}return br[N]};function kt(N,A){const b=s.Z();return s.$(b,b,[1,1,0]),s.a0(b,b,[.5*N.width,.5*N.height,1]),s.a1(b,b,N.calculatePosMatrix(A.toUnwrapped()))}function lt(N,A,b,M,O,z){const J=function(B,L,j){if(B)for(const _ of B){const E=L[_];if(E&&E.source===j&&E.type==="fill-extrusion")return!0}else for(const _ in L){const E=L[_];if(E.source===j&&E.type==="fill-extrusion")return!0}return!1}(O&&O.layers,A,N.id),w=z.maxPitchScaleFactor(),l=N.tilesIn(M,w,J);l.sort(wt);const p=[];for(const B of l)p.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(A,b,N._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,O,z,w,kt(N.transform,B.tileID))});const x=function(B){const L={},j={};for(const _ of B){const E=_.queryResults,F=_.wrappedTileID,V=j[F]=j[F]||{};for(const q in E){const K=E[q],te=V[q]=V[q]||{},se=L[q]=L[q]||[];for(const oe of K)te[oe.featureIndex]||(te[oe.featureIndex]=!0,se.push(oe))}}return L}(p);for(const B in x)x[B].forEach(L=>{const j=L.feature,_=N.getFeatureState(j.layer["source-layer"],j.id);j.source=j.layer.source,j.layer["source-layer"]&&(j.sourceLayer=j.layer["source-layer"]),j.state=_});return x}function wt(N,A){const b=N.tileID,M=A.tileID;return b.overscaledZ-M.overscaledZ||b.canonical.y-M.canonical.y||b.wrap-M.wrap||b.canonical.x-M.canonical.x}class Ur{constructor(A,b){this.timeAdded=0,this.fadeEndTime=0,this.tileID=A,this.uid=s.a2(),this.uses=0,this.tileSize=b,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(A){const b=A+this.timeAdded;b<this.fadeEndTime||(this.fadeEndTime=b)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(A){this.demTexture&&A.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(A,b,M){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",A){A.featureIndex&&(this.latestFeatureIndex=A.featureIndex,A.rawTileData?(this.latestRawTileData=A.rawTileData,this.latestFeatureIndex.rawTileData=A.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=A.collisionBoxArray,this.buckets=function(O,z){const J={};if(!z)return J;for(const w of O){const l=w.layerIds.map(p=>z.getLayer(p)).filter(Boolean);if(l.length!==0){w.layers=l,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(p=>l.filter(x=>x.id===p)[0]));for(const p of l)J[p.id]=w}}return J}(A.buckets,b.style),this.hasSymbolBuckets=!1;for(const O in this.buckets){const z=this.buckets[O];if(z instanceof s.a4){if(this.hasSymbolBuckets=!0,!M)break;z.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const O in this.buckets){const z=this.buckets[O];if(z instanceof s.a4&&z.hasRTLText){this.hasRTLText=!0,s.a5();break}}this.queryPadding=0;for(const O in this.buckets){const z=this.buckets[O];this.queryPadding=Math.max(this.queryPadding,b.style.getLayer(O).queryRadius(z))}A.imageAtlas&&(this.imageAtlas=A.imageAtlas),A.glyphAtlasImage&&(this.glyphAtlasImage=A.glyphAtlasImage)}else this.collisionBoxArray=new s.a3}unloadVectorData(){for(const A in this.buckets)this.buckets[A].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(A){return this.buckets[A.id]}upload(A){for(const M in this.buckets){const O=this.buckets[M];O.uploadPending()&&O.upload(A)}const b=A.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new nt(A,this.imageAtlas.image,b.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new nt(A,this.glyphAtlasImage,b.ALPHA),this.glyphAtlasImage=null)}prepare(A){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(A,this.imageAtlasTexture)}queryRenderedFeatures(A,b,M,O,z,J,w,l,p,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:O,cameraQueryGeometry:z,scale:J,tileSize:this.tileSize,pixelPosMatrix:x,transform:l,params:w,queryPadding:this.queryPadding*p},A,b,M):{}}querySourceFeatures(A,b){const M=this.latestFeatureIndex;if(!M||!M.rawTileData)return;const O=M.loadVTLayers(),z=b&&b.sourceLayer?b.sourceLayer:"",J=O._geojsonTileLayer||O[z];if(!J)return;const w=s.a6(b&&b.filter),{z:l,x:p,y:x}=this.tileID.canonical,B={z:l,x:p,y:x};for(let L=0;L<J.length;L++){const j=J.feature(L);if(w.needGeometry){const F=s.a7(j,!0);if(!w.filter(new s.a8(this.tileID.overscaledZ),F,this.tileID.canonical))continue}else if(!w.filter(new s.a8(this.tileID.overscaledZ),j))continue;const _=M.getId(j,z),E=new s.a9(j,l,p,x,_);E.tile=B,A.push(E)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(A){const b=this.expirationTime;if(A.cacheControl){const M=s.aa(A.cacheControl);M["max-age"]&&(this.expirationTime=Date.now()+1e3*M["max-age"])}else A.expires&&(this.expirationTime=new Date(A.expires).getTime());if(this.expirationTime){const M=Date.now();let O=!1;if(this.expirationTime>M)O=!1;else if(b)if(this.expirationTime<b)O=!0;else{const z=this.expirationTime-b;z?this.expirationTime=M+Math.max(z,3e4):O=!0}else O=!0;O?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(A,b){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(A).length===0)return;const M=this.latestFeatureIndex.loadVTLayers();for(const O in this.buckets){if(!b.style.hasLayer(O))continue;const z=this.buckets[O],J=z.layers[0].sourceLayer||"_geojsonTileLayer",w=M[J],l=A[J];if(!w||!l||Object.keys(l).length===0)continue;z.update(l,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const p=b&&b.style&&b.style.getLayer(O);p&&(this.queryPadding=Math.max(this.queryPadding,p.queryRadius(z)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.h.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(A){this.symbolFadeHoldUntil=s.h.now()+A}setDependencies(A,b){const M={};for(const O of b)M[O]=!0;this.dependencies[A]=M}hasDependency(A,b){for(const M of A){const O=this.dependencies[M];if(O){for(const z of b)if(O[z])return!0}}return!1}}class tr{constructor(A,b){this.max=A,this.onRemove=b,this.reset()}reset(){for(const A in this.data)for(const b of this.data[A])b.timeout&&clearTimeout(b.timeout),this.onRemove(b.value);return this.data={},this.order=[],this}add(A,b,M){const O=A.wrapped().key;this.data[O]===void 0&&(this.data[O]=[]);const z={value:b,timeout:void 0};if(M!==void 0&&(z.timeout=setTimeout(()=>{this.remove(A,z)},M)),this.data[O].push(z),this.order.push(O),this.order.length>this.max){const J=this._getAndRemoveByKey(this.order[0]);J&&this.onRemove(J)}return this}has(A){return A.wrapped().key in this.data}getAndRemove(A){return this.has(A)?this._getAndRemoveByKey(A.wrapped().key):null}_getAndRemoveByKey(A){const b=this.data[A].shift();return b.timeout&&clearTimeout(b.timeout),this.data[A].length===0&&delete this.data[A],this.order.splice(this.order.indexOf(A),1),b.value}getByKey(A){const b=this.data[A];return b?b[0].value:null}get(A){return this.has(A)?this.data[A.wrapped().key][0].value:null}remove(A,b){if(!this.has(A))return this;const M=A.wrapped().key,O=b===void 0?0:this.data[M].indexOf(b),z=this.data[M][O];return this.data[M].splice(O,1),z.timeout&&clearTimeout(z.timeout),this.data[M].length===0&&delete this.data[M],this.onRemove(z.value),this.order.splice(this.order.indexOf(M),1),this}setMaxSize(A){for(this.max=A;this.order.length>this.max;){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}filter(A){const b=[];for(const M in this.data)for(const O of this.data[M])A(O.value)||b.push(O);for(const M of b)this.remove(M.value.tileID,M)}}class ht{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(A,b,M){const O=String(b);if(this.stateChanges[A]=this.stateChanges[A]||{},this.stateChanges[A][O]=this.stateChanges[A][O]||{},s.e(this.stateChanges[A][O],M),this.deletedStates[A]===null){this.deletedStates[A]={};for(const z in this.state[A])z!==O&&(this.deletedStates[A][z]=null)}else if(this.deletedStates[A]&&this.deletedStates[A][O]===null){this.deletedStates[A][O]={};for(const z in this.state[A][O])M[z]||(this.deletedStates[A][O][z]=null)}else for(const z in M)this.deletedStates[A]&&this.deletedStates[A][O]&&this.deletedStates[A][O][z]===null&&delete this.deletedStates[A][O][z]}removeFeatureState(A,b,M){if(this.deletedStates[A]===null)return;const O=String(b);if(this.deletedStates[A]=this.deletedStates[A]||{},M&&b!==void 0)this.deletedStates[A][O]!==null&&(this.deletedStates[A][O]=this.deletedStates[A][O]||{},this.deletedStates[A][O][M]=null);else if(b!==void 0)if(this.stateChanges[A]&&this.stateChanges[A][O])for(M in this.deletedStates[A][O]={},this.stateChanges[A][O])this.deletedStates[A][O][M]=null;else this.deletedStates[A][O]=null;else this.deletedStates[A]=null}getState(A,b){const M=String(b),O=s.e({},(this.state[A]||{})[M],(this.stateChanges[A]||{})[M]);if(this.deletedStates[A]===null)return{};if(this.deletedStates[A]){const z=this.deletedStates[A][b];if(z===null)return{};for(const J in z)delete O[J]}return O}initializeTileState(A,b){A.setFeatureState(this.state,b)}coalesceChanges(A,b){const M={};for(const O in this.stateChanges){this.state[O]=this.state[O]||{};const z={};for(const J in this.stateChanges[O])this.state[O][J]||(this.state[O][J]={}),s.e(this.state[O][J],this.stateChanges[O][J]),z[J]=this.state[O][J];M[O]=z}for(const O in this.deletedStates){this.state[O]=this.state[O]||{};const z={};if(this.deletedStates[O]===null)for(const J in this.state[O])z[J]={},this.state[O][J]={};else for(const J in this.deletedStates[O]){if(this.deletedStates[O][J]===null)this.state[O][J]={};else for(const w of Object.keys(this.deletedStates[O][J]))delete this.state[O][J][w];z[J]=this.state[O][J]}M[O]=M[O]||{},s.e(M[O],z)}if(this.stateChanges={},this.deletedStates={},Object.keys(M).length!==0)for(const O in A)A[O].setFeatureState(M,b)}}class $t extends s.E{constructor(A,b,M){super(),this.id=A,this.dispatcher=M,this.on("data",O=>{O.dataType==="source"&&O.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&O.dataType==="source"&&O.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((O,z,J,w)=>{const l=new(Fr(z.type))(O,z,J,w);if(l.id!==O)throw new Error(`Expected Source id to be ${O} instead of ${l.id}`);return l})(A,b,M,this),this._tiles={},this._cache=new tr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ht,this._didEmitContent=!1,this._updated=!1}onAdd(A){this.map=A,this._maxTileCacheSize=A?A._maxTileCacheSize:null,this._maxTileCacheZoomLevels=A?A._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(A)}onRemove(A){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(A)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const A in this._tiles){const b=this._tiles[A];if(b.state!=="loaded"&&b.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const A=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,A&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(A,b){return this._source.loadTile(A,b)}_unloadTile(A){if(this._source.unloadTile)return this._source.unloadTile(A,()=>{})}_abortTile(A){this._source.abortTile&&this._source.abortTile(A,()=>{}),this._source.fire(new s.k("dataabort",{tile:A,coord:A.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(A){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const b in this._tiles){const M=this._tiles[b];M.upload(A),M.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(A=>A.tileID).sort(or).map(A=>A.key)}getRenderableIds(A){const b=[];for(const M in this._tiles)this._isIdRenderable(M,A)&&b.push(this._tiles[M]);return A?b.sort((M,O)=>{const z=M.tileID,J=O.tileID,w=new s.P(z.canonical.x,z.canonical.y)._rotate(this.transform.angle),l=new s.P(J.canonical.x,J.canonical.y)._rotate(this.transform.angle);return z.overscaledZ-J.overscaledZ||l.y-w.y||l.x-w.x}).map(M=>M.tileID.key):b.map(M=>M.tileID).sort(or).map(M=>M.key)}hasRenderableParent(A){const b=this.findLoadedParent(A,0);return!!b&&this._isIdRenderable(b.tileID.key)}_isIdRenderable(A,b){return this._tiles[A]&&this._tiles[A].hasData()&&!this._coveredTiles[A]&&(b||!this._tiles[A].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const A in this._tiles)this._tiles[A].state!=="errored"&&this._reloadTile(A,"reloading")}}_reloadTile(A,b){const M=this._tiles[A];M&&(M.state!=="loading"&&(M.state=b),this._loadTile(M,this._tileLoaded.bind(this,M,A,b)))}_tileLoaded(A,b,M,O){if(O)return A.state="errored",void(O.status!==404?this._source.fire(new s.j(O,{tile:A})):this.update(this.transform,this.terrain));A.timeAdded=s.h.now(),M==="expired"&&(A.refreshedUponExpiration=!0),this._setTileReloadTimer(b,A),this.getSource().type==="raster-dem"&&A.dem&&this._backfillDEM(A),this._state.initializeTileState(A,this.map?this.map.painter:null),A.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:A,coord:A.tileID}))}_backfillDEM(A){const b=this.getRenderableIds();for(let O=0;O<b.length;O++){const z=b[O];if(A.neighboringTiles&&A.neighboringTiles[z]){const J=this.getTileByID(z);M(A,J),M(J,A)}}function M(O,z){O.needsHillshadePrepare=!0,O.needsTerrainPrepare=!0;let J=z.tileID.canonical.x-O.tileID.canonical.x;const w=z.tileID.canonical.y-O.tileID.canonical.y,l=Math.pow(2,O.tileID.canonical.z),p=z.tileID.key;J===0&&w===0||Math.abs(w)>1||(Math.abs(J)>1&&(Math.abs(J+l)===1?J+=l:Math.abs(J-l)===1&&(J-=l)),z.dem&&O.dem&&(O.dem.backfillBorder(z.dem,J,w),O.neighboringTiles&&O.neighboringTiles[p]&&(O.neighboringTiles[p].backfilled=!0)))}}getTile(A){return this.getTileByID(A.key)}getTileByID(A){return this._tiles[A]}_retainLoadedChildren(A,b,M,O){for(const z in this._tiles){let J=this._tiles[z];if(O[z]||!J.hasData()||J.tileID.overscaledZ<=b||J.tileID.overscaledZ>M)continue;let w=J.tileID;for(;J&&J.tileID.overscaledZ>b+1;){const p=J.tileID.scaledTo(J.tileID.overscaledZ-1);J=this._tiles[p.key],J&&J.hasData()&&(w=p)}let l=w;for(;l.overscaledZ>b;)if(l=l.scaledTo(l.overscaledZ-1),A[l.key]){O[w.key]=w;break}}}findLoadedParent(A,b){if(A.key in this._loadedParentTiles){const M=this._loadedParentTiles[A.key];return M&&M.tileID.overscaledZ>=b?M:null}for(let M=A.overscaledZ-1;M>=b;M--){const O=A.scaledTo(M),z=this._getLoadedTile(O);if(z)return z}}_getLoadedTile(A){const b=this._tiles[A.key];return b&&b.hasData()?b:this._cache.getByKey(A.wrapped().key)}updateCacheSize(A){const b=Math.ceil(A.width/this._source.tileSize)+1,M=Math.ceil(A.height/this._source.tileSize)+1,O=Math.floor(b*M*(this._maxTileCacheZoomLevels===null?s.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),z=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,O):O;this._cache.setMaxSize(z)}handleWrapJump(A){const b=Math.round((A-(this._prevLng===void 0?A:this._prevLng))/360);if(this._prevLng=A,b){const M={};for(const O in this._tiles){const z=this._tiles[O];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+b),M[z.tileID.key]=z}this._tiles=M;for(const O in this._timers)clearTimeout(this._timers[O]),delete this._timers[O];for(const O in this._tiles)this._setTileReloadTimer(O,this._tiles[O])}}update(A,b){if(this.transform=A,this.terrain=b,!this._sourceLoaded||this._paused)return;let M;this.updateCacheSize(A),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?M=A.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new s.O(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(M=A.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:b}),this._source.hasTile&&(M=M.filter(x=>this._source.hasTile(x)))):M=[];const O=A.coveringZoomLevel(this._source),z=Math.max(O-$t.maxOverzooming,this._source.minzoom),J=Math.max(O+$t.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const x={};for(const B of M)if(B.canonical.z>this._source.minzoom){const L=B.scaledTo(B.canonical.z-1);x[L.key]=L;const j=B.scaledTo(Math.max(this._source.minzoom,Math.min(B.canonical.z,5)));x[j.key]=j}M=M.concat(Object.values(x))}const w=M.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const l=this._updateRetainedTiles(M,O);if(mr(this._source.type)){const x={},B={},L=Object.keys(l),j=s.h.now();for(const _ of L){const E=l[_],F=this._tiles[_];if(!F||F.fadeEndTime!==0&&F.fadeEndTime<=j)continue;const V=this.findLoadedParent(E,z);V&&(this._addTile(V.tileID),x[V.tileID.key]=V.tileID),B[_]=E}this._retainLoadedChildren(B,O,J,l);for(const _ in x)l[_]||(this._coveredTiles[_]=!0,l[_]=x[_]);if(b){const _={},E={};for(const F of M)this._tiles[F.key].hasData()?_[F.key]=F:E[F.key]=F;for(const F in E){const V=E[F].children(this._source.maxzoom);this._tiles[V[0].key]&&this._tiles[V[1].key]&&this._tiles[V[2].key]&&this._tiles[V[3].key]&&(_[V[0].key]=l[V[0].key]=V[0],_[V[1].key]=l[V[1].key]=V[1],_[V[2].key]=l[V[2].key]=V[2],_[V[3].key]=l[V[3].key]=V[3],delete E[F])}for(const F in E){const V=this.findLoadedParent(E[F],this._source.minzoom);if(V){_[V.tileID.key]=l[V.tileID.key]=V.tileID;for(const q in _)_[q].isChildOf(V.tileID)&&delete _[q]}}for(const F in this._tiles)_[F]||(this._coveredTiles[F]=!0)}}for(const x in l)this._tiles[x].clearFadeHold();const p=s.ab(this._tiles,l);for(const x of p){const B=this._tiles[x];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(x)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const A in this._tiles)this._tiles[A].holdingForFade()&&this._removeTile(A)}_updateRetainedTiles(A,b){const M={},O={},z=Math.max(b-$t.maxOverzooming,this._source.minzoom),J=Math.max(b+$t.maxUnderzooming,this._source.minzoom),w={};for(const l of A){const p=this._addTile(l);M[l.key]=l,p.hasData()||b<this._source.maxzoom&&(w[l.key]=l)}this._retainLoadedChildren(w,b,J,M);for(const l of A){let p=this._tiles[l.key];if(p.hasData())continue;if(b+1>this._source.maxzoom){const B=l.children(this._source.maxzoom)[0],L=this.getTile(B);if(L&&L.hasData()){M[B.key]=B;continue}}else{const B=l.children(this._source.maxzoom);if(M[B[0].key]&&M[B[1].key]&&M[B[2].key]&&M[B[3].key])continue}let x=p.wasRequested();for(let B=l.overscaledZ-1;B>=z;--B){const L=l.scaledTo(B);if(O[L.key])break;if(O[L.key]=!0,p=this.getTile(L),!p&&x&&(p=this._addTile(L)),p){const j=p.hasData();if((x||j)&&(M[L.key]=L),x=p.wasRequested(),j)break}}}return M}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const A in this._tiles){const b=[];let M,O=this._tiles[A].tileID;for(;O.overscaledZ>0;){if(O.key in this._loadedParentTiles){M=this._loadedParentTiles[O.key];break}b.push(O.key);const z=O.scaledTo(O.overscaledZ-1);if(M=this._getLoadedTile(z),M)break;O=z}for(const z of b)this._loadedParentTiles[z]=M}}_addTile(A){let b=this._tiles[A.key];if(b)return b;b=this._cache.getAndRemove(A),b&&(this._setTileReloadTimer(A.key,b),b.tileID=A,this._state.initializeTileState(b,this.map?this.map.painter:null),this._cacheTimers[A.key]&&(clearTimeout(this._cacheTimers[A.key]),delete this._cacheTimers[A.key],this._setTileReloadTimer(A.key,b)));const M=b;return b||(b=new Ur(A,this._source.tileSize*A.overscaleFactor()),this._loadTile(b,this._tileLoaded.bind(this,b,A.key,b.state))),b.uses++,this._tiles[A.key]=b,M||this._source.fire(new s.k("dataloading",{tile:b,coord:b.tileID,dataType:"source"})),b}_setTileReloadTimer(A,b){A in this._timers&&(clearTimeout(this._timers[A]),delete this._timers[A]);const M=b.getExpiryTimeout();M&&(this._timers[A]=setTimeout(()=>{this._reloadTile(A,"expired"),delete this._timers[A]},M))}_removeTile(A){const b=this._tiles[A];b&&(b.uses--,delete this._tiles[A],this._timers[A]&&(clearTimeout(this._timers[A]),delete this._timers[A]),b.uses>0||(b.hasData()&&b.state!=="reloading"?this._cache.add(b.tileID,b,b.getExpiryTimeout()):(b.aborted=!0,this._abortTile(b),this._unloadTile(b))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const A in this._tiles)this._removeTile(A);this._cache.reset()}tilesIn(A,b,M){const O=[],z=this.transform;if(!z)return O;const J=M?z.getCameraQueryGeometry(A):A,w=A.map(_=>z.pointCoordinate(_,this.terrain)),l=J.map(_=>z.pointCoordinate(_,this.terrain)),p=this.getIds();let x=1/0,B=1/0,L=-1/0,j=-1/0;for(const _ of l)x=Math.min(x,_.x),B=Math.min(B,_.y),L=Math.max(L,_.x),j=Math.max(j,_.y);for(let _=0;_<p.length;_++){const E=this._tiles[p[_]];if(E.holdingForFade())continue;const F=E.tileID,V=Math.pow(2,z.zoom-E.tileID.overscaledZ),q=b*E.queryPadding*s.N/E.tileSize/V,K=[F.getTilePoint(new s.U(x,B)),F.getTilePoint(new s.U(L,j))];if(K[0].x-q<s.N&&K[0].y-q<s.N&&K[1].x+q>=0&&K[1].y+q>=0){const te=w.map(oe=>F.getTilePoint(oe)),se=l.map(oe=>F.getTilePoint(oe));O.push({tile:E,tileID:F,queryGeometry:te,cameraQueryGeometry:se,scale:V})}}return O}getVisibleCoordinates(A){const b=this.getRenderableIds(A).map(M=>this._tiles[M].tileID);for(const M of b)M.posMatrix=this.transform.calculatePosMatrix(M.toUnwrapped());return b}hasTransition(){if(this._source.hasTransition())return!0;if(mr(this._source.type)){const A=s.h.now();for(const b in this._tiles)if(this._tiles[b].fadeEndTime>=A)return!0}return!1}setFeatureState(A,b,M){this._state.updateState(A=A||"_geojsonTileLayer",b,M)}removeFeatureState(A,b,M){this._state.removeFeatureState(A=A||"_geojsonTileLayer",b,M)}getFeatureState(A,b){return this._state.getState(A=A||"_geojsonTileLayer",b)}setDependencies(A,b,M){const O=this._tiles[A];O&&O.setDependencies(b,M)}reloadTilesForDependencies(A,b){for(const M in this._tiles)this._tiles[M].hasDependency(A,b)&&this._reloadTile(M,"reloading");this._cache.filter(M=>!M.hasDependency(A,b))}}function or(N,A){const b=Math.abs(2*N.wrap)-+(N.wrap<0),M=Math.abs(2*A.wrap)-+(A.wrap<0);return N.overscaledZ-A.overscaledZ||M-b||A.canonical.y-N.canonical.y||A.canonical.x-N.canonical.x}function mr(N){return N==="raster"||N==="image"||N==="video"}$t.maxOverzooming=10,$t.maxUnderzooming=3;const ur="mapboxgl_preloaded_worker_pool";class Wr{constructor(){this.active={}}acquire(A){if(!this.workers)for(this.workers=[];this.workers.length<Wr.workerCount;)this.workers.push(new Worker(s.c.WORKER_URL));return this.active[A]=!0,this.workers.slice()}release(A){delete this.active[A],this.numActive()===0&&(this.workers.forEach(b=>{b.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ur]}numActive(){return Object.keys(this.active).length}}const ri=Math.floor(s.h.hardwareConcurrency/2);let gi;function Pi(){return gi||(gi=new Wr),gi}Wr.workerCount=s.ac(globalThis)?Math.max(Math.min(ri,3),1):1;class zt{constructor(A,b){this.reset(A,b)}reset(A,b){this.points=A||[],this._distances=[0];for(let M=1;M<this.points.length;M++)this._distances[M]=this._distances[M-1]+this.points[M].dist(this.points[M-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(b||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(A){if(this.points.length===1)return this.points[0];A=s.ad(A,0,1);let b=1,M=this._distances[b];const O=A*this.paddedLength+this.padding;for(;M<O&&b<this._distances.length;)M=this._distances[++b];const z=b-1,J=this._distances[z],w=M-J,l=w>0?(O-J)/w:0;return this.points[z].mult(1-l).add(this.points[b].mult(l))}}function Xr(N,A){let b=!0;return N==="always"||N!=="never"&&A!=="never"||(b=!1),b}class Ar{constructor(A,b,M){const O=this.boxCells=[],z=this.circleCells=[];this.xCellCount=Math.ceil(A/M),this.yCellCount=Math.ceil(b/M);for(let J=0;J<this.xCellCount*this.yCellCount;J++)O.push([]),z.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=A,this.height=b,this.xScale=this.xCellCount/A,this.yScale=this.yCellCount/b,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(A,b,M,O,z){this._forEachCell(b,M,O,z,this._insertBoxCell,this.boxUid++),this.boxKeys.push(A),this.bboxes.push(b),this.bboxes.push(M),this.bboxes.push(O),this.bboxes.push(z)}insertCircle(A,b,M,O){this._forEachCell(b-O,M-O,b+O,M+O,this._insertCircleCell,this.circleUid++),this.circleKeys.push(A),this.circles.push(b),this.circles.push(M),this.circles.push(O)}_insertBoxCell(A,b,M,O,z,J){this.boxCells[z].push(J)}_insertCircleCell(A,b,M,O,z,J){this.circleCells[z].push(J)}_query(A,b,M,O,z,J,w){if(M<0||A>this.width||O<0||b>this.height)return[];const l=[];if(A<=0&&b<=0&&this.width<=M&&this.height<=O){if(z)return[{key:null,x1:A,y1:b,x2:M,y2:O}];for(let p=0;p<this.boxKeys.length;p++)l.push({key:this.boxKeys[p],x1:this.bboxes[4*p],y1:this.bboxes[4*p+1],x2:this.bboxes[4*p+2],y2:this.bboxes[4*p+3]});for(let p=0;p<this.circleKeys.length;p++){const x=this.circles[3*p],B=this.circles[3*p+1],L=this.circles[3*p+2];l.push({key:this.circleKeys[p],x1:x-L,y1:B-L,x2:x+L,y2:B+L})}}else this._forEachCell(A,b,M,O,this._queryCell,l,{hitTest:z,overlapMode:J,seenUids:{box:{},circle:{}}},w);return l}query(A,b,M,O){return this._query(A,b,M,O,!1,null)}hitTest(A,b,M,O,z,J){return this._query(A,b,M,O,!0,z,J).length>0}hitTestCircle(A,b,M,O,z){const J=A-M,w=A+M,l=b-M,p=b+M;if(w<0||J>this.width||p<0||l>this.height)return!1;const x=[];return this._forEachCell(J,l,w,p,this._queryCellCircle,x,{hitTest:!0,overlapMode:O,circle:{x:A,y:b,radius:M},seenUids:{box:{},circle:{}}},z),x.length>0}_queryCell(A,b,M,O,z,J,w,l){const{seenUids:p,hitTest:x,overlapMode:B}=w,L=this.boxCells[z];if(L!==null){const _=this.bboxes;for(const E of L)if(!p.box[E]){p.box[E]=!0;const F=4*E,V=this.boxKeys[E];if(A<=_[F+2]&&b<=_[F+3]&&M>=_[F+0]&&O>=_[F+1]&&(!l||l(V))&&(!x||!Xr(B,V.overlapMode))&&(J.push({key:V,x1:_[F],y1:_[F+1],x2:_[F+2],y2:_[F+3]}),x))return!0}}const j=this.circleCells[z];if(j!==null){const _=this.circles;for(const E of j)if(!p.circle[E]){p.circle[E]=!0;const F=3*E,V=this.circleKeys[E];if(this._circleAndRectCollide(_[F],_[F+1],_[F+2],A,b,M,O)&&(!l||l(V))&&(!x||!Xr(B,V.overlapMode))){const q=_[F],K=_[F+1],te=_[F+2];if(J.push({key:V,x1:q-te,y1:K-te,x2:q+te,y2:K+te}),x)return!0}}}return!1}_queryCellCircle(A,b,M,O,z,J,w,l){const{circle:p,seenUids:x,overlapMode:B}=w,L=this.boxCells[z];if(L!==null){const _=this.bboxes;for(const E of L)if(!x.box[E]){x.box[E]=!0;const F=4*E,V=this.boxKeys[E];if(this._circleAndRectCollide(p.x,p.y,p.radius,_[F+0],_[F+1],_[F+2],_[F+3])&&(!l||l(V))&&!Xr(B,V.overlapMode))return J.push(!0),!0}}const j=this.circleCells[z];if(j!==null){const _=this.circles;for(const E of j)if(!x.circle[E]){x.circle[E]=!0;const F=3*E,V=this.circleKeys[E];if(this._circlesCollide(_[F],_[F+1],_[F+2],p.x,p.y,p.radius)&&(!l||l(V))&&!Xr(B,V.overlapMode))return J.push(!0),!0}}}_forEachCell(A,b,M,O,z,J,w,l){const p=this._convertToXCellCoord(A),x=this._convertToYCellCoord(b),B=this._convertToXCellCoord(M),L=this._convertToYCellCoord(O);for(let j=p;j<=B;j++)for(let _=x;_<=L;_++)if(z.call(this,A,b,M,O,this.xCellCount*_+j,J,w,l))return}_convertToXCellCoord(A){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(A*this.xScale)))}_convertToYCellCoord(A){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(A*this.yScale)))}_circlesCollide(A,b,M,O,z,J){const w=O-A,l=z-b,p=M+J;return p*p>w*w+l*l}_circleAndRectCollide(A,b,M,O,z,J,w){const l=(J-O)/2,p=Math.abs(A-(O+l));if(p>l+M)return!1;const x=(w-z)/2,B=Math.abs(b-(z+x));if(B>x+M)return!1;if(p<=l||B<=x)return!0;const L=p-l,j=B-x;return L*L+j*j<=M*M}}function Wt(N,A,b,M,O){const z=s.Z();return A?(s.a0(z,z,[1/O,1/O,1]),b||s.ae(z,z,M.angle)):s.a1(z,M.labelPlaneMatrix,N),z}function di(N,A,b,M,O){if(A){const z=s.af(N);return s.a0(z,z,[O,O,1]),b||s.ae(z,z,-M.angle),z}return M.glCoordMatrix}function Qt(N,A,b){let M;b?(M=[N.x,N.y,b(N.x,N.y),1],s.ag(M,M,A)):(M=[N.x,N.y,0,1],xe(M,M,A));const O=M[3];return{point:new s.P(M[0]/O,M[1]/O),signedDistanceFromCamera:O}}function Tr(N,A){return .5+N/A*.5}function Lr(N,A){const b=N[0]/N[3],M=N[1]/N[3];return b>=-A[0]&&b<=A[0]&&M>=-A[1]&&M<=A[1]}function Xt(N,A,b,M,O,z,J,w,l,p){const x=M?N.textSizeData:N.iconSizeData,B=s.ah(x,b.transform.zoom),L=[256/b.width*2+1,256/b.height*2+1],j=M?N.text.dynamicLayoutVertexArray:N.icon.dynamicLayoutVertexArray;j.clear();const _=N.lineVertexArray,E=M?N.text.placedSymbolArray:N.icon.placedSymbolArray,F=b.transform.width/b.transform.height;let V=!1;for(let q=0;q<E.length;q++){const K=E.get(q);if(K.hidden||K.writingMode===s.ai.vertical&&!V){ge(K.numGlyphs,j);continue}let te;if(V=!1,p?(te=[K.anchorX,K.anchorY,p(K.anchorX,K.anchorY),1],s.ag(te,te,A)):(te=[K.anchorX,K.anchorY,0,1],xe(te,te,A)),!Lr(te,L)){ge(K.numGlyphs,j);continue}const se=Tr(b.transform.cameraToCenterDistance,te[3]),oe=s.aj(x,B,K),le=J?oe/se:oe*se,_e=new s.P(K.anchorX,K.anchorY),Ie=Qt(_e,O,p).point,ve={projections:{},offsets:{}},Se=vi(K,le,!1,w,A,O,z,N.glyphOffsetArray,_,j,Ie,_e,ve,F,l,p);V=Se.useVertical,(Se.notEnoughRoom||V||Se.needsFlipping&&vi(K,le,!0,w,A,O,z,N.glyphOffsetArray,_,j,Ie,_e,ve,F,l,p).notEnoughRoom)&&ge(K.numGlyphs,j)}M?N.text.dynamicLayoutVertexBuffer.updateData(j):N.icon.dynamicLayoutVertexBuffer.updateData(j)}function xr(N,A,b,M,O,z,J,w,l,p,x,B,L){const j=w.glyphStartIndex+w.numGlyphs,_=w.lineStartIndex,E=w.lineStartIndex+w.lineLength,F=A.getoffsetX(w.glyphStartIndex),V=A.getoffsetX(j-1),q=re(N*F,b,M,O,z,J,w.segment,_,E,l,p,x,B,L);if(!q)return null;const K=re(N*V,b,M,O,z,J,w.segment,_,E,l,p,x,B,L);return K?{first:q,last:K}:null}function er(N,A,b,M){return N===s.ai.horizontal&&Math.abs(b.y-A.y)>Math.abs(b.x-A.x)*M?{useVertical:!0}:(N===s.ai.vertical?A.y<b.y:A.x>b.x)?{needsFlipping:!0}:null}function vi(N,A,b,M,O,z,J,w,l,p,x,B,L,j,_,E){const F=A/24,V=N.lineOffsetX*F,q=N.lineOffsetY*F;let K;if(N.numGlyphs>1){const te=N.glyphStartIndex+N.numGlyphs,se=N.lineStartIndex,oe=N.lineStartIndex+N.lineLength,le=xr(F,w,V,q,b,x,B,N,l,z,L,_,E);if(!le)return{notEnoughRoom:!0};const _e=Qt(le.first.point,J,E).point,Ie=Qt(le.last.point,J,E).point;if(M&&!b){const ve=er(N.writingMode,_e,Ie,j);if(ve)return ve}K=[le.first];for(let ve=N.glyphStartIndex+1;ve<te-1;ve++)K.push(re(F*w.getoffsetX(ve),V,q,b,x,B,N.segment,se,oe,l,z,L,_,E));K.push(le.last)}else{if(M&&!b){const se=Qt(B,O,E).point,oe=N.lineStartIndex+N.segment+1,le=new s.P(l.getx(oe),l.gety(oe)),_e=Qt(le,O,E),Ie=_e.signedDistanceFromCamera>0?_e.point:Zi(B,le,se,1,O,E),ve=er(N.writingMode,se,Ie,j);if(ve)return ve}const te=re(F*w.getoffsetX(N.glyphStartIndex),V,q,b,x,B,N.segment,N.lineStartIndex,N.lineStartIndex+N.lineLength,l,z,L,_,E);if(!te)return{notEnoughRoom:!0};K=[te]}for(const te of K)s.ak(p,te.point,te.angle);return{}}function Zi(N,A,b,M,O,z){const J=Qt(N.add(N.sub(A)._unit()),O,z).point,w=b.sub(J);return b.add(w._mult(M/w.mag()))}function Qe(N,A){const{projectionCache:b,lineVertexArray:M,labelPlaneMatrix:O,tileAnchorPoint:z,distanceFromAnchor:J,getElevation:w,previousVertex:l,direction:p,absOffsetX:x}=A;if(b.projections[N])return b.projections[N];const B=new s.P(M.getx(N),M.gety(N)),L=Qt(B,O,w);if(L.signedDistanceFromCamera>0)return b.projections[N]=L.point,L.point;const j=N-p;return Zi(J===0?z:new s.P(M.getx(j),M.gety(j)),B,l,x-J+1,O,w)}function Be(N,A,b){return N._unit()._perp()._mult(A*b)}function ue(N,A,b,M,O,z,J,w){const{projectionCache:l,direction:p}=w;if(l.offsets[N])return l.offsets[N];const x=b.add(A);if(N+p<M||N+p>=O)return l.offsets[N]=x,x;const B=Qe(N+p,w),L=Be(B.sub(b),J,p),j=b.add(L),_=B.add(L);return l.offsets[N]=s.al(z,x,j,_)||x,l.offsets[N]}function re(N,A,b,M,O,z,J,w,l,p,x,B,L,j){const _=M?N-A:N+A;let E=_>0?1:-1,F=0;M&&(E*=-1,F=Math.PI),E<0&&(F+=Math.PI);let V,q,K=E>0?w+J:w+J+1,te=O,se=O,oe=0,le=0;const _e=Math.abs(_),Ie=[];let ve;for(;oe+le<=_e;){if(K+=E,K<w||K>=l)return null;oe+=le,se=te,q=V;const Oe={projectionCache:B,lineVertexArray:p,labelPlaneMatrix:x,tileAnchorPoint:z,distanceFromAnchor:oe,getElevation:j,previousVertex:se,direction:E,absOffsetX:_e};if(te=Qe(K,Oe),b===0)Ie.push(se),ve=te.sub(se);else{let Re;const Ve=te.sub(se);Re=Ve.mag()===0?Be(Qe(K+E,Oe).sub(te),b,E):Be(Ve,b,E),q||(q=se.add(Re)),V=ue(K,Re,te,w,l,q,b,Oe),Ie.push(q),ve=V.sub(q)}le=ve.mag()}const Se=ve._mult((_e-oe)/le)._add(q||se),et=F+Math.atan2(te.y-se.y,te.x-se.x);return Ie.push(Se),{point:Se,angle:L?et:0,path:Ie}}const Ae=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ge(N,A){for(let b=0;b<N;b++){const M=A.length;A.resize(M+4),A.float32.set(Ae,3*M)}}function xe(N,A,b){const M=A[0],O=A[1];return N[0]=b[0]*M+b[4]*O+b[12],N[1]=b[1]*M+b[5]*O+b[13],N[3]=b[3]*M+b[7]*O+b[15],N}const Ee=100;class we{constructor(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Ar(A.width+200,A.height+200,25),M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Ar(A.width+200,A.height+200,25);this.transform=A,this.grid=b,this.ignoredGrid=M,this.pitchfactor=Math.cos(A._pitch)*A.cameraToCenterDistance,this.screenRightBoundary=A.width+Ee,this.screenBottomBoundary=A.height+Ee,this.gridRightBoundary=A.width+200,this.gridBottomBoundary=A.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(A,b,M,O,z,J){const w=this.projectAndGetPerspectiveRatio(O,A.anchorPointX,A.anchorPointY,J),l=M*w.perspectiveRatio,p=A.x1*l+w.point.x,x=A.y1*l+w.point.y,B=A.x2*l+w.point.x,L=A.y2*l+w.point.y;return!this.isInsideGrid(p,x,B,L)||b!=="always"&&this.grid.hitTest(p,x,B,L,b,z)||w.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[p,x,B,L],offscreen:this.isOffscreen(p,x,B,L)}}placeCollisionCircles(A,b,M,O,z,J,w,l,p,x,B,L,j,_){const E=[],F=new s.P(b.anchorX,b.anchorY),V=Qt(F,J,_),q=Tr(this.transform.cameraToCenterDistance,V.signedDistanceFromCamera),K=(x?z/q:z*q)/s.ap,te=Qt(F,w,_).point,se=xr(K,O,b.lineOffsetX*K,b.lineOffsetY*K,!1,te,F,b,M,w,{projections:{},offsets:{}},!1,_);let oe=!1,le=!1,_e=!0;if(se){const Ie=.5*L*q+j,ve=new s.P(-100,-100),Se=new s.P(this.screenRightBoundary,this.screenBottomBoundary),et=new zt,Oe=se.first,Re=se.last;let Ve=[];for(let ft=Oe.path.length-1;ft>=1;ft--)Ve.push(Oe.path[ft]);for(let ft=1;ft<Re.path.length;ft++)Ve.push(Re.path[ft]);const At=2.5*Ie;if(l){const ft=Ve.map(Nt=>Qt(Nt,l,_));Ve=ft.some(Nt=>Nt.signedDistanceFromCamera<=0)?[]:ft.map(Nt=>Nt.point)}let dt=[];if(Ve.length>0){const ft=Ve[0].clone(),Nt=Ve[0].clone();for(let It=1;It<Ve.length;It++)ft.x=Math.min(ft.x,Ve[It].x),ft.y=Math.min(ft.y,Ve[It].y),Nt.x=Math.max(Nt.x,Ve[It].x),Nt.y=Math.max(Nt.y,Ve[It].y);dt=ft.x>=ve.x&&Nt.x<=Se.x&&ft.y>=ve.y&&Nt.y<=Se.y?[Ve]:Nt.x<ve.x||ft.x>Se.x||Nt.y<ve.y||ft.y>Se.y?[]:s.am([Ve],ve.x,ve.y,Se.x,Se.y)}for(const ft of dt){et.reset(ft,.25*Ie);let Nt=0;Nt=et.length<=.5*Ie?1:Math.ceil(et.paddedLength/At)+1;for(let It=0;It<Nt;It++){const jt=It/Math.max(Nt-1,1),Ht=et.lerp(jt),Pr=Ht.x+Ee,yr=Ht.y+Ee;E.push(Pr,yr,Ie,0);const Ir=Pr-Ie,hr=yr-Ie,li=Pr+Ie,ti=yr+Ie;if(_e=_e&&this.isOffscreen(Ir,hr,li,ti),le=le||this.isInsideGrid(Ir,hr,li,ti),A!=="always"&&this.grid.hitTestCircle(Pr,yr,Ie,A,B)&&(oe=!0,!p))return{circles:[],offscreen:!1,collisionDetected:oe}}}}return{circles:!p&&oe||!le||q<this.perspectiveRatioCutoff?[]:E,offscreen:_e,collisionDetected:oe}}queryRenderedSymbols(A){if(A.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const b=[];let M=1/0,O=1/0,z=-1/0,J=-1/0;for(const x of A){const B=new s.P(x.x+Ee,x.y+Ee);M=Math.min(M,B.x),O=Math.min(O,B.y),z=Math.max(z,B.x),J=Math.max(J,B.y),b.push(B)}const w=this.grid.query(M,O,z,J).concat(this.ignoredGrid.query(M,O,z,J)),l={},p={};for(const x of w){const B=x.key;if(l[B.bucketInstanceId]===void 0&&(l[B.bucketInstanceId]={}),l[B.bucketInstanceId][B.featureIndex])continue;const L=[new s.P(x.x1,x.y1),new s.P(x.x2,x.y1),new s.P(x.x2,x.y2),new s.P(x.x1,x.y2)];s.an(b,L)&&(l[B.bucketInstanceId][B.featureIndex]=!0,p[B.bucketInstanceId]===void 0&&(p[B.bucketInstanceId]=[]),p[B.bucketInstanceId].push(B.featureIndex))}return p}insertCollisionBox(A,b,M,O,z,J){(M?this.ignoredGrid:this.grid).insert({bucketInstanceId:O,featureIndex:z,collisionGroupID:J,overlapMode:b},A[0],A[1],A[2],A[3])}insertCollisionCircles(A,b,M,O,z,J){const w=M?this.ignoredGrid:this.grid,l={bucketInstanceId:O,featureIndex:z,collisionGroupID:J,overlapMode:b};for(let p=0;p<A.length;p+=4)w.insertCircle(l,A[p],A[p+1],A[p+2])}projectAndGetPerspectiveRatio(A,b,M,O){let z;return O?(z=[b,M,O(b,M),1],s.ag(z,z,A)):(z=[b,M,0,1],xe(z,z,A)),{point:new s.P((z[0]/z[3]+1)/2*this.transform.width+Ee,(-z[1]/z[3]+1)/2*this.transform.height+Ee),perspectiveRatio:.5+this.transform.cameraToCenterDistance/z[3]*.5}}isOffscreen(A,b,M,O){return M<Ee||A>=this.screenRightBoundary||O<Ee||b>this.screenBottomBoundary}isInsideGrid(A,b,M,O){return M>=0&&A<this.gridRightBoundary&&O>=0&&b<this.gridBottomBoundary}getViewportMatrix(){const A=s.ao([]);return s.$(A,A,[-100,-100,0]),A}}function Fe(N,A,b){return A*(s.N/(N.tileSize*Math.pow(2,b-N.tileID.overscaledZ)))}class ze{constructor(A,b,M,O){this.opacity=A?Math.max(0,Math.min(1,A.opacity+(A.placed?b:-b))):O&&M?1:0,this.placed=M}isHidden(){return this.opacity===0&&!this.placed}}class Ge{constructor(A,b,M,O,z){this.text=new ze(A?A.text:null,b,M,z),this.icon=new ze(A?A.icon:null,b,O,z)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class st{constructor(A,b,M){this.text=A,this.icon=b,this.skipFade=M}}class vt{constructor(){this.invProjMatrix=s.Z(),this.viewportMatrix=s.Z(),this.circles=[]}}class Tt{constructor(A,b,M,O,z){this.bucketInstanceId=A,this.featureIndex=b,this.sourceLayerIndex=M,this.bucketIndex=O,this.tileID=z}}class Kt{constructor(A){this.crossSourceCollisions=A,this.maxGroupID=0,this.collisionGroups={}}get(A){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[A]){const b=++this.maxGroupID;this.collisionGroups[A]={ID:b,predicate:M=>M.collisionGroupID===b}}return this.collisionGroups[A]}}function rr(N,A,b,M,O){const{horizontalAlign:z,verticalAlign:J}=s.au(N);return new s.P(-(z-.5)*A+M[0]*O,-(J-.5)*b+M[1]*O)}function Gt(N,A,b,M,O,z){const{x1:J,x2:w,y1:l,y2:p,anchorPointX:x,anchorPointY:B}=N,L=new s.P(A,b);return M&&L._rotate(O?z:-z),{x1:J+L.x,y1:l+L.y,x2:w+L.x,y2:p+L.y,anchorPointX:x,anchorPointY:B}}class dr{constructor(A,b,M,O,z){this.transform=A.clone(),this.terrain=b,this.collisionIndex=new we(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=M,this.retainedQueryData={},this.collisionGroups=new Kt(O),this.collisionCircleArrays={},this.prevPlacement=z,z&&(z.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(A,b,M,O){const z=M.getBucket(b),J=M.latestFeatureIndex;if(!z||!J||b.id!==z.layerIds[0])return;const w=M.collisionBoxArray,l=z.layers[0].layout,p=Math.pow(2,this.transform.zoom-M.tileID.overscaledZ),x=M.tileSize/s.N,B=this.transform.calculatePosMatrix(M.tileID.toUnwrapped()),L=l.get("text-pitch-alignment")==="map",j=l.get("text-rotation-alignment")==="map",_=Fe(M,1,this.transform.zoom),E=Wt(B,L,j,this.transform,_);let F=null;if(L){const q=di(B,L,j,this.transform,_);F=s.a1([],this.transform.labelPlaneMatrix,q)}this.retainedQueryData[z.bucketInstanceId]=new Tt(z.bucketInstanceId,J,z.sourceLayerIndex,z.index,M.tileID);const V={bucket:z,layout:l,posMatrix:B,textLabelPlaneMatrix:E,labelToScreenMatrix:F,scale:p,textPixelRatio:x,holdingForFade:M.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:s.ah(z.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(z.sourceID)};if(O)for(const q of z.sortKeyRanges){const{sortKey:K,symbolInstanceStart:te,symbolInstanceEnd:se}=q;A.push({sortKey:K,symbolInstanceStart:te,symbolInstanceEnd:se,parameters:V})}else A.push({symbolInstanceStart:0,symbolInstanceEnd:z.symbolInstances.length,parameters:V})}attemptAnchorPlacement(A,b,M,O,z,J,w,l,p,x,B,L,j,_,E,F){const V=s.aq[A.textAnchor],q=[A.textOffset0,A.textOffset1],K=rr(V,M,O,q,z),te=this.collisionIndex.placeCollisionBox(Gt(b,K.x,K.y,J,w,this.transform.angle),B,l,p,x.predicate,F);if((!E||this.collisionIndex.placeCollisionBox(Gt(E,K.x,K.y,J,w,this.transform.angle),B,l,p,x.predicate,F).box.length!==0)&&te.box.length>0){let se;if(this.prevPlacement&&this.prevPlacement.variableOffsets[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID]&&this.prevPlacement.placements[L.crossTileID].text&&(se=this.prevPlacement.variableOffsets[L.crossTileID].anchor),L.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[L.crossTileID]={textOffset:q,width:M,height:O,anchor:V,textBoxScale:z,prevAnchor:se},this.markUsedJustification(j,V,L,_),j.allowVerticalPlacement&&(this.markUsedOrientation(j,_,L),this.placedOrientations[L.crossTileID]=_),{shift:K,placedGlyphBoxes:te}}}placeLayerBucketPart(A,b,M){const{bucket:O,layout:z,posMatrix:J,textLabelPlaneMatrix:w,labelToScreenMatrix:l,textPixelRatio:p,holdingForFade:x,collisionBoxArray:B,partiallyEvaluatedTextSize:L,collisionGroup:j}=A.parameters,_=z.get("text-optional"),E=z.get("icon-optional"),F=s.ar(z,"text-overlap","text-allow-overlap"),V=F==="always",q=s.ar(z,"icon-overlap","icon-allow-overlap"),K=q==="always",te=z.get("text-rotation-alignment")==="map",se=z.get("text-pitch-alignment")==="map",oe=z.get("icon-text-fit")!=="none",le=z.get("symbol-z-order")==="viewport-y",_e=V&&(K||!O.hasIconData()||E),Ie=K&&(V||!O.hasTextData()||_);!O.collisionArrays&&B&&O.deserializeCollisionBoxes(B);const ve=this.retainedQueryData[O.bucketInstanceId].tileID,Se=this.terrain?(Oe,Re)=>this.terrain.getElevation(ve,Oe,Re):null,et=(Oe,Re)=>{var Ve,At;if(b[Oe.crossTileID])return;if(x)return void(this.placements[Oe.crossTileID]=new st(!1,!1,!1));let dt=!1,ft=!1,Nt=!0,It=null,jt={box:null,offscreen:null},Ht={box:null,offscreen:null},Pr=null,yr=null,Ir=null,hr=0,li=0,ti=0;Re.textFeatureIndex?hr=Re.textFeatureIndex:Oe.useRuntimeCollisionCircles&&(hr=Oe.featureIndex),Re.verticalTextFeatureIndex&&(li=Re.verticalTextFeatureIndex);const ii=Re.textBox;if(ii){const wi=Wi=>{let Oi=s.ai.horizontal;if(O.allowVerticalPlacement&&!Wi&&this.prevPlacement){const Xi=this.prevPlacement.placedOrientations[Oe.crossTileID];Xi&&(this.placedOrientations[Oe.crossTileID]=Xi,Oi=Xi,this.markUsedOrientation(O,Oi,Oe))}return Oi},Ki=(Wi,Oi)=>{if(O.allowVerticalPlacement&&Oe.numVerticalGlyphVertices>0&&Re.verticalTextBox){for(const Xi of O.writingModes)if(Xi===s.ai.vertical?(jt=Oi(),Ht=jt):jt=Wi(),jt&&jt.box&&jt.box.length)break}else jt=Wi()},xi=Oe.textAnchorOffsetStartIndex,Zn=Oe.textAnchorOffsetEndIndex;if(Zn===xi){const Wi=(Oi,Xi)=>{const hi=this.collisionIndex.placeCollisionBox(Oi,F,p,J,j.predicate,Se);return hi&&hi.box&&hi.box.length&&(this.markUsedOrientation(O,Xi,Oe),this.placedOrientations[Oe.crossTileID]=Xi),hi};Ki(()=>Wi(ii,s.ai.horizontal),()=>{const Oi=Re.verticalTextBox;return O.allowVerticalPlacement&&Oe.numVerticalGlyphVertices>0&&Oi?Wi(Oi,s.ai.vertical):{box:null,offscreen:null}}),wi(jt&&jt.box&&jt.box.length)}else{let Wi=s.aq[(At=(Ve=this.prevPlacement)===null||Ve===void 0?void 0:Ve.variableOffsets[Oe.crossTileID])===null||At===void 0?void 0:At.anchor];const Oi=(hi,zi,on)=>{const rs=hi.x2-hi.x1,an=hi.y2-hi.y1,is=Oe.textBoxScale,Es=oe&&q==="never"?zi:null;let yi={box:[],offscreen:!1},bn=F==="never"?1:2,ia="never";Wi&&bn++;for(let Ns=0;Ns<bn;Ns++){for(let so=xi;so<Zn;so++){const xl=O.textAnchorOffsets.get(so);if(Wi&&xl.textAnchor!==Wi)continue;const bo=this.attemptAnchorPlacement(xl,hi,rs,an,is,te,se,p,J,j,ia,Oe,O,on,Es,Se);if(bo&&(yi=bo.placedGlyphBoxes,yi&&yi.box&&yi.box.length))return dt=!0,It=bo.shift,yi}Wi?Wi=null:ia=F}return yi};Ki(()=>Oi(ii,Re.iconBox,s.ai.horizontal),()=>{const hi=Re.verticalTextBox;return O.allowVerticalPlacement&&!(jt&&jt.box&&jt.box.length)&&Oe.numVerticalGlyphVertices>0&&hi?Oi(hi,Re.verticalIconBox,s.ai.vertical):{box:null,offscreen:null}}),jt&&(dt=jt.box,Nt=jt.offscreen);const Xi=wi(jt&&jt.box);if(!dt&&this.prevPlacement){const hi=this.prevPlacement.variableOffsets[Oe.crossTileID];hi&&(this.variableOffsets[Oe.crossTileID]=hi,this.markUsedJustification(O,hi.anchor,Oe,Xi))}}}if(Pr=jt,dt=Pr&&Pr.box&&Pr.box.length>0,Nt=Pr&&Pr.offscreen,Oe.useRuntimeCollisionCircles){const wi=O.text.placedSymbolArray.get(Oe.centerJustifiedTextSymbolIndex),Ki=s.aj(O.textSizeData,L,wi),xi=z.get("text-padding");yr=this.collisionIndex.placeCollisionCircles(F,wi,O.lineVertexArray,O.glyphOffsetArray,Ki,J,w,l,M,se,j.predicate,Oe.collisionCircleDiameter,xi,Se),yr.circles.length&&yr.collisionDetected&&!M&&s.w("Collisions detected, but collision boxes are not shown"),dt=V||yr.circles.length>0&&!yr.collisionDetected,Nt=Nt&&yr.offscreen}if(Re.iconFeatureIndex&&(ti=Re.iconFeatureIndex),Re.iconBox){const wi=Ki=>{const xi=oe&&It?Gt(Ki,It.x,It.y,te,se,this.transform.angle):Ki;return this.collisionIndex.placeCollisionBox(xi,q,p,J,j.predicate,Se)};Ht&&Ht.box&&Ht.box.length&&Re.verticalIconBox?(Ir=wi(Re.verticalIconBox),ft=Ir.box.length>0):(Ir=wi(Re.iconBox),ft=Ir.box.length>0),Nt=Nt&&Ir.offscreen}const Ri=_||Oe.numHorizontalGlyphVertices===0&&Oe.numVerticalGlyphVertices===0,ki=E||Oe.numIconVertices===0;if(Ri||ki?ki?Ri||(ft=ft&&dt):dt=ft&&dt:ft=dt=ft&&dt,dt&&Pr&&Pr.box&&this.collisionIndex.insertCollisionBox(Pr.box,F,z.get("text-ignore-placement"),O.bucketInstanceId,Ht&&Ht.box&&li?li:hr,j.ID),ft&&Ir&&this.collisionIndex.insertCollisionBox(Ir.box,q,z.get("icon-ignore-placement"),O.bucketInstanceId,ti,j.ID),yr&&(dt&&this.collisionIndex.insertCollisionCircles(yr.circles,F,z.get("text-ignore-placement"),O.bucketInstanceId,hr,j.ID),M)){const wi=O.bucketInstanceId;let Ki=this.collisionCircleArrays[wi];Ki===void 0&&(Ki=this.collisionCircleArrays[wi]=new vt);for(let xi=0;xi<yr.circles.length;xi+=4)Ki.circles.push(yr.circles[xi+0]),Ki.circles.push(yr.circles[xi+1]),Ki.circles.push(yr.circles[xi+2]),Ki.circles.push(yr.collisionDetected?1:0)}if(Oe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(O.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Oe.crossTileID]=new st(dt||_e,ft||Ie,Nt||O.justReloaded),b[Oe.crossTileID]=!0};if(le){if(A.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Oe=O.getSortedSymbolIndexes(this.transform.angle);for(let Re=Oe.length-1;Re>=0;--Re){const Ve=Oe[Re];et(O.symbolInstances.get(Ve),O.collisionArrays[Ve])}}else for(let Oe=A.symbolInstanceStart;Oe<A.symbolInstanceEnd;Oe++)et(O.symbolInstances.get(Oe),O.collisionArrays[Oe]);if(M&&O.bucketInstanceId in this.collisionCircleArrays){const Oe=this.collisionCircleArrays[O.bucketInstanceId];s.as(Oe.invProjMatrix,J),Oe.viewportMatrix=this.collisionIndex.getViewportMatrix()}O.justReloaded=!1}markUsedJustification(A,b,M,O){let z;z=O===s.ai.vertical?M.verticalPlacedTextSymbolIndex:{left:M.leftJustifiedTextSymbolIndex,center:M.centerJustifiedTextSymbolIndex,right:M.rightJustifiedTextSymbolIndex}[s.at(b)];const J=[M.leftJustifiedTextSymbolIndex,M.centerJustifiedTextSymbolIndex,M.rightJustifiedTextSymbolIndex,M.verticalPlacedTextSymbolIndex];for(const w of J)w>=0&&(A.text.placedSymbolArray.get(w).crossTileID=z>=0&&w!==z?0:M.crossTileID)}markUsedOrientation(A,b,M){const O=b===s.ai.horizontal||b===s.ai.horizontalOnly?b:0,z=b===s.ai.vertical?b:0,J=[M.leftJustifiedTextSymbolIndex,M.centerJustifiedTextSymbolIndex,M.rightJustifiedTextSymbolIndex];for(const w of J)A.text.placedSymbolArray.get(w).placedOrientation=O;M.verticalPlacedTextSymbolIndex&&(A.text.placedSymbolArray.get(M.verticalPlacedTextSymbolIndex).placedOrientation=z)}commit(A){this.commitTime=A,this.zoomAtLastRecencyCheck=this.transform.zoom;const b=this.prevPlacement;let M=!1;this.prevZoomAdjustment=b?b.zoomAdjustment(this.transform.zoom):0;const O=b?b.symbolFadeChange(A):1,z=b?b.opacities:{},J=b?b.variableOffsets:{},w=b?b.placedOrientations:{};for(const l in this.placements){const p=this.placements[l],x=z[l];x?(this.opacities[l]=new Ge(x,O,p.text,p.icon),M=M||p.text!==x.text.placed||p.icon!==x.icon.placed):(this.opacities[l]=new Ge(null,O,p.text,p.icon,p.skipFade),M=M||p.text||p.icon)}for(const l in z){const p=z[l];if(!this.opacities[l]){const x=new Ge(p,O,!1,!1);x.isHidden()||(this.opacities[l]=x,M=M||p.text.placed||p.icon.placed)}}for(const l in J)this.variableOffsets[l]||!this.opacities[l]||this.opacities[l].isHidden()||(this.variableOffsets[l]=J[l]);for(const l in w)this.placedOrientations[l]||!this.opacities[l]||this.opacities[l].isHidden()||(this.placedOrientations[l]=w[l]);if(b&&b.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");M?this.lastPlacementChangeTime=A:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=b?b.lastPlacementChangeTime:A)}updateLayerOpacities(A,b){const M={};for(const O of b){const z=O.getBucket(A);z&&O.latestFeatureIndex&&A.id===z.layerIds[0]&&this.updateBucketOpacities(z,M,O.collisionBoxArray)}}updateBucketOpacities(A,b,M){A.hasTextData()&&(A.text.opacityVertexArray.clear(),A.text.hasVisibleVertices=!1),A.hasIconData()&&(A.icon.opacityVertexArray.clear(),A.icon.hasVisibleVertices=!1),A.hasIconCollisionBoxData()&&A.iconCollisionBox.collisionVertexArray.clear(),A.hasTextCollisionBoxData()&&A.textCollisionBox.collisionVertexArray.clear();const O=A.layers[0],z=O.layout,J=new Ge(null,0,!1,!1,!0),w=z.get("text-allow-overlap"),l=z.get("icon-allow-overlap"),p=O._unevaluatedLayout.hasValue("text-variable-anchor")||O._unevaluatedLayout.hasValue("text-variable-anchor-offset"),x=z.get("text-rotation-alignment")==="map",B=z.get("text-pitch-alignment")==="map",L=z.get("icon-text-fit")!=="none",j=new Ge(null,0,w&&(l||!A.hasIconData()||z.get("icon-optional")),l&&(w||!A.hasTextData()||z.get("text-optional")),!0);!A.collisionArrays&&M&&(A.hasIconCollisionBoxData()||A.hasTextCollisionBoxData())&&A.deserializeCollisionBoxes(M);const _=(E,F,V)=>{for(let q=0;q<F/4;q++)E.opacityVertexArray.emplaceBack(V);E.hasVisibleVertices=E.hasVisibleVertices||V!==un};for(let E=0;E<A.symbolInstances.length;E++){const F=A.symbolInstances.get(E),{numHorizontalGlyphVertices:V,numVerticalGlyphVertices:q,crossTileID:K}=F;let te=this.opacities[K];b[K]?te=J:te||(te=j,this.opacities[K]=te),b[K]=!0;const se=F.numIconVertices>0,oe=this.placedOrientations[F.crossTileID],le=oe===s.ai.vertical,_e=oe===s.ai.horizontal||oe===s.ai.horizontalOnly;if(V>0||q>0){const Ie=ci(te.text);_(A.text,V,le?un:Ie),_(A.text,q,_e?un:Ie);const ve=te.text.isHidden();[F.rightJustifiedTextSymbolIndex,F.centerJustifiedTextSymbolIndex,F.leftJustifiedTextSymbolIndex].forEach(Oe=>{Oe>=0&&(A.text.placedSymbolArray.get(Oe).hidden=ve||le?1:0)}),F.verticalPlacedTextSymbolIndex>=0&&(A.text.placedSymbolArray.get(F.verticalPlacedTextSymbolIndex).hidden=ve||_e?1:0);const Se=this.variableOffsets[F.crossTileID];Se&&this.markUsedJustification(A,Se.anchor,F,oe);const et=this.placedOrientations[F.crossTileID];et&&(this.markUsedJustification(A,"left",F,et),this.markUsedOrientation(A,et,F))}if(se){const Ie=ci(te.icon),ve=!(L&&F.verticalPlacedIconSymbolIndex&&le);F.placedIconSymbolIndex>=0&&(_(A.icon,F.numIconVertices,ve?Ie:un),A.icon.placedSymbolArray.get(F.placedIconSymbolIndex).hidden=te.icon.isHidden()),F.verticalPlacedIconSymbolIndex>=0&&(_(A.icon,F.numVerticalIconVertices,ve?un:Ie),A.icon.placedSymbolArray.get(F.verticalPlacedIconSymbolIndex).hidden=te.icon.isHidden())}if(A.hasIconCollisionBoxData()||A.hasTextCollisionBoxData()){const Ie=A.collisionArrays[E];if(Ie){let ve=new s.P(0,0);if(Ie.textBox||Ie.verticalTextBox){let et=!0;if(p){const Oe=this.variableOffsets[K];Oe?(ve=rr(Oe.anchor,Oe.width,Oe.height,Oe.textOffset,Oe.textBoxScale),x&&ve._rotate(B?this.transform.angle:-this.transform.angle)):et=!1}Ie.textBox&&Cr(A.textCollisionBox.collisionVertexArray,te.text.placed,!et||le,ve.x,ve.y),Ie.verticalTextBox&&Cr(A.textCollisionBox.collisionVertexArray,te.text.placed,!et||_e,ve.x,ve.y)}const Se=!!(!_e&&Ie.verticalIconBox);Ie.iconBox&&Cr(A.iconCollisionBox.collisionVertexArray,te.icon.placed,Se,L?ve.x:0,L?ve.y:0),Ie.verticalIconBox&&Cr(A.iconCollisionBox.collisionVertexArray,te.icon.placed,!Se,L?ve.x:0,L?ve.y:0)}}}if(A.sortFeatures(this.transform.angle),this.retainedQueryData[A.bucketInstanceId]&&(this.retainedQueryData[A.bucketInstanceId].featureSortOrder=A.featureSortOrder),A.hasTextData()&&A.text.opacityVertexBuffer&&A.text.opacityVertexBuffer.updateData(A.text.opacityVertexArray),A.hasIconData()&&A.icon.opacityVertexBuffer&&A.icon.opacityVertexBuffer.updateData(A.icon.opacityVertexArray),A.hasIconCollisionBoxData()&&A.iconCollisionBox.collisionVertexBuffer&&A.iconCollisionBox.collisionVertexBuffer.updateData(A.iconCollisionBox.collisionVertexArray),A.hasTextCollisionBoxData()&&A.textCollisionBox.collisionVertexBuffer&&A.textCollisionBox.collisionVertexBuffer.updateData(A.textCollisionBox.collisionVertexArray),A.text.opacityVertexArray.length!==A.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${A.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${A.text.layoutVertexArray.length}) / 4`);if(A.icon.opacityVertexArray.length!==A.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${A.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${A.icon.layoutVertexArray.length}) / 4`);if(A.bucketInstanceId in this.collisionCircleArrays){const E=this.collisionCircleArrays[A.bucketInstanceId];A.placementInvProjMatrix=E.invProjMatrix,A.placementViewportMatrix=E.viewportMatrix,A.collisionCircleArray=E.circles,delete this.collisionCircleArrays[A.bucketInstanceId]}}symbolFadeChange(A){return this.fadeDuration===0?1:(A-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(A){return Math.max(0,(this.transform.zoom-A)/1.5)}hasTransitions(A){return this.stale||A-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(A,b){const M=this.zoomAtLastRecencyCheck===b?1-this.zoomAdjustment(b):1;return this.zoomAtLastRecencyCheck=b,this.commitTime+this.fadeDuration*M>A}setStale(){this.stale=!0}}function Cr(N,A,b,M,O){N.emplaceBack(A?1:0,b?1:0,M||0,O||0),N.emplaceBack(A?1:0,b?1:0,M||0,O||0),N.emplaceBack(A?1:0,b?1:0,M||0,O||0),N.emplaceBack(A?1:0,b?1:0,M||0,O||0)}const Gr=Math.pow(2,25),Er=Math.pow(2,24),zr=Math.pow(2,17),ot=Math.pow(2,16),ir=Math.pow(2,9),Vt=Math.pow(2,8),Hr=Math.pow(2,1);function ci(N){if(N.opacity===0&&!N.placed)return 0;if(N.opacity===1&&N.placed)return 4294967295;const A=N.placed?1:0,b=Math.floor(127*N.opacity);return b*Gr+A*Er+b*zr+A*ot+b*ir+A*Vt+b*Hr+A}const un=0;class wn{constructor(A){this._sortAcrossTiles=A.layout.get("symbol-z-order")!=="viewport-y"&&!A.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(A,b,M,O,z){const J=this._bucketParts;for(;this._currentTileIndex<A.length;)if(b.getBucketParts(J,O,A[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,z())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,J.sort((w,l)=>w.sortKey-l.sortKey));this._currentPartIndex<J.length;)if(b.placeLayerBucketPart(J[this._currentPartIndex],this._seenCrossTileIDs,M),this._currentPartIndex++,z())return!0;return!1}}class mi{constructor(A,b,M,O,z,J,w,l){this.placement=new dr(A,b,J,w,l),this._currentPlacementIndex=M.length-1,this._forceFullPlacement=O,this._showCollisionBoxes=z,this._done=!1}isDone(){return this._done}continuePlacement(A,b,M){const O=s.h.now(),z=()=>!this._forceFullPlacement&&s.h.now()-O>2;for(;this._currentPlacementIndex>=0;){const J=b[A[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(J.type==="symbol"&&(!J.minzoom||J.minzoom<=w)&&(!J.maxzoom||J.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new wn(J)),this._inProgressLayer.continuePlacement(M[J.source],this.placement,this._showCollisionBoxes,J,z))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(A){return this.placement.commit(A),this.placement}}const mn=512/s.N/2;class yn{constructor(A,b,M){this.tileID=A,this.bucketInstanceId=M,this._symbolsByKey={};const O=new Map;for(let z=0;z<b.length;z++){const J=b.get(z),w=J.key,l=O.get(w);l?l.push(J):O.set(w,[J])}for(const[z,J]of O){const w={positions:J.map(l=>({x:Math.floor(l.anchorX*mn),y:Math.floor(l.anchorY*mn)})),crossTileIDs:J.map(l=>l.crossTileID)};if(w.positions.length>128){const l=new s.av(w.positions.length,16,Uint16Array);for(const{x:p,y:x}of w.positions)l.add(p,x);l.finish(),delete w.positions,w.index=l}this._symbolsByKey[z]=w}}getScaledCoordinates(A,b){const{x:M,y:O,z}=this.tileID.canonical,{x:J,y:w,z:l}=b.canonical,p=mn/Math.pow(2,l-z),x=(w*s.N+A.anchorY)*p,B=O*s.N*mn;return{x:Math.floor((J*s.N+A.anchorX)*p-M*s.N*mn),y:Math.floor(x-B)}}findMatches(A,b,M){const O=this.tileID.canonical.z<b.canonical.z?1:Math.pow(2,this.tileID.canonical.z-b.canonical.z);for(let z=0;z<A.length;z++){const J=A.get(z);if(J.crossTileID)continue;const w=this._symbolsByKey[J.key];if(!w)continue;const l=this.getScaledCoordinates(J,b);if(w.index){const p=w.index.range(l.x-O,l.y-O,l.x+O,l.y+O).sort();for(const x of p){const B=w.crossTileIDs[x];if(!M[B]){M[B]=!0,J.crossTileID=B;break}}}else if(w.positions)for(let p=0;p<w.positions.length;p++){const x=w.positions[p],B=w.crossTileIDs[p];if(Math.abs(x.x-l.x)<=O&&Math.abs(x.y-l.y)<=O&&!M[B]){M[B]=!0,J.crossTileID=B;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(A=>{let{crossTileIDs:b}=A;return b})}}class fi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class jn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(A){const b=Math.round((A-this.lng)/360);if(b!==0)for(const M in this.indexes){const O=this.indexes[M],z={};for(const J in O){const w=O[J];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+b),z[w.tileID.key]=w}this.indexes[M]=z}this.lng=A}addBucket(A,b,M){if(this.indexes[A.overscaledZ]&&this.indexes[A.overscaledZ][A.key]){if(this.indexes[A.overscaledZ][A.key].bucketInstanceId===b.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(A.overscaledZ,this.indexes[A.overscaledZ][A.key])}for(let z=0;z<b.symbolInstances.length;z++)b.symbolInstances.get(z).crossTileID=0;this.usedCrossTileIDs[A.overscaledZ]||(this.usedCrossTileIDs[A.overscaledZ]={});const O=this.usedCrossTileIDs[A.overscaledZ];for(const z in this.indexes){const J=this.indexes[z];if(Number(z)>A.overscaledZ)for(const w in J){const l=J[w];l.tileID.isChildOf(A)&&l.findMatches(b.symbolInstances,A,O)}else{const w=J[A.scaledTo(Number(z)).key];w&&w.findMatches(b.symbolInstances,A,O)}}for(let z=0;z<b.symbolInstances.length;z++){const J=b.symbolInstances.get(z);J.crossTileID||(J.crossTileID=M.generate(),O[J.crossTileID]=!0)}return this.indexes[A.overscaledZ]===void 0&&(this.indexes[A.overscaledZ]={}),this.indexes[A.overscaledZ][A.key]=new yn(A,b.symbolInstances,b.bucketInstanceId),!0}removeBucketCrossTileIDs(A,b){for(const M of b.getCrossTileIDsLists())for(const O of M)delete this.usedCrossTileIDs[A][O]}removeStaleBuckets(A){let b=!1;for(const M in this.indexes){const O=this.indexes[M];for(const z in O)A[O[z].bucketInstanceId]||(this.removeBucketCrossTileIDs(M,O[z]),delete O[z],b=!0)}return b}}class qs{constructor(){this.layerIndexes={},this.crossTileIDs=new fi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(A,b,M){let O=this.layerIndexes[A.id];O===void 0&&(O=this.layerIndexes[A.id]=new jn);let z=!1;const J={};O.handleWrapJump(M);for(const w of b){const l=w.getBucket(A);l&&A.id===l.layerIds[0]&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),O.addBucket(w.tileID,l,this.crossTileIDs)&&(z=!0),J[l.bucketInstanceId]=!0)}return O.removeStaleBuckets(J)&&(z=!0),z}pruneUnusedLayers(A){const b={};A.forEach(M=>{b[M]=!0});for(const M in this.layerIndexes)b[M]||delete this.layerIndexes[M]}}const Ui=(N,A)=>s.x(N,A&&A.filter(b=>b.identifier!=="source.canvas")),Bn=s.F(s.ax,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Xa=s.F(s.ax,["setCenter","setZoom","setBearing","setPitch"]),Nn=s.aw();class Zr extends s.E{constructor(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),this.map=A,this.dispatcher=new Zt(Pi(),this,A._getMapId()),this.imageManager=new De,this.imageManager.setEventedParent(this),this.glyphManager=new Et(A._requestManager,b.localIdeographFontFamily),this.lineAtlas=new Ft(256,512),this.crossTileSymbolIndex=new qs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.ay,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.az());const M=this;this._rtlTextPluginCallback=Zr.registerForPluginStateChange(O=>{M.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:O.pluginStatus,pluginURL:O.pluginURL},(z,J)=>{if(s.aA(z),J&&J.every(w=>w))for(const w in M.sourceCaches){const l=M.sourceCaches[w].getSource().type;l!=="vector"&&l!=="geojson"||M.sourceCaches[w].reload()}})}),this.on("data",O=>{if(O.dataType!=="source"||O.sourceDataType!=="metadata")return;const z=this.sourceCaches[O.sourceId];if(!z)return;const J=z.getSource();if(J&&J.vectorLayerIds)for(const w in this._layers){const l=this._layers[w];l.source===J.id&&this._validateLayer(l)}})}loadURL(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),b.validate=typeof b.validate!="boolean"||b.validate;const O=this.map._requestManager.transformRequest(A,ce.Style);this._request=s.f(O,(z,J)=>{this._request=null,z?this.fire(new s.j(z)):J&&this._load(J,b,M)})}loadJSON(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;this.fire(new s.k("dataloading",{dataType:"style"})),this._request=s.h.frame(()=>{this._request=null,b.validate=b.validate!==!1,this._load(A,b,M)})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(Nn,{validate:!1})}_load(A,b,M){var O;const z=b.transformStyle?b.transformStyle(M,A):A;if(!b.validate||!Ui(this,s.y(z))){this._loaded=!0,this.stylesheet=z;for(const J in z.sources)this.addSource(J,z.sources[J],{validate:!1});z.sprite?this._loadSprite(z.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(z.glyphs),this._createLayers(),this.light=new Rt(this.stylesheet.light),this.map.setTerrain((O=this.stylesheet.terrain)!==null&&O!==void 0?O:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const A=s.aB(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",A),this._order=A.map(b=>b.id),this._layers={},this._serializedLayers=null;for(const b of A){const M=s.aC(b);M.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=M}}_loadSprite(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;this.imageManager.setLoaded(!1),this._spriteRequest=function(O,z,J,w){const l=Ne(O),p=l.length,x=J>1?"@2x":"",B={},L={},j={};for(const{id:_,url:E}of l){const F=z.transformRequest(z.normalizeSpriteURL(E,x,".json"),ce.SpriteJSON),V=`${_}_${F.url}`;B[V]=s.f(F,(te,se)=>{delete B[V],L[_]=se,at(w,L,j,te,p)});const q=z.transformRequest(z.normalizeSpriteURL(E,x,".png"),ce.SpriteImage),K=`${_}_${q.url}`;B[K]=he.getImage(q,(te,se)=>{delete B[K],j[_]=se,at(w,L,j,te,p)})}return{cancel(){for(const _ of Object.values(B))_.cancel()}}}(A,this.map._requestManager,this.map.getPixelRatio(),(O,z)=>{if(this._spriteRequest=null,O)this.fire(new s.j(O));else if(z)for(const J in z){this._spritesImagesIds[J]=[];const w=this._spritesImagesIds[J]?this._spritesImagesIds[J].filter(l=>!(l in z)):[];for(const l of w)this.imageManager.removeImage(l),this._changedImages[l]=!0;for(const l in z[J]){const p=J==="default"?l:`${J}:${l}`;this._spritesImagesIds[J].push(p),p in this.imageManager.images?this.imageManager.updateImage(p,z[J][l],!1):this.imageManager.addImage(p,z[J][l]),b&&(this._changedImages[p]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),b&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),M&&M(O)})}_unloadSprite(){for(const A of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(A),this._changedImages[A]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(A){const b=this.sourceCaches[A.source];if(!b)return;const M=A.sourceLayer;if(!M)return;const O=b.getSource();(O.type==="geojson"||O.vectorLayerIds&&O.vectorLayerIds.indexOf(M)===-1)&&this.fire(new s.j(new Error(`Source layer "${M}" does not exist on source "${O.id}" as specified by style layer "${A.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const A in this.sourceCaches)if(!this.sourceCaches[A].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(A){const b=this._serializedAllLayers();if(!A||A.length===0)return Object.values(b);const M=[];for(const O of A)b[O]&&M.push(b[O]);return M}_serializedAllLayers(){let A=this._serializedLayers;if(A)return A;A=this._serializedLayers={};const b=Object.keys(this._layers);for(const M of b){const O=this._layers[M];O.type!=="custom"&&(A[M]=O.serialize())}return A}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const A in this.sourceCaches)if(this.sourceCaches[A].hasTransition())return!0;for(const A in this._layers)if(this._layers[A].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(A){if(!this._loaded)return;const b=this._changed;if(this._changed){const O=Object.keys(this._updatedLayers),z=Object.keys(this._removedLayers);(O.length||z.length)&&this._updateWorkerLayers(O,z);for(const J in this._updatedSources){const w=this._updatedSources[J];if(w==="reload")this._reloadSource(J);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(J)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const J in this._updatedPaintProps)this._layers[J].updateTransitions(A);this.light.updateTransitions(A),this._resetUpdates()}const M={};for(const O in this.sourceCaches){const z=this.sourceCaches[O];M[O]=z.used,z.used=!1}for(const O of this._order){const z=this._layers[O];z.recalculate(A,this._availableImages),!z.isHidden(A.zoom)&&z.source&&(this.sourceCaches[z.source].used=!0)}for(const O in M){const z=this.sourceCaches[O];M[O]!==z.used&&z.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:O}))}this.light.recalculate(A),this.z=A.zoom,b&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const A=Object.keys(this._changedImages);if(A.length){for(const b in this.sourceCaches)this.sourceCaches[b].reloadTilesForDependencies(["icons","patterns"],A);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const A in this.sourceCaches)this.sourceCaches[A].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(A,b){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(A),removedIds:b})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const M=this.serialize();if(A=b.transformStyle?b.transformStyle(M,A):A,Ui(this,s.y(A)))return!1;(A=s.aD(A)).layers=s.aB(A.layers);const O=s.aE(M,A).filter(J=>!(J.command in Xa));if(O.length===0)return!1;const z=O.filter(J=>!(J.command in Bn));if(z.length>0)throw new Error(`Unimplemented: ${z.map(J=>J.command).join(", ")}.`);for(const J of O)J.command!=="setTransition"&&this[J.command].apply(this,J.args);return this.stylesheet=A,this._serializedLayers=null,!0}addImage(A,b){if(this.getImage(A))return this.fire(new s.j(new Error(`An image named "${A}" already exists.`)));this.imageManager.addImage(A,b),this._afterImageUpdated(A)}updateImage(A,b){this.imageManager.updateImage(A,b)}getImage(A){return this.imageManager.getImage(A)}removeImage(A){if(!this.getImage(A))return this.fire(new s.j(new Error(`An image named "${A}" does not exist.`)));this.imageManager.removeImage(A),this._afterImageUpdated(A)}_afterImageUpdated(A){this._availableImages=this.imageManager.listImages(),this._changedImages[A]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(A,b){let M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this._checkLoaded(),this.sourceCaches[A]!==void 0)throw new Error(`Source "${A}" already exists.`);if(!b.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(b).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(b.type)>=0&&this._validate(s.y.source,`sources.${A}`,b,null,M))return;this.map&&this.map._collectResourceTiming&&(b.collectResourceTiming=!0);const O=this.sourceCaches[A]=new $t(A,b,this.dispatcher);O.style=this,O.setEventedParent(this,()=>({isSourceLoaded:O.loaded(),source:O.serialize(),sourceId:A})),O.onAdd(this.map),this._changed=!0}removeSource(A){if(this._checkLoaded(),this.sourceCaches[A]===void 0)throw new Error("There is no source with this ID");for(const M in this._layers)if(this._layers[M].source===A)return this.fire(new s.j(new Error(`Source "${A}" cannot be removed while layer "${M}" is using it.`)));const b=this.sourceCaches[A];delete this.sourceCaches[A],delete this._updatedSources[A],b.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:A})),b.setEventedParent(null),b.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(A,b){if(this._checkLoaded(),this.sourceCaches[A]===void 0)throw new Error(`There is no source with this ID=${A}`);const M=this.sourceCaches[A].getSource();if(M.type!=="geojson")throw new Error(`geojsonSource.type is ${M.type}, which is !== 'geojson`);M.setData(b),this._changed=!0}getSource(A){return this.sourceCaches[A]&&this.sourceCaches[A].getSource()}addLayer(A,b){let M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const O=A.id;if(this.getLayer(O))return void this.fire(new s.j(new Error(`Layer "${O}" already exists on this map.`)));let z;if(A.type==="custom"){if(Ui(this,s.aF(A)))return;z=s.aC(A)}else{if("source"in A&&typeof A.source=="object"&&(this.addSource(O,A.source),A=s.aD(A),A=s.e(A,{source:O})),this._validate(s.y.layer,`layers.${O}`,A,{arrayIndex:-1},M))return;z=s.aC(A),this._validateLayer(z),z.setEventedParent(this,{layer:{id:O}})}const J=b?this._order.indexOf(b):this._order.length;if(b&&J===-1)this.fire(new s.j(new Error(`Cannot add layer "${O}" before non-existing layer "${b}".`)));else{if(this._order.splice(J,0,O),this._layerOrderChanged=!0,this._layers[O]=z,this._removedLayers[O]&&z.source&&z.type!=="custom"){const w=this._removedLayers[O];delete this._removedLayers[O],w.type!==z.type?this._updatedSources[z.source]="clear":(this._updatedSources[z.source]="reload",this.sourceCaches[z.source].pause())}this._updateLayer(z),z.onAdd&&z.onAdd(this.map)}}moveLayer(A,b){if(this._checkLoaded(),this._changed=!0,!this._layers[A])return void this.fire(new s.j(new Error(`The layer '${A}' does not exist in the map's style and cannot be moved.`)));if(A===b)return;const M=this._order.indexOf(A);this._order.splice(M,1);const O=b?this._order.indexOf(b):this._order.length;b&&O===-1?this.fire(new s.j(new Error(`Cannot move layer "${A}" before non-existing layer "${b}".`))):(this._order.splice(O,0,A),this._layerOrderChanged=!0)}removeLayer(A){this._checkLoaded();const b=this._layers[A];if(!b)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${A}".`)));b.setEventedParent(null);const M=this._order.indexOf(A);this._order.splice(M,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[A]=b,delete this._layers[A],this._serializedLayers&&delete this._serializedLayers[A],delete this._updatedLayers[A],delete this._updatedPaintProps[A],b.onRemove&&b.onRemove(this.map)}getLayer(A){return this._layers[A]}getLayersOrder(){return[...this._order]}hasLayer(A){return A in this._layers}setLayerZoomRange(A,b,M){this._checkLoaded();const O=this.getLayer(A);O?O.minzoom===b&&O.maxzoom===M||(b!=null&&(O.minzoom=b),M!=null&&(O.maxzoom=M),this._updateLayer(O)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${A}".`)))}setFilter(A,b){let M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._checkLoaded();const O=this.getLayer(A);if(O){if(!s.aG(O.filter,b))return b==null?(O.filter=void 0,void this._updateLayer(O)):void(this._validate(s.y.filter,`layers.${O.id}.filter`,b,null,M)||(O.filter=s.aD(b),this._updateLayer(O)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${A}".`)))}getFilter(A){return s.aD(this.getLayer(A).filter)}setLayoutProperty(A,b,M){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const z=this.getLayer(A);z?s.aG(z.getLayoutProperty(b),M)||(z.setLayoutProperty(b,M,O),this._updateLayer(z)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${A}".`)))}getLayoutProperty(A,b){const M=this.getLayer(A);if(M)return M.getLayoutProperty(b);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${A}".`)))}setPaintProperty(A,b,M){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this._checkLoaded();const z=this.getLayer(A);z?s.aG(z.getPaintProperty(b),M)||(z.setPaintProperty(b,M,O)&&this._updateLayer(z),this._changed=!0,this._updatedPaintProps[A]=!0):this.fire(new s.j(new Error(`Cannot style non-existing layer "${A}".`)))}getPaintProperty(A,b){return this.getLayer(A).getPaintProperty(b)}setFeatureState(A,b){this._checkLoaded();const M=A.source,O=A.sourceLayer,z=this.sourceCaches[M];if(z===void 0)return void this.fire(new s.j(new Error(`The source '${M}' does not exist in the map's style.`)));const J=z.getSource().type;J==="geojson"&&O?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):J!=="vector"||O?(A.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),z.setFeatureState(O,A.id,b)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(A,b){this._checkLoaded();const M=A.source,O=this.sourceCaches[M];if(O===void 0)return void this.fire(new s.j(new Error(`The source '${M}' does not exist in the map's style.`)));const z=O.getSource().type,J=z==="vector"?A.sourceLayer:void 0;z!=="vector"||J?b&&typeof A.id!="string"&&typeof A.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):O.removeFeatureState(J,A.id,b):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(A){this._checkLoaded();const b=A.source,M=A.sourceLayer,O=this.sourceCaches[b];if(O!==void 0)return O.getSource().type!=="vector"||M?(A.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),O.getFeatureState(M,A.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${b}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const A=s.aH(this.sourceCaches,z=>z.serialize()),b=this._serializeByIds(this._order),M=this.map.getTerrain()||void 0,O=this.stylesheet;return s.aI({version:O.version,name:O.name,metadata:O.metadata,light:O.light,center:O.center,zoom:O.zoom,bearing:O.bearing,pitch:O.pitch,sprite:O.sprite,glyphs:O.glyphs,transition:O.transition,sources:A,layers:b,terrain:M},z=>z!==void 0)}_updateLayer(A){this._updatedLayers[A.id]=!0,A.source&&!this._updatedSources[A.source]&&this.sourceCaches[A.source].getSource().type!=="raster"&&(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(A){const b=J=>this._layers[J].type==="fill-extrusion",M={},O=[];for(let J=this._order.length-1;J>=0;J--){const w=this._order[J];if(b(w)){M[w]=J;for(const l of A){const p=l[w];if(p)for(const x of p)O.push(x)}}}O.sort((J,w)=>w.intersectionZ-J.intersectionZ);const z=[];for(let J=this._order.length-1;J>=0;J--){const w=this._order[J];if(b(w))for(let l=O.length-1;l>=0;l--){const p=O[l].feature;if(M[p.layer.id]<J)break;z.push(p),O.pop()}else for(const l of A){const p=l[w];if(p)for(const x of p)z.push(x.feature)}}return z}queryRenderedFeatures(A,b,M){b&&b.filter&&this._validate(s.y.filter,"queryRenderedFeatures.filter",b.filter,null,b);const O={};if(b&&b.layers){if(!Array.isArray(b.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const w of b.layers){const l=this._layers[w];if(!l)return this.fire(new s.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];O[l.source]=!0}}const z=[];b.availableImages=this._availableImages;const J=this._serializedAllLayers();for(const w in this.sourceCaches)b.layers&&!O[w]||z.push(lt(this.sourceCaches[w],this._layers,J,A,b,M));return this.placement&&z.push(function(w,l,p,x,B,L,j){const _={},E=L.queryRenderedSymbols(x),F=[];for(const V of Object.keys(E).map(Number))F.push(j[V]);F.sort(wt);for(const V of F){const q=V.featureIndex.lookupSymbolFeatures(E[V.bucketInstanceId],l,V.bucketIndex,V.sourceLayerIndex,B.filter,B.layers,B.availableImages,w);for(const K in q){const te=_[K]=_[K]||[],se=q[K];se.sort((oe,le)=>{const _e=V.featureSortOrder;if(_e){const Ie=_e.indexOf(oe.featureIndex);return _e.indexOf(le.featureIndex)-Ie}return le.featureIndex-oe.featureIndex});for(const oe of se)te.push(oe)}}for(const V in _)_[V].forEach(q=>{const K=q.feature,te=p[w[V].source].getFeatureState(K.layer["source-layer"],K.id);K.source=K.layer.source,K.layer["source-layer"]&&(K.sourceLayer=K.layer["source-layer"]),K.state=te});return _}(this._layers,J,this.sourceCaches,A,b,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(z)}querySourceFeatures(A,b){b&&b.filter&&this._validate(s.y.filter,"querySourceFeatures.filter",b.filter,null,b);const M=this.sourceCaches[A];return M?function(O,z){const J=O.getRenderableIds().map(p=>O.getTileByID(p)),w=[],l={};for(let p=0;p<J.length;p++){const x=J[p],B=x.tileID.canonical.key;l[B]||(l[B]=!0,x.querySourceFeatures(w,z))}return w}(M,b):[]}addSourceType(A,b,M){return Fr(A)?M(new Error(`A source type called "${A}" already exists.`)):(((O,z)=>{br[O]=z})(A,b),b.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:A,url:b.workerSourceURL},M):M(null,null))}getLight(){return this.light.getLight()}setLight(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded();const M=this.light.getLight();let O=!1;for(const J in A)if(!s.aG(A[J],M[J])){O=!0;break}if(!O)return;const z={now:s.h.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(A,b),this.light.updateTransitions(z)}_validate(A,b,M,O){let z=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return(!z||z.validate!==!1)&&Ui(this,A.call(s.y,s.e({key:b,style:this.serialize(),value:M,styleSpec:s.v},O)))}_remove(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.aJ.off("pluginStateChange",this._rtlTextPluginCallback);for(const b in this._layers)this._layers[b].setEventedParent(null);for(const b in this.sourceCaches){const M=this.sourceCaches[b];M.setEventedParent(null),M.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(A)}_clearSource(A){this.sourceCaches[A].clearTiles()}_reloadSource(A){this.sourceCaches[A].resume(),this.sourceCaches[A].reload()}_updateSources(A){for(const b in this.sourceCaches)this.sourceCaches[b].update(A,this.map.terrain)}_generateCollisionBoxes(){for(const A in this.sourceCaches)this._reloadSource(A)}_updatePlacement(A,b,M,O){let z=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,J=!1,w=!1;const l={};for(const p of this._order){const x=this._layers[p];if(x.type!=="symbol")continue;if(!l[x.source]){const L=this.sourceCaches[x.source];l[x.source]=L.getRenderableIds(!0).map(j=>L.getTileByID(j)).sort((j,_)=>_.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(_.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(x,l[x.source],A.center.lng);J=J||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((z=z||this._layerOrderChanged||M===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.h.now(),A.zoom))&&(this.pauseablePlacement=new mi(A,this.map.terrain,this._order,z,b,M,O,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.h.now()),w=!0),J&&this.pauseablePlacement.placement.setStale()),w||J)for(const p of this._order){const x=this._layers[p];x.type==="symbol"&&this.placement.updateLayerOpacities(x,l[x.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.h.now())}_releaseSymbolFadeTiles(){for(const A in this.sourceCaches)this.sourceCaches[A].releaseSymbolFadeTiles()}getImages(A,b,M){this.imageManager.getImages(b.icons,M),this._updateTilesForChangedImages();const O=this.sourceCaches[b.source];O&&O.setDependencies(b.tileID.key,b.type,b.icons)}getGlyphs(A,b,M){this.glyphManager.getGlyphs(b.stacks,M);const O=this.sourceCaches[b.source];O&&O.setDependencies(b.tileID.key,b.type,[""])}getResource(A,b,M){return s.m(b,M)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._checkLoaded(),A&&this._validate(s.y.glyphs,"glyphs",A,null,b)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=A,this.glyphManager.entries={},this.glyphManager.setURL(A))}addSprite(A,b){let M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},O=arguments.length>3?arguments[3]:void 0;this._checkLoaded();const z=[{id:A,url:b}],J=[...Ne(this.stylesheet.sprite),...z];this._validate(s.y.sprite,"sprite",J,null,M)||(this.stylesheet.sprite=J,this._loadSprite(z,!0,O))}removeSprite(A){this._checkLoaded();const b=Ne(this.stylesheet.sprite);if(b.find(M=>M.id===A)){if(this._spritesImagesIds[A])for(const M of this._spritesImagesIds[A])this.imageManager.removeImage(M),this._changedImages[M]=!0;b.splice(b.findIndex(M=>M.id===A),1),this.stylesheet.sprite=b.length>0?b:void 0,delete this._spritesImagesIds[A],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${A}" doesn't exists on this map.`)))}getSprite(){return Ne(this.stylesheet.sprite)}setSprite(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},M=arguments.length>2?arguments[2]:void 0;this._checkLoaded(),A&&this._validate(s.y.sprite,"sprite",A,null,b)||(this.stylesheet.sprite=A,A?this._loadSprite(A,!0,M):(this._unloadSprite(),M&&M(null)))}}Zr.registerForPluginStateChange=s.aK;var co=s.Q([{name:"a_pos",type:"Int16",components:2}]),Fs="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const bi={prelude:Ii(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ii(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ii(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ii(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ii("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ii(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ii(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ii("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ii("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ii("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ii(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ii(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ii(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ii(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ii(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ii(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ii(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ii(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ii(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ii(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ii(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ii(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ii(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ii(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ii(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ii(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ii("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Fs),terrainDepth:Ii("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Fs),terrainCoords:Ii("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Fs)};function Ii(N,A){const b=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,M=A.match(/attribute ([\w]+) ([\w]+)/g),O=N.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),z=A.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),J=z?z.concat(O):O,w={};return{fragmentSource:N=N.replace(b,(l,p,x,B,L)=>(w[L]=!0,p==="define"?`
#ifndef HAS_UNIFORM_u_${L}
varying ${x} ${B} ${L};
#else
uniform ${x} ${B} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${x} ${B} ${L} = u_${L};
#endif
`)),vertexSource:A=A.replace(b,(l,p,x,B,L)=>{const j=B==="float"?"vec2":"vec4",_=L.match(/color/)?"color":j;return w[L]?p==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${x} ${j} a_${L};
varying ${x} ${B} ${L};
#else
uniform ${x} ${B} u_${L};
#endif
`:_==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${x} ${B} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${_}(a_${L}, u_${L}_t);
#else
    ${x} ${B} ${L} = u_${L};
#endif
`:p==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${x} ${j} a_${L};
#else
uniform ${x} ${B} u_${L};
#endif
`:_==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${x} ${B} ${L} = a_${L};
#else
    ${x} ${B} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${x} ${B} ${L} = unpack_mix_${_}(a_${L}, u_${L}_t);
#else
    ${x} ${B} ${L} = u_${L};
#endif
`}),staticAttributes:M,staticUniforms:J}}class ss{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(A,b,M,O,z,J,w,l,p){this.context=A;let x=this.boundPaintVertexBuffers.length!==O.length;for(let B=0;!x&&B<O.length;B++)this.boundPaintVertexBuffers[B]!==O[B]&&(x=!0);!this.vao||this.boundProgram!==b||this.boundLayoutVertexBuffer!==M||x||this.boundIndexBuffer!==z||this.boundVertexOffset!==J||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==l||this.boundDynamicVertexBuffer3!==p?this.freshBind(b,M,O,z,J,w,l,p):(A.bindVertexArray.set(this.vao),w&&w.bind(),z&&z.dynamicDraw&&z.bind(),l&&l.bind(),p&&p.bind())}freshBind(A,b,M,O,z,J,w,l){const p=A.numAttributes,x=this.context,B=x.gl;this.vao&&this.destroy(),this.vao=x.createVertexArray(),x.bindVertexArray.set(this.vao),this.boundProgram=A,this.boundLayoutVertexBuffer=b,this.boundPaintVertexBuffers=M,this.boundIndexBuffer=O,this.boundVertexOffset=z,this.boundDynamicVertexBuffer=J,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=l,b.enableAttributes(B,A);for(const L of M)L.enableAttributes(B,A);J&&J.enableAttributes(B,A),w&&w.enableAttributes(B,A),l&&l.enableAttributes(B,A),b.bind(),b.setVertexAttribPointers(B,A,z);for(const L of M)L.bind(),L.setVertexAttribPointers(B,A,z);J&&(J.bind(),J.setVertexAttribPointers(B,A,z)),O&&O.bind(),w&&(w.bind(),w.setVertexAttribPointers(B,A,z)),l&&(l.bind(),l.setVertexAttribPointers(B,A,z)),x.currentNumAttributes=p}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ji(N){const A=[];for(let b=0;b<N.length;b++){if(N[b]===null)continue;const M=N[b].split(" ");A.push(M.pop())}return A}class Tn{constructor(A,b,M,O,z,J){const w=A.gl;this.program=w.createProgram();const l=ji(b.staticAttributes),p=M?M.getBinderAttributes():[],x=l.concat(p),B=bi.prelude.staticUniforms?ji(bi.prelude.staticUniforms):[],L=b.staticUniforms?ji(b.staticUniforms):[],j=M?M.getBinderUniforms():[],_=B.concat(L).concat(j),E=[];for(const oe of _)E.indexOf(oe)<0&&E.push(oe);const F=M?M.defines():[];z&&F.push("#define OVERDRAW_INSPECTOR;"),J&&F.push("#define TERRAIN3D;");const V=F.concat(bi.prelude.fragmentSource,b.fragmentSource).join(`
`),q=F.concat(bi.prelude.vertexSource,b.vertexSource).join(`
`),K=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(K,V),w.compileShader(K),!w.getShaderParameter(K,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(K)}`);w.attachShader(this.program,K);const te=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(te,q),w.compileShader(te),!w.getShaderParameter(te,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(te)}`);w.attachShader(this.program,te),this.attributes={};const se={};this.numAttributes=x.length;for(let oe=0;oe<this.numAttributes;oe++)x[oe]&&(w.bindAttribLocation(this.program,oe,x[oe]),this.attributes[x[oe]]=oe);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(te),w.deleteShader(K);for(let oe=0;oe<E.length;oe++){const le=E[oe];if(le&&!se[le]){const _e=w.getUniformLocation(this.program,le);_e&&(se[le]=_e)}}this.fixedUniforms=O(A,se),this.terrainUniforms=((oe,le)=>({u_depth:new s.aL(oe,le.u_depth),u_terrain:new s.aL(oe,le.u_terrain),u_terrain_dim:new s.aM(oe,le.u_terrain_dim),u_terrain_matrix:new s.aN(oe,le.u_terrain_matrix),u_terrain_unpack:new s.aO(oe,le.u_terrain_unpack),u_terrain_exaggeration:new s.aM(oe,le.u_terrain_exaggeration)}))(A,se),this.binderUniforms=M?M.getUniforms(A,se):[]}draw(A,b,M,O,z,J,w,l,p,x,B,L,j,_,E,F,V,q){const K=A.gl;if(this.failedToCreate)return;if(A.program.set(this.program),A.setDepthMode(M),A.setStencilMode(O),A.setColorMode(z),A.setCullFace(J),l){A.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,l.depthTexture),A.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,l.texture);for(const se in this.terrainUniforms)this.terrainUniforms[se].set(l[se])}for(const se in this.fixedUniforms)this.fixedUniforms[se].set(w[se]);E&&E.setUniforms(A,this.binderUniforms,j,{zoom:_});let te=0;switch(b){case K.LINES:te=2;break;case K.TRIANGLES:te=3;break;case K.LINE_STRIP:te=1}for(const se of L.get()){const oe=se.vaos||(se.vaos={});(oe[p]||(oe[p]=new ss)).bind(A,this,x,E?E.getPaintVertexBuffers():[],B,se.vertexOffset,F,V,q),K.drawElements(b,se.primitiveLength*te,K.UNSIGNED_SHORT,se.primitiveOffset*te*2)}}}function Cn(N,A,b){const M=1/Fe(b,1,A.transform.tileZoom),O=Math.pow(2,b.tileID.overscaledZ),z=b.tileSize*Math.pow(2,A.transform.tileZoom)/O,J=z*(b.tileID.canonical.x+b.tileID.wrap*O),w=z*b.tileID.canonical.y;return{u_image:0,u_texsize:b.imageAtlasTexture.size,u_scale:[M,N.fromScale,N.toScale],u_fade:N.t,u_pixel_coord_upper:[J>>16,w>>16],u_pixel_coord_lower:[65535&J,65535&w]}}const mo=(N,A,b,M)=>{const O=A.style.light,z=O.properties.get("position"),J=[z.x,z.y,z.z],w=function(){var p=new s.A(9);return s.A!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[5]=0,p[6]=0,p[7]=0),p[0]=1,p[4]=1,p[8]=1,p}();O.properties.get("anchor")==="viewport"&&function(p,x){var B=Math.sin(x),L=Math.cos(x);p[0]=L,p[1]=B,p[2]=0,p[3]=-B,p[4]=L,p[5]=0,p[6]=0,p[7]=0,p[8]=1}(w,-A.transform.angle),function(p,x,B){var L=x[0],j=x[1],_=x[2];p[0]=L*B[0]+j*B[3]+_*B[6],p[1]=L*B[1]+j*B[4]+_*B[7],p[2]=L*B[2]+j*B[5]+_*B[8]}(J,J,w);const l=O.properties.get("color");return{u_matrix:N,u_lightpos:J,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[l.r,l.g,l.b],u_vertical_gradient:+b,u_opacity:M}},Mi=(N,A,b,M,O,z,J)=>s.e(mo(N,A,b,M),Cn(z,A,J),{u_height_factor:-Math.pow(2,O.overscaledZ)/J.tileSize/8}),Za=N=>({u_matrix:N}),Ys=(N,A,b,M)=>s.e(Za(N),Cn(b,A,M)),Ja=(N,A)=>({u_matrix:N,u_world:A}),He=(N,A,b,M,O)=>s.e(Ys(N,A,b,M),{u_world:O}),Je=(N,A,b,M)=>{const O=N.transform;let z,J;if(M.paint.get("circle-pitch-alignment")==="map"){const w=Fe(b,1,O.zoom);z=!0,J=[w,w]}else z=!1,J=O.pixelsToGLUnits;return{u_camera_to_center_distance:O.cameraToCenterDistance,u_scale_with_map:+(M.paint.get("circle-pitch-scale")==="map"),u_matrix:N.translatePosMatrix(A.posMatrix,b,M.paint.get("circle-translate"),M.paint.get("circle-translate-anchor")),u_pitch_with_map:+z,u_device_pixel_ratio:N.pixelRatio,u_extrude_scale:J}},gt=(N,A,b)=>{const M=Fe(b,1,A.zoom),O=Math.pow(2,A.zoom-b.tileID.overscaledZ),z=b.tileID.overscaleFactor();return{u_matrix:N,u_camera_to_center_distance:A.cameraToCenterDistance,u_pixels_to_tile_units:M,u_extrude_scale:[A.pixelsToGLUnits[0]/(M*O),A.pixelsToGLUnits[1]/(M*O)],u_overscale_factor:z}},Ot=function(N,A){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return{u_matrix:N,u_color:A,u_overlay:0,u_overlay_scale:b}},fr=N=>({u_matrix:N}),qr=(N,A,b,M)=>({u_matrix:N,u_extrude_scale:Fe(A,1,b),u_intensity:M});function Ci(N,A){const b=Math.pow(2,A.canonical.z),M=A.canonical.y;return[new s.U(0,M/b).toLngLat().lat,new s.U(0,(M+1)/b).toLngLat().lat]}const In=(N,A,b,M)=>{const O=N.transform;return{u_matrix:Hl(N,A,b,M),u_ratio:1/Fe(A,1,O.zoom),u_device_pixel_ratio:N.pixelRatio,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]]}},qn=(N,A,b,M,O)=>s.e(In(N,A,b,O),{u_image:0,u_image_height:M}),os=(N,A,b,M,O)=>{const z=N.transform,J=fu(A,z);return{u_matrix:Hl(N,A,b,O),u_texsize:A.imageAtlasTexture.size,u_ratio:1/Fe(A,1,z.zoom),u_device_pixel_ratio:N.pixelRatio,u_image:0,u_scale:[J,M.fromScale,M.toScale],u_fade:M.t,u_units_to_pixels:[1/z.pixelsToGLUnits[0],1/z.pixelsToGLUnits[1]]}},_n=(N,A,b,M,O,z)=>{const J=N.lineAtlas,w=fu(A,N.transform),l=b.layout.get("line-cap")==="round",p=J.getDash(M.from,l),x=J.getDash(M.to,l),B=p.width*O.fromScale,L=x.width*O.toScale;return s.e(In(N,A,b,z),{u_patternscale_a:[w/B,-p.height/2],u_patternscale_b:[w/L,-x.height/2],u_sdfgamma:J.width/(256*Math.min(B,L)*N.pixelRatio)/2,u_image:0,u_tex_y_a:p.y,u_tex_y_b:x.y,u_mix:O.t})};function fu(N,A){return 1/Fe(N,1,A.tileZoom)}function Hl(N,A,b,M){return N.translatePosMatrix(M?M.posMatrix:A.tileID.posMatrix,A,b.paint.get("line-translate"),b.paint.get("line-translate-anchor"))}const Ei=(N,A,b,M,O)=>{return{u_matrix:N,u_tl_parent:A,u_scale_parent:b,u_buffer_scale:1,u_fade_t:M.mix,u_opacity:M.opacity*O.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:O.paint.get("raster-brightness-min"),u_brightness_high:O.paint.get("raster-brightness-max"),u_saturation_factor:(J=O.paint.get("raster-saturation"),J>0?1-1/(1.001-J):-J),u_contrast_factor:(z=O.paint.get("raster-contrast"),z>0?1/(1-z):1+z),u_spin_weights:Ya(O.paint.get("raster-hue-rotate"))};var z,J};function Ya(N){N*=Math.PI/180;const A=Math.sin(N),b=Math.cos(N);return[(2*b+1)/3,(-Math.sqrt(3)*A-b+1)/3,(Math.sqrt(3)*A-b+1)/3]}const Gl=(N,A,b,M,O,z,J,w,l,p)=>{const x=O.transform;return{u_is_size_zoom_constant:+(N==="constant"||N==="source"),u_is_size_feature_constant:+(N==="constant"||N==="camera"),u_size_t:A?A.uSizeT:0,u_size:A?A.uSize:0,u_camera_to_center_distance:x.cameraToCenterDistance,u_pitch:x.pitch/360*2*Math.PI,u_rotate_symbol:+b,u_aspect_ratio:x.width/x.height,u_fade_change:O.options.fadeDuration?O.symbolFadeChange:1,u_matrix:z,u_label_plane_matrix:J,u_coord_matrix:w,u_is_text:+l,u_pitch_with_map:+M,u_texsize:p,u_texture:0}},as=(N,A,b,M,O,z,J,w,l,p,x)=>{const B=O.transform;return s.e(Gl(N,A,b,M,O,z,J,w,l,p),{u_gamma_scale:M?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:O.pixelRatio,u_is_halo:+x})},Lo=(N,A,b,M,O,z,J,w,l,p)=>s.e(as(N,A,b,M,O,z,J,w,!0,l,!0),{u_texsize_icon:p,u_texture_icon:1}),Ia=(N,A,b)=>({u_matrix:N,u_opacity:A,u_color:b}),ys=(N,A,b,M,O,z)=>s.e(function(J,w,l,p){const x=l.imageManager.getPattern(J.from.toString()),B=l.imageManager.getPattern(J.to.toString()),{width:L,height:j}=l.imageManager.getPixelSize(),_=Math.pow(2,p.tileID.overscaledZ),E=p.tileSize*Math.pow(2,l.transform.tileZoom)/_,F=E*(p.tileID.canonical.x+p.tileID.wrap*_),V=E*p.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:x.tl,u_pattern_br_a:x.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[L,j],u_mix:w.t,u_pattern_size_a:x.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/Fe(p,1,l.transform.tileZoom),u_pixel_coord_upper:[F>>16,V>>16],u_pixel_coord_lower:[65535&F,65535&V]}}(M,z,b,O),{u_matrix:N,u_opacity:A}),La={fillExtrusion:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_lightpos:new s.aP(N,A.u_lightpos),u_lightintensity:new s.aM(N,A.u_lightintensity),u_lightcolor:new s.aP(N,A.u_lightcolor),u_vertical_gradient:new s.aM(N,A.u_vertical_gradient),u_opacity:new s.aM(N,A.u_opacity)}),fillExtrusionPattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_lightpos:new s.aP(N,A.u_lightpos),u_lightintensity:new s.aM(N,A.u_lightintensity),u_lightcolor:new s.aP(N,A.u_lightcolor),u_vertical_gradient:new s.aM(N,A.u_vertical_gradient),u_height_factor:new s.aM(N,A.u_height_factor),u_image:new s.aL(N,A.u_image),u_texsize:new s.aQ(N,A.u_texsize),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade),u_opacity:new s.aM(N,A.u_opacity)}),fill:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix)}),fillPattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_image:new s.aL(N,A.u_image),u_texsize:new s.aQ(N,A.u_texsize),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade)}),fillOutline:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_world:new s.aQ(N,A.u_world)}),fillOutlinePattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_world:new s.aQ(N,A.u_world),u_image:new s.aL(N,A.u_image),u_texsize:new s.aQ(N,A.u_texsize),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade)}),circle:(N,A)=>({u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_scale_with_map:new s.aL(N,A.u_scale_with_map),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_extrude_scale:new s.aQ(N,A.u_extrude_scale),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_matrix:new s.aN(N,A.u_matrix)}),collisionBox:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aM(N,A.u_pixels_to_tile_units),u_extrude_scale:new s.aQ(N,A.u_extrude_scale),u_overscale_factor:new s.aM(N,A.u_overscale_factor)}),collisionCircle:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_inv_matrix:new s.aN(N,A.u_inv_matrix),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_viewport_size:new s.aQ(N,A.u_viewport_size)}),debug:(N,A)=>({u_color:new s.aR(N,A.u_color),u_matrix:new s.aN(N,A.u_matrix),u_overlay:new s.aL(N,A.u_overlay),u_overlay_scale:new s.aM(N,A.u_overlay_scale)}),clippingMask:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix)}),heatmap:(N,A)=>({u_extrude_scale:new s.aM(N,A.u_extrude_scale),u_intensity:new s.aM(N,A.u_intensity),u_matrix:new s.aN(N,A.u_matrix)}),heatmapTexture:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_world:new s.aQ(N,A.u_world),u_image:new s.aL(N,A.u_image),u_color_ramp:new s.aL(N,A.u_color_ramp),u_opacity:new s.aM(N,A.u_opacity)}),hillshade:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_image:new s.aL(N,A.u_image),u_latrange:new s.aQ(N,A.u_latrange),u_light:new s.aQ(N,A.u_light),u_shadow:new s.aR(N,A.u_shadow),u_highlight:new s.aR(N,A.u_highlight),u_accent:new s.aR(N,A.u_accent)}),hillshadePrepare:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_image:new s.aL(N,A.u_image),u_dimension:new s.aQ(N,A.u_dimension),u_zoom:new s.aM(N,A.u_zoom),u_unpack:new s.aO(N,A.u_unpack)}),line:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels)}),lineGradient:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels),u_image:new s.aL(N,A.u_image),u_image_height:new s.aM(N,A.u_image_height)}),linePattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_texsize:new s.aQ(N,A.u_texsize),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_image:new s.aL(N,A.u_image),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels),u_scale:new s.aP(N,A.u_scale),u_fade:new s.aM(N,A.u_fade)}),lineSDF:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ratio:new s.aM(N,A.u_ratio),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_units_to_pixels:new s.aQ(N,A.u_units_to_pixels),u_patternscale_a:new s.aQ(N,A.u_patternscale_a),u_patternscale_b:new s.aQ(N,A.u_patternscale_b),u_sdfgamma:new s.aM(N,A.u_sdfgamma),u_image:new s.aL(N,A.u_image),u_tex_y_a:new s.aM(N,A.u_tex_y_a),u_tex_y_b:new s.aM(N,A.u_tex_y_b),u_mix:new s.aM(N,A.u_mix)}),raster:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_tl_parent:new s.aQ(N,A.u_tl_parent),u_scale_parent:new s.aM(N,A.u_scale_parent),u_buffer_scale:new s.aM(N,A.u_buffer_scale),u_fade_t:new s.aM(N,A.u_fade_t),u_opacity:new s.aM(N,A.u_opacity),u_image0:new s.aL(N,A.u_image0),u_image1:new s.aL(N,A.u_image1),u_brightness_low:new s.aM(N,A.u_brightness_low),u_brightness_high:new s.aM(N,A.u_brightness_high),u_saturation_factor:new s.aM(N,A.u_saturation_factor),u_contrast_factor:new s.aM(N,A.u_contrast_factor),u_spin_weights:new s.aP(N,A.u_spin_weights)}),symbolIcon:(N,A)=>({u_is_size_zoom_constant:new s.aL(N,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(N,A.u_is_size_feature_constant),u_size_t:new s.aM(N,A.u_size_t),u_size:new s.aM(N,A.u_size),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pitch:new s.aM(N,A.u_pitch),u_rotate_symbol:new s.aL(N,A.u_rotate_symbol),u_aspect_ratio:new s.aM(N,A.u_aspect_ratio),u_fade_change:new s.aM(N,A.u_fade_change),u_matrix:new s.aN(N,A.u_matrix),u_label_plane_matrix:new s.aN(N,A.u_label_plane_matrix),u_coord_matrix:new s.aN(N,A.u_coord_matrix),u_is_text:new s.aL(N,A.u_is_text),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_texsize:new s.aQ(N,A.u_texsize),u_texture:new s.aL(N,A.u_texture)}),symbolSDF:(N,A)=>({u_is_size_zoom_constant:new s.aL(N,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(N,A.u_is_size_feature_constant),u_size_t:new s.aM(N,A.u_size_t),u_size:new s.aM(N,A.u_size),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pitch:new s.aM(N,A.u_pitch),u_rotate_symbol:new s.aL(N,A.u_rotate_symbol),u_aspect_ratio:new s.aM(N,A.u_aspect_ratio),u_fade_change:new s.aM(N,A.u_fade_change),u_matrix:new s.aN(N,A.u_matrix),u_label_plane_matrix:new s.aN(N,A.u_label_plane_matrix),u_coord_matrix:new s.aN(N,A.u_coord_matrix),u_is_text:new s.aL(N,A.u_is_text),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_texsize:new s.aQ(N,A.u_texsize),u_texture:new s.aL(N,A.u_texture),u_gamma_scale:new s.aM(N,A.u_gamma_scale),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_is_halo:new s.aL(N,A.u_is_halo)}),symbolTextAndIcon:(N,A)=>({u_is_size_zoom_constant:new s.aL(N,A.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aL(N,A.u_is_size_feature_constant),u_size_t:new s.aM(N,A.u_size_t),u_size:new s.aM(N,A.u_size),u_camera_to_center_distance:new s.aM(N,A.u_camera_to_center_distance),u_pitch:new s.aM(N,A.u_pitch),u_rotate_symbol:new s.aL(N,A.u_rotate_symbol),u_aspect_ratio:new s.aM(N,A.u_aspect_ratio),u_fade_change:new s.aM(N,A.u_fade_change),u_matrix:new s.aN(N,A.u_matrix),u_label_plane_matrix:new s.aN(N,A.u_label_plane_matrix),u_coord_matrix:new s.aN(N,A.u_coord_matrix),u_is_text:new s.aL(N,A.u_is_text),u_pitch_with_map:new s.aL(N,A.u_pitch_with_map),u_texsize:new s.aQ(N,A.u_texsize),u_texsize_icon:new s.aQ(N,A.u_texsize_icon),u_texture:new s.aL(N,A.u_texture),u_texture_icon:new s.aL(N,A.u_texture_icon),u_gamma_scale:new s.aM(N,A.u_gamma_scale),u_device_pixel_ratio:new s.aM(N,A.u_device_pixel_ratio),u_is_halo:new s.aL(N,A.u_is_halo)}),background:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_opacity:new s.aM(N,A.u_opacity),u_color:new s.aR(N,A.u_color)}),backgroundPattern:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_opacity:new s.aM(N,A.u_opacity),u_image:new s.aL(N,A.u_image),u_pattern_tl_a:new s.aQ(N,A.u_pattern_tl_a),u_pattern_br_a:new s.aQ(N,A.u_pattern_br_a),u_pattern_tl_b:new s.aQ(N,A.u_pattern_tl_b),u_pattern_br_b:new s.aQ(N,A.u_pattern_br_b),u_texsize:new s.aQ(N,A.u_texsize),u_mix:new s.aM(N,A.u_mix),u_pattern_size_a:new s.aQ(N,A.u_pattern_size_a),u_pattern_size_b:new s.aQ(N,A.u_pattern_size_b),u_scale_a:new s.aM(N,A.u_scale_a),u_scale_b:new s.aM(N,A.u_scale_b),u_pixel_coord_upper:new s.aQ(N,A.u_pixel_coord_upper),u_pixel_coord_lower:new s.aQ(N,A.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aM(N,A.u_tile_units_to_pixels)}),terrain:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_texture:new s.aL(N,A.u_texture),u_ele_delta:new s.aM(N,A.u_ele_delta)}),terrainDepth:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_ele_delta:new s.aM(N,A.u_ele_delta)}),terrainCoords:(N,A)=>({u_matrix:new s.aN(N,A.u_matrix),u_texture:new s.aL(N,A.u_texture),u_terrain_coords_id:new s.aM(N,A.u_terrain_coords_id),u_ele_delta:new s.aM(N,A.u_ele_delta)})};class el{constructor(A,b,M){this.context=A;const O=A.gl;this.buffer=O.createBuffer(),this.dynamicDraw=!!M,this.context.unbindVAO(),A.bindElementBuffer.set(this.buffer),O.bufferData(O.ELEMENT_ARRAY_BUFFER,b.arrayBuffer,this.dynamicDraw?O.DYNAMIC_DRAW:O.STATIC_DRAW),this.dynamicDraw||delete b.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(A){const b=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),b.bufferSubData(b.ELEMENT_ARRAY_BUFFER,0,A.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Aa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vc{constructor(A,b,M,O){this.length=b.length,this.attributes=M,this.itemSize=b.bytesPerElement,this.dynamicDraw=O,this.context=A;const z=A.gl;this.buffer=z.createBuffer(),A.bindVertexBuffer.set(this.buffer),z.bufferData(z.ARRAY_BUFFER,b.arrayBuffer,this.dynamicDraw?z.DYNAMIC_DRAW:z.STATIC_DRAW),this.dynamicDraw||delete b.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(A){if(A.length!==this.length)throw new Error(`Length of new data is ${A.length}, which doesn't match current length of ${this.length}`);const b=this.context.gl;this.bind(),b.bufferSubData(b.ARRAY_BUFFER,0,A.arrayBuffer)}enableAttributes(A,b){for(let M=0;M<this.attributes.length;M++){const O=b.attributes[this.attributes[M].name];O!==void 0&&A.enableVertexAttribArray(O)}}setVertexAttribPointers(A,b,M){for(let O=0;O<this.attributes.length;O++){const z=this.attributes[O],J=b.attributes[z.name];J!==void 0&&A.vertexAttribPointer(J,z.components,A[Aa[z.type]],!1,this.itemSize,z.offset+this.itemSize*(M||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const tl=new WeakMap;function yo(N){var A;if(tl.has(N))return tl.get(N);{const b=(A=N.getParameter(N.VERSION))===null||A===void 0?void 0:A.startsWith("WebGL 2.0");return tl.set(N,b),b}}class Fi{constructor(A){this.gl=A.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(A){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class da extends Fi{getDefault(){return s.aT.transparent}set(A){const b=this.current;(A.r!==b.r||A.g!==b.g||A.b!==b.b||A.a!==b.a||this.dirty)&&(this.gl.clearColor(A.r,A.g,A.b,A.a),this.current=A,this.dirty=!1)}}class As extends Fi{getDefault(){return 1}set(A){(A!==this.current||this.dirty)&&(this.gl.clearDepth(A),this.current=A,this.dirty=!1)}}class En extends Fi{getDefault(){return 0}set(A){(A!==this.current||this.dirty)&&(this.gl.clearStencil(A),this.current=A,this.dirty=!1)}}class ds extends Fi{getDefault(){return[!0,!0,!0,!0]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||A[2]!==b[2]||A[3]!==b[3]||this.dirty)&&(this.gl.colorMask(A[0],A[1],A[2],A[3]),this.current=A,this.dirty=!1)}}class fa extends Fi{getDefault(){return!0}set(A){(A!==this.current||this.dirty)&&(this.gl.depthMask(A),this.current=A,this.dirty=!1)}}class qi extends Fi{getDefault(){return 255}set(A){(A!==this.current||this.dirty)&&(this.gl.stencilMask(A),this.current=A,this.dirty=!1)}}class dl extends Fi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(A){const b=this.current;(A.func!==b.func||A.ref!==b.ref||A.mask!==b.mask||this.dirty)&&(this.gl.stencilFunc(A.func,A.ref,A.mask),this.current=A,this.dirty=!1)}}class jl extends Fi{getDefault(){const A=this.gl;return[A.KEEP,A.KEEP,A.KEEP]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||A[2]!==b[2]||this.dirty)&&(this.gl.stencilOp(A[0],A[1],A[2]),this.current=A,this.dirty=!1)}}class Mo extends Fi{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;A?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST),this.current=A,this.dirty=!1}}class Zo extends Fi{getDefault(){return[0,1]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||this.dirty)&&(this.gl.depthRange(A[0],A[1]),this.current=A,this.dirty=!1)}}class bc extends Fi{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;A?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST),this.current=A,this.dirty=!1}}class Jo extends Fi{getDefault(){return this.gl.LESS}set(A){(A!==this.current||this.dirty)&&(this.gl.depthFunc(A),this.current=A,this.dirty=!1)}}class _o extends Fi{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;A?b.enable(b.BLEND):b.disable(b.BLEND),this.current=A,this.dirty=!1}}class xc extends Fi{getDefault(){const A=this.gl;return[A.ONE,A.ZERO]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||this.dirty)&&(this.gl.blendFunc(A[0],A[1]),this.current=A,this.dirty=!1)}}class Yo extends Fi{getDefault(){return s.aT.transparent}set(A){const b=this.current;(A.r!==b.r||A.g!==b.g||A.b!==b.b||A.a!==b.a||this.dirty)&&(this.gl.blendColor(A.r,A.g,A.b,A.a),this.current=A,this.dirty=!1)}}class ql extends Fi{getDefault(){return this.gl.FUNC_ADD}set(A){(A!==this.current||this.dirty)&&(this.gl.blendEquation(A),this.current=A,this.dirty=!1)}}class Hc extends Fi{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;A?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE),this.current=A,this.dirty=!1}}class Eh extends Fi{getDefault(){return this.gl.BACK}set(A){(A!==this.current||this.dirty)&&(this.gl.cullFace(A),this.current=A,this.dirty=!1)}}class pu extends Fi{getDefault(){return this.gl.CCW}set(A){(A!==this.current||this.dirty)&&(this.gl.frontFace(A),this.current=A,this.dirty=!1)}}class gu extends Fi{getDefault(){return null}set(A){(A!==this.current||this.dirty)&&(this.gl.useProgram(A),this.current=A,this.dirty=!1)}}class Vu extends Fi{getDefault(){return this.gl.TEXTURE0}set(A){(A!==this.current||this.dirty)&&(this.gl.activeTexture(A),this.current=A,this.dirty=!1)}}class $l extends Fi{getDefault(){const A=this.gl;return[0,0,A.drawingBufferWidth,A.drawingBufferHeight]}set(A){const b=this.current;(A[0]!==b[0]||A[1]!==b[1]||A[2]!==b[2]||A[3]!==b[3]||this.dirty)&&(this.gl.viewport(A[0],A[1],A[2],A[3]),this.current=A,this.dirty=!1)}}class rl extends Fi{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,A),this.current=A,this.dirty=!1}}class il extends Fi{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.bindRenderbuffer(b.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class Kl extends Fi{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.bindTexture(b.TEXTURE_2D,A),this.current=A,this.dirty=!1}}class nl extends Fi{getDefault(){return null}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.bindBuffer(b.ARRAY_BUFFER,A),this.current=A,this.dirty=!1}}class pa extends Fi{getDefault(){return null}set(A){const b=this.gl;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,A),this.current=A,this.dirty=!1}}class fl extends Fi{getDefault(){return null}set(A){var b;if(A===this.current&&!this.dirty)return;const M=this.gl;yo(M)?M.bindVertexArray(A):(b=M.getExtension("OES_vertex_array_object"))===null||b===void 0||b.bindVertexArrayOES(A),this.current=A,this.dirty=!1}}class Wl extends Fi{getDefault(){return 4}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.pixelStorei(b.UNPACK_ALIGNMENT,A),this.current=A,this.dirty=!1}}class uo extends Fi{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,A),this.current=A,this.dirty=!1}}class ga extends Fi{getDefault(){return!1}set(A){if(A===this.current&&!this.dirty)return;const b=this.gl;b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,A),this.current=A,this.dirty=!1}}class ne extends Fi{constructor(A,b){super(A),this.context=A,this.parent=b}getDefault(){return null}}class Pe extends ne{setDirty(){this.dirty=!0}set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const b=this.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,A,0),this.current=A,this.dirty=!1}}class ct extends ne{set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const b=this.gl;b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class _t extends ne{set(A){if(A===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const b=this.gl;b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,A),this.current=A,this.dirty=!1}}class xt{constructor(A,b,M,O,z){this.context=A,this.width=b,this.height=M;const J=A.gl,w=this.framebuffer=J.createFramebuffer();if(this.colorAttachment=new Pe(A,w),O)this.depthAttachment=z?new _t(A,w):new ct(A,w);else if(z)throw new Error("Stencil cannot be setted without depth");if(J.checkFramebufferStatus(J.FRAMEBUFFER)!==J.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const A=this.context.gl,b=this.colorAttachment.get();if(b&&A.deleteTexture(b),this.depthAttachment){const M=this.depthAttachment.get();M&&A.deleteRenderbuffer(M)}A.deleteFramebuffer(this.framebuffer)}}class Lt{constructor(A,b,M){this.blendFunction=A,this.blendColor=b,this.mask=M}}Lt.Replace=[1,0],Lt.disabled=new Lt(Lt.Replace,s.aT.transparent,[!1,!1,!1,!1]),Lt.unblended=new Lt(Lt.Replace,s.aT.transparent,[!0,!0,!0,!0]),Lt.alphaBlended=new Lt([1,771],s.aT.transparent,[!0,!0,!0,!0]);class gr{constructor(A){var b,M;if(this.gl=A,this.clearColor=new da(this),this.clearDepth=new As(this),this.clearStencil=new En(this),this.colorMask=new ds(this),this.depthMask=new fa(this),this.stencilMask=new qi(this),this.stencilFunc=new dl(this),this.stencilOp=new jl(this),this.stencilTest=new Mo(this),this.depthRange=new Zo(this),this.depthTest=new bc(this),this.depthFunc=new Jo(this),this.blend=new _o(this),this.blendFunc=new xc(this),this.blendColor=new Yo(this),this.blendEquation=new ql(this),this.cullFace=new Hc(this),this.cullFaceSide=new Eh(this),this.frontFace=new pu(this),this.program=new gu(this),this.activeTexture=new Vu(this),this.viewport=new $l(this),this.bindFramebuffer=new rl(this),this.bindRenderbuffer=new il(this),this.bindTexture=new Kl(this),this.bindVertexBuffer=new nl(this),this.bindElementBuffer=new pa(this),this.bindVertexArray=new fl(this),this.pixelStoreUnpack=new Wl(this),this.pixelStoreUnpackPremultiplyAlpha=new uo(this),this.pixelStoreUnpackFlipY=new ga(this),this.extTextureFilterAnisotropic=A.getExtension("EXT_texture_filter_anisotropic")||A.getExtension("MOZ_EXT_texture_filter_anisotropic")||A.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=A.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=A.getParameter(A.MAX_TEXTURE_SIZE),yo(A)){this.HALF_FLOAT=A.HALF_FLOAT;const O=A.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(b=A.RGBA16F)!==null&&b!==void 0?b:O==null?void 0:O.RGBA16F_EXT,this.RGB16F=(M=A.RGB16F)!==null&&M!==void 0?M:O==null?void 0:O.RGB16F_EXT,A.getExtension("EXT_color_buffer_float")}else{A.getExtension("EXT_color_buffer_half_float"),A.getExtension("OES_texture_half_float_linear");const O=A.getExtension("OES_texture_half_float");this.HALF_FLOAT=O==null?void 0:O.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(A,b){return new el(this,A,b)}createVertexBuffer(A,b,M){return new Vc(this,A,b,M)}createRenderbuffer(A,b,M){const O=this.gl,z=O.createRenderbuffer();return this.bindRenderbuffer.set(z),O.renderbufferStorage(O.RENDERBUFFER,A,b,M),this.bindRenderbuffer.set(null),z}createFramebuffer(A,b,M,O){return new xt(this,A,b,M,O)}clear(A){let{color:b,depth:M,stencil:O}=A;const z=this.gl;let J=0;b&&(J|=z.COLOR_BUFFER_BIT,this.clearColor.set(b),this.colorMask.set([!0,!0,!0,!0])),M!==void 0&&(J|=z.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(M),this.depthMask.set(!0)),O!==void 0&&(J|=z.STENCIL_BUFFER_BIT,this.clearStencil.set(O),this.stencilMask.set(255)),z.clear(J)}setCullFace(A){A.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(A.mode),this.frontFace.set(A.frontFace))}setDepthMode(A){A.func!==this.gl.ALWAYS||A.mask?(this.depthTest.set(!0),this.depthFunc.set(A.func),this.depthMask.set(A.mask),this.depthRange.set(A.range)):this.depthTest.set(!1)}setStencilMode(A){A.test.func!==this.gl.ALWAYS||A.mask?(this.stencilTest.set(!0),this.stencilMask.set(A.mask),this.stencilOp.set([A.fail,A.depthFail,A.pass]),this.stencilFunc.set({func:A.test.func,ref:A.ref,mask:A.test.mask})):this.stencilTest.set(!1)}setColorMode(A){s.aG(A.blendFunction,Lt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(A.blendFunction),this.blendColor.set(A.blendColor)),this.colorMask.set(A.mask)}createVertexArray(){var A;return yo(this.gl)?this.gl.createVertexArray():(A=this.gl.getExtension("OES_vertex_array_object"))===null||A===void 0?void 0:A.createVertexArrayOES()}deleteVertexArray(A){var b;return yo(this.gl)?this.gl.deleteVertexArray(A):(b=this.gl.getExtension("OES_vertex_array_object"))===null||b===void 0?void 0:b.deleteVertexArrayOES(A)}unbindVAO(){this.bindVertexArray.set(null)}}class sr{constructor(A,b,M){this.func=A,this.mask=b,this.range=M}}sr.ReadOnly=!1,sr.ReadWrite=!0,sr.disabled=new sr(519,sr.ReadOnly,[0,1]);const si=7680;class $r{constructor(A,b,M,O,z,J){this.test=A,this.ref=b,this.mask=M,this.fail=O,this.depthFail=z,this.pass=J}}$r.disabled=new $r({func:519,mask:0},0,0,si,si,si);class ei{constructor(A,b,M){this.enable=A,this.mode=b,this.frontFace=M}}let ui;function $n(N,A,b,M,O,z,J){const w=N.context,l=w.gl,p=N.useProgram("collisionBox"),x=[];let B=0,L=0;for(let K=0;K<M.length;K++){const te=M[K],se=A.getTile(te),oe=se.getBucket(b);if(!oe)continue;let le=te.posMatrix;O[0]===0&&O[1]===0||(le=N.translatePosMatrix(te.posMatrix,se,O,z));const _e=J?oe.textCollisionBox:oe.iconCollisionBox,Ie=oe.collisionCircleArray;if(Ie.length>0){const ve=s.Z(),Se=le;s.aU(ve,oe.placementInvProjMatrix,N.transform.glCoordMatrix),s.aU(ve,ve,oe.placementViewportMatrix),x.push({circleArray:Ie,circleOffset:L,transform:Se,invTransform:ve,coord:te}),B+=Ie.length/4,L=B}_e&&p.draw(w,l.LINES,sr.disabled,$r.disabled,N.colorModeForRenderPass(),ei.disabled,gt(le,N.transform,se),N.style.map.terrain&&N.style.map.terrain.getTerrainData(te),b.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,null,N.transform.zoom,null,null,_e.collisionVertexBuffer)}if(!J||!x.length)return;const j=N.useProgram("collisionCircle"),_=new s.aV;_.resize(4*B),_._trim();let E=0;for(const K of x)for(let te=0;te<K.circleArray.length/4;te++){const se=4*te,oe=K.circleArray[se+0],le=K.circleArray[se+1],_e=K.circleArray[se+2],Ie=K.circleArray[se+3];_.emplace(E++,oe,le,_e,Ie,0),_.emplace(E++,oe,le,_e,Ie,1),_.emplace(E++,oe,le,_e,Ie,2),_.emplace(E++,oe,le,_e,Ie,3)}(!ui||ui.length<2*B)&&(ui=function(K){const te=2*K,se=new s.aX;se.resize(te),se._trim();for(let oe=0;oe<te;oe++){const le=6*oe;se.uint16[le+0]=4*oe+0,se.uint16[le+1]=4*oe+1,se.uint16[le+2]=4*oe+2,se.uint16[le+3]=4*oe+2,se.uint16[le+4]=4*oe+3,se.uint16[le+5]=4*oe+0}return se}(B));const F=w.createIndexBuffer(ui,!0),V=w.createVertexBuffer(_,s.aW.members,!0);for(const K of x){const te={u_matrix:K.transform,u_inv_matrix:K.invTransform,u_camera_to_center_distance:(q=N.transform).cameraToCenterDistance,u_viewport_size:[q.width,q.height]};j.draw(w,l.TRIANGLES,sr.disabled,$r.disabled,N.colorModeForRenderPass(),ei.disabled,te,N.style.map.terrain&&N.style.map.terrain.getTerrainData(K.coord),b.id,V,F,s.S.simpleSegment(0,2*K.circleOffset,K.circleArray.length,K.circleArray.length/2),null,N.transform.zoom,null,null,null)}var q;V.destroy(),F.destroy()}ei.disabled=new ei(!1,1029,2305),ei.backCCW=new ei(!0,1029,2305);const ai=s.ao(new Float32Array(16));function Pn(N,A,b,M,O,z){const{horizontalAlign:J,verticalAlign:w}=s.au(N);return new s.P((-(J-.5)*A/O+M[0])*z,(-(w-.5)*b/O+M[1])*z)}function Di(N,A,b,M,O,z,J,w,l,p,x){const B=N.text.placedSymbolArray,L=N.text.dynamicLayoutVertexArray,j=N.icon.dynamicLayoutVertexArray,_={};L.clear();for(let E=0;E<B.length;E++){const F=B.get(E),V=F.hidden||!F.crossTileID||N.allowVerticalPlacement&&!F.placedOrientation?null:M[F.crossTileID];if(V){const q=new s.P(F.anchorX,F.anchorY),K=Qt(q,b?J:z,x),te=Tr(O.cameraToCenterDistance,K.signedDistanceFromCamera);let se=s.aj(N.textSizeData,l,F)*te/s.ap;b&&(se*=N.tilePixelRatio/w);const{width:oe,height:le,anchor:_e,textOffset:Ie,textBoxScale:ve}=V,Se=Pn(_e,oe,le,Ie,ve,se),et=b?Qt(q.add(Se),z,x).point:K.point.add(A?Se.rotate(-O.angle):Se),Oe=N.allowVerticalPlacement&&F.placedOrientation===s.ai.vertical?Math.PI/2:0;for(let Re=0;Re<F.numGlyphs;Re++)s.ak(L,et,Oe);p&&F.associatedIconIndex>=0&&(_[F.associatedIconIndex]={shiftedAnchor:et,angle:Oe})}else ge(F.numGlyphs,L)}if(p){j.clear();const E=N.icon.placedSymbolArray;for(let F=0;F<E.length;F++){const V=E.get(F);if(V.hidden)ge(V.numGlyphs,j);else{const q=_[F];if(q)for(let K=0;K<V.numGlyphs;K++)s.ak(j,q.shiftedAnchor,q.angle);else ge(V.numGlyphs,j)}}N.icon.dynamicLayoutVertexBuffer.updateData(j)}N.text.dynamicLayoutVertexBuffer.updateData(L)}function Li(N,A,b){return b.iconsInText&&A?"symbolTextAndIcon":N?"symbolSDF":"symbolIcon"}function Ds(N,A,b,M,O,z,J,w,l,p,x,B){const L=N.context,j=L.gl,_=N.transform,E=w==="map",F=l==="map",V=w!=="viewport"&&b.layout.get("symbol-placement")!=="point",q=E&&!F&&!V,K=!b.layout.get("symbol-sort-key").isConstant();let te=!1;const se=N.depthModeForSublayer(0,sr.ReadOnly),oe=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),le=[];for(const _e of M){const Ie=A.getTile(_e),ve=Ie.getBucket(b);if(!ve)continue;const Se=O?ve.text:ve.icon;if(!Se||!Se.segments.get().length||!Se.hasVisibleVertices)continue;const et=Se.programConfigurations.get(b.id),Oe=O||ve.sdfIcons,Re=O?ve.textSizeData:ve.iconSizeData,Ve=F||_.pitch!==0,At=N.useProgram(Li(Oe,O,ve),et),dt=s.ah(Re,_.zoom),ft=N.style.map.terrain&&N.style.map.terrain.getTerrainData(_e);let Nt,It,jt,Ht,Pr=[0,0],yr=null;if(O)It=Ie.glyphAtlasTexture,jt=j.LINEAR,Nt=Ie.glyphAtlasTexture.size,ve.iconsInText&&(Pr=Ie.imageAtlasTexture.size,yr=Ie.imageAtlasTexture,Ht=Ve||N.options.rotating||N.options.zooming||Re.kind==="composite"||Re.kind==="camera"?j.LINEAR:j.NEAREST);else{const Wi=b.layout.get("icon-size").constantOr(0)!==1||ve.iconsNeedLinear;It=Ie.imageAtlasTexture,jt=Oe||N.options.rotating||N.options.zooming||Wi||Ve?j.LINEAR:j.NEAREST,Nt=Ie.imageAtlasTexture.size}const Ir=Fe(Ie,1,N.transform.zoom),hr=Wt(_e.posMatrix,F,E,N.transform,Ir),li=di(_e.posMatrix,F,E,N.transform,Ir),ti=oe&&ve.hasTextData(),ii=b.layout.get("icon-text-fit")!=="none"&&ti&&ve.hasIconData();if(V){const Wi=N.style.map.terrain?(Xi,hi)=>N.style.map.terrain.getElevation(_e,Xi,hi):null,Oi=b.layout.get("text-rotation-alignment")==="map";Xt(ve,_e.posMatrix,N,O,hr,li,F,p,Oi,Wi)}const Ri=N.translatePosMatrix(_e.posMatrix,Ie,z,J),ki=V||O&&oe||ii?ai:hr,wi=N.translatePosMatrix(li,Ie,z,J,!0),Ki=Oe&&b.paint.get(O?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let xi;xi=Oe?ve.iconsInText?Lo(Re.kind,dt,q,F,N,Ri,ki,wi,Nt,Pr):as(Re.kind,dt,q,F,N,Ri,ki,wi,O,Nt,!0):Gl(Re.kind,dt,q,F,N,Ri,ki,wi,O,Nt);const Zn={program:At,buffers:Se,uniformValues:xi,atlasTexture:It,atlasTextureIcon:yr,atlasInterpolation:jt,atlasInterpolationIcon:Ht,isSDF:Oe,hasHalo:Ki};if(K&&ve.canOverlap){te=!0;const Wi=Se.segments.get();for(const Oi of Wi)le.push({segments:new s.S([Oi]),sortKey:Oi.sortKey,state:Zn,terrainData:ft})}else le.push({segments:Se.segments,sortKey:0,state:Zn,terrainData:ft})}te&&le.sort((_e,Ie)=>_e.sortKey-Ie.sortKey);for(const _e of le){const Ie=_e.state;if(L.activeTexture.set(j.TEXTURE0),Ie.atlasTexture.bind(Ie.atlasInterpolation,j.CLAMP_TO_EDGE),Ie.atlasTextureIcon&&(L.activeTexture.set(j.TEXTURE1),Ie.atlasTextureIcon&&Ie.atlasTextureIcon.bind(Ie.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),Ie.isSDF){const ve=Ie.uniformValues;Ie.hasHalo&&(ve.u_is_halo=1,eo(Ie.buffers,_e.segments,b,N,Ie.program,se,x,B,ve,_e.terrainData)),ve.u_is_halo=0}eo(Ie.buffers,_e.segments,b,N,Ie.program,se,x,B,Ie.uniformValues,_e.terrainData)}}function eo(N,A,b,M,O,z,J,w,l,p){const x=M.context;O.draw(x,x.gl.TRIANGLES,z,J,w,ei.disabled,l,p,b.id,N.layoutVertexBuffer,N.indexBuffer,A,b.paint,M.transform.zoom,N.programConfigurations.get(b.id),N.dynamicLayoutVertexBuffer,N.opacityVertexBuffer)}function Po(N,A,b,M,O){if(!b||!M||!M.imageAtlas)return;const z=M.imageAtlas.patternPositions;let J=z[b.to.toString()],w=z[b.from.toString()];if(!J&&w&&(J=w),!w&&J&&(w=J),!J||!w){const l=O.getPaintProperty(A);J=z[l],w=z[l]}J&&w&&N.setConstantPatternPositions(J,w)}function Ma(N,A,b,M,O,z,J){const w=N.context.gl,l="fill-pattern",p=b.paint.get(l),x=p&&p.constantOr(1),B=b.getCrossfadeParameters();let L,j,_,E,F;J?(j=x&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=w.LINES):(j=x?"fillPattern":"fill",L=w.TRIANGLES);const V=p.constantOr(null);for(const q of M){const K=A.getTile(q);if(x&&!K.patternsLoaded())continue;const te=K.getBucket(b);if(!te)continue;const se=te.programConfigurations.get(b.id),oe=N.useProgram(j,se),le=N.style.map.terrain&&N.style.map.terrain.getTerrainData(q);x&&(N.context.activeTexture.set(w.TEXTURE0),K.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),se.updatePaintBuffers(B)),Po(se,l,V,K,b);const _e=le?q:null,Ie=N.translatePosMatrix(_e?_e.posMatrix:q.posMatrix,K,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor"));if(J){E=te.indexBuffer2,F=te.segments2;const ve=[w.drawingBufferWidth,w.drawingBufferHeight];_=j==="fillOutlinePattern"&&x?He(Ie,N,B,K,ve):Ja(Ie,ve)}else E=te.indexBuffer,F=te.segments,_=x?Ys(Ie,N,B,K):Za(Ie);oe.draw(N.context,L,O,N.stencilModeForClipping(q),z,ei.disabled,_,le,b.id,te.layoutVertexBuffer,E,F,b.paint,N.transform.zoom,se)}}function ma(N,A,b,M,O,z,J){const w=N.context,l=w.gl,p="fill-extrusion-pattern",x=b.paint.get(p),B=x.constantOr(1),L=b.getCrossfadeParameters(),j=b.paint.get("fill-extrusion-opacity"),_=x.constantOr(null);for(const E of M){const F=A.getTile(E),V=F.getBucket(b);if(!V)continue;const q=N.style.map.terrain&&N.style.map.terrain.getTerrainData(E),K=V.programConfigurations.get(b.id),te=N.useProgram(B?"fillExtrusionPattern":"fillExtrusion",K);B&&(N.context.activeTexture.set(l.TEXTURE0),F.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),K.updatePaintBuffers(L)),Po(K,p,_,F,b);const se=N.translatePosMatrix(E.posMatrix,F,b.paint.get("fill-extrusion-translate"),b.paint.get("fill-extrusion-translate-anchor")),oe=b.paint.get("fill-extrusion-vertical-gradient"),le=B?Mi(se,N,oe,j,E,L,F):mo(se,N,oe,j);te.draw(w,w.gl.TRIANGLES,O,z,J,ei.backCCW,le,q,b.id,V.layoutVertexBuffer,V.indexBuffer,V.segments,b.paint,N.transform.zoom,K,N.style.map.terrain&&V.centroidVertexBuffer)}}function wc(N,A,b,M,O,z,J){const w=N.context,l=w.gl,p=b.fbo;if(!p)return;const x=N.useProgram("hillshade"),B=N.style.map.terrain&&N.style.map.terrain.getTerrainData(A);w.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,p.colorAttachment.get()),x.draw(w,l.TRIANGLES,O,z,J,ei.disabled,((L,j,_,E)=>{const F=_.paint.get("hillshade-shadow-color"),V=_.paint.get("hillshade-highlight-color"),q=_.paint.get("hillshade-accent-color");let K=_.paint.get("hillshade-illumination-direction")*(Math.PI/180);_.paint.get("hillshade-illumination-anchor")==="viewport"&&(K-=L.transform.angle);const te=!L.options.moving;return{u_matrix:E?E.posMatrix:L.transform.calculatePosMatrix(j.tileID.toUnwrapped(),te),u_image:0,u_latrange:Ci(0,j.tileID),u_light:[_.paint.get("hillshade-exaggeration"),K],u_shadow:F,u_highlight:V,u_accent:q}})(N,b,M,B?A:null),B,M.id,N.rasterBoundsBuffer,N.quadTriangleIndexBuffer,N.rasterBoundsSegments)}function pl(N,A,b,M,O,z){const J=N.context,w=J.gl,l=A.dem;if(l&&l.data){const p=l.dim,x=l.stride,B=l.getPixels();if(J.activeTexture.set(w.TEXTURE1),J.pixelStoreUnpackPremultiplyAlpha.set(!1),A.demTexture=A.demTexture||N.getTileTexture(x),A.demTexture){const j=A.demTexture;j.update(B,{premultiply:!1}),j.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else A.demTexture=new nt(J,B,w.RGBA,{premultiply:!1}),A.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);J.activeTexture.set(w.TEXTURE0);let L=A.fbo;if(!L){const j=new nt(J,{width:p,height:p,data:null},w.RGBA);j.bind(w.LINEAR,w.CLAMP_TO_EDGE),L=A.fbo=J.createFramebuffer(p,p,!0,!1),L.colorAttachment.set(j.texture)}J.bindFramebuffer.set(L.framebuffer),J.viewport.set([0,0,p,p]),N.useProgram("hillshadePrepare").draw(J,w.TRIANGLES,M,O,z,ei.disabled,((j,_)=>{const E=_.stride,F=s.Z();return s.aS(F,0,s.N,-s.N,0,0,1),s.$(F,F,[0,-s.N,0]),{u_matrix:F,u_image:1,u_dimension:[E,E],u_zoom:j.overscaledZ,u_unpack:_.getUnpackVector()}})(A.tileID,l),null,b.id,N.rasterBoundsBuffer,N.quadTriangleIndexBuffer,N.rasterBoundsSegments),A.needsHillshadePrepare=!1}}function Xl(N,A,b,M,O,z){const J=M.paint.get("raster-fade-duration");if(!z&&J>0){const w=s.h.now(),l=(w-N.timeAdded)/J,p=A?(w-A.timeAdded)/J:-1,x=b.getSource(),B=O.coveringZoomLevel({tileSize:x.tileSize,roundZoom:x.roundZoom}),L=!A||Math.abs(A.tileID.overscaledZ-B)>Math.abs(N.tileID.overscaledZ-B),j=L&&N.refreshedUponExpiration?1:s.ad(L?l:1-p,0,1);return N.refreshedUponExpiration&&l>=1&&(N.refreshedUponExpiration=!1),A?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}const Bc=new s.aT(1,0,0,1),Pa=new s.aT(0,1,0,1),_s=new s.aT(0,0,1,1),gl=new s.aT(1,0,1,1),Zl=new s.aT(0,1,1,1);function Fa(N,A,b,M){Rs(N,0,A+b/2,N.transform.width,b,M)}function Da(N,A,b,M){Rs(N,A-b/2,0,b,N.transform.height,M)}function Rs(N,A,b,M,O,z){const J=N.context,w=J.gl;w.enable(w.SCISSOR_TEST),w.scissor(A*N.pixelRatio,b*N.pixelRatio,M*N.pixelRatio,O*N.pixelRatio),J.clear({color:z}),w.disable(w.SCISSOR_TEST)}function Hu(N,A,b){const M=N.context,O=M.gl,z=b.posMatrix,J=N.useProgram("debug"),w=sr.disabled,l=$r.disabled,p=N.colorModeForRenderPass(),x="$debug",B=N.style.map.terrain&&N.style.map.terrain.getTerrainData(b);M.activeTexture.set(O.TEXTURE0);const L=A.getTileByID(b.key).latestRawTileData,j=Math.floor((L&&L.byteLength||0)/1024),_=A.getTile(b).tileSize,E=512/Math.min(_,512)*(b.overscaledZ/N.transform.zoom)*.5;let F=b.canonical.toString();b.overscaledZ!==b.canonical.z&&(F+=` => ${b.overscaledZ}`),function(V,q){V.initDebugOverlayCanvas();const K=V.debugOverlayCanvas,te=V.context.gl,se=V.debugOverlayCanvas.getContext("2d");se.clearRect(0,0,K.width,K.height),se.shadowColor="white",se.shadowBlur=2,se.lineWidth=1.5,se.strokeStyle="white",se.textBaseline="top",se.font="bold 36px Open Sans, sans-serif",se.fillText(q,5,5),se.strokeText(q,5,5),V.debugOverlayTexture.update(K),V.debugOverlayTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE)}(N,`${F} ${j}kB`),J.draw(M,O.TRIANGLES,w,l,Lt.alphaBlended,ei.disabled,Ot(z,s.aT.transparent,E),null,x,N.debugBuffer,N.quadTriangleIndexBuffer,N.debugSegments),J.draw(M,O.LINE_STRIP,w,l,p,ei.disabled,Ot(z,s.aT.red),B,x,N.debugBuffer,N.tileBorderIndexBuffer,N.debugSegments)}function Ln(N,A,b){const M=N.context,O=M.gl,z=N.colorModeForRenderPass(),J=new sr(O.LEQUAL,sr.ReadWrite,N.depthRangeFor3D),w=N.useProgram("terrain"),l=A.getTerrainMesh();M.bindFramebuffer.set(null),M.viewport.set([0,0,N.width,N.height]);for(const p of b){const x=N.renderToTexture.getTexture(p),B=A.getTerrainData(p.tileID);M.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,x.texture);const L={u_matrix:N.transform.calculatePosMatrix(p.tileID.toUnwrapped()),u_texture:0,u_ele_delta:A.getMeshFrameDelta(N.transform.zoom)};w.draw(M,O.TRIANGLES,J,$r.disabled,z,ei.backCCW,L,B,"terrain",l.vertexBuffer,l.indexBuffer,l.segments)}}class fn{constructor(A,b){this.context=new gr(A),this.transform=b,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.Z(),renderTime:0},this.setup(),this.numSublayers=$t.maxUnderzooming+$t.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new qs}resize(A,b,M){if(this.width=Math.floor(A*M),this.height=Math.floor(b*M),this.pixelRatio=M,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const O of this.style._order)this.style._layers[O].resize()}setup(){const A=this.context,b=new s.a_;b.emplaceBack(0,0),b.emplaceBack(s.N,0),b.emplaceBack(0,s.N),b.emplaceBack(s.N,s.N),this.tileExtentBuffer=A.createVertexBuffer(b,co.members),this.tileExtentSegments=s.S.simpleSegment(0,0,4,2);const M=new s.a_;M.emplaceBack(0,0),M.emplaceBack(s.N,0),M.emplaceBack(0,s.N),M.emplaceBack(s.N,s.N),this.debugBuffer=A.createVertexBuffer(M,co.members),this.debugSegments=s.S.simpleSegment(0,0,4,5);const O=new s.V;O.emplaceBack(0,0,0,0),O.emplaceBack(s.N,0,s.N,0),O.emplaceBack(0,s.N,0,s.N),O.emplaceBack(s.N,s.N,s.N,s.N),this.rasterBoundsBuffer=A.createVertexBuffer(O,Mt.members),this.rasterBoundsSegments=s.S.simpleSegment(0,0,4,2);const z=new s.a_;z.emplaceBack(0,0),z.emplaceBack(1,0),z.emplaceBack(0,1),z.emplaceBack(1,1),this.viewportBuffer=A.createVertexBuffer(z,co.members),this.viewportSegments=s.S.simpleSegment(0,0,4,2);const J=new s.a$;J.emplaceBack(0),J.emplaceBack(1),J.emplaceBack(3),J.emplaceBack(2),J.emplaceBack(0),this.tileBorderIndexBuffer=A.createIndexBuffer(J);const w=new s.b0;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=A.createIndexBuffer(w);const l=this.context.gl;this.stencilClearMode=new $r({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO)}clearStencil(){const A=this.context,b=A.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const M=s.Z();s.aS(M,0,this.width,this.height,0,0,1),s.a0(M,M,[b.drawingBufferWidth,b.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(A,b.TRIANGLES,sr.disabled,this.stencilClearMode,Lt.disabled,ei.disabled,fr(M),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(A,b){if(this.currentStencilSource===A.source||!A.isTileClipped()||!b||!b.length)return;this.currentStencilSource=A.source;const M=this.context,O=M.gl;this.nextStencilID+b.length>256&&this.clearStencil(),M.setColorMode(Lt.disabled),M.setDepthMode(sr.disabled);const z=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const J of b){const w=this._tileClippingMaskIDs[J.key]=this.nextStencilID++,l=this.style.map.terrain&&this.style.map.terrain.getTerrainData(J);z.draw(M,O.TRIANGLES,sr.disabled,new $r({func:O.ALWAYS,mask:0},w,255,O.KEEP,O.KEEP,O.REPLACE),Lt.disabled,ei.disabled,fr(J.posMatrix),l,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const A=this.nextStencilID++,b=this.context.gl;return new $r({func:b.NOTEQUAL,mask:255},A,255,b.KEEP,b.KEEP,b.REPLACE)}stencilModeForClipping(A){const b=this.context.gl;return new $r({func:b.EQUAL,mask:255},this._tileClippingMaskIDs[A.key],0,b.KEEP,b.KEEP,b.REPLACE)}stencilConfigForOverlap(A){const b=this.context.gl,M=A.sort((J,w)=>w.overscaledZ-J.overscaledZ),O=M[M.length-1].overscaledZ,z=M[0].overscaledZ-O+1;if(z>1){this.currentStencilSource=void 0,this.nextStencilID+z>256&&this.clearStencil();const J={};for(let w=0;w<z;w++)J[w+O]=new $r({func:b.GEQUAL,mask:255},w+this.nextStencilID,255,b.KEEP,b.KEEP,b.REPLACE);return this.nextStencilID+=z,[J,M]}return[{[O]:$r.disabled},M]}colorModeForRenderPass(){const A=this.context.gl;return this._showOverdrawInspector?new Lt([A.CONSTANT_COLOR,A.ONE],new s.aT(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Lt.unblended:Lt.alphaBlended}depthModeForSublayer(A,b,M){if(!this.opaquePassEnabledForLayer())return sr.disabled;const O=1-((1+this.currentLayer)*this.numSublayers+A)*this.depthEpsilon;return new sr(M||this.context.gl.LEQUAL,b,[O,O])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(A,b){this.style=A,this.options=b,this.lineAtlas=A.lineAtlas,this.imageManager=A.imageManager,this.glyphManager=A.glyphManager,this.symbolFadeChange=A.placement.symbolFadeChange(s.h.now()),this.imageManager.beginFrame();const M=this.style._order,O=this.style.sourceCaches,z={},J={},w={};for(const l in O){const p=O[l];p.used&&p.prepare(this.context),z[l]=p.getVisibleCoordinates(),J[l]=z[l].slice().reverse(),w[l]=p.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let l=0;l<M.length;l++)if(this.style._layers[M[l]].is3D()){this.opaquePassCutoff=l;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const l=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!s.b1(this.terrainFacilitator.matrix,this.transform.projMatrix)||l.length)&&(s.b2(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(p,x){const B=p.context,L=B.gl,j=Lt.unblended,_=new sr(L.LEQUAL,sr.ReadWrite,[0,1]),E=x.getTerrainMesh(),F=x.sourceCache.getRenderableTiles(),V=p.useProgram("terrainDepth");B.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),B.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),B.clear({color:s.aT.transparent,depth:1});for(const q of F){const K=x.getTerrainData(q.tileID),te={u_matrix:p.transform.calculatePosMatrix(q.tileID.toUnwrapped()),u_ele_delta:x.getMeshFrameDelta(p.transform.zoom)};V.draw(B,L.TRIANGLES,_,$r.disabled,j,ei.backCCW,te,K,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}B.bindFramebuffer.set(null),B.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain),function(p,x){const B=p.context,L=B.gl,j=Lt.unblended,_=new sr(L.LEQUAL,sr.ReadWrite,[0,1]),E=x.getTerrainMesh(),F=x.getCoordsTexture(),V=x.sourceCache.getRenderableTiles(),q=p.useProgram("terrainCoords");B.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),B.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),B.clear({color:s.aT.transparent,depth:1}),x.coordsIndex=[];for(const K of V){const te=x.getTerrainData(K.tileID);B.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,F.texture);const se={u_matrix:p.transform.calculatePosMatrix(K.tileID.toUnwrapped()),u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(p.transform.zoom)};q.draw(B,L.TRIANGLES,_,$r.disabled,j,ei.backCCW,se,te,"terrain",E.vertexBuffer,E.indexBuffer,E.segments),x.coordsIndex.push(K.tileID.key)}B.bindFramebuffer.set(null),B.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const l of M){const p=this.style._layers[l];if(!p.hasOffscreenPass()||p.isHidden(this.transform.zoom))continue;const x=J[p.source];(p.type==="custom"||x.length)&&this.renderLayer(this,O[p.source],p,x)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:b.showOverdrawInspector?s.aT.black:s.aT.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=b.showOverdrawInspector,this.depthRangeFor3D=[0,1-(A._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=M.length-1;this.currentLayer>=0;this.currentLayer--){const l=this.style._layers[M[this.currentLayer]],p=O[l.source],x=z[l.source];this._renderTileClippingMasks(l,x),this.renderLayer(this,p,l,x)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<M.length;this.currentLayer++){const l=this.style._layers[M[this.currentLayer]],p=O[l.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(l))continue;const x=(l.type==="symbol"?w:J)[l.source];this._renderTileClippingMasks(l,z[l.source]),this.renderLayer(this,p,l,x)}if(this.options.showTileBoundaries){const l=function(p,x){let B=null;const L=Object.values(p._layers).flatMap(F=>F.source&&!F.isHidden(x)?[p.sourceCaches[F.source]]:[]),j=L.filter(F=>F.getSource().type==="vector"),_=L.filter(F=>F.getSource().type!=="vector"),E=F=>{(!B||B.getSource().maxzoom<F.getSource().maxzoom)&&(B=F)};return j.forEach(F=>E(F)),B||_.forEach(F=>E(F)),B}(this.style,this.transform.zoom);l&&function(p,x,B){for(let L=0;L<B.length;L++)Hu(p,x,B[L])}(this,l,l.getVisibleCoordinates())}this.options.showPadding&&function(l){const p=l.transform.padding;Fa(l,l.transform.height-(p.top||0),3,Bc),Fa(l,p.bottom||0,3,Pa),Da(l,p.left||0,3,_s),Da(l,l.transform.width-(p.right||0),3,gl);const x=l.transform.centerPoint;(function(B,L,j,_){Rs(B,L-1,j-10,2,20,_),Rs(B,L-10,j-1,20,2,_)})(l,x.x,l.transform.height-x.y,Zl)}(this),this.context.setDefault()}renderLayer(A,b,M,O){if(!M.isHidden(this.transform.zoom)&&(M.type==="background"||M.type==="custom"||(O||[]).length))switch(this.id=M.id,M.type){case"symbol":(function(z,J,w,l,p){if(z.renderPass!=="translucent")return;const x=$r.disabled,B=z.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(L,j,_,E,F,V,q){const K=j.transform,te=F==="map",se=V==="map";for(const oe of L){const le=E.getTile(oe),_e=le.getBucket(_);if(!_e||!_e.text||!_e.text.segments.get().length)continue;const Ie=s.ah(_e.textSizeData,K.zoom),ve=Fe(le,1,j.transform.zoom),Se=Wt(oe.posMatrix,se,te,j.transform,ve),et=_.layout.get("icon-text-fit")!=="none"&&_e.hasIconData();if(Ie){const Oe=Math.pow(2,K.zoom-le.tileID.overscaledZ);Di(_e,te,se,q,K,Se,oe.posMatrix,Oe,Ie,et,j.style.map.terrain?(Re,Ve)=>j.style.map.terrain.getElevation(oe,Re,Ve):null)}}}(l,z,w,J,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),p),w.paint.get("icon-opacity").constantOr(1)!==0&&Ds(z,J,w,l,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),x,B),w.paint.get("text-opacity").constantOr(1)!==0&&Ds(z,J,w,l,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),x,B),J.map.showCollisionBoxes&&($n(z,J,w,l,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),!0),$n(z,J,w,l,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),!1))})(A,b,M,O,this.style.placement.variableOffsets);break;case"circle":(function(z,J,w,l){if(z.renderPass!=="translucent")return;const p=w.paint.get("circle-opacity"),x=w.paint.get("circle-stroke-width"),B=w.paint.get("circle-stroke-opacity"),L=!w.layout.get("circle-sort-key").isConstant();if(p.constantOr(1)===0&&(x.constantOr(1)===0||B.constantOr(1)===0))return;const j=z.context,_=j.gl,E=z.depthModeForSublayer(0,sr.ReadOnly),F=$r.disabled,V=z.colorModeForRenderPass(),q=[];for(let K=0;K<l.length;K++){const te=l[K],se=J.getTile(te),oe=se.getBucket(w);if(!oe)continue;const le=oe.programConfigurations.get(w.id),_e=z.useProgram("circle",le),Ie=oe.layoutVertexBuffer,ve=oe.indexBuffer,Se=z.style.map.terrain&&z.style.map.terrain.getTerrainData(te),et={programConfiguration:le,program:_e,layoutVertexBuffer:Ie,indexBuffer:ve,uniformValues:Je(z,te,se,w),terrainData:Se};if(L){const Oe=oe.segments.get();for(const Re of Oe)q.push({segments:new s.S([Re]),sortKey:Re.sortKey,state:et})}else q.push({segments:oe.segments,sortKey:0,state:et})}L&&q.sort((K,te)=>K.sortKey-te.sortKey);for(const K of q){const{programConfiguration:te,program:se,layoutVertexBuffer:oe,indexBuffer:le,uniformValues:_e,terrainData:Ie}=K.state;se.draw(j,_.TRIANGLES,E,F,V,ei.disabled,_e,Ie,w.id,oe,le,K.segments,w.paint,z.transform.zoom,te)}})(A,b,M,O);break;case"heatmap":(function(z,J,w,l){if(w.paint.get("heatmap-opacity")!==0)if(z.renderPass==="offscreen"){const p=z.context,x=p.gl,B=$r.disabled,L=new Lt([x.ONE,x.ONE],s.aT.transparent,[!0,!0,!0,!0]);(function(j,_,E){const F=j.gl;j.activeTexture.set(F.TEXTURE1),j.viewport.set([0,0,_.width/4,_.height/4]);let V=E.heatmapFbo;if(V)F.bindTexture(F.TEXTURE_2D,V.colorAttachment.get()),j.bindFramebuffer.set(V.framebuffer);else{const q=F.createTexture();F.bindTexture(F.TEXTURE_2D,q),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),V=E.heatmapFbo=j.createFramebuffer(_.width/4,_.height/4,!1,!1),function(K,te,se,oe){var le,_e;const Ie=K.gl,ve=(le=K.HALF_FLOAT)!==null&&le!==void 0?le:Ie.UNSIGNED_BYTE,Se=(_e=K.RGBA16F)!==null&&_e!==void 0?_e:Ie.RGBA;Ie.texImage2D(Ie.TEXTURE_2D,0,Se,te.width/4,te.height/4,0,Ie.RGBA,ve,null),oe.colorAttachment.set(se)}(j,_,q,V)}})(p,z,w),p.clear({color:s.aT.transparent});for(let j=0;j<l.length;j++){const _=l[j];if(J.hasRenderableParent(_))continue;const E=J.getTile(_),F=E.getBucket(w);if(!F)continue;const V=F.programConfigurations.get(w.id),q=z.useProgram("heatmap",V),{zoom:K}=z.transform;q.draw(p,x.TRIANGLES,sr.disabled,B,L,ei.disabled,qr(_.posMatrix,E,K,w.paint.get("heatmap-intensity")),null,w.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,w.paint,z.transform.zoom,V)}p.viewport.set([0,0,z.width,z.height])}else z.renderPass==="translucent"&&(z.context.setColorMode(z.colorModeForRenderPass()),function(p,x){const B=p.context,L=B.gl,j=x.heatmapFbo;if(!j)return;B.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,j.colorAttachment.get()),B.activeTexture.set(L.TEXTURE1);let _=x.colorRampTexture;_||(_=x.colorRampTexture=new nt(B,x.colorRamp,L.RGBA)),_.bind(L.LINEAR,L.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(B,L.TRIANGLES,sr.disabled,$r.disabled,p.colorModeForRenderPass(),ei.disabled,((E,F,V,q)=>{const K=s.Z();s.aS(K,0,E.width,E.height,0,0,1);const te=E.context.gl;return{u_matrix:K,u_world:[te.drawingBufferWidth,te.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}})(p,x),null,x.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,x.paint,p.transform.zoom)}(z,w))})(A,b,M,O);break;case"line":(function(z,J,w,l){if(z.renderPass!=="translucent")return;const p=w.paint.get("line-opacity"),x=w.paint.get("line-width");if(p.constantOr(1)===0||x.constantOr(1)===0)return;const B=z.depthModeForSublayer(0,sr.ReadOnly),L=z.colorModeForRenderPass(),j=w.paint.get("line-dasharray"),_=w.paint.get("line-pattern"),E=_.constantOr(1),F=w.paint.get("line-gradient"),V=w.getCrossfadeParameters(),q=E?"linePattern":j?"lineSDF":F?"lineGradient":"line",K=z.context,te=K.gl;let se=!0;for(const oe of l){const le=J.getTile(oe);if(E&&!le.patternsLoaded())continue;const _e=le.getBucket(w);if(!_e)continue;const Ie=_e.programConfigurations.get(w.id),ve=z.context.program.get(),Se=z.useProgram(q,Ie),et=se||Se.program!==ve,Oe=z.style.map.terrain&&z.style.map.terrain.getTerrainData(oe),Re=_.constantOr(null);if(Re&&le.imageAtlas){const dt=le.imageAtlas,ft=dt.patternPositions[Re.to.toString()],Nt=dt.patternPositions[Re.from.toString()];ft&&Nt&&Ie.setConstantPatternPositions(ft,Nt)}const Ve=Oe?oe:null,At=E?os(z,le,w,V,Ve):j?_n(z,le,w,j,V,Ve):F?qn(z,le,w,_e.lineClipsArray.length,Ve):In(z,le,w,Ve);if(E)K.activeTexture.set(te.TEXTURE0),le.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Ie.updatePaintBuffers(V);else if(j&&(et||z.lineAtlas.dirty))K.activeTexture.set(te.TEXTURE0),z.lineAtlas.bind(K);else if(F){const dt=_e.gradients[w.id];let ft=dt.texture;if(w.gradientVersion!==dt.version){let Nt=256;if(w.stepInterpolant){const It=J.getSource().maxzoom,jt=oe.canonical.z===It?Math.ceil(1<<z.transform.maxZoom-oe.canonical.z):1;Nt=s.ad(s.aY(_e.maxLineLength/s.N*1024*jt),256,K.maxTextureSize)}dt.gradient=s.aZ({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Nt,image:dt.gradient||void 0,clips:_e.lineClipsArray}),dt.texture?dt.texture.update(dt.gradient):dt.texture=new nt(K,dt.gradient,te.RGBA),dt.version=w.gradientVersion,ft=dt.texture}K.activeTexture.set(te.TEXTURE0),ft.bind(w.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}Se.draw(K,te.TRIANGLES,B,z.stencilModeForClipping(oe),L,ei.disabled,At,Oe,w.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,w.paint,z.transform.zoom,Ie,_e.layoutVertexBuffer2),se=!1}})(A,b,M,O);break;case"fill":(function(z,J,w,l){const p=w.paint.get("fill-color"),x=w.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const B=z.colorModeForRenderPass(),L=w.paint.get("fill-pattern"),j=z.opaquePassEnabledForLayer()&&!L.constantOr(1)&&p.constantOr(s.aT.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(z.renderPass===j){const _=z.depthModeForSublayer(1,z.renderPass==="opaque"?sr.ReadWrite:sr.ReadOnly);Ma(z,J,w,l,_,B,!1)}if(z.renderPass==="translucent"&&w.paint.get("fill-antialias")){const _=z.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,sr.ReadOnly);Ma(z,J,w,l,_,B,!0)}})(A,b,M,O);break;case"fill-extrusion":(function(z,J,w,l){const p=w.paint.get("fill-extrusion-opacity");if(p!==0&&z.renderPass==="translucent"){const x=new sr(z.context.gl.LEQUAL,sr.ReadWrite,z.depthRangeFor3D);if(p!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))ma(z,J,w,l,x,$r.disabled,Lt.disabled),ma(z,J,w,l,x,z.stencilModeFor3D(),z.colorModeForRenderPass());else{const B=z.colorModeForRenderPass();ma(z,J,w,l,x,$r.disabled,B)}}})(A,b,M,O);break;case"hillshade":(function(z,J,w,l){if(z.renderPass!=="offscreen"&&z.renderPass!=="translucent")return;const p=z.context,x=z.depthModeForSublayer(0,sr.ReadOnly),B=z.colorModeForRenderPass(),[L,j]=z.renderPass==="translucent"?z.stencilConfigForOverlap(l):[{},l];for(const _ of j){const E=J.getTile(_);E.needsHillshadePrepare!==void 0&&E.needsHillshadePrepare&&z.renderPass==="offscreen"?pl(z,E,w,x,$r.disabled,B):z.renderPass==="translucent"&&wc(z,_,E,w,x,L[_.overscaledZ],B)}p.viewport.set([0,0,z.width,z.height])})(A,b,M,O);break;case"raster":(function(z,J,w,l){if(z.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!l.length)return;const p=z.context,x=p.gl,B=J.getSource(),L=z.useProgram("raster"),j=z.colorModeForRenderPass(),[_,E]=B instanceof qt?[{},l]:z.stencilConfigForOverlap(l),F=E[E.length-1].overscaledZ,V=!z.options.moving;for(const q of E){const K=z.depthModeForSublayer(q.overscaledZ-F,w.paint.get("raster-opacity")===1?sr.ReadWrite:sr.ReadOnly,x.LESS),te=J.getTile(q);te.registerFadeDuration(w.paint.get("raster-fade-duration"));const se=J.findLoadedParent(q,0),oe=Xl(te,se,J,w,z.transform,z.style.map.terrain);let le,_e;const Ie=w.paint.get("raster-resampling")==="nearest"?x.NEAREST:x.LINEAR;p.activeTexture.set(x.TEXTURE0),te.texture.bind(Ie,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),p.activeTexture.set(x.TEXTURE1),se?(se.texture.bind(Ie,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),le=Math.pow(2,se.tileID.overscaledZ-te.tileID.overscaledZ),_e=[te.tileID.canonical.x*le%1,te.tileID.canonical.y*le%1]):te.texture.bind(Ie,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST);const ve=z.style.map.terrain&&z.style.map.terrain.getTerrainData(q),Se=ve?q:null,et=Se?Se.posMatrix:z.transform.calculatePosMatrix(q.toUnwrapped(),V),Oe=Ei(et,_e||[0,0],le||1,oe,w);B instanceof qt?L.draw(p,x.TRIANGLES,K,$r.disabled,j,ei.disabled,Oe,ve,w.id,B.boundsBuffer,z.quadTriangleIndexBuffer,B.boundsSegments):L.draw(p,x.TRIANGLES,K,_[q.overscaledZ],j,ei.disabled,Oe,ve,w.id,z.rasterBoundsBuffer,z.quadTriangleIndexBuffer,z.rasterBoundsSegments)}})(A,b,M,O);break;case"background":(function(z,J,w,l){const p=w.paint.get("background-color"),x=w.paint.get("background-opacity");if(x===0)return;const B=z.context,L=B.gl,j=z.transform,_=j.tileSize,E=w.paint.get("background-pattern");if(z.isPatternMissing(E))return;const F=!E&&p.a===1&&x===1&&z.opaquePassEnabledForLayer()?"opaque":"translucent";if(z.renderPass!==F)return;const V=$r.disabled,q=z.depthModeForSublayer(0,F==="opaque"?sr.ReadWrite:sr.ReadOnly),K=z.colorModeForRenderPass(),te=z.useProgram(E?"backgroundPattern":"background"),se=l||j.coveringTiles({tileSize:_,terrain:z.style.map.terrain});E&&(B.activeTexture.set(L.TEXTURE0),z.imageManager.bind(z.context));const oe=w.getCrossfadeParameters();for(const le of se){const _e=l?le.posMatrix:z.transform.calculatePosMatrix(le.toUnwrapped()),Ie=E?ys(_e,x,z,E,{tileID:le,tileSize:_},oe):Ia(_e,x,p),ve=z.style.map.terrain&&z.style.map.terrain.getTerrainData(le);te.draw(B,L.TRIANGLES,q,V,K,ei.disabled,Ie,ve,w.id,z.tileExtentBuffer,z.quadTriangleIndexBuffer,z.tileExtentSegments)}})(A,0,M,O);break;case"custom":(function(z,J,w){const l=z.context,p=w.implementation;if(z.renderPass==="offscreen"){const x=p.prerender;x&&(z.setCustomLayerDefaults(),l.setColorMode(z.colorModeForRenderPass()),x.call(p,l.gl,z.transform.customLayerMatrix()),l.setDirty(),z.setBaseState())}else if(z.renderPass==="translucent"){z.setCustomLayerDefaults(),l.setColorMode(z.colorModeForRenderPass()),l.setStencilMode($r.disabled);const x=p.renderingMode==="3d"?new sr(z.context.gl.LEQUAL,sr.ReadWrite,z.depthRangeFor3D):z.depthModeForSublayer(0,sr.ReadOnly);l.setDepthMode(x),p.render(l.gl,z.transform.customLayerMatrix()),l.setDirty(),z.setBaseState(),l.bindFramebuffer.set(null)}})(A,0,M)}}translatePosMatrix(A,b,M,O,z){if(!M[0]&&!M[1])return A;const J=z?O==="map"?this.transform.angle:0:O==="viewport"?-this.transform.angle:0;if(J){const p=Math.sin(J),x=Math.cos(J);M=[M[0]*x-M[1]*p,M[0]*p+M[1]*x]}const w=[z?M[0]:Fe(b,M[0],this.transform.zoom),z?M[1]:Fe(b,M[1],this.transform.zoom),0],l=new Float32Array(16);return s.$(l,A,w),l}saveTileTexture(A){const b=this._tileTextures[A.size[0]];b?b.push(A):this._tileTextures[A.size[0]]=[A]}getTileTexture(A){const b=this._tileTextures[A];return b&&b.length>0?b.pop():null}isPatternMissing(A){if(!A)return!1;if(!A.from||!A.to)return!0;const b=this.imageManager.getPattern(A.from.toString()),M=this.imageManager.getPattern(A.to.toString());return!b||!M}useProgram(A,b){this.cache=this.cache||{};const M=A+(b?b.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[M]||(this.cache[M]=new Tn(this.context,bi[A],b,La[A],this._showOverdrawInspector,this.style.map.terrain)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const A=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(A.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new nt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:A,drawingBufferHeight:b}=this.context.gl;return this.width!==A||this.height!==b}}class pn{constructor(A,b){this.points=A,this.planes=b}static fromInvProjectionMatrix(A,b,M){const O=Math.pow(2,M),z=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const l=1/(w=s.ag([],w,A))[3]/b*O;return s.b3(w,w,[l,l,1/w[3],l])}),J=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const l=function(L,j){var _=j[0],E=j[1],F=j[2],V=_*_+E*E+F*F;return V>0&&(V=1/Math.sqrt(V)),L[0]=j[0]*V,L[1]=j[1]*V,L[2]=j[2]*V,L}([],function(L,j,_){var E=j[0],F=j[1],V=j[2],q=_[0],K=_[1],te=_[2];return L[0]=F*te-V*K,L[1]=V*q-E*te,L[2]=E*K-F*q,L}([],je([],z[w[0]],z[w[1]]),je([],z[w[2]],z[w[1]]))),p=-((x=l)[0]*(B=z[w[1]])[0]+x[1]*B[1]+x[2]*B[2]);var x,B;return l.concat(p)});return new pn(z,J)}}class fs{constructor(A,b){this.min=A,this.max=b,this.center=function(M,O,z){return M[0]=.5*O[0],M[1]=.5*O[1],M[2]=.5*O[2],M}([],function(M,O,z){return M[0]=O[0]+z[0],M[1]=O[1]+z[1],M[2]=O[2]+z[2],M}([],this.min,this.max))}quadrant(A){const b=[A%2==0,A<2],M=Te(this.min),O=Te(this.max);for(let z=0;z<b.length;z++)M[z]=b[z]?this.min[z]:this.center[z],O[z]=b[z]?this.center[z]:this.max[z];return O[2]=this.max[2],new fs(M,O)}distanceX(A){return Math.max(Math.min(this.max[0],A[0]),this.min[0])-A[0]}distanceY(A){return Math.max(Math.min(this.max[1],A[1]),this.min[1])-A[1]}intersects(A){const b=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let M=!0;for(let O=0;O<A.planes.length;O++){const z=A.planes[O];let J=0;for(let w=0;w<b.length;w++)s.b4(z,b[w])>=0&&J++;if(J===0)return 0;J!==b.length&&(M=!1)}if(M)return 2;for(let O=0;O<3;O++){let z=Number.MAX_VALUE,J=-Number.MAX_VALUE;for(let w=0;w<A.points.length;w++){const l=A.points[w][O]-this.min[O];z=Math.min(z,l),J=Math.max(J,l)}if(J<0||z>this.max[O]-this.min[O])return 0}return 1}}class ya{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(isNaN(A)||A<0||isNaN(b)||b<0||isNaN(M)||M<0||isNaN(O)||O<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=A,this.bottom=b,this.left=M,this.right=O}interpolate(A,b,M){return b.top!=null&&A.top!=null&&(this.top=s.B.number(A.top,b.top,M)),b.bottom!=null&&A.bottom!=null&&(this.bottom=s.B.number(A.bottom,b.bottom,M)),b.left!=null&&A.left!=null&&(this.left=s.B.number(A.left,b.left,M)),b.right!=null&&A.right!=null&&(this.right=s.B.number(A.right,b.right,M)),this}getCenter(A,b){const M=s.ad((this.left+A-this.right)/2,0,A),O=s.ad((this.top+b-this.bottom)/2,0,b);return new s.P(M,O)}equals(A){return this.top===A.top&&this.bottom===A.bottom&&this.left===A.left&&this.right===A.right}clone(){return new ya(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Jl{constructor(A,b,M,O,z){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=z===void 0||!!z,this._minZoom=A||0,this._maxZoom=b||22,this._minPitch=M??0,this._maxPitch=O??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.L(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ya,this._posMatrixCache={},this._alignedPosMatrixCache={},this._minEleveationForCurrentTile=0}clone(){const A=new Jl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return A.apply(this),A}apply(A){this.tileSize=A.tileSize,this.latRange=A.latRange,this.width=A.width,this.height=A.height,this._center=A._center,this._elevation=A._elevation,this._minEleveationForCurrentTile=A._minEleveationForCurrentTile,this.zoom=A.zoom,this.angle=A.angle,this._fov=A._fov,this._pitch=A._pitch,this._unmodified=A._unmodified,this._edgeInsets=A._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(A){this._minZoom!==A&&(this._minZoom=A,this.zoom=Math.max(this.zoom,A))}get maxZoom(){return this._maxZoom}set maxZoom(A){this._maxZoom!==A&&(this._maxZoom=A,this.zoom=Math.min(this.zoom,A))}get minPitch(){return this._minPitch}set minPitch(A){this._minPitch!==A&&(this._minPitch=A,this.pitch=Math.max(this.pitch,A))}get maxPitch(){return this._maxPitch}set maxPitch(A){this._maxPitch!==A&&(this._maxPitch=A,this.pitch=Math.min(this.pitch,A))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(A){A===void 0?A=!0:A===null&&(A=!1),this._renderWorldCopies=A}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(A){const b=-s.b5(A,-180,180)*Math.PI/180;this.angle!==b&&(this._unmodified=!1,this.angle=b,this._calcMatrices(),this.rotationMatrix=function(){var M=new s.A(4);return s.A!=Float32Array&&(M[1]=0,M[2]=0),M[0]=1,M[3]=1,M}(),function(M,O,z){var J=O[0],w=O[1],l=O[2],p=O[3],x=Math.sin(z),B=Math.cos(z);M[0]=J*B+l*x,M[1]=w*B+p*x,M[2]=J*-x+l*B,M[3]=w*-x+p*B}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(A){const b=s.ad(A,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==b&&(this._unmodified=!1,this._pitch=b,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(A){A=Math.max(.01,Math.min(60,A)),this._fov!==A&&(this._unmodified=!1,this._fov=A/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(A){const b=Math.min(Math.max(A,this.minZoom),this.maxZoom);this._zoom!==b&&(this._unmodified=!1,this._zoom=b,this.tileZoom=Math.max(0,Math.floor(b)),this.scale=this.zoomScale(b),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(A){A.lat===this._center.lat&&A.lng===this._center.lng||(this._unmodified=!1,this._center=A,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(A){A!==this._elevation&&(this._elevation=A,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(A){this._edgeInsets.equals(A)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,A,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(A){return this._edgeInsets.equals(A)}interpolatePadding(A,b,M){this._unmodified=!1,this._edgeInsets.interpolate(A,b,M),this._constrain(),this._calcMatrices()}coveringZoomLevel(A){const b=(A.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/A.tileSize));return Math.max(0,b)}getVisibleUnwrappedCoordinates(A){const b=[new s.b6(0,A)];if(this._renderWorldCopies){const M=this.pointCoordinate(new s.P(0,0)),O=this.pointCoordinate(new s.P(this.width,0)),z=this.pointCoordinate(new s.P(this.width,this.height)),J=this.pointCoordinate(new s.P(0,this.height)),w=Math.floor(Math.min(M.x,O.x,z.x,J.x)),l=Math.floor(Math.max(M.x,O.x,z.x,J.x)),p=1;for(let x=w-p;x<=l+p;x++)x!==0&&b.push(new s.b6(x,A))}return b}coveringTiles(A){var b,M;let O=this.coveringZoomLevel(A);const z=O;if(A.minzoom!==void 0&&O<A.minzoom)return[];A.maxzoom!==void 0&&O>A.maxzoom&&(O=A.maxzoom);const J=this.pointCoordinate(this.getCameraPoint()),w=s.U.fromLngLat(this.center),l=Math.pow(2,O),p=[l*J.x,l*J.y,0],x=[l*w.x,l*w.y,0],B=pn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,O);let L=A.minzoom||0;!A.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(L=O);const j=A.terrain?2/Math.min(this.tileSize,A.tileSize)*this.tileSize:3,_=K=>({aabb:new fs([K*l,0,0],[(K+1)*l,l,0]),zoom:0,x:0,y:0,wrap:K,fullyVisible:!1}),E=[],F=[],V=O,q=A.reparseOverscaled?z:O;if(this._renderWorldCopies)for(let K=1;K<=3;K++)E.push(_(-K)),E.push(_(K));for(E.push(_(0));E.length>0;){const K=E.pop(),te=K.x,se=K.y;let oe=K.fullyVisible;if(!oe){const Se=K.aabb.intersects(B);if(Se===0)continue;oe=Se===2}const le=A.terrain?p:x,_e=K.aabb.distanceX(le),Ie=K.aabb.distanceY(le),ve=Math.max(Math.abs(_e),Math.abs(Ie));if(K.zoom===V||ve>j+(1<<V-K.zoom)-2&&K.zoom>=L){const Se=V-K.zoom,et=p[0]-.5-(te<<Se),Oe=p[1]-.5-(se<<Se);F.push({tileID:new s.O(K.zoom===V?q:K.zoom,K.wrap,K.zoom,te,se),distanceSq:We([x[0]-.5-te,x[1]-.5-se]),tileDistanceToCamera:Math.sqrt(et*et+Oe*Oe)})}else for(let Se=0;Se<4;Se++){const et=(te<<1)+Se%2,Oe=(se<<1)+(Se>>1),Re=K.zoom+1;let Ve=K.aabb.quadrant(Se);if(A.terrain){const At=new s.O(Re,K.wrap,Re,et,Oe),dt=A.terrain.getMinMaxElevation(At),ft=(b=dt.minElevation)!==null&&b!==void 0?b:this.elevation,Nt=(M=dt.maxElevation)!==null&&M!==void 0?M:this.elevation;Ve=new fs([Ve.min[0],Ve.min[1],ft],[Ve.max[0],Ve.max[1],Nt])}E.push({aabb:Ve,zoom:Re,x:et,y:Oe,wrap:K.wrap,fullyVisible:oe})}}return F.sort((K,te)=>K.distanceSq-te.distanceSq).map(K=>K.tileID)}resize(A,b){this.width=A,this.height=b,this.pixelsToGLUnits=[2/A,-2/b],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(A){return Math.pow(2,A)}scaleZoom(A){return Math.log(A)/Math.LN2}project(A){const b=s.ad(A.lat,-this.maxValidLatitude,this.maxValidLatitude);return new s.P(s.G(A.lng)*this.worldSize,s.H(b)*this.worldSize)}unproject(A){return new s.U(A.x/this.worldSize,A.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(A){const b=this.pointLocation(this.centerPoint,A),M=A.getElevationForLngLatZoom(b,this.tileZoom);if(!(this.elevation-M))return;const O=this.getCameraPosition(),z=s.U.fromLngLat(O.lngLat,O.altitude),J=s.U.fromLngLat(b,M),w=z.x-J.x,l=z.y-J.y,p=z.z-J.z,x=Math.sqrt(w*w+l*l+p*p),B=this.scaleZoom(this.cameraToCenterDistance/x/this.tileSize);this._elevation=M,this._center=b,this.zoom=B}setLocationAtPoint(A,b){const M=this.pointCoordinate(b),O=this.pointCoordinate(this.centerPoint),z=this.locationCoordinate(A),J=new s.U(z.x-(M.x-O.x),z.y-(M.y-O.y));this.center=this.coordinateLocation(J),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(A,b){return b?this.coordinatePoint(this.locationCoordinate(A),b.getElevationForLngLatZoom(A,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(A))}pointLocation(A,b){return this.coordinateLocation(this.pointCoordinate(A,b))}locationCoordinate(A){return s.U.fromLngLat(A)}coordinateLocation(A){return A&&A.toLngLat()}pointCoordinate(A,b){if(b){const L=b.pointCoordinate(A);if(L!=null)return L}const M=[A.x,A.y,0,1],O=[A.x,A.y,1,1];s.ag(M,M,this.pixelMatrixInverse),s.ag(O,O,this.pixelMatrixInverse);const z=M[3],J=O[3],w=M[1]/z,l=O[1]/J,p=M[2]/z,x=O[2]/J,B=p===x?0:(0-p)/(x-p);return new s.U(s.B.number(M[0]/z,O[0]/J,B)/this.worldSize,s.B.number(w,l,B)/this.worldSize)}coordinatePoint(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.pixelMatrix;const O=[A.x*this.worldSize,A.y*this.worldSize,b,1];return s.ag(O,O,M),new s.P(O[0]/O[3],O[1]/O[3])}getBounds(){const A=Math.max(0,this.height/2-this.getHorizon());return new Ze().extend(this.pointLocation(new s.P(0,A))).extend(this.pointLocation(new s.P(this.width,A))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ze([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(A){A?(this.lngRange=[A.getWest(),A.getEast()],this.latRange=[A.getSouth(),A.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const M=A.key,O=b?this._alignedPosMatrixCache:this._posMatrixCache;if(O[M])return O[M];const z=A.canonical,J=this.worldSize/this.zoomScale(z.z),w=z.x+Math.pow(2,z.z)*A.wrap,l=s.ao(new Float64Array(16));return s.$(l,l,[w*J,z.y*J,0]),s.a0(l,l,[J/s.N,J/s.N,1]),s.a1(l,b?this.alignedProjMatrix:this.projMatrix,l),O[M]=new Float32Array(l),O[M]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let A,b,M,O,z=-90,J=90,w=-180,l=180;const p=this.size,x=this._unmodified;if(this.latRange){const j=this.latRange;z=s.H(j[1])*this.worldSize,J=s.H(j[0])*this.worldSize,A=J-z<p.y?p.y/(J-z):0}if(this.lngRange){const j=this.lngRange;w=s.b5(s.G(j[0])*this.worldSize,0,this.worldSize),l=s.b5(s.G(j[1])*this.worldSize,0,this.worldSize),l<w&&(l+=this.worldSize),b=l-w<p.x?p.x/(l-w):0}const B=this.point,L=Math.max(b||0,A||0);if(L)return this.center=this.unproject(new s.P(b?(l+w)/2:B.x,A?(J+z)/2:B.y)),this.zoom+=this.scaleZoom(L),this._unmodified=x,void(this._constraining=!1);if(this.latRange){const j=B.y,_=p.y/2;j-_<z&&(O=z+_),j+_>J&&(O=J-_)}if(this.lngRange){const j=(w+l)/2,_=s.b5(B.x,j-this.worldSize/2,j+this.worldSize/2),E=p.x/2;_-E<w&&(M=w+E),_+E>l&&(M=l-E)}M===void 0&&O===void 0||(this.center=this.unproject(new s.P(M!==void 0?M:B.x,O!==void 0?O:B.y)).wrap()),this._unmodified=x,this._constraining=!1}_calcMatrices(){if(!this.height)return;const A=this.centerOffset,b=this.point.x,M=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b7(1,this.center.lat)*this.worldSize;let O=s.ao(new Float64Array(16));s.a0(O,O,[this.width/2,-this.height/2,1]),s.$(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=s.ao(new Float64Array(16)),s.a0(O,O,[1,-1,1]),s.$(O,O,[-1,-1,0]),s.a0(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O;const z=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),J=Math.min(this.elevation,this._minEleveationForCurrentTile),w=z-J*this._pixelPerMeter/Math.cos(this._pitch),l=J<0?w:z,p=Math.PI/2+this._pitch,x=this._fov*(.5+A.y/this.height),B=Math.sin(x)*l/Math.sin(s.ad(Math.PI-p-x,.01,Math.PI-.01)),L=this.getHorizon(),j=2*Math.atan(L/this.cameraToCenterDistance)*(.5+A.y/(2*L)),_=Math.sin(j)*l/Math.sin(s.ad(Math.PI-p-j,.01,Math.PI-.01)),E=Math.min(B,_),F=1.01*(Math.cos(Math.PI/2-this._pitch)*E+l),V=this.height/50;O=new Float64Array(16),s.b8(O,this._fov,this.width/this.height,V,F),O[8]=2*-A.x/this.width,O[9]=2*A.y/this.height,s.a0(O,O,[1,-1,1]),s.$(O,O,[0,0,-this.cameraToCenterDistance]),s.b9(O,O,this._pitch),s.ae(O,O,this.angle),s.$(O,O,[-b,-M,0]),this.mercatorMatrix=s.a0([],O,[this.worldSize,this.worldSize,this.worldSize]),s.a0(O,O,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.a1(new Float64Array(16),this.labelPlaneMatrix,O),s.$(O,O,[0,0,-this.elevation]),this.projMatrix=O,this.invProjMatrix=s.as([],O),this.pixelMatrix3D=s.a1(new Float64Array(16),this.labelPlaneMatrix,O);const q=this.width%2/2,K=this.height%2/2,te=Math.cos(this.angle),se=Math.sin(this.angle),oe=b-Math.round(b)+te*q+se*K,le=M-Math.round(M)+te*K+se*q,_e=new Float64Array(O);if(s.$(_e,_e,[oe>.5?oe-1:oe,le>.5?le-1:le,0]),this.alignedProjMatrix=_e,O=s.as(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");this.pixelMatrixInverse=O,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const A=this.pointCoordinate(new s.P(0,0)),b=[A.x*this.worldSize,A.y*this.worldSize,0,1];return s.ag(b,b,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const A=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,A))}getCameraQueryGeometry(A){const b=this.getCameraPoint();if(A.length===1)return[A[0],b];{let M=b.x,O=b.y,z=b.x,J=b.y;for(const w of A)M=Math.min(M,w.x),O=Math.min(O,w.y),z=Math.max(z,w.x),J=Math.max(J,w.y);return[new s.P(M,O),new s.P(z,O),new s.P(z,J),new s.P(M,J),new s.P(M,O)]}}}function ho(N,A){var b=this;let M,O=!1,z=null,J=null;const w=()=>{z=null,O&&(N.apply(J,M),z=setTimeout(w,A),O=!1)};return function(){for(var l=arguments.length,p=new Array(l),x=0;x<l;x++)p[x]=arguments[x];return O=!0,J=b,M=p,z||w(),z}}class vs{constructor(A){this._getCurrentHash=()=>{const b=window.location.hash.replace("#","");if(this._hashName){let M;return b.split("&").map(O=>O.split("=")).forEach(O=>{O[0]===this._hashName&&(M=O)}),(M&&M[1]||"").split("/")}return b.split("/")},this._onHashChange=()=>{const b=this._getCurrentHash();if(b.length>=3&&!b.some(M=>isNaN(M))){const M=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(b[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+b[2],+b[1]],zoom:+b[0],bearing:M,pitch:+(b[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const b=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,b)}catch{}},this._updateHash=ho(this._updateHashUnthrottled,300),this._hashName=A&&encodeURIComponent(A)}addTo(A){return this._map=A,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(A){const b=this._map.getCenter(),M=Math.round(100*this._map.getZoom())/100,O=Math.ceil((M*Math.LN2+Math.log(512/360/.5))/Math.LN10),z=Math.pow(10,O),J=Math.round(b.lng*z)/z,w=Math.round(b.lat*z)/z,l=this._map.getBearing(),p=this._map.getPitch();let x="";if(x+=A?`/${J}/${w}/${M}`:`${M}/${w}/${J}`,(l||p)&&(x+="/"+Math.round(10*l)/10),p&&(x+=`/${Math.round(p)}`),this._hashName){const B=this._hashName;let L=!1;const j=window.location.hash.slice(1).split("&").map(_=>{const E=_.split("=")[0];return E===B?(L=!0,`${E}=${x}`):_}).filter(_=>_);return L||j.push(`${B}=${x}`),`#${j.join("&")}`}return`#${x}`}}const ps={linearity:.3,easing:s.ba(0,0,.3,1)},Fo=s.e({deceleration:2500,maxSpeed:1400},ps),vo=s.e({deceleration:20,maxSpeed:1400},ps),_a=s.e({deceleration:1e3,maxSpeed:360},ps),sl=s.e({deceleration:1e3,maxSpeed:90},ps);class Do{constructor(A){this._map=A,this.clear()}clear(){this._inertiaBuffer=[]}record(A){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.h.now(),settings:A})}_drainInertiaBuffer(){const A=this._inertiaBuffer,b=s.h.now();for(;A.length>0&&b-A[0].time>160;)A.shift()}_onMoveEnd(A){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const b={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:z}of this._inertiaBuffer)b.zoom+=z.zoomDelta||0,b.bearing+=z.bearingDelta||0,b.pitch+=z.pitchDelta||0,z.panDelta&&b.pan._add(z.panDelta),z.around&&(b.around=z.around),z.pinchAround&&(b.pinchAround=z.pinchAround);const M=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,O={};if(b.pan.mag()){const z=$s(b.pan.mag(),M,s.e({},Fo,A||{}));O.offset=b.pan.mult(z.amount/b.pan.mag()),O.center=this._map.transform.center,to(O,z)}if(b.zoom){const z=$s(b.zoom,M,vo);O.zoom=this._map.transform.zoom+z.amount,to(O,z)}if(b.bearing){const z=$s(b.bearing,M,_a);O.bearing=this._map.transform.bearing+s.ad(z.amount,-179,179),to(O,z)}if(b.pitch){const z=$s(b.pitch,M,sl);O.pitch=this._map.transform.pitch+z.amount,to(O,z)}if(O.zoom||O.bearing){const z=b.pinchAround===void 0?b.around:b.pinchAround;O.around=z?this._map.unproject(z):this._map.getCenter()}return this.clear(),s.e(O,{noMoveStart:!0})}}function to(N,A){(!N.duration||N.duration<A.duration)&&(N.duration=A.duration,N.easing=A.easing)}function $s(N,A,b){const{maxSpeed:M,linearity:O,deceleration:z}=b,J=s.ad(N*O/(A/1e3),-M,M),w=Math.abs(J)/(z*O);return{easing:b.easing,duration:1e3*w,amount:J*(w/2)}}class bs extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,b,M){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const z=y.mousePos(b.getCanvasContainer(),M),J=b.unproject(z);super(A,s.e({point:z,lngLat:J,originalEvent:M},O)),this._defaultPrevented=!1,this.target=b}}class Ao extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,b,M){const O=A==="touchend"?M.changedTouches:M.touches,z=y.touchPos(b.getCanvasContainer(),O),J=z.map(l=>b.unproject(l)),w=z.reduce((l,p,x,B)=>l.add(p.div(B.length)),new s.P(0,0));super(A,{points:z,point:w,lngLats:J,lngLat:b.unproject(w),originalEvent:M}),this._defaultPrevented=!1}}class Ra extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(A,b,M){super(A,{originalEvent:M}),this._defaultPrevented=!1}}class ml{constructor(A,b){this._map=A,this._clickTolerance=b.clickTolerance}reset(){delete this._mousedownPos}wheel(A){return this._firePreventable(new Ra(A.type,this._map,A))}mousedown(A,b){return this._mousedownPos=b,this._firePreventable(new bs(A.type,this._map,A))}mouseup(A){this._map.fire(new bs(A.type,this._map,A))}click(A,b){this._mousedownPos&&this._mousedownPos.dist(b)>=this._clickTolerance||this._map.fire(new bs(A.type,this._map,A))}dblclick(A){return this._firePreventable(new bs(A.type,this._map,A))}mouseover(A){this._map.fire(new bs(A.type,this._map,A))}mouseout(A){this._map.fire(new bs(A.type,this._map,A))}touchstart(A){return this._firePreventable(new Ao(A.type,this._map,A))}touchmove(A){this._map.fire(new Ao(A.type,this._map,A))}touchend(A){this._map.fire(new Ao(A.type,this._map,A))}touchcancel(A){this._map.fire(new Ao(A.type,this._map,A))}_firePreventable(A){if(this._map.fire(A),A.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yl{constructor(A){this._map=A}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(A){this._map.fire(new bs(A.type,this._map,A))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new bs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(A){this._delayContextMenu?this._contextMenuEvent=A:this._ignoreContextMenu||this._map.fire(new bs(A.type,this._map,A)),this._map.listens("contextmenu")&&A.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ks{constructor(A){this._map=A}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(A){return this.transform.pointLocation(s.P.convert(A),this._map.terrain)}}class ea{constructor(A,b){this._map=A,this._tr=new ks(A),this._el=A.getCanvasContainer(),this._container=A.getContainer(),this._clickTolerance=b.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(A,b){this.isEnabled()&&A.shiftKey&&A.button===0&&(y.disableDrag(),this._startPos=this._lastPos=b,this._active=!0)}mousemoveWindow(A,b){if(!this._active)return;const M=b;if(this._lastPos.equals(M)||!this._box&&M.dist(this._startPos)<this._clickTolerance)return;const O=this._startPos;this._lastPos=M,this._box||(this._box=y.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",A));const z=Math.min(O.x,M.x),J=Math.max(O.x,M.x),w=Math.min(O.y,M.y),l=Math.max(O.y,M.y);y.setTransform(this._box,`translate(${z}px,${w}px)`),this._box.style.width=J-z+"px",this._box.style.height=l-w+"px"}mouseupWindow(A,b){if(!this._active||A.button!==0)return;const M=this._startPos,O=b;if(this.reset(),y.suppressClick(),M.x!==O.x||M.y!==O.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:A})),{cameraAnimation:z=>z.fitScreenCoordinates(M,O,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",A)}keydown(A){this._active&&A.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",A))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(y.remove(this._box),this._box=null),y.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(A,b){return this._map.fire(new s.k(A,{originalEvent:b}))}}function ln(N,A){if(N.length!==A.length)throw new Error(`The number of touches and points are not equal - touches ${N.length}, points ${A.length}`);const b={};for(let M=0;M<N.length;M++)b[N[M].identifier]=A[M];return b}class Kn{constructor(A){this.reset(),this.numTouches=A.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(A,b,M){(this.centroid||M.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=A.timeStamp),M.length===this.numTouches&&(this.centroid=function(O){const z=new s.P(0,0);for(const J of O)z._add(J);return z.div(O.length)}(b),this.touches=ln(M,b)))}touchmove(A,b,M){if(this.aborted||!this.centroid)return;const O=ln(M,b);for(const z in this.touches){const J=O[z];(!J||J.dist(this.touches[z])>30)&&(this.aborted=!0)}}touchend(A,b,M){if((!this.centroid||A.timeStamp-this.startTime>500)&&(this.aborted=!0),M.length===0){const O=!this.aborted&&this.centroid;if(this.reset(),O)return O}}}class ls{constructor(A){this.singleTap=new Kn(A),this.numTaps=A.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(A,b,M){this.singleTap.touchstart(A,b,M)}touchmove(A,b,M){this.singleTap.touchmove(A,b,M)}touchend(A,b,M){const O=this.singleTap.touchend(A,b,M);if(O){const z=A.timeStamp-this.lastTime<500,J=!this.lastTap||this.lastTap.dist(O)<30;if(z&&J||this.reset(),this.count++,this.lastTime=A.timeStamp,this.lastTap=O,this.count===this.numTaps)return this.reset(),O}}}class Ni{constructor(A){this._tr=new ks(A),this._zoomIn=new ls({numTouches:1,numTaps:2}),this._zoomOut=new ls({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(A,b,M){this._zoomIn.touchstart(A,b,M),this._zoomOut.touchstart(A,b,M)}touchmove(A,b,M){this._zoomIn.touchmove(A,b,M),this._zoomOut.touchmove(A,b,M)}touchend(A,b,M){const O=this._zoomIn.touchend(A,b,M),z=this._zoomOut.touchend(A,b,M),J=this._tr;return O?(this._active=!0,A.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:J.zoom+1,around:J.unproject(O)},{originalEvent:A})}):z?(this._active=!0,A.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:J.zoom-1,around:J.unproject(z)},{originalEvent:A})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tn{constructor(A){this._enabled=!!A.enable,this._moveStateManager=A.moveStateManager,this._clickTolerance=A.clickTolerance||1,this._moveFunction=A.move,this._activateOnStart=!!A.activateOnStart,A.assignEvents(this),this.reset()}reset(A){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(A)}_move(){const A=this._moveFunction(...arguments);if(A.bearingDelta||A.pitchDelta||A.around||A.panDelta)return this._active=!0,A}dragStart(A,b){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(A)&&(this._moveStateManager.startMove(A),this._lastPoint=b.length?b[0]:b,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(A,b){if(!this.isEnabled())return;const M=this._lastPoint;if(!M)return;if(A.preventDefault(),!this._moveStateManager.isValidMoveEvent(A))return void this.reset(A);const O=b.length?b[0]:b;return!this._moved&&O.dist(M)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=O,this._move(M,O))}dragEnd(A){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(A)&&(this._moved&&y.suppressClick(),this.reset(A))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const nn={0:1,2:2};class zn{constructor(A){this._correctEvent=A.checkCorrectEvent}startMove(A){const b=y.mouseButton(A);this._eventButton=b}endMove(A){delete this._eventButton}isValidStartEvent(A){return this._correctEvent(A)}isValidMoveEvent(A){return!function(b,M){const O=nn[M];return b.buttons===void 0||(b.buttons&O)!==O}(A,this._eventButton)}isValidEndEvent(A){return y.mouseButton(A)===this._eventButton}}class va{constructor(){this._firstTouch=void 0}_isOneFingerTouch(A){return A.targetTouches.length===1}_isSameTouchEvent(A){return A.targetTouches[0].identifier===this._firstTouch}startMove(A){this._firstTouch=A.targetTouches[0].identifier}endMove(A){delete this._firstTouch}isValidStartEvent(A){return this._isOneFingerTouch(A)}isValidMoveEvent(A){return this._isOneFingerTouch(A)&&this._isSameTouchEvent(A)}isValidEndEvent(A){return this._isOneFingerTouch(A)&&this._isSameTouchEvent(A)}}const ka=N=>{N.mousedown=N.dragStart,N.mousemoveWindow=N.dragMove,N.mouseup=N.dragEnd,N.contextmenu=function(A){A.preventDefault()}},ta=N=>{let{enable:A,clickTolerance:b,bearingDegreesPerPixelMoved:M=.8}=N;const O=new zn({checkCorrectEvent:z=>y.mouseButton(z)===0&&z.ctrlKey||y.mouseButton(z)===2});return new tn({clickTolerance:b,move:(z,J)=>({bearingDelta:(J.x-z.x)*M}),moveStateManager:O,enable:A,assignEvents:ka})},ra=N=>{let{enable:A,clickTolerance:b,pitchDegreesPerPixelMoved:M=-.5}=N;const O=new zn({checkCorrectEvent:z=>y.mouseButton(z)===0&&z.ctrlKey||y.mouseButton(z)===2});return new tn({clickTolerance:b,move:(z,J)=>({pitchDelta:(J.y-z.y)*M}),moveStateManager:O,enable:A,assignEvents:ka})};class Nr{constructor(A,b){this._minTouches=A.cooperativeGestures?2:1,this._clickTolerance=A.clickTolerance||1,this._map=b,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(A,b,M){return this._calculateTransform(A,b,M)}touchmove(A,b,M){if(this._map._cooperativeGestures&&(this._minTouches===2&&M.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(A,!1,M.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(M.length<this._minTouches))return A.preventDefault(),this._calculateTransform(A,b,M)}touchend(A,b,M){this._calculateTransform(A,b,M),this._active&&M.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(A,b,M){M.length>0&&(this._active=!0);const O=ln(M,b),z=new s.P(0,0),J=new s.P(0,0);let w=0;for(const p in O){const x=O[p],B=this._touches[p];B&&(z._add(x),J._add(x.sub(B)),w++,O[p]=x)}if(this._touches=O,w<this._minTouches||!J.mag())return;const l=J.div(w);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:z.div(w),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ba{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(A,b,M){this._firstTwoTouches||M.length<2||(this._firstTwoTouches=[M[0].identifier,M[1].identifier],this._start([b[0],b[1]]))}touchmove(A,b,M){if(!this._firstTwoTouches)return;A.preventDefault();const[O,z]=this._firstTwoTouches,J=Rr(M,b,O),w=Rr(M,b,z);if(!J||!w)return;const l=this._aroundCenter?null:J.add(w).div(2);return this._move([J,w],l,A)}touchend(A,b,M){if(!this._firstTwoTouches)return;const[O,z]=this._firstTwoTouches,J=Rr(M,b,O),w=Rr(M,b,z);J&&w||(this._active&&y.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(A){this._enabled=!0,this._aroundCenter=!!A&&A.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Rr(N,A,b){for(let M=0;M<N.length;M++)if(N[M].identifier===b)return A[M]}function yl(N,A){return Math.log(N/A)/Math.LN2}class _l extends ba{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(A){this._startDistance=this._distance=A[0].dist(A[1])}_move(A,b){const M=this._distance;if(this._distance=A[0].dist(A[1]),this._active||!(Math.abs(yl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yl(this._distance,M),pinchAround:b}}}function Mr(N,A){return 180*N.angleWith(A)/Math.PI}class Cc extends ba{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(A){this._startVector=this._vector=A[0].sub(A[1]),this._minDiameter=A[0].dist(A[1])}_move(A,b){const M=this._vector;if(this._vector=A[0].sub(A[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Mr(this._vector,M),pinchAround:b}}_isBelowThreshold(A){this._minDiameter=Math.min(this._minDiameter,A.mag());const b=25/(Math.PI*this._minDiameter)*360,M=Mr(A,this._startVector);return Math.abs(M)<b}}function Dr(N){return Math.abs(N.y)>Math.abs(N.x)}class ro extends ba{constructor(A){super(),this._map=A}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(A,b,M){super.touchstart(A,b,M),this._currentTouchCount=M.length}_start(A){this._lastPoints=A,Dr(A[0].sub(A[1]))&&(this._valid=!1)}_move(A,b,M){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const O=A[0].sub(this._lastPoints[0]),z=A[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(O,z,M.timeStamp),this._valid?(this._lastPoints=A,this._active=!0,{pitchDelta:(O.y+z.y)/2*-.5}):void 0}gestureBeginsVertically(A,b,M){if(this._valid!==void 0)return this._valid;const O=A.mag()>=2,z=b.mag()>=2;if(!O&&!z)return;if(!O||!z)return this._firstMove===void 0&&(this._firstMove=M),M-this._firstMove<100&&void 0;const J=A.y>0==b.y>0;return Dr(A)&&Dr(b)&&J}}const io={panStep:100,bearingStep:15,pitchStep:10};class Gc{constructor(A){this._tr=new ks(A);const b=io;this._panStep=b.panStep,this._bearingStep=b.bearingStep,this._pitchStep=b.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(A){if(A.altKey||A.ctrlKey||A.metaKey)return;let b=0,M=0,O=0,z=0,J=0;switch(A.keyCode){case 61:case 107:case 171:case 187:b=1;break;case 189:case 109:case 173:b=-1;break;case 37:A.shiftKey?M=-1:(A.preventDefault(),z=-1);break;case 39:A.shiftKey?M=1:(A.preventDefault(),z=1);break;case 38:A.shiftKey?O=1:(A.preventDefault(),J=-1);break;case 40:A.shiftKey?O=-1:(A.preventDefault(),J=1);break;default:return}return this._rotationDisabled&&(M=0,O=0),{cameraAnimation:w=>{const l=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:ec,zoom:b?Math.round(l.zoom)+b*(A.shiftKey?2:1):l.zoom,bearing:l.bearing+M*this._bearingStep,pitch:l.pitch+O*this._pitchStep,offset:[-z*this._panStep,-J*this._panStep],center:l.center},{originalEvent:A})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ec(N){return N*(2-N)}const mu=4.000244140625;class jc{constructor(A,b){this._onTimeout=M=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(M)},this._map=A,this._tr=new ks(A),this._el=A.getCanvasContainer(),this._triggerRenderFrame=b,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(A){this._defaultZoomRate=A}setWheelZoomRate(A){this._wheelZoomRate=A}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(A){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!A&&A.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(A){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!A[this._map._metaKey])return;A.preventDefault()}let b=A.deltaMode===WheelEvent.DOM_DELTA_LINE?40*A.deltaY:A.deltaY;const M=s.h.now(),O=M-(this._lastWheelEventTime||0);this._lastWheelEventTime=M,b!==0&&b%mu==0?this._type="wheel":b!==0&&Math.abs(b)<4?this._type="trackpad":O>400?(this._type=null,this._lastValue=b,this._timeout=setTimeout(this._onTimeout,40,A)):this._type||(this._type=Math.abs(O*b)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,b+=this._lastValue)),A.shiftKey&&b&&(b/=4),this._type&&(this._lastWheelEvent=A,this._delta-=b,this._active||this._start(A)),A.preventDefault()}_start(A){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const b=y.mousePos(this._el,A),M=this._tr;this._around=s.L.convert(this._aroundCenter?M.center:M.unproject(b)),this._aroundPoint=M.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const A=this._tr.transform;if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>mu?this._wheelZoomRate:this._defaultZoomRate;let l=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&l!==0&&(l=1/l);const p=typeof this._targetZoom=="number"?A.zoomScale(this._targetZoom):A.scale;this._targetZoom=Math.min(A.maxZoom,Math.max(A.minZoom,A.scaleZoom(p*l))),this._type==="wheel"&&(this._startZoom=A.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const b=typeof this._targetZoom=="number"?this._targetZoom:A.zoom,M=this._startZoom,O=this._easing;let z,J=!1;if(this._type==="wheel"&&M&&O){const w=Math.min((s.h.now()-this._lastWheelEventTime)/200,1),l=O(w);z=s.B.number(M,b,l),w<1?this._frameId||(this._frameId=!0):J=!0}else z=b,J=!0;return this._active=!0,J&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!J,zoomDelta:z-A.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(A){let b=s.bb;if(this._prevEase){const M=this._prevEase,O=(s.h.now()-M.start)/M.duration,z=M.easing(O+.01)-M.easing(O),J=.27/Math.sqrt(z*z+1e-4)*.01,w=Math.sqrt(.0729-J*J);b=s.ba(J,w,.25,1)}return this._prevEase={start:s.h.now(),duration:A,easing:b},b}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class tc{constructor(A,b){this._clickZoom=A,this._tapZoom=b}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qc{constructor(A){this._tr=new ks(A),this.reset()}reset(){this._active=!1}dblclick(A,b){return A.preventDefault(),{cameraAnimation:M=>{M.easeTo({duration:300,zoom:this._tr.zoom+(A.shiftKey?-1:1),around:this._tr.unproject(b)},{originalEvent:A})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ol{constructor(){this._tap=new ls({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(A,b,M){if(!this._swipePoint)if(this._tapTime){const O=b[0],z=A.timeStamp-this._tapTime<500,J=this._tapPoint.dist(O)<30;z&&J?M.length>0&&(this._swipePoint=O,this._swipeTouch=M[0].identifier):this.reset()}else this._tap.touchstart(A,b,M)}touchmove(A,b,M){if(this._tapTime){if(this._swipePoint){if(M[0].identifier!==this._swipeTouch)return;const O=b[0],z=O.y-this._swipePoint.y;return this._swipePoint=O,A.preventDefault(),this._active=!0,{zoomDelta:z/128}}}else this._tap.touchmove(A,b,M)}touchend(A,b,M){if(this._tapTime)this._swipePoint&&M.length===0&&this.reset();else{const O=this._tap.touchend(A,b,M);O&&(this._tapTime=A.timeStamp,this._tapPoint=O)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vn{constructor(A,b,M){this._el=A,this._mousePan=b,this._touchPan=M}enable(A){this._inertiaOptions=A||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Os{constructor(A,b,M){this._pitchWithRotate=A.pitchWithRotate,this._mouseRotate=b,this._mousePitch=M}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ro{constructor(A,b,M,O){this._el=A,this._touchZoom=b,this._touchRotate=M,this._tapDragZoom=O,this._rotationDisabled=!1,this._enabled=!0}enable(A){this._touchZoom.enable(A),this._rotationDisabled||this._touchRotate.enable(A),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const vl=N=>N.zoom||N.drag||N.pitch||N.rotate;class yu extends s.k{}function $c(N){return N.panDelta&&N.panDelta.mag()||N.zoomDelta||N.bearingDelta||N.pitchDelta}class Gu{constructor(A,b){this.handleWindowEvent=O=>{this.handleEvent(O,`${O.type}Window`)},this.handleEvent=(O,z)=>{if(O.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const J=O.type==="renderFrame"?void 0:O,w={needsRenderFrame:!1},l={},p={},x=O.touches,B=x?this._getMapTouches(x):void 0,L=B?y.touchPos(this._el,B):y.mousePos(this._el,O);for(const{handlerName:E,handler:F,allowed:V}of this._handlers){if(!F.isEnabled())continue;let q;this._blockedByActive(p,V,E)?F.reset():F[z||O.type]&&(q=F[z||O.type](O,L,B),this.mergeHandlerResult(w,l,q,E,J),q&&q.needsRenderFrame&&this._triggerRenderFrame()),(q||F.isActive())&&(p[E]=F)}const j={};for(const E in this._previousActiveHandlers)p[E]||(j[E]=J);this._previousActiveHandlers=p,(Object.keys(j).length||$c(w))&&(this._changes.push([w,l,j]),this._triggerRenderFrame()),(Object.keys(p).length||$c(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:_}=w;_&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],_(this._map))},this._map=A,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Do(A),this._bearingSnap=b.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(b);const M=this._el;this._listeners=[[M,"touchstart",{passive:!0}],[M,"touchmove",{passive:!1}],[M,"touchend",void 0],[M,"touchcancel",void 0],[M,"mousedown",void 0],[M,"mousemove",void 0],[M,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[M,"mouseover",void 0],[M,"mouseout",void 0],[M,"dblclick",void 0],[M,"click",void 0],[M,"keydown",{capture:!1}],[M,"keyup",void 0],[M,"wheel",{passive:!1}],[M,"contextmenu",void 0],[window,"blur",void 0]];for(const[O,z,J]of this._listeners)y.addEventListener(O,z,O===document?this.handleWindowEvent:this.handleEvent,J)}destroy(){for(const[A,b,M]of this._listeners)y.removeEventListener(A,b,A===document?this.handleWindowEvent:this.handleEvent,M)}_addDefaultHandlers(A){const b=this._map,M=b.getCanvasContainer();this._add("mapEvent",new ml(b,A));const O=b.boxZoom=new ea(b,A);this._add("boxZoom",O),A.interactive&&A.boxZoom&&O.enable();const z=new Ni(b),J=new qc(b);b.doubleClickZoom=new tc(J,z),this._add("tapZoom",z),this._add("clickZoom",J),A.interactive&&A.doubleClickZoom&&b.doubleClickZoom.enable();const w=new ol;this._add("tapDragZoom",w);const l=b.touchPitch=new ro(b);this._add("touchPitch",l),A.interactive&&A.touchPitch&&b.touchPitch.enable(A.touchPitch);const p=ta(A),x=ra(A);b.dragRotate=new Os(A,p,x),this._add("mouseRotate",p,["mousePitch"]),this._add("mousePitch",x,["mouseRotate"]),A.interactive&&A.dragRotate&&b.dragRotate.enable();const B=(V=>{let{enable:q,clickTolerance:K}=V;const te=new zn({checkCorrectEvent:se=>y.mouseButton(se)===0&&!se.ctrlKey});return new tn({clickTolerance:K,move:(se,oe)=>({around:oe,panDelta:oe.sub(se)}),activateOnStart:!0,moveStateManager:te,enable:q,assignEvents:ka})})(A),L=new Nr(A,b);b.dragPan=new vn(M,B,L),this._add("mousePan",B),this._add("touchPan",L,["touchZoom","touchRotate"]),A.interactive&&A.dragPan&&b.dragPan.enable(A.dragPan);const j=new Cc,_=new _l;b.touchZoomRotate=new Ro(M,_,j,w),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",_,["touchPan","touchRotate"]),A.interactive&&A.touchZoomRotate&&b.touchZoomRotate.enable(A.touchZoomRotate);const E=b.scrollZoom=new jc(b,()=>this._triggerRenderFrame());this._add("scrollZoom",E,["mousePan"]),A.interactive&&A.scrollZoom&&b.scrollZoom.enable(A.scrollZoom);const F=b.keyboard=new Gc(b);this._add("keyboard",F),A.interactive&&A.keyboard&&b.keyboard.enable(),this._add("blockableMapEvent",new Yl(b))}_add(A,b,M){this._handlers.push({handlerName:A,handler:b,allowed:M}),this._handlersById[A]=b}stop(A){if(!this._updatingCamera){for(const{handler:b}of this._handlers)b.reset();this._inertia.clear(),this._fireEvents({},{},A),this._changes=[]}}isActive(){for(const{handler:A}of this._handlers)if(A.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vl(this._eventsInProgress)||this.isZooming()}_blockedByActive(A,b,M){for(const O in A)if(O!==M&&(!b||b.indexOf(O)<0))return!0;return!1}_getMapTouches(A){const b=[];for(const M of A)this._el.contains(M.target)&&b.push(M);return b}mergeHandlerResult(A,b,M,O,z){if(!M)return;s.e(A,M);const J={handlerName:O,originalEvent:M.originalEvent||z};M.zoomDelta!==void 0&&(b.zoom=J),M.panDelta!==void 0&&(b.drag=J),M.pitchDelta!==void 0&&(b.pitch=J),M.bearingDelta!==void 0&&(b.rotate=J)}_applyChanges(){const A={},b={},M={};for(const[O,z,J]of this._changes)O.panDelta&&(A.panDelta=(A.panDelta||new s.P(0,0))._add(O.panDelta)),O.zoomDelta&&(A.zoomDelta=(A.zoomDelta||0)+O.zoomDelta),O.bearingDelta&&(A.bearingDelta=(A.bearingDelta||0)+O.bearingDelta),O.pitchDelta&&(A.pitchDelta=(A.pitchDelta||0)+O.pitchDelta),O.around!==void 0&&(A.around=O.around),O.pinchAround!==void 0&&(A.pinchAround=O.pinchAround),O.noInertia&&(A.noInertia=O.noInertia),s.e(b,z),s.e(M,J);this._updateMapTransform(A,b,M),this._changes=[]}_updateMapTransform(A,b,M){const O=this._map,z=O._getTransformForUpdate(),J=O.terrain;if(!($c(A)||J&&this._terrainMovement))return this._fireEvents(b,M,!0);let{panDelta:w,zoomDelta:l,bearingDelta:p,pitchDelta:x,around:B,pinchAround:L}=A;L!==void 0&&(B=L),O._stop(!0),B=B||O.transform.centerPoint;const j=z.pointLocation(w?B.sub(w):B);p&&(z.bearing+=p),x&&(z.pitch+=x),l&&(z.zoom+=l),J?this._terrainMovement||!b.drag&&!b.zoom?b.drag&&this._terrainMovement?z.center=z.pointLocation(z.centerPoint.sub(w)):z.setLocationAtPoint(j,B):(this._terrainMovement=!0,this._map._elevationFreeze=!0,z.setLocationAtPoint(j,B),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,z.recalculateZoom(O.terrain)})):z.setLocationAtPoint(j,B),O._applyUpdatedTransform(z),this._map._update(),A.noInertia||this._inertia.record(A),this._fireEvents(b,M,!0)}_fireEvents(A,b,M){const O=vl(this._eventsInProgress),z=vl(A),J={};for(const x in A){const{originalEvent:B}=A[x];this._eventsInProgress[x]||(J[`${x}start`]=B),this._eventsInProgress[x]=A[x]}!O&&z&&this._fireEvent("movestart",z.originalEvent);for(const x in J)this._fireEvent(x,J[x]);z&&this._fireEvent("move",z.originalEvent);for(const x in A){const{originalEvent:B}=A[x];this._fireEvent(x,B)}const w={};let l;for(const x in this._eventsInProgress){const{handlerName:B,originalEvent:L}=this._eventsInProgress[x];this._handlersById[B].isActive()||(delete this._eventsInProgress[x],l=b[B]||L,w[`${x}end`]=l)}for(const x in w)this._fireEvent(x,w[x]);const p=vl(this._eventsInProgress);if(M&&(O||z)&&!p){this._updatingCamera=!0;const x=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=L=>L!==0&&-this._bearingSnap<L&&L<this._bearingSnap;!x||!x.essential&&s.h.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:l})),B(this._map.getBearing())&&this._map.resetNorth()):(B(x.bearing||this._map.getBearing())&&(x.bearing=0),x.freezeElevation=!0,this._map.easeTo(x,{originalEvent:l})),this._updatingCamera=!1}}_fireEvent(A,b){this._map.fire(new s.k(A,b?{originalEvent:b}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(A=>{delete this._frameId,this.handleEvent(new yu("renderFrame",{timeStamp:A})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class xa extends s.E{constructor(A,b){super(),this._renderFrameCallback=()=>{const M=Math.min((s.h.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(M)),M<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=A,this._bearingSnap=b.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(A,b){return this.jumpTo({center:A},b)}panBy(A,b,M){return A=s.P.convert(A).mult(-1),this.panTo(this.transform.center,s.e({offset:A},b),M)}panTo(A,b,M){return this.easeTo(s.e({center:A},b),M)}getZoom(){return this.transform.zoom}setZoom(A,b){return this.jumpTo({zoom:A},b),this}zoomTo(A,b,M){return this.easeTo(s.e({zoom:A},b),M)}zoomIn(A,b){return this.zoomTo(this.getZoom()+1,A,b),this}zoomOut(A,b){return this.zoomTo(this.getZoom()-1,A,b),this}getBearing(){return this.transform.bearing}setBearing(A,b){return this.jumpTo({bearing:A},b),this}getPadding(){return this.transform.padding}setPadding(A,b){return this.jumpTo({padding:A},b),this}rotateTo(A,b,M){return this.easeTo(s.e({bearing:A},b),M)}resetNorth(A,b){return this.rotateTo(0,s.e({duration:1e3},A),b),this}resetNorthPitch(A,b){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},A),b),this}snapToNorth(A,b){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(A,b):this}getPitch(){return this.transform.pitch}setPitch(A,b){return this.jumpTo({pitch:A},b),this}cameraForBounds(A,b){A=Ze.convert(A);const M=b&&b.bearing||0;return this._cameraForBoxAndBearing(A.getNorthWest(),A.getSouthEast(),M,b)}_cameraForBoxAndBearing(A,b,M,O){const z={top:0,bottom:0,right:0,left:0};if(typeof(O=s.e({padding:z,offset:[0,0],maxZoom:this.transform.maxZoom},O)).padding=="number"){const se=O.padding;O.padding={top:se,bottom:se,right:se,left:se}}O.padding=s.e(z,O.padding);const J=this.transform,w=J.padding,l=J.project(s.L.convert(A)),p=J.project(s.L.convert(b)),x=l.rotate(-M*Math.PI/180),B=p.rotate(-M*Math.PI/180),L=new s.P(Math.max(x.x,B.x),Math.max(x.y,B.y)),j=new s.P(Math.min(x.x,B.x),Math.min(x.y,B.y)),_=L.sub(j),E=(J.width-(w.left+w.right+O.padding.left+O.padding.right))/_.x,F=(J.height-(w.top+w.bottom+O.padding.top+O.padding.bottom))/_.y;if(F<0||E<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const V=Math.min(J.scaleZoom(J.scale*Math.min(E,F)),O.maxZoom),q=s.P.convert(O.offset),K=new s.P((O.padding.left-O.padding.right)/2,(O.padding.top-O.padding.bottom)/2).rotate(M*Math.PI/180),te=q.add(K).mult(J.scale/J.zoomScale(V));return{center:J.unproject(l.add(p).div(2).sub(te)),zoom:V,bearing:M}}fitBounds(A,b,M){return this._fitInternal(this.cameraForBounds(A,b),b,M)}fitScreenCoordinates(A,b,M,O,z){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(A)),this.transform.pointLocation(s.P.convert(b)),M,O),O,z)}_fitInternal(A,b,M){return A?(delete(b=s.e(A,b)).padding,b.linear?this.easeTo(b,M):this.flyTo(b,M)):this}jumpTo(A,b){this.stop();const M=this._getTransformForUpdate();let O=!1,z=!1,J=!1;return"zoom"in A&&M.zoom!==+A.zoom&&(O=!0,M.zoom=+A.zoom),A.center!==void 0&&(M.center=s.L.convert(A.center)),"bearing"in A&&M.bearing!==+A.bearing&&(z=!0,M.bearing=+A.bearing),"pitch"in A&&M.pitch!==+A.pitch&&(J=!0,M.pitch=+A.pitch),A.padding==null||M.isPaddingEqual(A.padding)||(M.padding=A.padding),this._applyUpdatedTransform(M),this.fire(new s.k("movestart",b)).fire(new s.k("move",b)),O&&this.fire(new s.k("zoomstart",b)).fire(new s.k("zoom",b)).fire(new s.k("zoomend",b)),z&&this.fire(new s.k("rotatestart",b)).fire(new s.k("rotate",b)).fire(new s.k("rotateend",b)),J&&this.fire(new s.k("pitchstart",b)).fire(new s.k("pitch",b)).fire(new s.k("pitchend",b)),this.fire(new s.k("moveend",b))}calculateCameraOptionsFromTo(A,b,M){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const z=s.U.fromLngLat(A,b),J=s.U.fromLngLat(M,O),w=J.x-z.x,l=J.y-z.y,p=J.z-z.z,x=Math.hypot(w,l,p);if(x===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(w,l),L=this.transform.scaleZoom(this.transform.cameraToCenterDistance/x/this.transform.tileSize),j=180*Math.atan2(w,-l)/Math.PI;let _=180*Math.acos(B/x)/Math.PI;return _=p<0?90-_:90+_,{center:J.toLngLat(),zoom:L,pitch:_,bearing:j}}easeTo(A,b){this._stop(!1,A.easeId),((A=s.e({offset:[0,0],duration:500,easing:s.bb},A)).animate===!1||!A.essential&&s.h.prefersReducedMotion)&&(A.duration=0);const M=this._getTransformForUpdate(),O=this.getZoom(),z=this.getBearing(),J=this.getPitch(),w=this.getPadding(),l="zoom"in A?+A.zoom:O,p="bearing"in A?this._normalizeBearing(A.bearing,z):z,x="pitch"in A?+A.pitch:J,B="padding"in A?A.padding:M.padding,L=s.P.convert(A.offset);let j=M.centerPoint.add(L);const _=M.pointLocation(j),E=s.L.convert(A.center||_);this._normalizeCenter(E);const F=M.project(_),V=M.project(E).sub(F),q=M.zoomScale(l-O);let K,te;A.around&&(K=s.L.convert(A.around),te=M.locationPoint(K));const se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||l!==O,this._rotating=this._rotating||z!==p,this._pitching=this._pitching||x!==J,this._padding=!M.isPaddingEqual(B),this._easeId=A.easeId,this._prepareEase(b,A.noMoveStart,se),this.terrain&&this._prepareElevation(E),this._ease(oe=>{if(this._zooming&&(M.zoom=s.B.number(O,l,oe)),this._rotating&&(M.bearing=s.B.number(z,p,oe)),this._pitching&&(M.pitch=s.B.number(J,x,oe)),this._padding&&(M.interpolatePadding(w,B,oe),j=M.centerPoint.add(L)),this.terrain&&!A.freezeElevation&&this._updateElevation(oe),K)M.setLocationAtPoint(K,te);else{const le=M.zoomScale(M.zoom-O),_e=l>O?Math.min(2,q):Math.max(.5,q),Ie=Math.pow(_e,1-oe),ve=M.unproject(F.add(V.mult(oe*Ie)).mult(le));M.setLocationAtPoint(M.renderWorldCopies?ve.wrap():ve,j)}this._applyUpdatedTransform(M),this._fireMoveEvents(b)},oe=>{this.terrain&&this._finalizeElevation(),this._afterEase(b,oe)},A),this}_prepareEase(A,b){let M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this._moving=!0,b||M.moving||this.fire(new s.k("movestart",A)),this._zooming&&!M.zooming&&this.fire(new s.k("zoomstart",A)),this._rotating&&!M.rotating&&this.fire(new s.k("rotatestart",A)),this._pitching&&!M.pitching&&this.fire(new s.k("pitchstart",A))}_prepareElevation(A){this._elevationCenter=A,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(A,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(A){this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const b=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(A<1&&b!==this._elevationTarget){const M=this._elevationTarget-this._elevationStart;this._elevationStart+=A*(M-(b-(M*A+this._elevationStart))/(1-A)),this._elevationTarget=b}this.transform.elevation=s.B.number(this._elevationStart,this._elevationTarget,A)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(A){if(!this.transformCameraUpdate)return;const b=A.clone(),{center:M,zoom:O,pitch:z,bearing:J,elevation:w}=this.transformCameraUpdate(b);M&&(b.center=M),O!==void 0&&(b.zoom=O),z!==void 0&&(b.pitch=z),J!==void 0&&(b.bearing=J),w!==void 0&&(b.elevation=w),this.transform.apply(b)}_fireMoveEvents(A){this.fire(new s.k("move",A)),this._zooming&&this.fire(new s.k("zoom",A)),this._rotating&&this.fire(new s.k("rotate",A)),this._pitching&&this.fire(new s.k("pitch",A))}_afterEase(A,b){if(this._easeId&&b&&this._easeId===b)return;delete this._easeId;const M=this._zooming,O=this._rotating,z=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,M&&this.fire(new s.k("zoomend",A)),O&&this.fire(new s.k("rotateend",A)),z&&this.fire(new s.k("pitchend",A)),this.fire(new s.k("moveend",A))}flyTo(A,b){if(!A.essential&&s.h.prefersReducedMotion){const Ve=s.F(A,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ve,b)}this.stop(),A=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.bb},A);const M=this._getTransformForUpdate(),O=this.getZoom(),z=this.getBearing(),J=this.getPitch(),w=this.getPadding(),l="zoom"in A?s.ad(+A.zoom,M.minZoom,M.maxZoom):O,p="bearing"in A?this._normalizeBearing(A.bearing,z):z,x="pitch"in A?+A.pitch:J,B="padding"in A?A.padding:M.padding,L=M.zoomScale(l-O),j=s.P.convert(A.offset);let _=M.centerPoint.add(j);const E=M.pointLocation(_),F=s.L.convert(A.center||E);this._normalizeCenter(F);const V=M.project(E),q=M.project(F).sub(V);let K=A.curve;const te=Math.max(M.width,M.height),se=te/L,oe=q.mag();if("minZoom"in A){const Ve=s.ad(Math.min(A.minZoom,O,l),M.minZoom,M.maxZoom),At=te/M.zoomScale(Ve-O);K=Math.sqrt(At/oe*2)}const le=K*K;function _e(Ve){const At=(se*se-te*te+(Ve?-1:1)*le*le*oe*oe)/(2*(Ve?se:te)*le*oe);return Math.log(Math.sqrt(At*At+1)-At)}function Ie(Ve){return(Math.exp(Ve)-Math.exp(-Ve))/2}function ve(Ve){return(Math.exp(Ve)+Math.exp(-Ve))/2}const Se=_e(!1);let et=function(Ve){return ve(Se)/ve(Se+K*Ve)},Oe=function(Ve){return te*((ve(Se)*(Ie(At=Se+K*Ve)/ve(At))-Ie(Se))/le)/oe;var At},Re=(_e(!0)-Se)/K;if(Math.abs(oe)<1e-6||!isFinite(Re)){if(Math.abs(te-se)<1e-6)return this.easeTo(A,b);const Ve=se<te?-1:1;Re=Math.abs(Math.log(se/te))/K,Oe=function(){return 0},et=function(At){return Math.exp(Ve*K*At)}}return A.duration="duration"in A?+A.duration:1e3*Re/("screenSpeed"in A?+A.screenSpeed/K:+A.speed),A.maxDuration&&A.duration>A.maxDuration&&(A.duration=0),this._zooming=!0,this._rotating=z!==p,this._pitching=x!==J,this._padding=!M.isPaddingEqual(B),this._prepareEase(b,!1),this.terrain&&this._prepareElevation(F),this._ease(Ve=>{const At=Ve*Re,dt=1/et(At);M.zoom=Ve===1?l:O+M.scaleZoom(dt),this._rotating&&(M.bearing=s.B.number(z,p,Ve)),this._pitching&&(M.pitch=s.B.number(J,x,Ve)),this._padding&&(M.interpolatePadding(w,B,Ve),_=M.centerPoint.add(j)),this.terrain&&!A.freezeElevation&&this._updateElevation(Ve);const ft=Ve===1?F:M.unproject(V.add(q.mult(Oe(At))).mult(dt));M.setLocationAtPoint(M.renderWorldCopies?ft.wrap():ft,_),this._applyUpdatedTransform(M),this._fireMoveEvents(b)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(b)},A),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(A,b){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const M=this._onEaseEnd;delete this._onEaseEnd,M.call(this,b)}if(!A){const M=this.handlers;M&&M.stop(!1)}return this}_ease(A,b,M){M.animate===!1||M.duration===0?(A(1),b()):(this._easeStart=s.h.now(),this._easeOptions=M,this._onEaseFrame=A,this._onEaseEnd=b,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(A,b){A=s.b5(A,-180,180);const M=Math.abs(A-b);return Math.abs(A-360-b)<M&&(A-=360),Math.abs(A+360-b)<M&&(A+=360),A}_normalizeCenter(A){const b=this.transform;if(!b.renderWorldCopies||b.lngRange)return;const M=A.lng-b.center.lng;A.lng+=M>180?-360:M<-180?360:0}queryTerrainElevation(A){return this.terrain?this.terrain.getElevationForLngLatZoom(s.L.convert(A),this.transform.tileZoom)-this.transform.elevation:null}}class no{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=b=>{!b||b.sourceDataType!=="metadata"&&b.sourceDataType!=="visibility"&&b.dataType!=="style"&&b.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=A}getDefaultPosition(){return"bottom-right"}onAdd(A){return this._map=A,this._compact=this.options&&this.options.compact,this._container=y.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=y.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=y.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){y.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(A,b){const M=this._map._getUIString(`AttributionControl.${b}`);A.title=M,A.setAttribute("aria-label",M)}_updateAttributions(){if(!this._map.style)return;let A=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?A=A.concat(this.options.customAttribution.map(O=>typeof O!="string"?"":O)):typeof this.options.customAttribution=="string"&&A.push(this.options.customAttribution)),this._map.style.stylesheet){const O=this._map.style.stylesheet;this.styleOwner=O.owner,this.styleId=O.id}const b=this._map.style.sourceCaches;for(const O in b){const z=b[O];if(z.used||z.usedForTerrain){const J=z.getSource();J.attribution&&A.indexOf(J.attribution)<0&&A.push(J.attribution)}}A=A.filter(O=>String(O).trim()),A.sort((O,z)=>O.length-z.length),A=A.filter((O,z)=>{for(let J=z+1;J<A.length;J++)if(A[J].indexOf(O)>=0)return!1;return!0});const M=A.join(" | ");M!==this._attribHTML&&(this._attribHTML=M,A.length?(this._innerContainer.innerHTML=M,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Sr{constructor(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._updateCompact=()=>{const b=this._container.children;if(b.length){const M=b[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&M.classList.add("maplibregl-compact"):M.classList.remove("maplibregl-compact")}},this.options=A}getDefaultPosition(){return"bottom-left"}onAdd(A){this._map=A,this._compact=this.options&&this.options.compact,this._container=y.create("div","maplibregl-ctrl");const b=y.create("a","maplibregl-ctrl-logo");return b.target="_blank",b.rel="noopener nofollow",b.href="https://maplibre.org/",b.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),b.setAttribute("rel","noopener nofollow"),this._container.appendChild(b),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){y.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class oi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(A){const b=++this._id;return this._queue.push({callback:A,id:b,cancelled:!1}),b}remove(A){const b=this._currentlyRunning,M=b?this._queue.concat(b):this._queue;for(const O of M)if(O.id===A)return void(O.cancelled=!0)}run(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const b=this._currentlyRunning=this._queue;this._queue=[];for(const M of b)if(!M.cancelled&&(M.callback(A),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const bl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Kc=s.Q([{name:"a_pos3d",type:"Int16",components:3}]);class rc extends s.E{constructor(A){super(),this.sourceCache=A,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,A.usedForTerrain=!0,A.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(A,b){this.sourceCache.update(A,b),this._renderableTilesKeys=[];const M={};for(const O of A.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:b}))M[O.key]=!0,this._renderableTilesKeys.push(O.key),this._tiles[O.key]||(O.posMatrix=new Float64Array(16),s.aS(O.posMatrix,0,s.N,0,s.N,0,1),this._tiles[O.key]=new Ur(O,this.tileSize));for(const O in this._tiles)M[O]||delete this._tiles[O]}freeRtt(A){for(const b in this._tiles){const M=this._tiles[b];(!A||M.tileID.equals(A)||M.tileID.isChildOf(A)||A.isChildOf(M.tileID))&&(M.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(A=>this.getTileByID(A))}getTileByID(A){return this._tiles[A]}getTerrainCoords(A){const b={};for(const M of this._renderableTilesKeys){const O=this._tiles[M].tileID;if(O.canonical.equals(A.canonical)){const z=A.clone();z.posMatrix=new Float64Array(16),s.aS(z.posMatrix,0,s.N,0,s.N,0,1),b[M]=z}else if(O.canonical.isChildOf(A.canonical)){const z=A.clone();z.posMatrix=new Float64Array(16);const J=O.canonical.z-A.canonical.z,w=O.canonical.x-(O.canonical.x>>J<<J),l=O.canonical.y-(O.canonical.y>>J<<J),p=s.N>>J;s.aS(z.posMatrix,0,p,0,p,0,1),s.$(z.posMatrix,z.posMatrix,[-w*p,-l*p,0]),b[M]=z}else if(A.canonical.isChildOf(O.canonical)){const z=A.clone();z.posMatrix=new Float64Array(16);const J=A.canonical.z-O.canonical.z,w=A.canonical.x-(A.canonical.x>>J<<J),l=A.canonical.y-(A.canonical.y>>J<<J),p=s.N>>J;s.aS(z.posMatrix,0,s.N,0,s.N,0,1),s.$(z.posMatrix,z.posMatrix,[w*p,l*p,0]),s.a0(z.posMatrix,z.posMatrix,[1/2**J,1/2**J,0]),b[M]=z}}return b}getSourceTile(A,b){const M=this.sourceCache._source;let O=A.overscaledZ-this.deltaZoom;if(O>M.maxzoom&&(O=M.maxzoom),O<M.minzoom)return null;this._sourceTileCache[A.key]||(this._sourceTileCache[A.key]=A.scaledTo(O).key);let z=this.sourceCache.getTileByID(this._sourceTileCache[A.key]);if((!z||!z.dem)&&b)for(;O>=M.minzoom&&(!z||!z.dem);)z=this.sourceCache.getTileByID(A.scaledTo(O--).key);return z}tilesAfterTime(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();return Object.values(this._tiles).filter(b=>b.timeAdded>=A)}}class Us{constructor(A,b,M){this.painter=A,this.sourceCache=new rc(b),this.options=M,this.exaggeration=typeof M.exaggeration=="number"?M.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(A,b,M){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.N;var z;if(!(b>=0&&b<O&&M>=0&&M<O))return 0;const J=this.getTerrainData(A),w=(z=J.tile)===null||z===void 0?void 0:z.dem;if(!w)return 0;const l=function(_,E,F){var V=E[0],q=E[1];return _[0]=F[0]*V+F[4]*q+F[12],_[1]=F[1]*V+F[5]*q+F[13],_}([],[b/O*s.N,M/O*s.N],J.u_terrain_matrix),p=[l[0]*w.dim,l[1]*w.dim],x=Math.floor(p[0]),B=Math.floor(p[1]),L=p[0]-x,j=p[1]-B;return w.get(x,B)*(1-L)*(1-j)+w.get(x+1,B)*L*(1-j)+w.get(x,B+1)*(1-L)*j+w.get(x+1,B+1)*L*j}getElevationForLngLatZoom(A,b){const{tileID:M,mercatorX:O,mercatorY:z}=this._getOverscaledTileIDFromLngLatZoom(A,b);return this.getElevation(M,O%s.N,z%s.N,s.N)}getElevation(A,b,M){let O=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s.N;return this.getDEMElevation(A,b,M,O)*this.exaggeration}getTerrainData(A){if(!this._emptyDemTexture){const O=this.painter.context,z=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new nt(O,z,O.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new nt(O,new s.R({width:1,height:1}),O.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(O.gl.NEAREST,O.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.ao([])}const b=this.sourceCache.getSourceTile(A,!0);if(b&&b.dem&&(!b.demTexture||b.needsTerrainPrepare)){const O=this.painter.context;b.demTexture=this.painter.getTileTexture(b.dem.stride),b.demTexture?b.demTexture.update(b.dem.getPixels(),{premultiply:!1}):b.demTexture=new nt(O,b.dem.getPixels(),O.gl.RGBA,{premultiply:!1}),b.demTexture.bind(O.gl.NEAREST,O.gl.CLAMP_TO_EDGE),b.needsTerrainPrepare=!1}const M=b&&b+b.tileID.key+A.key;if(M&&!this._demMatrixCache[M]){const O=this.sourceCache.sourceCache._source.maxzoom;let z=A.canonical.z-b.tileID.canonical.z;A.overscaledZ>A.canonical.z&&(A.canonical.z>=O?z=A.canonical.z-O:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const J=A.canonical.x-(A.canonical.x>>z<<z),w=A.canonical.y-(A.canonical.y>>z<<z),l=s.bc(new Float64Array(16),[1/(s.N<<z),1/(s.N<<z),0]);s.$(l,l,[J*s.N,w*s.N,0]),this._demMatrixCache[A.key]={matrix:l,coord:A}}return{u_depth:2,u_terrain:3,u_terrain_dim:b&&b.dem&&b.dem.dim||1,u_terrain_matrix:M?this._demMatrixCache[A.key].matrix:this._emptyDemMatrix,u_terrain_unpack:b&&b.dem&&b.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(b&&b.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:b}}getFramebuffer(A){const b=this.painter,M=b.width/devicePixelRatio,O=b.height/devicePixelRatio;return!this._fbo||this._fbo.width===M&&this._fbo.height===O||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new nt(b.context,{width:M,height:O,data:null},b.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(b.context.gl.NEAREST,b.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new nt(b.context,{width:M,height:O,data:null},b.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(b.context.gl.NEAREST,b.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=b.context.createFramebuffer(M,O,!0,!1),this._fbo.depthAttachment.set(b.context.createRenderbuffer(b.context.gl.DEPTH_COMPONENT16,M,O))),this._fbo.colorAttachment.set(A==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const A=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const b=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let z=0,J=0;z<this._coordsTextureSize;z++)for(let w=0;w<this._coordsTextureSize;w++,J+=4)b[J+0]=255&w,b[J+1]=255&z,b[J+2]=w>>8<<4|z>>8,b[J+3]=0;const M=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(b.buffer)),O=new nt(A,M,A.gl.RGBA,{premultiply:!1});return O.bind(A.gl.NEAREST,A.gl.CLAMP_TO_EDGE),this._coordsTexture=O,O}pointCoordinate(A){const b=new Uint8Array(4),M=this.painter.context,O=M.gl;M.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),O.readPixels(A.x,this.painter.height/devicePixelRatio-A.y-1,1,1,O.RGBA,O.UNSIGNED_BYTE,b),M.bindFramebuffer.set(null);const z=b[0]+(b[2]>>4<<8),J=b[1]+((15&b[2])<<8),w=this.coordsIndex[255-b[3]],l=w&&this.sourceCache.getTileByID(w);if(!l)return null;const p=this._coordsTextureSize,x=(1<<l.tileID.canonical.z)*p;return new s.U(this._allowMercatorOverflow(A,(l.tileID.canonical.x*p+z)/x),(l.tileID.canonical.y*p+J)/x,this.getElevation(l.tileID,z,J,p))}getTerrainMesh(){if(this._mesh)return this._mesh;const A=this.painter.context,b=new s.bd,M=new s.b0,O=this.meshSize,z=s.N/O,J=O*O;for(let B=0;B<=O;B++)for(let L=0;L<=O;L++)b.emplaceBack(L*z,B*z,0);for(let B=0;B<J;B+=O+1)for(let L=0;L<O;L++)M.emplaceBack(L+B,O+L+B+1,O+L+B+2),M.emplaceBack(L+B,O+L+B+2,L+B+1);const w=b.length,l=w+2*(O+1);for(const B of[0,1])for(let L=0;L<=O;L++)for(const j of[0,1])b.emplaceBack(L*z,B*s.N,j);for(let B=0;B<2*O;B+=2)M.emplaceBack(l+B,l+B+1,l+B+3),M.emplaceBack(l+B,l+B+3,l+B+2),M.emplaceBack(w+B,w+B+3,w+B+1),M.emplaceBack(w+B,w+B+2,w+B+3);const p=b.length,x=p+2*(O+1);for(const B of[0,1])for(let L=0;L<=O;L++)for(const j of[0,1])b.emplaceBack(B*s.N,L*z,j);for(let B=0;B<2*O;B+=2)M.emplaceBack(p+B,p+B+1,p+B+3),M.emplaceBack(p+B,p+B+3,p+B+2),M.emplaceBack(x+B,x+B+3,x+B+1),M.emplaceBack(x+B,x+B+2,x+B+3);return this._mesh={indexBuffer:A.createIndexBuffer(M),vertexBuffer:A.createVertexBuffer(b,Kc.members),segments:s.S.simpleSegment(0,0,b.length,M.length)},this._mesh}getMeshFrameDelta(A){return 2*Math.PI*s.be/Math.pow(2,A)/5}getMinTileElevationForLngLatZoom(A,b){var M;const{tileID:O}=this._getOverscaledTileIDFromLngLatZoom(A,b);return(M=this.getMinMaxElevation(O).minElevation)!==null&&M!==void 0?M:0}getMinMaxElevation(A){const b=this.getTerrainData(A).tile,M={minElevation:null,maxElevation:null};return b&&b.dem&&(M.minElevation=b.dem.min*this.exaggeration,M.maxElevation=b.dem.max*this.exaggeration),M}_getOverscaledTileIDFromLngLatZoom(A,b){const M=s.U.fromLngLat(A.wrap()),O=(1<<b)*s.N,z=M.x*O,J=M.y*O,w=Math.floor(z/s.N),l=Math.floor(J/s.N);return{tileID:new s.O(b,0,b,w,l),mercatorX:z,mercatorY:J}}_allowMercatorOverflow(A,b){const M=A.x<this.painter.width/2;let O=s.bf(b);const z=this.painter.transform.center.lng;return M&&Math.sign(O)>0&&Math.sign(z)<0||!M&&Math.sign(O)<0&&Math.sign(z)>0?(O=360*Math.sign(z)+O,s.G(O)):b}}class uA{constructor(A,b,M){this._context=A,this._size=b,this._tileSize=M,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const A of this._objects)A.texture.destroy(),A.fbo.destroy()}_createObject(A){const b=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),M=new nt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return M.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),b.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),b.colorAttachment.set(M.texture),{id:A,fbo:b,texture:M,stamp:-1,inUse:!1}}getObjectForId(A){return this._objects[A]}useObject(A){A.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(b=>A.id!==b),this._recentlyUsed.push(A.id)}stampObject(A){A.stamp=++this._stamp}getOrCreateFreeObject(){for(const b of this._recentlyUsed)if(!this._objects[b].inUse)return this._objects[b];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const A=this._createObject(this._objects.length);return this._objects.push(A),A}freeObject(A){A.inUse=!1}freeAllObjects(){for(const A of this._objects)this.freeObject(A)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(A=>!A.inUse)===!1}}const Wn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Wc{constructor(A,b){this.painter=A,this.terrain=b,this.pool=new uA(A.context,30,b.sourceCache.tileSize*b.qualityFactor)}destruct(){this.pool.destruct()}getTexture(A){return this.pool.getObjectForId(A.rtt[this._stacks.length-1].id).texture}prepareForRender(A,b){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=A._order.filter(M=>!A._layers[M].isHidden(b)),this._coordsDescendingInv={};for(const M in A.sourceCaches){this._coordsDescendingInv[M]={};const O=A.sourceCaches[M].getVisibleCoordinates();for(const z of O){const J=this.terrain.sourceCache.getTerrainCoords(z);for(const w in J)this._coordsDescendingInv[M][w]||(this._coordsDescendingInv[M][w]=[]),this._coordsDescendingInv[M][w].push(J[w])}}this._coordsDescendingInvStr={};for(const M of A._order){const O=A._layers[M],z=O.source;if(Wn[O.type]&&!this._coordsDescendingInvStr[z]){this._coordsDescendingInvStr[z]={};for(const J in this._coordsDescendingInv[z])this._coordsDescendingInvStr[z][J]=this._coordsDescendingInv[z][J].map(w=>w.key).sort().join()}}for(const M of this._renderableTiles)for(const O in this._coordsDescendingInvStr){const z=this._coordsDescendingInvStr[O][M.tileID.key];z&&z!==M.rttCoords[O]&&(M.rtt=[])}}renderLayer(A){if(A.isHidden(this.painter.transform.zoom))return!1;const b=A.type,M=this.painter,O=this._renderableLayerIds[this._renderableLayerIds.length-1]===A.id;if(Wn[b]&&(this._prevType&&Wn[this._prevType]||this._stacks.push([]),this._prevType=b,this._stacks[this._stacks.length-1].push(A.id),!O))return!0;if(Wn[this._prevType]||Wn[b]&&O){this._prevType=b;const z=this._stacks.length-1,J=this._stacks[z]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(Ln(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[z]){const p=this.pool.getObjectForId(w.rtt[z].id);if(p.stamp===w.rtt[z].stamp){this.pool.useObject(p);continue}}const l=this.pool.getOrCreateFreeObject();this.pool.useObject(l),this.pool.stampObject(l),w.rtt[z]={id:l.id,stamp:l.stamp},M.context.bindFramebuffer.set(l.fbo.framebuffer),M.context.clear({color:s.aT.transparent,stencil:0}),M.currentStencilSource=void 0;for(let p=0;p<J.length;p++){const x=M.style._layers[J[p]],B=x.source?this._coordsDescendingInv[x.source][w.tileID.key]:[w.tileID];M.context.viewport.set([0,0,l.fbo.width,l.fbo.height]),M._renderTileClippingMasks(x,B),M.renderLayer(M,M.style.sourceCaches[x.source],x,B),x.source&&(w.rttCoords[x.source]=this._coordsDescendingInvStr[x.source][w.tileID.key])}}return Ln(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Wn[b]}return!1}}const Kr=g,Qr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.c.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Xn=N=>{N.touchstart=N.dragStart,N.touchmoveWindow=N.dragMove,N.touchend=N.dragEnd},ju={showCompass:!0,showZoom:!0,visualizePitch:!1};class ko{constructor(A,b){let M=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.mousedown=J=>{this.startMouse(s.e({},J,{ctrlKey:!0,preventDefault:()=>J.preventDefault()}),y.mousePos(this.element,J)),y.addEventListener(window,"mousemove",this.mousemove),y.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=J=>{this.moveMouse(J,y.mousePos(this.element,J))},this.mouseup=J=>{this.mouseRotate.dragEnd(J),this.mousePitch&&this.mousePitch.dragEnd(J),this.offTemp()},this.touchstart=J=>{J.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=y.touchPos(this.element,J.targetTouches)[0],this.startTouch(J,this._startPos),y.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.addEventListener(window,"touchend",this.touchend))},this.touchmove=J=>{J.targetTouches.length!==1?this.reset():(this._lastPos=y.touchPos(this.element,J.targetTouches)[0],this.moveTouch(J,this._lastPos))},this.touchend=J=>{J.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const O=A.dragRotate._mouseRotate.getClickTolerance(),z=A.dragRotate._mousePitch.getClickTolerance();this.element=b,this.mouseRotate=ta({clickTolerance:O,enable:!0}),this.touchRotate=(J=>{let{enable:w,clickTolerance:l,bearingDegreesPerPixelMoved:p=.8}=J;const x=new va;return new tn({clickTolerance:l,move:(B,L)=>({bearingDelta:(L.x-B.x)*p}),moveStateManager:x,enable:w,assignEvents:Xn})})({clickTolerance:O,enable:!0}),this.map=A,M&&(this.mousePitch=ra({clickTolerance:z,enable:!0}),this.touchPitch=(J=>{let{enable:w,clickTolerance:l,pitchDegreesPerPixelMoved:p=-.5}=J;const x=new va;return new tn({clickTolerance:l,move:(B,L)=>({pitchDelta:(L.y-B.y)*p}),moveStateManager:x,enable:w,assignEvents:Xn})})({clickTolerance:z,enable:!0})),y.addEventListener(b,"mousedown",this.mousedown),y.addEventListener(b,"touchstart",this.touchstart,{passive:!1}),y.addEventListener(b,"touchcancel",this.reset)}startMouse(A,b){this.mouseRotate.dragStart(A,b),this.mousePitch&&this.mousePitch.dragStart(A,b),y.disableDrag()}startTouch(A,b){this.touchRotate.dragStart(A,b),this.touchPitch&&this.touchPitch.dragStart(A,b),y.disableDrag()}moveMouse(A,b){const M=this.map,{bearingDelta:O}=this.mouseRotate.dragMove(A,b)||{};if(O&&M.setBearing(M.getBearing()+O),this.mousePitch){const{pitchDelta:z}=this.mousePitch.dragMove(A,b)||{};z&&M.setPitch(M.getPitch()+z)}}moveTouch(A,b){const M=this.map,{bearingDelta:O}=this.touchRotate.dragMove(A,b)||{};if(O&&M.setBearing(M.getBearing()+O),this.touchPitch){const{pitchDelta:z}=this.touchPitch.dragMove(A,b)||{};z&&M.setPitch(M.getPitch()+z)}}off(){const A=this.element;y.removeEventListener(A,"mousedown",this.mousedown),y.removeEventListener(A,"touchstart",this.touchstart,{passive:!1}),y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.removeEventListener(window,"touchend",this.touchend),y.removeEventListener(A,"touchcancel",this.reset),this.offTemp()}offTemp(){y.enableDrag(),y.removeEventListener(window,"mousemove",this.mousemove),y.removeEventListener(window,"mouseup",this.mouseup),y.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),y.removeEventListener(window,"touchend",this.touchend)}}let sn;function Ks(N,A,b){if(N=new s.L(N.lng,N.lat),A){const M=new s.L(N.lng-360,N.lat),O=new s.L(N.lng+360,N.lat),z=b.locationPoint(N).distSqr(A);b.locationPoint(M).distSqr(A)<z?N=M:b.locationPoint(O).distSqr(A)<z&&(N=O)}for(;Math.abs(N.lng-b.center.lng)>180;){const M=b.locationPoint(N);if(M.x>=0&&M.y>=0&&M.x<=b.width&&M.y<=b.height)break;N.lng>b.center.lng?N.lng-=360:N.lng+=360}return N}const Oo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function _u(N,A,b){const M=N.classList;for(const O in Oo)M.remove(`maplibregl-${b}-anchor-${O}`);M.add(`maplibregl-${b}-anchor-${A}`)}class Ws extends s.E{constructor(A){if(super(),this._onKeyPress=b=>{const M=b.code,O=b.charCode||b.keyCode;M!=="Space"&&M!=="Enter"&&O!==32&&O!==13||this.togglePopup()},this._onMapClick=b=>{const M=b.originalEvent.target,O=this._element;this._popup&&(M===O||O.contains(M))&&this.togglePopup()},this._update=b=>{if(!this._map)return;const M=this._map.loaded()&&!this._map.isMoving();((b==null?void 0:b.type)==="terrain"||(b==null?void 0:b.type)==="render"&&!M)&&this._map.once("render",this._update),this._map.transform.renderWorldCopies&&(this._lngLat=Ks(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let O="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?O=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(O=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let z="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?z="rotateX(0deg)":this._pitchAlignment==="map"&&(z=`rotateX(${this._map.getPitch()}deg)`),b&&b.type!=="moveend"||(this._pos=this._pos.round()),y.setTransform(this._element,`${Oo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${z} ${O}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const J=this._map.unproject(this._pos),w=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=J.distanceTo(this._lngLat)>20*w?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=b=>{if(!this._isDragging){const M=this._clickTolerance||this._map._clickTolerance;this._isDragging=b.point.dist(this._pointerdownPos)>=M}this._isDragging&&(this._pos=b.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=b=>{this._element.contains(b.originalEvent.target)&&(b.preventDefault(),this._positionDelta=b.point.sub(this._pos).add(this._offset),this._pointerdownPos=b.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=A&&A.anchor||"center",this._color=A&&A.color||"#3FB1CE",this._scale=A&&A.scale||1,this._draggable=A&&A.draggable||!1,this._clickTolerance=A&&A.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=A&&A.rotation||0,this._rotationAlignment=A&&A.rotationAlignment||"auto",this._pitchAlignment=A&&A.pitchAlignment&&A.pitchAlignment!=="auto"?A.pitchAlignment:this._rotationAlignment,A&&A.element)this._element=A.element,this._offset=s.P.convert(A&&A.offset||[0,0]);else{this._defaultMarker=!0,this._element=y.create("div"),this._element.setAttribute("aria-label","Map marker");const b=y.createNS("http://www.w3.org/2000/svg","svg"),M=41,O=27;b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height",`${M}px`),b.setAttributeNS(null,"width",`${O}px`),b.setAttributeNS(null,"viewBox",`0 0 ${O} ${M}`);const z=y.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"stroke","none"),z.setAttributeNS(null,"stroke-width","1"),z.setAttributeNS(null,"fill","none"),z.setAttributeNS(null,"fill-rule","evenodd");const J=y.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"fill-rule","nonzero");const w=y.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const l=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const V of l){const q=y.createNS("http://www.w3.org/2000/svg","ellipse");q.setAttributeNS(null,"opacity","0.04"),q.setAttributeNS(null,"cx","10.5"),q.setAttributeNS(null,"cy","5.80029008"),q.setAttributeNS(null,"rx",V.rx),q.setAttributeNS(null,"ry",V.ry),w.appendChild(q)}const p=y.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"fill",this._color);const x=y.createNS("http://www.w3.org/2000/svg","path");x.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),p.appendChild(x);const B=y.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const L=y.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild(L);const j=y.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const _=y.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(8.0, 8.0)");const E=y.createNS("http://www.w3.org/2000/svg","circle");E.setAttributeNS(null,"fill","#000000"),E.setAttributeNS(null,"opacity","0.25"),E.setAttributeNS(null,"cx","5.5"),E.setAttributeNS(null,"cy","5.5"),E.setAttributeNS(null,"r","5.4999962");const F=y.createNS("http://www.w3.org/2000/svg","circle");F.setAttributeNS(null,"fill","#FFFFFF"),F.setAttributeNS(null,"cx","5.5"),F.setAttributeNS(null,"cy","5.5"),F.setAttributeNS(null,"r","5.4999962"),_.appendChild(E),_.appendChild(F),J.appendChild(w),J.appendChild(p),J.appendChild(B),J.appendChild(j),J.appendChild(_),b.appendChild(J),b.setAttributeNS(null,"height",M*this._scale+"px"),b.setAttributeNS(null,"width",O*this._scale+"px"),this._element.appendChild(b),this._offset=s.P.convert(A&&A.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()}),_u(this._element,this._anchor,"marker"),A&&A.className)for(const b of A.className.split(" "))this._element.classList.add(b);this._popup=null}addTo(A){return this.remove(),this._map=A,A.getCanvasContainer().appendChild(this._element),A.on("move",this._update),A.on("moveend",this._update),A.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),y.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(A){return this._lngLat=s.L.convert(A),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(A){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),A){if(!("offset"in A.options)){const O=Math.abs(13.5)/Math.SQRT2;A.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[O,-1*(38.1-13.5+O)],"bottom-right":[-O,-1*(38.1-13.5+O)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=A,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const A=this._popup;return A?(A.isOpen()?A.remove():A.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(A){return this._offset=s.P.convert(A),this._update(),this}addClassName(A){this._element.classList.add(A)}removeClassName(A){this._element.classList.remove(A)}toggleClassName(A){return this._element.classList.toggle(A)}setDraggable(A){return this._draggable=!!A,this._map&&(A?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(A){return this._rotation=A||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(A){return this._rotationAlignment=A||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(A){return this._pitchAlignment=A&&A!=="auto"?A:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Yi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Fn=0,ic=!1;const nc={maxWidth:100,unit:"metric"};function Uo(N,A,b){const M=b&&b.maxWidth||100,O=N._container.clientHeight/2,z=N.unproject([0,O]),J=N.unproject([M,O]),w=z.distanceTo(J);if(b&&b.unit==="imperial"){const l=3.2808*w;l>5280?Oa(A,M,l/5280,N._getUIString("ScaleControl.Miles")):Oa(A,M,l,N._getUIString("ScaleControl.Feet"))}else b&&b.unit==="nautical"?Oa(A,M,w/1852,N._getUIString("ScaleControl.NauticalMiles")):w>=1e3?Oa(A,M,w/1e3,N._getUIString("ScaleControl.Kilometers")):Oa(A,M,w,N._getUIString("ScaleControl.Meters"))}function Oa(N,A,b,M){const O=function(z){const J=Math.pow(10,`${Math.floor(z)}`.length-1);let w=z/J;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(l){const p=Math.pow(10,Math.ceil(-Math.log(l)/Math.LN10));return Math.round(l*p)/p}(w),J*w}(b);N.style.width=A*(O/b)+"px",N.innerHTML=`${O}&nbsp;${M}`}const sc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Xc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function No(N){if(N){if(typeof N=="number"){const A=Math.round(Math.abs(N)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,N),"top-left":new s.P(A,A),"top-right":new s.P(-A,A),bottom:new s.P(0,-N),"bottom-left":new s.P(A,-A),"bottom-right":new s.P(-A,-A),left:new s.P(N,0),right:new s.P(-N,0)}}if(N instanceof s.P||Array.isArray(N)){const A=s.P.convert(N);return{center:A,top:A,"top-left":A,"top-right":A,bottom:A,"bottom-left":A,"bottom-right":A,left:A,right:A}}return{center:s.P.convert(N.center||[0,0]),top:s.P.convert(N.top||[0,0]),"top-left":s.P.convert(N["top-left"]||[0,0]),"top-right":s.P.convert(N["top-right"]||[0,0]),bottom:s.P.convert(N.bottom||[0,0]),"bottom-left":s.P.convert(N["bottom-left"]||[0,0]),"bottom-right":s.P.convert(N["bottom-right"]||[0,0]),left:s.P.convert(N.left||[0,0]),right:s.P.convert(N.right||[0,0])}}return No(new s.P(0,0))}const oc={extend:function(N){for(var A=arguments.length,b=new Array(A>1?A-1:0),M=1;M<A;M++)b[M-1]=arguments[M];return s.e(N,...b)},run(N){N()},logToElement(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"log";const M=window.document.getElementById(b);M&&(A&&(M.innerHTML=""),M.innerHTML+=`<br>${N}`)}},wa=g;class Qi{static get version(){return wa}static get workerCount(){return Wr.workerCount}static set workerCount(A){Wr.workerCount=A}static get maxParallelImageRequests(){return s.c.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(A){s.c.MAX_PARALLEL_IMAGE_REQUESTS=A}static get workerUrl(){return s.c.WORKER_URL}static set workerUrl(A){s.c.WORKER_URL=A}static addProtocol(A,b){s.c.REGISTERED_PROTOCOLS[A]=b}static removeProtocol(A){delete s.c.REGISTERED_PROTOCOLS[A]}}return Qi.Map=class extends xa{constructor(N){if(s.bg.mark(s.bh.create),(N=s.e({},Qr,N)).minZoom!=null&&N.maxZoom!=null&&N.minZoom>N.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(N.minPitch!=null&&N.maxPitch!=null&&N.minPitch>N.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(N.minPitch!=null&&N.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(N.maxPitch!=null&&N.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Jl(N.minZoom,N.maxZoom,N.minPitch,N.maxPitch,N.renderWorldCopies),{bearingSnap:N.bearingSnap}),this._cooperativeGesturesOnWheel=A=>{this._onCooperativeGesture(A,A[this._metaKey],1)},this._contextLost=A=>{A.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.k("webglcontextlost",{originalEvent:A}))},this._contextRestored=A=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:A}))},this._onMapScroll=A=>{if(A.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=N.interactive,this._cooperativeGestures=N.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=N.maxTileCacheSize,this._maxTileCacheZoomLevels=N.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=N.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=N.preserveDrawingBuffer,this._antialias=N.antialias,this._trackResize=N.trackResize,this._bearingSnap=N.bearingSnap,this._refreshExpiredTiles=N.refreshExpiredTiles,this._fadeDuration=N.fadeDuration,this._crossSourceCollisions=N.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=N.collectResourceTiming,this._renderTaskQueue=new oi,this._controls=[],this._mapId=s.a2(),this._locale=s.e({},bl,N.locale),this._clickTolerance=N.clickTolerance,this._overridePixelRatio=N.pixelRatio,this._maxCanvasSize=N.maxCanvasSize,this.transformCameraUpdate=N.transformCameraUpdate,this._imageQueueHandle=he.addThrottleControl(()=>this.isMoving()),this._requestManager=new pe(N.transformRequest),typeof N.container=="string"){if(this._container=document.getElementById(N.container),!this._container)throw new Error(`Container '${N.container}' not found.`)}else{if(!(N.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=N.container}if(N.maxBounds&&this.setMaxBounds(N.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let A=!1;const b=ho(M=>{this._trackResize&&!this._removed&&this.resize(M)._update()},50);this._resizeObserver=new ResizeObserver(M=>{A?b(M):A=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Gu(this,N),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=N.hash&&new vs(typeof N.hash=="string"&&N.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:N.center,zoom:N.zoom,bearing:N.bearing,pitch:N.pitch}),N.bounds&&(this.resize(),this.fitBounds(N.bounds,s.e({},N.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=N.localIdeographFontFamily,this._validateStyle=N.validateStyle,N.style&&this.setStyle(N.style,{localIdeographFontFamily:N.localIdeographFontFamily}),N.attributionControl&&this.addControl(new no({customAttribution:N.customAttribution})),N.maplibreLogo&&this.addControl(new Sr,N.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",A=>{this._update(A.dataType==="style"),this.fire(new s.k(`${A.dataType}data`,A))}),this.on("dataloading",A=>{this.fire(new s.k(`${A.dataType}dataloading`,A))}),this.on("dataabort",A=>{this.fire(new s.k("sourcedataabort",A))})}_getMapId(){return this._mapId}addControl(N,A){if(A===void 0&&(A=N.getDefaultPosition?N.getDefaultPosition():"top-right"),!N||!N.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const b=N.onAdd(this);this._controls.push(N);const M=this._controlPositions[A];return A.indexOf("bottom")!==-1?M.insertBefore(b,M.firstChild):M.appendChild(b),this}removeControl(N){if(!N||!N.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const A=this._controls.indexOf(N);return A>-1&&this._controls.splice(A,1),N.onRemove(this),this}hasControl(N){return this._controls.indexOf(N)>-1}calculateCameraOptionsFromTo(N,A,b,M){return M==null&&this.terrain&&(M=this.terrain.getElevationForLngLatZoom(b,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(N,A,b,M)}resize(N){var A;const b=this._containerDimensions(),M=b[0],O=b[1],z=this._getClampedPixelRatio(M,O);if(this._resizeCanvas(M,O,z),this.painter.resize(M,O,z),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const l=this._getClampedPixelRatio(M,O);this._resizeCanvas(M,O,l),this.painter.resize(M,O,l)}this.transform.resize(M,O),(A=this._requestedCameraState)===null||A===void 0||A.resize(M,O);const J=!this._moving;return J&&(this.stop(),this.fire(new s.k("movestart",N)).fire(new s.k("move",N))),this.fire(new s.k("resize",N)),J&&this.fire(new s.k("moveend",N)),this}_getClampedPixelRatio(N,A){const{0:b,1:M}=this._maxCanvasSize,O=this.getPixelRatio(),z=N*O,J=A*O;return Math.min(z>b?b/z:1,J>M?M/J:1)*O}getPixelRatio(){var N;return(N=this._overridePixelRatio)!==null&&N!==void 0?N:devicePixelRatio}setPixelRatio(N){this._overridePixelRatio=N,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(N){return this.transform.setMaxBounds(Ze.convert(N)),this._update()}setMinZoom(N){if((N=N??-2)>=-2&&N<=this.transform.maxZoom)return this.transform.minZoom=N,this._update(),this.getZoom()<N&&this.setZoom(N),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(N){if((N=N??22)>=this.transform.minZoom)return this.transform.maxZoom=N,this._update(),this.getZoom()>N&&this.setZoom(N),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(N){if((N=N??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(N>=0&&N<=this.transform.maxPitch)return this.transform.minPitch=N,this._update(),this.getPitch()<N&&this.setPitch(N),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(N){if((N=N??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(N>=this.transform.minPitch)return this.transform.maxPitch=N,this._update(),this.getPitch()>N&&this.setPitch(N),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(N){return this.transform.renderWorldCopies=N,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(N){return this._cooperativeGestures=N,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(N){return this.transform.locationPoint(s.L.convert(N),this.style&&this.terrain)}unproject(N){return this.transform.pointLocation(s.P.convert(N),this.terrain)}isMoving(){var N;return this._moving||((N=this.handlers)===null||N===void 0?void 0:N.isMoving())}isZooming(){var N;return this._zooming||((N=this.handlers)===null||N===void 0?void 0:N.isZooming())}isRotating(){var N;return this._rotating||((N=this.handlers)===null||N===void 0?void 0:N.isRotating())}_createDelegatedListener(N,A,b){if(N==="mouseenter"||N==="mouseover"){let M=!1;return{layer:A,listener:b,delegates:{mousemove:z=>{const J=this.getLayer(A)?this.queryRenderedFeatures(z.point,{layers:[A]}):[];J.length?M||(M=!0,b.call(this,new bs(N,this,z.originalEvent,{features:J}))):M=!1},mouseout:()=>{M=!1}}}}if(N==="mouseleave"||N==="mouseout"){let M=!1;return{layer:A,listener:b,delegates:{mousemove:J=>{(this.getLayer(A)?this.queryRenderedFeatures(J.point,{layers:[A]}):[]).length?M=!0:M&&(M=!1,b.call(this,new bs(N,this,J.originalEvent)))},mouseout:J=>{M&&(M=!1,b.call(this,new bs(N,this,J.originalEvent)))}}}}{const M=O=>{const z=this.getLayer(A)?this.queryRenderedFeatures(O.point,{layers:[A]}):[];z.length&&(O.features=z,b.call(this,O),delete O.features)};return{layer:A,listener:b,delegates:{[N]:M}}}}on(N,A,b){if(b===void 0)return super.on(N,A);const M=this._createDelegatedListener(N,A,b);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[N]=this._delegatedListeners[N]||[],this._delegatedListeners[N].push(M);for(const O in M.delegates)this.on(O,M.delegates[O]);return this}once(N,A,b){if(b===void 0)return super.once(N,A);const M=this._createDelegatedListener(N,A,b);for(const O in M.delegates)this.once(O,M.delegates[O]);return this}off(N,A,b){return b===void 0?super.off(N,A):(this._delegatedListeners&&this._delegatedListeners[N]&&(M=>{const O=this._delegatedListeners[N];for(let z=0;z<O.length;z++){const J=O[z];if(J.layer===A&&J.listener===b){for(const w in J.delegates)this.off(w,J.delegates[w]);return O.splice(z,1),this}}})(),this)}queryRenderedFeatures(N,A){if(!this.style)return[];let b;const M=N instanceof s.P||Array.isArray(N),O=M?N:[[0,0],[this.transform.width,this.transform.height]];if(A=A||(M?{}:N)||{},O instanceof s.P||typeof O[0]=="number")b=[s.P.convert(O)];else{const z=s.P.convert(O[0]),J=s.P.convert(O[1]);b=[z,new s.P(J.x,z.y),J,new s.P(z.x,J.y),z]}return this.style.queryRenderedFeatures(b,A,this.transform)}querySourceFeatures(N,A){return this.style.querySourceFeatures(N,A)}setStyle(N,A){return(A=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},A)).diff!==!1&&A.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&N?(this._diffStyle(N,A),this):(this._localIdeographFontFamily=A.localIdeographFontFamily,this._updateStyle(N,A))}setTransformRequest(N){return this._requestManager.setTransformRequest(N),this}_getUIString(N){const A=this._locale[N];if(A==null)throw new Error(`Missing UI string '${N}'`);return A}_updateStyle(N,A){if(A.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(N,A));const b=this.style&&A.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!N)),N?(this.style=new Zr(this,A||{}),this.style.setEventedParent(this,{style:this.style}),typeof N=="string"?this.style.loadURL(N,A,b):this.style.loadJSON(N,A,b),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Zr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(N,A){if(typeof N=="string"){const b=this._requestManager.transformRequest(N,ce.Style);s.f(b,(M,O)=>{M?this.fire(new s.j(M)):O&&this._updateDiff(O,A)})}else typeof N=="object"&&this._updateDiff(N,A)}_updateDiff(N,A){try{this.style.setState(N,A)&&this._update(!0)}catch(b){s.w(`Unable to perform style diff: ${b.message||b.error||b}.  Rebuilding the style from scratch.`),this._updateStyle(N,A)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(N,A){return this._lazyInitEmptyStyle(),this.style.addSource(N,A),this._update(!0)}isSourceLoaded(N){const A=this.style&&this.style.sourceCaches[N];if(A!==void 0)return A.loaded();this.fire(new s.j(new Error(`There is no source with ID '${N}'`)))}setTerrain(N){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),N){const A=this.style.sourceCaches[N.source];if(!A)throw new Error(`cannot load terrain, because there exists no source with ID: ${N.source}`);for(const b in this.style._layers){const M=this.style._layers[b];M.type==="hillshade"&&M.source===N.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Us(this.painter,A,N),this.painter.renderToTexture=new Wc(this.painter,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=b=>{b.dataType==="style"?this.terrain.sourceCache.freeRtt():b.dataType==="source"&&b.tile&&(b.sourceId!==N.source||this._elevationFreeze||(this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(b.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:N})),this}getTerrain(){var N,A;return(A=(N=this.terrain)===null||N===void 0?void 0:N.options)!==null&&A!==void 0?A:null}areTilesLoaded(){const N=this.style&&this.style.sourceCaches;for(const A in N){const b=N[A]._tiles;for(const M in b){const O=b[M];if(O.state!=="loaded"&&O.state!=="errored")return!1}}return!0}addSourceType(N,A,b){return this._lazyInitEmptyStyle(),this.style.addSourceType(N,A,b)}removeSource(N){return this.style.removeSource(N),this._update(!0)}getSource(N){return this.style.getSource(N)}addImage(N,A){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{pixelRatio:M=1,sdf:O=!1,stretchX:z,stretchY:J,content:w}=b;if(this._lazyInitEmptyStyle(),!(A instanceof HTMLImageElement||s.a(A))){if(A.width===void 0||A.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:l,height:p,data:x}=A,B=A;return this.style.addImage(N,{data:new s.R({width:l,height:p},new Uint8Array(x)),pixelRatio:M,stretchX:z,stretchY:J,content:w,sdf:O,version:0,userImage:B}),B.onAdd&&B.onAdd(this,N),this}}{const{width:l,height:p,data:x}=s.h.getImageData(A);this.style.addImage(N,{data:new s.R({width:l,height:p},x),pixelRatio:M,stretchX:z,stretchY:J,content:w,sdf:O,version:0})}}updateImage(N,A){const b=this.style.getImage(N);if(!b)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const M=A instanceof HTMLImageElement||s.a(A)?s.h.getImageData(A):A,{width:O,height:z,data:J}=M;if(O===void 0||z===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(O!==b.data.width||z!==b.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(A instanceof HTMLImageElement||s.a(A));return b.data.replace(J,w),this.style.updateImage(N,b),this}getImage(N){return this.style.getImage(N)}hasImage(N){return N?!!this.style.getImage(N):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(N){this.style.removeImage(N)}loadImage(N,A){he.getImage(this._requestManager.transformRequest(N,ce.Image),A)}listImages(){return this.style.listImages()}addLayer(N,A){return this._lazyInitEmptyStyle(),this.style.addLayer(N,A),this._update(!0)}moveLayer(N,A){return this.style.moveLayer(N,A),this._update(!0)}removeLayer(N){return this.style.removeLayer(N),this._update(!0)}getLayer(N){return this.style.getLayer(N)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(N,A,b){return this.style.setLayerZoomRange(N,A,b),this._update(!0)}setFilter(N,A){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.style.setFilter(N,A,b),this._update(!0)}getFilter(N){return this.style.getFilter(N)}setPaintProperty(N,A,b){let M=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setPaintProperty(N,A,b,M),this._update(!0)}getPaintProperty(N,A){return this.style.getPaintProperty(N,A)}setLayoutProperty(N,A,b){let M=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.style.setLayoutProperty(N,A,b,M),this._update(!0)}getLayoutProperty(N,A){return this.style.getLayoutProperty(N,A)}setGlyphs(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setGlyphs(N,A),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(N,A){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this._lazyInitEmptyStyle(),this.style.addSprite(N,A,b,M=>{M||this._update(!0)}),this}removeSprite(N){return this._lazyInitEmptyStyle(),this.style.removeSprite(N),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setSprite(N,A,b=>{b||this._update(!0)}),this}setLight(N){let A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(N,A),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(N,A){return this.style.setFeatureState(N,A),this._update()}removeFeatureState(N,A){return this.style.removeFeatureState(N,A),this._update()}getFeatureState(N){return this.style.getFeatureState(N)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let N=0,A=0;return this._container&&(N=this._container.clientWidth||400,A=this._container.clientHeight||300),[N,A]}_setupContainer(){const N=this._container;N.classList.add("maplibregl-map");const A=this._canvasContainer=y.create("div","maplibregl-canvas-container",N);this._interactive&&A.classList.add("maplibregl-interactive"),this._canvas=y.create("canvas","maplibregl-canvas",A),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const b=this._containerDimensions(),M=this._getClampedPixelRatio(b[0],b[1]);this._resizeCanvas(b[0],b[1],M);const O=this._controlContainer=y.create("div","maplibregl-control-container",N),z=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(J=>{z[J]=y.create("div",`maplibregl-ctrl-${J} `,O)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=y.create("div","maplibregl-cooperative-gesture-screen",this._container);let N=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(N=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${N}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._cooperativeGesturesScreen.setAttribute("aria-hidden","true"),this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){y.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(N,A,b){this._canvas.width=Math.floor(b*N),this._canvas.height=Math.floor(b*A),this._canvas.style.width=`${N}px`,this._canvas.style.height=`${A}px`}_setupPainter(){const N={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let A=null;this._canvas.addEventListener("webglcontextcreationerror",M=>{A={requestedAttributes:N},M&&(A.statusMessage=M.statusMessage,A.type=M.type)},{once:!0});const b=this._canvas.getContext("webgl2",N)||this._canvas.getContext("webgl",N);if(!b){const M="Failed to initialize WebGL";throw A?(A.message=M,new Error(JSON.stringify(A))):new Error(M)}this.painter=new fn(b,this.transform),T.testSupport(b)}_onCooperativeGesture(N,A,b){return!A&&b<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(N){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||N,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(N){return this._update(),this._renderTaskQueue.add(N)}_cancelRenderFrame(N){this._renderTaskQueue.remove(N)}_render(N){const A=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(N),this._removed)return;let b=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,z=s.h.now();this.style.zoomHistory.update(O,z);const J=new s.a8(O,{now:z,fadeDuration:A,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=J.crossFadingFactor();w===1&&w===this._crossFadingFactor||(b=!0,this._crossFadingFactor=w),this.style.update(J)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform._minEleveationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform._minEleveationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,A,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:A,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bg.mark(s.bh.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const M=this._sourcesDirty||this._styleDirty||this._placementDirty;return M||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,s.bg.mark(s.bh.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var N;this._hash&&this._hash.remove();for(const b of this._controls)b.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),he.removeThrottleControl(this._imageQueueHandle),(N=this._resizeObserver)===null||N===void 0||N.disconnect();const A=this.painter.context.gl.getExtension("WEBGL_lose_context");A&&A.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),y.remove(this._canvasContainer),y.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),s.bg.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=s.h.frame(N=>{s.bg.frame(N),this._frame=null,this._render(N)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(N){this._showTileBoundaries!==N&&(this._showTileBoundaries=N,this._update())}get showPadding(){return!!this._showPadding}set showPadding(N){this._showPadding!==N&&(this._showPadding=N,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(N){this._showCollisionBoxes!==N&&(this._showCollisionBoxes=N,N?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(N){this._showOverdrawInspector!==N&&(this._showOverdrawInspector=N,this._update())}get repaint(){return!!this._repaint}set repaint(N){this._repaint!==N&&(this._repaint=N,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(N){this._vertices=N,this._update()}get version(){return Kr}getCameraTargetElevation(){return this.transform.elevation}},Qi.NavigationControl=class{constructor(N){this._updateZoomButtons=()=>{const A=this._map.getZoom(),b=A===this._map.getMaxZoom(),M=A===this._map.getMinZoom();this._zoomInButton.disabled=b,this._zoomOutButton.disabled=M,this._zoomInButton.setAttribute("aria-disabled",b.toString()),this._zoomOutButton.setAttribute("aria-disabled",M.toString())},this._rotateCompassArrow=()=>{const A=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=A},this._setButtonTitle=(A,b)=>{const M=this._map._getUIString(`NavigationControl.${b}`);A.title=M,A.setAttribute("aria-label",M)},this.options=s.e({},ju,N),this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",A=>A.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",A=>this._map.zoomIn({},{originalEvent:A})),y.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",A=>this._map.zoomOut({},{originalEvent:A})),y.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",A=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:A}):this._map.resetNorth({},{originalEvent:A})}),this._compassIcon=y.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(N){return this._map=N,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ko(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){y.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(N,A){const b=y.create("button",N,this._container);return b.type="button",b.addEventListener("click",A),b}},Qi.GeolocateControl=class extends s.E{constructor(N){super(),this._onSuccess=A=>{if(this._map){if(this._isOutOfMapMaxBounds(A))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",A)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=A,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(A),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(A),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",A)),this._finish()}},this._updateCamera=A=>{const b=new s.L(A.coords.longitude,A.coords.latitude),M=A.coords.accuracy,O=this._map.getBearing(),z=s.e({bearing:O},this.options.fitBoundsOptions),J=Ze.fromLngLat(b,M);this._map.fitBounds(J,z,{geolocateSource:!0})},this._updateMarker=A=>{if(A){const b=new s.L(A.coords.longitude,A.coords.latitude);this._accuracyCircleMarker.setLngLat(b).addTo(this._map),this._userLocationDotMarker.setLngLat(b).addTo(this._map),this._accuracy=A.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=A=>{if(this._map){if(this.options.trackUserLocation)if(A.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(A.code===3&&ic)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",A)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=A=>{if(this._map){if(this._container.addEventListener("contextmenu",b=>b.preventDefault()),this._geolocateButton=y.create("button","maplibregl-ctrl-geolocate",this._container),y.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",A===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}else{const b=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=y.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ws({element:this._dotElement}),this._circleElement=y.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ws({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",b=>{b.geolocateSource||this._watchState!=="ACTIVE_LOCK"||b.originalEvent&&b.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},Yi,N)}onAdd(N){return this._map=N,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(A){let b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;sn===void 0||b?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(M=>{sn=M.state!=="denied",A(sn)}).catch(()=>{sn=!!window.navigator.geolocation,A(sn)}):(sn=!!window.navigator.geolocation,A(sn)):A(sn)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),y.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Fn=0,ic=!1}_isOutOfMapMaxBounds(N){const A=this._map.getMaxBounds(),b=N.coords;return A&&(b.longitude<A.getWest()||b.longitude>A.getEast()||b.latitude<A.getSouth()||b.latitude>A.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const N=this._map.getBounds(),A=N.getSouthEast(),b=N.getNorthEast(),M=A.distanceTo(b),O=Math.ceil(this._accuracy/(M/this._map._container.clientHeight)*2);this._circleElement.style.width=`${O}px`,this._circleElement.style.height=`${O}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Fn--,ic=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let N;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Fn++,Fn>1?(N={maximumAge:6e5,timeout:0},ic=!0):(N=this.options.positionOptions,ic=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,N)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},Qi.AttributionControl=no,Qi.LogoControl=Sr,Qi.ScaleControl=class{constructor(N){this._onMove=()=>{Uo(this._map,this._container,this.options)},this.setUnit=A=>{this.options.unit=A,Uo(this._map,this._container,this.options)},this.options=s.e({},nc,N)}getDefaultPosition(){return"bottom-left"}onAdd(N){return this._map=N,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-scale",N.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){y.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},Qi.FullscreenControl=class extends s.E{constructor(){let N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,N&&N.container&&(N.container instanceof HTMLElement?this._container=N.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(N){return this._map=N,this._container||(this._container=this._map.getContainer()),this._controlContainer=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){y.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const N=this._fullscreenButton=y.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);y.create("span","maplibregl-ctrl-icon",N).setAttribute("aria-hidden","true"),N.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const N=this._getTitle();this._fullscreenButton.setAttribute("aria-label",N),this._fullscreenButton.title=N}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},Qi.TerrainControl=class{constructor(N){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=N}onAdd(N){return this._map=N,this._container=y.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=y.create("button","maplibregl-ctrl-terrain",this._container),y.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){y.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},Qi.Popup=class extends s.E{constructor(N){super(),this.remove=()=>(this._content&&y.remove(this._content),this._container&&(y.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new s.k("close")),this),this._onMouseUp=A=>{this._update(A.point)},this._onMouseMove=A=>{this._update(A.point)},this._onDrag=A=>{this._update(A.point)},this._update=A=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=y.create("div","maplibregl-popup",this._map.getContainer()),this._tip=y.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const J of this.options.className.split(" "))this._container.classList.add(J);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ks(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!A)return;const b=this._pos=this._trackPointer&&A?A:this._map.project(this._lngLat);let M=this.options.anchor;const O=No(this.options.offset);if(!M){const J=this._container.offsetWidth,w=this._container.offsetHeight;let l;l=b.y+O.bottom.y<w?["top"]:b.y>this._map.transform.height-w?["bottom"]:[],b.x<J/2?l.push("left"):b.x>this._map.transform.width-J/2&&l.push("right"),M=l.length===0?"bottom":l.join("-")}const z=b.add(O[M]).round();y.setTransform(this._container,`${Oo[M]} translate(${z.x}px,${z.y}px)`),_u(this._container,M,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(sc),N)}addTo(N){return this._map&&this.remove(),this._map=N,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(N){return this._lngLat=s.L.convert(N),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(N){return this.setDOMContent(document.createTextNode(N))}setHTML(N){const A=document.createDocumentFragment(),b=document.createElement("body");let M;for(b.innerHTML=N;M=b.firstChild,M;)A.appendChild(M);return this.setDOMContent(A)}getMaxWidth(){var N;return(N=this._container)===null||N===void 0?void 0:N.style.maxWidth}setMaxWidth(N){return this.options.maxWidth=N,this._update(),this}setDOMContent(N){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=y.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(N),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(N){this._container&&this._container.classList.add(N)}removeClassName(N){this._container&&this._container.classList.remove(N)}setOffset(N){return this.options.offset=N,this._update(),this}toggleClassName(N){if(this._container)return this._container.classList.toggle(N)}_createCloseButton(){this.options.closeButton&&(this._closeButton=y.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const N=this._container.querySelector(Xc);N&&N.focus()}},Qi.Marker=Ws,Qi.Style=Zr,Qi.LngLat=s.L,Qi.LngLatBounds=Ze,Qi.Point=s.P,Qi.MercatorCoordinate=s.U,Qi.Evented=s.E,Qi.AJAXError=s.bi,Qi.config=s.c,Qi.CanvasSource=vr,Qi.GeoJSONSource=Dt,Qi.ImageSource=qt,Qi.RasterDEMTileSource=Bt,Qi.RasterTileSource=mt,Qi.VectorTileSource=pt,Qi.VideoSource=nr,Qi.setRTLTextPlugin=s.bj,Qi.getRTLTextPluginStatus=s.bk,Qi.prewarm=function(){Pi().acquire(ur)},Qi.clearPrewarmedResources=function(){const N=gi;N&&(N.isPreloaded()&&N.numActive()===1?(N.release(ur),gi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},oc.extend(Qi,{isSafari:s.ac,getPerformanceMetrics:s.bg.getPerformanceMetrics}),Qi});var a=n;return a})})(J4);var Gie=J4.exports,jie=Object.defineProperty,qie=(r,e,t)=>e in r?jie(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ms=(r,e,t)=>(qie(r,typeof e!="symbol"?e+"":e,t),t);let $ie=class{constructor(e){Ms(this,"map"),Ms(this,"width"),Ms(this,"height"),Ms(this,"svgCanvas"),Ms(this,"xLine"),Ms(this,"yLine"),Ms(this,"color","#535353"),this.map=e,this.mapResize=this.mapResize.bind(this)}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var e,t;this.width=(e=this.map)==null?void 0:e.getCanvas().clientWidth,this.height=(t=this.map)==null?void 0:t.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const e=this.width/2,t=this.height/2;this.yLine.setAttribute("x1",`${e}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${e}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1","0px"),this.xLine.setAttribute("y1",`${t}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${t}px`)}else console.error("element value is null")}createCanvas(e){if(this.width!==void 0&&this.height!==void 0){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.style.position="relative",t.setAttribute("width",`${this.width}px`),t.setAttribute("height",`${this.height}px`);const i=this.width/2,n=this.height/2;this.yLine=t.appendChild(this.createLine(i,0,i,this.height,this.color,"2px")),this.xLine=t.appendChild(this.createLine(0,n,this.width,n,this.color,"2px")),e==null||e.appendChild(t),this.svgCanvas=t}}createLine(e,t,i,n,o,a){const s=document.createElementNS("http://www.w3.org/2000/svg","line");return s.setAttribute("x1",e),s.setAttribute("y1",t),s.setAttribute("x2",i),s.setAttribute("y2",n),s.setAttribute("stroke-dasharray","5,5"),s.setAttribute("stroke",o),s.setAttribute("stroke-width",a),s}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}};function ts(r){"@babel/helpers - typeof";return ts=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ts(r)}var dc=Uint8Array,fc=Uint16Array,Wy=Uint32Array,hv=new dc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Av=new dc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),UC=new dc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Y4=function(r,e){for(var t=new fc(31),i=0;i<31;++i)t[i]=e+=1<<r[i-1];for(var n=new Wy(t[30]),i=1;i<30;++i)for(var o=t[i];o<t[i+1];++o)n[o]=o-t[i]<<5|i;return[t,n]},eD=Y4(hv,2),tD=eD[0],NC=eD[1];tD[28]=258,NC[258]=28;for(var rD=Y4(Av,0),Kie=rD[0],iD=rD[1],zC=new fc(32768),Zs=0;Zs<32768;++Zs){var wd=(Zs&43690)>>>1|(Zs&21845)<<1;wd=(wd&52428)>>>2|(wd&13107)<<2,wd=(wd&61680)>>>4|(wd&3855)<<4,zC[Zs]=((wd&65280)>>>8|(wd&255)<<8)>>>1}for(var Xh=function(r,e,t){for(var i=r.length,n=0,o=new fc(e);n<i;++n)++o[r[n]-1];var a=new fc(e);for(n=0;n<e;++n)a[n]=a[n-1]+o[n-1]<<1;var s;if(t){s=new fc(1<<e);var g=15-e;for(n=0;n<i;++n)if(r[n])for(var y=n<<4|r[n],T=e-r[n],I=a[r[n]-1]++<<T,R=I|(1<<T)-1;I<=R;++I)s[zC[I]>>>g]=y}else for(s=new fc(i),n=0;n<i;++n)s[n]=zC[a[r[n]-1]++]>>>15-r[n];return s},Bd=new dc(288),Zs=0;Zs<144;++Zs)Bd[Zs]=8;for(var Zs=144;Zs<256;++Zs)Bd[Zs]=9;for(var Zs=256;Zs<280;++Zs)Bd[Zs]=7;for(var Zs=280;Zs<288;++Zs)Bd[Zs]=8;for(var Xy=new dc(32),Zs=0;Zs<32;++Zs)Xy[Zs]=5;var Wie=Xh(Bd,9,0),Xie=Xh(Bd,9,1),Zie=Xh(Xy,5,0),Jie=Xh(Xy,5,1),QC=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},dh=function(r,e,t){var i=e/8>>0;return(r[i]|r[i+1]<<8)>>>(e&7)&t},VC=function(r,e){var t=e/8>>0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>>(e&7)},HC=function(r){return(r/8>>0)+(r&7&&1)},nD=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var i=new(r instanceof fc?fc:r instanceof Wy?Wy:dc)(t-e);return i.set(r.subarray(e,t)),i},Yie=function(r,e,t){var i=r.length,n=!e||t,o=!t||t.i;t||(t={}),e||(e=new dc(i*3));var a=function(mt){var Bt=e.length;if(mt>Bt){var Dt=new dc(Math.max(Bt*2,mt));Dt.set(e),e=Dt}},s=t.f||0,g=t.p||0,y=t.b||0,T=t.l,I=t.d,R=t.m,U=t.n,Z=i*8;do{if(!T){t.f=s=dh(r,g,1);var Y=dh(r,g+1,3);if(g+=3,Y)if(Y==1)T=Xie,I=Jie,R=9,U=5;else if(Y==2){var he=dh(r,g,31)+257,ce=dh(r,g+10,15)+4,pe=he+dh(r,g+5,31)+1;g+=14;for(var be=new dc(pe),Te=new dc(19),qe=0;qe<ce;++qe)Te[UC[qe]]=dh(r,g+qe*3,7);g+=ce*3;var je=QC(Te),We=(1<<je)-1;if(!o&&g+pe*(je+7)>Z)break;for(var Ne=Xh(Te,je,1),qe=0;qe<pe;){var at=Ne[dh(r,g,We)];g+=at&15;var nt=at>>>4;if(nt<16)be[qe++]=nt;else{var ke=0,De=0;for(nt==16?(De=3+dh(r,g,3),g+=2,ke=be[qe-1]):nt==17?(De=3+dh(r,g,7),g+=3):nt==18&&(De=11+dh(r,g,127),g+=7);De--;)be[qe++]=ke}}var Ye=be.subarray(0,he),Xe=be.subarray(he);R=QC(Ye),U=QC(Xe),T=Xh(Ye,R,1),I=Xh(Xe,U,1)}else throw"invalid block type";else{var nt=HC(g)+4,Ct=r[nt-4]|r[nt-3]<<8,Et=nt+Ct;if(Et>i){if(o)throw"unexpected EOF";break}n&&a(y+Ct),e.set(r.subarray(nt,Et),y),t.b=y+=Ct,t.p=g=Et*8;continue}if(g>Z)throw"unexpected EOF"}n&&a(y+131072);for(var Pt=(1<<R)-1,bt=(1<<U)-1,Rt=R+U+18;o||g+Rt<Z;){var ke=T[VC(r,g)&Pt],Ft=ke>>>4;if(g+=ke&15,g>Z)throw"unexpected EOF";if(!ke)throw"invalid length/literal";if(Ft<256)e[y++]=Ft;else if(Ft==256){T=null;break}else{var Zt=Ft-254;if(Ft>264){var qe=Ft-257,Le=hv[qe];Zt=dh(r,g,(1<<Le)-1)+tD[qe],g+=Le}var Ze=I[VC(r,g)&bt],rt=Ze>>>4;if(!Ze)throw"invalid distance";g+=Ze&15;var Xe=Kie[rt];if(rt>3){var Le=Av[rt];Xe+=VC(r,g)&(1<<Le)-1,g+=Le}if(g>Z)throw"unexpected EOF";n&&a(y+131072);for(var pt=y+Zt;y<pt;y+=4)e[y]=e[y-Xe],e[y+1]=e[y+1-Xe],e[y+2]=e[y+2-Xe],e[y+3]=e[y+3-Xe];y=pt}}t.l=T,t.p=g,t.b=y,T&&(s=1,t.m=R,t.d=I,t.n=U)}while(!s);return y==e.length?e:nD(e,0,y)},UA=function(r,e,t){t<<=e&7;var i=e/8>>0;r[i]|=t,r[i+1]|=t>>>8},Zy=function(r,e,t){t<<=e&7;var i=e/8>>0;r[i]|=t,r[i+1]|=t>>>8,r[i+2]|=t>>>16},GC=function(r,e){for(var t=[],i=0;i<r.length;++i)r[i]&&t.push({s:i,f:r[i]});var n=t.length,o=t.slice();if(!n)return[new dc(0),0];if(n==1){var a=new dc(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort(function(qe,je){return qe.f-je.f}),t.push({s:-1,f:25001});var s=t[0],g=t[1],y=0,T=1,I=2;for(t[0]={s:-1,f:s.f+g.f,l:s,r:g};T!=n-1;)s=t[t[y].f<t[I].f?y++:I++],g=t[y!=T&&t[y].f<t[I].f?y++:I++],t[T++]={s:-1,f:s.f+g.f,l:s,r:g};for(var R=o[0].s,i=1;i<n;++i)o[i].s>R&&(R=o[i].s);var U=new fc(R+1),Z=jC(t[T-1],U,0);if(Z>e){var i=0,Y=0,he=Z-e,ce=1<<he;for(o.sort(function(je,We){return U[We.s]-U[je.s]||je.f-We.f});i<n;++i){var pe=o[i].s;if(U[pe]>e)Y+=ce-(1<<Z-U[pe]),U[pe]=e;else break}for(Y>>>=he;Y>0;){var be=o[i].s;U[be]<e?Y-=1<<e-U[be]++-1:++i}for(;i>=0&&Y;--i){var Te=o[i].s;U[Te]==e&&(--U[Te],++Y)}Z=e}return[new dc(U),Z]},jC=function(r,e,t){return r.s==-1?Math.max(jC(r.l,e,t+1),jC(r.r,e,t+1)):e[r.s]=t},sD=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new fc(++e),i=0,n=r[0],o=1,a=function(g){t[i++]=g},s=1;s<=e;++s)if(r[s]==n&&s!=e)++o;else{if(!n&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(n),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(n);o=1,n=r[s]}return[t.subarray(0,i),e]},Jy=function(r,e){for(var t=0,i=0;i<e.length;++i)t+=r[i]*e[i];return t},dv=function(r,e,t){var i=t.length,n=HC(e+2);r[n]=i&255,r[n+1]=i>>>8,r[n+2]=r[n]^255,r[n+3]=r[n+1]^255;for(var o=0;o<i;++o)r[n+o+4]=t[o];return(n+4+i)*8},oD=function(r,e,t,i,n,o,a,s,g,y,T){UA(e,T++,t),++n[256];for(var I=GC(n,15),R=I[0],U=I[1],Z=GC(o,15),Y=Z[0],he=Z[1],ce=sD(R),pe=ce[0],be=ce[1],Te=sD(Y),qe=Te[0],je=Te[1],We=new fc(19),Ne=0;Ne<pe.length;++Ne)We[pe[Ne]&31]++;for(var Ne=0;Ne<qe.length;++Ne)We[qe[Ne]&31]++;for(var at=GC(We,7),nt=at[0],ke=at[1],De=19;De>4&&!nt[UC[De-1]];--De);var Ye=y+5<<3,Xe=Jy(n,Bd)+Jy(o,Xy)+a,Ct=Jy(n,R)+Jy(o,Y)+a+14+3*De+Jy(We,nt)+(2*We[16]+3*We[17]+7*We[18]);if(Ye<=Xe&&Ye<=Ct)return dv(e,T,r.subarray(g,g+y));var Et,Pt,bt,Rt;if(UA(e,T,1+(Ct<Xe)),T+=2,Ct<Xe){Et=Xh(R,U,0),Pt=R,bt=Xh(Y,he,0),Rt=Y;var Ft=Xh(nt,ke,0);UA(e,T,be-257),UA(e,T+5,je-1),UA(e,T+10,De-4),T+=14;for(var Ne=0;Ne<De;++Ne)UA(e,T+3*Ne,nt[UC[Ne]]);T+=3*De;for(var Zt=[pe,qe],Le=0;Le<2;++Le)for(var Ze=Zt[Le],Ne=0;Ne<Ze.length;++Ne){var rt=Ze[Ne]&31;UA(e,T,Ft[rt]),T+=nt[rt],rt>15&&(UA(e,T,Ze[Ne]>>>5&127),T+=Ze[Ne]>>>12)}}else Et=Wie,Pt=Bd,bt=Zie,Rt=Xy;for(var Ne=0;Ne<s;++Ne)if(i[Ne]>255){var rt=i[Ne]>>>18&31;Zy(e,T,Et[rt+257]),T+=Pt[rt+257],rt>7&&(UA(e,T,i[Ne]>>>23&31),T+=hv[rt]);var pt=i[Ne]&31;Zy(e,T,bt[pt]),T+=Rt[pt],pt>3&&(Zy(e,T,i[Ne]>>>5&8191),T+=Av[pt])}else Zy(e,T,Et[i[Ne]]),T+=Pt[i[Ne]];return Zy(e,T,Et[256]),T+Pt[256]},ene=new Wy([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),tne=new dc(0),rne=function(r,e,t,i,n,o){var a=r.length,s=new dc(i+a+5*(1+Math.floor(a/7e3))+n),g=s.subarray(i,s.length-n),y=0;if(!e||a<8)for(var T=0;T<=a;T+=65535){var I=T+65535;I<a?y=dv(g,y,r.subarray(T,I)):(g[T]=o,y=dv(g,y,r.subarray(T,a)))}else{for(var R=ene[e-1],U=R>>>13,Z=R&8191,Y=(1<<t)-1,he=new fc(32768),ce=new fc(Y+1),pe=Math.ceil(t/3),be=2*pe,Te=function(Fr){return(r[Fr]^r[Fr+1]<<pe^r[Fr+2]<<be)&Y},qe=new Wy(25e3),je=new fc(288),We=new fc(32),Ne=0,at=0,T=0,nt=0,ke=0,De=0;T<a;++T){var Ye=Te(T),Xe=T&32767,Ct=ce[Ye];if(he[Xe]=Ct,ce[Ye]=Xe,ke<=T){var Et=a-T;if((Ne>7e3||nt>24576)&&Et>423){y=oD(r,g,0,qe,je,We,at,nt,De,T-De,y),nt=Ne=at=0,De=T;for(var Pt=0;Pt<286;++Pt)je[Pt]=0;for(var Pt=0;Pt<30;++Pt)We[Pt]=0}var bt=2,Rt=0,Ft=Z,Zt=Xe-Ct&32767;if(Et>2&&Ye==Te(T-Zt))for(var Le=Math.min(U,Et)-1,Ze=Math.min(32767,T),rt=Math.min(258,Et);Zt<=Ze&&--Ft&&Xe!=Ct;){if(r[T+bt]==r[T+bt-Zt]){for(var pt=0;pt<rt&&r[T+pt]==r[T+pt-Zt];++pt);if(pt>bt){if(bt=pt,Rt=Zt,pt>Le)break;for(var mt=Math.min(Zt,pt-2),Bt=0,Pt=0;Pt<mt;++Pt){var Dt=T-Zt+Pt+32768&32767,Mt=he[Dt],qt=Dt-Mt+32768&32767;qt>Bt&&(Bt=qt,Ct=Dt)}}}Xe=Ct,Ct=he[Xe],Zt+=Xe-Ct+32768&32767}if(Rt){qe[nt++]=268435456|NC[bt]<<18|iD[Rt];var nr=NC[bt]&31,vr=iD[Rt]&31;at+=hv[nr]+Av[vr],++je[257+nr],++We[vr],ke=T+bt,++Ne}else qe[nt++]=r[T],++je[r[T]]}}y=oD(r,g,o,qe,je,We,at,nt,De,T-De,y),o||(y=dv(g,y,tne))}return nD(s,0,i+HC(y)+n)},ine=function(){var r=1,e=0;return{p:function(t){for(var i=r,n=e,o=t.length,a=0;a!=o;){for(var s=Math.min(a+5552,o);a<s;++a)i+=t[a],n+=i;i%=65521,n%=65521}r=i,e=n},d:function(){return(r>>>8<<16|(e&255)<<8|e>>>8)+((r&255)<<23)*2}}},nne=function(r,e,t,i,n){return rne(r,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):12+e.mem,t,i,!n)},sne=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8},one=function(r,e){var t=e.level,i=t==0?0:t<6?1:t==9?3:2;r[0]=120,r[1]=i<<6|(i?32-2*i:1)},ane=function(r){if((r[0]&15)!=8||r[0]>>>4>7||(r[0]<<8|r[1])%31)throw"invalid zlib data";if(r[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function qC(r,e){e===void 0&&(e={});var t=ine();t.p(r);var i=nne(r,e,2,4);return one(i,e),sne(i,i.length-4,t.d()),i}function lne(r,e){return Yie((ane(r),r.subarray(2,-4)),e)}/** @license
*
* jsPDF - PDF Document creation from JavaScript
* Version 2.5.1 Built on 2022-01-28T15:37:57.791Z
*                      CommitID 00000000
*
* Copyright (c) 2010-2021 James Hall <james@parall.ax>, https://github.com/MrRio/jsPDF
*               2015-2021 yWorks GmbH, http://www.yworks.com
*               2015-2021 Lukas Hollnder <lukas.hollaender@yworks.com>, https://github.com/HackbrettXXX
*               2016-2018 Aras Abbasi <aras.abbasi@gmail.com>
*               2010 Aaron Spike, https://github.com/acspike
*               2012 Willow Systems Corporation, https://github.com/willowsystems
*               2012 Pablo Hess, https://github.com/pablohess
*               2012 Florian Jenett, https://github.com/fjenett
*               2013 Warren Weckesser, https://github.com/warrenweckesser
*               2013 Youssef Beddad, https://github.com/lifof
*               2013 Lee Driscoll, https://github.com/lsdriscoll
*               2013 Stefan Slonevskiy, https://github.com/stefslon
*               2013 Jeremy Morel, https://github.com/jmorel
*               2013 Christoph Hartmann, https://github.com/chris-rock
*               2014 Juan Pablo Gaviria, https://github.com/juanpgaviria
*               2014 James Makes, https://github.com/dollaruw
*               2014 Diego Casorran, https://github.com/diegocr
*               2014 Steven Spungin, https://github.com/Flamenco
*               2014 Kenneth Glassey, https://github.com/Gavvers
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*
* Contributor(s):
*    siefkenj, ahwolf, rickygu, Midnith, saintclair, eaparango,
*    kim3er, mfo, alnorth, Flamenco
*/var Hi=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function $C(){Hi.console&&typeof Hi.console.log=="function"&&Hi.console.log.apply(Hi.console,arguments)}var Ps={log:$C,warn:function(r){Hi.console&&(typeof Hi.console.warn=="function"?Hi.console.warn.apply(Hi.console,arguments):$C.call(null,arguments))},error:function(r){Hi.console&&(typeof Hi.console.error=="function"?Hi.console.error.apply(Hi.console,arguments):$C(r))}};function KC(r,e,t){var i=new XMLHttpRequest;i.open("GET",r),i.responseType="blob",i.onload=function(){Of(i.response,e,t)},i.onerror=function(){Ps.error("could not download file")},i.send()}function aD(r){var e=new XMLHttpRequest;e.open("HEAD",r,!1);try{e.send()}catch{}return e.status>=200&&e.status<=299}function fv(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(e)}}var Yy,WC,Of=Hi.saveAs||((typeof window>"u"?"undefined":ts(window))!=="object"||window!==Hi?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(r,e,t){var i=Hi.URL||Hi.webkitURL,n=document.createElement("a");e=e||r.name||"download",n.download=e,n.rel="noopener",typeof r=="string"?(n.href=r,n.origin!==location.origin?aD(n.href)?KC(r,e,t):fv(n,n.target="_blank"):fv(n)):(n.href=i.createObjectURL(r),setTimeout(function(){i.revokeObjectURL(n.href)},4e4),setTimeout(function(){fv(n)},0))}:"msSaveOrOpenBlob"in navigator?function(r,e,t){if(e=e||r.name||"download",typeof r=="string")if(aD(r))KC(r,e,t);else{var i=document.createElement("a");i.href=r,i.target="_blank",setTimeout(function(){fv(i)})}else navigator.msSaveOrOpenBlob(function(n,o){return o===void 0?o={autoBom:!1}:ts(o)!=="object"&&(Ps.warn("Deprecated: Expected third argument to be a object"),o={autoBom:!o}),o.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}(r,t),e)}:function(r,e,t,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),typeof r=="string")return KC(r,e,t);var n=r.type==="application/octet-stream",o=/constructor/i.test(Hi.HTMLElement)||Hi.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent);if((a||n&&o)&&(typeof FileReader>"u"?"undefined":ts(FileReader))==="object"){var s=new FileReader;s.onloadend=function(){var T=s.result;T=a?T:T.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=T:location=T,i=null},s.readAsDataURL(r)}else{var g=Hi.URL||Hi.webkitURL,y=g.createObjectURL(r);i?i.location=y:location.href=y,i=null,setTimeout(function(){g.revokeObjectURL(y)},4e4)}});/**
* A class to parse color values
* @author Stoyan Stefanov <sstoo@gmail.com>
* {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
* @license Use it if you like it
*/function lD(r){var e;r=r||"",this.ok=!1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[r=(r=r.replace(/ /g,"")).toLowerCase()]||r;for(var t=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(s){return[parseInt(s[1]),parseInt(s[2]),parseInt(s[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(s){return[parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(s){return[parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16),parseInt(s[3]+s[3],16)]}}],i=0;i<t.length;i++){var n=t[i].re,o=t[i].process,a=n.exec(r);a&&(e=o(a),this.r=e[0],this.g=e[1],this.b=e[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var s=this.r.toString(16),g=this.g.toString(16),y=this.b.toString(16);return s.length==1&&(s="0"+s),g.length==1&&(g="0"+g),y.length==1&&(y="0"+y),"#"+s+g+y}}/**
* @license
* Joseph Myers does not specify a particular license for his work.
*
* Author: Joseph Myers
* Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
*
* Modified by: Owen Leong
*/function XC(r,e){var t=r[0],i=r[1],n=r[2],o=r[3];t=Rl(t,i,n,o,e[0],7,-680876936),o=Rl(o,t,i,n,e[1],12,-389564586),n=Rl(n,o,t,i,e[2],17,606105819),i=Rl(i,n,o,t,e[3],22,-1044525330),t=Rl(t,i,n,o,e[4],7,-176418897),o=Rl(o,t,i,n,e[5],12,1200080426),n=Rl(n,o,t,i,e[6],17,-1473231341),i=Rl(i,n,o,t,e[7],22,-45705983),t=Rl(t,i,n,o,e[8],7,1770035416),o=Rl(o,t,i,n,e[9],12,-1958414417),n=Rl(n,o,t,i,e[10],17,-42063),i=Rl(i,n,o,t,e[11],22,-1990404162),t=Rl(t,i,n,o,e[12],7,1804603682),o=Rl(o,t,i,n,e[13],12,-40341101),n=Rl(n,o,t,i,e[14],17,-1502002290),t=kl(t,i=Rl(i,n,o,t,e[15],22,1236535329),n,o,e[1],5,-165796510),o=kl(o,t,i,n,e[6],9,-1069501632),n=kl(n,o,t,i,e[11],14,643717713),i=kl(i,n,o,t,e[0],20,-373897302),t=kl(t,i,n,o,e[5],5,-701558691),o=kl(o,t,i,n,e[10],9,38016083),n=kl(n,o,t,i,e[15],14,-660478335),i=kl(i,n,o,t,e[4],20,-405537848),t=kl(t,i,n,o,e[9],5,568446438),o=kl(o,t,i,n,e[14],9,-1019803690),n=kl(n,o,t,i,e[3],14,-187363961),i=kl(i,n,o,t,e[8],20,1163531501),t=kl(t,i,n,o,e[13],5,-1444681467),o=kl(o,t,i,n,e[2],9,-51403784),n=kl(n,o,t,i,e[7],14,1735328473),t=Ol(t,i=kl(i,n,o,t,e[12],20,-1926607734),n,o,e[5],4,-378558),o=Ol(o,t,i,n,e[8],11,-2022574463),n=Ol(n,o,t,i,e[11],16,1839030562),i=Ol(i,n,o,t,e[14],23,-35309556),t=Ol(t,i,n,o,e[1],4,-1530992060),o=Ol(o,t,i,n,e[4],11,1272893353),n=Ol(n,o,t,i,e[7],16,-155497632),i=Ol(i,n,o,t,e[10],23,-1094730640),t=Ol(t,i,n,o,e[13],4,681279174),o=Ol(o,t,i,n,e[0],11,-358537222),n=Ol(n,o,t,i,e[3],16,-722521979),i=Ol(i,n,o,t,e[6],23,76029189),t=Ol(t,i,n,o,e[9],4,-640364487),o=Ol(o,t,i,n,e[12],11,-421815835),n=Ol(n,o,t,i,e[15],16,530742520),t=Ul(t,i=Ol(i,n,o,t,e[2],23,-995338651),n,o,e[0],6,-198630844),o=Ul(o,t,i,n,e[7],10,1126891415),n=Ul(n,o,t,i,e[14],15,-1416354905),i=Ul(i,n,o,t,e[5],21,-57434055),t=Ul(t,i,n,o,e[12],6,1700485571),o=Ul(o,t,i,n,e[3],10,-1894986606),n=Ul(n,o,t,i,e[10],15,-1051523),i=Ul(i,n,o,t,e[1],21,-2054922799),t=Ul(t,i,n,o,e[8],6,1873313359),o=Ul(o,t,i,n,e[15],10,-30611744),n=Ul(n,o,t,i,e[6],15,-1560198380),i=Ul(i,n,o,t,e[13],21,1309151649),t=Ul(t,i,n,o,e[4],6,-145523070),o=Ul(o,t,i,n,e[11],10,-1120210379),n=Ul(n,o,t,i,e[2],15,718787259),i=Ul(i,n,o,t,e[9],21,-343485551),r[0]=Cd(t,r[0]),r[1]=Cd(i,r[1]),r[2]=Cd(n,r[2]),r[3]=Cd(o,r[3])}function pv(r,e,t,i,n,o){return e=Cd(Cd(e,r),Cd(i,o)),Cd(e<<n|e>>>32-n,t)}function Rl(r,e,t,i,n,o,a){return pv(e&t|~e&i,r,e,n,o,a)}function kl(r,e,t,i,n,o,a){return pv(e&i|t&~i,r,e,n,o,a)}function Ol(r,e,t,i,n,o,a){return pv(e^t^i,r,e,n,o,a)}function Ul(r,e,t,i,n,o,a){return pv(t^(e|~i),r,e,n,o,a)}function cD(r){var e,t=r.length,i=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=r.length;e+=64)XC(i,cne(r.substring(e-64,e)));r=r.substring(e-64);var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<r.length;e++)n[e>>2]|=r.charCodeAt(e)<<(e%4<<3);if(n[e>>2]|=128<<(e%4<<3),e>55)for(XC(i,n),e=0;e<16;e++)n[e]=0;return n[14]=8*t,XC(i,n),i}function cne(r){var e,t=[];for(e=0;e<64;e+=4)t[e>>2]=r.charCodeAt(e)+(r.charCodeAt(e+1)<<8)+(r.charCodeAt(e+2)<<16)+(r.charCodeAt(e+3)<<24);return t}Yy=Hi.atob.bind(Hi),WC=Hi.btoa.bind(Hi);var uD="0123456789abcdef".split("");function une(r){for(var e="",t=0;t<4;t++)e+=uD[r>>8*t+4&15]+uD[r>>8*t&15];return e}function hne(r){return String.fromCharCode((255&r)>>0,(65280&r)>>8,(16711680&r)>>16,(4278190080&r)>>24)}function ZC(r){return cD(r).map(hne).join("")}var Ane=function(r){for(var e=0;e<r.length;e++)r[e]=une(r[e]);return r.join("")}(cD("hello"))!="5d41402abc4b2a76b9719d911017c592";function Cd(r,e){if(Ane){var t=(65535&r)+(65535&e);return(r>>16)+(e>>16)+(t>>16)<<16|65535&t}return r+e&4294967295}/**
* @license
* FPDF is released under a permissive license: there is no usage restriction.
* You may embed it freely in your application (commercial or not), with or
* without modifications.
*
* Reference: http://www.fpdf.org/en/script/script37.php
*/function JC(r,e){var t,i,n,o;if(r!==t){for(var a=(n=r,o=1+(256/r.length>>0),new Array(o+1).join(n)),s=[],g=0;g<256;g++)s[g]=g;var y=0;for(g=0;g<256;g++){var T=s[g];y=(y+T+a.charCodeAt(g))%256,s[g]=s[y],s[y]=T}t=r,i=s}else s=i;var I=e.length,R=0,U=0,Z="";for(g=0;g<I;g++)U=(U+(T=s[R=(R+1)%256]))%256,s[R]=s[U],s[U]=T,a=s[(s[R]+s[U])%256],Z+=String.fromCharCode(e.charCodeAt(g)^a);return Z}/**
* @license
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
* Author: Owen Leong (@owenl131)
* Date: 15 Oct 2020
* References:
* https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
* https://github.com/foliojs/pdfkit/blob/master/lib/security.js
* http://www.fpdf.org/en/script/script37.php
*/var hD={print:4,modify:8,copy:16,"annot-forms":32};function Pg(r,e,t,i){this.v=1,this.r=2;var n=192;r.forEach(function(s){if(hD.perm!==void 0)throw new Error("Invalid permission: "+s);n+=hD[s]}),this.padding="(N^NuAd\0NV\b..\0h>/\fdSiz";var o=(e+this.padding).substr(0,32),a=(t+this.padding).substr(0,32);this.O=this.processOwnerPassword(o,a),this.P=-(1+(255^n)),this.encryptionKey=ZC(o+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(i)).substr(0,5),this.U=JC(this.encryptionKey,this.padding)}function Fg(r){if(/[^\u0000-\u00ff]/.test(r))throw new Error("Invalid PDF Name Object: "+r+", Only accept ASCII characters.");for(var e="",t=r.length,i=0;i<t;i++){var n=r.charCodeAt(i);n<33||n===35||n===37||n===40||n===41||n===47||n===60||n===62||n===91||n===93||n===123||n===125||n>126?e+="#"+("0"+n.toString(16)).slice(-2):e+=r[i]}return e}function AD(r){if(ts(r)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var e={};this.subscribe=function(t,i,n){if(n=n||!1,typeof t!="string"||typeof i!="function"||typeof n!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");e.hasOwnProperty(t)||(e[t]={});var o=Math.random().toString(35);return e[t][o]=[i,!!n],o},this.unsubscribe=function(t){for(var i in e)if(e[i][t])return delete e[i][t],Object.keys(e[i]).length===0&&delete e[i],!0;return!1},this.publish=function(t){if(e.hasOwnProperty(t)){var i=Array.prototype.slice.call(arguments,1),n=[];for(var o in e[t]){var a=e[t][o];try{a[0].apply(r,i)}catch(s){Hi.console&&Ps.error("jsPDF PubSub Error",s.message,s)}a[1]&&n.push(o)}n.length&&n.forEach(this.unsubscribe)}},this.getTopics=function(){return e}}function gv(r){if(!(this instanceof gv))return new gv(r);var e="opacity,stroke-opacity".split(",");for(var t in r)r.hasOwnProperty(t)&&e.indexOf(t)>=0&&(this[t]=r[t]);this.id="",this.objectNumber=-1}function dD(r,e){this.gState=r,this.matrix=e,this.id="",this.objectNumber=-1}function Uf(r,e,t,i,n){if(!(this instanceof Uf))return new Uf(r,e,t,i,n);this.type=r==="axial"?2:3,this.coords=e,this.colors=t,dD.call(this,i,n)}function Dg(r,e,t,i,n){if(!(this instanceof Dg))return new Dg(r,e,t,i,n);this.boundingBox=r,this.xStep=e,this.yStep=t,this.stream="",this.cloneIndex=0,dD.call(this,i,n)}function Gi(r){var e,t=typeof arguments[0]=="string"?arguments[0]:"p",i=arguments[1],n=arguments[2],o=arguments[3],a=[],s=1,g=16,y="S",T=null;ts(r=r||{})==="object"&&(t=r.orientation,i=r.unit||i,n=r.format||n,o=r.compress||r.compressPdf||o,(T=r.encryption||null)!==null&&(T.userPassword=T.userPassword||"",T.ownerPassword=T.ownerPassword||"",T.userPermissions=T.userPermissions||[]),s=typeof r.userUnit=="number"?Math.abs(r.userUnit):1,r.precision!==void 0&&(e=r.precision),r.floatPrecision!==void 0&&(g=r.floatPrecision),y=r.defaultPathOperation||"S"),a=r.filters||(o===!0?["FlateEncode"]:a),i=i||"mm",t=(""+(t||"P")).toLowerCase();var I=r.putOnlyUsedFonts||!1,R={},U={internal:{},__private__:{}};U.__private__.PubSub=AD;var Z="1.3",Y=U.__private__.getPdfVersion=function(){return Z};U.__private__.setPdfVersion=function(ne){Z=ne};var he={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};U.__private__.getPageFormats=function(){return he};var ce=U.__private__.getPageFormat=function(ne){return he[ne]};n=n||"a4";var pe={COMPAT:"compat",ADVANCED:"advanced"},be=pe.COMPAT;function Te(){this.saveGraphicsState(),lt(new we(Ar,0,0,-Ar,0,uo()*Ar).toString()+" cm"),this.setFontSize(this.getFontSize()/Ar),y="n",be=pe.ADVANCED}function qe(){this.restoreGraphicsState(),y="S",be=pe.COMPAT}var je=U.__private__.combineFontStyleAndFontWeight=function(ne,Pe){if(ne=="bold"&&Pe=="normal"||ne=="bold"&&Pe==400||ne=="normal"&&Pe=="italic"||ne=="bold"&&Pe=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Pe&&(ne=Pe==400||Pe==="normal"?ne==="italic"?"italic":"normal":Pe!=700&&Pe!=="bold"||ne!=="normal"?(Pe==700?"bold":Pe)+""+ne:"bold"),ne};U.advancedAPI=function(ne){var Pe=be===pe.COMPAT;return Pe&&Te.call(this),typeof ne!="function"||(ne(this),Pe&&qe.call(this)),this},U.compatAPI=function(ne){var Pe=be===pe.ADVANCED;return Pe&&qe.call(this),typeof ne!="function"||(ne(this),Pe&&Te.call(this)),this},U.isAdvancedAPI=function(){return be===pe.ADVANCED};var We,Ne=function(ne){if(be!==pe.ADVANCED)throw new Error(ne+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},at=U.roundToPrecision=U.__private__.roundToPrecision=function(ne,Pe){var ct=e||Pe;if(isNaN(ne)||isNaN(ct))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return ne.toFixed(ct).replace(/0+$/,"")};We=U.hpf=U.__private__.hpf=typeof g=="number"?function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.hpf");return at(ne,g)}:g==="smart"?function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.hpf");return at(ne,ne>-1&&ne<1?16:5)}:function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.hpf");return at(ne,16)};var nt=U.f2=U.__private__.f2=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.f2");return at(ne,2)},ke=U.__private__.f3=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.f3");return at(ne,3)},De=U.scale=U.__private__.scale=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.scale");return be===pe.COMPAT?ne*Ar:be===pe.ADVANCED?ne:void 0},Ye=function(ne){return be===pe.COMPAT?uo()-ne:be===pe.ADVANCED?ne:void 0},Xe=function(ne){return De(Ye(ne))};U.__private__.setPrecision=U.setPrecision=function(ne){typeof parseInt(ne,10)=="number"&&(e=parseInt(ne,10))};var Ct,Et="00000000000000000000000000000000",Pt=U.__private__.getFileId=function(){return Et},bt=U.__private__.setFileId=function(ne){return Et=ne!==void 0&&/^[a-fA-F0-9]{32}$/.test(ne)?ne.toUpperCase():Et.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),T!==null&&(_n=new Pg(T.userPermissions,T.userPassword,T.ownerPassword,Et)),Et};U.setFileId=function(ne){return bt(ne),this},U.getFileId=function(){return Pt()};var Rt=U.__private__.convertDateToPDFDate=function(ne){var Pe=ne.getTimezoneOffset(),ct=Pe<0?"+":"-",_t=Math.floor(Math.abs(Pe/60)),xt=Math.abs(Pe%60),Lt=[ct,rt(_t),"'",rt(xt),"'"].join("");return["D:",ne.getFullYear(),rt(ne.getMonth()+1),rt(ne.getDate()),rt(ne.getHours()),rt(ne.getMinutes()),rt(ne.getSeconds()),Lt].join("")},Ft=U.__private__.convertPDFDateToDate=function(ne){var Pe=parseInt(ne.substr(2,4),10),ct=parseInt(ne.substr(6,2),10)-1,_t=parseInt(ne.substr(8,2),10),xt=parseInt(ne.substr(10,2),10),Lt=parseInt(ne.substr(12,2),10),gr=parseInt(ne.substr(14,2),10);return new Date(Pe,ct,_t,xt,Lt,gr,0)},Zt=U.__private__.setCreationDate=function(ne){var Pe;if(ne===void 0&&(ne=new Date),ne instanceof Date)Pe=Rt(ne);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(ne))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Pe=ne}return Ct=Pe},Le=U.__private__.getCreationDate=function(ne){var Pe=Ct;return ne==="jsDate"&&(Pe=Ft(Ct)),Pe};U.setCreationDate=function(ne){return Zt(ne),this},U.getCreationDate=function(ne){return Le(ne)};var Ze,rt=U.__private__.padd2=function(ne){return("0"+parseInt(ne)).slice(-2)},pt=U.__private__.padd2Hex=function(ne){return("00"+(ne=ne.toString())).substr(ne.length)},mt=0,Bt=[],Dt=[],Mt=0,qt=[],nr=[],vr=!1,br=Dt,Fr=function(){mt=0,Mt=0,Dt=[],Bt=[],qt=[],rr=vt(),Gt=vt()};U.__private__.setCustomOutputDestination=function(ne){vr=!0,br=ne};var kt=function(ne){vr||(br=ne)};U.__private__.resetCustomOutputDestination=function(){vr=!1,br=Dt};var lt=U.__private__.out=function(ne){return ne=ne.toString(),Mt+=ne.length+1,br.push(ne),br},wt=U.__private__.write=function(ne){return lt(arguments.length===1?ne.toString():Array.prototype.join.call(arguments," "))},Ur=U.__private__.getArrayBuffer=function(ne){for(var Pe=ne.length,ct=new ArrayBuffer(Pe),_t=new Uint8Array(ct);Pe--;)_t[Pe]=ne.charCodeAt(Pe);return ct},tr=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];U.__private__.getStandardFonts=function(){return tr};var ht=r.fontSize||16;U.__private__.setFontSize=U.setFontSize=function(ne){return ht=be===pe.ADVANCED?ne/Ar:ne,this};var $t,or=U.__private__.getFontSize=U.getFontSize=function(){return be===pe.COMPAT?ht:ht*Ar},mr=r.R2L||!1;U.__private__.setR2L=U.setR2L=function(ne){return mr=ne,this},U.__private__.getR2L=U.getR2L=function(){return mr};var ur,Wr=U.__private__.setZoomMode=function(ne){var Pe=[void 0,null,"fullwidth","fullheight","fullpage","original"];if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(ne))$t=ne;else if(isNaN(ne)){if(Pe.indexOf(ne)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+ne+'" is not recognized.');$t=ne}else $t=parseInt(ne,10)};U.__private__.getZoomMode=function(){return $t};var ri,gi=U.__private__.setPageMode=function(ne){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(ne)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+ne+'" is not recognized.');ur=ne};U.__private__.getPageMode=function(){return ur};var Pi=U.__private__.setLayoutMode=function(ne){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(ne)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+ne+'" is not recognized.');ri=ne};U.__private__.getLayoutMode=function(){return ri},U.__private__.setDisplayMode=U.setDisplayMode=function(ne,Pe,ct){return Wr(ne),Pi(Pe),gi(ct),this};var zt={title:"",subject:"",author:"",keywords:"",creator:""};U.__private__.getDocumentProperty=function(ne){if(Object.keys(zt).indexOf(ne)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return zt[ne]},U.__private__.getDocumentProperties=function(){return zt},U.__private__.setDocumentProperties=U.setProperties=U.setDocumentProperties=function(ne){for(var Pe in zt)zt.hasOwnProperty(Pe)&&ne[Pe]&&(zt[Pe]=ne[Pe]);return this},U.__private__.setDocumentProperty=function(ne,Pe){if(Object.keys(zt).indexOf(ne)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return zt[ne]=Pe};var Xr,Ar,Wt,di,Qt,Tr={},Lr={},Xt=[],xr={},er={},vi={},Zi={},Qe=null,Be=0,ue=[],re=new AD(U),Ae=r.hotfixes||[],ge={},xe={},Ee=[],we=function ne(Pe,ct,_t,xt,Lt,gr){if(!(this instanceof ne))return new ne(Pe,ct,_t,xt,Lt,gr);isNaN(Pe)&&(Pe=1),isNaN(ct)&&(ct=0),isNaN(_t)&&(_t=0),isNaN(xt)&&(xt=1),isNaN(Lt)&&(Lt=0),isNaN(gr)&&(gr=0),this._matrix=[Pe,ct,_t,xt,Lt,gr]};Object.defineProperty(we.prototype,"sx",{get:function(){return this._matrix[0]},set:function(ne){this._matrix[0]=ne}}),Object.defineProperty(we.prototype,"shy",{get:function(){return this._matrix[1]},set:function(ne){this._matrix[1]=ne}}),Object.defineProperty(we.prototype,"shx",{get:function(){return this._matrix[2]},set:function(ne){this._matrix[2]=ne}}),Object.defineProperty(we.prototype,"sy",{get:function(){return this._matrix[3]},set:function(ne){this._matrix[3]=ne}}),Object.defineProperty(we.prototype,"tx",{get:function(){return this._matrix[4]},set:function(ne){this._matrix[4]=ne}}),Object.defineProperty(we.prototype,"ty",{get:function(){return this._matrix[5]},set:function(ne){this._matrix[5]=ne}}),Object.defineProperty(we.prototype,"a",{get:function(){return this._matrix[0]},set:function(ne){this._matrix[0]=ne}}),Object.defineProperty(we.prototype,"b",{get:function(){return this._matrix[1]},set:function(ne){this._matrix[1]=ne}}),Object.defineProperty(we.prototype,"c",{get:function(){return this._matrix[2]},set:function(ne){this._matrix[2]=ne}}),Object.defineProperty(we.prototype,"d",{get:function(){return this._matrix[3]},set:function(ne){this._matrix[3]=ne}}),Object.defineProperty(we.prototype,"e",{get:function(){return this._matrix[4]},set:function(ne){this._matrix[4]=ne}}),Object.defineProperty(we.prototype,"f",{get:function(){return this._matrix[5]},set:function(ne){this._matrix[5]=ne}}),Object.defineProperty(we.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(we.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(we.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(we.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),we.prototype.join=function(ne){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(We).join(ne)},we.prototype.multiply=function(ne){var Pe=ne.sx*this.sx+ne.shy*this.shx,ct=ne.sx*this.shy+ne.shy*this.sy,_t=ne.shx*this.sx+ne.sy*this.shx,xt=ne.shx*this.shy+ne.sy*this.sy,Lt=ne.tx*this.sx+ne.ty*this.shx+this.tx,gr=ne.tx*this.shy+ne.ty*this.sy+this.ty;return new we(Pe,ct,_t,xt,Lt,gr)},we.prototype.decompose=function(){var ne=this.sx,Pe=this.shy,ct=this.shx,_t=this.sy,xt=this.tx,Lt=this.ty,gr=Math.sqrt(ne*ne+Pe*Pe),sr=(ne/=gr)*ct+(Pe/=gr)*_t;ct-=ne*sr,_t-=Pe*sr;var si=Math.sqrt(ct*ct+_t*_t);return sr/=si,ne*(_t/=si)<Pe*(ct/=si)&&(ne=-ne,Pe=-Pe,sr=-sr,gr=-gr),{scale:new we(gr,0,0,si,0,0),translate:new we(1,0,0,1,xt,Lt),rotate:new we(ne,Pe,-Pe,ne,0,0),skew:new we(1,0,sr,1,0,0)}},we.prototype.toString=function(ne){return this.join(" ")},we.prototype.inversed=function(){var ne=this.sx,Pe=this.shy,ct=this.shx,_t=this.sy,xt=this.tx,Lt=this.ty,gr=1/(ne*_t-Pe*ct),sr=_t*gr,si=-Pe*gr,$r=-ct*gr,ei=ne*gr;return new we(sr,si,$r,ei,-sr*xt-$r*Lt,-si*xt-ei*Lt)},we.prototype.applyToPoint=function(ne){var Pe=ne.x*this.sx+ne.y*this.shx+this.tx,ct=ne.x*this.shy+ne.y*this.sy+this.ty;return new $l(Pe,ct)},we.prototype.applyToRectangle=function(ne){var Pe=this.applyToPoint(ne),ct=this.applyToPoint(new $l(ne.x+ne.w,ne.y+ne.h));return new rl(Pe.x,Pe.y,ct.x-Pe.x,ct.y-Pe.y)},we.prototype.clone=function(){var ne=this.sx,Pe=this.shy,ct=this.shx,_t=this.sy,xt=this.tx,Lt=this.ty;return new we(ne,Pe,ct,_t,xt,Lt)},U.Matrix=we;var Fe=U.matrixMult=function(ne,Pe){return Pe.multiply(ne)},ze=new we(1,0,0,1,0,0);U.unitMatrix=U.identityMatrix=ze;var Ge=function(ne,Pe){if(!er[ne]){var ct=(Pe instanceof Uf?"Sh":"P")+(Object.keys(xr).length+1).toString(10);Pe.id=ct,er[ne]=ct,xr[ct]=Pe,re.publish("addPattern",Pe)}};U.ShadingPattern=Uf,U.TilingPattern=Dg,U.addShadingPattern=function(ne,Pe){return Ne("addShadingPattern()"),Ge(ne,Pe),this},U.beginTilingPattern=function(ne){Ne("beginTilingPattern()"),Kl(ne.boundingBox[0],ne.boundingBox[1],ne.boundingBox[2]-ne.boundingBox[0],ne.boundingBox[3]-ne.boundingBox[1],ne.matrix)},U.endTilingPattern=function(ne,Pe){Ne("endTilingPattern()"),Pe.stream=nr[Ze].join(`
`),Ge(ne,Pe),re.publish("endTilingPattern",Pe),Ee.pop().restore()};var st=U.__private__.newObject=function(){var ne=vt();return Tt(ne,!0),ne},vt=U.__private__.newObjectDeferred=function(){return mt++,Bt[mt]=function(){return Mt},mt},Tt=function(ne,Pe){return Pe=typeof Pe=="boolean"&&Pe,Bt[ne]=Mt,Pe&&lt(ne+" 0 obj"),ne},Kt=U.__private__.newAdditionalObject=function(){var ne={objId:vt(),content:""};return qt.push(ne),ne},rr=vt(),Gt=vt(),dr=U.__private__.decodeColorString=function(ne){var Pe=ne.split(" ");if(Pe.length!==2||Pe[1]!=="g"&&Pe[1]!=="G")Pe.length===5&&(Pe[4]==="k"||Pe[4]==="K")&&(Pe=[(1-Pe[0])*(1-Pe[3]),(1-Pe[1])*(1-Pe[3]),(1-Pe[2])*(1-Pe[3]),"r"]);else{var ct=parseFloat(Pe[0]);Pe=[ct,ct,ct,"r"]}for(var _t="#",xt=0;xt<3;xt++)_t+=("0"+Math.floor(255*parseFloat(Pe[xt])).toString(16)).slice(-2);return _t},Cr=U.__private__.encodeColorString=function(ne){var Pe;typeof ne=="string"&&(ne={ch1:ne});var ct=ne.ch1,_t=ne.ch2,xt=ne.ch3,Lt=ne.ch4,gr=ne.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof ct=="string"&&ct.charAt(0)!=="#"){var sr=new lD(ct);if(sr.ok)ct=sr.toHex();else if(!/^\d*\.?\d*$/.test(ct))throw new Error('Invalid color "'+ct+'" passed to jsPDF.encodeColorString.')}if(typeof ct=="string"&&/^#[0-9A-Fa-f]{3}$/.test(ct)&&(ct="#"+ct[1]+ct[1]+ct[2]+ct[2]+ct[3]+ct[3]),typeof ct=="string"&&/^#[0-9A-Fa-f]{6}$/.test(ct)){var si=parseInt(ct.substr(1),16);ct=si>>16&255,_t=si>>8&255,xt=255&si}if(_t===void 0||Lt===void 0&&ct===_t&&_t===xt)if(typeof ct=="string")Pe=ct+" "+gr[0];else switch(ne.precision){case 2:Pe=nt(ct/255)+" "+gr[0];break;case 3:default:Pe=ke(ct/255)+" "+gr[0]}else if(Lt===void 0||ts(Lt)==="object"){if(Lt&&!isNaN(Lt.a)&&Lt.a===0)return Pe=["1.","1.","1.",gr[1]].join(" ");if(typeof ct=="string")Pe=[ct,_t,xt,gr[1]].join(" ");else switch(ne.precision){case 2:Pe=[nt(ct/255),nt(_t/255),nt(xt/255),gr[1]].join(" ");break;default:case 3:Pe=[ke(ct/255),ke(_t/255),ke(xt/255),gr[1]].join(" ")}}else if(typeof ct=="string")Pe=[ct,_t,xt,Lt,gr[2]].join(" ");else switch(ne.precision){case 2:Pe=[nt(ct),nt(_t),nt(xt),nt(Lt),gr[2]].join(" ");break;case 3:default:Pe=[ke(ct),ke(_t),ke(xt),ke(Lt),gr[2]].join(" ")}return Pe},Gr=U.__private__.getFilters=function(){return a},Er=U.__private__.putStream=function(ne){var Pe=(ne=ne||{}).data||"",ct=ne.filters||Gr(),_t=ne.alreadyAppliedFilters||[],xt=ne.addLength1||!1,Lt=Pe.length,gr=ne.objectId,sr=function(Di){return Di};if(T!==null&&gr===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");T!==null&&(sr=_n.encryptor(gr,0));var si={};ct===!0&&(ct=["FlateEncode"]);var $r=ne.additionalKeyValues||[],ei=(si=Gi.API.processDataByFilters!==void 0?Gi.API.processDataByFilters(Pe,ct):{data:Pe,reverseChain:[]}).reverseChain+(Array.isArray(_t)?_t.join(" "):_t.toString());if(si.data.length!==0&&($r.push({key:"Length",value:si.data.length}),xt===!0&&$r.push({key:"Length1",value:Lt})),ei.length!=0)if(ei.split("/").length-1==1)$r.push({key:"Filter",value:ei});else{$r.push({key:"Filter",value:"["+ei+"]"});for(var ui=0;ui<$r.length;ui+=1)if($r[ui].key==="DecodeParms"){for(var $n=[],ai=0;ai<si.reverseChain.split("/").length-1;ai+=1)$n.push("null");$n.push($r[ui].value),$r[ui].value="["+$n.join(" ")+"]"}}lt("<<");for(var Pn=0;Pn<$r.length;Pn++)lt("/"+$r[Pn].key+" "+$r[Pn].value);lt(">>"),si.data.length!==0&&(lt("stream"),lt(sr(si.data)),lt("endstream"))},zr=U.__private__.putPage=function(ne){var Pe=ne.number,ct=ne.data,_t=ne.objId,xt=ne.contentsObjId;Tt(_t,!0),lt("<</Type /Page"),lt("/Parent "+ne.rootDictionaryObjId+" 0 R"),lt("/Resources "+ne.resourceDictionaryObjId+" 0 R"),lt("/MediaBox ["+parseFloat(We(ne.mediaBox.bottomLeftX))+" "+parseFloat(We(ne.mediaBox.bottomLeftY))+" "+We(ne.mediaBox.topRightX)+" "+We(ne.mediaBox.topRightY)+"]"),ne.cropBox!==null&&lt("/CropBox ["+We(ne.cropBox.bottomLeftX)+" "+We(ne.cropBox.bottomLeftY)+" "+We(ne.cropBox.topRightX)+" "+We(ne.cropBox.topRightY)+"]"),ne.bleedBox!==null&&lt("/BleedBox ["+We(ne.bleedBox.bottomLeftX)+" "+We(ne.bleedBox.bottomLeftY)+" "+We(ne.bleedBox.topRightX)+" "+We(ne.bleedBox.topRightY)+"]"),ne.trimBox!==null&&lt("/TrimBox ["+We(ne.trimBox.bottomLeftX)+" "+We(ne.trimBox.bottomLeftY)+" "+We(ne.trimBox.topRightX)+" "+We(ne.trimBox.topRightY)+"]"),ne.artBox!==null&&lt("/ArtBox ["+We(ne.artBox.bottomLeftX)+" "+We(ne.artBox.bottomLeftY)+" "+We(ne.artBox.topRightX)+" "+We(ne.artBox.topRightY)+"]"),typeof ne.userUnit=="number"&&ne.userUnit!==1&&lt("/UserUnit "+ne.userUnit),re.publish("putPage",{objId:_t,pageContext:ue[Pe],pageNumber:Pe,page:ct}),lt("/Contents "+xt+" 0 R"),lt(">>"),lt("endobj");var Lt=ct.join(`
`);return be===pe.ADVANCED&&(Lt+=`
Q`),Tt(xt,!0),Er({data:Lt,filters:Gr(),objectId:xt}),lt("endobj"),_t},ot=U.__private__.putPages=function(){var ne,Pe,ct=[];for(ne=1;ne<=Be;ne++)ue[ne].objId=vt(),ue[ne].contentsObjId=vt();for(ne=1;ne<=Be;ne++)ct.push(zr({number:ne,data:nr[ne],objId:ue[ne].objId,contentsObjId:ue[ne].contentsObjId,mediaBox:ue[ne].mediaBox,cropBox:ue[ne].cropBox,bleedBox:ue[ne].bleedBox,trimBox:ue[ne].trimBox,artBox:ue[ne].artBox,userUnit:ue[ne].userUnit,rootDictionaryObjId:rr,resourceDictionaryObjId:Gt}));Tt(rr,!0),lt("<</Type /Pages");var _t="/Kids [";for(Pe=0;Pe<Be;Pe++)_t+=ct[Pe]+" 0 R ";lt(_t+"]"),lt("/Count "+Be),lt(">>"),lt("endobj"),re.publish("postPutPages")},ir=function(ne){re.publish("putFont",{font:ne,out:lt,newObject:st,putStream:Er}),ne.isAlreadyPutted!==!0&&(ne.objectNumber=st(),lt("<<"),lt("/Type /Font"),lt("/BaseFont /"+Fg(ne.postScriptName)),lt("/Subtype /Type1"),typeof ne.encoding=="string"&&lt("/Encoding /"+ne.encoding),lt("/FirstChar 32"),lt("/LastChar 255"),lt(">>"),lt("endobj"))},Vt=function(){for(var ne in Tr)Tr.hasOwnProperty(ne)&&(I===!1||I===!0&&R.hasOwnProperty(ne))&&ir(Tr[ne])},Hr=function(ne){ne.objectNumber=st();var Pe=[];Pe.push({key:"Type",value:"/XObject"}),Pe.push({key:"Subtype",value:"/Form"}),Pe.push({key:"BBox",value:"["+[We(ne.x),We(ne.y),We(ne.x+ne.width),We(ne.y+ne.height)].join(" ")+"]"}),Pe.push({key:"Matrix",value:"["+ne.matrix.toString()+"]"});var ct=ne.pages[1].join(`
`);Er({data:ct,additionalKeyValues:Pe,objectId:ne.objectNumber}),lt("endobj")},ci=function(){for(var ne in ge)ge.hasOwnProperty(ne)&&Hr(ge[ne])},un=function(ne,Pe){var ct,_t=[],xt=1/(Pe-1);for(ct=0;ct<1;ct+=xt)_t.push(ct);if(_t.push(1),ne[0].offset!=0){var Lt={offset:0,color:ne[0].color};ne.unshift(Lt)}if(ne[ne.length-1].offset!=1){var gr={offset:1,color:ne[ne.length-1].color};ne.push(gr)}for(var sr="",si=0,$r=0;$r<_t.length;$r++){for(ct=_t[$r];ct>ne[si+1].offset;)si++;var ei=ne[si].offset,ui=(ct-ei)/(ne[si+1].offset-ei),$n=ne[si].color,ai=ne[si+1].color;sr+=pt(Math.round((1-ui)*$n[0]+ui*ai[0]).toString(16))+pt(Math.round((1-ui)*$n[1]+ui*ai[1]).toString(16))+pt(Math.round((1-ui)*$n[2]+ui*ai[2]).toString(16))}return sr.trim()},wn=function(ne,Pe){Pe||(Pe=21);var ct=st(),_t=un(ne.colors,Pe),xt=[];xt.push({key:"FunctionType",value:"0"}),xt.push({key:"Domain",value:"[0.0 1.0]"}),xt.push({key:"Size",value:"["+Pe+"]"}),xt.push({key:"BitsPerSample",value:"8"}),xt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),xt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Er({data:_t,additionalKeyValues:xt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:ct}),lt("endobj"),ne.objectNumber=st(),lt("<< /ShadingType "+ne.type),lt("/ColorSpace /DeviceRGB");var Lt="/Coords ["+We(parseFloat(ne.coords[0]))+" "+We(parseFloat(ne.coords[1]))+" ";ne.type===2?Lt+=We(parseFloat(ne.coords[2]))+" "+We(parseFloat(ne.coords[3])):Lt+=We(parseFloat(ne.coords[2]))+" "+We(parseFloat(ne.coords[3]))+" "+We(parseFloat(ne.coords[4]))+" "+We(parseFloat(ne.coords[5])),lt(Lt+="]"),ne.matrix&&lt("/Matrix ["+ne.matrix.toString()+"]"),lt("/Function "+ct+" 0 R"),lt("/Extend [true true]"),lt(">>"),lt("endobj")},mi=function(ne,Pe){var ct=vt(),_t=st();Pe.push({resourcesOid:ct,objectOid:_t}),ne.objectNumber=_t;var xt=[];xt.push({key:"Type",value:"/Pattern"}),xt.push({key:"PatternType",value:"1"}),xt.push({key:"PaintType",value:"1"}),xt.push({key:"TilingType",value:"1"}),xt.push({key:"BBox",value:"["+ne.boundingBox.map(We).join(" ")+"]"}),xt.push({key:"XStep",value:We(ne.xStep)}),xt.push({key:"YStep",value:We(ne.yStep)}),xt.push({key:"Resources",value:ct+" 0 R"}),ne.matrix&&xt.push({key:"Matrix",value:"["+ne.matrix.toString()+"]"}),Er({data:ne.stream,additionalKeyValues:xt,objectId:ne.objectNumber}),lt("endobj")},mn=function(ne){var Pe;for(Pe in xr)xr.hasOwnProperty(Pe)&&(xr[Pe]instanceof Uf?wn(xr[Pe]):xr[Pe]instanceof Dg&&mi(xr[Pe],ne))},yn=function(ne){for(var Pe in ne.objectNumber=st(),lt("<<"),ne)switch(Pe){case"opacity":lt("/ca "+nt(ne[Pe]));break;case"stroke-opacity":lt("/CA "+nt(ne[Pe]))}lt(">>"),lt("endobj")},fi=function(){var ne;for(ne in vi)vi.hasOwnProperty(ne)&&yn(vi[ne])},jn=function(){for(var ne in lt("/XObject <<"),ge)ge.hasOwnProperty(ne)&&ge[ne].objectNumber>=0&&lt("/"+ne+" "+ge[ne].objectNumber+" 0 R");re.publish("putXobjectDict"),lt(">>")},qs=function(){_n.oid=st(),lt("<<"),lt("/Filter /Standard"),lt("/V "+_n.v),lt("/R "+_n.r),lt("/U <"+_n.toHexString(_n.U)+">"),lt("/O <"+_n.toHexString(_n.O)+">"),lt("/P "+_n.P),lt(">>"),lt("endobj")},Ui=function(){for(var ne in lt("/Font <<"),Tr)Tr.hasOwnProperty(ne)&&(I===!1||I===!0&&R.hasOwnProperty(ne))&&lt("/"+ne+" "+Tr[ne].objectNumber+" 0 R");lt(">>")},Bn=function(){if(Object.keys(xr).length>0){for(var ne in lt("/Shading <<"),xr)xr.hasOwnProperty(ne)&&xr[ne]instanceof Uf&&xr[ne].objectNumber>=0&&lt("/"+ne+" "+xr[ne].objectNumber+" 0 R");re.publish("putShadingPatternDict"),lt(">>")}},Xa=function(ne){if(Object.keys(xr).length>0){for(var Pe in lt("/Pattern <<"),xr)xr.hasOwnProperty(Pe)&&xr[Pe]instanceof U.TilingPattern&&xr[Pe].objectNumber>=0&&xr[Pe].objectNumber<ne&&lt("/"+Pe+" "+xr[Pe].objectNumber+" 0 R");re.publish("putTilingPatternDict"),lt(">>")}},Nn=function(){if(Object.keys(vi).length>0){var ne;for(ne in lt("/ExtGState <<"),vi)vi.hasOwnProperty(ne)&&vi[ne].objectNumber>=0&&lt("/"+ne+" "+vi[ne].objectNumber+" 0 R");re.publish("putGStateDict"),lt(">>")}},Zr=function(ne){Tt(ne.resourcesOid,!0),lt("<<"),lt("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),Ui(),Bn(),Xa(ne.objectOid),Nn(),jn(),lt(">>"),lt("endobj")},co=function(){var ne=[];Vt(),fi(),ci(),mn(ne),re.publish("putResources"),ne.forEach(Zr),Zr({resourcesOid:Gt,objectOid:Number.MAX_SAFE_INTEGER}),re.publish("postPutResources")},Fs=function(){re.publish("putAdditionalObjects");for(var ne=0;ne<qt.length;ne++){var Pe=qt[ne];Tt(Pe.objId,!0),lt(Pe.content),lt("endobj")}re.publish("postPutAdditionalObjects")},bi=function(ne){Lr[ne.fontName]=Lr[ne.fontName]||{},Lr[ne.fontName][ne.fontStyle]=ne.id},Ii=function(ne,Pe,ct,_t,xt){var Lt={id:"F"+(Object.keys(Tr).length+1).toString(10),postScriptName:ne,fontName:Pe,fontStyle:ct,encoding:_t,isStandardFont:xt||!1,metadata:{}};return re.publish("addFont",{font:Lt,instance:this}),Tr[Lt.id]=Lt,bi(Lt),Lt.id},ss=function(ne){for(var Pe=0,ct=tr.length;Pe<ct;Pe++){var _t=Ii.call(this,ne[Pe][0],ne[Pe][1],ne[Pe][2],tr[Pe][3],!0);I===!1&&(R[_t]=!0);var xt=ne[Pe][0].split("-");bi({id:_t,fontName:xt[0],fontStyle:xt[1]||""})}re.publish("addFonts",{fonts:Tr,dictionary:Lr})},ji=function(ne){return ne.foo=function(){try{return ne.apply(this,arguments)}catch(_t){var Pe=_t.stack||"";~Pe.indexOf(" at ")&&(Pe=Pe.split(" at ")[1]);var ct="Error in function "+Pe.split(`
`)[0].split("<")[0]+": "+_t.message;if(!Hi.console)throw new Error(ct);Hi.console.error(ct,_t),Hi.alert&&alert(ct)}},ne.foo.bar=ne,ne.foo},Tn=function(ne,Pe){var ct,_t,xt,Lt,gr,sr,si,$r,ei;if(xt=(Pe=Pe||{}).sourceEncoding||"Unicode",gr=Pe.outputEncoding,(Pe.autoencode||gr)&&Tr[Xr].metadata&&Tr[Xr].metadata[xt]&&Tr[Xr].metadata[xt].encoding&&(Lt=Tr[Xr].metadata[xt].encoding,!gr&&Tr[Xr].encoding&&(gr=Tr[Xr].encoding),!gr&&Lt.codePages&&(gr=Lt.codePages[0]),typeof gr=="string"&&(gr=Lt[gr]),gr)){for(si=!1,sr=[],ct=0,_t=ne.length;ct<_t;ct++)($r=gr[ne.charCodeAt(ct)])?sr.push(String.fromCharCode($r)):sr.push(ne[ct]),sr[ct].charCodeAt(0)>>8&&(si=!0);ne=sr.join("")}for(ct=ne.length;si===void 0&&ct!==0;)ne.charCodeAt(ct-1)>>8&&(si=!0),ct--;if(!si)return ne;for(sr=Pe.noBOM?[]:[254,255],ct=0,_t=ne.length;ct<_t;ct++){if((ei=($r=ne.charCodeAt(ct))>>8)>>8)throw new Error("Character at position "+ct+" of string '"+ne+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");sr.push(ei),sr.push($r-(ei<<8))}return String.fromCharCode.apply(void 0,sr)},Cn=U.__private__.pdfEscape=U.pdfEscape=function(ne,Pe){return Tn(ne,Pe).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},mo=U.__private__.beginPage=function(ne){nr[++Be]=[],ue[Be]={objId:0,contentsObjId:0,userUnit:Number(s),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(ne[0]),topRightY:Number(ne[1])}},Ys(Be),kt(nr[Ze])},Mi=function(ne,Pe){var ct,_t,xt;switch(t=Pe||t,typeof ne=="string"&&(ct=ce(ne.toLowerCase()),Array.isArray(ct)&&(_t=ct[0],xt=ct[1])),Array.isArray(ne)&&(_t=ne[0]*Ar,xt=ne[1]*Ar),isNaN(_t)&&(_t=n[0],xt=n[1]),(_t>14400||xt>14400)&&(Ps.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),_t=Math.min(14400,_t),xt=Math.min(14400,xt)),n=[_t,xt],t.substr(0,1)){case"l":xt>_t&&(n=[xt,_t]);break;case"p":_t>xt&&(n=[xt,_t])}mo(n),fa(En),lt(_o),pu!==0&&lt(pu+" J"),gu!==0&&lt(gu+" j"),re.publish("addPage",{pageNumber:Be})},Za=function(ne){ne>0&&ne<=Be&&(nr.splice(ne,1),ue.splice(ne,1),Be--,Ze>Be&&(Ze=Be),this.setPage(Ze))},Ys=function(ne){ne>0&&ne<=Be&&(Ze=ne)},Ja=U.__private__.getNumberOfPages=U.getNumberOfPages=function(){return nr.length-1},He=function(ne,Pe,ct){var _t,xt=void 0;return ct=ct||{},ne=ne!==void 0?ne:Tr[Xr].fontName,Pe=Pe!==void 0?Pe:Tr[Xr].fontStyle,_t=ne.toLowerCase(),Lr[_t]!==void 0&&Lr[_t][Pe]!==void 0?xt=Lr[_t][Pe]:Lr[ne]!==void 0&&Lr[ne][Pe]!==void 0?xt=Lr[ne][Pe]:ct.disableWarning===!1&&Ps.warn("Unable to look up font label for font '"+ne+"', '"+Pe+"'. Refer to getFontList() for available fonts."),xt||ct.noFallback||(xt=Lr.times[Pe])==null&&(xt=Lr.times.normal),xt},Je=U.__private__.putInfo=function(){var ne=st(),Pe=function(_t){return _t};for(var ct in T!==null&&(Pe=_n.encryptor(ne,0)),lt("<<"),lt("/Producer ("+Cn(Pe("jsPDF "+Gi.version))+")"),zt)zt.hasOwnProperty(ct)&&zt[ct]&&lt("/"+ct.substr(0,1).toUpperCase()+ct.substr(1)+" ("+Cn(Pe(zt[ct]))+")");lt("/CreationDate ("+Cn(Pe(Ct))+")"),lt(">>"),lt("endobj")},gt=U.__private__.putCatalog=function(ne){var Pe=(ne=ne||{}).rootDictionaryObjId||rr;switch(st(),lt("<<"),lt("/Type /Catalog"),lt("/Pages "+Pe+" 0 R"),$t||($t="fullwidth"),$t){case"fullwidth":lt("/OpenAction [3 0 R /FitH null]");break;case"fullheight":lt("/OpenAction [3 0 R /FitV null]");break;case"fullpage":lt("/OpenAction [3 0 R /Fit]");break;case"original":lt("/OpenAction [3 0 R /XYZ null null 1]");break;default:var ct=""+$t;ct.substr(ct.length-1)==="%"&&($t=parseInt($t)/100),typeof $t=="number"&&lt("/OpenAction [3 0 R /XYZ null null "+nt($t)+"]")}switch(ri||(ri="continuous"),ri){case"continuous":lt("/PageLayout /OneColumn");break;case"single":lt("/PageLayout /SinglePage");break;case"two":case"twoleft":lt("/PageLayout /TwoColumnLeft");break;case"tworight":lt("/PageLayout /TwoColumnRight")}ur&&lt("/PageMode /"+ur),re.publish("putCatalog"),lt(">>"),lt("endobj")},Ot=U.__private__.putTrailer=function(){lt("trailer"),lt("<<"),lt("/Size "+(mt+1)),lt("/Root "+mt+" 0 R"),lt("/Info "+(mt-1)+" 0 R"),T!==null&&lt("/Encrypt "+_n.oid+" 0 R"),lt("/ID [ <"+Et+"> <"+Et+"> ]"),lt(">>")},fr=U.__private__.putHeader=function(){lt("%PDF-"+Z),lt("%")},qr=U.__private__.putXRef=function(){var ne="0000000000";lt("xref"),lt("0 "+(mt+1)),lt("0000000000 65535 f ");for(var Pe=1;Pe<=mt;Pe++)typeof Bt[Pe]=="function"?lt((ne+Bt[Pe]()).slice(-10)+" 00000 n "):Bt[Pe]!==void 0?lt((ne+Bt[Pe]).slice(-10)+" 00000 n "):lt("0000000000 00000 n ")},Ci=U.__private__.buildDocument=function(){Fr(),kt(Dt),re.publish("buildDocument"),fr(),ot(),Fs(),co(),T!==null&&qs(),Je(),gt();var ne=Mt;return qr(),Ot(),lt("startxref"),lt(""+ne),lt("%%EOF"),kt(nr[Ze]),Dt.join(`
`)},In=U.__private__.getBlob=function(ne){return new Blob([Ur(ne)],{type:"application/pdf"})},qn=U.output=U.__private__.output=ji(function(ne,Pe){switch(typeof(Pe=Pe||{})=="string"?Pe={filename:Pe}:Pe.filename=Pe.filename||"generated.pdf",ne){case void 0:return Ci();case"save":U.save(Pe.filename);break;case"arraybuffer":return Ur(Ci());case"blob":return In(Ci());case"bloburi":case"bloburl":if(Hi.URL!==void 0&&typeof Hi.URL.createObjectURL=="function")return Hi.URL&&Hi.URL.createObjectURL(In(Ci()))||void 0;Ps.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var ct="",_t=Ci();try{ct=WC(_t)}catch{ct=WC(unescape(encodeURIComponent(_t)))}return"data:application/pdf;filename="+Pe.filename+";base64,"+ct;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Hi)==="[object Window]"){var xt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Lt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Pe.pdfObjectUrl&&(xt=Pe.pdfObjectUrl,Lt="");var gr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+xt+'"'+Lt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Pe)+");<\/script></body></html>",sr=Hi.open();return sr!==null&&sr.document.write(gr),sr}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Hi)==="[object Window]"){var si='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Pe.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Pe.filename+'" width="500px" height="400px" /></body></html>',$r=Hi.open();if($r!==null){$r.document.write(si);var ei=this;$r.document.documentElement.querySelector("#pdfViewer").onload=function(){$r.document.title=Pe.filename,$r.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(ei.output("bloburl"))}}return $r}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Hi)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var ui='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Pe)+'"></iframe></body></html>',$n=Hi.open();if($n!==null&&($n.document.write(ui),$n.document.title=Pe.filename),$n||typeof safari>"u")return $n;break;case"datauri":case"dataurl":return Hi.document.location.href=this.output("datauristring",Pe);default:return null}}),os=function(ne){return Array.isArray(Ae)===!0&&Ae.indexOf(ne)>-1};switch(i){case"pt":Ar=1;break;case"mm":Ar=72/25.4;break;case"cm":Ar=72/2.54;break;case"in":Ar=72;break;case"px":Ar=os("px_scaling")==1?.75:96/72;break;case"pc":case"em":Ar=12;break;case"ex":Ar=6;break;default:if(typeof i!="number")throw new Error("Invalid unit: "+i);Ar=i}var _n=null;Zt(),bt();var fu=function(ne){return T!==null?_n.encryptor(ne,0):function(Pe){return Pe}},Hl=U.__private__.getPageInfo=U.getPageInfo=function(ne){if(isNaN(ne)||ne%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:ue[ne].objId,pageNumber:ne,pageContext:ue[ne]}},Ei=U.__private__.getPageInfoByObjId=function(ne){if(isNaN(ne)||ne%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Pe in ue)if(ue[Pe].objId===ne)break;return Hl(Pe)},Ya=U.__private__.getCurrentPageInfo=U.getCurrentPageInfo=function(){return{objId:ue[Ze].objId,pageNumber:Ze,pageContext:ue[Ze]}};U.addPage=function(){return Mi.apply(this,arguments),this},U.setPage=function(){return Ys.apply(this,arguments),kt.call(this,nr[Ze]),this},U.insertPage=function(ne){return this.addPage(),this.movePage(Ze,ne),this},U.movePage=function(ne,Pe){var ct,_t;if(ne>Pe){ct=nr[ne],_t=ue[ne];for(var xt=ne;xt>Pe;xt--)nr[xt]=nr[xt-1],ue[xt]=ue[xt-1];nr[Pe]=ct,ue[Pe]=_t,this.setPage(Pe)}else if(ne<Pe){ct=nr[ne],_t=ue[ne];for(var Lt=ne;Lt<Pe;Lt++)nr[Lt]=nr[Lt+1],ue[Lt]=ue[Lt+1];nr[Pe]=ct,ue[Pe]=_t,this.setPage(Pe)}return this},U.deletePage=function(){return Za.apply(this,arguments),this},U.__private__.text=U.text=function(ne,Pe,ct,_t,xt){var Lt,gr,sr,si,$r,ei,ui,$n,ai,Pn=(_t=_t||{}).scope||this;if(typeof ne=="number"&&typeof Pe=="number"&&(typeof ct=="string"||Array.isArray(ct))){var Di=ct;ct=Pe,Pe=ne,ne=Di}if(arguments[3]instanceof we?(Ne("The transform parameter of text() with a Matrix value"),ai=xt):(sr=arguments[4],si=arguments[5],ts(ui=arguments[3])==="object"&&ui!==null||(typeof sr=="string"&&(si=sr,sr=null),typeof ui=="string"&&(si=ui,ui=null),typeof ui=="number"&&(sr=ui,ui=null),_t={flags:ui,angle:sr,align:si})),isNaN(Pe)||isNaN(ct)||ne==null)throw new Error("Invalid arguments passed to jsPDF.text");if(ne.length===0)return Pn;var Li="",Ds=!1,eo=typeof _t.lineHeightFactor=="number"?_t.lineHeightFactor:As,Po=Pn.internal.scaleFactor;function Ma(Ni){return Ni=Ni.split("	").join(Array(_t.TabLen||9).join(" ")),Cn(Ni,ui)}function ma(Ni){for(var tn,nn=Ni.concat(),zn=[],va=nn.length;va--;)typeof(tn=nn.shift())=="string"?zn.push(tn):Array.isArray(Ni)&&(tn.length===1||tn[1]===void 0&&tn[2]===void 0)?zn.push(tn[0]):zn.push([tn[0],tn[1],tn[2]]);return zn}function wc(Ni,tn){var nn;if(typeof Ni=="string")nn=tn(Ni)[0];else if(Array.isArray(Ni)){for(var zn,va,ka=Ni.concat(),ta=[],ra=ka.length;ra--;)typeof(zn=ka.shift())=="string"?ta.push(tn(zn)[0]):Array.isArray(zn)&&typeof zn[0]=="string"&&(va=tn(zn[0],zn[1],zn[2]),ta.push([va[0],va[1],va[2]]));nn=ta}return nn}var pl=!1,Xl=!0;if(typeof ne=="string")pl=!0;else if(Array.isArray(ne)){var Bc=ne.concat();gr=[];for(var Pa,_s=Bc.length;_s--;)(typeof(Pa=Bc.shift())!="string"||Array.isArray(Pa)&&typeof Pa[0]!="string")&&(Xl=!1);pl=Xl}if(pl===!1)throw new Error('Type of text must be string or Array. "'+ne+'" is not recognized.');typeof ne=="string"&&(ne=ne.match(/[\r?\n]/)?ne.split(/\r\n|\r|\n/g):[ne]);var gl=ht/Pn.internal.scaleFactor,Zl=gl*(eo-1);switch(_t.baseline){case"bottom":ct-=Zl;break;case"top":ct+=gl-Zl;break;case"hanging":ct+=gl-2*Zl;break;case"middle":ct+=gl/2-Zl}if((ei=_t.maxWidth||0)>0&&(typeof ne=="string"?ne=Pn.splitTextToSize(ne,ei):Object.prototype.toString.call(ne)==="[object Array]"&&(ne=ne.reduce(function(Ni,tn){return Ni.concat(Pn.splitTextToSize(tn,ei))},[]))),Lt={text:ne,x:Pe,y:ct,options:_t,mutex:{pdfEscape:Cn,activeFontKey:Xr,fonts:Tr,activeFontSize:ht}},re.publish("preProcessText",Lt),ne=Lt.text,sr=(_t=Lt.options).angle,!(ai instanceof we)&&sr&&typeof sr=="number"){sr*=Math.PI/180,_t.rotationDirection===0&&(sr=-sr),be===pe.ADVANCED&&(sr=-sr);var Fa=Math.cos(sr),Da=Math.sin(sr);ai=new we(Fa,Da,-Da,Fa,0,0)}else sr&&sr instanceof we&&(ai=sr);be!==pe.ADVANCED||ai||(ai=ze),($r=_t.charSpace||Hc)!==void 0&&(Li+=We(De($r))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),($n=_t.horizontalScale)!==void 0&&(Li+=We(100*$n)+` Tz
`),_t.lang;var Rs=-1,Hu=_t.renderingMode!==void 0?_t.renderingMode:_t.stroke,Ln=Pn.internal.getCurrentPageInfo().pageContext;switch(Hu){case 0:case!1:case"fill":Rs=0;break;case 1:case!0:case"stroke":Rs=1;break;case 2:case"fillThenStroke":Rs=2;break;case 3:case"invisible":Rs=3;break;case 4:case"fillAndAddForClipping":Rs=4;break;case 5:case"strokeAndAddPathForClipping":Rs=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":Rs=6;break;case 7:case"addToPathForClipping":Rs=7}var fn=Ln.usedRenderingMode!==void 0?Ln.usedRenderingMode:-1;Rs!==-1?Li+=Rs+` Tr
`:fn!==-1&&(Li+=`0 Tr
`),Rs!==-1&&(Ln.usedRenderingMode=Rs),si=_t.align||"left";var pn,fs=ht*eo,ya=Pn.internal.pageSize.getWidth(),Jl=Tr[Xr];$r=_t.charSpace||Hc,ei=_t.maxWidth||0,ui=Object.assign({autoencode:!0,noBOM:!0},_t.flags);var ho=[];if(Object.prototype.toString.call(ne)==="[object Array]"){var vs;gr=ma(ne),si!=="left"&&(pn=gr.map(function(Ni){return Pn.getStringUnitWidth(Ni,{font:Jl,charSpace:$r,fontSize:ht,doKerning:!1})*ht/Po}));var ps,Fo=0;if(si==="right"){Pe-=pn[0],ne=[],_s=gr.length;for(var vo=0;vo<_s;vo++)vo===0?(ps=Mo(Pe),vs=Zo(ct)):(ps=De(Fo-pn[vo]),vs=-fs),ne.push([gr[vo],ps,vs]),Fo=pn[vo]}else if(si==="center"){Pe-=pn[0]/2,ne=[],_s=gr.length;for(var _a=0;_a<_s;_a++)_a===0?(ps=Mo(Pe),vs=Zo(ct)):(ps=De((Fo-pn[_a])/2),vs=-fs),ne.push([gr[_a],ps,vs]),Fo=pn[_a]}else if(si==="left"){ne=[],_s=gr.length;for(var sl=0;sl<_s;sl++)ne.push(gr[sl])}else{if(si!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');ne=[],_s=gr.length,ei=ei!==0?ei:ya;for(var Do=0;Do<_s;Do++)vs=Do===0?Zo(ct):-fs,ps=Do===0?Mo(Pe):0,Do<_s-1?ho.push(We(De((ei-pn[Do])/(gr[Do].split(" ").length-1)))):ho.push(0),ne.push([gr[Do],ps,vs])}}var to=typeof _t.R2L=="boolean"?_t.R2L:mr;to===!0&&(ne=wc(ne,function(Ni,tn,nn){return[Ni.split("").reverse().join(""),tn,nn]})),Lt={text:ne,x:Pe,y:ct,options:_t,mutex:{pdfEscape:Cn,activeFontKey:Xr,fonts:Tr,activeFontSize:ht}},re.publish("postProcessText",Lt),ne=Lt.text,Ds=Lt.mutex.isHex||!1;var $s=Tr[Xr].encoding;$s!=="WinAnsiEncoding"&&$s!=="StandardEncoding"||(ne=wc(ne,function(Ni,tn,nn){return[Ma(Ni),tn,nn]})),gr=ma(ne),ne=[];for(var bs,Ao,Ra,ml=0,Yl=1,ks=Array.isArray(gr[0])?Yl:ml,ea="",ln=function(Ni,tn,nn){var zn="";return nn instanceof we?(nn=typeof _t.angle=="number"?Fe(nn,new we(1,0,0,1,Ni,tn)):Fe(new we(1,0,0,1,Ni,tn),nn),be===pe.ADVANCED&&(nn=Fe(new we(1,0,0,-1,0,0),nn)),zn=nn.join(" ")+` Tm
`):zn=We(Ni)+" "+We(tn)+` Td
`,zn},Kn=0;Kn<gr.length;Kn++){switch(ea="",ks){case Yl:Ra=(Ds?"<":"(")+gr[Kn][0]+(Ds?">":")"),bs=parseFloat(gr[Kn][1]),Ao=parseFloat(gr[Kn][2]);break;case ml:Ra=(Ds?"<":"(")+gr[Kn]+(Ds?">":")"),bs=Mo(Pe),Ao=Zo(ct)}ho!==void 0&&ho[Kn]!==void 0&&(ea=ho[Kn]+` Tw
`),Kn===0?ne.push(ea+ln(bs,Ao,ai)+Ra):ks===ml?ne.push(ea+Ra):ks===Yl&&ne.push(ea+ln(bs,Ao,ai)+Ra)}ne=ks===ml?ne.join(` Tj
T* `):ne.join(` Tj
`),ne+=` Tj
`;var ls=`BT
/`;return ls+=Xr+" "+ht+` Tf
`,ls+=We(ht*eo)+` TL
`,ls+=Yo+`
`,ls+=Li,ls+=ne,lt(ls+="ET"),R[Xr]=!0,Pn};var Gl=U.__private__.clip=U.clip=function(ne){return lt(ne==="evenodd"?"W*":"W"),this};U.clipEvenOdd=function(){return Gl("evenodd")},U.__private__.discardPath=U.discardPath=function(){return lt("n"),this};var as=U.__private__.isValidStyle=function(ne){var Pe=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(ne)!==-1&&(Pe=!0),Pe};U.__private__.setDefaultPathOperation=U.setDefaultPathOperation=function(ne){return as(ne)&&(y=ne),this};var Lo=U.__private__.getStyle=U.getStyle=function(ne){var Pe=y;switch(ne){case"D":case"S":Pe="S";break;case"F":Pe="f";break;case"FD":case"DF":Pe="B";break;case"f":case"f*":case"B":case"B*":Pe=ne}return Pe},Ia=U.close=function(){return lt("h"),this};U.stroke=function(){return lt("S"),this},U.fill=function(ne){return ys("f",ne),this},U.fillEvenOdd=function(ne){return ys("f*",ne),this},U.fillStroke=function(ne){return ys("B",ne),this},U.fillStrokeEvenOdd=function(ne){return ys("B*",ne),this};var ys=function(ne,Pe){ts(Pe)==="object"?Aa(Pe,ne):lt(ne)},La=function(ne){ne===null||be===pe.ADVANCED&&ne===void 0||(ne=Lo(ne),lt(ne))};function el(ne,Pe,ct,_t,xt){var Lt=new Dg(Pe||this.boundingBox,ct||this.xStep,_t||this.yStep,this.gState,xt||this.matrix);Lt.stream=this.stream;var gr=ne+"$$"+this.cloneIndex+++"$$";return Ge(gr,Lt),Lt}var Aa=function(ne,Pe){var ct=er[ne.key],_t=xr[ct];if(_t instanceof Uf)lt("q"),lt(Vc(Pe)),_t.gState&&U.setGState(_t.gState),lt(ne.matrix.toString()+" cm"),lt("/"+ct+" sh"),lt("Q");else if(_t instanceof Dg){var xt=new we(1,0,0,-1,0,uo());ne.matrix&&(xt=xt.multiply(ne.matrix||ze),ct=el.call(_t,ne.key,ne.boundingBox,ne.xStep,ne.yStep,xt).id),lt("q"),lt("/Pattern cs"),lt("/"+ct+" scn"),_t.gState&&U.setGState(_t.gState),lt(Pe),lt("Q")}},Vc=function(ne){switch(ne){case"f":case"F":return"W n";case"f*":return"W* n";case"B":return"W S";case"B*":return"W* S";case"S":return"W S";case"n":return"W n"}},tl=U.moveTo=function(ne,Pe){return lt(We(De(ne))+" "+We(Xe(Pe))+" m"),this},yo=U.lineTo=function(ne,Pe){return lt(We(De(ne))+" "+We(Xe(Pe))+" l"),this},Fi=U.curveTo=function(ne,Pe,ct,_t,xt,Lt){return lt([We(De(ne)),We(Xe(Pe)),We(De(ct)),We(Xe(_t)),We(De(xt)),We(Xe(Lt)),"c"].join(" ")),this};U.__private__.line=U.line=function(ne,Pe,ct,_t,xt){if(isNaN(ne)||isNaN(Pe)||isNaN(ct)||isNaN(_t)||!as(xt))throw new Error("Invalid arguments passed to jsPDF.line");return be===pe.COMPAT?this.lines([[ct-ne,_t-Pe]],ne,Pe,[1,1],xt||"S"):this.lines([[ct-ne,_t-Pe]],ne,Pe,[1,1]).stroke()},U.__private__.lines=U.lines=function(ne,Pe,ct,_t,xt,Lt){var gr,sr,si,$r,ei,ui,$n,ai,Pn,Di,Li,Ds;if(typeof ne=="number"&&(Ds=ct,ct=Pe,Pe=ne,ne=Ds),_t=_t||[1,1],Lt=Lt||!1,isNaN(Pe)||isNaN(ct)||!Array.isArray(ne)||!Array.isArray(_t)||!as(xt)||typeof Lt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(tl(Pe,ct),gr=_t[0],sr=_t[1],$r=ne.length,Di=Pe,Li=ct,si=0;si<$r;si++)(ei=ne[si]).length===2?(Di=ei[0]*gr+Di,Li=ei[1]*sr+Li,yo(Di,Li)):(ui=ei[0]*gr+Di,$n=ei[1]*sr+Li,ai=ei[2]*gr+Di,Pn=ei[3]*sr+Li,Di=ei[4]*gr+Di,Li=ei[5]*sr+Li,Fi(ui,$n,ai,Pn,Di,Li));return Lt&&Ia(),La(xt),this},U.path=function(ne){for(var Pe=0;Pe<ne.length;Pe++){var ct=ne[Pe],_t=ct.c;switch(ct.op){case"m":tl(_t[0],_t[1]);break;case"l":yo(_t[0],_t[1]);break;case"c":Fi.apply(this,_t);break;case"h":Ia()}}return this},U.__private__.rect=U.rect=function(ne,Pe,ct,_t,xt){if(isNaN(ne)||isNaN(Pe)||isNaN(ct)||isNaN(_t)||!as(xt))throw new Error("Invalid arguments passed to jsPDF.rect");return be===pe.COMPAT&&(_t=-_t),lt([We(De(ne)),We(Xe(Pe)),We(De(ct)),We(De(_t)),"re"].join(" ")),La(xt),this},U.__private__.triangle=U.triangle=function(ne,Pe,ct,_t,xt,Lt,gr){if(isNaN(ne)||isNaN(Pe)||isNaN(ct)||isNaN(_t)||isNaN(xt)||isNaN(Lt)||!as(gr))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[ct-ne,_t-Pe],[xt-ct,Lt-_t],[ne-xt,Pe-Lt]],ne,Pe,[1,1],gr,!0),this},U.__private__.roundedRect=U.roundedRect=function(ne,Pe,ct,_t,xt,Lt,gr){if(isNaN(ne)||isNaN(Pe)||isNaN(ct)||isNaN(_t)||isNaN(xt)||isNaN(Lt)||!as(gr))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var sr=4/3*(Math.SQRT2-1);return xt=Math.min(xt,.5*ct),Lt=Math.min(Lt,.5*_t),this.lines([[ct-2*xt,0],[xt*sr,0,xt,Lt-Lt*sr,xt,Lt],[0,_t-2*Lt],[0,Lt*sr,-xt*sr,Lt,-xt,Lt],[2*xt-ct,0],[-xt*sr,0,-xt,-Lt*sr,-xt,-Lt],[0,2*Lt-_t],[0,-Lt*sr,xt*sr,-Lt,xt,-Lt]],ne+xt,Pe,[1,1],gr,!0),this},U.__private__.ellipse=U.ellipse=function(ne,Pe,ct,_t,xt){if(isNaN(ne)||isNaN(Pe)||isNaN(ct)||isNaN(_t)||!as(xt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Lt=4/3*(Math.SQRT2-1)*ct,gr=4/3*(Math.SQRT2-1)*_t;return tl(ne+ct,Pe),Fi(ne+ct,Pe-gr,ne+Lt,Pe-_t,ne,Pe-_t),Fi(ne-Lt,Pe-_t,ne-ct,Pe-gr,ne-ct,Pe),Fi(ne-ct,Pe+gr,ne-Lt,Pe+_t,ne,Pe+_t),Fi(ne+Lt,Pe+_t,ne+ct,Pe+gr,ne+ct,Pe),La(xt),this},U.__private__.circle=U.circle=function(ne,Pe,ct,_t){if(isNaN(ne)||isNaN(Pe)||isNaN(ct)||!as(_t))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(ne,Pe,ct,ct,_t)},U.setFont=function(ne,Pe,ct){return ct&&(Pe=je(Pe,ct)),Xr=He(ne,Pe,{disableWarning:!1}),this};var da=U.__private__.getFont=U.getFont=function(){return Tr[He.apply(U,arguments)]};U.__private__.getFontList=U.getFontList=function(){var ne,Pe,ct={};for(ne in Lr)if(Lr.hasOwnProperty(ne))for(Pe in ct[ne]=[],Lr[ne])Lr[ne].hasOwnProperty(Pe)&&ct[ne].push(Pe);return ct},U.addFont=function(ne,Pe,ct,_t,xt){var Lt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Lt.indexOf(arguments[3])!==-1?xt=arguments[3]:arguments[3]&&Lt.indexOf(arguments[3])==-1&&(ct=je(ct,_t)),xt=xt||"Identity-H",Ii.call(this,ne,Pe,ct,xt)};var As,En=r.lineWidth||.200025,ds=U.__private__.getLineWidth=U.getLineWidth=function(){return En},fa=U.__private__.setLineWidth=U.setLineWidth=function(ne){return En=ne,lt(We(De(ne))+" w"),this};U.__private__.setLineDash=Gi.API.setLineDash=Gi.API.setLineDashPattern=function(ne,Pe){if(ne=ne||[],Pe=Pe||0,isNaN(Pe)||!Array.isArray(ne))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return ne=ne.map(function(ct){return We(De(ct))}).join(" "),Pe=We(De(Pe)),lt("["+ne+"] "+Pe+" d"),this};var qi=U.__private__.getLineHeight=U.getLineHeight=function(){return ht*As};U.__private__.getLineHeight=U.getLineHeight=function(){return ht*As};var dl=U.__private__.setLineHeightFactor=U.setLineHeightFactor=function(ne){return typeof(ne=ne||1.15)=="number"&&(As=ne),this},jl=U.__private__.getLineHeightFactor=U.getLineHeightFactor=function(){return As};dl(r.lineHeight);var Mo=U.__private__.getHorizontalCoordinate=function(ne){return De(ne)},Zo=U.__private__.getVerticalCoordinate=function(ne){return be===pe.ADVANCED?ne:ue[Ze].mediaBox.topRightY-ue[Ze].mediaBox.bottomLeftY-De(ne)},bc=U.__private__.getHorizontalCoordinateString=U.getHorizontalCoordinateString=function(ne){return We(Mo(ne))},Jo=U.__private__.getVerticalCoordinateString=U.getVerticalCoordinateString=function(ne){return We(Zo(ne))},_o=r.strokeColor||"0 G";U.__private__.getStrokeColor=U.getDrawColor=function(){return dr(_o)},U.__private__.setStrokeColor=U.setDrawColor=function(ne,Pe,ct,_t){return _o=Cr({ch1:ne,ch2:Pe,ch3:ct,ch4:_t,pdfColorType:"draw",precision:2}),lt(_o),this};var xc=r.fillColor||"0 g";U.__private__.getFillColor=U.getFillColor=function(){return dr(xc)},U.__private__.setFillColor=U.setFillColor=function(ne,Pe,ct,_t){return xc=Cr({ch1:ne,ch2:Pe,ch3:ct,ch4:_t,pdfColorType:"fill",precision:2}),lt(xc),this};var Yo=r.textColor||"0 g",ql=U.__private__.getTextColor=U.getTextColor=function(){return dr(Yo)};U.__private__.setTextColor=U.setTextColor=function(ne,Pe,ct,_t){return Yo=Cr({ch1:ne,ch2:Pe,ch3:ct,ch4:_t,pdfColorType:"text",precision:3}),this};var Hc=r.charSpace,Eh=U.__private__.getCharSpace=U.getCharSpace=function(){return parseFloat(Hc||0)};U.__private__.setCharSpace=U.setCharSpace=function(ne){if(isNaN(ne))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return Hc=ne,this};var pu=0;U.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},U.__private__.setLineCap=U.setLineCap=function(ne){var Pe=U.CapJoinStyles[ne];if(Pe===void 0)throw new Error("Line cap style of '"+ne+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return pu=Pe,lt(Pe+" J"),this};var gu=0;U.__private__.setLineJoin=U.setLineJoin=function(ne){var Pe=U.CapJoinStyles[ne];if(Pe===void 0)throw new Error("Line join style of '"+ne+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return gu=Pe,lt(Pe+" j"),this},U.__private__.setLineMiterLimit=U.__private__.setMiterLimit=U.setLineMiterLimit=U.setMiterLimit=function(ne){if(ne=ne||0,isNaN(ne))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return lt(We(De(ne))+" M"),this},U.GState=gv,U.setGState=function(ne){(ne=typeof ne=="string"?vi[Zi[ne]]:Vu(null,ne)).equals(Qe)||(lt("/"+ne.id+" gs"),Qe=ne)};var Vu=function(ne,Pe){if(!ne||!Zi[ne]){var ct=!1;for(var _t in vi)if(vi.hasOwnProperty(_t)&&vi[_t].equals(Pe)){ct=!0;break}if(ct)Pe=vi[_t];else{var xt="GS"+(Object.keys(vi).length+1).toString(10);vi[xt]=Pe,Pe.id=xt}return ne&&(Zi[ne]=Pe.id),re.publish("addGState",Pe),Pe}};U.addGState=function(ne,Pe){return Vu(ne,Pe),this},U.saveGraphicsState=function(){return lt("q"),Xt.push({key:Xr,size:ht,color:Yo}),this},U.restoreGraphicsState=function(){lt("Q");var ne=Xt.pop();return Xr=ne.key,ht=ne.size,Yo=ne.color,Qe=null,this},U.setCurrentTransformationMatrix=function(ne){return lt(ne.toString()+" cm"),this},U.comment=function(ne){return lt("#"+ne),this};var $l=function(ne,Pe){var ct=ne||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return ct},set:function(Lt){isNaN(Lt)||(ct=parseFloat(Lt))}});var _t=Pe||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return _t},set:function(Lt){isNaN(Lt)||(_t=parseFloat(Lt))}});var xt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return xt},set:function(Lt){xt=Lt.toString()}}),this},rl=function(ne,Pe,ct,_t){$l.call(this,ne,Pe),this.type="rect";var xt=ct||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return xt},set:function(gr){isNaN(gr)||(xt=parseFloat(gr))}});var Lt=_t||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Lt},set:function(gr){isNaN(gr)||(Lt=parseFloat(gr))}}),this},il=function(){this.page=Be,this.currentPage=Ze,this.pages=nr.slice(0),this.pagesContext=ue.slice(0),this.x=Wt,this.y=di,this.matrix=Qt,this.width=fl(Ze),this.height=uo(Ze),this.outputDestination=br,this.id="",this.objectNumber=-1};il.prototype.restore=function(){Be=this.page,Ze=this.currentPage,ue=this.pagesContext,nr=this.pages,Wt=this.x,di=this.y,Qt=this.matrix,Wl(Ze,this.width),ga(Ze,this.height),br=this.outputDestination};var Kl=function(ne,Pe,ct,_t,xt){Ee.push(new il),Be=Ze=0,nr=[],Wt=ne,di=Pe,Qt=xt,mo([ct,_t])},nl=function(ne){if(xe[ne])Ee.pop().restore();else{var Pe=new il,ct="Xo"+(Object.keys(ge).length+1).toString(10);Pe.id=ct,xe[ne]=ct,ge[ct]=Pe,re.publish("addFormObject",Pe),Ee.pop().restore()}};for(var pa in U.beginFormObject=function(ne,Pe,ct,_t,xt){return Kl(ne,Pe,ct,_t,xt),this},U.endFormObject=function(ne){return nl(ne),this},U.doFormObject=function(ne,Pe){var ct=ge[xe[ne]];return lt("q"),lt(Pe.toString()+" cm"),lt("/"+ct.id+" Do"),lt("Q"),this},U.getFormObject=function(ne){var Pe=ge[xe[ne]];return{x:Pe.x,y:Pe.y,width:Pe.width,height:Pe.height,matrix:Pe.matrix}},U.save=function(ne,Pe){return ne=ne||"generated.pdf",(Pe=Pe||{}).returnPromise=Pe.returnPromise||!1,Pe.returnPromise===!1?(Of(In(Ci()),ne),typeof Of.unload=="function"&&Hi.setTimeout&&setTimeout(Of.unload,911),this):new Promise(function(ct,_t){try{var xt=Of(In(Ci()),ne);typeof Of.unload=="function"&&Hi.setTimeout&&setTimeout(Of.unload,911),ct(xt)}catch(Lt){_t(Lt.message)}})},Gi.API)Gi.API.hasOwnProperty(pa)&&(pa==="events"&&Gi.API.events.length?function(ne,Pe){var ct,_t,xt;for(xt=Pe.length-1;xt!==-1;xt--)ct=Pe[xt][0],_t=Pe[xt][1],ne.subscribe.apply(ne,[ct].concat(typeof _t=="function"?[_t]:_t))}(re,Gi.API.events):U[pa]=Gi.API[pa]);var fl=U.getPageWidth=function(ne){return(ue[ne=ne||Ze].mediaBox.topRightX-ue[ne].mediaBox.bottomLeftX)/Ar},Wl=U.setPageWidth=function(ne,Pe){ue[ne].mediaBox.topRightX=Pe*Ar+ue[ne].mediaBox.bottomLeftX},uo=U.getPageHeight=function(ne){return(ue[ne=ne||Ze].mediaBox.topRightY-ue[ne].mediaBox.bottomLeftY)/Ar},ga=U.setPageHeight=function(ne,Pe){ue[ne].mediaBox.topRightY=Pe*Ar+ue[ne].mediaBox.bottomLeftY};return U.internal={pdfEscape:Cn,getStyle:Lo,getFont:da,getFontSize:or,getCharSpace:Eh,getTextColor:ql,getLineHeight:qi,getLineHeightFactor:jl,getLineWidth:ds,write:wt,getHorizontalCoordinate:Mo,getVerticalCoordinate:Zo,getCoordinateString:bc,getVerticalCoordinateString:Jo,collections:{},newObject:st,newAdditionalObject:Kt,newObjectDeferred:vt,newObjectDeferredBegin:Tt,getFilters:Gr,putStream:Er,events:re,scaleFactor:Ar,pageSize:{getWidth:function(){return fl(Ze)},setWidth:function(ne){Wl(Ze,ne)},getHeight:function(){return uo(Ze)},setHeight:function(ne){ga(Ze,ne)}},encryptionOptions:T,encryption:_n,getEncryptor:fu,output:qn,getNumberOfPages:Ja,pages:nr,out:lt,f2:nt,f3:ke,getPageInfo:Hl,getPageInfoByObjId:Ei,getCurrentPageInfo:Ya,getPDFVersion:Y,Point:$l,Rectangle:rl,Matrix:we,hasHotfix:os},Object.defineProperty(U.internal.pageSize,"width",{get:function(){return fl(Ze)},set:function(ne){Wl(Ze,ne)},enumerable:!0,configurable:!0}),Object.defineProperty(U.internal.pageSize,"height",{get:function(){return uo(Ze)},set:function(ne){ga(Ze,ne)},enumerable:!0,configurable:!0}),ss.call(U,tr),Xr="F1",Mi(n,t),re.publish("initialized"),U}Pg.prototype.lsbFirstWord=function(r){return String.fromCharCode(r>>0&255,r>>8&255,r>>16&255,r>>24&255)},Pg.prototype.toHexString=function(r){return r.split("").map(function(e){return("0"+(255&e.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Pg.prototype.hexToBytes=function(r){for(var e=[],t=0;t<r.length;t+=2)e.push(String.fromCharCode(parseInt(r.substr(t,2),16)));return e.join("")},Pg.prototype.processOwnerPassword=function(r,e){return JC(ZC(e).substr(0,5),r)},Pg.prototype.encryptor=function(r,e){var t=ZC(this.encryptionKey+String.fromCharCode(255&r,r>>8&255,r>>16&255,255&e,e>>8&255)).substr(0,10);return function(i){return JC(t,i)}},gv.prototype.equals=function(r){var e,t="id,objectNumber,equals";if(!r||ts(r)!==ts(this))return!1;var i=0;for(e in this)if(!(t.indexOf(e)>=0)){if(this.hasOwnProperty(e)&&!r.hasOwnProperty(e)||this[e]!==r[e])return!1;i++}for(e in r)r.hasOwnProperty(e)&&t.indexOf(e)<0&&i--;return i===0},Gi.API={events:[]},Gi.version="2.5.1";var So=Gi.API,YC=1,Nf=function(r){return r.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Rg=function(r){return r.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Ji=function(r){return r.toFixed(2)},Ed=function(r){return r.toFixed(5)};So.__acroform__={};var Uc=function(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r},fD=function(r){return r*YC},Zh=function(r){var e=new gD,t=pi.internal.getHeight(r)||0,i=pi.internal.getWidth(r)||0;return e.BBox=[0,0,Number(Ji(i)),Number(Ji(t))],e},dne=So.__acroform__.setBit=function(r,e){if(r=r||0,e=e||0,isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return r|=1<<e},fne=So.__acroform__.clearBit=function(r,e){if(r=r||0,e=e||0,isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return r&=~(1<<e)},pne=So.__acroform__.getBit=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return r&1<<e?1:0},Ho=So.__acroform__.getBitForPdf=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return pne(r,e-1)},Go=So.__acroform__.setBitForPdf=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return dne(r,e-1)},jo=So.__acroform__.clearBitForPdf=function(r,e){if(isNaN(r)||isNaN(e))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return fne(r,e-1)},gne=So.__acroform__.calculateCoordinates=function(r,e){var t=e.internal.getHorizontalCoordinate,i=e.internal.getVerticalCoordinate,n=r[0],o=r[1],a=r[2],s=r[3],g={};return g.lowerLeft_X=t(n)||0,g.lowerLeft_Y=i(o+s)||0,g.upperRight_X=t(n+a)||0,g.upperRight_Y=i(o)||0,[Number(Ji(g.lowerLeft_X)),Number(Ji(g.lowerLeft_Y)),Number(Ji(g.upperRight_X)),Number(Ji(g.upperRight_Y))]},mne=function(r){if(r.appearanceStreamContent)return r.appearanceStreamContent;if(r.V||r.DV){var e=[],t=r._V||r.DV,i=eE(r,t),n=r.scope.internal.getFont(r.fontName,r.fontStyle).id;e.push("/Tx BMC"),e.push("q"),e.push("BT"),e.push(r.scope.__private__.encodeColorString(r.color)),e.push("/"+n+" "+Ji(i.fontSize)+" Tf"),e.push("1 0 0 1 0 0 Tm"),e.push(i.text),e.push("ET"),e.push("Q"),e.push("EMC");var o=Zh(r);return o.scope=r.scope,o.stream=e.join(`
`),o}},eE=function(r,e){var t=r.fontSize===0?r.maxFontSize:r.fontSize,i={text:"",fontSize:""},n=(e=(e=e.substr(0,1)=="("?e.substr(1):e).substr(e.length-1)==")"?e.substr(0,e.length-1):e).split(" ");n=r.multiline?n.map(function(ke){return ke.split(`
`)}):n.map(function(ke){return[ke]});var o=t,a=pi.internal.getHeight(r)||0;a=a<0?-a:a;var s=pi.internal.getWidth(r)||0;s=s<0?-s:s;var g=function(ke,De,Ye){if(ke+1<n.length){var Xe=De+" "+n[ke+1][0];return mv(Xe,r,Ye).width<=s-4}return!1};o++;e:for(;o>0;){e="",o--;var y,T,I=mv("3",r,o).height,R=r.multiline?a-o:(a-I)/2,U=R+=2,Z=0,Y=0,he=0;if(o<=0){e=`(...) Tj
`,e+="% Width of Text: "+mv(e,r,o=12).width+", FieldWidth:"+s+`
`;break}for(var ce="",pe=0,be=0;be<n.length;be++)if(n.hasOwnProperty(be)){var Te=!1;if(n[be].length!==1&&he!==n[be].length-1){if((I+2)*(pe+2)+2>a)continue e;ce+=n[be][he],Te=!0,Y=be,be--}else{ce=(ce+=n[be][he]+" ").substr(ce.length-1)==" "?ce.substr(0,ce.length-1):ce;var qe=parseInt(be),je=g(qe,ce,o),We=be>=n.length-1;if(je&&!We){ce+=" ",he=0;continue}if(je||We){if(We)Y=qe;else if(r.multiline&&(I+2)*(pe+2)+2>a)continue e}else{if(!r.multiline||(I+2)*(pe+2)+2>a)continue e;Y=qe}}for(var Ne="",at=Z;at<=Y;at++){var nt=n[at];if(r.multiline){if(at===Y){Ne+=nt[he]+" ",he=(he+1)%nt.length;continue}if(at===Z){Ne+=nt[nt.length-1]+" ";continue}}Ne+=nt[0]+" "}switch(Ne=Ne.substr(Ne.length-1)==" "?Ne.substr(0,Ne.length-1):Ne,T=mv(Ne,r,o).width,r.textAlign){case"right":y=s-T-2;break;case"center":y=(s-T)/2;break;case"left":default:y=2}e+=Ji(y)+" "+Ji(U)+` Td
`,e+="("+Nf(Ne)+`) Tj
`,e+=-Ji(y)+` 0 Td
`,U=-(o+2),T=0,Z=Te?Y:Y+1,pe++,ce=""}break}return i.text=e,i.fontSize=o,i},mv=function(r,e,t){var i=e.scope.internal.getFont(e.fontName,e.fontStyle),n=e.scope.getStringUnitWidth(r,{font:i,fontSize:parseFloat(t),charSpace:0})*parseFloat(t);return{height:e.scope.getStringUnitWidth("3",{font:i,fontSize:parseFloat(t),charSpace:0})*parseFloat(t)*1.5,width:n}},yne={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},_ne=function(r,e){var t={type:"reference",object:r};e.internal.getPageInfo(r.page).pageContext.annotations.find(function(i){return i.type===t.type&&i.object===t.object})===void 0&&e.internal.getPageInfo(r.page).pageContext.annotations.push(t)},vne=function(r,e){for(var t in r)if(r.hasOwnProperty(t)){var i=t,n=r[t];e.internal.newObjectDeferredBegin(n.objId,!0),ts(n)==="object"&&typeof n.putStream=="function"&&n.putStream(),delete r[i]}},bne=function(r,e){if(e.scope=r,r.internal!==void 0&&(r.internal.acroformPlugin===void 0||r.internal.acroformPlugin.isInitialized===!1)){if(fh.FieldNum=0,r.internal.acroformPlugin=JSON.parse(JSON.stringify(yne)),r.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");YC=r.internal.scaleFactor,r.internal.acroformPlugin.acroFormDictionaryRoot=new mD,r.internal.acroformPlugin.acroFormDictionaryRoot.scope=r,r.internal.acroformPlugin.acroFormDictionaryRoot._eventID=r.internal.events.subscribe("postPutResources",function(){(function(t){t.internal.events.unsubscribe(t.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete t.internal.acroformPlugin.acroFormDictionaryRoot._eventID,t.internal.acroformPlugin.printedOut=!0})(r)}),r.internal.events.subscribe("buildDocument",function(){(function(t){t.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var i=t.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var n in i)if(i.hasOwnProperty(n)){var o=i[n];o.objId=void 0,o.hasAnnotation&&_ne(o,t)}})(r)}),r.internal.events.subscribe("putCatalog",function(){(function(t){if(t.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");t.internal.write("/AcroForm "+t.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(r)}),r.internal.events.subscribe("postPutPages",function(t){(function(i,n){var o=!i;for(var a in i||(n.internal.newObjectDeferredBegin(n.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),n.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),i=i||n.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(i.hasOwnProperty(a)){var s=i[a],g=[],y=s.Rect;if(s.Rect&&(s.Rect=gne(s.Rect,n)),n.internal.newObjectDeferredBegin(s.objId,!0),s.DA=pi.createDefaultAppearanceStream(s),ts(s)==="object"&&typeof s.getKeyValueListForStream=="function"&&(g=s.getKeyValueListForStream()),s.Rect=y,s.hasAppearanceStream&&!s.appearanceStreamContent){var T=mne(s);g.push({key:"AP",value:"<</N "+T+">>"}),n.internal.acroformPlugin.xForms.push(T)}if(s.appearanceStreamContent){var I="";for(var R in s.appearanceStreamContent)if(s.appearanceStreamContent.hasOwnProperty(R)){var U=s.appearanceStreamContent[R];if(I+="/"+R+" ",I+="<<",Object.keys(U).length>=1||Array.isArray(U)){for(var a in U)if(U.hasOwnProperty(a)){var Z=U[a];typeof Z=="function"&&(Z=Z.call(n,s)),I+="/"+a+" "+Z+" ",n.internal.acroformPlugin.xForms.indexOf(Z)>=0||n.internal.acroformPlugin.xForms.push(Z)}}else typeof(Z=U)=="function"&&(Z=Z.call(n,s)),I+="/"+a+" "+Z,n.internal.acroformPlugin.xForms.indexOf(Z)>=0||n.internal.acroformPlugin.xForms.push(Z);I+=">>"}g.push({key:"AP",value:`<<
`+I+">>"})}n.internal.putStream({additionalKeyValues:g,objectId:s.objId}),n.internal.out("endobj")}o&&vne(n.internal.acroformPlugin.xForms,n)})(t,r)}),r.internal.acroformPlugin.isInitialized=!0}},pD=So.__acroform__.arrayToPdfArray=function(r,e,t){var i=function(a){return a};if(Array.isArray(r)){for(var n="[",o=0;o<r.length;o++)switch(o!==0&&(n+=" "),ts(r[o])){case"boolean":case"number":case"object":n+=r[o].toString();break;case"string":r[o].substr(0,1)!=="/"?(e!==void 0&&t&&(i=t.internal.getEncryptor(e)),n+="("+Nf(i(r[o].toString()))+")"):n+=r[o].toString()}return n+="]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},tE=function(r,e,t){var i=function(n){return n};return e!==void 0&&t&&(i=t.internal.getEncryptor(e)),(r=r||"").toString(),r="("+Nf(i(r))+")"},Jh=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(r){this._objId=r}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Jh.prototype.toString=function(){return this.objId+" 0 R"},Jh.prototype.putStream=function(){var r=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:r,objectId:this.objId}),this.scope.internal.out("endobj")},Jh.prototype.getKeyValueListForStream=function(){var r=[],e=Object.getOwnPropertyNames(this).filter(function(o){return o!="content"&&o!="appearanceStreamContent"&&o!="scope"&&o!="objId"&&o.substring(0,1)!="_"});for(var t in e)if(Object.getOwnPropertyDescriptor(this,e[t]).configurable===!1){var i=e[t],n=this[i];n&&(Array.isArray(n)?r.push({key:i,value:pD(n,this.objId,this.scope)}):n instanceof Jh?(n.scope=this.scope,r.push({key:i,value:n.objId+" 0 R"})):typeof n!="function"&&r.push({key:i,value:n}))}return r};var gD=function(){Jh.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var r,e=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return e},set:function(t){e=t}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(t){r=t.trim()},get:function(){return r||null}})};Uc(gD,Jh);var mD=function(){Jh.call(this);var r,e=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return e.length>0?e:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return e}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(r){var t=function(i){return i};return this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),"("+Nf(t(r))+")"}},set:function(t){r=t}})};Uc(mD,Jh);var fh=function r(){Jh.call(this);var e=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return e},set:function(ce){if(isNaN(ce))throw new Error('Invalid value "'+ce+'" for attribute F supplied.');e=ce}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Ho(e,3)},set:function(ce){ce?this.F=Go(e,3):this.F=jo(e,3)}});var t=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return t},set:function(ce){if(isNaN(ce))throw new Error('Invalid value "'+ce+'" for attribute Ff supplied.');t=ce}});var i=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(i.length!==0)return i},set:function(ce){i=ce!==void 0?ce:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[0])?0:i[0]},set:function(ce){i[0]=ce}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[1])?0:i[1]},set:function(ce){i[1]=ce}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[2])?0:i[2]},set:function(ce){i[2]=ce}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!i||isNaN(i[3])?0:i[3]},set:function(ce){i[3]=ce}});var n="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return n},set:function(ce){switch(ce){case"/Btn":case"/Tx":case"/Ch":case"/Sig":n=ce;break;default:throw new Error('Invalid value "'+ce+'" for attribute FT supplied.')}}});var o=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!o||o.length<1){if(this instanceof vv)return;o="FieldObject"+r.FieldNum++}var ce=function(pe){return pe};return this.scope&&(ce=this.scope.internal.getEncryptor(this.objId)),"("+Nf(ce(o))+")"},set:function(ce){o=ce.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return o},set:function(ce){o=ce}});var a="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return a},set:function(ce){a=ce}});var s="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return s},set:function(ce){s=ce}});var g=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return g},set:function(ce){g=ce}});var y=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return y===void 0?50/YC:y},set:function(ce){y=ce}});var T="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return T},set:function(ce){T=ce}});var I="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!I||this instanceof vv||this instanceof zf))return tE(I,this.objId,this.scope)},set:function(ce){ce=ce.toString(),I=ce}});var R=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(R)return this instanceof $a?R:tE(R,this.objId,this.scope)},set:function(ce){ce=ce.toString(),R=this instanceof $a?ce:ce.substr(0,1)==="("?Rg(ce.substr(1,ce.length-2)):Rg(ce)}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof $a?Rg(R.substr(1,R.length-1)):R},set:function(ce){ce=ce.toString(),R=this instanceof $a?"/"+ce:ce}});var U=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(U)return U},set:function(ce){this.V=ce}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(U)return this instanceof $a?U:tE(U,this.objId,this.scope)},set:function(ce){ce=ce.toString(),U=this instanceof $a?ce:ce.substr(0,1)==="("?Rg(ce.substr(1,ce.length-2)):Rg(ce)}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof $a?Rg(U.substr(1,U.length-1)):U},set:function(ce){ce=ce.toString(),U=this instanceof $a?"/"+ce:ce}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var Z,Y=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return Y},set:function(ce){ce=!!ce,Y=ce}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(Z)return Z},set:function(ce){Z=ce}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,1)},set:function(ce){ce?this.Ff=Go(this.Ff,1):this.Ff=jo(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,2)},set:function(ce){ce?this.Ff=Go(this.Ff,2):this.Ff=jo(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,3)},set:function(ce){ce?this.Ff=Go(this.Ff,3):this.Ff=jo(this.Ff,3)}});var he=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(he!==null)return he},set:function(ce){if([0,1,2].indexOf(ce)===-1)throw new Error('Invalid value "'+ce+'" for attribute Q supplied.');he=ce}}),Object.defineProperty(this,"textAlign",{get:function(){var ce;switch(he){case 0:default:ce="left";break;case 1:ce="center";break;case 2:ce="right"}return ce},configurable:!0,enumerable:!0,set:function(ce){switch(ce){case"right":case 2:he=2;break;case"center":case 1:he=1;break;case"left":case 0:default:he=0}}})};Uc(fh,Jh);var kg=function(){fh.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var r=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return r},set:function(t){r=t}});var e=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return pD(e,this.objId,this.scope)},set:function(t){var i,n;n=[],typeof(i=t)=="string"&&(n=function(o,a,s){s||(s=1);for(var g,y=[];g=a.exec(o);)y.push(g[s]);return y}(i,/\((.*?)\)/g)),e=n}}),this.getOptions=function(){return e},this.setOptions=function(t){e=t,this.sort&&e.sort()},this.addOption=function(t){t=(t=t||"").toString(),e.push(t),this.sort&&e.sort()},this.removeOption=function(t,i){for(i=i||!1,t=(t=t||"").toString();e.indexOf(t)!==-1&&(e.splice(e.indexOf(t),1),i!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,18)},set:function(t){t?this.Ff=Go(this.Ff,18):this.Ff=jo(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,19)},set:function(t){this.combo===!0&&(t?this.Ff=Go(this.Ff,19):this.Ff=jo(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,20)},set:function(t){t?(this.Ff=Go(this.Ff,20),e.sort()):this.Ff=jo(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,22)},set:function(t){t?this.Ff=Go(this.Ff,22):this.Ff=jo(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,23)},set:function(t){t?this.Ff=Go(this.Ff,23):this.Ff=jo(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,27)},set:function(t){t?this.Ff=Go(this.Ff,27):this.Ff=jo(this.Ff,27)}}),this.hasAppearanceStream=!1};Uc(kg,fh);var Og=function(){kg.call(this),this.fontName="helvetica",this.combo=!1};Uc(Og,kg);var Ug=function(){Og.call(this),this.combo=!0};Uc(Ug,Og);var yv=function(){Ug.call(this),this.edit=!0};Uc(yv,Ug);var $a=function(){fh.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,15)},set:function(t){t?this.Ff=Go(this.Ff,15):this.Ff=jo(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,16)},set:function(t){t?this.Ff=Go(this.Ff,16):this.Ff=jo(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,17)},set:function(t){t?this.Ff=Go(this.Ff,17):this.Ff=jo(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,26)},set:function(t){t?this.Ff=Go(this.Ff,26):this.Ff=jo(this.Ff,26)}});var r,e={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var t=function(o){return o};if(this.scope&&(t=this.scope.internal.getEncryptor(this.objId)),Object.keys(e).length!==0){var i,n=[];for(i in n.push("<<"),e)n.push("/"+i+" ("+Nf(t(e[i]))+")");return n.push(">>"),n.join(`
`)}},set:function(t){ts(t)==="object"&&(e=t)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return e.CA||""},set:function(t){typeof t=="string"&&(e.CA=t)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(t){r="/"+t}})};Uc($a,fh);var _v=function(){$a.call(this),this.pushButton=!0};Uc(_v,$a);var Ng=function(){$a.call(this),this.radio=!0,this.pushButton=!1;var r=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){r=e!==void 0?e:[]}})};Uc(Ng,$a);var vv=function(){var r,e;fh.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return r},set:function(n){r=n}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return e},set:function(n){e=n}});var t,i={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var n=function(s){return s};this.scope&&(n=this.scope.internal.getEncryptor(this.objId));var o,a=[];for(o in a.push("<<"),i)a.push("/"+o+" ("+Nf(n(i[o]))+")");return a.push(">>"),a.join(`
`)},set:function(n){ts(n)==="object"&&(i=n)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return i.CA||""},set:function(n){typeof n=="string"&&(i.CA=n)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(n){t=n}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(n){t="/"+n}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=pi.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};Uc(vv,fh),Ng.prototype.setAppearance=function(r){if(!("createAppearanceStream"in r)||!("getCA"in r))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var e in this.Kids)if(this.Kids.hasOwnProperty(e)){var t=this.Kids[e];t.appearanceStreamContent=r.createAppearanceStream(t.optionName),t.caption=r.getCA()}},Ng.prototype.createOption=function(r){var e=new vv;return e.Parent=this,e.optionName=r,this.Kids.push(e),xne.call(this.scope,e),e};var bv=function(){$a.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=pi.CheckBox.createAppearanceStream()};Uc(bv,$a);var zf=function(){fh.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,13)},set:function(e){e?this.Ff=Go(this.Ff,13):this.Ff=jo(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,21)},set:function(e){e?this.Ff=Go(this.Ff,21):this.Ff=jo(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,23)},set:function(e){e?this.Ff=Go(this.Ff,23):this.Ff=jo(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,24)},set:function(e){e?this.Ff=Go(this.Ff,24):this.Ff=jo(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,25)},set:function(e){e?this.Ff=Go(this.Ff,25):this.Ff=jo(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,26)},set:function(e){e?this.Ff=Go(this.Ff,26):this.Ff=jo(this.Ff,26)}});var r=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return r},set:function(e){Number.isInteger(e)&&(r=e)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};Uc(zf,fh);var xv=function(){zf.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Ho(this.Ff,14)},set:function(r){r?this.Ff=Go(this.Ff,14):this.Ff=jo(this.Ff,14)}}),this.password=!0};Uc(xv,zf);var pi={CheckBox:{createAppearanceStream:function(){return{N:{On:pi.CheckBox.YesNormal},D:{On:pi.CheckBox.YesPushDown,Off:pi.CheckBox.OffPushDown}}},YesPushDown:function(r){var e=Zh(r);e.scope=r.scope;var t=[],i=r.scope.internal.getFont(r.fontName,r.fontStyle).id,n=r.scope.__private__.encodeColorString(r.color),o=eE(r,r.caption);return t.push("0.749023 g"),t.push("0 0 "+Ji(pi.internal.getWidth(r))+" "+Ji(pi.internal.getHeight(r))+" re"),t.push("f"),t.push("BMC"),t.push("q"),t.push("0 0 1 rg"),t.push("/"+i+" "+Ji(o.fontSize)+" Tf "+n),t.push("BT"),t.push(o.text),t.push("ET"),t.push("Q"),t.push("EMC"),e.stream=t.join(`
`),e},YesNormal:function(r){var e=Zh(r);e.scope=r.scope;var t=r.scope.internal.getFont(r.fontName,r.fontStyle).id,i=r.scope.__private__.encodeColorString(r.color),n=[],o=pi.internal.getHeight(r),a=pi.internal.getWidth(r),s=eE(r,r.caption);return n.push("1 g"),n.push("0 0 "+Ji(a)+" "+Ji(o)+" re"),n.push("f"),n.push("q"),n.push("0 0 1 rg"),n.push("0 0 "+Ji(a-1)+" "+Ji(o-1)+" re"),n.push("W"),n.push("n"),n.push("0 g"),n.push("BT"),n.push("/"+t+" "+Ji(s.fontSize)+" Tf "+i),n.push(s.text),n.push("ET"),n.push("Q"),e.stream=n.join(`
`),e},OffPushDown:function(r){var e=Zh(r);e.scope=r.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Ji(pi.internal.getWidth(r))+" "+Ji(pi.internal.getHeight(r))+" re"),t.push("f"),e.stream=t.join(`
`),e}},RadioButton:{Circle:{createAppearanceStream:function(r){var e={D:{Off:pi.RadioButton.Circle.OffPushDown},N:{}};return e.N[r]=pi.RadioButton.Circle.YesNormal,e.D[r]=pi.RadioButton.Circle.YesPushDown,e},getCA:function(){return"l"},YesNormal:function(r){var e=Zh(r);e.scope=r.scope;var t=[],i=pi.internal.getWidth(r)<=pi.internal.getHeight(r)?pi.internal.getWidth(r)/4:pi.internal.getHeight(r)/4;i=Number((.9*i).toFixed(5));var n=pi.internal.Bezier_C,o=Number((i*n).toFixed(5));return t.push("q"),t.push("1 0 0 1 "+Ed(pi.internal.getWidth(r)/2)+" "+Ed(pi.internal.getHeight(r)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+o+" "+o+" "+i+" 0 "+i+" c"),t.push("-"+o+" "+i+" -"+i+" "+o+" -"+i+" 0 c"),t.push("-"+i+" -"+o+" -"+o+" -"+i+" 0 -"+i+" c"),t.push(o+" -"+i+" "+i+" -"+o+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(r){var e=Zh(r);e.scope=r.scope;var t=[],i=pi.internal.getWidth(r)<=pi.internal.getHeight(r)?pi.internal.getWidth(r)/4:pi.internal.getHeight(r)/4;i=Number((.9*i).toFixed(5));var n=Number((2*i).toFixed(5)),o=Number((n*pi.internal.Bezier_C).toFixed(5)),a=Number((i*pi.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Ed(pi.internal.getWidth(r)/2)+" "+Ed(pi.internal.getHeight(r)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),t.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),t.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),t.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),t.push("f"),t.push("Q"),t.push("0 g"),t.push("q"),t.push("1 0 0 1 "+Ed(pi.internal.getWidth(r)/2)+" "+Ed(pi.internal.getHeight(r)/2)+" cm"),t.push(i+" 0 m"),t.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),t.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),t.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),t.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e},OffPushDown:function(r){var e=Zh(r);e.scope=r.scope;var t=[],i=pi.internal.getWidth(r)<=pi.internal.getHeight(r)?pi.internal.getWidth(r)/4:pi.internal.getHeight(r)/4;i=Number((.9*i).toFixed(5));var n=Number((2*i).toFixed(5)),o=Number((n*pi.internal.Bezier_C).toFixed(5));return t.push("0.749023 g"),t.push("q"),t.push("1 0 0 1 "+Ed(pi.internal.getWidth(r)/2)+" "+Ed(pi.internal.getHeight(r)/2)+" cm"),t.push(n+" 0 m"),t.push(n+" "+o+" "+o+" "+n+" 0 "+n+" c"),t.push("-"+o+" "+n+" -"+n+" "+o+" -"+n+" 0 c"),t.push("-"+n+" -"+o+" -"+o+" -"+n+" 0 -"+n+" c"),t.push(o+" -"+n+" "+n+" -"+o+" "+n+" 0 c"),t.push("f"),t.push("Q"),e.stream=t.join(`
`),e}},Cross:{createAppearanceStream:function(r){var e={D:{Off:pi.RadioButton.Cross.OffPushDown},N:{}};return e.N[r]=pi.RadioButton.Cross.YesNormal,e.D[r]=pi.RadioButton.Cross.YesPushDown,e},getCA:function(){return"8"},YesNormal:function(r){var e=Zh(r);e.scope=r.scope;var t=[],i=pi.internal.calculateCross(r);return t.push("q"),t.push("1 1 "+Ji(pi.internal.getWidth(r)-2)+" "+Ji(pi.internal.getHeight(r)-2)+" re"),t.push("W"),t.push("n"),t.push(Ji(i.x1.x)+" "+Ji(i.x1.y)+" m"),t.push(Ji(i.x2.x)+" "+Ji(i.x2.y)+" l"),t.push(Ji(i.x4.x)+" "+Ji(i.x4.y)+" m"),t.push(Ji(i.x3.x)+" "+Ji(i.x3.y)+" l"),t.push("s"),t.push("Q"),e.stream=t.join(`
`),e},YesPushDown:function(r){var e=Zh(r);e.scope=r.scope;var t=pi.internal.calculateCross(r),i=[];return i.push("0.749023 g"),i.push("0 0 "+Ji(pi.internal.getWidth(r))+" "+Ji(pi.internal.getHeight(r))+" re"),i.push("f"),i.push("q"),i.push("1 1 "+Ji(pi.internal.getWidth(r)-2)+" "+Ji(pi.internal.getHeight(r)-2)+" re"),i.push("W"),i.push("n"),i.push(Ji(t.x1.x)+" "+Ji(t.x1.y)+" m"),i.push(Ji(t.x2.x)+" "+Ji(t.x2.y)+" l"),i.push(Ji(t.x4.x)+" "+Ji(t.x4.y)+" m"),i.push(Ji(t.x3.x)+" "+Ji(t.x3.y)+" l"),i.push("s"),i.push("Q"),e.stream=i.join(`
`),e},OffPushDown:function(r){var e=Zh(r);e.scope=r.scope;var t=[];return t.push("0.749023 g"),t.push("0 0 "+Ji(pi.internal.getWidth(r))+" "+Ji(pi.internal.getHeight(r))+" re"),t.push("f"),e.stream=t.join(`
`),e}}},createDefaultAppearanceStream:function(r){var e=r.scope.internal.getFont(r.fontName,r.fontStyle).id,t=r.scope.__private__.encodeColorString(r.color);return"/"+e+" "+r.fontSize+" Tf "+t}};pi.internal={Bezier_C:.551915024494,calculateCross:function(r){var e=pi.internal.getWidth(r),t=pi.internal.getHeight(r),i=Math.min(e,t);return{x1:{x:(e-i)/2,y:(t-i)/2+i},x2:{x:(e-i)/2+i,y:(t-i)/2},x3:{x:(e-i)/2,y:(t-i)/2},x4:{x:(e-i)/2+i,y:(t-i)/2+i}}}},pi.internal.getWidth=function(r){var e=0;return ts(r)==="object"&&(e=fD(r.Rect[2])),e},pi.internal.getHeight=function(r){var e=0;return ts(r)==="object"&&(e=fD(r.Rect[3])),e};var xne=So.addField=function(r){if(bne(this,r),!(r instanceof fh))throw new Error("Invalid argument passed to jsPDF.addField.");var e;return(e=r).scope.internal.acroformPlugin.printedOut&&(e.scope.internal.acroformPlugin.printedOut=!1,e.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),e.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(e),r.page=r.scope.internal.getCurrentPageInfo().pageNumber,this};So.AcroFormChoiceField=kg,So.AcroFormListBox=Og,So.AcroFormComboBox=Ug,So.AcroFormEditBox=yv,So.AcroFormButton=$a,So.AcroFormPushButton=_v,So.AcroFormRadioButton=Ng,So.AcroFormCheckBox=bv,So.AcroFormTextField=zf,So.AcroFormPasswordField=xv,So.AcroFormAppearance=pi,So.AcroForm={ChoiceField:kg,ListBox:Og,ComboBox:Ug,EditBox:yv,Button:$a,PushButton:_v,RadioButton:Ng,CheckBox:bv,TextField:zf,PasswordField:xv,Appearance:pi},Gi.AcroForm={ChoiceField:kg,ListBox:Og,ComboBox:Ug,EditBox:yv,Button:$a,PushButton:_v,RadioButton:Ng,CheckBox:bv,TextField:zf,PasswordField:xv,Appearance:pi};function yD(r){return r.reduce(function(e,t,i){return e[t]=i,e},{})}(function(r){r.__addimage__={};var e="UNKNOWN",t={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},i=r.__addimage__.getImageFileTypeByImageData=function(ke,De){var Ye,Xe,Ct,Et,Pt,bt=e;if((De=De||e)==="RGBA"||ke.data!==void 0&&ke.data instanceof Uint8ClampedArray&&"height"in ke&&"width"in ke)return"RGBA";if(je(ke))for(Pt in t)for(Ct=t[Pt],Ye=0;Ye<Ct.length;Ye+=1){for(Et=!0,Xe=0;Xe<Ct[Ye].length;Xe+=1)if(Ct[Ye][Xe]!==void 0&&Ct[Ye][Xe]!==ke[Xe]){Et=!1;break}if(Et===!0){bt=Pt;break}}else for(Pt in t)for(Ct=t[Pt],Ye=0;Ye<Ct.length;Ye+=1){for(Et=!0,Xe=0;Xe<Ct[Ye].length;Xe+=1)if(Ct[Ye][Xe]!==void 0&&Ct[Ye][Xe]!==ke.charCodeAt(Xe)){Et=!1;break}if(Et===!0){bt=Pt;break}}return bt===e&&De!==e&&(bt=De),bt},n=function ke(De){for(var Ye=this.internal.write,Xe=this.internal.putStream,Ct=(0,this.internal.getFilters)();Ct.indexOf("FlateEncode")!==-1;)Ct.splice(Ct.indexOf("FlateEncode"),1);De.objectId=this.internal.newObject();var Et=[];if(Et.push({key:"Type",value:"/XObject"}),Et.push({key:"Subtype",value:"/Image"}),Et.push({key:"Width",value:De.width}),Et.push({key:"Height",value:De.height}),De.colorSpace===he.INDEXED?Et.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(De.palette.length/3-1)+" "+("sMask"in De&&De.sMask!==void 0?De.objectId+2:De.objectId+1)+" 0 R]"}):(Et.push({key:"ColorSpace",value:"/"+De.colorSpace}),De.colorSpace===he.DEVICE_CMYK&&Et.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),Et.push({key:"BitsPerComponent",value:De.bitsPerComponent}),"decodeParameters"in De&&De.decodeParameters!==void 0&&Et.push({key:"DecodeParms",value:"<<"+De.decodeParameters+">>"}),"transparency"in De&&Array.isArray(De.transparency)){for(var Pt="",bt=0,Rt=De.transparency.length;bt<Rt;bt++)Pt+=De.transparency[bt]+" "+De.transparency[bt]+" ";Et.push({key:"Mask",value:"["+Pt+"]"})}De.sMask!==void 0&&Et.push({key:"SMask",value:De.objectId+1+" 0 R"});var Ft=De.filter!==void 0?["/"+De.filter]:void 0;if(Xe({data:De.data,additionalKeyValues:Et,alreadyAppliedFilters:Ft,objectId:De.objectId}),Ye("endobj"),"sMask"in De&&De.sMask!==void 0){var Zt="/Predictor "+De.predictor+" /Colors 1 /BitsPerComponent "+De.bitsPerComponent+" /Columns "+De.width,Le={width:De.width,height:De.height,colorSpace:"DeviceGray",bitsPerComponent:De.bitsPerComponent,decodeParameters:Zt,data:De.sMask};"filter"in De&&(Le.filter=De.filter),ke.call(this,Le)}if(De.colorSpace===he.INDEXED){var Ze=this.internal.newObject();Xe({data:Ne(new Uint8Array(De.palette)),objectId:Ze}),Ye("endobj")}},o=function(){var ke=this.internal.collections.addImage_images;for(var De in ke)n.call(this,ke[De])},a=function(){var ke,De=this.internal.collections.addImage_images,Ye=this.internal.write;for(var Xe in De)Ye("/I"+(ke=De[Xe]).index,ke.objectId,"0","R")},s=function(){this.internal.collections.addImage_images||(this.internal.collections.addImage_images={},this.internal.events.subscribe("putResources",o),this.internal.events.subscribe("putXobjectDict",a))},g=function(){var ke=this.internal.collections.addImage_images;return s.call(this),ke},y=function(){return Object.keys(this.internal.collections.addImage_images).length},T=function(ke){return typeof r["process"+ke.toUpperCase()]=="function"},I=function(ke){return ts(ke)==="object"&&ke.nodeType===1},R=function(ke,De){if(ke.nodeName==="IMG"&&ke.hasAttribute("src")){var Ye=""+ke.getAttribute("src");if(Ye.indexOf("data:image/")===0)return Yy(unescape(Ye).split("base64,").pop());var Xe=r.loadFile(Ye,!0);if(Xe!==void 0)return Xe}if(ke.nodeName==="CANVAS"){if(ke.width===0||ke.height===0)throw new Error("Given canvas must have data. Canvas width: "+ke.width+", height: "+ke.height);var Ct;switch(De){case"PNG":Ct="image/png";break;case"WEBP":Ct="image/webp";break;case"JPEG":case"JPG":default:Ct="image/jpeg"}return Yy(ke.toDataURL(Ct,1).split("base64,").pop())}},U=function(ke){var De=this.internal.collections.addImage_images;if(De){for(var Ye in De)if(ke===De[Ye].alias)return De[Ye]}},Z=function(ke,De,Ye){return ke||De||(ke=-96,De=-96),ke<0&&(ke=-1*Ye.width*72/ke/this.internal.scaleFactor),De<0&&(De=-1*Ye.height*72/De/this.internal.scaleFactor),ke===0&&(ke=De*Ye.width/Ye.height),De===0&&(De=ke*Ye.height/Ye.width),[ke,De]},Y=function(ke,De,Ye,Xe,Ct,Et){var Pt=Z.call(this,Ye,Xe,Ct),bt=this.internal.getCoordinateString,Rt=this.internal.getVerticalCoordinateString,Ft=g.call(this);if(Ye=Pt[0],Xe=Pt[1],Ft[Ct.index]=Ct,Et){Et*=Math.PI/180;var Zt=Math.cos(Et),Le=Math.sin(Et),Ze=function(pt){return pt.toFixed(4)},rt=[Ze(Zt),Ze(Le),Ze(-1*Le),Ze(Zt),0,0,"cm"]}this.internal.write("q"),Et?(this.internal.write([1,"0","0",1,bt(ke),Rt(De+Xe),"cm"].join(" ")),this.internal.write(rt.join(" ")),this.internal.write([bt(Ye),"0","0",bt(Xe),"0","0","cm"].join(" "))):this.internal.write([bt(Ye),"0","0",bt(Xe),bt(ke),Rt(De+Xe),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Ct.index+" Do"),this.internal.write("Q")},he=r.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};r.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var ce=r.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},pe=r.__addimage__.sHashCode=function(ke){var De,Ye,Xe=0;if(typeof ke=="string")for(Ye=ke.length,De=0;De<Ye;De++)Xe=(Xe<<5)-Xe+ke.charCodeAt(De),Xe|=0;else if(je(ke))for(Ye=ke.byteLength/2,De=0;De<Ye;De++)Xe=(Xe<<5)-Xe+ke[De],Xe|=0;return Xe},be=r.__addimage__.validateStringAsBase64=function(ke){(ke=ke||"").toString().trim();var De=!0;return ke.length===0&&(De=!1),ke.length%4!=0&&(De=!1),/^[A-Za-z0-9+/]+$/.test(ke.substr(0,ke.length-2))===!1&&(De=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(ke.substr(-2))===!1&&(De=!1),De},Te=r.__addimage__.extractImageFromDataUrl=function(ke){var De=(ke=ke||"").split("base64,"),Ye=null;if(De.length===2){var Xe=/^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(De[0]);Array.isArray(Xe)&&(Ye={mimeType:Xe[1],charset:Xe[2],data:De[1]})}return Ye},qe=r.__addimage__.supportsArrayBuffer=function(){return typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"};r.__addimage__.isArrayBuffer=function(ke){return qe()&&ke instanceof ArrayBuffer};var je=r.__addimage__.isArrayBufferView=function(ke){return qe()&&typeof Uint32Array<"u"&&(ke instanceof Int8Array||ke instanceof Uint8Array||typeof Uint8ClampedArray<"u"&&ke instanceof Uint8ClampedArray||ke instanceof Int16Array||ke instanceof Uint16Array||ke instanceof Int32Array||ke instanceof Uint32Array||ke instanceof Float32Array||ke instanceof Float64Array)},We=r.__addimage__.binaryStringToUint8Array=function(ke){for(var De=ke.length,Ye=new Uint8Array(De),Xe=0;Xe<De;Xe++)Ye[Xe]=ke.charCodeAt(Xe);return Ye},Ne=r.__addimage__.arrayBufferToBinaryString=function(ke){for(var De="",Ye=je(ke)?ke:new Uint8Array(ke),Xe=0;Xe<Ye.length;Xe+=8192)De+=String.fromCharCode.apply(null,Ye.subarray(Xe,Xe+8192));return De};r.addImage=function(){var ke,De,Ye,Xe,Ct,Et,Pt,bt,Rt;if(typeof arguments[1]=="number"?(De=e,Ye=arguments[1],Xe=arguments[2],Ct=arguments[3],Et=arguments[4],Pt=arguments[5],bt=arguments[6],Rt=arguments[7]):(De=arguments[1],Ye=arguments[2],Xe=arguments[3],Ct=arguments[4],Et=arguments[5],Pt=arguments[6],bt=arguments[7],Rt=arguments[8]),ts(ke=arguments[0])==="object"&&!I(ke)&&"imageData"in ke){var Ft=ke;ke=Ft.imageData,De=Ft.format||De||e,Ye=Ft.x||Ye||0,Xe=Ft.y||Xe||0,Ct=Ft.w||Ft.width||Ct,Et=Ft.h||Ft.height||Et,Pt=Ft.alias||Pt,bt=Ft.compression||bt,Rt=Ft.rotation||Ft.angle||Rt}var Zt=this.internal.getFilters();if(bt===void 0&&Zt.indexOf("FlateEncode")!==-1&&(bt="SLOW"),isNaN(Ye)||isNaN(Xe))throw new Error("Invalid coordinates passed to jsPDF.addImage");s.call(this);var Le=at.call(this,ke,De,Pt,bt);return Y.call(this,Ye,Xe,Ct,Et,Le,Rt),this};var at=function(ke,De,Ye,Xe){var Ct,Et,Pt;if(typeof ke=="string"&&i(ke)===e){ke=unescape(ke);var bt=nt(ke,!1);(bt!==""||(bt=r.loadFile(ke,!0))!==void 0)&&(ke=bt)}if(I(ke)&&(ke=R(ke,De)),De=i(ke,De),!T(De))throw new Error("addImage does not support files of type '"+De+"', please ensure that a plugin for '"+De+"' support is added.");if(((Pt=Ye)==null||Pt.length===0)&&(Ye=function(Rt){return typeof Rt=="string"||je(Rt)?pe(Rt):je(Rt.data)?pe(Rt.data):null}(ke)),(Ct=U.call(this,Ye))||(qe()&&(ke instanceof Uint8Array||De==="RGBA"||(Et=ke,ke=We(ke))),Ct=this["process"+De.toUpperCase()](ke,y.call(this),Ye,function(Rt){return Rt&&typeof Rt=="string"&&(Rt=Rt.toUpperCase()),Rt in r.image_compression?Rt:ce.NONE}(Xe),Et)),!Ct)throw new Error("An unknown error occurred whilst processing the image.");return Ct},nt=r.__addimage__.convertBase64ToBinaryString=function(ke,De){var Ye;De=typeof De!="boolean"||De;var Xe,Ct="";if(typeof ke=="string"){Xe=(Ye=Te(ke))!==null?Ye.data:ke;try{Ct=Yy(Xe)}catch(Et){if(De)throw be(Xe)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+Et.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Ct};r.getImageProperties=function(ke){var De,Ye,Xe="";if(I(ke)&&(ke=R(ke)),typeof ke=="string"&&i(ke)===e&&((Xe=nt(ke,!1))===""&&(Xe=r.loadFile(ke)||""),ke=Xe),Ye=i(ke),!T(Ye))throw new Error("addImage does not support files of type '"+Ye+"', please ensure that a plugin for '"+Ye+"' support is added.");if(!qe()||ke instanceof Uint8Array||(ke=We(ke)),!(De=this["process"+Ye.toUpperCase()](ke)))throw new Error("An unknown error occurred whilst processing the image");return De.fileType=Ye,De}})(Gi.API),function(r){var e=function(t){if(t!==void 0&&t!="")return!0};Gi.API.events.push(["addPage",function(t){this.internal.getPageInfo(t.pageNumber).pageContext.annotations=[]}]),r.events.push(["putPage",function(t){for(var i,n,o,a=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,g=this.internal.getPageInfoByObjId(t.objId),y=t.pageContext.annotations,T=!1,I=0;I<y.length&&!T;I++)switch((i=y[I]).type){case"link":(e(i.options.url)||e(i.options.pageNumber))&&(T=!0);break;case"reference":case"text":case"freetext":T=!0}if(T!=0){this.internal.write("/Annots [");for(var R=0;R<y.length;R++){i=y[R];var U=this.internal.pdfEscape,Z=this.internal.getEncryptor(t.objId);switch(i.type){case"reference":this.internal.write(" "+i.object.objId+" 0 R ");break;case"text":var Y=this.internal.newAdditionalObject(),he=this.internal.newAdditionalObject(),ce=this.internal.getEncryptor(Y.objId),pe=i.title||"Note";o="<</Type /Annot /Subtype /Text "+(n="/Rect ["+a(i.bounds.x)+" "+s(i.bounds.y+i.bounds.h)+" "+a(i.bounds.x+i.bounds.w)+" "+s(i.bounds.y)+"] ")+"/Contents ("+U(ce(i.contents))+")",o+=" /Popup "+he.objId+" 0 R",o+=" /P "+g.objId+" 0 R",o+=" /T ("+U(ce(pe))+") >>",Y.content=o;var be=Y.objId+" 0 R";o="<</Type /Annot /Subtype /Popup "+(n="/Rect ["+a(i.bounds.x+30)+" "+s(i.bounds.y+i.bounds.h)+" "+a(i.bounds.x+i.bounds.w+30)+" "+s(i.bounds.y)+"] ")+" /Parent "+be,i.open&&(o+=" /Open true"),o+=" >>",he.content=o,this.internal.write(Y.objId,"0 R",he.objId,"0 R");break;case"freetext":n="/Rect ["+a(i.bounds.x)+" "+s(i.bounds.y)+" "+a(i.bounds.x+i.bounds.w)+" "+s(i.bounds.y+i.bounds.h)+"] ";var Te=i.color||"#000000";o="<</Type /Annot /Subtype /FreeText "+n+"/Contents ("+U(Z(i.contents))+")",o+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+Te+")",o+=" /Border [0 0 0]",o+=" >>",this.internal.write(o);break;case"link":if(i.options.name){var qe=this.annotations._nameMap[i.options.name];i.options.pageNumber=qe.page,i.options.top=qe.y}else i.options.top||(i.options.top=0);if(n="/Rect ["+i.finalBounds.x+" "+i.finalBounds.y+" "+i.finalBounds.w+" "+i.finalBounds.h+"] ",o="",i.options.url)o="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /A <</S /URI /URI ("+U(Z(i.options.url))+") >>";else if(i.options.pageNumber)switch(o="<</Type /Annot /Subtype /Link "+n+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(i.options.pageNumber).objId+" 0 R",i.options.magFactor=i.options.magFactor||"XYZ",i.options.magFactor){case"Fit":o+=" /Fit]";break;case"FitH":o+=" /FitH "+i.options.top+"]";break;case"FitV":i.options.left=i.options.left||0,o+=" /FitV "+i.options.left+"]";break;case"XYZ":default:var je=s(i.options.top);i.options.left=i.options.left||0,i.options.zoom===void 0&&(i.options.zoom=0),o+=" /XYZ "+i.options.left+" "+je+" "+i.options.zoom+"]"}o!=""&&(o+=" >>",this.internal.write(o))}}this.internal.write("]")}}]),r.createAnnotation=function(t){var i=this.internal.getCurrentPageInfo();switch(t.type){case"link":this.link(t.bounds.x,t.bounds.y,t.bounds.w,t.bounds.h,t);break;case"text":case"freetext":i.pageContext.annotations.push(t)}},r.link=function(t,i,n,o,a){var s=this.internal.getCurrentPageInfo(),g=this.internal.getCoordinateString,y=this.internal.getVerticalCoordinateString;s.pageContext.annotations.push({finalBounds:{x:g(t),y:y(i),w:g(t+n),h:y(i+o)},options:a,type:"link"})},r.textWithLink=function(t,i,n,o){var a,s,g=this.getTextWidth(t),y=this.internal.getLineHeight()/this.internal.scaleFactor;if(o.maxWidth!==void 0){s=o.maxWidth;var T=this.splitTextToSize(t,s).length;a=Math.ceil(y*T)}else s=g,a=y;return this.text(t,i,n,o),n+=.2*y,o.align==="center"&&(i-=g/2),o.align==="right"&&(i-=g),this.link(i,n-y,s,a,o),g},r.getTextWidth=function(t){var i=this.internal.getFontSize();return this.getStringUnitWidth(t)*i/this.internal.scaleFactor}}(Gi.API),function(r){var e={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},t={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},i={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},n=[1570,1571,1573,1575];r.__arabicParser__={};var o=r.__arabicParser__.isInArabicSubstitutionA=function(Y){return e[Y.charCodeAt(0)]!==void 0},a=r.__arabicParser__.isArabicLetter=function(Y){return typeof Y=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(Y)},s=r.__arabicParser__.isArabicEndLetter=function(Y){return a(Y)&&o(Y)&&e[Y.charCodeAt(0)].length<=2},g=r.__arabicParser__.isArabicAlfLetter=function(Y){return a(Y)&&n.indexOf(Y.charCodeAt(0))>=0};r.__arabicParser__.arabicLetterHasIsolatedForm=function(Y){return a(Y)&&o(Y)&&e[Y.charCodeAt(0)].length>=1};var y=r.__arabicParser__.arabicLetterHasFinalForm=function(Y){return a(Y)&&o(Y)&&e[Y.charCodeAt(0)].length>=2};r.__arabicParser__.arabicLetterHasInitialForm=function(Y){return a(Y)&&o(Y)&&e[Y.charCodeAt(0)].length>=3};var T=r.__arabicParser__.arabicLetterHasMedialForm=function(Y){return a(Y)&&o(Y)&&e[Y.charCodeAt(0)].length==4},I=r.__arabicParser__.resolveLigatures=function(Y){var he=0,ce=t,pe="",be=0;for(he=0;he<Y.length;he+=1)ce[Y.charCodeAt(he)]!==void 0?(be++,typeof(ce=ce[Y.charCodeAt(he)])=="number"&&(pe+=String.fromCharCode(ce),ce=t,be=0),he===Y.length-1&&(ce=t,pe+=Y.charAt(he-(be-1)),he-=be-1,be=0)):(ce=t,pe+=Y.charAt(he-be),he-=be,be=0);return pe};r.__arabicParser__.isArabicDiacritic=function(Y){return Y!==void 0&&i[Y.charCodeAt(0)]!==void 0};var R=r.__arabicParser__.getCorrectForm=function(Y,he,ce){return a(Y)?o(Y)===!1?-1:!y(Y)||!a(he)&&!a(ce)||!a(ce)&&s(he)||s(Y)&&!a(he)||s(Y)&&g(he)||s(Y)&&s(he)?0:T(Y)&&a(he)&&!s(he)&&a(ce)&&y(ce)?3:s(Y)||!a(ce)?1:2:-1},U=function(Y){var he=0,ce=0,pe=0,be="",Te="",qe="",je=(Y=Y||"").split("\\s+"),We=[];for(he=0;he<je.length;he+=1){for(We.push(""),ce=0;ce<je[he].length;ce+=1)be=je[he][ce],Te=je[he][ce-1],qe=je[he][ce+1],a(be)?(pe=R(be,Te,qe),We[he]+=pe!==-1?String.fromCharCode(e[be.charCodeAt(0)][pe]):be):We[he]+=be;We[he]=I(We[he])}return We.join(" ")},Z=r.__arabicParser__.processArabic=r.processArabic=function(){var Y,he=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,ce=[];if(Array.isArray(he)){var pe=0;for(ce=[],pe=0;pe<he.length;pe+=1)Array.isArray(he[pe])?ce.push([U(he[pe][0]),he[pe][1],he[pe][2]]):ce.push([U(he[pe])]);Y=ce}else Y=U(he);return typeof arguments[0]=="string"?Y:(arguments[0].text=Y,arguments[0])};r.events.push(["preProcessText",Z])}(Gi.API),Gi.API.autoPrint=function(r){var e;switch((r=r||{}).variant=r.variant||"non-conform",r.variant){case"javascript":this.addJS("print({});");break;case"non-conform":default:this.internal.events.subscribe("postPutResources",function(){e=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+e+" 0 R")})}return this},function(r){var e=function(){var t=void 0;Object.defineProperty(this,"pdf",{get:function(){return t},set:function(s){t=s}});var i=150;Object.defineProperty(this,"width",{get:function(){return i},set:function(s){i=isNaN(s)||Number.isInteger(s)===!1||s<0?150:s,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=i+1)}});var n=300;Object.defineProperty(this,"height",{get:function(){return n},set:function(s){n=isNaN(s)||Number.isInteger(s)===!1||s<0?300:s,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=n+1)}});var o=[];Object.defineProperty(this,"childNodes",{get:function(){return o},set:function(s){o=s}});var a={};Object.defineProperty(this,"style",{get:function(){return a},set:function(s){a=s}}),Object.defineProperty(this,"parentNode",{})};e.prototype.getContext=function(t,i){var n;if((t=t||"2d")!=="2d")return null;for(n in i)this.pdf.context2d.hasOwnProperty(n)&&(this.pdf.context2d[n]=i[n]);return this.pdf.context2d._canvas=this,this.pdf.context2d},e.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},r.events.push(["initialized",function(){this.canvas=new e,this.canvas.pdf=this}])}(Gi.API),function(r){var e={left:0,top:0,bottom:0,right:0},t=!1,i=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},e),this.internal.__cell__.margins.width=this.getPageWidth(),n.call(this))},n=function(){this.internal.__cell__.lastCell=new o,this.internal.__cell__.pages=1},o=function(){var g=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return g},set:function(Y){g=Y}});var y=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return y},set:function(Y){y=Y}});var T=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return T},set:function(Y){T=Y}});var I=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return I},set:function(Y){I=Y}});var R=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return R},set:function(Y){R=Y}});var U=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return U},set:function(Y){U=Y}});var Z=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return Z},set:function(Y){Z=Y}}),this};o.prototype.clone=function(){return new o(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},o.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},r.setHeaderFunction=function(g){return i.call(this),this.internal.__cell__.headerFunction=typeof g=="function"?g:void 0,this},r.getTextDimensions=function(g,y){i.call(this);var T=(y=y||{}).fontSize||this.getFontSize(),I=y.font||this.getFont(),R=y.scaleFactor||this.internal.scaleFactor,U=0,Z=0,Y=0,he=this;if(!Array.isArray(g)&&typeof g!="string"){if(typeof g!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");g=String(g)}var ce=y.maxWidth;ce>0?typeof g=="string"?g=this.splitTextToSize(g,ce):Object.prototype.toString.call(g)==="[object Array]"&&(g=g.reduce(function(be,Te){return be.concat(he.splitTextToSize(Te,ce))},[])):g=Array.isArray(g)?g:[g];for(var pe=0;pe<g.length;pe++)U<(Y=this.getStringUnitWidth(g[pe],{font:I})*T)&&(U=Y);return U!==0&&(Z=g.length),{w:U/=R,h:Math.max((Z*T*this.getLineHeightFactor()-T*(this.getLineHeightFactor()-1))/R,0)}},r.cellAddPage=function(){i.call(this),this.addPage();var g=this.internal.__cell__.margins||e;return this.internal.__cell__.lastCell=new o(g.left,g.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var a=r.cell=function(){var g;g=arguments[0]instanceof o?arguments[0]:new o(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),i.call(this);var y=this.internal.__cell__.lastCell,T=this.internal.__cell__.padding,I=this.internal.__cell__.margins||e,R=this.internal.__cell__.tableHeaderRow,U=this.internal.__cell__.printHeaders;return y.lineNumber!==void 0&&(y.lineNumber===g.lineNumber?(g.x=(y.x||0)+(y.width||0),g.y=y.y||0):y.y+y.height+g.height+I.bottom>this.getPageHeight()?(this.cellAddPage(),g.y=I.top,U&&R&&(this.printHeaderRow(g.lineNumber,!0),g.y+=R[0].height)):g.y=y.y+y.height||g.y),g.text[0]!==void 0&&(this.rect(g.x,g.y,g.width,g.height,t===!0?"FD":void 0),g.align==="right"?this.text(g.text,g.x+g.width-T,g.y+T,{align:"right",baseline:"top"}):g.align==="center"?this.text(g.text,g.x+g.width/2,g.y+T,{align:"center",baseline:"top",maxWidth:g.width-T-T}):this.text(g.text,g.x+T,g.y+T,{align:"left",baseline:"top",maxWidth:g.width-T-T})),this.internal.__cell__.lastCell=g,this};r.table=function(g,y,T,I,R){if(i.call(this),!T)throw new Error("No data for PDF table.");var U,Z,Y,he,ce=[],pe=[],be=[],Te={},qe={},je=[],We=[],Ne=(R=R||{}).autoSize||!1,at=R.printHeaders!==!1,nt=R.css&&R.css["font-size"]!==void 0?16*R.css["font-size"]:R.fontSize||12,ke=R.margins||Object.assign({width:this.getPageWidth()},e),De=typeof R.padding=="number"?R.padding:3,Ye=R.headerBackgroundColor||"#c8c8c8",Xe=R.headerTextColor||"#000";if(n.call(this),this.internal.__cell__.printHeaders=at,this.internal.__cell__.margins=ke,this.internal.__cell__.table_font_size=nt,this.internal.__cell__.padding=De,this.internal.__cell__.headerBackgroundColor=Ye,this.internal.__cell__.headerTextColor=Xe,this.setFontSize(nt),I==null)pe=ce=Object.keys(T[0]),be=ce.map(function(){return"left"});else if(Array.isArray(I)&&ts(I[0])==="object")for(ce=I.map(function(Ft){return Ft.name}),pe=I.map(function(Ft){return Ft.prompt||Ft.name||""}),be=I.map(function(Ft){return Ft.align||"left"}),U=0;U<I.length;U+=1)qe[I[U].name]=I[U].width*(19.049976/25.4);else Array.isArray(I)&&typeof I[0]=="string"&&(pe=ce=I,be=ce.map(function(){return"left"}));if(Ne||Array.isArray(I)&&typeof I[0]=="string")for(U=0;U<ce.length;U+=1){for(Te[he=ce[U]]=T.map(function(Ft){return Ft[he]}),this.setFont(void 0,"bold"),je.push(this.getTextDimensions(pe[U],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),Z=Te[he],this.setFont(void 0,"normal"),Y=0;Y<Z.length;Y+=1)je.push(this.getTextDimensions(Z[Y],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);qe[he]=Math.max.apply(null,je)+De+De,je=[]}if(at){var Ct={};for(U=0;U<ce.length;U+=1)Ct[ce[U]]={},Ct[ce[U]].text=pe[U],Ct[ce[U]].align=be[U];var Et=s.call(this,Ct,qe);We=ce.map(function(Ft){return new o(g,y,qe[Ft],Et,Ct[Ft].text,void 0,Ct[Ft].align)}),this.setTableHeaderRow(We),this.printHeaderRow(1,!1)}var Pt=I.reduce(function(Ft,Zt){return Ft[Zt.name]=Zt.align,Ft},{});for(U=0;U<T.length;U+=1){"rowStart"in R&&R.rowStart instanceof Function&&R.rowStart({row:U,data:T[U]},this);var bt=s.call(this,T[U],qe);for(Y=0;Y<ce.length;Y+=1){var Rt=T[U][ce[Y]];"cellStart"in R&&R.cellStart instanceof Function&&R.cellStart({row:U,col:Y,data:Rt},this),a.call(this,new o(g,y,qe[ce[Y]],bt,Rt,U+2,Pt[ce[Y]]))}}return this.internal.__cell__.table_x=g,this.internal.__cell__.table_y=y,this};var s=function(g,y){var T=this.internal.__cell__.padding,I=this.internal.__cell__.table_font_size,R=this.internal.scaleFactor;return Object.keys(g).map(function(U){var Z=g[U];return this.splitTextToSize(Z.hasOwnProperty("text")?Z.text:Z,y[U]-T-T)},this).map(function(U){return this.getLineHeightFactor()*U.length*I/R+T+T},this).reduce(function(U,Z){return Math.max(U,Z)},0)};r.setTableHeaderRow=function(g){i.call(this),this.internal.__cell__.tableHeaderRow=g},r.printHeaderRow=function(g,y){if(i.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var T;if(t=!0,typeof this.internal.__cell__.headerFunction=="function"){var I=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new o(I[0],I[1],I[2],I[3],void 0,-1)}this.setFont(void 0,"bold");for(var R=[],U=0;U<this.internal.__cell__.tableHeaderRow.length;U+=1){T=this.internal.__cell__.tableHeaderRow[U].clone(),y&&(T.y=this.internal.__cell__.margins.top||0,R.push(T)),T.lineNumber=g;var Z=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),a.call(this,T),this.setTextColor(Z)}R.length>0&&this.setTableHeaderRow(R),this.setFont(void 0,"normal"),t=!1}}(Gi.API);var _D={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},vD=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],rE=yD(vD),bD=[100,200,300,400,500,600,700,800,900],wne=yD(bD);function iE(r){var e=r.family.replace(/"|'/g,"").toLowerCase(),t=function(o){return _D[o=o||"normal"]?o:"normal"}(r.style),i=function(o){if(!o)return 400;if(typeof o=="number")return o>=100&&o<=900&&o%100==0?o:400;if(/^\d00$/.test(o))return parseInt(o);switch(o){case"bold":return 700;case"normal":default:return 400}}(r.weight),n=function(o){return typeof rE[o=o||"normal"]=="number"?o:"normal"}(r.stretch);return{family:e,style:t,weight:i,stretch:n,src:r.src||[],ref:r.ref||{name:e,style:[n,t,i].join(" ")}}}function xD(r,e,t,i){var n;for(n=t;n>=0&&n<e.length;n+=i)if(r[e[n]])return r[e[n]];for(n=t;n>=0&&n<e.length;n-=i)if(r[e[n]])return r[e[n]]}var Bne={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},wD={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function BD(r){return[r.stretch,r.style,r.weight,r.family].join(" ")}function Cne(r,e,t){for(var i=(t=t||{}).defaultFontFamily||"times",n=Object.assign({},Bne,t.genericFontFamilies||{}),o=null,a=null,s=0;s<e.length;++s)if(n[(o=iE(e[s])).family]&&(o.family=n[o.family]),r.hasOwnProperty(o.family)){a=r[o.family];break}if(!(a=a||r[i]))throw new Error("Could not find a font-family for the rule '"+BD(o)+"' and default family '"+i+"'.");if(a=function(g,y){if(y[g])return y[g];var T=rE[g],I=T<=rE.normal?-1:1,R=xD(y,vD,T,I);if(!R)throw new Error("Could not find a matching font-stretch value for "+g);return R}(o.stretch,a),a=function(g,y){if(y[g])return y[g];for(var T=_D[g],I=0;I<T.length;++I)if(y[T[I]])return y[T[I]];throw new Error("Could not find a matching font-style for "+g)}(o.style,a),!(a=function(g,y){if(y[g])return y[g];if(g===400&&y[500])return y[500];if(g===500&&y[400])return y[400];var T=wne[g],I=xD(y,bD,T,g<400?-1:1);if(!I)throw new Error("Could not find a matching font-weight for value "+g);return I}(o.weight,a)))throw new Error("Failed to resolve a font for the rule '"+BD(o)+"'.");return a}function CD(r){return r.trimLeft()}function Ene(r,e){for(var t=0;t<r.length;){if(r.charAt(t)===e)return[r.substring(0,t),r.substring(t+1)];t+=1}return null}function Sne(r){var e=r.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return e===null?null:[e[0],r.substring(e[0].length)]}var wv,ED,SD,TD=["times"];(function(r){var e,t,i,n,o,a,s,g,y,T=function(Le){return Le=Le||{},this.isStrokeTransparent=Le.isStrokeTransparent||!1,this.strokeOpacity=Le.strokeOpacity||1,this.strokeStyle=Le.strokeStyle||"#000000",this.fillStyle=Le.fillStyle||"#000000",this.isFillTransparent=Le.isFillTransparent||!1,this.fillOpacity=Le.fillOpacity||1,this.font=Le.font||"10px sans-serif",this.textBaseline=Le.textBaseline||"alphabetic",this.textAlign=Le.textAlign||"left",this.lineWidth=Le.lineWidth||1,this.lineJoin=Le.lineJoin||"miter",this.lineCap=Le.lineCap||"butt",this.path=Le.path||[],this.transform=Le.transform!==void 0?Le.transform.clone():new g,this.globalCompositeOperation=Le.globalCompositeOperation||"normal",this.globalAlpha=Le.globalAlpha||1,this.clip_path=Le.clip_path||[],this.currentPoint=Le.currentPoint||new a,this.miterLimit=Le.miterLimit||10,this.lastPoint=Le.lastPoint||new a,this.lineDashOffset=Le.lineDashOffset||0,this.lineDash=Le.lineDash||[],this.margin=Le.margin||[0,0,0,0],this.prevPageLastElemOffset=Le.prevPageLastElemOffset||0,this.ignoreClearRect=typeof Le.ignoreClearRect!="boolean"||Le.ignoreClearRect,this};r.events.push(["initialized",function(){this.context2d=new I(this),e=this.internal.f2,t=this.internal.getCoordinateString,i=this.internal.getVerticalCoordinateString,n=this.internal.getHorizontalCoordinate,o=this.internal.getVerticalCoordinate,a=this.internal.Point,s=this.internal.Rectangle,g=this.internal.Matrix,y=new T}]);var I=function(Le){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Ze=Le;Object.defineProperty(this,"pdf",{get:function(){return Ze}});var rt=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return rt},set:function(kt){rt=!!kt}});var pt=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return pt},set:function(kt){pt=!!kt}});var mt=0;Object.defineProperty(this,"posX",{get:function(){return mt},set:function(kt){isNaN(kt)||(mt=kt)}});var Bt=0;Object.defineProperty(this,"posY",{get:function(){return Bt},set:function(kt){isNaN(kt)||(Bt=kt)}}),Object.defineProperty(this,"margin",{get:function(){return y.margin},set:function(kt){var lt;typeof kt=="number"?lt=[kt,kt,kt,kt]:((lt=new Array(4))[0]=kt[0],lt[1]=kt.length>=2?kt[1]:lt[0],lt[2]=kt.length>=3?kt[2]:lt[0],lt[3]=kt.length>=4?kt[3]:lt[1]),y.margin=lt}});var Dt=!1;Object.defineProperty(this,"autoPaging",{get:function(){return Dt},set:function(kt){Dt=kt}});var Mt=0;Object.defineProperty(this,"lastBreak",{get:function(){return Mt},set:function(kt){Mt=kt}});var qt=[];Object.defineProperty(this,"pageBreaks",{get:function(){return qt},set:function(kt){qt=kt}}),Object.defineProperty(this,"ctx",{get:function(){return y},set:function(kt){kt instanceof T&&(y=kt)}}),Object.defineProperty(this,"path",{get:function(){return y.path},set:function(kt){y.path=kt}});var nr=[];Object.defineProperty(this,"ctxStack",{get:function(){return nr},set:function(kt){nr=kt}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(kt){var lt;lt=R(kt),this.ctx.fillStyle=lt.style,this.ctx.isFillTransparent=lt.a===0,this.ctx.fillOpacity=lt.a,this.pdf.setFillColor(lt.r,lt.g,lt.b,{a:lt.a}),this.pdf.setTextColor(lt.r,lt.g,lt.b,{a:lt.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(kt){var lt=R(kt);this.ctx.strokeStyle=lt.style,this.ctx.isStrokeTransparent=lt.a===0,this.ctx.strokeOpacity=lt.a,lt.a===0?this.pdf.setDrawColor(255,255,255):(lt.a,this.pdf.setDrawColor(lt.r,lt.g,lt.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(kt){["butt","round","square"].indexOf(kt)!==-1&&(this.ctx.lineCap=kt,this.pdf.setLineCap(kt))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(kt){isNaN(kt)||(this.ctx.lineWidth=kt,this.pdf.setLineWidth(kt))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(kt){["bevel","round","miter"].indexOf(kt)!==-1&&(this.ctx.lineJoin=kt,this.pdf.setLineJoin(kt))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(kt){isNaN(kt)||(this.ctx.miterLimit=kt,this.pdf.setMiterLimit(kt))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(kt){this.ctx.textBaseline=kt}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(kt){["right","end","center","left","start"].indexOf(kt)!==-1&&(this.ctx.textAlign=kt)}});var vr=null;function br(kt,lt){if(vr===null){var wt=function(Ur){var tr=[];return Object.keys(Ur).forEach(function(ht){Ur[ht].forEach(function($t){var or=null;switch($t){case"bold":or={family:ht,weight:"bold"};break;case"italic":or={family:ht,style:"italic"};break;case"bolditalic":or={family:ht,weight:"bold",style:"italic"};break;case"":case"normal":or={family:ht}}or!==null&&(or.ref={name:ht,style:$t},tr.push(or))})}),tr}(kt.getFontList());vr=function(Ur){for(var tr={},ht=0;ht<Ur.length;++ht){var $t=iE(Ur[ht]),or=$t.family,mr=$t.stretch,ur=$t.style,Wr=$t.weight;tr[or]=tr[or]||{},tr[or][mr]=tr[or][mr]||{},tr[or][mr][ur]=tr[or][mr][ur]||{},tr[or][mr][ur][Wr]=$t}return tr}(wt.concat(lt))}return vr}var Fr=null;Object.defineProperty(this,"fontFaces",{get:function(){return Fr},set:function(kt){vr=null,Fr=kt}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(kt){var lt;if(this.ctx.font=kt,(lt=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z]+?)\s*$/i.exec(kt))!==null){var wt=lt[1],Ur=(lt[2],lt[3]),tr=lt[4],ht=(lt[5],lt[6]),$t=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(tr)[2];tr=Math.floor($t==="px"?parseFloat(tr)*this.pdf.internal.scaleFactor:$t==="em"?parseFloat(tr)*this.pdf.getFontSize():parseFloat(tr)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(tr);var or=function(zt){var Xr,Ar,Wt=[],di=zt.trim();if(di==="")return TD;if(di in wD)return[wD[di]];for(;di!=="";){switch(Ar=null,Xr=(di=CD(di)).charAt(0)){case'"':case"'":Ar=Ene(di.substring(1),Xr);break;default:Ar=Sne(di)}if(Ar===null||(Wt.push(Ar[0]),(di=CD(Ar[1]))!==""&&di.charAt(0)!==","))return TD;di=di.replace(/^,/,"")}return Wt}(ht);if(this.fontFaces){var mr=Cne(br(this.pdf,this.fontFaces),or.map(function(zt){return{family:zt,stretch:"normal",weight:Ur,style:wt}}));this.pdf.setFont(mr.ref.name,mr.ref.style)}else{var ur="";(Ur==="bold"||parseInt(Ur,10)>=700||wt==="bold")&&(ur="bold"),wt==="italic"&&(ur+="italic"),ur.length===0&&(ur="normal");for(var Wr="",ri={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},gi=0;gi<or.length;gi++){if(this.pdf.internal.getFont(or[gi],ur,{noFallback:!0,disableWarning:!0})!==void 0){Wr=or[gi];break}if(ur==="bolditalic"&&this.pdf.internal.getFont(or[gi],"bold",{noFallback:!0,disableWarning:!0})!==void 0)Wr=or[gi],ur="bold";else if(this.pdf.internal.getFont(or[gi],"normal",{noFallback:!0,disableWarning:!0})!==void 0){Wr=or[gi],ur="normal";break}}if(Wr===""){for(var Pi=0;Pi<or.length;Pi++)if(ri[or[Pi]]){Wr=ri[or[Pi]];break}}Wr=Wr===""?"Times":Wr,this.pdf.setFont(Wr,ur)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(kt){this.ctx.globalCompositeOperation=kt}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(kt){this.ctx.globalAlpha=kt}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(kt){this.ctx.lineDashOffset=kt,Zt.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(kt){this.ctx.lineDash=kt,Zt.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(kt){this.ctx.ignoreClearRect=!!kt}})};I.prototype.setLineDash=function(Le){this.lineDash=Le},I.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},I.prototype.fill=function(){Te.call(this,"fill",!1)},I.prototype.stroke=function(){Te.call(this,"stroke",!1)},I.prototype.beginPath=function(){this.path=[{type:"begin"}]},I.prototype.moveTo=function(Le,Ze){if(isNaN(Le)||isNaN(Ze))throw Ps.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var rt=this.ctx.transform.applyToPoint(new a(Le,Ze));this.path.push({type:"mt",x:rt.x,y:rt.y}),this.ctx.lastPoint=new a(Le,Ze)},I.prototype.closePath=function(){var Le=new a(0,0),Ze=0;for(Ze=this.path.length-1;Ze!==-1;Ze--)if(this.path[Ze].type==="begin"&&ts(this.path[Ze+1])==="object"&&typeof this.path[Ze+1].x=="number"){Le=new a(this.path[Ze+1].x,this.path[Ze+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new a(Le.x,Le.y)},I.prototype.lineTo=function(Le,Ze){if(isNaN(Le)||isNaN(Ze))throw Ps.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var rt=this.ctx.transform.applyToPoint(new a(Le,Ze));this.path.push({type:"lt",x:rt.x,y:rt.y}),this.ctx.lastPoint=new a(rt.x,rt.y)},I.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),Te.call(this,null,!0)},I.prototype.quadraticCurveTo=function(Le,Ze,rt,pt){if(isNaN(rt)||isNaN(pt)||isNaN(Le)||isNaN(Ze))throw Ps.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var mt=this.ctx.transform.applyToPoint(new a(rt,pt)),Bt=this.ctx.transform.applyToPoint(new a(Le,Ze));this.path.push({type:"qct",x1:Bt.x,y1:Bt.y,x:mt.x,y:mt.y}),this.ctx.lastPoint=new a(mt.x,mt.y)},I.prototype.bezierCurveTo=function(Le,Ze,rt,pt,mt,Bt){if(isNaN(mt)||isNaN(Bt)||isNaN(Le)||isNaN(Ze)||isNaN(rt)||isNaN(pt))throw Ps.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var Dt=this.ctx.transform.applyToPoint(new a(mt,Bt)),Mt=this.ctx.transform.applyToPoint(new a(Le,Ze)),qt=this.ctx.transform.applyToPoint(new a(rt,pt));this.path.push({type:"bct",x1:Mt.x,y1:Mt.y,x2:qt.x,y2:qt.y,x:Dt.x,y:Dt.y}),this.ctx.lastPoint=new a(Dt.x,Dt.y)},I.prototype.arc=function(Le,Ze,rt,pt,mt,Bt){if(isNaN(Le)||isNaN(Ze)||isNaN(rt)||isNaN(pt)||isNaN(mt))throw Ps.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(Bt=!!Bt,!this.ctx.transform.isIdentity){var Dt=this.ctx.transform.applyToPoint(new a(Le,Ze));Le=Dt.x,Ze=Dt.y;var Mt=this.ctx.transform.applyToPoint(new a(0,rt)),qt=this.ctx.transform.applyToPoint(new a(0,0));rt=Math.sqrt(Math.pow(Mt.x-qt.x,2)+Math.pow(Mt.y-qt.y,2))}Math.abs(mt-pt)>=2*Math.PI&&(pt=0,mt=2*Math.PI),this.path.push({type:"arc",x:Le,y:Ze,radius:rt,startAngle:pt,endAngle:mt,counterclockwise:Bt})},I.prototype.arcTo=function(Le,Ze,rt,pt,mt){throw new Error("arcTo not implemented.")},I.prototype.rect=function(Le,Ze,rt,pt){if(isNaN(Le)||isNaN(Ze)||isNaN(rt)||isNaN(pt))throw Ps.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(Le,Ze),this.lineTo(Le+rt,Ze),this.lineTo(Le+rt,Ze+pt),this.lineTo(Le,Ze+pt),this.lineTo(Le,Ze),this.lineTo(Le+rt,Ze),this.lineTo(Le,Ze)},I.prototype.fillRect=function(Le,Ze,rt,pt){if(isNaN(Le)||isNaN(Ze)||isNaN(rt)||isNaN(pt))throw Ps.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!U.call(this)){var mt={};this.lineCap!=="butt"&&(mt.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(mt.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(Le,Ze,rt,pt),this.fill(),mt.hasOwnProperty("lineCap")&&(this.lineCap=mt.lineCap),mt.hasOwnProperty("lineJoin")&&(this.lineJoin=mt.lineJoin)}},I.prototype.strokeRect=function(Le,Ze,rt,pt){if(isNaN(Le)||isNaN(Ze)||isNaN(rt)||isNaN(pt))throw Ps.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");Z.call(this)||(this.beginPath(),this.rect(Le,Ze,rt,pt),this.stroke())},I.prototype.clearRect=function(Le,Ze,rt,pt){if(isNaN(Le)||isNaN(Ze)||isNaN(rt)||isNaN(pt))throw Ps.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(Le,Ze,rt,pt))},I.prototype.save=function(Le){Le=typeof Le!="boolean"||Le;for(var Ze=this.pdf.internal.getCurrentPageInfo().pageNumber,rt=0;rt<this.pdf.internal.getNumberOfPages();rt++)this.pdf.setPage(rt+1),this.pdf.internal.out("q");if(this.pdf.setPage(Ze),Le){this.ctx.fontSize=this.pdf.internal.getFontSize();var pt=new T(this.ctx);this.ctxStack.push(this.ctx),this.ctx=pt}},I.prototype.restore=function(Le){Le=typeof Le!="boolean"||Le;for(var Ze=this.pdf.internal.getCurrentPageInfo().pageNumber,rt=0;rt<this.pdf.internal.getNumberOfPages();rt++)this.pdf.setPage(rt+1),this.pdf.internal.out("Q");this.pdf.setPage(Ze),Le&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},I.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var R=function(Le){var Ze,rt,pt,mt;if(Le.isCanvasGradient===!0&&(Le=Le.getColor()),!Le)return{r:0,g:0,b:0,a:0,style:Le};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(Le))Ze=0,rt=0,pt=0,mt=0;else{var Bt=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(Le);if(Bt!==null)Ze=parseInt(Bt[1]),rt=parseInt(Bt[2]),pt=parseInt(Bt[3]),mt=1;else if((Bt=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(Le))!==null)Ze=parseInt(Bt[1]),rt=parseInt(Bt[2]),pt=parseInt(Bt[3]),mt=parseFloat(Bt[4]);else{if(mt=1,typeof Le=="string"&&Le.charAt(0)!=="#"){var Dt=new lD(Le);Le=Dt.ok?Dt.toHex():"#000000"}Le.length===4?(Ze=Le.substring(1,2),Ze+=Ze,rt=Le.substring(2,3),rt+=rt,pt=Le.substring(3,4),pt+=pt):(Ze=Le.substring(1,3),rt=Le.substring(3,5),pt=Le.substring(5,7)),Ze=parseInt(Ze,16),rt=parseInt(rt,16),pt=parseInt(pt,16)}}return{r:Ze,g:rt,b:pt,a:mt,style:Le}},U=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},Z=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};I.prototype.fillText=function(Le,Ze,rt,pt){if(isNaN(Ze)||isNaN(rt)||typeof Le!="string")throw Ps.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(pt=isNaN(pt)?void 0:pt,!U.call(this)){var mt=bt(this.ctx.transform.rotation),Bt=this.ctx.transform.scaleX;De.call(this,{text:Le,x:Ze,y:rt,scale:Bt,angle:mt,align:this.textAlign,maxWidth:pt})}},I.prototype.strokeText=function(Le,Ze,rt,pt){if(isNaN(Ze)||isNaN(rt)||typeof Le!="string")throw Ps.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!Z.call(this)){pt=isNaN(pt)?void 0:pt;var mt=bt(this.ctx.transform.rotation),Bt=this.ctx.transform.scaleX;De.call(this,{text:Le,x:Ze,y:rt,scale:Bt,renderingMode:"stroke",angle:mt,align:this.textAlign,maxWidth:pt})}},I.prototype.measureText=function(Le){if(typeof Le!="string")throw Ps.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Ze=this.pdf,rt=this.pdf.internal.scaleFactor,pt=Ze.internal.getFontSize(),mt=Ze.getStringUnitWidth(Le)*pt/Ze.internal.scaleFactor,Bt=function(Dt){var Mt=(Dt=Dt||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return Mt}}),this};return new Bt({width:mt*=Math.round(96*rt/72*1e4)/1e4})},I.prototype.scale=function(Le,Ze){if(isNaN(Le)||isNaN(Ze))throw Ps.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var rt=new g(Le,0,0,Ze,0,0);this.ctx.transform=this.ctx.transform.multiply(rt)},I.prototype.rotate=function(Le){if(isNaN(Le))throw Ps.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Ze=new g(Math.cos(Le),Math.sin(Le),-Math.sin(Le),Math.cos(Le),0,0);this.ctx.transform=this.ctx.transform.multiply(Ze)},I.prototype.translate=function(Le,Ze){if(isNaN(Le)||isNaN(Ze))throw Ps.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var rt=new g(1,0,0,1,Le,Ze);this.ctx.transform=this.ctx.transform.multiply(rt)},I.prototype.transform=function(Le,Ze,rt,pt,mt,Bt){if(isNaN(Le)||isNaN(Ze)||isNaN(rt)||isNaN(pt)||isNaN(mt)||isNaN(Bt))throw Ps.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var Dt=new g(Le,Ze,rt,pt,mt,Bt);this.ctx.transform=this.ctx.transform.multiply(Dt)},I.prototype.setTransform=function(Le,Ze,rt,pt,mt,Bt){Le=isNaN(Le)?1:Le,Ze=isNaN(Ze)?0:Ze,rt=isNaN(rt)?0:rt,pt=isNaN(pt)?1:pt,mt=isNaN(mt)?0:mt,Bt=isNaN(Bt)?0:Bt,this.ctx.transform=new g(Le,Ze,rt,pt,mt,Bt)};var Y=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};I.prototype.drawImage=function(Le,Ze,rt,pt,mt,Bt,Dt,Mt,qt){var nr=this.pdf.getImageProperties(Le),vr=1,br=1,Fr=1,kt=1;pt!==void 0&&Mt!==void 0&&(Fr=Mt/pt,kt=qt/mt,vr=nr.width/pt*Mt/pt,br=nr.height/mt*qt/mt),Bt===void 0&&(Bt=Ze,Dt=rt,Ze=0,rt=0),pt!==void 0&&Mt===void 0&&(Mt=pt,qt=mt),pt===void 0&&Mt===void 0&&(Mt=nr.width,qt=nr.height);for(var lt,wt=this.ctx.transform.decompose(),Ur=bt(wt.rotate.shx),tr=new g,ht=(tr=(tr=(tr=tr.multiply(wt.translate)).multiply(wt.skew)).multiply(wt.scale)).applyToRectangle(new s(Bt-Ze*Fr,Dt-rt*kt,pt*vr,mt*br)),$t=he.call(this,ht),or=[],mr=0;mr<$t.length;mr+=1)or.indexOf($t[mr])===-1&&or.push($t[mr]);if(be(or),this.autoPaging)for(var ur=or[0],Wr=or[or.length-1],ri=ur;ri<Wr+1;ri++){this.pdf.setPage(ri);var gi=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Pi=ri===1?this.posY+this.margin[0]:this.margin[0],zt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Xr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Ar=ri===1?0:zt+(ri-2)*Xr;if(this.ctx.clip_path.length!==0){var Wt=this.path;lt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=pe(lt,this.posX+this.margin[3],-Ar+Pi+this.ctx.prevPageLastElemOffset),qe.call(this,"fill",!0),this.path=Wt}var di=JSON.parse(JSON.stringify(ht));di=pe([di],this.posX+this.margin[3],-Ar+Pi+this.ctx.prevPageLastElemOffset)[0];var Qt=(ri>ur||ri<Wr)&&Y.call(this);Qt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],gi,Xr,null).clip().discardPath()),this.pdf.addImage(Le,"JPEG",di.x,di.y,di.w,di.h,null,null,Ur),Qt&&this.pdf.restoreGraphicsState()}else this.pdf.addImage(Le,"JPEG",ht.x,ht.y,ht.w,ht.h,null,null,Ur)};var he=function(Le,Ze,rt){var pt=[];Ze=Ze||this.pdf.internal.pageSize.width,rt=rt||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var mt=this.posY+this.ctx.prevPageLastElemOffset;switch(Le.type){default:case"mt":case"lt":pt.push(Math.floor((Le.y+mt)/rt)+1);break;case"arc":pt.push(Math.floor((Le.y+mt-Le.radius)/rt)+1),pt.push(Math.floor((Le.y+mt+Le.radius)/rt)+1);break;case"qct":var Bt=Rt(this.ctx.lastPoint.x,this.ctx.lastPoint.y,Le.x1,Le.y1,Le.x,Le.y);pt.push(Math.floor((Bt.y+mt)/rt)+1),pt.push(Math.floor((Bt.y+Bt.h+mt)/rt)+1);break;case"bct":var Dt=Ft(this.ctx.lastPoint.x,this.ctx.lastPoint.y,Le.x1,Le.y1,Le.x2,Le.y2,Le.x,Le.y);pt.push(Math.floor((Dt.y+mt)/rt)+1),pt.push(Math.floor((Dt.y+Dt.h+mt)/rt)+1);break;case"rect":pt.push(Math.floor((Le.y+mt)/rt)+1),pt.push(Math.floor((Le.y+Le.h+mt)/rt)+1)}for(var Mt=0;Mt<pt.length;Mt+=1)for(;this.pdf.internal.getNumberOfPages()<pt[Mt];)ce.call(this);return pt},ce=function(){var Le=this.fillStyle,Ze=this.strokeStyle,rt=this.font,pt=this.lineCap,mt=this.lineWidth,Bt=this.lineJoin;this.pdf.addPage(),this.fillStyle=Le,this.strokeStyle=Ze,this.font=rt,this.lineCap=pt,this.lineWidth=mt,this.lineJoin=Bt},pe=function(Le,Ze,rt){for(var pt=0;pt<Le.length;pt++)switch(Le[pt].type){case"bct":Le[pt].x2+=Ze,Le[pt].y2+=rt;case"qct":Le[pt].x1+=Ze,Le[pt].y1+=rt;case"mt":case"lt":case"arc":default:Le[pt].x+=Ze,Le[pt].y+=rt}return Le},be=function(Le){return Le.sort(function(Ze,rt){return Ze-rt})},Te=function(Le,Ze){for(var rt,pt,mt=this.fillStyle,Bt=this.strokeStyle,Dt=this.lineCap,Mt=this.lineWidth,qt=Math.abs(Mt*this.ctx.transform.scaleX),nr=this.lineJoin,vr=JSON.parse(JSON.stringify(this.path)),br=JSON.parse(JSON.stringify(this.path)),Fr=[],kt=0;kt<br.length;kt++)if(br[kt].x!==void 0)for(var lt=he.call(this,br[kt]),wt=0;wt<lt.length;wt+=1)Fr.indexOf(lt[wt])===-1&&Fr.push(lt[wt]);for(var Ur=0;Ur<Fr.length;Ur++)for(;this.pdf.internal.getNumberOfPages()<Fr[Ur];)ce.call(this);if(be(Fr),this.autoPaging)for(var tr=Fr[0],ht=Fr[Fr.length-1],$t=tr;$t<ht+1;$t++){this.pdf.setPage($t),this.fillStyle=mt,this.strokeStyle=Bt,this.lineCap=Dt,this.lineWidth=qt,this.lineJoin=nr;var or=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],mr=$t===1?this.posY+this.margin[0]:this.margin[0],ur=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Wr=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],ri=$t===1?0:ur+($t-2)*Wr;if(this.ctx.clip_path.length!==0){var gi=this.path;rt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=pe(rt,this.posX+this.margin[3],-ri+mr+this.ctx.prevPageLastElemOffset),qe.call(this,Le,!0),this.path=gi}if(pt=JSON.parse(JSON.stringify(vr)),this.path=pe(pt,this.posX+this.margin[3],-ri+mr+this.ctx.prevPageLastElemOffset),Ze===!1||$t===0){var Pi=($t>tr||$t<ht)&&Y.call(this);Pi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],or,Wr,null).clip().discardPath()),qe.call(this,Le,Ze),Pi&&this.pdf.restoreGraphicsState()}this.lineWidth=Mt}else this.lineWidth=qt,qe.call(this,Le,Ze),this.lineWidth=Mt;this.path=vr},qe=function(Le,Ze){if((Le!=="stroke"||Ze||!Z.call(this))&&(Le==="stroke"||Ze||!U.call(this))){for(var rt,pt,mt=[],Bt=this.path,Dt=0;Dt<Bt.length;Dt++){var Mt=Bt[Dt];switch(Mt.type){case"begin":mt.push({begin:!0});break;case"close":mt.push({close:!0});break;case"mt":mt.push({start:Mt,deltas:[],abs:[]});break;case"lt":var qt=mt.length;if(Bt[Dt-1]&&!isNaN(Bt[Dt-1].x)&&(rt=[Mt.x-Bt[Dt-1].x,Mt.y-Bt[Dt-1].y],qt>0)){for(;qt>=0;qt--)if(mt[qt-1].close!==!0&&mt[qt-1].begin!==!0){mt[qt-1].deltas.push(rt),mt[qt-1].abs.push(Mt);break}}break;case"bct":rt=[Mt.x1-Bt[Dt-1].x,Mt.y1-Bt[Dt-1].y,Mt.x2-Bt[Dt-1].x,Mt.y2-Bt[Dt-1].y,Mt.x-Bt[Dt-1].x,Mt.y-Bt[Dt-1].y],mt[mt.length-1].deltas.push(rt);break;case"qct":var nr=Bt[Dt-1].x+2/3*(Mt.x1-Bt[Dt-1].x),vr=Bt[Dt-1].y+2/3*(Mt.y1-Bt[Dt-1].y),br=Mt.x+2/3*(Mt.x1-Mt.x),Fr=Mt.y+2/3*(Mt.y1-Mt.y),kt=Mt.x,lt=Mt.y;rt=[nr-Bt[Dt-1].x,vr-Bt[Dt-1].y,br-Bt[Dt-1].x,Fr-Bt[Dt-1].y,kt-Bt[Dt-1].x,lt-Bt[Dt-1].y],mt[mt.length-1].deltas.push(rt);break;case"arc":mt.push({deltas:[],abs:[],arc:!0}),Array.isArray(mt[mt.length-1].abs)&&mt[mt.length-1].abs.push(Mt)}}pt=Ze?null:Le==="stroke"?"stroke":"fill";for(var wt=!1,Ur=0;Ur<mt.length;Ur++)if(mt[Ur].arc)for(var tr=mt[Ur].abs,ht=0;ht<tr.length;ht++){var $t=tr[ht];$t.type==="arc"?Ne.call(this,$t.x,$t.y,$t.radius,$t.startAngle,$t.endAngle,$t.counterclockwise,void 0,Ze,!wt):Ye.call(this,$t.x,$t.y),wt=!0}else if(mt[Ur].close===!0)this.pdf.internal.out("h"),wt=!1;else if(mt[Ur].begin!==!0){var or=mt[Ur].start.x,mr=mt[Ur].start.y;Xe.call(this,mt[Ur].deltas,or,mr),wt=!0}pt&&at.call(this,pt),Ze&&nt.call(this)}},je=function(Le){var Ze=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,rt=Ze*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return Le-rt;case"top":return Le+Ze-rt;case"hanging":return Le+Ze-2*rt;case"middle":return Le+Ze/2-rt;case"ideographic":return Le;case"alphabetic":default:return Le}},We=function(Le){return Le+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};I.prototype.createLinearGradient=function(){var Le=function(){};return Le.colorStops=[],Le.addColorStop=function(Ze,rt){this.colorStops.push([Ze,rt])},Le.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},Le.isCanvasGradient=!0,Le},I.prototype.createPattern=function(){return this.createLinearGradient()},I.prototype.createRadialGradient=function(){return this.createLinearGradient()};var Ne=function(Le,Ze,rt,pt,mt,Bt,Dt,Mt,qt){for(var nr=Et.call(this,rt,pt,mt,Bt),vr=0;vr<nr.length;vr++){var br=nr[vr];vr===0&&(qt?ke.call(this,br.x1+Le,br.y1+Ze):Ye.call(this,br.x1+Le,br.y1+Ze)),Ct.call(this,Le,Ze,br.x2,br.y2,br.x3,br.y3,br.x4,br.y4)}Mt?nt.call(this):at.call(this,Dt)},at=function(Le){switch(Le){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},nt=function(){this.pdf.clip(),this.pdf.discardPath()},ke=function(Le,Ze){this.pdf.internal.out(t(Le)+" "+i(Ze)+" m")},De=function(Le){var Ze;switch(Le.align){case"right":case"end":Ze="right";break;case"center":Ze="center";break;case"left":case"start":default:Ze="left"}var rt=this.pdf.getTextDimensions(Le.text),pt=je.call(this,Le.y),mt=We.call(this,pt)-rt.h,Bt=this.ctx.transform.applyToPoint(new a(Le.x,pt)),Dt=this.ctx.transform.decompose(),Mt=new g;Mt=(Mt=(Mt=Mt.multiply(Dt.translate)).multiply(Dt.skew)).multiply(Dt.scale);for(var qt,nr,vr,br=this.ctx.transform.applyToRectangle(new s(Le.x,pt,rt.w,rt.h)),Fr=Mt.applyToRectangle(new s(Le.x,mt,rt.w,rt.h)),kt=he.call(this,Fr),lt=[],wt=0;wt<kt.length;wt+=1)lt.indexOf(kt[wt])===-1&&lt.push(kt[wt]);if(be(lt),this.autoPaging)for(var Ur=lt[0],tr=lt[lt.length-1],ht=Ur;ht<tr+1;ht++){this.pdf.setPage(ht);var $t=ht===1?this.posY+this.margin[0]:this.margin[0],or=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],mr=this.pdf.internal.pageSize.height-this.margin[2],ur=mr-this.margin[0],Wr=this.pdf.internal.pageSize.width-this.margin[1],ri=Wr-this.margin[3],gi=ht===1?0:or+(ht-2)*ur;if(this.ctx.clip_path.length!==0){var Pi=this.path;qt=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=pe(qt,this.posX+this.margin[3],-1*gi+$t),qe.call(this,"fill",!0),this.path=Pi}var zt=pe([JSON.parse(JSON.stringify(Fr))],this.posX+this.margin[3],-gi+$t+this.ctx.prevPageLastElemOffset)[0];Le.scale>=.01&&(nr=this.pdf.internal.getFontSize(),this.pdf.setFontSize(nr*Le.scale),vr=this.lineWidth,this.lineWidth=vr*Le.scale);var Xr=this.autoPaging!=="text";if(Xr||zt.y+zt.h<=mr){if(Xr||zt.y>=$t&&zt.x<=Wr){var Ar=Xr?Le.text:this.pdf.splitTextToSize(Le.text,Le.maxWidth||Wr-zt.x)[0],Wt=pe([JSON.parse(JSON.stringify(br))],this.posX+this.margin[3],-gi+$t+this.ctx.prevPageLastElemOffset)[0],di=Xr&&(ht>Ur||ht<tr)&&Y.call(this);di&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ri,ur,null).clip().discardPath()),this.pdf.text(Ar,Wt.x,Wt.y,{angle:Le.angle,align:Ze,renderingMode:Le.renderingMode}),di&&this.pdf.restoreGraphicsState()}}else zt.y<mr&&(this.ctx.prevPageLastElemOffset+=mr-zt.y);Le.scale>=.01&&(this.pdf.setFontSize(nr),this.lineWidth=vr)}else Le.scale>=.01&&(nr=this.pdf.internal.getFontSize(),this.pdf.setFontSize(nr*Le.scale),vr=this.lineWidth,this.lineWidth=vr*Le.scale),this.pdf.text(Le.text,Bt.x+this.posX,Bt.y+this.posY,{angle:Le.angle,align:Ze,renderingMode:Le.renderingMode,maxWidth:Le.maxWidth}),Le.scale>=.01&&(this.pdf.setFontSize(nr),this.lineWidth=vr)},Ye=function(Le,Ze,rt,pt){rt=rt||0,pt=pt||0,this.pdf.internal.out(t(Le+rt)+" "+i(Ze+pt)+" l")},Xe=function(Le,Ze,rt){return this.pdf.lines(Le,Ze,rt,null,null)},Ct=function(Le,Ze,rt,pt,mt,Bt,Dt,Mt){this.pdf.internal.out([e(n(rt+Le)),e(o(pt+Ze)),e(n(mt+Le)),e(o(Bt+Ze)),e(n(Dt+Le)),e(o(Mt+Ze)),"c"].join(" "))},Et=function(Le,Ze,rt,pt){for(var mt=2*Math.PI,Bt=Math.PI/2;Ze>rt;)Ze-=mt;var Dt=Math.abs(rt-Ze);Dt<mt&&pt&&(Dt=mt-Dt);for(var Mt=[],qt=pt?-1:1,nr=Ze;Dt>1e-5;){var vr=nr+qt*Math.min(Dt,Bt);Mt.push(Pt.call(this,Le,nr,vr)),Dt-=Math.abs(vr-nr),nr=vr}return Mt},Pt=function(Le,Ze,rt){var pt=(rt-Ze)/2,mt=Le*Math.cos(pt),Bt=Le*Math.sin(pt),Dt=mt,Mt=-Bt,qt=Dt*Dt+Mt*Mt,nr=qt+Dt*mt+Mt*Bt,vr=4/3*(Math.sqrt(2*qt*nr)-nr)/(Dt*Bt-Mt*mt),br=Dt-vr*Mt,Fr=Mt+vr*Dt,kt=br,lt=-Fr,wt=pt+Ze,Ur=Math.cos(wt),tr=Math.sin(wt);return{x1:Le*Math.cos(Ze),y1:Le*Math.sin(Ze),x2:br*Ur-Fr*tr,y2:br*tr+Fr*Ur,x3:kt*Ur-lt*tr,y3:kt*tr+lt*Ur,x4:Le*Math.cos(rt),y4:Le*Math.sin(rt)}},bt=function(Le){return 180*Le/Math.PI},Rt=function(Le,Ze,rt,pt,mt,Bt){var Dt=Le+.5*(rt-Le),Mt=Ze+.5*(pt-Ze),qt=mt+.5*(rt-mt),nr=Bt+.5*(pt-Bt),vr=Math.min(Le,mt,Dt,qt),br=Math.max(Le,mt,Dt,qt),Fr=Math.min(Ze,Bt,Mt,nr),kt=Math.max(Ze,Bt,Mt,nr);return new s(vr,Fr,br-vr,kt-Fr)},Ft=function(Le,Ze,rt,pt,mt,Bt,Dt,Mt){var qt,nr,vr,br,Fr,kt,lt,wt,Ur,tr,ht,$t,or,mr,ur=rt-Le,Wr=pt-Ze,ri=mt-rt,gi=Bt-pt,Pi=Dt-mt,zt=Mt-Bt;for(nr=0;nr<41;nr++)Ur=(lt=(vr=Le+(qt=nr/40)*ur)+qt*((Fr=rt+qt*ri)-vr))+qt*(Fr+qt*(mt+qt*Pi-Fr)-lt),tr=(wt=(br=Ze+qt*Wr)+qt*((kt=pt+qt*gi)-br))+qt*(kt+qt*(Bt+qt*zt-kt)-wt),nr==0?(ht=Ur,$t=tr,or=Ur,mr=tr):(ht=Math.min(ht,Ur),$t=Math.min($t,tr),or=Math.max(or,Ur),mr=Math.max(mr,tr));return new s(Math.round(ht),Math.round($t),Math.round(or-ht),Math.round(mr-$t))},Zt=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var Le,Ze,rt=(Le=this.ctx.lineDash,Ze=this.ctx.lineDashOffset,JSON.stringify({lineDash:Le,lineDashOffset:Ze}));this.prevLineDash!==rt&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=rt)}}})(Gi.API),function(r){var e=function(o){var a,s,g,y,T,I,R,U,Z,Y;for(s=[],g=0,y=(o+=a="\0\0\0\0".slice(o.length%4||4)).length;y>g;g+=4)(T=(o.charCodeAt(g)<<24)+(o.charCodeAt(g+1)<<16)+(o.charCodeAt(g+2)<<8)+o.charCodeAt(g+3))!==0?(I=(T=((T=((T=((T=(T-(Y=T%85))/85)-(Z=T%85))/85)-(U=T%85))/85)-(R=T%85))/85)%85,s.push(I+33,R+33,U+33,Z+33,Y+33)):s.push(122);return function(he,ce){for(var pe=ce;pe>0;pe--)he.pop()}(s,a.length),String.fromCharCode.apply(String,s)+"~>"},t=function(o){var a,s,g,y,T,I=String,R="length",U=255,Z="charCodeAt",Y="slice",he="replace";for(o[Y](-2),o=o[Y](0,-2)[he](/\s/g,"")[he]("z","!!!!!"),g=[],y=0,T=(o+=a="uuuuu"[Y](o[R]%5||5))[R];T>y;y+=5)s=52200625*(o[Z](y)-33)+614125*(o[Z](y+1)-33)+7225*(o[Z](y+2)-33)+85*(o[Z](y+3)-33)+(o[Z](y+4)-33),g.push(U&s>>24,U&s>>16,U&s>>8,U&s);return function(ce,pe){for(var be=pe;be>0;be--)ce.pop()}(g,a[R]),I.fromCharCode.apply(I,g)},i=function(o){var a=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((o=o.replace(/\s/g,"")).indexOf(">")!==-1&&(o=o.substr(0,o.indexOf(">"))),o.length%2&&(o+="0"),a.test(o)===!1)return"";for(var s="",g=0;g<o.length;g+=2)s+=String.fromCharCode("0x"+(o[g]+o[g+1]));return s},n=function(o){for(var a=new Uint8Array(o.length),s=o.length;s--;)a[s]=o.charCodeAt(s);return o=(a=qC(a)).reduce(function(g,y){return g+String.fromCharCode(y)},"")};r.processDataByFilters=function(o,a){var s=0,g=o||"",y=[];for(typeof(a=a||[])=="string"&&(a=[a]),s=0;s<a.length;s+=1)switch(a[s]){case"ASCII85Decode":case"/ASCII85Decode":g=t(g),y.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":g=e(g),y.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":g=i(g),y.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":g=g.split("").map(function(T){return("0"+T.charCodeAt().toString(16)).slice(-2)}).join("")+">",y.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":g=n(g),y.push("/FlateDecode");break;default:throw new Error('The filter: "'+a[s]+'" is not implemented')}return{data:g,reverseChain:y.reverse().join(" ")}}}(Gi.API),function(r){r.loadFile=function(e,t,i){return function(n,o,a){o=o!==!1,a=typeof a=="function"?a:function(){};var s=void 0;try{s=function(g,y,T){var I=new XMLHttpRequest,R=0,U=function(Z){var Y=Z.length,he=[],ce=String.fromCharCode;for(R=0;R<Y;R+=1)he.push(ce(255&Z.charCodeAt(R)));return he.join("")};if(I.open("GET",g,!y),I.overrideMimeType("text/plain; charset=x-user-defined"),y===!1&&(I.onload=function(){I.status===200?T(U(this.responseText)):T(void 0)}),I.send(null),y&&I.status===200)return U(I.responseText)}(n,o,a)}catch{}return s}(e,t,i)},r.loadImageFile=r.loadFile}(Gi.API),function(r){function e(){return(Hi.html2canvas?Promise.resolve(Hi.html2canvas):Promise.resolve().then(()=>NAe)).catch(function(a){return Promise.reject(new Error("Could not load html2canvas: "+a))}).then(function(a){return a.default?a.default:a})}function t(){return(Hi.DOMPurify?Promise.resolve(Hi.DOMPurify):Promise.resolve().then(()=>pde)).catch(function(a){return Promise.reject(new Error("Could not load dompurify: "+a))}).then(function(a){return a.default?a.default:a})}var i=function(a){var s=ts(a);return s==="undefined"?"undefined":s==="string"||a instanceof String?"string":s==="number"||a instanceof Number?"number":s==="function"||a instanceof Function?"function":a&&a.constructor===Array?"array":a&&a.nodeType===1?"element":s==="object"?"object":"unknown"},n=function(a,s){var g=document.createElement(a);for(var y in s.className&&(g.className=s.className),s.innerHTML&&s.dompurify&&(g.innerHTML=s.dompurify.sanitize(s.innerHTML)),s.style)g.style[y]=s.style[y];return g},o=function a(s){var g=Object.assign(a.convert(Promise.resolve()),JSON.parse(JSON.stringify(a.template))),y=a.convert(Promise.resolve(),g);return y=(y=y.setProgress(1,a,1,[a])).set(s)};(o.prototype=Object.create(Promise.prototype)).constructor=o,o.convert=function(a,s){return a.__proto__=s||o.prototype,a},o.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},o.prototype.from=function(a,s){return this.then(function(){switch(s=s||function(g){switch(i(g)){case"string":return"string";case"element":return g.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(a)){case"string":return this.then(t).then(function(g){return this.set({src:n("div",{innerHTML:a,dompurify:g})})});case"element":return this.set({src:a});case"canvas":return this.set({canvas:a});case"img":return this.set({img:a});default:return this.error("Unknown source type.")}})},o.prototype.to=function(a){switch(a){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},o.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var a={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},s=function g(y,T){for(var I=y.nodeType===3?document.createTextNode(y.nodeValue):y.cloneNode(!1),R=y.firstChild;R;R=R.nextSibling)T!==!0&&R.nodeType===1&&R.nodeName==="SCRIPT"||I.appendChild(g(R,T));return y.nodeType===1&&(y.nodeName==="CANVAS"?(I.width=y.width,I.height=y.height,I.getContext("2d").drawImage(y,0,0)):y.nodeName!=="TEXTAREA"&&y.nodeName!=="SELECT"||(I.value=y.value),I.addEventListener("load",function(){I.scrollTop=y.scrollTop,I.scrollLeft=y.scrollLeft},!0)),I}(this.prop.src,this.opt.html2canvas.javascriptEnabled);s.tagName==="BODY"&&(a.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=n("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=n("div",{className:"html2pdf__container",style:a}),this.prop.container.appendChild(s),this.prop.container.firstChild.appendChild(n("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},o.prototype.toCanvas=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(e).then(function(s){var g=Object.assign({},this.opt.html2canvas);return delete g.onrendered,s(this.prop.container,g)}).then(function(s){(this.opt.html2canvas.onrendered||function(){})(s),this.prop.canvas=s,document.body.removeChild(this.prop.overlay)})},o.prototype.toContext2d=function(){var a=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(a).then(e).then(function(s){var g=this.opt.jsPDF,y=this.opt.fontFaces,T=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,I=Object.assign({async:!0,allowTaint:!0,scale:T,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete I.onrendered,g.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,g.context2d.posX=this.opt.x,g.context2d.posY=this.opt.y,g.context2d.margin=this.opt.margin,g.context2d.fontFaces=y,y)for(var R=0;R<y.length;++R){var U=y[R],Z=U.src.find(function(Y){return Y.format==="truetype"});Z&&g.addFont(Z.url,U.ref.name,U.ref.style)}return I.windowHeight=I.windowHeight||0,I.windowHeight=I.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):I.windowHeight,g.context2d.save(!0),s(this.prop.container,I)}).then(function(s){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(s),this.prop.canvas=s,document.body.removeChild(this.prop.overlay)})},o.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var a=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=a})},o.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},o.prototype.output=function(a,s,g){return(g=g||"pdf").toLowerCase()==="img"||g.toLowerCase()==="image"?this.outputImg(a,s):this.outputPdf(a,s)},o.prototype.outputPdf=function(a,s){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(a,s)})},o.prototype.outputImg=function(a){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(a){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+a+'" is not supported.'}})},o.prototype.save=function(a){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(a?{filename:a}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},o.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},o.prototype.set=function(a){if(i(a)!=="object")return this;var s=Object.keys(a||{}).map(function(g){if(g in o.template.prop)return function(){this.prop[g]=a[g]};switch(g){case"margin":return this.setMargin.bind(this,a.margin);case"jsPDF":return function(){return this.opt.jsPDF=a.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,a.pageSize);default:return function(){this.opt[g]=a[g]}}},this);return this.then(function(){return this.thenList(s)})},o.prototype.get=function(a,s){return this.then(function(){var g=a in o.template.prop?this.prop[a]:this.opt[a];return s?s(g):g})},o.prototype.setMargin=function(a){return this.then(function(){switch(i(a)){case"number":a=[a,a,a,a];case"array":if(a.length===2&&(a=[a[0],a[1],a[0],a[1]]),a.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=a}).then(this.setPageSize)},o.prototype.setPageSize=function(a){function s(g,y){return Math.floor(g*y/72*96)}return this.then(function(){(a=a||Gi.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(a.inner={width:a.width-this.opt.margin[1]-this.opt.margin[3],height:a.height-this.opt.margin[0]-this.opt.margin[2]},a.inner.px={width:s(a.inner.width,a.k),height:s(a.inner.height,a.k)},a.inner.ratio=a.inner.height/a.inner.width),this.prop.pageSize=a})},o.prototype.setProgress=function(a,s,g,y){return a!=null&&(this.progress.val=a),s!=null&&(this.progress.state=s),g!=null&&(this.progress.n=g),y!=null&&(this.progress.stack=y),this.progress.ratio=this.progress.val/this.progress.state,this},o.prototype.updateProgress=function(a,s,g,y){return this.setProgress(a?this.progress.val+a:null,s||null,g?this.progress.n+g:null,y?this.progress.stack.concat(y):null)},o.prototype.then=function(a,s){var g=this;return this.thenCore(a,s,function(y,T){return g.updateProgress(null,null,1,[y]),Promise.prototype.then.call(this,function(I){return g.updateProgress(null,y),I}).then(y,T).then(function(I){return g.updateProgress(1),I})})},o.prototype.thenCore=function(a,s,g){g=g||Promise.prototype.then,a&&(a=a.bind(this)),s&&(s=s.bind(this));var y=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?this:o.convert(Object.assign({},this),Promise.prototype),T=g.call(y,a,s);return o.convert(T,this.__proto__)},o.prototype.thenExternal=function(a,s){return Promise.prototype.then.call(this,a,s)},o.prototype.thenList=function(a){var s=this;return a.forEach(function(g){s=s.thenCore(g)}),s},o.prototype.catch=function(a){a&&(a=a.bind(this));var s=Promise.prototype.catch.call(this,a);return o.convert(s,this)},o.prototype.catchExternal=function(a){return Promise.prototype.catch.call(this,a)},o.prototype.error=function(a){return this.then(function(){throw new Error(a)})},o.prototype.using=o.prototype.set,o.prototype.saveAs=o.prototype.save,o.prototype.export=o.prototype.output,o.prototype.run=o.prototype.then,Gi.getPageSize=function(a,s,g){if(ts(a)==="object"){var y=a;a=y.orientation,s=y.unit||s,g=y.format||g}s=s||"mm",g=g||"a4",a=(""+(a||"P")).toLowerCase();var T,I=(""+g).toLowerCase(),R={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(s){case"pt":T=1;break;case"mm":T=72/25.4;break;case"cm":T=72/2.54;break;case"in":T=72;break;case"px":T=.75;break;case"pc":case"em":T=12;break;case"ex":T=6;break;default:throw"Invalid unit: "+s}var U,Z=0,Y=0;if(R.hasOwnProperty(I))Z=R[I][1]/T,Y=R[I][0]/T;else try{Z=g[1],Y=g[0]}catch{throw new Error("Invalid format: "+g)}if(a==="p"||a==="portrait")a="p",Y>Z&&(U=Y,Y=Z,Z=U);else{if(a!=="l"&&a!=="landscape")throw"Invalid orientation: "+a;a="l",Z>Y&&(U=Y,Y=Z,Z=U)}return{width:Y,height:Z,unit:s,k:T,orientation:a}},r.html=function(a,s){(s=s||{}).callback=s.callback||function(){},s.html2canvas=s.html2canvas||{},s.html2canvas.canvas=s.html2canvas.canvas||this.canvas,s.jsPDF=s.jsPDF||this,s.fontFaces=s.fontFaces?s.fontFaces.map(iE):null;var g=new o(s);return s.worker?g:g.from(a).doCallback()}}(Gi.API),Gi.API.addJS=function(r){return SD=r,this.internal.events.subscribe("postPutResources",function(){wv=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(wv+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),ED=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+SD+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){wv!==void 0&&ED!==void 0&&this.internal.out("/Names <</JavaScript "+wv+" 0 R>>")}),this},function(r){var e;r.events.push(["postPutResources",function(){var t=this,i=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var n=t.outline.render().split(/\r\n/),o=0;o<n.length;o++){var a=n[o],s=i.exec(a);if(s!=null){var g=s[1];t.internal.newObjectDeferredBegin(g,!1)}t.internal.write(a)}if(this.outline.createNamedDestinations){var y=this.internal.pages.length,T=[];for(o=0;o<y;o++){var I=t.internal.newObject();T.push(I);var R=t.internal.getPageInfo(o+1);t.internal.write("<< /D["+R.objId+" 0 R /XYZ null null null]>> endobj")}var U=t.internal.newObject();for(t.internal.write("<< /Names [ "),o=0;o<T.length;o++)t.internal.write("(page_"+(o+1)+")"+T[o]+" 0 R");t.internal.write(" ] >>","endobj"),e=t.internal.newObject(),t.internal.write("<< /Dests "+U+" 0 R"),t.internal.write(">>","endobj")}}]),r.events.push(["putCatalog",function(){this.outline.root.children.length>0&&(this.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&this.internal.write("/Names "+e+" 0 R"))}]),r.events.push(["initialized",function(){var t=this;t.outline={createNamedDestinations:!1,root:{children:[]}},t.outline.add=function(i,n,o){var a={title:n,options:o,children:[]};return i==null&&(i=this.root),i.children.push(a),a},t.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=t,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},t.outline.genIds_r=function(i){i.id=t.internal.newObjectDeferred();for(var n=0;n<i.children.length;n++)this.genIds_r(i.children[n])},t.outline.renderRoot=function(i){this.objStart(i),this.line("/Type /Outlines"),i.children.length>0&&(this.line("/First "+this.makeRef(i.children[0])),this.line("/Last "+this.makeRef(i.children[i.children.length-1]))),this.line("/Count "+this.count_r({count:0},i)),this.objEnd()},t.outline.renderItems=function(i){for(var n=this.ctx.pdf.internal.getVerticalCoordinateString,o=0;o<i.children.length;o++){var a=i.children[o];this.objStart(a),this.line("/Title "+this.makeString(a.title)),this.line("/Parent "+this.makeRef(i)),o>0&&this.line("/Prev "+this.makeRef(i.children[o-1])),o<i.children.length-1&&this.line("/Next "+this.makeRef(i.children[o+1])),a.children.length>0&&(this.line("/First "+this.makeRef(a.children[0])),this.line("/Last "+this.makeRef(a.children[a.children.length-1])));var s=this.count=this.count_r({count:0},a);if(s>0&&this.line("/Count "+s),a.options&&a.options.pageNumber){var g=t.internal.getPageInfo(a.options.pageNumber);this.line("/Dest ["+g.objId+" 0 R /XYZ 0 "+n(0)+" 0]")}this.objEnd()}for(var y=0;y<i.children.length;y++)this.renderItems(i.children[y])},t.outline.line=function(i){this.ctx.val+=i+`\r
`},t.outline.makeRef=function(i){return i.id+" 0 R"},t.outline.makeString=function(i){return"("+t.internal.pdfEscape(i)+")"},t.outline.objStart=function(i){this.ctx.val+=`\r
`+i.id+` 0 obj\r
<<\r
`},t.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},t.outline.count_r=function(i,n){for(var o=0;o<n.children.length;o++)i.count++,this.count_r(i,n.children[o]);return i.count}}])}(Gi.API),function(r){var e=[192,193,194,195,196,197,198,199];r.processJPEG=function(t,i,n,o,a,s){var g,y=this.decode.DCT_DECODE,T=null;if(typeof t=="string"||this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t)){switch(t=a||t,t=this.__addimage__.isArrayBuffer(t)?new Uint8Array(t):t,(g=function(I){for(var R,U=256*I.charCodeAt(4)+I.charCodeAt(5),Z=I.length,Y={width:0,height:0,numcomponents:1},he=4;he<Z;he+=2){if(he+=U,e.indexOf(I.charCodeAt(he+1))!==-1){R=256*I.charCodeAt(he+5)+I.charCodeAt(he+6),Y={width:256*I.charCodeAt(he+7)+I.charCodeAt(he+8),height:R,numcomponents:I.charCodeAt(he+9)};break}U=256*I.charCodeAt(he+2)+I.charCodeAt(he+3)}return Y}(t=this.__addimage__.isArrayBufferView(t)?this.__addimage__.arrayBufferToBinaryString(t):t)).numcomponents){case 1:s=this.color_spaces.DEVICE_GRAY;break;case 4:s=this.color_spaces.DEVICE_CMYK;break;case 3:s=this.color_spaces.DEVICE_RGB}T={data:t,width:g.width,height:g.height,colorSpace:s,bitsPerComponent:8,filter:y,index:i,alias:n}}return T}}(Gi.API);var zg,Bv,ID,LD,MD,Tne=function(){var r,e,t;function i(o){var a,s,g,y,T,I,R,U,Z,Y,he,ce,pe,be;for(this.data=o,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},I=null;;){switch(a=this.readUInt32(),Z=(function(){var Te,qe;for(qe=[],Te=0;Te<4;++Te)qe.push(String.fromCharCode(this.data[this.pos++]));return qe}).call(this).join("")){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(a);break;case"fcTL":I&&this.animation.frames.push(I),this.pos+=4,I={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},T=this.readUInt16(),y=this.readUInt16()||100,I.delay=1e3*T/y,I.disposeOp=this.data[this.pos++],I.blendOp=this.data[this.pos++],I.data=[];break;case"IDAT":case"fdAT":for(Z==="fdAT"&&(this.pos+=4,a-=4),o=(I!=null?I.data:void 0)||this.imgData,ce=0;0<=a?ce<a:ce>a;0<=a?++ce:--ce)o.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:if(g=this.palette.length/3,this.transparency.indexed=this.read(a),this.transparency.indexed.length>g)throw new Error("More transparent colors than palette size");if((Y=g-this.transparency.indexed.length)>0)for(pe=0;0<=Y?pe<Y:pe>Y;0<=Y?++pe:--pe)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":R=(he=this.read(a)).indexOf(0),U=String.fromCharCode.apply(String,he.slice(0,R)),this.text[U]=String.fromCharCode.apply(String,he.slice(R+1));break;case"IEND":return I&&this.animation.frames.push(I),this.colors=(function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}).call(this),this.hasAlphaChannel=(be=this.colorType)===4||be===6,s=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*s,this.colorSpace=(function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}).call(this),void(this.imgData=new Uint8Array(this.imgData));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}}i.prototype.read=function(o){var a,s;for(s=[],a=0;0<=o?a<o:a>o;0<=o?++a:--a)s.push(this.data[this.pos++]);return s},i.prototype.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},i.prototype.decodePixels=function(o){var a=this.pixelBitlength/8,s=new Uint8Array(this.width*this.height*a),g=0,y=this;if(o==null&&(o=this.imgData),o.length===0)return new Uint8Array(0);function T(I,R,U,Z){var Y,he,ce,pe,be,Te,qe,je,We,Ne,at,nt,ke,De,Ye,Xe,Ct,Et,Pt,bt,Rt,Ft=Math.ceil((y.width-I)/U),Zt=Math.ceil((y.height-R)/Z),Le=y.width==Ft&&y.height==Zt;for(De=a*Ft,nt=Le?s:new Uint8Array(De*Zt),Te=o.length,ke=0,he=0;ke<Zt&&g<Te;){switch(o[g++]){case 0:for(pe=Ct=0;Ct<De;pe=Ct+=1)nt[he++]=o[g++];break;case 1:for(pe=Et=0;Et<De;pe=Et+=1)Y=o[g++],be=pe<a?0:nt[he-a],nt[he++]=(Y+be)%256;break;case 2:for(pe=Pt=0;Pt<De;pe=Pt+=1)Y=o[g++],ce=(pe-pe%a)/a,Ye=ke&&nt[(ke-1)*De+ce*a+pe%a],nt[he++]=(Ye+Y)%256;break;case 3:for(pe=bt=0;bt<De;pe=bt+=1)Y=o[g++],ce=(pe-pe%a)/a,be=pe<a?0:nt[he-a],Ye=ke&&nt[(ke-1)*De+ce*a+pe%a],nt[he++]=(Y+Math.floor((be+Ye)/2))%256;break;case 4:for(pe=Rt=0;Rt<De;pe=Rt+=1)Y=o[g++],ce=(pe-pe%a)/a,be=pe<a?0:nt[he-a],ke===0?Ye=Xe=0:(Ye=nt[(ke-1)*De+ce*a+pe%a],Xe=ce&&nt[(ke-1)*De+(ce-1)*a+pe%a]),qe=be+Ye-Xe,je=Math.abs(qe-be),Ne=Math.abs(qe-Ye),at=Math.abs(qe-Xe),We=je<=Ne&&je<=at?be:Ne<=at?Ye:Xe,nt[he++]=(Y+We)%256;break;default:throw new Error("Invalid filter algorithm: "+o[g-1])}if(!Le){var Ze=((R+ke*Z)*y.width+I)*a,rt=ke*De;for(pe=0;pe<Ft;pe+=1){for(var pt=0;pt<a;pt+=1)s[Ze++]=nt[rt++];Ze+=(U-1)*a}}ke++}}return o=lne(o),y.interlaceMethod==1?(T(0,0,8,8),T(4,0,8,8),T(0,4,4,8),T(2,0,4,4),T(0,2,2,4),T(1,0,2,2),T(0,1,1,2)):T(0,0,1,1),s},i.prototype.decodePalette=function(){var o,a,s,g,y,T,I,R,U;for(s=this.palette,T=this.transparency.indexed||[],y=new Uint8Array((T.length||0)+s.length),g=0,o=0,a=I=0,R=s.length;I<R;a=I+=3)y[g++]=s[a],y[g++]=s[a+1],y[g++]=s[a+2],y[g++]=(U=T[o++])!=null?U:255;return y},i.prototype.copyToImageData=function(o,a){var s,g,y,T,I,R,U,Z,Y,he,ce;if(g=this.colors,Y=null,s=this.hasAlphaChannel,this.palette.length&&(Y=(ce=this._decodedPalette)!=null?ce:this._decodedPalette=this.decodePalette(),g=4,s=!0),Z=(y=o.data||o).length,I=Y||a,T=R=0,g===1)for(;T<Z;)U=Y?4*a[T/4]:R,he=I[U++],y[T++]=he,y[T++]=he,y[T++]=he,y[T++]=s?I[U++]:255,R=U;else for(;T<Z;)U=Y?4*a[T/4]:R,y[T++]=I[U++],y[T++]=I[U++],y[T++]=I[U++],y[T++]=s?I[U++]:255,R=U},i.prototype.decode=function(){var o;return o=new Uint8Array(this.width*this.height*4),this.copyToImageData(o,this.decodePixels()),o};var n=function(){if(Object.prototype.toString.call(Hi)==="[object Window]"){try{e=Hi.document.createElement("canvas"),t=e.getContext("2d")}catch{return!1}return!0}return!1};return n(),r=function(o){var a;if(n()===!0)return t.width=o.width,t.height=o.height,t.clearRect(0,0,o.width,o.height),t.putImageData(o,0,0),(a=new Image).src=e.toDataURL(),a;throw new Error("This method requires a Browser with Canvas-capability.")},i.prototype.decodeFrames=function(o){var a,s,g,y,T,I,R,U;if(this.animation){for(U=[],s=T=0,I=(R=this.animation.frames).length;T<I;s=++T)a=R[s],g=o.createImageData(a.width,a.height),y=this.decodePixels(new Uint8Array(a.data)),this.copyToImageData(g,y),a.imageData=g,U.push(a.image=r(g));return U}},i.prototype.renderFrame=function(o,a){var s,g,y;return s=(g=this.animation.frames)[a],y=g[a-1],a===0&&o.clearRect(0,0,this.width,this.height),(y!=null?y.disposeOp:void 0)===1?o.clearRect(y.xOffset,y.yOffset,y.width,y.height):(y!=null?y.disposeOp:void 0)===2&&o.putImageData(y.imageData,y.xOffset,y.yOffset),s.blendOp===0&&o.clearRect(s.xOffset,s.yOffset,s.width,s.height),o.drawImage(s.image,s.xOffset,s.yOffset)},i.prototype.animate=function(o){var a,s,g,y,T,I,R=this;return s=0,I=this.animation,y=I.numFrames,g=I.frames,T=I.numPlays,(a=function(){var U,Z;if(U=s++%y,Z=g[U],R.renderFrame(o,U),y>1&&s/y<T)return R.animation._timeout=setTimeout(a,Z.delay)})()},i.prototype.stopAnimation=function(){var o;return clearTimeout((o=this.animation)!=null?o._timeout:void 0)},i.prototype.render=function(o){var a,s;return o._png&&o._png.stopAnimation(),o._png=this,o.width=this.width,o.height=this.height,a=o.getContext("2d"),this.animation?(this.decodeFrames(a),this.animate(a)):(s=a.createImageData(this.width,this.height),this.copyToImageData(s,this.decodePixels()),a.putImageData(s,0,0))},i}();/**
* @license
*
* Copyright (c) 2014 James Robb, https://github.com/jamesbrobb
*
* Permission is hereby granted, free of charge, to any person obtaining
* a copy of this software and associated documentation files (the
* "Software"), to deal in the Software without restriction, including
* without limitation the rights to use, copy, modify, merge, publish,
* distribute, sublicense, and/or sell copies of the Software, and to
* permit persons to whom the Software is furnished to do so, subject to
* the following conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
* LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
* OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
* ====================================================================
*//**
* @license
* (c) Dean McNamee <dean@gmail.com>, 2013.
*
* https://github.com/deanm/omggif
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to
* deal in the Software without restriction, including without limitation the
* rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
* sell copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
* IN THE SOFTWARE.
*
* omggif is a JavaScript implementation of a GIF 89a encoder and decoder,
* including animation and compression.  It does not rely on any specific
* underlying system, so should run in the browser, Node, or Plask.
*/function Ine(r){var e=0;if(r[e++]!==71||r[e++]!==73||r[e++]!==70||r[e++]!==56||(r[e++]+1&253)!=56||r[e++]!==97)throw new Error("Invalid GIF 87a/89a header.");var t=r[e++]|r[e++]<<8,i=r[e++]|r[e++]<<8,n=r[e++],o=n>>7,a=1<<(7&n)+1;r[e++],r[e++];var s=null,g=null;o&&(s=e,g=a,e+=3*a);var y=!0,T=[],I=0,R=null,U=0,Z=null;for(this.width=t,this.height=i;y&&e<r.length;)switch(r[e++]){case 33:switch(r[e++]){case 255:if(r[e]!==11||r[e+1]==78&&r[e+2]==69&&r[e+3]==84&&r[e+4]==83&&r[e+5]==67&&r[e+6]==65&&r[e+7]==80&&r[e+8]==69&&r[e+9]==50&&r[e+10]==46&&r[e+11]==48&&r[e+12]==3&&r[e+13]==1&&r[e+16]==0)e+=14,Z=r[e++]|r[e++]<<8,e++;else for(e+=12;;){if(!((ke=r[e++])>=0))throw Error("Invalid block size");if(ke===0)break;e+=ke}break;case 249:if(r[e++]!==4||r[e+4]!==0)throw new Error("Invalid graphics extension block.");var Y=r[e++];I=r[e++]|r[e++]<<8,R=r[e++],!(1&Y)&&(R=null),U=Y>>2&7,e++;break;case 254:for(;;){if(!((ke=r[e++])>=0))throw Error("Invalid block size");if(ke===0)break;e+=ke}break;default:throw new Error("Unknown graphic control label: 0x"+r[e-1].toString(16))}break;case 44:var he=r[e++]|r[e++]<<8,ce=r[e++]|r[e++]<<8,pe=r[e++]|r[e++]<<8,be=r[e++]|r[e++]<<8,Te=r[e++],qe=Te>>6&1,je=1<<(7&Te)+1,We=s,Ne=g,at=!1;Te>>7&&(at=!0,We=e,Ne=je,e+=3*je);var nt=e;for(e++;;){var ke;if(!((ke=r[e++])>=0))throw Error("Invalid block size");if(ke===0)break;e+=ke}T.push({x:he,y:ce,width:pe,height:be,has_local_palette:at,palette_offset:We,palette_size:Ne,data_offset:nt,data_length:e-nt,transparent_index:R,interlaced:!!qe,delay:I,disposal:U});break;case 59:y=!1;break;default:throw new Error("Unknown gif block: 0x"+r[e-1].toString(16))}this.numFrames=function(){return T.length},this.loopCount=function(){return Z},this.frameInfo=function(De){if(De<0||De>=T.length)throw new Error("Frame index out of range.");return T[De]},this.decodeAndBlitFrameBGRA=function(De,Ye){var Xe=this.frameInfo(De),Ct=Xe.width*Xe.height,Et=new Uint8Array(Ct);PD(r,Xe.data_offset,Et,Ct);var Pt=Xe.palette_offset,bt=Xe.transparent_index;bt===null&&(bt=256);var Rt=Xe.width,Ft=t-Rt,Zt=Rt,Le=4*(Xe.y*t+Xe.x),Ze=4*((Xe.y+Xe.height)*t+Xe.x),rt=Le,pt=4*Ft;Xe.interlaced===!0&&(pt+=4*t*7);for(var mt=8,Bt=0,Dt=Et.length;Bt<Dt;++Bt){var Mt=Et[Bt];if(Zt===0&&(Zt=Rt,(rt+=pt)>=Ze&&(pt=4*Ft+4*t*(mt-1),rt=Le+(Rt+Ft)*(mt<<1),mt>>=1)),Mt===bt)rt+=4;else{var qt=r[Pt+3*Mt],nr=r[Pt+3*Mt+1],vr=r[Pt+3*Mt+2];Ye[rt++]=vr,Ye[rt++]=nr,Ye[rt++]=qt,Ye[rt++]=255}--Zt}},this.decodeAndBlitFrameRGBA=function(De,Ye){var Xe=this.frameInfo(De),Ct=Xe.width*Xe.height,Et=new Uint8Array(Ct);PD(r,Xe.data_offset,Et,Ct);var Pt=Xe.palette_offset,bt=Xe.transparent_index;bt===null&&(bt=256);var Rt=Xe.width,Ft=t-Rt,Zt=Rt,Le=4*(Xe.y*t+Xe.x),Ze=4*((Xe.y+Xe.height)*t+Xe.x),rt=Le,pt=4*Ft;Xe.interlaced===!0&&(pt+=4*t*7);for(var mt=8,Bt=0,Dt=Et.length;Bt<Dt;++Bt){var Mt=Et[Bt];if(Zt===0&&(Zt=Rt,(rt+=pt)>=Ze&&(pt=4*Ft+4*t*(mt-1),rt=Le+(Rt+Ft)*(mt<<1),mt>>=1)),Mt===bt)rt+=4;else{var qt=r[Pt+3*Mt],nr=r[Pt+3*Mt+1],vr=r[Pt+3*Mt+2];Ye[rt++]=qt,Ye[rt++]=nr,Ye[rt++]=vr,Ye[rt++]=255}--Zt}}}function PD(r,e,t,i){for(var n=r[e++],o=1<<n,a=o+1,s=a+1,g=n+1,y=(1<<g)-1,T=0,I=0,R=0,U=r[e++],Z=new Int32Array(4096),Y=null;;){for(;T<16&&U!==0;)I|=r[e++]<<T,T+=8,U===1?U=r[e++]:--U;if(T<g)break;var he=I&y;if(I>>=g,T-=g,he!==o){if(he===a)break;for(var ce=he<s?he:Y,pe=0,be=ce;be>o;)be=Z[be]>>8,++pe;var Te=be;if(R+pe+(ce!==he?1:0)>i)return void Ps.log("Warning, gif stream longer than expected.");t[R++]=Te;var qe=R+=pe;for(ce!==he&&(t[R++]=Te),be=ce;pe--;)be=Z[be],t[--qe]=255&be,be>>=8;Y!==null&&s<4096&&(Z[s++]=Y<<8|Te,s>=y+1&&g<12&&(++g,y=y<<1|1)),Y=he}else s=a+1,y=(1<<(g=n+1))-1,Y=null}return R!==i&&Ps.log("Warning, gif stream shorter than expected."),t}/**
	 * @license
	  Copyright (c) 2008, Adobe Systems Incorporated
	  All rights reserved.

	  Redistribution and use in source and binary forms, with or without 
	  modification, are permitted provided that the following conditions are
	  met:

	  * Redistributions of source code must retain the above copyright notice, 
	    this list of conditions and the following disclaimer.
	  
	  * Redistributions in binary form must reproduce the above copyright
	    notice, this list of conditions and the following disclaimer in the 
	    documentation and/or other materials provided with the distribution.
	  
	  * Neither the name of Adobe Systems Incorporated nor the names of its 
	    contributors may be used to endorse or promote products derived from 
	    this software without specific prior written permission.

	  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
	  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
	  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
	  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
	  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
	  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
	  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
	  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
	  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
	  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
	  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
	*/function nE(r){var e,t,i,n,o,a=Math.floor,s=new Array(64),g=new Array(64),y=new Array(64),T=new Array(64),I=new Array(65535),R=new Array(65535),U=new Array(64),Z=new Array(64),Y=[],he=0,ce=7,pe=new Array(64),be=new Array(64),Te=new Array(64),qe=new Array(256),je=new Array(2048),We=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Ne=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],at=[0,1,2,3,4,5,6,7,8,9,10,11],nt=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],ke=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],De=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Ye=[0,1,2,3,4,5,6,7,8,9,10,11],Xe=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Ct=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function Et(Le,Ze){for(var rt=0,pt=0,mt=new Array,Bt=1;Bt<=16;Bt++){for(var Dt=1;Dt<=Le[Bt];Dt++)mt[Ze[pt]]=[],mt[Ze[pt]][0]=rt,mt[Ze[pt]][1]=Bt,pt++,rt++;rt*=2}return mt}function Pt(Le){for(var Ze=Le[0],rt=Le[1]-1;rt>=0;)Ze&1<<rt&&(he|=1<<ce),rt--,--ce<0&&(he==255?(bt(255),bt(0)):bt(he),ce=7,he=0)}function bt(Le){Y.push(Le)}function Rt(Le){bt(Le>>8&255),bt(255&Le)}function Ft(Le,Ze,rt,pt,mt){for(var Bt,Dt=mt[0],Mt=mt[240],qt=function(tr,ht){var $t,or,mr,ur,Wr,ri,gi,Pi,zt,Xr,Ar=0;for(zt=0;zt<8;++zt){$t=tr[Ar],or=tr[Ar+1],mr=tr[Ar+2],ur=tr[Ar+3],Wr=tr[Ar+4],ri=tr[Ar+5],gi=tr[Ar+6];var Wt=$t+(Pi=tr[Ar+7]),di=$t-Pi,Qt=or+gi,Tr=or-gi,Lr=mr+ri,Xt=mr-ri,xr=ur+Wr,er=ur-Wr,vi=Wt+xr,Zi=Wt-xr,Qe=Qt+Lr,Be=Qt-Lr;tr[Ar]=vi+Qe,tr[Ar+4]=vi-Qe;var ue=.707106781*(Be+Zi);tr[Ar+2]=Zi+ue,tr[Ar+6]=Zi-ue;var re=.382683433*((vi=er+Xt)-(Be=Tr+di)),Ae=.5411961*vi+re,ge=1.306562965*Be+re,xe=.707106781*(Qe=Xt+Tr),Ee=di+xe,we=di-xe;tr[Ar+5]=we+Ae,tr[Ar+3]=we-Ae,tr[Ar+1]=Ee+ge,tr[Ar+7]=Ee-ge,Ar+=8}for(Ar=0,zt=0;zt<8;++zt){$t=tr[Ar],or=tr[Ar+8],mr=tr[Ar+16],ur=tr[Ar+24],Wr=tr[Ar+32],ri=tr[Ar+40],gi=tr[Ar+48];var Fe=$t+(Pi=tr[Ar+56]),ze=$t-Pi,Ge=or+gi,st=or-gi,vt=mr+ri,Tt=mr-ri,Kt=ur+Wr,rr=ur-Wr,Gt=Fe+Kt,dr=Fe-Kt,Cr=Ge+vt,Gr=Ge-vt;tr[Ar]=Gt+Cr,tr[Ar+32]=Gt-Cr;var Er=.707106781*(Gr+dr);tr[Ar+16]=dr+Er,tr[Ar+48]=dr-Er;var zr=.382683433*((Gt=rr+Tt)-(Gr=st+ze)),ot=.5411961*Gt+zr,ir=1.306562965*Gr+zr,Vt=.707106781*(Cr=Tt+st),Hr=ze+Vt,ci=ze-Vt;tr[Ar+40]=ci+ot,tr[Ar+24]=ci-ot,tr[Ar+8]=Hr+ir,tr[Ar+56]=Hr-ir,Ar++}for(zt=0;zt<64;++zt)Xr=tr[zt]*ht[zt],U[zt]=Xr>0?Xr+.5|0:Xr-.5|0;return U}(Le,Ze),nr=0;nr<64;++nr)Z[We[nr]]=qt[nr];var vr=Z[0]-rt;rt=Z[0],vr==0?Pt(pt[0]):(Pt(pt[R[Bt=32767+vr]]),Pt(I[Bt]));for(var br=63;br>0&&Z[br]==0;)br--;if(br==0)return Pt(Dt),rt;for(var Fr,kt=1;kt<=br;){for(var lt=kt;Z[kt]==0&&kt<=br;)++kt;var wt=kt-lt;if(wt>=16){Fr=wt>>4;for(var Ur=1;Ur<=Fr;++Ur)Pt(Mt);wt&=15}Bt=32767+Z[kt],Pt(mt[(wt<<4)+R[Bt]]),Pt(I[Bt]),kt++}return br!=63&&Pt(Dt),rt}function Zt(Le){Le=Math.min(Math.max(Le,1),100),o!=Le&&(function(Ze){for(var rt=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],pt=0;pt<64;pt++){var mt=a((rt[pt]*Ze+50)/100);mt=Math.min(Math.max(mt,1),255),s[We[pt]]=mt}for(var Bt=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],Dt=0;Dt<64;Dt++){var Mt=a((Bt[Dt]*Ze+50)/100);Mt=Math.min(Math.max(Mt,1),255),g[We[Dt]]=Mt}for(var qt=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],nr=0,vr=0;vr<8;vr++)for(var br=0;br<8;br++)y[nr]=1/(s[We[nr]]*qt[vr]*qt[br]*8),T[nr]=1/(g[We[nr]]*qt[vr]*qt[br]*8),nr++}(Le<50?Math.floor(5e3/Le):Math.floor(200-2*Le)),o=Le)}this.encode=function(Le,Ze){Ze&&Zt(Ze),Y=new Array,he=0,ce=7,Rt(65496),Rt(65504),Rt(16),bt(74),bt(70),bt(73),bt(70),bt(0),bt(1),bt(1),bt(0),Rt(1),Rt(1),bt(0),bt(0),function(){Rt(65499),Rt(132),bt(0);for(var or=0;or<64;or++)bt(s[or]);bt(1);for(var mr=0;mr<64;mr++)bt(g[mr])}(),function(or,mr){Rt(65472),Rt(17),bt(8),Rt(mr),Rt(or),bt(3),bt(1),bt(17),bt(0),bt(2),bt(17),bt(1),bt(3),bt(17),bt(1)}(Le.width,Le.height),function(){Rt(65476),Rt(418),bt(0);for(var or=0;or<16;or++)bt(Ne[or+1]);for(var mr=0;mr<=11;mr++)bt(at[mr]);bt(16);for(var ur=0;ur<16;ur++)bt(nt[ur+1]);for(var Wr=0;Wr<=161;Wr++)bt(ke[Wr]);bt(1);for(var ri=0;ri<16;ri++)bt(De[ri+1]);for(var gi=0;gi<=11;gi++)bt(Ye[gi]);bt(17);for(var Pi=0;Pi<16;Pi++)bt(Xe[Pi+1]);for(var zt=0;zt<=161;zt++)bt(Ct[zt])}(),Rt(65498),Rt(12),bt(3),bt(1),bt(0),bt(2),bt(17),bt(3),bt(17),bt(0),bt(63),bt(0);var rt=0,pt=0,mt=0;he=0,ce=7,this.encode.displayName="_encode_";for(var Bt,Dt,Mt,qt,nr,vr,br,Fr,kt,lt=Le.data,wt=Le.width,Ur=Le.height,tr=4*wt,ht=0;ht<Ur;){for(Bt=0;Bt<tr;){for(nr=tr*ht+Bt,br=-1,Fr=0,kt=0;kt<64;kt++)vr=nr+(Fr=kt>>3)*tr+(br=4*(7&kt)),ht+Fr>=Ur&&(vr-=tr*(ht+1+Fr-Ur)),Bt+br>=tr&&(vr-=Bt+br-tr+4),Dt=lt[vr++],Mt=lt[vr++],qt=lt[vr++],pe[kt]=(je[Dt]+je[Mt+256>>0]+je[qt+512>>0]>>16)-128,be[kt]=(je[Dt+768>>0]+je[Mt+1024>>0]+je[qt+1280>>0]>>16)-128,Te[kt]=(je[Dt+1280>>0]+je[Mt+1536>>0]+je[qt+1792>>0]>>16)-128;rt=Ft(pe,y,rt,e,i),pt=Ft(be,T,pt,t,n),mt=Ft(Te,T,mt,t,n),Bt+=32}ht+=8}if(ce>=0){var $t=[];$t[1]=ce+1,$t[0]=(1<<ce+1)-1,Pt($t)}return Rt(65497),new Uint8Array(Y)},r=r||50,function(){for(var Le=String.fromCharCode,Ze=0;Ze<256;Ze++)qe[Ze]=Le(Ze)}(),e=Et(Ne,at),t=Et(De,Ye),i=Et(nt,ke),n=Et(Xe,Ct),function(){for(var Le=1,Ze=2,rt=1;rt<=15;rt++){for(var pt=Le;pt<Ze;pt++)R[32767+pt]=rt,I[32767+pt]=[],I[32767+pt][1]=rt,I[32767+pt][0]=pt;for(var mt=-(Ze-1);mt<=-Le;mt++)R[32767+mt]=rt,I[32767+mt]=[],I[32767+mt][1]=rt,I[32767+mt][0]=Ze-1+mt;Le<<=1,Ze<<=1}}(),function(){for(var Le=0;Le<256;Le++)je[Le]=19595*Le,je[Le+256>>0]=38470*Le,je[Le+512>>0]=7471*Le+32768,je[Le+768>>0]=-11059*Le,je[Le+1024>>0]=-21709*Le,je[Le+1280>>0]=32768*Le+8421375,je[Le+1536>>0]=-27439*Le,je[Le+1792>>0]=-5329*Le}(),Zt(r)}/**
* @license
* Copyright (c) 2017 Aras Abbasi
*
* Licensed under the MIT License.
* http://opensource.org/licenses/mit-license
*/function ph(r,e){if(this.pos=0,this.buffer=r,this.datav=new DataView(r.buffer),this.is_with_alpha=!!e,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function FD(r){function e(Ne){if(!Ne)throw Error("assert :P")}function t(Ne,at,nt){for(var ke=0;4>ke;ke++)if(Ne[at+ke]!=nt.charCodeAt(ke))return!0;return!1}function i(Ne,at,nt,ke,De){for(var Ye=0;Ye<De;Ye++)Ne[at+Ye]=nt[ke+Ye]}function n(Ne,at,nt,ke){for(var De=0;De<ke;De++)Ne[at+De]=nt}function o(Ne){return new Int32Array(Ne)}function a(Ne,at){for(var nt=[],ke=0;ke<Ne;ke++)nt.push(new at);return nt}function s(Ne,at){var nt=[];return function ke(De,Ye,Xe){for(var Ct=Xe[Ye],Et=0;Et<Ct&&(De.push(Xe.length>Ye+1?[]:new at),!(Xe.length<Ye+1));Et++)ke(De[Et],Ye+1,Xe)}(nt,0,Ne),nt}var g=function(){var Ne=this;function at(_,E){for(var F=1<<E-1>>>0;_&F;)F>>>=1;return F?(_&F-1)+F:_}function nt(_,E,F,V,q){e(!(V%F));do _[E+(V-=F)]=q;while(0<V)}function ke(_,E,F,V,q){if(e(2328>=q),512>=q)var K=o(512);else if((K=o(q))==null)return 0;return function(te,se,oe,le,_e,Ie){var ve,Se,et=se,Oe=1<<oe,Re=o(16),Ve=o(16);for(e(_e!=0),e(le!=null),e(te!=null),e(0<oe),Se=0;Se<_e;++Se){if(15<le[Se])return 0;++Re[le[Se]]}if(Re[0]==_e)return 0;for(Ve[1]=0,ve=1;15>ve;++ve){if(Re[ve]>1<<ve)return 0;Ve[ve+1]=Ve[ve]+Re[ve]}for(Se=0;Se<_e;++Se)ve=le[Se],0<le[Se]&&(Ie[Ve[ve]++]=Se);if(Ve[15]==1)return(le=new De).g=0,le.value=Ie[0],nt(te,et,1,Oe,le),Oe;var At,dt=-1,ft=Oe-1,Nt=0,It=1,jt=1,Ht=1<<oe;for(Se=0,ve=1,_e=2;ve<=oe;++ve,_e<<=1){if(It+=jt<<=1,0>(jt-=Re[ve]))return 0;for(;0<Re[ve];--Re[ve])(le=new De).g=ve,le.value=Ie[Se++],nt(te,et+Nt,_e,Ht,le),Nt=at(Nt,ve)}for(ve=oe+1,_e=2;15>=ve;++ve,_e<<=1){if(It+=jt<<=1,0>(jt-=Re[ve]))return 0;for(;0<Re[ve];--Re[ve]){if(le=new De,(Nt&ft)!=dt){for(et+=Ht,At=1<<(dt=ve)-oe;15>dt&&!(0>=(At-=Re[dt]));)++dt,At<<=1;Oe+=Ht=1<<(At=dt-oe),te[se+(dt=Nt&ft)].g=At+oe,te[se+dt].value=et-se-dt}le.g=ve-oe,le.value=Ie[Se++],nt(te,et+(Nt>>oe),_e,Ht,le),Nt=at(Nt,ve)}}return It!=2*Ve[15]-1?0:Oe}(_,E,F,V,q,K)}function De(){this.value=this.g=0}function Ye(){this.value=this.g=0}function Xe(){this.G=a(5,De),this.H=o(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=a(_s,Ye)}function Ct(_,E,F,V){e(_!=null),e(E!=null),e(2147483648>V),_.Ca=254,_.I=0,_.b=-8,_.Ka=0,_.oa=E,_.pa=F,_.Jd=E,_.Yc=F+V,_.Zc=4<=V?F+V-4+1:F,Bt(_)}function Et(_,E){for(var F=0;0<E--;)F|=Mt(_,128)<<E;return F}function Pt(_,E){var F=Et(_,E);return Dt(_)?-F:F}function bt(_,E,F,V){var q,K=0;for(e(_!=null),e(E!=null),e(4294967288>V),_.Sb=V,_.Ra=0,_.u=0,_.h=0,4<V&&(V=4),q=0;q<V;++q)K+=E[F+q]<<8*q;_.Ra=K,_.bb=V,_.oa=E,_.pa=F}function Rt(_){for(;8<=_.u&&_.bb<_.Sb;)_.Ra>>>=8,_.Ra+=_.oa[_.pa+_.bb]<<Fa-8>>>0,++_.bb,_.u-=8;rt(_)&&(_.h=1,_.u=0)}function Ft(_,E){if(e(0<=E),!_.h&&E<=Zl){var F=Ze(_)&gl[E];return _.u+=E,Rt(_),F}return _.h=1,_.u=0}function Zt(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Le(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Ze(_){return _.Ra>>>(_.u&Fa-1)>>>0}function rt(_){return e(_.bb<=_.Sb),_.h||_.bb==_.Sb&&_.u>Fa}function pt(_,E){_.u=E,_.h=rt(_)}function mt(_){_.u>=Da&&(e(_.u>=Da),Rt(_))}function Bt(_){e(_!=null&&_.oa!=null),_.pa<_.Zc?(_.I=(_.oa[_.pa++]|_.I<<8)>>>0,_.b+=8):(e(_!=null&&_.oa!=null),_.pa<_.Yc?(_.b+=8,_.I=_.oa[_.pa++]|_.I<<8):_.Ka?_.b=0:(_.I<<=8,_.b+=8,_.Ka=1))}function Dt(_){return Et(_,1)}function Mt(_,E){var F=_.Ca;0>_.b&&Bt(_);var V=_.b,q=F*E>>>8,K=(_.I>>>V>q)+0;for(K?(F-=q,_.I-=q+1<<V>>>0):F=q+1,V=F,q=0;256<=V;)q+=8,V>>=8;return V=7^q+Rs[V],_.b-=V,_.Ca=(F<<V)-1,K}function qt(_,E,F){_[E+0]=F>>24&255,_[E+1]=F>>16&255,_[E+2]=F>>8&255,_[E+3]=F>>0&255}function nr(_,E){return _[E+0]<<0|_[E+1]<<8}function vr(_,E){return nr(_,E)|_[E+2]<<16}function br(_,E){return nr(_,E)|nr(_,E+2)<<16}function Fr(_,E){var F=1<<E;return e(_!=null),e(0<E),_.X=o(F),_.X==null?0:(_.Mb=32-E,_.Xa=E,1)}function kt(_,E){e(_!=null),e(E!=null),e(_.Xa==E.Xa),i(E.X,0,_.X,0,1<<E.Xa)}function lt(){this.X=[],this.Xa=this.Mb=0}function wt(_,E,F,V){e(F!=null),e(V!=null);var q=F[0],K=V[0];return q==0&&(q=(_*K+E/2)/E),K==0&&(K=(E*q+_/2)/_),0>=q||0>=K?0:(F[0]=q,V[0]=K,1)}function Ur(_,E){return _+(1<<E)-1>>>E}function tr(_,E){return((4278255360&_)+(4278255360&E)>>>0&4278255360)+((16711935&_)+(16711935&E)>>>0&16711935)>>>0}function ht(_,E){Ne[E]=function(F,V,q,K,te,se,oe){var le;for(le=0;le<te;++le){var _e=Ne[_](se[oe+le-1],q,K+le);se[oe+le]=tr(F[V+le],_e)}}}function $t(){this.ud=this.hd=this.jd=0}function or(_,E){return((4278124286&(_^E))>>>1)+(_&E)>>>0}function mr(_){return 0<=_&&256>_?_:0>_?0:255<_?255:void 0}function ur(_,E){return mr(_+(_-E+.5>>1))}function Wr(_,E,F){return Math.abs(E-F)-Math.abs(_-F)}function ri(_,E,F,V,q,K,te){for(V=K[te-1],F=0;F<q;++F)K[te+F]=V=tr(_[E+F],V)}function gi(_,E,F,V,q){var K;for(K=0;K<F;++K){var te=_[E+K],se=te>>8&255,oe=16711935&(oe=(oe=16711935&te)+((se<<16)+se));V[q+K]=(4278255360&te)+oe>>>0}}function Pi(_,E){E.jd=_>>0&255,E.hd=_>>8&255,E.ud=_>>16&255}function zt(_,E,F,V,q,K){var te;for(te=0;te<V;++te){var se=E[F+te],oe=se>>>8,le=se,_e=255&(_e=(_e=se>>>16)+((_.jd<<24>>24)*(oe<<24>>24)>>>5));le=255&(le=(le=le+((_.hd<<24>>24)*(oe<<24>>24)>>>5))+((_.ud<<24>>24)*(_e<<24>>24)>>>5)),q[K+te]=(4278255360&se)+(_e<<16)+le}}function Xr(_,E,F,V,q){Ne[E]=function(K,te,se,oe,le,_e,Ie,ve,Se){for(oe=Ie;oe<ve;++oe)for(Ie=0;Ie<Se;++Ie)le[_e++]=q(se[V(K[te++])])},Ne[_]=function(K,te,se,oe,le,_e,Ie){var ve=8>>K.b,Se=K.Ea,et=K.K[0],Oe=K.w;if(8>ve)for(K=(1<<K.b)-1,Oe=(1<<ve)-1;te<se;++te){var Re,Ve=0;for(Re=0;Re<Se;++Re)Re&K||(Ve=V(oe[le++])),_e[Ie++]=q(et[Ve&Oe]),Ve>>=ve}else Ne["VP8LMapColor"+F](oe,le,et,Oe,_e,Ie,te,se,Se)}}function Ar(_,E,F,V,q){for(F=E+F;E<F;){var K=_[E++];V[q++]=K>>16&255,V[q++]=K>>8&255,V[q++]=K>>0&255}}function Wt(_,E,F,V,q){for(F=E+F;E<F;){var K=_[E++];V[q++]=K>>16&255,V[q++]=K>>8&255,V[q++]=K>>0&255,V[q++]=K>>24&255}}function di(_,E,F,V,q){for(F=E+F;E<F;){var K=(te=_[E++])>>16&240|te>>12&15,te=te>>0&240|te>>28&15;V[q++]=K,V[q++]=te}}function Qt(_,E,F,V,q){for(F=E+F;E<F;){var K=(te=_[E++])>>16&248|te>>13&7,te=te>>5&224|te>>3&31;V[q++]=K,V[q++]=te}}function Tr(_,E,F,V,q){for(F=E+F;E<F;){var K=_[E++];V[q++]=K>>0&255,V[q++]=K>>8&255,V[q++]=K>>16&255}}function Lr(_,E,F,V,q,K){if(K==0)for(F=E+F;E<F;)qt(V,((K=_[E++])[0]>>24|K[1]>>8&65280|K[2]<<8&16711680|K[3]<<24)>>>0),q+=32;else i(V,q,_,E,F)}function Xt(_,E){Ne[E][0]=Ne[_+"0"],Ne[E][1]=Ne[_+"1"],Ne[E][2]=Ne[_+"2"],Ne[E][3]=Ne[_+"3"],Ne[E][4]=Ne[_+"4"],Ne[E][5]=Ne[_+"5"],Ne[E][6]=Ne[_+"6"],Ne[E][7]=Ne[_+"7"],Ne[E][8]=Ne[_+"8"],Ne[E][9]=Ne[_+"9"],Ne[E][10]=Ne[_+"10"],Ne[E][11]=Ne[_+"11"],Ne[E][12]=Ne[_+"12"],Ne[E][13]=Ne[_+"13"],Ne[E][14]=Ne[_+"0"],Ne[E][15]=Ne[_+"0"]}function xr(_){return _==vn||_==Os||_==Ro||_==vl}function er(){this.eb=[],this.size=this.A=this.fb=0}function vi(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Zi(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new er,this.f.kb=new vi,this.sd=null}function Qe(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Be(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function ue(_){return alert("todo:WebPSamplerProcessPlane"),_.T}function re(_,E){var F=_.T,V=E.ba.f.RGBA,q=V.eb,K=V.fb+_.ka*V.A,te=Yi[E.ba.S],se=_.y,oe=_.O,le=_.f,_e=_.N,Ie=_.ea,ve=_.W,Se=E.cc,et=E.dc,Oe=E.Mc,Re=E.Nc,Ve=_.ka,At=_.ka+_.T,dt=_.U,ft=dt+1>>1;for(Ve==0?te(se,oe,null,null,le,_e,Ie,ve,le,_e,Ie,ve,q,K,null,null,dt):(te(E.ec,E.fc,se,oe,Se,et,Oe,Re,le,_e,Ie,ve,q,K-V.A,q,K,dt),++F);Ve+2<At;Ve+=2)Se=le,et=_e,Oe=Ie,Re=ve,_e+=_.Rc,ve+=_.Rc,K+=2*V.A,te(se,(oe+=2*_.fa)-_.fa,se,oe,Se,et,Oe,Re,le,_e,Ie,ve,q,K-V.A,q,K,dt);return oe+=_.fa,_.j+At<_.o?(i(E.ec,E.fc,se,oe,dt),i(E.cc,E.dc,le,_e,ft),i(E.Mc,E.Nc,Ie,ve,ft),F--):1&At||te(se,oe,null,null,le,_e,Ie,ve,le,_e,Ie,ve,q,K+V.A,null,null,dt),F}function Ae(_,E,F){var V=_.F,q=[_.J];if(V!=null){var K=_.U,te=E.ba.S,se=te==tc||te==Ro;E=E.ba.f.RGBA;var oe=[0],le=_.ka;oe[0]=_.T,_.Kb&&(le==0?--oe[0]:(--le,q[0]-=_.width),_.j+_.ka+_.T==_.o&&(oe[0]=_.o-_.j-le));var _e=E.eb;le=E.fb+le*E.A,_=ra(V,q[0],_.width,K,oe,_e,le+(se?0:3),E.A),e(F==oe),_&&xr(te)&&ka(_e,le,se,K,oe,E.A)}return 0}function ge(_){var E=_.ma,F=E.ba.S,V=11>F,q=F==ec||F==jc||F==tc||F==qc||F==12||xr(F);if(E.memory=null,E.Ib=null,E.Jb=null,E.Nd=null,!Xl(E.Oa,_,q?11:12))return 0;if(q&&xr(F)&&gr(),_.da)alert("todo:use_scaling");else{if(V){if(E.Ib=ue,_.Kb){if(F=_.U+1>>1,E.memory=o(_.U+2*F),E.memory==null)return 0;E.ec=E.memory,E.fc=0,E.cc=E.ec,E.dc=E.fc+_.U,E.Mc=E.cc,E.Nc=E.dc+F,E.Ib=re,gr()}}else alert("todo:EmitYUV");q&&(E.Jb=Ae,V&&xt())}if(V&&!b){for(_=0;256>_;++_)M[_]=89858*(_-128)+oc>>No,J[_]=-22014*(_-128)+oc,z[_]=-45773*(_-128),O[_]=113618*(_-128)+oc>>No;for(_=wa;_<Qi;++_)E=76283*(_-16)+oc>>No,w[_-wa]=eo(E,255),l[_-wa]=eo(E+8>>4,15);b=1}return 1}function xe(_){var E=_.ma,F=_.U,V=_.T;return e(!(1&_.ka)),0>=F||0>=V?0:(F=E.Ib(_,E),E.Jb!=null&&E.Jb(_,E,F),E.Dc+=F,1)}function Ee(_){_.ma.memory=null}function we(_,E,F,V){return Ft(_,8)!=47?0:(E[0]=Ft(_,14)+1,F[0]=Ft(_,14)+1,V[0]=Ft(_,1),Ft(_,3)!=0?0:!_.h)}function Fe(_,E){if(4>_)return _+1;var F=_-2>>1;return(2+(1&_)<<F)+Ft(E,F)+1}function ze(_,E){return 120<E?E-120:1<=(F=((F=Sr[E-1])>>4)*_+(8-(15&F)))?F:1;var F}function Ge(_,E,F){var V=Ze(F),q=_[E+=255&V].g-8;return 0<q&&(pt(F,F.u+8),V=Ze(F),E+=_[E].value,E+=V&(1<<q)-1),pt(F,F.u+_[E].g),_[E].value}function st(_,E,F){return F.g+=_.g,F.value+=_.value<<E>>>0,e(8>=F.g),_.g}function vt(_,E,F){var V=_.xc;return e((E=V==0?0:_.vc[_.md*(F>>V)+(E>>V)])<_.Wb),_.Ya[E]}function Tt(_,E,F,V){var q=_.ab,K=_.c*E,te=_.C;E=te+E;var se=F,oe=V;for(V=_.Ta,F=_.Ua;0<q--;){var le=_.gc[q],_e=te,Ie=E,ve=se,Se=oe,et=(oe=V,se=F,le.Ea);switch(e(_e<Ie),e(Ie<=le.nc),le.hc){case 2:fn(ve,Se,(Ie-_e)*et,oe,se);break;case 0:var Oe=_e,Re=Ie,Ve=oe,At=se,dt=(Ht=le).Ea;Oe==0&&(Hu(ve,Se,null,null,1,Ve,At),ri(ve,Se+1,0,0,dt-1,Ve,At+1),Se+=dt,At+=dt,++Oe);for(var ft=1<<Ht.b,Nt=ft-1,It=Ur(dt,Ht.b),jt=Ht.K,Ht=Ht.w+(Oe>>Ht.b)*It;Oe<Re;){var Pr=jt,yr=Ht,Ir=1;for(Ln(ve,Se,Ve,At-dt,1,Ve,At);Ir<dt;){var hr=(Ir&~Nt)+ft;hr>dt&&(hr=dt),(0,ho[Pr[yr++]>>8&15])(ve,Se+ +Ir,Ve,At+Ir-dt,hr-Ir,Ve,At+Ir),Ir=hr}Se+=dt,At+=dt,++Oe&Nt||(Ht+=It)}Ie!=le.nc&&i(oe,se-et,oe,se+(Ie-_e-1)*et,et);break;case 1:for(et=ve,Re=Se,dt=(ve=le.Ea)-(At=ve&~(Ve=(Se=1<<le.b)-1)),Oe=Ur(ve,le.b),ft=le.K,le=le.w+(_e>>le.b)*Oe;_e<Ie;){for(Nt=ft,It=le,jt=new $t,Ht=Re+At,Pr=Re+ve;Re<Ht;)Pi(Nt[It++],jt),vs(jt,et,Re,Se,oe,se),Re+=Se,se+=Se;Re<Pr&&(Pi(Nt[It++],jt),vs(jt,et,Re,dt,oe,se),Re+=dt,se+=dt),++_e&Ve||(le+=Oe)}break;case 3:if(ve==oe&&Se==se&&0<le.b){for(Re=oe,ve=et=se+(Ie-_e)*et-(At=(Ie-_e)*Ur(le.Ea,le.b)),Se=oe,Ve=se,Oe=[],At=(dt=At)-1;0<=At;--At)Oe[At]=Se[Ve+At];for(At=dt-1;0<=At;--At)Re[ve+At]=Oe[At];pn(le,_e,Ie,oe,et,oe,se)}else pn(le,_e,Ie,ve,Se,oe,se)}se=V,oe=F}oe!=F&&i(V,F,se,oe,K)}function Kt(_,E){var F=_.V,V=_.Ba+_.c*_.C,q=E-_.C;if(e(E<=_.l.o),e(16>=q),0<q){var K=_.l,te=_.Ta,se=_.Ua,oe=K.width;if(Tt(_,q,F,V),q=se=[se],e((F=_.C)<(V=E)),e(K.v<K.va),V>K.o&&(V=K.o),F<K.j){var le=K.j-F;F=K.j,q[0]+=le*oe}if(F>=V?F=0:(q[0]+=4*K.v,K.ka=F-K.j,K.U=K.va-K.v,K.T=V-F,F=1),F){if(se=se[0],11>(F=_.ca).S){var _e=F.f.RGBA,Ie=(V=F.S,q=K.U,K=K.T,le=_e.eb,_e.A),ve=K;for(_e=_e.fb+_.Ma*_e.A;0<ve--;){var Se=te,et=se,Oe=q,Re=le,Ve=_e;switch(V){case Gc:ps(Se,et,Oe,Re,Ve);break;case ec:Fo(Se,et,Oe,Re,Ve);break;case vn:Fo(Se,et,Oe,Re,Ve),ka(Re,Ve,0,Oe,1,0);break;case mu:sl(Se,et,Oe,Re,Ve);break;case jc:Lr(Se,et,Oe,Re,Ve,1);break;case Os:Lr(Se,et,Oe,Re,Ve,1),ka(Re,Ve,0,Oe,1,0);break;case tc:Lr(Se,et,Oe,Re,Ve,0);break;case Ro:Lr(Se,et,Oe,Re,Ve,0),ka(Re,Ve,1,Oe,1,0);break;case qc:vo(Se,et,Oe,Re,Ve);break;case vl:vo(Se,et,Oe,Re,Ve),ta(Re,Ve,Oe,1,0);break;case ol:_a(Se,et,Oe,Re,Ve);break;default:e(0)}se+=oe,_e+=Ie}_.Ma+=K}else alert("todo:EmitRescaledRowsYUVA");e(_.Ma<=F.height)}}_.C=E,e(_.C<=_.i)}function rr(_){var E;if(0<_.ua)return 0;for(E=0;E<_.Wb;++E){var F=_.Ya[E].G,V=_.Ya[E].H;if(0<F[1][V[1]+0].g||0<F[2][V[2]+0].g||0<F[3][V[3]+0].g)return 0}return 1}function Gt(_,E,F,V,q,K){if(_.Z!=0){var te=_.qd,se=_.rd;for(e(Ws[_.Z]!=null);E<F;++E)Ws[_.Z](te,se,V,q,V,q,K),te=V,se=q,q+=K;_.qd=te,_.rd=se}}function dr(_,E){var F=_.l.ma,V=F.Z==0||F.Z==1?_.l.j:_.C;if(V=_.C<V?V:_.C,e(E<=_.l.o),E>V){var q=_.l.width,K=F.ca,te=F.tb+q*V,se=_.V,oe=_.Ba+_.c*V,le=_.gc;e(_.ab==1),e(le[0].hc==3),ya(le[0],V,E,se,oe,K,te),Gt(F,V,E,K,te,q)}_.C=_.Ma=E}function Cr(_,E,F,V,q,K,te){var se=_.$/V,oe=_.$%V,le=_.m,_e=_.s,Ie=F+_.$,ve=Ie;q=F+V*q;var Se=F+V*K,et=280+_e.ua,Oe=_.Pb?se:16777216,Re=0<_e.ua?_e.Wa:null,Ve=_e.wc,At=Ie<Se?vt(_e,oe,se):null;e(_.C<K),e(Se<=q);var dt=!1;e:for(;;){for(;dt||Ie<Se;){var ft=0;if(se>=Oe){var Nt=Ie-F;e((Oe=_).Pb),Oe.wd=Oe.m,Oe.xd=Nt,0<Oe.s.ua&&kt(Oe.s.Wa,Oe.s.vb),Oe=se+bl}if(oe&Ve||(At=vt(_e,oe,se)),e(At!=null),At.Qb&&(E[Ie]=At.qb,dt=!0),!dt)if(mt(le),At.jc){ft=le,Nt=E;var It=Ie,jt=At.pd[Ze(ft)&_s-1];e(At.jc),256>jt.g?(pt(ft,ft.u+jt.g),Nt[It]=jt.value,ft=0):(pt(ft,ft.u+jt.g-256),e(256<=jt.value),ft=jt.value),ft==0&&(dt=!0)}else ft=Ge(At.G[0],At.H[0],le);if(le.h)break;if(dt||256>ft){if(!dt)if(At.nd)E[Ie]=(At.qb|ft<<8)>>>0;else{if(mt(le),dt=Ge(At.G[1],At.H[1],le),mt(le),Nt=Ge(At.G[2],At.H[2],le),It=Ge(At.G[3],At.H[3],le),le.h)break;E[Ie]=(It<<24|dt<<16|ft<<8|Nt)>>>0}if(dt=!1,++Ie,++oe>=V&&(oe=0,++se,te!=null&&se<=K&&!(se%16)&&te(_,se),Re!=null))for(;ve<Ie;)ft=E[ve++],Re.X[(506832829*ft&4294967295)>>>Re.Mb]=ft}else if(280>ft){if(ft=Fe(ft-256,le),Nt=Ge(At.G[4],At.H[4],le),mt(le),Nt=ze(V,Nt=Fe(Nt,le)),le.h)break;if(Ie-F<Nt||q-Ie<ft)break e;for(It=0;It<ft;++It)E[Ie+It]=E[Ie+It-Nt];for(Ie+=ft,oe+=ft;oe>=V;)oe-=V,++se,te!=null&&se<=K&&!(se%16)&&te(_,se);if(e(Ie<=q),oe&Ve&&(At=vt(_e,oe,se)),Re!=null)for(;ve<Ie;)ft=E[ve++],Re.X[(506832829*ft&4294967295)>>>Re.Mb]=ft}else{if(!(ft<et))break e;for(dt=ft-280,e(Re!=null);ve<Ie;)ft=E[ve++],Re.X[(506832829*ft&4294967295)>>>Re.Mb]=ft;ft=Ie,e(!(dt>>>(Nt=Re).Xa)),E[ft]=Nt.X[dt],dt=!0}dt||e(le.h==rt(le))}if(_.Pb&&le.h&&Ie<q)e(_.m.h),_.a=5,_.m=_.wd,_.$=_.xd,0<_.s.ua&&kt(_.s.vb,_.s.Wa);else{if(le.h)break e;te!=null&&te(_,se>K?K:se),_.a=0,_.$=Ie-F}return 1}return _.a=3,0}function Gr(_){e(_!=null),_.vc=null,_.yc=null,_.Ya=null;var E=_.Wa;E!=null&&(E.X=null),_.vb=null,e(_!=null)}function Er(){var _=new nl;return _==null?null:(_.a=0,_.xb=_u,Xt("Predictor","VP8LPredictors"),Xt("Predictor","VP8LPredictors_C"),Xt("PredictorAdd","VP8LPredictorsAdd"),Xt("PredictorAdd","VP8LPredictorsAdd_C"),fn=gi,vs=zt,ps=Ar,Fo=Wt,vo=di,_a=Qt,sl=Tr,Ne.VP8LMapColor32b=fs,Ne.VP8LMapColor8b=Jl,_)}function zr(_,E,F,V,q){var K=1,te=[_],se=[E],oe=V.m,le=V.s,_e=null,Ie=0;e:for(;;){if(F)for(;K&&Ft(oe,1);){var ve=te,Se=se,et=V,Oe=1,Re=et.m,Ve=et.gc[et.ab],At=Ft(Re,2);if(et.Oc&1<<At)K=0;else{switch(et.Oc|=1<<At,Ve.hc=At,Ve.Ea=ve[0],Ve.nc=Se[0],Ve.K=[null],++et.ab,e(4>=et.ab),At){case 0:case 1:Ve.b=Ft(Re,3)+2,Oe=zr(Ur(Ve.Ea,Ve.b),Ur(Ve.nc,Ve.b),0,et,Ve.K),Ve.K=Ve.K[0];break;case 3:var dt,ft=Ft(Re,8)+1,Nt=16<ft?0:4<ft?1:2<ft?2:3;if(ve[0]=Ur(Ve.Ea,Nt),Ve.b=Nt,dt=Oe=zr(ft,1,0,et,Ve.K)){var It,jt=ft,Ht=Ve,Pr=1<<(8>>Ht.b),yr=o(Pr);if(yr==null)dt=0;else{var Ir=Ht.K[0],hr=Ht.w;for(yr[0]=Ht.K[0][0],It=1;It<1*jt;++It)yr[It]=tr(Ir[hr+It],yr[It-1]);for(;It<4*Pr;++It)yr[It]=0;Ht.K[0]=null,Ht.K[0]=yr,dt=1}}Oe=dt;break;case 2:break;default:e(0)}K=Oe}}if(te=te[0],se=se[0],K&&Ft(oe,1)&&!(K=1<=(Ie=Ft(oe,4))&&11>=Ie)){V.a=3;break e}var li;if(li=K)t:{var ti,ii,Ri,ki=V,wi=te,Ki=se,xi=Ie,Zn=F,Wi=ki.m,Oi=ki.s,Xi=[null],hi=1,zi=0,on=oi[xi];r:for(;;){if(Zn&&Ft(Wi,1)){var rs=Ft(Wi,3)+2,an=Ur(wi,rs),is=Ur(Ki,rs),Es=an*is;if(!zr(an,is,0,ki,Xi))break r;for(Xi=Xi[0],Oi.xc=rs,ti=0;ti<Es;++ti){var yi=Xi[ti]>>8&65535;Xi[ti]=yi,yi>=hi&&(hi=yi+1)}}if(Wi.h)break r;for(ii=0;5>ii;++ii){var bn=Gu[ii];!ii&&0<xi&&(bn+=1<<xi),zi<bn&&(zi=bn)}var ia=a(hi*on,De),Ns=hi,so=a(Ns,Xe);if(so==null)var xl=null;else e(65536>=Ns),xl=so;var bo=o(zi);if(xl==null||bo==null||ia==null){ki.a=1;break r}var ac=ia;for(ti=Ri=0;ti<hi;++ti){var Ua=xl[ti],Dn=Ua.G,Ec=Ua.H,vu=0,wl=1,al=0;for(ii=0;5>ii;++ii){bn=Gu[ii],Dn[ii]=ac,Ec[ii]=Ri,!ii&&0<xi&&(bn+=1<<xi);n:{var qu,hA=bn,Zc=ki,JA=bo,AA=ac,Gd=Ri,$u=0,bu=Zc.m,jd=Ft(bu,1);if(n(JA,0,0,hA),jd){var wm=Ft(bu,1)+1,na=Ft(bu,1),lc=Ft(bu,na==0?1:8);JA[lc]=1,wm==2&&(JA[lc=Ft(bu,8)]=1);var dA=1}else{var Sh=o(19),xu=Ft(bu,4)+4;if(19<xu){Zc.a=3;var Th=0;break n}for(qu=0;qu<xu;++qu)Sh[no[qu]]=Ft(bu,3);var Ih=void 0,fA=void 0,cp=Zc,sa=Sh,Jc=hA,qd=JA,pA=0,Bl=cp.m,$d=8,wu=a(128,De);i:for(;ke(wu,0,7,sa,19);){if(Ft(Bl,1)){var Cl=2+2*Ft(Bl,3);if((Ih=2+Ft(Bl,Cl))>Jc)break i}else Ih=Jc;for(fA=0;fA<Jc&&Ih--;){mt(Bl);var Kd=wu[0+(127&Ze(Bl))];pt(Bl,Bl.u+Kd.g);var Lh=Kd.value;if(16>Lh)qd[fA++]=Lh,Lh!=0&&($d=Lh);else{var up=Lh==16,Bm=Lh-16,hp=$c[Bm],Ap=Ft(Bl,yu[Bm])+hp;if(fA+Ap>Jc)break i;for(var dp=up?$d:0;0<Ap--;)qd[fA++]=dp}}pA=1;break i}pA||(cp.a=3),dA=pA}(dA=dA&&!bu.h)&&($u=ke(AA,Gd,8,JA,hA)),dA&&$u!=0?Th=$u:(Zc.a=3,Th=0)}if(Th==0)break r;if(wl&&xa[ii]==1&&(wl=ac[Ri].g==0),vu+=ac[Ri].g,Ri+=Th,3>=ii){var Sc,zo=bo[0];for(Sc=1;Sc<bn;++Sc)bo[Sc]>zo&&(zo=bo[Sc]);al+=zo}}if(Ua.nd=wl,Ua.Qb=0,wl&&(Ua.qb=(Dn[3][Ec[3]+0].value<<24|Dn[1][Ec[1]+0].value<<16|Dn[2][Ec[2]+0].value)>>>0,vu==0&&256>Dn[0][Ec[0]+0].value&&(Ua.Qb=1,Ua.qb+=Dn[0][Ec[0]+0].value<<8)),Ua.jc=!Ua.Qb&&6>al,Ua.jc){var gA,Na=Ua;for(gA=0;gA<_s;++gA){var El=gA,Ku=Na.pd[El],Wd=Na.G[0][Na.H[0]+El];256<=Wd.value?(Ku.g=Wd.g+256,Ku.value=Wd.value):(Ku.g=0,Ku.value=0,El>>=st(Wd,8,Ku),El>>=st(Na.G[1][Na.H[1]+El],16,Ku),El>>=st(Na.G[2][Na.H[2]+El],0,Ku),st(Na.G[3][Na.H[3]+El],24,Ku))}}}Oi.vc=Xi,Oi.Wb=hi,Oi.Ya=xl,Oi.yc=ia,li=1;break t}li=0}if(!(K=li)){V.a=3;break e}if(0<Ie){if(le.ua=1<<Ie,!Fr(le.Wa,Ie)){V.a=1,K=0;break e}}else le.ua=0;var fp=V,Cm=te,pp=se,mA=fp.s,Xd=mA.xc;if(fp.c=Cm,fp.i=pp,mA.md=Ur(Cm,Xd),mA.wc=Xd==0?-1:(1<<Xd)-1,F){V.xb=Oo;break e}if((_e=o(te*se))==null){V.a=1,K=0;break e}K=(K=Cr(V,_e,0,te,se,se,null))&&!oe.h;break e}return K?(q!=null?q[0]=_e:(e(_e==null),e(F)),V.$=0,F||Gr(le)):Gr(le),K}function ot(_,E){var F=_.c*_.i,V=F+E+16*E;return e(_.c<=E),_.V=o(V),_.V==null?(_.Ta=null,_.Ua=0,_.a=1,0):(_.Ta=_.V,_.Ua=_.Ba+F+E,1)}function ir(_,E){var F=_.C,V=E-F,q=_.V,K=_.Ba+_.c*F;for(e(E<=_.l.o);0<V;){var te=16<V?16:V,se=_.l.ma,oe=_.l.width,le=oe*te,_e=se.ca,Ie=se.tb+oe*F,ve=_.Ta,Se=_.Ua;Tt(_,te,q,K),Nr(ve,Se,_e,Ie,le),Gt(se,F,F+te,_e,Ie,oe),V-=te,q+=te*_.c,F+=te}e(F==E),_.C=_.Ma=E}function Vt(){this.ub=this.yd=this.td=this.Rb=0}function Hr(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function ci(){this.Fb=this.Bb=this.Cb=0,this.Zb=o(4),this.Lb=o(4)}function un(){this.Yb=function(){var _=[];return function E(F,V,q){for(var K=q[V],te=0;te<K&&(F.push(q.length>V+1?[]:0),!(q.length<V+1));te++)E(F[te],V+1,q)}(_,0,[3,11]),_}()}function wn(){this.jb=o(3),this.Wc=s([4,8],un),this.Xc=s([4,17],un)}function mi(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new o(4),this.od=new o(4)}function mn(){this.ld=this.La=this.dd=this.tc=0}function yn(){this.Na=this.la=0}function fi(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function jn(){this.ad=o(384),this.Za=0,this.Ob=o(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function qs(){this.uc=this.M=this.Nb=0,this.wa=Array(new mn),this.Y=0,this.ya=Array(new jn),this.aa=0,this.l=new Xa}function Ui(){this.y=o(16),this.f=o(8),this.ea=o(8)}function Bn(){this.cb=this.a=0,this.sc="",this.m=new Zt,this.Od=new Vt,this.Kc=new Hr,this.ed=new mi,this.Qa=new ci,this.Ic=this.$c=this.Aa=0,this.D=new qs,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=a(8,Zt),this.ia=0,this.pb=a(4,fi),this.Pa=new wn,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new Ui),this.Hd=0,this.rb=Array(new yn),this.sb=0,this.wa=Array(new mn),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new jn),this.L=this.aa=0,this.gd=s([4,2],mn),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function Xa(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function Nn(){var _=new Bn;return _!=null&&(_.a=0,_.sc="OK",_.cb=0,_.Xb=0,Us||(Us=bi)),_}function Zr(_,E,F){return _.a==0&&(_.a=E,_.sc=F,_.cb=0),0}function co(_,E,F){return 3<=F&&_[E+0]==157&&_[E+1]==1&&_[E+2]==42}function Fs(_,E){if(_==null)return 0;if(_.a=0,_.sc="OK",E==null)return Zr(_,2,"null VP8Io passed to VP8GetHeaders()");var F=E.data,V=E.w,q=E.ha;if(4>q)return Zr(_,7,"Truncated header.");var K=F[V+0]|F[V+1]<<8|F[V+2]<<16,te=_.Od;if(te.Rb=!(1&K),te.td=K>>1&7,te.yd=K>>4&1,te.ub=K>>5,3<te.td)return Zr(_,3,"Incorrect keyframe parameters.");if(!te.yd)return Zr(_,4,"Frame not displayable.");V+=3,q-=3;var se=_.Kc;if(te.Rb){if(7>q)return Zr(_,7,"cannot parse picture header");if(!co(F,V,q))return Zr(_,3,"Bad code word");se.c=16383&(F[V+4]<<8|F[V+3]),se.Td=F[V+4]>>6,se.i=16383&(F[V+6]<<8|F[V+5]),se.Ud=F[V+6]>>6,V+=7,q-=7,_.za=se.c+15>>4,_.Ub=se.i+15>>4,E.width=se.c,E.height=se.i,E.Da=0,E.j=0,E.v=0,E.va=E.width,E.o=E.height,E.da=0,E.ib=E.width,E.hb=E.height,E.U=E.width,E.T=E.height,n((K=_.Pa).jb,0,255,K.jb.length),e((K=_.Qa)!=null),K.Cb=0,K.Bb=0,K.Fb=1,n(K.Zb,0,0,K.Zb.length),n(K.Lb,0,0,K.Lb)}if(te.ub>q)return Zr(_,7,"bad partition length");Ct(K=_.m,F,V,te.ub),V+=te.ub,q-=te.ub,te.Rb&&(se.Ld=Dt(K),se.Kd=Dt(K)),se=_.Qa;var oe,le=_.Pa;if(e(K!=null),e(se!=null),se.Cb=Dt(K),se.Cb){if(se.Bb=Dt(K),Dt(K)){for(se.Fb=Dt(K),oe=0;4>oe;++oe)se.Zb[oe]=Dt(K)?Pt(K,7):0;for(oe=0;4>oe;++oe)se.Lb[oe]=Dt(K)?Pt(K,6):0}if(se.Bb)for(oe=0;3>oe;++oe)le.jb[oe]=Dt(K)?Et(K,8):255}else se.Bb=0;if(K.Ka)return Zr(_,3,"cannot parse segment header");if((se=_.ed).zd=Dt(K),se.Tb=Et(K,6),se.wb=Et(K,3),se.Pc=Dt(K),se.Pc&&Dt(K)){for(le=0;4>le;++le)Dt(K)&&(se.vd[le]=Pt(K,6));for(le=0;4>le;++le)Dt(K)&&(se.od[le]=Pt(K,6))}if(_.L=se.Tb==0?0:se.zd?1:2,K.Ka)return Zr(_,3,"cannot parse filter header");var _e=q;if(q=oe=V,V=oe+_e,se=_e,_.Xb=(1<<Et(_.m,2))-1,_e<3*(le=_.Xb))F=7;else{for(oe+=3*le,se-=3*le,_e=0;_e<le;++_e){var Ie=F[q+0]|F[q+1]<<8|F[q+2]<<16;Ie>se&&(Ie=se),Ct(_.Jc[+_e],F,oe,Ie),oe+=Ie,se-=Ie,q+=3}Ct(_.Jc[+le],F,oe,se),F=oe<V?0:5}if(F!=0)return Zr(_,F,"cannot parse partitions");for(F=Et(oe=_.m,7),q=Dt(oe)?Pt(oe,4):0,V=Dt(oe)?Pt(oe,4):0,se=Dt(oe)?Pt(oe,4):0,le=Dt(oe)?Pt(oe,4):0,oe=Dt(oe)?Pt(oe,4):0,_e=_.Qa,Ie=0;4>Ie;++Ie){if(_e.Cb){var ve=_e.Zb[Ie];_e.Fb||(ve+=F)}else{if(0<Ie){_.pb[Ie]=_.pb[0];continue}ve=F}var Se=_.pb[Ie];Se.Sc[0]=Kc[eo(ve+q,127)],Se.Sc[1]=rc[eo(ve+0,127)],Se.Eb[0]=2*Kc[eo(ve+V,127)],Se.Eb[1]=101581*rc[eo(ve+se,127)]>>16,8>Se.Eb[1]&&(Se.Eb[1]=8),Se.Qc[0]=Kc[eo(ve+le,117)],Se.Qc[1]=rc[eo(ve+oe,127)],Se.lc=ve+oe}if(!te.Rb)return Zr(_,4,"Not a key frame.");for(Dt(K),te=_.Pa,F=0;4>F;++F){for(q=0;8>q;++q)for(V=0;3>V;++V)for(se=0;11>se;++se)le=Mt(K,Xn[F][q][V][se])?Et(K,8):Kr[F][q][V][se],te.Wc[F][q].Yb[V][se]=le;for(q=0;17>q;++q)te.Xc[F][q]=te.Wc[F][ju[q]]}return _.kc=Dt(K),_.kc&&(_.Bd=Et(K,8)),_.cb=1}function bi(_,E,F,V,q,K,te){var se=E[q].Yb[F];for(F=0;16>q;++q){if(!Mt(_,se[F+0]))return q;for(;!Mt(_,se[F+1]);)if(se=E[++q].Yb[0],F=0,q==16)return 16;var oe=E[q+1].Yb;if(Mt(_,se[F+2])){var le=_,_e=0;if(Mt(le,(ve=se)[(Ie=F)+3]))if(Mt(le,ve[Ie+6])){for(se=0,Ie=2*(_e=Mt(le,ve[Ie+8]))+(ve=Mt(le,ve[Ie+9+_e])),_e=0,ve=uA[Ie];ve[se];++se)_e+=_e+Mt(le,ve[se]);_e+=3+(8<<Ie)}else Mt(le,ve[Ie+7])?(_e=7+2*Mt(le,165),_e+=Mt(le,145)):_e=5+Mt(le,159);else _e=Mt(le,ve[Ie+4])?3+Mt(le,ve[Ie+5]):2;se=oe[2]}else _e=1,se=oe[1];oe=te+Wn[q],0>(le=_).b&&Bt(le);var Ie,ve=le.b,Se=(Ie=le.Ca>>1)-(le.I>>ve)>>31;--le.b,le.Ca+=Se,le.Ca|=1,le.I-=(Ie+1&Se)<<ve,K[oe]=((_e^Se)-Se)*V[(0<q)+0]}return 16}function Ii(_){var E=_.rb[_.sb-1];E.la=0,E.Na=0,n(_.zc,0,0,_.zc.length),_.ja=0}function ss(_,E){if(_==null)return 0;if(E==null)return Zr(_,2,"NULL VP8Io parameter in VP8Decode().");if(!_.cb&&!Fs(_,E))return 0;if(e(_.cb),E.ac==null||E.ac(E)){E.ob&&(_.L=0);var F=x[_.L];if(_.L==2?(_.yb=0,_.zb=0):(_.yb=E.v-F>>4,_.zb=E.j-F>>4,0>_.yb&&(_.yb=0),0>_.zb&&(_.zb=0)),_.Va=E.o+15+F>>4,_.Hb=E.va+15+F>>4,_.Hb>_.za&&(_.Hb=_.za),_.Va>_.Ub&&(_.Va=_.Ub),0<_.L){var V=_.ed;for(F=0;4>F;++F){var q;if(_.Qa.Cb){var K=_.Qa.Lb[F];_.Qa.Fb||(K+=V.Tb)}else K=V.Tb;for(q=0;1>=q;++q){var te=_.gd[F][q],se=K;if(V.Pc&&(se+=V.vd[0],q&&(se+=V.od[0])),0<(se=0>se?0:63<se?63:se)){var oe=se;0<V.wb&&(oe=4<V.wb?oe>>2:oe>>1)>9-V.wb&&(oe=9-V.wb),1>oe&&(oe=1),te.dd=oe,te.tc=2*se+oe,te.ld=40<=se?2:15<=se?1:0}else te.tc=0;te.La=q}}}F=0}else Zr(_,6,"Frame setup failed"),F=_.a;if(F=F==0){if(F){_.$c=0,0<_.Aa||(_.Ic=L);e:{F=_.Ic,V=4*(oe=_.za);var le=32*oe,_e=oe+1,Ie=0<_.L?oe*(0<_.Aa?2:1):0,ve=(_.Aa==2?2:1)*oe;if((te=V+832+(q=3*(16*F+x[_.L])/2*le)+(K=_.Fa!=null&&0<_.Fa.length?_.Kc.c*_.Kc.i:0))!=te)F=0;else{if(te>_.Vb){if(_.Vb=0,_.Ec=o(te),_.Fc=0,_.Ec==null){F=Zr(_,1,"no memory during frame initialization.");break e}_.Vb=te}te=_.Ec,se=_.Fc,_.Ac=te,_.Bc=se,se+=V,_.Gd=a(le,Ui),_.Hd=0,_.rb=a(_e+1,yn),_.sb=1,_.wa=Ie?a(Ie,mn):null,_.Y=0,_.D.Nb=0,_.D.wa=_.wa,_.D.Y=_.Y,0<_.Aa&&(_.D.Y+=oe),e(!0),_.oc=te,_.pc=se,se+=832,_.ya=a(ve,jn),_.aa=0,_.D.ya=_.ya,_.D.aa=_.aa,_.Aa==2&&(_.D.aa+=oe),_.R=16*oe,_.B=8*oe,oe=(le=x[_.L])*_.R,le=le/2*_.B,_.sa=te,_.ta=se+oe,_.qa=_.sa,_.ra=_.ta+16*F*_.R+le,_.Ha=_.qa,_.Ia=_.ra+8*F*_.B+le,_.$c=0,se+=q,_.mb=K?te:null,_.nb=K?se:null,e(se+K<=_.Fc+_.Vb),Ii(_),n(_.Ac,_.Bc,0,V),F=1}}if(F){if(E.ka=0,E.y=_.sa,E.O=_.ta,E.f=_.qa,E.N=_.ra,E.ea=_.Ha,E.Vd=_.Ia,E.fa=_.R,E.Rc=_.B,E.F=null,E.J=0,!Mr){for(F=-255;255>=F;++F)ba[255+F]=0>F?-F:F;for(F=-1020;1020>=F;++F)Rr[1020+F]=-128>F?-128:127<F?127:F;for(F=-112;112>=F;++F)yl[112+F]=-16>F?-16:15<F?15:F;for(F=-255;510>=F;++F)_l[255+F]=0>F?0:255<F?255:F;Mr=1}Do=Je,to=Za,bs=Ys,Ao=Ja,Ra=He,$s=Mi,ml=xc,Yl=Yo,ks=Eh,ea=pu,ln=ql,Kn=Hc,ls=gu,Ni=Vu,tn=jl,nn=Mo,zn=Zo,va=bc,sn[0]=as,sn[1]=Ot,sn[2]=Ya,sn[3]=Gl,sn[4]=Lo,sn[5]=ys,sn[6]=Ia,sn[7]=La,sn[8]=Aa,sn[9]=el,ko[0]=os,ko[1]=qr,ko[2]=Ci,ko[3]=In,ko[4]=_n,ko[5]=fu,ko[6]=Hl,Ks[0]=Fi,Ks[1]=fr,Ks[2]=Vc,Ks[3]=tl,Ks[4]=As,Ks[5]=da,Ks[6]=En,F=1}else F=0}F&&(F=function(Se,et){for(Se.M=0;Se.M<Se.Va;++Se.M){var Oe,Re=Se.Jc[Se.M&Se.Xb],Ve=Se.m,At=Se;for(Oe=0;Oe<At.za;++Oe){var dt=Ve,ft=At,Nt=ft.Ac,It=ft.Bc+4*Oe,jt=ft.zc,Ht=ft.ya[ft.aa+Oe];if(ft.Qa.Bb?Ht.$b=Mt(dt,ft.Pa.jb[0])?2+Mt(dt,ft.Pa.jb[2]):Mt(dt,ft.Pa.jb[1]):Ht.$b=0,ft.kc&&(Ht.Ad=Mt(dt,ft.Bd)),Ht.Za=!Mt(dt,145)+0,Ht.Za){var Pr=Ht.Ob,yr=0;for(ft=0;4>ft;++ft){var Ir,hr=jt[0+ft];for(Ir=0;4>Ir;++Ir){hr=Qr[Nt[It+Ir]][hr];for(var li=Wc[Mt(dt,hr[0])];0<li;)li=Wc[2*li+Mt(dt,hr[li])];hr=-li,Nt[It+Ir]=hr}i(Pr,yr,Nt,It,4),yr+=4,jt[0+ft]=hr}}else hr=Mt(dt,156)?Mt(dt,128)?1:3:Mt(dt,163)?2:0,Ht.Ob[0]=hr,n(Nt,It,hr,4),n(jt,0,hr,4);Ht.Dd=Mt(dt,142)?Mt(dt,114)?Mt(dt,183)?1:3:2:0}if(At.m.Ka)return Zr(Se,7,"Premature end-of-partition0 encountered.");for(;Se.ja<Se.za;++Se.ja){if(At=Re,dt=(Ve=Se).rb[Ve.sb-1],Nt=Ve.rb[Ve.sb+Ve.ja],Oe=Ve.ya[Ve.aa+Ve.ja],It=Ve.kc?Oe.Ad:0)dt.la=Nt.la=0,Oe.Za||(dt.Na=Nt.Na=0),Oe.Hc=0,Oe.Gc=0,Oe.ia=0;else{var ti,ii;if(dt=Nt,Nt=At,It=Ve.Pa.Xc,jt=Ve.ya[Ve.aa+Ve.ja],Ht=Ve.pb[jt.$b],ft=jt.ad,Pr=0,yr=Ve.rb[Ve.sb-1],hr=Ir=0,n(ft,Pr,0,384),jt.Za)var Ri=0,ki=It[3];else{li=o(16);var wi=dt.Na+yr.Na;if(wi=Us(Nt,It[1],wi,Ht.Eb,0,li,0),dt.Na=yr.Na=(0<wi)+0,1<wi)Do(li,0,ft,Pr);else{var Ki=li[0]+3>>3;for(li=0;256>li;li+=16)ft[Pr+li]=Ki}Ri=1,ki=It[0]}var xi=15&dt.la,Zn=15&yr.la;for(li=0;4>li;++li){var Wi=1&Zn;for(Ki=ii=0;4>Ki;++Ki)xi=xi>>1|(Wi=(wi=Us(Nt,ki,wi=Wi+(1&xi),Ht.Sc,Ri,ft,Pr))>Ri)<<7,ii=ii<<2|(3<wi?3:1<wi?2:ft[Pr+0]!=0),Pr+=16;xi>>=4,Zn=Zn>>1|Wi<<7,Ir=(Ir<<8|ii)>>>0}for(ki=xi,Ri=Zn>>4,ti=0;4>ti;ti+=2){for(ii=0,xi=dt.la>>4+ti,Zn=yr.la>>4+ti,li=0;2>li;++li){for(Wi=1&Zn,Ki=0;2>Ki;++Ki)wi=Wi+(1&xi),xi=xi>>1|(Wi=0<(wi=Us(Nt,It[2],wi,Ht.Qc,0,ft,Pr)))<<3,ii=ii<<2|(3<wi?3:1<wi?2:ft[Pr+0]!=0),Pr+=16;xi>>=2,Zn=Zn>>1|Wi<<5}hr|=ii<<4*ti,ki|=xi<<4<<ti,Ri|=(240&Zn)<<ti}dt.la=ki,yr.la=Ri,jt.Hc=Ir,jt.Gc=hr,jt.ia=43690&hr?0:Ht.ia,It=!(Ir|hr)}if(0<Ve.L&&(Ve.wa[Ve.Y+Ve.ja]=Ve.gd[Oe.$b][Oe.Za],Ve.wa[Ve.Y+Ve.ja].La|=!It),At.Ka)return Zr(Se,7,"Premature end-of-file encountered.")}if(Ii(Se),Ve=et,At=1,Oe=(Re=Se).D,dt=0<Re.L&&Re.M>=Re.zb&&Re.M<=Re.Va,Re.Aa==0)e:{if(Oe.M=Re.M,Oe.uc=dt,wc(Re,Oe),At=1,Oe=(ii=Re.D).Nb,dt=(hr=x[Re.L])*Re.R,Nt=hr/2*Re.B,li=16*Oe*Re.R,Ki=8*Oe*Re.B,It=Re.sa,jt=Re.ta-dt+li,Ht=Re.qa,ft=Re.ra-Nt+Ki,Pr=Re.Ha,yr=Re.Ia-Nt+Ki,Zn=(xi=ii.M)==0,Ir=xi>=Re.Va-1,Re.Aa==2&&wc(Re,ii),ii.uc)for(Wi=(wi=Re).D.M,e(wi.D.uc),ii=wi.yb;ii<wi.Hb;++ii){Ri=ii,ki=Wi;var Oi=(Xi=(bn=wi).D).Nb;ti=bn.R;var Xi=Xi.wa[Xi.Y+Ri],hi=bn.sa,zi=bn.ta+16*Oi*ti+16*Ri,on=Xi.dd,rs=Xi.tc;if(rs!=0)if(e(3<=rs),bn.L==1)0<Ri&&nn(hi,zi,ti,rs+4),Xi.La&&va(hi,zi,ti,rs),0<ki&&tn(hi,zi,ti,rs+4),Xi.La&&zn(hi,zi,ti,rs);else{var an=bn.B,is=bn.qa,Es=bn.ra+8*Oi*an+8*Ri,yi=bn.Ha,bn=bn.Ia+8*Oi*an+8*Ri;Oi=Xi.ld,0<Ri&&(Yl(hi,zi,ti,rs+4,on,Oi),ea(is,Es,yi,bn,an,rs+4,on,Oi)),Xi.La&&(Kn(hi,zi,ti,rs,on,Oi),Ni(is,Es,yi,bn,an,rs,on,Oi)),0<ki&&(ml(hi,zi,ti,rs+4,on,Oi),ks(is,Es,yi,bn,an,rs+4,on,Oi)),Xi.La&&(ln(hi,zi,ti,rs,on,Oi),ls(is,Es,yi,bn,an,rs,on,Oi))}}if(Re.ia&&alert("todo:DitherRow"),Ve.put!=null){if(ii=16*xi,xi=16*(xi+1),Zn?(Ve.y=Re.sa,Ve.O=Re.ta+li,Ve.f=Re.qa,Ve.N=Re.ra+Ki,Ve.ea=Re.Ha,Ve.W=Re.Ia+Ki):(ii-=hr,Ve.y=It,Ve.O=jt,Ve.f=Ht,Ve.N=ft,Ve.ea=Pr,Ve.W=yr),Ir||(xi-=hr),xi>Ve.o&&(xi=Ve.o),Ve.F=null,Ve.J=null,Re.Fa!=null&&0<Re.Fa.length&&ii<xi&&(Ve.J=ga(Re,Ve,ii,xi-ii),Ve.F=Re.mb,Ve.F==null&&Ve.F.length==0)){At=Zr(Re,3,"Could not decode alpha data.");break e}ii<Ve.j&&(hr=Ve.j-ii,ii=Ve.j,e(!(1&hr)),Ve.O+=Re.R*hr,Ve.N+=Re.B*(hr>>1),Ve.W+=Re.B*(hr>>1),Ve.F!=null&&(Ve.J+=Ve.width*hr)),ii<xi&&(Ve.O+=Ve.v,Ve.N+=Ve.v>>1,Ve.W+=Ve.v>>1,Ve.F!=null&&(Ve.J+=Ve.v),Ve.ka=ii-Ve.j,Ve.U=Ve.va-Ve.v,Ve.T=xi-ii,At=Ve.put(Ve))}Oe+1!=Re.Ic||Ir||(i(Re.sa,Re.ta-dt,It,jt+16*Re.R,dt),i(Re.qa,Re.ra-Nt,Ht,ft+8*Re.B,Nt),i(Re.Ha,Re.Ia-Nt,Pr,yr+8*Re.B,Nt))}if(!At)return Zr(Se,6,"Output aborted.")}return 1}(_,E)),E.bc!=null&&E.bc(E),F&=1}return F?(_.cb=0,F):0}function ji(_,E,F,V,q){q=_[E+F+32*V]+(q>>3),_[E+F+32*V]=-256&q?0>q?0:255:q}function Tn(_,E,F,V,q,K){ji(_,E,0,F,V+q),ji(_,E,1,F,V+K),ji(_,E,2,F,V-K),ji(_,E,3,F,V-q)}function Cn(_){return(20091*_>>16)+_}function mo(_,E,F,V){var q,K=0,te=o(16);for(q=0;4>q;++q){var se=_[E+0]+_[E+8],oe=_[E+0]-_[E+8],le=(35468*_[E+4]>>16)-Cn(_[E+12]),_e=Cn(_[E+4])+(35468*_[E+12]>>16);te[K+0]=se+_e,te[K+1]=oe+le,te[K+2]=oe-le,te[K+3]=se-_e,K+=4,E++}for(q=K=0;4>q;++q)se=(_=te[K+0]+4)+te[K+8],oe=_-te[K+8],le=(35468*te[K+4]>>16)-Cn(te[K+12]),ji(F,V,0,0,se+(_e=Cn(te[K+4])+(35468*te[K+12]>>16))),ji(F,V,1,0,oe+le),ji(F,V,2,0,oe-le),ji(F,V,3,0,se-_e),K++,V+=32}function Mi(_,E,F,V){var q=_[E+0]+4,K=35468*_[E+4]>>16,te=Cn(_[E+4]),se=35468*_[E+1]>>16;Tn(F,V,0,q+te,_=Cn(_[E+1]),se),Tn(F,V,1,q+K,_,se),Tn(F,V,2,q-K,_,se),Tn(F,V,3,q-te,_,se)}function Za(_,E,F,V,q){mo(_,E,F,V),q&&mo(_,E+16,F,V+4)}function Ys(_,E,F,V){to(_,E+0,F,V,1),to(_,E+32,F,V+128,1)}function Ja(_,E,F,V){var q;for(_=_[E+0]+4,q=0;4>q;++q)for(E=0;4>E;++E)ji(F,V,E,q,_)}function He(_,E,F,V){_[E+0]&&Ao(_,E+0,F,V),_[E+16]&&Ao(_,E+16,F,V+4),_[E+32]&&Ao(_,E+32,F,V+128),_[E+48]&&Ao(_,E+48,F,V+128+4)}function Je(_,E,F,V){var q,K=o(16);for(q=0;4>q;++q){var te=_[E+0+q]+_[E+12+q],se=_[E+4+q]+_[E+8+q],oe=_[E+4+q]-_[E+8+q],le=_[E+0+q]-_[E+12+q];K[0+q]=te+se,K[8+q]=te-se,K[4+q]=le+oe,K[12+q]=le-oe}for(q=0;4>q;++q)te=(_=K[0+4*q]+3)+K[3+4*q],se=K[1+4*q]+K[2+4*q],oe=K[1+4*q]-K[2+4*q],le=_-K[3+4*q],F[V+0]=te+se>>3,F[V+16]=le+oe>>3,F[V+32]=te-se>>3,F[V+48]=le-oe>>3,V+=64}function gt(_,E,F){var V,q=E-32,K=ro,te=255-_[q-1];for(V=0;V<F;++V){var se,oe=K,le=te+_[E-1];for(se=0;se<F;++se)_[E+se]=oe[le+_[q+se]];E+=32}}function Ot(_,E){gt(_,E,4)}function fr(_,E){gt(_,E,8)}function qr(_,E){gt(_,E,16)}function Ci(_,E){var F;for(F=0;16>F;++F)i(_,E+32*F,_,E-32,16)}function In(_,E){var F;for(F=16;0<F;--F)n(_,E,_[E-1],16),E+=32}function qn(_,E,F){var V;for(V=0;16>V;++V)n(E,F+32*V,_,16)}function os(_,E){var F,V=16;for(F=0;16>F;++F)V+=_[E-1+32*F]+_[E+F-32];qn(V>>5,_,E)}function _n(_,E){var F,V=8;for(F=0;16>F;++F)V+=_[E-1+32*F];qn(V>>4,_,E)}function fu(_,E){var F,V=8;for(F=0;16>F;++F)V+=_[E+F-32];qn(V>>4,_,E)}function Hl(_,E){qn(128,_,E)}function Ei(_,E,F){return _+2*E+F+2>>2}function Ya(_,E){var F,V=E-32;for(V=new Uint8Array([Ei(_[V-1],_[V+0],_[V+1]),Ei(_[V+0],_[V+1],_[V+2]),Ei(_[V+1],_[V+2],_[V+3]),Ei(_[V+2],_[V+3],_[V+4])]),F=0;4>F;++F)i(_,E+32*F,V,0,V.length)}function Gl(_,E){var F=_[E-1],V=_[E-1+32],q=_[E-1+64],K=_[E-1+96];qt(_,E+0,16843009*Ei(_[E-1-32],F,V)),qt(_,E+32,16843009*Ei(F,V,q)),qt(_,E+64,16843009*Ei(V,q,K)),qt(_,E+96,16843009*Ei(q,K,K))}function as(_,E){var F,V=4;for(F=0;4>F;++F)V+=_[E+F-32]+_[E-1+32*F];for(V>>=3,F=0;4>F;++F)n(_,E+32*F,V,4)}function Lo(_,E){var F=_[E-1+0],V=_[E-1+32],q=_[E-1+64],K=_[E-1-32],te=_[E+0-32],se=_[E+1-32],oe=_[E+2-32],le=_[E+3-32];_[E+0+96]=Ei(V,q,_[E-1+96]),_[E+1+96]=_[E+0+64]=Ei(F,V,q),_[E+2+96]=_[E+1+64]=_[E+0+32]=Ei(K,F,V),_[E+3+96]=_[E+2+64]=_[E+1+32]=_[E+0+0]=Ei(te,K,F),_[E+3+64]=_[E+2+32]=_[E+1+0]=Ei(se,te,K),_[E+3+32]=_[E+2+0]=Ei(oe,se,te),_[E+3+0]=Ei(le,oe,se)}function Ia(_,E){var F=_[E+1-32],V=_[E+2-32],q=_[E+3-32],K=_[E+4-32],te=_[E+5-32],se=_[E+6-32],oe=_[E+7-32];_[E+0+0]=Ei(_[E+0-32],F,V),_[E+1+0]=_[E+0+32]=Ei(F,V,q),_[E+2+0]=_[E+1+32]=_[E+0+64]=Ei(V,q,K),_[E+3+0]=_[E+2+32]=_[E+1+64]=_[E+0+96]=Ei(q,K,te),_[E+3+32]=_[E+2+64]=_[E+1+96]=Ei(K,te,se),_[E+3+64]=_[E+2+96]=Ei(te,se,oe),_[E+3+96]=Ei(se,oe,oe)}function ys(_,E){var F=_[E-1+0],V=_[E-1+32],q=_[E-1+64],K=_[E-1-32],te=_[E+0-32],se=_[E+1-32],oe=_[E+2-32],le=_[E+3-32];_[E+0+0]=_[E+1+64]=K+te+1>>1,_[E+1+0]=_[E+2+64]=te+se+1>>1,_[E+2+0]=_[E+3+64]=se+oe+1>>1,_[E+3+0]=oe+le+1>>1,_[E+0+96]=Ei(q,V,F),_[E+0+64]=Ei(V,F,K),_[E+0+32]=_[E+1+96]=Ei(F,K,te),_[E+1+32]=_[E+2+96]=Ei(K,te,se),_[E+2+32]=_[E+3+96]=Ei(te,se,oe),_[E+3+32]=Ei(se,oe,le)}function La(_,E){var F=_[E+0-32],V=_[E+1-32],q=_[E+2-32],K=_[E+3-32],te=_[E+4-32],se=_[E+5-32],oe=_[E+6-32],le=_[E+7-32];_[E+0+0]=F+V+1>>1,_[E+1+0]=_[E+0+64]=V+q+1>>1,_[E+2+0]=_[E+1+64]=q+K+1>>1,_[E+3+0]=_[E+2+64]=K+te+1>>1,_[E+0+32]=Ei(F,V,q),_[E+1+32]=_[E+0+96]=Ei(V,q,K),_[E+2+32]=_[E+1+96]=Ei(q,K,te),_[E+3+32]=_[E+2+96]=Ei(K,te,se),_[E+3+64]=Ei(te,se,oe),_[E+3+96]=Ei(se,oe,le)}function el(_,E){var F=_[E-1+0],V=_[E-1+32],q=_[E-1+64],K=_[E-1+96];_[E+0+0]=F+V+1>>1,_[E+2+0]=_[E+0+32]=V+q+1>>1,_[E+2+32]=_[E+0+64]=q+K+1>>1,_[E+1+0]=Ei(F,V,q),_[E+3+0]=_[E+1+32]=Ei(V,q,K),_[E+3+32]=_[E+1+64]=Ei(q,K,K),_[E+3+64]=_[E+2+64]=_[E+0+96]=_[E+1+96]=_[E+2+96]=_[E+3+96]=K}function Aa(_,E){var F=_[E-1+0],V=_[E-1+32],q=_[E-1+64],K=_[E-1+96],te=_[E-1-32],se=_[E+0-32],oe=_[E+1-32],le=_[E+2-32];_[E+0+0]=_[E+2+32]=F+te+1>>1,_[E+0+32]=_[E+2+64]=V+F+1>>1,_[E+0+64]=_[E+2+96]=q+V+1>>1,_[E+0+96]=K+q+1>>1,_[E+3+0]=Ei(se,oe,le),_[E+2+0]=Ei(te,se,oe),_[E+1+0]=_[E+3+32]=Ei(F,te,se),_[E+1+32]=_[E+3+64]=Ei(V,F,te),_[E+1+64]=_[E+3+96]=Ei(q,V,F),_[E+1+96]=Ei(K,q,V)}function Vc(_,E){var F;for(F=0;8>F;++F)i(_,E+32*F,_,E-32,8)}function tl(_,E){var F;for(F=0;8>F;++F)n(_,E,_[E-1],8),E+=32}function yo(_,E,F){var V;for(V=0;8>V;++V)n(E,F+32*V,_,8)}function Fi(_,E){var F,V=8;for(F=0;8>F;++F)V+=_[E+F-32]+_[E-1+32*F];yo(V>>4,_,E)}function da(_,E){var F,V=4;for(F=0;8>F;++F)V+=_[E+F-32];yo(V>>3,_,E)}function As(_,E){var F,V=4;for(F=0;8>F;++F)V+=_[E-1+32*F];yo(V>>3,_,E)}function En(_,E){yo(128,_,E)}function ds(_,E,F){var V=_[E-F],q=_[E+0],K=3*(q-V)+Cc[1020+_[E-2*F]-_[E+F]],te=Dr[112+(K+4>>3)];_[E-F]=ro[255+V+Dr[112+(K+3>>3)]],_[E+0]=ro[255+q-te]}function fa(_,E,F,V){var q=_[E+0],K=_[E+F];return io[255+_[E-2*F]-_[E-F]]>V||io[255+K-q]>V}function qi(_,E,F,V){return 4*io[255+_[E-F]-_[E+0]]+io[255+_[E-2*F]-_[E+F]]<=V}function dl(_,E,F,V,q){var K=_[E-3*F],te=_[E-2*F],se=_[E-F],oe=_[E+0],le=_[E+F],_e=_[E+2*F],Ie=_[E+3*F];return 4*io[255+se-oe]+io[255+te-le]>V?0:io[255+_[E-4*F]-K]<=q&&io[255+K-te]<=q&&io[255+te-se]<=q&&io[255+Ie-_e]<=q&&io[255+_e-le]<=q&&io[255+le-oe]<=q}function jl(_,E,F,V){var q=2*V+1;for(V=0;16>V;++V)qi(_,E+V,F,q)&&ds(_,E+V,F)}function Mo(_,E,F,V){var q=2*V+1;for(V=0;16>V;++V)qi(_,E+V*F,1,q)&&ds(_,E+V*F,1)}function Zo(_,E,F,V){var q;for(q=3;0<q;--q)jl(_,E+=4*F,F,V)}function bc(_,E,F,V){var q;for(q=3;0<q;--q)Mo(_,E+=4,F,V)}function Jo(_,E,F,V,q,K,te,se){for(K=2*K+1;0<q--;){if(dl(_,E,F,K,te))if(fa(_,E,F,se))ds(_,E,F);else{var oe=_,le=E,_e=F,Ie=oe[le-2*_e],ve=oe[le-_e],Se=oe[le+0],et=oe[le+_e],Oe=oe[le+2*_e],Re=27*(At=Cc[1020+3*(Se-ve)+Cc[1020+Ie-et]])+63>>7,Ve=18*At+63>>7,At=9*At+63>>7;oe[le-3*_e]=ro[255+oe[le-3*_e]+At],oe[le-2*_e]=ro[255+Ie+Ve],oe[le-_e]=ro[255+ve+Re],oe[le+0]=ro[255+Se-Re],oe[le+_e]=ro[255+et-Ve],oe[le+2*_e]=ro[255+Oe-At]}E+=V}}function _o(_,E,F,V,q,K,te,se){for(K=2*K+1;0<q--;){if(dl(_,E,F,K,te))if(fa(_,E,F,se))ds(_,E,F);else{var oe=_,le=E,_e=F,Ie=oe[le-_e],ve=oe[le+0],Se=oe[le+_e],et=Dr[112+((Oe=3*(ve-Ie))+4>>3)],Oe=Dr[112+(Oe+3>>3)],Re=et+1>>1;oe[le-2*_e]=ro[255+oe[le-2*_e]+Re],oe[le-_e]=ro[255+Ie+Oe],oe[le+0]=ro[255+ve-et],oe[le+_e]=ro[255+Se-Re]}E+=V}}function xc(_,E,F,V,q,K){Jo(_,E,F,1,16,V,q,K)}function Yo(_,E,F,V,q,K){Jo(_,E,1,F,16,V,q,K)}function ql(_,E,F,V,q,K){var te;for(te=3;0<te;--te)_o(_,E+=4*F,F,1,16,V,q,K)}function Hc(_,E,F,V,q,K){var te;for(te=3;0<te;--te)_o(_,E+=4,1,F,16,V,q,K)}function Eh(_,E,F,V,q,K,te,se){Jo(_,E,q,1,8,K,te,se),Jo(F,V,q,1,8,K,te,se)}function pu(_,E,F,V,q,K,te,se){Jo(_,E,1,q,8,K,te,se),Jo(F,V,1,q,8,K,te,se)}function gu(_,E,F,V,q,K,te,se){_o(_,E+4*q,q,1,8,K,te,se),_o(F,V+4*q,q,1,8,K,te,se)}function Vu(_,E,F,V,q,K,te,se){_o(_,E+4,1,q,8,K,te,se),_o(F,V+4,1,q,8,K,te,se)}function $l(){this.ba=new Zi,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Be,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function rl(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function il(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Kl(){this.ua=0,this.Wa=new lt,this.vb=new lt,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Xe,this.yc=new De}function nl(){this.xb=this.a=0,this.l=new Xa,this.ca=new Zi,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Le,this.Pb=0,this.wd=new Le,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Kl,this.ab=0,this.gc=a(4,il),this.Oc=0}function pa(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Xa,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function fl(_,E,F,V,q,K,te){for(_=_==null?0:_[E+0],E=0;E<te;++E)q[K+E]=_+F[V+E]&255,_=q[K+E]}function Wl(_,E,F,V,q,K,te){var se;if(_==null)fl(null,null,F,V,q,K,te);else for(se=0;se<te;++se)q[K+se]=_[E+se]+F[V+se]&255}function uo(_,E,F,V,q,K,te){if(_==null)fl(null,null,F,V,q,K,te);else{var se,oe=_[E+0],le=oe,_e=oe;for(se=0;se<te;++se)le=_e+(oe=_[E+se])-le,_e=F[V+se]+(-256&le?0>le?0:255:le)&255,le=oe,q[K+se]=_e}}function ga(_,E,F,V){var q=E.width,K=E.o;if(e(_!=null&&E!=null),0>F||0>=V||F+V>K)return null;if(!_.Cc){if(_.ga==null){var te;if(_.ga=new pa,(te=_.ga==null)||(te=E.width*E.o,e(_.Gb.length==0),_.Gb=o(te),_.Uc=0,_.Gb==null?te=0:(_.mb=_.Gb,_.nb=_.Uc,_.rc=null,te=1),te=!te),!te){te=_.ga;var se=_.Fa,oe=_.P,le=_.qc,_e=_.mb,Ie=_.nb,ve=oe+1,Se=le-1,et=te.l;if(e(se!=null&&_e!=null&&E!=null),Ws[0]=null,Ws[1]=fl,Ws[2]=Wl,Ws[3]=uo,te.ca=_e,te.tb=Ie,te.c=E.width,te.i=E.height,e(0<te.c&&0<te.i),1>=le)E=0;else if(te.$a=se[oe+0]>>0&3,te.Z=se[oe+0]>>2&3,te.Lc=se[oe+0]>>4&3,oe=se[oe+0]>>6&3,0>te.$a||1<te.$a||4<=te.Z||1<te.Lc||oe)E=0;else if(et.put=xe,et.ac=ge,et.bc=Ee,et.ma=te,et.width=E.width,et.height=E.height,et.Da=E.Da,et.v=E.v,et.va=E.va,et.j=E.j,et.o=E.o,te.$a)e:{e(te.$a==1),E=Er();t:for(;;){if(E==null){E=0;break e}if(e(te!=null),te.mc=E,E.c=te.c,E.i=te.i,E.l=te.l,E.l.ma=te,E.l.width=te.c,E.l.height=te.i,E.a=0,bt(E.m,se,ve,Se),!zr(te.c,te.i,1,E,null)||(E.ab==1&&E.gc[0].hc==3&&rr(E.s)?(te.ic=1,se=E.c*E.i,E.Ta=null,E.Ua=0,E.V=o(se),E.Ba=0,E.V==null?(E.a=1,E=0):E=1):(te.ic=0,E=ot(E,te.c)),!E))break t;E=1;break e}te.mc=null,E=0}else E=Se>=te.c*te.i;te=!E}if(te)return null;_.ga.Lc!=1?_.Ga=0:V=K-F}e(_.ga!=null),e(F+V<=K);e:{if(E=(se=_.ga).c,K=se.l.o,se.$a==0){if(ve=_.rc,Se=_.Vc,et=_.Fa,oe=_.P+1+F*E,le=_.mb,_e=_.nb+F*E,e(oe<=_.P+_.qc),se.Z!=0)for(e(Ws[se.Z]!=null),te=0;te<V;++te)Ws[se.Z](ve,Se,et,oe,le,_e,E),ve=le,Se=_e,_e+=E,oe+=E;else for(te=0;te<V;++te)i(le,_e,et,oe,E),ve=le,Se=_e,_e+=E,oe+=E;_.rc=ve,_.Vc=Se}else{if(e(se.mc!=null),E=F+V,e((te=se.mc)!=null),e(E<=te.i),te.C>=E)E=1;else if(se.ic||xt(),se.ic){se=te.V,ve=te.Ba,Se=te.c;var Oe=te.i,Re=(et=1,oe=te.$/Se,le=te.$%Se,_e=te.m,Ie=te.s,te.$),Ve=Se*Oe,At=Se*E,dt=Ie.wc,ft=Re<At?vt(Ie,le,oe):null;e(Re<=Ve),e(E<=Oe),e(rr(Ie));t:for(;;){for(;!_e.h&&Re<At;){if(le&dt||(ft=vt(Ie,le,oe)),e(ft!=null),mt(_e),256>(Oe=Ge(ft.G[0],ft.H[0],_e)))se[ve+Re]=Oe,++Re,++le>=Se&&(le=0,++oe<=E&&!(oe%16)&&dr(te,oe));else{if(!(280>Oe)){et=0;break t}Oe=Fe(Oe-256,_e);var Nt,It=Ge(ft.G[4],ft.H[4],_e);if(mt(_e),!(Re>=(It=ze(Se,It=Fe(It,_e)))&&Ve-Re>=Oe)){et=0;break t}for(Nt=0;Nt<Oe;++Nt)se[ve+Re+Nt]=se[ve+Re+Nt-It];for(Re+=Oe,le+=Oe;le>=Se;)le-=Se,++oe<=E&&!(oe%16)&&dr(te,oe);Re<At&&le&dt&&(ft=vt(Ie,le,oe))}e(_e.h==rt(_e))}dr(te,oe>E?E:oe);break t}!et||_e.h&&Re<Ve?(et=0,te.a=_e.h?5:3):te.$=Re,E=et}else E=Cr(te,te.V,te.Ba,te.c,te.i,E,ir);if(!E){V=0;break e}}F+V>=K&&(_.Cc=1),V=1}if(!V)return null;if(_.Cc&&((V=_.ga)!=null&&(V.mc=null),_.ga=null,0<_.Ga))return alert("todo:WebPDequantizeLevels"),null}return _.nb+F*q}function ne(_,E,F,V,q,K){for(;0<q--;){var te,se=_,oe=E+(F?1:0),le=_,_e=E+(F?0:3);for(te=0;te<V;++te){var Ie=le[_e+4*te];Ie!=255&&(Ie*=32897,se[oe+4*te+0]=se[oe+4*te+0]*Ie>>23,se[oe+4*te+1]=se[oe+4*te+1]*Ie>>23,se[oe+4*te+2]=se[oe+4*te+2]*Ie>>23)}E+=K}}function Pe(_,E,F,V,q){for(;0<V--;){var K;for(K=0;K<F;++K){var te=_[E+2*K+0],se=15&(le=_[E+2*K+1]),oe=4369*se,le=(240&le|le>>4)*oe>>16;_[E+2*K+0]=(240&te|te>>4)*oe>>16&240|(15&te|te<<4)*oe>>16>>4&15,_[E+2*K+1]=240&le|se}E+=q}}function ct(_,E,F,V,q,K,te,se){var oe,le,_e=255;for(le=0;le<q;++le){for(oe=0;oe<V;++oe){var Ie=_[E+oe];K[te+4*oe]=Ie,_e&=Ie}E+=F,te+=se}return _e!=255}function _t(_,E,F,V,q){var K;for(K=0;K<q;++K)F[V+K]=_[E+K]>>8}function xt(){ka=ne,ta=Pe,ra=ct,Nr=_t}function Lt(_,E,F){Ne[_]=function(V,q,K,te,se,oe,le,_e,Ie,ve,Se,et,Oe,Re,Ve,At,dt){var ft,Nt=dt-1>>1,It=se[oe+0]|le[_e+0]<<16,jt=Ie[ve+0]|Se[et+0]<<16;e(V!=null);var Ht=3*It+jt+131074>>2;for(E(V[q+0],255&Ht,Ht>>16,Oe,Re),K!=null&&(Ht=3*jt+It+131074>>2,E(K[te+0],255&Ht,Ht>>16,Ve,At)),ft=1;ft<=Nt;++ft){var Pr=se[oe+ft]|le[_e+ft]<<16,yr=Ie[ve+ft]|Se[et+ft]<<16,Ir=It+Pr+jt+yr+524296,hr=Ir+2*(Pr+jt)>>3;Ht=hr+It>>1,It=(Ir=Ir+2*(It+yr)>>3)+Pr>>1,E(V[q+2*ft-1],255&Ht,Ht>>16,Oe,Re+(2*ft-1)*F),E(V[q+2*ft-0],255&It,It>>16,Oe,Re+(2*ft-0)*F),K!=null&&(Ht=Ir+jt>>1,It=hr+yr>>1,E(K[te+2*ft-1],255&Ht,Ht>>16,Ve,At+(2*ft-1)*F),E(K[te+2*ft+0],255&It,It>>16,Ve,At+(2*ft+0)*F)),It=Pr,jt=yr}1&dt||(Ht=3*It+jt+131074>>2,E(V[q+dt-1],255&Ht,Ht>>16,Oe,Re+(dt-1)*F),K!=null&&(Ht=3*jt+It+131074>>2,E(K[te+dt-1],255&Ht,Ht>>16,Ve,At+(dt-1)*F)))}}function gr(){Yi[Gc]=Fn,Yi[ec]=nc,Yi[mu]=ic,Yi[jc]=Uo,Yi[tc]=Oa,Yi[qc]=sc,Yi[ol]=Xc,Yi[vn]=nc,Yi[Os]=Uo,Yi[Ro]=Oa,Yi[vl]=sc}function sr(_){return _&~A?0>_?0:255:_>>N}function si(_,E){return sr((19077*_>>8)+(26149*E>>8)-14234)}function $r(_,E,F){return sr((19077*_>>8)-(6419*E>>8)-(13320*F>>8)+8708)}function ei(_,E){return sr((19077*_>>8)+(33050*E>>8)-17685)}function ui(_,E,F,V,q){V[q+0]=si(_,F),V[q+1]=$r(_,E,F),V[q+2]=ei(_,E)}function $n(_,E,F,V,q){V[q+0]=ei(_,E),V[q+1]=$r(_,E,F),V[q+2]=si(_,F)}function ai(_,E,F,V,q){var K=$r(_,E,F);E=K<<3&224|ei(_,E)>>3,V[q+0]=248&si(_,F)|K>>5,V[q+1]=E}function Pn(_,E,F,V,q){var K=240&ei(_,E)|15;V[q+0]=240&si(_,F)|$r(_,E,F)>>4,V[q+1]=K}function Di(_,E,F,V,q){V[q+0]=255,ui(_,E,F,V,q+1)}function Li(_,E,F,V,q){$n(_,E,F,V,q),V[q+3]=255}function Ds(_,E,F,V,q){ui(_,E,F,V,q),V[q+3]=255}function eo(_,E){return 0>_?0:_>E?E:_}function Po(_,E,F){Ne[_]=function(V,q,K,te,se,oe,le,_e,Ie){for(var ve=_e+(-2&Ie)*F;_e!=ve;)E(V[q+0],K[te+0],se[oe+0],le,_e),E(V[q+1],K[te+0],se[oe+0],le,_e+F),q+=2,++te,++oe,_e+=2*F;1&Ie&&E(V[q+0],K[te+0],se[oe+0],le,_e)}}function Ma(_,E,F){return F==0?_==0?E==0?6:5:E==0?4:0:F}function ma(_,E,F,V,q){switch(_>>>30){case 3:to(E,F,V,q,0);break;case 2:$s(E,F,V,q);break;case 1:Ao(E,F,V,q)}}function wc(_,E){var F,V,q=E.M,K=E.Nb,te=_.oc,se=_.pc+40,oe=_.oc,le=_.pc+584,_e=_.oc,Ie=_.pc+600;for(F=0;16>F;++F)te[se+32*F-1]=129;for(F=0;8>F;++F)oe[le+32*F-1]=129,_e[Ie+32*F-1]=129;for(0<q?te[se-1-32]=oe[le-1-32]=_e[Ie-1-32]=129:(n(te,se-32-1,127,21),n(oe,le-32-1,127,9),n(_e,Ie-32-1,127,9)),V=0;V<_.za;++V){var ve=E.ya[E.aa+V];if(0<V){for(F=-1;16>F;++F)i(te,se+32*F-4,te,se+32*F+12,4);for(F=-1;8>F;++F)i(oe,le+32*F-4,oe,le+32*F+4,4),i(_e,Ie+32*F-4,_e,Ie+32*F+4,4)}var Se=_.Gd,et=_.Hd+V,Oe=ve.ad,Re=ve.Hc;if(0<q&&(i(te,se-32,Se[et].y,0,16),i(oe,le-32,Se[et].f,0,8),i(_e,Ie-32,Se[et].ea,0,8)),ve.Za){var Ve=te,At=se-32+16;for(0<q&&(V>=_.za-1?n(Ve,At,Se[et].y[15],4):i(Ve,At,Se[et+1].y,0,4)),F=0;4>F;F++)Ve[At+128+F]=Ve[At+256+F]=Ve[At+384+F]=Ve[At+0+F];for(F=0;16>F;++F,Re<<=2)Ve=te,At=se+p[F],sn[ve.Ob[F]](Ve,At),ma(Re,Oe,16*+F,Ve,At)}else if(Ve=Ma(V,q,ve.Ob[0]),ko[Ve](te,se),Re!=0)for(F=0;16>F;++F,Re<<=2)ma(Re,Oe,16*+F,te,se+p[F]);for(F=ve.Gc,Ve=Ma(V,q,ve.Dd),Ks[Ve](oe,le),Ks[Ve](_e,Ie),Re=Oe,Ve=oe,At=le,255&(ve=F>>0)&&(170&ve?bs(Re,256,Ve,At):Ra(Re,256,Ve,At)),ve=_e,Re=Ie,255&(F>>=8)&&(170&F?bs(Oe,320,ve,Re):Ra(Oe,320,ve,Re)),q<_.Ub-1&&(i(Se[et].y,0,te,se+480,16),i(Se[et].f,0,oe,le+224,8),i(Se[et].ea,0,_e,Ie+224,8)),F=8*K*_.B,Se=_.sa,et=_.ta+16*V+16*K*_.R,Oe=_.qa,ve=_.ra+8*V+F,Re=_.Ha,Ve=_.Ia+8*V+F,F=0;16>F;++F)i(Se,et+F*_.R,te,se+32*F,16);for(F=0;8>F;++F)i(Oe,ve+F*_.B,oe,le+32*F,8),i(Re,Ve+F*_.B,_e,Ie+32*F,8)}}function pl(_,E,F,V,q,K,te,se,oe){var le=[0],_e=[0],Ie=0,ve=oe!=null?oe.kd:0,Se=oe??new rl;if(_==null||12>F)return 7;Se.data=_,Se.w=E,Se.ha=F,E=[E],F=[F],Se.gb=[Se.gb];e:{var et=E,Oe=F,Re=Se.gb;if(e(_!=null),e(Oe!=null),e(Re!=null),Re[0]=0,12<=Oe[0]&&!t(_,et[0],"RIFF")){if(t(_,et[0]+8,"WEBP")){Re=3;break e}var Ve=br(_,et[0]+4);if(12>Ve||4294967286<Ve){Re=3;break e}if(ve&&Ve>Oe[0]-8){Re=7;break e}Re[0]=Ve,et[0]+=12,Oe[0]-=12}Re=0}if(Re!=0)return Re;for(Ve=0<Se.gb[0],F=F[0];;){e:{var At=_;Oe=E,Re=F;var dt=le,ft=_e,Nt=et=[0];if((Ht=Ie=[Ie])[0]=0,8>Re[0])Re=7;else{if(!t(At,Oe[0],"VP8X")){if(br(At,Oe[0]+4)!=10){Re=3;break e}if(18>Re[0]){Re=7;break e}var It=br(At,Oe[0]+8),jt=1+vr(At,Oe[0]+12);if(2147483648<=jt*(At=1+vr(At,Oe[0]+15))){Re=3;break e}Nt!=null&&(Nt[0]=It),dt!=null&&(dt[0]=jt),ft!=null&&(ft[0]=At),Oe[0]+=18,Re[0]-=18,Ht[0]=1}Re=0}}if(Ie=Ie[0],et=et[0],Re!=0)return Re;if(Oe=!!(2&et),!Ve&&Ie)return 3;if(K!=null&&(K[0]=!!(16&et)),te!=null&&(te[0]=Oe),se!=null&&(se[0]=0),te=le[0],et=_e[0],Ie&&Oe&&oe==null){Re=0;break}if(4>F){Re=7;break}if(Ve&&Ie||!Ve&&!Ie&&!t(_,E[0],"ALPH")){F=[F],Se.na=[Se.na],Se.P=[Se.P],Se.Sa=[Se.Sa];e:{It=_,Re=E,Ve=F;var Ht=Se.gb;dt=Se.na,ft=Se.P,Nt=Se.Sa,jt=22,e(It!=null),e(Ve!=null),At=Re[0];var Pr=Ve[0];for(e(dt!=null),e(Nt!=null),dt[0]=null,ft[0]=null,Nt[0]=0;;){if(Re[0]=At,Ve[0]=Pr,8>Pr){Re=7;break e}var yr=br(It,At+4);if(4294967286<yr){Re=3;break e}var Ir=8+yr+1&-2;if(jt+=Ir,0<Ht&&jt>Ht){Re=3;break e}if(!t(It,At,"VP8 ")||!t(It,At,"VP8L")){Re=0;break e}if(Pr[0]<Ir){Re=7;break e}t(It,At,"ALPH")||(dt[0]=It,ft[0]=At+8,Nt[0]=yr),At+=Ir,Pr-=Ir}}if(F=F[0],Se.na=Se.na[0],Se.P=Se.P[0],Se.Sa=Se.Sa[0],Re!=0)break}F=[F],Se.Ja=[Se.Ja],Se.xa=[Se.xa];e:if(Ht=_,Re=E,Ve=F,dt=Se.gb[0],ft=Se.Ja,Nt=Se.xa,It=Re[0],At=!t(Ht,It,"VP8 "),jt=!t(Ht,It,"VP8L"),e(Ht!=null),e(Ve!=null),e(ft!=null),e(Nt!=null),8>Ve[0])Re=7;else{if(At||jt){if(Ht=br(Ht,It+4),12<=dt&&Ht>dt-12){Re=3;break e}if(ve&&Ht>Ve[0]-8){Re=7;break e}ft[0]=Ht,Re[0]+=8,Ve[0]-=8,Nt[0]=jt}else Nt[0]=5<=Ve[0]&&Ht[It+0]==47&&!(Ht[It+4]>>5),ft[0]=Ve[0];Re=0}if(F=F[0],Se.Ja=Se.Ja[0],Se.xa=Se.xa[0],E=E[0],Re!=0)break;if(4294967286<Se.Ja)return 3;if(se==null||Oe||(se[0]=Se.xa?2:1),te=[te],et=[et],Se.xa){if(5>F){Re=7;break}se=te,ve=et,Oe=K,_==null||5>F?_=0:5<=F&&_[E+0]==47&&!(_[E+4]>>5)?(Ve=[0],Ht=[0],dt=[0],bt(ft=new Le,_,E,F),we(ft,Ve,Ht,dt)?(se!=null&&(se[0]=Ve[0]),ve!=null&&(ve[0]=Ht[0]),Oe!=null&&(Oe[0]=dt[0]),_=1):_=0):_=0}else{if(10>F){Re=7;break}se=et,_==null||10>F||!co(_,E+3,F-3)?_=0:(ve=_[E+0]|_[E+1]<<8|_[E+2]<<16,Oe=16383&(_[E+7]<<8|_[E+6]),_=16383&(_[E+9]<<8|_[E+8]),1&ve||3<(ve>>1&7)||!(ve>>4&1)||ve>>5>=Se.Ja||!Oe||!_?_=0:(te&&(te[0]=Oe),se&&(se[0]=_),_=1))}if(!_||(te=te[0],et=et[0],Ie&&(le[0]!=te||_e[0]!=et)))return 3;oe!=null&&(oe[0]=Se,oe.offset=E-oe.w,e(4294967286>E-oe.w),e(oe.offset==oe.ha-F));break}return Re==0||Re==7&&Ie&&oe==null?(K!=null&&(K[0]|=Se.na!=null&&0<Se.na.length),V!=null&&(V[0]=te),q!=null&&(q[0]=et),0):Re}function Xl(_,E,F){var V=E.width,q=E.height,K=0,te=0,se=V,oe=q;if(E.Da=_!=null&&0<_.Da,E.Da&&(se=_.cd,oe=_.bd,K=_.v,te=_.j,11>F||(K&=-2,te&=-2),0>K||0>te||0>=se||0>=oe||K+se>V||te+oe>q))return 0;if(E.v=K,E.j=te,E.va=K+se,E.o=te+oe,E.U=se,E.T=oe,E.da=_!=null&&0<_.da,E.da){if(!wt(se,oe,F=[_.ib],K=[_.hb]))return 0;E.ib=F[0],E.hb=K[0]}return E.ob=_!=null&&_.ob,E.Kb=_==null||!_.Sd,E.da&&(E.ob=E.ib<3*V/4&&E.hb<3*q/4,E.Kb=0),1}function Bc(_){if(_==null)return 2;if(11>_.S){var E=_.f.RGBA;E.fb+=(_.height-1)*E.A,E.A=-E.A}else E=_.f.kb,_=_.height,E.O+=(_-1)*E.fa,E.fa=-E.fa,E.N+=(_-1>>1)*E.Ab,E.Ab=-E.Ab,E.W+=(_-1>>1)*E.Db,E.Db=-E.Db,E.F!=null&&(E.J+=(_-1)*E.lb,E.lb=-E.lb);return 0}function Pa(_,E,F,V){if(V==null||0>=_||0>=E)return 2;if(F!=null){if(F.Da){var q=F.cd,K=F.bd,te=-2&F.v,se=-2&F.j;if(0>te||0>se||0>=q||0>=K||te+q>_||se+K>E)return 2;_=q,E=K}if(F.da){if(!wt(_,E,q=[F.ib],K=[F.hb]))return 2;_=q[0],E=K[0]}}V.width=_,V.height=E;e:{var oe=V.width,le=V.height;if(_=V.S,0>=oe||0>=le||!(_>=Gc&&13>_))_=2;else{if(0>=V.Rd&&V.sd==null){te=K=q=E=0;var _e=(se=oe*j[_])*le;if(11>_||(K=(le+1)/2*(E=(oe+1)/2),_==12&&(te=(q=oe)*le)),(le=o(_e+2*K+te))==null){_=1;break e}V.sd=le,11>_?((oe=V.f.RGBA).eb=le,oe.fb=0,oe.A=se,oe.size=_e):((oe=V.f.kb).y=le,oe.O=0,oe.fa=se,oe.Fd=_e,oe.f=le,oe.N=0+_e,oe.Ab=E,oe.Cd=K,oe.ea=le,oe.W=0+_e+K,oe.Db=E,oe.Ed=K,_==12&&(oe.F=le,oe.J=0+_e+2*K),oe.Tc=te,oe.lb=q)}if(E=1,q=V.S,K=V.width,te=V.height,q>=Gc&&13>q)if(11>q)_=V.f.RGBA,E&=(se=Math.abs(_.A))*(te-1)+K<=_.size,E&=se>=K*j[q],E&=_.eb!=null;else{_=V.f.kb,se=(K+1)/2,_e=(te+1)/2,oe=Math.abs(_.fa),le=Math.abs(_.Ab);var Ie=Math.abs(_.Db),ve=Math.abs(_.lb),Se=ve*(te-1)+K;E&=oe*(te-1)+K<=_.Fd,E&=le*(_e-1)+se<=_.Cd,E=(E&=Ie*(_e-1)+se<=_.Ed)&oe>=K&le>=se&Ie>=se,E&=_.y!=null,E&=_.f!=null,E&=_.ea!=null,q==12&&(E&=ve>=K,E&=Se<=_.Tc,E&=_.F!=null)}else E=0;_=E?0:2}}return _!=0||F!=null&&F.fd&&(_=Bc(V)),_}var _s=64,gl=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Zl=24,Fa=32,Da=8,Rs=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];ht("Predictor0","PredictorAdd0"),Ne.Predictor0=function(){return 4278190080},Ne.Predictor1=function(_){return _},Ne.Predictor2=function(_,E,F){return E[F+0]},Ne.Predictor3=function(_,E,F){return E[F+1]},Ne.Predictor4=function(_,E,F){return E[F-1]},Ne.Predictor5=function(_,E,F){return or(or(_,E[F+1]),E[F+0])},Ne.Predictor6=function(_,E,F){return or(_,E[F-1])},Ne.Predictor7=function(_,E,F){return or(_,E[F+0])},Ne.Predictor8=function(_,E,F){return or(E[F-1],E[F+0])},Ne.Predictor9=function(_,E,F){return or(E[F+0],E[F+1])},Ne.Predictor10=function(_,E,F){return or(or(_,E[F-1]),or(E[F+0],E[F+1]))},Ne.Predictor11=function(_,E,F){var V=E[F+0];return 0>=Wr(V>>24&255,_>>24&255,(E=E[F-1])>>24&255)+Wr(V>>16&255,_>>16&255,E>>16&255)+Wr(V>>8&255,_>>8&255,E>>8&255)+Wr(255&V,255&_,255&E)?V:_},Ne.Predictor12=function(_,E,F){var V=E[F+0];return(mr((_>>24&255)+(V>>24&255)-((E=E[F-1])>>24&255))<<24|mr((_>>16&255)+(V>>16&255)-(E>>16&255))<<16|mr((_>>8&255)+(V>>8&255)-(E>>8&255))<<8|mr((255&_)+(255&V)-(255&E)))>>>0},Ne.Predictor13=function(_,E,F){var V=E[F-1];return(ur((_=or(_,E[F+0]))>>24&255,V>>24&255)<<24|ur(_>>16&255,V>>16&255)<<16|ur(_>>8&255,V>>8&255)<<8|ur(_>>0&255,V>>0&255))>>>0};var Hu=Ne.PredictorAdd0;Ne.PredictorAdd1=ri,ht("Predictor2","PredictorAdd2"),ht("Predictor3","PredictorAdd3"),ht("Predictor4","PredictorAdd4"),ht("Predictor5","PredictorAdd5"),ht("Predictor6","PredictorAdd6"),ht("Predictor7","PredictorAdd7"),ht("Predictor8","PredictorAdd8"),ht("Predictor9","PredictorAdd9"),ht("Predictor10","PredictorAdd10"),ht("Predictor11","PredictorAdd11"),ht("Predictor12","PredictorAdd12"),ht("Predictor13","PredictorAdd13");var Ln=Ne.PredictorAdd2;Xr("ColorIndexInverseTransform","MapARGB","32b",function(_){return _>>8&255},function(_){return _}),Xr("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(_){return _},function(_){return _>>8&255});var fn,pn=Ne.ColorIndexInverseTransform,fs=Ne.MapARGB,ya=Ne.VP8LColorIndexInverseTransformAlpha,Jl=Ne.MapAlpha,ho=Ne.VP8LPredictorsAdd=[];ho.length=16,(Ne.VP8LPredictors=[]).length=16,(Ne.VP8LPredictorsAdd_C=[]).length=16,(Ne.VP8LPredictors_C=[]).length=16;var vs,ps,Fo,vo,_a,sl,Do,to,$s,bs,Ao,Ra,ml,Yl,ks,ea,ln,Kn,ls,Ni,tn,nn,zn,va,ka,ta,ra,Nr,ba=o(511),Rr=o(2041),yl=o(225),_l=o(767),Mr=0,Cc=Rr,Dr=yl,ro=_l,io=ba,Gc=0,ec=1,mu=2,jc=3,tc=4,qc=5,ol=6,vn=7,Os=8,Ro=9,vl=10,yu=[2,3,7],$c=[3,3,11],Gu=[280,256,256,256,40],xa=[0,1,1,1,0],no=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],Sr=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],oi=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],bl=8,Kc=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],rc=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],Us=null,uA=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Wn=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],Wc=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Kr=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Qr=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Xn=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],ju=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],ko=[],sn=[],Ks=[],Oo=1,_u=2,Ws=[],Yi=[];Lt("UpsampleRgbLinePair",ui,3),Lt("UpsampleBgrLinePair",$n,3),Lt("UpsampleRgbaLinePair",Ds,4),Lt("UpsampleBgraLinePair",Li,4),Lt("UpsampleArgbLinePair",Di,4),Lt("UpsampleRgba4444LinePair",Pn,2),Lt("UpsampleRgb565LinePair",ai,2);var Fn=Ne.UpsampleRgbLinePair,ic=Ne.UpsampleBgrLinePair,nc=Ne.UpsampleRgbaLinePair,Uo=Ne.UpsampleBgraLinePair,Oa=Ne.UpsampleArgbLinePair,sc=Ne.UpsampleRgba4444LinePair,Xc=Ne.UpsampleRgb565LinePair,No=16,oc=1<<No-1,wa=-227,Qi=482,N=6,A=(256<<N)-1,b=0,M=o(256),O=o(256),z=o(256),J=o(256),w=o(Qi-wa),l=o(Qi-wa);Po("YuvToRgbRow",ui,3),Po("YuvToBgrRow",$n,3),Po("YuvToRgbaRow",Ds,4),Po("YuvToBgraRow",Li,4),Po("YuvToArgbRow",Di,4),Po("YuvToRgba4444Row",Pn,2),Po("YuvToRgb565Row",ai,2);var p=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],x=[0,2,8],B=[8,7,6,4,4,2,2,2,1,1,1,1],L=1;this.WebPDecodeRGBA=function(_,E,F,V,q){var K=ec,te=new $l,se=new Zi;te.ba=se,se.S=K,se.width=[se.width],se.height=[se.height];var oe=se.width,le=se.height,_e=new Qe;if(_e==null||_==null)var Ie=2;else e(_e!=null),Ie=pl(_,E,F,_e.width,_e.height,_e.Pd,_e.Qd,_e.format,null);if(Ie!=0?oe=0:(oe!=null&&(oe[0]=_e.width[0]),le!=null&&(le[0]=_e.height[0]),oe=1),oe){se.width=se.width[0],se.height=se.height[0],V!=null&&(V[0]=se.width),q!=null&&(q[0]=se.height);e:{if(V=new Xa,(q=new rl).data=_,q.w=E,q.ha=F,q.kd=1,E=[0],e(q!=null),((_=pl(q.data,q.w,q.ha,null,null,null,E,null,q))==0||_==7)&&E[0]&&(_=4),(E=_)==0){if(e(te!=null),V.data=q.data,V.w=q.w+q.offset,V.ha=q.ha-q.offset,V.put=xe,V.ac=ge,V.bc=Ee,V.ma=te,q.xa){if((_=Er())==null){te=1;break e}if(function(ve,Se){var et=[0],Oe=[0],Re=[0];t:for(;;){if(ve==null)return 0;if(Se==null)return ve.a=2,0;if(ve.l=Se,ve.a=0,bt(ve.m,Se.data,Se.w,Se.ha),!we(ve.m,et,Oe,Re)){ve.a=3;break t}if(ve.xb=_u,Se.width=et[0],Se.height=Oe[0],!zr(et[0],Oe[0],1,ve,null))break t;return 1}return e(ve.a!=0),0}(_,V)){if(V=(E=Pa(V.width,V.height,te.Oa,te.ba))==0){t:{V=_;r:for(;;){if(V==null){V=0;break t}if(e(V.s.yc!=null),e(V.s.Ya!=null),e(0<V.s.Wb),e((F=V.l)!=null),e((q=F.ma)!=null),V.xb!=0){if(V.ca=q.ba,V.tb=q.tb,e(V.ca!=null),!Xl(q.Oa,F,jc)){V.a=2;break r}if(!ot(V,F.width)||F.da)break r;if((F.da||xr(V.ca.S))&&xt(),11>V.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),V.ca.f.kb.F!=null&&xt()),V.Pb&&0<V.s.ua&&V.s.vb.X==null&&!Fr(V.s.vb,V.s.Wa.Xa)){V.a=1;break r}V.xb=0}if(!Cr(V,V.V,V.Ba,V.c,V.i,F.o,Kt))break r;q.Dc=V.Ma,V=1;break t}e(V.a!=0),V=0}V=!V}V&&(E=_.a)}else E=_.a}else{if((_=new Nn)==null){te=1;break e}if(_.Fa=q.na,_.P=q.P,_.qc=q.Sa,Fs(_,V)){if((E=Pa(V.width,V.height,te.Oa,te.ba))==0){if(_.Aa=0,F=te.Oa,e((q=_)!=null),F!=null){if(0<(oe=0>(oe=F.Md)?0:100<oe?255:255*oe/100)){for(le=_e=0;4>le;++le)12>(Ie=q.pb[le]).lc&&(Ie.ia=oe*B[0>Ie.lc?0:Ie.lc]>>3),_e|=Ie.ia;_e&&(alert("todo:VP8InitRandom"),q.ia=1)}q.Ga=F.Id,100<q.Ga?q.Ga=100:0>q.Ga&&(q.Ga=0)}ss(_,V)||(E=_.a)}}else E=_.a}E==0&&te.Oa!=null&&te.Oa.fd&&(E=Bc(te.ba))}te=E}K=te!=0?null:11>K?se.f.RGBA.eb:se.f.kb.y}else K=null;return K};var j=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function y(Ne,at){for(var nt="",ke=0;ke<4;ke++)nt+=String.fromCharCode(Ne[at++]);return nt}function T(Ne,at){return(Ne[at+0]<<0|Ne[at+1]<<8|Ne[at+2]<<16)>>>0}function I(Ne,at){return(Ne[at+0]<<0|Ne[at+1]<<8|Ne[at+2]<<16|Ne[at+3]<<24)>>>0}new g;var R=[0],U=[0],Z=[],Y=new g,he=r,ce=function(Ne,at){var nt={},ke=0,De=!1,Ye=0,Xe=0;if(nt.frames=[],!function(Ze,rt,pt,mt){for(var Bt=0;Bt<mt;Bt++)if(Ze[rt+Bt]!=pt.charCodeAt(Bt))return!0;return!1}(Ne,at,"RIFF",4)){var Ct,Et;for(I(Ne,at+=4),at+=8;at<Ne.length;){var Pt=y(Ne,at),bt=I(Ne,at+=4);at+=4;var Rt=bt+(1&bt);switch(Pt){case"VP8 ":case"VP8L":nt.frames[ke]===void 0&&(nt.frames[ke]={}),(Le=nt.frames[ke]).src_off=De?Xe:at-8,Le.src_size=Ye+bt+8,ke++,De&&(De=!1,Ye=0,Xe=0);break;case"VP8X":(Le=nt.header={}).feature_flags=Ne[at];var Ft=at+4;Le.canvas_width=1+T(Ne,Ft),Ft+=3,Le.canvas_height=1+T(Ne,Ft),Ft+=3;break;case"ALPH":De=!0,Ye=Rt+8,Xe=at-8;break;case"ANIM":(Le=nt.header).bgcolor=I(Ne,at),Ft=at+4,Le.loop_count=(Ct=Ne)[(Et=Ft)+0]<<0|Ct[Et+1]<<8,Ft+=2;break;case"ANMF":var Zt,Le;(Le=nt.frames[ke]={}).offset_x=2*T(Ne,at),at+=3,Le.offset_y=2*T(Ne,at),at+=3,Le.width=1+T(Ne,at),at+=3,Le.height=1+T(Ne,at),at+=3,Le.duration=T(Ne,at),at+=3,Zt=Ne[at++],Le.dispose=1&Zt,Le.blend=Zt>>1&1}Pt!="ANMF"&&(at+=Rt)}return nt}}(he,0);ce.response=he,ce.rgbaoutput=!0,ce.dataurl=!1;var pe=ce.header?ce.header:null,be=ce.frames?ce.frames:null;if(pe){pe.loop_counter=pe.loop_count,R=[pe.canvas_height],U=[pe.canvas_width];for(var Te=0;Te<be.length&&be[Te].blend!=0;Te++);}var qe=be[0],je=Y.WebPDecodeRGBA(he,qe.src_off,qe.src_size,U,R);qe.rgba=je,qe.imgwidth=U[0],qe.imgheight=R[0];for(var We=0;We<U[0]*R[0]*4;We++)Z[We]=je[We];return this.width=U,this.height=R,this.data=Z,this}(function(r){var e=function(){return typeof qC=="function"},t=function(R,U,Z,Y){var he=4,ce=a;switch(Y){case r.image_compression.FAST:he=1,ce=o;break;case r.image_compression.MEDIUM:he=6,ce=s;break;case r.image_compression.SLOW:he=9,ce=g}R=i(R,U,Z,ce);var pe=qC(R,{level:he});return r.__addimage__.arrayBufferToBinaryString(pe)},i=function(R,U,Z,Y){for(var he,ce,pe,be=R.length/U,Te=new Uint8Array(R.length+be),qe=T(),je=0;je<be;je+=1){if(pe=je*U,he=R.subarray(pe,pe+U),Y)Te.set(Y(he,Z,ce),pe+je);else{for(var We,Ne=qe.length,at=[];We<Ne;We+=1)at[We]=qe[We](he,Z,ce);var nt=I(at.concat());Te.set(at[nt],pe+je)}ce=he}return Te},n=function(R){var U=Array.apply([],R);return U.unshift(0),U},o=function(R,U){var Z,Y=[],he=R.length;Y[0]=1;for(var ce=0;ce<he;ce+=1)Z=R[ce-U]||0,Y[ce+1]=R[ce]-Z+256&255;return Y},a=function(R,U,Z){var Y,he=[],ce=R.length;he[0]=2;for(var pe=0;pe<ce;pe+=1)Y=Z&&Z[pe]||0,he[pe+1]=R[pe]-Y+256&255;return he},s=function(R,U,Z){var Y,he,ce=[],pe=R.length;ce[0]=3;for(var be=0;be<pe;be+=1)Y=R[be-U]||0,he=Z&&Z[be]||0,ce[be+1]=R[be]+256-(Y+he>>>1)&255;return ce},g=function(R,U,Z){var Y,he,ce,pe,be=[],Te=R.length;be[0]=4;for(var qe=0;qe<Te;qe+=1)Y=R[qe-U]||0,he=Z&&Z[qe]||0,ce=Z&&Z[qe-U]||0,pe=y(Y,he,ce),be[qe+1]=R[qe]-pe+256&255;return be},y=function(R,U,Z){if(R===U&&U===Z)return R;var Y=Math.abs(U-Z),he=Math.abs(R-Z),ce=Math.abs(R+U-Z-Z);return Y<=he&&Y<=ce?R:he<=ce?U:Z},T=function(){return[n,o,a,s,g]},I=function(R){var U=R.map(function(Z){return Z.reduce(function(Y,he){return Y+Math.abs(he)},0)});return U.indexOf(Math.min.apply(null,U))};r.processPNG=function(R,U,Z,Y){var he,ce,pe,be,Te,qe,je,We,Ne,at,nt,ke,De,Ye,Xe,Ct=this.decode.FLATE_DECODE,Et="";if(this.__addimage__.isArrayBuffer(R)&&(R=new Uint8Array(R)),this.__addimage__.isArrayBufferView(R)){if(R=(pe=new Tne(R)).imgData,ce=pe.bits,he=pe.colorSpace,Te=pe.colors,[4,6].indexOf(pe.colorType)!==-1){if(pe.bits===8){Ne=(We=pe.pixelBitlength==32?new Uint32Array(pe.decodePixels().buffer):pe.pixelBitlength==16?new Uint16Array(pe.decodePixels().buffer):new Uint8Array(pe.decodePixels().buffer)).length,nt=new Uint8Array(Ne*pe.colors),at=new Uint8Array(Ne);var Pt,bt=pe.pixelBitlength-pe.bits;for(Ye=0,Xe=0;Ye<Ne;Ye++){for(De=We[Ye],Pt=0;Pt<bt;)nt[Xe++]=De>>>Pt&255,Pt+=pe.bits;at[Ye]=De>>>Pt&255}}if(pe.bits===16){Ne=(We=new Uint32Array(pe.decodePixels().buffer)).length,nt=new Uint8Array(Ne*(32/pe.pixelBitlength)*pe.colors),at=new Uint8Array(Ne*(32/pe.pixelBitlength)),ke=pe.colors>1,Ye=0,Xe=0;for(var Rt=0;Ye<Ne;)De=We[Ye++],nt[Xe++]=De>>>0&255,ke&&(nt[Xe++]=De>>>16&255,De=We[Ye++],nt[Xe++]=De>>>0&255),at[Rt++]=De>>>16&255;ce=8}Y!==r.image_compression.NONE&&e()?(R=t(nt,pe.width*pe.colors,pe.colors,Y),je=t(at,pe.width,1,Y)):(R=nt,je=at,Ct=void 0)}if(pe.colorType===3&&(he=this.color_spaces.INDEXED,qe=pe.palette,pe.transparency.indexed)){var Ft=pe.transparency.indexed,Zt=0;for(Ye=0,Ne=Ft.length;Ye<Ne;++Ye)Zt+=Ft[Ye];if((Zt/=255)===Ne-1&&Ft.indexOf(0)!==-1)be=[Ft.indexOf(0)];else if(Zt!==Ne){for(We=pe.decodePixels(),at=new Uint8Array(We.length),Ye=0,Ne=We.length;Ye<Ne;Ye++)at[Ye]=Ft[We[Ye]];je=t(at,pe.width,1)}}var Le=function(Ze){var rt;switch(Ze){case r.image_compression.FAST:rt=11;break;case r.image_compression.MEDIUM:rt=13;break;case r.image_compression.SLOW:rt=14;break;default:rt=12}return rt}(Y);return Ct===this.decode.FLATE_DECODE&&(Et="/Predictor "+Le+" "),Et+="/Colors "+Te+" /BitsPerComponent "+ce+" /Columns "+pe.width,(this.__addimage__.isArrayBuffer(R)||this.__addimage__.isArrayBufferView(R))&&(R=this.__addimage__.arrayBufferToBinaryString(R)),(je&&this.__addimage__.isArrayBuffer(je)||this.__addimage__.isArrayBufferView(je))&&(je=this.__addimage__.arrayBufferToBinaryString(je)),{alias:Z,data:R,index:U,filter:Ct,decodeParameters:Et,transparency:be,palette:qe,sMask:je,predictor:Le,width:pe.width,height:pe.height,bitsPerComponent:ce,colorSpace:he}}}})(Gi.API),function(r){r.processGIF89A=function(e,t,i,n){var o=new Ine(e),a=o.width,s=o.height,g=[];o.decodeAndBlitFrameRGBA(0,g);var y={data:g,width:a,height:s},T=new nE(100).encode(y,100);return r.processJPEG.call(this,T,t,i,n)},r.processGIF87A=r.processGIF89A}(Gi.API),ph.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var r=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(r);for(var e=0;e<r;e++){var t=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0);this.palette[e]={red:n,green:i,blue:t,quad:o}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},ph.prototype.parseBGR=function(){this.pos=this.offset;try{var r="bit"+this.bitPP,e=this.width*this.height*4;this.data=new Uint8Array(e),this[r]()}catch(t){Ps.log("bit decode error:"+t)}},ph.prototype.bit1=function(){var r,e=Math.ceil(this.width/8),t=e%4;for(r=this.height-1;r>=0;r--){for(var i=this.bottom_up?r:this.height-1-r,n=0;n<e;n++)for(var o=this.datav.getUint8(this.pos++,!0),a=i*this.width*4+8*n*4,s=0;s<8&&8*n+s<this.width;s++){var g=this.palette[o>>7-s&1];this.data[a+4*s]=g.blue,this.data[a+4*s+1]=g.green,this.data[a+4*s+2]=g.red,this.data[a+4*s+3]=255}t!==0&&(this.pos+=4-t)}},ph.prototype.bit4=function(){for(var r=Math.ceil(this.width/2),e=r%4,t=this.height-1;t>=0;t--){for(var i=this.bottom_up?t:this.height-1-t,n=0;n<r;n++){var o=this.datav.getUint8(this.pos++,!0),a=i*this.width*4+2*n*4,s=o>>4,g=15&o,y=this.palette[s];if(this.data[a]=y.blue,this.data[a+1]=y.green,this.data[a+2]=y.red,this.data[a+3]=255,2*n+1>=this.width)break;y=this.palette[g],this.data[a+4]=y.blue,this.data[a+4+1]=y.green,this.data[a+4+2]=y.red,this.data[a+4+3]=255}e!==0&&(this.pos+=4-e)}},ph.prototype.bit8=function(){for(var r=this.width%4,e=this.height-1;e>=0;e--){for(var t=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var n=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*i;if(n<this.palette.length){var a=this.palette[n];this.data[o]=a.red,this.data[o+1]=a.green,this.data[o+2]=a.blue,this.data[o+3]=255}else this.data[o]=255,this.data[o+1]=255,this.data[o+2]=255,this.data[o+3]=255}r!==0&&(this.pos+=4-r)}},ph.prototype.bit15=function(){for(var r=this.width%3,e=parseInt("11111",2),t=this.height-1;t>=0;t--){for(var i=this.bottom_up?t:this.height-1-t,n=0;n<this.width;n++){var o=this.datav.getUint16(this.pos,!0);this.pos+=2;var a=(o&e)/e*255|0,s=(o>>5&e)/e*255|0,g=(o>>10&e)/e*255|0,y=o>>15?255:0,T=i*this.width*4+4*n;this.data[T]=g,this.data[T+1]=s,this.data[T+2]=a,this.data[T+3]=y}this.pos+=r}},ph.prototype.bit16=function(){for(var r=this.width%3,e=parseInt("11111",2),t=parseInt("111111",2),i=this.height-1;i>=0;i--){for(var n=this.bottom_up?i:this.height-1-i,o=0;o<this.width;o++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var s=(a&e)/e*255|0,g=(a>>5&t)/t*255|0,y=(a>>11)/e*255|0,T=n*this.width*4+4*o;this.data[T]=y,this.data[T+1]=g,this.data[T+2]=s,this.data[T+3]=255}this.pos+=r}},ph.prototype.bit24=function(){for(var r=this.height-1;r>=0;r--){for(var e=this.bottom_up?r:this.height-1-r,t=0;t<this.width;t++){var i=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),a=e*this.width*4+4*t;this.data[a]=o,this.data[a+1]=n,this.data[a+2]=i,this.data[a+3]=255}this.pos+=this.width%4}},ph.prototype.bit32=function(){for(var r=this.height-1;r>=0;r--)for(var e=this.bottom_up?r:this.height-1-r,t=0;t<this.width;t++){var i=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*t;this.data[s]=o,this.data[s+1]=n,this.data[s+2]=i,this.data[s+3]=a}},ph.prototype.getData=function(){return this.data},function(r){r.processBMP=function(e,t,i,n){var o=new ph(e,!1),a=o.width,s=o.height,g={data:o.getData(),width:a,height:s},y=new nE(100).encode(g,100);return r.processJPEG.call(this,y,t,i,n)}}(Gi.API),FD.prototype.getData=function(){return this.data},function(r){r.processWEBP=function(e,t,i,n){var o=new FD(e),a=o.width,s=o.height,g={data:o.getData(),width:a,height:s},y=new nE(100).encode(g,100);return r.processJPEG.call(this,y,t,i,n)}}(Gi.API),Gi.API.processRGBA=function(r,e,t){for(var i=r.data,n=i.length,o=new Uint8Array(n/4*3),a=new Uint8Array(n/4),s=0,g=0,y=0;y<n;y+=4){var T=i[y],I=i[y+1],R=i[y+2],U=i[y+3];o[s++]=T,o[s++]=I,o[s++]=R,a[g++]=U}var Z=this.__addimage__.arrayBufferToBinaryString(o);return{alpha:this.__addimage__.arrayBufferToBinaryString(a),data:Z,index:e,alias:t,colorSpace:"DeviceRGB",bitsPerComponent:8,width:r.width,height:r.height}},Gi.API.setLanguage=function(r){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[r]!==void 0&&(this.internal.languageSettings.languageCode=r,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},zg=Gi.API,Bv=zg.getCharWidthsArray=function(r,e){var t,i,n=(e=e||{}).font||this.internal.getFont(),o=e.fontSize||this.internal.getFontSize(),a=e.charSpace||this.internal.getCharSpace(),s=e.widths?e.widths:n.metadata.Unicode.widths,g=s.fof?s.fof:1,y=e.kerning?e.kerning:n.metadata.Unicode.kerning,T=y.fof?y.fof:1,I=e.doKerning!==!1,R=0,U=r.length,Z=0,Y=s[0]||g,he=[];for(t=0;t<U;t++)i=r.charCodeAt(t),typeof n.metadata.widthOfString=="function"?he.push((n.metadata.widthOfGlyph(n.metadata.characterToGlyph(i))+a*(1e3/o)||0)/1e3):(R=I&&ts(y[i])==="object"&&!isNaN(parseInt(y[i][Z],10))?y[i][Z]/T:0,he.push((s[i]||Y)/g+R)),Z=i;return he},ID=zg.getStringUnitWidth=function(r,e){var t=(e=e||{}).fontSize||this.internal.getFontSize(),i=e.font||this.internal.getFont(),n=e.charSpace||this.internal.getCharSpace();return zg.processArabic&&(r=zg.processArabic(r)),typeof i.metadata.widthOfString=="function"?i.metadata.widthOfString(r,t,n)/t:Bv.apply(this,arguments).reduce(function(o,a){return o+a},0)},LD=function(r,e,t,i){for(var n=[],o=0,a=r.length,s=0;o!==a&&s+e[o]<t;)s+=e[o],o++;n.push(r.slice(0,o));var g=o;for(s=0;o!==a;)s+e[o]>i&&(n.push(r.slice(g,o)),s=0,g=o),s+=e[o],o++;return g!==o&&n.push(r.slice(g,o)),n},MD=function(r,e,t){t||(t={});var i,n,o,a,s,g,y,T=[],I=[T],R=t.textIndent||0,U=0,Z=0,Y=r.split(" "),he=Bv.apply(this,[" ",t])[0];if(g=t.lineIndent===-1?Y[0].length+2:t.lineIndent||0){var ce=Array(g).join(" "),pe=[];Y.map(function(Te){(Te=Te.split(/\s*\n/)).length>1?pe=pe.concat(Te.map(function(qe,je){return(je&&qe.length?`
`:"")+qe})):pe.push(Te[0])}),Y=pe,g=ID.apply(this,[ce,t])}for(o=0,a=Y.length;o<a;o++){var be=0;if(i=Y[o],g&&i[0]==`
`&&(i=i.substr(1),be=1),R+U+(Z=(n=Bv.apply(this,[i,t])).reduce(function(Te,qe){return Te+qe},0))>e||be){if(Z>e){for(s=LD.apply(this,[i,n,e-(R+U),e]),T.push(s.shift()),T=[s.pop()];s.length;)I.push([s.shift()]);Z=n.slice(i.length-(T[0]?T[0].length:0)).reduce(function(Te,qe){return Te+qe},0)}else T=[i];I.push(T),R=Z+g,U=he}else T.push(i),R+=U+Z,U=he}return y=g?function(Te,qe){return(qe?ce:"")+Te.join(" ")}:function(Te){return Te.join(" ")},I.map(y)},zg.splitTextToSize=function(r,e,t){var i,n=(t=t||{}).fontSize||this.internal.getFontSize(),o=(function(T){if(T.widths&&T.kerning)return{widths:T.widths,kerning:T.kerning};var I=this.internal.getFont(T.fontName,T.fontStyle);return I.metadata.Unicode?{widths:I.metadata.Unicode.widths||{0:1},kerning:I.metadata.Unicode.kerning||{}}:{font:I.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,t);i=Array.isArray(r)?r:String(r).split(/\r?\n/);var a=1*this.internal.scaleFactor*e/n;o.textIndent=t.textIndent?1*t.textIndent*this.internal.scaleFactor/n:0,o.lineIndent=t.lineIndent;var s,g,y=[];for(s=0,g=i.length;s<g;s++)y=y.concat(MD.apply(this,[i[s],a,o]));return y},function(r){r.__fontmetrics__=r.__fontmetrics__||{};for(var e="klmnopqrstuvwxyz",t={},i={},n=0;n<e.length;n++)t[e[n]]="0123456789abcdef"[n],i["0123456789abcdef"[n]]=e[n];var o=function(I){return"0x"+parseInt(I,10).toString(16)},a=r.__fontmetrics__.compress=function(I){var R,U,Z,Y,he=["{"];for(var ce in I){if(R=I[ce],isNaN(parseInt(ce,10))?U="'"+ce+"'":(ce=parseInt(ce,10),U=(U=o(ce).slice(2)).slice(0,-1)+i[U.slice(-1)]),typeof R=="number")R<0?(Z=o(R).slice(3),Y="-"):(Z=o(R).slice(2),Y=""),Z=Y+Z.slice(0,-1)+i[Z.slice(-1)];else{if(ts(R)!=="object")throw new Error("Don't know what to do with value type "+ts(R)+".");Z=a(R)}he.push(U+Z)}return he.push("}"),he.join("")},s=r.__fontmetrics__.uncompress=function(I){if(typeof I!="string")throw new Error("Invalid argument passed to uncompress.");for(var R,U,Z,Y,he={},ce=1,pe=he,be=[],Te="",qe="",je=I.length-1,We=1;We<je;We+=1)(Y=I[We])=="'"?R?(Z=R.join(""),R=void 0):R=[]:R?R.push(Y):Y=="{"?(be.push([pe,Z]),pe={},Z=void 0):Y=="}"?((U=be.pop())[0][U[1]]=pe,Z=void 0,pe=U[0]):Y=="-"?ce=-1:Z===void 0?t.hasOwnProperty(Y)?(Te+=t[Y],Z=parseInt(Te,16)*ce,ce=1,Te=""):Te+=Y:t.hasOwnProperty(Y)?(qe+=t[Y],pe[Z]=parseInt(qe,16)*ce,ce=1,Z=void 0,qe=""):qe+=Y;return he},g={codePages:["WinAnsiEncoding"],WinAnsiEncoding:s("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},y={Unicode:{Courier:g,"Courier-Bold":g,"Courier-BoldOblique":g,"Courier-Oblique":g,Helvetica:g,"Helvetica-Bold":g,"Helvetica-BoldOblique":g,"Helvetica-Oblique":g,"Times-Roman":g,"Times-Bold":g,"Times-BoldItalic":g,"Times-Italic":g}},T={Unicode:{"Courier-Oblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":s("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":s("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:s("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":s("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:s("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":s("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":s("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":s("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":s("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};r.events.push(["addFont",function(I){var R=I.font,U=T.Unicode[R.postScriptName];U&&(R.metadata.Unicode={},R.metadata.Unicode.widths=U.widths,R.metadata.Unicode.kerning=U.kerning);var Z=y.Unicode[R.postScriptName];Z&&(R.metadata.Unicode.encoding=Z,R.encoding=Z.codePages[0])}])}(Gi.API),function(r){var e=function(t){for(var i=t.length,n=new Uint8Array(i),o=0;o<i;o++)n[o]=t.charCodeAt(o);return n};r.API.events.push(["addFont",function(t){var i=void 0,n=t.font,o=t.instance;if(!n.isStandardFont){if(o===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");if(typeof(i=o.existsFileInVFS(n.postScriptName)===!1?o.loadFile(n.postScriptName):o.getFileFromVFS(n.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+n.postScriptName+"').");(function(a,s){s=/^\x00\x01\x00\x00/.test(s)?e(s):e(Yy(s)),a.metadata=r.API.TTFFont.open(s),a.metadata.Unicode=a.metadata.Unicode||{encoding:{},kerning:{},widths:[]},a.metadata.glyIdsUsed=[0]})(n,i)}}])}(Gi),function(r){function e(){return(Hi.canvg?Promise.resolve(Hi.canvg):Promise.resolve().then(()=>fwe)).catch(function(t){return Promise.reject(new Error("Could not load canvg: "+t))}).then(function(t){return t.default?t.default:t})}Gi.API.addSvgAsImage=function(t,i,n,o,a,s,g,y){if(isNaN(i)||isNaN(n))throw Ps.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(o)||isNaN(a))throw Ps.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var T=document.createElement("canvas");T.width=o,T.height=a;var I=T.getContext("2d");I.fillStyle="#fff",I.fillRect(0,0,T.width,T.height);var R={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},U=this;return e().then(function(Z){return Z.fromString(I,t,R)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(Z){return Z.render(R)}).then(function(){U.addImage(T.toDataURL("image/jpeg",1),i,n,o,a,g,y)})}}(),Gi.API.putTotalPages=function(r){var e,t=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(e=new RegExp(r,"g"),t=this.internal.getNumberOfPages()):(e=new RegExp(this.pdfEscape16(r,this.internal.getFont()),"g"),t=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var i=1;i<=this.internal.getNumberOfPages();i++)for(var n=0;n<this.internal.pages[i].length;n++)this.internal.pages[i][n]=this.internal.pages[i][n].replace(e,t);return this},Gi.API.viewerPreferences=function(r,e){var t;r=r||{},e=e||!1;var i,n,o,a={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},s=Object.keys(a),g=[],y=0,T=0,I=0;function R(Z,Y){var he,ce=!1;for(he=0;he<Z.length;he+=1)Z[he]===Y&&(ce=!0);return ce}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(a)),this.internal.viewerpreferences.isSubscribed=!1),t=this.internal.viewerpreferences.configuration,r==="reset"||e===!0){var U=s.length;for(I=0;I<U;I+=1)t[s[I]].value=t[s[I]].defaultValue,t[s[I]].explicitSet=!1}if(ts(r)==="object"){for(n in r)if(o=r[n],R(s,n)&&o!==void 0){if(t[n].type==="boolean"&&typeof o=="boolean")t[n].value=o;else if(t[n].type==="name"&&R(t[n].valueSet,o))t[n].value=o;else if(t[n].type==="integer"&&Number.isInteger(o))t[n].value=o;else if(t[n].type==="array"){for(y=0;y<o.length;y+=1)if(i=!0,o[y].length===1&&typeof o[y][0]=="number")g.push(String(o[y]-1));else if(o[y].length>1){for(T=0;T<o[y].length;T+=1)typeof o[y][T]!="number"&&(i=!1);i===!0&&g.push([o[y][0]-1,o[y][1]-1].join(" "))}t[n].value="["+g.join(" ")+"]"}else t[n].value=t[n].defaultValue;t[n].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var Z,Y=[];for(Z in t)t[Z].explicitSet===!0&&(t[Z].type==="name"?Y.push("/"+Z+" /"+t[Z].value):Y.push("/"+Z+" "+t[Z].value));Y.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+Y.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=t,this},function(r){var e=function(){var i='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',n=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),o=unescape(encodeURIComponent(i)),a=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),s=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),g=unescape(encodeURIComponent("</x:xmpmeta>")),y=o.length+a.length+s.length+n.length+g.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+y+" >>"),this.internal.write("stream"),this.internal.write(n+o+a+s+g),this.internal.write("endstream"),this.internal.write("endobj")},t=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};r.addMetadata=function(i,n){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:i,namespaceuri:n||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",t),this.internal.events.subscribe("postPutResources",e)),this}}(Gi.API),function(r){var e=r.API,t=e.pdfEscape16=function(o,a){for(var s,g=a.metadata.Unicode.widths,y=["","0","00","000","0000"],T=[""],I=0,R=o.length;I<R;++I){if(s=a.metadata.characterToGlyph(o.charCodeAt(I)),a.metadata.glyIdsUsed.push(s),a.metadata.toUnicode[s]=o.charCodeAt(I),g.indexOf(s)==-1&&(g.push(s),g.push([parseInt(a.metadata.widthOfGlyph(s),10)])),s=="0")return T.join("");s=s.toString(16),T.push(y[4-s.length],s)}return T.join("")},i=function(o){var a,s,g,y,T,I,R;for(T=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,g=[],I=0,R=(s=Object.keys(o).sort(function(U,Z){return U-Z})).length;I<R;I++)a=s[I],g.length>=100&&(T+=`
`+g.length+` beginbfchar
`+g.join(`
`)+`
endbfchar`,g=[]),o[a]!==void 0&&o[a]!==null&&typeof o[a].toString=="function"&&(y=("0000"+o[a].toString(16)).slice(-4),a=("0000"+(+a).toString(16)).slice(-4),g.push("<"+a+"><"+y+">"));return g.length&&(T+=`
`+g.length+` beginbfchar
`+g.join(`
`)+`
endbfchar
`),T+=`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};e.events.push(["putFont",function(o){(function(a){var s=a.font,g=a.out,y=a.newObject,T=a.putStream;if(s.metadata instanceof r.API.TTFFont&&s.encoding==="Identity-H"){for(var I=s.metadata.Unicode.widths,R=s.metadata.subset.encode(s.metadata.glyIdsUsed,1),U="",Z=0;Z<R.length;Z++)U+=String.fromCharCode(R[Z]);var Y=y();T({data:U,addLength1:!0,objectId:Y}),g("endobj");var he=y();T({data:i(s.metadata.toUnicode),addLength1:!0,objectId:he}),g("endobj");var ce=y();g("<<"),g("/Type /FontDescriptor"),g("/FontName /"+Fg(s.fontName)),g("/FontFile2 "+Y+" 0 R"),g("/FontBBox "+r.API.PDFObject.convert(s.metadata.bbox)),g("/Flags "+s.metadata.flags),g("/StemV "+s.metadata.stemV),g("/ItalicAngle "+s.metadata.italicAngle),g("/Ascent "+s.metadata.ascender),g("/Descent "+s.metadata.decender),g("/CapHeight "+s.metadata.capHeight),g(">>"),g("endobj");var pe=y();g("<<"),g("/Type /Font"),g("/BaseFont /"+Fg(s.fontName)),g("/FontDescriptor "+ce+" 0 R"),g("/W "+r.API.PDFObject.convert(I)),g("/CIDToGIDMap /Identity"),g("/DW 1000"),g("/Subtype /CIDFontType2"),g("/CIDSystemInfo"),g("<<"),g("/Supplement 0"),g("/Registry (Adobe)"),g("/Ordering ("+s.encoding+")"),g(">>"),g(">>"),g("endobj"),s.objectNumber=y(),g("<<"),g("/Type /Font"),g("/Subtype /Type0"),g("/ToUnicode "+he+" 0 R"),g("/BaseFont /"+Fg(s.fontName)),g("/Encoding /"+s.encoding),g("/DescendantFonts ["+pe+" 0 R]"),g(">>"),g("endobj"),s.isAlreadyPutted=!0}})(o)}]),e.events.push(["putFont",function(o){(function(a){var s=a.font,g=a.out,y=a.newObject,T=a.putStream;if(s.metadata instanceof r.API.TTFFont&&s.encoding==="WinAnsiEncoding"){for(var I=s.metadata.rawData,R="",U=0;U<I.length;U++)R+=String.fromCharCode(I[U]);var Z=y();T({data:R,addLength1:!0,objectId:Z}),g("endobj");var Y=y();T({data:i(s.metadata.toUnicode),addLength1:!0,objectId:Y}),g("endobj");var he=y();g("<<"),g("/Descent "+s.metadata.decender),g("/CapHeight "+s.metadata.capHeight),g("/StemV "+s.metadata.stemV),g("/Type /FontDescriptor"),g("/FontFile2 "+Z+" 0 R"),g("/Flags 96"),g("/FontBBox "+r.API.PDFObject.convert(s.metadata.bbox)),g("/FontName /"+Fg(s.fontName)),g("/ItalicAngle "+s.metadata.italicAngle),g("/Ascent "+s.metadata.ascender),g(">>"),g("endobj"),s.objectNumber=y();for(var ce=0;ce<s.metadata.hmtx.widths.length;ce++)s.metadata.hmtx.widths[ce]=parseInt(s.metadata.hmtx.widths[ce]*(1e3/s.metadata.head.unitsPerEm));g("<</Subtype/TrueType/Type/Font/ToUnicode "+Y+" 0 R/BaseFont/"+Fg(s.fontName)+"/FontDescriptor "+he+" 0 R/Encoding/"+s.encoding+" /FirstChar 29 /LastChar 255 /Widths "+r.API.PDFObject.convert(s.metadata.hmtx.widths)+">>"),g("endobj"),s.isAlreadyPutted=!0}})(o)}]);var n=function(o){var a,s=o.text||"",g=o.x,y=o.y,T=o.options||{},I=o.mutex||{},R=I.pdfEscape,U=I.activeFontKey,Z=I.fonts,Y=U,he="",ce=0,pe="",be=Z[Y].encoding;if(Z[Y].encoding!=="Identity-H")return{text:s,x:g,y,options:T,mutex:I};for(pe=s,Y=U,Array.isArray(s)&&(pe=s[0]),ce=0;ce<pe.length;ce+=1)Z[Y].metadata.hasOwnProperty("cmap")&&(a=Z[Y].metadata.cmap.unicode.codeMap[pe[ce].charCodeAt(0)]),a||pe[ce].charCodeAt(0)<256&&Z[Y].metadata.hasOwnProperty("Unicode")?he+=pe[ce]:he+="";var Te="";return parseInt(Y.slice(1))<14||be==="WinAnsiEncoding"?Te=R(he,Y).split("").map(function(qe){return qe.charCodeAt(0).toString(16)}).join(""):be==="Identity-H"&&(Te=t(he,Z[Y])),I.isHex=!0,{text:Te,x:g,y,options:T,mutex:I}};e.events.push(["postProcessText",function(o){var a=o.text||"",s=[],g={text:a,x:o.x,y:o.y,options:o.options,mutex:o.mutex};if(Array.isArray(a)){var y=0;for(y=0;y<a.length;y+=1)Array.isArray(a[y])&&a[y].length===3?s.push([n(Object.assign({},g,{text:a[y][0]})).text,a[y][1],a[y][2]]):s.push(n(Object.assign({},g,{text:a[y]})).text);o.text=s}else o.text=n(Object.assign({},g,{text:a})).text}])}(Gi),function(r){var e=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};r.existsFileInVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0},r.addFileToVFS=function(t,i){return e.call(this),this.internal.vFS[t]=i,this},r.getFileFromVFS=function(t){return e.call(this),this.internal.vFS[t]!==void 0?this.internal.vFS[t]:null}}(Gi.API),function(r){r.__bidiEngine__=r.prototype.__bidiEngine__=function(i){var n,o,a,s,g,y,T,I=e,R=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],U=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],Z={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},Y={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},he=["(",")","(","<",">","<","[","]","[","{","}","{","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],ce=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),pe=!1,be=0;this.__bidiEngine__={};var Te=function(ke){var De=ke.charCodeAt(),Ye=De>>8,Xe=Y[Ye];return Xe!==void 0?I[256*Xe+(255&De)]:Ye===252||Ye===253?"AL":ce.test(Ye)?"L":Ye===8?"R":"N"},qe=function(ke){for(var De,Ye=0;Ye<ke.length;Ye++){if((De=Te(ke.charAt(Ye)))==="L")return!1;if(De==="R")return!0}return!1},je=function(ke,De,Ye,Xe){var Ct,Et,Pt,bt,Rt=De[Xe];switch(Rt){case"L":case"R":pe=!1;break;case"N":case"AN":break;case"EN":pe&&(Rt="AN");break;case"AL":pe=!0,Rt="R";break;case"WS":Rt="N";break;case"CS":Xe<1||Xe+1>=De.length||(Ct=Ye[Xe-1])!=="EN"&&Ct!=="AN"||(Et=De[Xe+1])!=="EN"&&Et!=="AN"?Rt="N":pe&&(Et="AN"),Rt=Et===Ct?Et:"N";break;case"ES":Rt=(Ct=Xe>0?Ye[Xe-1]:"B")==="EN"&&Xe+1<De.length&&De[Xe+1]==="EN"?"EN":"N";break;case"ET":if(Xe>0&&Ye[Xe-1]==="EN"){Rt="EN";break}if(pe){Rt="N";break}for(Pt=Xe+1,bt=De.length;Pt<bt&&De[Pt]==="ET";)Pt++;Rt=Pt<bt&&De[Pt]==="EN"?"EN":"N";break;case"NSM":if(a&&!s){for(bt=De.length,Pt=Xe+1;Pt<bt&&De[Pt]==="NSM";)Pt++;if(Pt<bt){var Ft=ke[Xe],Zt=Ft>=1425&&Ft<=2303||Ft===64286;if(Ct=De[Pt],Zt&&(Ct==="R"||Ct==="AL")){Rt="R";break}}}Rt=Xe<1||(Ct=De[Xe-1])==="B"?"N":Ye[Xe-1];break;case"B":pe=!1,n=!0,Rt=be;break;case"S":o=!0,Rt="N";break;case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":pe=!1;break;case"BN":Rt="N"}return Rt},We=function(ke,De,Ye){var Xe=ke.split("");return Ye&&Ne(Xe,Ye,{hiLevel:be}),Xe.reverse(),De&&De.reverse(),Xe.join("")},Ne=function(ke,De,Ye){var Xe,Ct,Et,Pt,bt,Rt=-1,Ft=ke.length,Zt=0,Le=[],Ze=be?U:R,rt=[];for(pe=!1,n=!1,o=!1,Ct=0;Ct<Ft;Ct++)rt[Ct]=Te(ke[Ct]);for(Et=0;Et<Ft;Et++){if(bt=Zt,Le[Et]=je(ke,rt,Le,Et),Xe=240&(Zt=Ze[bt][Z[Le[Et]]]),Zt&=15,De[Et]=Pt=Ze[Zt][5],Xe>0)if(Xe===16){for(Ct=Rt;Ct<Et;Ct++)De[Ct]=1;Rt=-1}else Rt=-1;if(Ze[Zt][6])Rt===-1&&(Rt=Et);else if(Rt>-1){for(Ct=Rt;Ct<Et;Ct++)De[Ct]=Pt;Rt=-1}rt[Et]==="B"&&(De[Et]=0),Ye.hiLevel|=Pt}o&&function(pt,mt,Bt){for(var Dt=0;Dt<Bt;Dt++)if(pt[Dt]==="S"){mt[Dt]=be;for(var Mt=Dt-1;Mt>=0&&pt[Mt]==="WS";Mt--)mt[Mt]=be}}(rt,De,Ft)},at=function(ke,De,Ye,Xe,Ct){if(!(Ct.hiLevel<ke)){if(ke===1&&be===1&&!n)return De.reverse(),void(Ye&&Ye.reverse());for(var Et,Pt,bt,Rt,Ft=De.length,Zt=0;Zt<Ft;){if(Xe[Zt]>=ke){for(bt=Zt+1;bt<Ft&&Xe[bt]>=ke;)bt++;for(Rt=Zt,Pt=bt-1;Rt<Pt;Rt++,Pt--)Et=De[Rt],De[Rt]=De[Pt],De[Pt]=Et,Ye&&(Et=Ye[Rt],Ye[Rt]=Ye[Pt],Ye[Pt]=Et);Zt=bt}Zt++}}},nt=function(ke,De,Ye){var Xe=ke.split(""),Ct={hiLevel:be};return Ye||(Ye=[]),Ne(Xe,Ye,Ct),function(Et,Pt,bt){if(bt.hiLevel!==0&&T)for(var Rt,Ft=0;Ft<Et.length;Ft++)Pt[Ft]===1&&(Rt=he.indexOf(Et[Ft]))>=0&&(Et[Ft]=he[Rt+1])}(Xe,Ye,Ct),at(2,Xe,De,Ye,Ct),at(1,Xe,De,Ye,Ct),Xe.join("")};return this.__bidiEngine__.doBidiReorder=function(ke,De,Ye){if(function(Ct,Et){if(Et)for(var Pt=0;Pt<Ct.length;Pt++)Et[Pt]=Pt;s===void 0&&(s=qe(Ct)),y===void 0&&(y=qe(Ct))}(ke,De),a||!g||y)if(a&&g&&s^y)be=s?1:0,ke=We(ke,De,Ye);else if(!a&&g&&y)be=s?1:0,ke=nt(ke,De,Ye),ke=We(ke,De);else if(!a||s||g||y){if(a&&!g&&s^y)ke=We(ke,De),s?(be=0,ke=nt(ke,De,Ye)):(be=1,ke=nt(ke,De,Ye),ke=We(ke,De));else if(a&&s&&!g&&y)be=1,ke=nt(ke,De,Ye),ke=We(ke,De);else if(!a&&!g&&s^y){var Xe=T;s?(be=1,ke=nt(ke,De,Ye),be=0,T=!1,ke=nt(ke,De,Ye),T=Xe):(be=0,ke=nt(ke,De,Ye),ke=We(ke,De),be=1,T=!1,ke=nt(ke,De,Ye),T=Xe,ke=We(ke,De))}}else be=0,ke=nt(ke,De,Ye);else be=s?1:0,ke=nt(ke,De,Ye);return ke},this.__bidiEngine__.setOptions=function(ke){ke&&(a=ke.isInputVisual,g=ke.isOutputVisual,s=ke.isInputRtl,y=ke.isOutputRtl,T=ke.isSymmetricSwapping)},this.__bidiEngine__.setOptions(i),this.__bidiEngine__};var e=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],t=new r.__bidiEngine__({isInputVisual:!0});r.API.events.push(["postProcessText",function(i){var n=i.text,o=(i.x,i.y,i.options||{}),a=(i.mutex,o.lang,[]);if(o.isInputVisual=typeof o.isInputVisual!="boolean"||o.isInputVisual,t.setOptions(o),Object.prototype.toString.call(n)==="[object Array]"){var s=0;for(a=[],s=0;s<n.length;s+=1)Object.prototype.toString.call(n[s])==="[object Array]"?a.push([t.doBidiReorder(n[s][0]),n[s][1],n[s][2]]):a.push([t.doBidiReorder(n[s])]);i.text=a}else i.text=t.doBidiReorder(n);t.setOptions({isInputVisual:!0})}])}(Gi),Gi.API.TTFFont=function(){function r(e){var t;if(this.rawData=e,t=this.contents=new Sd(e),this.contents.pos=4,t.readString(4)==="ttcf")throw new Error("TTCF not supported.");t.pos=0,this.parse(),this.subset=new Gne(this),this.registerTTF()}return r.open=function(e){return new r(e)},r.prototype.parse=function(){return this.directory=new Lne(this.contents),this.head=new Pne(this),this.name=new One(this),this.cmap=new RD(this),this.toUnicode={},this.hhea=new Fne(this),this.maxp=new Une(this),this.hmtx=new Nne(this),this.post=new Rne(this),this.os2=new Dne(this),this.loca=new Hne(this),this.glyf=new zne(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},r.prototype.registerTTF=function(){var e,t,i,n,o;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var a,s,g,y;for(y=[],a=0,s=(g=this.bbox).length;a<s;a++)e=g[a],y.push(Math.round(e*this.scaleFactor));return y}).call(this),this.stemV=0,this.post.exists?(i=255&(n=this.post.italic_angle),32768&(t=n>>16)&&(t=-(1+(65535^t))),this.italicAngle=+(t+"."+i)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(o=this.familyClass)===1||o===2||o===3||o===4||o===5||o===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},r.prototype.characterToGlyph=function(e){var t;return((t=this.cmap.unicode)!=null?t.codeMap[e]:void 0)||0},r.prototype.widthOfGlyph=function(e){var t;return t=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(e).advance*t},r.prototype.widthOfString=function(e,t,i){var n,o,a,s;for(a=0,o=0,s=(e=""+e).length;0<=s?o<s:o>s;o=0<=s?++o:--o)n=e.charCodeAt(o),a+=this.widthOfGlyph(this.characterToGlyph(n))+i*(1e3/t)||0;return a*(t/1e3)},r.prototype.lineHeight=function(e,t){var i;return t==null&&(t=!1),i=t?this.lineGap:0,(this.ascender+i-this.decender)/1e3*e},r}();var gh,Sd=function(){function r(e){this.data=e??[],this.pos=0,this.length=this.data.length}return r.prototype.readByte=function(){return this.data[this.pos++]},r.prototype.writeByte=function(e){return this.data[this.pos++]=e},r.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},r.prototype.writeUInt32=function(e){return this.writeByte(e>>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e)},r.prototype.readInt32=function(){var e;return(e=this.readUInt32())>=2147483648?e-4294967296:e},r.prototype.writeInt32=function(e){return e<0&&(e+=4294967296),this.writeUInt32(e)},r.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},r.prototype.writeUInt16=function(e){return this.writeByte(e>>8&255),this.writeByte(255&e)},r.prototype.readInt16=function(){var e;return(e=this.readUInt16())>=32768?e-65536:e},r.prototype.writeInt16=function(e){return e<0&&(e+=65536),this.writeUInt16(e)},r.prototype.readString=function(e){var t,i;for(i=[],t=0;0<=e?t<e:t>e;t=0<=e?++t:--t)i[t]=String.fromCharCode(this.readByte());return i.join("")},r.prototype.writeString=function(e){var t,i,n;for(n=[],t=0,i=e.length;0<=i?t<i:t>i;t=0<=i?++t:--t)n.push(this.writeByte(e.charCodeAt(t)));return n},r.prototype.readShort=function(){return this.readInt16()},r.prototype.writeShort=function(e){return this.writeInt16(e)},r.prototype.readLongLong=function(){var e,t,i,n,o,a,s,g;return e=this.readByte(),t=this.readByte(),i=this.readByte(),n=this.readByte(),o=this.readByte(),a=this.readByte(),s=this.readByte(),g=this.readByte(),128&e?-1*(72057594037927940*(255^e)+281474976710656*(255^t)+1099511627776*(255^i)+4294967296*(255^n)+16777216*(255^o)+65536*(255^a)+256*(255^s)+(255^g)+1):72057594037927940*e+281474976710656*t+1099511627776*i+4294967296*n+16777216*o+65536*a+256*s+g},r.prototype.writeLongLong=function(e){var t,i;return t=Math.floor(e/4294967296),i=4294967295&e,this.writeByte(t>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t),this.writeByte(i>>24&255),this.writeByte(i>>16&255),this.writeByte(i>>8&255),this.writeByte(255&i)},r.prototype.readInt=function(){return this.readInt32()},r.prototype.writeInt=function(e){return this.writeInt32(e)},r.prototype.read=function(e){var t,i;for(t=[],i=0;0<=e?i<e:i>e;i=0<=e?++i:--i)t.push(this.readByte());return t},r.prototype.write=function(e){var t,i,n,o;for(o=[],i=0,n=e.length;i<n;i++)t=e[i],o.push(this.writeByte(t));return o},r}(),Lne=function(){var r;function e(t){var i,n,o;for(this.scalarType=t.readInt(),this.tableCount=t.readShort(),this.searchRange=t.readShort(),this.entrySelector=t.readShort(),this.rangeShift=t.readShort(),this.tables={},n=0,o=this.tableCount;0<=o?n<o:n>o;n=0<=o?++n:--n)i={tag:t.readString(4),checksum:t.readInt(),offset:t.readInt(),length:t.readInt()},this.tables[i.tag]=i}return e.prototype.encode=function(t){var i,n,o,a,s,g,y,T,I,R,U,Z,Y;for(Y in U=Object.keys(t).length,g=Math.log(2),I=16*Math.floor(Math.log(U)/g),a=Math.floor(I/g),T=16*U-I,(n=new Sd).writeInt(this.scalarType),n.writeShort(U),n.writeShort(I),n.writeShort(a),n.writeShort(T),o=16*U,y=n.pos+o,s=null,Z=[],t)for(R=t[Y],n.writeString(Y),n.writeInt(r(R)),n.writeInt(y),n.writeInt(R.length),Z=Z.concat(R),Y==="head"&&(s=y),y+=R.length;y%4;)Z.push(0),y++;return n.write(Z),i=2981146554-r(n.data),n.pos=s+8,n.writeUInt32(i),n.data},r=function(t){var i,n,o,a;for(t=kD.call(t);t.length%4;)t.push(0);for(o=new Sd(t),n=0,i=0,a=t.length;i<a;i=i+=4)n+=o.readUInt32();return 4294967295&n},e}(),Mne={}.hasOwnProperty,Yh=function(r,e){for(var t in e)Mne.call(e,t)&&(r[t]=e[t]);function i(){this.constructor=r}return i.prototype=e.prototype,r.prototype=new i,r.__super__=e.prototype,r};gh=function(){function r(e){var t;this.file=e,t=this.file.directory.tables[this.tag],this.exists=!!t,t&&(this.offset=t.offset,this.length=t.length,this.parse(this.file.contents))}return r.prototype.parse=function(){},r.prototype.encode=function(){},r.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},r}();var Pne=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Yh(e,gh),e.prototype.tag="head",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},e.prototype.encode=function(t){var i;return(i=new Sd).writeInt(this.version),i.writeInt(this.revision),i.writeInt(this.checkSumAdjustment),i.writeInt(this.magicNumber),i.writeShort(this.flags),i.writeShort(this.unitsPerEm),i.writeLongLong(this.created),i.writeLongLong(this.modified),i.writeShort(this.xMin),i.writeShort(this.yMin),i.writeShort(this.xMax),i.writeShort(this.yMax),i.writeShort(this.macStyle),i.writeShort(this.lowestRecPPEM),i.writeShort(this.fontDirectionHint),i.writeShort(t),i.writeShort(this.glyphDataFormat),i.data},e}(),DD=function(){function r(e,t){var i,n,o,a,s,g,y,T,I,R,U,Z,Y,he,ce,pe,be;switch(this.platformID=e.readUInt16(),this.encodingID=e.readShort(),this.offset=t+e.readInt(),I=e.pos,e.pos=this.offset,this.format=e.readUInt16(),this.length=e.readUInt16(),this.language=e.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(g=0;g<256;++g)this.codeMap[g]=e.readByte();break;case 4:for(U=e.readUInt16(),R=U/2,e.pos+=6,o=function(){var Te,qe;for(qe=[],g=Te=0;0<=R?Te<R:Te>R;g=0<=R?++Te:--Te)qe.push(e.readUInt16());return qe}(),e.pos+=2,Y=function(){var Te,qe;for(qe=[],g=Te=0;0<=R?Te<R:Te>R;g=0<=R?++Te:--Te)qe.push(e.readUInt16());return qe}(),y=function(){var Te,qe;for(qe=[],g=Te=0;0<=R?Te<R:Te>R;g=0<=R?++Te:--Te)qe.push(e.readUInt16());return qe}(),T=function(){var Te,qe;for(qe=[],g=Te=0;0<=R?Te<R:Te>R;g=0<=R?++Te:--Te)qe.push(e.readUInt16());return qe}(),n=(this.length-e.pos+this.offset)/2,s=function(){var Te,qe;for(qe=[],g=Te=0;0<=n?Te<n:Te>n;g=0<=n?++Te:--Te)qe.push(e.readUInt16());return qe}(),g=ce=0,be=o.length;ce<be;g=++ce)for(he=o[g],i=pe=Z=Y[g];Z<=he?pe<=he:pe>=he;i=Z<=he?++pe:--pe)T[g]===0?a=i+y[g]:(a=s[T[g]/2+(i-Z)-(R-g)]||0)!==0&&(a+=y[g]),this.codeMap[i]=65535&a}e.pos=I}return r.encode=function(e,t){var i,n,o,a,s,g,y,T,I,R,U,Z,Y,he,ce,pe,be,Te,qe,je,We,Ne,at,nt,ke,De,Ye,Xe,Ct,Et,Pt,bt,Rt,Ft,Zt,Le,Ze,rt,pt,mt,Bt,Dt,Mt,qt,nr,vr;switch(Xe=new Sd,a=Object.keys(e).sort(function(br,Fr){return br-Fr}),t){case"macroman":for(Y=0,he=function(){var br=[];for(Z=0;Z<256;++Z)br.push(0);return br}(),pe={0:0},o={},Ct=0,Rt=a.length;Ct<Rt;Ct++)pe[Mt=e[n=a[Ct]]]==null&&(pe[Mt]=++Y),o[n]={old:e[n],new:pe[e[n]]},he[n]=pe[e[n]];return Xe.writeUInt16(1),Xe.writeUInt16(0),Xe.writeUInt32(12),Xe.writeUInt16(0),Xe.writeUInt16(262),Xe.writeUInt16(0),Xe.write(he),{charMap:o,subtable:Xe.data,maxGlyphID:Y+1};case"unicode":for(De=[],I=[],be=0,pe={},i={},ce=y=null,Et=0,Ft=a.length;Et<Ft;Et++)pe[qe=e[n=a[Et]]]==null&&(pe[qe]=++be),i[n]={old:qe,new:pe[qe]},s=pe[qe]-n,ce!=null&&s===y||(ce&&I.push(ce),De.push(n),y=s),ce=n;for(ce&&I.push(ce),I.push(65535),De.push(65535),nt=2*(at=De.length),Ne=2*Math.pow(Math.log(at)/Math.LN2,2),R=Math.log(Ne/2)/Math.LN2,We=2*at-Ne,g=[],je=[],U=[],Z=Pt=0,Zt=De.length;Pt<Zt;Z=++Pt){if(ke=De[Z],T=I[Z],ke===65535){g.push(0),je.push(0);break}if(ke-(Ye=i[ke].new)>=32768)for(g.push(0),je.push(2*(U.length+at-Z)),n=bt=ke;ke<=T?bt<=T:bt>=T;n=ke<=T?++bt:--bt)U.push(i[n].new);else g.push(Ye-ke),je.push(0)}for(Xe.writeUInt16(3),Xe.writeUInt16(1),Xe.writeUInt32(12),Xe.writeUInt16(4),Xe.writeUInt16(16+8*at+2*U.length),Xe.writeUInt16(0),Xe.writeUInt16(nt),Xe.writeUInt16(Ne),Xe.writeUInt16(R),Xe.writeUInt16(We),Bt=0,Le=I.length;Bt<Le;Bt++)n=I[Bt],Xe.writeUInt16(n);for(Xe.writeUInt16(0),Dt=0,Ze=De.length;Dt<Ze;Dt++)n=De[Dt],Xe.writeUInt16(n);for(qt=0,rt=g.length;qt<rt;qt++)s=g[qt],Xe.writeUInt16(s);for(nr=0,pt=je.length;nr<pt;nr++)Te=je[nr],Xe.writeUInt16(Te);for(vr=0,mt=U.length;vr<mt;vr++)Y=U[vr],Xe.writeUInt16(Y);return{charMap:i,subtable:Xe.data,maxGlyphID:be+1}}},r}(),RD=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Yh(e,gh),e.prototype.tag="cmap",e.prototype.parse=function(t){var i,n,o;for(t.pos=this.offset,this.version=t.readUInt16(),o=t.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=o?n<o:n>o;n=0<=o?++n:--n)i=new DD(t,this.offset),this.tables.push(i),i.isUnicode&&this.unicode==null&&(this.unicode=i);return!0},e.encode=function(t,i){var n,o;return i==null&&(i="macroman"),n=DD.encode(t,i),(o=new Sd).writeUInt16(0),o.writeUInt16(1),n.table=o.data.concat(n.subtable),n},e}(),Fne=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Yh(e,gh),e.prototype.tag="hhea",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},e}(),Dne=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Yh(e,gh),e.prototype.tag="OS/2",e.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=function(){var i,n;for(n=[],i=0;i<10;++i)n.push(t.readByte());return n}(),this.charRange=function(){var i,n;for(n=[],i=0;i<4;++i)n.push(t.readInt());return n}(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=function(){var i,n;for(n=[],i=0;i<2;i=++i)n.push(t.readInt());return n}(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},e}(),Rne=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Yh(e,gh),e.prototype.tag="post",e.prototype.parse=function(t){var i,n,o;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:break;case 131072:var a;for(n=t.readUInt16(),this.glyphNameIndex=[],a=0;0<=n?a<n:a>n;a=0<=n?++a:--a)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],o=[];t.pos<this.offset+this.length;)i=t.readByte(),o.push(this.names.push(t.readString(i)));return o;case 151552:return n=t.readUInt16(),this.offsets=t.read(n);case 196608:break;case 262144:return this.map=(function(){var s,g,y;for(y=[],a=s=0,g=this.file.maxp.numGlyphs;0<=g?s<g:s>g;a=0<=g?++s:--s)y.push(t.readUInt32());return y}).call(this)}},e}(),kne=function(r,e){this.raw=r,this.length=r.length,this.platformID=e.platformID,this.encodingID=e.encodingID,this.languageID=e.languageID},One=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Yh(e,gh),e.prototype.tag="name",e.prototype.parse=function(t){var i,n,o,a,s,g,y,T,I,R,U;for(t.pos=this.offset,t.readShort(),i=t.readShort(),g=t.readShort(),n=[],a=0;0<=i?a<i:a>i;a=0<=i?++a:--a)n.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+g+t.readShort()});for(y={},a=I=0,R=n.length;I<R;a=++I)o=n[a],t.pos=o.offset,T=t.readString(o.length),s=new kne(T,o),y[U=o.nameID]==null&&(y[U]=[]),y[o.nameID].push(s);this.strings=y,this.copyright=y[0],this.fontFamily=y[1],this.fontSubfamily=y[2],this.uniqueSubfamily=y[3],this.fontName=y[4],this.version=y[5];try{this.postscriptName=y[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=y[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=y[7],this.manufacturer=y[8],this.designer=y[9],this.description=y[10],this.vendorUrl=y[11],this.designerUrl=y[12],this.license=y[13],this.licenseUrl=y[14],this.preferredFamily=y[15],this.preferredSubfamily=y[17],this.compatibleFull=y[18],this.sampleText=y[19]},e}(),Une=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Yh(e,gh),e.prototype.tag="maxp",e.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},e}(),Nne=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Yh(e,gh),e.prototype.tag="hmtx",e.prototype.parse=function(t){var i,n,o,a,s,g,y;for(t.pos=this.offset,this.metrics=[],i=0,g=this.file.hhea.numberOfMetrics;0<=g?i<g:i>g;i=0<=g?++i:--i)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(o=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var T,I;for(I=[],i=T=0;0<=o?T<o:T>o;i=0<=o?++T:--T)I.push(t.readInt16());return I}(),this.widths=(function(){var T,I,R,U;for(U=[],T=0,I=(R=this.metrics).length;T<I;T++)a=R[T],U.push(a.advance);return U}).call(this),n=this.widths[this.widths.length-1],y=[],i=s=0;0<=o?s<o:s>o;i=0<=o?++s:--s)y.push(this.widths.push(n));return y},e.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},e}(),kD=[].slice,zne=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Yh(e,gh),e.prototype.tag="glyf",e.prototype.parse=function(){return this.cache={}},e.prototype.glyphFor=function(t){var i,n,o,a,s,g,y,T,I,R;return t in this.cache?this.cache[t]:(a=this.file.loca,i=this.file.contents,n=a.indexOf(t),(o=a.lengthOf(t))===0?this.cache[t]=null:(i.pos=this.offset+n,s=(g=new Sd(i.read(o))).readShort(),T=g.readShort(),R=g.readShort(),y=g.readShort(),I=g.readShort(),this.cache[t]=s===-1?new Vne(g,T,R,y,I):new Qne(g,s,T,R,y,I),this.cache[t]))},e.prototype.encode=function(t,i,n){var o,a,s,g,y;for(s=[],a=[],g=0,y=i.length;g<y;g++)o=t[i[g]],a.push(s.length),o&&(s=s.concat(o.encode(n)));return a.push(s.length),{table:s,offsets:a}},e}(),Qne=function(){function r(e,t,i,n,o,a){this.raw=e,this.numberOfContours=t,this.xMin=i,this.yMin=n,this.xMax=o,this.yMax=a,this.compound=!1}return r.prototype.encode=function(){return this.raw.data},r}(),Vne=function(){function r(e,t,i,n,o){var a,s;for(this.raw=e,this.xMin=t,this.yMin=i,this.xMax=n,this.yMax=o,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],a=this.raw;s=a.readShort(),this.glyphOffsets.push(a.pos),this.glyphIDs.push(a.readUInt16()),32&s;)a.pos+=1&s?4:2,128&s?a.pos+=8:64&s?a.pos+=4:8&s&&(a.pos+=2)}return r.prototype.encode=function(){var e,t,i;for(t=new Sd(kD.call(this.raw.data)),e=0,i=this.glyphIDs.length;e<i;++e)t.pos=this.glyphOffsets[e];return t.data},r}(),Hne=function(r){function e(){return e.__super__.constructor.apply(this,arguments)}return Yh(e,gh),e.prototype.tag="loca",e.prototype.parse=function(t){var i,n;return t.pos=this.offset,i=this.file.head.indexToLocFormat,this.offsets=i===0?(function(){var o,a;for(a=[],n=0,o=this.length;n<o;n+=2)a.push(2*t.readUInt16());return a}).call(this):(function(){var o,a;for(a=[],n=0,o=this.length;n<o;n+=4)a.push(t.readUInt32());return a}).call(this)},e.prototype.indexOf=function(t){return this.offsets[t]},e.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},e.prototype.encode=function(t,i){for(var n=new Uint32Array(this.offsets.length),o=0,a=0,s=0;s<n.length;++s)if(n[s]=o,a<i.length&&i[a]==s){++a,n[s]=o;var g=this.offsets[s],y=this.offsets[s+1]-g;y>0&&(o+=y)}for(var T=new Array(4*n.length),I=0;I<n.length;++I)T[4*I+3]=255&n[I],T[4*I+2]=(65280&n[I])>>8,T[4*I+1]=(16711680&n[I])>>16,T[4*I]=(4278190080&n[I])>>24;return T},e}(),Gne=function(){function r(e){this.font=e,this.subset={},this.unicodes={},this.next=33}return r.prototype.generateCmap=function(){var e,t,i,n,o;for(t in n=this.font.cmap.tables[0].codeMap,e={},o=this.subset)i=o[t],e[t]=n[i];return e},r.prototype.glyphsFor=function(e){var t,i,n,o,a,s,g;for(n={},a=0,s=e.length;a<s;a++)n[o=e[a]]=this.font.glyf.glyphFor(o);for(o in t=[],n)(i=n[o])!=null&&i.compound&&t.push.apply(t,i.glyphIDs);if(t.length>0)for(o in g=this.glyphsFor(t))i=g[o],n[o]=i;return n},r.prototype.encode=function(e,t){var i,n,o,a,s,g,y,T,I,R,U,Z,Y,he,ce;for(n in i=RD.encode(this.generateCmap(),"unicode"),a=this.glyphsFor(e),U={0:0},ce=i.charMap)U[(g=ce[n]).old]=g.new;for(Z in R=i.maxGlyphID,a)Z in U||(U[Z]=R++);return T=function(pe){var be,Te;for(be in Te={},pe)Te[pe[be]]=be;return Te}(U),I=Object.keys(T).sort(function(pe,be){return pe-be}),Y=function(){var pe,be,Te;for(Te=[],pe=0,be=I.length;pe<be;pe++)s=I[pe],Te.push(T[s]);return Te}(),o=this.font.glyf.encode(a,Y,U),y=this.font.loca.encode(o.offsets,Y),he={cmap:this.font.cmap.raw(),glyf:o.table,loca:y,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(t)},this.font.os2.exists&&(he["OS/2"]=this.font.os2.raw()),this.font.directory.encode(he)},r}();Gi.API.PDFObject=function(){var r;function e(){}return r=function(t,i){return(Array(i+1).join("0")+t).slice(-i)},e.convert=function(t){var i,n,o,a;if(Array.isArray(t))return"["+function(){var s,g,y;for(y=[],s=0,g=t.length;s<g;s++)i=t[s],y.push(e.convert(i));return y}().join(" ")+"]";if(typeof t=="string")return"/"+t;if(t!=null&&t.isString)return"("+t+")";if(t instanceof Date)return"(D:"+r(t.getUTCFullYear(),4)+r(t.getUTCMonth(),2)+r(t.getUTCDate(),2)+r(t.getUTCHours(),2)+r(t.getUTCMinutes(),2)+r(t.getUTCSeconds(),2)+"Z)";if({}.toString.call(t)==="[object Object]"){for(n in o=["<<"],t)a=t[n],o.push("/"+n+" "+e.convert(a));return o.push(">>"),o.join(`
`)}return""+t},e}(),function(r){var e={};function t(i){if(e[i])return e[i].exports;var n=e[i]={i,l:!1,exports:{}};return r[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}t.m=r,t.c=e,t.d=function(i,n,o){t.o(i,n)||Object.defineProperty(i,n,{enumerable:!0,get:o})},t.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},t.t=function(i,n){if(1&n&&(i=t(i)),8&n||4&n&&typeof i=="object"&&i&&i.__esModule)return i;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:i}),2&n&&typeof i!="string")for(var a in i)t.d(o,a,(function(s){return i[s]}).bind(null,a));return o},t.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return t.d(n,"a",n),n},t.o=function(i,n){return Object.prototype.hasOwnProperty.call(i,n)},t.p="",t(t.s=0)}([function(r,e,t){r.exports=t(1)},function(r,e){function t(n,o){for(var a=0;a<o.length;a++){var s=o[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}var i=function(){function n(){(function(s,g){if(!(s instanceof g))throw new TypeError("Cannot call a class as a function")})(this,n),this.options={overlayBackgroundColor:"#666666",overlayOpacity:.6,spinnerIcon:"ball-circus",spinnerColor:"#000",spinnerSize:"3x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetY:0,offsetX:0,lockScroll:!1,containerID:null,spinnerZIndex:99999,overlayZIndex:99998},this.stylesheetBaseURL="https://cdn.jsdelivr.net/npm/load-awesome@1.1.0/css/",this.spinner=null,this.spinnerStylesheetURL=null,this.numberOfEmptyDivForSpinner={"ball-8bits":16,"ball-atom":4,"ball-beat":3,"ball-circus":5,"ball-climbing-dot":1,"ball-clip-rotate":1,"ball-clip-rotate-multiple":2,"ball-clip-rotate-pulse":2,"ball-elastic-dots":5,"ball-fall":3,"ball-fussion":4,"ball-grid-beat":9,"ball-grid-pulse":9,"ball-newton-cradle":4,"ball-pulse":3,"ball-pulse-rise":5,"ball-pulse-sync":3,"ball-rotate":1,"ball-running-dots":5,"ball-scale":1,"ball-scale-multiple":3,"ball-scale-pulse":2,"ball-scale-ripple":1,"ball-scale-ripple-multiple":3,"ball-spin":8,"ball-spin-clockwise":8,"ball-spin-clockwise-fade":8,"ball-spin-clockwise-fade-rotating":8,"ball-spin-fade":8,"ball-spin-fade-rotating":8,"ball-spin-rotate":2,"ball-square-clockwise-spin":8,"ball-square-spin":8,"ball-triangle-path":3,"ball-zig-zag":2,"ball-zig-zag-deflect":2,cog:1,"cube-transition":2,fire:3,"line-scale":5,"line-scale-party":5,"line-scale-pulse-out":5,"line-scale-pulse-out-rapid":5,"line-spin-clockwise-fade":8,"line-spin-clockwise-fade-rotating":8,"line-spin-fade":8,"line-spin-fade-rotating":8,pacman:6,"square-jelly-box":2,"square-loader":1,"square-spin":1,timer:1,"triangle-skew-spin":1}}var o,a;return o=n,(a=[{key:"show",value:function(s){this.setOptions(s),this.addSpinnerStylesheet(),this.generateSpinnerElement(),this.options.lockScroll&&(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden"),this.generateAndAddOverlayElement()}},{key:"hide",value:function(){this.options.lockScroll&&(document.body.style.overflow="",document.documentElement.style.overflow="");var s=document.getElementById("loading-overlay-stylesheet");s&&(s.disabled=!0,s.parentNode.removeChild(s),document.getElementById(this.options.overlayIDName).remove(),document.getElementById(this.options.spinnerIDName).remove())}},{key:"setOptions",value:function(s){if(s!==void 0)for(var g in s)this.options[g]=s[g]}},{key:"generateAndAddOverlayElement",value:function(){var s="50%";this.options.offsetX!==0&&(s="calc(50% + "+this.options.offsetX+")");var g="50%";if(this.options.offsetY!==0&&(g="calc(50% + "+this.options.offsetY+")"),this.options.containerID&&document.body.contains(document.getElementById(this.options.containerID))){var y='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: absolute; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,'; z-index: 50; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: absolute; top: ').concat(g,"; left: ").concat(s,'; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: 9999;">').concat(this.spinner,"</div>"),T=document.getElementById(this.options.containerID);return T.style.position="relative",void T.insertAdjacentHTML("beforeend",y)}var I='<div id="'.concat(this.options.overlayIDName,'" style="display: block !important; position: fixed; top: 0; left: 0; overflow: auto; opacity: ').concat(this.options.overlayOpacity,"; background: ").concat(this.options.overlayBackgroundColor,"; z-index: ").concat(this.options.overlayZIndex,'; width: 100%; height: 100%;"></div><div id="').concat(this.options.spinnerIDName,'" style="display: block !important; position: fixed; top: ').concat(g,"; left: ").concat(s,"; -webkit-transform: translate(-50%); -ms-transform: translate(-50%); transform: translate(-50%); z-index: ").concat(this.options.spinnerZIndex,';">').concat(this.spinner,"</div>");document.body.insertAdjacentHTML("beforeend",I)}},{key:"generateSpinnerElement",value:function(){var s=this,g=Object.keys(this.numberOfEmptyDivForSpinner).find(function(T){return T===s.options.spinnerIcon}),y=this.generateEmptyDivElement(this.numberOfEmptyDivForSpinner[g]);this.spinner='<div style="color: '.concat(this.options.spinnerColor,'" class="la-').concat(this.options.spinnerIcon," la-").concat(this.options.spinnerSize,'">').concat(y,"</div>")}},{key:"addSpinnerStylesheet",value:function(){this.setSpinnerStylesheetURL();var s=document.createElement("link");s.setAttribute("id","loading-overlay-stylesheet"),s.setAttribute("rel","stylesheet"),s.setAttribute("type","text/css"),s.setAttribute("href",this.spinnerStylesheetURL),document.getElementsByTagName("head")[0].appendChild(s)}},{key:"setSpinnerStylesheetURL",value:function(){this.spinnerStylesheetURL=this.stylesheetBaseURL+this.options.spinnerIcon+".min.css"}},{key:"generateEmptyDivElement",value:function(s){for(var g="",y=1;y<=s;y++)g+="<div></div>";return g}}])&&t(o.prototype,a),n}();window.JsLoadingOverlay=new i,r.exports=JsLoadingOverlay}]);const Td={JPEG:"jpg",PNG:"png",PDF:"pdf",SVG:"svg"},e0={in:"in",mm:"mm"},Qg={A2:[594,420],A3:[420,297],A4:[297,210],A5:[210,148],A6:[148,105],B2:[707,500],B3:[500,353],B4:[353,250],B5:[250,176],B6:[176,125]},t0={Landscape:"landscape",Portrait:"portrait"},sE={72:72,96:96,200:200,300:300,400:400};let jne=class{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qg.A4,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:300,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Td.PNG.toString(),o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:e0.mm,a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"map";Ms(this,"map"),Ms(this,"width"),Ms(this,"height"),Ms(this,"dpi"),Ms(this,"format"),Ms(this,"unit"),Ms(this,"fileName"),this.map=e,this.width=t[0],this.height=t[1],this.dpi=i,this.format=n,this.unit=o,this.fileName=a}generate(){const e=this;JsLoadingOverlay.show({overlayBackgroundColor:"#5D5959",overlayOpacity:"0.6",spinnerIcon:"ball-spin",spinnerColor:"#2400FD",spinnerSize:"2x",overlayIDName:"overlay",spinnerIDName:"spinner",offsetX:0,offsetY:0,containerID:null,lockScroll:!1,overlayZIndex:9998,spinnerZIndex:9999});const t=window.devicePixelRatio;Object.defineProperty(window,"devicePixelRatio",{get(){return e.dpi/96}});const i=document.createElement("div");i.className="hidden-map",document.body.appendChild(i);const n=document.createElement("div");n.style.width=this.toPixels(this.width),n.style.height=this.toPixels(this.height),i.appendChild(n);const o=this.map.getStyle();if(o&&o.sources){const s=o.sources;Object.keys(s).forEach(g=>{const y=s[g];Object.keys(y).forEach(T=>{y[T]||delete y[T]})})}const a=new Gie.Map({container:n,style:o,center:this.map.getCenter(),zoom:this.map.getZoom(),bearing:this.map.getBearing(),pitch:this.map.getPitch(),interactive:!1,preserveDrawingBuffer:!0,fadeDuration:0,attributionControl:!1,transformRequest:this.map._requestManager._transformRequestFn});a.once("idle",()=>{var s;const g=a.getCanvas(),y=`${this.fileName}.${e.format}`;switch(e.format){case Td.PNG:e.toPNG(g,y);break;case Td.JPEG:e.toJPEG(g,y);break;case Td.PDF:e.toPDF(a,y);break;case Td.SVG:e.toSVG(g,y);break;default:console.error(`Invalid file format: ${e.format}`);break}a.remove(),(s=i.parentNode)==null||s.removeChild(i),Object.defineProperty(window,"devicePixelRatio",{get(){return t}}),i.remove(),JsLoadingOverlay.hide()})}toPNG(e,t){const i=document.createElement("a");i.href=e.toDataURL(),i.download=t,i.click(),i.remove()}toJPEG(e,t){const i=e.toDataURL("image/jpeg",.85);if(e.msToBlob){const n=this.toBlob(i);window.navigator.msSaveBlob(n,t)}else{const n=document.createElement("a");n.href=i,n.download=t,n.click(),n.remove()}}toPDF(e,t){const i=e.getCanvas(),n=new Gi({orientation:this.width>this.height?"l":"p",unit:this.unit,compress:!0,format:[this.width,this.height]});n.addImage(i.toDataURL("image/png"),"png",0,0,this.width,this.height,void 0,"FAST");const{lng:o,lat:a}=e.getCenter();n.setProperties({title:e.getStyle().name,subject:`center: [${o}, ${a}], zoom: ${e.getZoom()}`,creator:"Mapbox GL Export Plugin",author:"(c)Mapbox, (c)OpenStreetMap"}),n.save(t)}toSVG(e,t){const i=e.toDataURL("image/png"),n=Number(this.toPixels(this.width,this.dpi).replace("px","")),o=Number(this.toPixels(this.height,this.dpi).replace("px","")),a=`
    <svg xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" 
      version="1.1" 
      width="${n}" 
      height="${o}" 
      viewBox="0 0 ${n} ${o}" 
      xml:space="preserve">
        <image style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-dashoffset: 0; stroke-linejoin: miter; stroke-miterlimit: 4; fill: rgb(0,0,0); fill-rule: nonzero; opacity: 1;"  
      xlink:href="${i}" width="${n}" height="${o}"></image>
    </svg>`,s=document.createElement("a");s.href=`data:application/xml,${encodeURIComponent(a)}`,s.download=t,s.click(),s.remove()}toPixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===e0.mm&&(t/=25.4),`${t*e}px`}toBlob(e){const t=atob(e.replace(/^.*,/,"")),i=new Uint8Array(t.length);for(let n=0;n<t.length;n+=1)i[n]=t.charCodeAt(n);return new Blob([i.buffer],{type:"image/png"})}},qne=class{constructor(e){Ms(this,"map"),Ms(this,"width"),Ms(this,"height"),Ms(this,"unit"),Ms(this,"svgCanvas"),Ms(this,"svgPath");var t,i,n;if(this.map=e,this.map===void 0)return;this.mapResize=this.mapResize.bind(this),this.map.on("resize",this.mapResize);const o=(t=this.map)==null?void 0:t.getCanvas().clientWidth,a=(i=this.map)==null?void 0:i.getCanvas().clientHeight,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.style.position="absolute",s.style.top="0px",s.style.left="0px",s.setAttribute("width",`${o}px`),s.setAttribute("height",`${a}px`);const g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("style","fill:#888888;stroke-width:0"),g.setAttribute("fill-opacity","0.5"),s.append(g),(n=this.map)==null||n.getCanvasContainer().appendChild(s),this.svgCanvas=s,this.svgPath=g}mapResize(){this.generateCutOut()}updateArea(e,t){this.width=e,this.height=t,this.unit=e0.mm,this.generateCutOut()}generateCutOut(){var e,t;if(this.map===void 0||this.svgCanvas===void 0||this.svgPath===void 0)return;const i=this.toPixels(this.width),n=this.toPixels(this.height),o=(e=this.map)==null?void 0:e.getCanvas().clientWidth,a=(t=this.map)==null?void 0:t.getCanvas().clientHeight,s=o/2-i/2,g=s+i,y=a/2-n/2,T=y+n;this.svgCanvas.setAttribute("width",`${o}px`),this.svgCanvas.setAttribute("height",`${a}px`),this.svgPath.setAttribute("d",`M 0 0 L ${o} 0 L ${o} ${a} L 0 ${a} M ${s} ${y} L ${s} ${T} L ${g} ${T} L ${g} ${y}`)}destroy(){this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map=void 0)}toPixels(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:96;return this.unit===e0.mm&&(t/=25.4),t*e}};const OD={PageSize:"Page Size",PageOrientation:"Page Orientation",Format:"Format",DPI:"DPI",Generate:"Generate"},$ne={PageSize:"Taille de page",PageOrientation:"Orientation de la page",Format:"Format",DPI:"DPI",Generate:"Gnrer"},Kne={PageSize:"Sivukoko",PageOrientation:"Sivun suunta",Format:"Muoto",DPI:"DPI",Generate:"Generoi"},Wne={PageSize:"Papierformat",PageOrientation:"Papierausrichtung",Format:"Dateiformat",DPI:"Druckauflsung",Generate:"Erstellen"},Xne={PageSize:"Sidstorlek",PageOrientation:"Sidorientering",Format:"Format",DPI:"DPI",Generate:"Generera"},Zne={PageSize:"Tamao de pgina",PageOrientation:"Orientacin de pgina",Format:"Formato",DPI:"DPI",Generate:"Generar"},Jne={PageSize:"Kch thc trang",PageOrientation:"Loi trang",Format:"nh dng",DPI:"Mt  im nh (DPI)",Generate:"To"},Yne={PageSize:" ",PageOrientation:" ",Format:"",DPI:"DPI",Generate:""},ese={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:""},tse={PageSize:"",PageOrientation:"",Format:"",DPI:"",Generate:""},rse={PageSize:"",PageOrientation:"",Format:"",DPI:"DPI",Generate:""};let ise=class{constructor(e){Ms(this,"controlContainer"),Ms(this,"exportContainer"),Ms(this,"crosshair"),Ms(this,"printableArea"),Ms(this,"map"),Ms(this,"exportButton"),Ms(this,"options",{PageSize:Qg.A4,PageOrientation:t0.Landscape,Format:Td.PDF,DPI:sE[300],Crosshair:!1,PrintableArea:!1,Local:"en",AllowedSizes:Object.keys(Qg),Filename:"map"}),e&&(this.options=Object.assign(this.options,e)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}getTranslation(){switch(this.options.Local){case"de":return Wne;case"en":return OD;case"fr":return $ne;case"fi":return Kne;case"sv":return Xne;case"es":return Zne;case"vi":return Jne;case"uk":return Yne;case"zhHans":return ese;case"zhHant":return tse;case"ja":return rse;default:return OD}}onAdd(e){var t;this.map=e,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.exportContainer=document.createElement("div"),this.exportContainer.classList.add("maplibregl-export-list"),this.exportButton=document.createElement("button"),this.exportButton.classList.add("maplibregl-ctrl-icon"),this.exportButton.classList.add("maplibregl-export-control"),this.exportButton.type="button",this.exportButton.addEventListener("click",()=>{this.exportButton.style.display="none",this.exportContainer.style.display="block",this.toggleCrosshair(!0),this.togglePrintableArea(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.exportButton),this.controlContainer.appendChild(this.exportContainer);const i=document.createElement("TABLE");i.className="print-table";const n={};(t=this.options.AllowedSizes)==null||t.forEach(T=>{Qg[T]&&(n[T]=Qg[T])});const o=this.createSelection(n,this.getTranslation().PageSize,"page-size",this.options.PageSize,(T,I)=>JSON.stringify(T[I]));i.appendChild(o);const a=this.createSelection(t0,this.getTranslation().PageOrientation,"page-orientation",this.options.PageOrientation,(T,I)=>T[I]);i.appendChild(a);const s=this.createSelection(Td,this.getTranslation().Format,"format-type",this.options.Format,(T,I)=>T[I]);i.appendChild(s);const g=this.createSelection(sE,this.getTranslation().DPI,"dpi-type",this.options.DPI,(T,I)=>T[I]);i.appendChild(g),this.exportContainer.appendChild(i);const y=document.createElement("button");return y.type="button",y.textContent=this.getTranslation().Generate,y.classList.add("generate-button"),y.addEventListener("click",()=>{const T=document.getElementById("mapbox-gl-export-page-size"),I=document.getElementById("mapbox-gl-export-page-orientation"),R=document.getElementById("mapbox-gl-export-format-type"),U=document.getElementById("mapbox-gl-export-dpi-type"),Z=I.value;let Y=JSON.parse(T.value);Z===t0.Portrait&&(Y=Y.reverse()),new jne(e,Y,Number(U.value),R.value,e0.mm,this.options.Filename).generate()}),this.exportContainer.appendChild(y),this.controlContainer}createSelection(e,t,i,n,o){const a=document.createElement("label");a.textContent=t;const s=document.createElement("select");s.setAttribute("id",`mapbox-gl-export-${i}`),s.style.width="100%",Object.keys(e).forEach(I=>{const R=document.createElement("option");R.setAttribute("value",o(e,I)),R.appendChild(document.createTextNode(I)),R.setAttribute("name",i),n===e[I]&&(R.selected=!0),s.appendChild(R)}),s.addEventListener("change",()=>{this.updatePrintableArea()});const g=document.createElement("TR"),y=document.createElement("TD"),T=document.createElement("TD");return y.appendChild(a),T.appendChild(s),g.appendChild(y),g.appendChild(T),g}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.exportButton||(this.exportButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.map=void 0)}onDocumentClick(e){this.controlContainer&&!this.controlContainer.contains(e.target)&&this.exportContainer&&this.exportButton&&(this.exportContainer.style.display="none",this.exportButton.style.display="block",this.toggleCrosshair(!1),this.togglePrintableArea(!1))}toggleCrosshair(e){this.options.Crosshair===!0&&(e===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new $ie(this.map),this.crosshair.create()))}togglePrintableArea(e){this.options.PrintableArea===!0&&(e===!1?this.printableArea!==void 0&&(this.printableArea.destroy(),this.printableArea=void 0):(this.printableArea=new qne(this.map),this.updatePrintableArea()))}updatePrintableArea(){if(this.printableArea===void 0)return;const e=document.getElementById("mapbox-gl-export-page-size"),t=document.getElementById("mapbox-gl-export-page-orientation").value;let i=JSON.parse(e.value);t===t0.Portrait&&(i=i.reverse()),this.printableArea.updateArea(i[0],i[1])}};var UD=sse,nse=Object.prototype.hasOwnProperty;function sse(){for(var r={},e=0;e<arguments.length;e++){var t=arguments[e];for(var i in t)nse.call(t,i)&&(r[i]=t[i])}return r}var ND={exports:{}};(function(r,e){(function(){var t={};r.exports=t,t.simpleFilter=function(i,n){return n.filter(function(o){return t.test(i,o)})},t.test=function(i,n){return t.match(i,n)!==null},t.match=function(i,n,o){o=o||{};var a=0,s=[],g=n.length,y=0,T=0,I=o.pre||"",R=o.post||"",U=o.caseSensitive&&n||n.toLowerCase(),Z;i=o.caseSensitive&&i||i.toLowerCase();for(var Y=0;Y<g;Y++)Z=n[Y],U[Y]===i[a]?(Z=I+Z+R,a+=1,T+=1+T):T=0,y+=T,s[s.length]=Z;return a===i.length?(y=U===i?1/0:y,{rendered:s.join(""),score:y}):null},t.filter=function(i,n,o){return!n||n.length===0?[]:typeof i!="string"?n:(o=o||{},n.reduce(function(a,s,g,y){var T=s;o.extract&&(T=o.extract(s));var I=t.match(i,T,o);return I!=null&&(a[a.length]={string:I.rendered,score:I.score,index:g,original:s}),a},[]).sort(function(a,s){var g=s.score-a.score;return g||a.index-s.index}))}})()})(ND);var ose=ND.exports,Nc=function(r){return this.component=r,this.items=[],this.active=r.options.noInitialSelection?-1:0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,r.el.parentNode.insertBefore(this.wrapper,r.el.nextSibling),this};Nc.prototype.show=function(){this.element.style.display="block"},Nc.prototype.hide=function(){this.element.style.display="none"},Nc.prototype.add=function(r){this.items.push(r)},Nc.prototype.clear=function(){this.items=[],this.active=this.component.options.noInitialSelection?-1:0},Nc.prototype.isEmpty=function(){return!this.items.length},Nc.prototype.isVisible=function(){return this.element.style.display==="block"},Nc.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var r=0;r<this.items.length;r++)this.drawItem(this.items[r],this.active===r);this.show()},Nc.prototype.drawItem=function(r,e){var t=document.createElement("li"),i=document.createElement("a");e&&(t.className+=" active"),i.innerHTML=r.string,t.appendChild(i),this.element.appendChild(t),t.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),t.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,r)}).bind(this))},Nc.prototype.handleMouseUp=function(r){this.selectingListItem=!1,this.component.value(r.original),this.clear(),this.draw()},Nc.prototype.move=function(r){this.active=r,this.draw()},Nc.prototype.previous=function(){this.move(this.active<=0?this.items.length-1:this.active-1)},Nc.prototype.next=function(){this.move(this.active>=this.items.length-1?0:this.active+1)},Nc.prototype.drawError=function(r){var e=document.createElement("li");e.innerHTML=r,this.element.appendChild(e),this.show()};var ase=Nc,lse=UD,cse=ose,use=ase,Nl=function(r,e,t){return t=t||{},this.options=lse({minLength:2,limit:5,filter:!0,hideOnBlur:!0,noInitialSelection:!0},t),this.el=r,this.data=e||[],this.list=new use(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(i){this.handleKeyUp(i.keyCode,i)}).bind(this),!1),this.el.addEventListener("keydown",(function(i){this.handleKeyDown(i)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(i){this.handlePaste(i)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Nl.prototype.handleKeyUp=function(r,e){if(!(r===40||r===38||r===27||r===9)){if(r===13){this.list.items[this.list.active]&&(this.list.handleMouseUp(this.list.items[this.list.active]),e.stopPropagation());return}this.handleInputChange(this.el.value)}},Nl.prototype.handleKeyDown=function(r){switch(r.keyCode){case 13:this.list.active>=0&&(this.list.selectingListItem=!0);break;case 9:this.list.isEmpty()||(this.list.isVisible()&&r.preventDefault(),this.value(this.list.active>=0?this.list.items[this.list.active].original:null),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},Nl.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},Nl.prototype.handlePaste=function(r){if(r.clipboardData)this.handleInputChange(r.clipboardData.getData("Text"));else{var e=this;setTimeout(function(){e.handleInputChange(r.target.value)},100)}},Nl.prototype.handleInputChange=function(r){if(this.query=this.normalize(r),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(e){for(var t=0;t<e.length&&(this.list.add(e[t]),t!==this.options.limit-1);t++);this.list.draw()}).bind(this))},Nl.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},Nl.prototype.update=function(r){this.data=r,this.handleKeyUp()},Nl.prototype.clear=function(){this.data=[],this.list.clear()},Nl.prototype.normalize=function(r){return r=r.toLowerCase(),r},Nl.prototype.match=function(r,e){return r.indexOf(e)>-1},Nl.prototype.value=function(r){if(this.selected=r,this.el.value=this.getItemValue(r||{place_name:this.query}),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")},Nl.prototype.getCandidates=function(r){var e={pre:"<strong>",post:"</strong>",extract:(function(i){return this.getItemValue(i)}).bind(this)},t;this.options.filter?(t=cse.filter(this.query,this.data,e),t=t.map((function(i){return{original:i.original,string:this.render(i.original,i.string)}}).bind(this))):t=this.data.map((function(i){var n=this.render(i);return{original:i,string:n}}).bind(this)),r(t)},Nl.prototype.getItemValue=function(r){return r},Nl.prototype.render=function(r,e){if(e)return e;for(var t=r.original?this.getItemValue(r.original):this.getItemValue(r),i=this.normalize(t),n=i.lastIndexOf(this.query);n>-1;){var o=n+this.query.length;t=t.slice(0,n)+"<strong>"+t.slice(n,o)+"</strong>"+t.slice(o),n=i.slice(0,n).lastIndexOf(this.query)}return t},Nl.prototype.renderError=function(r){this.list.drawError(r)};var hse=Nl,zD=hse,Ase=zD;typeof window<"u"&&(window.Suggestions=zD);var dse="Expected a function",QD=NaN,fse="[object Symbol]",pse=/^\s+|\s+$/g,gse=/^[-+]0x[0-9a-f]+$/i,mse=/^0b[01]+$/i,yse=/^0o[0-7]+$/i,_se=parseInt,vse=typeof mf=="object"&&mf&&mf.Object===Object&&mf,bse=typeof self=="object"&&self&&self.Object===Object&&self,xse=vse||bse||Function("return this")(),wse=Object.prototype,Bse=wse.toString,Cse=Math.max,Ese=Math.min,oE=function(){return xse.Date.now()};function Sse(r,e,t){var i,n,o,a,s,g,y=0,T=!1,I=!1,R=!0;if(typeof r!="function")throw new TypeError(dse);e=VD(e)||0,aE(t)&&(T=!!t.leading,I="maxWait"in t,o=I?Cse(VD(t.maxWait)||0,e):o,R="trailing"in t?!!t.trailing:R);function U(je){var We=i,Ne=n;return i=n=void 0,y=je,a=r.apply(Ne,We),a}function Z(je){return y=je,s=setTimeout(ce,e),T?U(je):a}function Y(je){var We=je-g,Ne=je-y,at=e-We;return I?Ese(at,o-Ne):at}function he(je){var We=je-g,Ne=je-y;return g===void 0||We>=e||We<0||I&&Ne>=o}function ce(){var je=oE();if(he(je))return pe(je);s=setTimeout(ce,Y(je))}function pe(je){return s=void 0,R&&i?U(je):(i=n=void 0,a)}function be(){s!==void 0&&clearTimeout(s),y=0,i=g=n=s=void 0}function Te(){return s===void 0?a:pe(oE())}function qe(){var je=oE(),We=he(je);if(i=arguments,n=this,g=je,We){if(s===void 0)return Z(g);if(I)return s=setTimeout(ce,e),U(g)}return s===void 0&&(s=setTimeout(ce,e)),a}return qe.cancel=be,qe.flush=Te,qe}function aE(r){var e=typeof r;return!!r&&(e=="object"||e=="function")}function Tse(r){return!!r&&typeof r=="object"}function Ise(r){return typeof r=="symbol"||Tse(r)&&Bse.call(r)==fse}function VD(r){if(typeof r=="number")return r;if(Ise(r))return QD;if(aE(r)){var e=typeof r.valueOf=="function"?r.valueOf():r;r=aE(e)?e+"":e}if(typeof r!="string")return r===0?r:+r;r=r.replace(pse,"");var t=mse.test(r);return t||yse.test(r)?_se(r.slice(2),t?2:8):gse.test(r)?QD:+r}var Lse=Sse,lE={exports:{}},Vg=typeof Reflect=="object"?Reflect:null,HD=Vg&&typeof Vg.apply=="function"?Vg.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},Cv;Vg&&typeof Vg.ownKeys=="function"?Cv=Vg.ownKeys:Object.getOwnPropertySymbols?Cv=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Cv=function(e){return Object.getOwnPropertyNames(e)};function Mse(r){console&&console.warn&&console.warn(r)}var GD=Number.isNaN||function(e){return e!==e};function Bs(){Bs.init.call(this)}lE.exports=Bs,lE.exports.once=Rse,Bs.EventEmitter=Bs,Bs.prototype._events=void 0,Bs.prototype._eventsCount=0,Bs.prototype._maxListeners=void 0;var jD=10;function Ev(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(Bs,"defaultMaxListeners",{enumerable:!0,get:function(){return jD},set:function(r){if(typeof r!="number"||r<0||GD(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");jD=r}}),Bs.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Bs.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||GD(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function qD(r){return r._maxListeners===void 0?Bs.defaultMaxListeners:r._maxListeners}Bs.prototype.getMaxListeners=function(){return qD(this)},Bs.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n=e==="error",o=this._events;if(o!==void 0)n=n&&o.error===void 0;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var g=o[e];if(g===void 0)return!1;if(typeof g=="function")HD(g,this,t);else for(var y=g.length,T=ZD(g,y),i=0;i<y;++i)HD(T[i],this,t);return!0};function $D(r,e,t,i){var n,o,a;if(Ev(t),o=r._events,o===void 0?(o=r._events=Object.create(null),r._eventsCount=0):(o.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),o=r._events),a=o[e]),a===void 0)a=o[e]=t,++r._eventsCount;else if(typeof a=="function"?a=o[e]=i?[t,a]:[a,t]:i?a.unshift(t):a.push(t),n=qD(r),n>0&&a.length>n&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=r,s.type=e,s.count=a.length,Mse(s)}return r}Bs.prototype.addListener=function(e,t){return $D(this,e,t,!1)},Bs.prototype.on=Bs.prototype.addListener,Bs.prototype.prependListener=function(e,t){return $D(this,e,t,!0)};function Pse(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function KD(r,e,t){var i={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},n=Pse.bind(i);return n.listener=t,i.wrapFn=n,n}Bs.prototype.once=function(e,t){return Ev(t),this.on(e,KD(this,e,t)),this},Bs.prototype.prependOnceListener=function(e,t){return Ev(t),this.prependListener(e,KD(this,e,t)),this},Bs.prototype.removeListener=function(e,t){var i,n,o,a,s;if(Ev(t),n=this._events,n===void 0)return this;if(i=n[e],i===void 0)return this;if(i===t||i.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if(typeof i!="function"){for(o=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){s=i[a].listener,o=a;break}if(o<0)return this;o===0?i.shift():Fse(i,o),i.length===1&&(n[e]=i[0]),n.removeListener!==void 0&&this.emit("removeListener",e,s||t)}return this},Bs.prototype.off=Bs.prototype.removeListener,Bs.prototype.removeAllListeners=function(e){var t,i,n;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var o=Object.keys(i),a;for(n=0;n<o.length;++n)a=o[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=i[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this};function WD(r,e,t){var i=r._events;if(i===void 0)return[];var n=i[e];return n===void 0?[]:typeof n=="function"?t?[n.listener||n]:[n]:t?Dse(n):ZD(n,n.length)}Bs.prototype.listeners=function(e){return WD(this,e,!0)},Bs.prototype.rawListeners=function(e){return WD(this,e,!1)},Bs.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):XD.call(r,e)},Bs.prototype.listenerCount=XD;function XD(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}Bs.prototype.eventNames=function(){return this._eventsCount>0?Cv(this._events):[]};function ZD(r,e){for(var t=new Array(e),i=0;i<e;++i)t[i]=r[i];return t}function Fse(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function Dse(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function Rse(r,e){return new Promise(function(t,i){function n(a){r.removeListener(e,o),i(a)}function o(){typeof r.removeListener=="function"&&r.removeListener("error",n),t([].slice.call(arguments))}JD(r,e,o,{once:!0}),e!=="error"&&kse(r,n,{once:!0})})}function kse(r,e,t){typeof r.on=="function"&&JD(r,"error",e,t)}function JD(r,e,t,i){if(typeof r.on=="function")i.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function n(o){i.once&&r.removeEventListener(e,n),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}var YD=lE.exports,Ose={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}},Use={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},Nse={placeholder:Use},eR={exports:{}};(function(r){(function(e,t,i){r.exports?r.exports=i():e[t]=i()})(mf,"subtag",function(){var e="",t=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function i(g){return g.match(t)||[]}function n(g){return i(g).filter(function(y,T){return y&&T})}function o(g){return g=i(g),{language:g[1]||e,extlang:g[2]||e,script:g[3]||e,region:g[4]||e}}function a(g,y,T){Object.defineProperty(g,y,{value:T,enumerable:!0})}function s(g,y,T){function I(R){return i(R)[g]||e}a(I,"pattern",y),a(o,T,I)}return s(1,/^[a-zA-Z]{2,3}$/,"language"),s(2,/^[a-zA-Z]{3}$/,"extlang"),s(3,/^[a-zA-Z]{4}$/,"script"),s(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),a(o,"split",n),o})})(eR);var zse=eR.exports,Qse=Ase,Vse=Lse,hu=UD,Hse=YD.EventEmitter,tR=Ose,Gse=Nse,jse=zse;function rR(r,e){this._eventEmitter=new Hse,this.options=hu({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geocoderApi=r}rR.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,showResultsWhileTyping:!1,minLength:2,reverseGeocode:!1,limit:5,enableEventLogging:!0,marker:!0,popup:!1,maplibregl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(r){return r.text!==void 0?r.text:r.place_name},render:function(r){if(r.geometry){var s=r.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--result maplibregl-ctrl-geocoder--result"><svg class="mapboxgl-ctrl-geocoder--result-icon maplibre-ctrl-geocoder--result-icon" viewBox="0 0 24 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.36571 0 0 5.38676 0 12.0471C0 21.0824 12 32 12 32C12 32 24 21.0824 24 12.0471C24 5.38676 18.6343 0 12 0ZM12 16.3496C9.63428 16.3496 7.71429 14.4221 7.71429 12.0471C7.71429 9.67207 9.63428 7.74454 12 7.74454C14.3657 7.74454 16.2857 9.67207 16.2857 12.0471C16.2857 14.4221 14.3657 16.3496 12 16.3496Z" fill="#687078"/></svg><div><div class="mapboxgl-ctrl-geocoder--result-title maplibregl-ctrl-geocoder--result-title">'+s[0]+'</div><div class="mapboxgl-ctrl-geocoder--result-address maplibregl-ctrl-geocoder--result-address">'+s.splice(1,s.length).join(",")+"</div></div></div>"}else{var e=r.text,t=e.toLowerCase().indexOf(this.query.toLowerCase()),i=this.query.length,n=e.substring(0,t),o=e.substring(t,t+i),a=e.substring(t+i);return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibregl-ctrl-geocoder--suggestion"><svg class="mapboxgl-ctrl-geocoder--suggestion-icon maplibre-ctrl-geocoder--suggestion-icon" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22.8702 20.1258H21.4248L20.9125 19.6318C22.7055 17.546 23.785 14.8382 23.785 11.8925C23.785 5.32419 18.4608 0 11.8925 0C5.32419 0 0 5.32419 0 11.8925C0 18.4608 5.32419 23.785 11.8925 23.785C14.8382 23.785 17.546 22.7055 19.6318 20.9125L20.1258 21.4248V22.8702L29.2739 32L32 29.2739L22.8702 20.1258ZM11.8925 20.1258C7.33676 20.1258 3.65923 16.4483 3.65923 11.8925C3.65923 7.33676 7.33676 3.65923 11.8925 3.65923C16.4483 3.65923 20.1258 7.33676 20.1258 11.8925C20.1258 16.4483 16.4483 20.1258 11.8925 20.1258Z" fill="#687078"/></svg><div class="mapboxgl-ctrl-geocoder--suggestion-info maplibregl-ctrl-geocoder--suggestion-info"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibregl-ctrl-geocoder--suggestion-title">'+n+'<span class="mapboxgl-ctrl-geocoder--suggestion-match maplibregl-ctrl-geocoder--suggestion-match">'+o+"</span>"+a+"</div></div></div>"}},popupRender:function(r){var e=r.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion maplibre-ctrl-geocoder--suggestion popup-suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title maplibre-ctrl-geocoder--suggestion-title popup-suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address maplibre-ctrl-geocoder--suggestion-address popup-suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"},showResultMarkers:!0,debounceSearch:200},addTo:function(r){function e(i,n){if(!document.body.contains(n))throw new Error("Element provided to #addTo() exists, but is not in the DOM");var o=i.onAdd();n.appendChild(o)}if(r._controlContainer)r.addControl(this);else if(r instanceof HTMLElement)e(this,r);else if(typeof r=="string"){var t=document.querySelectorAll(r);if(t.length===0)throw new Error("Element ",r,"not found.");if(t.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,t[0])}else throw new Error("Error: addTo must be a maplibre-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(r){if(r&&typeof r!="string"&&(this._map=r),this.setLanguage(),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl";var t=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input maplibregl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",Vse(this._onKeyDown,this.options.debounceSearch)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton);var i=document.createElement("div");i.classList.add("mapboxgl-ctrl-geocoder--pin-right","maplibregl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button maplibregl-ctrl-geocoder--button";var n=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(n),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),i.appendChild(this._clearEl),i.appendChild(this._loadingEl),e.appendChild(t),e.appendChild(this._inputEl),e.appendChild(i),this._typeahead=new Qse(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit,noInitialSelection:!0}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this.resultMarkers=[],this._handleMarker=this._handleMarker.bind(this),this._handleResultMarkers=this._handleResultMarkers.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._maplibregl=this.options.maplibregl,!this._maplibregl&&this.options.marker&&(console.error("No maplibregl detected in options. Map markers are disabled. Please set options.maplibregl."),this.options.marker=!1)),e},createIcon:function(r,e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+r+" maplibregl-ctrl-geocoder--icon maplibregl-ctrl-geocoder--icon-"+r),t.setAttribute("viewBox","0 0 18 18"),t.setAttribute("xml:space","preserve"),t.setAttribute("width",18),t.setAttribute("height",18),"innerHTML"in t)t.innerHTML=e;else{var i=document.createElement("div");i.innerHTML="<svg>"+e.valueOf().toString()+"</svg>";var n=i.firstChild,o=n.firstChild;t.appendChild(o)}return t},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(r){var e=(r.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(e)},_onKeyDown:function(r){var e=27,t=9;if(r.keyCode===e&&this.options.clearAndBlurOnEsc)return this._clear(r),this._inputEl.blur();var i=r.target&&r.target.shadowRoot?r.target.shadowRoot.activeElement:r.target,n=i?i.value:"";if(!n)return this.fresh=!0,r.keyCode!==t&&this.clear(r),this._clearEl.style.display="none";if(!(r.metaKey||[t,e,37,39,38,40].indexOf(r.keyCode)!==-1)){if(r.keyCode===13)if(!this.options.showResultsWhileTyping)this._typeahead.selected||this._geocode(i.value);else{this._typeahead.selected==null&&this.geocoderApi.getSuggestions?this._geocode(i.value,!0):this._typeahead.selected==null&&this.options.showResultMarkers&&this._fitBoundsForMarkers();return}i.value.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(i.value)}},_showButton:function(){this._inputEl.value.length>0&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(r){this.options.clearOnBlur&&this._clearOnBlur(r),this.options.collapsed&&this._collapse()},_onChange:function(){var r=this._typeahead.selected;if(r&&!r.geometry)r.placeId?this._geocode(r.placeId,!0,!0):this._geocode(r.text,!0);else if(r&&JSON.stringify(r)!==this.lastSelected){if(this._clearEl.style.display="none",this.options.flyTo){var e;if(this._removeResultMarkers(),r.properties&&tR[r.properties.short_code])e=hu({},this.options.flyTo),this._map&&this._map.fitBounds(tR[r.properties.short_code].bbox,e);else if(r.bbox){var t=r.bbox;e=hu({},this.options.flyTo),this._map&&this._map.fitBounds([[t[0],t[1]],[t[2],t[3]]],e)}else{var i={zoom:this.options.zoom};e=hu({},i,this.options.flyTo),r.center?e.center=r.center:r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(e.center=r.geometry.coordinates),this._map&&this._map.flyTo(e)}}this.options.marker&&this._maplibregl&&this._handleMarker(r),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(r),this._typeahead.selected=null,this._eventEmitter.emit("result",{result:r})}},_getConfigForRequest:function(){var r=["bbox","limit","proximity","countries","types","language","reverseMode"],e=this,t=r.reduce(function(i,n){return e.options[n]&&(["countries","types","language"].indexOf(n)>-1?i[n]=e.options[n].split(/[\s,]+/):i[n]=e.options[n],n==="proximity"&&e.options[n]&&typeof e.options[n].longitude=="number"&&typeof e.options[n].latitude=="number"&&(i[n]=[e.options[n].longitude,e.options[n].latitude])),i},{});return t},_geocode:function(r,e,t){this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:r}),this.inputString=r;var i=null,n=this._getConfigForRequest(),o;if(this.options.localGeocoderOnly)o=Promise.resolve();else if(this.options.reverseGeocode&&/(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(r)){var a=r.split(/[\s(,)?]+/).map(function(y){return parseFloat(y,10)}).reverse();n.types&&n.types[0],n=hu(n,{query:a,limit:1}),"proximity"in n&&delete n.proximity,o=this.geocoderApi.reverseGeocode(n)}else n=hu(n,{query:r}),this.geocoderApi.getSuggestions?e?this.geocoderApi.searchByPlaceId&&t?o=this.geocoderApi.searchByPlaceId(n):o=this.geocoderApi.forwardGeocode(n):o=this.geocoderApi.getSuggestions(n):o=this.geocoderApi.forwardGeocode(n);var s=[];this.options.localGeocoder&&(s=this.options.localGeocoder(r),s||(s=[]));var g=[];return o.catch((function(y){i=y}).bind(this)).then((function(y){this._loadingEl.style.display="none";var T={};return y?T=y:T={type:"FeatureCollection",features:[]},T.config=n,this.fresh&&(this.fresh=!1),T.features=T.features?s.concat(T.features):s,this.options.externalGeocoder?(g=this.options.externalGeocoder(r,T.features,n)||[],g.then(function(I){return T.features=T.features?I.concat(T.features):I,T},function(){return T})):T}).bind(this)).then((function(y){if(i)throw i;this.options.filter&&y.features.length&&(y.features=y.features.filter(this.options.filter));var T=[];y.suggestions?T=y.suggestions:y.place?T=[y.place]:T=y.features,T.length?(this._clearEl.style.display="block",this._typeahead.update(T),(!this.options.showResultsWhileTyping||e)&&this.options.showResultMarkers&&(y.features.length>0||y.place)&&this._fitBoundsForMarkers(),this._eventEmitter.emit("results",y)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",y))}).bind(this)).catch((function(y){this._loadingEl.style.display="none",s.length&&this.options.localGeocoder||g.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(s)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:s}),this._eventEmitter.emit("error",{error:y})}).bind(this)),o},_clear:function(r){r&&r.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this._removeResultMarkers(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(r){this._clear(r),this._inputEl.focus()},_clearOnBlur:function(r){var e=this;r.relatedTarget&&e._clear(r)},_onQueryResult:function(r){var e=r;if(e.features.length){var t=e.features[0];this._typeahead.selected=t,this._inputEl.value=t.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var r=this._map.getCenter().wrap();this.setProximity({longitude:r.lng,latitude:r.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed","maplibregl-ctrl-geocoder--collapsed")},query:function(r){return this._geocode(r).then(this._onQueryResult),this},_renderError:function(){var r="<div class='mapbox-gl-geocoder--error maplibre-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(r)},_renderNoResults:function(){var r="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results maplibre-gl-geocoder--error maplibre-gl-geocoder--no-results'>No results found</div>";this._renderMessage(r)},_renderMessage:function(r){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(r)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var r=this.options.language.split(",")[0],e=jse.language(r),t=Gse.placeholder[e];if(t)return t}return"Search"},_fitBoundsForMarkers:function(){if(!(this._typeahead.data.length<1)){var r=this._typeahead.data.filter(function(n){return typeof n!="string"}).slice(0,this.options.limit);if(this._clearEl.style.display="none",this.options.flyTo&&this._maplibregl&&this._map){var e={padding:100},t=hu({},e,this.options.flyTo),i=new this._maplibregl.LngLatBounds;r.forEach(function(n){i.extend(n.geometry.coordinates)}),this._map.fitBounds(i.toArray(),t)}return r.length>0&&this._maplibregl&&this._handleResultMarkers(r),this}},setInput:function(r){return this._inputEl.value=r,this._typeahead.selected=null,this._typeahead.clear(),r.length>=this.options.minLength&&this.options.showResultsWhileTyping&&this._geocode(r),this},setProximity:function(r){return this.options.proximity=r,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(r){return r&&typeof r=="function"&&(this._typeahead.render=r),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(r){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=r||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(r){return this.options.zoom=r,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(r){return this.options.flyTo=r,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(r){return this.placeholder=r||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(r){return this.options.bbox=r,this},getCountries:function(){return this.options.countries},setCountries:function(r){return this.options.countries=r,this},getTypes:function(){return this.options.types},setTypes:function(r){return this.options.types=r,this},getMinLength:function(){return this.options.minLength},setMinLength:function(r){return this.options.minLength=r,this._typeahead&&(this._typeahead.options.minLength=r),this},getLimit:function(){return this.options.limit},setLimit:function(r){return this.options.limit=r,this._typeahead&&(this._typeahead.options.limit=r),this},getFilter:function(){return this.options.filter},setFilter:function(r){return this.options.filter=r,this},setGeocoderApi:function(r){return this.geocoderApi=r,this},getGeocoderApi:function(){return this.geocoderApi},_handleMarker:function(r){if(this._map){this._removeMarker();var e={color:"#4668F2"},t=hu({},e,this.options.marker);this.mapMarker=new this._maplibregl.Marker(t);var i;if(this.options.popup){var n={},o=hu({},n,this.options.popup);i=new this._maplibregl.Popup(o).setHTML(this.options.popupRender(r))}return r.center?(this.mapMarker.setLngLat(r.center).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(i)):r.geometry&&r.geometry.type&&r.geometry.type==="Point"&&r.geometry.coordinates&&(this.mapMarker.setLngLat(r.geometry.coordinates).addTo(this._map),this.options.popup&&this.mapMarker.setPopup(i)),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},_handleResultMarkers:function(r){if(this._map){this._removeResultMarkers();var e={color:"#4668F2"},t=hu({},e,this.options.showResultMarkers);return r.forEach((function(i){if(this.options.showResultMarkers&&this.options.showResultMarkers.element){var n=this.options.showResultMarkers.element.cloneNode(!0);t=hu(t,{element:n})}var o=new this._maplibregl.Marker(hu({},t,{element:n})),a;if(this.options.popup){var s={},g=hu({},s,this.options.popup);a=new this._maplibregl.Popup(g).setHTML(this.options.popupRender(i))}i.center?(o.setLngLat(i.center).addTo(this._map),this.options.popup&&o.setPopup(a)):i.geometry&&i.geometry.type&&i.geometry.type==="Point"&&i.geometry.coordinates&&(o.setLngLat(i.geometry.coordinates).addTo(this._map),this.options.popup&&o.setPopup(a)),this.resultMarkers.push(o)}).bind(this)),this}},_removeResultMarkers:function(){this.resultMarkers&&this.resultMarkers.length>0&&(this.resultMarkers.forEach(function(r){r.remove()}),this.resultMarkers=[])},on:function(r,e){return this._eventEmitter.on(r,e),this},off:function(r,e){return this._eventEmitter.removeListener(r,e),this}};var qse=rR;const $se=Wm(qse);class Kse{constructor(e){this.options=e}onAdd(e){let t=this.options.defaultOptions;return this._map=e,this._img1=document.createElement("img"),this._img1.className="maplibregl-ctrl",this._img1.src=this.options.color?t.logoIcgcOptions.logoUrlColor:t.logoIcgcOptions.logoUrlWhite,this._img1.width=t.logoIcgcOptions.logoWidth,this._img1.title=t.logoIcgcOptions.logoTitle,this.link1=document.createElement("a"),this.link1.href=t.logoIcgcOptions.logoLink,this.link1.target="_blank",this.link1.appendChild(this._img1),this._container1=document.createElement("div"),this._container1.className="maplibregl-ctrl",this._container1.style.width=`${t.logoIcgcOptions.logoWidth}px`,this._container1.appendChild(this.link1),this._img2=document.createElement("img"),this._img2.className="maplibregl-ctrl",this._img2.src=this.options.color?t.logoGencatOptions.logoUrlColor:t.logoGencatOptions.logoUrlWhite,this._img2.width=t.logoGencatOptions.logoWidth,this._img2.title=t.logoGencatOptions.logoTitle,this.link2=document.createElement("a"),this.link2.href=t.logoGencatOptions.logoLink,this.link2.target="_blank",this.link2.appendChild(this._img2),this._container2=document.createElement("div"),this._container2.className="maplibregl-ctrl",this._container2.style.width=`${t.logoGencatOptions.logoWidth}px`,this._container2.appendChild(this.link2),this._mainContainer=document.createElement("div"),this._mainContainer.className="divLogos",this._mainContainer.style="display: flex",this._mainContainer.appendChild(this._container1),this._mainContainer.appendChild(this._container2),this._mainContainer}}var Hg=iR.prototype,cE="WGS 84";function iR(r){r!==void 0&&(cE=r),this.setEllipsoid(cE)}Hg.convertLatLngToUtm=function(r,e,t){var i;if(this.status)return"No ecclipsoid data associated with unknown datum: "+cE;if(!Number.isInteger(t))return"Precision is not integer number.";r=parseFloat(r),e=parseFloat(e);var n=e,o=this.toRadians(r),a=this.toRadians(n);n>=8&&n<=13&&r>54.5&&r<58||r>=56&&r<64&&n>=3&&n<12?i=32:(i=(n+180)/6+1,r>=72&&r<84&&(n>=0&&n<9?i=31:n>=9&&n<21?i=33:n>=21&&n<33?i=35:n>=33&&n<42&&(i=37))),i=parseInt(i);var s=(i-1)*6-180+3,g=this.toRadians(s),y=this.getUtmLetterDesignator(r),T=this.eccSquared/(1-this.eccSquared),I=this.a/Math.sqrt(1-this.eccSquared*Math.sin(o)*Math.sin(o)),R=Math.tan(o)*Math.tan(o),U=T*Math.cos(o)*Math.cos(o),Z=Math.cos(o)*(a-g),Y=this.a*((1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)*o-(3*this.eccSquared/8+3*this.eccSquared*this.eccSquared/32+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(2*o)+(15*this.eccSquared*this.eccSquared/256+45*this.eccSquared*this.eccSquared*this.eccSquared/1024)*Math.sin(4*o)-35*this.eccSquared*this.eccSquared*this.eccSquared/3072*Math.sin(6*o)),he=parseFloat(.9996*I*(Z+(1-R+U)*Z*Z*Z/6+(5-18*R+R*R+72*U-58*T)*Z*Z*Z*Z*Z/120)+5e5),ce=parseFloat(.9996*(Y+I*Math.tan(o)*(Z*Z/2+(5-R+9*U+4*U*U)*Z*Z*Z*Z/24+(61-58*R+R*R+600*U-330*T)*Z*Z*Z*Z*Z*Z/720)));return r<0&&(ce+=1e7),ce=nR(ce,t),he=nR(he,t),{Easting:he,Northing:ce,ZoneNumber:parseInt(i),ZoneLetter:y}},Hg.convertUtmToLatLng=function(r,e,t,i){var n=(1-Math.sqrt(1-this.eccSquared))/(1+Math.sqrt(1-this.eccSquared)),o=r-5e5,a=e,s=t,g=i;if(r===void 0)return"Please pass the UTMEasting!";if(e===void 0)return"Please pass the UTMNorthing!";if(t===void 0)return"Please pass the UTMZoneNumber!";if(i===void 0)return"Please pass the UTMZoneLetter!";["N","P","Q","R","S","T","U","V","W","X","Y","Z"].indexOf(g)!==-1||(a-=1e7);var y=(s-1)*6-180+3,T=this.eccSquared/(1-this.eccSquared),I=a/.9996,R=I/(this.a*(1-this.eccSquared/4-3*this.eccSquared*this.eccSquared/64-5*this.eccSquared*this.eccSquared*this.eccSquared/256)),U=R+(3*n/2-27*n*n*n/32)*Math.sin(2*R)+(21*n*n/16-55*n*n*n*n/32)*Math.sin(4*R)+151*n*n*n/96*Math.sin(6*R);this.toDegrees(U);var Z=this.a/Math.sqrt(1-this.eccSquared*Math.sin(U)*Math.sin(U)),Y=Math.tan(U)*Math.tan(U),he=T*Math.cos(U)*Math.cos(U),ce=this.a*(1-this.eccSquared)/Math.pow(1-this.eccSquared*Math.sin(U)*Math.sin(U),1.5),pe=o/(Z*.9996),be=U-Z*Math.tan(U)/ce*(pe*pe/2-(5+3*Y+10*he-4*he*he-9*T)*pe*pe*pe*pe/24+(61+90*Y+298*he+45*Y*Y-252*T-3*he*he)*pe*pe*pe*pe*pe*pe/720);be=this.toDegrees(be);var Te=(pe-(1+2*Y+he)*pe*pe*pe/6+(5-2*he+28*Y-3*he*he+8*T+24*Y*Y)*pe*pe*pe*pe*pe/120)/Math.cos(U);return Te=y+this.toDegrees(Te),{lat:be,lng:Te}},Hg.getUtmLetterDesignator=function(r){return r=parseFloat(r),84>=r&&r>=72?"X":72>r&&r>=64?"W":64>r&&r>=56?"V":56>r&&r>=48?"U":48>r&&r>=40?"T":40>r&&r>=32?"S":32>r&&r>=24?"R":24>r&&r>=16?"Q":16>r&&r>=8?"P":8>r&&r>=0?"N":0>r&&r>=-8?"M":-8>r&&r>=-16?"L":-16>r&&r>=-24?"K":-24>r&&r>=-32?"J":-32>r&&r>=-40?"H":-40>r&&r>=-48?"G":-48>r&&r>=-56?"F":-56>r&&r>=-64?"E":-64>r&&r>=-72?"D":-72>r&&r>=-80?"C":"Z"},Hg.setEllipsoid=function(r){switch(r){case"Airy":this.a=6377563,this.eccSquared=.00667054;break;case"Australian National":this.a=6378160,this.eccSquared=.006694542;break;case"Bessel 1841":this.a=6377397,this.eccSquared=.006674372;break;case"Bessel 1841 Nambia":this.a=6377484,this.eccSquared=.006674372;break;case"Clarke 1866":this.a=6378206,this.eccSquared=.006768658;break;case"Clarke 1880":this.a=6378249,this.eccSquared=.006803511;break;case"Everest":this.a=6377276,this.eccSquared=.006637847;break;case"Fischer 1960 Mercury":this.a=6378166,this.eccSquared=.006693422;break;case"Fischer 1968":this.a=6378150,this.eccSquared=.006693422;break;case"GRS 1967":this.a=6378160,this.eccSquared=.006694605;break;case"GRS 1980":this.a=6378137,this.eccSquared=.00669438;break;case"Helmert 1906":this.a=6378200,this.eccSquared=.006693422;break;case"Hough":this.a=6378270,this.eccSquared=.00672267;break;case"International":this.a=6378388,this.eccSquared=.00672267;break;case"Krassovsky":this.a=6378245,this.eccSquared=.006693422;break;case"Modified Airy":this.a=6377340,this.eccSquared=.00667054;break;case"Modified Everest":this.a=6377304,this.eccSquared=.006637847;break;case"Modified Fischer 1960":this.a=6378155,this.eccSquared=.006693422;break;case"South American 1969":this.a=6378160,this.eccSquared=.006694542;break;case"WGS 60":this.a=6378165,this.eccSquared=.006693422;break;case"WGS 66":this.a=6378145,this.eccSquared=.006694542;break;case"WGS 72":this.a=6378135,this.eccSquared=.006694318;break;case"ED50":this.a=6378388,this.eccSquared=.00672267;break;case"WGS 84":case"EUREF89":case"ETRS89":this.a=6378137,this.eccSquared=.00669438;break;default:this.status=!0}},Hg.toDegrees=function(r){return r/Math.PI*180},Hg.toRadians=function(r){return r*Math.PI/180};function nR(r,e){var t=Math.pow(10,e);return Math.round(r*t)/t}var Wse=iR;const Xse=Wm(Wse);class Zse{constructor(e){this.options=e||{},this.options.utm=this.options.hasOwnProperty("utm")?this.options.utm:!0,this.options.lonlat=this.options.hasOwnProperty("lonlat")?this.options.lonlat:!0}onAdd(e){const t=new Xse;return this._map=e,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl coordControl",this._container.style.width=`${this.options.width||"225px"}`,this._map.on("mousemove",i=>{const n=i.lngLat.lat,o=i.lngLat.lng;let a="",s="";const g=t.convertLatLngToUtm(n,o,2),y=n>0?"N":"S";this.options.utm&&(a=`ETRS89 UTM ${g.ZoneNumber}${y} X:<b> ${g.Easting}</b> Y:<b> ${g.Northing}</b> <br>`),this.options.lonlat&&(s=`WGS 84 Lon:<b> ${o.toFixed(5)}</b>  Lat:<b> ${n.toFixed(5)}</b>`);const T=`${a}${s}`;this._container.innerHTML=T}),this._container}_lookUTM31(e,t){var i=0,n=0,o=6,a=84;return e>=i&&e<=o&&t>=n&&t<=a}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}function sR(r,e){return function(){return r.apply(e,arguments)}}const{toString:Jse}=Object.prototype,{getPrototypeOf:uE}=Object,Sv=(r=>e=>{const t=Jse.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),eA=r=>(r=r.toLowerCase(),e=>Sv(e)===r),Tv=r=>e=>typeof e===r,{isArray:Gg}=Array,r0=Tv("undefined");function Yse(r){return r!==null&&!r0(r)&&r.constructor!==null&&!r0(r.constructor)&&ku(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const oR=eA("ArrayBuffer");function eoe(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&oR(r.buffer),e}const toe=Tv("string"),ku=Tv("function"),aR=Tv("number"),Iv=r=>r!==null&&typeof r=="object",roe=r=>r===!0||r===!1,Lv=r=>{if(Sv(r)!=="object")return!1;const e=uE(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},ioe=eA("Date"),noe=eA("File"),soe=eA("Blob"),ooe=eA("FileList"),aoe=r=>Iv(r)&&ku(r.pipe),loe=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||ku(r.append)&&((e=Sv(r))==="formdata"||e==="object"&&ku(r.toString)&&r.toString()==="[object FormData]"))},coe=eA("URLSearchParams"),uoe=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function i0(r,e){let{allOwnKeys:t=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(r===null||typeof r>"u")return;let i,n;if(typeof r!="object"&&(r=[r]),Gg(r))for(i=0,n=r.length;i<n;i++)e.call(null,r[i],i,r);else{const o=t?Object.getOwnPropertyNames(r):Object.keys(r),a=o.length;let s;for(i=0;i<a;i++)s=o[i],e.call(null,r[s],s,r)}}function lR(r,e){e=e.toLowerCase();const t=Object.keys(r);let i=t.length,n;for(;i-- >0;)if(n=t[i],e===n.toLowerCase())return n;return null}const cR=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,uR=r=>!r0(r)&&r!==cR;function hE(){const{caseless:r}=uR(this)&&this||{},e={},t=(i,n)=>{const o=r&&lR(e,n)||n;Lv(e[o])&&Lv(i)?e[o]=hE(e[o],i):Lv(i)?e[o]=hE({},i):Gg(i)?e[o]=i.slice():e[o]=i};for(let i=0,n=arguments.length;i<n;i++)arguments[i]&&i0(arguments[i],t);return e}const hoe=function(r,e,t){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return i0(e,(n,o)=>{t&&ku(n)?r[o]=sR(n,t):r[o]=n},{allOwnKeys:i}),r},Aoe=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),doe=(r,e,t,i)=>{r.prototype=Object.create(e.prototype,i),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},foe=(r,e,t,i)=>{let n,o,a;const s={};if(e=e||{},r==null)return e;do{for(n=Object.getOwnPropertyNames(r),o=n.length;o-- >0;)a=n[o],(!i||i(a,r,e))&&!s[a]&&(e[a]=r[a],s[a]=!0);r=t!==!1&&uE(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},poe=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const i=r.indexOf(e,t);return i!==-1&&i===t},goe=r=>{if(!r)return null;if(Gg(r))return r;let e=r.length;if(!aR(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},moe=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&uE(Uint8Array)),yoe=(r,e)=>{const i=(r&&r[Symbol.iterator]).call(r);let n;for(;(n=i.next())&&!n.done;){const o=n.value;e.call(r,o[0],o[1])}},_oe=(r,e)=>{let t;const i=[];for(;(t=r.exec(e))!==null;)i.push(t);return i},voe=eA("HTMLFormElement"),boe=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,i,n){return i.toUpperCase()+n}),hR=(r=>{let{hasOwnProperty:e}=r;return(t,i)=>e.call(t,i)})(Object.prototype),xoe=eA("RegExp"),AR=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),i={};i0(t,(n,o)=>{let a;(a=e(n,o,r))!==!1&&(i[o]=a||n)}),Object.defineProperties(r,i)},woe=r=>{AR(r,(e,t)=>{if(ku(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const i=r[t];if(ku(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Boe=(r,e)=>{const t={},i=n=>{n.forEach(o=>{t[o]=!0})};return Gg(r)?i(r):i(String(r).split(e)),t},Coe=()=>{},Eoe=(r,e)=>(r=+r,Number.isFinite(r)?r:e),AE="abcdefghijklmnopqrstuvwxyz",dR="0123456789",fR={DIGIT:dR,ALPHA:AE,ALPHA_DIGIT:AE+AE.toUpperCase()+dR},Soe=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fR.ALPHA_DIGIT,t="";const{length:i}=e;for(;r--;)t+=e[Math.random()*i|0];return t};function Toe(r){return!!(r&&ku(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const Ioe=r=>{const e=new Array(10),t=(i,n)=>{if(Iv(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[n]=i;const o=Gg(i)?[]:{};return i0(i,(a,s)=>{const g=t(a,n+1);!r0(g)&&(o[s]=g)}),e[n]=void 0,o}}return i};return t(r,0)},Loe=eA("AsyncFunction"),cr={isArray:Gg,isArrayBuffer:oR,isBuffer:Yse,isFormData:loe,isArrayBufferView:eoe,isString:toe,isNumber:aR,isBoolean:roe,isObject:Iv,isPlainObject:Lv,isUndefined:r0,isDate:ioe,isFile:noe,isBlob:soe,isRegExp:xoe,isFunction:ku,isStream:aoe,isURLSearchParams:coe,isTypedArray:moe,isFileList:ooe,forEach:i0,merge:hE,extend:hoe,trim:uoe,stripBOM:Aoe,inherits:doe,toFlatObject:foe,kindOf:Sv,kindOfTest:eA,endsWith:poe,toArray:goe,forEachEntry:yoe,matchAll:_oe,isHTMLForm:voe,hasOwnProperty:hR,hasOwnProp:hR,reduceDescriptors:AR,freezeMethods:woe,toObjectSet:Boe,toCamelCase:boe,noop:Coe,toFiniteNumber:Eoe,findKey:lR,global:cR,isContextDefined:uR,ALPHABET:fR,generateString:Soe,isSpecCompliantForm:Toe,toJSONObject:Ioe,isAsyncFn:Loe,isThenable:r=>r&&(Iv(r)||ku(r))&&ku(r.then)&&ku(r.catch)};function Un(r,e,t,i,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),i&&(this.request=i),n&&(this.response=n)}cr.inherits(Un,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:cr.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const pR=Un.prototype,gR={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{gR[r]={value:r}}),Object.defineProperties(Un,gR),Object.defineProperty(pR,"isAxiosError",{value:!0}),Un.from=(r,e,t,i,n,o)=>{const a=Object.create(pR);return cr.toFlatObject(r,a,function(g){return g!==Error.prototype},s=>s!=="isAxiosError"),Un.call(a,r.message,e,t,i,n),a.cause=r,a.name=r.name,o&&Object.assign(a,o),a};const Moe=null;function dE(r){return cr.isPlainObject(r)||cr.isArray(r)}function mR(r){return cr.endsWith(r,"[]")?r.slice(0,-2):r}function yR(r,e,t){return r?r.concat(e).map(function(n,o){return n=mR(n),!t&&o?"["+n+"]":n}).join(t?".":""):e}function Poe(r){return cr.isArray(r)&&!r.some(dE)}const Foe=cr.toFlatObject(cr,{},null,function(e){return/^is[A-Z]/.test(e)});function Mv(r,e,t){if(!cr.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=cr.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Y,he){return!cr.isUndefined(he[Y])});const i=t.metaTokens,n=t.visitor||T,o=t.dots,a=t.indexes,g=(t.Blob||typeof Blob<"u"&&Blob)&&cr.isSpecCompliantForm(e);if(!cr.isFunction(n))throw new TypeError("visitor must be a function");function y(Z){if(Z===null)return"";if(cr.isDate(Z))return Z.toISOString();if(!g&&cr.isBlob(Z))throw new Un("Blob is not supported. Use a Buffer instead.");return cr.isArrayBuffer(Z)||cr.isTypedArray(Z)?g&&typeof Blob=="function"?new Blob([Z]):Buffer.from(Z):Z}function T(Z,Y,he){let ce=Z;if(Z&&!he&&typeof Z=="object"){if(cr.endsWith(Y,"{}"))Y=i?Y:Y.slice(0,-2),Z=JSON.stringify(Z);else if(cr.isArray(Z)&&Poe(Z)||(cr.isFileList(Z)||cr.endsWith(Y,"[]"))&&(ce=cr.toArray(Z)))return Y=mR(Y),ce.forEach(function(be,Te){!(cr.isUndefined(be)||be===null)&&e.append(a===!0?yR([Y],Te,o):a===null?Y:Y+"[]",y(be))}),!1}return dE(Z)?!0:(e.append(yR(he,Y,o),y(Z)),!1)}const I=[],R=Object.assign(Foe,{defaultVisitor:T,convertValue:y,isVisitable:dE});function U(Z,Y){if(!cr.isUndefined(Z)){if(I.indexOf(Z)!==-1)throw Error("Circular reference detected in "+Y.join("."));I.push(Z),cr.forEach(Z,function(ce,pe){(!(cr.isUndefined(ce)||ce===null)&&n.call(e,ce,cr.isString(pe)?pe.trim():pe,Y,R))===!0&&U(ce,Y?Y.concat(pe):[pe])}),I.pop()}}if(!cr.isObject(r))throw new TypeError("data must be an object");return U(r),e}function _R(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function fE(r,e){this._pairs=[],r&&Mv(r,this,e)}const vR=fE.prototype;vR.append=function(e,t){this._pairs.push([e,t])},vR.toString=function(e){const t=e?function(i){return e.call(this,i,_R)}:_R;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};function Doe(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function bR(r,e,t){if(!e)return r;const i=t&&t.encode||Doe,n=t&&t.serialize;let o;if(n?o=n(e,t):o=cr.isURLSearchParams(e)?e.toString():new fE(e,t).toString(i),o){const a=r.indexOf("#");a!==-1&&(r=r.slice(0,a)),r+=(r.indexOf("?")===-1?"?":"&")+o}return r}class xR{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){cr.forEach(this.handlers,function(i){i!==null&&e(i)})}}const wR={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Roe={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:fE,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},BR=typeof window<"u"&&typeof document<"u",koe=(r=>BR&&["ReactNative","NativeScript","NS"].indexOf(r)<0)(typeof navigator<"u"&&navigator.product),Ooe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",tA={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:BR,hasStandardBrowserEnv:koe,hasStandardBrowserWebWorkerEnv:Ooe},Symbol.toStringTag,{value:"Module"})),...Roe};function Uoe(r,e){return Mv(r,new tA.classes.URLSearchParams,Object.assign({visitor:function(t,i,n,o){return tA.isNode&&cr.isBuffer(t)?(this.append(i,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function Noe(r){return cr.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function zoe(r){const e={},t=Object.keys(r);let i;const n=t.length;let o;for(i=0;i<n;i++)o=t[i],e[o]=r[o];return e}function CR(r){function e(t,i,n,o){let a=t[o++];if(a==="__proto__")return!0;const s=Number.isFinite(+a),g=o>=t.length;return a=!a&&cr.isArray(n)?n.length:a,g?(cr.hasOwnProp(n,a)?n[a]=[n[a],i]:n[a]=i,!s):((!n[a]||!cr.isObject(n[a]))&&(n[a]=[]),e(t,i,n[a],o)&&cr.isArray(n[a])&&(n[a]=zoe(n[a])),!s)}if(cr.isFormData(r)&&cr.isFunction(r.entries)){const t={};return cr.forEachEntry(r,(i,n)=>{e(Noe(i),n,t,0)}),t}return null}function Qoe(r,e,t){if(cr.isString(r))try{return(e||JSON.parse)(r),cr.trim(r)}catch(i){if(i.name!=="SyntaxError")throw i}return(t||JSON.stringify)(r)}const pE={transitional:wR,adapter:["xhr","http"],transformRequest:[function(e,t){const i=t.getContentType()||"",n=i.indexOf("application/json")>-1,o=cr.isObject(e);if(o&&cr.isHTMLForm(e)&&(e=new FormData(e)),cr.isFormData(e))return n?JSON.stringify(CR(e)):e;if(cr.isArrayBuffer(e)||cr.isBuffer(e)||cr.isStream(e)||cr.isFile(e)||cr.isBlob(e))return e;if(cr.isArrayBufferView(e))return e.buffer;if(cr.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(o){if(i.indexOf("application/x-www-form-urlencoded")>-1)return Uoe(e,this.formSerializer).toString();if((s=cr.isFileList(e))||i.indexOf("multipart/form-data")>-1){const g=this.env&&this.env.FormData;return Mv(s?{"files[]":e}:e,g&&new g,this.formSerializer)}}return o||n?(t.setContentType("application/json",!1),Qoe(e)):e}],transformResponse:[function(e){const t=this.transitional||pE.transitional,i=t&&t.forcedJSONParsing,n=this.responseType==="json";if(e&&cr.isString(e)&&(i&&!this.responseType||n)){const a=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(s){if(a)throw s.name==="SyntaxError"?Un.from(s,Un.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:tA.classes.FormData,Blob:tA.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};cr.forEach(["delete","get","head","post","put","patch"],r=>{pE.headers[r]={}});const gE=pE,Voe=cr.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Hoe=r=>{const e={};let t,i,n;return r&&r.split(`
`).forEach(function(a){n=a.indexOf(":"),t=a.substring(0,n).trim().toLowerCase(),i=a.substring(n+1).trim(),!(!t||e[t]&&Voe[t])&&(t==="set-cookie"?e[t]?e[t].push(i):e[t]=[i]:e[t]=e[t]?e[t]+", "+i:i)}),e},ER=Symbol("internals");function n0(r){return r&&String(r).trim().toLowerCase()}function Pv(r){return r===!1||r==null?r:cr.isArray(r)?r.map(Pv):String(r)}function Goe(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=t.exec(r);)e[i[1]]=i[2];return e}const joe=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function mE(r,e,t,i,n){if(cr.isFunction(i))return i.call(this,e,t);if(n&&(e=t),!!cr.isString(e)){if(cr.isString(i))return e.indexOf(i)!==-1;if(cr.isRegExp(i))return i.test(e)}}function qoe(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,i)=>t.toUpperCase()+i)}function $oe(r,e){const t=cr.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(r,i+t,{value:function(n,o,a){return this[i].call(this,e,n,o,a)},configurable:!0})})}class Fv{constructor(e){e&&this.set(e)}set(e,t,i){const n=this;function o(s,g,y){const T=n0(g);if(!T)throw new Error("header name must be a non-empty string");const I=cr.findKey(n,T);(!I||n[I]===void 0||y===!0||y===void 0&&n[I]!==!1)&&(n[I||g]=Pv(s))}const a=(s,g)=>cr.forEach(s,(y,T)=>o(y,T,g));return cr.isPlainObject(e)||e instanceof this.constructor?a(e,t):cr.isString(e)&&(e=e.trim())&&!joe(e)?a(Hoe(e),t):e!=null&&o(t,e,i),this}get(e,t){if(e=n0(e),e){const i=cr.findKey(this,e);if(i){const n=this[i];if(!t)return n;if(t===!0)return Goe(n);if(cr.isFunction(t))return t.call(this,n,i);if(cr.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=n0(e),e){const i=cr.findKey(this,e);return!!(i&&this[i]!==void 0&&(!t||mE(this,this[i],i,t)))}return!1}delete(e,t){const i=this;let n=!1;function o(a){if(a=n0(a),a){const s=cr.findKey(i,a);s&&(!t||mE(i,i[s],s,t))&&(delete i[s],n=!0)}}return cr.isArray(e)?e.forEach(o):o(e),n}clear(e){const t=Object.keys(this);let i=t.length,n=!1;for(;i--;){const o=t[i];(!e||mE(this,this[o],o,e,!0))&&(delete this[o],n=!0)}return n}normalize(e){const t=this,i={};return cr.forEach(this,(n,o)=>{const a=cr.findKey(i,o);if(a){t[a]=Pv(n),delete t[o];return}const s=e?qoe(o):String(o).trim();s!==o&&delete t[o],t[s]=Pv(n),i[s]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return cr.forEach(this,(i,n)=>{i!=null&&i!==!1&&(t[n]=e&&cr.isArray(i)?i.join(", "):i)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,i]=e;return t+": "+i}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var i=arguments.length,n=new Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];return n.forEach(a=>t.set(a)),t}static accessor(e){const i=(this[ER]=this[ER]={accessors:{}}).accessors,n=this.prototype;function o(a){const s=n0(a);i[s]||($oe(n,a),i[s]=!0)}return cr.isArray(e)?e.forEach(o):o(e),this}}Fv.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),cr.reduceDescriptors(Fv.prototype,(r,e)=>{let{value:t}=r,i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[i]=n}}}),cr.freezeMethods(Fv);const NA=Fv;function yE(r,e){const t=this||gE,i=e||t,n=NA.from(i.headers);let o=i.data;return cr.forEach(r,function(s){o=s.call(t,o,n.normalize(),e?e.status:void 0)}),n.normalize(),o}function SR(r){return!!(r&&r.__CANCEL__)}function s0(r,e,t){Un.call(this,r??"canceled",Un.ERR_CANCELED,e,t),this.name="CanceledError"}cr.inherits(s0,Un,{__CANCEL__:!0});function Koe(r,e,t){const i=t.config.validateStatus;!t.status||!i||i(t.status)?r(t):e(new Un("Request failed with status code "+t.status,[Un.ERR_BAD_REQUEST,Un.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}const Woe=tA.hasStandardBrowserEnv?{write(r,e,t,i,n,o){const a=[r+"="+encodeURIComponent(e)];cr.isNumber(t)&&a.push("expires="+new Date(t).toGMTString()),cr.isString(i)&&a.push("path="+i),cr.isString(n)&&a.push("domain="+n),o===!0&&a.push("secure"),document.cookie=a.join("; ")},read(r){const e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Xoe(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function Zoe(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function TR(r,e){return r&&!Xoe(e)?Zoe(r,e):e}const Joe=tA.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let i;function n(o){let a=o;return e&&(t.setAttribute("href",a),a=t.href),t.setAttribute("href",a),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return i=n(window.location.href),function(a){const s=cr.isString(a)?n(a):a;return s.protocol===i.protocol&&s.host===i.host}}():function(){return function(){return!0}}();function Yoe(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function eae(r,e){r=r||10;const t=new Array(r),i=new Array(r);let n=0,o=0,a;return e=e!==void 0?e:1e3,function(g){const y=Date.now(),T=i[o];a||(a=y),t[n]=g,i[n]=y;let I=o,R=0;for(;I!==n;)R+=t[I++],I=I%r;if(n=(n+1)%r,n===o&&(o=(o+1)%r),y-a<e)return;const U=T&&y-T;return U?Math.round(R*1e3/U):void 0}}function IR(r,e){let t=0;const i=eae(50,250);return n=>{const o=n.loaded,a=n.lengthComputable?n.total:void 0,s=o-t,g=i(s),y=o<=a;t=o;const T={loaded:o,total:a,progress:a?o/a:void 0,bytes:s,rate:g||void 0,estimated:g&&a&&y?(a-o)/g:void 0,event:n};T[e?"download":"upload"]=!0,r(T)}}const _E={http:Moe,xhr:typeof XMLHttpRequest<"u"&&function(r){return new Promise(function(t,i){let n=r.data;const o=NA.from(r.headers).normalize();let{responseType:a,withXSRFToken:s}=r,g;function y(){r.cancelToken&&r.cancelToken.unsubscribe(g),r.signal&&r.signal.removeEventListener("abort",g)}let T;if(cr.isFormData(n)){if(tA.hasStandardBrowserEnv||tA.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if((T=o.getContentType())!==!1){const[Y,...he]=T?T.split(";").map(ce=>ce.trim()).filter(Boolean):[];o.setContentType([Y||"multipart/form-data",...he].join("; "))}}let I=new XMLHttpRequest;if(r.auth){const Y=r.auth.username||"",he=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";o.set("Authorization","Basic "+btoa(Y+":"+he))}const R=TR(r.baseURL,r.url);I.open(r.method.toUpperCase(),bR(R,r.params,r.paramsSerializer),!0),I.timeout=r.timeout;function U(){if(!I)return;const Y=NA.from("getAllResponseHeaders"in I&&I.getAllResponseHeaders()),ce={data:!a||a==="text"||a==="json"?I.responseText:I.response,status:I.status,statusText:I.statusText,headers:Y,config:r,request:I};Koe(function(be){t(be),y()},function(be){i(be),y()},ce),I=null}if("onloadend"in I?I.onloadend=U:I.onreadystatechange=function(){!I||I.readyState!==4||I.status===0&&!(I.responseURL&&I.responseURL.indexOf("file:")===0)||setTimeout(U)},I.onabort=function(){I&&(i(new Un("Request aborted",Un.ECONNABORTED,r,I)),I=null)},I.onerror=function(){i(new Un("Network Error",Un.ERR_NETWORK,r,I)),I=null},I.ontimeout=function(){let he=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const ce=r.transitional||wR;r.timeoutErrorMessage&&(he=r.timeoutErrorMessage),i(new Un(he,ce.clarifyTimeoutError?Un.ETIMEDOUT:Un.ECONNABORTED,r,I)),I=null},tA.hasStandardBrowserEnv&&(s&&cr.isFunction(s)&&(s=s(r)),s||s!==!1&&Joe(R))){const Y=r.xsrfHeaderName&&r.xsrfCookieName&&Woe.read(r.xsrfCookieName);Y&&o.set(r.xsrfHeaderName,Y)}n===void 0&&o.setContentType(null),"setRequestHeader"in I&&cr.forEach(o.toJSON(),function(he,ce){I.setRequestHeader(ce,he)}),cr.isUndefined(r.withCredentials)||(I.withCredentials=!!r.withCredentials),a&&a!=="json"&&(I.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&I.addEventListener("progress",IR(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&I.upload&&I.upload.addEventListener("progress",IR(r.onUploadProgress)),(r.cancelToken||r.signal)&&(g=Y=>{I&&(i(!Y||Y.type?new s0(null,r,I):Y),I.abort(),I=null)},r.cancelToken&&r.cancelToken.subscribe(g),r.signal&&(r.signal.aborted?g():r.signal.addEventListener("abort",g)));const Z=Yoe(R);if(Z&&tA.protocols.indexOf(Z)===-1){i(new Un("Unsupported protocol "+Z+":",Un.ERR_BAD_REQUEST,r));return}I.send(n||null)})}};cr.forEach(_E,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const LR=r=>`- ${r}`,tae=r=>cr.isFunction(r)||r===null||r===!1,MR={getAdapter:r=>{r=cr.isArray(r)?r:[r];const{length:e}=r;let t,i;const n={};for(let o=0;o<e;o++){t=r[o];let a;if(i=t,!tae(t)&&(i=_E[(a=String(t)).toLowerCase()],i===void 0))throw new Un(`Unknown adapter '${a}'`);if(i)break;n[a||"#"+o]=i}if(!i){const o=Object.entries(n).map(s=>{let[g,y]=s;return`adapter ${g} `+(y===!1?"is not supported by the environment":"is not available in the build")});let a=e?o.length>1?`since :
`+o.map(LR).join(`
`):" "+LR(o[0]):"as no adapter specified";throw new Un("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return i},adapters:_E};function vE(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new s0(null,r)}function PR(r){return vE(r),r.headers=NA.from(r.headers),r.data=yE.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),MR.getAdapter(r.adapter||gE.adapter)(r).then(function(i){return vE(r),i.data=yE.call(r,r.transformResponse,i),i.headers=NA.from(i.headers),i},function(i){return SR(i)||(vE(r),i&&i.response&&(i.response.data=yE.call(r,r.transformResponse,i.response),i.response.headers=NA.from(i.response.headers))),Promise.reject(i)})}const FR=r=>r instanceof NA?r.toJSON():r;function jg(r,e){e=e||{};const t={};function i(y,T,I){return cr.isPlainObject(y)&&cr.isPlainObject(T)?cr.merge.call({caseless:I},y,T):cr.isPlainObject(T)?cr.merge({},T):cr.isArray(T)?T.slice():T}function n(y,T,I){if(cr.isUndefined(T)){if(!cr.isUndefined(y))return i(void 0,y,I)}else return i(y,T,I)}function o(y,T){if(!cr.isUndefined(T))return i(void 0,T)}function a(y,T){if(cr.isUndefined(T)){if(!cr.isUndefined(y))return i(void 0,y)}else return i(void 0,T)}function s(y,T,I){if(I in e)return i(y,T);if(I in r)return i(void 0,y)}const g={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(y,T)=>n(FR(y),FR(T),!0)};return cr.forEach(Object.keys(Object.assign({},r,e)),function(T){const I=g[T]||n,R=I(r[T],e[T],T);cr.isUndefined(R)&&I!==s||(t[T]=R)}),t}const DR="1.6.7",bE={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{bE[r]=function(i){return typeof i===r||"a"+(e<1?"n ":" ")+r}});const RR={};bE.transitional=function(e,t,i){function n(o,a){return"[Axios v"+DR+"] Transitional option '"+o+"'"+a+(i?". "+i:"")}return(o,a,s)=>{if(e===!1)throw new Un(n(a," has been removed"+(t?" in "+t:"")),Un.ERR_DEPRECATED);return t&&!RR[a]&&(RR[a]=!0,console.warn(n(a," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,a,s):!0}};function rae(r,e,t){if(typeof r!="object")throw new Un("options must be an object",Un.ERR_BAD_OPTION_VALUE);const i=Object.keys(r);let n=i.length;for(;n-- >0;){const o=i[n],a=e[o];if(a){const s=r[o],g=s===void 0||a(s,o,r);if(g!==!0)throw new Un("option "+o+" must be "+g,Un.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Un("Unknown option "+o,Un.ERR_BAD_OPTION)}}const xE={assertOptions:rae,validators:bE},Id=xE.validators;class Dv{constructor(e){this.defaults=e,this.interceptors={request:new xR,response:new xR}}async request(e,t){try{return await this._request(e,t)}catch(i){if(i instanceof Error){let n;Error.captureStackTrace?Error.captureStackTrace(n={}):n=new Error;const o=n.stack?n.stack.replace(/^.+\n/,""):"";i.stack?o&&!String(i.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+o):i.stack=o}throw i}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=jg(this.defaults,t);const{transitional:i,paramsSerializer:n,headers:o}=t;i!==void 0&&xE.assertOptions(i,{silentJSONParsing:Id.transitional(Id.boolean),forcedJSONParsing:Id.transitional(Id.boolean),clarifyTimeoutError:Id.transitional(Id.boolean)},!1),n!=null&&(cr.isFunction(n)?t.paramsSerializer={serialize:n}:xE.assertOptions(n,{encode:Id.function,serialize:Id.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let a=o&&cr.merge(o.common,o[t.method]);o&&cr.forEach(["delete","get","head","post","put","patch","common"],Z=>{delete o[Z]}),t.headers=NA.concat(a,o);const s=[];let g=!0;this.interceptors.request.forEach(function(Y){typeof Y.runWhen=="function"&&Y.runWhen(t)===!1||(g=g&&Y.synchronous,s.unshift(Y.fulfilled,Y.rejected))});const y=[];this.interceptors.response.forEach(function(Y){y.push(Y.fulfilled,Y.rejected)});let T,I=0,R;if(!g){const Z=[PR.bind(this),void 0];for(Z.unshift.apply(Z,s),Z.push.apply(Z,y),R=Z.length,T=Promise.resolve(t);I<R;)T=T.then(Z[I++],Z[I++]);return T}R=s.length;let U=t;for(I=0;I<R;){const Z=s[I++],Y=s[I++];try{U=Z(U)}catch(he){Y.call(this,he);break}}try{T=PR.call(this,U)}catch(Z){return Promise.reject(Z)}for(I=0,R=y.length;I<R;)T=T.then(y[I++],y[I++]);return T}getUri(e){e=jg(this.defaults,e);const t=TR(e.baseURL,e.url);return bR(t,e.params,e.paramsSerializer)}}cr.forEach(["delete","get","head","options"],function(e){Dv.prototype[e]=function(t,i){return this.request(jg(i||{},{method:e,url:t,data:(i||{}).data}))}}),cr.forEach(["post","put","patch"],function(e){function t(i){return function(o,a,s){return this.request(jg(s||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:a}))}}Dv.prototype[e]=t(),Dv.prototype[e+"Form"]=t(!0)});const Rv=Dv;class wE{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});const i=this;this.promise.then(n=>{if(!i._listeners)return;let o=i._listeners.length;for(;o-- >0;)i._listeners[o](n);i._listeners=null}),this.promise.then=n=>{let o;const a=new Promise(s=>{i.subscribe(s),o=s}).then(n);return a.cancel=function(){i.unsubscribe(o)},a},e(function(o,a,s){i.reason||(i.reason=new s0(o,a,s),t(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new wE(function(n){e=n}),cancel:e}}}const iae=wE;function nae(r){return function(t){return r.apply(null,t)}}function sae(r){return cr.isObject(r)&&r.isAxiosError===!0}const BE={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(BE).forEach(r=>{let[e,t]=r;BE[t]=e});const oae=BE;function kR(r){const e=new Rv(r),t=sR(Rv.prototype.request,e);return cr.extend(t,Rv.prototype,e,{allOwnKeys:!0}),cr.extend(t,e,null,{allOwnKeys:!0}),t.create=function(n){return kR(jg(r,n))},t}const qo=kR(gE);qo.Axios=Rv,qo.CanceledError=s0,qo.CancelToken=iae,qo.isCancel=SR,qo.VERSION=DR,qo.toFormData=Mv,qo.AxiosError=Un,qo.Cancel=qo.CanceledError,qo.all=function(e){return Promise.all(e)},qo.spread=nae,qo.isAxiosError=sae,qo.mergeConfig=jg,qo.AxiosHeaders=NA,qo.formToJSON=r=>CR(cr.isHTMLForm(r)?new FormData(r):r),qo.getAdapter=MR.getAdapter,qo.HttpStatusCode=oae,qo.default=qo;const Qf={defaultOptions:{limitsUrl:"https://tilemaps.icgc.cat/vt/limits-tilejsonV3.json",geocoder:{peliasUrl1:"https://eines.icgc.cat/geocodificador/autocompletar?text=",peliasUrl2:"&layers=topo1%2Ctopo2%2Caddress&size=5"},mapOptions:{container:"map",center:{0:1.537786,1:41.837539},zoom:7.5,bearing:0,pitch:0,hash:!1,style:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",maxZoom:18,maxPitch:85},logoIcgcOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/icgc_logo_color.png",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/icgc_logo_blanc.svg",logoLink:"https://www.icgc.cat",logoTitle:"Institut Cartogrfic i Geolgic de Catalunya",logoWidth:100},logoGencatOptions:{logoUrlColor:"https://tilemaps.icgc.cat/cdn/logos/gencat_logo_color.png",logoUrlWhite:"https://tilemaps.icgc.cat/cdn/logos/gencat_logo_blanc.png",logoLink:"https://web.gencat.cat/",logoTitle:"Generalitat de Catalunya",logoWidth:100},map3dOptions:{spaceErrorFactor:2,exaggeration:1,zfactor:48,minZoomRange:15.5,maxZoomRange:22,urlTilesetCities:"https://tilemaps.icgc.cat/vector/3dtiles/ciutats/v1/tilesetV1.0.json",layerIdOrder:"place-isolated",sourceLayerFilterId:"place",minZoomFilter:14,layerId3d:"edificisMapboxLayer",terrainSource:"ICGC5M",style3dName:"orto3d",imageIcon:"https://tilemaps.icgc.cat/cdn/images/stick.png"},baseStyles:[{key:"TOPO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_estandard.png"},{key:"ORTO",url:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ORTO3D",url:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_orto_hibrida.png"},{key:"ADMIN",url:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_delimitacio_limits_administratius.png"},{key:"DARK",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_fosc.png"},{key:"LIGHT",url:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_mapa_base_gris.png"},{key:"GEOLOGY",url:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json",image:"https://visors.icgc.cat/contextmaps/imatges_estil/icgc_geologic_informacio.png"}],urlTerrainICGC:[{name:"ICGC5M",url:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png"},{name:"WORLD30M",url:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png",encoding:"terrarium"}],ortoLayersICGC:[{name:"ortofotoColorProvisional",key:"ortofoto_color_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional"},{name:"ortofotoColor2022",key:"ortofoto_color_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022"},{name:"ortofotoColor2021",key:"ortofoto_color_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021"},{name:"ortofotoColor2020",key:"ortofoto_color_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020"},{name:"ortofotoColor2019",key:"ortofoto_color_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019"},{name:"ortofotoColor2018",key:"ortofoto_color_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018"},{name:"ortofotoColor2017",key:"ortofoto_color_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017"},{name:"ortofotoColor2016",key:"ortofoto_color_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016"},{name:"ortofotoColor2015",key:"ortofoto_color_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015"},{name:"ortofotoColor2014",key:"ortofoto_color_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014"},{name:"ortofotoColor2013",key:"ortofoto_color_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013"},{name:"ortofotoColor2012",key:"ortofoto_color_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012"},{name:"ortofotoColor2011",key:"ortofoto_color_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011"},{name:"ortofotoColor2010",key:"ortofoto_color_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010"},{name:"ortofotoColor2009",key:"ortofoto_color_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009"},{name:"ortofotoColor2008",key:"ortofoto_color_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008"},{name:"ortofotoColor20062007",key:"ortofoto_color_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007"},{name:"ortofotoColor20042005",key:"ortofoto_color_2004-2005",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005"},{name:"ortofotoColor20002003",key:"ortofoto_color_2000-2003",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003"},{name:"ortofotoBlancINegre1998",key:"ortofoto_blanc_i_negre_1998",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998"},{name:"ortofotoBlancINegre19941997",key:"ortofoto_blanc_i_negre_1994-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997"},{name:"ortofotoColor1993",key:"ortofoto_color_1993",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993"},{name:"ortofotoBlancINegre19831992",key:"ortofoto_blanc_i_negre_1983-1992",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992"},{name:"ortofotoBlancINegre19701977",key:"ortofoto_blanc_i_negre_1970-1977",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977"},{name:"ortofotoBlancINegre1956",key:"ortofoto_blanc_i_negre_1956",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956"},{name:"ortofotoBlancINegre1945",key:"ortofoto_blanc_i_negre_1945",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945"},{name:"ortofotoColorSerieAnual",key:"ortofoto_color_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual"},{name:"ortofotoInfraroigProvisional",key:"ortofoto_infraroig_provisional",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional"},{name:"ortofotoInfraroig2022",key:"ortofoto_infraroig_2022",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022"},{name:"ortofotoInfraroig2021",key:"ortofoto_infraroig_2021",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021"},{name:"ortofotoInfraroig2020",key:"ortofoto_infraroig_2020",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020"},{name:"ortofotoInfraroig2019",key:"ortofoto_infraroig_2019",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019"},{name:"ortofotoInfraroig2018",key:"ortofoto_infraroig_2018",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018"},{name:"ortofotoInfraroig2017",key:"ortofoto_infraroig_2017",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017"},{name:"ortofotoInfraroig2016",key:"ortofoto_infraroig_2016",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016"},{name:"ortofotoInfraroig2015",key:"ortofoto_infraroig_2015",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015"},{name:"ortofotoInfraroig2014",key:"ortofoto_infraroig_2014",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014"},{name:"ortofotoInfraroig2013",key:"ortofoto_infraroig_2013",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013"},{name:"ortofotoInfraroig2012",key:"ortofoto_infraroig_2012",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012"},{name:"ortofotoInfraroig2011",key:"ortofoto_infraroig_2011",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011"},{name:"ortofotoInfraroig2010",key:"ortofoto_infraroig_2010",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010"},{name:"ortofotoInfraroig2009",key:"ortofoto_infraroig_2009",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009"},{name:"ortofotoInfraroig2008",key:"ortofoto_infraroig_2008",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008"},{name:"ortofotoInfraroig20062007",key:"ortofoto_infraroig_2006-2007",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007"},{name:"ortofotoInfraroig19961997",key:"ortofoto_infraroig_1996-1997",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997"},{name:"ortofotoInfraroigSerieAnual",key:"ortofoto_infraroig_serie_anual",url:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"}],vectorLayersICGC:[{name:"agrupacionsCensals2015",key:"agrupacions_censals_2015"},{name:"agrupacionsCensals2016",key:"agrupacions_censals_2016"},{name:"agrupacionsCensals2017",key:"agrupacions_censals_2017"},{name:"agrupacionsCensals2018",key:"agrupacions_censals_2018"},{name:"agrupacionsCensals2019",key:"agrupacions_censals_2019"},{name:"agrupacionsCensals2020",key:"agrupacions_censals_2020"},{name:"agrupacionsCensals2021",key:"agrupacions_censals_2021"},{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text"},{name:"areesBasiquesPolicials2019",key:"arees_basiques_policials_2019"},{name:"areesBasiquesPolicials2020",key:"arees_basiques_policials_2020"},{name:"areesBasiquesPolicials2022",key:"arees_basiques_policials_2022"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent"},{name:"catalunyaVigent",key:"catalunya_vigent"},{name:"catalunyaVigentText",key:"catalunya_vigent_text"},{name:"comarques2022",key:"comarques_2022"},{name:"comarquesVigent",key:"comarques_vigent"},{name:"comarquesVigentText",key:"comarques_vigent_text"},{name:"districtesCensals2015",key:"districtes_censals_2015"},{name:"districtesCensals2016",key:"districtes_censals_2016"},{name:"districtesCensals2017",key:"districtes_censals_2017"},{name:"districtesCensals2018",key:"districtes_censals_2018"},{name:"districtesCensals2019",key:"districtes_censals_2019"},{name:"districtesCensals2020",key:"districtes_censals_2020"},{name:"districtesCensals2021",key:"districtes_censals_2021"},{name:"districtesCensals2022",key:"districtes_censals_2022"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text"},{name:"municipis2022",key:"municipis_2022"},{name:"municipis2022Text",key:"municipis_2022_text"},{name:"municipisVigent",key:"municipis_vigent"},{name:"municipisVigentText",key:"municipis_vigent_text"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text"},{name:"plaTerritorial2015",key:"pla_territorial_2015"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text"},{name:"provinciesVigent",key:"provincies_vigent"},{name:"provinciesVigentText",key:"provincies_vigent_text"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text"},{name:"seccionsCensals2015",key:"seccions_censals_2015"},{name:"seccionsCensals2016",key:"seccions_censals_2016"},{name:"seccionsCensals2017",key:"seccions_censals_2017"},{name:"seccionsCensals2018",key:"seccions_censals_2018"},{name:"seccionsCensals2019",key:"seccions_censals_2019"},{name:"seccionsCensals2020",key:"seccions_censals_2020"},{name:"seccionsCensals2021",key:"seccions_censals_2021"},{name:"seccionsCensals2022",key:"seccions_censals_2022"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent"},{name:"vegueriesVigent",key:"vegueries_vigent"},{name:"vegueriesVigentText",key:"vegueries_vigent_text"}],vectorLayers:[{key:"cobertes2018",url:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json",legend:"https://tilemaps.icgc.cat/cdn/images/llegendaCobertesSol2018.jpg"}],wmsLayers:[{key:"espaisInteresGeologic",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"gravimetriaBouguer500000",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"cobertesSol2018",layer:"",url:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}"},{key:"administratiu",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png"},{key:"simplificat",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png"},{key:"cims",layer:"",url:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455"},{key:"cobertesSol",layer:"",url:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}],fgbLayers:[{name:"agrupacionsCensalsVigent",key:"agrupacions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb"},{name:"agrupacionsCensalsVigentText",key:"agrupacions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb"},{name:"areesBasiquesPolicialsVigent",key:"arees_basiques_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb"},{name:"areesBasiquesPolicialsVigentText",key:"arees_basiques_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb"},{name:"areesBasiquesSalutVigent",key:"arees_basiques_salut_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigent",key:"arees_basiques_serveis_socials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb"},{name:"areesBasiquesServeisSocialsVigentText",key:"arees_basiques_serveis_socials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb"},{name:"areesGestioAssistencialVigent",key:"arees_gestio_assistencial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb"},{name:"areesHidrogeologiquesAquifersVigent",key:"arees_hidrogeologiques_aquifers_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb"},{name:"catalunyaVigent",key:"catalunya_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb"},{name:"catalunyaVigentText",key:"catalunya_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb"},{name:"comarquesVigent",key:"comarques_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb"},{name:"comarquesVigentText",key:"comarques_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb"},{name:"districtesCensalsVigent",key:"districtes_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb"},{name:"districtesCensalsVigentText",key:"districtes_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb"},{name:"incendisForestalsVigent",key:"incendis_forestals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb"},{name:"incendisForestalsVigentText",key:"incendis_forestals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb"},{name:"municipisVigent",key:"municipis_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb"},{name:"municipisVigentText",key:"municipis_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb"},{name:"partitsJudicialsVigent",key:"partits_judicials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb"},{name:"partitsJudicialsVigentText",key:"partits_judicials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb"},{name:"plaTerritorialVigent",key:"pla_territorial_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb"},{name:"plaTerritorialVigentText",key:"pla_territorial_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb"},{name:"provinciesVigent",key:"provincies_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb"},{name:"provinciesVigentText",key:"provincies_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb"},{name:"regionsPolicialsVigent",key:"regions_policials_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb"},{name:"regionsPolicialsVigentText",key:"regions_policials_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb"},{name:"regionsSanitariesVigent",key:"regions_sanitaries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb"},{name:"regionsSanitariesVigentText",key:"regions_sanitaries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb"},{name:"seccionsCensalsVigent",key:"seccions_censals_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb"},{name:"seccionsCensalsVigentText",key:"seccions_censals_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb"},{name:"sectorsSanitarisVigent",key:"sectors_sanitaris_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb"},{name:"vegueriesVigent",key:"vegueries_vigent",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb"},{name:"vegueriesVigentText",key:"vegueries_vigent_text",url:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"}]},Styles:{TOPO:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_estandard.json",ORTO:"https://geoserveis.icgc.cat/contextmaps/icgc_orto_estandard.json",ORTO3D:"https://tilemaps.icgc.cat/cdn/styles/icgc_orto_3d.json",ADMIN:"https://geoserveis.icgc.cat/contextmaps/icgc_delimitacio_limits_administratius.json",DARK:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_fosc.json",LIGHT:"https://geoserveis.icgc.cat/contextmaps/icgc_mapa_base_gris.json",GEOLOGY:"https://geoserveis.icgc.cat/contextmaps/icgc_geologic_informacio.json"},Terrains:{ICGC5M:"https://tilemaps.icgc.cat/tileserver/tileserver/terreny-5m-30m-rgb-extent/{z}/{x}/{y}.png",WORLD30M:"https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png"},Layers:{Orto:{ortofotoColorProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_provisional",ortofotoColor2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2022",ortofotoColor2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2021",ortofotoColor2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2020",ortofotoColor2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2019",ortofotoColor2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2018",ortofotoColor2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2017",ortofotoColor2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2016",ortofotoColor2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2015",ortofotoColor2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2014",ortofotoColor2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2013",ortofotoColor2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2012",ortofotoColor2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2011",ortofotoColor2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2010",ortofotoColor2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2009",ortofotoColor2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2008",ortofotoColor20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2006-2007",ortofotoColor20042005:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2004-2005",ortofotoColor20002003:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_2000-2003",ortofotoBlancINegre1998:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1998",ortofotoBlancINegre19941997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1994-1997",ortofotoColor1993:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_1993",ortofotoBlancINegre19831992:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1983-1992",ortofotoBlancINegre19701977:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1970-1977",ortofotoBlancINegre1956:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1956",ortofotoBlancINegre1945:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_blanc_i_negre_1945",ortofotoColorSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_color_serie_anual",ortofotoInfraroigProvisional:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_provisional",ortofotoInfraroig2022:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2022",ortofotoInfraroig2021:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2021",ortofotoInfraroig2020:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2020",ortofotoInfraroig2019:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2019",ortofotoInfraroig2018:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2018",ortofotoInfraroig2017:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2017",ortofotoInfraroig2016:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2016",ortofotoInfraroig2015:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2015",ortofotoInfraroig2014:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2014",ortofotoInfraroig2013:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2013",ortofotoInfraroig2012:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2012",ortofotoInfraroig2011:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2011",ortofotoInfraroig2010:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2010",ortofotoInfraroig2009:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2009",ortofotoInfraroig2008:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2008",ortofotoInfraroig20062007:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_2006-2007",ortofotoInfraroig19961997:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_1996-1997",ortofotoInfraroigSerieAnual:"https://geoserveis.icgc.cat/servei/catalunya/orto-territorial/wms?&bbox={bbox-epsg-3857}&format=image/png&service=WMS&version=1.1.1&request=GetMap&STYLES=&srs=EPSG:3857&transparent=true&width=256&height=256&layers=ortofoto_infraroig_serie_anual"},VectorAdmin:{agrupacionsCensals2015:"agrupacions_censals_2015",agrupacionsCensals2016:"agrupacions_censals_2016",agrupacionsCensals2017:"agrupacions_censals_2017",agrupacionsCensals2018:"agrupacions_censals_2018",agrupacionsCensals2019:"agrupacions_censals_2019",agrupacionsCensals2020:"agrupacions_censals_2020",agrupacionsCensals2021:"agrupacions_censals_2021",agrupacionsCensalsVigent:"agrupacions_censals_vigent",agrupacionsCensalsVigentText:"agrupacions_censals_vigent_text",areesBasiquesPolicials2019:"arees_basiques_policials_2019",areesBasiquesPolicials2020:"arees_basiques_policials_2020",areesBasiquesPolicials2022:"arees_basiques_policials_2022",areesBasiquesPolicialsVigent:"arees_basiques_policials_vigent",areesBasiquesPolicialsVigentText:"arees_basiques_policials_vigent_text",areesBasiquesSalutVigent:"arees_basiques_salut_vigent",areesBasiquesServeisSocialsVigent:"arees_basiques_serveis_socials_vigent",areesBasiquesServeisSocialsVigentText:"arees_basiques_serveis_socials_vigent_text",areesGestioAssistencialVigent:"arees_gestio_assistencial_vigent",areesHidrogeologiquesAquifersVigent:"arees_hidrogeologiques_aquifers_vigent",catalunyaVigent:"catalunya_vigent",catalunyaVigentText:"catalunya_vigent_text",comarques2022:"comarques_2022",comarquesVigent:"comarques_vigent",comarquesVigentText:"comarques_vigent_text",districtesCensals2015:"districtes_censals_2015",districtesCensals2016:"districtes_censals_2016",districtesCensals2017:"districtes_censals_2017",districtesCensals2018:"districtes_censals_2018",districtesCensals2019:"districtes_censals_2019",districtesCensals2020:"districtes_censals_2020",districtesCensals2021:"districtes_censals_2021",districtesCensals2022:"districtes_censals_2022",districtesCensalsVigent:"districtes_censals_vigent",districtesCensalsVigentText:"districtes_censals_vigent_text",incendisForestalsVigent:"incendis_forestals_vigent",incendisForestalsVigentText:"incendis_forestals_vigent_text",municipis2022:"municipis_2022",municipis2022Text:"municipis_2022_text",municipisVigent:"municipis_vigent",municipisVigentText:"municipis_vigent_text",partitsJudicialsVigent:"partits_judicials_vigent",partitsJudicialsVigentText:"partits_judicials_vigent_text",plaTerritorial2015:"pla_territorial_2015",plaTerritorialVigent:"pla_territorial_vigent",plaTerritorialVigentText:"pla_territorial_vigent_text",provinciesVigent:"provincies_vigent",provinciesVigentText:"provincies_vigent_text",regionsPolicialsVigent:"regions_policials_vigent",regionsPolicialsVigentText:"regions_policials_vigent_text",regionsSanitariesVigent:"regions_sanitaries_vigent",regionsSanitariesVigentText:"regions_sanitaries_vigent_text",seccionsCensals2015:"seccions_censals_2015",seccionsCensals2016:"seccions_censals_2016",seccionsCensals2017:"seccions_censals_2017",seccionsCensals2018:"seccions_censals_2018",seccionsCensals2019:"seccions_censals_2019",seccionsCensals2020:"seccions_censals_2020",seccionsCensals2021:"seccions_censals_2021",seccionsCensals2022:"seccions_censals_2022",seccionsCensalsVigent:"seccions_censals_vigent",seccionsCensalsVigentText:"seccions_censals_vigent_text",sectorsSanitarisVigent:"sectors_sanitaris_vigent",vegueriesVigent:"vegueries_vigent",vegueriesVigentText:"vegueries_vigent_text"},FGBAdmin:{agrupacionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent.fgb",agrupacionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/agrupacions_censals_vigent_text.fgb",areesBasiquesPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent.fgb",areesBasiquesPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_policials_vigent_text.fgb",areesBasiquesSalutVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_salut_vigent.fgb",areesBasiquesServeisSocialsVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent.fgb",areesBasiquesServeisSocialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/arees_basiques_serveis_socials_vigent_text.fgb",areesGestioAssistencialVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_gestio_assistencial_vigent.fgb",areesHidrogeologiquesAquifersVigent:"https://tilemaps.icgc.cat/vector/fgb/arees_hidrogeologiques_aquifers_vigent.fgb",catalunyaVigent:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent.fgb",catalunyaVigentText:"https://tilemaps.icgc.cat/vector/fgb/catalunya_vigent_text.fgb",comarquesVigent:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent.fgb",comarquesVigentText:"https://tilemaps.icgc.cat/vector/fgb/comarques_vigent_text.fgb",districtesCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent.fgb",districtesCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/districtes_censals_vigent_text.fgb",incendisForestalsVigent:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent.fgb",incendisForestalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/incendis_forestals_vigent_text.fgb",municipisVigent:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent.fgb",municipisVigentText:"https://tilemaps.icgc.cat/vector/fgb/municipis_vigent_text.fgb",partitsJudicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent.fgb",partitsJudicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/partits_judicials_vigent_text.fgb",plaTerritorialVigent:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent.fgb",plaTerritorialVigentText:"https://tilemaps.icgc.cat/vector/fgb/pla_territorial_vigent_text.fgb",provinciesVigent:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent.fgb",provinciesVigentText:"https://tilemaps.icgc.cat/vector/fgb/provincies_vigent_text.fgb",regionsPolicialsVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent.fgb",regionsPolicialsVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_policials_vigent_text.fgb",regionsSanitariesVigent:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent.fgb",regionsSanitariesVigentText:"https://tilemaps.icgc.cat/vector/fgb/regions_sanitaries_vigent_text.fgb",seccionsCensalsVigent:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent.fgb",seccionsCensalsVigentText:"https://tilemaps.icgc.cat/vector/fgb/seccions_censals_vigent_text.fgb",sectorsSanitarisVigent:"https://tilemaps.icgc.cat/vector/fgb/sectors_sanitaris_vigent.fgb",vegueriesVigent:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent.fgb",vegueriesVigentText:"https://tilemaps.icgc.cat/vector/fgb/vegueries_vigent_text.fgb"},Vector:{cobertes2018:"https://tilemaps.icgc.cat/tileserver/cobertes_tilejson.json"},WMS:{espaisInteresGeologic:"https://geoserveis.icgc.cat/servei/catalunya/espais-interes-geologic/wms/service?&service=WMS&request=GetMap&layers=espais-interes-geologic&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",gravimetriaBouguer500000:"https://geoserveis.icgc.cat/servei/catalunya/gravimetria/wms/service?&service=WMS&request=GetMap&layers=anomalia_bouguer_500000&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",cobertesSol2018:"https://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms/service?&service=WMS&request=GetMap&layers=cobertes_2018&styles=&format=image%2Fpng&transparent=true&version=1.1.1&tipus=wms&width=512&height=512&srs=EPSG%3A3857&bbox={bbox-epsg-3857}",administratiu:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/administratiu/MON3857NW/{z}/{x}/{y}.png",simplificat:"http://geoserveis.icgc.cat/servei/catalunya/mapa-base/wmts/simplificat/MON3857NW/{z}/{x}/{y}.png",cims:"https://geoserveis.icgc.cat/icc_100cims/wms/service?REQUEST=GetMap&SERVICE=WMS&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&SRS=EPSG:25831&BBOX=137118.923076923,4488408.75,650959.076923077,4749634.75&WIDTH=895&HEIGHT=455",cobertesSol:"http://geoserveis.icgc.cat/servei/catalunya/cobertes-sol/wms?REQUEST=GetMap&SERVICE=WMS&VERSION=1.3.0&LAYERS=cobertes_2009&STYLES=&FORMAT=image/png&BGCOLOR=0xFFFFFF&TRANSPARENT=TRUE&CRS=EPSG:25831&BBOX=374110.828167253,4639230.79853085,452621.120632226,4703578.45000215&WIDTH=1020&HEIGHT=836"}}};let Js,Vf,o0,Gn,aae=class{constructor(e){qo.get("https://tilemaps.icgc.cat/cdn/configs/mapicgc-config.json").then(t=>{Js=t.data.Layers,Vf=t.data.Styles,o0=t.data.Terrains,Gn=t.data.defaultOptions,this.initTheMap(e)}).catch(t=>{Js=Qf.Layers,Vf=Qf.Styles,o0=Qf.Terrains,Gn=Qf.defaultOptions,console.log("Error en la petici. Carregant configuraci per defecte..."),this.initTheMap(e)})}initTheMap(e){if(!e)e=Gn.mapOptions;else for(const t in Gn.mapOptions){let i=[Gn.mapOptions.center[0],Gn.mapOptions.center[1]];Gn.mapOptions.center=i,e.hasOwnProperty(t)||(e[t]=Gn.mapOptions[t])}e.maxPitch=85,e.maplibreLogo=!1,e.attributionControl=!1,this.map=new Va.Map(e),this.map.options=e,this.map.addControl(new Va.AttributionControl({compact:!0})),this.map.on("load",async()=>{const t=this.map.getStyle().name,i=this.map.options.style;if(window.document.querySelector(".maplibregl-compact-show")){var n=window.document.querySelector(".maplibregl-compact-show");n.classList.remove("maplibregl-compact-show")}this.map.addControl(new Kse({color:i.indexOf("orto")===-1,defaultOptions:Gn}),"bottom-left"),this._dealOrto3dStyle(t)})}addGeocoderICGC(e){try{e===void 0&&(e="top-right");let t={collapsed:!0,marker:!0,popup:!0,showResultMarkers:!0,maplibregl:Va,showResultsWhileTyping:!0,minLength:2};const i={forwardGeocode:async o=>{const a=[];try{const s=Gn.geocoder.peliasUrl1+encodeURIComponent(o.query)+Gn.geocoder.peliasUrl2,y=await(await fetch(s)).json();for(const T of y.features){const I=T.geometry.coordinates,R={type:"Feature",geometry:{type:"Point",coordinates:I},place_name:T.properties.label,properties:T.properties,text:T.properties.label,place_type:["place"],center:I};a.push(R)}}catch(s){console.error(`Failed to forwardGeocode with error: ${s}`)}return{features:a}}};this.map.addControl(new $se(i,t),e);let n=document.getElementsByClassName("maplibregl-ctrl-geocoder--input");n[0].attributes[2].nodeValue="Cerca...",n[0].addEventListener("input",function(o){o.target.value.length>3})}catch(t){console.error(`Error adding ICGC geocoder: ${t.message}`)}}getStyle(){try{return this.map.getStyle()}catch(e){console.error(`Error getting style: ${e.message}`)}}async loadImage(e){try{return this.map.loadImage(e)}catch(t){console.error(`Error getting loadImage: ${t.message}`)}}addImage(e,t){try{return this.map.addImage(e,t)}catch(i){console.error(`Error getting addImage: ${i.message}`)}}getConfigStyles(){try{let e=[];for(const t of Vf)e.push(t.name);return e}catch(e){console.error(`Error retrieving base styles: ${e.message}`)}}getConfigWMSLayers(){try{let e=[];for(const t in Js.WMS)Js.WMS.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving WMS layers: ${e.message}`)}}getConfigOrtoLayers(){try{let e=[];for(const t in Js.Orto)Js.Orto.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving orto image layers: ${e.message}`)}}getConfigVectorLayers(){try{let e=[];for(const t in Js.Vector)Js.Vector.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vector layers: ${e.message}`)}}getConfigVectorAdminLayers(){try{let e=[];for(const t in Js.VectorAdmin)Js.VectorAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving vectorAdmin layers: ${e.message}`)}}getConfigFGBAdminLayers(){try{let e=[];for(const t in Js.FGBAdmin)Js.FGBAdmin.hasOwnProperty(t)&&e.push(t);return e}catch(e){console.error(`Error retrieving FGBAdmin layers: ${e.message}`)}}async fetchData(e,t,i,n){try{if(e.includes(".fgb"))this.addFGBLayerICGC(e,i,null,n);else{const a=await(await fetch(e)).json();let s=t,g="";i==="labels"&&(g=this._firstSymbolLayer()),i==="lines"&&(g=this._firstLineLayer());let y=a.features[0].geometry.type;y.includes("ine")&&(n!==void 0?map.addLayer({id:s,type:"line",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:n},g):map.addLayer({id:s,type:"line",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},g)),y.includes("olygon")&&(n!==void 0?map.addLayer({id:s,type:"fill",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:n},g):map.addLayer({id:s,type:"fill",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"fill-color":"blue","fill-opacity":.6}},g)),y.includes("oint")&&(n!==void 0?map.addLayer({id:s,type:"circle",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:n},g):map.addLayer({id:s,type:"circle",source:{type:"geojson",data:a},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},g))}}catch(o){console.error(`Error fetching data: ${o.message}`)}}async fetchDataAndMenu(e,t,i,n,o){try{const a=document.getElementById("menu-group");let s="visible",g="";n==="labels"&&(g=this._firstSymbolLayer()),n==="lines"&&(g=this._firstLineLayer());let y;if(e.includes(".fgb")){let R=function(he){for(const ce in Js.FGBAdmin)if(Js.FGBAdmin.hasOwnProperty(ce)&&Js.FGBAdmin[ce]===he)return ce;return null}(e);R===null&&(R="userFGB");const U=await fetch(e),Z={type:"FeatureCollection",features:[]};for await(const he of R5(U.body))Z.features.push(he);y=Z;let Y=R;if(this.map.addSource(Y,{type:"geojson",data:Z}),e.includes("text"))this.map.addLayer({id:R,type:"symbol",source:Y,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:s,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},g);else{let he=R+"Text";this.map.addLayer({id:he,type:"symbol",source:Y,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:s,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},g)}}else y=await(await fetch(e)).json();if(i!=="all"){const I=document.createElement("div");I.id="titleDivMenu",I.textContent=t,a.appendChild(I);const R=document.createElement("div");R.id="titleDivMenuSub",R.textContent=` ${i}`,a.appendChild(R)}let T=y.features[0].geometry.type;if(i==="all")T.includes("ine")&&(o!==void 0?map.addLayer({id:t,type:"line",source:{type:"geojson",data:y},layout:{visibility:"visible"},paint:o},g):map.addLayer({id:t,type:"line",source:{type:"geojson",data:y},layout:{visibility:"visible"},paint:{"line-color":"black","line-width":2,"line-opacity":1}},g)),T.includes("olygon")&&(o!==void 0?this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:y},layout:{visibility:"visible"},paint:o},g):this.map.addLayer({id:t,type:"fill",source:{type:"geojson",data:y},layout:{visibility:"visible"},paint:{"fill-color":"#0000FF","fill-opacity":0}},g)),T.includes("oint")&&(o!==void 0?map.addLayer({id:t,type:"circle",source:{type:"geojson",data:y},layout:{visibility:"visible"},paint:o},g):map.addLayer({id:t,type:"circle",source:{type:"geojson",data:y},layout:{visibility:"visible"},paint:{"circle-color":"red","circle-opacity":.85}},g)),map.addMenuItem(t);else{let I=i;const R={};y.features.forEach(U=>{const Z=U.properties[I],Y=Z+"-userFieldFilter-"+t;Z!==null&&(R[Y]||(T.includes("ine")&&(o!==void 0?map.addLayer({id:Y,type:"line",source:{type:"geojson",data:y},layout:{visibility:"visible"},filter:["==",`${I}`,Z],paint:o},g):map.addLayer({id:Y,type:"line",source:{type:"geojson",data:y},layout:{visibility:"visible"},filter:["==",`${I}`,Z],paint:{"line-color":"black","line-width":2,"line-opacity":1}},g)),T.includes("olygon")&&(o!==void 0?map.addLayer({id:Y,type:"fill",source:{type:"geojson",data:y},layout:{visibility:"visible"},filter:["==",`${I}`,Z],paint:o},g):map.addLayer({id:Y,type:"fill",source:{type:"geojson",data:y},layout:{visibility:"visible"},filter:["==",`${I}`,Z],paint:{"fill-color":"blue","fill-opacity":.6}},g)),T.includes("oint")&&(o!==void 0?map.addLayer({id:Y,type:"circle",source:{type:"geojson",data:y},layout:{visibility:"visible"},filter:["==",`${I}`,Z],paint:o},g):map.addLayer({id:Y,type:"circle",source:{type:"geojson",data:y},layout:{visibility:"visible"},filter:["==",`${I}`,Z],paint:{"circle-color":"red","circle-opacity":.85}},g)),R[Y]=!0,map.addMenuItem(Y)))})}}catch(a){console.error(`Error fetching data: ${a.message}`)}}on(e,t){setTimeout(()=>{try{this.map.on(e,t)}catch(i){console.error(`Error adding event ON listener: ${i.message}`)}},500)}getSource(e){try{return this.map.getSource(e)}catch(t){console.error(`Error getting source: ${t.message}`)}}addSource(e,t){try{this.map.addSource(e,t)}catch(i){console.error(`Error adding source: ${i.message}`)}}setStyle(e,t){try{t!==void 0?this.map.setStyle(e,t):this.map.setStyle(e),this.map.on("styledata",()=>{if(window.document.querySelector(".maplibregl-compact-show")){var i=window.document.querySelector(".maplibregl-compact-show");i.classList.remove("maplibregl-compact-show")}this._dealOrto3dStyle(this.map.getStyle().name)})}catch(i){console.error(`Error setting style: ${i.message}`)}}getLayer(e){try{return this.map.getLayer(e)}catch(t){console.error(`Error getting layer: ${t.message}`)}}setFilter(e,t,i){try{return this.map.setFilter(e,t,i)}catch(n){console.error(`Error setting filter: ${n.message}`)}}jumpTo(e){try{this.map.jumpTo(e)}catch(t){console.error(`Error jumping to ${e}: ${t.message}`)}}setLayoutProperty(e,t,i){try{this.map.setLayoutProperty(e,t,i)}catch(n){console.error(`Error setting layout property: ${n.message}`)}}setPaintProperty(e,t,i){try{this.map.setPaintProperty(e,t,i)}catch(n){console.error(`Error setting paint property: ${n.message}`)}}addControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(e,t)}catch(i){console.error(`Error adding control: ${i.message}`)}}getZoom(){try{return this.map.getZoom()}catch(e){console.error(`Error getting zoom level: ${e.message}`)}}addMouseCoordControl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"bottom-left";try{this.map.addControl(new Zse(e),t)}catch(i){console.error(`Error adding mouse coordinate control: ${i.message}`)}}addGeolocateControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new Va.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),t):this.map.addControl(new Va.GeolocateControl(e),t)}catch(i){console.error(`Error adding geolocate control: ${i.message}`)}}addFullscreenControl(e,t){try{t===void 0&&(t="top-right"),e===void 0?this.map.addControl(new Va.FullscreenControl({container:HTMLElement}),t):this.map.addControl(new Va.FullscreenControl(e),t)}catch(i){console.error(`Error adding fullscreen control: ${i.message}`)}}getBounds(){try{return this.map.getBounds()}catch(e){console.error(`Error getting bounds: ${e.message}`)}}getCenter(){try{return this.map.getCenter()}catch(e){console.error(`Error getting center: ${e.message}`)}}setTerrain(e){try{return this.map.setTerrain(e)}catch(t){console.error(`Error setting terrain: ${t.message}`)}}setLayerZoomRange(e,t,i){try{return this.map.setLayerZoomRange(e,t,i)}catch(n){console.error(`Error setting terrain: ${n.message}`)}}getCanvas(){try{return this.map.getCanvas()}catch(e){console.error(`Error getting canvas: ${e.message}`)}}setCenter(e){try{return this.map.setCenter(e)}catch(t){console.error(`Error setting center: ${t.message}`)}}addLayer(e,t){try{this.map.addLayer(e,t)}catch(i){console.error(`Error adding layer: ${i.message}`)}}addLayerGeoJSON(e,t){try{let i="";t==="labels"&&(i=this._firstSymbolLayer()),t==="lines"&&(i=this._firstLineLayer()),this.map.addSource(`${e.id}`,{type:"geojson",data:e.data}),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:e.layerType,source:`${e.id}`,layout:e.layout,paint:e.paint},i)}catch(i){console.error(`Error adding GeoJSON layer: ${i.message}`)}}addLayerWMS(e,t){try{let i="";t==="labels"&&(i=this._firstSymbolLayer()),t==="lines"&&(i=this._firstLineLayer()),this.map.addSource(`${e.id}`,{type:"raster",tiles:[e.tiles],tileSize:256},i),this.map.addLayer({id:`${e.id}-layerIcgcMap`,type:"raster",source:`${e.id}`,paint:{}},i)}catch(i){console.error(`Error adding WMS layer: ${i.message}`)}}removeControl(e){try{this.map.removeControl(e)}catch(t){console.error(`Error removing control: ${t.message}`)}}removeLayer(e){try{this.map.removeLayer(e)}catch(t){console.error(`Error removing layer: ${t.message}`)}}removeSource(e){try{this.map.removeSource(e)}catch(t){console.error(`Error removing source: ${t.message}`)}}addLogo(e,t){try{const i=document.createElement("img");i.src=e.url,i.style.height=e.height;const n=document.getElementById("logos"),o=document.createElement("a");o.id=e.id,o.href=e.href,o.target="_blank",o.style.position="relative",o.style.bottom="1px",o.appendChild(i),n.appendChild(o)}catch(i){console.error(`Error adding logo: ${i.message}`)}}addBasemapsICGC(e){try{const t=n=>{map.setStyle(n)},i=document.getElementById("basemap-group");for(const n of e)for(const o of Object.keys(Gn.baseStyles)){const a=Gn.baseStyles[o];if(n===a.url){const s=document.createElement("div");s.className="basemap-item",s.title=a.key,s.style.backgroundImage=`url('${a.image}')`,i.appendChild(s),s.addEventListener("click",()=>t(a.url))}}}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addBasemaps(e){try{const t=n=>{map.setStyle(n.url)},i=document.getElementById("basemap-group");e.forEach(n=>{const o=document.createElement("div");o.className="basemap-item",o.title=n.label,o.style.backgroundImage=`url('${n.image}')`,i.appendChild(o),o.addEventListener("click",()=>t(n))})}catch(t){console.error(`Error adding basemaps: ${t.message}`)}}addFeatureQuery(e,t,i){try{let n;this.map.on("mouseenter",e,()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave",e,()=>{this.map.getCanvas().style.cursor=""}),this.map.on("click",o=>{let a=this.map.queryRenderedFeatures(o.point);if(a&&a[0].source.includes(e)){let s=[o.lngLat.lng,o.lngLat.lat];if(t!==void 0&&t.length>0&&t!=="all"){if(t!==null){let g="";t.forEach(y=>{let T=a[0].properties[y];g=g+`<h4>${T}</h4>`}),n=g,map.addPopup(s,n,i)}}else{let g="";for(const y in a[0].properties)g+="<b>"+y+"</b>:"+a[0].properties[y]+"<br>";n=g,map.addPopup(s,n,i)}}})}catch(n){console.error(`Error adding feature query: ${n.message}`)}}addScaleControl(e,t){try{var i=new Va.ScaleControl(e);this.map.addControl(i,t)}catch(n){console.error(`Error adding scale: ${n.message}`)}}addExportControl(e,t){try{typeof e=="string"&&(t=e,e=void 0),e===void 0&&(e={PageSize:Qg.A4,PageOrientation:t0.Landscape,Format:Td.PNG,DPI:sE[300],Crosshair:!0,PrintableArea:!0},t="top-right"),map.addControl(new ise(e),t)}catch(i){console.error(`Error adding export control: ${i.message}`)}}addPopup(e,t){try{new Va.Popup().setLngLat(e).setHTML(t).addTo(this.map)}catch{}}addMarker(e){try{let t,i;return e.text===void 0?t=new Va.Marker(e.options).setLngLat(e.coord).addTo(this.map):(i=new Va.Popup({offset:e.textOffset}).setText(e.text),t=new Va.Marker().setLngLat(e.coord).setPopup(i).addTo(this.map)),t}catch(t){return console.error(`Error adding marker: ${t.message}`),null}}addPopup(e,t,i){try{return i.image===void 0?new Va.Popup().setLngLat(e).setHTML(`
       
        <div class="popupBody">
          
          <div class="popupTop">
          ${i.title}
        
          </div>
          
          <div class="popupBottom">
          <div class="popupBottomUp">
 ${t}
        
          </div>
          <div class="popupBottomDown">
             
          </div>
         
            
          </div>
        </div>
      `).addTo(this.map):new Va.Popup().setLngLat(e).setHTML(`
       
        <div class="popupBody">
          
          <div class="popupTop">
          ${i.title}
        
          </div>
          
          <div class="popupBottom">
          <div class="popupBottomUp">
          ${t}
        
          </div>
          <div class="popupBottomDown">
             <img style="  padding: 8px;  width: 50%;" src=${i.image} />
          </div>
         
            
          </div>
        </div>
      `).addTo(this.map)}catch(n){return console.error(`Error adding popup: ${n.message}`),null}}addFullScreen(e){try{e===void 0&&(e="top-right"),this.map.addControl(new Va.FullscreenControl,e)}catch(t){console.error(`Error adding fullscreen control: ${t.message}`)}}addMenuItem(e){try{let t;if(e.includes("-userFieldFilter-")?t=e.split("-userFieldFilter-")[0]:t=e,e.length>0){const i=document.getElementById("menu-group"),n=document.createElement("input");n.type="checkbox",n.id=e,n.checked=!0,i.appendChild(n);const o=document.createElement("label");o.setAttribute("for",e),o.textContent=t,i.appendChild(o),n.addEventListener("change",a=>{this.map.setLayoutProperty(e,"visibility",a.target.checked?"visible":"none")})}}catch(t){console.error(`Error adding menu item: ${t.message}`)}}addLayerTree(e){try{let t=e.features;const i=document.getElementById("filter-group");this.map.addSource(`${e.id}`,{type:e.type,data:t}),t.features.forEach(n=>{const o=n.properties.icon,a=`poi-${o}`;if(!this.map.getLayer(a)){this.map.addLayer({id:a,type:"circle",source:`${e.id}`,paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","icon",o]},this._firstSymbolLayer());const s=document.createElement("input");s.type="checkbox",s.id=a,s.checked=!0,i.appendChild(s);const g=document.createElement("label");g.setAttribute("for",a),g.textContent=o,i.appendChild(g),s.addEventListener("change",y=>{this.map.setLayoutProperty(a,"visibility",y.target.checked?"visible":"none")})}})}catch(t){console.error(`Error adding layer tree: ${t.message}`)}}createNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new Va.NavigationControl(e),t)}catch(i){return console.error(`Error creating navigation control: ${i.message}`),null}}addNavigationControl(e,t){try{t===void 0&&(t="top-right"),this.map.addControl(new Va.NavigationControl(e),t)}catch(i){console.error(`Error adding navigation control: ${i.message}`)}}addAttributionControl(e,t){try{this.map.addControl(new Va.AttributionControl(e),t)}catch(i){console.error(`Error adding attribution control: ${i.message}`)}}_dealStyleMaps(e){try{if(e&&e.indexOf("icgc.cat")!=-1){for(const t in Vf)if(Vf.hasOwnProperty(t)){const i=Vf[t];if(t===e)return i}return Vf[0]}else return e}catch(t){return console.error(`Error dealing with map styles: ${t.message}`),null}}addImageLayerICGC(e,t){try{let n=function(a,s,g,y,T){const I=[s,g,y,T];for(const R of I)for(const[U,Z]of Object.entries(R))if(Z===a)return U;return null},i=null;i=n(e,Js.Orto,Js.VectorAdmin,Js.WMS,Js.Vector),i||console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",e,"font-weight: bold; font-style: italic;");let o={id:i,tiles:e};this.addLayerWMS(o,t)}catch(i){console.error(`Error adding ICGC image layer: ${i.message}`)}}async addVectorLayerICGC(e,t,i,n){try{let o="";t==="labels"&&(o=this._firstSymbolLayer()),t==="lines"&&(o=this._firstLineLayer());let a=e;if(a===null)console.log(" %c The layer: %c%s%c does not exist in the ICGC DB. Consult the documentation.","font-weight: bold; font-style: italic;","font-weight: normal; font-style: normal; color: red;",a,"font-weight: bold; font-style: italic;");else if(e.includes("https")){let s=function(I){for(const R in Js.Vector)if(Js.Vector.hasOwnProperty(R)&&Js.Vector[R]===I)return R;return null},y=function(I){for(const R in Gn.vectorLayers){const U=Gn.vectorLayers[R];if(U.key===I)return U.legend}return null},g=s(e);this.map.addSource(g,{type:"vector",url:e}),g==="cobertes2018"&&map.addLayer({id:g,type:"fill",source:g,"source-layer":"cobertes",maxzoom:18,layout:{visibility:"visible"},paint:{"fill-opacity":["interpolate",["exponential",.5],["zoom"],13.5,1,18,.4],"fill-outline-color":"rgba(0,0, 0, 0)","fill-color":["interpolate",["cubic-bezier",.5,1,1,1],["get","nivell_2"],0,"#ffffff",111,"#ffff00",112,"#ccff33",113,"#af5b15",114,"#808000",115,"#cdcd00",116,"#ffffcc",221,"#33cc33",222,"#66ff33",223,"#689018",224,"#967d5f",225,"#19e61e",226,"#b4ff9b",227,"#aaa500",228,"#c3c3a0",229,"#00ff9b",230,"#ff9632",231,"#282828",232,"#79797a",233,"#f5df78",234,"#3296ff",341,"#ff007d",342,"#ff53cd",343,"#ffa4e2",344,"#ffc8e2",345,"#ffb4b4",346,"#0f3700",347,"#730055",348,"#6200c4",349,"#4a9595",350,"#ff00f0",351,"#adaaca",352,"#ffe6e6",353,"#67629a",354,"#4a466e",355,"#2f2d46",461,"#6f6fff",462,"#0000dc",463,"#000064",464,"#185f94",465,"#12466d",466,"#000080"]}},o);let T=y(g);i==="visible"&&map.addLegend(g,T)}else{let s="limitsSource";this.map.addSource(s,{type:"vector",url:Gn.limitsUrl}),this.map.addLayer({id:a+"-fill",type:"fill",source:s,"source-layer":a,layout:{visibility:i},paint:{"fill-color":"#0000FF","fill-opacity":0}},o),this.map.addLayer({id:a+"-underline",type:"line",source:s,"source-layer":a,layout:{visibility:i},paint:{"line-color":"#ffffff","line-opacity":1,"line-width":3}},o),n?this.map.addLayer({id:a+"-line",type:"line",source:s,"source-layer":a,layout:{visibility:i},paint:n},o):this.map.addLayer({id:a+"-line",type:"line",source:s,layout:{visibility:i},"source-layer":a,paint:{"line-color":"#4832a8","line-opacity":1,"line-width":1}},o)}}catch(o){console.error(`Error adding ICGC vector layer: ${o.message}`)}}async addFGBLayerICGC(e,t,i){try{let a=function(I){for(const R in Js.FGBAdmin)if(Js.FGBAdmin.hasOwnProperty(R)&&Js.FGBAdmin[R]===I)return R;return null},n="visible",o="";t==="labels"&&(o=this._firstSymbolLayer()),t==="lines"&&(o=this._firstLineLayer());let s=a(e);s===null&&(s="userFGB");const g=await fetch(e),y={type:"FeatureCollection",features:[]};for await(const I of R5(g.body))y.features.push(I);let T=s;if(this.map.addSource(T,{type:"geojson",data:y}),e.includes("text"))this.map.addLayer({id:s,type:"symbol",source:T,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:n,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},o);else{this.map.addLayer({id:s+"-fill",type:"fill",source:T,paint:{"fill-color":"#0000FF","fill-opacity":0}},o),this.map.addLayer({id:s+"-underline",type:"line",source:T,paint:{"line-color":"#ffffff","line-opacity":1,"line-width":3}},o),i?this.map.addLayer({id:s+"-line",type:"line",source:T,paint:i},o):this.map.addLayer({id:s+"-line",type:"line",source:T,paint:{"line-color":"#4832a8","line-opacity":1,"line-width":1}},o);let I=s+"Text";this.map.addLayer({id:I,type:"symbol",source:T,layout:{"text-letter-spacing":.1,"text-size":{base:1.2,stops:[[8,0],[12,14],[15,15]]},"text-font":["FiraSans-Regular"],"text-field":["get","NOM_AC"],"text-transform":"none","text-max-width":25,visibility:n,"text-justify":"right","text-anchor":"top","text-allow-overlap":!1,"symbol-spacing":2,"text-line-height":1},paint:{"text-halo-blur":.5,"text-color":"rgba(90, 7, 7, 1)","text-halo-width":2,"text-halo-color":"rgba(255, 255, 255,0.8)"}},o)}}catch(n){console.error(`Error adding ICGC FGB layer: ${n.message}`)}}addTerrainICGC(e,t){try{let i;for(const o in o0)if(o0.hasOwnProperty(o)){const a=o0[o];a===e&&(i=a)}let n=i;this.getSource("terrainICGC")!==void 0&&(this.getStyle().layers.forEach(a=>{a.source==="terrainICGC"&&this.removeLayer(a.id)}),this.removeSource("terrainICGC")),this.getSource("terrainICGC")===void 0&&(e.includes("terrarium")?this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[n],tileSize:512,encoding:"terrarium",maxzoom:16}):this.map.addSource("terrainICGC",{type:"raster-dem",tiles:[n],tileSize:512,maxzoom:16})),this.map.setTerrain({source:"terrainICGC",exaggeration:1.5}),t===void 0&&(t="top-right"),this.map.addControl(new cQ({pitch:90,bearing:null,minpitchzoom:null}),t)}catch(i){console.error(`Error adding 3D terrain: ${i.message}`)}}addLegend(e,t){try{(function(){var n=document.createElement("link");n.rel="stylesheet",n.href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css";var o=document.createElement("script");o.src="https://code.jquery.com/jquery-3.6.0.min.js";var a=document.createElement("script");a.src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js";var s=document.head||document.getElementsByTagName("head")[0];s.appendChild(n),o.onload=function(){s.appendChild(a),$(document).ready(function(){const g=document.createElement("div");g.id="legendContainer",g.innerHTML=`<img src=${t} alt="Legend" >`,g.style.display="none",document.body.appendChild(g),a.onload=function(){$(function(){$("#legendContainer").draggable(),$("#legendContainer").resizable()})},s.appendChild(o);const y=document.createElement("div");y.id="toggleLegend",y.innerHTML="<span>&#x2630;</span>",document.body.appendChild(y),y.addEventListener("click",function(){g.style.display==="none"?g.style.display="block":g.style.display="none"})})},s.appendChild(o)})()}catch(i){console.error(`Error adding legend: ${i.message}`)}}async _raiseText3DStyle(){try{const e=await this.map.loadImage(Gn.map3dOptions.imageIcon);this.map.addImage("stick",e.data),this.map.getStyle().layers.forEach(t=>{if(t["source-layer"]===Gn.map3dOptions.sourceLayerFilterId&&t.minzoom>=Gn.map3dOptions.minZoomFilter&&e){const i=t.id;this.map.setLayoutProperty(i,"icon-image","stick"),this.map.setLayoutProperty(i,"text-offset",[0,-9]),this.map.setLayoutProperty(i,"symbol-placement","point"),this.map.setLayoutProperty(i,"symbol-avoid-edges",!1),this.map.setLayoutProperty(i,"text-allow-overlap",!0),this.map.setLayoutProperty(i,"text-ignore-placement",!1),this.map.setLayoutProperty(i,"text-pitch-alignment","auto"),this.map.setLayoutProperty(i,"text-rotation-alignment","auto"),this.map.setLayoutProperty(i,"text-justify","center"),this.map.setLayoutProperty(i,"text-anchor","bottom"),this.map.setLayoutProperty(i,"icon-anchor","bottom"),this.map.setPaintProperty(i,"text-color","#ffffff"),this.map.setPaintProperty(i,"text-halo-color","#000000"),this.map.setPaintProperty(i,"text-halo-width",2)}})}catch(e){return console.error(`Error dealing orto 3D: ${e.message}`),null}}_dealOrto3dStyle(e){try{if(e=="orto3d"){this.map.setMaxZoom(18.8),this.map.easeTo({pitch:45});const t=new EM({intensity:4}),i=new dB({ambientLight:t});this.map.setTerrain({source:Gn.map3dOptions.terrainSource,exaggeration:Gn.map3dOptions.exaggeration});const n=this._createCitiesMapboxLayer();this.map.getLayer(Gn.map3dOptions.layerId3d)||(this.map.addLayer(n,Gn.map3dOptions.layerIdOrder),this.map.setLayerZoomRange(Gn.map3dOptions.layerId3d,Gn.map3dOptions.minZoomRange,Gn.map3dOptions.maxZoomRange),n.deck.setProps({effects:[i]}),this._raiseText3DStyle())}else this.map.getLayer(Gn.map3dOptions.layerId3d)&&(this.map.removeLayer(Gn.map3dOptions.layerId3d),this.map.setTerrain(null))}catch(t){return console.error(`Error dealing orto 3D: ${t.message}`),null}}_firstSymbolLayer(){try{const e=this.map.getStyle().layers;let t;for(let i=0;i<e.length;i++)if(e[i].type==="symbol"){t=e[i].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_firstLineLayer(){try{const e=this.map.getStyle().layers;let t;for(let i=0;i<e.length;i++)if(e[i].type==="line"){t=e[i].id;break}return t}catch(e){console.error(`Error getting first symbol layer: ${e.message}`)}}_createCitiesMapboxLayer(){try{return new zZ({id:Gn.map3dOptions.layerId3d,type:OC,data:Gn.map3dOptions.urlTilesetCities,loader:kC,loadOptions:{tileset:{viewDistanceScale:1,updateTransforms:!0,maximumScreenSpaceError:Gn.map3dOptions.spaceErrorFactor}},onTilesetLoad:t=>{t.options.maximumScreenSpaceError=Gn.map3dOptions.spaceErrorFactor},onTileLoad:t=>{t.content.cartographicOrigin.z-=Gn.map3dOptions.zfactor},operation:"terrain+draw"})}catch(e){return console.error(`Error adding MapboxLayer: ${e.message}`),null}}};var OR={exports:{}};function lae(r,e){var t=r.getCenter(),i=r.getZoom(),n=r.getBearing(),o=r.getPitch();e.forEach(function(a){a.jumpTo({center:t,zoom:i,bearing:n,pitch:o})})}function cae(){var r,e=arguments.length;if(e===1)r=arguments[0];else{r=[];for(var t=0;t<e;t++)r.push(arguments[t])}var i=[];r.forEach(function(s,g){i[g]=a.bind(null,s,r.filter(function(y,T){return T!==g}))});function n(){r.forEach(function(s,g){s.on("move",i[g])})}function o(){r.forEach(function(s,g){s.off("move",i[g])})}function a(s,g){o(),lae(s,g),n()}return n(),function(){o(),i=[],r=[]}}var uae=cae;(function(r){var e=uae,t=YD.EventEmitter;function i(n,o,a,s){if(this.options=s||{},this._mapA=n,this._mapB=o,this._horizontal=this.options.orientation==="horizontal",this._onDown=this._onDown.bind(this),this._onMove=this._onMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._ev=new t,this._swiper=document.createElement("div"),this._swiper.className=this._horizontal?"compare-swiper-horizontal":"compare-swiper-vertical",this._controlContainer=document.createElement("div"),this._controlContainer.className=this._horizontal?"maplibregl-compare maplibregl-compare-horizontal":"maplibregl-compare",this._controlContainer.className=this._controlContainer.className,this._controlContainer.appendChild(this._swiper),typeof a=="string"&&document.body.querySelectorAll){var g=document.body.querySelectorAll(a)[0];if(!g)throw new Error("Cannot find element with specified container selector.");g.appendChild(this._controlContainer)}else if(a instanceof Element&&a.appendChild)a.appendChild(this._controlContainer);else throw new Error("Invalid container specified. Must be CSS selector or HTML element.");this._bounds=o.getContainer().getBoundingClientRect();var y=(this._horizontal?this._bounds.height:this._bounds.width)/2;this._setPosition(y),this._clearSync=e(n,o),this._onResize=(function(){this._bounds=o.getContainer().getBoundingClientRect(),this.currentPosition&&this._setPosition(this.currentPosition)}).bind(this),o.on("resize",this._onResize),this.options&&this.options.mousemove&&(n.getContainer().addEventListener("mousemove",this._onMove),o.getContainer().addEventListener("mousemove",this._onMove)),this._swiper.addEventListener("mousedown",this._onDown),this._swiper.addEventListener("touchstart",this._onDown)}i.prototype={_setPointerEvents:function(n){this._controlContainer.style.pointerEvents=n,this._swiper.style.pointerEvents=n},_onDown:function(n){n.touches?(document.addEventListener("touchmove",this._onMove),document.addEventListener("touchend",this._onTouchEnd)):(document.addEventListener("mousemove",this._onMove),document.addEventListener("mouseup",this._onMouseUp))},_setPosition:function(n){n=Math.min(n,this._horizontal?this._bounds.height:this._bounds.width);var o=this._horizontal?"translate(0, "+n+"px)":"translate("+n+"px, 0)";this._controlContainer.style.transform=o,this._controlContainer.style.WebkitTransform=o;var a=this._horizontal?"rect(0, 999em, "+n+"px, 0)":"rect(0, "+n+"px, "+this._bounds.height+"px, 0)",s=this._horizontal?"rect("+n+"px, 999em, "+this._bounds.height+"px,0)":"rect(0, 999em, "+this._bounds.height+"px,"+n+"px)";this._mapA.getContainer().style.clip=a,this._mapB.getContainer().style.clip=s,this.currentPosition=n},_onMove:function(n){this.options&&this.options.mousemove&&this._setPointerEvents(n.touches?"auto":"none"),this._horizontal?this._setPosition(this._getY(n)):this._setPosition(this._getX(n))},_onMouseUp:function(){document.removeEventListener("mousemove",this._onMove),document.removeEventListener("mouseup",this._onMouseUp),this.fire("slideend",{currentPosition:this.currentPosition})},_onTouchEnd:function(){document.removeEventListener("touchmove",this._onMove),document.removeEventListener("touchend",this._onTouchEnd),this.fire("slideend",{currentPosition:this.currentPosition})},_getX:function(n){n=n.touches?n.touches[0]:n;var o=n.clientX-this._bounds.left;return o<0&&(o=0),o>this._bounds.width&&(o=this._bounds.width),o},_getY:function(n){n=n.touches?n.touches[0]:n;var o=n.clientY-this._bounds.top;return o<0&&(o=0),o>this._bounds.height&&(o=this._bounds.height),o},setSlider:function(n){this._setPosition(n)},on:function(n,o){return this._ev.on(n,o),this},fire:function(n,o){return this._ev.emit(n,o),this},off:function(n,o){return this._ev.removeListener(n,o),this},remove:function(){this._clearSync(),this._mapB.off("resize",this._onResize);var n=this._mapA.getContainer();n&&(n.style.clip=null,n.removeEventListener("mousemove",this._onMove));var o=this._mapB.getContainer();o&&(o.style.clip=null,o.removeEventListener("mousemove",this._onMove)),this._swiper.removeEventListener("mousedown",this._onDown),this._swiper.removeEventListener("touchstart",this._onDown),this._controlContainer.remove()}},window.maplibregl?maplibregl.Compare=i:r.exports=i})(OR);var hae=OR.exports;const Aae=Wm(hae);class dae{constructor(e,t,i,n){this.mapCompare=new Aae(e.map,t.map,i,{})}}Ll.Layers=void 0,Ll.Styles=void 0,Ll.Terrains=void 0,qo.get("https://tilemaps.icgc.cat/cdn/configs/mapicgc-config.json").then(r=>{Ll.Layers=r.data.Layers,Ll.Styles=r.data.Styles,Ll.Terrains=r.data.Terrains}).catch(r=>{Ll.Layers=Qf.Layers,Ll.Styles=Qf.Styles,Ll.Terrains=Qf.Terrains});/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var CE=function(r,e){return CE=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},CE(r,e)};function mh(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");CE(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var EE=function(){return EE=Object.assign||function(r){for(var e,t=1,i=arguments.length;t<i;t++){e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n])}return r},EE.apply(this,arguments)};function pc(r,e,t,i){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(T){try{y(i.next(T))}catch(I){a(I)}}function g(T){try{y(i.throw(T))}catch(I){a(I)}}function y(T){T.done?o(T.value):n(T.value).then(s,g)}y((i=i.apply(r,e||[])).next())})}function zl(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,n,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(y){return function(T){return g([y,T])}}function g(y){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(o=y[0]&2?n.return:y[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,y[1])).done)return o;switch(n=0,o&&(y=[y[0]&2,o.value]),y[0]){case 0:case 1:o=y;break;case 4:return t.label++,{value:y[1],done:!1};case 5:t.label++,n=y[1],y=[0];continue;case 7:y=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(y[0]===6||y[0]===2)){t=0;continue}if(y[0]===3&&(!o||y[1]>o[0]&&y[1]<o[3])){t.label=y[1];break}if(y[0]===6&&t.label<o[1]){t.label=o[1],o=y;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(y);break}o[2]&&t.ops.pop(),t.trys.pop();continue}y=e.call(r,t)}catch(T){y=[6,T],n=0}finally{i=o=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function kv(r,e,t){if(t||arguments.length===2)for(var i=0,n=e.length,o;i<n;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return r.concat(o||e)}for(var zA=function(){function r(e,t,i,n){this.left=e,this.top=t,this.width=i,this.height=n}return r.prototype.add=function(e,t,i,n){return new r(this.left+e,this.top+t,this.width+i,this.height+n)},r.fromClientRect=function(e,t){return new r(t.left+e.windowBounds.left,t.top+e.windowBounds.top,t.width,t.height)},r.fromDOMRectList=function(e,t){var i=Array.from(t).find(function(n){return n.width!==0});return i?new r(i.left+e.windowBounds.left,i.top+e.windowBounds.top,i.width,i.height):r.EMPTY},r.EMPTY=new r(0,0,0,0),r}(),Ov=function(r,e){return zA.fromClientRect(r,e.getBoundingClientRect())},fae=function(r){var e=r.body,t=r.documentElement;if(!e||!t)throw new Error("Unable to get document size");var i=Math.max(Math.max(e.scrollWidth,t.scrollWidth),Math.max(e.offsetWidth,t.offsetWidth),Math.max(e.clientWidth,t.clientWidth)),n=Math.max(Math.max(e.scrollHeight,t.scrollHeight),Math.max(e.offsetHeight,t.offsetHeight),Math.max(e.clientHeight,t.clientHeight));return new zA(0,0,i,n)},Uv=function(r){for(var e=[],t=0,i=r.length;t<i;){var n=r.charCodeAt(t++);if(n>=55296&&n<=56319&&t<i){var o=r.charCodeAt(t++);(o&64512)===56320?e.push(((n&1023)<<10)+(o&1023)+65536):(e.push(n),t--)}else e.push(n)}return e},$o=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var t=r.length;if(!t)return"";for(var i=[],n=-1,o="";++n<t;){var a=r[n];a<=65535?i.push(a):(a-=65536,i.push((a>>10)+55296,a%1024+56320)),(n+1===t||i.length>16384)&&(o+=String.fromCharCode.apply(String,i),i.length=0)}return o},UR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",pae=typeof Uint8Array>"u"?[]:new Uint8Array(256),Nv=0;Nv<UR.length;Nv++)pae[UR.charCodeAt(Nv)]=Nv;for(var NR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a0=typeof Uint8Array>"u"?[]:new Uint8Array(256),zv=0;zv<NR.length;zv++)a0[NR.charCodeAt(zv)]=zv;for(var gae=function(r){var e=r.length*.75,t=r.length,i,n=0,o,a,s,g;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);var y=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),T=Array.isArray(y)?y:new Uint8Array(y);for(i=0;i<t;i+=4)o=a0[r.charCodeAt(i)],a=a0[r.charCodeAt(i+1)],s=a0[r.charCodeAt(i+2)],g=a0[r.charCodeAt(i+3)],T[n++]=o<<2|a>>4,T[n++]=(a&15)<<4|s>>2,T[n++]=(s&3)<<6|g&63;return y},mae=function(r){for(var e=r.length,t=[],i=0;i<e;i+=2)t.push(r[i+1]<<8|r[i]);return t},yae=function(r){for(var e=r.length,t=[],i=0;i<e;i+=4)t.push(r[i+3]<<24|r[i+2]<<16|r[i+1]<<8|r[i]);return t},Hf=5,SE=11,TE=2,_ae=SE-Hf,zR=65536>>Hf,vae=1<<Hf,IE=vae-1,bae=1024>>Hf,xae=zR+bae,wae=xae,Bae=32,Cae=wae+Bae,Eae=65536>>SE,Sae=1<<_ae,Tae=Sae-1,QR=function(r,e,t){return r.slice?r.slice(e,t):new Uint16Array(Array.prototype.slice.call(r,e,t))},Iae=function(r,e,t){return r.slice?r.slice(e,t):new Uint32Array(Array.prototype.slice.call(r,e,t))},Lae=function(r,e){var t=gae(r),i=Array.isArray(t)?yae(t):new Uint32Array(t),n=Array.isArray(t)?mae(t):new Uint16Array(t),o=24,a=QR(n,o/2,i[4]/2),s=i[5]===2?QR(n,(o+i[4])/2):Iae(i,Math.ceil((o+i[4])/4));return new Mae(i[0],i[1],i[2],i[3],a,s)},Mae=function(){function r(e,t,i,n,o,a){this.initialValue=e,this.errorValue=t,this.highStart=i,this.highValueIndex=n,this.index=o,this.data=a}return r.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>Hf],t=(t<<TE)+(e&IE),this.data[t];if(e<=65535)return t=this.index[zR+(e-55296>>Hf)],t=(t<<TE)+(e&IE),this.data[t];if(e<this.highStart)return t=Cae-Eae+(e>>SE),t=this.index[t],t+=e>>Hf&Tae,t=this.index[t],t=(t<<TE)+(e&IE),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),VR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Pae=typeof Uint8Array>"u"?[]:new Uint8Array(256),Qv=0;Qv<VR.length;Qv++)Pae[VR.charCodeAt(Qv)]=Qv;var Fae="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",HR=50,Dae=1,GR=2,jR=3,Rae=4,kae=5,qR=7,$R=8,KR=9,Ld=10,LE=11,WR=12,ME=13,Oae=14,l0=15,PE=16,Vv=17,c0=18,Uae=19,XR=20,FE=21,u0=22,DE=23,qg=24,Au=25,h0=26,A0=27,$g=28,Nae=29,Kg=30,zae=31,Hv=32,Gv=33,RE=34,kE=35,OE=36,d0=37,UE=38,jv=39,qv=40,NE=41,ZR=42,Qae=43,Vae=[9001,65288],JR="!",gc="",$v="",zE=Lae(Fae),QA=[Kg,OE],QE=[Dae,GR,jR,kae],YR=[Ld,$R],ek=[A0,h0],Hae=QE.concat(YR),tk=[UE,jv,qv,RE,kE],Gae=[l0,ME],jae=function(r,e){e===void 0&&(e="strict");var t=[],i=[],n=[];return r.forEach(function(o,a){var s=zE.get(o);if(s>HR?(n.push(!0),s-=HR):n.push(!1),["normal","auto","loose"].indexOf(e)!==-1&&[8208,8211,12316,12448].indexOf(o)!==-1)return i.push(a),t.push(PE);if(s===Rae||s===LE){if(a===0)return i.push(a),t.push(Kg);var g=t[a-1];return Hae.indexOf(g)===-1?(i.push(i[a-1]),t.push(g)):(i.push(a),t.push(Kg))}if(i.push(a),s===zae)return t.push(e==="strict"?FE:d0);if(s===ZR||s===Nae)return t.push(Kg);if(s===Qae)return o>=131072&&o<=196605||o>=196608&&o<=262141?t.push(d0):t.push(Kg);t.push(s)}),[i,t,n]},VE=function(r,e,t,i){var n=i[t];if(Array.isArray(r)?r.indexOf(n)!==-1:r===n)for(var o=t;o<=i.length;){o++;var a=i[o];if(a===e)return!0;if(a!==Ld)break}if(n===Ld)for(var o=t;o>0;){o--;var s=i[o];if(Array.isArray(r)?r.indexOf(s)!==-1:r===s)for(var g=t;g<=i.length;){g++;var a=i[g];if(a===e)return!0;if(a!==Ld)break}if(s!==Ld)break}return!1},rk=function(r,e){for(var t=r;t>=0;){var i=e[t];if(i===Ld)t--;else return i}return 0},qae=function(r,e,t,i,n){if(t[i]===0)return gc;var o=i-1;if(Array.isArray(n)&&n[o]===!0)return gc;var a=o-1,s=o+1,g=e[o],y=a>=0?e[a]:0,T=e[s];if(g===GR&&T===jR)return gc;if(QE.indexOf(g)!==-1)return JR;if(QE.indexOf(T)!==-1||YR.indexOf(T)!==-1)return gc;if(rk(o,e)===$R)return $v;if(zE.get(r[o])===LE||(g===Hv||g===Gv)&&zE.get(r[s])===LE||g===qR||T===qR||g===KR||[Ld,ME,l0].indexOf(g)===-1&&T===KR||[Vv,c0,Uae,qg,$g].indexOf(T)!==-1||rk(o,e)===u0||VE(DE,u0,o,e)||VE([Vv,c0],FE,o,e)||VE(WR,WR,o,e))return gc;if(g===Ld)return $v;if(g===DE||T===DE)return gc;if(T===PE||g===PE)return $v;if([ME,l0,FE].indexOf(T)!==-1||g===Oae||y===OE&&Gae.indexOf(g)!==-1||g===$g&&T===OE||T===XR||QA.indexOf(T)!==-1&&g===Au||QA.indexOf(g)!==-1&&T===Au||g===A0&&[d0,Hv,Gv].indexOf(T)!==-1||[d0,Hv,Gv].indexOf(g)!==-1&&T===h0||QA.indexOf(g)!==-1&&ek.indexOf(T)!==-1||ek.indexOf(g)!==-1&&QA.indexOf(T)!==-1||[A0,h0].indexOf(g)!==-1&&(T===Au||[u0,l0].indexOf(T)!==-1&&e[s+1]===Au)||[u0,l0].indexOf(g)!==-1&&T===Au||g===Au&&[Au,$g,qg].indexOf(T)!==-1)return gc;if([Au,$g,qg,Vv,c0].indexOf(T)!==-1)for(var I=o;I>=0;){var R=e[I];if(R===Au)return gc;if([$g,qg].indexOf(R)!==-1)I--;else break}if([A0,h0].indexOf(T)!==-1)for(var I=[Vv,c0].indexOf(g)!==-1?a:o;I>=0;){var R=e[I];if(R===Au)return gc;if([$g,qg].indexOf(R)!==-1)I--;else break}if(UE===g&&[UE,jv,RE,kE].indexOf(T)!==-1||[jv,RE].indexOf(g)!==-1&&[jv,qv].indexOf(T)!==-1||[qv,kE].indexOf(g)!==-1&&T===qv||tk.indexOf(g)!==-1&&[XR,h0].indexOf(T)!==-1||tk.indexOf(T)!==-1&&g===A0||QA.indexOf(g)!==-1&&QA.indexOf(T)!==-1||g===qg&&QA.indexOf(T)!==-1||QA.concat(Au).indexOf(g)!==-1&&T===u0&&Vae.indexOf(r[s])===-1||QA.concat(Au).indexOf(T)!==-1&&g===c0)return gc;if(g===NE&&T===NE){for(var U=t[o],Z=1;U>0&&(U--,e[U]===NE);)Z++;if(Z%2!==0)return gc}return g===Hv&&T===Gv?gc:$v},$ae=function(r,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var t=jae(r,e.lineBreak),i=t[0],n=t[1],o=t[2];(e.wordBreak==="break-all"||e.wordBreak==="break-word")&&(n=n.map(function(s){return[Au,Kg,ZR].indexOf(s)!==-1?d0:s}));var a=e.wordBreak==="keep-all"?o.map(function(s,g){return s&&r[g]>=19968&&r[g]<=40959}):void 0;return[i,n,a]},Kae=function(){function r(e,t,i,n){this.codePoints=e,this.required=t===JR,this.start=i,this.end=n}return r.prototype.slice=function(){return $o.apply(void 0,this.codePoints.slice(this.start,this.end))},r}(),Wae=function(r,e){var t=Uv(r),i=$ae(t,e),n=i[0],o=i[1],a=i[2],s=t.length,g=0,y=0;return{next:function(){if(y>=s)return{done:!0,value:null};for(var T=gc;y<s&&(T=qae(t,o,n,++y,a))===gc;);if(T!==gc||y===s){var I=new Kae(t,T,g,y);return g=y,{value:I,done:!1}}return{done:!0,value:null}}}},Xae=1,Zae=2,f0=4,ik=8,Kv=10,nk=47,p0=92,Jae=9,Yae=32,Wv=34,g0=61,ele=35,tle=36,rle=37,Xv=39,Zv=40,m0=41,ile=95,zc=45,nle=33,sle=60,ole=62,ale=64,lle=91,cle=93,ule=61,hle=123,Jv=63,Ale=125,sk=124,dle=126,fle=128,ok=65533,HE=42,Gf=43,ple=44,gle=58,mle=59,y0=46,yle=0,_le=8,vle=11,ble=14,xle=31,wle=127,rA=-1,ak=48,lk=97,ck=101,Ble=102,Cle=117,Ele=122,uk=65,hk=69,Ak=70,Sle=85,Tle=90,mc=function(r){return r>=ak&&r<=57},Ile=function(r){return r>=55296&&r<=57343},Wg=function(r){return mc(r)||r>=uk&&r<=Ak||r>=lk&&r<=Ble},Lle=function(r){return r>=lk&&r<=Ele},Mle=function(r){return r>=uk&&r<=Tle},Ple=function(r){return Lle(r)||Mle(r)},Fle=function(r){return r>=fle},Yv=function(r){return r===Kv||r===Jae||r===Yae},eb=function(r){return Ple(r)||Fle(r)||r===ile},dk=function(r){return eb(r)||mc(r)||r===zc},Dle=function(r){return r>=yle&&r<=_le||r===vle||r>=ble&&r<=xle||r===wle},Md=function(r,e){return r!==p0?!1:e!==Kv},tb=function(r,e,t){return r===zc?eb(e)||Md(e,t):eb(r)?!0:!!(r===p0&&Md(r,e))},GE=function(r,e,t){return r===Gf||r===zc?mc(e)?!0:e===y0&&mc(t):mc(r===y0?e:r)},Rle=function(r){var e=0,t=1;(r[e]===Gf||r[e]===zc)&&(r[e]===zc&&(t=-1),e++);for(var i=[];mc(r[e]);)i.push(r[e++]);var n=i.length?parseInt($o.apply(void 0,i),10):0;r[e]===y0&&e++;for(var o=[];mc(r[e]);)o.push(r[e++]);var a=o.length,s=a?parseInt($o.apply(void 0,o),10):0;(r[e]===hk||r[e]===ck)&&e++;var g=1;(r[e]===Gf||r[e]===zc)&&(r[e]===zc&&(g=-1),e++);for(var y=[];mc(r[e]);)y.push(r[e++]);var T=y.length?parseInt($o.apply(void 0,y),10):0;return t*(n+s*Math.pow(10,-a))*Math.pow(10,g*T)},kle={type:2},Ole={type:3},Ule={type:4},Nle={type:13},zle={type:8},Qle={type:21},Vle={type:9},Hle={type:10},Gle={type:11},jle={type:12},qle={type:14},rb={type:23},$le={type:1},Kle={type:25},Wle={type:24},Xle={type:26},Zle={type:27},Jle={type:28},Yle={type:29},ece={type:31},jE={type:32},fk=function(){function r(){this._value=[]}return r.prototype.write=function(e){this._value=this._value.concat(Uv(e))},r.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==jE;)e.push(t),t=this.consumeToken();return e},r.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case Wv:return this.consumeStringToken(Wv);case ele:var t=this.peekCodePoint(0),i=this.peekCodePoint(1),n=this.peekCodePoint(2);if(dk(t)||Md(i,n)){var o=tb(t,i,n)?Zae:Xae,a=this.consumeName();return{type:5,value:a,flags:o}}break;case tle:if(this.peekCodePoint(0)===g0)return this.consumeCodePoint(),Nle;break;case Xv:return this.consumeStringToken(Xv);case Zv:return kle;case m0:return Ole;case HE:if(this.peekCodePoint(0)===g0)return this.consumeCodePoint(),qle;break;case Gf:if(GE(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case ple:return Ule;case zc:var s=e,g=this.peekCodePoint(0),y=this.peekCodePoint(1);if(GE(s,g,y))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(tb(s,g,y))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(g===zc&&y===ole)return this.consumeCodePoint(),this.consumeCodePoint(),Wle;break;case y0:if(GE(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case nk:if(this.peekCodePoint(0)===HE)for(this.consumeCodePoint();;){var T=this.consumeCodePoint();if(T===HE&&(T=this.consumeCodePoint(),T===nk))return this.consumeToken();if(T===rA)return this.consumeToken()}break;case gle:return Xle;case mle:return Zle;case sle:if(this.peekCodePoint(0)===nle&&this.peekCodePoint(1)===zc&&this.peekCodePoint(2)===zc)return this.consumeCodePoint(),this.consumeCodePoint(),Kle;break;case ale:var I=this.peekCodePoint(0),R=this.peekCodePoint(1),U=this.peekCodePoint(2);if(tb(I,R,U)){var a=this.consumeName();return{type:7,value:a}}break;case lle:return Jle;case p0:if(Md(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case cle:return Yle;case ule:if(this.peekCodePoint(0)===g0)return this.consumeCodePoint(),zle;break;case hle:return Gle;case Ale:return jle;case Cle:case Sle:var Z=this.peekCodePoint(0),Y=this.peekCodePoint(1);return Z===Gf&&(Wg(Y)||Y===Jv)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case sk:if(this.peekCodePoint(0)===g0)return this.consumeCodePoint(),Vle;if(this.peekCodePoint(0)===sk)return this.consumeCodePoint(),Qle;break;case dle:if(this.peekCodePoint(0)===g0)return this.consumeCodePoint(),Hle;break;case rA:return jE}return Yv(e)?(this.consumeWhiteSpace(),ece):mc(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):eb(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:$o(e)}},r.prototype.consumeCodePoint=function(){var e=this._value.shift();return typeof e>"u"?-1:e},r.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},r.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},r.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();Wg(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var i=!1;t===Jv&&e.length<6;)e.push(t),t=this.consumeCodePoint(),i=!0;if(i){var n=parseInt($o.apply(void 0,e.map(function(g){return g===Jv?ak:g})),16),o=parseInt($o.apply(void 0,e.map(function(g){return g===Jv?Ak:g})),16);return{type:30,start:n,end:o}}var a=parseInt($o.apply(void 0,e),16);if(this.peekCodePoint(0)===zc&&Wg(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var s=[];Wg(t)&&s.length<6;)s.push(t),t=this.consumeCodePoint();var o=parseInt($o.apply(void 0,s),16);return{type:30,start:a,end:o}}else return{type:30,start:a,end:a}},r.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return e.toLowerCase()==="url"&&this.peekCodePoint(0)===Zv?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===Zv?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},r.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===rA)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===Xv||t===Wv){var i=this.consumeStringToken(this.consumeCodePoint());return i.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===rA||this.peekCodePoint(0)===m0)?(this.consumeCodePoint(),{type:22,value:i.value}):(this.consumeBadUrlRemnants(),rb)}for(;;){var n=this.consumeCodePoint();if(n===rA||n===m0)return{type:22,value:$o.apply(void 0,e)};if(Yv(n))return this.consumeWhiteSpace(),this.peekCodePoint(0)===rA||this.peekCodePoint(0)===m0?(this.consumeCodePoint(),{type:22,value:$o.apply(void 0,e)}):(this.consumeBadUrlRemnants(),rb);if(n===Wv||n===Xv||n===Zv||Dle(n))return this.consumeBadUrlRemnants(),rb;if(n===p0)if(Md(n,this.peekCodePoint(0)))e.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),rb;else e.push(n)}},r.prototype.consumeWhiteSpace=function(){for(;Yv(this.peekCodePoint(0));)this.consumeCodePoint()},r.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===m0||e===rA)return;Md(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},r.prototype.consumeStringSlice=function(e){for(var t=5e4,i="";e>0;){var n=Math.min(t,e);i+=$o.apply(void 0,this._value.splice(0,n)),e-=n}return this._value.shift(),i},r.prototype.consumeStringToken=function(e){var t="",i=0;do{var n=this._value[i];if(n===rA||n===void 0||n===e)return t+=this.consumeStringSlice(i),{type:0,value:t};if(n===Kv)return this._value.splice(0,i),$le;if(n===p0){var o=this._value[i+1];o!==rA&&o!==void 0&&(o===Kv?(t+=this.consumeStringSlice(i),i=-1,this._value.shift()):Md(n,o)&&(t+=this.consumeStringSlice(i),t+=$o(this.consumeEscapedCodePoint()),i=-1))}i++}while(!0)},r.prototype.consumeNumber=function(){var e=[],t=f0,i=this.peekCodePoint(0);for((i===Gf||i===zc)&&e.push(this.consumeCodePoint());mc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());i=this.peekCodePoint(0);var n=this.peekCodePoint(1);if(i===y0&&mc(n))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=ik;mc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());i=this.peekCodePoint(0),n=this.peekCodePoint(1);var o=this.peekCodePoint(2);if((i===hk||i===ck)&&((n===Gf||n===zc)&&mc(o)||mc(n)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=ik;mc(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[Rle(e),t]},r.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],i=e[1],n=this.peekCodePoint(0),o=this.peekCodePoint(1),a=this.peekCodePoint(2);if(tb(n,o,a)){var s=this.consumeName();return{type:15,number:t,flags:i,unit:s}}return n===rle?(this.consumeCodePoint(),{type:16,number:t,flags:i}):{type:17,number:t,flags:i}},r.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(Wg(e)){for(var t=$o(e);Wg(this.peekCodePoint(0))&&t.length<6;)t+=$o(this.consumeCodePoint());Yv(this.peekCodePoint(0))&&this.consumeCodePoint();var i=parseInt(t,16);return i===0||Ile(i)||i>1114111?ok:i}return e===rA?ok:e},r.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(dk(t))e+=$o(t);else if(Md(t,this.peekCodePoint(0)))e+=$o(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(t),e}},r}(),pk=function(){function r(e){this._tokens=e}return r.create=function(e){var t=new fk;return t.write(e),new r(t.read())},r.parseValue=function(e){return r.create(e).parseComponentValue()},r.parseValues=function(e){return r.create(e).parseComponentValues()},r.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===31;)e=this.consumeToken();if(e.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do e=this.consumeToken();while(e.type===31);if(e.type===32)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},r.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(t.type===32)return e;e.push(t),e.push()}},r.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},r.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},i=this.consumeToken();;){if(i.type===32||rce(i,e))return t;this.reconsumeToken(i),t.values.push(this.consumeComponentValue()),i=this.consumeToken()}},r.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var i=this.consumeToken();if(i.type===32||i.type===3)return t;this.reconsumeToken(i),t.values.push(this.consumeComponentValue())}},r.prototype.consumeToken=function(){var e=this._tokens.shift();return typeof e>"u"?jE:e},r.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},r}(),_0=function(r){return r.type===15},Xg=function(r){return r.type===17},Cs=function(r){return r.type===20},tce=function(r){return r.type===0},qE=function(r,e){return Cs(r)&&r.value===e},gk=function(r){return r.type!==31},Zg=function(r){return r.type!==31&&r.type!==4},iA=function(r){var e=[],t=[];return r.forEach(function(i){if(i.type===4){if(t.length===0)throw new Error("Error parsing function args, zero tokens for arg");e.push(t),t=[];return}i.type!==31&&t.push(i)}),t.length&&e.push(t),e},rce=function(r,e){return e===11&&r.type===12||e===28&&r.type===29?!0:e===2&&r.type===3},Pd=function(r){return r.type===17||r.type===15},ca=function(r){return r.type===16||Pd(r)},mk=function(r){return r.length>1?[r[0],r[1]]:[r[0]]},ul={type:17,number:0,flags:f0},$E={type:16,number:50,flags:f0},Fd={type:16,number:100,flags:f0},v0=function(r,e,t){var i=r[0],n=r[1];return[Gs(i,e),Gs(typeof n<"u"?n:i,t)]},Gs=function(r,e){if(r.type===16)return r.number/100*e;if(_0(r))switch(r.unit){case"rem":case"em":return 16*r.number;case"px":default:return r.number}return r.number},yk="deg",_k="grad",vk="rad",bk="turn",ib={name:"angle",parse:function(r,e){if(e.type===15)switch(e.unit){case yk:return Math.PI*e.number/180;case _k:return Math.PI/200*e.number;case vk:return e.number;case bk:return Math.PI*2*e.number}throw new Error("Unsupported angle type")}},xk=function(r){return r.type===15&&(r.unit===yk||r.unit===_k||r.unit===vk||r.unit===bk)},wk=function(r){var e=r.filter(Cs).map(function(t){return t.value}).join(" ");switch(e){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ul,ul];case"to top":case"bottom":return Ou(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ul,Fd];case"to right":case"left":return Ou(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Fd,Fd];case"to bottom":case"top":return Ou(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Fd,ul];case"to left":case"right":return Ou(270)}return 0},Ou=function(r){return Math.PI*r/180},Dd={name:"color",parse:function(r,e){if(e.type===18){var t=ice[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(r,e.values)}if(e.type===5){if(e.value.length===3){var i=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3);return kd(parseInt(i+i,16),parseInt(n+n,16),parseInt(o+o,16),1)}if(e.value.length===4){var i=e.value.substring(0,1),n=e.value.substring(1,2),o=e.value.substring(2,3),a=e.value.substring(3,4);return kd(parseInt(i+i,16),parseInt(n+n,16),parseInt(o+o,16),parseInt(a+a,16)/255)}if(e.value.length===6){var i=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6);return kd(parseInt(i,16),parseInt(n,16),parseInt(o,16),1)}if(e.value.length===8){var i=e.value.substring(0,2),n=e.value.substring(2,4),o=e.value.substring(4,6),a=e.value.substring(6,8);return kd(parseInt(i,16),parseInt(n,16),parseInt(o,16),parseInt(a,16)/255)}}if(e.type===20){var s=VA[e.value.toUpperCase()];if(typeof s<"u")return s}return VA.TRANSPARENT}},Rd=function(r){return(255&r)===0},Ka=function(r){var e=255&r,t=255&r>>8,i=255&r>>16,n=255&r>>24;return e<255?"rgba("+n+","+i+","+t+","+e/255+")":"rgb("+n+","+i+","+t+")"},kd=function(r,e,t,i){return(r<<24|e<<16|t<<8|Math.round(i*255)<<0)>>>0},Bk=function(r,e){if(r.type===17)return r.number;if(r.type===16){var t=e===3?1:255;return e===3?r.number/100*t:Math.round(r.number/100*t)}return 0},Ck=function(r,e){var t=e.filter(Zg);if(t.length===3){var i=t.map(Bk),n=i[0],o=i[1],a=i[2];return kd(n,o,a,1)}if(t.length===4){var s=t.map(Bk),n=s[0],o=s[1],a=s[2],g=s[3];return kd(n,o,a,g)}return 0};function KE(r,e,t){return t<0&&(t+=1),t>=1&&(t-=1),t<1/6?(e-r)*t*6+r:t<1/2?e:t<2/3?(e-r)*6*(2/3-t)+r:r}var Ek=function(r,e){var t=e.filter(Zg),i=t[0],n=t[1],o=t[2],a=t[3],s=(i.type===17?Ou(i.number):ib.parse(r,i))/(Math.PI*2),g=ca(n)?n.number/100:0,y=ca(o)?o.number/100:0,T=typeof a<"u"&&ca(a)?Gs(a,1):1;if(g===0)return kd(y*255,y*255,y*255,1);var I=y<=.5?y*(g+1):y+g-y*g,R=y*2-I,U=KE(R,I,s+1/3),Z=KE(R,I,s),Y=KE(R,I,s-1/3);return kd(U*255,Z*255,Y*255,T)},ice={hsl:Ek,hsla:Ek,rgb:Ck,rgba:Ck},b0=function(r,e){return Dd.parse(r,pk.create(e).parseComponentValue())},VA={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},nce={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(r,e){return e.map(function(t){if(Cs(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},sce={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},nb=function(r,e){var t=Dd.parse(r,e[0]),i=e[1];return i&&ca(i)?{color:t,stop:i}:{color:t,stop:null}},Sk=function(r,e){var t=r[0],i=r[r.length-1];t.stop===null&&(t.stop=ul),i.stop===null&&(i.stop=Fd);for(var n=[],o=0,a=0;a<r.length;a++){var s=r[a].stop;if(s!==null){var g=Gs(s,e);g>o?n.push(g):n.push(o),o=g}else n.push(null)}for(var y=null,a=0;a<n.length;a++){var T=n[a];if(T===null)y===null&&(y=a);else if(y!==null){for(var I=a-y,R=n[y-1],U=(T-R)/(I+1),Z=1;Z<=I;Z++)n[y+Z-1]=U*Z;y=null}}return r.map(function(Y,he){var ce=Y.color;return{color:ce,stop:Math.max(Math.min(1,n[he]/e),0)}})},oce=function(r,e,t){var i=e/2,n=t/2,o=Gs(r[0],e)-i,a=n-Gs(r[1],t);return(Math.atan2(a,o)+Math.PI*2)%(Math.PI*2)},ace=function(r,e,t){var i=typeof r=="number"?r:oce(r,e,t),n=Math.abs(e*Math.sin(i))+Math.abs(t*Math.cos(i)),o=e/2,a=t/2,s=n/2,g=Math.sin(i-Math.PI/2)*s,y=Math.cos(i-Math.PI/2)*s;return[n,o-y,o+y,a-g,a+g]},yh=function(r,e){return Math.sqrt(r*r+e*e)},Tk=function(r,e,t,i,n){var o=[[0,0],[0,e],[r,0],[r,e]];return o.reduce(function(a,s){var g=s[0],y=s[1],T=yh(t-g,i-y);return(n?T<a.optimumDistance:T>a.optimumDistance)?{optimumCorner:s,optimumDistance:T}:a},{optimumDistance:n?1/0:-1/0,optimumCorner:null}).optimumCorner},lce=function(r,e,t,i,n){var o=0,a=0;switch(r.size){case 0:r.shape===0?o=a=Math.min(Math.abs(e),Math.abs(e-i),Math.abs(t),Math.abs(t-n)):r.shape===1&&(o=Math.min(Math.abs(e),Math.abs(e-i)),a=Math.min(Math.abs(t),Math.abs(t-n)));break;case 2:if(r.shape===0)o=a=Math.min(yh(e,t),yh(e,t-n),yh(e-i,t),yh(e-i,t-n));else if(r.shape===1){var s=Math.min(Math.abs(t),Math.abs(t-n))/Math.min(Math.abs(e),Math.abs(e-i)),g=Tk(i,n,e,t,!0),y=g[0],T=g[1];o=yh(y-e,(T-t)/s),a=s*o}break;case 1:r.shape===0?o=a=Math.max(Math.abs(e),Math.abs(e-i),Math.abs(t),Math.abs(t-n)):r.shape===1&&(o=Math.max(Math.abs(e),Math.abs(e-i)),a=Math.max(Math.abs(t),Math.abs(t-n)));break;case 3:if(r.shape===0)o=a=Math.max(yh(e,t),yh(e,t-n),yh(e-i,t),yh(e-i,t-n));else if(r.shape===1){var s=Math.max(Math.abs(t),Math.abs(t-n))/Math.max(Math.abs(e),Math.abs(e-i)),I=Tk(i,n,e,t,!1),y=I[0],T=I[1];o=yh(y-e,(T-t)/s),a=s*o}break}return Array.isArray(r.size)&&(o=Gs(r.size[0],i),a=r.size.length===2?Gs(r.size[1],n):o),[o,a]},cce=function(r,e){var t=Ou(180),i=[];return iA(e).forEach(function(n,o){if(o===0){var a=n[0];if(a.type===20&&a.value==="to"){t=wk(n);return}else if(xk(a)){t=ib.parse(r,a);return}}var s=nb(r,n);i.push(s)}),{angle:t,stops:i,type:1}},sb=function(r,e){var t=Ou(180),i=[];return iA(e).forEach(function(n,o){if(o===0){var a=n[0];if(a.type===20&&["top","left","right","bottom"].indexOf(a.value)!==-1){t=wk(n);return}else if(xk(a)){t=(ib.parse(r,a)+Ou(270))%Ou(360);return}}var s=nb(r,n);i.push(s)}),{angle:t,stops:i,type:1}},uce=function(r,e){var t=Ou(180),i=[],n=1,o=0,a=3,s=[];return iA(e).forEach(function(g,y){var T=g[0];if(y===0){if(Cs(T)&&T.value==="linear"){n=1;return}else if(Cs(T)&&T.value==="radial"){n=2;return}}if(T.type===18){if(T.name==="from"){var I=Dd.parse(r,T.values[0]);i.push({stop:ul,color:I})}else if(T.name==="to"){var I=Dd.parse(r,T.values[0]);i.push({stop:Fd,color:I})}else if(T.name==="color-stop"){var R=T.values.filter(Zg);if(R.length===2){var I=Dd.parse(r,R[1]),U=R[0];Xg(U)&&i.push({stop:{type:16,number:U.number*100,flags:U.flags},color:I})}}}}),n===1?{angle:(t+Ou(180))%Ou(360),stops:i,type:n}:{size:a,shape:o,stops:i,position:s,type:n}},Ik="closest-side",Lk="farthest-side",Mk="closest-corner",Pk="farthest-corner",Fk="circle",Dk="ellipse",Rk="cover",kk="contain",hce=function(r,e){var t=0,i=3,n=[],o=[];return iA(e).forEach(function(a,s){var g=!0;if(s===0){var y=!1;g=a.reduce(function(I,R){if(y)if(Cs(R))switch(R.value){case"center":return o.push($E),I;case"top":case"left":return o.push(ul),I;case"right":case"bottom":return o.push(Fd),I}else(ca(R)||Pd(R))&&o.push(R);else if(Cs(R))switch(R.value){case Fk:return t=0,!1;case Dk:return t=1,!1;case"at":return y=!0,!1;case Ik:return i=0,!1;case Rk:case Lk:return i=1,!1;case kk:case Mk:return i=2,!1;case Pk:return i=3,!1}else if(Pd(R)||ca(R))return Array.isArray(i)||(i=[]),i.push(R),!1;return I},g)}if(g){var T=nb(r,a);n.push(T)}}),{size:i,shape:t,stops:n,position:o,type:2}},ob=function(r,e){var t=0,i=3,n=[],o=[];return iA(e).forEach(function(a,s){var g=!0;if(s===0?g=a.reduce(function(T,I){if(Cs(I))switch(I.value){case"center":return o.push($E),!1;case"top":case"left":return o.push(ul),!1;case"right":case"bottom":return o.push(Fd),!1}else if(ca(I)||Pd(I))return o.push(I),!1;return T},g):s===1&&(g=a.reduce(function(T,I){if(Cs(I))switch(I.value){case Fk:return t=0,!1;case Dk:return t=1,!1;case kk:case Ik:return i=0,!1;case Lk:return i=1,!1;case Mk:return i=2,!1;case Rk:case Pk:return i=3,!1}else if(Pd(I)||ca(I))return Array.isArray(i)||(i=[]),i.push(I),!1;return T},g)),g){var y=nb(r,a);n.push(y)}}),{size:i,shape:t,stops:n,position:o,type:2}},Ace=function(r){return r.type===1},dce=function(r){return r.type===2},WE={name:"image",parse:function(r,e){if(e.type===22){var t={url:e.value,type:0};return r.cache.addImage(e.value),t}if(e.type===18){var i=Ok[e.name];if(typeof i>"u")throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return i(r,e.values)}throw new Error("Unsupported image type "+e.type)}};function fce(r){return!(r.type===20&&r.value==="none")&&(r.type!==18||!!Ok[r.name])}var Ok={"linear-gradient":cce,"-moz-linear-gradient":sb,"-ms-linear-gradient":sb,"-o-linear-gradient":sb,"-webkit-linear-gradient":sb,"radial-gradient":hce,"-moz-radial-gradient":ob,"-ms-radial-gradient":ob,"-o-radial-gradient":ob,"-webkit-radial-gradient":ob,"-webkit-gradient":uce},pce={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(r,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e.filter(function(i){return Zg(i)&&fce(i)}).map(function(i){return WE.parse(r,i)})}},gce={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(r,e){return e.map(function(t){if(Cs(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},mce={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(r,e){return iA(e).map(function(t){return t.filter(ca)}).map(mk)}},yce={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(r,e){return iA(e).map(function(t){return t.filter(Cs).map(function(i){return i.value}).join(" ")}).map(_ce)}},_ce=function(r){switch(r){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},Jg;(function(r){r.AUTO="auto",r.CONTAIN="contain",r.COVER="cover"})(Jg||(Jg={}));var vce={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(r,e){return iA(e).map(function(t){return t.filter(bce)})}},bce=function(r){return Cs(r)||ca(r)},ab=function(r){return{name:"border-"+r+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},xce=ab("top"),wce=ab("right"),Bce=ab("bottom"),Cce=ab("left"),lb=function(r){return{name:"border-radius-"+r,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return mk(t.filter(ca))}}},Ece=lb("top-left"),Sce=lb("top-right"),Tce=lb("bottom-right"),Ice=lb("bottom-left"),cb=function(r){return{name:"border-"+r+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},Lce=cb("top"),Mce=cb("right"),Pce=cb("bottom"),Fce=cb("left"),ub=function(r){return{name:"border-"+r+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return _0(t)?t.number:0}}},Dce=ub("top"),Rce=ub("right"),kce=ub("bottom"),Oce=ub("left"),Uce={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Nce={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(r,e){switch(e){case"rtl":return 1;case"ltr":default:return 0}}},zce={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(r,e){return e.filter(Cs).reduce(function(t,i){return t|Qce(i.value)},0)}},Qce=function(r){switch(r){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},Vce={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},Hce={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(r,e){return e.type===20&&e.value==="normal"?0:e.type===17||e.type===15?e.number:0}},hb;(function(r){r.NORMAL="normal",r.STRICT="strict"})(hb||(hb={}));var Gce={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"strict":return hb.STRICT;case"normal":default:return hb.NORMAL}}},jce={name:"line-height",initialValue:"normal",prefix:!1,type:4},Uk=function(r,e){return Cs(r)&&r.value==="normal"?1.2*e:r.type===17?e*r.number:ca(r)?Gs(r,e):e},qce={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(r,e){return e.type===20&&e.value==="none"?null:WE.parse(r,e)}},$ce={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(r,e){switch(e){case"inside":return 0;case"outside":default:return 1}}},XE={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},Ab=function(r){return{name:"margin-"+r,initialValue:"0",prefix:!1,type:4}},Kce=Ab("top"),Wce=Ab("right"),Xce=Ab("bottom"),Zce=Ab("left"),Jce={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(r,e){return e.filter(Cs).map(function(t){switch(t.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},Yce={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"break-word":return"break-word";case"normal":default:return"normal"}}},db=function(r){return{name:"padding-"+r,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},eue=db("top"),tue=db("right"),rue=db("bottom"),iue=db("left"),nue={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(r,e){switch(e){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},sue={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(r,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},oue={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.length===1&&qE(e[0],"none")?[]:iA(e).map(function(t){for(var i={color:VA.TRANSPARENT,offsetX:ul,offsetY:ul,blur:ul},n=0,o=0;o<t.length;o++){var a=t[o];Pd(a)?(n===0?i.offsetX=a:n===1?i.offsetY=a:i.blur=a,n++):i.color=Dd.parse(r,a)}return i})}},aue={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},lue={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(r,e){if(e.type===20&&e.value==="none")return null;if(e.type===18){var t=hue[e.name];if(typeof t>"u")throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}return null}},cue=function(r){var e=r.filter(function(t){return t.type===17}).map(function(t){return t.number});return e.length===6?e:null},uue=function(r){var e=r.filter(function(g){return g.type===17}).map(function(g){return g.number}),t=e[0],i=e[1];e[2],e[3];var n=e[4],o=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var a=e[12],s=e[13];return e[14],e[15],e.length===16?[t,i,n,o,a,s]:null},hue={matrix:cue,matrix3d:uue},Nk={type:16,number:50,flags:f0},Aue=[Nk,Nk],due={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(r,e){var t=e.filter(ca);return t.length!==2?Aue:[t[0],t[1]]}},fue={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(r,e){switch(e){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},x0;(function(r){r.NORMAL="normal",r.BREAK_ALL="break-all",r.KEEP_ALL="keep-all"})(x0||(x0={}));for(var pue={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"break-all":return x0.BREAK_ALL;case"keep-all":return x0.KEEP_ALL;case"normal":default:return x0.NORMAL}}},gue={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(r,e){if(e.type===20)return{auto:!0,order:0};if(Xg(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},zk={name:"time",parse:function(r,e){if(e.type===15)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},mue={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(r,e){return Xg(e)?e.number:1}},yue={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},_ue={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(r,e){return e.filter(Cs).map(function(t){switch(t.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(t){return t!==0})}},vue={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(r,e){var t=[],i=[];return e.forEach(function(n){switch(n.type){case 20:case 0:t.push(n.value);break;case 17:t.push(n.number.toString());break;case 4:i.push(t.join(" ")),t.length=0;break}}),t.length&&i.push(t.join(" ")),i.map(function(n){return n.indexOf(" ")===-1?n:"'"+n+"'"})}},bue={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},xue={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(r,e){if(Xg(e))return e.number;if(Cs(e))switch(e.value){case"bold":return 700;case"normal":default:return 400}return 400}},wue={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.filter(Cs).map(function(t){return t.value})}},Bue={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(r,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Sa=function(r,e){return(r&e)!==0},Cue={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(r,e){if(e.length===0)return[];var t=e[0];return t.type===20&&t.value==="none"?[]:e}},Eue={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;for(var i=[],n=e.filter(gk),o=0;o<n.length;o++){var a=n[o],s=n[o+1];if(a.type===20){var g=s&&Xg(s)?s.number:1;i.push({counter:a.value,increment:g})}}return i}},Sue={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return[];for(var t=[],i=e.filter(gk),n=0;n<i.length;n++){var o=i[n],a=i[n+1];if(Cs(o)&&o.value!=="none"){var s=a&&Xg(a)?a.number:0;t.push({counter:o.value,reset:s})}}return t}},Tue={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(r,e){return e.filter(_0).map(function(t){return zk.parse(r,t)})}},Iue={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(r,e){if(e.length===0)return null;var t=e[0];if(t.type===20&&t.value==="none")return null;var i=[],n=e.filter(tce);if(n.length%2!==0)return null;for(var o=0;o<n.length;o+=2){var a=n[o].value,s=n[o+1].value;i.push({open:a,close:s})}return i}},Qk=function(r,e,t){if(!r)return"";var i=r[Math.min(e,r.length-1)];return i?t?i.open:i.close:""},Lue={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(r,e){return e.length===1&&qE(e[0],"none")?[]:iA(e).map(function(t){for(var i={color:255,offsetX:ul,offsetY:ul,blur:ul,spread:ul,inset:!1},n=0,o=0;o<t.length;o++){var a=t[o];qE(a,"inset")?i.inset=!0:Pd(a)?(n===0?i.offsetX=a:n===1?i.offsetY=a:n===2?i.blur=a:i.spread=a,n++):i.color=Dd.parse(r,a)}return i})}},Mue={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(r,e){var t=[0,1,2],i=[];return e.filter(Cs).forEach(function(n){switch(n.value){case"stroke":i.push(1);break;case"fill":i.push(0);break;case"markers":i.push(2);break}}),t.forEach(function(n){i.indexOf(n)===-1&&i.push(n)}),i}},Pue={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},Fue={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(r,e){return _0(e)?e.number:0}},Due=function(){function r(e,t){var i,n;this.animationDuration=ni(e,Tue,t.animationDuration),this.backgroundClip=ni(e,nce,t.backgroundClip),this.backgroundColor=ni(e,sce,t.backgroundColor),this.backgroundImage=ni(e,pce,t.backgroundImage),this.backgroundOrigin=ni(e,gce,t.backgroundOrigin),this.backgroundPosition=ni(e,mce,t.backgroundPosition),this.backgroundRepeat=ni(e,yce,t.backgroundRepeat),this.backgroundSize=ni(e,vce,t.backgroundSize),this.borderTopColor=ni(e,xce,t.borderTopColor),this.borderRightColor=ni(e,wce,t.borderRightColor),this.borderBottomColor=ni(e,Bce,t.borderBottomColor),this.borderLeftColor=ni(e,Cce,t.borderLeftColor),this.borderTopLeftRadius=ni(e,Ece,t.borderTopLeftRadius),this.borderTopRightRadius=ni(e,Sce,t.borderTopRightRadius),this.borderBottomRightRadius=ni(e,Tce,t.borderBottomRightRadius),this.borderBottomLeftRadius=ni(e,Ice,t.borderBottomLeftRadius),this.borderTopStyle=ni(e,Lce,t.borderTopStyle),this.borderRightStyle=ni(e,Mce,t.borderRightStyle),this.borderBottomStyle=ni(e,Pce,t.borderBottomStyle),this.borderLeftStyle=ni(e,Fce,t.borderLeftStyle),this.borderTopWidth=ni(e,Dce,t.borderTopWidth),this.borderRightWidth=ni(e,Rce,t.borderRightWidth),this.borderBottomWidth=ni(e,kce,t.borderBottomWidth),this.borderLeftWidth=ni(e,Oce,t.borderLeftWidth),this.boxShadow=ni(e,Lue,t.boxShadow),this.color=ni(e,Uce,t.color),this.direction=ni(e,Nce,t.direction),this.display=ni(e,zce,t.display),this.float=ni(e,Vce,t.cssFloat),this.fontFamily=ni(e,vue,t.fontFamily),this.fontSize=ni(e,bue,t.fontSize),this.fontStyle=ni(e,Bue,t.fontStyle),this.fontVariant=ni(e,wue,t.fontVariant),this.fontWeight=ni(e,xue,t.fontWeight),this.letterSpacing=ni(e,Hce,t.letterSpacing),this.lineBreak=ni(e,Gce,t.lineBreak),this.lineHeight=ni(e,jce,t.lineHeight),this.listStyleImage=ni(e,qce,t.listStyleImage),this.listStylePosition=ni(e,$ce,t.listStylePosition),this.listStyleType=ni(e,XE,t.listStyleType),this.marginTop=ni(e,Kce,t.marginTop),this.marginRight=ni(e,Wce,t.marginRight),this.marginBottom=ni(e,Xce,t.marginBottom),this.marginLeft=ni(e,Zce,t.marginLeft),this.opacity=ni(e,mue,t.opacity);var o=ni(e,Jce,t.overflow);this.overflowX=o[0],this.overflowY=o[o.length>1?1:0],this.overflowWrap=ni(e,Yce,t.overflowWrap),this.paddingTop=ni(e,eue,t.paddingTop),this.paddingRight=ni(e,tue,t.paddingRight),this.paddingBottom=ni(e,rue,t.paddingBottom),this.paddingLeft=ni(e,iue,t.paddingLeft),this.paintOrder=ni(e,Mue,t.paintOrder),this.position=ni(e,sue,t.position),this.textAlign=ni(e,nue,t.textAlign),this.textDecorationColor=ni(e,yue,(i=t.textDecorationColor)!==null&&i!==void 0?i:t.color),this.textDecorationLine=ni(e,_ue,(n=t.textDecorationLine)!==null&&n!==void 0?n:t.textDecoration),this.textShadow=ni(e,oue,t.textShadow),this.textTransform=ni(e,aue,t.textTransform),this.transform=ni(e,lue,t.transform),this.transformOrigin=ni(e,due,t.transformOrigin),this.visibility=ni(e,fue,t.visibility),this.webkitTextStrokeColor=ni(e,Pue,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=ni(e,Fue,t.webkitTextStrokeWidth),this.wordBreak=ni(e,pue,t.wordBreak),this.zIndex=ni(e,gue,t.zIndex)}return r.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},r.prototype.isTransparent=function(){return Rd(this.backgroundColor)},r.prototype.isTransformed=function(){return this.transform!==null},r.prototype.isPositioned=function(){return this.position!==0},r.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},r.prototype.isFloating=function(){return this.float!==0},r.prototype.isInlineLevel=function(){return Sa(this.display,4)||Sa(this.display,33554432)||Sa(this.display,268435456)||Sa(this.display,536870912)||Sa(this.display,67108864)||Sa(this.display,134217728)},r}(),Rue=function(){function r(e,t){this.content=ni(e,Cue,t.content),this.quotes=ni(e,Iue,t.quotes)}return r}(),Vk=function(){function r(e,t){this.counterIncrement=ni(e,Eue,t.counterIncrement),this.counterReset=ni(e,Sue,t.counterReset)}return r}(),ni=function(r,e,t){var i=new fk,n=t!==null&&typeof t<"u"?t.toString():e.initialValue;i.write(n);var o=new pk(i.read());switch(e.type){case 2:var a=o.parseComponentValue();return e.parse(r,Cs(a)?a.value:e.initialValue);case 0:return e.parse(r,o.parseComponentValue());case 1:return e.parse(r,o.parseComponentValues());case 4:return o.parseComponentValue();case 3:switch(e.format){case"angle":return ib.parse(r,o.parseComponentValue());case"color":return Dd.parse(r,o.parseComponentValue());case"image":return WE.parse(r,o.parseComponentValue());case"length":var s=o.parseComponentValue();return Pd(s)?s:ul;case"length-percentage":var g=o.parseComponentValue();return ca(g)?g:ul;case"time":return zk.parse(r,o.parseComponentValue())}break}},kue="data-html2canvas-debug",Oue=function(r){var e=r.getAttribute(kue);switch(e){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},ZE=function(r,e){var t=Oue(r);return t===1||e===t},nA=function(){function r(e,t){if(this.context=e,this.textNodes=[],this.elements=[],this.flags=0,ZE(t,3))debugger;this.styles=new Due(e,window.getComputedStyle(t,null)),uS(t)&&(this.styles.animationDuration.some(function(i){return i>0})&&(t.style.animationDuration="0s"),this.styles.transform!==null&&(t.style.transform="none")),this.bounds=Ov(this.context,t),ZE(t,4)&&(this.flags|=16)}return r}(),Uue="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",Hk="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",w0=typeof Uint8Array>"u"?[]:new Uint8Array(256),fb=0;fb<Hk.length;fb++)w0[Hk.charCodeAt(fb)]=fb;for(var Nue=function(r){var e=r.length*.75,t=r.length,i,n=0,o,a,s,g;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);var y=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),T=Array.isArray(y)?y:new Uint8Array(y);for(i=0;i<t;i+=4)o=w0[r.charCodeAt(i)],a=w0[r.charCodeAt(i+1)],s=w0[r.charCodeAt(i+2)],g=w0[r.charCodeAt(i+3)],T[n++]=o<<2|a>>4,T[n++]=(a&15)<<4|s>>2,T[n++]=(s&3)<<6|g&63;return y},zue=function(r){for(var e=r.length,t=[],i=0;i<e;i+=2)t.push(r[i+1]<<8|r[i]);return t},Que=function(r){for(var e=r.length,t=[],i=0;i<e;i+=4)t.push(r[i+3]<<24|r[i+2]<<16|r[i+1]<<8|r[i]);return t},jf=5,JE=11,YE=2,Vue=JE-jf,Gk=65536>>jf,Hue=1<<jf,eS=Hue-1,Gue=1024>>jf,jue=Gk+Gue,que=jue,$ue=32,Kue=que+$ue,Wue=65536>>JE,Xue=1<<Vue,Zue=Xue-1,jk=function(r,e,t){return r.slice?r.slice(e,t):new Uint16Array(Array.prototype.slice.call(r,e,t))},Jue=function(r,e,t){return r.slice?r.slice(e,t):new Uint32Array(Array.prototype.slice.call(r,e,t))},Yue=function(r,e){var t=Nue(r),i=Array.isArray(t)?Que(t):new Uint32Array(t),n=Array.isArray(t)?zue(t):new Uint16Array(t),o=24,a=jk(n,o/2,i[4]/2),s=i[5]===2?jk(n,(o+i[4])/2):Jue(i,Math.ceil((o+i[4])/4));return new ehe(i[0],i[1],i[2],i[3],a,s)},ehe=function(){function r(e,t,i,n,o,a){this.initialValue=e,this.errorValue=t,this.highStart=i,this.highValueIndex=n,this.index=o,this.data=a}return r.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=this.index[e>>jf],t=(t<<YE)+(e&eS),this.data[t];if(e<=65535)return t=this.index[Gk+(e-55296>>jf)],t=(t<<YE)+(e&eS),this.data[t];if(e<this.highStart)return t=Kue-Wue+(e>>JE),t=this.index[t],t+=e>>jf&Zue,t=this.index[t],t=(t<<YE)+(e&eS),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},r}(),qk="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",the=typeof Uint8Array>"u"?[]:new Uint8Array(256),pb=0;pb<qk.length;pb++)the[qk.charCodeAt(pb)]=pb;var rhe=1,tS=2,rS=3,$k=4,Kk=5,ihe=7,Wk=8,iS=9,nS=10,Xk=11,Zk=12,Jk=13,Yk=14,sS=15,nhe=function(r){for(var e=[],t=0,i=r.length;t<i;){var n=r.charCodeAt(t++);if(n>=55296&&n<=56319&&t<i){var o=r.charCodeAt(t++);(o&64512)===56320?e.push(((n&1023)<<10)+(o&1023)+65536):(e.push(n),t--)}else e.push(n)}return e},she=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,r);var t=r.length;if(!t)return"";for(var i=[],n=-1,o="";++n<t;){var a=r[n];a<=65535?i.push(a):(a-=65536,i.push((a>>10)+55296,a%1024+56320)),(n+1===t||i.length>16384)&&(o+=String.fromCharCode.apply(String,i),i.length=0)}return o},ohe=Yue(Uue),qf="",eO="",ahe=function(r){return ohe.get(r)},lhe=function(r,e,t){var i=t-2,n=e[i],o=e[t-1],a=e[t];if(o===tS&&a===rS)return qf;if(o===tS||o===rS||o===$k||a===tS||a===rS||a===$k)return eO;if(o===Wk&&[Wk,iS,Xk,Zk].indexOf(a)!==-1||(o===Xk||o===iS)&&(a===iS||a===nS)||(o===Zk||o===nS)&&a===nS||a===Jk||a===Kk||a===ihe||o===rhe)return qf;if(o===Jk&&a===Yk){for(;n===Kk;)n=e[--i];if(n===Yk)return qf}if(o===sS&&a===sS){for(var s=0;n===sS;)s++,n=e[--i];if(s%2===0)return qf}return eO},che=function(r){var e=nhe(r),t=e.length,i=0,n=0,o=e.map(ahe);return{next:function(){if(i>=t)return{done:!0,value:null};for(var a=qf;i<t&&(a=lhe(e,o,++i))===qf;);if(a!==qf||i===t){var s=she.apply(null,e.slice(n,i));return n=i,{value:s,done:!1}}return{done:!0,value:null}}}},uhe=function(r){for(var e=che(r),t=[],i;!(i=e.next()).done;)i.value&&t.push(i.value.slice());return t},hhe=function(r){var e=123;if(r.createRange){var t=r.createRange();if(t.getBoundingClientRect){var i=r.createElement("boundtest");i.style.height=e+"px",i.style.display="block",r.body.appendChild(i),t.selectNode(i);var n=t.getBoundingClientRect(),o=Math.round(n.height);if(r.body.removeChild(i),o===e)return!0}}return!1},Ahe=function(r){var e=r.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",r.body.appendChild(e);var t=r.createRange();e.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var i=e.firstChild,n=Uv(i.data).map(function(g){return $o(g)}),o=0,a={},s=n.every(function(g,y){t.setStart(i,o),t.setEnd(i,o+g.length);var T=t.getBoundingClientRect();o+=g.length;var I=T.x>a.x||T.y>a.y;return a=T,y===0?!0:I});return r.body.removeChild(e),s},dhe=function(){return typeof new Image().crossOrigin<"u"},fhe=function(){return typeof new XMLHttpRequest().responseType=="string"},phe=function(r){var e=new Image,t=r.createElement("canvas"),i=t.getContext("2d");if(!i)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{i.drawImage(e,0,0),t.toDataURL()}catch{return!1}return!0},tO=function(r){return r[0]===0&&r[1]===255&&r[2]===0&&r[3]===255},ghe=function(r){var e=r.createElement("canvas"),t=100;e.width=t,e.height=t;var i=e.getContext("2d");if(!i)return Promise.reject(!1);i.fillStyle="rgb(0, 255, 0)",i.fillRect(0,0,t,t);var n=new Image,o=e.toDataURL();n.src=o;var a=oS(t,t,0,0,n);return i.fillStyle="red",i.fillRect(0,0,t,t),rO(a).then(function(s){i.drawImage(s,0,0);var g=i.getImageData(0,0,t,t).data;i.fillStyle="red",i.fillRect(0,0,t,t);var y=r.createElement("div");return y.style.backgroundImage="url("+o+")",y.style.height=t+"px",tO(g)?rO(oS(t,t,0,0,y)):Promise.reject(!1)}).then(function(s){return i.drawImage(s,0,0),tO(i.getImageData(0,0,t,t).data)}).catch(function(){return!1})},oS=function(r,e,t,i,n){var o="http://www.w3.org/2000/svg",a=document.createElementNS(o,"svg"),s=document.createElementNS(o,"foreignObject");return a.setAttributeNS(null,"width",r.toString()),a.setAttributeNS(null,"height",e.toString()),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"height","100%"),s.setAttributeNS(null,"x",t.toString()),s.setAttributeNS(null,"y",i.toString()),s.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(s),s.appendChild(n),a},rO=function(r){return new Promise(function(e,t){var i=new Image;i.onload=function(){return e(i)},i.onerror=t,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},hl={get SUPPORT_RANGE_BOUNDS(){var r=hhe(document);return Object.defineProperty(hl,"SUPPORT_RANGE_BOUNDS",{value:r}),r},get SUPPORT_WORD_BREAKING(){var r=hl.SUPPORT_RANGE_BOUNDS&&Ahe(document);return Object.defineProperty(hl,"SUPPORT_WORD_BREAKING",{value:r}),r},get SUPPORT_SVG_DRAWING(){var r=phe(document);return Object.defineProperty(hl,"SUPPORT_SVG_DRAWING",{value:r}),r},get SUPPORT_FOREIGNOBJECT_DRAWING(){var r=typeof Array.from=="function"&&typeof window.fetch=="function"?ghe(document):Promise.resolve(!1);return Object.defineProperty(hl,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:r}),r},get SUPPORT_CORS_IMAGES(){var r=dhe();return Object.defineProperty(hl,"SUPPORT_CORS_IMAGES",{value:r}),r},get SUPPORT_RESPONSE_TYPE(){var r=fhe();return Object.defineProperty(hl,"SUPPORT_RESPONSE_TYPE",{value:r}),r},get SUPPORT_CORS_XHR(){var r="withCredentials"in new XMLHttpRequest;return Object.defineProperty(hl,"SUPPORT_CORS_XHR",{value:r}),r},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var r=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(hl,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:r}),r}},B0=function(){function r(e,t){this.text=e,this.bounds=t}return r}(),mhe=function(r,e,t,i){var n=vhe(e,t),o=[],a=0;return n.forEach(function(s){if(t.textDecorationLine.length||s.trim().length>0)if(hl.SUPPORT_RANGE_BOUNDS){var g=iO(i,a,s.length).getClientRects();if(g.length>1){var y=aS(s),T=0;y.forEach(function(R){o.push(new B0(R,zA.fromDOMRectList(r,iO(i,T+a,R.length).getClientRects()))),T+=R.length})}else o.push(new B0(s,zA.fromDOMRectList(r,g)))}else{var I=i.splitText(s.length);o.push(new B0(s,yhe(r,i))),i=I}else hl.SUPPORT_RANGE_BOUNDS||(i=i.splitText(s.length));a+=s.length}),o},yhe=function(r,e){var t=e.ownerDocument;if(t){var i=t.createElement("html2canvaswrapper");i.appendChild(e.cloneNode(!0));var n=e.parentNode;if(n){n.replaceChild(i,e);var o=Ov(r,i);return i.firstChild&&n.replaceChild(i.firstChild,i),o}}return zA.EMPTY},iO=function(r,e,t){var i=r.ownerDocument;if(!i)throw new Error("Node has no owner document");var n=i.createRange();return n.setStart(r,e),n.setEnd(r,e+t),n},aS=function(r){if(hl.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(r)).map(function(t){return t.segment})}return uhe(r)},_he=function(r,e){if(hl.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(t.segment(r)).map(function(i){return i.segment})}return xhe(r,e)},vhe=function(r,e){return e.letterSpacing!==0?aS(r):_he(r,e)},bhe=[32,160,4961,65792,65793,4153,4241],xhe=function(r,e){for(var t=Wae(r,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap==="break-word"?"break-word":e.wordBreak}),i=[],n,o=function(){if(n.value){var a=n.value.slice(),s=Uv(a),g="";s.forEach(function(y){bhe.indexOf(y)===-1?g+=$o(y):(g.length&&i.push(g),i.push($o(y)),g="")}),g.length&&i.push(g)}};!(n=t.next()).done;)o();return i},whe=function(){function r(e,t,i){this.text=Bhe(t.data,i.textTransform),this.textBounds=mhe(e,this.text,i,t)}return r}(),Bhe=function(r,e){switch(e){case 1:return r.toLowerCase();case 3:return r.replace(Che,Ehe);case 2:return r.toUpperCase();default:return r}},Che=/(^|\s|:|-|\(|\))([a-z])/g,Ehe=function(r,e,t){return r.length>0?e+t.toUpperCase():r},nO=function(r){mh(e,r);function e(t,i){var n=r.call(this,t,i)||this;return n.src=i.currentSrc||i.src,n.intrinsicWidth=i.naturalWidth,n.intrinsicHeight=i.naturalHeight,n.context.cache.addImage(n.src),n}return e}(nA),sO=function(r){mh(e,r);function e(t,i){var n=r.call(this,t,i)||this;return n.canvas=i,n.intrinsicWidth=i.width,n.intrinsicHeight=i.height,n}return e}(nA),oO=function(r){mh(e,r);function e(t,i){var n=r.call(this,t,i)||this,o=new XMLSerializer,a=Ov(t,i);return i.setAttribute("width",a.width+"px"),i.setAttribute("height",a.height+"px"),n.svg="data:image/svg+xml,"+encodeURIComponent(o.serializeToString(i)),n.intrinsicWidth=i.width.baseVal.value,n.intrinsicHeight=i.height.baseVal.value,n.context.cache.addImage(n.svg),n}return e}(nA),aO=function(r){mh(e,r);function e(t,i){var n=r.call(this,t,i)||this;return n.value=i.value,n}return e}(nA),lS=function(r){mh(e,r);function e(t,i){var n=r.call(this,t,i)||this;return n.start=i.start,n.reversed=typeof i.reversed=="boolean"&&i.reversed===!0,n}return e}(nA),She=[{type:15,flags:0,unit:"px",number:3}],The=[{type:16,flags:0,number:50}],Ihe=function(r){return r.width>r.height?new zA(r.left+(r.width-r.height)/2,r.top,r.height,r.height):r.width<r.height?new zA(r.left,r.top+(r.height-r.width)/2,r.width,r.width):r},Lhe=function(r){var e=r.type===Mhe?new Array(r.value.length+1).join(""):r.value;return e.length===0?r.placeholder||"":e},gb="checkbox",mb="radio",Mhe="password",lO=707406591,cS=function(r){mh(e,r);function e(t,i){var n=r.call(this,t,i)||this;switch(n.type=i.type.toLowerCase(),n.checked=i.checked,n.value=Lhe(i),(n.type===gb||n.type===mb)&&(n.styles.backgroundColor=3739148031,n.styles.borderTopColor=n.styles.borderRightColor=n.styles.borderBottomColor=n.styles.borderLeftColor=2779096575,n.styles.borderTopWidth=n.styles.borderRightWidth=n.styles.borderBottomWidth=n.styles.borderLeftWidth=1,n.styles.borderTopStyle=n.styles.borderRightStyle=n.styles.borderBottomStyle=n.styles.borderLeftStyle=1,n.styles.backgroundClip=[0],n.styles.backgroundOrigin=[0],n.bounds=Ihe(n.bounds)),n.type){case gb:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=She;break;case mb:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=The;break}return n}return e}(nA),cO=function(r){mh(e,r);function e(t,i){var n=r.call(this,t,i)||this,o=i.options[i.selectedIndex||0];return n.value=o&&o.text||"",n}return e}(nA),uO=function(r){mh(e,r);function e(t,i){var n=r.call(this,t,i)||this;return n.value=i.value,n}return e}(nA),hO=function(r){mh(e,r);function e(t,i){var n=r.call(this,t,i)||this;n.src=i.src,n.width=parseInt(i.width,10)||0,n.height=parseInt(i.height,10)||0,n.backgroundColor=n.styles.backgroundColor;try{if(i.contentWindow&&i.contentWindow.document&&i.contentWindow.document.documentElement){n.tree=dO(t,i.contentWindow.document.documentElement);var o=i.contentWindow.document.documentElement?b0(t,getComputedStyle(i.contentWindow.document.documentElement).backgroundColor):VA.TRANSPARENT,a=i.contentWindow.document.body?b0(t,getComputedStyle(i.contentWindow.document.body).backgroundColor):VA.TRANSPARENT;n.backgroundColor=Rd(o)?Rd(a)?n.styles.backgroundColor:a:o}}catch{}return n}return e}(nA),Phe=["OL","UL","MENU"],yb=function(r,e,t,i){for(var n=e.firstChild,o=void 0;n;n=o)if(o=n.nextSibling,fO(n)&&n.data.trim().length>0)t.textNodes.push(new whe(r,n,t.styles));else if(Yg(n))if(vO(n)&&n.assignedNodes)n.assignedNodes().forEach(function(s){return yb(r,s,t,i)});else{var a=AO(r,n);a.styles.isVisible()&&(Fhe(n,a,i)?a.flags|=4:Dhe(a.styles)&&(a.flags|=2),Phe.indexOf(n.tagName)!==-1&&(a.flags|=8),t.elements.push(a),n.slot,n.shadowRoot?yb(r,n.shadowRoot,a,i):!vb(n)&&!pO(n)&&!bb(n)&&yb(r,n,a,i))}},AO=function(r,e){return AS(e)?new nO(r,e):gO(e)?new sO(r,e):pO(e)?new oO(r,e):Rhe(e)?new aO(r,e):khe(e)?new lS(r,e):Ohe(e)?new cS(r,e):bb(e)?new cO(r,e):vb(e)?new uO(r,e):yO(e)?new hO(r,e):new nA(r,e)},dO=function(r,e){var t=AO(r,e);return t.flags|=4,yb(r,e,t,t),t},Fhe=function(r,e,t){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||hS(r)&&t.styles.isTransparent()},Dhe=function(r){return r.isPositioned()||r.isFloating()},fO=function(r){return r.nodeType===Node.TEXT_NODE},Yg=function(r){return r.nodeType===Node.ELEMENT_NODE},uS=function(r){return Yg(r)&&typeof r.style<"u"&&!_b(r)},_b=function(r){return typeof r.className=="object"},Rhe=function(r){return r.tagName==="LI"},khe=function(r){return r.tagName==="OL"},Ohe=function(r){return r.tagName==="INPUT"},Uhe=function(r){return r.tagName==="HTML"},pO=function(r){return r.tagName==="svg"},hS=function(r){return r.tagName==="BODY"},gO=function(r){return r.tagName==="CANVAS"},mO=function(r){return r.tagName==="VIDEO"},AS=function(r){return r.tagName==="IMG"},yO=function(r){return r.tagName==="IFRAME"},_O=function(r){return r.tagName==="STYLE"},Nhe=function(r){return r.tagName==="SCRIPT"},vb=function(r){return r.tagName==="TEXTAREA"},bb=function(r){return r.tagName==="SELECT"},vO=function(r){return r.tagName==="SLOT"},bO=function(r){return r.tagName.indexOf("-")>0},zhe=function(){function r(){this.counters={}}return r.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},r.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},r.prototype.pop=function(e){var t=this;e.forEach(function(i){return t.counters[i].pop()})},r.prototype.parse=function(e){var t=this,i=e.counterIncrement,n=e.counterReset,o=!0;i!==null&&i.forEach(function(s){var g=t.counters[s.counter];g&&s.increment!==0&&(o=!1,g.length||g.push(1),g[Math.max(0,g.length-1)]+=s.increment)});var a=[];return o&&n.forEach(function(s){var g=t.counters[s.counter];a.push(s.counter),g||(g=t.counters[s.counter]=[]),g.push(s.reset)}),a},r}(),xO={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},wO={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Qhe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Vhe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},em=function(r,e,t,i,n,o){return r<e||r>t?E0(r,n,o.length>0):i.integers.reduce(function(a,s,g){for(;r>=s;)r-=s,a+=i.values[g];return a},"")+o},BO=function(r,e,t,i){var n="";do t||r--,n=i(r)+n,r/=e;while(r*e>=e);return n},Ko=function(r,e,t,i,n){var o=t-e+1;return(r<0?"-":"")+(BO(Math.abs(r),o,i,function(a){return $o(Math.floor(a%o)+e)})+n)},$f=function(r,e,t){t===void 0&&(t=". ");var i=e.length;return BO(Math.abs(r),i,!1,function(n){return e[Math.floor(n%i)]})+t},tm=1,Od=2,Ud=4,C0=8,HA=function(r,e,t,i,n,o){if(r<-9999||r>9999)return E0(r,4,n.length>0);var a=Math.abs(r),s=n;if(a===0)return e[0]+s;for(var g=0;a>0&&g<=4;g++){var y=a%10;y===0&&Sa(o,tm)&&s!==""?s=e[y]+s:y>1||y===1&&g===0||y===1&&g===1&&Sa(o,Od)||y===1&&g===1&&Sa(o,Ud)&&r>100||y===1&&g>1&&Sa(o,C0)?s=e[y]+(g>0?t[g-1]:"")+s:y===1&&g>0&&(s=t[g-1]+s),a=Math.floor(a/10)}return(r<0?i:"")+s},CO="",EO="",SO="",dS="",E0=function(r,e,t){var i=t?". ":"",n=t?"":"",o=t?", ":"",a=t?" ":"";switch(e){case 0:return""+a;case 1:return""+a;case 2:return""+a;case 5:var s=Ko(r,48,57,!0,i);return s.length<4?"0"+s:s;case 4:return $f(r,"",n);case 6:return em(r,1,3999,xO,3,i).toLowerCase();case 7:return em(r,1,3999,xO,3,i);case 8:return Ko(r,945,969,!1,i);case 9:return Ko(r,97,122,!1,i);case 10:return Ko(r,65,90,!1,i);case 11:return Ko(r,1632,1641,!0,i);case 12:case 49:return em(r,1,9999,wO,3,i);case 35:return em(r,1,9999,wO,3,i).toLowerCase();case 13:return Ko(r,2534,2543,!0,i);case 14:case 30:return Ko(r,6112,6121,!0,i);case 15:return $f(r,"",n);case 16:return $f(r,"",n);case 17:case 48:return HA(r,"",CO,"",n,Od|Ud|C0);case 47:return HA(r,"",EO,"",n,tm|Od|Ud|C0);case 42:return HA(r,"",CO,"",n,Od|Ud|C0);case 41:return HA(r,"",EO,"",n,tm|Od|Ud|C0);case 26:return HA(r,"","",SO,n,0);case 25:return HA(r,"","",SO,n,tm|Od|Ud);case 31:return HA(r,"","",dS,o,tm|Od|Ud);case 33:return HA(r,"","",dS,o,0);case 32:return HA(r,"","",dS,o,tm|Od|Ud);case 18:return Ko(r,2406,2415,!0,i);case 20:return em(r,1,19999,Vhe,3,i);case 21:return Ko(r,2790,2799,!0,i);case 22:return Ko(r,2662,2671,!0,i);case 22:return em(r,1,10999,Qhe,3,i);case 23:return $f(r,"");case 24:return $f(r,"");case 27:return Ko(r,3302,3311,!0,i);case 28:return $f(r,"",n);case 29:return $f(r,"",n);case 34:return Ko(r,3792,3801,!0,i);case 37:return Ko(r,6160,6169,!0,i);case 38:return Ko(r,4160,4169,!0,i);case 39:return Ko(r,2918,2927,!0,i);case 40:return Ko(r,1776,1785,!0,i);case 43:return Ko(r,3046,3055,!0,i);case 44:return Ko(r,3174,3183,!0,i);case 45:return Ko(r,3664,3673,!0,i);case 46:return Ko(r,3872,3881,!0,i);case 3:default:return Ko(r,48,57,!0,i)}},TO="data-html2canvas-ignore",IO=function(){function r(e,t,i){if(this.context=e,this.options=i,this.scrolledElements=[],this.referenceElement=t,this.counters=new zhe,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return r.prototype.toIFrame=function(e,t){var i=this,n=Hhe(e,t);if(!n.contentWindow)return Promise.reject("Unable to find iframe window");var o=e.defaultView.pageXOffset,a=e.defaultView.pageYOffset,s=n.contentWindow,g=s.document,y=qhe(n).then(function(){return pc(i,void 0,void 0,function(){var T,I;return zl(this,function(R){switch(R.label){case 0:return this.scrolledElements.forEach(Xhe),s&&(s.scrollTo(t.left,t.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(s.scrollY!==t.top||s.scrollX!==t.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(s.scrollX-t.left,s.scrollY-t.top,0,0))),T=this.options.onclone,I=this.clonedReferenceElement,typeof I>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:g.fonts&&g.fonts.ready?[4,g.fonts.ready]:[3,2];case 1:R.sent(),R.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,jhe(g)]:[3,4];case 3:R.sent(),R.label=4;case 4:return typeof T=="function"?[2,Promise.resolve().then(function(){return T(g,I)}).then(function(){return n})]:[2,n]}})})});return g.open(),g.write(Khe(document.doctype)+"<html></html>"),Whe(this.referenceElement.ownerDocument,o,a),g.replaceChild(g.adoptNode(this.documentElement),g.documentElement),g.close(),y},r.prototype.createElementClone=function(e){if(ZE(e,2))debugger;if(gO(e))return this.createCanvasClone(e);if(mO(e))return this.createVideoClone(e);if(_O(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return AS(t)&&(AS(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager")),bO(t)?this.createCustomElementClone(t):t},r.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return fS(e.style,t),t},r.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var i=[].slice.call(t.cssRules,0).reduce(function(o,a){return a&&typeof a.cssText=="string"?o+a.cssText:o},""),n=e.cloneNode(!1);return n.textContent=i,n}}catch(o){if(this.context.logger.error("Unable to access cssRules property",o),o.name!=="SecurityError")throw o}return e.cloneNode(!1)},r.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var i=e.ownerDocument.createElement("img");try{return i.src=e.toDataURL(),i}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var n=e.cloneNode(!1);try{n.width=e.width,n.height=e.height;var o=e.getContext("2d"),a=n.getContext("2d");if(a)if(!this.options.allowTaint&&o)a.putImageData(o.getImageData(0,0,e.width,e.height),0,0);else{var s=(t=e.getContext("webgl2"))!==null&&t!==void 0?t:e.getContext("webgl");if(s){var g=s.getContextAttributes();(g==null?void 0:g.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}a.drawImage(e,0,0)}return n}catch{this.context.logger.info("Unable to clone canvas as it is tainted",e)}return n},r.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var i=t.getContext("2d");try{return i&&(i.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||i.getImageData(0,0,t.width,t.height)),t}catch{this.context.logger.info("Unable to clone video as it is tainted",e)}var n=e.ownerDocument.createElement("canvas");return n.width=e.offsetWidth,n.height=e.offsetHeight,n},r.prototype.appendChildNode=function(e,t,i){(!Yg(t)||!Nhe(t)&&!t.hasAttribute(TO)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(t)))&&(!this.options.copyStyles||!Yg(t)||!_O(t))&&e.appendChild(this.cloneNode(t,i))},r.prototype.cloneChildNodes=function(e,t,i){for(var n=this,o=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;o;o=o.nextSibling)if(Yg(o)&&vO(o)&&typeof o.assignedNodes=="function"){var a=o.assignedNodes();a.length&&a.forEach(function(s){return n.appendChildNode(t,s,i)})}else this.appendChildNode(t,o,i)},r.prototype.cloneNode=function(e,t){if(fO(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var i=e.ownerDocument.defaultView;if(i&&Yg(e)&&(uS(e)||_b(e))){var n=this.createElementClone(e);n.style.transitionProperty="none";var o=i.getComputedStyle(e),a=i.getComputedStyle(e,":before"),s=i.getComputedStyle(e,":after");this.referenceElement===e&&uS(n)&&(this.clonedReferenceElement=n),hS(n)&&Yhe(n);var g=this.counters.parse(new Vk(this.context,o)),y=this.resolvePseudoContent(e,n,a,S0.BEFORE);bO(e)&&(t=!0),mO(e)||this.cloneChildNodes(e,n,t),y&&n.insertBefore(y,n.firstChild);var T=this.resolvePseudoContent(e,n,s,S0.AFTER);return T&&n.appendChild(T),this.counters.pop(g),(o&&(this.options.copyStyles||_b(e))&&!yO(e)||t)&&fS(o,n),(e.scrollTop!==0||e.scrollLeft!==0)&&this.scrolledElements.push([n,e.scrollLeft,e.scrollTop]),(vb(e)||bb(e))&&(vb(n)||bb(n))&&(n.value=e.value),n}return e.cloneNode(!1)},r.prototype.resolvePseudoContent=function(e,t,i,n){var o=this;if(i){var a=i.content,s=t.ownerDocument;if(!(!s||!a||a==="none"||a==="-moz-alt-content"||i.display==="none")){this.counters.parse(new Vk(this.context,i));var g=new Rue(this.context,i),y=s.createElement("html2canvaspseudoelement");fS(i,y),g.content.forEach(function(I){if(I.type===0)y.appendChild(s.createTextNode(I.value));else if(I.type===22){var R=s.createElement("img");R.src=I.value,R.style.opacity="1",y.appendChild(R)}else if(I.type===18){if(I.name==="attr"){var U=I.values.filter(Cs);U.length&&y.appendChild(s.createTextNode(e.getAttribute(U[0].value)||""))}else if(I.name==="counter"){var Z=I.values.filter(Zg),Y=Z[0],he=Z[1];if(Y&&Cs(Y)){var ce=o.counters.getCounterValue(Y.value),pe=he&&Cs(he)?XE.parse(o.context,he.value):3;y.appendChild(s.createTextNode(E0(ce,pe,!1)))}}else if(I.name==="counters"){var be=I.values.filter(Zg),Y=be[0],Te=be[1],he=be[2];if(Y&&Cs(Y)){var qe=o.counters.getCounterValues(Y.value),je=he&&Cs(he)?XE.parse(o.context,he.value):3,We=Te&&Te.type===0?Te.value:"",Ne=qe.map(function(ke){return E0(ke,je,!1)}).join(We);y.appendChild(s.createTextNode(Ne))}}}else if(I.type===20)switch(I.value){case"open-quote":y.appendChild(s.createTextNode(Qk(g.quotes,o.quoteDepth++,!0)));break;case"close-quote":y.appendChild(s.createTextNode(Qk(g.quotes,--o.quoteDepth,!1)));break;default:y.appendChild(s.createTextNode(I.value))}}),y.className=pS+" "+gS;var T=n===S0.BEFORE?" "+pS:" "+gS;return _b(t)?t.className.baseValue+=T:t.className+=T,y}}},r.destroy=function(e){return e.parentNode?(e.parentNode.removeChild(e),!0):!1},r}(),S0;(function(r){r[r.BEFORE=0]="BEFORE",r[r.AFTER=1]="AFTER"})(S0||(S0={}));var Hhe=function(r,e){var t=r.createElement("iframe");return t.className="html2canvas-container",t.style.visibility="hidden",t.style.position="fixed",t.style.left="-10000px",t.style.top="0px",t.style.border="0",t.width=e.width.toString(),t.height=e.height.toString(),t.scrolling="no",t.setAttribute(TO,"true"),r.body.appendChild(t),t},Ghe=function(r){return new Promise(function(e){if(r.complete){e();return}if(!r.src){e();return}r.onload=e,r.onerror=e})},jhe=function(r){return Promise.all([].slice.call(r.images,0).map(Ghe))},qhe=function(r){return new Promise(function(e,t){var i=r.contentWindow;if(!i)return t("No window assigned for iframe");var n=i.document;i.onload=r.onload=function(){i.onload=r.onload=null;var o=setInterval(function(){n.body.childNodes.length>0&&n.readyState==="complete"&&(clearInterval(o),e(r))},50)}})},$he=["all","d","content"],fS=function(r,e){for(var t=r.length-1;t>=0;t--){var i=r.item(t);$he.indexOf(i)===-1&&e.style.setProperty(i,r.getPropertyValue(i))}return e},Khe=function(r){var e="";return r&&(e+="<!DOCTYPE ",r.name&&(e+=r.name),r.internalSubset&&(e+=r.internalSubset),r.publicId&&(e+='"'+r.publicId+'"'),r.systemId&&(e+='"'+r.systemId+'"'),e+=">"),e},Whe=function(r,e,t){r&&r.defaultView&&(e!==r.defaultView.pageXOffset||t!==r.defaultView.pageYOffset)&&r.defaultView.scrollTo(e,t)},Xhe=function(r){var e=r[0],t=r[1],i=r[2];e.scrollLeft=t,e.scrollTop=i},Zhe=":before",Jhe=":after",pS="___html2canvas___pseudoelement_before",gS="___html2canvas___pseudoelement_after",LO=`{
    content: "" !important;
    display: none !important;
}`,Yhe=function(r){eAe(r,"."+pS+Zhe+LO+`
         .`+gS+Jhe+LO)},eAe=function(r,e){var t=r.ownerDocument;if(t){var i=t.createElement("style");i.textContent=e,r.appendChild(i)}},MO=function(){function r(){}return r.getOrigin=function(e){var t=r._link;return t?(t.href=e,t.href=t.href,t.protocol+t.hostname+t.port):"about:blank"},r.isSameOrigin=function(e){return r.getOrigin(e)===r._origin},r.setContext=function(e){r._link=e.document.createElement("a"),r._origin=r.getOrigin(e.location.href)},r._origin="about:blank",r}(),tAe=function(){function r(e,t){this.context=e,this._options=t,this._cache={}}return r.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)||(yS(e)||sAe(e))&&(this._cache[e]=this.loadImage(e)).catch(function(){}),t},r.prototype.match=function(e){return this._cache[e]},r.prototype.loadImage=function(e){return pc(this,void 0,void 0,function(){var t,i,n,o,a=this;return zl(this,function(s){switch(s.label){case 0:return t=MO.isSameOrigin(e),i=!mS(e)&&this._options.useCORS===!0&&hl.SUPPORT_CORS_IMAGES&&!t,n=!mS(e)&&!t&&!yS(e)&&typeof this._options.proxy=="string"&&hl.SUPPORT_CORS_XHR&&!i,!t&&this._options.allowTaint===!1&&!mS(e)&&!yS(e)&&!n&&!i?[2]:(o=e,n?[4,this.proxy(o)]:[3,2]);case 1:o=s.sent(),s.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(g,y){var T=new Image;T.onload=function(){return g(T)},T.onerror=y,(oAe(o)||i)&&(T.crossOrigin="anonymous"),T.src=o,T.complete===!0&&setTimeout(function(){return g(T)},500),a._options.imageTimeout>0&&setTimeout(function(){return y("Timed out ("+a._options.imageTimeout+"ms) loading image")},a._options.imageTimeout)})];case 3:return[2,s.sent()]}})})},r.prototype.has=function(e){return typeof this._cache[e]<"u"},r.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},r.prototype.proxy=function(e){var t=this,i=this._options.proxy;if(!i)throw new Error("No proxy defined");var n=e.substring(0,256);return new Promise(function(o,a){var s=hl.SUPPORT_RESPONSE_TYPE?"blob":"text",g=new XMLHttpRequest;g.onload=function(){if(g.status===200)if(s==="text")o(g.response);else{var I=new FileReader;I.addEventListener("load",function(){return o(I.result)},!1),I.addEventListener("error",function(R){return a(R)},!1),I.readAsDataURL(g.response)}else a("Failed to proxy resource "+n+" with status code "+g.status)},g.onerror=a;var y=i.indexOf("?")>-1?"&":"?";if(g.open("GET",""+i+y+"url="+encodeURIComponent(e)+"&responseType="+s),s!=="text"&&g instanceof XMLHttpRequest&&(g.responseType=s),t._options.imageTimeout){var T=t._options.imageTimeout;g.timeout=T,g.ontimeout=function(){return a("Timed out ("+T+"ms) proxying "+n)}}g.send()})},r}(),rAe=/^data:image\/svg\+xml/i,iAe=/^data:image\/.*;base64,/i,nAe=/^data:image\/.*/i,sAe=function(r){return hl.SUPPORT_SVG_DRAWING||!aAe(r)},mS=function(r){return nAe.test(r)},oAe=function(r){return iAe.test(r)},yS=function(r){return r.substr(0,4)==="blob"},aAe=function(r){return r.substr(-3).toLowerCase()==="svg"||rAe.test(r)},Yr=function(){function r(e,t){this.type=0,this.x=e,this.y=t}return r.prototype.add=function(e,t){return new r(this.x+e,this.y+t)},r}(),rm=function(r,e,t){return new Yr(r.x+(e.x-r.x)*t,r.y+(e.y-r.y)*t)},xb=function(){function r(e,t,i,n){this.type=1,this.start=e,this.startControl=t,this.endControl=i,this.end=n}return r.prototype.subdivide=function(e,t){var i=rm(this.start,this.startControl,e),n=rm(this.startControl,this.endControl,e),o=rm(this.endControl,this.end,e),a=rm(i,n,e),s=rm(n,o,e),g=rm(a,s,e);return t?new r(this.start,i,a,g):new r(g,s,o,this.end)},r.prototype.add=function(e,t){return new r(this.start.add(e,t),this.startControl.add(e,t),this.endControl.add(e,t),this.end.add(e,t))},r.prototype.reverse=function(){return new r(this.end,this.endControl,this.startControl,this.start)},r}(),Uu=function(r){return r.type===1},lAe=function(){function r(e){var t=e.styles,i=e.bounds,n=v0(t.borderTopLeftRadius,i.width,i.height),o=n[0],a=n[1],s=v0(t.borderTopRightRadius,i.width,i.height),g=s[0],y=s[1],T=v0(t.borderBottomRightRadius,i.width,i.height),I=T[0],R=T[1],U=v0(t.borderBottomLeftRadius,i.width,i.height),Z=U[0],Y=U[1],he=[];he.push((o+g)/i.width),he.push((Z+I)/i.width),he.push((a+Y)/i.height),he.push((y+R)/i.height);var ce=Math.max.apply(Math,he);ce>1&&(o/=ce,a/=ce,g/=ce,y/=ce,I/=ce,R/=ce,Z/=ce,Y/=ce);var pe=i.width-g,be=i.height-R,Te=i.width-I,qe=i.height-Y,je=t.borderTopWidth,We=t.borderRightWidth,Ne=t.borderBottomWidth,at=t.borderLeftWidth,nt=Gs(t.paddingTop,e.bounds.width),ke=Gs(t.paddingRight,e.bounds.width),De=Gs(t.paddingBottom,e.bounds.width),Ye=Gs(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=o>0||a>0?lo(i.left+at/3,i.top+je/3,o-at/3,a-je/3,us.TOP_LEFT):new Yr(i.left+at/3,i.top+je/3),this.topRightBorderDoubleOuterBox=o>0||a>0?lo(i.left+pe,i.top+je/3,g-We/3,y-je/3,us.TOP_RIGHT):new Yr(i.left+i.width-We/3,i.top+je/3),this.bottomRightBorderDoubleOuterBox=I>0||R>0?lo(i.left+Te,i.top+be,I-We/3,R-Ne/3,us.BOTTOM_RIGHT):new Yr(i.left+i.width-We/3,i.top+i.height-Ne/3),this.bottomLeftBorderDoubleOuterBox=Z>0||Y>0?lo(i.left+at/3,i.top+qe,Z-at/3,Y-Ne/3,us.BOTTOM_LEFT):new Yr(i.left+at/3,i.top+i.height-Ne/3),this.topLeftBorderDoubleInnerBox=o>0||a>0?lo(i.left+at*2/3,i.top+je*2/3,o-at*2/3,a-je*2/3,us.TOP_LEFT):new Yr(i.left+at*2/3,i.top+je*2/3),this.topRightBorderDoubleInnerBox=o>0||a>0?lo(i.left+pe,i.top+je*2/3,g-We*2/3,y-je*2/3,us.TOP_RIGHT):new Yr(i.left+i.width-We*2/3,i.top+je*2/3),this.bottomRightBorderDoubleInnerBox=I>0||R>0?lo(i.left+Te,i.top+be,I-We*2/3,R-Ne*2/3,us.BOTTOM_RIGHT):new Yr(i.left+i.width-We*2/3,i.top+i.height-Ne*2/3),this.bottomLeftBorderDoubleInnerBox=Z>0||Y>0?lo(i.left+at*2/3,i.top+qe,Z-at*2/3,Y-Ne*2/3,us.BOTTOM_LEFT):new Yr(i.left+at*2/3,i.top+i.height-Ne*2/3),this.topLeftBorderStroke=o>0||a>0?lo(i.left+at/2,i.top+je/2,o-at/2,a-je/2,us.TOP_LEFT):new Yr(i.left+at/2,i.top+je/2),this.topRightBorderStroke=o>0||a>0?lo(i.left+pe,i.top+je/2,g-We/2,y-je/2,us.TOP_RIGHT):new Yr(i.left+i.width-We/2,i.top+je/2),this.bottomRightBorderStroke=I>0||R>0?lo(i.left+Te,i.top+be,I-We/2,R-Ne/2,us.BOTTOM_RIGHT):new Yr(i.left+i.width-We/2,i.top+i.height-Ne/2),this.bottomLeftBorderStroke=Z>0||Y>0?lo(i.left+at/2,i.top+qe,Z-at/2,Y-Ne/2,us.BOTTOM_LEFT):new Yr(i.left+at/2,i.top+i.height-Ne/2),this.topLeftBorderBox=o>0||a>0?lo(i.left,i.top,o,a,us.TOP_LEFT):new Yr(i.left,i.top),this.topRightBorderBox=g>0||y>0?lo(i.left+pe,i.top,g,y,us.TOP_RIGHT):new Yr(i.left+i.width,i.top),this.bottomRightBorderBox=I>0||R>0?lo(i.left+Te,i.top+be,I,R,us.BOTTOM_RIGHT):new Yr(i.left+i.width,i.top+i.height),this.bottomLeftBorderBox=Z>0||Y>0?lo(i.left,i.top+qe,Z,Y,us.BOTTOM_LEFT):new Yr(i.left,i.top+i.height),this.topLeftPaddingBox=o>0||a>0?lo(i.left+at,i.top+je,Math.max(0,o-at),Math.max(0,a-je),us.TOP_LEFT):new Yr(i.left+at,i.top+je),this.topRightPaddingBox=g>0||y>0?lo(i.left+Math.min(pe,i.width-We),i.top+je,pe>i.width+We?0:Math.max(0,g-We),Math.max(0,y-je),us.TOP_RIGHT):new Yr(i.left+i.width-We,i.top+je),this.bottomRightPaddingBox=I>0||R>0?lo(i.left+Math.min(Te,i.width-at),i.top+Math.min(be,i.height-Ne),Math.max(0,I-We),Math.max(0,R-Ne),us.BOTTOM_RIGHT):new Yr(i.left+i.width-We,i.top+i.height-Ne),this.bottomLeftPaddingBox=Z>0||Y>0?lo(i.left+at,i.top+Math.min(qe,i.height-Ne),Math.max(0,Z-at),Math.max(0,Y-Ne),us.BOTTOM_LEFT):new Yr(i.left+at,i.top+i.height-Ne),this.topLeftContentBox=o>0||a>0?lo(i.left+at+Ye,i.top+je+nt,Math.max(0,o-(at+Ye)),Math.max(0,a-(je+nt)),us.TOP_LEFT):new Yr(i.left+at+Ye,i.top+je+nt),this.topRightContentBox=g>0||y>0?lo(i.left+Math.min(pe,i.width+at+Ye),i.top+je+nt,pe>i.width+at+Ye?0:g-at+Ye,y-(je+nt),us.TOP_RIGHT):new Yr(i.left+i.width-(We+ke),i.top+je+nt),this.bottomRightContentBox=I>0||R>0?lo(i.left+Math.min(Te,i.width-(at+Ye)),i.top+Math.min(be,i.height+je+nt),Math.max(0,I-(We+ke)),R-(Ne+De),us.BOTTOM_RIGHT):new Yr(i.left+i.width-(We+ke),i.top+i.height-(Ne+De)),this.bottomLeftContentBox=Z>0||Y>0?lo(i.left+at+Ye,i.top+qe,Math.max(0,Z-(at+Ye)),Y-(Ne+De),us.BOTTOM_LEFT):new Yr(i.left+at+Ye,i.top+i.height-(Ne+De))}return r}(),us;(function(r){r[r.TOP_LEFT=0]="TOP_LEFT",r[r.TOP_RIGHT=1]="TOP_RIGHT",r[r.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",r[r.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(us||(us={}));var lo=function(r,e,t,i,n){var o=4*((Math.sqrt(2)-1)/3),a=t*o,s=i*o,g=r+t,y=e+i;switch(n){case us.TOP_LEFT:return new xb(new Yr(r,y),new Yr(r,y-s),new Yr(g-a,e),new Yr(g,e));case us.TOP_RIGHT:return new xb(new Yr(r,e),new Yr(r+a,e),new Yr(g,y-s),new Yr(g,y));case us.BOTTOM_RIGHT:return new xb(new Yr(g,e),new Yr(g,e+s),new Yr(r+a,y),new Yr(r,y));case us.BOTTOM_LEFT:default:return new xb(new Yr(g,y),new Yr(g-a,y),new Yr(r,e+s),new Yr(r,e))}},wb=function(r){return[r.topLeftBorderBox,r.topRightBorderBox,r.bottomRightBorderBox,r.bottomLeftBorderBox]},cAe=function(r){return[r.topLeftContentBox,r.topRightContentBox,r.bottomRightContentBox,r.bottomLeftContentBox]},Bb=function(r){return[r.topLeftPaddingBox,r.topRightPaddingBox,r.bottomRightPaddingBox,r.bottomLeftPaddingBox]},uAe=function(){function r(e,t,i){this.offsetX=e,this.offsetY=t,this.matrix=i,this.type=0,this.target=6}return r}(),Cb=function(){function r(e,t){this.path=e,this.target=t,this.type=1}return r}(),hAe=function(){function r(e){this.opacity=e,this.type=2,this.target=6}return r}(),AAe=function(r){return r.type===0},PO=function(r){return r.type===1},dAe=function(r){return r.type===2},FO=function(r,e){return r.length===e.length?r.some(function(t,i){return t===e[i]}):!1},fAe=function(r,e,t,i,n){return r.map(function(o,a){switch(a){case 0:return o.add(e,t);case 1:return o.add(e+i,t);case 2:return o.add(e+i,t+n);case 3:return o.add(e,t+n)}return o})},DO=function(){function r(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return r}(),RO=function(){function r(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new lAe(this.container),this.container.styles.opacity<1&&this.effects.push(new hAe(this.container.styles.opacity)),this.container.styles.transform!==null){var i=this.container.bounds.left+this.container.styles.transformOrigin[0].number,n=this.container.bounds.top+this.container.styles.transformOrigin[1].number,o=this.container.styles.transform;this.effects.push(new uAe(i,n,o))}if(this.container.styles.overflowX!==0){var a=wb(this.curves),s=Bb(this.curves);FO(a,s)?this.effects.push(new Cb(a,6)):(this.effects.push(new Cb(a,2)),this.effects.push(new Cb(s,4)))}}return r.prototype.getEffects=function(e){for(var t=[2,3].indexOf(this.container.styles.position)===-1,i=this.parent,n=this.effects.slice(0);i;){var o=i.effects.filter(function(g){return!PO(g)});if(t||i.container.styles.position!==0||!i.parent){if(n.unshift.apply(n,o),t=[2,3].indexOf(i.container.styles.position)===-1,i.container.styles.overflowX!==0){var a=wb(i.curves),s=Bb(i.curves);FO(a,s)||n.unshift(new Cb(s,6))}}else n.unshift.apply(n,o);i=i.parent}return n.filter(function(g){return Sa(g.target,e)})},r}(),_S=function(r,e,t,i){r.container.elements.forEach(function(n){var o=Sa(n.flags,4),a=Sa(n.flags,2),s=new RO(n,r);Sa(n.styles.display,2048)&&i.push(s);var g=Sa(n.flags,8)?[]:i;if(o||a){var y=o||n.styles.isPositioned()?t:e,T=new DO(s);if(n.styles.isPositioned()||n.styles.opacity<1||n.styles.isTransformed()){var I=n.styles.zIndex.order;if(I<0){var R=0;y.negativeZIndex.some(function(Z,Y){return I>Z.element.container.styles.zIndex.order?(R=Y,!1):R>0}),y.negativeZIndex.splice(R,0,T)}else if(I>0){var U=0;y.positiveZIndex.some(function(Z,Y){return I>=Z.element.container.styles.zIndex.order?(U=Y+1,!1):U>0}),y.positiveZIndex.splice(U,0,T)}else y.zeroOrAutoZIndexOrTransformedOrOpacity.push(T)}else n.styles.isFloating()?y.nonPositionedFloats.push(T):y.nonPositionedInlineLevel.push(T);_S(s,T,o?T:t,g)}else n.styles.isInlineLevel()?e.inlineLevel.push(s):e.nonInlineLevel.push(s),_S(s,e,t,g);Sa(n.flags,8)&&kO(n,g)})},kO=function(r,e){for(var t=r instanceof lS?r.start:1,i=r instanceof lS?r.reversed:!1,n=0;n<e.length;n++){var o=e[n];o.container instanceof aO&&typeof o.container.value=="number"&&o.container.value!==0&&(t=o.container.value),o.listValue=E0(t,o.container.styles.listStyleType,!0),t+=i?-1:1}},pAe=function(r){var e=new RO(r,null),t=new DO(e),i=[];return _S(e,t,t,i),kO(e.container,i),t},OO=function(r,e){switch(e){case 0:return Nu(r.topLeftBorderBox,r.topLeftPaddingBox,r.topRightBorderBox,r.topRightPaddingBox);case 1:return Nu(r.topRightBorderBox,r.topRightPaddingBox,r.bottomRightBorderBox,r.bottomRightPaddingBox);case 2:return Nu(r.bottomRightBorderBox,r.bottomRightPaddingBox,r.bottomLeftBorderBox,r.bottomLeftPaddingBox);case 3:default:return Nu(r.bottomLeftBorderBox,r.bottomLeftPaddingBox,r.topLeftBorderBox,r.topLeftPaddingBox)}},gAe=function(r,e){switch(e){case 0:return Nu(r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox,r.topRightBorderBox,r.topRightBorderDoubleOuterBox);case 1:return Nu(r.topRightBorderBox,r.topRightBorderDoubleOuterBox,r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox);case 2:return Nu(r.bottomRightBorderBox,r.bottomRightBorderDoubleOuterBox,r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox);case 3:default:return Nu(r.bottomLeftBorderBox,r.bottomLeftBorderDoubleOuterBox,r.topLeftBorderBox,r.topLeftBorderDoubleOuterBox)}},mAe=function(r,e){switch(e){case 0:return Nu(r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox,r.topRightBorderDoubleInnerBox,r.topRightPaddingBox);case 1:return Nu(r.topRightBorderDoubleInnerBox,r.topRightPaddingBox,r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox);case 2:return Nu(r.bottomRightBorderDoubleInnerBox,r.bottomRightPaddingBox,r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox);case 3:default:return Nu(r.bottomLeftBorderDoubleInnerBox,r.bottomLeftPaddingBox,r.topLeftBorderDoubleInnerBox,r.topLeftPaddingBox)}},yAe=function(r,e){switch(e){case 0:return Eb(r.topLeftBorderStroke,r.topRightBorderStroke);case 1:return Eb(r.topRightBorderStroke,r.bottomRightBorderStroke);case 2:return Eb(r.bottomRightBorderStroke,r.bottomLeftBorderStroke);case 3:default:return Eb(r.bottomLeftBorderStroke,r.topLeftBorderStroke)}},Eb=function(r,e){var t=[];return Uu(r)?t.push(r.subdivide(.5,!1)):t.push(r),Uu(e)?t.push(e.subdivide(.5,!0)):t.push(e),t},Nu=function(r,e,t,i){var n=[];return Uu(r)?n.push(r.subdivide(.5,!1)):n.push(r),Uu(t)?n.push(t.subdivide(.5,!0)):n.push(t),Uu(i)?n.push(i.subdivide(.5,!0).reverse()):n.push(i),Uu(e)?n.push(e.subdivide(.5,!1).reverse()):n.push(e),n},UO=function(r){var e=r.bounds,t=r.styles;return e.add(t.borderLeftWidth,t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth),-(t.borderTopWidth+t.borderBottomWidth))},Sb=function(r){var e=r.styles,t=r.bounds,i=Gs(e.paddingLeft,t.width),n=Gs(e.paddingRight,t.width),o=Gs(e.paddingTop,t.width),a=Gs(e.paddingBottom,t.width);return t.add(i+e.borderLeftWidth,o+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+i+n),-(e.borderTopWidth+e.borderBottomWidth+o+a))},_Ae=function(r,e){return r===0?e.bounds:r===2?Sb(e):UO(e)},vAe=function(r,e){return r===0?e.bounds:r===2?Sb(e):UO(e)},vS=function(r,e,t){var i=_Ae(nm(r.styles.backgroundOrigin,e),r),n=vAe(nm(r.styles.backgroundClip,e),r),o=bAe(nm(r.styles.backgroundSize,e),t,i),a=o[0],s=o[1],g=v0(nm(r.styles.backgroundPosition,e),i.width-a,i.height-s),y=xAe(nm(r.styles.backgroundRepeat,e),g,o,i,n),T=Math.round(i.left+g[0]),I=Math.round(i.top+g[1]);return[y,T,I,a,s]},im=function(r){return Cs(r)&&r.value===Jg.AUTO},Tb=function(r){return typeof r=="number"},bAe=function(r,e,t){var i=e[0],n=e[1],o=e[2],a=r[0],s=r[1];if(!a)return[0,0];if(ca(a)&&s&&ca(s))return[Gs(a,t.width),Gs(s,t.height)];var g=Tb(o);if(Cs(a)&&(a.value===Jg.CONTAIN||a.value===Jg.COVER)){if(Tb(o)){var y=t.width/t.height;return y<o!=(a.value===Jg.COVER)?[t.width,t.width/o]:[t.height*o,t.height]}return[t.width,t.height]}var T=Tb(i),I=Tb(n),R=T||I;if(im(a)&&(!s||im(s))){if(T&&I)return[i,n];if(!g&&!R)return[t.width,t.height];if(R&&g){var U=T?i:n*o,Z=I?n:i/o;return[U,Z]}var Y=T?i:t.width,he=I?n:t.height;return[Y,he]}if(g){var ce=0,pe=0;return ca(a)?ce=Gs(a,t.width):ca(s)&&(pe=Gs(s,t.height)),im(a)?ce=pe*o:(!s||im(s))&&(pe=ce/o),[ce,pe]}var be=null,Te=null;if(ca(a)?be=Gs(a,t.width):s&&ca(s)&&(Te=Gs(s,t.height)),be!==null&&(!s||im(s))&&(Te=T&&I?be/i*n:t.height),Te!==null&&im(a)&&(be=T&&I?Te/n*i:t.width),be!==null&&Te!==null)return[be,Te];throw new Error("Unable to calculate background-size for element")},nm=function(r,e){var t=r[e];return typeof t>"u"?r[0]:t},xAe=function(r,e,t,i,n){var o=e[0],a=e[1],s=t[0],g=t[1];switch(r){case 2:return[new Yr(Math.round(i.left),Math.round(i.top+a)),new Yr(Math.round(i.left+i.width),Math.round(i.top+a)),new Yr(Math.round(i.left+i.width),Math.round(g+i.top+a)),new Yr(Math.round(i.left),Math.round(g+i.top+a))];case 3:return[new Yr(Math.round(i.left+o),Math.round(i.top)),new Yr(Math.round(i.left+o+s),Math.round(i.top)),new Yr(Math.round(i.left+o+s),Math.round(i.height+i.top)),new Yr(Math.round(i.left+o),Math.round(i.height+i.top))];case 1:return[new Yr(Math.round(i.left+o),Math.round(i.top+a)),new Yr(Math.round(i.left+o+s),Math.round(i.top+a)),new Yr(Math.round(i.left+o+s),Math.round(i.top+a+g)),new Yr(Math.round(i.left+o),Math.round(i.top+a+g))];default:return[new Yr(Math.round(n.left),Math.round(n.top)),new Yr(Math.round(n.left+n.width),Math.round(n.top)),new Yr(Math.round(n.left+n.width),Math.round(n.height+n.top)),new Yr(Math.round(n.left),Math.round(n.height+n.top))]}},wAe="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",NO="Hidden Text",BAe=function(){function r(e){this._data={},this._document=e}return r.prototype.parseMetrics=function(e,t){var i=this._document.createElement("div"),n=this._document.createElement("img"),o=this._document.createElement("span"),a=this._document.body;i.style.visibility="hidden",i.style.fontFamily=e,i.style.fontSize=t,i.style.margin="0",i.style.padding="0",i.style.whiteSpace="nowrap",a.appendChild(i),n.src=wAe,n.width=1,n.height=1,n.style.margin="0",n.style.padding="0",n.style.verticalAlign="baseline",o.style.fontFamily=e,o.style.fontSize=t,o.style.margin="0",o.style.padding="0",o.appendChild(this._document.createTextNode(NO)),i.appendChild(o),i.appendChild(n);var s=n.offsetTop-o.offsetTop+2;i.removeChild(o),i.appendChild(this._document.createTextNode(NO)),i.style.lineHeight="normal",n.style.verticalAlign="super";var g=n.offsetTop-i.offsetTop+2;return a.removeChild(i),{baseline:s,middle:g}},r.prototype.getMetrics=function(e,t){var i=e+" "+t;return typeof this._data[i]>"u"&&(this._data[i]=this.parseMetrics(e,t)),this._data[i]},r}(),zO=function(){function r(e,t){this.context=e,this.options=t}return r}(),CAe=1e4,EAe=function(r){mh(e,r);function e(t,i){var n=r.call(this,t,i)||this;return n._activeEffects=[],n.canvas=i.canvas?i.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),i.canvas||(n.canvas.width=Math.floor(i.width*i.scale),n.canvas.height=Math.floor(i.height*i.scale),n.canvas.style.width=i.width+"px",n.canvas.style.height=i.height+"px"),n.fontMetrics=new BAe(document),n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-i.x,-i.y),n.ctx.textBaseline="bottom",n._activeEffects=[],n.context.logger.debug("Canvas renderer initialized ("+i.width+"x"+i.height+") with scale "+i.scale),n}return e.prototype.applyEffects=function(t){for(var i=this;this._activeEffects.length;)this.popEffect();t.forEach(function(n){return i.applyEffect(n)})},e.prototype.applyEffect=function(t){this.ctx.save(),dAe(t)&&(this.ctx.globalAlpha=t.opacity),AAe(t)&&(this.ctx.translate(t.offsetX,t.offsetY),this.ctx.transform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this.ctx.translate(-t.offsetX,-t.offsetY)),PO(t)&&(this.path(t.path),this.ctx.clip()),this._activeEffects.push(t)},e.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},e.prototype.renderStack=function(t){return pc(this,void 0,void 0,function(){var i;return zl(this,function(n){switch(n.label){case 0:return i=t.element.container.styles,i.isVisible()?[4,this.renderStackContent(t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})})},e.prototype.renderNode=function(t){return pc(this,void 0,void 0,function(){return zl(this,function(i){switch(i.label){case 0:if(Sa(t.container.flags,16))debugger;return t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return i.sent(),[4,this.renderNodeContent(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})},e.prototype.renderTextWithLetterSpacing=function(t,i,n){var o=this;if(i===0)this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+n);else{var a=aS(t.text);a.reduce(function(s,g){return o.ctx.fillText(g,s,t.bounds.top+n),s+o.ctx.measureText(g).width},t.bounds.left)}},e.prototype.createFontStyle=function(t){var i=t.fontVariant.filter(function(a){return a==="normal"||a==="small-caps"}).join(""),n=MAe(t.fontFamily).join(", "),o=_0(t.fontSize)?""+t.fontSize.number+t.fontSize.unit:t.fontSize.number+"px";return[[t.fontStyle,i,t.fontWeight,o,n].join(" "),n,o]},e.prototype.renderTextNode=function(t,i){return pc(this,void 0,void 0,function(){var n,o,a,s,g,y,T,I,R=this;return zl(this,function(U){return n=this.createFontStyle(i),o=n[0],a=n[1],s=n[2],this.ctx.font=o,this.ctx.direction=i.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",g=this.fontMetrics.getMetrics(a,s),y=g.baseline,T=g.middle,I=i.paintOrder,t.textBounds.forEach(function(Z){I.forEach(function(Y){switch(Y){case 0:R.ctx.fillStyle=Ka(i.color),R.renderTextWithLetterSpacing(Z,i.letterSpacing,y);var he=i.textShadow;he.length&&Z.text.trim().length&&(he.slice(0).reverse().forEach(function(ce){R.ctx.shadowColor=Ka(ce.color),R.ctx.shadowOffsetX=ce.offsetX.number*R.options.scale,R.ctx.shadowOffsetY=ce.offsetY.number*R.options.scale,R.ctx.shadowBlur=ce.blur.number,R.renderTextWithLetterSpacing(Z,i.letterSpacing,y)}),R.ctx.shadowColor="",R.ctx.shadowOffsetX=0,R.ctx.shadowOffsetY=0,R.ctx.shadowBlur=0),i.textDecorationLine.length&&(R.ctx.fillStyle=Ka(i.textDecorationColor||i.color),i.textDecorationLine.forEach(function(ce){switch(ce){case 1:R.ctx.fillRect(Z.bounds.left,Math.round(Z.bounds.top+y),Z.bounds.width,1);break;case 2:R.ctx.fillRect(Z.bounds.left,Math.round(Z.bounds.top),Z.bounds.width,1);break;case 3:R.ctx.fillRect(Z.bounds.left,Math.ceil(Z.bounds.top+T),Z.bounds.width,1);break}}));break;case 1:i.webkitTextStrokeWidth&&Z.text.trim().length&&(R.ctx.strokeStyle=Ka(i.webkitTextStrokeColor),R.ctx.lineWidth=i.webkitTextStrokeWidth,R.ctx.lineJoin=window.chrome?"miter":"round",R.ctx.strokeText(Z.text,Z.bounds.left,Z.bounds.top+y)),R.ctx.strokeStyle="",R.ctx.lineWidth=0,R.ctx.lineJoin="miter";break}})}),[2]})})},e.prototype.renderReplacedElement=function(t,i,n){if(n&&t.intrinsicWidth>0&&t.intrinsicHeight>0){var o=Sb(t),a=Bb(i);this.path(a),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,t.intrinsicWidth,t.intrinsicHeight,o.left,o.top,o.width,o.height),this.ctx.restore()}},e.prototype.renderNodeContent=function(t){return pc(this,void 0,void 0,function(){var i,n,o,a,s,g,pe,pe,y,T,I,R,Te,U,Z,qe,Y,he,ce,pe,be,Te,qe;return zl(this,function(je){switch(je.label){case 0:this.applyEffects(t.getEffects(4)),i=t.container,n=t.curves,o=i.styles,a=0,s=i.textNodes,je.label=1;case 1:return a<s.length?(g=s[a],[4,this.renderTextNode(g,o)]):[3,4];case 2:je.sent(),je.label=3;case 3:return a++,[3,1];case 4:if(!(i instanceof nO))return[3,8];je.label=5;case 5:return je.trys.push([5,7,,8]),[4,this.context.cache.match(i.src)];case 6:return pe=je.sent(),this.renderReplacedElement(i,n,pe),[3,8];case 7:return je.sent(),this.context.logger.error("Error loading image "+i.src),[3,8];case 8:if(i instanceof sO&&this.renderReplacedElement(i,n,i.canvas),!(i instanceof oO))return[3,12];je.label=9;case 9:return je.trys.push([9,11,,12]),[4,this.context.cache.match(i.svg)];case 10:return pe=je.sent(),this.renderReplacedElement(i,n,pe),[3,12];case 11:return je.sent(),this.context.logger.error("Error loading svg "+i.svg.substring(0,255)),[3,12];case 12:return i instanceof hO&&i.tree?(y=new e(this.context,{scale:this.options.scale,backgroundColor:i.backgroundColor,x:0,y:0,width:i.width,height:i.height}),[4,y.render(i.tree)]):[3,14];case 13:T=je.sent(),i.width&&i.height&&this.ctx.drawImage(T,0,0,i.width,i.height,i.bounds.left,i.bounds.top,i.bounds.width,i.bounds.height),je.label=14;case 14:if(i instanceof cS&&(I=Math.min(i.bounds.width,i.bounds.height),i.type===gb?i.checked&&(this.ctx.save(),this.path([new Yr(i.bounds.left+I*.39363,i.bounds.top+I*.79),new Yr(i.bounds.left+I*.16,i.bounds.top+I*.5549),new Yr(i.bounds.left+I*.27347,i.bounds.top+I*.44071),new Yr(i.bounds.left+I*.39694,i.bounds.top+I*.5649),new Yr(i.bounds.left+I*.72983,i.bounds.top+I*.23),new Yr(i.bounds.left+I*.84,i.bounds.top+I*.34085),new Yr(i.bounds.left+I*.39363,i.bounds.top+I*.79)]),this.ctx.fillStyle=Ka(lO),this.ctx.fill(),this.ctx.restore()):i.type===mb&&i.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(i.bounds.left+I/2,i.bounds.top+I/2,I/4,0,Math.PI*2,!0),this.ctx.fillStyle=Ka(lO),this.ctx.fill(),this.ctx.restore())),SAe(i)&&i.value.length){switch(R=this.createFontStyle(o),Te=R[0],U=R[1],Z=this.fontMetrics.getMetrics(Te,U).baseline,this.ctx.font=Te,this.ctx.fillStyle=Ka(o.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=IAe(i.styles.textAlign),qe=Sb(i),Y=0,i.styles.textAlign){case 1:Y+=qe.width/2;break;case 2:Y+=qe.width;break}he=qe.add(Y,0,0,-qe.height/2+1),this.ctx.save(),this.path([new Yr(qe.left,qe.top),new Yr(qe.left+qe.width,qe.top),new Yr(qe.left+qe.width,qe.top+qe.height),new Yr(qe.left,qe.top+qe.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new B0(i.value,he),o.letterSpacing,Z),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Sa(i.styles.display,2048))return[3,20];if(i.styles.listStyleImage===null)return[3,19];if(ce=i.styles.listStyleImage,ce.type!==0)return[3,18];pe=void 0,be=ce.url,je.label=15;case 15:return je.trys.push([15,17,,18]),[4,this.context.cache.match(be)];case 16:return pe=je.sent(),this.ctx.drawImage(pe,i.bounds.left-(pe.width+10),i.bounds.top),[3,18];case 17:return je.sent(),this.context.logger.error("Error loading list-style-image "+be),[3,18];case 18:return[3,20];case 19:t.listValue&&i.styles.listStyleType!==-1&&(Te=this.createFontStyle(o)[0],this.ctx.font=Te,this.ctx.fillStyle=Ka(o.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",qe=new zA(i.bounds.left,i.bounds.top+Gs(i.styles.paddingTop,i.bounds.width),i.bounds.width,Uk(o.lineHeight,o.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new B0(t.listValue,qe),o.letterSpacing,Uk(o.lineHeight,o.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),je.label=20;case 20:return[2]}})})},e.prototype.renderStackContent=function(t){return pc(this,void 0,void 0,function(){var i,n,ce,o,a,ce,s,g,ce,y,T,ce,I,R,ce,U,Z,ce,Y,he,ce;return zl(this,function(pe){switch(pe.label){case 0:if(Sa(t.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(t.element)];case 1:pe.sent(),i=0,n=t.negativeZIndex,pe.label=2;case 2:return i<n.length?(ce=n[i],[4,this.renderStack(ce)]):[3,5];case 3:pe.sent(),pe.label=4;case 4:return i++,[3,2];case 5:return[4,this.renderNodeContent(t.element)];case 6:pe.sent(),o=0,a=t.nonInlineLevel,pe.label=7;case 7:return o<a.length?(ce=a[o],[4,this.renderNode(ce)]):[3,10];case 8:pe.sent(),pe.label=9;case 9:return o++,[3,7];case 10:s=0,g=t.nonPositionedFloats,pe.label=11;case 11:return s<g.length?(ce=g[s],[4,this.renderStack(ce)]):[3,14];case 12:pe.sent(),pe.label=13;case 13:return s++,[3,11];case 14:y=0,T=t.nonPositionedInlineLevel,pe.label=15;case 15:return y<T.length?(ce=T[y],[4,this.renderStack(ce)]):[3,18];case 16:pe.sent(),pe.label=17;case 17:return y++,[3,15];case 18:I=0,R=t.inlineLevel,pe.label=19;case 19:return I<R.length?(ce=R[I],[4,this.renderNode(ce)]):[3,22];case 20:pe.sent(),pe.label=21;case 21:return I++,[3,19];case 22:U=0,Z=t.zeroOrAutoZIndexOrTransformedOrOpacity,pe.label=23;case 23:return U<Z.length?(ce=Z[U],[4,this.renderStack(ce)]):[3,26];case 24:pe.sent(),pe.label=25;case 25:return U++,[3,23];case 26:Y=0,he=t.positiveZIndex,pe.label=27;case 27:return Y<he.length?(ce=he[Y],[4,this.renderStack(ce)]):[3,30];case 28:pe.sent(),pe.label=29;case 29:return Y++,[3,27];case 30:return[2]}})})},e.prototype.mask=function(t){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(t.slice(0).reverse()),this.ctx.closePath()},e.prototype.path=function(t){this.ctx.beginPath(),this.formatPath(t),this.ctx.closePath()},e.prototype.formatPath=function(t){var i=this;t.forEach(function(n,o){var a=Uu(n)?n.start:n;o===0?i.ctx.moveTo(a.x,a.y):i.ctx.lineTo(a.x,a.y),Uu(n)&&i.ctx.bezierCurveTo(n.startControl.x,n.startControl.y,n.endControl.x,n.endControl.y,n.end.x,n.end.y)})},e.prototype.renderRepeat=function(t,i,n,o){this.path(t),this.ctx.fillStyle=i,this.ctx.translate(n,o),this.ctx.fill(),this.ctx.translate(-n,-o)},e.prototype.resizeImage=function(t,i,n){var o;if(t.width===i&&t.height===n)return t;var a=(o=this.canvas.ownerDocument)!==null&&o!==void 0?o:document,s=a.createElement("canvas");s.width=Math.max(1,i),s.height=Math.max(1,n);var g=s.getContext("2d");return g.drawImage(t,0,0,t.width,t.height,0,0,i,n),s},e.prototype.renderBackgroundImage=function(t){return pc(this,void 0,void 0,function(){var i,n,o,a,s,g;return zl(this,function(y){switch(y.label){case 0:i=t.styles.backgroundImage.length-1,n=function(T){var I,R,U,nt,Et,Pt,Ye,Xe,Ne,Z,nt,Et,Pt,Ye,Xe,Y,he,ce,pe,be,Te,qe,je,We,Ne,at,nt,ke,De,Ye,Xe,Ct,Et,Pt,bt,Rt,Ft,Zt,Le,Ze,rt,pt;return zl(this,function(mt){switch(mt.label){case 0:if(T.type!==0)return[3,5];I=void 0,R=T.url,mt.label=1;case 1:return mt.trys.push([1,3,,4]),[4,o.context.cache.match(R)];case 2:return I=mt.sent(),[3,4];case 3:return mt.sent(),o.context.logger.error("Error loading background-image "+R),[3,4];case 4:return I&&(U=vS(t,i,[I.width,I.height,I.width/I.height]),nt=U[0],Et=U[1],Pt=U[2],Ye=U[3],Xe=U[4],Ne=o.ctx.createPattern(o.resizeImage(I,Ye,Xe),"repeat"),o.renderRepeat(nt,Ne,Et,Pt)),[3,6];case 5:Ace(T)?(Z=vS(t,i,[null,null,null]),nt=Z[0],Et=Z[1],Pt=Z[2],Ye=Z[3],Xe=Z[4],Y=ace(T.angle,Ye,Xe),he=Y[0],ce=Y[1],pe=Y[2],be=Y[3],Te=Y[4],qe=document.createElement("canvas"),qe.width=Ye,qe.height=Xe,je=qe.getContext("2d"),We=je.createLinearGradient(ce,be,pe,Te),Sk(T.stops,he).forEach(function(Bt){return We.addColorStop(Bt.stop,Ka(Bt.color))}),je.fillStyle=We,je.fillRect(0,0,Ye,Xe),Ye>0&&Xe>0&&(Ne=o.ctx.createPattern(qe,"repeat"),o.renderRepeat(nt,Ne,Et,Pt))):dce(T)&&(at=vS(t,i,[null,null,null]),nt=at[0],ke=at[1],De=at[2],Ye=at[3],Xe=at[4],Ct=T.position.length===0?[$E]:T.position,Et=Gs(Ct[0],Ye),Pt=Gs(Ct[Ct.length-1],Xe),bt=lce(T,Et,Pt,Ye,Xe),Rt=bt[0],Ft=bt[1],Rt>0&&Ft>0&&(Zt=o.ctx.createRadialGradient(ke+Et,De+Pt,0,ke+Et,De+Pt,Rt),Sk(T.stops,Rt*2).forEach(function(Bt){return Zt.addColorStop(Bt.stop,Ka(Bt.color))}),o.path(nt),o.ctx.fillStyle=Zt,Rt!==Ft?(Le=t.bounds.left+.5*t.bounds.width,Ze=t.bounds.top+.5*t.bounds.height,rt=Ft/Rt,pt=1/rt,o.ctx.save(),o.ctx.translate(Le,Ze),o.ctx.transform(1,0,0,rt,0,0),o.ctx.translate(-Le,-Ze),o.ctx.fillRect(ke,pt*(De-Ze)+Ze,Ye,Xe*pt),o.ctx.restore()):o.ctx.fill())),mt.label=6;case 6:return i--,[2]}})},o=this,a=0,s=t.styles.backgroundImage.slice(0).reverse(),y.label=1;case 1:return a<s.length?(g=s[a],[5,n(g)]):[3,4];case 2:y.sent(),y.label=3;case 3:return a++,[3,1];case 4:return[2]}})})},e.prototype.renderSolidBorder=function(t,i,n){return pc(this,void 0,void 0,function(){return zl(this,function(o){return this.path(OO(n,i)),this.ctx.fillStyle=Ka(t),this.ctx.fill(),[2]})})},e.prototype.renderDoubleBorder=function(t,i,n,o){return pc(this,void 0,void 0,function(){var a,s;return zl(this,function(g){switch(g.label){case 0:return i<3?[4,this.renderSolidBorder(t,n,o)]:[3,2];case 1:return g.sent(),[2];case 2:return a=gAe(o,n),this.path(a),this.ctx.fillStyle=Ka(t),this.ctx.fill(),s=mAe(o,n),this.path(s),this.ctx.fill(),[2]}})})},e.prototype.renderNodeBackgroundAndBorders=function(t){return pc(this,void 0,void 0,function(){var i,n,o,a,s,g,y,T,I=this;return zl(this,function(R){switch(R.label){case 0:return this.applyEffects(t.getEffects(2)),i=t.container.styles,n=!Rd(i.backgroundColor)||i.backgroundImage.length,o=[{style:i.borderTopStyle,color:i.borderTopColor,width:i.borderTopWidth},{style:i.borderRightStyle,color:i.borderRightColor,width:i.borderRightWidth},{style:i.borderBottomStyle,color:i.borderBottomColor,width:i.borderBottomWidth},{style:i.borderLeftStyle,color:i.borderLeftColor,width:i.borderLeftWidth}],a=TAe(nm(i.backgroundClip,0),t.curves),n||i.boxShadow.length?(this.ctx.save(),this.path(a),this.ctx.clip(),Rd(i.backgroundColor)||(this.ctx.fillStyle=Ka(i.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(t.container)]):[3,2];case 1:R.sent(),this.ctx.restore(),i.boxShadow.slice(0).reverse().forEach(function(U){I.ctx.save();var Z=wb(t.curves),Y=U.inset?0:CAe,he=fAe(Z,-Y+(U.inset?1:-1)*U.spread.number,(U.inset?1:-1)*U.spread.number,U.spread.number*(U.inset?-2:2),U.spread.number*(U.inset?-2:2));U.inset?(I.path(Z),I.ctx.clip(),I.mask(he)):(I.mask(Z),I.ctx.clip(),I.path(he)),I.ctx.shadowOffsetX=U.offsetX.number+Y,I.ctx.shadowOffsetY=U.offsetY.number,I.ctx.shadowColor=Ka(U.color),I.ctx.shadowBlur=U.blur.number,I.ctx.fillStyle=U.inset?Ka(U.color):"rgba(0,0,0,1)",I.ctx.fill(),I.ctx.restore()}),R.label=2;case 2:s=0,g=0,y=o,R.label=3;case 3:return g<y.length?(T=y[g],T.style!==0&&!Rd(T.color)&&T.width>0?T.style!==2?[3,5]:[4,this.renderDashedDottedBorder(T.color,T.width,s,t.curves,2)]:[3,11]):[3,13];case 4:return R.sent(),[3,11];case 5:return T.style!==3?[3,7]:[4,this.renderDashedDottedBorder(T.color,T.width,s,t.curves,3)];case 6:return R.sent(),[3,11];case 7:return T.style!==4?[3,9]:[4,this.renderDoubleBorder(T.color,T.width,s,t.curves)];case 8:return R.sent(),[3,11];case 9:return[4,this.renderSolidBorder(T.color,s,t.curves)];case 10:R.sent(),R.label=11;case 11:s++,R.label=12;case 12:return g++,[3,3];case 13:return[2]}})})},e.prototype.renderDashedDottedBorder=function(t,i,n,o,a){return pc(this,void 0,void 0,function(){var s,g,y,T,I,R,U,Z,Y,he,ce,pe,be,Te,qe,je,qe,je;return zl(this,function(We){return this.ctx.save(),s=yAe(o,n),g=OO(o,n),a===2&&(this.path(g),this.ctx.clip()),Uu(g[0])?(y=g[0].start.x,T=g[0].start.y):(y=g[0].x,T=g[0].y),Uu(g[1])?(I=g[1].end.x,R=g[1].end.y):(I=g[1].x,R=g[1].y),n===0||n===2?U=Math.abs(y-I):U=Math.abs(T-R),this.ctx.beginPath(),a===3?this.formatPath(s):this.formatPath(g.slice(0,2)),Z=i<3?i*3:i*2,Y=i<3?i*2:i,a===3&&(Z=i,Y=i),he=!0,U<=Z*2?he=!1:U<=Z*2+Y?(ce=U/(2*Z+Y),Z*=ce,Y*=ce):(pe=Math.floor((U+Y)/(Z+Y)),be=(U-pe*Z)/(pe-1),Te=(U-(pe+1)*Z)/pe,Y=Te<=0||Math.abs(Y-be)<Math.abs(Y-Te)?be:Te),he&&(a===3?this.ctx.setLineDash([0,Z+Y]):this.ctx.setLineDash([Z,Y])),a===3?(this.ctx.lineCap="round",this.ctx.lineWidth=i):this.ctx.lineWidth=i*2+1.1,this.ctx.strokeStyle=Ka(t),this.ctx.stroke(),this.ctx.setLineDash([]),a===2&&(Uu(g[0])&&(qe=g[3],je=g[0],this.ctx.beginPath(),this.formatPath([new Yr(qe.end.x,qe.end.y),new Yr(je.start.x,je.start.y)]),this.ctx.stroke()),Uu(g[1])&&(qe=g[1],je=g[2],this.ctx.beginPath(),this.formatPath([new Yr(qe.end.x,qe.end.y),new Yr(je.start.x,je.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},e.prototype.render=function(t){return pc(this,void 0,void 0,function(){var i;return zl(this,function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=Ka(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),i=pAe(t),[4,this.renderStack(i)];case 1:return n.sent(),this.applyEffects([]),[2,this.canvas]}})})},e}(zO),SAe=function(r){return r instanceof uO||r instanceof cO?!0:r instanceof cS&&r.type!==mb&&r.type!==gb},TAe=function(r,e){switch(r){case 0:return wb(e);case 2:return cAe(e);case 1:default:return Bb(e)}},IAe=function(r){switch(r){case 1:return"center";case 2:return"right";case 0:default:return"left"}},LAe=["-apple-system","system-ui"],MAe=function(r){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?r.filter(function(e){return LAe.indexOf(e)===-1}):r},PAe=function(r){mh(e,r);function e(t,i){var n=r.call(this,t,i)||this;return n.canvas=i.canvas?i.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),n.options=i,n.canvas.width=Math.floor(i.width*i.scale),n.canvas.height=Math.floor(i.height*i.scale),n.canvas.style.width=i.width+"px",n.canvas.style.height=i.height+"px",n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-i.x,-i.y),n.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+i.width+"x"+i.height+" at "+i.x+","+i.y+") with scale "+i.scale),n}return e.prototype.render=function(t){return pc(this,void 0,void 0,function(){var i,n;return zl(this,function(o){switch(o.label){case 0:return i=oS(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,FAe(i)];case 1:return n=o.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=Ka(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e}(zO),FAe=function(r){return new Promise(function(e,t){var i=new Image;i.onload=function(){e(i)},i.onerror=t,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(r))})},DAe=function(){function r(e){var t=e.id,i=e.enabled;this.id=t,this.enabled=i,this.start=Date.now()}return r.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,kv([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.prototype.getTime=function(){return Date.now()-this.start},r.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,kv([this.id,this.getTime()+"ms"],e))},r.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,kv([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,kv([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},r.instances={},r}(),RAe=function(){function r(e,t){var i;this.windowBounds=t,this.instanceName="#"+r.instanceCount++,this.logger=new DAe({id:this.instanceName,enabled:e.logging}),this.cache=(i=e.cache)!==null&&i!==void 0?i:new tAe(this,e)}return r.instanceCount=1,r}(),kAe=function(r,e){return e===void 0&&(e={}),OAe(r,e)};typeof window<"u"&&MO.setContext(window);var OAe=function(r,e){return pc(void 0,void 0,void 0,function(){var t,i,n,o,a,s,g,y,T,I,R,U,Z,Y,he,ce,pe,be,Te,qe,We,je,We,Ne,at,nt,ke,De,Ye,Xe,Ct,Et,Pt,bt,Rt,Ft,Zt,Le,Ze,rt;return zl(this,function(pt){switch(pt.label){case 0:if(!r||typeof r!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(t=r.ownerDocument,!t)throw new Error("Element is not attached to a Document");if(i=t.defaultView,!i)throw new Error("Document is not attached to a Window");return n={allowTaint:(Ne=e.allowTaint)!==null&&Ne!==void 0?Ne:!1,imageTimeout:(at=e.imageTimeout)!==null&&at!==void 0?at:15e3,proxy:e.proxy,useCORS:(nt=e.useCORS)!==null&&nt!==void 0?nt:!1},o=EE({logging:(ke=e.logging)!==null&&ke!==void 0?ke:!0,cache:e.cache},n),a={windowWidth:(De=e.windowWidth)!==null&&De!==void 0?De:i.innerWidth,windowHeight:(Ye=e.windowHeight)!==null&&Ye!==void 0?Ye:i.innerHeight,scrollX:(Xe=e.scrollX)!==null&&Xe!==void 0?Xe:i.pageXOffset,scrollY:(Ct=e.scrollY)!==null&&Ct!==void 0?Ct:i.pageYOffset},s=new zA(a.scrollX,a.scrollY,a.windowWidth,a.windowHeight),g=new RAe(o,s),y=(Et=e.foreignObjectRendering)!==null&&Et!==void 0?Et:!1,T={allowTaint:(Pt=e.allowTaint)!==null&&Pt!==void 0?Pt:!1,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:y,copyStyles:y},g.logger.debug("Starting document clone with size "+s.width+"x"+s.height+" scrolled to "+-s.left+","+-s.top),I=new IO(g,r,T),R=I.clonedReferenceElement,R?[4,I.toIFrame(t,s)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return U=pt.sent(),Z=hS(R)||Uhe(R)?fae(R.ownerDocument):Ov(g,R),Y=Z.width,he=Z.height,ce=Z.left,pe=Z.top,be=UAe(g,R,e.backgroundColor),Te={canvas:e.canvas,backgroundColor:be,scale:(Rt=(bt=e.scale)!==null&&bt!==void 0?bt:i.devicePixelRatio)!==null&&Rt!==void 0?Rt:1,x:((Ft=e.x)!==null&&Ft!==void 0?Ft:0)+ce,y:((Zt=e.y)!==null&&Zt!==void 0?Zt:0)+pe,width:(Le=e.width)!==null&&Le!==void 0?Le:Math.ceil(Y),height:(Ze=e.height)!==null&&Ze!==void 0?Ze:Math.ceil(he)},y?(g.logger.debug("Document cloned, using foreign object rendering"),We=new PAe(g,Te),[4,We.render(R)]):[3,3];case 2:return qe=pt.sent(),[3,5];case 3:return g.logger.debug("Document cloned, element located at "+ce+","+pe+" with size "+Y+"x"+he+" using computed rendering"),g.logger.debug("Starting DOM parsing"),je=dO(g,R),be===je.styles.backgroundColor&&(je.styles.backgroundColor=VA.TRANSPARENT),g.logger.debug("Starting renderer for element at "+Te.x+","+Te.y+" with size "+Te.width+"x"+Te.height),We=new EAe(g,Te),[4,We.render(je)];case 4:qe=pt.sent(),pt.label=5;case 5:return(!((rt=e.removeContainer)!==null&&rt!==void 0)||rt)&&(IO.destroy(U)||g.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),g.logger.debug("Finished rendering"),[2,qe]}})})},UAe=function(r,e,t){var i=e.ownerDocument,n=i.documentElement?b0(r,getComputedStyle(i.documentElement).backgroundColor):VA.TRANSPARENT,o=i.body?b0(r,getComputedStyle(i.body).backgroundColor):VA.TRANSPARENT,a=typeof t=="string"?b0(r,t):t===null?VA.TRANSPARENT:4294967295;return e===i.documentElement?Rd(n)?Rd(o)?a:o:n:a};const NAe=Object.freeze(Object.defineProperty({__proto__:null,default:kAe},Symbol.toStringTag,{value:"Module"}));/*! @license DOMPurify 2.4.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/2.4.5/LICENSE */function Nd(r){"@babel/helpers - typeof";return Nd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nd(r)}function bS(r,e){return bS=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t},bS(r,e)}function zAe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ib(r,e,t){return zAe()?Ib=Reflect.construct:Ib=function(i,n,o){var a=[null];a.push.apply(a,n);var s=Function.bind.apply(i,a),g=new s;return o&&bS(g,o.prototype),g},Ib.apply(null,arguments)}function _h(r){return QAe(r)||VAe(r)||HAe(r)||GAe()}function QAe(r){if(Array.isArray(r))return xS(r)}function VAe(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function HAe(r,e){if(r){if(typeof r=="string")return xS(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return xS(r,e)}}function xS(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=r[t];return i}function GAe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var jAe=Object.hasOwnProperty,QO=Object.setPrototypeOf,qAe=Object.isFrozen,$Ae=Object.getPrototypeOf,KAe=Object.getOwnPropertyDescriptor,yc=Object.freeze,vh=Object.seal,WAe=Object.create,VO=typeof Reflect<"u"&&Reflect,Lb=VO.apply,wS=VO.construct;Lb||(Lb=function(r,e,t){return r.apply(e,t)}),yc||(yc=function(r){return r}),vh||(vh=function(r){return r}),wS||(wS=function(r,e){return Ib(r,_h(e))});var XAe=zu(Array.prototype.forEach),HO=zu(Array.prototype.pop),T0=zu(Array.prototype.push),Mb=zu(String.prototype.toLowerCase),BS=zu(String.prototype.toString),ZAe=zu(String.prototype.match),bh=zu(String.prototype.replace),JAe=zu(String.prototype.indexOf),YAe=zu(String.prototype.trim),_c=zu(RegExp.prototype.test),CS=ede(TypeError);function zu(r){return function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return Lb(r,e,i)}}function ede(r){return function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return wS(r,t)}}function cn(r,e,t){t=t||Mb,QO&&QO(r,null);for(var i=e.length;i--;){var n=e[i];if(typeof n=="string"){var o=t(n);o!==n&&(qAe(e)||(e[i]=o),n=o)}r[n]=!0}return r}function Kf(r){var e=WAe(null),t;for(t in r)Lb(jAe,r,[t])===!0&&(e[t]=r[t]);return e}function Pb(r,e){for(;r!==null;){var t=KAe(r,e);if(t){if(t.get)return zu(t.get);if(typeof t.value=="function")return zu(t.value)}r=$Ae(r)}function i(n){return console.warn("fallback value for",n),null}return i}var GO=yc(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),ES=yc(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),SS=yc(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),tde=yc(["animate","color-profile","cursor","discard","fedropshadow","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),TS=yc(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover"]),rde=yc(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),jO=yc(["#text"]),qO=yc(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),IS=yc(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),$O=yc(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Fb=yc(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),ide=vh(/\{\{[\w\W]*|[\w\W]*\}\}/gm),nde=vh(/<%[\w\W]*|[\w\W]*%>/gm),sde=vh(/\${[\w\W]*}/gm),ode=vh(/^data-[\-\w.\u00B7-\uFFFF]/),ade=vh(/^aria-[\-\w]+$/),lde=vh(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),cde=vh(/^(?:\w+script|data):/i),ude=vh(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),hde=vh(/^html$/i),Ade=function(){return typeof window>"u"?null:window},dde=function(r,e){if(Nd(r)!=="object"||typeof r.createPolicy!="function")return null;var t=null,i="data-tt-policy-suffix";e.currentScript&&e.currentScript.hasAttribute(i)&&(t=e.currentScript.getAttribute(i));var n="dompurify"+(t?"#"+t:"");try{return r.createPolicy(n,{createHTML:function(o){return o},createScriptURL:function(o){return o}})}catch{return console.warn("TrustedTypes policy "+n+" could not be created."),null}};function KO(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ade(),e=function(ot){return KO(ot)};if(e.version="2.4.5",e.removed=[],!r||!r.document||r.document.nodeType!==9)return e.isSupported=!1,e;var t=r.document,i=r.document,n=r.DocumentFragment,o=r.HTMLTemplateElement,a=r.Node,s=r.Element,g=r.NodeFilter,y=r.NamedNodeMap,T=y===void 0?r.NamedNodeMap||r.MozNamedAttrMap:y,I=r.HTMLFormElement,R=r.DOMParser,U=r.trustedTypes,Z=s.prototype,Y=Pb(Z,"cloneNode"),he=Pb(Z,"nextSibling"),ce=Pb(Z,"childNodes"),pe=Pb(Z,"parentNode");if(typeof o=="function"){var be=i.createElement("template");be.content&&be.content.ownerDocument&&(i=be.content.ownerDocument)}var Te=dde(U,t),qe=Te?Te.createHTML(""):"",je=i,We=je.implementation,Ne=je.createNodeIterator,at=je.createDocumentFragment,nt=je.getElementsByTagName,ke=t.importNode,De={};try{De=Kf(i).documentMode?i.documentMode:{}}catch{}var Ye={};e.isSupported=typeof pe=="function"&&We&&typeof We.createHTMLDocument<"u"&&De!==9;var Xe=ide,Ct=nde,Et=sde,Pt=ode,bt=ade,Rt=cde,Ft=ude,Zt=lde,Le=null,Ze=cn({},[].concat(_h(GO),_h(ES),_h(SS),_h(TS),_h(jO))),rt=null,pt=cn({},[].concat(_h(qO),_h(IS),_h($O),_h(Fb))),mt=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Bt=null,Dt=null,Mt=!0,qt=!0,nr=!1,vr=!0,br=!1,Fr=!1,kt=!1,lt=!1,wt=!1,Ur=!1,tr=!1,ht=!0,$t=!1,or="user-content-",mr=!0,ur=!1,Wr={},ri=null,gi=cn({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),Pi=null,zt=cn({},["audio","video","img","source","image","track"]),Xr=null,Ar=cn({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Wt="http://www.w3.org/1998/Math/MathML",di="http://www.w3.org/2000/svg",Qt="http://www.w3.org/1999/xhtml",Tr=Qt,Lr=!1,Xt=null,xr=cn({},[Wt,di,Qt],BS),er,vi=["application/xhtml+xml","text/html"],Zi="text/html",Qe,Be=null,ue=i.createElement("form"),re=function(ot){return ot instanceof RegExp||ot instanceof Function},Ae=function(ot){Be&&Be===ot||((!ot||Nd(ot)!=="object")&&(ot={}),ot=Kf(ot),er=vi.indexOf(ot.PARSER_MEDIA_TYPE)===-1?er=Zi:er=ot.PARSER_MEDIA_TYPE,Qe=er==="application/xhtml+xml"?BS:Mb,Le="ALLOWED_TAGS"in ot?cn({},ot.ALLOWED_TAGS,Qe):Ze,rt="ALLOWED_ATTR"in ot?cn({},ot.ALLOWED_ATTR,Qe):pt,Xt="ALLOWED_NAMESPACES"in ot?cn({},ot.ALLOWED_NAMESPACES,BS):xr,Xr="ADD_URI_SAFE_ATTR"in ot?cn(Kf(Ar),ot.ADD_URI_SAFE_ATTR,Qe):Ar,Pi="ADD_DATA_URI_TAGS"in ot?cn(Kf(zt),ot.ADD_DATA_URI_TAGS,Qe):zt,ri="FORBID_CONTENTS"in ot?cn({},ot.FORBID_CONTENTS,Qe):gi,Bt="FORBID_TAGS"in ot?cn({},ot.FORBID_TAGS,Qe):{},Dt="FORBID_ATTR"in ot?cn({},ot.FORBID_ATTR,Qe):{},Wr="USE_PROFILES"in ot?ot.USE_PROFILES:!1,Mt=ot.ALLOW_ARIA_ATTR!==!1,qt=ot.ALLOW_DATA_ATTR!==!1,nr=ot.ALLOW_UNKNOWN_PROTOCOLS||!1,vr=ot.ALLOW_SELF_CLOSE_IN_ATTR!==!1,br=ot.SAFE_FOR_TEMPLATES||!1,Fr=ot.WHOLE_DOCUMENT||!1,wt=ot.RETURN_DOM||!1,Ur=ot.RETURN_DOM_FRAGMENT||!1,tr=ot.RETURN_TRUSTED_TYPE||!1,lt=ot.FORCE_BODY||!1,ht=ot.SANITIZE_DOM!==!1,$t=ot.SANITIZE_NAMED_PROPS||!1,mr=ot.KEEP_CONTENT!==!1,ur=ot.IN_PLACE||!1,Zt=ot.ALLOWED_URI_REGEXP||Zt,Tr=ot.NAMESPACE||Qt,mt=ot.CUSTOM_ELEMENT_HANDLING||{},ot.CUSTOM_ELEMENT_HANDLING&&re(ot.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(mt.tagNameCheck=ot.CUSTOM_ELEMENT_HANDLING.tagNameCheck),ot.CUSTOM_ELEMENT_HANDLING&&re(ot.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(mt.attributeNameCheck=ot.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),ot.CUSTOM_ELEMENT_HANDLING&&typeof ot.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(mt.allowCustomizedBuiltInElements=ot.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),br&&(qt=!1),Ur&&(wt=!0),Wr&&(Le=cn({},_h(jO)),rt=[],Wr.html===!0&&(cn(Le,GO),cn(rt,qO)),Wr.svg===!0&&(cn(Le,ES),cn(rt,IS),cn(rt,Fb)),Wr.svgFilters===!0&&(cn(Le,SS),cn(rt,IS),cn(rt,Fb)),Wr.mathMl===!0&&(cn(Le,TS),cn(rt,$O),cn(rt,Fb))),ot.ADD_TAGS&&(Le===Ze&&(Le=Kf(Le)),cn(Le,ot.ADD_TAGS,Qe)),ot.ADD_ATTR&&(rt===pt&&(rt=Kf(rt)),cn(rt,ot.ADD_ATTR,Qe)),ot.ADD_URI_SAFE_ATTR&&cn(Xr,ot.ADD_URI_SAFE_ATTR,Qe),ot.FORBID_CONTENTS&&(ri===gi&&(ri=Kf(ri)),cn(ri,ot.FORBID_CONTENTS,Qe)),mr&&(Le["#text"]=!0),Fr&&cn(Le,["html","head","body"]),Le.table&&(cn(Le,["tbody"]),delete Bt.tbody),yc&&yc(ot),Be=ot)},ge=cn({},["mi","mo","mn","ms","mtext"]),xe=cn({},["foreignobject","desc","title","annotation-xml"]),Ee=cn({},["title","style","font","a","script"]),we=cn({},ES);cn(we,SS),cn(we,tde);var Fe=cn({},TS);cn(Fe,rde);var ze=function(ot){var ir=pe(ot);(!ir||!ir.tagName)&&(ir={namespaceURI:Tr,tagName:"template"});var Vt=Mb(ot.tagName),Hr=Mb(ir.tagName);return Xt[ot.namespaceURI]?ot.namespaceURI===di?ir.namespaceURI===Qt?Vt==="svg":ir.namespaceURI===Wt?Vt==="svg"&&(Hr==="annotation-xml"||ge[Hr]):!!we[Vt]:ot.namespaceURI===Wt?ir.namespaceURI===Qt?Vt==="math":ir.namespaceURI===di?Vt==="math"&&xe[Hr]:!!Fe[Vt]:ot.namespaceURI===Qt?ir.namespaceURI===di&&!xe[Hr]||ir.namespaceURI===Wt&&!ge[Hr]?!1:!Fe[Vt]&&(Ee[Vt]||!we[Vt]):!!(er==="application/xhtml+xml"&&Xt[ot.namespaceURI]):!1},Ge=function(ot){T0(e.removed,{element:ot});try{ot.parentNode.removeChild(ot)}catch{try{ot.outerHTML=qe}catch{ot.remove()}}},st=function(ot,ir){try{T0(e.removed,{attribute:ir.getAttributeNode(ot),from:ir})}catch{T0(e.removed,{attribute:null,from:ir})}if(ir.removeAttribute(ot),ot==="is"&&!rt[ot])if(wt||Ur)try{Ge(ir)}catch{}else try{ir.setAttribute(ot,"")}catch{}},vt=function(ot){var ir,Vt;if(lt)ot="<remove></remove>"+ot;else{var Hr=ZAe(ot,/^[\r\n\t ]+/);Vt=Hr&&Hr[0]}er==="application/xhtml+xml"&&Tr===Qt&&(ot='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+ot+"</body></html>");var ci=Te?Te.createHTML(ot):ot;if(Tr===Qt)try{ir=new R().parseFromString(ci,er)}catch{}if(!ir||!ir.documentElement){ir=We.createDocument(Tr,"template",null);try{ir.documentElement.innerHTML=Lr?qe:ci}catch{}}var un=ir.body||ir.documentElement;return ot&&Vt&&un.insertBefore(i.createTextNode(Vt),un.childNodes[0]||null),Tr===Qt?nt.call(ir,Fr?"html":"body")[0]:Fr?ir.documentElement:un},Tt=function(ot){return Ne.call(ot.ownerDocument||ot,ot,g.SHOW_ELEMENT|g.SHOW_COMMENT|g.SHOW_TEXT,null,!1)},Kt=function(ot){return ot instanceof I&&(typeof ot.nodeName!="string"||typeof ot.textContent!="string"||typeof ot.removeChild!="function"||!(ot.attributes instanceof T)||typeof ot.removeAttribute!="function"||typeof ot.setAttribute!="function"||typeof ot.namespaceURI!="string"||typeof ot.insertBefore!="function"||typeof ot.hasChildNodes!="function")},rr=function(ot){return Nd(a)==="object"?ot instanceof a:ot&&Nd(ot)==="object"&&typeof ot.nodeType=="number"&&typeof ot.nodeName=="string"},Gt=function(ot,ir,Vt){Ye[ot]&&XAe(Ye[ot],function(Hr){Hr.call(e,ir,Vt,Be)})},dr=function(ot){var ir;if(Gt("beforeSanitizeElements",ot,null),Kt(ot)||_c(/[\u0080-\uFFFF]/,ot.nodeName))return Ge(ot),!0;var Vt=Qe(ot.nodeName);if(Gt("uponSanitizeElement",ot,{tagName:Vt,allowedTags:Le}),ot.hasChildNodes()&&!rr(ot.firstElementChild)&&(!rr(ot.content)||!rr(ot.content.firstElementChild))&&_c(/<[/\w]/g,ot.innerHTML)&&_c(/<[/\w]/g,ot.textContent)||Vt==="select"&&_c(/<template/i,ot.innerHTML))return Ge(ot),!0;if(!Le[Vt]||Bt[Vt]){if(!Bt[Vt]&&Gr(Vt)&&(mt.tagNameCheck instanceof RegExp&&_c(mt.tagNameCheck,Vt)||mt.tagNameCheck instanceof Function&&mt.tagNameCheck(Vt)))return!1;if(mr&&!ri[Vt]){var Hr=pe(ot)||ot.parentNode,ci=ce(ot)||ot.childNodes;if(ci&&Hr)for(var un=ci.length,wn=un-1;wn>=0;--wn)Hr.insertBefore(Y(ci[wn],!0),he(ot))}return Ge(ot),!0}return ot instanceof s&&!ze(ot)||(Vt==="noscript"||Vt==="noembed")&&_c(/<\/no(script|embed)/i,ot.innerHTML)?(Ge(ot),!0):(br&&ot.nodeType===3&&(ir=ot.textContent,ir=bh(ir,Xe," "),ir=bh(ir,Ct," "),ir=bh(ir,Et," "),ot.textContent!==ir&&(T0(e.removed,{element:ot.cloneNode()}),ot.textContent=ir)),Gt("afterSanitizeElements",ot,null),!1)},Cr=function(ot,ir,Vt){if(ht&&(ir==="id"||ir==="name")&&(Vt in i||Vt in ue))return!1;if(!(qt&&!Dt[ir]&&_c(Pt,ir))&&!(Mt&&_c(bt,ir))){if(!rt[ir]||Dt[ir]){if(!(Gr(ot)&&(mt.tagNameCheck instanceof RegExp&&_c(mt.tagNameCheck,ot)||mt.tagNameCheck instanceof Function&&mt.tagNameCheck(ot))&&(mt.attributeNameCheck instanceof RegExp&&_c(mt.attributeNameCheck,ir)||mt.attributeNameCheck instanceof Function&&mt.attributeNameCheck(ir))||ir==="is"&&mt.allowCustomizedBuiltInElements&&(mt.tagNameCheck instanceof RegExp&&_c(mt.tagNameCheck,Vt)||mt.tagNameCheck instanceof Function&&mt.tagNameCheck(Vt))))return!1}else if(!Xr[ir]&&!_c(Zt,bh(Vt,Ft,""))&&!((ir==="src"||ir==="xlink:href"||ir==="href")&&ot!=="script"&&JAe(Vt,"data:")===0&&Pi[ot])&&!(nr&&!_c(Rt,bh(Vt,Ft,"")))&&Vt)return!1}return!0},Gr=function(ot){return ot.indexOf("-")>0},Er=function(ot){var ir,Vt,Hr,ci;Gt("beforeSanitizeAttributes",ot,null);var un=ot.attributes;if(un){var wn={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:rt};for(ci=un.length;ci--;){ir=un[ci];var mi=ir,mn=mi.name,yn=mi.namespaceURI;if(Vt=mn==="value"?ir.value:YAe(ir.value),Hr=Qe(mn),wn.attrName=Hr,wn.attrValue=Vt,wn.keepAttr=!0,wn.forceKeepAttr=void 0,Gt("uponSanitizeAttribute",ot,wn),Vt=wn.attrValue,!wn.forceKeepAttr&&(st(mn,ot),!!wn.keepAttr)){if(!vr&&_c(/\/>/i,Vt)){st(mn,ot);continue}br&&(Vt=bh(Vt,Xe," "),Vt=bh(Vt,Ct," "),Vt=bh(Vt,Et," "));var fi=Qe(ot.nodeName);if(Cr(fi,Hr,Vt)){if($t&&(Hr==="id"||Hr==="name")&&(st(mn,ot),Vt=or+Vt),Te&&Nd(U)==="object"&&typeof U.getAttributeType=="function"&&!yn)switch(U.getAttributeType(fi,Hr)){case"TrustedHTML":Vt=Te.createHTML(Vt);break;case"TrustedScriptURL":Vt=Te.createScriptURL(Vt);break}try{yn?ot.setAttributeNS(yn,mn,Vt):ot.setAttribute(mn,Vt),HO(e.removed)}catch{}}}}Gt("afterSanitizeAttributes",ot,null)}},zr=function ot(ir){var Vt,Hr=Tt(ir);for(Gt("beforeSanitizeShadowDOM",ir,null);Vt=Hr.nextNode();)Gt("uponSanitizeShadowNode",Vt,null),!dr(Vt)&&(Vt.content instanceof n&&ot(Vt.content),Er(Vt));Gt("afterSanitizeShadowDOM",ir,null)};return e.sanitize=function(ot){var ir=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Vt,Hr,ci,un,wn;if(Lr=!ot,Lr&&(ot="<!-->"),typeof ot!="string"&&!rr(ot)){if(typeof ot.toString!="function")throw CS("toString is not a function");if(ot=ot.toString(),typeof ot!="string")throw CS("dirty is not a string, aborting")}if(!e.isSupported){if(Nd(r.toStaticHTML)==="object"||typeof r.toStaticHTML=="function"){if(typeof ot=="string")return r.toStaticHTML(ot);if(rr(ot))return r.toStaticHTML(ot.outerHTML)}return ot}if(kt||Ae(ir),e.removed=[],typeof ot=="string"&&(ur=!1),ur){if(ot.nodeName){var mi=Qe(ot.nodeName);if(!Le[mi]||Bt[mi])throw CS("root node is forbidden and cannot be sanitized in-place")}}else if(ot instanceof a)Vt=vt("<!---->"),Hr=Vt.ownerDocument.importNode(ot,!0),Hr.nodeType===1&&Hr.nodeName==="BODY"||Hr.nodeName==="HTML"?Vt=Hr:Vt.appendChild(Hr);else{if(!wt&&!br&&!Fr&&ot.indexOf("<")===-1)return Te&&tr?Te.createHTML(ot):ot;if(Vt=vt(ot),!Vt)return wt?null:tr?qe:""}Vt&&lt&&Ge(Vt.firstChild);for(var mn=Tt(ur?ot:Vt);ci=mn.nextNode();)ci.nodeType===3&&ci===un||dr(ci)||(ci.content instanceof n&&zr(ci.content),Er(ci),un=ci);if(un=null,ur)return ot;if(wt){if(Ur)for(wn=at.call(Vt.ownerDocument);Vt.firstChild;)wn.appendChild(Vt.firstChild);else wn=Vt;return(rt.shadowroot||rt.shadowrootmod)&&(wn=ke.call(t,wn,!0)),wn}var yn=Fr?Vt.outerHTML:Vt.innerHTML;return Fr&&Le["!doctype"]&&Vt.ownerDocument&&Vt.ownerDocument.doctype&&Vt.ownerDocument.doctype.name&&_c(hde,Vt.ownerDocument.doctype.name)&&(yn="<!DOCTYPE "+Vt.ownerDocument.doctype.name+`>
`+yn),br&&(yn=bh(yn,Xe," "),yn=bh(yn,Ct," "),yn=bh(yn,Et," ")),Te&&tr?Te.createHTML(yn):yn},e.setConfig=function(ot){Ae(ot),kt=!0},e.clearConfig=function(){Be=null,kt=!1},e.isValidAttribute=function(ot,ir,Vt){Be||Ae({});var Hr=Qe(ot),ci=Qe(ir);return Cr(Hr,ci,Vt)},e.addHook=function(ot,ir){typeof ir=="function"&&(Ye[ot]=Ye[ot]||[],T0(Ye[ot],ir))},e.removeHook=function(ot){if(Ye[ot])return HO(Ye[ot])},e.removeHooks=function(ot){Ye[ot]&&(Ye[ot]=[])},e.removeAllHooks=function(){Ye={}},e}var fde=KO();const pde=Object.freeze(Object.defineProperty({__proto__:null,default:fde},Symbol.toStringTag,{value:"Module"}));var I0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function WO(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Db=function(r){return r&&r.Math==Math&&r},Ta=Db(typeof globalThis=="object"&&globalThis)||Db(typeof window=="object"&&window)||Db(typeof self=="object"&&self)||Db(typeof I0=="object"&&I0)||function(){return this}()||I0||Function("return this")(),sm={},Wo=function(r){try{return!!r()}catch{return!0}},gde=Wo,sA=!gde(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),mde=Wo,Rb=!mde(function(){var r=(function(){}).bind();return typeof r!="function"||r.hasOwnProperty("prototype")}),yde=Rb,kb=Function.prototype.call,Al=yde?kb.bind(kb):function(){return kb.apply(kb,arguments)},XO={},ZO={}.propertyIsEnumerable,JO=Object.getOwnPropertyDescriptor,_de=JO&&!ZO.call({1:2},1);XO.f=_de?function(r){var e=JO(this,r);return!!e&&e.enumerable}:ZO;var Ob=function(r,e){return{enumerable:!(r&1),configurable:!(r&2),writable:!(r&4),value:e}},YO=Rb,eU=Function.prototype,LS=eU.call,vde=YO&&eU.bind.bind(LS,LS),Xo=YO?vde:function(r){return function(){return LS.apply(r,arguments)}},tU=Xo,bde=tU({}.toString),xde=tU("".slice),Wf=function(r){return xde(bde(r),8,-1)},wde=Xo,Bde=Wo,Cde=Wf,MS=Object,Ede=wde("".split),rU=Bde(function(){return!MS("z").propertyIsEnumerable(0)})?function(r){return Cde(r)=="String"?Ede(r,""):MS(r)}:MS,Xf=function(r){return r==null},Sde=Xf,Tde=TypeError,oA=function(r){if(Sde(r))throw Tde("Can't call method on "+r);return r},Ide=rU,Lde=oA,L0=function(r){return Ide(Lde(r))},PS=typeof document=="object"&&document.all,Mde=typeof PS>"u"&&PS!==void 0,iU={all:PS,IS_HTMLDDA:Mde},nU=iU,Pde=nU.all,To=nU.IS_HTMLDDA?function(r){return typeof r=="function"||r===Pde}:function(r){return typeof r=="function"},sU=To,oU=iU,Fde=oU.all,GA=oU.IS_HTMLDDA?function(r){return typeof r=="object"?r!==null:sU(r)||r===Fde}:function(r){return typeof r=="object"?r!==null:sU(r)},FS=Ta,Dde=To,Rde=function(r){return Dde(r)?r:void 0},Zf=function(r,e){return arguments.length<2?Rde(FS[r]):FS[r]&&FS[r][e]},kde=Xo,Ub=kde({}.isPrototypeOf),Nb=typeof navigator<"u"&&String(navigator.userAgent)||"",aU=Ta,DS=Nb,lU=aU.process,cU=aU.Deno,uU=lU&&lU.versions||cU&&cU.version,hU=uU&&uU.v8,xh,zb;hU&&(xh=hU.split("."),zb=xh[0]>0&&xh[0]<4?1:+(xh[0]+xh[1])),!zb&&DS&&(xh=DS.match(/Edge\/(\d+)/),(!xh||xh[1]>=74)&&(xh=DS.match(/Chrome\/(\d+)/),xh&&(zb=+xh[1])));var RS=zb,AU=RS,Ode=Wo,Ude=Ta,Nde=Ude.String,dU=!!Object.getOwnPropertySymbols&&!Ode(function(){var r=Symbol();return!Nde(r)||!(Object(r)instanceof Symbol)||!Symbol.sham&&AU&&AU<41}),zde=dU,fU=zde&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Qde=Zf,Vde=To,Hde=Ub,Gde=fU,jde=Object,pU=Gde?function(r){return typeof r=="symbol"}:function(r){var e=Qde("Symbol");return Vde(e)&&Hde(e.prototype,jde(r))},qde=String,Qb=function(r){try{return qde(r)}catch{return"Object"}},$de=To,Kde=Qb,Wde=TypeError,jA=function(r){if($de(r))return r;throw Wde(Kde(r)+" is not a function")},Xde=jA,Zde=Xf,om=function(r,e){var t=r[e];return Zde(t)?void 0:Xde(t)},kS=Al,OS=To,US=GA,Jde=TypeError,Yde=function(r,e){var t,i;if(e==="string"&&OS(t=r.toString)&&!US(i=kS(t,r))||OS(t=r.valueOf)&&!US(i=kS(t,r))||e!=="string"&&OS(t=r.toString)&&!US(i=kS(t,r)))return i;throw Jde("Can't convert object to primitive value")},gU={exports:{}},mU=Ta,efe=Object.defineProperty,NS=function(r,e){try{efe(mU,r,{value:e,configurable:!0,writable:!0})}catch{mU[r]=e}return e},tfe=Ta,rfe=NS,yU="__core-js_shared__",ife=tfe[yU]||rfe(yU,{}),zS=ife,_U=zS;(gU.exports=function(r,e){return _U[r]||(_U[r]=e!==void 0?e:{})})("versions",[]).push({version:"3.30.2",mode:"global",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"});var QS=gU.exports,nfe=oA,sfe=Object,Vb=function(r){return sfe(nfe(r))},ofe=Xo,afe=Vb,lfe=ofe({}.hasOwnProperty),wh=Object.hasOwn||function(r,e){return lfe(afe(r),e)},cfe=Xo,ufe=0,hfe=Math.random(),Afe=cfe(1 .toString),vU=function(r){return"Symbol("+(r===void 0?"":r)+")_"+Afe(++ufe+hfe,36)},dfe=Ta,ffe=QS,bU=wh,pfe=vU,gfe=dU,mfe=fU,am=dfe.Symbol,VS=ffe("wks"),yfe=mfe?am.for||am:am&&am.withoutSetter||pfe,Wa=function(r){return bU(VS,r)||(VS[r]=gfe&&bU(am,r)?am[r]:yfe("Symbol."+r)),VS[r]},_fe=Al,xU=GA,wU=pU,vfe=om,bfe=Yde,xfe=Wa,wfe=TypeError,Bfe=xfe("toPrimitive"),Cfe=function(r,e){if(!xU(r)||wU(r))return r;var t=vfe(r,Bfe),i;if(t){if(e===void 0&&(e="default"),i=_fe(t,r,e),!xU(i)||wU(i))return i;throw wfe("Can't convert object to primitive value")}return e===void 0&&(e="number"),bfe(r,e)},Efe=Cfe,Sfe=pU,HS=function(r){var e=Efe(r,"string");return Sfe(e)?e:e+""},Tfe=Ta,BU=GA,GS=Tfe.document,Ife=BU(GS)&&BU(GS.createElement),Hb=function(r){return Ife?GS.createElement(r):{}},Lfe=sA,Mfe=Wo,Pfe=Hb,CU=!Lfe&&!Mfe(function(){return Object.defineProperty(Pfe("div"),"a",{get:function(){return 7}}).a!=7}),Ffe=sA,Dfe=Al,Rfe=XO,kfe=Ob,Ofe=L0,Ufe=HS,Nfe=wh,zfe=CU,EU=Object.getOwnPropertyDescriptor;sm.f=Ffe?EU:function(r,e){if(r=Ofe(r),e=Ufe(e),zfe)try{return EU(r,e)}catch{}if(Nfe(r,e))return kfe(!Dfe(Rfe.f,r,e),r[e])};var aA={},Qfe=sA,Vfe=Wo,SU=Qfe&&Vfe(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Hfe=GA,Gfe=String,jfe=TypeError,Ql=function(r){if(Hfe(r))return r;throw jfe(Gfe(r)+" is not an object")},qfe=sA,$fe=CU,Kfe=SU,Gb=Ql,TU=HS,Wfe=TypeError,jS=Object.defineProperty,Xfe=Object.getOwnPropertyDescriptor,qS="enumerable",$S="configurable",KS="writable";aA.f=qfe?Kfe?function(r,e,t){if(Gb(r),e=TU(e),Gb(t),typeof r=="function"&&e==="prototype"&&"value"in t&&KS in t&&!t[KS]){var i=Xfe(r,e);i&&i[KS]&&(r[e]=t.value,t={configurable:$S in t?t[$S]:i[$S],enumerable:qS in t?t[qS]:i[qS],writable:!1})}return jS(r,e,t)}:jS:function(r,e,t){if(Gb(r),e=TU(e),Gb(t),$fe)try{return jS(r,e,t)}catch{}if("get"in t||"set"in t)throw Wfe("Accessors not supported");return"value"in t&&(r[e]=t.value),r};var Zfe=sA,Jfe=aA,Yfe=Ob,M0=Zfe?function(r,e,t){return Jfe.f(r,e,Yfe(1,t))}:function(r,e,t){return r[e]=t,r},IU={exports:{}},WS=sA,epe=wh,LU=Function.prototype,tpe=WS&&Object.getOwnPropertyDescriptor,XS=epe(LU,"name"),rpe=XS&&(function(){}).name==="something",ipe=XS&&(!WS||WS&&tpe(LU,"name").configurable),jb={EXISTS:XS,PROPER:rpe,CONFIGURABLE:ipe},npe=Xo,spe=To,ZS=zS,ope=npe(Function.toString);spe(ZS.inspectSource)||(ZS.inspectSource=function(r){return ope(r)});var JS=ZS.inspectSource,ape=Ta,lpe=To,MU=ape.WeakMap,cpe=lpe(MU)&&/native code/.test(String(MU)),upe=QS,hpe=vU,PU=upe("keys"),YS=function(r){return PU[r]||(PU[r]=hpe(r))},eT={},Ape=cpe,FU=Ta,dpe=GA,fpe=M0,tT=wh,rT=zS,ppe=YS,gpe=eT,DU="Object already initialized",iT=FU.TypeError,mpe=FU.WeakMap,qb,P0,$b,ype=function(r){return $b(r)?P0(r):qb(r,{})},_pe=function(r){return function(e){var t;if(!dpe(e)||(t=P0(e)).type!==r)throw iT("Incompatible receiver, "+r+" required");return t}};if(Ape||rT.state){var lA=rT.state||(rT.state=new mpe);lA.get=lA.get,lA.has=lA.has,lA.set=lA.set,qb=function(r,e){if(lA.has(r))throw iT(DU);return e.facade=r,lA.set(r,e),e},P0=function(r){return lA.get(r)||{}},$b=function(r){return lA.has(r)}}else{var lm=ppe("state");gpe[lm]=!0,qb=function(r,e){if(tT(r,lm))throw iT(DU);return e.facade=r,fpe(r,lm,e),e},P0=function(r){return tT(r,lm)?r[lm]:{}},$b=function(r){return tT(r,lm)}}var Kb={set:qb,get:P0,has:$b,enforce:ype,getterFor:_pe},nT=Xo,vpe=Wo,bpe=To,Wb=wh,sT=sA,xpe=jb.CONFIGURABLE,wpe=JS,RU=Kb,Bpe=RU.enforce,Cpe=RU.get,kU=String,Xb=Object.defineProperty,Epe=nT("".slice),Spe=nT("".replace),Tpe=nT([].join),Ipe=sT&&!vpe(function(){return Xb(function(){},"length",{value:8}).length!==8}),Lpe=String(String).split("String"),Mpe=IU.exports=function(r,e,t){Epe(kU(e),0,7)==="Symbol("&&(e="["+Spe(kU(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!Wb(r,"name")||xpe&&r.name!==e)&&(sT?Xb(r,"name",{value:e,configurable:!0}):r.name=e),Ipe&&t&&Wb(t,"arity")&&r.length!==t.arity&&Xb(r,"length",{value:t.arity});try{t&&Wb(t,"constructor")&&t.constructor?sT&&Xb(r,"prototype",{writable:!1}):r.prototype&&(r.prototype=void 0)}catch{}var i=Bpe(r);return Wb(i,"source")||(i.source=Tpe(Lpe,typeof e=="string"?e:"")),r};Function.prototype.toString=Mpe(function(){return bpe(this)&&Cpe(this).source||wpe(this)},"toString");var OU=IU.exports,Ppe=To,Fpe=aA,Dpe=OU,Rpe=NS,Jf=function(r,e,t,i){i||(i={});var n=i.enumerable,o=i.name!==void 0?i.name:e;if(Ppe(t)&&Dpe(t,o,i),i.global)n?r[e]=t:Rpe(e,t);else{try{i.unsafe?r[e]&&(n=!0):delete r[e]}catch{}n?r[e]=t:Fpe.f(r,e,{value:t,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return r},UU={},kpe=Math.ceil,Ope=Math.floor,Upe=Math.trunc||function(r){var e=+r;return(e>0?Ope:kpe)(e)},Npe=Upe,Zb=function(r){var e=+r;return e!==e||e===0?0:Npe(e)},zpe=Zb,Qpe=Math.max,Vpe=Math.min,NU=function(r,e){var t=zpe(r);return t<0?Qpe(t+e,0):Vpe(t,e)},Hpe=Zb,Gpe=Math.min,cm=function(r){return r>0?Gpe(Hpe(r),9007199254740991):0},jpe=cm,Jb=function(r){return jpe(r.length)},qpe=L0,$pe=NU,Kpe=Jb,zU=function(r){return function(e,t,i){var n=qpe(e),o=Kpe(n),a=$pe(i,o),s;if(r&&t!=t){for(;o>a;)if(s=n[a++],s!=s)return!0}else for(;o>a;a++)if((r||a in n)&&n[a]===t)return r||a||0;return!r&&-1}},QU={includes:zU(!0),indexOf:zU(!1)},Wpe=Xo,oT=wh,Xpe=L0,Zpe=QU.indexOf,Jpe=eT,VU=Wpe([].push),HU=function(r,e){var t=Xpe(r),i=0,n=[],o;for(o in t)!oT(Jpe,o)&&oT(t,o)&&VU(n,o);for(;e.length>i;)oT(t,o=e[i++])&&(~Zpe(n,o)||VU(n,o));return n},aT=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ype=HU,ege=aT,tge=ege.concat("length","prototype");UU.f=Object.getOwnPropertyNames||function(r){return Ype(r,tge)};var GU={};GU.f=Object.getOwnPropertySymbols;var rge=Zf,ige=Xo,nge=UU,sge=GU,oge=Ql,age=ige([].concat),lge=rge("Reflect","ownKeys")||function(r){var e=nge.f(oge(r)),t=sge.f;return t?age(e,t(r)):e},jU=wh,cge=lge,uge=sm,hge=aA,Age=function(r,e,t){for(var i=cge(e),n=hge.f,o=uge.f,a=0;a<i.length;a++){var s=i[a];!jU(r,s)&&!(t&&jU(t,s))&&n(r,s,o(e,s))}},dge=Wo,fge=To,pge=/#|\.prototype\./,F0=function(r,e){var t=mge[gge(r)];return t==_ge?!0:t==yge?!1:fge(e)?dge(e):!!e},gge=F0.normalize=function(r){return String(r).replace(pge,".").toLowerCase()},mge=F0.data={},yge=F0.NATIVE="N",_ge=F0.POLYFILL="P",qU=F0,lT=Ta,vge=sm.f,bge=M0,xge=Jf,wge=NS,Bge=Age,Cge=qU,vc=function(r,e){var t=r.target,i=r.global,n=r.stat,o,a,s,g,y,T;if(i?a=lT:n?a=lT[t]||wge(t,{}):a=(lT[t]||{}).prototype,a)for(s in e){if(y=e[s],r.dontCallGetSet?(T=vge(a,s),g=T&&T.value):g=a[s],o=Cge(i?s:t+(n?".":"#")+s,r.forced),!o&&g!==void 0){if(typeof y==typeof g)continue;Bge(y,g)}(r.sham||g&&g.sham)&&bge(y,"sham",!0),xge(a,s,y,r)}},Ege=Wf,D0=typeof process<"u"&&Ege(process)=="process",Sge=Xo,Tge=jA,Ige=function(r,e,t){try{return Sge(Tge(Object.getOwnPropertyDescriptor(r,e)[t]))}catch{}},Lge=To,Mge=String,Pge=TypeError,Fge=function(r){if(typeof r=="object"||Lge(r))return r;throw Pge("Can't set "+Mge(r)+" as a prototype")},Dge=Ige,Rge=Ql,kge=Fge,$U=Object.setPrototypeOf||("__proto__"in{}?function(){var r=!1,e={},t;try{t=Dge(Object.prototype,"__proto__","set"),t(e,[]),r=e instanceof Array}catch{}return function(i,n){return Rge(i),kge(n),r?t(i,n):i.__proto__=n,i}}():void 0),Oge=aA.f,Uge=wh,Nge=Wa,KU=Nge("toStringTag"),cT=function(r,e,t){r&&!t&&(r=r.prototype),r&&!Uge(r,KU)&&Oge(r,KU,{configurable:!0,value:e})},WU=OU,zge=aA,Qge=function(r,e,t){return t.get&&WU(t.get,e,{getter:!0}),t.set&&WU(t.set,e,{setter:!0}),zge.f(r,e,t)},Vge=Zf,Hge=Qge,Gge=Wa,jge=sA,XU=Gge("species"),qge=function(r){var e=Vge(r);jge&&e&&!e[XU]&&Hge(e,XU,{configurable:!0,get:function(){return this}})},$ge=Ub,Kge=TypeError,Wge=function(r,e){if($ge(e,r))return r;throw Kge("Incorrect invocation")},Xge=Wa,Zge=Xge("toStringTag"),ZU={};ZU[Zge]="z";var Jge=String(ZU)==="[object z]",Yge=Jge,eme=To,Yb=Wf,tme=Wa,rme=tme("toStringTag"),ime=Object,nme=Yb(function(){return arguments}())=="Arguments",sme=function(r,e){try{return r[e]}catch{}},uT=Yge?Yb:function(r){var e,t,i;return r===void 0?"Undefined":r===null?"Null":typeof(t=sme(e=ime(r),rme))=="string"?t:nme?Yb(e):(i=Yb(e))=="Object"&&eme(e.callee)?"Arguments":i},ome=Xo,ame=Wo,JU=To,lme=uT,cme=Zf,ume=JS,YU=function(){},hme=[],e6=cme("Reflect","construct"),hT=/^\s*(?:class|function)\b/,Ame=ome(hT.exec),dme=!hT.exec(YU),R0=function(r){if(!JU(r))return!1;try{return e6(YU,hme,r),!0}catch{return!1}},t6=function(r){if(!JU(r))return!1;switch(lme(r)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return dme||!!Ame(hT,ume(r))}catch{return!0}};t6.sham=!0;var fme=!e6||ame(function(){var r;return R0(R0.call)||!R0(Object)||!R0(function(){r=!0})||r})?t6:R0,pme=fme,gme=Qb,mme=TypeError,yme=function(r){if(pme(r))return r;throw mme(gme(r)+" is not a constructor")},r6=Ql,_me=yme,vme=Xf,bme=Wa,xme=bme("species"),i6=function(r,e){var t=r6(r).constructor,i;return t===void 0||vme(i=r6(t)[xme])?e:_me(i)},wme=Rb,n6=Function.prototype,s6=n6.apply,o6=n6.call,AT=typeof Reflect=="object"&&Reflect.apply||(wme?o6.bind(s6):function(){return o6.apply(s6,arguments)}),Bme=Wf,Cme=Xo,k0=function(r){if(Bme(r)==="Function")return Cme(r)},a6=k0,Eme=jA,Sme=Rb,Tme=a6(a6.bind),dT=function(r,e){return Eme(r),e===void 0?r:Sme?Tme(r,e):function(){return r.apply(e,arguments)}},Ime=Zf,l6=Ime("document","documentElement"),Lme=Xo,Mme=Lme([].slice),Pme=TypeError,Fme=function(r,e){if(r<e)throw Pme("Not enough arguments");return r},Dme=Nb,c6=/(?:ipad|iphone|ipod).*applewebkit/i.test(Dme),du=Ta,Rme=AT,kme=dT,u6=To,Ome=wh,h6=Wo,A6=l6,Ume=Mme,d6=Hb,Nme=Fme,zme=c6,Qme=D0,fT=du.setImmediate,pT=du.clearImmediate,Vme=du.process,gT=du.Dispatch,Hme=du.Function,f6=du.MessageChannel,Gme=du.String,mT=0,O0={},p6="onreadystatechange",U0,Yf,yT,_T;h6(function(){U0=du.location});var vT=function(r){if(Ome(O0,r)){var e=O0[r];delete O0[r],e()}},bT=function(r){return function(){vT(r)}},g6=function(r){vT(r.data)},m6=function(r){du.postMessage(Gme(r),U0.protocol+"//"+U0.host)};(!fT||!pT)&&(fT=function(r){Nme(arguments.length,1);var e=u6(r)?r:Hme(r),t=Ume(arguments,1);return O0[++mT]=function(){Rme(e,void 0,t)},Yf(mT),mT},pT=function(r){delete O0[r]},Qme?Yf=function(r){Vme.nextTick(bT(r))}:gT&&gT.now?Yf=function(r){gT.now(bT(r))}:f6&&!zme?(yT=new f6,_T=yT.port2,yT.port1.onmessage=g6,Yf=kme(_T.postMessage,_T)):du.addEventListener&&u6(du.postMessage)&&!du.importScripts&&U0&&U0.protocol!=="file:"&&!h6(m6)?(Yf=m6,du.addEventListener("message",g6,!1)):p6 in d6("script")?Yf=function(r){A6.appendChild(d6("script"))[p6]=function(){A6.removeChild(this),vT(r)}}:Yf=function(r){setTimeout(bT(r),0)});var y6={set:fT,clear:pT},_6=function(){this.head=null,this.tail=null};_6.prototype={add:function(r){var e={item:r,next:null},t=this.tail;t?t.next=e:this.head=e,this.tail=e},get:function(){var r=this.head;if(r){var e=this.head=r.next;return e===null&&(this.tail=null),r.item}}};var v6=_6,jme=Nb,qme=/ipad|iphone|ipod/i.test(jme)&&typeof Pebble<"u",$me=Nb,Kme=/web0s(?!.*chrome)/i.test($me),ep=Ta,b6=dT,Wme=sm.f,xT=y6.set,Xme=v6,Zme=c6,Jme=qme,Yme=Kme,wT=D0,x6=ep.MutationObserver||ep.WebKitMutationObserver,w6=ep.document,B6=ep.process,ex=ep.Promise,C6=Wme(ep,"queueMicrotask"),BT=C6&&C6.value,um,CT,ET,tx,E6;if(!BT){var rx=new Xme,ix=function(){var r,e;for(wT&&(r=B6.domain)&&r.exit();e=rx.get();)try{e()}catch(t){throw rx.head&&um(),t}r&&r.enter()};!Zme&&!wT&&!Yme&&x6&&w6?(CT=!0,ET=w6.createTextNode(""),new x6(ix).observe(ET,{characterData:!0}),um=function(){ET.data=CT=!CT}):!Jme&&ex&&ex.resolve?(tx=ex.resolve(void 0),tx.constructor=ex,E6=b6(tx.then,tx),um=function(){E6(ix)}):wT?um=function(){B6.nextTick(ix)}:(xT=b6(xT,ep),um=function(){xT(ix)}),BT=function(r){rx.head||um(),rx.add(r)}}var eye=BT,tye=function(r,e){try{arguments.length==1?console.error(r):console.error(r,e)}catch{}},ST=function(r){try{return{error:!1,value:r()}}catch(e){return{error:!0,value:e}}},rye=Ta,nx=rye.Promise,S6=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",iye=S6,nye=D0,sye=!iye&&!nye&&typeof window=="object"&&typeof document=="object",oye=Ta,N0=nx,aye=To,lye=qU,cye=JS,uye=Wa,hye=sye,Aye=S6,TT=RS;N0&&N0.prototype;var dye=uye("species"),IT=!1,T6=aye(oye.PromiseRejectionEvent),fye=lye("Promise",function(){var r=cye(N0),e=r!==String(N0);if(!e&&TT===66)return!0;if(!TT||TT<51||!/native code/.test(r)){var t=new N0(function(o){o(1)}),i=function(o){o(function(){},function(){})},n=t.constructor={};if(n[dye]=i,IT=t.then(function(){})instanceof i,!IT)return!0}return!e&&(hye||Aye)&&!T6}),z0={CONSTRUCTOR:fye,REJECTION_EVENT:T6,SUBCLASSING:IT},hm={},I6=jA,pye=TypeError,gye=function(r){var e,t;this.promise=new r(function(i,n){if(e!==void 0||t!==void 0)throw pye("Bad Promise constructor");e=i,t=n}),this.resolve=I6(e),this.reject=I6(t)};hm.f=function(r){return new gye(r)};var mye=vc,sx=D0,zd=Ta,Am=Al,L6=Jf,M6=$U,yye=cT,_ye=qge,vye=jA,ox=To,bye=GA,xye=Wge,wye=i6,P6=y6.set,LT=eye,Bye=tye,Cye=ST,Eye=v6,F6=Kb,ax=nx,MT=z0,D6=hm,lx="Promise",R6=MT.CONSTRUCTOR,Sye=MT.REJECTION_EVENT,Tye=MT.SUBCLASSING,PT=F6.getterFor(lx),Iye=F6.set,dm=ax&&ax.prototype,tp=ax,cx=dm,k6=zd.TypeError,FT=zd.document,DT=zd.process,RT=D6.f,Lye=RT,Mye=!!(FT&&FT.createEvent&&zd.dispatchEvent),O6="unhandledrejection",Pye="rejectionhandled",U6=0,N6=1,Fye=2,kT=1,z6=2,ux,Q6,Dye,V6,H6=function(r){var e;return bye(r)&&ox(e=r.then)?e:!1},G6=function(r,e){var t=e.value,i=e.state==N6,n=i?r.ok:r.fail,o=r.resolve,a=r.reject,s=r.domain,g,y,T;try{n?(i||(e.rejection===z6&&kye(e),e.rejection=kT),n===!0?g=t:(s&&s.enter(),g=n(t),s&&(s.exit(),T=!0)),g===r.promise?a(k6("Promise-chain cycle")):(y=H6(g))?Am(y,g,o,a):o(g)):a(t)}catch(I){s&&!T&&s.exit(),a(I)}},j6=function(r,e){r.notified||(r.notified=!0,LT(function(){for(var t=r.reactions,i;i=t.get();)G6(i,r);r.notified=!1,e&&!r.rejection&&Rye(r)}))},q6=function(r,e,t){var i,n;Mye?(i=FT.createEvent("Event"),i.promise=e,i.reason=t,i.initEvent(r,!1,!0),zd.dispatchEvent(i)):i={promise:e,reason:t},!Sye&&(n=zd["on"+r])?n(i):r===O6&&Bye("Unhandled promise rejection",t)},Rye=function(r){Am(P6,zd,function(){var e=r.facade,t=r.value,i=$6(r),n;if(i&&(n=Cye(function(){sx?DT.emit("unhandledRejection",t,e):q6(O6,e,t)}),r.rejection=sx||$6(r)?z6:kT,n.error))throw n.value})},$6=function(r){return r.rejection!==kT&&!r.parent},kye=function(r){Am(P6,zd,function(){var e=r.facade;sx?DT.emit("rejectionHandled",e):q6(Pye,e,r.value)})},fm=function(r,e,t){return function(i){r(e,i,t)}},pm=function(r,e,t){r.done||(r.done=!0,t&&(r=t),r.value=e,r.state=Fye,j6(r,!0))},OT=function(r,e,t){if(!r.done){r.done=!0,t&&(r=t);try{if(r.facade===e)throw k6("Promise can't be resolved itself");var i=H6(e);i?LT(function(){var n={done:!1};try{Am(i,e,fm(OT,n,r),fm(pm,n,r))}catch(o){pm(n,o,r)}}):(r.value=e,r.state=N6,j6(r,!1))}catch(n){pm({done:!1},n,r)}}};if(R6&&(tp=function(r){xye(this,cx),vye(r),Am(ux,this);var e=PT(this);try{r(fm(OT,e),fm(pm,e))}catch(t){pm(e,t)}},cx=tp.prototype,ux=function(r){Iye(this,{type:lx,done:!1,notified:!1,parent:!1,reactions:new Eye,rejection:!1,state:U6,value:void 0})},ux.prototype=L6(cx,"then",function(r,e){var t=PT(this),i=RT(wye(this,tp));return t.parent=!0,i.ok=ox(r)?r:!0,i.fail=ox(e)&&e,i.domain=sx?DT.domain:void 0,t.state==U6?t.reactions.add(i):LT(function(){G6(i,t)}),i.promise}),Q6=function(){var r=new ux,e=PT(r);this.promise=r,this.resolve=fm(OT,e),this.reject=fm(pm,e)},D6.f=RT=function(r){return r===tp||r===Dye?new Q6(r):Lye(r)},ox(ax)&&dm!==Object.prototype)){V6=dm.then,Tye||L6(dm,"then",function(r,e){var t=this;return new tp(function(i,n){Am(V6,t,i,n)}).then(r,e)},{unsafe:!0});try{delete dm.constructor}catch{}M6&&M6(dm,cx)}mye({global:!0,constructor:!0,wrap:!0,forced:R6},{Promise:tp}),yye(tp,lx,!1),_ye(lx);var Q0={},Oye=Wa,Uye=Q0,Nye=Oye("iterator"),zye=Array.prototype,Qye=function(r){return r!==void 0&&(Uye.Array===r||zye[Nye]===r)},Vye=uT,K6=om,Hye=Xf,Gye=Q0,jye=Wa,qye=jye("iterator"),W6=function(r){if(!Hye(r))return K6(r,qye)||K6(r,"@@iterator")||Gye[Vye(r)]},$ye=Al,Kye=jA,Wye=Ql,Xye=Qb,Zye=W6,Jye=TypeError,Yye=function(r,e){var t=arguments.length<2?Zye(r):e;if(Kye(t))return Wye($ye(t,r));throw Jye(Xye(r)+" is not iterable")},e0e=Al,X6=Ql,t0e=om,r0e=function(r,e,t){var i,n;X6(r);try{if(i=t0e(r,"return"),!i){if(e==="throw")throw t;return t}i=e0e(i,r)}catch(o){n=!0,i=o}if(e==="throw")throw t;if(n)throw i;return X6(i),t},i0e=dT,n0e=Al,s0e=Ql,o0e=Qb,a0e=Qye,l0e=Jb,Z6=Ub,c0e=Yye,u0e=W6,J6=r0e,h0e=TypeError,hx=function(r,e){this.stopped=r,this.result=e},Y6=hx.prototype,eN=function(r,e,t){var i=t&&t.that,n=!!(t&&t.AS_ENTRIES),o=!!(t&&t.IS_RECORD),a=!!(t&&t.IS_ITERATOR),s=!!(t&&t.INTERRUPTED),g=i0e(e,i),y,T,I,R,U,Z,Y,he=function(pe){return y&&J6(y,"normal",pe),new hx(!0,pe)},ce=function(pe){return n?(s0e(pe),s?g(pe[0],pe[1],he):g(pe[0],pe[1])):s?g(pe,he):g(pe)};if(o)y=r.iterator;else if(a)y=r;else{if(T=u0e(r),!T)throw h0e(o0e(r)+" is not iterable");if(a0e(T)){for(I=0,R=l0e(r);R>I;I++)if(U=ce(r[I]),U&&Z6(Y6,U))return U;return new hx(!1)}y=c0e(r,T)}for(Z=o?r.next:y.next;!(Y=n0e(Z,y)).done;){try{U=ce(Y.value)}catch(pe){J6(y,"throw",pe)}if(typeof U=="object"&&U&&Z6(Y6,U))return U}return new hx(!1)},A0e=Wa,tN=A0e("iterator"),rN=!1;try{var d0e=0,iN={next:function(){return{done:!!d0e++}},return:function(){rN=!0}};iN[tN]=function(){return this},Array.from(iN,function(){throw 2})}catch{}var f0e=function(r,e){if(!e&&!rN)return!1;var t=!1;try{var i={};i[tN]=function(){return{next:function(){return{done:t=!0}}}},r(i)}catch{}return t},p0e=nx,g0e=f0e,m0e=z0.CONSTRUCTOR,nN=m0e||!g0e(function(r){p0e.all(r).then(void 0,function(){})}),y0e=vc,_0e=Al,v0e=jA,b0e=hm,x0e=ST,w0e=eN,B0e=nN;y0e({target:"Promise",stat:!0,forced:B0e},{all:function(r){var e=this,t=b0e.f(e),i=t.resolve,n=t.reject,o=x0e(function(){var a=v0e(e.resolve),s=[],g=0,y=1;w0e(r,function(T){var I=g++,R=!1;y++,_0e(a,e,T).then(function(U){R||(R=!0,s[I]=U,--y||i(s))},n)}),--y||i(s)});return o.error&&n(o.value),t.promise}});var C0e=vc,E0e=z0.CONSTRUCTOR,UT=nx,S0e=Zf,T0e=To,I0e=Jf,sN=UT&&UT.prototype;if(C0e({target:"Promise",proto:!0,forced:E0e,real:!0},{catch:function(r){return this.then(void 0,r)}}),T0e(UT)){var oN=S0e("Promise").prototype.catch;sN.catch!==oN&&I0e(sN,"catch",oN,{unsafe:!0})}var L0e=vc,M0e=Al,P0e=jA,F0e=hm,D0e=ST,R0e=eN,k0e=nN;L0e({target:"Promise",stat:!0,forced:k0e},{race:function(r){var e=this,t=F0e.f(e),i=t.reject,n=D0e(function(){var o=P0e(e.resolve);R0e(r,function(a){M0e(o,e,a).then(t.resolve,i)})});return n.error&&i(n.value),t.promise}});var O0e=vc,U0e=Al,N0e=hm,z0e=z0.CONSTRUCTOR;O0e({target:"Promise",stat:!0,forced:z0e},{reject:function(r){var e=N0e.f(this);return U0e(e.reject,void 0,r),e.promise}});var Q0e=Ql,V0e=GA,H0e=hm,G0e=function(r,e){if(Q0e(r),V0e(e)&&e.constructor===r)return e;var t=H0e.f(r),i=t.resolve;return i(e),t.promise},j0e=vc,q0e=Zf,$0e=z0.CONSTRUCTOR,K0e=G0e;q0e("Promise"),j0e({target:"Promise",stat:!0,forced:$0e},{resolve:function(r){return K0e(this,r)}});function aN(r,e,t,i,n,o,a){try{var s=r[o](a),g=s.value}catch(y){t(y);return}s.done?e(g):Promise.resolve(g).then(i,n)}function qA(r){return function(){var e=this,t=arguments;return new Promise(function(i,n){var o=r.apply(e,t);function a(g){aN(o,i,n,a,s,"next",g)}function s(g){aN(o,i,n,a,s,"throw",g)}a(void 0)})}}var W0e=uT,X0e=String,cA=function(r){if(W0e(r)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return X0e(r)},Z0e=Ql,lN=function(){var r=Z0e(this),e="";return r.hasIndices&&(e+="d"),r.global&&(e+="g"),r.ignoreCase&&(e+="i"),r.multiline&&(e+="m"),r.dotAll&&(e+="s"),r.unicode&&(e+="u"),r.unicodeSets&&(e+="v"),r.sticky&&(e+="y"),e},NT=Wo,J0e=Ta,zT=J0e.RegExp,QT=NT(function(){var r=zT("a","y");return r.lastIndex=2,r.exec("abcd")!=null}),Y0e=QT||NT(function(){return!zT("a","y").sticky}),e_e=QT||NT(function(){var r=zT("^r","gy");return r.lastIndex=2,r.exec("str")!=null}),cN={BROKEN_CARET:e_e,MISSED_STICKY:Y0e,UNSUPPORTED_Y:QT},uN={},t_e=HU,r_e=aT,i_e=Object.keys||function(r){return t_e(r,r_e)},n_e=sA,s_e=SU,o_e=aA,a_e=Ql,l_e=L0,c_e=i_e;uN.f=n_e&&!s_e?Object.defineProperties:function(r,e){a_e(r);for(var t=l_e(e),i=c_e(e),n=i.length,o=0,a;n>o;)o_e.f(r,a=i[o++],t[a]);return r};var u_e=Ql,h_e=uN,hN=aT,A_e=eT,d_e=l6,f_e=Hb,p_e=YS,AN=">",dN="<",VT="prototype",HT="script",fN=p_e("IE_PROTO"),GT=function(){},pN=function(r){return dN+HT+AN+r+dN+"/"+HT+AN},gN=function(r){r.write(pN("")),r.close();var e=r.parentWindow.Object;return r=null,e},g_e=function(){var r=f_e("iframe"),e="java"+HT+":",t;return r.style.display="none",d_e.appendChild(r),r.src=String(e),t=r.contentWindow.document,t.open(),t.write(pN("document.F=Object")),t.close(),t.F},Ax,dx=function(){try{Ax=new ActiveXObject("htmlfile")}catch{}dx=typeof document<"u"?document.domain&&Ax?gN(Ax):g_e():gN(Ax);for(var r=hN.length;r--;)delete dx[VT][hN[r]];return dx()};A_e[fN]=!0;var jT=Object.create||function(r,e){var t;return r!==null?(GT[VT]=u_e(r),t=new GT,GT[VT]=null,t[fN]=r):t=dx(),e===void 0?t:h_e.f(t,e)},m_e=Wo,y_e=Ta,__e=y_e.RegExp,v_e=m_e(function(){var r=__e(".","s");return!(r.dotAll&&r.exec(`
`)&&r.flags==="s")}),b_e=Wo,x_e=Ta,w_e=x_e.RegExp,B_e=b_e(function(){var r=w_e("(?<a>b)","g");return r.exec("b").groups.a!=="b"||"b".replace(r,"$<a>c")!=="bc"}),gm=Al,fx=Xo,C_e=cA,E_e=lN,S_e=cN,T_e=QS,I_e=jT,L_e=Kb.get,M_e=v_e,P_e=B_e,F_e=T_e("native-string-replace",String.prototype.replace),px=RegExp.prototype.exec,qT=px,D_e=fx("".charAt),R_e=fx("".indexOf),k_e=fx("".replace),$T=fx("".slice),KT=function(){var r=/a/,e=/b*/g;return gm(px,r,"a"),gm(px,e,"a"),r.lastIndex!==0||e.lastIndex!==0}(),mN=S_e.BROKEN_CARET,WT=/()??/.exec("")[1]!==void 0,O_e=KT||WT||mN||M_e||P_e;O_e&&(qT=function(r){var e=this,t=L_e(e),i=C_e(r),n=t.raw,o,a,s,g,y,T,I;if(n)return n.lastIndex=e.lastIndex,o=gm(qT,n,i),e.lastIndex=n.lastIndex,o;var R=t.groups,U=mN&&e.sticky,Z=gm(E_e,e),Y=e.source,he=0,ce=i;if(U&&(Z=k_e(Z,"y",""),R_e(Z,"g")===-1&&(Z+="g"),ce=$T(i,e.lastIndex),e.lastIndex>0&&(!e.multiline||e.multiline&&D_e(i,e.lastIndex-1)!==`
`)&&(Y="(?: "+Y+")",ce=" "+ce,he++),a=new RegExp("^(?:"+Y+")",Z)),WT&&(a=new RegExp("^"+Y+"$(?!\\s)",Z)),KT&&(s=e.lastIndex),g=gm(px,U?a:e,ce),U?g?(g.input=$T(g.input,he),g[0]=$T(g[0],he),g.index=e.lastIndex,e.lastIndex+=g[0].length):e.lastIndex=0:KT&&g&&(e.lastIndex=e.global?g.index+g[0].length:s),WT&&g&&g.length>1&&gm(F_e,g[0],a,function(){for(y=1;y<arguments.length-2;y++)arguments[y]===void 0&&(g[y]=void 0)}),g&&R)for(g.groups=T=I_e(null),y=0;y<R.length;y++)I=R[y],T[I[0]]=g[I[1]];return g});var gx=qT,U_e=vc,yN=gx;U_e({target:"RegExp",proto:!0,forced:/./.exec!==yN},{exec:yN});var _N=k0,vN=Jf,N_e=gx,bN=Wo,xN=Wa,z_e=M0,Q_e=xN("species"),XT=RegExp.prototype,ZT=function(r,e,t,i){var n=xN(r),o=!bN(function(){var y={};return y[n]=function(){return 7},""[r](y)!=7}),a=o&&!bN(function(){var y=!1,T=/a/;return r==="split"&&(T={},T.constructor={},T.constructor[Q_e]=function(){return T},T.flags="",T[n]=/./[n]),T.exec=function(){return y=!0,null},T[n](""),!y});if(!o||!a||t){var s=_N(/./[n]),g=e(n,""[r],function(y,T,I,R,U){var Z=_N(y),Y=T.exec;return Y===N_e||Y===XT.exec?o&&!U?{done:!0,value:s(T,I,R)}:{done:!0,value:Z(I,T,R)}:{done:!1}});vN(String.prototype,r,g[0]),vN(XT,n,g[1])}i&&z_e(XT[n],"sham",!0)},JT=Xo,V_e=Zb,H_e=cA,G_e=oA,j_e=JT("".charAt),wN=JT("".charCodeAt),q_e=JT("".slice),BN=function(r){return function(e,t){var i=H_e(G_e(e)),n=V_e(t),o=i.length,a,s;return n<0||n>=o?r?"":void 0:(a=wN(i,n),a<55296||a>56319||n+1===o||(s=wN(i,n+1))<56320||s>57343?r?j_e(i,n):a:r?q_e(i,n,n+2):(a-55296<<10)+(s-56320)+65536)}},$_e={codeAt:BN(!1),charAt:BN(!0)},K_e=$_e.charAt,YT=function(r,e,t){return e+(t?K_e(r,e).length:1)},CN=Al,W_e=Ql,X_e=To,Z_e=Wf,J_e=gx,Y_e=TypeError,eI=function(r,e){var t=r.exec;if(X_e(t)){var i=CN(t,r,e);return i!==null&&W_e(i),i}if(Z_e(r)==="RegExp")return CN(J_e,r,e);throw Y_e("RegExp#exec called on incompatible receiver")},e1e=Al,t1e=ZT,r1e=Ql,i1e=Xf,n1e=cm,tI=cA,s1e=oA,o1e=om,a1e=YT,EN=eI;t1e("match",function(r,e,t){return[function(i){var n=s1e(this),o=i1e(i)?void 0:o1e(i,r);return o?e1e(o,i,n):new RegExp(i)[r](tI(n))},function(i){var n=r1e(this),o=tI(i),a=t(e,n,o);if(a.done)return a.value;if(!n.global)return EN(n,o);var s=n.unicode;n.lastIndex=0;for(var g=[],y=0,T;(T=EN(n,o))!==null;){var I=tI(T[0]);g[y]=I,I===""&&(n.lastIndex=a1e(o,n1e(n.lastIndex),s)),y++}return y===0?null:g}]});var rI=Xo,l1e=Vb,c1e=Math.floor,iI=rI("".charAt),u1e=rI("".replace),nI=rI("".slice),h1e=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,A1e=/\$([$&'`]|\d{1,2})/g,d1e=function(r,e,t,i,n,o){var a=t+r.length,s=i.length,g=A1e;return n!==void 0&&(n=l1e(n),g=h1e),u1e(o,g,function(y,T){var I;switch(iI(T,0)){case"$":return"$";case"&":return r;case"`":return nI(e,0,t);case"'":return nI(e,a);case"<":I=n[nI(T,1,-1)];break;default:var R=+T;if(R===0)return y;if(R>s){var U=c1e(R/10);return U===0?y:U<=s?i[U-1]===void 0?iI(T,1):i[U-1]+iI(T,1):y}I=i[R-1]}return I===void 0?"":I})},f1e=AT,SN=Al,mx=Xo,p1e=ZT,g1e=Wo,m1e=Ql,y1e=To,_1e=Xf,v1e=Zb,b1e=cm,mm=cA,x1e=oA,w1e=YT,B1e=om,C1e=d1e,E1e=eI,S1e=Wa,sI=S1e("replace"),T1e=Math.max,I1e=Math.min,L1e=mx([].concat),oI=mx([].push),TN=mx("".indexOf),IN=mx("".slice),M1e=function(r){return r===void 0?r:String(r)},P1e=function(){return"a".replace(/./,"$0")==="$0"}(),LN=function(){return/./[sI]?/./[sI]("a","$0")==="":!1}(),F1e=!g1e(function(){var r=/./;return r.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(r,"$<a>")!=="7"});p1e("replace",function(r,e,t){var i=LN?"$":"$0";return[function(n,o){var a=x1e(this),s=_1e(n)?void 0:B1e(n,sI);return s?SN(s,n,a,o):SN(e,mm(a),n,o)},function(n,o){var a=m1e(this),s=mm(n);if(typeof o=="string"&&TN(o,i)===-1&&TN(o,"$<")===-1){var g=t(e,a,s,o);if(g.done)return g.value}var y=y1e(o);y||(o=mm(o));var T=a.global;if(T){var I=a.unicode;a.lastIndex=0}for(var R=[];;){var U=E1e(a,s);if(U===null||(oI(R,U),!T))break;var Z=mm(U[0]);Z===""&&(a.lastIndex=w1e(s,b1e(a.lastIndex),I))}for(var Y="",he=0,ce=0;ce<R.length;ce++){U=R[ce];for(var pe=mm(U[0]),be=T1e(I1e(v1e(U.index),s.length),0),Te=[],qe=1;qe<U.length;qe++)oI(Te,M1e(U[qe]));var je=U.groups;if(y){var We=L1e([pe],Te,be,s);je!==void 0&&oI(We,je);var Ne=mm(f1e(o,void 0,We))}else Ne=C1e(pe,s,be,Te,je,o);be>=he&&(Y+=IN(s,he,be)+Ne,he=be+pe.length)}return Y+IN(s,he)}]},!F1e||!P1e||LN);var D1e=GA,R1e=Wf,k1e=Wa,O1e=k1e("match"),MN=function(r){var e;return D1e(r)&&((e=r[O1e])!==void 0?!!e:R1e(r)=="RegExp")},U1e=MN,N1e=TypeError,aI=function(r){if(U1e(r))throw N1e("The method doesn't accept regular expressions");return r},z1e=Wa,Q1e=z1e("match"),lI=function(r){var e=/./;try{"/./"[r](e)}catch{try{return e[Q1e]=!1,"/./"[r](e)}catch{}}return!1},V1e=vc,PN=k0,H1e=sm.f,G1e=cm,FN=cA,j1e=aI,q1e=oA,$1e=lI,DN=PN("".startsWith),K1e=PN("".slice),W1e=Math.min,RN=$1e("startsWith"),X1e=!RN&&!!function(){var r=H1e(String.prototype,"startsWith");return r&&!r.writable}();V1e({target:"String",proto:!0,forced:!X1e&&!RN},{startsWith:function(r){var e=FN(q1e(this));j1e(r);var t=G1e(W1e(arguments.length>1?arguments[1]:void 0,e.length)),i=FN(r);return DN?DN(e,i,t):K1e(e,t,t+i.length)===i}});var Z1e=Wa,J1e=jT,Y1e=aA.f,cI=Z1e("unscopables"),uI=Array.prototype;uI[cI]==null&&Y1e(uI,cI,{configurable:!0,value:J1e(null)});var eve=function(r){uI[cI][r]=!0},tve=Wo,rve=!tve(function(){function r(){}return r.prototype.constructor=null,Object.getPrototypeOf(new r)!==r.prototype}),ive=wh,nve=To,sve=Vb,ove=YS,ave=rve,kN=ove("IE_PROTO"),hI=Object,lve=hI.prototype,ON=ave?hI.getPrototypeOf:function(r){var e=sve(r);if(ive(e,kN))return e[kN];var t=e.constructor;return nve(t)&&e instanceof t?t.prototype:e instanceof hI?lve:null},cve=Wo,uve=To,hve=GA,UN=ON,Ave=Jf,dve=Wa,AI=dve("iterator"),NN=!1,rp,dI,fI;[].keys&&(fI=[].keys(),"next"in fI?(dI=UN(UN(fI)),dI!==Object.prototype&&(rp=dI)):NN=!0);var fve=!hve(rp)||cve(function(){var r={};return rp[AI].call(r)!==r});fve&&(rp={}),uve(rp[AI])||Ave(rp,AI,function(){return this});var zN={IteratorPrototype:rp,BUGGY_SAFARI_ITERATORS:NN},pve=zN.IteratorPrototype,gve=jT,mve=Ob,yve=cT,_ve=Q0,vve=function(){return this},bve=function(r,e,t,i){var n=e+" Iterator";return r.prototype=gve(pve,{next:mve(+!i,t)}),yve(r,n,!1),_ve[n]=vve,r},xve=vc,wve=Al,QN=jb,Bve=To,Cve=bve,VN=ON,HN=$U,Eve=cT,Sve=M0,pI=Jf,Tve=Wa,Ive=Q0,GN=zN,Lve=QN.PROPER,Mve=QN.CONFIGURABLE,jN=GN.IteratorPrototype,yx=GN.BUGGY_SAFARI_ITERATORS,V0=Tve("iterator"),qN="keys",H0="values",$N="entries",Pve=function(){return this},Fve=function(r,e,t,i,n,o,a){Cve(t,e,i);var s=function(ce){if(ce===n&&R)return R;if(!yx&&ce in T)return T[ce];switch(ce){case qN:return function(){return new t(this,ce)};case H0:return function(){return new t(this,ce)};case $N:return function(){return new t(this,ce)}}return function(){return new t(this)}},g=e+" Iterator",y=!1,T=r.prototype,I=T[V0]||T["@@iterator"]||n&&T[n],R=!yx&&I||s(n),U=e=="Array"&&T.entries||I,Z,Y,he;if(U&&(Z=VN(U.call(new r)),Z!==Object.prototype&&Z.next&&(VN(Z)!==jN&&(HN?HN(Z,jN):Bve(Z[V0])||pI(Z,V0,Pve)),Eve(Z,g,!0))),Lve&&n==H0&&I&&I.name!==H0&&(Mve?Sve(T,"name",H0):(y=!0,R=function(){return wve(I,this)})),n)if(Y={values:s(H0),keys:o?R:s(qN),entries:s($N)},a)for(he in Y)(yx||y||!(he in T))&&pI(T,he,Y[he]);else xve({target:e,proto:!0,forced:yx||y},Y);return T[V0]!==R&&pI(T,V0,R,{name:n}),Ive[e]=R,Y},Dve=function(r,e){return{value:r,done:e}},Rve=L0,gI=eve,KN=Q0,WN=Kb,kve=aA.f,Ove=Fve,_x=Dve,Uve=sA,XN="Array Iterator",Nve=WN.set,zve=WN.getterFor(XN),Qve=Ove(Array,"Array",function(r,e){Nve(this,{type:XN,target:Rve(r),index:0,kind:e})},function(){var r=zve(this),e=r.target,t=r.kind,i=r.index++;return!e||i>=e.length?(r.target=void 0,_x(void 0,!0)):t=="keys"?_x(i,!1):t=="values"?_x(e[i],!1):_x([i,e[i]],!1)},"values"),ZN=KN.Arguments=KN.Array;if(gI("keys"),gI("values"),gI("entries"),Uve&&ZN.name!=="values")try{kve(ZN,"name",{value:"values"})}catch{}var Vve={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Hve=Hb,mI=Hve("span").classList,JN=mI&&mI.constructor&&mI.constructor.prototype,Gve=JN===Object.prototype?void 0:JN,YN=Ta,e8=Vve,jve=Gve,G0=Qve,yI=M0,t8=Wa,_I=t8("iterator"),r8=t8("toStringTag"),vI=G0.values,i8=function(r,e){if(r){if(r[_I]!==vI)try{yI(r,_I,vI)}catch{r[_I]=vI}if(r[r8]||yI(r,r8,e),e8[e]){for(var t in G0)if(r[t]!==G0[t])try{yI(r,t,G0[t])}catch{r[t]=G0[t]}}}};for(var bI in e8)i8(YN[bI]&&YN[bI].prototype,bI);i8(jve,"DOMTokenList");function qve(r,e){if(ts(r)!=="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e||"default");if(ts(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function $ve(r){var e=qve(r,"string");return ts(e)==="symbol"?e:String(e)}function xI(r,e,t){return e=$ve(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var Kve=jA,Wve=Vb,Xve=rU,Zve=Jb,Jve=TypeError,n8=function(r){return function(e,t,i,n){Kve(t);var o=Wve(e),a=Xve(o),s=Zve(o),g=r?s-1:0,y=r?-1:1;if(i<2)for(;;){if(g in a){n=a[g],g+=y;break}if(g+=y,r?g<0:s<=g)throw Jve("Reduce of empty array with no initial value")}for(;r?g>=0:s>g;g+=y)g in a&&(n=t(n,a[g],g,o));return n}},Yve={left:n8(!1),right:n8(!0)},ebe=Wo,s8=function(r,e){var t=[][r];return!!t&&ebe(function(){t.call(null,e||function(){return 1},1)})},tbe=vc,rbe=Yve.left,ibe=s8,o8=RS,nbe=D0,sbe=!nbe&&o8>79&&o8<83,obe=sbe||!ibe("reduce");tbe({target:"Array",proto:!0,forced:obe},{reduce:function(r){var e=arguments.length;return rbe(this,r,e,e>1?arguments[1]:void 0)}});var abe=vc,a8=k0,lbe=sm.f,cbe=cm,l8=cA,ube=aI,hbe=oA,Abe=lI,c8=a8("".endsWith),dbe=a8("".slice),fbe=Math.min,u8=Abe("endsWith"),pbe=!u8&&!!function(){var r=lbe(String.prototype,"endsWith");return r&&!r.writable}();abe({target:"String",proto:!0,forced:!pbe&&!u8},{endsWith:function(r){var e=l8(hbe(this));ube(r);var t=arguments.length>1?arguments[1]:void 0,i=e.length,n=t===void 0?i:fbe(cbe(t),i),o=l8(r);return c8?c8(e,o,n):dbe(e,n-o.length,n)===o}});var gbe=HS,mbe=aA,ybe=Ob,_be=function(r,e,t){var i=gbe(e);i in r?mbe.f(r,i,ybe(0,t)):r[i]=t},h8=NU,vbe=Jb,bbe=_be,xbe=Array,wbe=Math.max,Bbe=function(r,e,t){for(var i=vbe(r),n=h8(e,i),o=h8(t===void 0?i:t,i),a=xbe(wbe(o-n,0)),s=0;n<o;n++,s++)bbe(a,s,r[n]);return a.length=s,a},Cbe=AT,j0=Al,wI=Xo,Ebe=ZT,Sbe=Ql,Tbe=Xf,Ibe=MN,A8=oA,Lbe=i6,Mbe=YT,Pbe=cm,BI=cA,Fbe=om,d8=Bbe,f8=eI,Dbe=gx,Rbe=cN,kbe=Wo,ym=Rbe.UNSUPPORTED_Y,p8=4294967295,Obe=Math.min,g8=[].push,Ube=wI(/./.exec),_m=wI(g8),q0=wI("".slice),Nbe=!kbe(function(){var r=/(?:)/,e=r.exec;r.exec=function(){return e.apply(this,arguments)};var t="ab".split(r);return t.length!==2||t[0]!=="a"||t[1]!=="b"});Ebe("split",function(r,e,t){var i;return"abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?i=function(n,o){var a=BI(A8(this)),s=o===void 0?p8:o>>>0;if(s===0)return[];if(n===void 0)return[a];if(!Ibe(n))return j0(e,a,n,s);for(var g=[],y=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(n.sticky?"y":""),T=0,I=new RegExp(n.source,y+"g"),R,U,Z;(R=j0(Dbe,I,a))&&(U=I.lastIndex,!(U>T&&(_m(g,q0(a,T,R.index)),R.length>1&&R.index<a.length&&Cbe(g8,g,d8(R,1)),Z=R[0].length,T=U,g.length>=s)));)I.lastIndex===R.index&&I.lastIndex++;return T===a.length?(Z||!Ube(I,""))&&_m(g,""):_m(g,q0(a,T)),g.length>s?d8(g,0,s):g}:"0".split(void 0,0).length?i=function(n,o){return n===void 0&&o===0?[]:j0(e,this,n,o)}:i=e,[function(n,o){var a=A8(this),s=Tbe(n)?void 0:Fbe(n,r);return s?j0(s,n,a,o):j0(i,BI(a),n,o)},function(n,o){var a=Sbe(this),s=BI(n),g=t(i,a,s,o,i!==e);if(g.done)return g.value;var y=Lbe(a,RegExp),T=a.unicode,I=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(ym?"g":"y"),R=new y(ym?"^(?:"+a.source+")":a,I),U=o===void 0?p8:o>>>0;if(U===0)return[];if(s.length===0)return f8(R,s)===null?[s]:[];for(var Z=0,Y=0,he=[];Y<s.length;){R.lastIndex=ym?0:Y;var ce=f8(R,ym?q0(s,Y):s),pe;if(ce===null||(pe=Obe(Pbe(R.lastIndex+(ym?Y:0)),s.length))===Z)Y=Mbe(s,Y,T);else{if(_m(he,q0(s,Z,Y)),he.length===U)return he;for(var be=1;be<=ce.length-1;be++)if(_m(he,ce[be]),he.length===U)return he;Y=Z=pe}}return _m(he,q0(s,Z)),he}]},!Nbe,ym);var vx={exports:{}},$0={exports:{}};(function(){var r,e,t,i,n,o;typeof performance<"u"&&performance!==null&&performance.now?$0.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?($0.exports=function(){return(r()-n)/1e6},e=process.hrtime,r=function(){var a;return a=e(),a[0]*1e9+a[1]},i=r(),o=process.uptime()*1e9,n=i-o):Date.now?($0.exports=function(){return Date.now()-t},t=Date.now()):($0.exports=function(){return new Date().getTime()-t},t=new Date().getTime())}).call(I0);for(var zbe=$0.exports,Qbe=zbe,$A=typeof window>"u"?I0:window,bx=["moz","webkit"],vm="AnimationFrame",bm=$A["request"+vm],K0=$A["cancel"+vm]||$A["cancelRequest"+vm],W0=0;!bm&&W0<bx.length;W0++)bm=$A[bx[W0]+"Request"+vm],K0=$A[bx[W0]+"Cancel"+vm]||$A[bx[W0]+"CancelRequest"+vm];if(!bm||!K0){var CI=0,m8=0,ip=[],Vbe=1e3/60;bm=function(r){if(ip.length===0){var e=Qbe(),t=Math.max(0,Vbe-(e-CI));CI=t+e,setTimeout(function(){var i=ip.slice(0);ip.length=0;for(var n=0;n<i.length;n++)if(!i[n].cancelled)try{i[n].callback(CI)}catch(o){setTimeout(function(){throw o},0)}},Math.round(t))}return ip.push({handle:++m8,callback:r,cancelled:!1}),m8},K0=function(r){for(var e=0;e<ip.length;e++)ip[e].handle===r&&(ip[e].cancelled=!0)}}vx.exports=function(r){return bm.call($A,r)},vx.exports.cancel=function(){K0.apply($A,arguments)},vx.exports.polyfill=function(r){r||(r=$A),r.requestAnimationFrame=bm,r.cancelAnimationFrame=K0};var Hbe=vx.exports;const EI=WO(Hbe);var y8=`	
\v\f\r \u2028\u2029\uFEFF`,Gbe=Xo,jbe=oA,qbe=cA,SI=y8,_8=Gbe("".replace),$be=RegExp("^["+SI+"]+"),Kbe=RegExp("(^|[^"+SI+"])["+SI+"]+$"),TI=function(r){return function(e){var t=qbe(jbe(e));return r&1&&(t=_8(t,$be,"")),r&2&&(t=_8(t,Kbe,"$1")),t}},Wbe={start:TI(1),end:TI(2),trim:TI(3)},Xbe=jb.PROPER,Zbe=Wo,v8=y8,b8="",Jbe=function(r){return Zbe(function(){return!!v8[r]()||b8[r]()!==b8||Xbe&&v8[r].name!==r})},Ybe=vc,exe=Wbe.trim,txe=Jbe;Ybe({target:"String",proto:!0,forced:txe("trim")},{trim:function(){return exe(this)}});var rxe=function(r){this.ok=!1,this.alpha=1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r=r.replace(/ /g,""),r=r.toLowerCase();var e={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};r=e[r]||r;for(var t=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(g){return[parseInt(g[1]),parseInt(g[2]),parseInt(g[3]),parseFloat(g[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(g){return[parseInt(g[1]),parseInt(g[2]),parseInt(g[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(g){return[parseInt(g[1],16),parseInt(g[2],16),parseInt(g[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(g){return[parseInt(g[1]+g[1],16),parseInt(g[2]+g[2],16),parseInt(g[3]+g[3],16)]}}],i=0;i<t.length;i++){var n=t[i].re,o=t[i].process,a=n.exec(r);if(a){var s=o(a);this.r=s[0],this.g=s[1],this.b=s[2],s.length>3&&(this.alpha=s[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var g=this.r.toString(16),y=this.g.toString(16),T=this.b.toString(16);return g.length==1&&(g="0"+g),y.length==1&&(y="0"+y),T.length==1&&(T="0"+T),"#"+g+y+T},this.getHelpXML=function(){for(var g=new Array,y=0;y<t.length;y++)for(var T=t[y].example,I=0;I<T.length;I++)g[g.length]=T[I];for(var R in e)g[g.length]=R;var U=document.createElement("ul");U.setAttribute("id","rgbcolor-examples");for(var y=0;y<g.length;y++)try{var Z=document.createElement("li"),Y=new RGBColor(g[y]),he=document.createElement("div");he.style.cssText="margin: 3px; border: 1px solid black; background:"+Y.toHex()+"; color:"+Y.toHex(),he.appendChild(document.createTextNode("test"));var ce=document.createTextNode(" "+g[y]+" -> "+Y.toRGB()+" -> "+Y.toHex());Z.appendChild(he),Z.appendChild(ce),U.appendChild(Z)}catch{}return U}};const II=WO(rxe);var ixe=vc,nxe=k0,sxe=QU.indexOf,oxe=s8,LI=nxe([].indexOf),x8=!!LI&&1/LI([1],1,-0)<0,axe=x8||!oxe("indexOf");ixe({target:"Array",proto:!0,forced:axe},{indexOf:function(r){var e=arguments.length>1?arguments[1]:void 0;return x8?LI(this,r,e)||0:sxe(this,r,e)}});var lxe=vc,cxe=Xo,uxe=aI,hxe=oA,w8=cA,Axe=lI,dxe=cxe("".indexOf);lxe({target:"String",proto:!0,forced:!Axe("includes")},{includes:function(r){return!!~dxe(w8(hxe(this)),w8(uxe(r)),arguments.length>1?arguments[1]:void 0)}});var fxe=Wf,pxe=Array.isArray||function(r){return fxe(r)=="Array"},gxe=vc,mxe=Xo,yxe=pxe,_xe=mxe([].reverse),B8=[1,2];gxe({target:"Array",proto:!0,forced:String(B8)===String(B8.reverse())},{reverse:function(){return yxe(this)&&(this.length=this.length),_xe(this)}});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var C8=function(r,e){return(C8=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])})(r,e)};function E8(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=r}C8(r,e),r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function vxe(r){var e="";Array.isArray(r)||(r=[r]);for(var t=0;t<r.length;t++){var i=r[t];if(i.type===wr.CLOSE_PATH)e+="z";else if(i.type===wr.HORIZ_LINE_TO)e+=(i.relative?"h":"H")+i.x;else if(i.type===wr.VERT_LINE_TO)e+=(i.relative?"v":"V")+i.y;else if(i.type===wr.MOVE_TO)e+=(i.relative?"m":"M")+i.x+" "+i.y;else if(i.type===wr.LINE_TO)e+=(i.relative?"l":"L")+i.x+" "+i.y;else if(i.type===wr.CURVE_TO)e+=(i.relative?"c":"C")+i.x1+" "+i.y1+" "+i.x2+" "+i.y2+" "+i.x+" "+i.y;else if(i.type===wr.SMOOTH_CURVE_TO)e+=(i.relative?"s":"S")+i.x2+" "+i.y2+" "+i.x+" "+i.y;else if(i.type===wr.QUAD_TO)e+=(i.relative?"q":"Q")+i.x1+" "+i.y1+" "+i.x+" "+i.y;else if(i.type===wr.SMOOTH_QUAD_TO)e+=(i.relative?"t":"T")+i.x+" "+i.y;else{if(i.type!==wr.ARC)throw new Error('Unexpected command type "'+i.type+'" at index '+t+".");e+=(i.relative?"a":"A")+i.rX+" "+i.rY+" "+i.xRot+" "+ +i.lArcFlag+" "+ +i.sweepFlag+" "+i.x+" "+i.y}}return e}function MI(r,e){var t=r[0],i=r[1];return[t*Math.cos(e)-i*Math.sin(e),t*Math.sin(e)+i*Math.cos(e)]}function Bh(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];for(var t=0;t<r.length;t++)if(typeof r[t]!="number")throw new Error("assertNumbers arguments["+t+"] is not a number. "+typeof r[t]+" == typeof "+r[t]);return!0}var Qd=Math.PI;function PI(r,e,t){r.lArcFlag=r.lArcFlag===0?0:1,r.sweepFlag=r.sweepFlag===0?0:1;var i=r.rX,n=r.rY,o=r.x,a=r.y;i=Math.abs(r.rX),n=Math.abs(r.rY);var s=MI([(e-o)/2,(t-a)/2],-r.xRot/180*Qd),g=s[0],y=s[1],T=Math.pow(g,2)/Math.pow(i,2)+Math.pow(y,2)/Math.pow(n,2);1<T&&(i*=Math.sqrt(T),n*=Math.sqrt(T)),r.rX=i,r.rY=n;var I=Math.pow(i,2)*Math.pow(y,2)+Math.pow(n,2)*Math.pow(g,2),R=(r.lArcFlag!==r.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(i,2)*Math.pow(n,2)-I)/I)),U=i*y/n*R,Z=-n*g/i*R,Y=MI([U,Z],r.xRot/180*Qd);r.cX=Y[0]+(e+o)/2,r.cY=Y[1]+(t+a)/2,r.phi1=Math.atan2((y-Z)/n,(g-U)/i),r.phi2=Math.atan2((-y-Z)/n,(-g-U)/i),r.sweepFlag===0&&r.phi2>r.phi1&&(r.phi2-=2*Qd),r.sweepFlag===1&&r.phi2<r.phi1&&(r.phi2+=2*Qd),r.phi1*=180/Qd,r.phi2*=180/Qd}function S8(r,e,t){Bh(r,e,t);var i=r*r+e*e-t*t;if(0>i)return[];if(i===0)return[[r*t/(r*r+e*e),e*t/(r*r+e*e)]];var n=Math.sqrt(i);return[[(r*t+e*n)/(r*r+e*e),(e*t-r*n)/(r*r+e*e)],[(r*t-e*n)/(r*r+e*e),(e*t+r*n)/(r*r+e*e)]]}var ua,KA=Math.PI/180;function T8(r,e,t){return(1-t)*r+t*e}function I8(r,e,t,i){return r+Math.cos(i/180*Qd)*e+Math.sin(i/180*Qd)*t}function L8(r,e,t,i){var n=1e-6,o=e-r,a=t-e,s=3*o+3*(i-t)-6*a,g=6*(a-o),y=3*o;return Math.abs(s)<n?[-y/g]:function(T,I,R){R===void 0&&(R=1e-6);var U=T*T/4-I;if(U<-R)return[];if(U<=R)return[-T/2];var Z=Math.sqrt(U);return[-T/2-Z,-T/2+Z]}(g/s,y/s,n)}function M8(r,e,t,i,n){var o=1-n;return r*(o*o*o)+e*(3*o*o*n)+t*(3*o*n*n)+i*(n*n*n)}(function(r){function e(){return n(function(s,g,y){return s.relative&&(s.x1!==void 0&&(s.x1+=g),s.y1!==void 0&&(s.y1+=y),s.x2!==void 0&&(s.x2+=g),s.y2!==void 0&&(s.y2+=y),s.x!==void 0&&(s.x+=g),s.y!==void 0&&(s.y+=y),s.relative=!1),s})}function t(){var s=NaN,g=NaN,y=NaN,T=NaN;return n(function(I,R,U){return I.type&wr.SMOOTH_CURVE_TO&&(I.type=wr.CURVE_TO,s=isNaN(s)?R:s,g=isNaN(g)?U:g,I.x1=I.relative?R-s:2*R-s,I.y1=I.relative?U-g:2*U-g),I.type&wr.CURVE_TO?(s=I.relative?R+I.x2:I.x2,g=I.relative?U+I.y2:I.y2):(s=NaN,g=NaN),I.type&wr.SMOOTH_QUAD_TO&&(I.type=wr.QUAD_TO,y=isNaN(y)?R:y,T=isNaN(T)?U:T,I.x1=I.relative?R-y:2*R-y,I.y1=I.relative?U-T:2*U-T),I.type&wr.QUAD_TO?(y=I.relative?R+I.x1:I.x1,T=I.relative?U+I.y1:I.y1):(y=NaN,T=NaN),I})}function i(){var s=NaN,g=NaN;return n(function(y,T,I){if(y.type&wr.SMOOTH_QUAD_TO&&(y.type=wr.QUAD_TO,s=isNaN(s)?T:s,g=isNaN(g)?I:g,y.x1=y.relative?T-s:2*T-s,y.y1=y.relative?I-g:2*I-g),y.type&wr.QUAD_TO){s=y.relative?T+y.x1:y.x1,g=y.relative?I+y.y1:y.y1;var R=y.x1,U=y.y1;y.type=wr.CURVE_TO,y.x1=((y.relative?0:T)+2*R)/3,y.y1=((y.relative?0:I)+2*U)/3,y.x2=(y.x+2*R)/3,y.y2=(y.y+2*U)/3}else s=NaN,g=NaN;return y})}function n(s){var g=0,y=0,T=NaN,I=NaN;return function(R){if(isNaN(T)&&!(R.type&wr.MOVE_TO))throw new Error("path must start with moveto");var U=s(R,g,y,T,I);return R.type&wr.CLOSE_PATH&&(g=T,y=I),R.x!==void 0&&(g=R.relative?g+R.x:R.x),R.y!==void 0&&(y=R.relative?y+R.y:R.y),R.type&wr.MOVE_TO&&(T=g,I=y),U}}function o(s,g,y,T,I,R){return Bh(s,g,y,T,I,R),n(function(U,Z,Y,he){var ce=U.x1,pe=U.x2,be=U.relative&&!isNaN(he),Te=U.x!==void 0?U.x:be?0:Z,qe=U.y!==void 0?U.y:be?0:Y;function je(Le){return Le*Le}U.type&wr.HORIZ_LINE_TO&&g!==0&&(U.type=wr.LINE_TO,U.y=U.relative?0:Y),U.type&wr.VERT_LINE_TO&&y!==0&&(U.type=wr.LINE_TO,U.x=U.relative?0:Z),U.x!==void 0&&(U.x=U.x*s+qe*y+(be?0:I)),U.y!==void 0&&(U.y=Te*g+U.y*T+(be?0:R)),U.x1!==void 0&&(U.x1=U.x1*s+U.y1*y+(be?0:I)),U.y1!==void 0&&(U.y1=ce*g+U.y1*T+(be?0:R)),U.x2!==void 0&&(U.x2=U.x2*s+U.y2*y+(be?0:I)),U.y2!==void 0&&(U.y2=pe*g+U.y2*T+(be?0:R));var We=s*T-g*y;if(U.xRot!==void 0&&(s!==1||g!==0||y!==0||T!==1))if(We===0)delete U.rX,delete U.rY,delete U.xRot,delete U.lArcFlag,delete U.sweepFlag,U.type=wr.LINE_TO;else{var Ne=U.xRot*Math.PI/180,at=Math.sin(Ne),nt=Math.cos(Ne),ke=1/je(U.rX),De=1/je(U.rY),Ye=je(nt)*ke+je(at)*De,Xe=2*at*nt*(ke-De),Ct=je(at)*ke+je(nt)*De,Et=Ye*T*T-Xe*g*T+Ct*g*g,Pt=Xe*(s*T+g*y)-2*(Ye*y*T+Ct*s*g),bt=Ye*y*y-Xe*s*y+Ct*s*s,Rt=(Math.atan2(Pt,Et-bt)+Math.PI)%Math.PI/2,Ft=Math.sin(Rt),Zt=Math.cos(Rt);U.rX=Math.abs(We)/Math.sqrt(Et*je(Zt)+Pt*Ft*Zt+bt*je(Ft)),U.rY=Math.abs(We)/Math.sqrt(Et*je(Ft)-Pt*Ft*Zt+bt*je(Zt)),U.xRot=180*Rt/Math.PI}return U.sweepFlag!==void 0&&0>We&&(U.sweepFlag=+!U.sweepFlag),U})}function a(){return function(s){var g={};for(var y in s)g[y]=s[y];return g}}r.ROUND=function(s){function g(y){return Math.round(y*s)/s}return s===void 0&&(s=1e13),Bh(s),function(y){return y.x1!==void 0&&(y.x1=g(y.x1)),y.y1!==void 0&&(y.y1=g(y.y1)),y.x2!==void 0&&(y.x2=g(y.x2)),y.y2!==void 0&&(y.y2=g(y.y2)),y.x!==void 0&&(y.x=g(y.x)),y.y!==void 0&&(y.y=g(y.y)),y.rX!==void 0&&(y.rX=g(y.rX)),y.rY!==void 0&&(y.rY=g(y.rY)),y}},r.TO_ABS=e,r.TO_REL=function(){return n(function(s,g,y){return s.relative||(s.x1!==void 0&&(s.x1-=g),s.y1!==void 0&&(s.y1-=y),s.x2!==void 0&&(s.x2-=g),s.y2!==void 0&&(s.y2-=y),s.x!==void 0&&(s.x-=g),s.y!==void 0&&(s.y-=y),s.relative=!0),s})},r.NORMALIZE_HVZ=function(s,g,y){return s===void 0&&(s=!0),g===void 0&&(g=!0),y===void 0&&(y=!0),n(function(T,I,R,U,Z){if(isNaN(U)&&!(T.type&wr.MOVE_TO))throw new Error("path must start with moveto");return g&&T.type&wr.HORIZ_LINE_TO&&(T.type=wr.LINE_TO,T.y=T.relative?0:R),y&&T.type&wr.VERT_LINE_TO&&(T.type=wr.LINE_TO,T.x=T.relative?0:I),s&&T.type&wr.CLOSE_PATH&&(T.type=wr.LINE_TO,T.x=T.relative?U-I:U,T.y=T.relative?Z-R:Z),T.type&wr.ARC&&(T.rX===0||T.rY===0)&&(T.type=wr.LINE_TO,delete T.rX,delete T.rY,delete T.xRot,delete T.lArcFlag,delete T.sweepFlag),T})},r.NORMALIZE_ST=t,r.QT_TO_C=i,r.INFO=n,r.SANITIZE=function(s){s===void 0&&(s=0),Bh(s);var g=NaN,y=NaN,T=NaN,I=NaN;return n(function(R,U,Z,Y,he){var ce=Math.abs,pe=!1,be=0,Te=0;if(R.type&wr.SMOOTH_CURVE_TO&&(be=isNaN(g)?0:U-g,Te=isNaN(y)?0:Z-y),R.type&(wr.CURVE_TO|wr.SMOOTH_CURVE_TO)?(g=R.relative?U+R.x2:R.x2,y=R.relative?Z+R.y2:R.y2):(g=NaN,y=NaN),R.type&wr.SMOOTH_QUAD_TO?(T=isNaN(T)?U:2*U-T,I=isNaN(I)?Z:2*Z-I):R.type&wr.QUAD_TO?(T=R.relative?U+R.x1:R.x1,I=R.relative?Z+R.y1:R.y2):(T=NaN,I=NaN),R.type&wr.LINE_COMMANDS||R.type&wr.ARC&&(R.rX===0||R.rY===0||!R.lArcFlag)||R.type&wr.CURVE_TO||R.type&wr.SMOOTH_CURVE_TO||R.type&wr.QUAD_TO||R.type&wr.SMOOTH_QUAD_TO){var qe=R.x===void 0?0:R.relative?R.x:R.x-U,je=R.y===void 0?0:R.relative?R.y:R.y-Z;be=isNaN(T)?R.x1===void 0?be:R.relative?R.x:R.x1-U:T-U,Te=isNaN(I)?R.y1===void 0?Te:R.relative?R.y:R.y1-Z:I-Z;var We=R.x2===void 0?0:R.relative?R.x:R.x2-U,Ne=R.y2===void 0?0:R.relative?R.y:R.y2-Z;ce(qe)<=s&&ce(je)<=s&&ce(be)<=s&&ce(Te)<=s&&ce(We)<=s&&ce(Ne)<=s&&(pe=!0)}return R.type&wr.CLOSE_PATH&&ce(U-Y)<=s&&ce(Z-he)<=s&&(pe=!0),pe?[]:R})},r.MATRIX=o,r.ROTATE=function(s,g,y){g===void 0&&(g=0),y===void 0&&(y=0),Bh(s,g,y);var T=Math.sin(s),I=Math.cos(s);return o(I,T,-T,I,g-g*I+y*T,y-g*T-y*I)},r.TRANSLATE=function(s,g){return g===void 0&&(g=0),Bh(s,g),o(1,0,0,1,s,g)},r.SCALE=function(s,g){return g===void 0&&(g=s),Bh(s,g),o(s,0,0,g,0,0)},r.SKEW_X=function(s){return Bh(s),o(1,0,Math.atan(s),1,0,0)},r.SKEW_Y=function(s){return Bh(s),o(1,Math.atan(s),0,1,0,0)},r.X_AXIS_SYMMETRY=function(s){return s===void 0&&(s=0),Bh(s),o(-1,0,0,1,s,0)},r.Y_AXIS_SYMMETRY=function(s){return s===void 0&&(s=0),Bh(s),o(1,0,0,-1,0,s)},r.A_TO_C=function(){return n(function(s,g,y){return wr.ARC===s.type?function(T,I,R){var U,Z,Y,he;T.cX||PI(T,I,R);for(var ce=Math.min(T.phi1,T.phi2),pe=Math.max(T.phi1,T.phi2)-ce,be=Math.ceil(pe/90),Te=new Array(be),qe=I,je=R,We=0;We<be;We++){var Ne=T8(T.phi1,T.phi2,We/be),at=T8(T.phi1,T.phi2,(We+1)/be),nt=at-Ne,ke=4/3*Math.tan(nt*KA/4),De=[Math.cos(Ne*KA)-ke*Math.sin(Ne*KA),Math.sin(Ne*KA)+ke*Math.cos(Ne*KA)],Ye=De[0],Xe=De[1],Ct=[Math.cos(at*KA),Math.sin(at*KA)],Et=Ct[0],Pt=Ct[1],bt=[Et+ke*Math.sin(at*KA),Pt-ke*Math.cos(at*KA)],Rt=bt[0],Ft=bt[1];Te[We]={relative:T.relative,type:wr.CURVE_TO};var Zt=function(Le,Ze){var rt=MI([Le*T.rX,Ze*T.rY],T.xRot),pt=rt[0],mt=rt[1];return[T.cX+pt,T.cY+mt]};U=Zt(Ye,Xe),Te[We].x1=U[0],Te[We].y1=U[1],Z=Zt(Rt,Ft),Te[We].x2=Z[0],Te[We].y2=Z[1],Y=Zt(Et,Pt),Te[We].x=Y[0],Te[We].y=Y[1],T.relative&&(Te[We].x1-=qe,Te[We].y1-=je,Te[We].x2-=qe,Te[We].y2-=je,Te[We].x-=qe,Te[We].y-=je),qe=(he=[Te[We].x,Te[We].y])[0],je=he[1]}return Te}(s,s.relative?0:g,s.relative?0:y):s})},r.ANNOTATE_ARCS=function(){return n(function(s,g,y){return s.relative&&(g=0,y=0),wr.ARC===s.type&&PI(s,g,y),s})},r.CLONE=a,r.CALCULATE_BOUNDS=function(){var s=function(R){var U={};for(var Z in R)U[Z]=R[Z];return U},g=e(),y=i(),T=t(),I=n(function(R,U,Z){var Y=T(y(g(s(R))));function he(Ft){Ft>I.maxX&&(I.maxX=Ft),Ft<I.minX&&(I.minX=Ft)}function ce(Ft){Ft>I.maxY&&(I.maxY=Ft),Ft<I.minY&&(I.minY=Ft)}if(Y.type&wr.DRAWING_COMMANDS&&(he(U),ce(Z)),Y.type&wr.HORIZ_LINE_TO&&he(Y.x),Y.type&wr.VERT_LINE_TO&&ce(Y.y),Y.type&wr.LINE_TO&&(he(Y.x),ce(Y.y)),Y.type&wr.CURVE_TO){he(Y.x),ce(Y.y);for(var pe=0,be=L8(U,Y.x1,Y.x2,Y.x);pe<be.length;pe++)0<(Rt=be[pe])&&1>Rt&&he(M8(U,Y.x1,Y.x2,Y.x,Rt));for(var Te=0,qe=L8(Z,Y.y1,Y.y2,Y.y);Te<qe.length;Te++)0<(Rt=qe[Te])&&1>Rt&&ce(M8(Z,Y.y1,Y.y2,Y.y,Rt))}if(Y.type&wr.ARC){he(Y.x),ce(Y.y),PI(Y,U,Z);for(var je=Y.xRot/180*Math.PI,We=Math.cos(je)*Y.rX,Ne=Math.sin(je)*Y.rX,at=-Math.sin(je)*Y.rY,nt=Math.cos(je)*Y.rY,ke=Y.phi1<Y.phi2?[Y.phi1,Y.phi2]:-180>Y.phi2?[Y.phi2+360,Y.phi1+360]:[Y.phi2,Y.phi1],De=ke[0],Ye=ke[1],Xe=function(Ft){var Zt=Ft[0],Le=Ft[1],Ze=180*Math.atan2(Le,Zt)/Math.PI;return Ze<De?Ze+360:Ze},Ct=0,Et=S8(at,-We,0).map(Xe);Ct<Et.length;Ct++)(Rt=Et[Ct])>De&&Rt<Ye&&he(I8(Y.cX,We,at,Rt));for(var Pt=0,bt=S8(nt,-Ne,0).map(Xe);Pt<bt.length;Pt++){var Rt;(Rt=bt[Pt])>De&&Rt<Ye&&ce(I8(Y.cY,Ne,nt,Rt))}}return R});return I.minX=1/0,I.maxX=-1/0,I.minY=1/0,I.maxY=-1/0,I}})(ua||(ua={}));var Ch,P8=function(){function r(){}return r.prototype.round=function(e){return this.transform(ua.ROUND(e))},r.prototype.toAbs=function(){return this.transform(ua.TO_ABS())},r.prototype.toRel=function(){return this.transform(ua.TO_REL())},r.prototype.normalizeHVZ=function(e,t,i){return this.transform(ua.NORMALIZE_HVZ(e,t,i))},r.prototype.normalizeST=function(){return this.transform(ua.NORMALIZE_ST())},r.prototype.qtToC=function(){return this.transform(ua.QT_TO_C())},r.prototype.aToC=function(){return this.transform(ua.A_TO_C())},r.prototype.sanitize=function(e){return this.transform(ua.SANITIZE(e))},r.prototype.translate=function(e,t){return this.transform(ua.TRANSLATE(e,t))},r.prototype.scale=function(e,t){return this.transform(ua.SCALE(e,t))},r.prototype.rotate=function(e,t,i){return this.transform(ua.ROTATE(e,t,i))},r.prototype.matrix=function(e,t,i,n,o,a){return this.transform(ua.MATRIX(e,t,i,n,o,a))},r.prototype.skewX=function(e){return this.transform(ua.SKEW_X(e))},r.prototype.skewY=function(e){return this.transform(ua.SKEW_Y(e))},r.prototype.xSymmetry=function(e){return this.transform(ua.X_AXIS_SYMMETRY(e))},r.prototype.ySymmetry=function(e){return this.transform(ua.Y_AXIS_SYMMETRY(e))},r.prototype.annotateArcs=function(){return this.transform(ua.ANNOTATE_ARCS())},r}(),bxe=function(r){return r===" "||r==="	"||r==="\r"||r===`
`},F8=function(r){return 48<=r.charCodeAt(0)&&r.charCodeAt(0)<=57},xxe=function(r){function e(){var t=r.call(this)||this;return t.curNumber="",t.curCommandType=-1,t.curCommandRelative=!1,t.canParseCommandOrComma=!0,t.curNumberHasExp=!1,t.curNumberHasExpDigits=!1,t.curNumberHasDecimal=!1,t.curArgs=[],t}return E8(e,r),e.prototype.finish=function(t){if(t===void 0&&(t=[]),this.parse(" ",t),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return t},e.prototype.parse=function(t,i){var n=this;i===void 0&&(i=[]);for(var o=function(I){i.push(I),n.curArgs.length=0,n.canParseCommandOrComma=!0},a=0;a<t.length;a++){var s=t[a],g=!(this.curCommandType!==wr.ARC||this.curArgs.length!==3&&this.curArgs.length!==4||this.curNumber.length!==1||this.curNumber!=="0"&&this.curNumber!=="1"),y=F8(s)&&(this.curNumber==="0"&&s==="0"||g);if(!F8(s)||y)if(s!=="e"&&s!=="E")if(s!=="-"&&s!=="+"||!this.curNumberHasExp||this.curNumberHasExpDigits)if(s!=="."||this.curNumberHasExp||this.curNumberHasDecimal||g){if(this.curNumber&&this.curCommandType!==-1){var T=Number(this.curNumber);if(isNaN(T))throw new SyntaxError("Invalid number ending at "+a);if(this.curCommandType===wr.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>T)throw new SyntaxError('Expected positive number, got "'+T+'" at index "'+a+'"')}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+a+'"')}this.curArgs.push(T),this.curArgs.length===wxe[this.curCommandType]&&(wr.HORIZ_LINE_TO===this.curCommandType?o({type:wr.HORIZ_LINE_TO,relative:this.curCommandRelative,x:T}):wr.VERT_LINE_TO===this.curCommandType?o({type:wr.VERT_LINE_TO,relative:this.curCommandRelative,y:T}):this.curCommandType===wr.MOVE_TO||this.curCommandType===wr.LINE_TO||this.curCommandType===wr.SMOOTH_QUAD_TO?(o({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),wr.MOVE_TO===this.curCommandType&&(this.curCommandType=wr.LINE_TO)):this.curCommandType===wr.CURVE_TO?o({type:wr.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===wr.SMOOTH_CURVE_TO?o({type:wr.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===wr.QUAD_TO?o({type:wr.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===wr.ARC&&o({type:wr.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!bxe(s))if(s===","&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if(s!=="+"&&s!=="-"&&s!==".")if(y)this.curNumber=s,this.curNumberHasDecimal=!1;else{if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index "+a+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+s+'" at index '+a+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,s!=="z"&&s!=="Z")if(s==="h"||s==="H")this.curCommandType=wr.HORIZ_LINE_TO,this.curCommandRelative=s==="h";else if(s==="v"||s==="V")this.curCommandType=wr.VERT_LINE_TO,this.curCommandRelative=s==="v";else if(s==="m"||s==="M")this.curCommandType=wr.MOVE_TO,this.curCommandRelative=s==="m";else if(s==="l"||s==="L")this.curCommandType=wr.LINE_TO,this.curCommandRelative=s==="l";else if(s==="c"||s==="C")this.curCommandType=wr.CURVE_TO,this.curCommandRelative=s==="c";else if(s==="s"||s==="S")this.curCommandType=wr.SMOOTH_CURVE_TO,this.curCommandRelative=s==="s";else if(s==="q"||s==="Q")this.curCommandType=wr.QUAD_TO,this.curCommandRelative=s==="q";else if(s==="t"||s==="T")this.curCommandType=wr.SMOOTH_QUAD_TO,this.curCommandRelative=s==="t";else{if(s!=="a"&&s!=="A")throw new SyntaxError('Unexpected character "'+s+'" at index '+a+".");this.curCommandType=wr.ARC,this.curCommandRelative=s==="a"}else i.push({type:wr.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=s,this.curNumberHasDecimal=s==="."}else this.curNumber+=s,this.curNumberHasDecimal=!0;else this.curNumber+=s;else this.curNumber+=s,this.curNumberHasExp=!0;else this.curNumber+=s,this.curNumberHasExpDigits=this.curNumberHasExp}return i},e.prototype.transform=function(t){return Object.create(this,{parse:{value:function(i,n){n===void 0&&(n=[]);for(var o=0,a=Object.getPrototypeOf(this).parse.call(this,i);o<a.length;o++){var s=a[o],g=t(s);Array.isArray(g)?n.push.apply(n,g):n.push(g)}return n}}})},e}(P8),wr=function(r){function e(t){var i=r.call(this)||this;return i.commands=typeof t=="string"?e.parse(t):t,i}return E8(e,r),e.prototype.encode=function(){return e.encode(this.commands)},e.prototype.getBounds=function(){var t=ua.CALCULATE_BOUNDS();return this.transform(t),t},e.prototype.transform=function(t){for(var i=[],n=0,o=this.commands;n<o.length;n++){var a=t(o[n]);Array.isArray(a)?i.push.apply(i,a):i.push(a)}return this.commands=i,this},e.encode=function(t){return vxe(t)},e.parse=function(t){var i=new xxe,n=[];return i.parse(t,n),i.finish(n),n},e.CLOSE_PATH=1,e.MOVE_TO=2,e.HORIZ_LINE_TO=4,e.VERT_LINE_TO=8,e.LINE_TO=16,e.CURVE_TO=32,e.SMOOTH_CURVE_TO=64,e.QUAD_TO=128,e.SMOOTH_QUAD_TO=256,e.ARC=512,e.LINE_COMMANDS=e.LINE_TO|e.HORIZ_LINE_TO|e.VERT_LINE_TO,e.DRAWING_COMMANDS=e.HORIZ_LINE_TO|e.VERT_LINE_TO|e.LINE_TO|e.CURVE_TO|e.SMOOTH_CURVE_TO|e.QUAD_TO|e.SMOOTH_QUAD_TO|e.ARC,e}(P8),wxe=((Ch={})[wr.MOVE_TO]=2,Ch[wr.LINE_TO]=2,Ch[wr.HORIZ_LINE_TO]=1,Ch[wr.VERT_LINE_TO]=1,Ch[wr.CLOSE_PATH]=0,Ch[wr.QUAD_TO]=4,Ch[wr.SMOOTH_QUAD_TO]=2,Ch[wr.CURVE_TO]=6,Ch[wr.SMOOTH_CURVE_TO]=4,Ch[wr.ARC]=7,Ch),Bxe=Al,Cxe=wh,Exe=Ub,Sxe=lN,D8=RegExp.prototype,Txe=function(r){var e=r.flags;return e===void 0&&!("flags"in D8)&&!Cxe(r,"flags")&&Exe(D8,r)?Bxe(Sxe,r):e},Ixe=jb.PROPER,Lxe=Jf,Mxe=Ql,R8=cA,Pxe=Wo,Fxe=Txe,FI="toString",Dxe=RegExp.prototype,k8=Dxe[FI],Rxe=Pxe(function(){return k8.call({source:"a",flags:"b"})!="/a/b"}),kxe=Ixe&&k8.name!=FI;(Rxe||kxe)&&Lxe(RegExp.prototype,FI,function(){var r=Mxe(this),e=R8(r.source),t=R8(Fxe(r));return"/"+e+"/"+t},{unsafe:!0});function xx(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?xx=function(e){return typeof e}:xx=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xx(r)}function Oxe(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}var Uxe=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],Nxe=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function zxe(r,e,t,i,n){if(typeof r=="string"&&(r=document.getElementById(r)),!r||xx(r)!=="object"||!("getContext"in r))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var o=r.getContext("2d");try{return o.getImageData(e,t,i,n)}catch(a){throw new Error("unable to access image data: "+a)}}function Qxe(r,e,t,i,n,o){if(!(isNaN(o)||o<1)){o|=0;var a=zxe(r,e,t,i,n);a=Vxe(a,e,t,i,n,o),r.getContext("2d").putImageData(a,e,t)}}function Vxe(r,e,t,i,n,o){for(var a=r.data,s=2*o+1,g=i-1,y=n-1,T=o+1,I=T*(T+1)/2,R=new O8,U=R,Z,Y=1;Y<s;Y++)U=U.next=new O8,Y===T&&(Z=U);U.next=R;for(var he=null,ce=null,pe=0,be=0,Te=Uxe[o],qe=Nxe[o],je=0;je<n;je++){U=R;for(var We=a[be],Ne=a[be+1],at=a[be+2],nt=a[be+3],ke=0;ke<T;ke++)U.r=We,U.g=Ne,U.b=at,U.a=nt,U=U.next;for(var De=0,Ye=0,Xe=0,Ct=0,Et=T*We,Pt=T*Ne,bt=T*at,Rt=T*nt,Ft=I*We,Zt=I*Ne,Le=I*at,Ze=I*nt,rt=1;rt<T;rt++){var pt=be+((g<rt?g:rt)<<2),mt=a[pt],Bt=a[pt+1],Dt=a[pt+2],Mt=a[pt+3],qt=T-rt;Ft+=(U.r=mt)*qt,Zt+=(U.g=Bt)*qt,Le+=(U.b=Dt)*qt,Ze+=(U.a=Mt)*qt,De+=mt,Ye+=Bt,Xe+=Dt,Ct+=Mt,U=U.next}he=R,ce=Z;for(var nr=0;nr<i;nr++){var vr=Ze*Te>>qe;if(a[be+3]=vr,vr!==0){var br=255/vr;a[be]=(Ft*Te>>qe)*br,a[be+1]=(Zt*Te>>qe)*br,a[be+2]=(Le*Te>>qe)*br}else a[be]=a[be+1]=a[be+2]=0;Ft-=Et,Zt-=Pt,Le-=bt,Ze-=Rt,Et-=he.r,Pt-=he.g,bt-=he.b,Rt-=he.a;var Fr=nr+o+1;Fr=pe+(Fr<g?Fr:g)<<2,De+=he.r=a[Fr],Ye+=he.g=a[Fr+1],Xe+=he.b=a[Fr+2],Ct+=he.a=a[Fr+3],Ft+=De,Zt+=Ye,Le+=Xe,Ze+=Ct,he=he.next;var kt=ce,lt=kt.r,wt=kt.g,Ur=kt.b,tr=kt.a;Et+=lt,Pt+=wt,bt+=Ur,Rt+=tr,De-=lt,Ye-=wt,Xe-=Ur,Ct-=tr,ce=ce.next,be+=4}pe+=i}for(var ht=0;ht<i;ht++){be=ht<<2;var $t=a[be],or=a[be+1],mr=a[be+2],ur=a[be+3],Wr=T*$t,ri=T*or,gi=T*mr,Pi=T*ur,zt=I*$t,Xr=I*or,Ar=I*mr,Wt=I*ur;U=R;for(var di=0;di<T;di++)U.r=$t,U.g=or,U.b=mr,U.a=ur,U=U.next;for(var Qt=i,Tr=0,Lr=0,Xt=0,xr=0,er=1;er<=o;er++){be=Qt+ht<<2;var vi=T-er;zt+=(U.r=$t=a[be])*vi,Xr+=(U.g=or=a[be+1])*vi,Ar+=(U.b=mr=a[be+2])*vi,Wt+=(U.a=ur=a[be+3])*vi,xr+=$t,Tr+=or,Lr+=mr,Xt+=ur,U=U.next,er<y&&(Qt+=i)}be=ht,he=R,ce=Z;for(var Zi=0;Zi<n;Zi++){var Qe=be<<2;a[Qe+3]=ur=Wt*Te>>qe,ur>0?(ur=255/ur,a[Qe]=(zt*Te>>qe)*ur,a[Qe+1]=(Xr*Te>>qe)*ur,a[Qe+2]=(Ar*Te>>qe)*ur):a[Qe]=a[Qe+1]=a[Qe+2]=0,zt-=Wr,Xr-=ri,Ar-=gi,Wt-=Pi,Wr-=he.r,ri-=he.g,gi-=he.b,Pi-=he.a,Qe=ht+((Qe=Zi+T)<y?Qe:y)*i<<2,zt+=xr+=he.r=a[Qe],Xr+=Tr+=he.g=a[Qe+1],Ar+=Lr+=he.b=a[Qe+2],Wt+=Xt+=he.a=a[Qe+3],he=he.next,Wr+=$t=ce.r,ri+=or=ce.g,gi+=mr=ce.b,Pi+=ur=ce.a,xr-=$t,Tr-=or,Lr-=mr,Xt-=ur,ce=ce.next,be+=i}}return r}var O8=function r(){Oxe(this,r),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function Hxe(){var{DOMParser:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e={window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:r,createCanvas(t,i){return new OffscreenCanvas(t,i)},createImage(t){return qA(function*(){var i=yield fetch(t),n=yield i.blob(),o=yield createImageBitmap(n);return o})()}};return(typeof DOMParser<"u"||typeof r>"u")&&Reflect.deleteProperty(e,"DOMParser"),e}function Gxe(r){var{DOMParser:e,canvas:t,fetch:i}=r;return{window:null,ignoreAnimation:!0,ignoreMouse:!0,DOMParser:e,fetch:i,createCanvas:t.createCanvas,createImage:t.loadImage}}var jxe=Object.freeze({__proto__:null,offscreen:Hxe,node:Gxe});function np(r){return r.replace(/(?!\u3000)\s+/gm," ")}function U8(r){return r.replace(/^[\n \t]+/,"")}function N8(r){return r.replace(/[\n \t]+$/,"")}function Qc(r){var e=(r||"").match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm)||[];return e.map(parseFloat)}var qxe=/^[A-Z-]+$/;function z8(r){return qxe.test(r)?r.toLowerCase():r}function DI(r){var e=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(r)||[];return e[2]||e[3]||e[4]}function Q8(r){if(!r.startsWith("rgb"))return r;var e=3,t=r.replace(/\d+(\.\d+)?/g,(i,n)=>e--&&n?String(Math.round(parseFloat(i))):i);return t}var $xe=/(\[[^\]]+\])/g,Kxe=/(#[^\s+>~.[:]+)/g,Wxe=/(\.[^\s+>~.[:]+)/g,Xxe=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,Zxe=/(:[\w-]+\([^)]*\))/gi,Jxe=/(:[^\s+>~.[:]+)/g,Yxe=/([^\s+>~.[:]+)/g;function sp(r,e){var t=e.exec(r);return t?[r.replace(e," "),t.length]:[r,0]}function V8(r){var e=[0,0,0],t=r.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),i=0;return[t,i]=sp(t,$xe),e[1]+=i,[t,i]=sp(t,Kxe),e[0]+=i,[t,i]=sp(t,Wxe),e[1]+=i,[t,i]=sp(t,Xxe),e[2]+=i,[t,i]=sp(t,Zxe),e[1]+=i,[t,i]=sp(t,Jxe),e[1]+=i,t=t.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[t,i]=sp(t,Yxe),e[2]+=i,e.join("")}var op=1e-8;function RI(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2))}function wx(r,e){return(r[0]*e[0]+r[1]*e[1])/(RI(r)*RI(e))}function kI(r,e){return(r[0]*e[1]<r[1]*e[0]?-1:1)*Math.acos(wx(r,e))}function OI(r){return r*r*r}function UI(r){return 3*r*r*(1-r)}function NI(r){return 3*r*(1-r)*(1-r)}function zI(r){return(1-r)*(1-r)*(1-r)}function QI(r){return r*r}function VI(r){return 2*r*(1-r)}function HI(r){return(1-r)*(1-r)}class Ti{constructor(e,t,i){this.document=e,this.name=t,this.value=i,this.isNormalizedColor=!1}static empty(e){return new Ti(e,"EMPTY","")}split(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ",{document:t,name:i}=this;return np(this.getString()).trim().split(e).map(n=>new Ti(t,i,n))}hasValue(e){var{value:t}=this;return t!==null&&t!==""&&(e||t!==0)&&typeof t<"u"}isString(e){var{value:t}=this,i=typeof t=="string";return!i||!e?i:e.test(t)}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;var e=this.getString();switch(!0){case e.endsWith("px"):case/^[0-9]+$/.test(e):return!0;default:return!1}}setValue(e){return this.value=e,this}getValue(e){return typeof e>"u"||this.hasValue()?this.value:e}getNumber(e){if(!this.hasValue())return typeof e>"u"?0:parseFloat(e);var{value:t}=this,i=parseFloat(t);return this.isString(/%$/)&&(i/=100),i}getString(e){return typeof e>"u"||this.hasValue()?typeof this.value>"u"?"":String(this.value):String(e)}getColor(e){var t=this.getString(e);return this.isNormalizedColor||(this.isNormalizedColor=!0,t=Q8(t),this.value=t),t}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasValue())return 0;var[i,n]=typeof e=="boolean"?[void 0,e]:[e],{viewPort:o}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(o.computeSize("x"),o.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(o.computeSize("x"),o.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*o.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*o.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case(this.isString(/%$/)&&n):return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*o.computeSize(i);default:{var a=this.getNumber();return t&&a<1?a*o.computeSize(i):a}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){var e=this.getString(),t=/#([^)'"]+)/.exec(e);return t&&(t=t[1]),t||(t=e),this.document.definitions[t]}getFillStyleDefinition(e,t){var i=this.getDefinition();if(!i)return null;if(typeof i.createGradient=="function")return i.createGradient(this.document.ctx,e,t);if(typeof i.createPattern=="function"){if(i.getHrefAttribute().hasValue()){var n=i.getAttribute("patternTransform");i=i.getHrefAttribute().getDefinition(),n.hasValue()&&i.getAttribute("patternTransform",!0).setValue(n.value)}return i.createPattern(this.document.ctx,e,t)}return null}getTextBaseline(){return this.hasValue()?Ti.textBaselineMapping[this.getString()]:null}addOpacity(e){for(var t=this.getColor(),i=t.length,n=0,o=0;o<i&&(t[o]===","&&n++,n!==3);o++);if(e.hasValue()&&this.isString()&&n!==3){var a=new II(t);a.ok&&(a.alpha=e.getNumber(),t=a.toRGBA())}return new Ti(this.document,this.name,t)}}Ti.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class H8{constructor(){this.viewPorts=[]}clear(){this.viewPorts=[]}setCurrent(e,t){this.viewPorts.push({width:e,height:t})}removeCurrent(){this.viewPorts.pop()}getCurrent(){var{viewPorts:e}=this;return e[e.length-1]}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(e){return typeof e=="number"?e:e==="x"?this.width:e==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}}class Io{constructor(e,t){this.x=e,this.y=t}static parse(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,[i=t,n=t]=Qc(e);return new Io(i,n)}static parseScale(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,[i=t,n=i]=Qc(e);return new Io(i,n)}static parsePath(e){for(var t=Qc(e),i=t.length,n=[],o=0;o<i;o+=2)n.push(new Io(t[o],t[o+1]));return n}angleTo(e){return Math.atan2(e.y-this.y,e.x-this.x)}applyTransform(e){var{x:t,y:i}=this,n=t*e[0]+i*e[2]+e[4],o=t*e[1]+i*e[3]+e[5];this.x=n,this.y=o}}class G8{constructor(e){this.screen=e,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}isWorking(){return this.working}start(){if(!this.working){var{screen:e,onClick:t,onMouseMove:i}=this,n=e.ctx.canvas;n.onclick=t,n.onmousemove=i,this.working=!0}}stop(){if(this.working){var e=this.screen.ctx.canvas;this.working=!1,e.onclick=null,e.onmousemove=null}}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(this.working){var{screen:e,events:t,eventElements:i}=this,{style:n}=e.ctx.canvas;n&&(n.cursor=""),t.forEach((o,a)=>{for(var{run:s}=o,g=i[a];g;)s(g),g=g.parent}),this.events=[],this.eventElements=[]}}checkPath(e,t){if(!(!this.working||!t)){var{events:i,eventElements:n}=this;i.forEach((o,a)=>{var{x:s,y:g}=o;!n[a]&&t.isPointInPath&&t.isPointInPath(s,g)&&(n[a]=e)})}}checkBoundingBox(e,t){if(!(!this.working||!t)){var{events:i,eventElements:n}=this;i.forEach((o,a)=>{var{x:s,y:g}=o;!n[a]&&t.isPointInBox(s,g)&&(n[a]=e)})}}mapXY(e,t){for(var{window:i,ctx:n}=this.screen,o=new Io(e,t),a=n.canvas;a;)o.x-=a.offsetLeft,o.y-=a.offsetTop,a=a.offsetParent;return i.scrollX&&(o.x+=i.scrollX),i.scrollY&&(o.y+=i.scrollY),o}onClick(e){var{x:t,y:i}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onclick",x:t,y:i,run(n){n.onClick&&n.onClick()}})}onMouseMove(e){var{x:t,y:i}=this.mapXY(e.clientX,e.clientY);this.events.push({type:"onmousemove",x:t,y:i,run(n){n.onMouseMove&&n.onMouseMove()}})}}var j8=typeof window<"u"?window:null,q8=typeof fetch<"u"?fetch.bind(void 0):null;class X0{constructor(e){var{fetch:t=q8,window:i=j8}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.ctx=e,this.FRAMERATE=30,this.MAX_VIRTUAL_PIXELS=3e4,this.CLIENT_WIDTH=800,this.CLIENT_HEIGHT=600,this.viewPort=new H8,this.mouse=new G8(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=i,this.fetch=t}wait(e){this.waits.push(e)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;var e=this.waits.every(t=>t());return e&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=e,e}setDefaults(e){e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4}setViewBox(e){var{document:t,ctx:i,aspectRatio:n,width:o,desiredWidth:a,height:s,desiredHeight:g,minX:y=0,minY:T=0,refX:I,refY:R,clip:U=!1,clipX:Z=0,clipY:Y=0}=e,he=np(n).replace(/^defer\s/,""),[ce,pe]=he.split(" "),be=ce||"xMidYMid",Te=pe||"meet",qe=o/a,je=s/g,We=Math.min(qe,je),Ne=Math.max(qe,je),at=a,nt=g;Te==="meet"&&(at*=We,nt*=We),Te==="slice"&&(at*=Ne,nt*=Ne);var ke=new Ti(t,"refX",I),De=new Ti(t,"refY",R),Ye=ke.hasValue()&&De.hasValue();if(Ye&&i.translate(-We*ke.getPixels("x"),-We*De.getPixels("y")),U){var Xe=We*Z,Ct=We*Y;i.beginPath(),i.moveTo(Xe,Ct),i.lineTo(o,Ct),i.lineTo(o,s),i.lineTo(Xe,s),i.closePath(),i.clip()}if(!Ye){var Et=Te==="meet"&&We===je,Pt=Te==="slice"&&Ne===je,bt=Te==="meet"&&We===qe,Rt=Te==="slice"&&Ne===qe;be.startsWith("xMid")&&(Et||Pt)&&i.translate(o/2-at/2,0),be.endsWith("YMid")&&(bt||Rt)&&i.translate(0,s/2-nt/2),be.startsWith("xMax")&&(Et||Pt)&&i.translate(o-at,0),be.endsWith("YMax")&&(bt||Rt)&&i.translate(0,s-nt)}switch(!0){case be==="none":i.scale(qe,je);break;case Te==="meet":i.scale(We,We);break;case Te==="slice":i.scale(Ne,Ne);break}i.translate(-y,-T)}start(e){var{enableRedraw:t=!1,ignoreMouse:i=!1,ignoreAnimation:n=!1,ignoreDimensions:o=!1,ignoreClear:a=!1,forceRedraw:s,scaleWidth:g,scaleHeight:y,offsetX:T,offsetY:I}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{FRAMERATE:R,mouse:U}=this,Z=1e3/R;if(this.frameDuration=Z,this.readyPromise=new Promise(be=>{this.resolveReady=be}),this.isReady()&&this.render(e,o,a,g,y,T,I),!!t){var Y=Date.now(),he=Y,ce=0,pe=()=>{Y=Date.now(),ce=Y-he,ce>=Z&&(he=Y-ce%Z,this.shouldUpdate(n,s)&&(this.render(e,o,a,g,y,T,I),U.runEvents())),this.intervalId=EI(pe)};i||U.start(),this.intervalId=EI(pe)}}stop(){this.intervalId&&(EI.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(e,t){if(!e){var{frameDuration:i}=this,n=this.animations.reduce((o,a)=>a.update(i)||o,!1);if(n)return!0}return!!(typeof t=="function"&&t()||!this.isReadyLock&&this.isReady()||this.mouse.hasEvents())}render(e,t,i,n,o,a,s){var{CLIENT_WIDTH:g,CLIENT_HEIGHT:y,viewPort:T,ctx:I,isFirstRender:R}=this,U=I.canvas;T.clear(),U.width&&U.height?T.setCurrent(U.width,U.height):T.setCurrent(g,y);var Z=e.getStyle("width"),Y=e.getStyle("height");!t&&(R||typeof n!="number"&&typeof o!="number")&&(Z.hasValue()&&(U.width=Z.getPixels("x"),U.style&&(U.style.width="".concat(U.width,"px"))),Y.hasValue()&&(U.height=Y.getPixels("y"),U.style&&(U.style.height="".concat(U.height,"px"))));var he=U.clientWidth||U.width,ce=U.clientHeight||U.height;if(t&&Z.hasValue()&&Y.hasValue()&&(he=Z.getPixels("x"),ce=Y.getPixels("y")),T.setCurrent(he,ce),typeof a=="number"&&e.getAttribute("x",!0).setValue(a),typeof s=="number"&&e.getAttribute("y",!0).setValue(s),typeof n=="number"||typeof o=="number"){var pe=Qc(e.getAttribute("viewBox").getString()),be=0,Te=0;if(typeof n=="number"){var qe=e.getStyle("width");qe.hasValue()?be=qe.getPixels("x")/n:isNaN(pe[2])||(be=pe[2]/n)}if(typeof o=="number"){var je=e.getStyle("height");je.hasValue()?Te=je.getPixels("y")/o:isNaN(pe[3])||(Te=pe[3]/o)}be||(be=Te),Te||(Te=be),e.getAttribute("width",!0).setValue(n),e.getAttribute("height",!0).setValue(o);var We=e.getStyle("transform",!0,!0);We.setValue("".concat(We.getString()," scale(").concat(1/be,", ").concat(1/Te,")"))}i||I.clearRect(0,0,he,ce),e.render(I),R&&(this.isFirstRender=!1)}}X0.defaultWindow=j8,X0.defaultFetch=q8;var{defaultFetch:ewe}=X0,twe=typeof DOMParser<"u"?DOMParser:null;class Bx{constructor(){var{fetch:e=ewe,DOMParser:t=twe}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fetch=e,this.DOMParser=t}parse(e){var t=this;return qA(function*(){return e.startsWith("<")?t.parseFromString(e):t.load(e)})()}parseFromString(e){var t=new this.DOMParser;try{return this.checkDocument(t.parseFromString(e,"image/svg+xml"))}catch{return this.checkDocument(t.parseFromString(e,"text/xml"))}}checkDocument(e){var t=e.getElementsByTagName("parsererror")[0];if(t)throw new Error(t.textContent);return e}load(e){var t=this;return qA(function*(){var i=yield t.fetch(e),n=yield i.text();return t.parseFromString(n)})()}}class $8{constructor(e,t){this.type="translate",this.point=null,this.point=Io.parse(t)}apply(e){var{x:t,y:i}=this.point;e.translate(t||0,i||0)}unapply(e){var{x:t,y:i}=this.point;e.translate(-1*t||0,-1*i||0)}applyToPoint(e){var{x:t,y:i}=this.point;e.applyTransform([1,0,0,1,t||0,i||0])}}class K8{constructor(e,t,i){this.type="rotate",this.angle=null,this.originX=null,this.originY=null,this.cx=0,this.cy=0;var n=Qc(t);this.angle=new Ti(e,"angle",n[0]),this.originX=i[0],this.originY=i[1],this.cx=n[1]||0,this.cy=n[2]||0}apply(e){var{cx:t,cy:i,originX:n,originY:o,angle:a}=this,s=t+n.getPixels("x"),g=i+o.getPixels("y");e.translate(s,g),e.rotate(a.getRadians()),e.translate(-s,-g)}unapply(e){var{cx:t,cy:i,originX:n,originY:o,angle:a}=this,s=t+n.getPixels("x"),g=i+o.getPixels("y");e.translate(s,g),e.rotate(-1*a.getRadians()),e.translate(-s,-g)}applyToPoint(e){var{cx:t,cy:i,angle:n}=this,o=n.getRadians();e.applyTransform([1,0,0,1,t||0,i||0]),e.applyTransform([Math.cos(o),Math.sin(o),-Math.sin(o),Math.cos(o),0,0]),e.applyTransform([1,0,0,1,-t||0,-i||0])}}class W8{constructor(e,t,i){this.type="scale",this.scale=null,this.originX=null,this.originY=null;var n=Io.parseScale(t);(n.x===0||n.y===0)&&(n.x=op,n.y=op),this.scale=n,this.originX=i[0],this.originY=i[1]}apply(e){var{scale:{x:t,y:i},originX:n,originY:o}=this,a=n.getPixels("x"),s=o.getPixels("y");e.translate(a,s),e.scale(t,i||t),e.translate(-a,-s)}unapply(e){var{scale:{x:t,y:i},originX:n,originY:o}=this,a=n.getPixels("x"),s=o.getPixels("y");e.translate(a,s),e.scale(1/t,1/i||t),e.translate(-a,-s)}applyToPoint(e){var{x:t,y:i}=this.scale;e.applyTransform([t||0,0,0,i||0,0,0])}}class GI{constructor(e,t,i){this.type="matrix",this.matrix=[],this.originX=null,this.originY=null,this.matrix=Qc(t),this.originX=i[0],this.originY=i[1]}apply(e){var{originX:t,originY:i,matrix:n}=this,o=t.getPixels("x"),a=i.getPixels("y");e.translate(o,a),e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),e.translate(-o,-a)}unapply(e){var{originX:t,originY:i,matrix:n}=this,o=n[0],a=n[2],s=n[4],g=n[1],y=n[3],T=n[5],I=0,R=0,U=1,Z=1/(o*(y*U-T*R)-a*(g*U-T*I)+s*(g*R-y*I)),Y=t.getPixels("x"),he=i.getPixels("y");e.translate(Y,he),e.transform(Z*(y*U-T*R),Z*(T*I-g*U),Z*(s*R-a*U),Z*(o*U-s*I),Z*(a*T-s*y),Z*(s*g-o*T)),e.translate(-Y,-he)}applyToPoint(e){e.applyTransform(this.matrix)}}class jI extends GI{constructor(e,t,i){super(e,t,i),this.type="skew",this.angle=null,this.angle=new Ti(e,"angle",t)}}class X8 extends jI{constructor(e,t,i){super(e,t,i),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class Z8 extends jI{constructor(e,t,i){super(e,t,i),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function rwe(r){return np(r).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function iwe(r){var[e,t]=r.split("(");return[e.trim(),t.trim().replace(")","")]}class Vd{constructor(e,t,i){this.document=e,this.transforms=[];var n=rwe(t);n.forEach(o=>{if(o!=="none"){var[a,s]=iwe(o),g=Vd.transformTypes[a];typeof g<"u"&&this.transforms.push(new g(this.document,s,i))}})}static fromElement(e,t){var i=t.getStyle("transform",!1,!0),[n,o=n]=t.getStyle("transform-origin",!1,!0).split(),a=[n,o];return i.hasValue()?new Vd(e,i.getString(),a):null}apply(e){for(var{transforms:t}=this,i=t.length,n=0;n<i;n++)t[n].apply(e)}unapply(e){for(var{transforms:t}=this,i=t.length,n=i-1;n>=0;n--)t[n].unapply(e)}applyToPoint(e){for(var{transforms:t}=this,i=t.length,n=0;n<i;n++)t[n].applyToPoint(e)}}Vd.transformTypes={translate:$8,rotate:K8,scale:W8,matrix:GI,skewX:X8,skewY:Z8};class js{constructor(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(this.document=e,this.node=t,this.captureTextNodes=i,this.attributes={},this.styles={},this.stylesSpecificity={},this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!(!t||t.nodeType!==1)){if(Array.from(t.attributes).forEach(s=>{var g=z8(s.nodeName);this.attributes[g]=new Ti(e,g,s.value)}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()){var n=this.getAttribute("style").getString().split(";").map(s=>s.trim());n.forEach(s=>{if(s){var[g,y]=s.split(":").map(T=>T.trim());this.styles[g]=new Ti(e,g,y)}})}var{definitions:o}=e,a=this.getAttribute("id");a.hasValue()&&(o[a.getString()]||(o[a.getString()]=this)),Array.from(t.childNodes).forEach(s=>{if(s.nodeType===1)this.addChild(s);else if(i&&(s.nodeType===3||s.nodeType===4)){var g=e.createTextNode(s);g.getText().length>0&&this.addChild(g)}})}}getAttribute(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=this.attributes[e];if(!i&&t){var n=new Ti(this.document,e,"");return this.attributes[e]=n,n}return i||Ti.empty(this.document)}getHrefAttribute(){for(var e in this.attributes)if(e==="href"||e.endsWith(":href"))return this.attributes[e];return Ti.empty(this.document)}getStyle(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=this.styles[e];if(n)return n;var o=this.getAttribute(e);if(o!=null&&o.hasValue())return this.styles[e]=o,o;if(!i){var{parent:a}=this;if(a){var s=a.getStyle(e);if(s!=null&&s.hasValue())return s}}if(t){var g=new Ti(this.document,e,"");return this.styles[e]=g,g}return n||Ti.empty(this.document)}render(e){if(!(this.getStyle("display").getString()==="none"||this.getStyle("visibility").getString()==="hidden")){if(e.save(),this.getStyle("mask").hasValue()){var t=this.getStyle("mask").getDefinition();t&&(this.applyEffects(e),t.apply(e,this))}else if(this.getStyle("filter").getValue("none")!=="none"){var i=this.getStyle("filter").getDefinition();i&&(this.applyEffects(e),i.apply(e,this))}else this.setContext(e),this.renderChildren(e),this.clearContext(e);e.restore()}}setContext(e){}applyEffects(e){var t=Vd.fromElement(this.document,this);t&&t.apply(e);var i=this.getStyle("clip-path",!1,!0);if(i.hasValue()){var n=i.getDefinition();n&&n.apply(e)}}clearContext(e){}renderChildren(e){this.children.forEach(t=>{t.render(e)})}addChild(e){var t=e instanceof js?e:this.document.createElement(e);t.parent=this,js.ignoreChildTypes.includes(t.type)||this.children.push(t)}matchesSelector(e){var t,{node:i}=this;if(typeof i.matches=="function")return i.matches(e);var n=(t=i.getAttribute)===null||t===void 0?void 0:t.call(i,"class");return!n||n===""?!1:n.split(" ").some(o=>".".concat(o)===e)}addStylesFromStyleDefinition(){var{styles:e,stylesSpecificity:t}=this.document;for(var i in e)if(!i.startsWith("@")&&this.matchesSelector(i)){var n=e[i],o=t[i];if(n)for(var a in n){var s=this.stylesSpecificity[a];typeof s>"u"&&(s="000"),o>=s&&(this.styles[a]=n[a],this.stylesSpecificity[a]=o)}}}removeStyles(e,t){var i=t.reduce((n,o)=>{var a=e.getStyle(o);if(!a.hasValue())return n;var s=a.getString();return a.setValue(""),[...n,[o,s]]},[]);return i}restoreStyles(e,t){t.forEach(i=>{var[n,o]=i;e.getStyle(n,!0).setValue(o)})}isFirstChild(){var e;return((e=this.parent)===null||e===void 0?void 0:e.children.indexOf(this))===0}}js.ignoreChildTypes=["title"];class J8 extends js{constructor(e,t,i){super(e,t,i)}}function nwe(r){var e=r.trim();return/^('|")/.test(e)?e:'"'.concat(e,'"')}function swe(r){return typeof process>"u"?r:r.trim().split(",").map(nwe).join(",")}function owe(r){if(!r)return"";var e=r.trim().toLowerCase();switch(e){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return e;default:return/^oblique\s+(-|)\d+deg$/.test(e)?e:""}}function awe(r){if(!r)return"";var e=r.trim().toLowerCase();switch(e){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return e;default:return/^[\d.]+$/.test(e)?e:""}}class Vl{constructor(e,t,i,n,o,a){var s=a?typeof a=="string"?Vl.parse(a):a:{};this.fontFamily=o||s.fontFamily,this.fontSize=n||s.fontSize,this.fontStyle=e||s.fontStyle,this.fontWeight=i||s.fontWeight,this.fontVariant=t||s.fontVariant}static parse(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,i="",n="",o="",a="",s="",g=np(e).trim().split(" "),y={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return g.forEach(T=>{switch(!0){case(!y.fontStyle&&Vl.styles.includes(T)):T!=="inherit"&&(i=T),y.fontStyle=!0;break;case(!y.fontVariant&&Vl.variants.includes(T)):T!=="inherit"&&(n=T),y.fontStyle=!0,y.fontVariant=!0;break;case(!y.fontWeight&&Vl.weights.includes(T)):T!=="inherit"&&(o=T),y.fontStyle=!0,y.fontVariant=!0,y.fontWeight=!0;break;case!y.fontSize:T!=="inherit"&&([a]=T.split("/")),y.fontStyle=!0,y.fontVariant=!0,y.fontWeight=!0,y.fontSize=!0;break;default:T!=="inherit"&&(s+=T)}}),new Vl(i,n,o,a,s,t)}toString(){return[owe(this.fontStyle),this.fontVariant,awe(this.fontWeight),this.fontSize,swe(this.fontFamily)].join(" ").trim()}}Vl.styles="normal|italic|oblique|inherit",Vl.variants="normal|small-caps|inherit",Vl.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class Qu{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.NaN,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.NaN,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Number.NaN,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Number.NaN;this.x1=e,this.y1=t,this.x2=i,this.y2=n,this.addPoint(e,t),this.addPoint(i,n)}get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(e,t){typeof e<"u"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=e,this.x2=e),e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)),typeof t<"u"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=t,this.y2=t),t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t))}addX(e){this.addPoint(e,null)}addY(e){this.addPoint(null,e)}addBoundingBox(e){if(e){var{x1:t,y1:i,x2:n,y2:o}=e;this.addPoint(t,i),this.addPoint(n,o)}}sumCubic(e,t,i,n,o){return Math.pow(1-e,3)*t+3*Math.pow(1-e,2)*e*i+3*(1-e)*Math.pow(e,2)*n+Math.pow(e,3)*o}bezierCurveAdd(e,t,i,n,o){var a=6*t-12*i+6*n,s=-3*t+9*i-9*n+3*o,g=3*i-3*t;if(s===0){if(a===0)return;var y=-g/a;0<y&&y<1&&(e?this.addX(this.sumCubic(y,t,i,n,o)):this.addY(this.sumCubic(y,t,i,n,o)));return}var T=Math.pow(a,2)-4*g*s;if(!(T<0)){var I=(-a+Math.sqrt(T))/(2*s);0<I&&I<1&&(e?this.addX(this.sumCubic(I,t,i,n,o)):this.addY(this.sumCubic(I,t,i,n,o)));var R=(-a-Math.sqrt(T))/(2*s);0<R&&R<1&&(e?this.addX(this.sumCubic(R,t,i,n,o)):this.addY(this.sumCubic(R,t,i,n,o)))}}addBezierCurve(e,t,i,n,o,a,s,g){this.addPoint(e,t),this.addPoint(s,g),this.bezierCurveAdd(!0,e,i,o,s),this.bezierCurveAdd(!1,t,n,a,g)}addQuadraticCurve(e,t,i,n,o,a){var s=e+.6666666666666666*(i-e),g=t+2/3*(n-t),y=s+1/3*(o-e),T=g+1/3*(a-t);this.addBezierCurve(e,t,s,y,g,T,o,a)}isPointInBox(e,t){var{x1:i,y1:n,x2:o,y2:a}=this;return i<=e&&e<=o&&n<=t&&t<=a}}class en extends wr{constructor(e){super(e.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=null,this.start=null,this.current=null,this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new Io(0,0),this.control=new Io(0,0),this.current=new Io(0,0),this.points=[],this.angles=[]}isEnd(){var{i:e,commands:t}=this;return e>=t.length-1}next(){var e=this.commands[++this.i];return this.previousCommand=this.command,this.command=e,e}getPoint(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y",i=new Io(this.command[e],this.command[t]);return this.makeAbsolute(i)}getAsControlPoint(e,t){var i=this.getPoint(e,t);return this.control=i,i}getAsCurrentPoint(e,t){var i=this.getPoint(e,t);return this.current=i,i}getReflectedControlPoint(){var e=this.previousCommand.type;if(e!==wr.CURVE_TO&&e!==wr.SMOOTH_CURVE_TO&&e!==wr.QUAD_TO&&e!==wr.SMOOTH_QUAD_TO)return this.current;var{current:{x:t,y:i},control:{x:n,y:o}}=this,a=new Io(2*t-n,2*i-o);return a}makeAbsolute(e){if(this.command.relative){var{x:t,y:i}=this.current;e.x+=t,e.y+=i}return e}addMarker(e,t,i){var{points:n,angles:o}=this;i&&o.length>0&&!o[o.length-1]&&(o[o.length-1]=n[n.length-1].angleTo(i)),this.addMarkerAngle(e,t?t.angleTo(e):null)}addMarkerAngle(e,t){this.points.push(e),this.angles.push(t)}getMarkerPoints(){return this.points}getMarkerAngles(){for(var{angles:e}=this,t=e.length,i=0;i<t;i++)if(!e[i]){for(var n=i+1;n<t;n++)if(e[n]){e[i]=e[n];break}}return e}}class Hd extends js{constructor(){super(...arguments),this.modifiedEmSizeStack=!1}calculateOpacity(){for(var e=1,t=this;t;){var i=t.getStyle("opacity",!1,!0);i.hasValue(!0)&&(e*=i.getNumber()),t=t.parent}return e}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!t){var i=this.getStyle("fill"),n=this.getStyle("fill-opacity"),o=this.getStyle("stroke"),a=this.getStyle("stroke-opacity");if(i.isUrlDefinition()){var s=i.getFillStyleDefinition(this,n);s&&(e.fillStyle=s)}else if(i.hasValue()){i.getString()==="currentColor"&&i.setValue(this.getStyle("color").getColor());var g=i.getColor();g!=="inherit"&&(e.fillStyle=g==="none"?"rgba(0,0,0,0)":g)}if(n.hasValue()){var y=new Ti(this.document,"fill",e.fillStyle).addOpacity(n).getColor();e.fillStyle=y}if(o.isUrlDefinition()){var T=o.getFillStyleDefinition(this,a);T&&(e.strokeStyle=T)}else if(o.hasValue()){o.getString()==="currentColor"&&o.setValue(this.getStyle("color").getColor());var I=o.getString();I!=="inherit"&&(e.strokeStyle=I==="none"?"rgba(0,0,0,0)":I)}if(a.hasValue()){var R=new Ti(this.document,"stroke",e.strokeStyle).addOpacity(a).getString();e.strokeStyle=R}var U=this.getStyle("stroke-width");if(U.hasValue()){var Z=U.getPixels();e.lineWidth=Z||op}var Y=this.getStyle("stroke-linecap"),he=this.getStyle("stroke-linejoin"),ce=this.getStyle("stroke-miterlimit"),pe=this.getStyle("stroke-dasharray"),be=this.getStyle("stroke-dashoffset");if(Y.hasValue()&&(e.lineCap=Y.getString()),he.hasValue()&&(e.lineJoin=he.getString()),ce.hasValue()&&(e.miterLimit=ce.getNumber()),pe.hasValue()&&pe.getString()!=="none"){var Te=Qc(pe.getString());typeof e.setLineDash<"u"?e.setLineDash(Te):typeof e.webkitLineDash<"u"?e.webkitLineDash=Te:typeof e.mozDash<"u"&&!(Te.length===1&&Te[0]===0)&&(e.mozDash=Te);var qe=be.getPixels();typeof e.lineDashOffset<"u"?e.lineDashOffset=qe:typeof e.webkitLineDashOffset<"u"?e.webkitLineDashOffset=qe:typeof e.mozDashOffset<"u"&&(e.mozDashOffset=qe)}}if(this.modifiedEmSizeStack=!1,typeof e.font<"u"){var je=this.getStyle("font"),We=this.getStyle("font-style"),Ne=this.getStyle("font-variant"),at=this.getStyle("font-weight"),nt=this.getStyle("font-size"),ke=this.getStyle("font-family"),De=new Vl(We.getString(),Ne.getString(),at.getString(),nt.hasValue()?"".concat(nt.getPixels(!0),"px"):"",ke.getString(),Vl.parse(je.getString(),e.font));We.setValue(De.fontStyle),Ne.setValue(De.fontVariant),at.setValue(De.fontWeight),nt.setValue(De.fontSize),ke.setValue(De.fontFamily),e.font=De.toString(),nt.isPixels()&&(this.document.emSize=nt.getPixels(),this.modifiedEmSizeStack=!0)}t||(this.applyEffects(e),e.globalAlpha=this.calculateOpacity())}clearContext(e){super.clearContext(e),this.modifiedEmSizeStack&&this.document.popEmSize()}}class hs extends Hd{constructor(e,t,i){super(e,t,i),this.type="path",this.pathParser=null,this.pathParser=new en(this.getAttribute("d").getString())}path(e){var{pathParser:t}=this,i=new Qu;for(t.reset(),e&&e.beginPath();!t.isEnd();)switch(t.next().type){case en.MOVE_TO:this.pathM(e,i);break;case en.LINE_TO:this.pathL(e,i);break;case en.HORIZ_LINE_TO:this.pathH(e,i);break;case en.VERT_LINE_TO:this.pathV(e,i);break;case en.CURVE_TO:this.pathC(e,i);break;case en.SMOOTH_CURVE_TO:this.pathS(e,i);break;case en.QUAD_TO:this.pathQ(e,i);break;case en.SMOOTH_QUAD_TO:this.pathT(e,i);break;case en.ARC:this.pathA(e,i);break;case en.CLOSE_PATH:this.pathZ(e,i);break}return i}getBoundingBox(e){return this.path()}getMarkers(){var{pathParser:e}=this,t=e.getMarkerPoints(),i=e.getMarkerAngles(),n=t.map((o,a)=>[o,i[a]]);return n}renderChildren(e){this.path(e),this.document.screen.mouse.checkPath(this,e);var t=this.getStyle("fill-rule");e.fillStyle!==""&&(t.getString("inherit")!=="inherit"?e.fill(t.getString()):e.fill()),e.strokeStyle!==""&&(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"?(e.save(),e.setTransform(1,0,0,1,0,0),e.stroke(),e.restore()):e.stroke());var i=this.getMarkers();if(i){var n=i.length-1,o=this.getStyle("marker-start"),a=this.getStyle("marker-mid"),s=this.getStyle("marker-end");if(o.isUrlDefinition()){var g=o.getDefinition(),[y,T]=i[0];g.render(e,y,T)}if(a.isUrlDefinition())for(var I=a.getDefinition(),R=1;R<n;R++){var[U,Z]=i[R];I.render(e,U,Z)}if(s.isUrlDefinition()){var Y=s.getDefinition(),[he,ce]=i[n];Y.render(e,he,ce)}}}static pathM(e){var t=e.getAsCurrentPoint();return e.start=e.current,{point:t}}pathM(e,t){var{pathParser:i}=this,{point:n}=hs.pathM(i),{x:o,y:a}=n;i.addMarker(n),t.addPoint(o,a),e&&e.moveTo(o,a)}static pathL(e){var{current:t}=e,i=e.getAsCurrentPoint();return{current:t,point:i}}pathL(e,t){var{pathParser:i}=this,{current:n,point:o}=hs.pathL(i),{x:a,y:s}=o;i.addMarker(o,n),t.addPoint(a,s),e&&e.lineTo(a,s)}static pathH(e){var{current:t,command:i}=e,n=new Io((i.relative?t.x:0)+i.x,t.y);return e.current=n,{current:t,point:n}}pathH(e,t){var{pathParser:i}=this,{current:n,point:o}=hs.pathH(i),{x:a,y:s}=o;i.addMarker(o,n),t.addPoint(a,s),e&&e.lineTo(a,s)}static pathV(e){var{current:t,command:i}=e,n=new Io(t.x,(i.relative?t.y:0)+i.y);return e.current=n,{current:t,point:n}}pathV(e,t){var{pathParser:i}=this,{current:n,point:o}=hs.pathV(i),{x:a,y:s}=o;i.addMarker(o,n),t.addPoint(a,s),e&&e.lineTo(a,s)}static pathC(e){var{current:t}=e,i=e.getPoint("x1","y1"),n=e.getAsControlPoint("x2","y2"),o=e.getAsCurrentPoint();return{current:t,point:i,controlPoint:n,currentPoint:o}}pathC(e,t){var{pathParser:i}=this,{current:n,point:o,controlPoint:a,currentPoint:s}=hs.pathC(i);i.addMarker(s,a,o),t.addBezierCurve(n.x,n.y,o.x,o.y,a.x,a.y,s.x,s.y),e&&e.bezierCurveTo(o.x,o.y,a.x,a.y,s.x,s.y)}static pathS(e){var{current:t}=e,i=e.getReflectedControlPoint(),n=e.getAsControlPoint("x2","y2"),o=e.getAsCurrentPoint();return{current:t,point:i,controlPoint:n,currentPoint:o}}pathS(e,t){var{pathParser:i}=this,{current:n,point:o,controlPoint:a,currentPoint:s}=hs.pathS(i);i.addMarker(s,a,o),t.addBezierCurve(n.x,n.y,o.x,o.y,a.x,a.y,s.x,s.y),e&&e.bezierCurveTo(o.x,o.y,a.x,a.y,s.x,s.y)}static pathQ(e){var{current:t}=e,i=e.getAsControlPoint("x1","y1"),n=e.getAsCurrentPoint();return{current:t,controlPoint:i,currentPoint:n}}pathQ(e,t){var{pathParser:i}=this,{current:n,controlPoint:o,currentPoint:a}=hs.pathQ(i);i.addMarker(a,o,o),t.addQuadraticCurve(n.x,n.y,o.x,o.y,a.x,a.y),e&&e.quadraticCurveTo(o.x,o.y,a.x,a.y)}static pathT(e){var{current:t}=e,i=e.getReflectedControlPoint();e.control=i;var n=e.getAsCurrentPoint();return{current:t,controlPoint:i,currentPoint:n}}pathT(e,t){var{pathParser:i}=this,{current:n,controlPoint:o,currentPoint:a}=hs.pathT(i);i.addMarker(a,o,o),t.addQuadraticCurve(n.x,n.y,o.x,o.y,a.x,a.y),e&&e.quadraticCurveTo(o.x,o.y,a.x,a.y)}static pathA(e){var{current:t,command:i}=e,{rX:n,rY:o,xRot:a,lArcFlag:s,sweepFlag:g}=i,y=a*(Math.PI/180),T=e.getAsCurrentPoint(),I=new Io(Math.cos(y)*(t.x-T.x)/2+Math.sin(y)*(t.y-T.y)/2,-Math.sin(y)*(t.x-T.x)/2+Math.cos(y)*(t.y-T.y)/2),R=Math.pow(I.x,2)/Math.pow(n,2)+Math.pow(I.y,2)/Math.pow(o,2);R>1&&(n*=Math.sqrt(R),o*=Math.sqrt(R));var U=(s===g?-1:1)*Math.sqrt((Math.pow(n,2)*Math.pow(o,2)-Math.pow(n,2)*Math.pow(I.y,2)-Math.pow(o,2)*Math.pow(I.x,2))/(Math.pow(n,2)*Math.pow(I.y,2)+Math.pow(o,2)*Math.pow(I.x,2)));isNaN(U)&&(U=0);var Z=new Io(U*n*I.y/o,U*-o*I.x/n),Y=new Io((t.x+T.x)/2+Math.cos(y)*Z.x-Math.sin(y)*Z.y,(t.y+T.y)/2+Math.sin(y)*Z.x+Math.cos(y)*Z.y),he=kI([1,0],[(I.x-Z.x)/n,(I.y-Z.y)/o]),ce=[(I.x-Z.x)/n,(I.y-Z.y)/o],pe=[(-I.x-Z.x)/n,(-I.y-Z.y)/o],be=kI(ce,pe);return wx(ce,pe)<=-1&&(be=Math.PI),wx(ce,pe)>=1&&(be=0),{currentPoint:T,rX:n,rY:o,sweepFlag:g,xAxisRotation:y,centp:Y,a1:he,ad:be}}pathA(e,t){var{pathParser:i}=this,{currentPoint:n,rX:o,rY:a,sweepFlag:s,xAxisRotation:g,centp:y,a1:T,ad:I}=hs.pathA(i),R=1-s?1:-1,U=T+R*(I/2),Z=new Io(y.x+o*Math.cos(U),y.y+a*Math.sin(U));if(i.addMarkerAngle(Z,U-R*Math.PI/2),i.addMarkerAngle(n,U-R*Math.PI),t.addPoint(n.x,n.y),e&&!isNaN(T)&&!isNaN(I)){var Y=o>a?o:a,he=o>a?1:o/a,ce=o>a?a/o:1;e.translate(y.x,y.y),e.rotate(g),e.scale(he,ce),e.arc(0,0,Y,T,T+I,!!(1-s)),e.scale(1/he,1/ce),e.rotate(-g),e.translate(-y.x,-y.y)}}static pathZ(e){e.current=e.start}pathZ(e,t){hs.pathZ(this.pathParser),e&&t.x1!==t.x2&&t.y1!==t.y2&&e.closePath()}}class qI extends hs{constructor(e,t,i){super(e,t,i),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}}class WA extends Hd{constructor(e,t,i){super(e,t,new.target===WA?!0:i),this.type="text",this.x=0,this.y=0,this.measureCache=-1}setContext(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.setContext(e,t);var i=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();i&&(e.textBaseline=i)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(e){if(this.type!=="text")return this.getTElementBoundingBox(e);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e);var t=null;return this.children.forEach((i,n)=>{var o=this.getChildBoundingBox(e,this,this,n);t?t.addBoundingBox(o):t=o}),t}getFontSize(){var{document:e,parent:t}=this,i=Vl.parse(e.ctx.font).fontSize,n=t.getStyle("font-size").getNumber(i);return n}getTElementBoundingBox(e){var t=this.getFontSize();return new Qu(this.x,this.y-t,this.x+this.measureText(e),this.y)}getGlyph(e,t,i){var n=t[i],o=null;if(e.isArabic){var a=t.length,s=t[i-1],g=t[i+1],y="isolated";if((i===0||s===" ")&&i<a-1&&g!==" "&&(y="terminal"),i>0&&s!==" "&&i<a-1&&g!==" "&&(y="medial"),i>0&&s!==" "&&(i===a-1||g===" ")&&(y="initial"),typeof e.glyphs[n]<"u"){var T=e.glyphs[n];o=T instanceof qI?T:T[y]}}else o=e.glyphs[n];return o||(o=e.missingGlyph),o}getText(){return""}getTextFromNode(e){var t=e||this.node,i=Array.from(t.parentNode.childNodes),n=i.indexOf(t),o=i.length-1,a=np(t.textContent||"");return n===0&&(a=U8(a)),n===o&&(a=N8(a)),a}renderChildren(e){if(this.type!=="text"){this.renderTElementChildren(e);return}this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(e),this.children.forEach((i,n)=>{this.renderChild(e,this,this,n)});var{mouse:t}=this.document.screen;t.isWorking()&&t.checkBoundingBox(this,this.getBoundingBox(e))}renderTElementChildren(e){var{document:t,parent:i}=this,n=this.getText(),o=i.getStyle("font-family").getDefinition();if(o){for(var{unitsPerEm:a}=o.fontFace,s=Vl.parse(t.ctx.font),g=i.getStyle("font-size").getNumber(s.fontSize),y=i.getStyle("font-style").getString(s.fontStyle),T=g/a,I=o.isRTL?n.split("").reverse().join(""):n,R=Qc(i.getAttribute("dx").getString()),U=I.length,Z=0;Z<U;Z++){var Y=this.getGlyph(o,I,Z);e.translate(this.x,this.y),e.scale(T,-T);var he=e.lineWidth;e.lineWidth=e.lineWidth*a/g,y==="italic"&&e.transform(1,0,.4,1,0,0),Y.render(e),y==="italic"&&e.transform(1,0,-.4,1,0,0),e.lineWidth=he,e.scale(1/T,-1/T),e.translate(-this.x,-this.y),this.x+=g*(Y.horizAdvX||o.horizAdvX)/a,typeof R[Z]<"u"&&!isNaN(R[Z])&&(this.x+=R[Z])}return}var{x:ce,y:pe}=this;e.fillStyle&&e.fillText(n,ce,pe),e.strokeStyle&&e.strokeText(n,ce,pe)}applyAnchoring(){if(!(this.textChunkStart>=this.leafTexts.length)){var e=this.leafTexts[this.textChunkStart],t=e.getStyle("text-anchor").getString("start"),i=!1,n=0;t==="start"&&!i||t==="end"&&i?n=e.x-this.minX:t==="end"&&!i||t==="start"&&i?n=e.x-this.maxX:n=e.x-(this.minX+this.maxX)/2;for(var o=this.textChunkStart;o<this.leafTexts.length;o++)this.leafTexts[o].x+=n;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}}adjustChildCoordinatesRecursive(e){this.children.forEach((t,i)=>{this.adjustChildCoordinatesRecursiveCore(e,this,this,i)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(e,t,i,n){var o=i.children[n];o.children.length>0?o.children.forEach((a,s)=>{t.adjustChildCoordinatesRecursiveCore(e,t,o,s)}):this.adjustChildCoordinates(e,t,i,n)}adjustChildCoordinates(e,t,i,n){var o=i.children[n];if(typeof o.measureText!="function")return o;e.save(),o.setContext(e,!0);var a=o.getAttribute("x"),s=o.getAttribute("y"),g=o.getAttribute("dx"),y=o.getAttribute("dy"),T=o.getStyle("font-family").getDefinition(),I=!!T&&T.isRTL;n===0&&(a.hasValue()||a.setValue(o.getInheritedAttribute("x")),s.hasValue()||s.setValue(o.getInheritedAttribute("y")),g.hasValue()||g.setValue(o.getInheritedAttribute("dx")),y.hasValue()||y.setValue(o.getInheritedAttribute("dy")));var R=o.measureText(e);return I&&(t.x-=R),a.hasValue()?(t.applyAnchoring(),o.x=a.getPixels("x"),g.hasValue()&&(o.x+=g.getPixels("x"))):(g.hasValue()&&(t.x+=g.getPixels("x")),o.x=t.x),t.x=o.x,I||(t.x+=R),s.hasValue()?(o.y=s.getPixels("y"),y.hasValue()&&(o.y+=y.getPixels("y"))):(y.hasValue()&&(t.y+=y.getPixels("y")),o.y=t.y),t.y=o.y,t.leafTexts.push(o),t.minX=Math.min(t.minX,o.x,o.x+R),t.maxX=Math.max(t.maxX,o.x,o.x+R),o.clearContext(e),e.restore(),o}getChildBoundingBox(e,t,i,n){var o=i.children[n];if(typeof o.getBoundingBox!="function")return null;var a=o.getBoundingBox(e);return a?(o.children.forEach((s,g)=>{var y=t.getChildBoundingBox(e,t,o,g);a.addBoundingBox(y)}),a):null}renderChild(e,t,i,n){var o=i.children[n];o.render(e),o.children.forEach((a,s)=>{t.renderChild(e,t,o,s)})}measureText(e){var{measureCache:t}=this;if(~t)return t;var i=this.getText(),n=this.measureTargetText(e,i);return this.measureCache=n,n}measureTargetText(e,t){if(!t.length)return 0;var{parent:i}=this,n=i.getStyle("font-family").getDefinition();if(n){for(var o=this.getFontSize(),a=n.isRTL?t.split("").reverse().join(""):t,s=Qc(i.getAttribute("dx").getString()),g=a.length,y=0,T=0;T<g;T++){var I=this.getGlyph(n,a,T);y+=(I.horizAdvX||n.horizAdvX)*o/n.fontFace.unitsPerEm,typeof s[T]<"u"&&!isNaN(s[T])&&(y+=s[T])}return y}if(!e.measureText)return t.length*10;e.save(),this.setContext(e,!0);var{width:R}=e.measureText(t);return this.clearContext(e),e.restore(),R}getInheritedAttribute(e){for(var t=this;t instanceof WA&&t.isFirstChild();){var i=t.parent.getAttribute(e);if(i.hasValue(!0))return i.getValue("0");t=t.parent}return null}}class Z0 extends WA{constructor(e,t,i){super(e,t,new.target===Z0?!0:i),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}getText(){return this.text}}class lwe extends Z0{constructor(){super(...arguments),this.type="textNode"}}class xm extends Hd{constructor(){super(...arguments),this.type="svg",this.root=!1}setContext(e){var t,{document:i}=this,{screen:n,window:o}=i,a=e.canvas;if(n.setDefaults(e),a.style&&typeof e.font<"u"&&o&&typeof o.getComputedStyle<"u"){e.font=o.getComputedStyle(a).getPropertyValue("font");var s=new Ti(i,"fontSize",Vl.parse(e.font).fontSize);s.hasValue()&&(i.rootEmSize=s.getPixels("y"),i.emSize=i.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);var{width:g,height:y}=n.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");var T=this.getAttribute("refX"),I=this.getAttribute("refY"),R=this.getAttribute("viewBox"),U=R.hasValue()?Qc(R.getString()):null,Z=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible",Y=0,he=0,ce=0,pe=0;U&&(Y=U[0],he=U[1]),this.root||(g=this.getStyle("width").getPixels("x"),y=this.getStyle("height").getPixels("y"),this.type==="marker"&&(ce=Y,pe=he,Y=0,he=0)),n.viewPort.setCurrent(g,y),this.node&&(!this.parent||((t=this.node.parentNode)===null||t===void 0?void 0:t.nodeName)==="foreignObject")&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(e),e.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),U&&(g=U[2],y=U[3]),i.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:n.viewPort.width,desiredWidth:g,height:n.viewPort.height,desiredHeight:y,minX:Y,minY:he,refX:T.getValue(),refY:I.getValue(),clip:Z,clipX:ce,clipY:pe}),U&&(n.viewPort.removeCurrent(),n.viewPort.setCurrent(g,y))}clearContext(e){super.clearContext(e),this.document.screen.viewPort.removeCurrent()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,n=this.getAttribute("width",!0),o=this.getAttribute("height",!0),a=this.getAttribute("viewBox"),s=this.getAttribute("style"),g=n.getNumber(0),y=o.getNumber(0);if(i)if(typeof i=="string")this.getAttribute("preserveAspectRatio",!0).setValue(i);else{var T=this.getAttribute("preserveAspectRatio");T.hasValue()&&T.setValue(T.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(n.setValue(e),o.setValue(t),a.hasValue()||a.setValue("0 0 ".concat(g||e," ").concat(y||t)),s.hasValue()){var I=this.getStyle("width"),R=this.getStyle("height");I.hasValue()&&I.setValue("".concat(e,"px")),R.hasValue()&&R.setValue("".concat(t,"px"))}}}class $I extends hs{constructor(){super(...arguments),this.type="rect"}path(e){var t=this.getAttribute("x").getPixels("x"),i=this.getAttribute("y").getPixels("y"),n=this.getStyle("width",!1,!0).getPixels("x"),o=this.getStyle("height",!1,!0).getPixels("y"),a=this.getAttribute("rx"),s=this.getAttribute("ry"),g=a.getPixels("x"),y=s.getPixels("y");if(a.hasValue()&&!s.hasValue()&&(y=g),s.hasValue()&&!a.hasValue()&&(g=y),g=Math.min(g,n/2),y=Math.min(y,o/2),e){var T=4*((Math.sqrt(2)-1)/3);e.beginPath(),o>0&&n>0&&(e.moveTo(t+g,i),e.lineTo(t+n-g,i),e.bezierCurveTo(t+n-g+T*g,i,t+n,i+y-T*y,t+n,i+y),e.lineTo(t+n,i+o-y),e.bezierCurveTo(t+n,i+o-y+T*y,t+n-g+T*g,i+o,t+n-g,i+o),e.lineTo(t+g,i+o),e.bezierCurveTo(t+g-T*g,i+o,t,i+o-y+T*y,t,i+o-y),e.lineTo(t,i+y),e.bezierCurveTo(t,i+y-T*y,t+g-T*g,i,t+g,i),e.closePath())}return new Qu(t,i,t+n,i+o)}getMarkers(){return null}}class Y8 extends hs{constructor(){super(...arguments),this.type="circle"}path(e){var t=this.getAttribute("cx").getPixels("x"),i=this.getAttribute("cy").getPixels("y"),n=this.getAttribute("r").getPixels();return e&&n>0&&(e.beginPath(),e.arc(t,i,n,0,Math.PI*2,!1),e.closePath()),new Qu(t-n,i-n,t+n,i+n)}getMarkers(){return null}}class ez extends hs{constructor(){super(...arguments),this.type="ellipse"}path(e){var t=4*((Math.sqrt(2)-1)/3),i=this.getAttribute("rx").getPixels("x"),n=this.getAttribute("ry").getPixels("y"),o=this.getAttribute("cx").getPixels("x"),a=this.getAttribute("cy").getPixels("y");return e&&i>0&&n>0&&(e.beginPath(),e.moveTo(o+i,a),e.bezierCurveTo(o+i,a+t*n,o+t*i,a+n,o,a+n),e.bezierCurveTo(o-t*i,a+n,o-i,a+t*n,o-i,a),e.bezierCurveTo(o-i,a-t*n,o-t*i,a-n,o,a-n),e.bezierCurveTo(o+t*i,a-n,o+i,a-t*n,o+i,a),e.closePath()),new Qu(o-i,a-n,o+i,a+n)}getMarkers(){return null}}class tz extends hs{constructor(){super(...arguments),this.type="line"}getPoints(){return[new Io(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new Io(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(e){var[{x:t,y:i},{x:n,y:o}]=this.getPoints();return e&&(e.beginPath(),e.moveTo(t,i),e.lineTo(n,o)),new Qu(t,i,n,o)}getMarkers(){var[e,t]=this.getPoints(),i=e.angleTo(t);return[[e,i],[t,i]]}}class KI extends hs{constructor(e,t,i){super(e,t,i),this.type="polyline",this.points=[],this.points=Io.parsePath(this.getAttribute("points").getString())}path(e){var{points:t}=this,[{x:i,y:n}]=t,o=new Qu(i,n);return e&&(e.beginPath(),e.moveTo(i,n)),t.forEach(a=>{var{x:s,y:g}=a;o.addPoint(s,g),e&&e.lineTo(s,g)}),o}getMarkers(){var{points:e}=this,t=e.length-1,i=[];return e.forEach((n,o)=>{o!==t&&i.push([n,n.angleTo(e[o+1])])}),i.length>0&&i.push([e[e.length-1],i[i.length-1][1]]),i}}class rz extends KI{constructor(){super(...arguments),this.type="polygon"}path(e){var t=super.path(e),[{x:i,y:n}]=this.points;return e&&(e.lineTo(i,n),e.closePath()),t}}class iz extends js{constructor(){super(...arguments),this.type="pattern"}createPattern(e,t,i){var n=this.getStyle("width").getPixels("x",!0),o=this.getStyle("height").getPixels("y",!0),a=new xm(this.document,null);a.attributes.viewBox=new Ti(this.document,"viewBox",this.getAttribute("viewBox").getValue()),a.attributes.width=new Ti(this.document,"width","".concat(n,"px")),a.attributes.height=new Ti(this.document,"height","".concat(o,"px")),a.attributes.transform=new Ti(this.document,"transform",this.getAttribute("patternTransform").getValue()),a.children=this.children;var s=this.document.createCanvas(n,o),g=s.getContext("2d"),y=this.getAttribute("x"),T=this.getAttribute("y");y.hasValue()&&T.hasValue()&&g.translate(y.getPixels("x",!0),T.getPixels("y",!0)),i.hasValue()?this.styles["fill-opacity"]=i:Reflect.deleteProperty(this.styles,"fill-opacity");for(var I=-1;I<=1;I++)for(var R=-1;R<=1;R++)g.save(),a.attributes.x=new Ti(this.document,"x",I*s.width),a.attributes.y=new Ti(this.document,"y",R*s.height),a.render(g),g.restore();var U=e.createPattern(s,"repeat");return U}}class nz extends js{constructor(){super(...arguments),this.type="marker"}render(e,t,i){if(t){var{x:n,y:o}=t,a=this.getAttribute("orient").getString("auto"),s=this.getAttribute("markerUnits").getString("strokeWidth");e.translate(n,o),a==="auto"&&e.rotate(i),s==="strokeWidth"&&e.scale(e.lineWidth,e.lineWidth),e.save();var g=new xm(this.document,null);g.type=this.type,g.attributes.viewBox=new Ti(this.document,"viewBox",this.getAttribute("viewBox").getValue()),g.attributes.refX=new Ti(this.document,"refX",this.getAttribute("refX").getValue()),g.attributes.refY=new Ti(this.document,"refY",this.getAttribute("refY").getValue()),g.attributes.width=new Ti(this.document,"width",this.getAttribute("markerWidth").getValue()),g.attributes.height=new Ti(this.document,"height",this.getAttribute("markerHeight").getValue()),g.attributes.overflow=new Ti(this.document,"overflow",this.getAttribute("overflow").getValue()),g.attributes.fill=new Ti(this.document,"fill",this.getAttribute("fill").getColor("black")),g.attributes.stroke=new Ti(this.document,"stroke",this.getAttribute("stroke").getValue("none")),g.children=this.children,g.render(e),e.restore(),s==="strokeWidth"&&e.scale(1/e.lineWidth,1/e.lineWidth),a==="auto"&&e.rotate(-i),e.translate(-n,-o)}}}class sz extends js{constructor(){super(...arguments),this.type="defs"}render(){}}class Cx extends Hd{constructor(){super(...arguments),this.type="g"}getBoundingBox(e){var t=new Qu;return this.children.forEach(i=>{t.addBoundingBox(i.getBoundingBox(e))}),t}}class WI extends js{constructor(e,t,i){super(e,t,i),this.attributesToInherit=["gradientUnits"],this.stops=[];var{stops:n,children:o}=this;o.forEach(a=>{a.type==="stop"&&n.push(a)})}getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(e,t,i){var n=this;this.getHrefAttribute().hasValue()&&(n=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(n));var{stops:o}=n,a=this.getGradient(e,t);if(!a)return this.addParentOpacity(i,o[o.length-1].color);if(o.forEach(he=>{a.addColorStop(he.offset,this.addParentOpacity(i,he.color))}),this.getAttribute("gradientTransform").hasValue()){var{document:s}=this,{MAX_VIRTUAL_PIXELS:g,viewPort:y}=s.screen,[T]=y.viewPorts,I=new $I(s,null);I.attributes.x=new Ti(s,"x",-g/3),I.attributes.y=new Ti(s,"y",-g/3),I.attributes.width=new Ti(s,"width",g),I.attributes.height=new Ti(s,"height",g);var R=new Cx(s,null);R.attributes.transform=new Ti(s,"transform",this.getAttribute("gradientTransform").getValue()),R.children=[I];var U=new xm(s,null);U.attributes.x=new Ti(s,"x",0),U.attributes.y=new Ti(s,"y",0),U.attributes.width=new Ti(s,"width",T.width),U.attributes.height=new Ti(s,"height",T.height),U.children=[R];var Z=s.createCanvas(T.width,T.height),Y=Z.getContext("2d");return Y.fillStyle=a,U.render(Y),Y.createPattern(Z,"no-repeat")}return a}inheritStopContainer(e){this.attributesToInherit.forEach(t=>{!this.getAttribute(t).hasValue()&&e.getAttribute(t).hasValue()&&this.getAttribute(t,!0).setValue(e.getAttribute(t).getValue())})}addParentOpacity(e,t){if(e.hasValue()){var i=new Ti(this.document,"color",t);return i.addOpacity(e).getColor()}return t}}class oz extends WI{constructor(e,t,i){super(e,t,i),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}getGradient(e,t){var i=this.getGradientUnits()==="objectBoundingBox",n=i?t.getBoundingBox(e):null;if(i&&!n)return null;!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()&&(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));var o=i?n.x+n.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),a=i?n.y+n.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),s=i?n.x+n.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),g=i?n.y+n.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return o===s&&a===g?null:e.createLinearGradient(o,a,s,g)}}class az extends WI{constructor(e,t,i){super(e,t,i),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}getGradient(e,t){var i=this.getGradientUnits()==="objectBoundingBox",n=t.getBoundingBox(e);if(i&&!n)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");var o=i?n.x+n.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),a=i?n.y+n.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y"),s=o,g=a;this.getAttribute("fx").hasValue()&&(s=i?n.x+n.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(g=i?n.y+n.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));var y=i?(n.width+n.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),T=this.getAttribute("fr").getPixels();return e.createRadialGradient(s,g,T,o,a,y)}}class lz extends js{constructor(e,t,i){super(e,t,i),this.type="stop";var n=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),o=this.getStyle("stop-opacity"),a=this.getStyle("stop-color",!0);a.getString()===""&&a.setValue("#000"),o.hasValue()&&(a=a.addOpacity(o)),this.offset=n,this.color=a.getColor()}}class Ex extends js{constructor(e,t,i){super(e,t,i),this.type="animate",this.duration=0,this.initialValue=null,this.initialUnits="",this.removed=!1,this.frozen=!1,e.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new Ti(e,"values",null);var n=this.getAttribute("values");n.hasValue()&&this.values.setValue(n.getString().split(";"))}getProperty(){var e=this.getAttribute("attributeType").getString(),t=this.getAttribute("attributeName").getString();return e==="CSS"?this.parent.getStyle(t,!0):this.parent.getAttribute(t,!0)}calcValue(){var{initialUnits:e}=this,{progress:t,from:i,to:n}=this.getProgress(),o=i.getNumber()+(n.getNumber()-i.getNumber())*t;return e==="%"&&(o*=100),"".concat(o).concat(e)}update(e){var{parent:t}=this,i=this.getProperty();if(this.initialValue||(this.initialValue=i.getString(),this.initialUnits=i.getUnits()),this.duration>this.maxDuration){var n=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(n==="freeze"&&!this.frozen)this.frozen=!0,t.animationFrozen=!0,t.animationFrozenValue=i.getString();else if(n==="remove"&&!this.removed)return this.removed=!0,i.setValue(t.animationFrozen?t.animationFrozenValue:this.initialValue),!0;return!1}this.duration+=e;var o=!1;if(this.begin<this.duration){var a=this.calcValue(),s=this.getAttribute("type");if(s.hasValue()){var g=s.getString();a="".concat(g,"(").concat(a,")")}i.setValue(a),o=!0}return o}getProgress(){var{document:e,values:t}=this,i={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(t.hasValue()){var n=i.progress*(t.getValue().length-1),o=Math.floor(n),a=Math.ceil(n);i.from=new Ti(e,"from",parseFloat(t.getValue()[o])),i.to=new Ti(e,"to",parseFloat(t.getValue()[a])),i.progress=(n-o)/(a-o)}else i.from=this.from,i.to=this.to;return i}}class cz extends Ex{constructor(){super(...arguments),this.type="animateColor"}calcValue(){var{progress:e,from:t,to:i}=this.getProgress(),n=new II(t.getColor()),o=new II(i.getColor());if(n.ok&&o.ok){var a=n.r+(o.r-n.r)*e,s=n.g+(o.g-n.g)*e,g=n.b+(o.b-n.b)*e;return"rgb(".concat(Math.floor(a),", ").concat(Math.floor(s),", ").concat(Math.floor(g),")")}return this.getAttribute("from").getColor()}}class uz extends Ex{constructor(){super(...arguments),this.type="animateTransform"}calcValue(){var{progress:e,from:t,to:i}=this.getProgress(),n=Qc(t.getString()),o=Qc(i.getString()),a=n.map((s,g)=>{var y=o[g];return s+(y-s)*e}).join(" ");return a}}class hz extends js{constructor(e,t,i){super(e,t,i),this.type="font",this.glyphs={},this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();var{definitions:n}=e,{children:o}=this;for(var a of o)switch(a.type){case"font-face":{this.fontFace=a;var s=a.getStyle("font-family");s.hasValue()&&(n[s.getString()]=this);break}case"missing-glyph":this.missingGlyph=a;break;case"glyph":{var g=a;g.arabicForm?(this.isRTL=!0,this.isArabic=!0,typeof this.glyphs[g.unicode]>"u"&&(this.glyphs[g.unicode]={}),this.glyphs[g.unicode][g.arabicForm]=g):this.glyphs[g.unicode]=g;break}}}render(){}}class Az extends js{constructor(e,t,i){super(e,t,i),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class dz extends hs{constructor(){super(...arguments),this.type="missing-glyph",this.horizAdvX=0}}class fz extends WA{constructor(){super(...arguments),this.type="tref"}getText(){var e=this.getHrefAttribute().getDefinition();if(e){var t=e.children[0];if(t)return t.getText()}return""}}class pz extends WA{constructor(e,t,i){super(e,t,i),this.type="a";var{childNodes:n}=t,o=n[0],a=n.length>0&&Array.from(n).every(s=>s.nodeType===3);this.hasText=a,this.text=a?this.getTextFromNode(o):""}getText(){return this.text}renderChildren(e){if(this.hasText){super.renderChildren(e);var{document:t,x:i,y:n}=this,{mouse:o}=t.screen,a=new Ti(t,"fontSize",Vl.parse(t.ctx.font).fontSize);o.isWorking()&&o.checkBoundingBox(this,new Qu(i,n-a.getPixels("y"),i+this.measureText(e),n))}else if(this.children.length>0){var s=new Cx(this.document,null);s.children=this.children,s.parent=this,s.render(e)}}onClick(){var{window:e}=this.document;e&&e.open(this.getHrefAttribute().getString())}onMouseMove(){var e=this.document.ctx;e.canvas.style.cursor="pointer"}}function gz(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),t.push.apply(t,i)}return t}function Sx(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gz(Object(t),!0).forEach(function(i){xI(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):gz(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}class mz extends WA{constructor(e,t,i){super(e,t,i),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);var n=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(n)}getText(){return this.text}path(e){var{dataArray:t}=this;e&&e.beginPath(),t.forEach(i=>{var{type:n,points:o}=i;switch(n){case en.LINE_TO:e&&e.lineTo(o[0],o[1]);break;case en.MOVE_TO:e&&e.moveTo(o[0],o[1]);break;case en.CURVE_TO:e&&e.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case en.QUAD_TO:e&&e.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case en.ARC:{var[a,s,g,y,T,I,R,U]=o,Z=g>y?g:y,Y=g>y?1:g/y,he=g>y?y/g:1;e&&(e.translate(a,s),e.rotate(R),e.scale(Y,he),e.arc(0,0,Z,T,T+I,!!(1-U)),e.scale(1/Y,1/he),e.rotate(-R),e.translate(-a,-s));break}case en.CLOSE_PATH:e&&e.closePath();break}})}renderChildren(e){this.setTextData(e),e.save();var t=this.parent.getStyle("text-decoration").getString(),i=this.getFontSize(),{glyphInfo:n}=this,o=e.fillStyle;t==="underline"&&e.beginPath(),n.forEach((a,s)=>{var{p0:g,p1:y,rotation:T,text:I}=a;e.save(),e.translate(g.x,g.y),e.rotate(T),e.fillStyle&&e.fillText(I,0,0),e.strokeStyle&&e.strokeText(I,0,0),e.restore(),t==="underline"&&(s===0&&e.moveTo(g.x,g.y+i/8),e.lineTo(y.x,y.y+i/5))}),t==="underline"&&(e.lineWidth=i/20,e.strokeStyle=o,e.stroke(),e.closePath()),e.restore()}getLetterSpacingAt(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[e]||0}findSegmentToFitChar(e,t,i,n,o,a,s,g,y){var T=a,I=this.measureText(e,g);g===" "&&t==="justify"&&i<n&&(I+=(n-i)/o),y>-1&&(T+=this.getLetterSpacingAt(y));var R=this.textHeight/20,U=this.getEquidistantPointOnPath(T,R,0),Z=this.getEquidistantPointOnPath(T+I,R,0),Y={p0:U,p1:Z},he=U&&Z?Math.atan2(Z.y-U.y,Z.x-U.x):0;if(s){var ce=Math.cos(Math.PI/2+he)*s,pe=Math.cos(-he)*s;Y.p0=Sx(Sx({},U),{},{x:U.x+ce,y:U.y+pe}),Y.p1=Sx(Sx({},Z),{},{x:Z.x+ce,y:Z.y+pe})}return T+=I,{offset:T,segment:Y,rotation:he}}measureText(e,t){var{measuresCache:i}=this,n=t||this.getText();if(i.has(n))return i.get(n);var o=this.measureTargetText(e,n);return i.set(n,o),o}setTextData(e){if(!this.glyphInfo){var t=this.getText(),i=t.split(""),n=t.split(" ").length-1,o=this.parent.getAttribute("dx").split().map(Te=>Te.getPixels("x")),a=this.parent.getAttribute("dy").getPixels("y"),s=this.parent.getStyle("text-anchor").getString("start"),g=this.getStyle("letter-spacing"),y=this.parent.getStyle("letter-spacing"),T=0;!g.hasValue()||g.getValue()==="inherit"?T=y.getPixels():g.hasValue()&&g.getValue()!=="initial"&&g.getValue()!=="unset"&&(T=g.getPixels());var I=[],R=t.length;this.letterSpacingCache=I;for(var U=0;U<R;U++)I.push(typeof o[U]<"u"?o[U]:T);var Z=I.reduce((Te,qe,je)=>je===0?0:Te+qe||0,0),Y=this.measureText(e),he=Math.max(Y+Z,0);this.textWidth=Y,this.textHeight=this.getFontSize(),this.glyphInfo=[];var ce=this.getPathLength(),pe=this.getStyle("startOffset").getNumber(0)*ce,be=0;(s==="middle"||s==="center")&&(be=-he/2),(s==="end"||s==="right")&&(be=-he),be+=pe,i.forEach((Te,qe)=>{var{offset:je,segment:We,rotation:Ne}=this.findSegmentToFitChar(e,s,he,ce,n,be,a,Te,qe);be=je,!(!We.p0||!We.p1)&&this.glyphInfo.push({text:i[qe],p0:We.p0,p1:We.p1,rotation:Ne})})}}parsePathData(e){if(this.pathLength=-1,!e)return[];var t=[],{pathParser:i}=e;for(i.reset();!i.isEnd();){var{current:n}=i,o=n?n.x:0,a=n?n.y:0,s=i.next(),g=s.type,y=[];switch(s.type){case en.MOVE_TO:this.pathM(i,y);break;case en.LINE_TO:g=this.pathL(i,y);break;case en.HORIZ_LINE_TO:g=this.pathH(i,y);break;case en.VERT_LINE_TO:g=this.pathV(i,y);break;case en.CURVE_TO:this.pathC(i,y);break;case en.SMOOTH_CURVE_TO:g=this.pathS(i,y);break;case en.QUAD_TO:this.pathQ(i,y);break;case en.SMOOTH_QUAD_TO:g=this.pathT(i,y);break;case en.ARC:y=this.pathA(i);break;case en.CLOSE_PATH:hs.pathZ(i);break}s.type!==en.CLOSE_PATH?t.push({type:g,points:y,start:{x:o,y:a},pathLength:this.calcLength(o,a,g,y)}):t.push({type:en.CLOSE_PATH,points:[],pathLength:0})}return t}pathM(e,t){var{x:i,y:n}=hs.pathM(e).point;t.push(i,n)}pathL(e,t){var{x:i,y:n}=hs.pathL(e).point;return t.push(i,n),en.LINE_TO}pathH(e,t){var{x:i,y:n}=hs.pathH(e).point;return t.push(i,n),en.LINE_TO}pathV(e,t){var{x:i,y:n}=hs.pathV(e).point;return t.push(i,n),en.LINE_TO}pathC(e,t){var{point:i,controlPoint:n,currentPoint:o}=hs.pathC(e);t.push(i.x,i.y,n.x,n.y,o.x,o.y)}pathS(e,t){var{point:i,controlPoint:n,currentPoint:o}=hs.pathS(e);return t.push(i.x,i.y,n.x,n.y,o.x,o.y),en.CURVE_TO}pathQ(e,t){var{controlPoint:i,currentPoint:n}=hs.pathQ(e);t.push(i.x,i.y,n.x,n.y)}pathT(e,t){var{controlPoint:i,currentPoint:n}=hs.pathT(e);return t.push(i.x,i.y,n.x,n.y),en.QUAD_TO}pathA(e){var{rX:t,rY:i,sweepFlag:n,xAxisRotation:o,centp:a,a1:s,ad:g}=hs.pathA(e);return n===0&&g>0&&(g-=2*Math.PI),n===1&&g<0&&(g+=2*Math.PI),[a.x,a.y,t,i,s,g,o,n]}calcLength(e,t,i,n){var o=0,a=null,s=null,g=0;switch(i){case en.LINE_TO:return this.getLineLength(e,t,n[0],n[1]);case en.CURVE_TO:for(o=0,a=this.getPointOnCubicBezier(0,e,t,n[0],n[1],n[2],n[3],n[4],n[5]),g=.01;g<=1;g+=.01)s=this.getPointOnCubicBezier(g,e,t,n[0],n[1],n[2],n[3],n[4],n[5]),o+=this.getLineLength(a.x,a.y,s.x,s.y),a=s;return o;case en.QUAD_TO:for(o=0,a=this.getPointOnQuadraticBezier(0,e,t,n[0],n[1],n[2],n[3]),g=.01;g<=1;g+=.01)s=this.getPointOnQuadraticBezier(g,e,t,n[0],n[1],n[2],n[3]),o+=this.getLineLength(a.x,a.y,s.x,s.y),a=s;return o;case en.ARC:{o=0;var y=n[4],T=n[5],I=n[4]+T,R=Math.PI/180;if(Math.abs(y-I)<R&&(R=Math.abs(y-I)),a=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],y,0),T<0)for(g=y-R;g>I;g-=R)s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],g,0),o+=this.getLineLength(a.x,a.y,s.x,s.y),a=s;else for(g=y+R;g<I;g+=R)s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],g,0),o+=this.getLineLength(a.x,a.y,s.x,s.y),a=s;return s=this.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],I,0),o+=this.getLineLength(a.x,a.y,s.x,s.y),o}}return 0}getPointOnLine(e,t,i,n,o){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:t,s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:i,g=(o-i)/(n-t+op),y=Math.sqrt(e*e/(1+g*g));n<t&&(y*=-1);var T=g*y,I=null;if(n===t)I={x:a,y:s+T};else if((s-i)/(a-t+op)===g)I={x:a+y,y:s+T};else{var R=0,U=0,Z=this.getLineLength(t,i,n,o);if(Z<op)return null;var Y=(a-t)*(n-t)+(s-i)*(o-i);Y/=Z*Z,R=t+Y*(n-t),U=i+Y*(o-i);var he=this.getLineLength(a,s,R,U),ce=Math.sqrt(e*e-he*he);y=Math.sqrt(ce*ce/(1+g*g)),n<t&&(y*=-1),T=g*y,I={x:R+y,y:U+T}}return I}getPointOnPath(e){var t=this.getPathLength(),i=0,n=null;if(e<-5e-5||e-5e-5>t)return null;var{dataArray:o}=this;for(var a of o){if(a&&(a.pathLength<5e-5||i+a.pathLength+5e-5<e)){i+=a.pathLength;continue}var s=e-i,g=0;switch(a.type){case en.LINE_TO:n=this.getPointOnLine(s,a.start.x,a.start.y,a.points[0],a.points[1],a.start.x,a.start.y);break;case en.ARC:{var y=a.points[4],T=a.points[5],I=a.points[4]+T;if(g=y+s/a.pathLength*T,T<0&&g<I||T>=0&&g>I)break;n=this.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],g,a.points[6]);break}case en.CURVE_TO:g=s/a.pathLength,g>1&&(g=1),n=this.getPointOnCubicBezier(g,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3],a.points[4],a.points[5]);break;case en.QUAD_TO:g=s/a.pathLength,g>1&&(g=1),n=this.getPointOnQuadraticBezier(g,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3]);break}if(n)return n;break}return null}getLineLength(e,t,i,n){return Math.sqrt((i-e)*(i-e)+(n-t)*(n-t))}getPathLength(){return this.pathLength===-1&&(this.pathLength=this.dataArray.reduce((e,t)=>t.pathLength>0?e+t.pathLength:e,0)),this.pathLength}getPointOnCubicBezier(e,t,i,n,o,a,s,g,y){var T=g*OI(e)+a*UI(e)+n*NI(e)+t*zI(e),I=y*OI(e)+s*UI(e)+o*NI(e)+i*zI(e);return{x:T,y:I}}getPointOnQuadraticBezier(e,t,i,n,o,a,s){var g=a*QI(e)+n*VI(e)+t*HI(e),y=s*QI(e)+o*VI(e)+i*HI(e);return{x:g,y}}getPointOnEllipticalArc(e,t,i,n,o,a){var s=Math.cos(a),g=Math.sin(a),y={x:i*Math.cos(o),y:n*Math.sin(o)};return{x:e+(y.x*s-y.y*g),y:t+(y.x*g+y.y*s)}}buildEquidistantCache(e,t){var i=this.getPathLength(),n=t||.25,o=e||i/100;if(!this.equidistantCache||this.equidistantCache.step!==o||this.equidistantCache.precision!==n){this.equidistantCache={step:o,precision:n,points:[]};for(var a=0,s=0;s<=i;s+=n){var g=this.getPointOnPath(s),y=this.getPointOnPath(s+n);!g||!y||(a+=this.getLineLength(g.x,g.y,y.x,y.y),a>=o&&(this.equidistantCache.points.push({x:g.x,y:g.y,distance:s}),a-=o))}}}getEquidistantPointOnPath(e,t,i){if(this.buildEquidistantCache(t,i),e<0||e-this.getPathLength()>5e-5)return null;var n=Math.round(e/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[n]||null}}var cwe=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class yz extends Hd{constructor(e,t,i){super(e,t,i),this.type="image",this.loaded=!1;var n=this.getHrefAttribute().getString();if(n){var o=n.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(n);e.images.push(this),o?this.loadSvg(n):this.loadImage(n),this.isSvg=o}}loadImage(e){var t=this;return qA(function*(){try{var i=yield t.document.createImage(e);t.image=i}catch(n){console.error('Error while loading image "'.concat(e,'":'),n)}t.loaded=!0})()}loadSvg(e){var t=this;return qA(function*(){var i=cwe.exec(e);if(i){var n=i[5];i[4]==="base64"?t.image=atob(n):t.image=decodeURIComponent(n)}else try{var o=yield t.document.fetch(e),a=yield o.text();t.image=a}catch(s){console.error('Error while loading image "'.concat(e,'":'),s)}t.loaded=!0})()}renderChildren(e){var{document:t,image:i,loaded:n}=this,o=this.getAttribute("x").getPixels("x"),a=this.getAttribute("y").getPixels("y"),s=this.getStyle("width").getPixels("x"),g=this.getStyle("height").getPixels("y");if(!(!n||!i||!s||!g)){if(e.save(),e.translate(o,a),this.isSvg){var y=t.canvg.forkString(e,this.image,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:s,scaleHeight:g});y.document.documentElement.parent=this,y.render()}else{var T=this.image;t.setViewBox({ctx:e,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:s,desiredWidth:T.width,height:g,desiredHeight:T.height}),this.loaded&&(typeof T.complete>"u"||T.complete)&&e.drawImage(T,0,0)}e.restore()}}getBoundingBox(){var e=this.getAttribute("x").getPixels("x"),t=this.getAttribute("y").getPixels("y"),i=this.getStyle("width").getPixels("x"),n=this.getStyle("height").getPixels("y");return new Qu(e,t,e+i,t+n)}}class _z extends Hd{constructor(){super(...arguments),this.type="symbol"}render(e){}}class vz{constructor(e){this.document=e,this.loaded=!1,e.fonts.push(this)}load(e,t){var i=this;return qA(function*(){try{var{document:n}=i,o=yield n.canvg.parser.load(t),a=o.getElementsByTagName("font");Array.from(a).forEach(s=>{var g=n.createElement(s);n.definitions[e]=g})}catch(s){console.error('Error while loading font "'.concat(t,'":'),s)}i.loaded=!0})()}}class XI extends js{constructor(e,t,i){super(e,t,i),this.type="style";var n=np(Array.from(t.childNodes).map(a=>a.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")),o=n.split("}");o.forEach(a=>{var s=a.trim();if(s){var g=s.split("{"),y=g[0].split(","),T=g[1].split(";");y.forEach(I=>{var R=I.trim();if(R){var U=e.styles[R]||{};if(T.forEach(he=>{var ce=he.indexOf(":"),pe=he.substr(0,ce).trim(),be=he.substr(ce+1,he.length-ce).trim();pe&&be&&(U[pe]=new Ti(e,pe,be))}),e.styles[R]=U,e.stylesSpecificity[R]=V8(R),R==="@font-face"){var Z=U["font-family"].getString().replace(/"|'/g,""),Y=U.src.getString().split(",");Y.forEach(he=>{if(he.indexOf('format("svg")')>0){var ce=DI(he);ce&&new vz(e).load(Z,ce)}})}}})}})}}XI.parseExternalUrl=DI;class bz extends Hd{constructor(){super(...arguments),this.type="use"}setContext(e){super.setContext(e);var t=this.getAttribute("x"),i=this.getAttribute("y");t.hasValue()&&e.translate(t.getPixels("x"),0),i.hasValue()&&e.translate(0,i.getPixels("y"))}path(e){var{element:t}=this;t&&t.path(e)}renderChildren(e){var{document:t,element:i}=this;if(i){var n=i;if(i.type==="symbol"&&(n=new xm(t,null),n.attributes.viewBox=new Ti(t,"viewBox",i.getAttribute("viewBox").getString()),n.attributes.preserveAspectRatio=new Ti(t,"preserveAspectRatio",i.getAttribute("preserveAspectRatio").getString()),n.attributes.overflow=new Ti(t,"overflow",i.getAttribute("overflow").getString()),n.children=i.children,i.styles.opacity=new Ti(t,"opacity",this.calculateOpacity())),n.type==="svg"){var o=this.getStyle("width",!1,!0),a=this.getStyle("height",!1,!0);o.hasValue()&&(n.attributes.width=new Ti(t,"width",o.getString())),a.hasValue()&&(n.attributes.height=new Ti(t,"height",a.getString()))}var s=n.parent;n.parent=this,n.render(e),n.parent=s}}getBoundingBox(e){var{element:t}=this;return t?t.getBoundingBox(e):null}elementTransform(){var{document:e,element:t}=this;return Vd.fromElement(e,t)}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}}function Tx(r,e,t,i,n,o){return r[t*i*4+e*4+o]}function Ix(r,e,t,i,n,o,a){r[t*i*4+e*4+o]=a}function ha(r,e,t){var i=r[e];return i*t}function XA(r,e,t,i){return e+Math.cos(r)*t+Math.sin(r)*i}class ZI extends js{constructor(e,t,i){super(e,t,i),this.type="feColorMatrix";var n=Qc(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{var o=n[0];n=[.213+.787*o,.715-.715*o,.072-.072*o,0,0,.213-.213*o,.715+.285*o,.072-.072*o,0,0,.213-.213*o,.715-.715*o,.072+.928*o,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{var a=n[0]*Math.PI/180;n=[XA(a,.213,.787,-.213),XA(a,.715,-.715,-.715),XA(a,.072,-.072,.928),0,0,XA(a,.213,-.213,.143),XA(a,.715,.285,.14),XA(a,.072,-.072,-.283),0,0,XA(a,.213,-.213,-.787),XA(a,.715,-.715,.715),XA(a,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=n,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}apply(e,t,i,n,o){for(var{includeOpacity:a,matrix:s}=this,g=e.getImageData(0,0,n,o),y=0;y<o;y++)for(var T=0;T<n;T++){var I=Tx(g.data,T,y,n,o,0),R=Tx(g.data,T,y,n,o,1),U=Tx(g.data,T,y,n,o,2),Z=Tx(g.data,T,y,n,o,3),Y=ha(s,0,I)+ha(s,1,R)+ha(s,2,U)+ha(s,3,Z)+ha(s,4,1),he=ha(s,5,I)+ha(s,6,R)+ha(s,7,U)+ha(s,8,Z)+ha(s,9,1),ce=ha(s,10,I)+ha(s,11,R)+ha(s,12,U)+ha(s,13,Z)+ha(s,14,1),pe=ha(s,15,I)+ha(s,16,R)+ha(s,17,U)+ha(s,18,Z)+ha(s,19,1);a&&(Y=0,he=0,ce=0,pe*=Z/255),Ix(g.data,T,y,n,o,0,Y),Ix(g.data,T,y,n,o,1,he),Ix(g.data,T,y,n,o,2,ce),Ix(g.data,T,y,n,o,3,pe)}e.clearRect(0,0,n,o),e.putImageData(g,0,0)}}class J0 extends js{constructor(){super(...arguments),this.type="mask"}apply(e,t){var{document:i}=this,n=this.getAttribute("x").getPixels("x"),o=this.getAttribute("y").getPixels("y"),a=this.getStyle("width").getPixels("x"),s=this.getStyle("height").getPixels("y");if(!a&&!s){var g=new Qu;this.children.forEach(Z=>{g.addBoundingBox(Z.getBoundingBox(e))}),n=Math.floor(g.x1),o=Math.floor(g.y1),a=Math.floor(g.width),s=Math.floor(g.height)}var y=this.removeStyles(t,J0.ignoreStyles),T=i.createCanvas(n+a,o+s),I=T.getContext("2d");i.screen.setDefaults(I),this.renderChildren(I),new ZI(i,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(I,0,0,n+a,o+s);var R=i.createCanvas(n+a,o+s),U=R.getContext("2d");i.screen.setDefaults(U),t.render(U),U.globalCompositeOperation="destination-in",U.fillStyle=I.createPattern(T,"no-repeat"),U.fillRect(0,0,n+a,o+s),e.fillStyle=U.createPattern(R,"no-repeat"),e.fillRect(0,0,n+a,o+s),this.restoreStyles(t,y)}render(e){}}J0.ignoreStyles=["mask","transform","clip-path"];var xz=()=>{};class wz extends js{constructor(){super(...arguments),this.type="clipPath"}apply(e){var{document:t}=this,i=Reflect.getPrototypeOf(e),{beginPath:n,closePath:o}=e;i&&(i.beginPath=xz,i.closePath=xz),Reflect.apply(n,e,[]),this.children.forEach(a=>{if(!(typeof a.path>"u")){var s=typeof a.elementTransform<"u"?a.elementTransform():null;s||(s=Vd.fromElement(t,a)),s&&s.apply(e),a.path(e),i&&(i.closePath=o),s&&s.unapply(e)}}),Reflect.apply(o,e,[]),e.clip(),i&&(i.beginPath=n,i.closePath=o)}render(e){}}class Y0 extends js{constructor(){super(...arguments),this.type="filter"}apply(e,t){var{document:i,children:n}=this,o=t.getBoundingBox(e);if(o){var a=0,s=0;n.forEach(ce=>{var pe=ce.extraFilterDistance||0;a=Math.max(a,pe),s=Math.max(s,pe)});var g=Math.floor(o.width),y=Math.floor(o.height),T=g+2*a,I=y+2*s;if(!(T<1||I<1)){var R=Math.floor(o.x),U=Math.floor(o.y),Z=this.removeStyles(t,Y0.ignoreStyles),Y=i.createCanvas(T,I),he=Y.getContext("2d");i.screen.setDefaults(he),he.translate(-R+a,-U+s),t.render(he),n.forEach(ce=>{typeof ce.apply=="function"&&ce.apply(he,0,0,T,I)}),e.drawImage(Y,0,0,T,I,R-a,U-s,T,I),this.restoreStyles(t,Z)}}}render(e){}}Y0.ignoreStyles=["filter","transform","clip-path"];class Bz extends js{constructor(e,t,i){super(e,t,i),this.type="feDropShadow",this.addStylesFromStyleDefinition()}apply(e,t,i,n,o){}}class Cz extends js{constructor(){super(...arguments),this.type="feMorphology"}apply(e,t,i,n,o){}}class Ez extends js{constructor(){super(...arguments),this.type="feComposite"}apply(e,t,i,n,o){}}class Sz extends js{constructor(e,t,i){super(e,t,i),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}apply(e,t,i,n,o){var{document:a,blurRadius:s}=this,g=a.window?a.window.document.body:null,y=e.canvas;y.id=a.getUniqueId(),g&&(y.style.display="none",g.appendChild(y)),Qxe(y,t,i,n,o,s),g&&g.removeChild(y)}}class Tz extends js{constructor(){super(...arguments),this.type="title"}}class Iz extends js{constructor(){super(...arguments),this.type="desc"}}var uwe={svg:xm,rect:$I,circle:Y8,ellipse:ez,line:tz,polyline:KI,polygon:rz,path:hs,pattern:iz,marker:nz,defs:sz,linearGradient:oz,radialGradient:az,stop:lz,animate:Ex,animateColor:cz,animateTransform:uz,font:hz,"font-face":Az,"missing-glyph":dz,glyph:qI,text:WA,tspan:Z0,tref:fz,a:pz,textPath:mz,image:yz,g:Cx,symbol:_z,style:XI,use:bz,mask:J0,clipPath:wz,filter:Y0,feDropShadow:Bz,feMorphology:Cz,feComposite:Ez,feColorMatrix:ZI,feGaussianBlur:Sz,title:Tz,desc:Iz};function Lz(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),t.push.apply(t,i)}return t}function hwe(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Lz(Object(t),!0).forEach(function(i){xI(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Lz(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function Awe(r,e){var t=document.createElement("canvas");return t.width=r,t.height=e,t}function dwe(r){return JI.apply(this,arguments)}function JI(){return JI=qA(function*(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=document.createElement("img");return e&&(t.crossOrigin="Anonymous"),new Promise((i,n)=>{t.onload=()=>{i(t)},t.onerror=(o,a,s,g,y)=>{n(y)},t.src=r})}),JI.apply(this,arguments)}class ZA{constructor(e){var{rootEmSize:t=12,emSize:i=12,createCanvas:n=ZA.createCanvas,createImage:o=ZA.createImage,anonymousCrossOrigin:a}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.canvg=e,this.definitions={},this.styles={},this.stylesSpecificity={},this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=e.screen,this.rootEmSize=t,this.emSize=i,this.createCanvas=n,this.createImage=this.bindCreateImage(o,a),this.screen.wait(this.isImagesLoaded.bind(this)),this.screen.wait(this.isFontsLoaded.bind(this))}bindCreateImage(e,t){return typeof t=="boolean"?(i,n)=>e(i,typeof n=="boolean"?n:t):e}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){var{emSizeStack:e}=this;return e[e.length-1]}set emSize(e){var{emSizeStack:t}=this;t.push(e)}popEmSize(){var{emSizeStack:e}=this;e.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(e=>e.loaded)}isFontsLoaded(){return this.fonts.every(e=>e.loaded)}createDocumentElement(e){var t=this.createElement(e.documentElement);return t.root=!0,t.addStylesFromStyleDefinition(),this.documentElement=t,t}createElement(e){var t=e.nodeName.replace(/^[^:]+:/,""),i=ZA.elementTypes[t];return typeof i<"u"?new i(this,e):new J8(this,e)}createTextNode(e){return new lwe(this,e)}setViewBox(e){this.screen.setViewBox(hwe({document:this},e))}}ZA.createCanvas=Awe,ZA.createImage=dwe,ZA.elementTypes=uwe;function Mz(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),t.push.apply(t,i)}return t}function ap(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Mz(Object(t),!0).forEach(function(i){xI(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Mz(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}class lp{constructor(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.parser=new Bx(i),this.screen=new X0(e,i),this.options=i;var n=new ZA(this,i),o=n.createDocumentElement(t);this.document=n,this.documentElement=o}static from(e,t){var i=arguments;return qA(function*(){var n=i.length>2&&i[2]!==void 0?i[2]:{},o=new Bx(n),a=yield o.parse(t);return new lp(e,a,n)})()}static fromString(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=new Bx(i),o=n.parseFromString(t);return new lp(e,o,i)}fork(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return lp.from(e,t,ap(ap({},this.options),i))}forkString(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return lp.fromString(e,t,ap(ap({},this.options),i))}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}render(){var e=arguments,t=this;return qA(function*(){var i=e.length>0&&e[0]!==void 0?e[0]:{};t.start(ap({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0},i)),yield t.ready(),t.stop()})()}start(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{documentElement:t,screen:i,options:n}=this;i.start(t,ap(ap({enableRedraw:!0},n),e))}stop(){this.screen.stop()}resize(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.documentElement.resize(e,t,i)}}const fwe=Object.freeze(Object.defineProperty({__proto__:null,AElement:pz,AnimateColorElement:cz,AnimateElement:Ex,AnimateTransformElement:uz,BoundingBox:Qu,CB1:OI,CB2:UI,CB3:NI,CB4:zI,Canvg:lp,CircleElement:Y8,ClipPathElement:wz,DefsElement:sz,DescElement:Iz,Document:ZA,Element:js,EllipseElement:ez,FeColorMatrixElement:ZI,FeCompositeElement:Ez,FeDropShadowElement:Bz,FeGaussianBlurElement:Sz,FeMorphologyElement:Cz,FilterElement:Y0,Font:Vl,FontElement:hz,FontFaceElement:Az,GElement:Cx,GlyphElement:qI,GradientElement:WI,ImageElement:yz,LineElement:tz,LinearGradientElement:oz,MarkerElement:nz,MaskElement:J0,Matrix:GI,MissingGlyphElement:dz,Mouse:G8,PSEUDO_ZERO:op,Parser:Bx,PathElement:hs,PathParser:en,PatternElement:iz,Point:Io,PolygonElement:rz,PolylineElement:KI,Property:Ti,QB1:QI,QB2:VI,QB3:HI,RadialGradientElement:az,RectElement:$I,RenderedElement:Hd,Rotate:K8,SVGElement:xm,SVGFontLoader:vz,Scale:W8,Screen:X0,Skew:jI,SkewX:X8,SkewY:Z8,StopElement:lz,StyleElement:XI,SymbolElement:_z,TRefElement:fz,TSpanElement:Z0,TextElement:WA,TextPathElement:mz,TitleElement:Tz,Transform:Vd,Translate:$8,UnknownElement:J8,UseElement:bz,ViewPort:H8,compressSpaces:np,default:lp,getSelectorSpecificity:V8,normalizeAttributeName:z8,normalizeColor:Q8,parseExternalUrl:DI,presets:jxe,toNumbers:Qc,trimLeft:U8,trimRight:N8,vectorMagnitude:RI,vectorsAngle:kI,vectorsRatio:wx},Symbol.toStringTag,{value:"Module"}));Ll.CompareMaps=dae,Ll.Map=aae,Object.defineProperty(Ll,Symbol.toStringTag,{value:"Module"})});
